import{ar as m,as as e}from"./index-Dlu2hcxn.js";import{r,aH as A,ar as T,f as w,w as M}from"./icons-BDU0tZd_.js";import"./react-DXGY7bZi.js";import"./pdf-D2LJUoLv.js";import"./supabase-VuevzHjS.js";const f=[{id:"message",label:"Messages",Icon:A,description:"Chat messages from field"},{id:"material_request",label:"Material Requests",Icon:T,description:"Equipment and material requests"},{id:"injury_report",label:"Safety Reports",Icon:w,description:"Injury and safety incident reports"},{id:"tm_ticket",label:"Time & Material",Icon:M,description:"Time & Material tickets"}];function R({project:c,company:l,onShowToast:p,onClose:o}){const[h,y]=r.useState([]),[g,d]=r.useState({}),[u,v]=r.useState([]),[b,x]=r.useState(!0),[j,N]=r.useState(!1);r.useEffect(()=>{S()},[c?.id,l?.id]);const S=async()=>{if(!(!c?.id||!l?.id))try{x(!0);const s=await m.getCompanyUsers(l.id);y(s);const i=await m.getProjectNotificationPreferences(c.id),a={};i.forEach(t=>{a[t.user_id]={types:t.notification_types||[],presetId:null}}),d(a);const n=await m.getNotificationPresets(l.id);v(n)}catch(s){console.error("Error loading notification settings:",s),p?.("Error loading notification settings","error")}finally{x(!1)}},P=(s,i)=>{d(a=>{const n=a[s]||{types:[]},t=n.types.includes(i)?n.types.filter(I=>I!==i):[...n.types,i];return{...a,[s]:{types:t,presetId:null}}})},C=(s,i)=>{const a=u.find(n=>n.id===i);a&&d(n=>({...n,[s]:{types:[...a.notification_types],presetId:i}}))},k=(s,i)=>{d(a=>({...a,[s]:{types:i?f.map(n=>n.id):[],presetId:null}}))},E=async()=>{try{N(!0);const s=Object.entries(g).map(([i,a])=>({userId:i,notificationTypes:a.types}));await m.setProjectNotificationPreferences(c.id,s),p?.("Notification settings saved","success"),o?.()}catch(s){console.error("Error saving notification settings:",s),p?.("Error saving notification settings","error")}finally{N(!1)}};return b?e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsx("button",{className:"close-btn",onClick:o,children:"×"})]}),e.jsx("div",{className:"loading-message",children:"Loading..."})]}):e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsxs("h3",{children:["Notification Settings for ",c?.name]}),e.jsx("button",{className:"close-btn",onClick:o,children:"×"})]}),e.jsx("p",{className:"settings-description",children:"Choose who receives notifications when field workers send messages, request materials, submit safety reports, or create Time & Material tickets for this project."}),h.length===0?e.jsxs("div",{className:"no-users-message",children:[e.jsx("p",{children:"No users found in this company."}),e.jsx("small",{children:"Users need to be added to the company to receive notifications."})]}):e.jsx("div",{className:"notification-users-list",children:h.map(s=>{const i=g[s.id]||{types:[],presetId:null},a=i.types.length===f.length,n=i.types.length>0&&!a;return e.jsxs("div",{className:"notification-user-row",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:s.name?.charAt(0).toUpperCase()||s.email?.charAt(0).toUpperCase()}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:s.name||s.email}),s.role&&e.jsx("span",{className:"user-role",children:s.role})]})]}),e.jsxs("div",{className:"notification-controls",children:[e.jsxs("select",{className:"preset-select",value:i.presetId||"",onChange:t=>t.target.value&&C(s.id,t.target.value),children:[e.jsx("option",{value:"",children:"Apply preset..."}),u.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("button",{className:`toggle-all-btn ${a?"all-on":n?"some-on":""}`,onClick:()=>k(s.id,!a),title:a?"Disable all":"Enable all",children:a?"All On":n?"Some":"None"})]}),e.jsx("div",{className:"notification-types",children:f.map(t=>e.jsxs("label",{className:`notification-type-toggle ${i.types.includes(t.id)?"active":""}`,title:t.description,children:[e.jsx("input",{type:"checkbox",checked:i.types.includes(t.id),onChange:()=>P(s.id,t.id)}),e.jsx("span",{className:"type-icon",children:e.jsx(t.Icon,{size:16})}),e.jsx("span",{className:"type-label",children:t.label})]},t.id))})]},s.id)})}),e.jsxs("div",{className:"notification-settings-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:o,children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:E,disabled:j,children:j?"Saving...":"Save Settings"})]})]})}export{R as default};
//# sourceMappingURL=NotificationSettings-Bu2KrPUE.js.map
