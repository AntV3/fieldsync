const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TMList-CN6nSl0q.js","assets/pdf-aQqpMATS.js","assets/index-Bi3H-AdY.js","assets/icons-Ng3QClhp.js","assets/react-DXGY7bZi.js","assets/supabase-VuevzHjS.js","assets/index-Ct9GPi7W.css","assets/SignatureLinkGenerator-DZlZDUfm.js","assets/corCalculations-vdJc_BOT.js","assets/CORLogPreview-BgxyUa-h.js","assets/CORList-DXli85C4.js","assets/CORLog-DQBLTyEo.js","assets/BillingCenter-DRBB9Q1u.js","assets/ShareModal-Ddtr0HjW.js","assets/NotificationSettings-gt9Jw8f6.js","assets/CORForm-DXEtRzoc.js","assets/CORDetail-B8SwJfm4.js","assets/SignatureCanvas-Bq2HrSHF.js","assets/DrawRequestModal-lmdqGmEl.js","assets/EquipmentModal-BPgYueNn.js","assets/AddCostModal-Q_cgwcyy.js","assets/DocumentsTab-CbmwkLSB.js"])))=>i.map(i=>d[i]);
import{_ as ne}from"./pdf-aQqpMATS.js";import{r as ys,c as yt,a as Rr,S as Pr,b as Tr,u as ts,s as Fr,d as Ar,e as Or,f as Mr,g as $r,h as Ir,i as Lr,j as Ye,k as Nt,l as zr,m as pa,n as qr,o as Vr,p as Br,D as Wa,q as wt,t as Wr,v as Ur,w as Hr,x as xa,y as Gr,z as Kr,A as Ua,Z as Ha,L as gs,C as Yr,B as Jr,E as Ie,F as va,G as Ct,H as Xr,I as Ks,J as kt,K as Ga,M as Ka,N as Qr,O as Zr,P as _t,Q as St,R as ei,T as si,U as Ya,V as fa,W as ti,X as ai,Y as ni,_ as ri,$ as ii,a0 as li,a1 as Ja,a2 as oi,a3 as ci,a4 as di,a5 as ui,a6 as mi,a7 as hi,a8 as pi,a9 as xi,aa as ja,ab as ga,ac as ba,ad as vi,ae as fi,af as ji,ag as es,ah as gi,ai as bi,aj as yi,ak as Xa,al as ut,am as Ni,an as wi,ao as Ci,ap as ki,aq as _i,ar as q,as as e,at as Dt,au as Si,av as Qa,aw as Za,ax as en,ay as Et,az as ya,aA as Di,aB as Ei,aC as Ri,aD as ss,aE as Pi,aF as sn,aG as js,aH as tn,aI as Ti,aJ as Fi,aK as hs,aL as Na,aM as ce,aN as Ai,aO as Oi,aP as Mi,aQ as $i}from"./index-Bi3H-AdY.js";import{r as c,e as an,X as os,a4 as Ii,Y as ft,y as Le,F as ns,s as xe,N as Re,a2 as Ws,T as is,a5 as Li,a6 as zi,D as We,a7 as nn,O as Ys,H as He,W as jt,a8 as mt,a9 as qi,c as Ns,K as ws,aa as Cs,m as Rt,b as wa,C as rn,Q as xs,ab as ln,ac as Vi,ad as Bi,ae as Wi,j as Ui,af as Hi,ag as Bs,l as Ge,p as Js,q as Je,ah as on,n as bs,R as Gi,ai as Ki,z as Yi,aj as Ji,i as Xi,ak as Qi,al as ht,a as gt,L as Ca,am as ka,d as Zi,an as _a,ao as el,h as sl,f as tl,ap as al,aq as nl,ar as rl}from"./icons-Ng3QClhp.js";import{f as Ne}from"./corCalculations-vdJc_BOT.js";function Us(){return Us=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},Us.apply(null,arguments)}function Sa(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function il(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Sa(Object(n),!0).forEach(function(a){ll(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Sa(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function ll(s,t,n){return(t=ol(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function ol(s){var t=cl(s,"string");return typeof t=="symbol"?t:t+""}function cl(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}var ye=32,dl={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function ul(s){var{data:t,iconType:n,inactiveColor:a}=s,r=ye/2,i=ye/6,l=ye/3,o=t.inactive?a:t.color,u=n??t.type;if(u==="none")return null;if(u==="plainline"){var m;return c.createElement("line",{strokeWidth:4,fill:"none",stroke:o,strokeDasharray:(m=t.payload)===null||m===void 0?void 0:m.strokeDasharray,x1:0,y1:r,x2:ye,y2:r,className:"recharts-legend-icon"})}if(u==="line")return c.createElement("path",{strokeWidth:4,fill:"none",stroke:o,d:"M0,".concat(r,"h").concat(l,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(2*l,",").concat(r,`
            H`).concat(ye,"M").concat(2*l,",").concat(r,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(l,",").concat(r),className:"recharts-legend-icon"});if(u==="rect")return c.createElement("path",{stroke:"none",fill:o,d:"M0,".concat(ye/8,"h").concat(ye,"v").concat(ye*3/4,"h").concat(-ye,"z"),className:"recharts-legend-icon"});if(c.isValidElement(t.legendIcon)){var d=il({},t);return delete d.legendIcon,c.cloneElement(t.legendIcon,d)}return c.createElement(Tr,{fill:o,cx:r,cy:r,size:ye,sizeType:"diameter",type:u})}function ml(s){var{payload:t,iconSize:n,layout:a,formatter:r,inactiveColor:i,iconType:l}=s,o={x:0,y:0,width:ye,height:ye},u={display:a==="horizontal"?"inline-block":"block",marginRight:10},m={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((d,p)=>{var v=d.formatter||r,j=yt({"recharts-legend-item":!0,["legend-item-".concat(p)]:!0,inactive:d.inactive});if(d.type==="none")return null;var h=d.inactive?i:d.color,x=v?v(d.value,d,p):d.value;return c.createElement("li",Us({className:j,style:u,key:"legend-item-".concat(p)},Rr(s,d,p)),c.createElement(Pr,{width:n,height:n,viewBox:o,style:m,"aria-label":"".concat(x," legend icon")},c.createElement(ul,{data:d,iconType:l,inactiveColor:i})),c.createElement("span",{className:"recharts-legend-item-text",style:{color:h}},x))})}var hl=s=>{var t=ys(s,dl),{payload:n,layout:a,align:r}=t;if(!n||!n.length)return null;var i={padding:0,margin:0,textAlign:a==="horizontal"?r:"left"};return c.createElement("ul",{className:"recharts-default-legend",style:i},c.createElement(ml,Us({},t,{payload:n})))};function pl(){return ts(Fr)}var xl=["contextPayload"];function bt(){return bt=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},bt.apply(null,arguments)}function Da(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function ls(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Da(Object(n),!0).forEach(function(a){vl(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Da(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function vl(s,t,n){return(t=fl(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function fl(s){var t=jl(s,"string");return typeof t=="symbol"?t:t+""}function jl(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function gl(s,t){if(s==null)return{};var n,a,r=bl(s,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(s,n)&&(r[n]=s[n])}return r}function bl(s,t){if(s==null)return{};var n={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(t.indexOf(a)!==-1)continue;n[a]=s[a]}return n}function yl(s){return s.value}function Nl(s){var{contextPayload:t}=s,n=gl(s,xl),a=qr(t,s.payloadUniqBy,yl),r=ls(ls({},n),{},{payload:a});return c.isValidElement(s.content)?c.cloneElement(s.content,r):typeof s.content=="function"?c.createElement(s.content,r):c.createElement(hl,r)}function wl(s,t,n,a,r,i){var{layout:l,align:o,verticalAlign:u}=t,m,d;return(!s||(s.left===void 0||s.left===null)&&(s.right===void 0||s.right===null))&&(o==="center"&&l==="vertical"?m={left:((a||0)-i.width)/2}:m=o==="right"?{right:n&&n.right||0}:{left:n&&n.left||0}),(!s||(s.top===void 0||s.top===null)&&(s.bottom===void 0||s.bottom===null))&&(u==="middle"?d={top:((r||0)-i.height)/2}:d=u==="bottom"?{bottom:n&&n.bottom||0}:{top:n&&n.top||0}),ls(ls({},m),d)}function Cl(s){var t=Nt();return c.useEffect(()=>{t(zr(s))},[t,s]),null}function kl(s){var t=Nt();return c.useEffect(()=>(t(pa(s)),()=>{t(pa({width:0,height:0}))}),[t,s]),null}function _l(s,t,n,a){return s==="vertical"&&Ye(t)?{height:t}:s==="horizontal"?{width:n||a}:null}var Sl={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function Xs(s){var t=ys(s,Sl),n=pl(),a=Ar(),r=Or(),{width:i,height:l,wrapperStyle:o,portal:u}=t,[m,d]=Mr([n]),p=$r(),v=Ir();if(p==null||v==null)return null;var j=p-(r?.left||0)-(r?.right||0),h=_l(t.layout,l,i,j),x=u?o:ls(ls({position:"absolute",width:h?.width||i||"auto",height:h?.height||l||"auto"},wl(o,t,r,p,v,m)),o),k=u??a;if(k==null||n==null)return null;var T=c.createElement("div",{className:"recharts-legend-wrapper",style:x,ref:d},c.createElement(Cl,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),!u&&c.createElement(kl,{width:m.width,height:m.height}),c.createElement(Nl,bt({},t,h,{margin:r,chartWidth:p,chartHeight:v,contextPayload:n})));return Lr.createPortal(T,k)}Xs.displayName="Legend";function Ea(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function Ra(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ea(Object(n),!0).forEach(function(a){Dl(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Ea(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function Dl(s,t,n){return(t=El(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function El(s){var t=Rl(s,"string");return typeof t=="symbol"?t:t+""}function Rl(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Hs(){return Hs=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},Hs.apply(null,arguments)}var Pl=(s,t)=>{var n;if(c.isValidElement(s))n=c.cloneElement(s,t);else if(typeof s=="function")n=s(t);else{if(!Ie(t.x1)||!Ie(t.y1)||!Ie(t.x2)||!Ie(t.y2))return null;n=c.createElement("line",Hs({},t,{className:"recharts-reference-line-line"}))}return n},Tl=(s,t,n,a,r,i)=>{var{x:l,width:o}=i,u=r.y.apply(s,{position:n});if(Ct(u)||t==="discard"&&!r.y.isInRange(u))return null;var m=[{x:l+o,y:u},{x:l,y:u}];return a==="left"?m.reverse():m},Fl=(s,t,n,a,r,i)=>{var{y:l,height:o}=i,u=r.x.apply(s,{position:n});if(Ct(u)||t==="discard"&&!r.x.isInRange(u))return null;var m=[{x:u,y:l+o},{x:u,y:l}];return a==="top"?m.reverse():m},Al=(s,t,n,a)=>{var r=s.map(i=>a.apply(i,{position:n}));return t==="discard"&&r.some(i=>!a.isInRange(i))?null:r},Ol=(s,t,n,a,r,i)=>{var{x:l,y:o,segment:u,ifOverflow:m}=i,d=va(l),p=va(o);return p?Tl(o,m,n,r,s,t):d?Fl(l,m,n,a,s,t):u!=null&&u.length===2?Al(u,m,n,s):null};function Ml(s){var t=Nt();return c.useEffect(()=>(t(Vr(s)),()=>{t(Br(s))})),null}function $l(s){var{xAxisId:t,yAxisId:n,shape:a,className:r,ifOverflow:i}=s,l=wt(),o=Wr(),u=ts(A=>Ur(A,t)),m=ts(A=>Hr(A,n)),d=ts(A=>xa(A,"xAxis",t,l)),p=ts(A=>xa(A,"yAxis",n,l)),v=Gr();if(!o||!v||u==null||m==null||d==null||p==null)return null;var j=Kr({x:d,y:p}),h=Ol(j,v,s.position,u.orientation,m.orientation,s);if(!h)return null;var[{x,y:k},{x:T,y:g}]=h,F=i==="hidden"?"url(#".concat(o,")"):void 0,f=Ra(Ra({clipPath:F},Ua(s)),{},{x1:x,y1:k,x2:T,y2:g}),y=Xr({x1:x,y1:k,x2:T,y2:g});return c.createElement(Ha,{zIndex:s.zIndex},c.createElement(gs,{className:yt("recharts-reference-line",r)},Pl(a,f),c.createElement(Yr,Hs({},y,{lowerWidth:y.width,upperWidth:y.width}),c.createElement(Jr,{label:s.label}),s.children)))}var Il={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:Wa.line};function cn(s){var t=ys(s,Il);return c.createElement(c.Fragment,null,c.createElement(Ml,{yAxisId:t.yAxisId,xAxisId:t.xAxisId,ifOverflow:t.ifOverflow,x:t.x,y:t.y,segment:t.segment}),c.createElement($l,t))}cn.displayName="ReferenceLine";var dn=(s,t,n)=>Ga(s,"xAxis",_t(s,t),n),un=(s,t,n)=>Ka(s,"xAxis",_t(s,t),n),mn=(s,t,n)=>Ga(s,"yAxis",St(s,t),n),hn=(s,t,n)=>Ka(s,"yAxis",St(s,t),n),Ll=Ks([kt,dn,mn,un,hn],(s,t,n,a,r)=>Ya(s,"xAxis")?fa(t,a,!1):fa(n,r,!1)),zl=(s,t)=>t,pn=Ks([ti,zl],(s,t)=>s.filter(n=>n.type==="area").find(n=>n.id===t)),xn=s=>{var t=kt(s),n=Ya(t,"xAxis");return n?"yAxis":"xAxis"},ql=(s,t)=>{var n=xn(s);return n==="yAxis"?St(s,t):_t(s,t)},Vl=(s,t,n)=>ei(s,xn(s),ql(s,t),n),Bl=Ks([pn,Vl],(s,t)=>{var n;if(!(s==null||t==null)){var{stackId:a}=s,r=si(s);if(!(a==null||r==null)){var i=(n=t[a])===null||n===void 0?void 0:n.stackedData,l=i?.find(o=>o.key===r);if(l!=null)return l.map(o=>[o[0],o[1]])}}}),Wl=Ks([kt,dn,mn,un,hn,Bl,Qr,Ll,pn,Zr],(s,t,n,a,r,i,l,o,u,m)=>{var{chartData:d,dataStartIndex:p,dataEndIndex:v}=l;if(!(u==null||s!=="horizontal"&&s!=="vertical"||t==null||n==null||a==null||r==null||a.length===0||r.length===0||o==null)){var{data:j}=u,h;if(j&&j.length>0?h=j:h=d?.slice(p,v+1),h!=null)return co({layout:s,xAxis:t,yAxis:n,xAxisTicks:a,yAxisTicks:r,dataStartIndex:p,areaSettings:u,stackedData:i,displayedData:h,chartBaseValue:m,bandSize:o})}}),Ul=["id"],Hl=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function Ke(){return Ke=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},Ke.apply(null,arguments)}function vn(s,t){if(s==null)return{};var n,a,r=Gl(s,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(s,n)&&(r[n]=s[n])}return r}function Gl(s,t){if(s==null)return{};var n={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(t.indexOf(a)!==-1)continue;n[a]=s[a]}return n}function Pa(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function as(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Pa(Object(n),!0).forEach(function(a){Kl(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Pa(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function Kl(s,t,n){return(t=Yl(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function Yl(s){var t=Jl(s,"string");return typeof t=="symbol"?t:t+""}function Jl(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Gs(s,t){return s&&s!=="none"?s:t}var Xl=s=>{var{dataKey:t,name:n,stroke:a,fill:r,legendType:i,hide:l}=s;return[{inactive:l,dataKey:t,type:i,color:Gs(a,r),value:Ja(n,t),payload:s}]},Ql=c.memo(s=>{var{dataKey:t,data:n,stroke:a,strokeWidth:r,fill:i,name:l,hide:o,unit:u,tooltipType:m,id:d}=s,p={dataDefinedOnItem:n,positions:void 0,settings:{stroke:a,strokeWidth:r,fill:i,dataKey:t,nameKey:void 0,name:Ja(l,t),hide:o,type:m,color:Gs(a,i),unit:u,graphicalItemId:d}};return c.createElement(oi,{tooltipEntrySettings:p})});function Zl(s){var{clipPathId:t,points:n,props:a}=s,{needClip:r,dot:i,dataKey:l}=a,o=Xa(a);return c.createElement(Ni,{points:n,dot:i,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:l,baseProps:o,needClip:r,clipPathId:t})}function eo(s){var{showLabels:t,children:n,points:a}=s,r=a.map(i=>{var l,o,u={x:(l=i.x)!==null&&l!==void 0?l:0,y:(o=i.y)!==null&&o!==void 0?o:0,width:0,lowerWidth:0,upperWidth:0,height:0};return as(as({},u),{},{value:i.value,payload:i.payload,parentViewBox:void 0,viewBox:u,fill:void 0})});return c.createElement(yi,{value:t?r:void 0},n)}function Ta(s){var{points:t,baseLine:n,needClip:a,clipPathId:r,props:i}=s,{layout:l,type:o,stroke:u,connectNulls:m,isRange:d}=i,{id:p}=i,v=vn(i,Ul),j=Xa(v),h=Ua(v);return c.createElement(c.Fragment,null,t?.length>1&&c.createElement(gs,{clipPath:a?"url(#clipPath-".concat(r,")"):void 0},c.createElement(ut,Ke({},h,{id:p,points:t,connectNulls:m,type:o,baseLine:n,layout:l,stroke:"none",className:"recharts-area-area"})),u!=="none"&&c.createElement(ut,Ke({},j,{className:"recharts-area-curve",layout:l,type:o,connectNulls:m,fill:"none",points:t})),u!=="none"&&d&&c.createElement(ut,Ke({},j,{className:"recharts-area-curve",layout:l,type:o,connectNulls:m,fill:"none",points:n}))),c.createElement(Zl,{points:t,props:v,clipPathId:r}))}function so(s){var t,n,{alpha:a,baseLine:r,points:i,strokeWidth:l}=s,o=(t=i[0])===null||t===void 0?void 0:t.y,u=(n=i[i.length-1])===null||n===void 0?void 0:n.y;if(!Ie(o)||!Ie(u))return null;var m=a*Math.abs(o-u),d=Math.max(...i.map(p=>p.x||0));return Ye(r)?d=Math.max(r,d):r&&Array.isArray(r)&&r.length&&(d=Math.max(...r.map(p=>p.x||0),d)),Ye(d)?c.createElement("rect",{x:0,y:o<u?o:o-m,width:d+(l?parseInt("".concat(l),10):1),height:Math.floor(m)}):null}function to(s){var t,n,{alpha:a,baseLine:r,points:i,strokeWidth:l}=s,o=(t=i[0])===null||t===void 0?void 0:t.x,u=(n=i[i.length-1])===null||n===void 0?void 0:n.x;if(!Ie(o)||!Ie(u))return null;var m=a*Math.abs(o-u),d=Math.max(...i.map(p=>p.y||0));return Ye(r)?d=Math.max(r,d):r&&Array.isArray(r)&&r.length&&(d=Math.max(...r.map(p=>p.y||0),d)),Ye(d)?c.createElement("rect",{x:o<u?o:o-m,y:0,width:m,height:Math.floor(d+(l?parseInt("".concat(l),10):1))}):null}function ao(s){var{alpha:t,layout:n,points:a,baseLine:r,strokeWidth:i}=s;return n==="vertical"?c.createElement(so,{alpha:t,points:a,baseLine:r,strokeWidth:i}):c.createElement(to,{alpha:t,points:a,baseLine:r,strokeWidth:i})}function no(s){var{needClip:t,clipPathId:n,props:a,previousPointsRef:r,previousBaselineRef:i}=s,{points:l,baseLine:o,isAnimationActive:u,animationBegin:m,animationDuration:d,animationEasing:p,onAnimationStart:v,onAnimationEnd:j}=a,h=c.useMemo(()=>({points:l,baseLine:o}),[l,o]),x=vi(h,"recharts-area-"),k=fi(),[T,g]=c.useState(!1),F=!T,f=c.useCallback(()=>{typeof j=="function"&&j(),g(!1)},[j]),y=c.useCallback(()=>{typeof v=="function"&&v(),g(!0)},[v]);if(k==null)return null;var A=r.current,$=i.current;return c.createElement(eo,{showLabels:F,points:l},a.children,c.createElement(ji,{animationId:x,begin:m,duration:d,isActive:u,easing:p,onAnimationEnd:f,onAnimationStart:y,key:x},S=>{if(A){var _=A.length/l.length,P=S===1?l:l.map((O,V)=>{var R=Math.floor(V*_);if(A[R]){var X=A[R];return as(as({},O),{},{x:es(X.x,O.x,S),y:es(X.y,O.y,S)})}return O}),L;return Ye(o)?L=es($,o,S):gi(o)||Ct(o)?L=es($,0,S):L=o.map((O,V)=>{var R=Math.floor(V*_);if(Array.isArray($)&&$[R]){var X=$[R];return as(as({},O),{},{x:es(X.x,O.x,S),y:es(X.y,O.y,S)})}return O}),S>0&&(r.current=P,i.current=L),c.createElement(Ta,{points:P,baseLine:L,needClip:t,clipPathId:n,props:a})}return S>0&&(r.current=l,i.current=o),c.createElement(gs,null,u&&c.createElement("defs",null,c.createElement("clipPath",{id:"animationClipPath-".concat(n)},c.createElement(ao,{alpha:S,points:l,baseLine:o,layout:k,strokeWidth:a.strokeWidth}))),c.createElement(gs,{clipPath:"url(#animationClipPath-".concat(n,")")},c.createElement(Ta,{points:l,baseLine:o,needClip:t,clipPathId:n,props:a})))}),c.createElement(bi,{label:a.label}))}function ro(s){var{needClip:t,clipPathId:n,props:a}=s,r=c.useRef(null),i=c.useRef();return c.createElement(no,{needClip:t,clipPathId:n,props:a,previousPointsRef:r,previousBaselineRef:i})}class io extends c.PureComponent{render(){var{hide:t,dot:n,points:a,className:r,top:i,left:l,needClip:o,xAxisId:u,yAxisId:m,width:d,height:p,id:v,baseLine:j,zIndex:h}=this.props;if(t)return null;var x=yt("recharts-area",r),k=v,{r:T,strokeWidth:g}=hi(n),F=pi(n),f=T*2+g,y=o?"url(#clipPath-".concat(F?"":"dots-").concat(k,")"):void 0;return c.createElement(Ha,{zIndex:h},c.createElement(gs,{className:x},o&&c.createElement("defs",null,c.createElement(xi,{clipPathId:k,xAxisId:u,yAxisId:m}),!F&&c.createElement("clipPath",{id:"clipPath-dots-".concat(k)},c.createElement("rect",{x:l-f/2,y:i-f/2,width:d+f,height:p+f}))),c.createElement(ro,{needClip:o,clipPathId:k,props:this.props})),c.createElement(ja,{points:a,mainColor:Gs(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:y}),this.props.isRange&&Array.isArray(j)&&c.createElement(ja,{points:j,mainColor:Gs(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:y}))}}var fn={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:Wa.area};function lo(s){var t,n=ys(s,fn),{activeDot:a,animationBegin:r,animationDuration:i,animationEasing:l,connectNulls:o,dot:u,fill:m,fillOpacity:d,hide:p,isAnimationActive:v,legendType:j,stroke:h,xAxisId:x,yAxisId:k}=n,T=vn(n,Hl),g=ci(),F=di(),{needClip:f}=ui(x,k),y=wt(),{points:A,isRange:$,baseLine:S}=(t=ts(R=>Wl(R,s.id,y)))!==null&&t!==void 0?t:{},_=mi();if(g!=="horizontal"&&g!=="vertical"||_==null||F!=="AreaChart"&&F!=="ComposedChart")return null;var{height:P,width:L,x:O,y:V}=_;return!A||!A.length?null:c.createElement(io,Ke({},T,{activeDot:a,animationBegin:r,animationDuration:i,animationEasing:l,baseLine:S,connectNulls:o,dot:u,fill:m,fillOpacity:d,height:P,hide:p,layout:g,isAnimationActive:v==="auto"?!wi.isSsr:v,isRange:$,legendType:j,needClip:f,points:A,stroke:h,width:L,left:O,top:V,xAxisId:x,yAxisId:k}))}var oo=(s,t,n,a,r)=>{var i=n??t;if(Ye(i))return i;var l=s==="horizontal"?r:a,o=l.scale.domain();if(l.type==="number"){var u=Math.max(o[0],o[1]),m=Math.min(o[0],o[1]);return i==="dataMin"?m:i==="dataMax"||u<0?u:Math.max(Math.min(o[0],o[1]),0)}return i==="dataMin"?o[0]:i==="dataMax"?o[1]:o[0]};function co(s){var{areaSettings:{connectNulls:t,baseValue:n,dataKey:a},stackedData:r,layout:i,chartBaseValue:l,xAxis:o,yAxis:u,displayedData:m,dataStartIndex:d,xAxisTicks:p,yAxisTicks:v,bandSize:j}=s,h=r&&r.length,x=oo(i,l,n,o,u),k=i==="horizontal",T=!1,g=m.map((f,y)=>{var A,$,S;if(h)S=r[d+y];else{var _=ga(f,a);Array.isArray(_)?(S=_,T=!0):S=[x,_]}var P=(A=($=S)===null||$===void 0?void 0:$[1])!==null&&A!==void 0?A:null,L=P==null||h&&!t&&ga(f,a)==null;return k?{x:ba({axis:o,ticks:p,bandSize:j,entry:f,index:y}),y:L?null:u.scale(P),value:S,payload:f}:{x:L?null:o.scale(P),y:ba({axis:u,ticks:v,bandSize:j,entry:f,index:y}),value:S,payload:f}}),F;return h||T?F=g.map(f=>{var y=Array.isArray(f.value)?f.value[0]:null;return k?{x:f.x,y:y!=null&&f.y!=null?u.scale(y):null,payload:f.payload}:{x:y!=null?o.scale(y):null,y:f.y,payload:f.payload}}):F=k?u.scale(x):o.scale(x),{points:g,baseLine:F,isRange:T}}function uo(s){var t=ys(s,fn),n=wt();return c.createElement(ni,{id:t.id,type:"area"},a=>c.createElement(c.Fragment,null,c.createElement(ri,{legendPayload:Xl(t)}),c.createElement(Ql,{dataKey:t.dataKey,data:t.data,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,unit:t.unit,tooltipType:t.tooltipType,id:a}),c.createElement(ii,{type:"area",id:a,data:t.data,dataKey:t.dataKey,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,stackId:li(t.stackId),hide:t.hide,barSize:void 0,baseValue:t.baseValue,isPanorama:n,connectNulls:t.connectNulls}),c.createElement(lo,Ke({},t,{id:a}))))}var vs=c.memo(uo,ai);vs.displayName="Area";var mo=["axis"],ho=c.forwardRef((s,t)=>c.createElement(Ci,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:mo,tooltipPayloadSearcher:ki,categoricalChartProps:s,ref:t}));const Fa={WARNING:"warning",ERROR:"error"},we={DATABASE:"database",NETWORK:"network",AUTH:"auth",VALIDATION:"validation",STORAGE:"storage",SYNC:"sync",GENERAL:"general"};function po(s){const t=s?.message?.toLowerCase()||"",n=s?.code?.toLowerCase()||"";return t.includes("fetch")||t.includes("network")||t.includes("offline")?we.NETWORK:t.includes("auth")||t.includes("unauthorized")||n.includes("auth")?we.AUTH:t.includes("storage")||t.includes("bucket")||t.includes("upload")?we.STORAGE:t.includes("validation")||t.includes("invalid")||t.includes("required")?we.VALIDATION:t.includes("sync")||t.includes("conflict")?we.SYNC:s?.code||t.includes("database")||t.includes("supabase")?we.DATABASE:we.GENERAL}function xo(s,t,n){return n?.userMessage?n.userMessage:t===we.NETWORK?"Network connection issue. Your changes will sync when back online.":t===we.AUTH?"Session expired. Please sign in again.":t===we.STORAGE?"Failed to upload file. Please try again.":t===we.VALIDATION?s?.message||"Please check your input and try again.":t===we.SYNC?"Sync conflict detected. Please refresh and try again.":n?.operation?`Failed to ${n.operation.replace(/([A-Z])/g," $1").toLowerCase().trim()}. Please try again.`:"Something went wrong. Please try again."}function vo(s,t={}){const{operation:n="unknown",category:a=po(s),severity:r=Fa.ERROR,showToast:i,userMessage:l,companyId:o,projectId:u,userId:m,silent:d=!1,rethrow:p=!1}=t;if(_i.error(a,{message:s?.message||"Unknown error",code:s?.code,severity:r,operation:n,company_id:o,project_id:u,user_id:m,extra:{stack:s?.stack,name:s?.name}}),!d&&i){const v=xo(s,a,{operation:n,userMessage:l}),j=r===Fa.WARNING?"warning":"error";i(v,j)}if(p)throw s;return null}async function be(s,t={}){const{fallback:n=null,context:a={},showToast:r,silent:i=!0}=t;try{return await s()}catch(l){return vo(l,{...a,showToast:r,silent:i}),n}}const cs={budget:{healthy:.6,warning:.75,critical:.85},schedule:{healthy:.05,warning:.15,critical:.25},corExposure:{healthy:.05,warning:.15,critical:.25},activity:{healthy:1,warning:3,critical:5},safety:{healthy:0,warning:1,critical:2}},fo={budget:.3,schedule:.25,corExposure:.2,activity:.15,safety:.1};function ks(s,t){if(s<=t.healthy)return 0;if(s>=t.critical)return 100;const n=t.critical-t.healthy;return(s-t.healthy)/n*100}function _s(s){return s<=25?"healthy":s<=60?"warning":"critical"}function jo(s,t,n=cs.budget){if(!t||t<=0)return{score:0,status:"healthy",ratio:0,label:"No revenue yet"};const a=s/t,r=ks(a,n),i=_s(r);let l;return a<n.healthy?l=`Costs at ${(a*100).toFixed(0)}% of revenue`:a<n.warning?l=`Costs at ${(a*100).toFixed(0)}% - monitor closely`:l=`Costs at ${(a*100).toFixed(0)}% - review immediately`,{score:r,status:i,ratio:a,label:l}}function go(s,t,n=cs.schedule){if(!t||t<=0)return{score:0,status:"healthy",variance:0,label:"No schedule baseline"};const a=(t-s)/t,r=Math.max(0,a),i=ks(r,n),l=_s(i);let o;return a<=0?o=s>=100?"Complete":"On or ahead of schedule":a<n.warning?o=`${(a*100).toFixed(0)}% behind schedule`:o=`${(a*100).toFixed(0)}% behind - needs attention`,{score:i,status:l,variance:a,label:o}}function bo(s,t,n=cs.corExposure){if(!t||t<=0)return{score:0,status:"healthy",exposure:0,label:"No contract value"};const a=s/t,r=ks(a,n),i=_s(r);let l;return a<n.healthy?l=s>0?`$${pt(s)} pending`:"No pending CORs":a<n.warning?l=`$${pt(s)} pending (${(a*100).toFixed(0)}% of contract)`:l=`High exposure: $${pt(s)} (${(a*100).toFixed(0)}%)`,{score:r,status:i,exposure:a,label:l}}function yo(s,t=cs.activity){if(!s)return{score:100,status:"critical",daysSince:null,label:"No reports filed"};const n=new Date(s),r=Math.floor((new Date-n)/(1e3*60*60*24)),i=ks(r,t),l=_s(i);let o;return r===0?o="Report filed today":r===1?o="Report filed yesterday":r<=t.warning?o=`Last report ${r} days ago`:o=`No report in ${r} days - may be stalled`,{score:i,status:l,daysSince:r,label:o}}function No(s,t=cs.safety){const n=s||0,a=ks(n,t),r=_s(a);let i;return n===0?i="No incidents":n===1?i="1 incident in last 30 days":i=`${n} incidents - safety review needed`,{score:a,status:r,count:n,label:i}}function wo(s,t={}){const n={...cs,...t.thresholds},a={...fo,...t.weights},r=jo(s.totalCosts,s.earnedRevenue,n.budget),i=go(s.actualProgress,s.expectedProgress,n.schedule),l=bo(s.pendingCORValue,s.contractValue,n.corExposure),o=yo(s.lastReportDate,n.activity),u=No(s.recentInjuryCount,n.safety),m=Math.round(r.score*a.budget+i.score*a.schedule+l.score*a.corExposure+o.score*a.activity+u.score*a.safety);let d;m<=25?d="healthy":m<=60?d="warning":d="critical";let p;return d==="healthy"?p="Project is on track":d==="warning"?p="Some factors need attention":p="Immediate review recommended",{score:m,status:d,label:p,factors:{budget:{...r,weight:a.budget},schedule:{...i,weight:a.schedule},corExposure:{...l,weight:a.corExposure},activity:{...o,weight:a.activity},safety:{...u,weight:a.safety}}}}function Co(s,t){const n=[],{factors:a}=s;a.budget.status==="critical"&&n.push({type:"critical",title:"Budget Alert",description:a.budget.label,action:"Review costs immediately",actionTarget:"financials",projectId:t.id}),a.activity.status==="critical"&&n.push({type:"critical",title:"Activity Alert",description:a.activity.label,action:"Check project status",actionTarget:"overview",projectId:t.id}),a.safety.status==="critical"&&n.push({type:"critical",title:"Safety Alert",description:a.safety.label,action:"Review safety reports",actionTarget:"reports",projectId:t.id}),a.budget.status==="warning"&&n.push({type:"warning",title:"Budget Watch",description:a.budget.label,action:"Monitor costs",actionTarget:"financials",projectId:t.id}),(a.schedule.status==="critical"||a.schedule.status==="warning")&&n.push({type:a.schedule.status==="critical"?"critical":"warning",title:"Schedule Alert",description:a.schedule.label,action:"Review progress",actionTarget:"overview",projectId:t.id}),(a.corExposure.status==="warning"||a.corExposure.status==="critical")&&n.push({type:a.corExposure.status==="critical"?"critical":"warning",title:"COR Exposure",description:a.corExposure.label,action:"Review pending CORs",actionTarget:"cors",projectId:t.id}),a.activity.status==="warning"&&n.push({type:"info",title:"Activity Notice",description:a.activity.label,action:"File daily report",actionTarget:"reports",projectId:t.id});const r={critical:0,warning:1,info:2};return n.sort((i,l)=>r[i.type]-r[l.type]),n}function ko(s){const{actualProgress:t,totalCosts:n,earnedRevenue:a,contractValue:r}=s;if(!t||t<=0)return{estimatedCompletionCost:null,estimatedFinalMargin:null,estimatedCompletionDate:null};const i=n/t,l=Math.round(i*100),o=r>0?(r-l)/r*100:0;let u=null;if(s.startDate&&t>0&&t<100){const m=new Date(s.startDate),d=new Date,p=Math.max(1,(d-m)/(1e3*60*60*24)),v=t/p,h=(100-t)/v;u=new Date(d.getTime()+h*24*60*60*1e3)}return{estimatedCompletionCost:l,estimatedFinalMargin:o,estimatedCompletionDate:u,costPerPercent:i}}function pt(s){return s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toFixed(0)}function _o(s){const t=c.useMemo(()=>{const i=s.reduce((j,h)=>j+(h.contract_value||0),0),l=s.reduce((j,h)=>j+(h.changeOrderValue||0),0),o=i+l,u=s.reduce((j,h)=>j+(h.billable||0),0),m=o-u,d=o>0?Math.round(u/o*100):0,p=s.reduce((j,h)=>j+(h.corPendingValue||0),0),v=s.reduce((j,h)=>j+(h.corPendingCount||0),0);return{totalOriginalContract:i,totalChangeOrders:l,totalPortfolioValue:o,totalEarned:u,totalRemaining:m,weightedCompletion:d,totalPendingCORValue:p,totalPendingCORCount:v}},[s]),n=c.useMemo(()=>{let i=0,l=0,o=0,u=0,m=0;for(const d of s){const p=d.revisedContractValue||d.contract_value;d.progress>=100&&i++,d.progress<100&&d.billable<=p*(d.progress/100)*1.1&&l++,d.billable>p*.9&&d.progress<90&&o++,d.billable>p&&u++,(d.changeOrderValue||0)>0&&m++}return{projectsComplete:i,projectsOnTrack:l,projectsAtRisk:o,projectsOverBudget:u,projectsWithChangeOrders:m}},[s]),a=c.useMemo(()=>{let i=0,l=0,o=0,u=0,m=0,d=0;for(const p of s)p.hasScheduleData&&(p.scheduleStatus==="ahead"?i++:p.scheduleStatus==="behind"?o++:l++),p.hasLaborData&&(p.laborStatus==="over"?u++:p.laborStatus==="under"?m++:d++);return{scheduleAhead:i,scheduleOnTrack:l,scheduleBehind:o,laborOver:u,laborUnder:m,laborOnTrack:d,hasAnyScheduleData:i+l+o>0,hasAnyLaborData:u+m+d>0}},[s]),r=c.useMemo(()=>{const i=s.map(o=>{const u={id:o.id,name:o.name,totalCosts:o.totalCosts||0,earnedRevenue:o.billable||0,actualProgress:o.progress||0,expectedProgress:o.expectedProgress||o.progress,pendingCORValue:o.corPendingValue||0,contractValue:o.revisedContractValue||o.contract_value||0,lastReportDate:o.lastDailyReport,recentInjuryCount:o.recentInjuryCount||0,startDate:o.start_date},m=wo(u),d=Co(m,{...u,name:o.name}),p=ko(u),v=d.map(j=>({...j,projectName:o.name,projectId:o.id}));return{projectId:o.id,projectName:o.name,riskScore:m.score,riskStatus:m.status,riskLabel:m.label,factors:m.factors,alerts:v,projections:p}}),l=i.flatMap(o=>o.alerts).sort((o,u)=>{const m={critical:0,warning:1,info:2};return m[o.type]-m[u.type]});return{projectRisks:i,allAlerts:l,criticalCount:l.filter(o=>o.type==="critical").length,warningCount:l.filter(o=>o.type==="warning").length}},[s]);return{portfolioMetrics:t,projectHealth:n,scheduleMetrics:a,riskAnalysis:r}}function So({selectedProject:s,areas:t,company:n,onShowToast:a,loadAreas:r,setSelectedProject:i}){const[l,o]=c.useState(!1),[u,m]=c.useState(null),[d,p]=c.useState(!1);return{editMode:l,editData:u,saving:d,handleEditClick:()=>{m({name:s.name,job_number:s.job_number||"",address:s.address||"",general_contractor:s.general_contractor||"",client_contact:s.client_contact||"",client_phone:s.client_phone||"",contract_value:s.contract_value,work_type:s.work_type||"demolition",job_type:s.job_type||"standard",pin:s.pin||"",default_dump_site_id:s.default_dump_site_id||"",areas:t.map(f=>({id:f.id,name:f.name,weight:f.weight,isNew:!1}))}),o(!0)},handleCancelEdit:()=>{o(!1),m(null)},handleEditChange:(f,y)=>{m(A=>({...A,[f]:y}))},handleAreaEditChange:(f,y,A)=>{m($=>({...$,areas:$.areas.map((S,_)=>_===f?{...S,[y]:A}:S)}))},handleAddArea:()=>{m(f=>({...f,areas:[...f.areas,{id:null,name:"",weight:"",isNew:!0}]}))},handleRemoveArea:f=>{u.areas.length>1&&m(y=>({...y,areas:y.areas.filter((A,$)=>$!==f)}))},handleSaveEdit:async()=>{if(!u.name.trim()){a("Please enter a project name","error");return}const f=parseFloat(u.contract_value);if(!f||f<=0){a("Please enter a valid contract value","error");return}if(u.pin&&u.pin.length!==4){a("PIN must be 4 digits","error");return}if(u.pin&&u.pin!==s.pin&&!await q.isPinAvailable(u.pin,s.id)){a("This PIN is already in use","error");return}const y=u.areas.filter($=>$.name.trim()&&parseFloat($.weight)>0);if(y.length===0){a("Please add at least one area","error");return}if(y.reduce(($,S)=>$+parseFloat(S.weight),0)!==100){a("Area weights must total 100%","error");return}p(!0);try{await q.updateProject(s.id,{name:u.name.trim(),job_number:u.job_number?.trim()||null,address:u.address?.trim()||null,general_contractor:u.general_contractor?.trim()||null,client_contact:u.client_contact?.trim()||null,client_phone:u.client_phone?.trim()||null,contract_value:f,work_type:u.work_type||"demolition",job_type:u.job_type||"standard",pin:u.pin||null,default_dump_site_id:u.default_dump_site_id||null},n?.id);const $=t.map(P=>P.id),S=u.areas.filter(P=>P.id).map(P=>P.id);for(const P of $)S.includes(P)||await q.deleteArea(P);for(let P=0;P<y.length;P++){const L=y[P];L.id?await q.updateArea(L.id,{name:L.name.trim(),weight:parseFloat(L.weight),sort_order:P}):await q.createArea({project_id:s.id,name:L.name.trim(),weight:parseFloat(L.weight),status:"not_started",sort_order:P})}const _=await q.getProject(s.id);i(_),await r(s.id),o(!1),m(null),a("Project updated!","success")}catch($){console.error("Error saving project:",$?.message||$),a($?.message||"Error saving changes","error")}finally{p(!1)}},handleDeleteProject:async f=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await q.deleteProject(s.id),i(null),a("Project deleted","success"),f()}catch(y){console.error("Error deleting project:",y),a("Error deleting project","error")}}}}const Qs=()=>ne(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),ie=210,B=14,Ee=ie-B*2,rs=s=>s?new Date(s+(s.includes("T")?"":"T12:00:00")).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"—",Te=(s,t,n=30)=>t+n>s.internal.pageSize.height-20?(s.addPage(),20):t;async function Do(s,t){const a=(await Qs()).default,r=new a;let i=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Daily Reports",ie/2,i,{align:"center"}),i+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${t.name}`,ie/2,i,{align:"center"}),i+=6,r.text(`${s.length} report${s.length!==1?"s":""}`,ie/2,i,{align:"center"}),i+=12,s.forEach((o,u)=>{i=Te(r,i,60),r.setDrawColor(200,200,200),r.setFillColor(245,247,250),r.roundedRect(B,i-2,Ee,10,2,2,"F"),r.setFontSize(11),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(`${rs(o.report_date)}`,B+4,i+5);const m=o.status==="submitted"?"Submitted":"Draft";r.setFontSize(9),r.setFont(void 0,"normal"),r.text(m,ie-B-4,i+5,{align:"right"}),i+=14,r.setTextColor(0,0,0),r.setFontSize(9);const d=[`Crew: ${o.crew_count||0}`,`Tasks: ${o.tasks_completed||0}/${o.tasks_total||0}`,`T&M Tickets: ${o.tm_tickets_count||0}`,`Photos: ${o.photos_count||0}`];if(r.text(d.join("    |    "),B+4,i),i+=7,o.crew_list?.length>0){r.setFont(void 0,"bold"),r.text("Crew:",B+4,i),r.setFont(void 0,"normal");const p=o.crew_list.map(j=>`${j.name} (${j.role||"Laborer"})`).join(", "),v=r.splitTextToSize(p,Ee-8);i+=4,r.text(v,B+4,i),i+=v.length*4+2}if(o.field_notes){i=Te(r,i,15),r.setFont(void 0,"bold"),r.text("Field Notes:",B+4,i),r.setFont(void 0,"normal"),i+=4;const p=r.splitTextToSize(o.field_notes,Ee-8);r.text(p,B+4,i),i+=p.length*4+2}if(o.issues){i=Te(r,i,15),r.setFont(void 0,"bold"),r.text("Issues:",B+4,i),r.setFont(void 0,"normal"),i+=4;const p=r.splitTextToSize(o.issues,Ee-8);r.text(p,B+4,i),i+=p.length*4+2}i+=8,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(B,i,ie-B,i),i+=6)});const l=`${t.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;r.save(l)}async function Eo(s,t){const a=(await Qs()).default,r=new a;let i=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Incident / Injury Reports",ie/2,i,{align:"center"}),i+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${t.name}`,ie/2,i,{align:"center"}),i+=6,r.text(`${s.length} report${s.length!==1?"s":""}`,ie/2,i,{align:"center"}),i+=12,s.forEach((o,u)=>{i=Te(r,i,50);const d={minor:[34,197,94],serious:[245,158,11],critical:[239,68,68],near_miss:[59,130,246]}[o.injury_type]||[128,128,128];r.setFillColor(...d),r.roundedRect(B,i-2,3,14,1,1,"F"),r.setFontSize(11),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(`${rs(o.incident_date)}`,B+8,i+4),r.setFontSize(9);const p=(o.injury_type||"").replace("_"," ").toUpperCase();if(r.text(p,B+8,i+10),r.setFont(void 0,"normal"),r.text(o.status==="open"?"OPEN":"CLOSED",ie-B-4,i+4,{align:"right"}),i+=16,r.setTextColor(0,0,0),o.description){r.setFontSize(9),r.setFont(void 0,"bold"),r.text("Description:",B+4,i),r.setFont(void 0,"normal"),i+=4;const v=r.splitTextToSize(o.description,Ee-8);r.text(v,B+4,i),i+=v.length*4+2}o.location&&(r.setFont(void 0,"bold"),r.text("Location: ",B+4,i),r.setFont(void 0,"normal"),r.text(o.location,B+30,i),i+=6),i+=6,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(B,i,ie-B,i),i+=6)});const l=`${t.name}_Incident_Reports_${new Date().toISOString().split("T")[0]}.pdf`;r.save(l)}async function Ro(s,t){const a=(await Qs()).default,r=new a;let i=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Crew Check-In History",ie/2,i,{align:"center"}),i+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${t.name}`,ie/2,i,{align:"center"}),i+=6,r.text(`${s.length} check-in${s.length!==1?"s":""}`,ie/2,i,{align:"center"}),i+=12,s.forEach((o,u)=>{i=Te(r,i,30);const m=o.workers||[];r.setFillColor(245,247,250),r.roundedRect(B,i-2,Ee,9,2,2,"F"),r.setFontSize(10),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(rs(o.check_in_date),B+4,i+4),r.setFont(void 0,"normal"),r.text(`${m.length} workers`,ie-B-4,i+4,{align:"right"}),i+=12,r.setTextColor(0,0,0),r.setFontSize(9),m.length>0&&(r.setFont(void 0,"bold"),r.text("Name",B+4,i),r.text("Role",110,i),i+=5,r.setFont(void 0,"normal"),m.forEach(d=>{i=Te(r,i,6),r.text(d.name||"—",B+4,i),r.text(d.role||"Laborer",110,i),i+=4.5})),i+=6,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(B,i,ie-B,i),i+=5)});const l=`${t.name}_Crew_Checkins_${new Date().toISOString().split("T")[0]}.pdf`;r.save(l)}async function Po({dailyReports:s=[],incidentReports:t=[],crewCheckins:n=[],project:a}){const i=(await Qs()).default,l=new i;let o=20;l.setFontSize(22),l.setFont(void 0,"bold"),l.text("Field Documents Report",ie/2,o,{align:"center"}),o+=10,l.setFontSize(13),l.setFont(void 0,"normal"),l.text(`Project: ${a.name}`,ie/2,o,{align:"center"}),o+=8,l.setFontSize(10),l.text(`Generated: ${new Date().toLocaleDateString()}`,ie/2,o,{align:"center"}),o+=16,l.setFontSize(11),l.setFont(void 0,"bold"),l.text("Document Summary",B,o),o+=8,l.setFontSize(10),l.setFont(void 0,"normal"),[["Daily Reports",`${s.length}`],["Incident Reports",`${t.length}`],["Crew Check-Ins",`${n.length}`]].forEach(([d,p])=>{l.text(d,B+4,o),l.text(p,100,o),o+=6}),s.length>0&&(l.addPage(),o=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Daily Reports",B,o),o+=10,s.forEach((d,p)=>{if(o=Te(l,o,40),l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(rs(d.report_date),B+2,o),l.setFont(void 0,"normal"),l.setFontSize(8),l.text(`Crew: ${d.crew_count||0} | Tasks: ${d.tasks_completed||0}/${d.tasks_total||0} | T&M: ${d.tm_tickets_count||0}`,B+60,o),o+=6,l.setTextColor(0,0,0),l.setFontSize(9),d.field_notes){const v=l.splitTextToSize(d.field_notes,Ee-4);l.text(v,B+2,o),o+=v.length*4+2}if(d.issues){l.setFont(void 0,"bold"),l.text("Issues: ",B+2,o),l.setFont(void 0,"normal");const v=l.splitTextToSize(d.issues,Ee-20);l.text(v,B+20,o),o+=v.length*4+2}o+=4,p<s.length-1&&(l.setDrawColor(220,220,220),l.line(B,o,ie-B,o),o+=4)})),t.length>0&&(l.addPage(),o=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Incident / Injury Reports",B,o),o+=10,t.forEach((d,p)=>{o=Te(l,o,35),l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(rs(d.incident_date),B+2,o),l.setFontSize(8),l.setFont(void 0,"normal");const v=(d.injury_type||"").replace("_"," ").toUpperCase();if(l.text(`${v} — ${d.status?.toUpperCase()||""}`,B+60,o),o+=6,l.setTextColor(0,0,0),l.setFontSize(9),d.description){const j=l.splitTextToSize(d.description,Ee-4);l.text(j,B+2,o),o+=j.length*4+2}d.location&&(l.text(`Location: ${d.location}`,B+2,o),o+=5),o+=4,p<t.length-1&&(l.setDrawColor(220,220,220),l.line(B,o,ie-B,o),o+=4)})),n.length>0&&(l.addPage(),o=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Crew Check-In History",B,o),o+=10,n.forEach((d,p)=>{o=Te(l,o,20);const v=d.workers||[];if(l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(rs(d.check_in_date),B+2,o),l.setFont(void 0,"normal"),l.setFontSize(8),l.text(`${v.length} workers`,B+60,o),o+=6,l.setTextColor(0,0,0),l.setFontSize(8),v.length>0){const j=v.map(x=>`${x.name} (${x.role||"Laborer"})`).join(", "),h=l.splitTextToSize(j,Ee-4);l.text(h,B+2,o),o+=h.length*3.5+3}p<n.length-1&&(l.setDrawColor(230,230,230),l.line(B,o,ie-B,o),o+=3)}));const m=`${a.name}_Field_Documents_${new Date().toISOString().split("T")[0]}.pdf`;l.save(m)}function Zs(s,t,n="text/csv"){const a=new Blob([s],{type:n}),r=URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}function Aa(s){if(s==null)return"";const t=String(s);return t.includes(",")||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t}function Pt(s,t){const n=s.map(r=>Aa(r.label)).join(","),a=t.map(r=>s.map(i=>Aa(r[i.key])).join(","));return[n,...a].join(`
`)}function To(s,t){const n=[{key:"category",label:"Category"},{key:"description",label:"Description"},{key:"amount",label:"Amount"},{key:"date",label:"Date"},{key:"type",label:"Type"}],a=[];a.push({category:"Revenue",description:"Original Contract Value",amount:s.contract_value||0,date:s.start_date||"",type:"Contract"}),t?.earnedRevenue&&a.push({category:"Revenue",description:"Earned Revenue (Progress)",amount:t.earnedRevenue,date:new Date().toISOString().split("T")[0],type:"Earned"}),t?.approvedCORs&&t.approvedCORs.forEach(u=>{a.push({category:"Revenue",description:`COR: ${u.cor_number} - ${u.title}`,amount:(u.cor_total||0)/100,date:u.approved_at?.split("T")[0]||"",type:"Change Order"})}),t?.laborByDate&&t.laborByDate.forEach(u=>{a.push({category:"Cost",description:"Labor",amount:u.cost,date:u.date,type:"Labor"})}),t?.haulOffByDate&&t.haulOffByDate.forEach(u=>{a.push({category:"Cost",description:"Disposal/Haul-off",amount:u.cost,date:u.date,type:"Disposal"})}),t?.customCosts&&t.customCosts.forEach(u=>{a.push({category:"Cost",description:u.description||u.category||"Other",amount:parseFloat(u.amount)||0,date:u.cost_date||"",type:u.category||"Other"})});const r=a.filter(u=>u.category==="Revenue").reduce((u,m)=>u+(parseFloat(m.amount)||0),0),i=a.filter(u=>u.category==="Cost").reduce((u,m)=>u+(parseFloat(m.amount)||0),0);a.push({category:"",description:"",amount:"",date:"",type:""}),a.push({category:"Summary",description:"Total Revenue",amount:r,date:"",type:""}),a.push({category:"Summary",description:"Total Costs",amount:i,date:"",type:""}),a.push({category:"Summary",description:"Gross Profit",amount:r-i,date:"",type:""}),a.push({category:"Summary",description:"Margin %",amount:r>0?((r-i)/r*100).toFixed(1)+"%":"N/A",date:"",type:""});const l=Pt(n,a),o=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_Financials_${new Date().toISOString().split("T")[0]}.csv`;Zs(l,o)}function Oc(s,t){const n=[],a=[{key:"section",label:"Section"},{key:"description",label:"Description"},{key:"quantity",label:"Quantity"},{key:"unit",label:"Unit"},{key:"rate",label:"Rate"},{key:"total",label:"Total"}];n.push({section:"COR Info",description:`${s.cor_number} - ${s.title}`,quantity:"",unit:"",rate:"",total:""}),n.push({section:"Status",description:s.status,quantity:"",unit:"",rate:"",total:""}),n.push({section:"Period",description:`${s.period_start||""} to ${s.period_end||""}`,quantity:"",unit:"",rate:"",total:""}),n.push({section:"",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor?.length>0&&(n.push({section:"LABOR",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor.forEach(l=>{const o=parseFloat(l.regular_hours)||0,u=parseFloat(l.overtime_hours)||0;n.push({section:"",description:l.description||l.classification,quantity:o+u,unit:"hours",rate:(parseInt(l.regular_rate)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_materials?.length>0&&(n.push({section:"MATERIALS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_materials.forEach(l=>{n.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"each",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_equipment?.length>0&&(n.push({section:"EQUIPMENT",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_equipment.forEach(l=>{n.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"day",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_subcontractors?.length>0&&(n.push({section:"SUBCONTRACTORS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_subcontractors.forEach(l=>{n.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"lump sum",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})}));const r=Pt(a,n),i=`COR_${s.cor_number||s.id}_${new Date().toISOString().split("T")[0]}.csv`;Zs(r,i)}function Mc(s,t){const n=[{key:"date",label:"Date"},{key:"status",label:"Status"},{key:"workers",label:"Worker Count"},{key:"totalHours",label:"Total Hours"},{key:"otHours",label:"OT Hours"},{key:"materialsCost",label:"Materials Cost"},{key:"corNumber",label:"COR #"},{key:"notes",label:"Notes"}],a=s.map(l=>{const o=l.t_and_m_workers||[],u=l.t_and_m_items||[],m=o.reduce((v,j)=>v+(parseFloat(j.hours)||0),0),d=o.reduce((v,j)=>v+(parseFloat(j.overtime_hours)||0),0),p=u.reduce((v,j)=>v+(parseFloat(j.quantity)||0)*(j.materials_equipment?.cost_per_unit||0),0);return{date:l.work_date,status:l.status,workers:o.length,totalHours:(m+d).toFixed(1),otHours:d.toFixed(1),materialsCost:p.toFixed(2),corNumber:l.assigned_cor_id?"Linked":"",notes:l.notes||""}}),r=Pt(n,a),i=`${t.name.replace(/[^a-zA-Z0-9]/g,"_")}_TM_Tickets_${new Date().toISOString().split("T")[0]}.csv`;Zs(r,i)}function Fo(s,t){const n=[],a=new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"});n.push("!TRNS	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),n.push("!SPL	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),n.push("!ENDTRNS");const r=s.contract_value||0;n.push(`TRNS	GENERAL JOURNAL	${a}	Accounts Receivable	${s.name}	${r.toFixed(2)}	FieldSync - Contract Revenue`),n.push(`SPL	GENERAL JOURNAL	${a}	Construction Revenue	${s.name}	${(-r).toFixed(2)}	Contract: ${s.name}`),n.push("ENDTRNS");const i=t?.totalLaborCost||0;i>0&&(n.push(`TRNS	GENERAL JOURNAL	${a}	Direct Labor	${s.name}	${i.toFixed(2)}	Labor costs - ${s.name}`),n.push(`SPL	GENERAL JOURNAL	${a}	Accounts Payable	${s.name}	${(-i).toFixed(2)}	Labor costs`),n.push("ENDTRNS"));const l=t?.totalDisposalCost||0;l>0&&(n.push(`TRNS	GENERAL JOURNAL	${a}	Disposal Expense	${s.name}	${l.toFixed(2)}	Disposal costs - ${s.name}`),n.push(`SPL	GENERAL JOURNAL	${a}	Accounts Payable	${s.name}	${(-l).toFixed(2)}	Disposal costs`),n.push("ENDTRNS"));const o=n.join(`
`),u=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_QB_${new Date().toISOString().split("T")[0]}.iif`;Zs(o,u,"application/x-iif")}function Ao({isOpen:s,onClose:t,companyId:n,onSelectProject:a,onSelectTicket:r,onSelectCOR:i,onShowToast:l}){const[o,u]=c.useState(""),[m,d]=c.useState({projects:[],tickets:[],cors:[],workers:[]}),[p,v]=c.useState(!1),[j,h]=c.useState(0),x=c.useRef(null),k=c.useRef(null),T=c.useRef(null);c.useEffect(()=>()=>{k.current&&clearTimeout(k.current),T.current&&clearTimeout(T.current)},[]),c.useEffect(()=>{s&&(u(""),d({projects:[],tickets:[],cors:[],workers:[]}),h(0),T.current=setTimeout(()=>x.current?.focus(),50))},[s]);const g=c.useCallback(async _=>{if(!_.trim()||_.length<2){d({projects:[],tickets:[],cors:[],workers:[]});return}v(!0);try{const P=await q.universalSearch(n,_.trim());d(P),h(0)}catch(P){console.error("Search error:",P),l?.("Search failed","error")}finally{v(!1)}},[n,l]),F=_=>{const P=_.target.value;u(P),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{g(P)},200)},y=(()=>{const _=[];return m.projects.forEach(P=>_.push({type:"project",data:P})),m.tickets.forEach(P=>_.push({type:"ticket",data:P})),m.cors.forEach(P=>_.push({type:"cor",data:P})),m.workers.forEach(P=>_.push({type:"worker",data:P})),_})(),A=y.length>0,$=_=>{_.key==="Escape"?t():_.key==="ArrowDown"?(_.preventDefault(),h(P=>Math.min(P+1,y.length-1))):_.key==="ArrowUp"?(_.preventDefault(),h(P=>Math.max(P-1,0))):_.key==="Enter"&&A&&(_.preventDefault(),S(y[j]))},S=_=>{if(_){switch(_.type){case"project":a?.(_.data);break;case"ticket":r?.(_.data);break;case"cor":i?.(_.data);break;case"worker":_.data.lastProject&&a?.(_.data.lastProject);break}t()}};return s?e.jsx("div",{className:"universal-search-overlay",onClick:t,children:e.jsxs("div",{className:"universal-search-modal",onClick:_=>_.stopPropagation(),children:[e.jsxs("div",{className:"universal-search-input-wrapper",children:[e.jsx(an,{size:20,className:"universal-search-icon"}),e.jsx("input",{ref:x,type:"text",value:o,onChange:F,onKeyDown:$,placeholder:"Search projects, tickets, CORs, workers...",className:"universal-search-input",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),o&&e.jsx("button",{className:"universal-search-clear",onClick:()=>u(""),children:e.jsx(os,{size:16})}),e.jsx("div",{className:"universal-search-shortcut",children:e.jsx("span",{children:"esc"})})]}),e.jsx("div",{className:"universal-search-results",children:p?e.jsxs("div",{className:"universal-search-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Searching..."})]}):o.trim()?A?e.jsxs(e.Fragment,{children:[m.projects.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(ft,{size:14}),e.jsx("span",{children:"Projects"})]}),m.projects.map((_,P)=>{const L=P;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>S({type:"project",data:_}),onMouseEnter:()=>h(L),children:[e.jsx(ft,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:_.name}),_.job_number&&e.jsxs("span",{className:"universal-search-item-meta",children:["#",_.job_number]})]}),e.jsx(Le,{size:16,className:"universal-search-item-arrow"})]},_.id)})]}),m.tickets.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(ns,{size:14}),e.jsx("span",{children:"T&M Tickets"})]}),m.tickets.map((_,P)=>{const L=m.projects.length+P;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>S({type:"ticket",data:_}),onMouseEnter:()=>h(L),children:[e.jsx(ns,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[_.description?.substring(0,50)||"T&M Ticket",_.description?.length>50&&"..."]}),e.jsxs("span",{className:"universal-search-item-meta",children:[_.projectName," • ",_.work_date]})]}),e.jsx("span",{className:`universal-search-item-badge ${_.status}`,children:_.status})]},_.id)})]}),m.cors.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(xe,{size:14}),e.jsx("span",{children:"Change Orders"})]}),m.cors.map((_,P)=>{const L=m.projects.length+m.tickets.length+P;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>S({type:"cor",data:_}),onMouseEnter:()=>h(L),children:[e.jsx(xe,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[_.cor_number?`COR #${_.cor_number}: `:"",_.title]}),e.jsx("span",{className:"universal-search-item-meta",children:_.projectName})]}),e.jsx("span",{className:`universal-search-item-badge ${_.status}`,children:_.status})]},_.id)})]}),m.workers.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(Re,{size:14}),e.jsx("span",{children:"Workers"})]}),m.workers.map((_,P)=>{const L=m.projects.length+m.tickets.length+m.cors.length+P;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>S({type:"worker",data:_}),onMouseEnter:()=>h(L),children:[e.jsx(Re,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:_.name}),e.jsxs("span",{className:"universal-search-item-meta",children:[_.role," • ",_.projectName]})]}),e.jsx(Le,{size:16,className:"universal-search-item-arrow"})]},`${_.name}-${P}`)})]})]}):e.jsx("div",{className:"universal-search-no-results",children:e.jsxs("span",{children:['No results for "',o,'"']})}):e.jsxs("div",{className:"universal-search-empty",children:[e.jsxs("div",{className:"universal-search-tip",children:[e.jsx(Ii,{size:14}),e.jsx("span",{children:"Type to search across all data"})]}),e.jsxs("div",{className:"universal-search-hints",children:[e.jsx("span",{children:"Projects"}),e.jsx("span",{children:"T&M Tickets"}),e.jsx("span",{children:"Change Orders"}),e.jsx("span",{children:"Workers"})]})]})}),e.jsxs("div",{className:"universal-search-footer",children:[e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↑↓"})," navigate"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↵"})," select"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"esc"})," close"]})]})]})}):null}function Oo(){const[s,t]=c.useState(!1);return c.useEffect(()=>{const n=a=>{(a.metaKey||a.ctrlKey)&&a.key==="k"&&(a.preventDefault(),t(r=>!r))};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]),{isOpen:s,setIsOpen:t,open:()=>t(!0),close:()=>t(!1)}}function Mo({alerts:s=[],onAction:t,onDismiss:n,maxVisible:a=3,className:r=""}){const[i,l]=c.useState(new Set),o=s.filter(m=>!i.has(m.id||`${m.projectId}-${m.type}-${m.title}`)).slice(0,a),u=c.useCallback(m=>{const d=m.id||`${m.projectId}-${m.type}-${m.title}`;l(p=>new Set([...p,d])),n?.(m)},[n]);return o.length===0?null:e.jsxs("div",{className:`smart-alerts ${r}`,role:"region","aria-label":"Project alerts","aria-live":"polite",children:[o.map((m,d)=>e.jsx($o,{alert:m,onAction:t,onDismiss:()=>u(m)},m.id||`${m.projectId}-${m.type}-${d}`)),s.length>a&&e.jsx("div",{className:"smart-alerts__overflow",children:e.jsxs("span",{className:"smart-alerts__overflow-text",children:["+",s.length-a," more alerts"]})})]})}function $o({alert:s,onAction:t,onDismiss:n}){const{type:a="info",title:r,description:i,action:l,actionTarget:o,projectId:u,projectName:m}=s,p={critical:Li,warning:is,info:Ws}[a]||Ws,v=()=>{t?.({target:o,projectId:u,alert:s})};return e.jsxs("div",{className:`smart-alert smart-alert--${a}`,role:"alert","aria-live":a==="critical"?"assertive":"polite",children:[e.jsx(p,{className:"smart-alert__icon","aria-hidden":"true"}),e.jsxs("div",{className:"smart-alert__content",children:[e.jsxs("div",{className:"smart-alert__title",children:[m&&e.jsxs("span",{className:"smart-alert__project",children:[m,": "]}),r]}),i&&e.jsx("div",{className:"smart-alert__description",children:i}),l&&e.jsx("div",{className:"smart-alert__action",children:e.jsxs("button",{type:"button",className:"smart-alert__action-btn",onClick:v,children:[l,e.jsx(zi,{size:14,"aria-hidden":"true"})]})})]}),n&&e.jsx("button",{type:"button",className:"smart-alert__dismiss",onClick:n,"aria-label":"Dismiss alert",children:e.jsx(os,{size:18,"aria-hidden":"true"})})]})}const Io=c.memo(function({progress:t=0,areasComplete:n=0,totalAreas:a=0,areasWorking:r=0,size:i=110,strokeWidth:l=9}){const[o,u]=c.useState(0),m=c.useRef(null);c.useEffect(()=>{const h=o,x=Math.min(100,Math.max(0,t)),k=800,T=performance.now(),g=F=>{const f=F-T,y=Math.min(f/k,1),A=1-Math.pow(1-y,3),$=h+(x-h)*A;u($),y<1&&(m.current=requestAnimationFrame(g))};return m.current=requestAnimationFrame(g),()=>{m.current&&cancelAnimationFrame(m.current)}},[t]);const d=(i-l)/2,p=d*2*Math.PI,v=p-o/100*p,j=()=>o>=80?"var(--accent-green)":o>=50||o>=25?"var(--accent-blue)":"var(--text-muted)";return e.jsxs("div",{className:"overview-progress-gauge",children:[e.jsxs("div",{className:"progress-gauge-circle",style:{width:i,height:i},children:[e.jsxs("svg",{width:i,height:i,viewBox:`0 0 ${i} ${i}`,children:[e.jsx("circle",{className:"gauge-track",cx:i/2,cy:i/2,r:d,fill:"none",strokeWidth:l,stroke:"var(--bg-tertiary)"}),e.jsx("circle",{className:"gauge-fill",cx:i/2,cy:i/2,r:d,fill:"none",stroke:j(),strokeWidth:l,strokeDasharray:p,strokeDashoffset:v,strokeLinecap:"round",transform:`rotate(-90 ${i/2} ${i/2})`,style:{transition:"stroke 0.3s ease"}})]}),e.jsxs("div",{className:"gauge-center",children:[e.jsxs("span",{className:"gauge-value",children:[Math.round(o),"%"]}),e.jsx("span",{className:"gauge-label",children:"Complete"})]})]}),e.jsxs("div",{className:"gauge-areas-status",children:[e.jsxs("span",{className:"areas-count",children:[e.jsx("strong",{children:n}),"/",a," Areas Done"]}),r>0&&e.jsxs("span",{className:"areas-active",children:[r," active"]})]})]})}),K={contract:"#3b82f6",revenue:"#10b981",costs:"#f59e0b",profit:"#22c55e",loss:"#ef4444",tmValue:"#8b5cf6",corValue:"#14b8a6",labor:"#6366f1",disposal:"#14b8a6",equipment:"#f97316",materials:"#a855f7",subcontractor:"#ec4899",other:"#6b7280"},fs={duration:800},Oa={contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"12px 16px"},labelStyle:{color:"var(--text-primary)",fontWeight:600,marginBottom:"8px"}},Ma={labor:{label:"Labor",color:K.labor,icon:"HardHat"},disposal:{label:"Disposal",color:K.disposal,icon:"Trash2"},equipment:{label:"Equipment",color:K.equipment,icon:"Truck"},materials:{label:"Materials",color:K.materials,icon:"Package"},subcontractor:{label:"Subcontractor",color:K.subcontractor,icon:"Users"},other:{label:"Other",color:K.other,icon:"MoreHorizontal"}},$a=[{id:"7d",label:"7D",days:7},{id:"30d",label:"30D",days:30},{id:"90d",label:"90D",days:90},{id:"all",label:"All",days:null}],Ue=s=>s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(0)}K`:`$${s.toFixed(0)}`,Tt=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}),Lo={revenue:{id:"revenueGradient",color:K.revenue,startOpacity:.3,endOpacity:0},costs:{id:"costsGradient",color:K.costs,startOpacity:.3,endOpacity:0},tmValue:{id:"tmValueGradient",color:K.tmValue,startOpacity:.2,endOpacity:0}},zo=c.memo(function({earnedRevenue:t=0,totalCosts:n=0,laborCost:a=0,disposalCost:r=0,equipmentCost:i=0,materialsCost:l=0,otherCost:o=0,contractValue:u=0}){const m=t-n,d=t>0?m/t*100:0,p=m>=0,v=x=>x>=1e6?`$${(x/1e6).toFixed(1)}M`:x>=1e3?`$${(x/1e3).toFixed(1)}K`:`$${x.toFixed(0)}`,j=[{key:"labor",value:a,color:K.labor,label:"Labor"},{key:"disposal",value:r,color:K.disposal,label:"Disposal"},{key:"equipment",value:i,color:K.equipment,label:"Equipment"},{key:"materials",value:l,color:K.materials,label:"Materials"},{key:"other",value:o,color:K.other,label:"Other"}].filter(x=>x.value>0),h=j.length>0&&n>0;return e.jsxs("div",{className:"overview-financial-card animate-fade-in-up",children:[e.jsxs("div",{className:"financial-metrics-row",children:[e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value green",children:v(t)}),e.jsx("span",{className:"financial-metric-label",children:"Earned"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value amber",children:v(n)}),e.jsx("span",{className:"financial-metric-label",children:"Costs"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsxs("span",{className:`financial-metric-value ${p?"green":"red"}`,children:[p?"":"-",v(Math.abs(m))]}),e.jsxs("span",{className:"financial-metric-label",children:["Profit",e.jsxs("span",{className:`margin-badge ${p?"positive":"negative"}`,children:[d>=0?"+":"",d.toFixed(0),"%"]})]})]})]}),h&&e.jsxs("div",{className:"cost-breakdown-section",children:[e.jsx("div",{className:"cost-breakdown-bar",children:j.map((x,k)=>{const T=x.value/n*100;return e.jsx("div",{className:"cost-segment",style:{width:`${T}%`,backgroundColor:x.color,animationDelay:`${k*100}ms`},title:`${x.label}: ${v(x.value)} (${T.toFixed(0)}%)`},x.key)})}),e.jsx("div",{className:"cost-breakdown-legend",children:j.slice(0,4).map(x=>e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot",style:{backgroundColor:x.color}}),e.jsx("span",{className:"legend-label",children:x.label})]},x.key))})]})]})}),qo=()=>ne(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),zs={contract:K.contract,tm:K.costs},Ia=[{id:"7d",label:"7D",days:7},{id:"14d",label:"14D",days:14},{id:"30d",label:"30D",days:30}],Vo=c.memo(function({project:t,onShowToast:n}){const[a,r]=c.useState([]),[i,l]=c.useState([]),[o,u]=c.useState(new Date().toISOString().split("T")[0]),[m,d]=c.useState("14d"),[p,v]=c.useState(!0),[j,h]=c.useState(!1);c.useEffect(()=>{t?.id&&x()},[t?.id]);const x=async()=>{v(!0);try{const[O,V]=await Promise.all([q.getCrewCheckinHistory(t.id,365),q.getTMTickets(t.id)]);r(O||[]),l(V||[])}catch(O){console.error("Error loading crew metrics:",O)}finally{v(!1)}},k=c.useMemo(()=>{const O={};return i.forEach(V=>{const R=V.work_date;R&&(O[R]||(O[R]=new Set),(V.t_and_m_workers||[]).forEach(X=>{O[R].add(X.name.toLowerCase().trim())}))}),O},[i]),T=c.useMemo(()=>{const O={};return a.forEach(V=>{O[V.check_in_date]=V.workers||[]}),O},[a]),g=T[o]||[],F=k[o]||new Set,f=c.useMemo(()=>{const O=[],V=[];return g.forEach(R=>{F.has(R.name.toLowerCase().trim())?V.push(R):O.push(R)}),{total:g.length,contract:O,tm:V}},[g,F]),y=c.useMemo(()=>{const O=Ia.find(X=>X.id===m)?.days||14,V=[],R=new Date;for(let X=O-1;X>=0;X--){const I=new Date(R);I.setDate(I.getDate()-X);const re=I.toISOString().split("T")[0],me=T[re]||[],le=k[re]||new Set;let Se=0,M=0;me.forEach(b=>{le.has(b.name.toLowerCase().trim())?M++:Se++}),V.push({date:re,displayDate:Tt(re),contract:Se,tm:M,total:me.length})}return V},[T,k,m]),A=c.useCallback(O=>{const V=new Date(o+"T12:00:00");V.setDate(V.getDate()+O),u(V.toISOString().split("T")[0])},[o]),$=o===new Date().toISOString().split("T")[0],S=O=>new Date(O+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),_=c.useCallback(O=>{O?.date&&u(O.date)},[]),P=({active:O,payload:V,label:R})=>{if(!O||!V?.length)return null;const X=(V[0]?.value||0)+(V[1]?.value||0);return e.jsxs("div",{style:{...Oa.contentStyle,fontSize:"0.8rem"},children:[e.jsx("p",{style:{...Oa.labelStyle,fontSize:"0.85rem",marginBottom:6},children:R}),e.jsxs("p",{style:{margin:"3px 0",color:zs.contract},children:["Contract: ",e.jsx("strong",{children:V[0]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:zs.tm},children:["T&M: ",e.jsx("strong",{children:V[1]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:"var(--text-primary)",borderTop:"1px solid var(--border-color)",paddingTop:4},children:["Total: ",e.jsx("strong",{children:X})]})]})},L=c.useCallback(async()=>{h(!0),n?.("Generating crew report PDF...","info");try{const V=(await qo()).default,R=new V,X=R.internal.pageSize.width;let I=20;R.setFontSize(18),R.setFont(void 0,"bold"),R.text("Crew On-Site Report",X/2,I,{align:"center"}),I+=8,R.setFontSize(11),R.setFont(void 0,"normal"),R.text(`Project: ${t.name}`,X/2,I,{align:"center"}),I+=6,R.text(`Date: ${S(o)}`,X/2,I,{align:"center"}),I+=12,R.setFontSize(12),R.setFont(void 0,"bold"),R.text("Selected Day Summary",14,I),I+=7,R.setFontSize(10),R.setFont(void 0,"normal"),R.text(`Total Crew On-Site: ${f.total}`,14,I),I+=5,R.text(`Contract Workers: ${f.contract.length}`,14,I),I+=5,R.text(`T&M Workers: ${f.tm.length}`,14,I),I+=10,f.contract.length>0&&(R.setFontSize(12),R.setFont(void 0,"bold"),R.text("Contract Workers",14,I),I+=7,R.setFontSize(9),R.setFont(void 0,"bold"),R.text("Name",14,I),R.text("Role",100,I),I+=5,R.setFont(void 0,"normal"),f.contract.forEach(le=>{I>270&&(R.addPage(),I=20),R.text(le.name,14,I),R.text(le.role||"—",100,I),I+=5}),I+=8),f.tm.length>0&&(I>240&&(R.addPage(),I=20),R.setFontSize(12),R.setFont(void 0,"bold"),R.text("T&M Workers (Extra Work)",14,I),I+=7,R.setFontSize(9),R.setFont(void 0,"bold"),R.text("Name",14,I),R.text("Role",100,I),I+=5,R.setFont(void 0,"normal"),f.tm.forEach(le=>{I>270&&(R.addPage(),I=20),R.text(le.name,14,I),R.text(le.role||"—",100,I),I+=5}),I+=8),I>200&&(R.addPage(),I=20),R.setFontSize(12),R.setFont(void 0,"bold"),R.text("Daily Timeline",14,I),I+=7,R.setFontSize(8),R.setFont(void 0,"bold"),R.text("Date",14,I),R.text("Total",70,I),R.text("Contract",95,I),R.text("T&M",125,I),I+=5,R.setFont(void 0,"normal"),y.forEach(le=>{I>275&&(R.addPage(),I=20),R.text(le.displayDate,14,I),R.text(String(le.total),70,I),R.text(String(le.contract),95,I),R.text(String(le.tm),125,I),I+=4.5});const re=R.internal.pageSize.height-10;R.setFontSize(8),R.setTextColor(128,128,128),R.text(`Generated ${new Date().toLocaleString()} — FieldSync`,X/2,re,{align:"center"});const me=`${t.name}_Crew_Report_${o}.pdf`;R.save(me),n?.("PDF exported!","success")}catch(O){console.error("Error exporting crew PDF:",O),n?.("Error generating PDF","error")}finally{h(!1)}},[t,o,f,y,n]);return p?e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsx("div",{className:"crew-metrics-header",children:e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Crew On-Site"]})}),e.jsxs("div",{className:"crew-metrics-loading",children:[e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"})]})]}):e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsxs("div",{className:"crew-metrics-header",children:[e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Crew On-Site"]}),e.jsx("div",{className:"crew-metrics-actions",children:e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:L,disabled:j,title:"Export crew report as PDF",children:[e.jsx(We,{size:14})," ",j?"Exporting...":"PDF"]})})]}),e.jsxs("div",{className:"crew-date-nav",children:[e.jsx("button",{className:"crew-date-btn",onClick:()=>A(-1),children:e.jsx(nn,{size:16})}),e.jsxs("span",{className:"crew-date-label",children:[e.jsx(Ys,{size:14}),$?"Today":S(o)]}),e.jsx("button",{className:"crew-date-btn",onClick:()=>A(1),disabled:$,children:e.jsx(Le,{size:16})})]}),e.jsxs("div",{className:"crew-stats-row",children:[e.jsxs("div",{className:"crew-stat total",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(Re,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:f.total}),e.jsx("span",{className:"crew-stat-label",children:"Total On-Site"})]})]}),e.jsxs("div",{className:"crew-stat contract",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(He,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:f.contract.length}),e.jsx("span",{className:"crew-stat-label",children:"Contract"})]})]}),e.jsxs("div",{className:"crew-stat tm",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(jt,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:f.tm.length}),e.jsx("span",{className:"crew-stat-label",children:"T&M"})]})]})]}),f.total>0&&e.jsxs("div",{className:"crew-breakdown-bar",children:[e.jsx("div",{className:"crew-bar-segment contract",style:{width:`${f.contract.length/f.total*100}%`},title:`${f.contract.length} Contract`}),e.jsx("div",{className:"crew-bar-segment tm",style:{width:`${f.tm.length/f.total*100}%`},title:`${f.tm.length} T&M`})]}),f.total>0&&e.jsxs("div",{className:"crew-name-lists",children:[f.contract.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header contract",children:[e.jsx(He,{size:13}),e.jsxs("span",{children:["Contract (",f.contract.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:f.contract.map((O,V)=>e.jsxs("span",{className:"crew-name-tag contract",children:[O.name,O.role&&O.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:O.role})]},V))})]}),f.tm.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header tm",children:[e.jsx(jt,{size:13}),e.jsxs("span",{children:["T&M (",f.tm.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:f.tm.map((O,V)=>e.jsxs("span",{className:"crew-name-tag tm",children:[O.name,O.role&&O.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:O.role})]},V))})]})]}),e.jsxs("div",{className:"crew-timeline-section",children:[e.jsxs("div",{className:"crew-timeline-header",children:[e.jsx("span",{className:"crew-timeline-title",children:"Daily Breakdown"}),e.jsx("div",{className:"crew-time-range-pills",children:Ia.map(O=>e.jsx("button",{className:`crew-range-pill ${m===O.id?"active":""}`,onClick:()=>d(O.id),children:O.label},O.id))})]}),e.jsx("div",{className:"crew-chart-container",children:e.jsx(Dt,{width:"100%",height:140,children:e.jsxs(Si,{data:y,onClick:O=>O?.activePayload?.[0]&&_(O.activePayload[0].payload),style:{cursor:"pointer"},children:[e.jsx(Qa,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Za,{dataKey:"displayDate",tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:{stroke:"var(--border-color)"},tickLine:!1,interval:m==="30d"?4:m==="14d"?1:0}),e.jsx(en,{tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:!1,tickLine:!1,allowDecimals:!1,width:30}),e.jsx(Et,{content:e.jsx(P,{})}),e.jsx(Xs,{wrapperStyle:{fontSize:"0.75rem",paddingTop:4},iconType:"circle",iconSize:8}),e.jsx(ya,{dataKey:"contract",name:"Contract",stackId:"crew",fill:zs.contract,radius:[0,0,0,0]}),e.jsx(ya,{dataKey:"tm",name:"T&M (Extra Work)",stackId:"crew",fill:zs.tm,radius:[3,3,0,0]})]})})})]}),f.total===0&&e.jsx("div",{className:"crew-empty",children:e.jsx("p",{children:"No crew checked in for this date"})})]})}),ae=c.memo(function({width:t,height:n,borderRadius:a="8px",className:r="",variant:i="default"}){const o=(()=>{switch(i){case"text":return{height:"1em",borderRadius:"4px"};case"circular":return{borderRadius:"50%"};case"rectangular":return{borderRadius:"0"};default:return{borderRadius:a}}})();return e.jsx("div",{className:`skeleton ${r}`,style:{width:t||"100%",height:n||o.height||"1rem",borderRadius:o.borderRadius},"aria-hidden":"true"})});c.memo(function({showProgress:t=!1}){return e.jsxs("div",{className:"metric-skeleton",children:[e.jsx(ae,{width:"60%",height:"0.75rem",className:"skeleton-label"}),e.jsx(ae,{width:"80%",height:"1.75rem",className:"skeleton-value"}),t&&e.jsx(ae,{width:"100%",height:"6px",className:"skeleton-progress"})]})});const $c=c.memo(function({lines:t=3,showHeader:n=!0,showAction:a=!1}){return e.jsxs("div",{className:"card-skeleton","aria-busy":"true","aria-label":"Loading content",children:[n&&e.jsxs("div",{className:"card-skeleton-header",children:[e.jsx(ae,{width:"40%",height:"1.25rem"}),a&&e.jsx(ae,{width:"80px",height:"32px"})]}),e.jsx("div",{className:"card-skeleton-body",children:Array.from({length:t}).map((r,i)=>e.jsx(ae,{width:`${100-i*15}%`,height:"1rem",className:"skeleton-line"},i))})]})});c.memo(function({count:t=3,showAvatar:n=!1,showAction:a=!1}){return e.jsx("div",{className:"list-skeleton","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:t}).map((r,i)=>e.jsxs("div",{className:"list-item-skeleton",children:[n&&e.jsx(ae,{width:"40px",height:"40px",variant:"circular"}),e.jsxs("div",{className:"list-item-skeleton-content",children:[e.jsx(ae,{width:"60%",height:"1rem"}),e.jsx(ae,{width:"40%",height:"0.75rem"})]}),a&&e.jsx(ae,{width:"60px",height:"28px"})]},i))})});c.memo(function(){return e.jsx("div",{className:"financial-row-skeleton","aria-busy":"true","aria-label":"Loading financial data",children:[1,2,3].map(t=>e.jsxs("div",{className:"financial-card-skeleton",children:[e.jsxs("div",{className:"financial-card-skeleton-header",children:[e.jsx(ae,{width:"24px",height:"24px",variant:"circular"}),e.jsx(ae,{width:"60%",height:"1rem"})]}),e.jsx(ae,{width:"50%",height:"2rem",className:"skeleton-hero-value"}),e.jsxs("div",{className:"financial-card-skeleton-details",children:[e.jsx(ae,{width:"100%",height:"0.875rem"}),e.jsx(ae,{width:"80%",height:"0.875rem"})]})]},t))})});c.memo(function({height:t="200px"}){return e.jsxs("div",{className:"chart-skeleton",style:{height:t},"aria-busy":"true","aria-label":"Loading chart",children:[e.jsx("div",{className:"chart-skeleton-bars",children:[40,65,45,80,55,70,50,75,60,85].map((n,a)=>e.jsx("div",{className:"chart-skeleton-bar",style:{height:`${n}%`}},a))}),e.jsx(ae,{width:"100%",height:"1px",className:"chart-skeleton-axis"})]})});const Ve=c.memo(function({count:t=3}){return e.jsx("div",{className:"ticket-skeleton-list","aria-busy":"true","aria-label":"Loading tickets",children:Array.from({length:t}).map((n,a)=>e.jsxs("div",{className:"ticket-skeleton-item",children:[e.jsxs("div",{className:"ticket-skeleton-header",children:[e.jsx(ae,{width:"100px",height:"0.875rem"}),e.jsx(ae,{width:"80px",height:"24px",borderRadius:"12px"})]}),e.jsx(ae,{width:"90%",height:"1rem"}),e.jsxs("div",{className:"ticket-skeleton-footer",children:[e.jsx(ae,{width:"60px",height:"0.75rem"}),e.jsx(ae,{width:"60px",height:"0.75rem"}),e.jsx(ae,{width:"60px",height:"0.75rem"})]})]},a))})}),Bo=c.memo(function(){return e.jsx("div",{className:"hero-metrics-skeleton","aria-busy":"true","aria-label":"Loading metrics",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"hero-metric-skeleton",children:[e.jsx(ae,{width:"80px",height:"0.75rem",className:"skeleton-label"}),e.jsx(ae,{width:"120px",height:"1.75rem",className:"skeleton-value"}),e.jsx(ae,{width:"100%",height:"4px",className:"skeleton-bar"})]},t))})}),jn=c.memo(function({title:t="Unable to load data",message:n="Something went wrong. Please try again.",error:a=null,onRetry:r=null,retryLabel:i="Try Again",variant:l="default",icon:o=null}){const m=o||(a?.message?.includes("network")||a?.message?.includes("offline")?qi:is);return l==="compact"?e.jsxs("div",{className:"error-state error-state-compact",role:"alert",children:[e.jsx(m,{size:16,className:"error-state-icon","aria-hidden":"true"}),e.jsx("span",{className:"error-state-message",children:n}),r&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:r,"aria-label":i,children:e.jsx(mt,{size:14})})]}):l==="inline"?e.jsxs("div",{className:"error-state error-state-inline",role:"alert",children:[e.jsxs("div",{className:"error-state-content",children:[e.jsx(m,{size:20,className:"error-state-icon","aria-hidden":"true"}),e.jsxs("div",{className:"error-state-text",children:[e.jsx("span",{className:"error-state-title",children:t}),e.jsx("span",{className:"error-state-message",children:n})]})]}),r&&e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:r,children:[e.jsx(mt,{size:14})," ",i]})]}):e.jsxs("div",{className:"error-state",role:"alert","aria-live":"polite",children:[e.jsx("div",{className:"error-state-icon-wrapper",children:e.jsx(m,{size:32,className:"error-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"error-state-title",children:t}),e.jsx("p",{className:"error-state-message",children:n}),!1,r&&e.jsxs("button",{className:"btn btn-primary",onClick:r,children:[e.jsx(mt,{size:16})," ",i]})]})}),La=c.memo(function({title:t="No data yet",message:n="Items will appear here once added.",icon:a=null,action:r=null,actionLabel:i="Get Started",onAction:l=null}){return e.jsxs("div",{className:"empty-state",role:"status",children:[a&&e.jsx("div",{className:"empty-state-icon-wrapper",children:e.jsx(a,{size:32,className:"empty-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"empty-state-title",children:t}),e.jsx("p",{className:"empty-state-message",children:n}),l&&e.jsx("button",{className:"btn btn-primary btn-small",onClick:l,children:i}),r&&!l&&r]})});c.memo(function({label:t,error:n,required:a=!1,hint:r,children:i,className:l=""}){return e.jsxs("div",{className:`form-field ${n?"has-error":""} ${l}`,children:[t&&e.jsxs("label",{className:"form-field-label",children:[t,a&&e.jsx("span",{className:"form-field-required",children:"*"})]}),e.jsx("div",{className:"form-field-input",children:i}),n&&e.jsxs("div",{className:"form-field-error",role:"alert",children:[e.jsx(Ns,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:n})]}),r&&!n&&e.jsx("div",{className:"form-field-hint",children:r})]})});c.memo(function({type:t="text",value:n,onChange:a,onBlur:r,error:i,placeholder:l,disabled:o,min:u,max:m,step:d,pattern:p,required:v,autoComplete:j,name:h,id:x,className:k="","aria-label":T,"aria-describedby":g}){const F=x||h,f=i?`${F}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:t,id:F,name:h,value:n,onChange:a,onBlur:r,placeholder:l,disabled:o,min:u,max:m,step:d,pattern:p,required:v,autoComplete:j,className:`validated-input ${i?"has-error":""} ${k}`,"aria-label":T,"aria-invalid":!!i,"aria-describedby":i?f:g}),i&&e.jsxs("div",{id:f,className:"input-error-inline",role:"alert",children:[e.jsx(Ns,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:i})]})]})});c.memo(function({value:t,onChange:n,onBlur:a,error:r,disabled:i,required:l,name:o,id:u,className:m="",children:d,"aria-label":p}){const v=u||o,j=r?`${v}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("select",{id:v,name:o,value:t,onChange:n,onBlur:a,disabled:i,required:l,className:`validated-select ${r?"has-error":""} ${m}`,"aria-label":p,"aria-invalid":!!r,"aria-describedby":r?j:void 0,children:d}),r&&e.jsxs("div",{id:j,className:"input-error-inline",role:"alert",children:[e.jsx(Ns,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});c.memo(function({value:t,onChange:n,onBlur:a,error:r,placeholder:i,disabled:l,required:o,rows:u=3,maxLength:m,name:d,id:p,className:v="","aria-label":j}){const h=p||d,x=r?`${h}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("textarea",{id:h,name:d,value:t,onChange:n,onBlur:a,placeholder:i,disabled:l,required:o,rows:u,maxLength:m,className:`validated-textarea ${r?"has-error":""} ${v}`,"aria-label":j,"aria-invalid":!!r,"aria-describedby":r?x:void 0}),m&&e.jsxs("div",{className:"textarea-counter",children:[t?.length||0," / ",m]}),r&&e.jsxs("div",{id:x,className:"input-error-inline",role:"alert",children:[e.jsx(Ns,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});const Wo=c.memo(function({count:t,label:n,variant:a="default",size:r="medium",pulse:i=!1,icon:l}){const[o,u]=c.useState(t),[m,d]=c.useState(!1);return c.useEffect(()=>{if(t!==o){d(!0);const p=setTimeout(()=>{d(!1),u(t)},400);return()=>clearTimeout(p)}},[t,o]),e.jsxs("span",{className:`count-badge count-badge-${a} count-badge-${r} ${i?"badge-new":""} ${m?"animate-count-up":""}`,title:n,children:[l&&e.jsx(l,{size:r==="small"?12:r==="large"?18:14}),e.jsx("span",{className:"count-badge-value",children:t}),n&&e.jsx("span",{className:"count-badge-label",children:n})]})}),Uo=c.memo(function({value:t,max:n=100,showLabel:a=!1,size:r="medium",variant:i="default",animated:l=!0}){const o=Math.min(100,Math.max(0,t/n*100)),u=r==="small"?"4px":r==="large"?"8px":"6px",m=i==="default"?o>=80?"danger":o>=60?"warning":"success":i;return e.jsxs("div",{className:`mini-progress mini-progress-${r}`,children:[e.jsx("div",{className:"mini-progress-track",style:{height:u},children:e.jsx("div",{className:`mini-progress-fill mini-progress-${m} ${l?"progress-animate":""}`,style:{width:`${o}%`}})}),a&&e.jsxs("span",{className:"mini-progress-label",children:[Math.round(o),"%"]})]})}),Ho=c.memo(function({value:t,previousValue:n,format:a="percent",inverted:r=!1,showValue:i=!0}){const l=t-n,o=n!==0?l/n*100:0;let u=l===0?"neutral":l>0?"up":"down",m="neutral";l!==0&&(r?m=l>0?"negative":"positive":m=l>0?"positive":"negative");const d=u==="up"?ws:u==="down"?Cs:Rt,p=()=>{const v=Math.abs(l);switch(a){case"percent":return`${Math.abs(o).toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(v);default:return v.toLocaleString()}};return e.jsxs("span",{className:`trend-indicator trend-${m}`,children:[e.jsx(d,{size:14}),i&&e.jsx("span",{className:"trend-value",children:p()})]})});c.memo(function({status:t="default",label:n,size:a="medium",pulse:r=!1}){return e.jsxs("span",{className:`status-dot-container status-dot-${a}`,children:[e.jsx("span",{className:`status-dot status-dot-${t} ${r?"status-dot-pulse":""}`}),n&&e.jsx("span",{className:"status-dot-label",children:n})]})});c.memo(function({data:t=[],width:n=80,height:a=24,strokeWidth:r=2,color:i="var(--accent-blue)",showArea:l=!0}){if(!t.length)return null;const o=Math.max(...t),u=Math.min(...t),m=o-u||1,d=t.map((v,j)=>{const h=j/(t.length-1)*n,x=a-(v-u)/m*(a-r*2)-r;return`${h},${x}`}).join(" "),p=`0,${a} ${d} ${n},${a}`;return e.jsxs("svg",{width:n,height:a,className:"sparkline",viewBox:`0 0 ${n} ${a}`,children:[l&&e.jsx("polygon",{points:p,fill:i,fillOpacity:"0.15"}),e.jsx("polyline",{points:d,fill:"none",stroke:i,strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]})});c.memo(function({items:t=[]}){return e.jsx("div",{className:"quick-stats",children:t.map((n,a)=>e.jsxs("span",{className:"quick-stat-item",children:[n.icon&&e.jsx(n.icon,{size:12}),e.jsx("span",{className:"quick-stat-value",children:n.value}),n.label&&e.jsx("span",{className:"quick-stat-label",children:n.label})]},a))})});c.memo(function({status:t,label:n,size:a="medium"}){const r={success:rn,warning:is,danger:is,info:wa,pending:wa},i=r[t]||r.info;return e.jsxs("span",{className:`status-indicator status-indicator-${t} status-indicator-${a}`,children:[e.jsx(i,{size:a==="small"?12:a==="large"?18:14}),n&&e.jsx("span",{className:"status-indicator-label",children:n})]})});c.memo(function({current:t,previous:n,format:a="number",label:r,inverted:i=!1}){const l=t-n,o=i?l<0:l>0,u=i?l>0:l<0,m=d=>{switch(a){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(Math.abs(d));case"percent":return`${Math.abs(d).toFixed(1)}%`;default:return Math.abs(d).toLocaleString()}};return e.jsxs("div",{className:`metric-delta ${o?"positive":u?"negative":"neutral"}`,children:[e.jsx("span",{className:"metric-delta-arrow",children:l>0?"↑":l<0?"↓":"→"}),e.jsx("span",{className:"metric-delta-value",children:m(l)}),r&&e.jsx("span",{className:"metric-delta-label",children:r})]})});c.memo(function({value:t,max:n=100,size:a=40,strokeWidth:r=4,showValue:i=!0,color:l="var(--accent-blue)"}){const o=Math.min(100,Math.max(0,t/n*100)),u=(a-r)/2,m=u*2*Math.PI,d=m-o/100*m;return e.jsxs("div",{className:"circular-progress",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,viewBox:`0 0 ${a} ${a}`,children:[e.jsx("circle",{className:"circular-progress-track",cx:a/2,cy:a/2,r:u,fill:"none",strokeWidth:r}),e.jsx("circle",{className:"circular-progress-fill",cx:a/2,cy:a/2,r:u,fill:"none",stroke:l,strokeWidth:r,strokeDasharray:m,strokeDashoffset:d,strokeLinecap:"round",transform:`rotate(-90 ${a/2} ${a/2})`,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),i&&e.jsxs("span",{className:"circular-progress-value",children:[Math.round(o),"%"]})]})});c.memo(function({isOpen:t,onClose:n,title:a,children:r,size:i="medium",className:l="",showCloseButton:o=!0,closeOnOverlayClick:u=!0,closeOnEscape:m=!0,footer:d,ariaDescribedBy:p}){const v=c.useRef(null),j=c.useRef(null),h=c.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`);c.useEffect(()=>{if(t){j.current=document.activeElement;const g=setTimeout(()=>{v.current?.focus()},10);return()=>clearTimeout(g)}},[t]),c.useEffect(()=>{!t&&j.current&&j.current.focus()},[t]),c.useEffect(()=>{if(!t||!m)return;const g=F=>{F.key==="Escape"&&(F.preventDefault(),n())};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[t,m,n]),c.useEffect(()=>{if(t){const g=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=g}}},[t]);const x=c.useCallback(g=>{if(g.key!=="Tab")return;const F=v.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!F||F.length===0)return;const f=F[0],y=F[F.length-1];g.shiftKey?document.activeElement===f&&(g.preventDefault(),y.focus()):document.activeElement===y&&(g.preventDefault(),f.focus())},[]),k=g=>{u&&g.target===g.currentTarget&&n()};if(!t)return null;const T={small:"modal-small",medium:"modal-medium",large:"modal-large",full:"modal-full"};return e.jsx("div",{className:"modal-overlay",onClick:k,role:"presentation",children:e.jsxs("div",{ref:v,className:`modal-content ${T[i]||""} ${l}`,role:"dialog","aria-modal":"true","aria-labelledby":a?h.current:void 0,"aria-describedby":p,tabIndex:-1,onKeyDown:x,onClick:g=>g.stopPropagation(),children:[a&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:h.current,children:a}),o&&e.jsx("button",{className:"close-btn",onClick:n,"aria-label":"Close modal",type:"button",children:e.jsx(os,{size:20})})]}),e.jsx("div",{className:"modal-body",children:r}),d&&e.jsx("div",{className:"modal-footer",children:d})]})})});const ps=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),qs=c.memo(function({icon:t,label:n,value:a,formattedValue:r,subLabel:i,progress:l,progressLabel:o,variant:u="default",trend:m,previousValue:d}){const p={default:"var(--accent-blue)",success:"var(--accent-green)",warning:"var(--accent-amber)",danger:"var(--accent-red)"};return e.jsxs("div",{className:"hero-metric-card hover-lift animate-fade-in-up",children:[e.jsxs("div",{className:"hero-metric-header",children:[e.jsx("div",{className:"hero-metric-icon",style:{color:p[u]},children:e.jsx(t,{size:18})}),e.jsx("span",{className:"hero-metric-label",children:n})]}),e.jsxs("div",{className:"hero-metric-value-row",children:[e.jsx("span",{className:`hero-metric-value hero-metric-${u}`,children:r}),m!==void 0&&d!==void 0&&e.jsx(Ho,{value:a,previousValue:d,format:"currency",inverted:n.toLowerCase().includes("cost")})]}),i&&e.jsx("span",{className:"hero-metric-sublabel",children:i}),l!==void 0&&e.jsxs("div",{className:"hero-metric-progress",children:[e.jsx(Uo,{value:l,max:100,size:"small",variant:u,showLabel:!0}),o&&e.jsx("span",{className:"hero-metric-progress-label",children:o})]})]})}),Go=c.memo(function({contractValue:t=0,earnedRevenue:n=0,totalCosts:a=0,profit:r=0,progress:i=0,corApprovedValue:l=0,loading:o=!1,previousData:u}){const m=t+l,d=n>0?r/n*100:0,p=n>0?a/n*100:0,v=m>0?n/m*100:0,j=m>0?a/m*100:0,h=c.useMemo(()=>d>=20?"success":d>=10?"warning":d<0?"danger":"default",[d]),x=c.useMemo(()=>p<=60?"success":p<=80?"warning":"danger",[p]);return o?e.jsx(Bo,{}):e.jsxs("div",{className:"hero-metrics stagger-children",children:[e.jsx(qs,{icon:xs,label:"Contract Value",value:m,formattedValue:ps(m),subLabel:l>0?`+${ps(l)} CORs`:null,variant:"default"}),e.jsx(qs,{icon:ws,label:"Earned Revenue",value:n,formattedValue:ps(n),progress:v,progressLabel:`${Math.round(v)}% of contract`,variant:"success",previousValue:u?.earnedRevenue,trend:u?n:void 0}),e.jsx(qs,{icon:ln,label:"Total Costs",value:a,formattedValue:ps(a),progress:j,progressLabel:`${Math.round(p)}% of revenue`,variant:x,previousValue:u?.totalCosts,trend:u?a:void 0}),e.jsx(qs,{icon:Vi,label:"Profit",value:r,formattedValue:ps(r),subLabel:`${d>=0?"+":""}${d.toFixed(1)}% margin`,variant:h,previousValue:u?.profit,trend:u?r:void 0})]})}),za=[{id:"overview",label:"Overview",shortLabel:"Overview",icon:Wi,description:"Metrics & trends",step:null},{id:"cors",label:"Change Orders",shortLabel:"CORs",icon:ns,description:"CORs & approvals",step:1},{id:"tickets",label:"T&M Tickets",shortLabel:"Tickets",icon:xe,description:"Field data",step:2},{id:"billing",label:"Billing",shortLabel:"Billing",icon:ln,description:"Invoices & billing",step:3}],Ko=c.memo(function({activeSection:t="overview",onSectionChange:n,collapsed:a=!1,onToggleCollapse:r,onMobileClose:i,stats:l={}}){const{corCount:o=0,ticketCount:u=0,corPending:m=0,ticketPending:d=0,billableCount:p=0,invoiceCount:v=0}=l,j=h=>h==="cors"&&o>0?{count:o,variant:m>0?"warning":"default",pending:m}:h==="tickets"&&u>0?{count:u,variant:d>0?"warning":"default",pending:d}:h==="billing"&&p>0?{count:p,variant:"success",pending:p}:null;return e.jsxs("nav",{className:`financials-nav ${a?"collapsed":""}`,"aria-label":"Financials sections",children:[i&&e.jsxs("div",{className:"financials-nav-mobile-header",children:[e.jsx("span",{className:"financials-nav-mobile-title",children:"Financials"}),e.jsx("button",{className:"financials-nav-mobile-close",onClick:i,"aria-label":"Close menu",children:e.jsx(os,{size:20})})]}),e.jsxs("button",{className:"financials-nav-toggle",onClick:r,"aria-label":a?"Expand sidebar":"Collapse sidebar",title:a?"Expand sidebar":"Collapse sidebar",children:[a?e.jsx(Bi,{size:18}):e.jsx(nn,{size:18}),!a&&e.jsx("span",{children:"Collapse"})]}),e.jsx("div",{className:"financials-nav-items",children:za.map((h,x)=>{const k=t===h.id,T=h.icon,g=j(h.id),F=x<za.length-1&&h.step!==null;return e.jsxs("div",{className:"financials-nav-item-wrapper",children:[e.jsxs("button",{className:`financials-nav-item ${k?"active":""}`,onClick:()=>n?.(h.id),"aria-current":k?"page":void 0,title:`${h.label}${g?` (${g.count})`:""}`,children:[h.step&&!a&&e.jsx("span",{className:"financials-nav-step",children:h.step}),e.jsxs("div",{className:"financials-nav-icon",children:[e.jsx(T,{size:a?22:20}),g&&g.pending>0&&e.jsx("span",{className:"financials-nav-dot"})]}),a&&e.jsx("span",{className:"financials-nav-short-label",children:h.shortLabel}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"financials-nav-content",children:[e.jsx("span",{className:"financials-nav-label",children:h.label}),e.jsx("span",{className:"financials-nav-desc",children:h.description})]}),g&&e.jsx(Wo,{count:g.count,size:"small",variant:g.variant}),e.jsx(Le,{size:16,className:"financials-nav-arrow"})]})]}),F&&!a&&e.jsx("div",{className:"financials-nav-connector",children:e.jsx("div",{className:"connector-line"})})]},h.id)})}),a&&e.jsxs("button",{className:"financials-nav-expand-btn",onClick:r,"aria-label":"Expand sidebar",children:[e.jsx(Le,{size:14}),e.jsx("span",{children:"Expand"})]})]})});function Yo(s,t,n=[],a=null,r=[]){const i=t?.contract_value||0,l=s?.laborByDate||[],o=s?.haulOffByDate||[],u=s?.materialsEquipmentByDate||[],m=s?.customCosts||[],d=new Set;l.forEach(y=>d.add(y.date)),o.forEach(y=>d.add(y.date)),u.forEach(y=>d.add(y.date)),m.forEach(y=>{y.cost_date&&d.add(y.cost_date)}),n.forEach(y=>{y.work_date&&d.add(y.work_date),y.ticket_date&&d.add(y.ticket_date),y.created_at&&d.add(y.created_at.split("T")[0])}),r.forEach(y=>{y.status==="done"&&y.updated_at&&d.add(y.updated_at.split("T")[0])});const p=[...d].sort((y,A)=>new Date(y)-new Date(A));if(p.length===0)return[];const v={},j=r.reduce((y,A)=>y+(parseFloat(A.weight)||0),0);r.forEach(y=>{if(y.status==="done"&&y.updated_at){const A=y.updated_at.split("T")[0],$=parseFloat(y.weight)||0,S=y.scheduled_value?parseFloat(y.scheduled_value):j>0?$/j*i:0;v[A]||(v[A]=0),v[A]+=S}});let h=0,x=0;const k={};n.forEach(y=>{const A=y.work_date||y.ticket_date||y.created_at?.split("T")[0];if(!A)return;let $=0;const S=y.t_and_m_workers||y.workers||[];Array.isArray(S)&&S.forEach(P=>{const L=parseFloat(P.hours)||parseFloat(P.regular_hours)||0,O=parseFloat(P.overtime_hours)||0,V=parseFloat(P.regular_rate)||parseFloat(P.rate)||65,R=parseFloat(P.overtime_rate)||V*1.5;$+=L*V+O*R});const _=y.t_and_m_items||y.items||[];Array.isArray(_)&&_.forEach(P=>{const L=parseFloat(P.quantity)||1,O=parseFloat(P.unit_cost)||parseFloat(P.materials_equipment?.cost_per_unit)||0;$+=L*O}),k[A]||(k[A]=0),k[A]+=$});const T={};m.forEach(y=>{const A=y.cost_date;A&&(T[A]||(T[A]=0),T[A]+=parseFloat(y.amount)||0)});const g={};u.forEach(y=>{y.date&&(g[y.date]=y.cost||0)});let F=0;return p.map(y=>{const $=l.find(re=>re.date===y)?.cost||0,_=o.find(re=>re.date===y)?.cost||0,P=g[y]||0,L=T[y]||0,O=$+P+_+L;h+=O;const V=k[y]||0;x+=V;const R=v[y]||0;F+=R;const I=Object.keys(v).length>0?F:s?.billable||0;return{date:y,contract:i,revenue:Math.round(I),costs:Math.round(h),tmValue:Math.round(x),corValue:Math.round(a?.total_approved_value||0),profit:Math.round(I-h),dailyLabor:Math.round($),dailyRevenue:Math.round(R),dailyMaterials:Math.round(P),dailyHaulOff:Math.round(_),dailyCustom:Math.round(L),dailyTM:Math.round(V),dailyTotal:Math.round(O)}})}function Jo(s,t){if(!t||!s.length)return s;const n=new Date,a=new Date;return a.setDate(n.getDate()-t),s.filter(r=>new Date(r.date)>=a)}function Xo(s=0,t=0,n=[]){const a=[];s>0&&a.push({name:"Labor",value:s,color:K.labor,category:"labor"}),t>0&&a.push({name:"Disposal",value:t,color:K.disposal,category:"disposal"});const r={};n.forEach(l=>{const o=l.category||"other";r[o]||(r[o]={items:[],total:0}),r[o].items.push(l),r[o].total+=parseFloat(l.amount)||0}),Object.entries(r).forEach(([l,o])=>{if(o.total>0){const u=Ma[l]||Ma.other;a.push({name:u.label,value:o.total,color:u.color,category:l,items:o.items})}});const i=a.reduce((l,o)=>l+o.value,0);return a.forEach(l=>{l.percentage=i>0?Math.round(l.value/i*100):0}),a.sort((l,o)=>o.value-l.value),a}function qa(s,t){if(!s||s.length<2)return{direction:"flat",percentage:0};const n=s.slice(-7);if(n.length<2)return{direction:"flat",percentage:0};const a=n[0][t]||0,r=n[n.length-1][t]||0;if(a===0)return{direction:r>0?"up":"flat",percentage:0};const i=(r-a)/a*100;return{direction:i>5?"up":i<-5?"down":"flat",percentage:Math.abs(Math.round(i))}}function Qo({active:s,payload:t,label:n}){if(!s||!t||!t.length)return null;const a=i=>i>=1e6?`$${(i/1e6).toFixed(2)}M`:i>=1e3?`$${(i/1e3).toFixed(1)}K`:`$${i.toFixed(0)}`,r=t[0]?.payload||{};return e.jsxs("div",{className:"chart-tooltip",children:[e.jsx("div",{className:"chart-tooltip-date",children:Tt(n)}),e.jsxs("div",{className:"chart-tooltip-rows",children:[r.contract!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:K.contract}}),"Contract"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.contract)})]}),r.revenue!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:K.revenue}}),"Revenue"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.revenue)})]}),r.costs!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:K.costs}}),"Costs"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.costs)})]}),r.tmValue!==void 0&&r.tmValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:K.tmValue}}),"T&M Value"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.tmValue)})]}),r.corValue!==void 0&&r.corValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:K.corValue}}),"COR Approved"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.corValue)})]}),r.profit!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:r.profit>=0?K.profit:K.loss}}),r.profit>=0?"Profit":"Loss"]}),e.jsx("span",{className:"chart-tooltip-value",style:{color:r.profit>=0?K.profit:K.loss},children:a(Math.abs(r.profit))})]})]}),(r.dailyRevenue>0||r.dailyLabor>0||r.dailyMaterials>0||r.dailyHaulOff>0||r.dailyTM>0)&&e.jsxs("div",{className:"chart-tooltip-daily",children:[e.jsx("div",{className:"chart-tooltip-daily-label",children:"Today's Activity"}),r.dailyRevenue>0&&e.jsx("div",{className:"chart-tooltip-daily-row earned",children:e.jsxs("span",{style:{color:K.revenue},children:["Areas Completed: ",a(r.dailyRevenue)]})}),r.dailyLabor>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Labor: ",a(r.dailyLabor)]}),r.dailyMaterials>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Materials: ",a(r.dailyMaterials)]}),r.dailyHaulOff>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Disposal: ",a(r.dailyHaulOff)]}),r.dailyTM>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["T&M Added: ",a(r.dailyTM)]}),r.dailyTotal>0&&e.jsx("div",{className:"chart-tooltip-daily-row total",children:e.jsxs("strong",{children:["Day Costs: ",a(r.dailyTotal)]})})]}),e.jsx("div",{className:"chart-tooltip-hint",children:"Click to see details"})]})}function Zo({projectData:s,project:t,tmTickets:n=[],corStats:a=null,areas:r=[],onDrillDown:i}){const[l,o]=c.useState("30d"),[u,m]=c.useState(null),d=c.useMemo(()=>{const x=Yo(s,t,n,a,r),k=$a.find(T=>T.id===l);return Jo(x,k?.days)},[s,t,n,a,r,l]),p=c.useMemo(()=>qa(d,"costs"),[d]),v=c.useMemo(()=>qa(d,"revenue"),[d]),j=x=>{if(x?.activePayload?.[0]){const k=x.activePayload[0].payload;i?.(k.date,k)}},h=({trend:x})=>x.direction==="up"?e.jsx(ws,{size:14,className:"trend-icon up"}):x.direction==="down"?e.jsx(Cs,{size:14,className:"trend-icon down"}):e.jsx(Rt,{size:14,className:"trend-icon flat"});return d.length?e.jsxs("div",{className:"financial-trend-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[e.jsx("h3",{children:"Financial Trend"}),e.jsxs("div",{className:"chart-trend-indicators",children:[e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:K.revenue},children:"Revenue"}),e.jsx(h,{trend:v}),v.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[v.percentage,"%"]})]}),e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:K.costs},children:"Costs"}),e.jsx(h,{trend:p}),p.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[p.percentage,"%"]})]})]})]}),e.jsx("div",{className:"time-range-selector",children:$a.map(x=>e.jsx("button",{className:l===x.id?"active":"",onClick:()=>o(x.id),children:x.label},x.id))})]}),e.jsx("div",{className:"chart-container",children:e.jsx(Dt,{width:"100%",height:300,children:e.jsxs(ho,{data:d,onClick:j,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:Object.values(Lo).map(x=>e.jsxs("linearGradient",{id:x.id,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:x.color,stopOpacity:x.startOpacity}),e.jsx("stop",{offset:"95%",stopColor:x.color,stopOpacity:x.endOpacity})]},x.id))}),e.jsx(Qa,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Za,{dataKey:"date",tickFormatter:Tt,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(en,{tickFormatter:Ue,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:!1,width:60}),e.jsx(Et,{content:e.jsx(Qo,{})}),e.jsx(Xs,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,formatter:x=>e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:x})}),d[0]?.contract>0&&e.jsx(cn,{y:d[0].contract,stroke:K.contract,strokeDasharray:"5 5",strokeWidth:2,label:{value:"Contract",position:"right",fill:K.contract,fontSize:11}}),e.jsx(vs,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:K.revenue,strokeWidth:2,fill:"url(#revenueGradient)",animationDuration:fs.duration,onMouseEnter:()=>m("revenue"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="revenue"?.3:1}}),e.jsx(vs,{type:"monotone",dataKey:"costs",name:"Costs",stroke:K.costs,strokeWidth:2,fill:"url(#costsGradient)",animationDuration:fs.duration,onMouseEnter:()=>m("costs"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="costs"?.3:1}}),d.some(x=>x.tmValue>0)&&e.jsx(vs,{type:"monotone",dataKey:"tmValue",name:"T&M Value",stroke:K.tmValue,strokeWidth:2,fill:"url(#tmValueGradient)",animationDuration:fs.duration,onMouseEnter:()=>m("tmValue"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="tmValue"?.3:1}}),d.some(x=>x.corValue>0)&&e.jsx(vs,{type:"monotone",dataKey:"corValue",name:"COR Approved",stroke:K.corValue,strokeWidth:2,strokeDasharray:"4 2",fill:"transparent",animationDuration:fs.duration,onMouseEnter:()=>m("corValue"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="corValue"?.3:1}})]})})}),e.jsxs("div",{className:"chart-quick-stats",children:[e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Current Revenue"}),e.jsx("span",{className:"stat-value",style:{color:K.revenue},children:Ue(d[d.length-1]?.revenue||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Total Costs"}),e.jsx("span",{className:"stat-value",style:{color:K.costs},children:Ue(d[d.length-1]?.costs||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Margin"}),e.jsx("span",{className:"stat-value",style:{color:(d[d.length-1]?.profit||0)>=0?K.profit:K.loss},children:(()=>{const x=d[d.length-1];return!x||!x.revenue?"0%":`${((x.revenue-x.costs)/x.revenue*100).toFixed(1)}%`})()})]}),d[d.length-1]?.tmValue>0&&e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"T&M Pending"}),e.jsx("span",{className:"stat-value",style:{color:K.tmValue},children:Ue(d[d.length-1]?.tmValue||0)})]})]})]}):e.jsx("div",{className:"financial-trend-chart empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No financial data available yet."}),e.jsx("span",{children:"Start tracking labor and costs to see trends."})]})})}function ec({laborCost:s=0,haulOffCost:t=0,customCosts:n=[],onSegmentClick:a}){const[r,i]=c.useState(null),l=c.useMemo(()=>Xo(s,t,n),[s,t,n]),o=c.useMemo(()=>l.reduce((j,h)=>j+h.value,0),[l]),u=(j,h)=>{i(h)},m=()=>{i(null)},d=(j,h)=>{a&&a(l[h])},p=({active:j,payload:h})=>{if(!j||!h||!h.length)return null;const x=h[0].payload;return e.jsxs("div",{className:"chart-tooltip donut-tooltip",children:[e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:x.color}}),x.name]}),e.jsx("span",{className:"chart-tooltip-value",children:Ue(x.value)})]}),e.jsxs("div",{className:"donut-tooltip-pct",children:[x.percentage,"% of total costs"]}),x.items&&x.items.length>0&&e.jsx("div",{className:"donut-tooltip-items",children:e.jsxs("div",{className:"donut-tooltip-items-label",children:[x.items.length," item",x.items.length>1?"s":""]})}),a&&e.jsx("div",{className:"chart-tooltip-hint",children:"Click to view details"})]})},v=j=>{const{payload:h}=j;return e.jsx("div",{className:"donut-legend",children:h.map((x,k)=>e.jsxs("div",{className:`donut-legend-item ${r===k?"active":""}`,onMouseEnter:()=>i(k),onMouseLeave:()=>i(null),onClick:()=>d(null,k),children:[e.jsx("span",{className:"donut-legend-color",style:{backgroundColor:x.payload.color}}),e.jsx("span",{className:"donut-legend-name",children:x.value}),e.jsx("span",{className:"donut-legend-value",children:Ue(x.payload.value)})]},`legend-${k}`))})};return!l.length||o===0?e.jsx("div",{className:"cost-donut empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No cost data available."}),e.jsx("span",{children:"Add labor, disposal, or custom costs to see breakdown."})]})}):e.jsx("div",{className:"cost-donut",children:e.jsxs("div",{className:"donut-chart-container",children:[e.jsx(Dt,{width:"100%",height:200,children:e.jsxs(Di,{children:[e.jsx(Ei,{data:l,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",onMouseEnter:u,onMouseLeave:m,onClick:d,animationDuration:fs.duration,animationEasing:"ease-out",children:l.map((j,h)=>e.jsx(Ri,{fill:j.color,stroke:"var(--card-bg)",strokeWidth:2,style:{filter:r===h?"brightness(1.1)":"none",cursor:a?"pointer":"default",transform:r===h?"scale(1.05)":"scale(1)",transformOrigin:"center",transition:"all 0.2s ease"}},`cell-${h}`))}),e.jsx(Et,{content:e.jsx(p,{})}),e.jsx(Xs,{content:v})]})}),e.jsxs("div",{className:"donut-center-label",children:[e.jsx("span",{className:"donut-center-value",children:Ue(o)}),e.jsx("span",{className:"donut-center-text",children:"Total"})]})]})})}const Be=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0);function sc({revenue:s,totalCosts:t,contractValue:n,progress:a}){const r=s-t,i=s>0?r/s*100:0,l=n,o=a>0?t/(a/100):t,u=l-o,m=l>0?u/l*100:0,d=i>=20,p=i>=0&&i<20,v=i<0,j=d?"healthy":p?"warning":"loss",h=d?"On Track":p?"Watch Margin":"Over Cost",x=d?Ui:p?Ns:Cs;return e.jsxs("div",{className:`profitability-card ${j}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${j}`,children:[e.jsx(x,{size:14}),e.jsx("span",{children:h})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${i<0?"negative":""}`,children:[Math.round(i),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${i<0?"negative":i<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(i),100)}%`}})})]}),a>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${m<0?"negative":""}`,children:[Math.round(m),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${m<0?"negative":m<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(m),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:Be(s)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",Be(t)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${r<0?"negative":"positive"}`,children:[r>=0?"":"-",Be(Math.abs(r))]})]})]}),a>10&&e.jsxs("div",{className:"profitability-insight",children:[d&&e.jsxs("p",{children:["At ",Math.round(a),"% complete, you're at ",Be(r)," profit.",u>0&&` Projected final profit: ${Be(u)}`]}),p&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",u<0&&` Trending toward ${Be(u)} loss.`]}),v&&e.jsxs("p",{children:["Currently over cost by ",Be(Math.abs(r)),". Immediate review recommended."]})]})]})}const xt=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Vs={labor:{label:"Labor",Icon:He,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Ge,color:"#10b981"},equipment:{label:"Equipment",Icon:jt,color:"#f59e0b"},materials:{label:"Materials",Icon:Bs,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:Re,color:"#ec4899"},other:{label:"Other",Icon:Hi,color:"#6b7280"}};function tc({laborCost:s=0,haulOffCost:t=0,customCosts:n=[],onAddCost:a,onDeleteCost:r}){const[i,l]=c.useState(!0),[o,u]=c.useState(null),m=[];s>0&&m.push({category:"labor",label:"Labor",amount:s,source:"auto",description:"From crew check-ins"}),t>0&&m.push({category:"disposal",label:"Disposal",amount:t,source:"auto",description:"From haul-off logs"});const d={};n.forEach(h=>{d[h.category]||(d[h.category]={category:h.category,items:[],total:0}),d[h.category].items.push(h),d[h.category].total+=parseFloat(h.amount)||0}),Object.values(d).forEach(h=>{const x=Vs[h.category]||Vs.other;m.push({category:h.category,label:x.label,amount:h.total,source:"manual",items:h.items})});const p=m.reduce((h,x)=>h+x.amount,0);m.forEach(h=>{h.percentage=p>0?h.amount/p*100:0}),m.sort((h,x)=>x.amount-h.amount);const v=h=>{u(o===h?null:h)},j=h=>{h.items&&h.items.length>0&&(l(!1),u(h.category))};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsxs("div",{className:"cost-contributors-title",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:xt(p)})]}),m.length>0&&e.jsxs("div",{className:"cost-view-toggle",children:[e.jsx("button",{className:i?"active":"",onClick:()=>l(!0),children:"Chart"}),e.jsx("button",{className:i?"":"active",onClick:()=>l(!1),children:"List"})]})]}),m.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):i?e.jsx(ec,{laborCost:s,haulOffCost:t,customCosts:n,onSegmentClick:j}):e.jsx("div",{className:"cost-breakdown",children:m.map(h=>{const x=Vs[h.category]||Vs.other,k=x.Icon,T=h.items&&h.items.length>0,g=o===h.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${T?"expandable":""}`,onClick:()=>T&&v(h.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(h.percentage,2)}%`,backgroundColor:x.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(k,{size:14,style:{color:x.color}}),e.jsx("span",{children:h.label}),h.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),T&&(g?e.jsx(Js,{size:14}):e.jsx(Je,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:xt(h.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(h.percentage),"%"]})]})]})]}),g&&T&&e.jsx("div",{className:"cost-category-items",children:h.items.map(F=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:F.description}),e.jsx("span",{className:"cost-item-date",children:new Date(F.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:xt(F.amount)}),r&&e.jsx("button",{className:"cost-item-delete",onClick:f=>{f.stopPropagation(),confirm("Delete this cost entry?")&&r(F.id)},children:e.jsx(on,{size:14})})]})]},F.id))})]},h.category)})}),a&&e.jsxs("button",{className:"cost-add-btn",onClick:a,children:[e.jsx(bs,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const gn=[{value:"concrete",label:"Concrete",icon:"🧱"},{value:"trash",label:"Trash",icon:"🗑️"},{value:"metals",label:"Metals",icon:"🔩"},{value:"hazardous_waste",label:"Hazardous",icon:"☣️"}],ac=s=>gn.find(t=>t.value===s)||{label:s,icon:"📦"};function nc({project:s,period:t="week"}){const[n,a]=c.useState([]),[r,i]=c.useState(!0),[l,o]=c.useState(!1);c.useEffect(()=>{s?.id&&u()},[s?.id,t]);const u=async()=>{try{i(!0);const h=t==="week"?7:t==="month"?30:14,x=await q.getDisposalLoadsHistory(s.id,h);a(x||[])}catch(h){console.error("Error loading disposal summary:",h)}finally{i(!1)}},m=n.reduce((h,x)=>{const k=x.load_type;return h[k]||(h[k]=0),h[k]+=x.load_count,h},{}),d=n.reduce((h,x)=>{const k=x.load_date||x.work_date;return h[k]||(h[k]={date:k,loads:[],total:0}),h[k].loads.push(x),h[k].total+=x.load_count,h},{}),p=Object.values(d).sort((h,x)=>new Date(x.date)-new Date(h.date)).slice(0,7),v=n.reduce((h,x)=>h+x.load_count,0),j=v>0;return r?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Ge,{size:18}),e.jsx("span",{children:"Disposal Loads"})]})}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Ge,{size:18}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("span",{className:"period-badge",children:t==="week"?"Last 7 days":t==="month"?"Last 30 days":"Last 14 days"})]}),j?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"disposal-total-value",children:v}),e.jsx("span",{className:"disposal-total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:gn.map(h=>{const x=m[h.value]||0;if(x===0)return null;const k=Math.round(x/v*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"disposal-type-info",children:[e.jsx("span",{className:"disposal-type-icon",children:h.icon}),e.jsx("span",{className:"disposal-type-label",children:h.label})]}),e.jsxs("div",{className:"disposal-type-stats",children:[e.jsx("span",{className:"disposal-type-count",children:x}),e.jsx("div",{className:"disposal-type-bar",children:e.jsx("div",{className:"disposal-type-bar-fill",style:{width:`${k}%`}})})]})]},h.value)})}),p.length>0&&e.jsxs("button",{className:"disposal-expand-btn",onClick:()=>o(!l),children:[l?e.jsx(Js,{size:16}):e.jsx(Je,{size:16}),e.jsxs("span",{children:[l?"Hide":"View"," Daily Breakdown"]})]}),l&&p.length>0&&e.jsx("div",{className:"disposal-daily-breakdown",children:p.map(h=>{const x=new Date(h.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),k=h.loads.reduce((T,g)=>(T[g.load_type]||(T[g.load_type]=0),T[g.load_type]+=g.load_count,T),{});return e.jsxs("div",{className:"disposal-daily-row",children:[e.jsxs("div",{className:"disposal-daily-header",children:[e.jsx("span",{className:"disposal-daily-date",children:x}),e.jsxs("span",{className:"disposal-daily-total",children:[h.total," loads"]})]}),e.jsx("div",{className:"disposal-daily-types",children:Object.entries(k).map(([T,g])=>{const F=ac(T);return e.jsxs("span",{className:"disposal-daily-type",children:[F.icon," ",g]},T)})})]},h.date)})})]}):e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx(Ge,{size:32}),e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("span",{className:"text-muted",children:"Loads will appear here when logged by field crews"})]})]})}const vt=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",rc=c.memo(function({project:t,onAddEquipment:n,onEditEquipment:a,onShowToast:r}){const[i,l]=c.useState([]),[o,u]=c.useState(!0),[m,d]=c.useState(!0),[p,v]=c.useState(0),j=c.useCallback(async()=>{if(t?.id)try{u(!0);const g=await ss.getProjectEquipment(t.id);l(g||[]);const F=ss.calculateProjectEquipmentCost(g||[]);v(F)}catch(g){console.error("Error loading equipment:",g),r?.("Failed to load equipment","error")}finally{u(!1)}},[t?.id]);c.useEffect(()=>{j()},[j]);const h=c.useCallback(async g=>{try{await ss.markEquipmentReturned(g.id),r?.(`${g.equipment_name} marked as returned`,"success"),j()}catch(F){console.error("Error marking equipment returned:",F),r?.("Failed to update equipment","error")}},[j]),x=c.useCallback(async g=>{if(confirm(`Remove ${g.equipment_name} from this project?`))try{await ss.removeEquipmentFromProject(g.id),r?.("Equipment removed","success"),j()}catch(F){console.error("Error removing equipment:",F),r?.("Failed to remove equipment","error")}},[j]),k=c.useMemo(()=>i.filter(g=>!g.end_date),[i]),T=c.useMemo(()=>i.filter(g=>g.end_date),[i]);return e.jsxs("div",{className:"project-equipment-card",children:[e.jsxs("div",{className:"project-equipment-header",children:[e.jsxs("div",{className:"project-equipment-title",children:[e.jsx(Ge,{size:18}),e.jsx("h3",{children:"Equipment on Site"}),i.length>0&&e.jsxs("span",{className:"equipment-count",children:[k.length," active"]})]}),e.jsxs("div",{className:"project-equipment-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>n?.(),title:"Add equipment",children:[e.jsx(bs,{size:14}),e.jsx("span",{children:"Add"})]}),i.length>0&&e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>d(!m),children:m?e.jsx(Js,{size:16}):e.jsx(Je,{size:16})})]})]}),o?e.jsx("div",{className:"equipment-loading",children:e.jsx("div",{className:"loading-spinner small"})}):i.length===0?e.jsxs("div",{className:"equipment-empty",children:[e.jsx("p",{children:"No equipment tracked on this project"}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>n?.(),children:[e.jsx(bs,{size:14}),"Track Equipment"]})]}):m?e.jsxs(e.Fragment,{children:[k.length>0&&e.jsx("div",{className:"equipment-list",children:k.map(g=>{const F=ss.calculateDaysOnSite(g.start_date,g.end_date),f=g.daily_rate*F;return e.jsxs("div",{className:"equipment-item active",children:[e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:g.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[e.jsx(Ys,{size:12}),"On-site since ",vt(g.start_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-rate",children:[Ne(g.daily_rate),"/day"]}),e.jsxs("span",{className:"equipment-days",children:[F," days"]}),e.jsx("span",{className:"equipment-total",children:Ne(f)})]})]}),e.jsxs("div",{className:"equipment-item-actions",children:[e.jsxs("button",{className:"btn btn-xs btn-outline",onClick:()=>h(g),title:"Mark as returned",children:[e.jsx(Gi,{size:12}),"Returned"]}),e.jsx("button",{className:"btn btn-xs btn-ghost",onClick:()=>a?.(g),title:"Edit",children:e.jsx(Ki,{size:12})}),e.jsx("button",{className:"btn btn-xs btn-ghost text-danger",onClick:()=>x(g),title:"Remove",children:e.jsx(on,{size:12})})]})]},g.id)})}),T.length>0&&e.jsxs("details",{className:"equipment-returned-section",children:[e.jsx("summary",{className:"equipment-returned-toggle",children:e.jsxs("span",{children:["Returned Equipment (",T.length,")"]})}),e.jsx("div",{className:"equipment-list returned",children:T.map(g=>{const F=ss.calculateDaysOnSite(g.start_date,g.end_date),f=g.daily_rate*F;return e.jsx("div",{className:"equipment-item returned",children:e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:g.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[vt(g.start_date)," - ",vt(g.end_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-days",children:[F," days"]}),e.jsx("span",{className:"equipment-total",children:Ne(f)})]})]})},g.id)})})]}),e.jsxs("div",{className:"equipment-total-row",children:[e.jsx("span",{children:"Total Equipment Cost"}),e.jsx("span",{className:"equipment-grand-total",children:Ne(p)})]})]}):e.jsxs("div",{className:"equipment-summary-collapsed",children:[e.jsxs("span",{children:[k.length," active, ",T.length," returned"]}),e.jsx("span",{className:"equipment-grand-total",children:Ne(p)})]})]})}),ic=c.memo(function({project:t,areas:n=[],corStats:a={},onCreateDraw:r,onViewDraw:i,onShowToast:l}){const[o,u]=c.useState([]),[m,d]=c.useState(!0),p=c.useMemo(()=>n.reduce((f,y)=>{const A=(y.square_footage||0)*(y.price_per_sqft||0);return f+Math.round(A*100)},0),[n]),v=c.useMemo(()=>a?.approvedTotal||0,[a?.approvedTotal]),j=p+v,h=c.useCallback(async()=>{if(t?.id)try{d(!0);const f=await Pi.getProjectDrawRequests(t.id);u(f||[])}catch(f){console.error("Error loading draw requests:",f)}finally{d(!1)}},[t?.id]);c.useEffect(()=>{h()},[h]);const x=c.useMemo(()=>{const f=o.filter(S=>["submitted","approved","paid"].includes(S.status)),y=f.reduce((S,_)=>S+(_.previous_billings||0)+(_.current_billing||0),0),$=f[0]?.retention_held||0;return{billedToDate:y,retentionHeld:$}},[o]),k=j>0?Math.round(x.billedToDate/j*100):0,T=o.length>0?Math.max(...o.map(f=>f.draw_number))+1:1,g=f=>f?new Date(f).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",F=f=>{switch(f){case"draft":return e.jsx("span",{className:"badge badge-muted",children:"Draft"});case"submitted":return e.jsx("span",{className:"badge badge-warning",children:"Submitted"});case"approved":return e.jsx("span",{className:"badge badge-success",children:"Approved"});case"paid":return e.jsx("span",{className:"badge badge-info",children:"Paid"});case"rejected":return e.jsx("span",{className:"badge badge-danger",children:"Rejected"});default:return null}};return e.jsxs("div",{className:"progress-billing-card",children:[e.jsxs("div",{className:"progress-billing-header",children:[e.jsxs("div",{className:"progress-billing-title",children:[e.jsx(Yi,{size:18}),e.jsx("h3",{children:"Progress Billing"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>r?.(),disabled:p===0,title:p===0?"Add areas with contract values first":`Create Draw #${T}`,children:[e.jsx(bs,{size:14}),e.jsxs("span",{children:["Draw #",T]})]})]}),e.jsxs("div",{className:"progress-billing-contract",children:[e.jsxs("div",{className:"contract-row",children:[e.jsx("span",{className:"contract-label",children:"Original Contract"}),e.jsx("span",{className:"contract-value",children:Ne(p)})]}),v>0&&e.jsxs("div",{className:"contract-row co",children:[e.jsx("span",{className:"contract-label",children:"Approved COs"}),e.jsxs("span",{className:"contract-value positive",children:["+",Ne(v)]})]}),e.jsxs("div",{className:"contract-row revised",children:[e.jsx("span",{className:"contract-label",children:"Revised Contract"}),e.jsx("span",{className:"contract-value",children:Ne(j)})]})]}),e.jsxs("div",{className:"progress-billing-status",children:[e.jsx("div",{className:"billing-progress-bar",children:e.jsx("div",{className:"billing-progress-fill",style:{width:`${Math.min(k,100)}%`}})}),e.jsxs("div",{className:"billing-stats",children:[e.jsxs("div",{className:"billing-stat",children:[e.jsx("span",{className:"billing-stat-value",children:Ne(x.billedToDate)}),e.jsxs("span",{className:"billing-stat-label",children:["Billed to Date (",k,"%)"]})]}),x.retentionHeld>0&&e.jsxs("div",{className:"billing-stat retention",children:[e.jsxs("span",{className:"billing-stat-value",children:["-",Ne(x.retentionHeld)]}),e.jsx("span",{className:"billing-stat-label",children:"Retention Held"})]}),e.jsxs("div",{className:"billing-stat remaining",children:[e.jsx("span",{className:"billing-stat-value",children:Ne(j-x.billedToDate)}),e.jsx("span",{className:"billing-stat-label",children:"Balance to Finish"})]})]})]}),m?e.jsx("div",{className:"progress-billing-loading",children:e.jsx("div",{className:"loading-spinner small"})}):o.length===0?e.jsxs("div",{className:"progress-billing-empty",children:[e.jsx("p",{children:"No draw requests yet"}),p>0&&e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>r?.(),children:[e.jsx(bs,{size:14}),"Create First Draw Request"]})]}):e.jsxs("div",{className:"progress-billing-draws",children:[e.jsx("div",{className:"draws-header",children:e.jsx("span",{children:"Recent Draws"})}),e.jsx("div",{className:"draws-list",children:o.slice(0,3).map(f=>e.jsxs("button",{className:"draw-item",onClick:()=>i?.(f),children:[e.jsxs("div",{className:"draw-item-info",children:[e.jsxs("span",{className:"draw-number",children:["Draw #",f.draw_number]}),e.jsx("span",{className:"draw-date",children:g(f.period_end||f.created_at)})]}),e.jsx("div",{className:"draw-item-amount",children:Ne(f.current_billing||0)}),F(f.status),e.jsx(Le,{size:16,className:"draw-item-arrow"})]},f.id))}),o.length>3&&e.jsxs("button",{className:"btn btn-sm btn-ghost view-all-draws",children:["View all ",o.length," draws"]})]})]})});function lc({project:s,company:t,onShowToast:n}){const[a,r]=c.useState(null),[i,l]=c.useState(!0),[o,u]=c.useState(!1);c.useEffect(()=>{if(s?.id&&t?.id){m();const h=q.subscribeToCrewCheckins?.(s.id,()=>{m()});return()=>{h&&q.unsubscribe?.(h)}}},[s?.id,t?.id]);const m=async()=>{try{const h=await q.calculateManDayCosts(s.id,t.id,s.work_type||"demolition",s.job_type||"standard");r(h)}catch(h){console.error("Error loading man day costs:",h)}finally{l(!1)}},d=h=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(h),p=h=>new Date(h).toLocaleDateString("en-US",{month:"short",day:"numeric"}),v=h=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[h]||h.charAt(0).toUpperCase()+h.slice(1);if(i)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!a||a.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(He,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const j=Object.entries(a.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>u(!o),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:d(a.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:o?"▼ Collapse":"▶ Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:d(a.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.daysWorked>0?d(a.totalCost/a.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),o&&e.jsxs("div",{className:"man-day-details",children:[j.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:j.map(([h,x])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:v(h)}),e.jsxs("span",{className:"role-rate",children:[d(x.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[x.count," days"]}),e.jsx("span",{className:"role-cost",children:d(x.cost)})]})]},h))})]}),a.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:a.byDate.slice(0,7).map((h,x)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:p(h.date)}),e.jsxs("span",{className:"date-workers",children:[h.workers," crew"]}),e.jsx("span",{className:"date-cost",children:d(h.cost)})]},x))}),a.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",a.byDate.length-7," more days"]})]})]})]})}const $e=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),oc=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"});function cc({dailyBurn:s,totalBurn:t,daysWorked:n,laborCost:a,materialsEquipmentCost:r=0,progress:i,contractValue:l,laborByDate:o=[],materialsEquipmentByDate:u=[]}){const[m,d]=c.useState(!1),p=l*(i/100)*.6,v=t<=p?"on-budget":t<=p*1.2?"warning":"over-budget",j={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[v],h=v==="on-budget"?Cs:v==="warning"?Rt:ws,k=i>0?t/(i/100):0,T=[],g={};o.forEach(f=>{g[f.date]||(g[f.date]={date:f.date,labor:0,materialsEquipment:0,total:0}),g[f.date].labor=f.cost||0,g[f.date].total+=f.cost||0}),u.forEach(f=>{g[f.date]||(g[f.date]={date:f.date,labor:0,materialsEquipment:0,total:0}),g[f.date].materialsEquipment=f.cost||0,g[f.date].total+=f.cost||0}),Object.values(g).sort((f,y)=>new Date(y.date)-new Date(f.date)).slice(0,10).forEach(f=>T.push(f));const F=Math.max(...T.map(f=>f.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(Ji,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${v}`,children:[e.jsx(h,{size:14}),e.jsx("span",{children:j})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:$e(s)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),n>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",n," work day",n!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:$e(t)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:$e(a)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Materials"}),e.jsx("span",{className:"burn-summary-value",children:$e(r)})]})]}),i>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${k>l*.7?"warning":""}`,children:$e(k)})]}),T.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>d(!m),children:[m?e.jsx(Js,{size:16}):e.jsx(Je,{size:16}),e.jsxs("span",{children:[m?"Hide":"View"," Daily Breakdown"]})]}),m&&T.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Materials"}),e.jsx("span",{children:"Total"})]}),T.map(f=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:oc(f.date)}),e.jsx("span",{className:"burn-labor",children:f.labor>0?$e(f.labor):"-"}),e.jsx("span",{className:"burn-materials",children:f.materialsEquipment>0?$e(f.materialsEquipment):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${f.total/F*100}%`}}),e.jsx("span",{className:"burn-amount",children:$e(f.total)})]})]},f.date))]})]})}const dc=()=>ne(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]);function bn({project:s,company:t,onShowToast:n}){const{branding:a}=sn(),[r,i]=c.useState([]),[l,o]=c.useState(!0),[u,m]=c.useState(null),[d,p]=c.useState(null),[v,j]=c.useState(new Set),[h,x]=c.useState(!1),[k,T]=c.useState("recent"),[g,F]=c.useState(new Set),[f,y]=c.useState({start:"",end:""});c.useEffect(()=>{A();const b=q.subscribeToDailyReports?.(s.id,()=>{A()});return()=>{b&&q.unsubscribe?.(b)}},[s.id]);const A=c.useCallback(async()=>{try{m(null);const b=await q.getDailyReports(s.id,365);i(b||[])}catch(b){console.error("Error loading daily reports:",b),m(b),n?.("Error loading daily reports","error")}finally{o(!1)}},[s.id]),$=c.useMemo(()=>{let b=[...r];if(f.start){const w=new Date(f.start);w.setHours(0,0,0,0),b=b.filter(G=>new Date(G.report_date||G.created_at)>=w)}if(f.end){const w=new Date(f.end);w.setHours(23,59,59,999),b=b.filter(G=>new Date(G.report_date||G.created_at)<=w)}if(k==="recent"){const w=new Date;w.setDate(w.getDate()-7),w.setHours(0,0,0,0),b=b.filter(G=>new Date(G.report_date||G.created_at)>=w)}return b},[r,k,f]),S=c.useMemo(()=>{if(k!=="all")return null;const b={};return $.forEach(w=>{const G=new Date(w.report_date||w.created_at),E=`${G.getFullYear()}-${String(G.getMonth()+1).padStart(2,"0")}`,Y=G.toLocaleDateString("en-US",{month:"long",year:"numeric"});b[E]||(b[E]={label:Y,reports:[]}),b[E].reports.push(w)}),Object.entries(b).sort((w,G)=>G[0].localeCompare(w[0]))},[$,k]);c.useEffect(()=>{if(S&&S.length>0){const b=S[0][0];F(new Set([b]))}},[S]);const _=()=>{x(!h),h&&j(new Set)},P=b=>{const w=new Set(v);w.has(b)?w.delete(b):w.add(b),j(w)},L=()=>{v.size===$.length?j(new Set):j(new Set($.map(b=>b.id)))},O=b=>{const w=new Set(g);w.has(b)?w.delete(b):w.add(b),F(w)},V=()=>v.size>0?$.filter(b=>v.has(b.id)):$,R=b=>new Date(b).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),X=b=>new Date(b).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),I=b=>{switch(b){case"submitted":return"✓";case"reviewed":return"✓✓";case"draft":return"○";default:return"○"}},re=b=>{switch(b){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return b}},me=async()=>{const b=V();if(b.length===0){n?.("No reports to export","error");return}n?.("Generating PDF...","info");const G=(await dc()).default,E=new G,Y=E.internal.pageSize.getWidth(),J=20;let se=J;const De=js(a?.primary_color||"#3B82F6"),Xe=js(a?.secondary_color||"#1E40AF");E.setFillColor(...De),E.rect(0,0,Y,45,"F"),E.setFillColor(...Xe),E.rect(0,42,Y,3,"F");let Pe=J;if(a?.logo_url)try{const ee=await tn(a.logo_url);ee&&(E.addImage(ee,"PNG",J,7,30,30),Pe=J+40)}catch(ee){console.error("Error adding logo:",ee)}E.setTextColor(255,255,255),E.setFontSize(22),E.setFont("helvetica","bold"),E.text(t?.name||"Company Name",Pe,20),E.setFontSize(10),E.setFont("helvetica","normal"),E.text("DAILY REPORTS SUMMARY",Pe,30),E.setFontSize(9),E.text(`Generated: ${new Date().toLocaleDateString()}`,Y-J,20,{align:"right"}),s.job_number&&E.text(`Job #: ${s.job_number}`,Y-J,28,{align:"right"}),se=55,E.setFillColor(248,250,252),E.rect(J,se-5,Y-J*2,20,"F"),E.setTextColor(...De),E.setFontSize(14),E.setFont("helvetica","bold"),E.text(`Project: ${s.name}`,J+5,se+7),E.setFontSize(10),E.setTextColor(100,100,100),E.text(`${b.length} Report${b.length!==1?"s":""}`,Y-J-5,se+7,{align:"right"}),se+=25,b.forEach((ee,ve)=>{se>250&&(E.addPage(),se=J),E.setFillColor(...De),E.setTextColor(255,255,255),E.rect(J,se,Y-J*2,10,"F"),E.setFontSize(11),E.setFont("helvetica","bold"),E.text(R(ee.report_date||ee.created_at),J+5,se+7),E.text(re(ee.status),Y-J-5,se+7,{align:"right"}),se+=15,E.setTextColor(50,50,50),E.setFontSize(10),E.setFont("helvetica","normal");const Ss=`Crew: ${ee.crew_count||0}  |  Tasks: ${ee.tasks_completed||0}  |  T&M: ${ee.tm_tickets_count||0}  |  Photos: ${ee.photos_count||0}`;if(E.text(Ss,J+5,se),se+=8,ee.crew_list?.length>0){E.setFont("helvetica","bold"),E.text("Crew:",J+5,se),E.setFont("helvetica","normal");const fe=ee.crew_list.map(Es=>`${Es.name} (${Es.role})`).join(", "),Ds=E.splitTextToSize(fe,Y-J*2-30);E.text(Ds,J+25,se),se+=Ds.length*5+3}if(ee.field_notes){E.setFont("helvetica","bold"),E.text("Notes:",J+5,se),E.setFont("helvetica","normal");const fe=E.splitTextToSize(ee.field_notes,Y-J*2-30);E.text(fe,J+25,se),se+=fe.length*5+3}if(ee.issues){E.setTextColor(180,50,50),E.setFont("helvetica","bold"),E.text("Issues:",J+5,se),E.setFont("helvetica","normal");const fe=E.splitTextToSize(ee.issues,Y-J*2-30);E.text(fe,J+25,se),E.setTextColor(50,50,50),se+=fe.length*5+3}se+=10});const Z=E.internal.getNumberOfPages();for(let ee=1;ee<=Z;ee++)E.setPage(ee),E.setFontSize(8),E.setTextColor(150,150,150),E.text(`Page ${ee} of ${Z}`,Y/2,E.internal.pageSize.getHeight()-10,{align:"center"});const Qe=`${s.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;E.save(Qe),n?.("PDF exported!","success")},le=b=>e.jsxs("div",{className:`daily-report-card ${b.status} ${v.has(b.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>p(d===b.id?null:b.id),children:[h&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:v.has(b.id),onChange:w=>{w.stopPropagation(),P(b.id)},onClick:w=>w.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:R(b.report_date||b.created_at)}),e.jsxs("span",{className:`report-status ${b.status}`,children:[I(b.status)," ",re(b.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[b.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[b.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:d===b.id?"▼":"▶"})]})]}),d===b.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),b.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:b.crew_list.map((w,G)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:w.name}),e.jsx("span",{className:"crew-role",children:w.role})]},G))})]}),b.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:b.completed_tasks.map((w,G)=>e.jsxs("li",{children:[w.name,w.group&&e.jsx("span",{className:"task-group",children:w.group})]},G))})]}),b.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:b.field_notes})]}),b.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:b.issues})]}),b.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",b.submitted_by||"Field"," at ",X(b.submitted_at)]})})]})]},b.id);if(l)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});if(u)return e.jsx("div",{className:"daily-reports-list card",children:e.jsx(jn,{title:"Unable to load reports",message:"There was a problem loading daily reports. Please try again.",error:u,onRetry:A})});const Se=r.length,M=$.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:r.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${h?"btn-primary":"btn-secondary"}`,onClick:_,children:h?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:me,children:["PDF",v.size>0?` (${v.size})`:""]})]})})]}),r.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${k==="recent"?"active":""}`,onClick:()=>T("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${k==="all"?"active":""}`,onClick:()=>T("all"),children:["All (",Se,")"]})]}),k==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Ys,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:f.start,onChange:b=>y(w=>({...w,start:b.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:f.end,onChange:b=>y(w=>({...w,end:b.target.value})),className:"date-input"}),(f.start||f.end)&&e.jsx("button",{className:"date-clear",onClick:()=>y({start:"",end:""}),children:"Clear"})]})]}),h&&$.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:v.size===$.length&&$.length>0,onChange:L}),"Select All (",$.length,")"]}),v.size>0&&e.jsxs("span",{className:"selected-count",children:[v.size," selected"]})]}),r.length===0?e.jsx(La,{icon:xe,title:"No daily reports yet",message:"Reports from the field will appear here"}):$.length===0?e.jsx(La,{icon:xe,title:"No reports in this time period",message:k==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"}):k==="recent"?e.jsxs("div",{className:"daily-reports",children:[$.map(b=>le(b)),Se>M&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>T("all"),children:["View All ",Se," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:S?.map(([b,{label:w,reports:G}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>O(b),children:[g.has(b)?e.jsx(Je,{size:18,className:"month-chevron"}):e.jsx(Le,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:w}),e.jsxs("span",{className:"month-count",children:[G.length," report",G.length!==1?"s":""]})]}),g.has(b)&&e.jsx("div",{className:"month-reports",children:G.map(E=>le(E))})]},b))})]})}const uc=Object.freeze(Object.defineProperty({__proto__:null,default:bn},Symbol.toStringTag,{value:"Module"})),Va=c.memo(function({report:t,formatDate:n,formatTime:a,getInjuryTypeColor:r,getInjuryTypeLabel:i,getStatusColor:l,onViewDetails:o}){const u=()=>o(t),m=d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),o(t))};return e.jsxs("div",{className:"report-card",onClick:u,onKeyDown:m,role:"button",tabIndex:0,"aria-label":`Injury report for ${t.employee_name} on ${n(t.incident_date)}`,children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[n(t.incident_date)," at ",a(t.incident_time)]}),e.jsx("div",{className:"employee-name",children:t.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:r(t.injury_type)},children:i(t.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:l(t.status)},children:t.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",t.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",t.reported_by_name," (",t.reported_by_title,")"]}),t.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",t.body_part_affected]}),t.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[t.incident_description.substring(0,150),t.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]})}),mc=()=>ne(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]);function yn({project:s,companyId:t,company:n,user:a,onShowToast:r}){const{branding:i}=sn(),[l,o]=c.useState([]),[u,m]=c.useState(null),[d,p]=c.useState(!1),[v,j]=c.useState(!0),[h,x]=c.useState(null),[k,T]=c.useState(null),[g,F]=c.useState("recent"),[f,y]=c.useState(new Set),[A,$]=c.useState({start:"",end:""});c.useEffect(()=>{S();const M=t||s?.company_id,b=M?q.subscribeToInjuryReports?.(M,()=>{S()}):null;return()=>{b&&q.unsubscribe?.(b)}},[s?.id,t]);const S=c.useCallback(async()=>{j(!0),x(null);try{const M=s?await q.getInjuryReports(s.id):await q.getCompanyInjuryReports(t);o(M)}catch(M){console.error("Error loading injury reports:",M),x(M),T({type:"error",message:"Failed to load injury reports"})}finally{j(!1)}},[s?.id,t]),_=()=>{S(),p(!1),T({type:"success",message:"Injury report created successfully"})},P=M=>{m(M)},L=()=>{m(null)},O=M=>M?new Date(M).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",V=M=>M?new Date(`2000-01-01T${M}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",R=M=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[M]||M,X=M=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[M]||"#9ca3af",I=M=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[M]||"#9ca3af",re=c.useMemo(()=>{let M=[...l];if(A.start){const b=new Date(A.start);b.setHours(0,0,0,0),M=M.filter(w=>new Date(w.incident_date)>=b)}if(A.end){const b=new Date(A.end);b.setHours(23,59,59,999),M=M.filter(w=>new Date(w.incident_date)<=b)}if(g==="recent"){const b=new Date;b.setDate(b.getDate()-7),b.setHours(0,0,0,0),M=M.filter(w=>new Date(w.incident_date)>=b)}return M},[l,g,A]),me=c.useMemo(()=>{if(g!=="all")return null;const M={};return re.forEach(b=>{const w=new Date(b.incident_date),G=`${w.getFullYear()}-${String(w.getMonth()+1).padStart(2,"0")}`,E=w.toLocaleDateString("en-US",{month:"long",year:"numeric"});M[G]||(M[G]={label:E,reports:[]}),M[G].reports.push(b)}),Object.entries(M).sort((b,w)=>w[0].localeCompare(b[0]))},[re,g]);c.useEffect(()=>{if(me&&me.length>0){const M=me[0][0];y(new Set([M]))}},[me]);const le=M=>{const b=new Set(f);b.has(M)?b.delete(M):b.add(M),y(b)},Se=async()=>{if(l.length===0){T({type:"error",message:"No reports to export"});return}T({type:"info",message:"Generating PDF..."});const b=(await mc()).default,w=new b,G=w.internal.pageSize.getWidth(),E=20;let Y=E;const J=js(i?.primary_color||"#3B82F6"),se=js(i?.secondary_color||"#1E40AF");w.setFillColor(...J),w.rect(0,0,G,45,"F"),w.setFillColor(...se),w.rect(0,42,G,3,"F");let De=E;if(i?.logo_url)try{const Z=await tn(i.logo_url);Z&&(w.addImage(Z,"PNG",E,7,30,30),De=E+40)}catch(Z){console.error("Error adding logo:",Z)}w.setTextColor(255,255,255),w.setFontSize(22),w.setFont("helvetica","bold"),w.text(n?.name||"Company",De,20),w.setFontSize(10),w.setFont("helvetica","normal"),w.text("INJURY & INCIDENT REPORTS",De,30),w.setFontSize(9),w.text(`Generated: ${new Date().toLocaleDateString()}`,G-E,20,{align:"right"}),w.text(`Total Reports: ${l.length}`,G-E,28,{align:"right"}),Y=55,s&&(w.setFillColor(248,250,252),w.rect(E,Y-5,G-E*2,15,"F"),w.setTextColor(...J),w.setFontSize(12),w.setFont("helvetica","bold"),w.text(`Project: ${s.name}`,E+5,Y+5),Y+=20),l.forEach(Z=>{Y>200&&(w.addPage(),Y=E);const Qe=js(I(Z.injury_type));w.setFillColor(...Qe),w.rect(E,Y,G-E*2,12,"F"),w.setTextColor(255,255,255),w.setFontSize(11),w.setFont("helvetica","bold"),w.text(`${Z.employee_name} - ${R(Z.injury_type)}`,E+5,Y+8),w.text(O(Z.incident_date),G-E-5,Y+8,{align:"right"}),Y+=17,w.setTextColor(50,50,50),w.setFontSize(9),w.setFont("helvetica","normal"),w.text(`Location: ${Z.incident_location}`,E+5,Y),Z.incident_time&&w.text(`Time: ${V(Z.incident_time)}`,E+100,Y),Y+=6,w.setFont("helvetica","bold"),w.text("Description:",E+5,Y),w.setFont("helvetica","normal"),Y+=5;const ee=w.splitTextToSize(Z.incident_description,G-E*2-10);w.text(ee,E+5,Y),Y+=ee.length*4+3;const ve=[];Z.body_part_affected&&ve.push(`Body Part: ${Z.body_part_affected}`),Z.osha_recordable&&ve.push("OSHA Recordable"),Z.workers_comp_claim&&ve.push("Workers' Comp Filed"),Z.medical_treatment_required&&ve.push("Medical Treatment Required"),ve.length>0&&(w.setFontSize(8),w.setTextColor(100,100,100),w.text(ve.join("  |  "),E+5,Y),Y+=5),w.setFontSize(8),w.text(`Reported by: ${Z.reported_by_name} (${Z.reported_by_title})`,E+5,Y),Y+=12});const Xe=w.internal.getNumberOfPages();for(let Z=1;Z<=Xe;Z++)w.setPage(Z),w.setFontSize(8),w.setTextColor(150,150,150),w.text(`Page ${Z} of ${Xe}`,G/2,w.internal.pageSize.getHeight()-10,{align:"center"}),w.text("CONFIDENTIAL - Injury Report",E,w.internal.pageSize.getHeight()-10);const Pe=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;w.save(Pe),T({type:"success",message:"PDF exported!"})};return v?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):h?e.jsx("div",{className:"injury-reports-section card",children:e.jsx(jn,{title:"Unable to load reports",message:"There was a problem loading injury reports. Please try again.",error:h,onRetry:S})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[l.length>0&&e.jsx("button",{className:"btn-secondary",onClick:Se,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>p(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${g==="recent"?"active":""}`,onClick:()=>{F("recent"),$({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${g==="all"?"active":""}`,onClick:()=>F("all"),children:["All (",l.length,")"]})]}),g==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Ys,{size:16}),e.jsx("input",{type:"date",value:A.start,onChange:M=>$(b=>({...b,start:M.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:A.end,onChange:M=>$(b=>({...b,end:M.target.value})),placeholder:"End date"}),(A.start||A.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>$({start:"",end:""}),children:"Clear"})]})]}),re.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:"🏥"}),e.jsxs("h4",{children:["No Injury Reports",g==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),g==="recent"&&l.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>F("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:g==="all"&&me?me.map(([M,b])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>le(M),children:e.jsxs("div",{className:"month-header-left",children:[f.has(M)?e.jsx(Je,{size:18}):e.jsx(Le,{size:18}),e.jsx("span",{className:"month-label",children:b.label}),e.jsxs("span",{className:"month-count",children:[b.reports.length," reports"]})]})}),f.has(M)&&e.jsx("div",{className:"month-reports",children:b.reports.map(w=>e.jsx(Va,{report:w,formatDate:O,formatTime:V,getInjuryTypeColor:I,getInjuryTypeLabel:R,getStatusColor:X,onViewDetails:P},w.id))})]},M)):re.map(M=>e.jsx(Va,{report:M,formatDate:O,formatTime:V,getInjuryTypeColor:I,getInjuryTypeLabel:R,getStatusColor:X,onViewDetails:P},M.id))}),u&&e.jsx("div",{className:"modal-overlay",onClick:L,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:L,children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[O(u.incident_date)," at ",V(u.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:u.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:I(u.injury_type)},children:R(u.injury_type)})})]}),u.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:u.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:u.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:u.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:u.employee_job_title})]}),u.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:u.employee_phone})]}),u.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:u.employee_email})]}),u.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:u.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:u.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:u.reported_by_title})]}),u.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:u.reported_by_phone})]}),u.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:u.reported_by_email})]})]})]}),u.witnesses&&u.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),u.witnesses.map((M,b)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:M.name}),M.phone&&e.jsxs("span",{children:[" • ",M.phone]}),M.email&&e.jsxs("span",{children:[" • ",M.email]})]}),M.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',M.testimony,'"']})})]},b))]}),u.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[u.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:u.medical_facility_name})]}),u.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:u.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:u.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),u.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:u.immediate_actions_taken})]}),u.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:u.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[u.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:u.safety_equipment_used})]}),u.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:u.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:u.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:u.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:u.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:u.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",O(u.created_at)]})]})]})}),d&&e.jsx(Ti,{project:s,companyId:t,user:a,onClose:()=>p(!1),onReportCreated:_}),k&&e.jsx(Fi,{message:k.message,type:k.type,onClose:()=>T(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const hc=Object.freeze(Object.defineProperty({__proto__:null,default:yn},Symbol.toStringTag,{value:"Module"})),Ba=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function pc({project:s,company:t,user:n,isAdmin:a,onShowToast:r}){const[i,l]=c.useState([]),[o,u]=c.useState([]),[m,d]=c.useState(!0),[p,v]=c.useState(!1),[j,h]=c.useState(""),[x,k]=c.useState("Team Member"),[T,g]=c.useState(null);c.useEffect(()=>{s?.id&&F()},[s?.id]),c.useEffect(()=>{p&&t?.id&&f()},[p,t?.id]);const F=async()=>{try{d(!0);const S=await q.getProjectTeam(s.id);l(S)}catch(S){console.error("Error loading project team:",S)}finally{d(!1)}},f=async()=>{try{const S=await q.getCompanyMembers(t.id),_=i.map(L=>L.users?.id),P=S.filter(L=>!_.includes(L.users?.id));u(P)}catch(S){console.error("Error loading company members:",S)}},y=async()=>{if(!j){r("Select a team member","error");return}try{g("add"),await q.addProjectMember(s.id,j,x,n.id),r("Team member added","success"),v(!1),h(""),k("Team Member"),F()}catch(S){console.error("Error adding team member:",S),r("Error adding team member","error")}finally{g(null)}},A=async(S,_)=>{try{g(S.id),await q.updateProjectMemberRole(s.id,S.users?.id,_),r("Role updated","success"),F()}catch(P){console.error("Error updating role:",P),r("Error updating role","error")}finally{g(null)}},$=async S=>{try{g(S.id),await q.removeProjectMember(s.id,S.users?.id),r("Team member removed","success"),F()}catch(_){console.error("Error removing team member:",_),r("Error removing team member","error")}finally{g(null)}};return m?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Project Team"]}),a&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>v(!0),children:[e.jsx(Xi,{size:14})," Add"]})]}),i.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",a&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:i.map(S=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:S.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:S.users?.email})]}),e.jsx("div",{className:"team-member-role",children:a?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:S.project_role,onChange:_=>A(S,_.target.value),disabled:T===S.id,className:"role-select",children:Ba.map(_=>e.jsx("option",{value:_,children:_},_))}),e.jsx(Je,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:S.project_role})}),a&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>$(S),disabled:T===S.id,title:"Remove from project",children:e.jsx(Qi,{size:14})})]},S.id))}),p&&e.jsx("div",{className:"modal-overlay",onClick:()=>v(!1),children:e.jsxs("div",{className:"modal-content small",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>v(!1),children:e.jsx(os,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:j,onChange:S=>h(S.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),o.map(S=>e.jsx("option",{value:S.users?.id,children:S.users?.name||S.users?.email},S.users?.id))]}),o.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:x,onChange:S=>k(S.target.value),className:"form-select",children:Ba.map(S=>e.jsx("option",{value:S,children:S},S))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>v(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:y,disabled:!j||T==="add",children:T==="add"?"Adding...":"Add to Project"})]})]})})]})}function xc({onShowToast:s,onClose:t}){const[n,a]=c.useState("loading"),[r,i]=c.useState([]),[l,o]=c.useState(null),[u,m]=c.useState(null),[d,p]=c.useState(null),[v,j]=c.useState(""),[h,x]=c.useState(!1),[k,T]=c.useState(!1),[g,F]=c.useState(null);c.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:P,error:L}=await hs.auth.mfa.listFactors();if(L)throw L;const O=(P?.totp||[]).filter(V=>V.status==="verified");i(O),a("overview")}catch{a("overview")}},y=async()=>{F(null);try{const{data:P,error:L}=await hs.auth.mfa.enroll({factorType:"totp",friendlyName:"FieldSync Authenticator"});if(L)throw L;o(P.totp.qr_code),m(P.totp.secret),p(P.id),a("enroll")}catch(P){F(P.message),s?.("Failed to start MFA enrollment","error")}},A=async()=>{if(v.length===6){x(!0),F(null);try{const{data:P,error:L}=await hs.auth.mfa.challenge({factorId:d});if(L)throw L;const{error:O}=await hs.auth.mfa.verify({factorId:d,challengeId:P.id,code:v});if(O)throw O;a("success"),s?.("MFA enabled successfully!","success"),await f()}catch{F("Invalid code. Please try again."),j("")}finally{x(!1)}}},$=async P=>{try{const{error:L}=await hs.auth.mfa.unenroll({factorId:P});if(L)throw L;s?.("MFA disabled","success"),await f()}catch{s?.("Failed to disable MFA","error")}},S=()=>{navigator.clipboard.writeText(u),T(!0),setTimeout(()=>T(!1),2e3)},_=r.length>0;return e.jsxs("div",{className:"mfa-setup",children:[e.jsxs("div",{className:"mfa-header",children:[e.jsxs("div",{className:"mfa-title",children:[_?e.jsx(ht,{size:20,className:"text-success"}):e.jsx(gt,{size:20}),e.jsx("h3",{children:"Two-Factor Authentication"})]}),t&&e.jsx("button",{className:"close-btn",onClick:t,"aria-label":"Close",children:e.jsx(os,{size:20})})]}),n==="loading"&&e.jsxs("div",{className:"mfa-loading",children:[e.jsx(Ca,{size:24,className:"spinner"})," Loading..."]}),n==="overview"&&e.jsxs("div",{className:"mfa-overview",children:[e.jsx("p",{className:"mfa-description",children:"Add an extra layer of security to your account. When enabled, you will need to enter a code from your authenticator app each time you sign in."}),_?e.jsxs("div",{className:"mfa-status mfa-status-enabled",children:[e.jsx(ht,{size:18}),e.jsx("span",{children:"MFA is enabled"}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>$(r[0].id),children:[e.jsx(ka,{size:14})," Disable"]})]}):e.jsxs("div",{className:"mfa-status mfa-status-disabled",children:[e.jsx(ka,{size:18}),e.jsx("span",{children:"MFA is not enabled"}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:y,children:[e.jsx(gt,{size:14})," Enable MFA"]})]})]}),n==="enroll"&&e.jsxs("div",{className:"mfa-enroll",children:[e.jsx("p",{children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):"}),l&&e.jsx("div",{className:"mfa-qr-container",children:e.jsx("img",{src:l,alt:"MFA QR Code",className:"mfa-qr"})}),e.jsxs("div",{className:"mfa-secret",children:[e.jsx("span",{className:"mfa-secret-label",children:"Or enter this key manually:"}),e.jsxs("div",{className:"mfa-secret-value",children:[e.jsx("code",{children:u}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:S,"aria-label":"Copy secret key",children:k?e.jsx(rn,{size:14}):e.jsx(Zi,{size:14})})]})]}),e.jsxs("div",{className:"mfa-verify-section",children:[e.jsx("label",{htmlFor:"mfa-verify-code",children:"Enter the 6-digit code from your app:"}),e.jsxs("div",{className:"mfa-code-input",children:[e.jsx("input",{id:"mfa-verify-code",type:"text",value:v,onChange:P=>j(P.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,autoFocus:!0,inputMode:"numeric",pattern:"[0-9]*"}),e.jsx("button",{className:"btn btn-primary",onClick:A,disabled:v.length!==6||h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(Ca,{size:14,className:"spinner"})," Verifying..."]}):"Verify & Enable"})]}),g&&e.jsx("p",{className:"mfa-error",children:g})]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>a("overview"),children:"Cancel"})]}),n==="success"&&e.jsxs("div",{className:"mfa-success",children:[e.jsx(ht,{size:48,className:"text-success"}),e.jsx("h4",{children:"MFA Enabled"}),e.jsx("p",{children:"Your account is now protected with two-factor authentication."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>a("overview"),children:"Done"})]})]})}c.lazy(()=>ne(()=>import("./TMList-CN6nSl0q.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])));c.lazy(()=>ne(()=>import("./CORLogPreview-BgxyUa-h.js"),__vite__mapDeps([9,2,3,4,1,5,6,8])));c.lazy(()=>ne(()=>import("./CORList-DXli85C4.js"),__vite__mapDeps([10,1,2,3,4,5,6,8,11])));c.lazy(()=>ne(()=>import("./BillingCenter-DRBB9Q1u.js"),__vite__mapDeps([12,2,3,4,1,5,6,8])));c.lazy(()=>ne(()=>Promise.resolve().then(()=>uc),void 0));c.lazy(()=>ne(()=>Promise.resolve().then(()=>hc),void 0));const vc=c.lazy(()=>ne(()=>import("./ShareModal-Ddtr0HjW.js"),__vite__mapDeps([13,2,3,4,1,5,6]))),fc=c.lazy(()=>ne(()=>import("./NotificationSettings-gt9Jw8f6.js"),__vite__mapDeps([14,2,3,4,1,5,6]))),jc=c.lazy(()=>ne(()=>import("./CORForm-DXEtRzoc.js"),__vite__mapDeps([15,2,3,4,1,5,6,8]))),gc=c.lazy(()=>ne(()=>import("./CORDetail-B8SwJfm4.js"),__vite__mapDeps([16,2,3,4,1,5,6,8,17,7]))),bc=c.lazy(()=>ne(()=>import("./CORLog-DQBLTyEo.js").then(s=>s.a),__vite__mapDeps([11,1,2,3,4,5,6,8]))),yc=c.lazy(()=>ne(()=>import("./DrawRequestModal-lmdqGmEl.js"),__vite__mapDeps([18,2,3,4,1,5,6,8]))),Nc=c.lazy(()=>ne(()=>import("./EquipmentModal-BPgYueNn.js"),__vite__mapDeps([19,2,3,4,1,5,6]))),wc=c.lazy(()=>ne(()=>import("./AddCostModal-Q_cgwcyy.js"),__vite__mapDeps([20,2,3,4,1,5,6]))),Cc=c.lazy(()=>ne(()=>import("./DocumentsTab-CbmwkLSB.js"),__vite__mapDeps([21,2,3,4,1,5,6]))),kc=c.lazy(()=>ne(()=>import("./CORLogPreview-BgxyUa-h.js"),__vite__mapDeps([9,2,3,4,1,5,6,8]))),_c=c.lazy(()=>ne(()=>import("./CORList-DXli85C4.js"),__vite__mapDeps([10,1,2,3,4,5,6,8,11]))),Sc=c.lazy(()=>ne(()=>import("./TMList-CN6nSl0q.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Dc=c.lazy(()=>ne(()=>import("./BillingCenter-DRBB9Q1u.js"),__vite__mapDeps([12,2,3,4,1,5,6,8])));function Ec({company:s,user:t,isAdmin:n,onShowToast:a,navigateToProjectId:r,onProjectNavigated:i}){const[l,o]=c.useState([]),[u,m]=c.useState([]),[d,p]=c.useState(null),[v,j]=c.useState([]),[h,x]=c.useState(!0),[k,T]=c.useState(!1),[g,F]=c.useState(!1),[f,y]=c.useState("overview"),[A,$]=c.useState("overview"),[S,_]=c.useState(!0),[P,L]=c.useState(!1),[O,V]=c.useState(!1),[R,X]=c.useState("list"),[I,re]=c.useState("preview"),[me,le]=c.useState([]),[Se,M]=c.useState(!1),[b,w]=c.useState(null),[G,E]=c.useState(!1),[Y,J]=c.useState(null),[se,De]=c.useState(0),[Xe,Pe]=c.useState(!1),[Z,Qe]=c.useState(!1),[ee,ve]=c.useState(!1),[Ss,fe]=c.useState(null),[Ds,Es]=c.useState(0),[Nn,Rs]=c.useState(!1),[Ft,Ps]=c.useState(null),[wn,Cn]=c.useState(0),{isOpen:kn,setIsOpen:_n,close:Sn}=Oo(),{portfolioMetrics:Dn,projectHealth:En,scheduleMetrics:Rn,riskAnalysis:ds}=_o(u),{editMode:Pn,editData:he,saving:At,handleEditClick:Ot,handleCancelEdit:Mt,handleEditChange:Ce,handleAreaEditChange:$t,handleAddArea:Tn,handleRemoveArea:Fn,handleSaveEdit:An,handleDeleteProject:On}=So({selectedProject:d,areas:v,company:s,onShowToast:a,loadAreas:tt,setSelectedProject:p}),us=c.useRef(null),Ts=c.useRef(!1),et=c.useRef(!1),st=c.useRef(new Map),It=300*1e3,ue=c.useCallback((C={})=>{const{refreshAreas:z=!1,refreshCOR:U=!1,projectId:Q=null}=C;z&&Q&&(Ts.current=Q),U&&(et.current=!0),us.current&&clearTimeout(us.current),us.current=setTimeout(async()=>{Ts.current&&(await tt(Ts.current),Ts.current=!1),et.current&&(De(de=>de+1),et.current=!1),await ms()},150)},[]);c.useEffect(()=>()=>{us.current&&clearTimeout(us.current)},[]),c.useEffect(()=>{s?.id&&(ms(),In())},[s?.id]);const Mn=c.useRef([]),$n=l.map(C=>C.id).sort().join(",");c.useEffect(()=>{if(!s?.id||l.length===0)return;const C=l.map(U=>U.id).sort();Mn.current=C;const z=q.subscribeToCompanyActivity?.(s.id,C,{onMessage:()=>ue(),onMaterialRequest:()=>ue(),onTMTicket:()=>ue(),onCrewCheckin:()=>ue(),onAreaUpdate:()=>ue(),onCORChange:()=>ue({refreshCOR:!0}),onInjuryReport:()=>ue(),onProjectChange:()=>ue(),onMaterialsEquipmentChange:()=>ue(),onLaborRateChange:()=>ue()});return()=>{z&&q.unsubscribe?.(z)}},[s?.id,$n,ue]),c.useEffect(()=>(P?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[P]);const In=async()=>{try{const C=await q.getDumpSites(s.id);le(C||[])}catch(C){console.error("Error loading dump sites:",C)}},Lt=c.useRef(null);c.useEffect(()=>{if(r&&r!==Lt.current&&l.length>0){const C=l.find(z=>z.id===r);C&&(Lt.current=r,p(C),i?.())}},[r,l,i]),c.useEffect(()=>{if(d){tt(d.id);const C=[],z=d.id,U=q.subscribeToAreas?.(z,()=>{ue({refreshAreas:!0,projectId:z})});U&&C.push(U);const Q=q.subscribeToDailyReports?.(z,()=>{ue()});Q&&C.push(Q);const de=q.subscribeToCrewCheckins?.(z,()=>{ue()});de&&C.push(de);const je=q.subscribeToHaulOffs?.(z,()=>{ue()});je&&C.push(je);const Fe=q.subscribeToCORs?.(z,()=>{ue({refreshCOR:!0})});return Fe&&C.push(Fe),()=>{C.forEach(pe=>q.unsubscribe?.(pe))}}},[d,ue]),c.useEffect(()=>{A==="tickets"&&re("full")},[A]);const Ln=async(C,z=!1)=>{const U=C.id,Q=st.current.get(U);if(Q&&!z&&Date.now()-Q.timestamp<It)return Q.data;try{const[de,je,Fe,pe,ge,ke,ze,Os,D,H,oe,Ae]=await Promise.all([be(()=>q.getAreas(C.id),{fallback:[],context:{operation:"getAreas",projectId:C.id}}),be(()=>q.getTMTickets(C.id),{fallback:[],context:{operation:"getTMTickets",projectId:C.id}}),be(()=>q.getChangeOrderTotals(C.id),{fallback:null,context:{operation:"getChangeOrderTotals",projectId:C.id}}),be(()=>q.getDailyReports(C.id,100),{fallback:[],context:{operation:"getDailyReports",projectId:C.id}}),be(()=>q.getInjuryReports(C.id),{fallback:[],context:{operation:"getInjuryReports",projectId:C.id}}),be(()=>q.calculateManDayCosts(C.id,s?.id,C.work_type||"demolition",C.job_type||"standard"),{fallback:null,context:{operation:"calculateManDayCosts",projectId:C.id}}),be(()=>q.calculateHaulOffCosts(C.id),{fallback:null,context:{operation:"calculateHaulOffCosts",projectId:C.id}}),be(()=>q.getProjectCosts(C.id),{fallback:[],context:{operation:"getProjectCosts",projectId:C.id}}),be(()=>q.getCORStats(C.id),{fallback:null,context:{operation:"getCORStats",projectId:C.id}}),be(()=>q.getCrewCheckinHistory(C.id,60),{fallback:[],context:{operation:"getCrewCheckinHistory",projectId:C.id}}),be(()=>q.getMaterialRequests(C.id),{fallback:[],context:{operation:"getMaterialRequests",projectId:C.id}}),be(()=>q.getWeeklyDisposalSummary(C.id,4),{fallback:[],context:{operation:"getWeeklyDisposalSummary",projectId:C.id}})]),_e=Na(de),at=_e.progress,ta=Fe?.totalApprovedValue||0,aa=C.contract_value+ta,Ms=_e.isValueBased?_e.earnedValue:at/100*aa,ur=je.filter(W=>W.status==="pending").length,nt=new Date;nt.setDate(nt.getDate()-7);const mr=pe.filter(W=>new Date(W.report_date)>=nt).length,na=Os.reduce((W,te)=>{const Ze=parseFloat(te.amount);return W+(isNaN(Ze)?0:Ze)},0);let $s=0;const Is={};je.forEach(W=>{const te=W.work_date||W.ticket_date||W.created_at?.split("T")[0],Ze=W.t_and_m_items||W.items||[];let Ls=0;Ze.forEach(dt=>{const Dr=parseFloat(dt.quantity)||1,Er=parseFloat(dt.unit_cost)||parseFloat(dt.materials_equipment?.cost_per_unit)||0;Ls+=Dr*Er}),Ls>0&&te&&($s+=Ls,Is[te]||(Is[te]={date:te,cost:0}),Is[te].cost+=Ls)});const ra=Object.values(Is).sort((W,te)=>new Date(te.date)-new Date(W.date)),rt=ke?.totalCost||0,hr=ze?.totalCost||0,ia=rt+$s+na,la=Ms-ia,pr=Ms>0?la/Ms*100:0,oa=ke?.byDate?.length||0,xr=ra.length,it=Math.max(oa,xr),ca=rt+$s,vr=it>0?ca/it:0,Oe=$i({...C,progress:at},ke?.totalManDays||0),qe={},da=new Set;(H||[]).forEach(W=>{const te=W.workers||[];qe[W.check_in_date]=te.length,te.forEach(Ze=>da.add(Ze.name?.toLowerCase()))});const Me=Object.keys(qe).sort(),fr=Me.length>0?Math.round(Me.reduce((W,te)=>W+qe[te],0)/Me.length*10)/10:0,jr=Me.length>0?Math.max(...Me.map(W=>qe[W])):0,lt=Me.slice(-7),ot=Me.slice(-14,-7),ua=lt.length>0?lt.reduce((W,te)=>W+qe[te],0)/lt.length:0,ct=ot.length>0?ot.reduce((W,te)=>W+qe[te],0)/ot.length:0,gr=(oe||[]).filter(W=>W.status==="pending").length,br=(oe||[]).filter(W=>W.status==="ordered").length,yr=(oe||[]).filter(W=>W.status==="delivered").length,Nr=(oe||[]).filter(W=>W.priority==="urgent"&&W.status==="pending").length,wr=pe.filter(W=>W.issues&&W.issues.trim().length>0).length,Cr=je.reduce((W,te)=>W+(te.photos?.length||0),0),kr=(Ae||[]).reduce((W,te)=>W+(te.concrete||0)+(te.trash||0)+(te.metals||0)+(te.hazardous_waste||0),0),ma=ge.length>0?new Date(ge[0]?.incident_date||ge[0]?.created_at):null,_r=ma?Math.floor((new Date-ma)/(1e3*60*60*24)):null,Sr=de.filter(W=>W.status==="done"),ha={...C,areas:de,progress:at,billable:Ms,changeOrderValue:ta,revisedContractValue:aa,changeOrderPending:Fe?.pendingCount||0,totalTickets:je.length,pendingTickets:ur,approvedTickets:je.filter(W=>W.status==="approved").length,tmTickets:je,dailyReportsCount:pe.length,recentDailyReports:mr,injuryReportsCount:ge.length,lastDailyReport:pe[0]?.report_date||null,isValueBased:_e.isValueBased,earnedValue:_e.earnedValue,totalSOVValue:_e.totalValue,laborCost:rt,laborDaysWorked:oa,laborManDays:ke?.totalManDays||0,laborByDate:ke?.byDate||[],dailyBurn:vr,materialsEquipmentCost:$s,materialsEquipmentByDate:ra,haulOffCost:hr,haulOffLoads:ze?.totalLoads||0,haulOffDays:ze?.daysWithHaulOff||0,haulOffByType:ze?.byWasteType||{},haulOffByDate:ze?.byDate||[],customCosts:Os,customCostTotal:na,totalBurn:ca,totalBurnDays:it,allCostsTotal:ia,currentProfit:la,profitMargin:pr,corPendingValue:D?.total_pending_value||0,corPendingCount:D?.pending_count||0,corApprovedValue:D?.total_approved_value||0,corBilledValue:D?.total_billed_value||0,corTotalCount:D?.total_cors||0,corStats:D,scheduleStatus:Oe.scheduleStatus,scheduleVariance:Oe.scheduleVariance,scheduleLabel:Oe.scheduleLabel,laborStatus:Oe.laborStatus,laborVariance:Oe.laborVariance,laborLabel:Oe.laborLabel,hasScheduleData:Oe.hasScheduleData,hasLaborData:Oe.hasLaborData,actualManDays:ke?.totalManDays||0,crewHistory:H||[],crewByDate:qe,uniqueWorkerCount:da.size,avgCrewSize:fr,peakCrewSize:jr,crewDaysTracked:Me.length,crewTrend:ct>0?(ua-ct)/ct*100:0,recentCrewAvg:ua,materialRequests:oe||[],pendingMaterialRequests:gr,orderedMaterialRequests:br,deliveredMaterialRequests:yr,urgentMaterialRequests:Nr,totalMaterialRequests:(oe||[]).length,reportsWithIssues:wr,totalPhotosFromTickets:Cr,dailyReports:pe,weeklyDisposal:Ae||[],disposalTotalLoads:kr,daysSinceLastInjury:_r,injuryReports:ge,oshaRecordable:ge.filter(W=>W.osha_recordable).length,completedAreasCount:Sr.length,hasError:!1,_detailsLoaded:!0};return st.current.set(U,{data:ha,timestamp:Date.now()}),ha}catch(de){return console.error(`Error loading details for project ${C.id}:`,de),{...C,hasError:!0,_detailsLoaded:!1}}},ms=async()=>{try{const C=await q.getProjectDashboardSummary(s?.id);o(C);const z=C.map(U=>{const Q=st.current.get(U.id);if(Q&&Date.now()-Q.timestamp<It)return Q.data;const de=U.areaCount||0,je=U.completedAreas||0,Fe=de>0?Math.round(je/de*100):0;return{...U,progress:Fe,areas:[],totalTickets:U.ticketCount||0,pendingTickets:U.pendingTicketCount||0,approvedTickets:U.approvedTicketCount||0,dailyReportsCount:U.dailyReportsThisWeek||0,recentDailyReports:U.dailyReportsThisWeek||0,corTotalCount:U.corCount||0,billable:0,changeOrderValue:0,revisedContractValue:U.contract_value||0,changeOrderPending:0,tmTickets:[],injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,materialsEquipmentCost:0,materialsEquipmentByDate:[],haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corStats:null,scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1,actualManDays:0,hasError:!1,_detailsLoaded:!1}});m(z)}catch(C){console.error("Error loading projects:",C),a("Error loading projects","error")}finally{x(!1)}},tt=async C=>{try{const z=await q.getAreas(C);j(z)}catch(z){console.error("Error loading areas:",z)}},Fs=async C=>{if(p(C),!C._detailsLoaded){const z=await Ln(C);m(U=>U.map(Q=>Q.id===C.id?z:Q)),p(z)}},zn=()=>{p(null),j([]),Mt(),y("overview"),ms()},N=c.useMemo(()=>d?u.find(C=>C.id===d.id):null,[d,u]),qn=c.useMemo(()=>{if(!d)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const C=Na(v),z=C.progress,U=N?.changeOrderValue||0,Q=d.contract_value+U,de=C.isValueBased?C.earnedValue:z/100*Q;return{progress:z,billable:de,changeOrderValue:U,revisedContractValue:Q,isValueBased:C.isValueBased,earnedValue:C.earnedValue,totalSOVValue:C.totalValue}},[d,v,N]),Vn=c.useCallback(({target:C,projectId:z,alert:U})=>{const Q=l.find(de=>de.id===z);Q&&(p(Q),C==="financials"?y("financials"):C==="reports"?y("reports"):C==="cors"?(y("financials"),$("cors")):y("overview"))},[l]);c.useEffect(()=>{const C=async()=>{for(const z of u)if(Ai(z,30))try{await q.archiveProject(z.id),a(`Project "${z.name}" has been auto-archived after 30 days of completion`,"info")}catch(U){console.error("Failed to auto-archive project:",U)}};u.length>0&&C()},[]);const Bn=c.useCallback(()=>{fe(null),ve(!0)},[]),Wn=c.useCallback(C=>{fe(C),ve(!0)},[]),Un=c.useCallback(()=>{Ps(null),Rs(!0)},[]),Hn=c.useCallback(C=>{Ps(C),Rs(!0)},[]),Gn=c.useCallback(()=>{re("full")},[]),Kn=c.useCallback(()=>{_(C=>!C)},[]),Yn=c.useCallback(()=>{L(C=>!C)},[]),zt=c.useCallback(()=>{L(!1)},[]),qt=c.useCallback(()=>{V(C=>!C)},[]),As=c.useCallback(async(C="all")=>{if(d){a("Gathering field data...","info");try{const[z,U,Q]=await Promise.all([q.getDailyReports(d.id,365),q.getInjuryReports(d.id),q.getCrewCheckinHistory(d.id,365)]);C==="daily"?await Do(z||[],d):C==="incidents"?await Eo(U||[],d):C==="crew"?await Ro(Q||[],d):await Po({dailyReports:z||[],incidentReports:U||[],crewCheckins:Q||[],project:d}),a("PDF exported!","success")}catch(z){console.error("Error exporting field documents:",z),a("Error generating PDF","error")}}},[d,a]),Jn=c.useCallback(()=>{re("preview")},[]),Xn=c.useCallback(()=>{X("log")},[]),Vt=c.useCallback(()=>{w(null),M(!0)},[]),Qn=c.useCallback(C=>{J(C),E(!0)},[]),Zn=c.useCallback(C=>{w(C),M(!0)},[]),er=c.useCallback(()=>{Pe(!0)},[]),sr=c.useCallback(async C=>{try{await q.deleteProjectCost(C),ms(),a?.("Cost deleted","success")}catch{a?.("Error deleting cost","error")}},[]),tr=c.useMemo(()=>({corCount:N?.corStats?.total||0,ticketCount:N?.totalTickets||0,corPending:N?.corStats?.pending||0,ticketPending:N?.pendingTickets||0}),[N?.corStats?.total,N?.totalTickets,N?.corStats?.pending,N?.pendingTickets]),{totalOriginalContract:ar,totalChangeOrders:Bt,totalPortfolioValue:nr,totalEarned:rr,totalRemaining:ir,weightedCompletion:lr,totalPendingCORValue:or,totalPendingCORCount:Wt}=Dn,{projectsComplete:Ut,projectsOnTrack:Ht,projectsAtRisk:Gt,projectsOverBudget:Kt,projectsWithChangeOrders:Yt}=En,{scheduleAhead:Jt,scheduleOnTrack:Xt,scheduleBehind:Qt,laborOver:Zt,laborUnder:ea,laborOnTrack:sa,hasAnyScheduleData:cr,hasAnyLaborData:dr}=Rn;if(h)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(d){const{progress:C,billable:z,changeOrderValue:U,revisedContractValue:Q,isValueBased:de,earnedValue:je,totalSOVValue:Fe}=qn;if(Pn&&he){const D=he.areas.reduce((H,oe)=>H+(parseFloat(oe.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Mt,style:{marginBottom:"1.5rem"},children:"← Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:he.name,onChange:H=>Ce("name",H.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:he.job_number,onChange:H=>Ce("job_number",H.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:he.address,onChange:H=>Ce("address",H.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:he.general_contractor,onChange:H=>Ce("general_contractor",H.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:he.client_contact,onChange:H=>Ce("client_contact",H.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:he.client_phone,onChange:H=>Ce("client_phone",H.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:he.contract_value,onChange:H=>Ce("contract_value",H.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:he.pin,onChange:H=>Ce("pin",H.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:he.work_type,onChange:H=>Ce("work_type",H.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:he.job_type,onChange:H=>Ce("job_type",H.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:he.default_dump_site_id,onChange:H=>Ce("default_dump_site_id",H.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),me.map(H=>e.jsx("option",{value:H.id,children:H.name},H.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),he.areas.map((H,oe)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:H.name,onChange:Ae=>$t(oe,"name",Ae.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:H.weight,onChange:Ae=>$t(oe,"weight",Ae.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>Fn(oe),children:"×"})]},oe)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${D===100?"valid":"invalid"}`,children:[D,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:Tn,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:An,disabled:At,style:{flex:1},children:At?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:On,children:"Delete Project"})]})}const pe=v.filter(D=>D.status==="done").length,ge=v.filter(D=>D.status==="working").length,ke=v.filter(D=>D.status==="not_started").length,ze=(N?.pendingTickets||0)+(N?.changeOrderPending||0),Os=[{id:"overview",label:"Overview",Icon:_a},{id:"financials",label:"Financials",Icon:xs,badge:ze},{id:"reports",label:"Reports",Icon:xe},{id:"documents",label:"Documents",Icon:ft},{id:"info",label:"Info",Icon:Ws}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:zn,children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>T(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>F(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:Ot,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:d.name}),(d.job_number||d.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[d.job_number&&`Job #${d.job_number}`,d.job_number&&d.work_type&&" • ",d.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[C,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:ce(z)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:ce(Q-z)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:Os.map(D=>e.jsxs("button",{className:`pv-tab ${f===D.id?"active":""} ${D.badge>0?"has-badge":""}`,onClick:()=>y(D.id),children:[e.jsx(D.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:D.label}),D.badge>0&&e.jsx("span",{className:"pv-tab-badge",children:D.badge})]},D.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[f==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab animate-fade-in",children:[e.jsxs("div",{className:"overview-hero-split",children:[e.jsx(Io,{progress:C,areasComplete:pe,totalAreas:v.length,areasWorking:ge}),e.jsx(zo,{earnedRevenue:z,totalCosts:N?.allCostsTotal||0,laborCost:N?.laborCost||0,disposalCost:N?.haulOffCost||0,equipmentCost:N?.materialsEquipmentCost||0,materialsCost:0,otherCost:N?.customCostTotal||0,contractValue:Q})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(Vo,{project:d,onShowToast:a}),e.jsxs("div",{className:"overview-section-card overview-work-areas-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[pe>0&&e.jsxs("span",{className:"section-badge done",children:[pe," Done"]}),ge>0&&e.jsxs("span",{className:"section-badge working",children:[ge," Active"]}),ke>0&&e.jsxs("span",{className:"section-badge pending",children:[ke," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list work-areas-scroll stagger-areas",children:v.map(D=>e.jsxs("div",{className:`work-area-item ${D.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[D.status==="done"&&e.jsx("span",{className:"status-icon done",children:"✓"}),D.status==="working"&&e.jsx("span",{className:"status-icon working",children:"●"}),D.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:"○"})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:D.name}),e.jsx("span",{className:"work-area-weight",children:D.scheduled_value?ce(D.scheduled_value):`${D.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${D.status}`,style:{width:D.status==="done"?"100%":D.status==="working"?"50%":"0%"}})})]},D.id))})]})]}),e.jsxs("div",{className:"overview-bottom-strip",children:[(N?.pendingTickets>0||N?.changeOrderPending>0||N?.pendingMaterialRequests>0||N?.urgentMaterialRequests>0)&&e.jsxs("div",{className:"overview-attention-inline",children:[N?.urgentMaterialRequests>0&&e.jsxs("div",{className:"attention-chip warning",onClick:()=>y("reports"),children:[e.jsx(is,{size:14}),e.jsxs("span",{children:[N.urgentMaterialRequests," urgent material request",N.urgentMaterialRequests!==1?"s":""]})]}),N?.pendingMaterialRequests>0&&!N?.urgentMaterialRequests&&e.jsxs("div",{className:"attention-chip info",onClick:()=>y("reports"),children:[e.jsx(Bs,{size:14}),e.jsxs("span",{children:[N.pendingMaterialRequests," material request",N.pendingMaterialRequests!==1?"s":""," pending"]})]}),N?.pendingTickets>0&&e.jsxs("div",{className:"attention-chip warning",onClick:()=>y("financials"),children:[e.jsx(xe,{size:14}),e.jsxs("span",{children:[N.pendingTickets," T&M pending"]})]}),N?.changeOrderPending>0&&e.jsxs("div",{className:"attention-chip info",onClick:()=>y("financials"),children:[e.jsx(ns,{size:14}),e.jsxs("span",{children:[N.changeOrderPending," CO pending"]})]})]}),e.jsxs("div",{className:"overview-quick-actions",children:[e.jsxs("button",{className:"overview-action-btn",onClick:()=>y("reports"),children:[e.jsx(xe,{size:15}),e.jsxs("span",{children:[N?.dailyReportsCount||0," Reports"]})]}),e.jsxs("button",{className:"overview-action-btn",onClick:()=>y("financials"),children:[e.jsx(xs,{size:15}),e.jsxs("span",{children:[N?.totalTickets||0," T&M Tickets"]})]}),e.jsx("span",{className:"overview-action-divider"}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>As("all"),children:[e.jsx(We,{size:15}),e.jsx("span",{children:"Export All Docs"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>As("daily"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Daily"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>As("incidents"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Incidents"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>As("crew"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Crew"})]})]})]})]}),f==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsxs("div",{className:"export-actions",style:{display:"flex",gap:"8px",marginLeft:"auto",marginBottom:"12px",justifyContent:"flex-end"},children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>To(d,{earnedRevenue:z,approvedCORs:N?.cors?.filter(D=>D.status==="approved"),laborByDate:N?.laborByDate,haulOffByDate:N?.haulOffByDate,customCosts:N?.customCosts}),children:[e.jsx(We,{size:14})," Export CSV"]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>Fo(d,{totalLaborCost:N?.totalLaborCost||0,totalDisposalCost:N?.totalDisposalCost||0}),children:[e.jsx(We,{size:14})," QuickBooks"]})]}),e.jsx(Go,{contractValue:d?.contract_value||0,earnedRevenue:z,totalCosts:N?.allCostsTotal||0,profit:N?.currentProfit||0,progress:C,corApprovedValue:U,loading:!N}),e.jsxs("div",{className:`financials-layout ${S?"sidebar-collapsed":""}`,children:[e.jsxs("button",{className:"financials-mobile-menu-toggle",onClick:Yn,"aria-label":"Open navigation menu",title:"Open navigation menu",children:[e.jsx(el,{size:20}),e.jsx("span",{children:"Menu"})]}),P&&e.jsx("div",{className:"financials-sidebar-overlay",onClick:zt,"aria-hidden":"true"}),e.jsx("div",{className:`financials-sidebar ${S?"collapsed":""} ${P?"mobile-open":""}`,children:e.jsx(Ko,{activeSection:A,onSectionChange:D=>{$(D),L(!1)},collapsed:S,onToggleCollapse:Kn,onMobileClose:zt,stats:tr})}),e.jsxs("div",{className:"financials-main",children:[A==="overview"&&e.jsxs("div",{className:"financials-overview animate-fade-in",children:[e.jsx(Zo,{projectData:N,project:d,tmTickets:N?.tmTickets||[],corStats:N?.corStats,areas:v}),e.jsxs("div",{className:"financials-analysis-row stagger-children",children:[e.jsx(cc,{dailyBurn:N?.dailyBurn||0,totalBurn:N?.totalBurn||0,daysWorked:N?.totalBurnDays||0,laborCost:N?.laborCost||0,materialsEquipmentCost:N?.materialsEquipmentCost||0,progress:C,contractValue:Q,laborByDate:N?.laborByDate||[],materialsEquipmentByDate:N?.materialsEquipmentByDate||[]}),e.jsx(sc,{revenue:z,totalCosts:N?.allCostsTotal||0,contractValue:Q,progress:C})]}),e.jsxs("div",{className:"cost-disposal-row",children:[e.jsx(tc,{laborCost:N?.laborCost||0,haulOffCost:N?.haulOffCost||0,customCosts:N?.customCosts||[],onAddCost:er,onDeleteCost:sr}),e.jsx(nc,{project:d,period:"week"})]}),e.jsx(rc,{project:d,onAddEquipment:Bn,onEditEquipment:Wn,onShowToast:a},Ds),e.jsx(ic,{project:d,areas:v,corStats:N?.corStats,onCreateDraw:Un,onViewDraw:Hn,onShowToast:a},wn),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(He,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:ce(N?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(lc,{project:d,company:s,onShowToast:a})})]})]}),A==="cors"&&e.jsxs("div",{className:"financials-cors animate-fade-in",children:[e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(c.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(kc,{project:d,onShowToast:a,onToggleList:qt,showingList:O,onViewFullLog:Xn,onCreateCOR:Vt})})}),O&&e.jsx("div",{className:"financials-section cor-section-list animate-fade-in",style:{marginTop:"1rem"},children:e.jsx(c.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(_c,{project:d,company:s,areas:v,refreshKey:se,onShowToast:a,previewMode:!1,onViewAll:qt,onDisplayModeChange:X,onCreateCOR:Vt,onViewCOR:Qn,onEditCOR:Zn})})})]}),A==="tickets"&&e.jsx("div",{className:"financials-tickets animate-fade-in",children:e.jsxs("div",{className:"financials-section tm-section",children:[I==="full"&&e.jsx("button",{className:"section-back-btn",onClick:Jn,children:"← Back to summary"}),e.jsx(c.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(Sc,{project:d,company:s,onShowToast:a,compact:I==="preview",previewMode:I==="preview",onViewAll:Gn})})]})}),A==="billing"&&e.jsx("div",{className:"financials-billing animate-fade-in",children:e.jsx(c.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(Dc,{project:d,company:s,user:t,onShowToast:a})})})]})]})]}),f==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(xe,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:N?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:N?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((N?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:N?.totalTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"T&M Tickets"}),(N?.pendingTickets||0)>0&&e.jsxs("div",{className:"reports-metric-status",style:{background:"#fef3c7",color:"#92400e"},children:[N.pendingTickets," pending"]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:N?.totalPhotosFromTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"Photos Captured"})]})]})}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsx("div",{className:"reports-insight-header",children:e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Re,{size:18}),e.jsx("h3",{children:"Crew Analytics"})]})}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.uniqueWorkerCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Workers"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.avgCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Avg Crew / Day"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.peakCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Peak Crew Size"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.crewDaysTracked||0}),e.jsx("span",{className:"reports-stat-label",children:"Days Tracked"})]})]}),(N?.crewTrend||0)!==0&&e.jsxs("div",{className:`reports-trend-badge ${N.crewTrend>0?"up":"down"}`,children:[N.crewTrend>0?e.jsx(ws,{size:14}):e.jsx(Cs,{size:14}),e.jsxs("span",{children:[Math.abs(Math.round(N.crewTrend)),"% ",N.crewTrend>0?"increase":"decrease"," vs prior week"]})]}),N?.crewByDate&&Object.keys(N.crewByDate).length>0&&e.jsxs("div",{className:"reports-mini-chart",children:[e.jsx("div",{className:"reports-mini-chart-label",children:"Recent Crew Size"}),e.jsx("div",{className:"reports-mini-bars",children:Object.keys(N.crewByDate).sort().slice(-14).map(D=>{const H=N.crewByDate[D],oe=N.peakCrewSize||1;return e.jsx("div",{className:"reports-mini-bar-wrap",title:`${new Date(D+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}: ${H} workers`,children:e.jsx("div",{className:"reports-mini-bar",style:{height:`${H/oe*100}%`}})},D)})})]})]})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(gt,{size:18}),e.jsx("h3",{children:"Safety Dashboard"})]}),e.jsx("span",{className:`reports-section-badge ${(N?.injuryReportsCount||0)>0?"warning":"success"}`,children:(N?.injuryReportsCount||0)>0?`${N.injuryReportsCount} incident${N.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsx("div",{className:"reports-safety-hero",children:e.jsxs("div",{className:`reports-safety-days ${N?.daysSinceLastInjury===null||N?.daysSinceLastInjury>30?"excellent":N?.daysSinceLastInjury>7?"good":"caution"}`,children:[e.jsx("span",{className:"reports-safety-days-value",children:N?.daysSinceLastInjury!==null?N.daysSinceLastInjury:"--"}),e.jsx("span",{className:"reports-safety-days-label",children:N?.daysSinceLastInjury!==null?"Days Since Last Incident":"No Incidents Recorded"})]})}),e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.injuryReportsCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Incidents"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.oshaRecordable||0}),e.jsx("span",{className:"reports-stat-label",children:"OSHA Recordable"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.reportsWithIssues||0}),e.jsx("span",{className:"reports-stat-label",children:"Reports w/ Issues"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.laborManDays||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Man-Days"})]})]})]})]})]}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Bs,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("span",{className:"reports-section-count",children:[N?.totalMaterialRequests||0," total"]})]}),e.jsx("div",{className:"reports-insight-body",children:(N?.totalMaterialRequests||0)===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Bs,{size:32}),e.jsx("p",{children:"No material requests yet"}),e.jsx("span",{children:"Requests from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-material-pipeline",children:[N?.urgentMaterialRequests>0&&e.jsxs("div",{className:"reports-material-status urgent",children:[e.jsx(is,{size:14}),e.jsxs("span",{children:[N.urgentMaterialRequests," Urgent"]})]}),e.jsxs("div",{className:"reports-material-status pending",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[N?.pendingMaterialRequests||0," Pending"]})]}),e.jsxs("div",{className:"reports-material-status ordered",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[N?.orderedMaterialRequests||0," Ordered"]})]}),e.jsxs("div",{className:"reports-material-status delivered",children:[e.jsx(sl,{size:14}),e.jsxs("span",{children:[N?.deliveredMaterialRequests||0," Delivered"]})]})]}),e.jsx("div",{className:"reports-recent-list",children:(N?.materialRequests||[]).slice(0,3).map(D=>e.jsxs("div",{className:`reports-recent-item ${D.status}`,children:[e.jsxs("div",{className:"reports-recent-item-main",children:[e.jsx("span",{className:`reports-recent-item-status ${D.status}`,children:D.status}),e.jsx("span",{className:"reports-recent-item-date",children:new Date(D.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"reports-recent-item-detail",children:[(D.items||[]).slice(0,2).map((H,oe)=>e.jsxs("span",{children:[H.name,H.quantity?` (${H.quantity})`:""]},oe)),(D.items||[]).length>2&&e.jsxs("span",{className:"reports-recent-more",children:["+",(D.items||[]).length-2," more"]})]}),D.priority==="urgent"&&e.jsx("span",{className:"reports-urgent-tag",children:"URGENT"})]},D.id))})]})})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Ge,{size:18}),e.jsx("h3",{children:"Disposal Trends"})]}),e.jsxs("span",{className:"reports-section-count",children:[N?.disposalTotalLoads||0," loads"]})]}),e.jsx("div",{className:"reports-insight-body",children:(N?.weeklyDisposal||[]).length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Ge,{size:32}),e.jsx("p",{children:"No disposal data yet"}),e.jsx("span",{children:"Disposal loads from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-disposal-chart",children:[e.jsx("div",{className:"reports-disposal-bars",children:(N?.weeklyDisposal||[]).map((D,H)=>{const oe=(D.concrete||0)+(D.trash||0)+(D.metals||0)+(D.hazardous_waste||0),Ae=Math.max(...(N?.weeklyDisposal||[]).map(_e=>(_e.concrete||0)+(_e.trash||0)+(_e.metals||0)+(_e.hazardous_waste||0)))||1;return e.jsxs("div",{className:"reports-disposal-bar-col",children:[e.jsxs("div",{className:"reports-disposal-bar-stack",style:{height:`${oe/Ae*100}%`},children:[D.concrete>0&&e.jsx("div",{className:"reports-disposal-seg concrete",style:{flex:D.concrete},title:`Concrete: ${D.concrete}`}),D.trash>0&&e.jsx("div",{className:"reports-disposal-seg trash",style:{flex:D.trash},title:`Trash: ${D.trash}`}),D.metals>0&&e.jsx("div",{className:"reports-disposal-seg metals",style:{flex:D.metals},title:`Metals: ${D.metals}`}),D.hazardous_waste>0&&e.jsx("div",{className:"reports-disposal-seg hazardous",style:{flex:D.hazardous_waste},title:`Hazardous: ${D.hazardous_waste}`})]}),e.jsx("span",{className:"reports-disposal-bar-label",children:new Date(D.week+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},H)})}),e.jsxs("div",{className:"reports-disposal-legend",children:[e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot concrete"}),"Concrete"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot trash"}),"Trash"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot metals"}),"Metals"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot hazardous"}),"Hazardous"]})]})]}),(N?.haulOffCost||0)>0&&e.jsxs("div",{className:"reports-disposal-cost",children:[e.jsx("span",{children:"Total Disposal Cost"}),e.jsx("strong",{children:ce(N.haulOffCost)})]})]})})]})]}),e.jsxs("div",{className:"reports-insight-card reports-activity-summary",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(xe,{size:18}),e.jsx("h3",{children:"Field Activity Summary"})]}),e.jsx("div",{className:"reports-activity-badges",children:N?.lastDailyReport&&e.jsxs("span",{className:"reports-last-filed",children:["Last report: ",new Date(N.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ","(",Math.floor((new Date-new Date(N.lastDailyReport))/(1e3*60*60*24)),"d ago)"]})})]}),e.jsx("div",{className:"reports-insight-body",children:e.jsxs("div",{className:"reports-activity-grid",children:[e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(xe,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:N?.dailyReportsCount||0}),e.jsx("span",{children:"Daily Reports Filed"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(ns,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:N?.totalTickets||0}),e.jsx("span",{children:"T&M Tickets Created"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(tl,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:N?.totalPhotosFromTickets||0}),e.jsx("span",{children:"Photos Documented"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(He,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsxs("strong",{children:[N?.completedAreasCount||0,"/",v.length]}),e.jsx("span",{children:"Work Areas Complete"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(xs,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:ce(N?.allCostsTotal||0)}),e.jsx("span",{children:"Total Costs Tracked"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Re,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:N?.laborManDays||0}),e.jsx("span",{children:"Total Man-Days"})]})]})]})})]}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(xe,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[N?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(c.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(bn,{project:d,company:s,onShowToast:a})})})]}),e.jsxs("div",{className:`reports-section-card ${(N?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(N?.injuryReportsCount||0)>0?"warning":"success"}`,children:(N?.injuryReportsCount||0)>0?"⚠":"✓"}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(N?.injuryReportsCount||0)>0?"warning":"success"}`,children:(N?.injuryReportsCount||0)>0?`${N.injuryReportsCount} incident${N.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(c.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(yn,{project:d,companyId:s?.id||d?.company_id,company:s,user:t,onShowToast:a})})})]})]}),f==="documents"&&e.jsx("div",{className:"pv-tab-panel documents-tab",children:e.jsx(c.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(Cc,{project:d,companyId:s?.id||d?.company_id,onShowToast:a,userRole:t?.access_level||"office"})})}),f==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:d.name}),d.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",d.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:Ot,children:e.jsx("span",{children:"Edit Project"})})]}),d.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(al,{size:14}),e.jsx("span",{children:d.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(He,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:d.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ns,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:d.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(xs,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:ce(Q)}),e.jsx("span",{className:"info-quick-label",children:U>0?`Incl. +${ce(U)} COs`:"Contract Value"})]})]}),d.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:d.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(nl,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[d.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:d.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),d.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:d.client_contact})]}),d.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(rl,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${d.client_phone}`,className:"info-detail-value link",children:d.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(_a,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[pe>0&&e.jsxs("span",{className:"info-badge done",children:[pe," Done"]}),ge>0&&e.jsxs("span",{className:"info-badge working",children:[ge," Active"]}),ke>0&&e.jsxs("span",{className:"info-badge pending",children:[ke," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:v.map(D=>e.jsxs("div",{className:`info-area-item ${D.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[D.status==="done"&&e.jsx("span",{className:"status-dot done",children:"✓"}),D.status==="working"&&e.jsx("span",{className:"status-dot working",children:"●"}),D.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:"○"})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:D.name}),e.jsx("span",{className:`info-area-status-label ${D.status}`,children:D.status==="done"?"Complete":D.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[D.weight,"%"]})]},D.id))})]}),e.jsx(pc,{project:d,company:s,user:t,isAdmin:n,onShowToast:a}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(Ws,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:ce(d.contract_value)})]}),U>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",ce(U)]})]}),d.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:me.find(D=>D.id===d.default_dump_site_id)?.name||"Unknown"})]})]})]}),e.jsx("div",{className:"info-section-card",children:e.jsx(xc,{onShowToast:a})})]})]}),k&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(vc,{project:d,user:t,onClose:()=>T(!1),onShareCreated:D=>{a("Share link created successfully!","success")}})}),g&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(c.Suspense,{fallback:null,children:e.jsx(fc,{project:d,company:s,onShowToast:a,onClose:()=>F(!1)})})}),Se&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(jc,{project:d,company:s,areas:v,existingCOR:b,onClose:()=>{M(!1),w(null)},onSaved:()=>{M(!1),w(null),De(D=>D+1)},onShowToast:a})}),G&&Y&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(gc,{cor:Y,project:d,company:s,areas:v,onClose:()=>{E(!1),J(null)},onEdit:D=>{E(!1),J(null),w(D),M(!0)},onShowToast:a,onStatusChange:()=>{}})}),R==="log"&&d&&e.jsx("div",{className:"cor-log-modal-overlay",onClick:()=>X("list"),children:e.jsxs("div",{className:"cor-log-modal",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"cor-log-modal-header",children:[e.jsx("h2",{children:"Change Order Log"}),e.jsx("button",{className:"cor-log-modal-close",onClick:()=>X("list"),title:"Close",children:"✕"})]}),e.jsx("div",{className:"cor-log-modal-content",children:e.jsx(c.Suspense,{fallback:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:e.jsx(bc,{project:d,company:s,onShowToast:a})})})]})}),Xe&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(wc,{onClose:()=>Pe(!1),saving:Z,onSave:async D=>{try{Qe(!0),await q.addProjectCost(d.id,s.id,D),Pe(!1),ms(),a("Cost added successfully","success")}catch(H){console.error("Error adding cost:",H),a("Error adding cost","error")}finally{Qe(!1)}}})}),ee&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(Nc,{project:d,company:s,user:t,editItem:Ss,onSave:()=>{ve(!1),fe(null),Es(D=>D+1),a(Ss?"Equipment updated":"Equipment added","success")},onClose:()=>{ve(!1),fe(null)}})}),Nn&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(yc,{project:d,company:s,areas:v,corStats:u.find(D=>D.id===d?.id)?.corStats,editDrawRequest:Ft,onSave:()=>{Rs(!1),Ps(null),Cn(D=>D+1),a(Ft?"Draw request updated":"Draw request created","success")},onClose:()=>{Rs(!1),Ps(null)}})})]})}return l.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(xe,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("button",{className:"search-trigger-btn",onClick:()=>_n(!0),children:[e.jsx(an,{size:16}),e.jsx("span",{children:"Search"}),e.jsx("span",{className:"shortcut",children:"⌘K"})]}),e.jsxs("div",{className:"bo-project-count",children:[l.length," Active Project",l.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(lr,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:ce(rr)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:ce(nr)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:ce(ir)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Bt>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:ce(ar)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",Yt," project",Yt!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",ce(Bt)]})]})]}),Wt>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:ce(or)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",Wt," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[Ut>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:Ut}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),Ht>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Ht}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Gt>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:Gt}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),Kt>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:Kt}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),cr&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[Jt>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:Jt}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),Xt>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Xt}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Qt>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:Qt}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),dr&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),ea>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[ea," under"]}),sa>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[sa," on track"]}),Zt>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[Zt," over"]})]})]})]}),ds.allAlerts.length>0&&e.jsxs("div",{className:"smart-alerts-section",style:{marginBottom:"var(--space-lg, 1.5rem)"},children:[e.jsx("div",{className:"smart-alerts-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"var(--space-sm, 0.5rem)"},children:e.jsxs("h3",{style:{fontSize:"var(--font-size-md, 1rem)",fontWeight:"var(--font-weight-semibold, 600)",color:"var(--text-primary)",margin:0},children:["Needs Attention",ds.criticalCount>0&&e.jsxs("span",{style:{marginLeft:"0.5rem",padding:"2px 8px",fontSize:"0.75rem",fontWeight:600,borderRadius:"9999px",background:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"},children:[ds.criticalCount," critical"]})]})}),e.jsx(Mo,{alerts:ds.allAlerts,onAction:Vn,maxVisible:3})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[l.length," active"]})]}),e.jsx("div",{className:"project-list",children:u.map(C=>{const z=ds.projectRisks.find(U=>U.projectId===C.id);return e.jsx(Rc,{project:C,riskScore:z?.riskScore,riskStatus:z?.riskStatus,onClick:()=>Fs(C)},C.id)})}),e.jsx(Ao,{isOpen:kn,onClose:Sn,companyId:s?.id,onSelectProject:C=>{Fs(C)},onSelectTicket:C=>{const z=l.find(U=>U.id===C.project_id);z&&(Fs(z),y("financials"),$("tickets"))},onSelectCOR:C=>{const z=l.find(U=>U.id===C.project_id);z&&(Fs(z),y("financials"),$("cors"),J(C),E(!0))},onShowToast:a})]})}function Rc({project:s,riskScore:t,riskStatus:n,onClick:a}){const r=Oi(s.areas||[]),i=Mi(s.areas||[]),l=s.contract_value-s.billable,o=s.billable>s.contract_value*.9&&s.progress<90,u={healthy:{bg:"var(--status-success-bg, #064e3b)",color:"var(--status-success, #059669)"},warning:{bg:"var(--status-warning-bg, #78350f)",color:"var(--status-warning, #d97706)"},critical:{bg:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"}},m=u[n]||u.healthy;return e.jsxs("div",{className:`project-card enhanced ${o?"at-risk":""}`,onClick:a,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[typeof t=="number"&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,background:m.bg,color:m.color},title:`Risk Score: ${t}`,"aria-label":`Risk score ${t}, ${n}`,children:t}),e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:s.name}),e.jsx("div",{className:"project-card-value",children:ce(s.contract_value)})]})]}),e.jsx("span",{className:`status-badge ${r}`,children:i})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[s.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:ce(s.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${l<0?"negative":""}`,children:ce(Math.abs(l))}),e.jsx("span",{className:"stat-label",children:l>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${s.progress}%`}})}),(s.pendingTickets>0||s.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[s.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[s.pendingTickets," Pending T&M"]}),s.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[s.approvedTickets," Approved T&M"]})]}),s.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${s.scheduleStatus}`,children:s.scheduleLabel}),s.hasLaborData&&s.laborLabel&&e.jsx("span",{className:`labor-indicator ${s.laborStatus}`,children:s.laborLabel})]})]})}const Ic=Object.freeze(Object.defineProperty({__proto__:null,default:Ec},Symbol.toStringTag,{value:"Module"}));export{ho as A,$c as C,Ic as D,Ve as T,Wo as a,vs as b,Mc as c,Oc as e};
//# sourceMappingURL=Dashboard-B8iBpqzR.js.map
