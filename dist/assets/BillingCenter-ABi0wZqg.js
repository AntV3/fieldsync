import{aG as de,aH as me,as as e,ar as M}from"./index-ChZkBqHL.js";import{r as u,L as ae,al as K,X as re,s as te,F as J,ab as ue,n as se,w as he,$ as xe,f as ne,y as ce,c as le,D as ee,aY as be}from"./icons-CwUiT5nc.js";import{f as v,g as pe}from"./corCalculations-vdJc_BOT.js";import{_ as ie}from"./pdf-aQqpMATS.js";import"./react-DXGY7bZi.js";import"./supabase-VuevzHjS.js";function oe(i){return i?new Date(i+"T00:00:00").toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):""}function Y(i,p,g,r,d=[226,232,240],t=.3){i.setDrawColor(...d),i.setLineWidth(t),i.line(p,g,r,g)}async function je(i,p,g){const{default:r}=await ie(async()=>{const{default:o}=await import("./pdf-aQqpMATS.js").then(x=>x.j);return{default:o}},[]),{default:d}=await ie(async()=>{const{default:o}=await import("./pdf-aQqpMATS.js").then(x=>x.c);return{default:o}},[]),t=new r("portrait","mm","letter"),_=t.internal.pageSize.width,U=t.internal.pageSize.height,h=20,T=_-h*2,j=g?.branding_color||g?.primary_color||"#1E3A5F",I=de(j),z=[17,24,39],k=[71,85,105],A=[148,163,184],V=[248,250,252],N=[226,232,240];let l=0;const c=48;t.setFillColor(...I),t.rect(0,0,_,c,"F");let E=h;if(g?.logo_url)try{const o=await me(g.logo_url);o&&(t.addImage(o,"PNG",h,(c-28)/2,28,28),E=h+28+10)}catch{}t.setFontSize(15),t.setFont("helvetica","bold"),t.setTextColor(255,255,255),t.text(g?.name||"Company Name",E,c/2-2);const L=[g?.phone,g?.email].filter(Boolean);L.length&&(t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(220,230,245),t.text(L.join("  ·  "),E,c/2+5)),t.setFontSize(26),t.setFont("helvetica","bold"),t.setTextColor(255,255,255),t.text("INVOICE",_-h,c/2+5,{align:"right"}),l=c+14;const q=T*.44,D=T*.44,C=h+T-D,y=[["Invoice #",i.invoice_number||"—"],["Invoice Date",oe(i.invoice_date)],["Due Date",i.due_date?oe(i.due_date):"Upon Receipt"],["Terms",i.terms||"Net 30"]],R=h,F=h+30;t.setFontSize(8),t.setFont("helvetica","bold"),t.setTextColor(...A),t.text("INVOICE DETAILS",R,l),l+=5,Y(t,R,l,R+q,N),l+=5,y.forEach(([o,x])=>{t.setFont("helvetica","normal"),t.setFontSize(9),t.setTextColor(...k),t.text(o,R,l),t.setFont("helvetica","bold"),t.setTextColor(...z),t.text(String(x||"—"),F,l),l+=5.5});let f=c+14;t.setFontSize(8),t.setFont("helvetica","bold"),t.setTextColor(...A),t.text("BILL TO",C,f),f+=5,Y(t,C,f,C+D,N),f+=5,i.bill_to_name&&(t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(...z),t.text(i.bill_to_name,C,f),f+=6),i.bill_to_address&&(t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(...k),t.splitTextToSize(i.bill_to_address,D).forEach(x=>{t.text(x,C,f),f+=4.5})),i.bill_to_contact&&(t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(...k),t.text(i.bill_to_contact,C,f)),l=Math.max(l,f)+10,t.setFillColor(...V),t.roundedRect(h,l-3,T,9,2,2,"F"),t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(...k),t.text("Project:",h+4,l+3),t.setFont("helvetica","bold"),t.setTextColor(...z);const G=(p?.name||"")+(p?.job_number?`  (Job #${p.job_number})`:"");t.text(G,h+22,l+3),l+=14;const $=(i.invoice_items||[]).map((o,x)=>[(x+1).toString(),o.reference_number||"—",o.description||"—",v(o.amount)]);d(t,{startY:l,head:[["#","Ref #","Description","Amount"]],body:$.length>0?$:[["","","No line items",""]],theme:"plain",styles:{fontSize:9,cellPadding:{top:4,bottom:4,left:4,right:4},textColor:z,overflow:"linebreak"},headStyles:{fillColor:I,textColor:[255,255,255],fontStyle:"bold",fontSize:9},alternateRowStyles:{fillColor:V},columnStyles:{0:{cellWidth:10,halign:"center"},1:{cellWidth:28},2:{cellWidth:"auto"},3:{cellWidth:30,halign:"right"}},margin:{left:h,right:h}}),l=t.lastAutoTable.finalY+8;const H=80,O=_-h-H,B=_-h;if(t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(...k),t.text("Subtotal",O,l),t.setTextColor(...z),t.text(v(i.subtotal),B,l,{align:"right"}),l+=6,i.retention_percent>0){const o=i.retention_percent/100;t.setFont("helvetica","normal"),t.setTextColor(...k),t.text(`Retention (${o}%)`,O,l),t.setTextColor(220,38,38),t.text(`-${v(i.retention_amount)}`,B,l,{align:"right"}),l+=6}Y(t,O,l,B,N,.5),l+=6;const a=12;t.setFillColor(...I),t.roundedRect(O-4,l-3,H+4,a,2,2,"F"),t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(255,255,255),t.text("Total Due",O,l+5),t.text(v(i.total),B,l+5,{align:"right"}),l+=a+10,i.notes&&(l>U-50&&(t.addPage(),l=h),t.setFontSize(8),t.setFont("helvetica","bold"),t.setTextColor(...A),t.text("NOTES",h,l),l+=5,Y(t,h,l,_-h,N),l+=5,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(...k),t.splitTextToSize(i.notes,T).forEach(x=>{t.text(x,h,l),l+=4.5}));const n=t.internal.getNumberOfPages();for(let o=1;o<=n;o++){t.setPage(o);const x=U-10;Y(t,h,x-4,_-h,N,.3),t.setFontSize(7.5),t.setFont("helvetica","normal"),t.setTextColor(...A),t.text(`Invoice ${i.invoice_number||""}  ·  Generated ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,h,x),t.text(`Page ${o} of ${n}`,_-h,x,{align:"right"})}return t}async function ve(i,p,g){const r=await je(i,p,g),d=(p?.name||"Project").replace(/\s+/g,"_"),t=`Invoice_${i.invoice_number||"draft"}_${p?.job_number||d}.pdf`;return r.save(t),t}function ge({project:i,company:p,user:g,selectedItems:r={cors:[],tickets:[]},onClose:d,onSuccess:t}){const[_,U]=u.useState(!0),[h,T]=u.useState(!1),[j,I]=u.useState(""),[z,k]=u.useState(new Date().toISOString().split("T")[0]),[A,V]=u.useState(""),[N,l]=u.useState(0),[c,E]=u.useState(""),[L,q]=u.useState("Net 30"),[D,C]=u.useState([]),[y,R]=u.useState({});u.useEffect(()=>{(async()=>{try{const n=new Date;n.setDate(n.getDate()+30),V(n.toISOString().split("T")[0]);const o=await M.getNextInvoiceNumber(p.id);I(o)}catch(n){console.error("Error initializing invoice:",n)}finally{U(!1)}})()},[p.id]);const F=u.useMemo(()=>{const a=[];return r.cors.forEach(n=>{a.push({id:n.id,item_type:"cor",reference_id:n.id,reference_number:n.cor_number,description:`COR ${n.cor_number}: ${n.title||"Change Order"}`,amount:n.cor_total||0})}),r.tickets.forEach(n=>{a.push({id:n.id,item_type:"tm_ticket",reference_id:n.id,reference_number:n.ce_pco_number||null,description:`T&M Ticket - ${new Date(n.work_date).toLocaleDateString()}`,amount:(parseFloat(n.change_order_value)||0)*100})}),D.forEach((n,o)=>{a.push({id:`manual-${o}`,item_type:"manual",reference_id:null,reference_number:null,description:n.description,amount:pe(parseFloat(n.amount)||0)})}),a},[r,D]),f=u.useMemo(()=>{const a=F.reduce((x,w)=>x+w.amount,0),n=Math.round(a*N/100),o=a-n;return{subtotal:a,retentionAmount:n,total:o}},[F,N]),G=()=>{C(a=>[...a,{description:"",amount:""}])},$=(a,n,o)=>{C(x=>{const w=[...x];return w[a]={...w[a],[n]:o},w})},H=a=>{C(n=>n.filter((o,x)=>x!==a))},O=()=>{const a={};return j.trim()||(a.invoiceNumber="Invoice number is required"),z||(a.invoiceDate="Invoice date is required"),F.length===0&&(a.items="At least one line item is required"),D.forEach((n,o)=>{n.description.trim()||(a[`manual-${o}-desc`]="Description required"),(!n.amount||parseFloat(n.amount)<=0)&&(a[`manual-${o}-amount`]="Valid amount required")}),R(a),Object.keys(a).length===0},B=async()=>{if(O()){T(!0);try{const a={project_id:i.id,company_id:p.id,invoice_number:j,invoice_date:z,due_date:A||null,status:"draft",retention_percent:N*100,bill_to_name:i.general_contractor||"",bill_to_address:i.address||"",notes:c||null,terms:L||"Net 30",created_by:g?.id},n=F.map(S=>({item_type:S.item_type,reference_id:S.item_type!=="manual"?S.reference_id:null,reference_number:S.reference_number,description:S.description,amount:S.amount})),o=await M.createInvoice(a,n),x=r.cors.map(S=>S.id),w=r.tickets.map(S=>S.id);await M.markItemsBilled(x,w),t?.(o)}catch(a){console.error("Error creating invoice:",a),R({submit:"Failed to create invoice. Please try again."})}finally{T(!1)}}};return _?e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"modal-content invoice-modal",children:e.jsxs("div",{className:"invoice-loading",children:[e.jsx(ae,{size:24,className:"spinning"}),e.jsx("span",{children:"Loading..."})]})})}):e.jsx("div",{className:"modal-overlay",onClick:d,children:e.jsxs("div",{className:"modal-content invoice-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(K,{size:20}),"Create Invoice"]}),e.jsx("button",{className:"close-btn",onClick:d,"aria-label":"Close",children:e.jsx(re,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"invoice-header-fields",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"invoice-number",children:"Invoice Number *"}),e.jsx("input",{id:"invoice-number",type:"text",value:j,onChange:a=>I(a.target.value),className:y.invoiceNumber?"error":""}),y.invoiceNumber&&e.jsx("span",{className:"form-error",children:y.invoiceNumber})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"invoice-date",children:"Invoice Date *"}),e.jsx("input",{id:"invoice-date",type:"date",value:z,onChange:a=>k(a.target.value),className:y.invoiceDate?"error":""})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"due-date",children:"Due Date"}),e.jsx("input",{id:"due-date",type:"date",value:A,onChange:a=>V(a.target.value)})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"bill-to",children:"Bill To"}),e.jsx("input",{id:"bill-to",type:"text",value:i.general_contractor||"",disabled:!0,className:"disabled"})]}),e.jsxs("div",{className:"form-group retention-group",children:[e.jsx("label",{htmlFor:"retention",children:"Retention %"}),e.jsxs("div",{className:"input-with-suffix",children:[e.jsx("input",{id:"retention",type:"number",min:"0",max:"100",step:"0.5",value:N,onChange:a=>l(parseFloat(a.target.value)||0)}),e.jsx("span",{className:"input-suffix",children:"%"})]})]})]})]}),e.jsxs("div",{className:"invoice-line-items",children:[e.jsxs("div",{className:"line-items-header",children:[e.jsx("h4",{children:"Line Items"}),e.jsxs("button",{type:"button",className:"btn btn-text btn-sm",onClick:G,children:[e.jsx(te,{size:14}),"Add Item"]})]}),y.items&&e.jsx("div",{className:"form-error",children:y.items}),e.jsxs("div",{className:"line-items-table",children:[e.jsxs("div",{className:"line-items-table-header",children:[e.jsx("span",{className:"col-type",children:"Type"}),e.jsx("span",{className:"col-desc",children:"Description"}),e.jsx("span",{className:"col-amount",children:"Amount"}),e.jsx("span",{className:"col-action"})]}),F.map((a,n)=>e.jsxs("div",{className:"line-item-row",children:[e.jsxs("span",{className:"col-type",children:[a.item_type==="cor"&&e.jsx(J,{size:14}),a.item_type==="tm_ticket"&&e.jsx(J,{size:14}),a.item_type==="manual"&&e.jsx(te,{size:14}),a.item_type==="cor"?"COR":a.item_type==="tm_ticket"?"T&M":"Manual"]}),a.item_type==="manual"?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:`col-desc ${y[`manual-${n-r.cors.length-r.tickets.length}-desc`]?"error":""}`,value:D[n-r.cors.length-r.tickets.length]?.description||"",onChange:o=>$(n-r.cors.length-r.tickets.length,"description",o.target.value),placeholder:"Description"}),e.jsxs("div",{className:"col-amount",children:[e.jsx("span",{className:"currency-prefix",children:"$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:y[`manual-${n-r.cors.length-r.tickets.length}-amount`]?"error":"",value:D[n-r.cors.length-r.tickets.length]?.amount||"",onChange:o=>$(n-r.cors.length-r.tickets.length,"amount",o.target.value),placeholder:"0.00"})]}),e.jsx("button",{type:"button",className:"btn btn-icon btn-ghost col-action",onClick:()=>H(n-r.cors.length-r.tickets.length),children:e.jsx(ue,{size:14})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"col-desc",children:a.description}),e.jsx("span",{className:"col-amount",children:v(a.amount)}),e.jsx("span",{className:"col-action"})]})]},a.id))]}),e.jsxs("div",{className:"invoice-totals",children:[e.jsxs("div",{className:"total-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:v(f.subtotal)})]}),N>0&&e.jsxs("div",{className:"total-row retention",children:[e.jsxs("span",{children:["Retention (",N,"%)"]}),e.jsxs("span",{children:["-",v(f.retentionAmount)]})]}),e.jsxs("div",{className:"total-row grand-total",children:[e.jsx("span",{children:"Total Due"}),e.jsx("span",{children:v(f.total)})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group flex-2",children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",value:c,onChange:a=>E(a.target.value),rows:2,placeholder:"Additional notes for the client..."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"terms",children:"Payment Terms"}),e.jsxs("select",{id:"terms",value:L,onChange:a=>q(a.target.value),children:[e.jsx("option",{value:"Due on Receipt",children:"Due on Receipt"}),e.jsx("option",{value:"Net 15",children:"Net 15"}),e.jsx("option",{value:"Net 30",children:"Net 30"}),e.jsx("option",{value:"Net 45",children:"Net 45"}),e.jsx("option",{value:"Net 60",children:"Net 60"})]})]})]}),y.submit&&e.jsx("div",{className:"form-error submit-error",children:y.submit})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:d,disabled:h,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:B,disabled:h||F.length===0,children:h?e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:16,className:"spinning"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:16}),"Create Invoice"]})})]})]})})}const X={draft:{label:"Draft",icon:J,className:"status-draft"},sent:{label:"Sent",icon:ce,className:"status-sent"},partial:{label:"Partial",icon:ne,className:"status-partial"},paid:{label:"Paid",icon:se,className:"status-paid"},void:{label:"Void",icon:ne,className:"status-void"}};function Se({project:i,company:p,user:g,onShowToast:r}){const[d,t]=u.useState({cors:[],tickets:[]}),[_,U]=u.useState([]),[h,T]=u.useState(!0),[j,I]=u.useState({cors:new Set,tickets:new Set}),[z,k]=u.useState(!1),[A,V]=u.useState(null),[N,l]=u.useState(null),[c,E]=u.useState(null),[L,q]=u.useState(!1),D=u.useRef(null);u.useEffect(()=>{C()},[i.id]);const C=async()=>{try{T(!0);const[s,m]=await Promise.all([M.getBillableItems(i.id),M.getProjectInvoices(i.id)]);t(s),U(m)}catch(s){console.error("Error loading billing data:",s),r?.("Error loading billing data","error")}finally{T(!1)}};u.useEffect(()=>{const s=m=>{D.current&&!D.current.contains(m.target)&&l(null)};if(N)return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[N]);const y=u.useCallback((s,m)=>{m.stopPropagation(),l(b=>b===s?null:s)},[]),R=u.useCallback(async s=>{l(null);try{const m=await M.getInvoice(s.id);E(m)}catch(m){console.error("Error fetching invoice:",m),r?.("Error loading invoice details","error")}},[]),F=u.useCallback(async s=>{l(null),q(!0);try{const m=await M.getInvoice(s.id),b=await ve(m,i,p);r?.(`Downloaded ${b}`,"success")}catch(m){console.error("Error generating PDF:",m),r?.("Error generating PDF","error")}finally{q(!1)}},[i,p]),f=u.useCallback(async s=>{if(l(null),s.status!=="draft"){r?.("Only draft invoices can be marked as sent","error");return}try{await M.markInvoiceSent(s.id),await C(),r?.(`Invoice ${s.invoice_number} marked as sent`,"success")}catch(m){console.error("Error updating invoice:",m),r?.("Error updating invoice","error")}},[]),G=u.useCallback(async s=>{if(l(null),s.status==="paid"){r?.("Invoice is already marked as paid","error");return}try{await M.updateInvoice(s.id,{status:"paid",paid_at:new Date().toISOString(),amount_paid:s.total}),await C(),r?.(`Invoice ${s.invoice_number} marked as paid`,"success")}catch(m){console.error("Error updating invoice:",m),r?.("Error updating invoice","error")}},[]),$=u.useMemo(()=>{const s=d.cors.filter(P=>j.cors.has(P.id)).reduce((P,W)=>P+(W.cor_total||0),0),m=d.tickets.filter(P=>j.tickets.has(P.id)).reduce((P,W)=>P+(parseFloat(W.change_order_value)||0)*100,0),b=d.cors.reduce((P,W)=>P+(W.cor_total||0),0),Z=d.tickets.reduce((P,W)=>P+(parseFloat(W.change_order_value)||0)*100,0);return{selected:s+m,total:b+Z,selectedCount:j.cors.size+j.tickets.size}},[d,j]),H=s=>{I(m=>{const b=new Set(m.cors);return b.has(s)?b.delete(s):b.add(s),{...m,cors:b}})},O=s=>{I(m=>{const b=new Set(m.tickets);return b.has(s)?b.delete(s):b.add(s),{...m,tickets:b}})},B=()=>{I({cors:new Set(d.cors.map(s=>s.id)),tickets:new Set(d.tickets.map(s=>s.id))})},a=()=>{I({cors:new Set,tickets:new Set})},n=()=>{V(null),k(!0)},o=async s=>{k(!1),a(),await C(),r?.(`Invoice ${s.invoice_number} created`,"success")},x=()=>{const s=d.cors.filter(b=>j.cors.has(b.id)),m=d.tickets.filter(b=>j.tickets.has(b.id));return{cors:s,tickets:m}},w=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"}):"-",S=d.cors.length>0||d.tickets.length>0,Q=$.selectedCount>0;return h?e.jsx("div",{className:"billing-center loading",children:e.jsxs("div",{className:"billing-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Loading billing data..."})]})}):e.jsxs("div",{className:"billing-center",children:[e.jsxs("div",{className:"billing-section",children:[e.jsxs("div",{className:"billing-section-header",children:[e.jsxs("div",{className:"billing-section-title",children:[e.jsx(K,{size:20}),e.jsx("h3",{children:"Ready to Bill"}),S&&e.jsxs("span",{className:"billing-count",children:[d.cors.length+d.tickets.length," items"]})]}),S&&e.jsx("div",{className:"billing-section-actions",children:e.jsx("button",{className:"btn btn-text btn-sm",onClick:Q?a:B,children:Q?"Clear Selection":"Select All"})})]}),S?e.jsxs(e.Fragment,{children:[d.cors.length>0&&e.jsxs("div",{className:"billable-group",children:[e.jsxs("div",{className:"billable-group-header",children:[e.jsx(J,{size:16}),e.jsxs("span",{children:["Change Orders (",d.cors.length,")"]})]}),e.jsx("div",{className:"billable-items",children:d.cors.map(s=>e.jsxs("label",{className:`billable-item ${j.cors.has(s.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:j.cors.has(s.id),onChange:()=>H(s.id)}),e.jsxs("div",{className:"billable-item-content",children:[e.jsx("span",{className:"billable-item-number",children:s.cor_number}),e.jsx("span",{className:"billable-item-title",children:s.title||"Untitled COR"})]}),e.jsx("span",{className:"billable-item-amount",children:v(s.cor_total||0)})]},s.id))})]}),d.tickets.length>0&&e.jsxs("div",{className:"billable-group",children:[e.jsxs("div",{className:"billable-group-header",children:[e.jsx(he,{size:16}),e.jsxs("span",{children:["T&M Tickets (",d.tickets.length,")"]})]}),e.jsx("div",{className:"billable-items",children:d.tickets.map(s=>e.jsxs("label",{className:`billable-item ${j.tickets.has(s.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:j.tickets.has(s.id),onChange:()=>O(s.id)}),e.jsxs("div",{className:"billable-item-content",children:[e.jsx("span",{className:"billable-item-number",children:s.ce_pco_number||w(s.work_date)}),e.jsxs("span",{className:"billable-item-title",children:["T&M Ticket - ",w(s.work_date)]})]}),e.jsx("span",{className:"billable-item-amount",children:v((parseFloat(s.change_order_value)||0)*100)})]},s.id))})]}),e.jsxs("div",{className:"billing-action-bar",children:[e.jsxs("div",{className:"billing-action-summary",children:[e.jsxs("span",{className:"selected-count",children:[$.selectedCount," of ",d.cors.length+d.tickets.length," selected"]}),e.jsx("span",{className:"selected-total",children:v($.selected)})]}),e.jsxs("button",{className:"btn btn-primary",disabled:!Q,onClick:n,children:[e.jsx(te,{size:16}),"Create Invoice"]})]})]}):e.jsxs("div",{className:"billing-empty-state",children:[e.jsx(se,{size:32,className:"text-success"}),e.jsx("p",{children:"No items ready to bill"}),e.jsx("span",{children:"Approved CORs and signed T&M tickets will appear here"})]})]}),e.jsxs("div",{className:"billing-section",children:[e.jsx("div",{className:"billing-section-header",children:e.jsxs("div",{className:"billing-section-title",children:[e.jsx(xe,{size:20}),e.jsx("h3",{children:"Invoices"}),_.length>0&&e.jsx("span",{className:"billing-count",children:_.length})]})}),_.length===0?e.jsxs("div",{className:"billing-empty-state",children:[e.jsx(K,{size:32}),e.jsx("p",{children:"No invoices yet"}),e.jsx("span",{children:"Create an invoice from the items above"})]}):e.jsx("div",{className:"invoice-list",children:_.map(s=>{const m=X[s.status]?.icon||J,b=N===s.id;return e.jsxs("div",{className:"invoice-row",children:[e.jsxs("div",{className:"invoice-info",children:[e.jsx("span",{className:"invoice-number",children:s.invoice_number}),e.jsx("span",{className:"invoice-date",children:w(s.invoice_date)})]}),e.jsx("span",{className:"invoice-amount",children:v(s.total||0)}),e.jsxs("span",{className:`invoice-status ${X[s.status]?.className||""}`,children:[e.jsx(m,{size:14}),X[s.status]?.label||s.status]}),e.jsxs("div",{className:"invoice-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-secondary",title:"View invoice details",onClick:()=>R(s),disabled:L,children:[e.jsx(le,{size:14}),"View"]}),e.jsxs("button",{className:"btn btn-sm btn-primary",title:"Download PDF",onClick:()=>F(s),disabled:L,children:[e.jsx(ee,{size:14}),"PDF"]})]}),e.jsxs("div",{className:"invoice-actions-container",ref:b?D:null,children:[e.jsx("button",{className:"btn btn-icon btn-ghost",title:"More options",onClick:Z=>y(s.id,Z),disabled:L,children:e.jsx(be,{size:16})}),b&&e.jsxs("div",{className:"invoice-dropdown",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>R(s),children:[e.jsx(le,{size:14}),"View Details"]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>F(s),children:[e.jsx(ee,{size:14}),"Download PDF"]}),s.status==="draft"&&e.jsxs("button",{className:"dropdown-item",onClick:()=>f(s),children:[e.jsx(ce,{size:14}),"Mark as Sent"]}),s.status!=="paid"&&s.status!=="void"&&e.jsxs("button",{className:"dropdown-item success",onClick:()=>G(s),children:[e.jsx(se,{size:14}),"Mark as Paid"]})]})]})]},s.id)})})]}),z&&e.jsx(ge,{project:i,company:p,user:g,selectedItems:x(),onClose:()=>k(!1),onSuccess:o}),c&&e.jsx("div",{className:"modal-overlay",onClick:()=>E(null),children:e.jsxs("div",{className:"modal invoice-detail-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Invoice ",c.invoice_number]}),e.jsx("button",{className:"btn btn-icon btn-ghost",onClick:()=>E(null),children:e.jsx(re,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"invoice-detail-header",children:[e.jsxs("div",{className:"invoice-detail-info",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Date:"}),e.jsx("span",{className:"detail-value",children:w(c.invoice_date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Due:"}),e.jsx("span",{className:"detail-value",children:c.due_date?w(c.due_date):"Upon Receipt"})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Status:"}),e.jsx("span",{className:`invoice-status ${X[c.status]?.className||""}`,children:X[c.status]?.label||c.status})]})]}),e.jsxs("div",{className:"invoice-detail-billto",children:[e.jsx("span",{className:"detail-label",children:"Bill To:"}),e.jsxs("div",{className:"billto-content",children:[c.bill_to_name&&e.jsx("p",{children:c.bill_to_name}),c.bill_to_address&&e.jsx("p",{children:c.bill_to_address}),c.bill_to_contact&&e.jsx("p",{children:c.bill_to_contact})]})]})]}),e.jsxs("div",{className:"invoice-detail-items",children:[e.jsx("h3",{children:"Line Items"}),e.jsxs("table",{className:"invoice-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:(c.invoice_items||[]).map((s,m)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.reference_number||"-"}),e.jsx("td",{children:s.description}),e.jsx("td",{className:"text-right",children:v(s.amount)})]},s.id||m))})]})]}),e.jsxs("div",{className:"invoice-detail-totals",children:[e.jsxs("div",{className:"total-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:v(c.subtotal)})]}),c.retention_percent>0&&e.jsxs("div",{className:"total-row retention",children:[e.jsxs("span",{children:["Retention (",c.retention_percent/100,"%)"]}),e.jsxs("span",{children:["-",v(c.retention_amount)]})]}),e.jsxs("div",{className:"total-row grand-total",children:[e.jsx("span",{children:"Total Due"}),e.jsx("span",{children:v(c.total)})]}),c.amount_paid>0&&e.jsxs("div",{className:"total-row paid",children:[e.jsx("span",{children:"Amount Paid"}),e.jsx("span",{children:v(c.amount_paid)})]})]}),c.notes&&e.jsxs("div",{className:"invoice-detail-notes",children:[e.jsx("span",{className:"detail-label",children:"Notes:"}),e.jsx("p",{children:c.notes})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>E(null),children:"Close"}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{F(c),E(null)},children:[e.jsx(ee,{size:16}),"Download PDF"]})]})]})})]})}export{Se as default};
//# sourceMappingURL=BillingCenter-ABi0wZqg.js.map
