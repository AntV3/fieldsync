import{r as Rf,a as zf,b as mx}from"./react-DXGY7bZi.js";import{c as hx}from"./supabase-VuevzHjS.js";import{u as Is,w as fx,r as px}from"./xlsx-BTp1RmNK.js";import{E as Ri,a as Ks}from"./pdf-C0G31WKZ.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))c(m);new MutationObserver(m=>{for(const u of m)if(u.type==="childList")for(const x of u.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&c(x)}).observe(document,{childList:!0,subtree:!0});function o(m){const u={};return m.integrity&&(u.integrity=m.integrity),m.referrerPolicy&&(u.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?u.credentials="include":m.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(m){if(m.ep)return;m.ep=!0;const u=o(m);fetch(m.href,u)}})();var Yo={exports:{}},nr={};var ef;function gx(){if(ef)return nr;ef=1;var l=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function o(c,m,u){var x=null;if(u!==void 0&&(x=""+u),m.key!==void 0&&(x=""+m.key),"key"in m){u={};for(var g in m)g!=="key"&&(u[g]=m[g])}else u=m;return m=u.ref,{$$typeof:l,type:c,key:x,ref:m!==void 0?m:null,props:u}}return nr.Fragment=r,nr.jsx=o,nr.jsxs=o,nr}var tf;function xx(){return tf||(tf=1,Yo.exports=gx()),Yo.exports}var e=xx(),p=Rf();const jx=zf(p);var Qo={exports:{}},lr={},Xo={exports:{}},Zo={};var af;function vx(){return af||(af=1,(function(l){function r(k,M){var C=k.length;k.push(M);e:for(;0<C;){var me=C-1>>>1,Q=k[me];if(0<m(Q,M))k[me]=M,k[C]=Q,C=me;else break e}}function o(k){return k.length===0?null:k[0]}function c(k){if(k.length===0)return null;var M=k[0],C=k.pop();if(C!==M){k[0]=C;e:for(var me=0,Q=k.length,O=Q>>>1;me<O;){var $=2*(me+1)-1,H=k[$],ve=$+1,Ne=k[ve];if(0>m(H,C))ve<Q&&0>m(Ne,H)?(k[me]=Ne,k[ve]=C,me=ve):(k[me]=H,k[$]=C,me=$);else if(ve<Q&&0>m(Ne,C))k[me]=Ne,k[ve]=C,me=ve;else break e}}return M}function m(k,M){var C=k.sortIndex-M.sortIndex;return C!==0?C:k.id-M.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;l.unstable_now=function(){return u.now()}}else{var x=Date,g=x.now();l.unstable_now=function(){return x.now()-g}}var f=[],v=[],y=1,R=null,X=3,B=!1,V=!1,L=!1,q=!1,ee=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function w(k){for(var M=o(v);M!==null;){if(M.callback===null)c(v);else if(M.startTime<=k)c(v),M.sortIndex=M.expirationTime,r(f,M);else break;M=o(v)}}function se(k){if(L=!1,w(k),!V)if(o(f)!==null)V=!0,ne||(ne=!0,j());else{var M=o(v);M!==null&&ae(se,M.startTime-k)}}var ne=!1,P=-1,I=5,F=-1;function J(){return q?!0:!(l.unstable_now()-F<I)}function Z(){if(q=!1,ne){var k=l.unstable_now();F=k;var M=!0;try{e:{V=!1,L&&(L=!1,T(P),P=-1),B=!0;var C=X;try{t:{for(w(k),R=o(f);R!==null&&!(R.expirationTime>k&&J());){var me=R.callback;if(typeof me=="function"){R.callback=null,X=R.priorityLevel;var Q=me(R.expirationTime<=k);if(k=l.unstable_now(),typeof Q=="function"){R.callback=Q,w(k),M=!0;break t}R===o(f)&&c(f),w(k)}else c(f);R=o(f)}if(R!==null)M=!0;else{var O=o(v);O!==null&&ae(se,O.startTime-k),M=!1}}break e}finally{R=null,X=C,B=!1}M=void 0}}finally{M?j():ne=!1}}}var j;if(typeof D=="function")j=function(){D(Z)};else if(typeof MessageChannel<"u"){var _=new MessageChannel,S=_.port2;_.port1.onmessage=Z,j=function(){S.postMessage(null)}}else j=function(){ee(Z,0)};function ae(k,M){P=ee(function(){k(l.unstable_now())},M)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(k){k.callback=null},l.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<k?Math.floor(1e3/k):5},l.unstable_getCurrentPriorityLevel=function(){return X},l.unstable_next=function(k){switch(X){case 1:case 2:case 3:var M=3;break;default:M=X}var C=X;X=M;try{return k()}finally{X=C}},l.unstable_requestPaint=function(){q=!0},l.unstable_runWithPriority=function(k,M){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var C=X;X=k;try{return M()}finally{X=C}},l.unstable_scheduleCallback=function(k,M,C){var me=l.unstable_now();switch(typeof C=="object"&&C!==null?(C=C.delay,C=typeof C=="number"&&0<C?me+C:me):C=me,k){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=C+Q,k={id:y++,callback:M,priorityLevel:k,startTime:C,expirationTime:Q,sortIndex:-1},C>me?(k.sortIndex=C,r(v,k),o(f)===null&&k===o(v)&&(L?(T(P),P=-1):L=!0,ae(se,C-me))):(k.sortIndex=Q,r(f,k),V||B||(V=!0,ne||(ne=!0,j()))),k},l.unstable_shouldYield=J,l.unstable_wrapCallback=function(k){var M=X;return function(){var C=X;X=M;try{return k.apply(this,arguments)}finally{X=C}}}})(Zo)),Zo}var sf;function yx(){return sf||(sf=1,Xo.exports=vx()),Xo.exports}var nf;function bx(){if(nf)return lr;nf=1;var l=yx(),r=Rf(),o=mx();function c(t){var a="https://react.dev/errors/"+t;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)a+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function m(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function u(t){var a=t,s=t;if(t.alternate)for(;a.return;)a=a.return;else{t=a;do a=t,(a.flags&4098)!==0&&(s=a.return),t=a.return;while(t)}return a.tag===3?s:null}function x(t){if(t.tag===13){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function g(t){if(t.tag===31){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function f(t){if(u(t)!==t)throw Error(c(188))}function v(t){var a=t.alternate;if(!a){if(a=u(t),a===null)throw Error(c(188));return a!==t?null:t}for(var s=t,n=a;;){var i=s.return;if(i===null)break;var d=i.alternate;if(d===null){if(n=i.return,n!==null){s=n;continue}break}if(i.child===d.child){for(d=i.child;d;){if(d===s)return f(i),t;if(d===n)return f(i),a;d=d.sibling}throw Error(c(188))}if(s.return!==n.return)s=i,n=d;else{for(var h=!1,b=i.child;b;){if(b===s){h=!0,s=i,n=d;break}if(b===n){h=!0,n=i,s=d;break}b=b.sibling}if(!h){for(b=d.child;b;){if(b===s){h=!0,s=d,n=i;break}if(b===n){h=!0,n=d,s=i;break}b=b.sibling}if(!h)throw Error(c(189))}}if(s.alternate!==n)throw Error(c(190))}if(s.tag!==3)throw Error(c(188));return s.stateNode.current===s?t:a}function y(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t;for(t=t.child;t!==null;){if(a=y(t),a!==null)return a;t=t.sibling}return null}var R=Object.assign,X=Symbol.for("react.element"),B=Symbol.for("react.transitional.element"),V=Symbol.for("react.portal"),L=Symbol.for("react.fragment"),q=Symbol.for("react.strict_mode"),ee=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),D=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),ne=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),J=Symbol.for("react.memo_cache_sentinel"),Z=Symbol.iterator;function j(t){return t===null||typeof t!="object"?null:(t=Z&&t[Z]||t["@@iterator"],typeof t=="function"?t:null)}var _=Symbol.for("react.client.reference");function S(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===_?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case L:return"Fragment";case ee:return"Profiler";case q:return"StrictMode";case se:return"Suspense";case ne:return"SuspenseList";case F:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case V:return"Portal";case D:return t.displayName||"Context";case T:return(t._context.displayName||"Context")+".Consumer";case w:var a=t.render;return t=t.displayName,t||(t=a.displayName||a.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case P:return a=t.displayName||null,a!==null?a:S(t.type)||"Memo";case I:a=t._payload,t=t._init;try{return S(t(a))}catch{}}return null}var ae=Array.isArray,k=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,C={pending:!1,data:null,method:null,action:null},me=[],Q=-1;function O(t){return{current:t}}function $(t){0>Q||(t.current=me[Q],me[Q]=null,Q--)}function H(t,a){Q++,me[Q]=t.current,t.current=a}var ve=O(null),Ne=O(null),Ae=O(null),be=O(null);function Pe(t,a){switch(H(Ae,a),H(Ne,t),H(ve,null),a.nodeType){case 9:case 11:t=(t=a.documentElement)&&(t=t.namespaceURI)?Nh(t):0;break;default:if(t=a.tagName,a=a.namespaceURI)a=Nh(a),t=Sh(a,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}$(ve),H(ve,t)}function Ve(){$(ve),$(Ne),$(Ae)}function Te(t){t.memoizedState!==null&&H(be,t);var a=ve.current,s=Sh(a,t.type);a!==s&&(H(Ne,t),H(ve,s))}function ht(t){Ne.current===t&&($(ve),$(Ne)),be.current===t&&($(be),er._currentValue=C)}var Yt,Tt;function ft(t){if(Yt===void 0)try{throw Error()}catch(s){var a=s.stack.trim().match(/\n( *(at )?)/);Yt=a&&a[1]||"",Tt=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Yt+t+Tt}var At=!1;function lt(t,a){if(!t||At)return"";At=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(a){var ye=function(){throw Error()};if(Object.defineProperty(ye.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ye,[])}catch(de){var oe=de}Reflect.construct(t,[],ye)}else{try{ye.call()}catch(de){oe=de}t.call(ye.prototype)}}else{try{throw Error()}catch(de){oe=de}(ye=t())&&typeof ye.catch=="function"&&ye.catch(function(){})}}catch(de){if(de&&oe&&typeof de.stack=="string")return[de.stack,oe.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=n.DetermineComponentFrameRoot(),h=d[0],b=d[1];if(h&&b){var z=h.split(`
`),ie=b.split(`
`);for(i=n=0;n<z.length&&!z[n].includes("DetermineComponentFrameRoot");)n++;for(;i<ie.length&&!ie[i].includes("DetermineComponentFrameRoot");)i++;if(n===z.length||i===ie.length)for(n=z.length-1,i=ie.length-1;1<=n&&0<=i&&z[n]!==ie[i];)i--;for(;1<=n&&0<=i;n--,i--)if(z[n]!==ie[i]){if(n!==1||i!==1)do if(n--,i--,0>i||z[n]!==ie[i]){var ge=`
`+z[n].replace(" at new "," at ");return t.displayName&&ge.includes("<anonymous>")&&(ge=ge.replace("<anonymous>",t.displayName)),ge}while(1<=n&&0<=i);break}}}finally{At=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?ft(s):""}function Le(t,a){switch(t.tag){case 26:case 27:case 5:return ft(t.type);case 16:return ft("Lazy");case 13:return t.child!==a&&a!==null?ft("Suspense Fallback"):ft("Suspense");case 19:return ft("SuspenseList");case 0:case 15:return lt(t.type,!1);case 11:return lt(t.type.render,!1);case 1:return lt(t.type,!0);case 31:return ft("Activity");default:return""}}function Wt(t){try{var a="",s=null;do a+=Le(t,s),s=t,t=t.return;while(t);return a}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var A=Object.prototype.hasOwnProperty,E=l.unstable_scheduleCallback,fe=l.unstable_cancelCallback,xe=l.unstable_shouldYield,G=l.unstable_requestPaint,_e=l.unstable_now,Ye=l.unstable_getCurrentPriorityLevel,qe=l.unstable_ImmediatePriority,We=l.unstable_UserBlockingPriority,wt=l.unstable_NormalPriority,Ie=l.unstable_LowPriority,kt=l.unstable_IdlePriority,Ft=l.log,Ot=l.unstable_setDisableYieldValue,Ut=null,ut=null;function Rt(t){if(typeof Ft=="function"&&Ot(t),ut&&typeof ut.setStrictMode=="function")try{ut.setStrictMode(Ut,t)}catch{}}var _t=Math.clz32?Math.clz32:ue,le=Math.log,Se=Math.LN2;function ue(t){return t>>>=0,t===0?32:31-(le(t)/Se|0)|0}var Xe=256,St=262144,Et=4194304;function ct(t){var a=t&42;if(a!==0)return a;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function It(t,a,s){var n=t.pendingLanes;if(n===0)return 0;var i=0,d=t.suspendedLanes,h=t.pingedLanes;t=t.warmLanes;var b=n&134217727;return b!==0?(n=b&~d,n!==0?i=ct(n):(h&=b,h!==0?i=ct(h):s||(s=b&~t,s!==0&&(i=ct(s))))):(b=n&~d,b!==0?i=ct(b):h!==0?i=ct(h):s||(s=n&~t,s!==0&&(i=ct(s)))),i===0?0:a!==0&&a!==i&&(a&d)===0&&(d=i&-i,s=a&-a,d>=s||d===32&&(s&4194048)!==0)?a:i}function Jt(t,a){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&a)===0}function ta(t,a){switch(t){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function N(){var t=Et;return Et<<=1,(Et&62914560)===0&&(Et=4194304),t}function pe(t){for(var a=[],s=0;31>s;s++)a.push(t);return a}function W(t,a){t.pendingLanes|=a,a!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function he(t,a,s,n,i,d){var h=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var b=t.entanglements,z=t.expirationTimes,ie=t.hiddenUpdates;for(s=h&~s;0<s;){var ge=31-_t(s),ye=1<<ge;b[ge]=0,z[ge]=-1;var oe=ie[ge];if(oe!==null)for(ie[ge]=null,ge=0;ge<oe.length;ge++){var de=oe[ge];de!==null&&(de.lane&=-536870913)}s&=~ye}n!==0&&Ce(t,n,0),d!==0&&i===0&&t.tag!==0&&(t.suspendedLanes|=d&~(h&~a))}function Ce(t,a,s){t.pendingLanes|=a,t.suspendedLanes&=~a;var n=31-_t(a);t.entangledLanes|=a,t.entanglements[n]=t.entanglements[n]|1073741824|s&261930}function ke(t,a){var s=t.entangledLanes|=a;for(t=t.entanglements;s;){var n=31-_t(s),i=1<<n;i&a|t[n]&a&&(t[n]|=a),s&=~i}}function Re(t,a){var s=a&-a;return s=(s&42)!==0?1:et(s),(s&(t.suspendedLanes|a))!==0?0:s}function et(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Ze(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function Ee(){var t=M.p;return t!==0?t:(t=window.event,t===void 0?32:Xh(t.type))}function De(t,a){var s=M.p;try{return M.p=t,a()}finally{M.p=s}}var Be=Math.random().toString(36).slice(2),Fe="__reactFiber$"+Be,pt="__reactProps$"+Be,zt="__reactContainer$"+Be,Me="__reactEvents$"+Be,Ge="__reactListeners$"+Be,aa="__reactHandles$"+Be,es="__reactResources$"+Be,Va="__reactMarker$"+Be;function hl(t){delete t[Fe],delete t[pt],delete t[Me],delete t[Ge],delete t[aa]}function Ga(t){var a=t[Fe];if(a)return a;for(var s=t.parentNode;s;){if(a=s[zt]||s[Fe]){if(s=a.alternate,a.child!==null||s!==null&&s.child!==null)for(t=Th(t);t!==null;){if(s=t[Fe])return s;t=Th(t)}return a}t=s,s=t.parentNode}return null}function Ss(t){if(t=t[Fe]||t[zt]){var a=t.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return t}return null}function Cs(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t.stateNode;throw Error(c(33))}function Ya(t){var a=t[es];return a||(a=t[es]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Lt(t){t[Va]=!0}var fl=new Set,pl={};function ts(t,a){as(t,a),as(t+"Capture",a)}function as(t,a){for(pl[t]=a,t=0;t<a.length;t++)fl.add(a[t])}var pr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),En={},gl={};function Oi(t){return A.call(gl,t)?!0:A.call(En,t)?!1:pr.test(t)?gl[t]=!0:(En[t]=!0,!1)}function ja(t,a,s){if(Oi(a))if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(a);return;case"boolean":var n=a.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){t.removeAttribute(a);return}}t.setAttribute(a,""+s)}}function ua(t,a,s){if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(a);return}t.setAttribute(a,""+s)}}function La(t,a,s,n){if(n===null)t.removeAttribute(s);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(a,s,""+n)}}function oa(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function pd(t){var a=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function lp(t,a,s){var n=Object.getOwnPropertyDescriptor(t.constructor.prototype,a);if(!t.hasOwnProperty(a)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,d=n.set;return Object.defineProperty(t,a,{configurable:!0,get:function(){return i.call(this)},set:function(h){s=""+h,d.call(this,h)}}),Object.defineProperty(t,a,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(h){s=""+h},stopTracking:function(){t._valueTracker=null,delete t[a]}}}}function Ui(t){if(!t._valueTracker){var a=pd(t)?"checked":"value";t._valueTracker=lp(t,a,""+t[a])}}function gd(t){if(!t)return!1;var a=t._valueTracker;if(!a)return!0;var s=a.getValue(),n="";return t&&(n=pd(t)?t.checked?"true":"false":t.value),t=n,t!==s?(a.setValue(t),!0):!1}function gr(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var rp=/[\n"\\]/g;function ka(t){return t.replace(rp,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Li(t,a,s,n,i,d,h,b){t.name="",h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"?t.type=h:t.removeAttribute("type"),a!=null?h==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+oa(a)):t.value!==""+oa(a)&&(t.value=""+oa(a)):h!=="submit"&&h!=="reset"||t.removeAttribute("value"),a!=null?Bi(t,h,oa(a)):s!=null?Bi(t,h,oa(s)):n!=null&&t.removeAttribute("value"),i==null&&d!=null&&(t.defaultChecked=!!d),i!=null&&(t.checked=i&&typeof i!="function"&&typeof i!="symbol"),b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?t.name=""+oa(b):t.removeAttribute("name")}function xd(t,a,s,n,i,d,h,b){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(t.type=d),a!=null||s!=null){if(!(d!=="submit"&&d!=="reset"||a!=null)){Ui(t);return}s=s!=null?""+oa(s):"",a=a!=null?""+oa(a):s,b||a===t.value||(t.value=a),t.defaultValue=a}n=n??i,n=typeof n!="function"&&typeof n!="symbol"&&!!n,t.checked=b?t.checked:!!n,t.defaultChecked=!!n,h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(t.name=h),Ui(t)}function Bi(t,a,s){a==="number"&&gr(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function Dn(t,a,s,n){if(t=t.options,a){a={};for(var i=0;i<s.length;i++)a["$"+s[i]]=!0;for(s=0;s<t.length;s++)i=a.hasOwnProperty("$"+t[s].value),t[s].selected!==i&&(t[s].selected=i),i&&n&&(t[s].defaultSelected=!0)}else{for(s=""+oa(s),a=null,i=0;i<t.length;i++){if(t[i].value===s){t[i].selected=!0,n&&(t[i].defaultSelected=!0);return}a!==null||t[i].disabled||(a=t[i])}a!==null&&(a.selected=!0)}}function jd(t,a,s){if(a!=null&&(a=""+oa(a),a!==t.value&&(t.value=a),s==null)){t.defaultValue!==a&&(t.defaultValue=a);return}t.defaultValue=s!=null?""+oa(s):""}function vd(t,a,s,n){if(a==null){if(n!=null){if(s!=null)throw Error(c(92));if(ae(n)){if(1<n.length)throw Error(c(93));n=n[0]}s=n}s==null&&(s=""),a=s}s=oa(a),t.defaultValue=s,n=t.textContent,n===s&&n!==""&&n!==null&&(t.value=n),Ui(t)}function Mn(t,a){if(a){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=a;return}}t.textContent=a}var ip=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function yd(t,a,s){var n=a.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?n?t.setProperty(a,""):a==="float"?t.cssFloat="":t[a]="":n?t.setProperty(a,s):typeof s!="number"||s===0||ip.has(a)?a==="float"?t.cssFloat=s:t[a]=(""+s).trim():t[a]=s+"px"}function bd(t,a,s){if(a!=null&&typeof a!="object")throw Error(c(62));if(t=t.style,s!=null){for(var n in s)!s.hasOwnProperty(n)||a!=null&&a.hasOwnProperty(n)||(n.indexOf("--")===0?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="");for(var i in a)n=a[i],a.hasOwnProperty(i)&&s[i]!==n&&yd(t,i,n)}else for(var d in a)a.hasOwnProperty(d)&&yd(t,d,a[d])}function Hi(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),op=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function xr(t){return op.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function ss(){}var Fi=null;function $i(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Tn=null,An=null;function _d(t){var a=Ss(t);if(a&&(t=a.stateNode)){var s=t[pt]||null;e:switch(t=a.stateNode,a.type){case"input":if(Li(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),a=s.name,s.type==="radio"&&a!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+ka(""+a)+'"][type="radio"]'),a=0;a<s.length;a++){var n=s[a];if(n!==t&&n.form===t.form){var i=n[pt]||null;if(!i)throw Error(c(90));Li(n,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(a=0;a<s.length;a++)n=s[a],n.form===t.form&&gd(n)}break e;case"textarea":jd(t,s.value,s.defaultValue);break e;case"select":a=s.value,a!=null&&Dn(t,!!s.multiple,a,!1)}}}var Vi=!1;function Nd(t,a,s){if(Vi)return t(a,s);Vi=!0;try{var n=t(a);return n}finally{if(Vi=!1,(Tn!==null||An!==null)&&(ni(),Tn&&(a=Tn,t=An,An=Tn=null,_d(a),t)))for(a=0;a<t.length;a++)_d(t[a])}}function xl(t,a){var s=t.stateNode;if(s===null)return null;var n=s[pt]||null;if(n===null)return null;s=n[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(c(231,a,typeof s));return s}var ns=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Gi=!1;if(ns)try{var jl={};Object.defineProperty(jl,"passive",{get:function(){Gi=!0}}),window.addEventListener("test",jl,jl),window.removeEventListener("test",jl,jl)}catch{Gi=!1}var ws=null,Yi=null,jr=null;function Sd(){if(jr)return jr;var t,a=Yi,s=a.length,n,i="value"in ws?ws.value:ws.textContent,d=i.length;for(t=0;t<s&&a[t]===i[t];t++);var h=s-t;for(n=1;n<=h&&a[s-n]===i[d-n];n++);return jr=i.slice(t,1<n?1-n:void 0)}function vr(t){var a=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&a===13&&(t=13)):t=a,t===10&&(t=13),32<=t||t===13?t:0}function yr(){return!0}function Cd(){return!1}function ma(t){function a(s,n,i,d,h){this._reactName=s,this._targetInst=i,this.type=n,this.nativeEvent=d,this.target=h,this.currentTarget=null;for(var b in t)t.hasOwnProperty(b)&&(s=t[b],this[b]=s?s(d):d[b]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?yr:Cd,this.isPropagationStopped=Cd,this}return R(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=yr)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=yr)},persist:function(){},isPersistent:yr}),a}var an={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},br=ma(an),vl=R({},an,{view:0,detail:0}),dp=ma(vl),Qi,Xi,yl,_r=R({},vl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pi,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==yl&&(yl&&t.type==="mousemove"?(Qi=t.screenX-yl.screenX,Xi=t.screenY-yl.screenY):Xi=Qi=0,yl=t),Qi)},movementY:function(t){return"movementY"in t?t.movementY:Xi}}),wd=ma(_r),up=R({},_r,{dataTransfer:0}),mp=ma(up),hp=R({},vl,{relatedTarget:0}),Zi=ma(hp),fp=R({},an,{animationName:0,elapsedTime:0,pseudoElement:0}),pp=ma(fp),gp=R({},an,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),xp=ma(gp),jp=R({},an,{data:0}),kd=ma(jp),vp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _p(t){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(t):(t=bp[t])?!!a[t]:!1}function Pi(){return _p}var Np=R({},vl,{key:function(t){if(t.key){var a=vp[t.key]||t.key;if(a!=="Unidentified")return a}return t.type==="keypress"?(t=vr(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?yp[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pi,charCode:function(t){return t.type==="keypress"?vr(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?vr(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Sp=ma(Np),Cp=R({},_r,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ed=ma(Cp),wp=R({},vl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pi}),kp=ma(wp),Ep=R({},an,{propertyName:0,elapsedTime:0,pseudoElement:0}),Dp=ma(Ep),Mp=R({},_r,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Tp=ma(Mp),Ap=R({},an,{newState:0,oldState:0}),Rp=ma(Ap),zp=[9,13,27,32],Ii=ns&&"CompositionEvent"in window,bl=null;ns&&"documentMode"in document&&(bl=document.documentMode);var qp=ns&&"TextEvent"in window&&!bl,Dd=ns&&(!Ii||bl&&8<bl&&11>=bl),Md=" ",Td=!1;function Ad(t,a){switch(t){case"keyup":return zp.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rd(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Rn=!1;function Op(t,a){switch(t){case"compositionend":return Rd(a);case"keypress":return a.which!==32?null:(Td=!0,Md);case"textInput":return t=a.data,t===Md&&Td?null:t;default:return null}}function Up(t,a){if(Rn)return t==="compositionend"||!Ii&&Ad(t,a)?(t=Sd(),jr=Yi=ws=null,Rn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Dd&&a.locale!=="ko"?null:a.data;default:return null}}var Lp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zd(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a==="input"?!!Lp[t.type]:a==="textarea"}function qd(t,a,s,n){Tn?An?An.push(n):An=[n]:Tn=n,a=ui(a,"onChange"),0<a.length&&(s=new br("onChange","change",null,s,n),t.push({event:s,listeners:a}))}var _l=null,Nl=null;function Bp(t){xh(t,0)}function Nr(t){var a=Cs(t);if(gd(a))return t}function Od(t,a){if(t==="change")return a}var Ud=!1;if(ns){var Ji;if(ns){var Ki="oninput"in document;if(!Ki){var Ld=document.createElement("div");Ld.setAttribute("oninput","return;"),Ki=typeof Ld.oninput=="function"}Ji=Ki}else Ji=!1;Ud=Ji&&(!document.documentMode||9<document.documentMode)}function Bd(){_l&&(_l.detachEvent("onpropertychange",Hd),Nl=_l=null)}function Hd(t){if(t.propertyName==="value"&&Nr(Nl)){var a=[];qd(a,Nl,t,$i(t)),Nd(Bp,a)}}function Hp(t,a,s){t==="focusin"?(Bd(),_l=a,Nl=s,_l.attachEvent("onpropertychange",Hd)):t==="focusout"&&Bd()}function Fp(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Nr(Nl)}function $p(t,a){if(t==="click")return Nr(a)}function Vp(t,a){if(t==="input"||t==="change")return Nr(a)}function Gp(t,a){return t===a&&(t!==0||1/t===1/a)||t!==t&&a!==a}var va=typeof Object.is=="function"?Object.is:Gp;function Sl(t,a){if(va(t,a))return!0;if(typeof t!="object"||t===null||typeof a!="object"||a===null)return!1;var s=Object.keys(t),n=Object.keys(a);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var i=s[n];if(!A.call(a,i)||!va(t[i],a[i]))return!1}return!0}function Fd(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function $d(t,a){var s=Fd(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=a&&n>=a)return{node:s,offset:a-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Fd(s)}}function Vd(t,a){return t&&a?t===a?!0:t&&t.nodeType===3?!1:a&&a.nodeType===3?Vd(t,a.parentNode):"contains"in t?t.contains(a):t.compareDocumentPosition?!!(t.compareDocumentPosition(a)&16):!1:!1}function Gd(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var a=gr(t.document);a instanceof t.HTMLIFrameElement;){try{var s=typeof a.contentWindow.location.href=="string"}catch{s=!1}if(s)t=a.contentWindow;else break;a=gr(t.document)}return a}function Wi(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a&&(a==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||a==="textarea"||t.contentEditable==="true")}var Yp=ns&&"documentMode"in document&&11>=document.documentMode,zn=null,ec=null,Cl=null,tc=!1;function Yd(t,a,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;tc||zn==null||zn!==gr(n)||(n=zn,"selectionStart"in n&&Wi(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Cl&&Sl(Cl,n)||(Cl=n,n=ui(ec,"onSelect"),0<n.length&&(a=new br("onSelect","select",null,a,s),t.push({event:a,listeners:n}),a.target=zn)))}function sn(t,a){var s={};return s[t.toLowerCase()]=a.toLowerCase(),s["Webkit"+t]="webkit"+a,s["Moz"+t]="moz"+a,s}var qn={animationend:sn("Animation","AnimationEnd"),animationiteration:sn("Animation","AnimationIteration"),animationstart:sn("Animation","AnimationStart"),transitionrun:sn("Transition","TransitionRun"),transitionstart:sn("Transition","TransitionStart"),transitioncancel:sn("Transition","TransitionCancel"),transitionend:sn("Transition","TransitionEnd")},ac={},Qd={};ns&&(Qd=document.createElement("div").style,"AnimationEvent"in window||(delete qn.animationend.animation,delete qn.animationiteration.animation,delete qn.animationstart.animation),"TransitionEvent"in window||delete qn.transitionend.transition);function nn(t){if(ac[t])return ac[t];if(!qn[t])return t;var a=qn[t],s;for(s in a)if(a.hasOwnProperty(s)&&s in Qd)return ac[t]=a[s];return t}var Xd=nn("animationend"),Zd=nn("animationiteration"),Pd=nn("animationstart"),Qp=nn("transitionrun"),Xp=nn("transitionstart"),Zp=nn("transitioncancel"),Id=nn("transitionend"),Jd=new Map,sc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");sc.push("scrollEnd");function Ba(t,a){Jd.set(t,a),ts(a,[t])}var Sr=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},Ea=[],On=0,nc=0;function Cr(){for(var t=On,a=nc=On=0;a<t;){var s=Ea[a];Ea[a++]=null;var n=Ea[a];Ea[a++]=null;var i=Ea[a];Ea[a++]=null;var d=Ea[a];if(Ea[a++]=null,n!==null&&i!==null){var h=n.pending;h===null?i.next=i:(i.next=h.next,h.next=i),n.pending=i}d!==0&&Kd(s,i,d)}}function wr(t,a,s,n){Ea[On++]=t,Ea[On++]=a,Ea[On++]=s,Ea[On++]=n,nc|=n,t.lanes|=n,t=t.alternate,t!==null&&(t.lanes|=n)}function lc(t,a,s,n){return wr(t,a,s,n),kr(t)}function ln(t,a){return wr(t,null,null,a),kr(t)}function Kd(t,a,s){t.lanes|=s;var n=t.alternate;n!==null&&(n.lanes|=s);for(var i=!1,d=t.return;d!==null;)d.childLanes|=s,n=d.alternate,n!==null&&(n.childLanes|=s),d.tag===22&&(t=d.stateNode,t===null||t._visibility&1||(i=!0)),t=d,d=d.return;return t.tag===3?(d=t.stateNode,i&&a!==null&&(i=31-_t(s),t=d.hiddenUpdates,n=t[i],n===null?t[i]=[a]:n.push(a),a.lane=s|536870912),d):null}function kr(t){if(50<Xl)throw Xl=0,po=null,Error(c(185));for(var a=t.return;a!==null;)t=a,a=t.return;return t.tag===3?t.stateNode:null}var Un={};function Pp(t,a,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ya(t,a,s,n){return new Pp(t,a,s,n)}function rc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ls(t,a){var s=t.alternate;return s===null?(s=ya(t.tag,a,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=a,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,a=t.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function Wd(t,a){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=a,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,a=s.dependencies,t.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),t}function Er(t,a,s,n,i,d){var h=0;if(n=t,typeof t=="function")rc(t)&&(h=1);else if(typeof t=="string")h=ex(t,s,ve.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case F:return t=ya(31,s,a,i),t.elementType=F,t.lanes=d,t;case L:return rn(s.children,i,d,a);case q:h=8,i|=24;break;case ee:return t=ya(12,s,a,i|2),t.elementType=ee,t.lanes=d,t;case se:return t=ya(13,s,a,i),t.elementType=se,t.lanes=d,t;case ne:return t=ya(19,s,a,i),t.elementType=ne,t.lanes=d,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case D:h=10;break e;case T:h=9;break e;case w:h=11;break e;case P:h=14;break e;case I:h=16,n=null;break e}h=29,s=Error(c(130,t===null?"null":typeof t,"")),n=null}return a=ya(h,s,a,i),a.elementType=t,a.type=n,a.lanes=d,a}function rn(t,a,s,n){return t=ya(7,t,n,a),t.lanes=s,t}function ic(t,a,s){return t=ya(6,t,null,a),t.lanes=s,t}function eu(t){var a=ya(18,null,null,0);return a.stateNode=t,a}function cc(t,a,s){return a=ya(4,t.children!==null?t.children:[],t.key,a),a.lanes=s,a.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},a}var tu=new WeakMap;function Da(t,a){if(typeof t=="object"&&t!==null){var s=tu.get(t);return s!==void 0?s:(a={value:t,source:a,stack:Wt(a)},tu.set(t,a),a)}return{value:t,source:a,stack:Wt(a)}}var Ln=[],Bn=0,Dr=null,wl=0,Ma=[],Ta=0,ks=null,Qa=1,Xa="";function rs(t,a){Ln[Bn++]=wl,Ln[Bn++]=Dr,Dr=t,wl=a}function au(t,a,s){Ma[Ta++]=Qa,Ma[Ta++]=Xa,Ma[Ta++]=ks,ks=t;var n=Qa;t=Xa;var i=32-_t(n)-1;n&=~(1<<i),s+=1;var d=32-_t(a)+i;if(30<d){var h=i-i%5;d=(n&(1<<h)-1).toString(32),n>>=h,i-=h,Qa=1<<32-_t(a)+i|s<<i|n,Xa=d+t}else Qa=1<<d|s<<i|n,Xa=t}function oc(t){t.return!==null&&(rs(t,1),au(t,1,0))}function dc(t){for(;t===Dr;)Dr=Ln[--Bn],Ln[Bn]=null,wl=Ln[--Bn],Ln[Bn]=null;for(;t===ks;)ks=Ma[--Ta],Ma[Ta]=null,Xa=Ma[--Ta],Ma[Ta]=null,Qa=Ma[--Ta],Ma[Ta]=null}function su(t,a){Ma[Ta++]=Qa,Ma[Ta++]=Xa,Ma[Ta++]=ks,Qa=a.id,Xa=a.overflow,ks=t}var sa=null,Dt=null,rt=!1,Es=null,Aa=!1,uc=Error(c(519));function Ds(t){var a=Error(c(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw kl(Da(a,t)),uc}function nu(t){var a=t.stateNode,s=t.type,n=t.memoizedProps;switch(a[Fe]=t,a[pt]=n,s){case"dialog":at("cancel",a),at("close",a);break;case"iframe":case"object":case"embed":at("load",a);break;case"video":case"audio":for(s=0;s<Pl.length;s++)at(Pl[s],a);break;case"source":at("error",a);break;case"img":case"image":case"link":at("error",a),at("load",a);break;case"details":at("toggle",a);break;case"input":at("invalid",a),xd(a,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":at("invalid",a);break;case"textarea":at("invalid",a),vd(a,n.value,n.defaultValue,n.children)}s=n.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||a.textContent===""+s||n.suppressHydrationWarning===!0||bh(a.textContent,s)?(n.popover!=null&&(at("beforetoggle",a),at("toggle",a)),n.onScroll!=null&&at("scroll",a),n.onScrollEnd!=null&&at("scrollend",a),n.onClick!=null&&(a.onclick=ss),a=!0):a=!1,a||Ds(t,!0)}function lu(t){for(sa=t.return;sa;)switch(sa.tag){case 5:case 31:case 13:Aa=!1;return;case 27:case 3:Aa=!0;return;default:sa=sa.return}}function Hn(t){if(t!==sa)return!1;if(!rt)return lu(t),rt=!0,!1;var a=t.tag,s;if((s=a!==3&&a!==27)&&((s=a===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||Mo(t.type,t.memoizedProps)),s=!s),s&&Dt&&Ds(t),lu(t),a===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(317));Dt=Mh(t)}else if(a===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(317));Dt=Mh(t)}else a===27?(a=Dt,Vs(t.type)?(t=qo,qo=null,Dt=t):Dt=a):Dt=sa?za(t.stateNode.nextSibling):null;return!0}function cn(){Dt=sa=null,rt=!1}function mc(){var t=Es;return t!==null&&(ga===null?ga=t:ga.push.apply(ga,t),Es=null),t}function kl(t){Es===null?Es=[t]:Es.push(t)}var hc=O(null),on=null,is=null;function Ms(t,a,s){H(hc,a._currentValue),a._currentValue=s}function cs(t){t._currentValue=hc.current,$(hc)}function fc(t,a,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&a)!==a?(t.childLanes|=a,n!==null&&(n.childLanes|=a)):n!==null&&(n.childLanes&a)!==a&&(n.childLanes|=a),t===s)break;t=t.return}}function pc(t,a,s,n){var i=t.child;for(i!==null&&(i.return=t);i!==null;){var d=i.dependencies;if(d!==null){var h=i.child;d=d.firstContext;e:for(;d!==null;){var b=d;d=i;for(var z=0;z<a.length;z++)if(b.context===a[z]){d.lanes|=s,b=d.alternate,b!==null&&(b.lanes|=s),fc(d.return,s,t),n||(h=null);break e}d=b.next}}else if(i.tag===18){if(h=i.return,h===null)throw Error(c(341));h.lanes|=s,d=h.alternate,d!==null&&(d.lanes|=s),fc(h,s,t),h=null}else h=i.child;if(h!==null)h.return=i;else for(h=i;h!==null;){if(h===t){h=null;break}if(i=h.sibling,i!==null){i.return=h.return,h=i;break}h=h.return}i=h}}function Fn(t,a,s,n){t=null;for(var i=a,d=!1;i!==null;){if(!d){if((i.flags&524288)!==0)d=!0;else if((i.flags&262144)!==0)break}if(i.tag===10){var h=i.alternate;if(h===null)throw Error(c(387));if(h=h.memoizedProps,h!==null){var b=i.type;va(i.pendingProps.value,h.value)||(t!==null?t.push(b):t=[b])}}else if(i===be.current){if(h=i.alternate,h===null)throw Error(c(387));h.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(t!==null?t.push(er):t=[er])}i=i.return}t!==null&&pc(a,t,s,n),a.flags|=262144}function Mr(t){for(t=t.firstContext;t!==null;){if(!va(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function dn(t){on=t,is=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function na(t){return ru(on,t)}function Tr(t,a){return on===null&&dn(t),ru(t,a)}function ru(t,a){var s=a._currentValue;if(a={context:a,memoizedValue:s,next:null},is===null){if(t===null)throw Error(c(308));is=a,t.dependencies={lanes:0,firstContext:a},t.flags|=524288}else is=is.next=a;return s}var Ip=typeof AbortController<"u"?AbortController:function(){var t=[],a=this.signal={aborted:!1,addEventListener:function(s,n){t.push(n)}};this.abort=function(){a.aborted=!0,t.forEach(function(s){return s()})}},Jp=l.unstable_scheduleCallback,Kp=l.unstable_NormalPriority,Qt={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function gc(){return{controller:new Ip,data:new Map,refCount:0}}function El(t){t.refCount--,t.refCount===0&&Jp(Kp,function(){t.controller.abort()})}var Dl=null,xc=0,$n=0,Vn=null;function Wp(t,a){if(Dl===null){var s=Dl=[];xc=0,$n=bo(),Vn={status:"pending",value:void 0,then:function(n){s.push(n)}}}return xc++,a.then(iu,iu),a}function iu(){if(--xc===0&&Dl!==null){Vn!==null&&(Vn.status="fulfilled");var t=Dl;Dl=null,$n=0,Vn=null;for(var a=0;a<t.length;a++)(0,t[a])()}}function eg(t,a){var s=[],n={status:"pending",value:null,reason:null,then:function(i){s.push(i)}};return t.then(function(){n.status="fulfilled",n.value=a;for(var i=0;i<s.length;i++)(0,s[i])(a)},function(i){for(n.status="rejected",n.reason=i,i=0;i<s.length;i++)(0,s[i])(void 0)}),n}var cu=k.S;k.S=function(t,a){Ym=_e(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&Wp(t,a),cu!==null&&cu(t,a)};var un=O(null);function jc(){var t=un.current;return t!==null?t:Nt.pooledCache}function Ar(t,a){a===null?H(un,un.current):H(un,a.pool)}function ou(){var t=jc();return t===null?null:{parent:Qt._currentValue,pool:t}}var Gn=Error(c(460)),vc=Error(c(474)),Rr=Error(c(542)),zr={then:function(){}};function du(t){return t=t.status,t==="fulfilled"||t==="rejected"}function uu(t,a,s){switch(s=t[s],s===void 0?t.push(a):s!==a&&(a.then(ss,ss),a=s),a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,hu(t),t;default:if(typeof a.status=="string")a.then(ss,ss);else{if(t=Nt,t!==null&&100<t.shellSuspendCounter)throw Error(c(482));t=a,t.status="pending",t.then(function(n){if(a.status==="pending"){var i=a;i.status="fulfilled",i.value=n}},function(n){if(a.status==="pending"){var i=a;i.status="rejected",i.reason=n}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,hu(t),t}throw hn=a,Gn}}function mn(t){try{var a=t._init;return a(t._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(hn=s,Gn):s}}var hn=null;function mu(){if(hn===null)throw Error(c(459));var t=hn;return hn=null,t}function hu(t){if(t===Gn||t===Rr)throw Error(c(483))}var Yn=null,Ml=0;function qr(t){var a=Ml;return Ml+=1,Yn===null&&(Yn=[]),uu(Yn,t,a)}function Tl(t,a){a=a.props.ref,t.ref=a!==void 0?a:null}function Or(t,a){throw a.$$typeof===X?Error(c(525)):(t=Object.prototype.toString.call(a),Error(c(31,t==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":t)))}function fu(t){function a(te,Y){if(t){var re=te.deletions;re===null?(te.deletions=[Y],te.flags|=16):re.push(Y)}}function s(te,Y){if(!t)return null;for(;Y!==null;)a(te,Y),Y=Y.sibling;return null}function n(te){for(var Y=new Map;te!==null;)te.key!==null?Y.set(te.key,te):Y.set(te.index,te),te=te.sibling;return Y}function i(te,Y){return te=ls(te,Y),te.index=0,te.sibling=null,te}function d(te,Y,re){return te.index=re,t?(re=te.alternate,re!==null?(re=re.index,re<Y?(te.flags|=67108866,Y):re):(te.flags|=67108866,Y)):(te.flags|=1048576,Y)}function h(te){return t&&te.alternate===null&&(te.flags|=67108866),te}function b(te,Y,re,je){return Y===null||Y.tag!==6?(Y=ic(re,te.mode,je),Y.return=te,Y):(Y=i(Y,re),Y.return=te,Y)}function z(te,Y,re,je){var $e=re.type;return $e===L?ge(te,Y,re.props.children,je,re.key):Y!==null&&(Y.elementType===$e||typeof $e=="object"&&$e!==null&&$e.$$typeof===I&&mn($e)===Y.type)?(Y=i(Y,re.props),Tl(Y,re),Y.return=te,Y):(Y=Er(re.type,re.key,re.props,null,te.mode,je),Tl(Y,re),Y.return=te,Y)}function ie(te,Y,re,je){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==re.containerInfo||Y.stateNode.implementation!==re.implementation?(Y=cc(re,te.mode,je),Y.return=te,Y):(Y=i(Y,re.children||[]),Y.return=te,Y)}function ge(te,Y,re,je,$e){return Y===null||Y.tag!==7?(Y=rn(re,te.mode,je,$e),Y.return=te,Y):(Y=i(Y,re),Y.return=te,Y)}function ye(te,Y,re){if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return Y=ic(""+Y,te.mode,re),Y.return=te,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case B:return re=Er(Y.type,Y.key,Y.props,null,te.mode,re),Tl(re,Y),re.return=te,re;case V:return Y=cc(Y,te.mode,re),Y.return=te,Y;case I:return Y=mn(Y),ye(te,Y,re)}if(ae(Y)||j(Y))return Y=rn(Y,te.mode,re,null),Y.return=te,Y;if(typeof Y.then=="function")return ye(te,qr(Y),re);if(Y.$$typeof===D)return ye(te,Tr(te,Y),re);Or(te,Y)}return null}function oe(te,Y,re,je){var $e=Y!==null?Y.key:null;if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return $e!==null?null:b(te,Y,""+re,je);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case B:return re.key===$e?z(te,Y,re,je):null;case V:return re.key===$e?ie(te,Y,re,je):null;case I:return re=mn(re),oe(te,Y,re,je)}if(ae(re)||j(re))return $e!==null?null:ge(te,Y,re,je,null);if(typeof re.then=="function")return oe(te,Y,qr(re),je);if(re.$$typeof===D)return oe(te,Y,Tr(te,re),je);Or(te,re)}return null}function de(te,Y,re,je,$e){if(typeof je=="string"&&je!==""||typeof je=="number"||typeof je=="bigint")return te=te.get(re)||null,b(Y,te,""+je,$e);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case B:return te=te.get(je.key===null?re:je.key)||null,z(Y,te,je,$e);case V:return te=te.get(je.key===null?re:je.key)||null,ie(Y,te,je,$e);case I:return je=mn(je),de(te,Y,re,je,$e)}if(ae(je)||j(je))return te=te.get(re)||null,ge(Y,te,je,$e,null);if(typeof je.then=="function")return de(te,Y,re,qr(je),$e);if(je.$$typeof===D)return de(te,Y,re,Tr(Y,je),$e);Or(Y,je)}return null}function ze(te,Y,re,je){for(var $e=null,ot=null,Oe=Y,Ke=Y=0,nt=null;Oe!==null&&Ke<re.length;Ke++){Oe.index>Ke?(nt=Oe,Oe=null):nt=Oe.sibling;var dt=oe(te,Oe,re[Ke],je);if(dt===null){Oe===null&&(Oe=nt);break}t&&Oe&&dt.alternate===null&&a(te,Oe),Y=d(dt,Y,Ke),ot===null?$e=dt:ot.sibling=dt,ot=dt,Oe=nt}if(Ke===re.length)return s(te,Oe),rt&&rs(te,Ke),$e;if(Oe===null){for(;Ke<re.length;Ke++)Oe=ye(te,re[Ke],je),Oe!==null&&(Y=d(Oe,Y,Ke),ot===null?$e=Oe:ot.sibling=Oe,ot=Oe);return rt&&rs(te,Ke),$e}for(Oe=n(Oe);Ke<re.length;Ke++)nt=de(Oe,te,Ke,re[Ke],je),nt!==null&&(t&&nt.alternate!==null&&Oe.delete(nt.key===null?Ke:nt.key),Y=d(nt,Y,Ke),ot===null?$e=nt:ot.sibling=nt,ot=nt);return t&&Oe.forEach(function(Zs){return a(te,Zs)}),rt&&rs(te,Ke),$e}function Qe(te,Y,re,je){if(re==null)throw Error(c(151));for(var $e=null,ot=null,Oe=Y,Ke=Y=0,nt=null,dt=re.next();Oe!==null&&!dt.done;Ke++,dt=re.next()){Oe.index>Ke?(nt=Oe,Oe=null):nt=Oe.sibling;var Zs=oe(te,Oe,dt.value,je);if(Zs===null){Oe===null&&(Oe=nt);break}t&&Oe&&Zs.alternate===null&&a(te,Oe),Y=d(Zs,Y,Ke),ot===null?$e=Zs:ot.sibling=Zs,ot=Zs,Oe=nt}if(dt.done)return s(te,Oe),rt&&rs(te,Ke),$e;if(Oe===null){for(;!dt.done;Ke++,dt=re.next())dt=ye(te,dt.value,je),dt!==null&&(Y=d(dt,Y,Ke),ot===null?$e=dt:ot.sibling=dt,ot=dt);return rt&&rs(te,Ke),$e}for(Oe=n(Oe);!dt.done;Ke++,dt=re.next())dt=de(Oe,te,Ke,dt.value,je),dt!==null&&(t&&dt.alternate!==null&&Oe.delete(dt.key===null?Ke:dt.key),Y=d(dt,Y,Ke),ot===null?$e=dt:ot.sibling=dt,ot=dt);return t&&Oe.forEach(function(ux){return a(te,ux)}),rt&&rs(te,Ke),$e}function yt(te,Y,re,je){if(typeof re=="object"&&re!==null&&re.type===L&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case B:e:{for(var $e=re.key;Y!==null;){if(Y.key===$e){if($e=re.type,$e===L){if(Y.tag===7){s(te,Y.sibling),je=i(Y,re.props.children),je.return=te,te=je;break e}}else if(Y.elementType===$e||typeof $e=="object"&&$e!==null&&$e.$$typeof===I&&mn($e)===Y.type){s(te,Y.sibling),je=i(Y,re.props),Tl(je,re),je.return=te,te=je;break e}s(te,Y);break}else a(te,Y);Y=Y.sibling}re.type===L?(je=rn(re.props.children,te.mode,je,re.key),je.return=te,te=je):(je=Er(re.type,re.key,re.props,null,te.mode,je),Tl(je,re),je.return=te,te=je)}return h(te);case V:e:{for($e=re.key;Y!==null;){if(Y.key===$e)if(Y.tag===4&&Y.stateNode.containerInfo===re.containerInfo&&Y.stateNode.implementation===re.implementation){s(te,Y.sibling),je=i(Y,re.children||[]),je.return=te,te=je;break e}else{s(te,Y);break}else a(te,Y);Y=Y.sibling}je=cc(re,te.mode,je),je.return=te,te=je}return h(te);case I:return re=mn(re),yt(te,Y,re,je)}if(ae(re))return ze(te,Y,re,je);if(j(re)){if($e=j(re),typeof $e!="function")throw Error(c(150));return re=$e.call(re),Qe(te,Y,re,je)}if(typeof re.then=="function")return yt(te,Y,qr(re),je);if(re.$$typeof===D)return yt(te,Y,Tr(te,re),je);Or(te,re)}return typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint"?(re=""+re,Y!==null&&Y.tag===6?(s(te,Y.sibling),je=i(Y,re),je.return=te,te=je):(s(te,Y),je=ic(re,te.mode,je),je.return=te,te=je),h(te)):s(te,Y)}return function(te,Y,re,je){try{Ml=0;var $e=yt(te,Y,re,je);return Yn=null,$e}catch(Oe){if(Oe===Gn||Oe===Rr)throw Oe;var ot=ya(29,Oe,null,te.mode);return ot.lanes=je,ot.return=te,ot}finally{}}}var fn=fu(!0),pu=fu(!1),Ts=!1;function yc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function bc(t,a){t=t.updateQueue,a.updateQueue===t&&(a.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function As(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Rs(t,a,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(mt&2)!==0){var i=n.pending;return i===null?a.next=a:(a.next=i.next,i.next=a),n.pending=a,a=kr(t),Kd(t,null,s),a}return wr(t,n,a,s),kr(t)}function Al(t,a,s){if(a=a.updateQueue,a!==null&&(a=a.shared,(s&4194048)!==0)){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,ke(t,s)}}function _c(t,a){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var i=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var h={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};d===null?i=d=h:d=d.next=h,s=s.next}while(s!==null);d===null?i=d=a:d=d.next=a}else i=d=a;s={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:d,shared:n.shared,callbacks:n.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=a:t.next=a,s.lastBaseUpdate=a}var Nc=!1;function Rl(){if(Nc){var t=Vn;if(t!==null)throw t}}function zl(t,a,s,n){Nc=!1;var i=t.updateQueue;Ts=!1;var d=i.firstBaseUpdate,h=i.lastBaseUpdate,b=i.shared.pending;if(b!==null){i.shared.pending=null;var z=b,ie=z.next;z.next=null,h===null?d=ie:h.next=ie,h=z;var ge=t.alternate;ge!==null&&(ge=ge.updateQueue,b=ge.lastBaseUpdate,b!==h&&(b===null?ge.firstBaseUpdate=ie:b.next=ie,ge.lastBaseUpdate=z))}if(d!==null){var ye=i.baseState;h=0,ge=ie=z=null,b=d;do{var oe=b.lane&-536870913,de=oe!==b.lane;if(de?(st&oe)===oe:(n&oe)===oe){oe!==0&&oe===$n&&(Nc=!0),ge!==null&&(ge=ge.next={lane:0,tag:b.tag,payload:b.payload,callback:null,next:null});e:{var ze=t,Qe=b;oe=a;var yt=s;switch(Qe.tag){case 1:if(ze=Qe.payload,typeof ze=="function"){ye=ze.call(yt,ye,oe);break e}ye=ze;break e;case 3:ze.flags=ze.flags&-65537|128;case 0:if(ze=Qe.payload,oe=typeof ze=="function"?ze.call(yt,ye,oe):ze,oe==null)break e;ye=R({},ye,oe);break e;case 2:Ts=!0}}oe=b.callback,oe!==null&&(t.flags|=64,de&&(t.flags|=8192),de=i.callbacks,de===null?i.callbacks=[oe]:de.push(oe))}else de={lane:oe,tag:b.tag,payload:b.payload,callback:b.callback,next:null},ge===null?(ie=ge=de,z=ye):ge=ge.next=de,h|=oe;if(b=b.next,b===null){if(b=i.shared.pending,b===null)break;de=b,b=de.next,de.next=null,i.lastBaseUpdate=de,i.shared.pending=null}}while(!0);ge===null&&(z=ye),i.baseState=z,i.firstBaseUpdate=ie,i.lastBaseUpdate=ge,d===null&&(i.shared.lanes=0),Ls|=h,t.lanes=h,t.memoizedState=ye}}function gu(t,a){if(typeof t!="function")throw Error(c(191,t));t.call(a)}function xu(t,a){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)gu(s[t],a)}var Qn=O(null),Ur=O(0);function ju(t,a){t=xs,H(Ur,t),H(Qn,a),xs=t|a.baseLanes}function Sc(){H(Ur,xs),H(Qn,Qn.current)}function Cc(){xs=Ur.current,$(Qn),$(Ur)}var ba=O(null),Ra=null;function zs(t){var a=t.alternate;H($t,$t.current&1),H(ba,t),Ra===null&&(a===null||Qn.current!==null||a.memoizedState!==null)&&(Ra=t)}function wc(t){H($t,$t.current),H(ba,t),Ra===null&&(Ra=t)}function vu(t){t.tag===22?(H($t,$t.current),H(ba,t),Ra===null&&(Ra=t)):qs()}function qs(){H($t,$t.current),H(ba,ba.current)}function _a(t){$(ba),Ra===t&&(Ra=null),$($t)}var $t=O(0);function Lr(t){for(var a=t;a!==null;){if(a.tag===13){var s=a.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||Ro(s)||zo(s)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var os=0,Je=null,jt=null,Xt=null,Br=!1,Xn=!1,pn=!1,Hr=0,ql=0,Zn=null,tg=0;function Bt(){throw Error(c(321))}function kc(t,a){if(a===null)return!1;for(var s=0;s<a.length&&s<t.length;s++)if(!va(t[s],a[s]))return!1;return!0}function Ec(t,a,s,n,i,d){return os=d,Je=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,k.H=t===null||t.memoizedState===null?am:Vc,pn=!1,d=s(n,i),pn=!1,Xn&&(d=bu(a,s,n,i)),yu(t),d}function yu(t){k.H=Ll;var a=jt!==null&&jt.next!==null;if(os=0,Xt=jt=Je=null,Br=!1,ql=0,Zn=null,a)throw Error(c(300));t===null||Zt||(t=t.dependencies,t!==null&&Mr(t)&&(Zt=!0))}function bu(t,a,s,n){Je=t;var i=0;do{if(Xn&&(Zn=null),ql=0,Xn=!1,25<=i)throw Error(c(301));if(i+=1,Xt=jt=null,t.updateQueue!=null){var d=t.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}k.H=sm,d=a(s,n)}while(Xn);return d}function ag(){var t=k.H,a=t.useState()[0];return a=typeof a.then=="function"?Ol(a):a,t=t.useState()[0],(jt!==null?jt.memoizedState:null)!==t&&(Je.flags|=1024),a}function Dc(){var t=Hr!==0;return Hr=0,t}function Mc(t,a,s){a.updateQueue=t.updateQueue,a.flags&=-2053,t.lanes&=~s}function Tc(t){if(Br){for(t=t.memoizedState;t!==null;){var a=t.queue;a!==null&&(a.pending=null),t=t.next}Br=!1}os=0,Xt=jt=Je=null,Xn=!1,ql=Hr=0,Zn=null}function da(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xt===null?Je.memoizedState=Xt=t:Xt=Xt.next=t,Xt}function Vt(){if(jt===null){var t=Je.alternate;t=t!==null?t.memoizedState:null}else t=jt.next;var a=Xt===null?Je.memoizedState:Xt.next;if(a!==null)Xt=a,jt=t;else{if(t===null)throw Je.alternate===null?Error(c(467)):Error(c(310));jt=t,t={memoizedState:jt.memoizedState,baseState:jt.baseState,baseQueue:jt.baseQueue,queue:jt.queue,next:null},Xt===null?Je.memoizedState=Xt=t:Xt=Xt.next=t}return Xt}function Fr(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ol(t){var a=ql;return ql+=1,Zn===null&&(Zn=[]),t=uu(Zn,t,a),a=Je,(Xt===null?a.memoizedState:Xt.next)===null&&(a=a.alternate,k.H=a===null||a.memoizedState===null?am:Vc),t}function $r(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Ol(t);if(t.$$typeof===D)return na(t)}throw Error(c(438,String(t)))}function Ac(t){var a=null,s=Je.updateQueue;if(s!==null&&(a=s.memoCache),a==null){var n=Je.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(a={data:n.data.map(function(i){return i.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),s===null&&(s=Fr(),Je.updateQueue=s),s.memoCache=a,s=a.data[a.index],s===void 0)for(s=a.data[a.index]=Array(t),n=0;n<t;n++)s[n]=J;return a.index++,s}function ds(t,a){return typeof a=="function"?a(t):a}function Vr(t){var a=Vt();return Rc(a,jt,t)}function Rc(t,a,s){var n=t.queue;if(n===null)throw Error(c(311));n.lastRenderedReducer=s;var i=t.baseQueue,d=n.pending;if(d!==null){if(i!==null){var h=i.next;i.next=d.next,d.next=h}a.baseQueue=i=d,n.pending=null}if(d=t.baseState,i===null)t.memoizedState=d;else{a=i.next;var b=h=null,z=null,ie=a,ge=!1;do{var ye=ie.lane&-536870913;if(ye!==ie.lane?(st&ye)===ye:(os&ye)===ye){var oe=ie.revertLane;if(oe===0)z!==null&&(z=z.next={lane:0,revertLane:0,gesture:null,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null}),ye===$n&&(ge=!0);else if((os&oe)===oe){ie=ie.next,oe===$n&&(ge=!0);continue}else ye={lane:0,revertLane:ie.revertLane,gesture:null,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},z===null?(b=z=ye,h=d):z=z.next=ye,Je.lanes|=oe,Ls|=oe;ye=ie.action,pn&&s(d,ye),d=ie.hasEagerState?ie.eagerState:s(d,ye)}else oe={lane:ye,revertLane:ie.revertLane,gesture:ie.gesture,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},z===null?(b=z=oe,h=d):z=z.next=oe,Je.lanes|=ye,Ls|=ye;ie=ie.next}while(ie!==null&&ie!==a);if(z===null?h=d:z.next=b,!va(d,t.memoizedState)&&(Zt=!0,ge&&(s=Vn,s!==null)))throw s;t.memoizedState=d,t.baseState=h,t.baseQueue=z,n.lastRenderedState=d}return i===null&&(n.lanes=0),[t.memoizedState,n.dispatch]}function zc(t){var a=Vt(),s=a.queue;if(s===null)throw Error(c(311));s.lastRenderedReducer=t;var n=s.dispatch,i=s.pending,d=a.memoizedState;if(i!==null){s.pending=null;var h=i=i.next;do d=t(d,h.action),h=h.next;while(h!==i);va(d,a.memoizedState)||(Zt=!0),a.memoizedState=d,a.baseQueue===null&&(a.baseState=d),s.lastRenderedState=d}return[d,n]}function _u(t,a,s){var n=Je,i=Vt(),d=rt;if(d){if(s===void 0)throw Error(c(407));s=s()}else s=a();var h=!va((jt||i).memoizedState,s);if(h&&(i.memoizedState=s,Zt=!0),i=i.queue,Uc(Cu.bind(null,n,i,t),[t]),i.getSnapshot!==a||h||Xt!==null&&Xt.memoizedState.tag&1){if(n.flags|=2048,Pn(9,{destroy:void 0},Su.bind(null,n,i,s,a),null),Nt===null)throw Error(c(349));d||(os&127)!==0||Nu(n,a,s)}return s}function Nu(t,a,s){t.flags|=16384,t={getSnapshot:a,value:s},a=Je.updateQueue,a===null?(a=Fr(),Je.updateQueue=a,a.stores=[t]):(s=a.stores,s===null?a.stores=[t]:s.push(t))}function Su(t,a,s,n){a.value=s,a.getSnapshot=n,wu(a)&&ku(t)}function Cu(t,a,s){return s(function(){wu(a)&&ku(t)})}function wu(t){var a=t.getSnapshot;t=t.value;try{var s=a();return!va(t,s)}catch{return!0}}function ku(t){var a=ln(t,2);a!==null&&xa(a,t,2)}function qc(t){var a=da();if(typeof t=="function"){var s=t;if(t=s(),pn){Rt(!0);try{s()}finally{Rt(!1)}}}return a.memoizedState=a.baseState=t,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ds,lastRenderedState:t},a}function Eu(t,a,s,n){return t.baseState=s,Rc(t,jt,typeof n=="function"?n:ds)}function sg(t,a,s,n,i){if(Qr(t))throw Error(c(485));if(t=a.action,t!==null){var d={payload:i,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(h){d.listeners.push(h)}};k.T!==null?s(!0):d.isTransition=!1,n(d),s=a.pending,s===null?(d.next=a.pending=d,Du(a,d)):(d.next=s.next,a.pending=s.next=d)}}function Du(t,a){var s=a.action,n=a.payload,i=t.state;if(a.isTransition){var d=k.T,h={};k.T=h;try{var b=s(i,n),z=k.S;z!==null&&z(h,b),Mu(t,a,b)}catch(ie){Oc(t,a,ie)}finally{d!==null&&h.types!==null&&(d.types=h.types),k.T=d}}else try{d=s(i,n),Mu(t,a,d)}catch(ie){Oc(t,a,ie)}}function Mu(t,a,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(n){Tu(t,a,n)},function(n){return Oc(t,a,n)}):Tu(t,a,s)}function Tu(t,a,s){a.status="fulfilled",a.value=s,Au(a),t.state=s,a=t.pending,a!==null&&(s=a.next,s===a?t.pending=null:(s=s.next,a.next=s,Du(t,s)))}function Oc(t,a,s){var n=t.pending;if(t.pending=null,n!==null){n=n.next;do a.status="rejected",a.reason=s,Au(a),a=a.next;while(a!==n)}t.action=null}function Au(t){t=t.listeners;for(var a=0;a<t.length;a++)(0,t[a])()}function Ru(t,a){return a}function zu(t,a){if(rt){var s=Nt.formState;if(s!==null){e:{var n=Je;if(rt){if(Dt){t:{for(var i=Dt,d=Aa;i.nodeType!==8;){if(!d){i=null;break t}if(i=za(i.nextSibling),i===null){i=null;break t}}d=i.data,i=d==="F!"||d==="F"?i:null}if(i){Dt=za(i.nextSibling),n=i.data==="F!";break e}}Ds(n)}n=!1}n&&(a=s[0])}}return s=da(),s.memoizedState=s.baseState=a,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ru,lastRenderedState:a},s.queue=n,s=Wu.bind(null,Je,n),n.dispatch=s,n=qc(!1),d=$c.bind(null,Je,!1,n.queue),n=da(),i={state:a,dispatch:null,action:t,pending:null},n.queue=i,s=sg.bind(null,Je,i,d,s),i.dispatch=s,n.memoizedState=t,[a,s,!1]}function qu(t){var a=Vt();return Ou(a,jt,t)}function Ou(t,a,s){if(a=Rc(t,a,Ru)[0],t=Vr(ds)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var n=Ol(a)}catch(h){throw h===Gn?Rr:h}else n=a;a=Vt();var i=a.queue,d=i.dispatch;return s!==a.memoizedState&&(Je.flags|=2048,Pn(9,{destroy:void 0},ng.bind(null,i,s),null)),[n,d,t]}function ng(t,a){t.action=a}function Uu(t){var a=Vt(),s=jt;if(s!==null)return Ou(a,s,t);Vt(),a=a.memoizedState,s=Vt();var n=s.queue.dispatch;return s.memoizedState=t,[a,n,!1]}function Pn(t,a,s,n){return t={tag:t,create:s,deps:n,inst:a,next:null},a=Je.updateQueue,a===null&&(a=Fr(),Je.updateQueue=a),s=a.lastEffect,s===null?a.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,a.lastEffect=t),t}function Lu(){return Vt().memoizedState}function Gr(t,a,s,n){var i=da();Je.flags|=t,i.memoizedState=Pn(1|a,{destroy:void 0},s,n===void 0?null:n)}function Yr(t,a,s,n){var i=Vt();n=n===void 0?null:n;var d=i.memoizedState.inst;jt!==null&&n!==null&&kc(n,jt.memoizedState.deps)?i.memoizedState=Pn(a,d,s,n):(Je.flags|=t,i.memoizedState=Pn(1|a,d,s,n))}function Bu(t,a){Gr(8390656,8,t,a)}function Uc(t,a){Yr(2048,8,t,a)}function lg(t){Je.flags|=4;var a=Je.updateQueue;if(a===null)a=Fr(),Je.updateQueue=a,a.events=[t];else{var s=a.events;s===null?a.events=[t]:s.push(t)}}function Hu(t){var a=Vt().memoizedState;return lg({ref:a,nextImpl:t}),function(){if((mt&2)!==0)throw Error(c(440));return a.impl.apply(void 0,arguments)}}function Fu(t,a){return Yr(4,2,t,a)}function $u(t,a){return Yr(4,4,t,a)}function Vu(t,a){if(typeof a=="function"){t=t();var s=a(t);return function(){typeof s=="function"?s():a(null)}}if(a!=null)return t=t(),a.current=t,function(){a.current=null}}function Gu(t,a,s){s=s!=null?s.concat([t]):null,Yr(4,4,Vu.bind(null,a,t),s)}function Lc(){}function Yu(t,a){var s=Vt();a=a===void 0?null:a;var n=s.memoizedState;return a!==null&&kc(a,n[1])?n[0]:(s.memoizedState=[t,a],t)}function Qu(t,a){var s=Vt();a=a===void 0?null:a;var n=s.memoizedState;if(a!==null&&kc(a,n[1]))return n[0];if(n=t(),pn){Rt(!0);try{t()}finally{Rt(!1)}}return s.memoizedState=[n,a],n}function Bc(t,a,s){return s===void 0||(os&1073741824)!==0&&(st&261930)===0?t.memoizedState=a:(t.memoizedState=s,t=Xm(),Je.lanes|=t,Ls|=t,s)}function Xu(t,a,s,n){return va(s,a)?s:Qn.current!==null?(t=Bc(t,s,n),va(t,a)||(Zt=!0),t):(os&42)===0||(os&1073741824)!==0&&(st&261930)===0?(Zt=!0,t.memoizedState=s):(t=Xm(),Je.lanes|=t,Ls|=t,a)}function Zu(t,a,s,n,i){var d=M.p;M.p=d!==0&&8>d?d:8;var h=k.T,b={};k.T=b,$c(t,!1,a,s);try{var z=i(),ie=k.S;if(ie!==null&&ie(b,z),z!==null&&typeof z=="object"&&typeof z.then=="function"){var ge=eg(z,n);Ul(t,a,ge,Ca(t))}else Ul(t,a,n,Ca(t))}catch(ye){Ul(t,a,{then:function(){},status:"rejected",reason:ye},Ca())}finally{M.p=d,h!==null&&b.types!==null&&(h.types=b.types),k.T=h}}function rg(){}function Hc(t,a,s,n){if(t.tag!==5)throw Error(c(476));var i=Pu(t).queue;Zu(t,i,a,C,s===null?rg:function(){return Iu(t),s(n)})}function Pu(t){var a=t.memoizedState;if(a!==null)return a;a={memoizedState:C,baseState:C,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ds,lastRenderedState:C},next:null};var s={};return a.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ds,lastRenderedState:s},next:null},t.memoizedState=a,t=t.alternate,t!==null&&(t.memoizedState=a),a}function Iu(t){var a=Pu(t);a.next===null&&(a=t.alternate.memoizedState),Ul(t,a.next.queue,{},Ca())}function Fc(){return na(er)}function Ju(){return Vt().memoizedState}function Ku(){return Vt().memoizedState}function ig(t){for(var a=t.return;a!==null;){switch(a.tag){case 24:case 3:var s=Ca();t=As(s);var n=Rs(a,t,s);n!==null&&(xa(n,a,s),Al(n,a,s)),a={cache:gc()},t.payload=a;return}a=a.return}}function cg(t,a,s){var n=Ca();s={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},Qr(t)?em(a,s):(s=lc(t,a,s,n),s!==null&&(xa(s,t,n),tm(s,a,n)))}function Wu(t,a,s){var n=Ca();Ul(t,a,s,n)}function Ul(t,a,s,n){var i={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(Qr(t))em(a,i);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=a.lastRenderedReducer,d!==null))try{var h=a.lastRenderedState,b=d(h,s);if(i.hasEagerState=!0,i.eagerState=b,va(b,h))return wr(t,a,i,0),Nt===null&&Cr(),!1}catch{}finally{}if(s=lc(t,a,i,n),s!==null)return xa(s,t,n),tm(s,a,n),!0}return!1}function $c(t,a,s,n){if(n={lane:2,revertLane:bo(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Qr(t)){if(a)throw Error(c(479))}else a=lc(t,s,n,2),a!==null&&xa(a,t,2)}function Qr(t){var a=t.alternate;return t===Je||a!==null&&a===Je}function em(t,a){Xn=Br=!0;var s=t.pending;s===null?a.next=a:(a.next=s.next,s.next=a),t.pending=a}function tm(t,a,s){if((s&4194048)!==0){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,ke(t,s)}}var Ll={readContext:na,use:$r,useCallback:Bt,useContext:Bt,useEffect:Bt,useImperativeHandle:Bt,useLayoutEffect:Bt,useInsertionEffect:Bt,useMemo:Bt,useReducer:Bt,useRef:Bt,useState:Bt,useDebugValue:Bt,useDeferredValue:Bt,useTransition:Bt,useSyncExternalStore:Bt,useId:Bt,useHostTransitionStatus:Bt,useFormState:Bt,useActionState:Bt,useOptimistic:Bt,useMemoCache:Bt,useCacheRefresh:Bt};Ll.useEffectEvent=Bt;var am={readContext:na,use:$r,useCallback:function(t,a){return da().memoizedState=[t,a===void 0?null:a],t},useContext:na,useEffect:Bu,useImperativeHandle:function(t,a,s){s=s!=null?s.concat([t]):null,Gr(4194308,4,Vu.bind(null,a,t),s)},useLayoutEffect:function(t,a){return Gr(4194308,4,t,a)},useInsertionEffect:function(t,a){Gr(4,2,t,a)},useMemo:function(t,a){var s=da();a=a===void 0?null:a;var n=t();if(pn){Rt(!0);try{t()}finally{Rt(!1)}}return s.memoizedState=[n,a],n},useReducer:function(t,a,s){var n=da();if(s!==void 0){var i=s(a);if(pn){Rt(!0);try{s(a)}finally{Rt(!1)}}}else i=a;return n.memoizedState=n.baseState=i,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},n.queue=t,t=t.dispatch=cg.bind(null,Je,t),[n.memoizedState,t]},useRef:function(t){var a=da();return t={current:t},a.memoizedState=t},useState:function(t){t=qc(t);var a=t.queue,s=Wu.bind(null,Je,a);return a.dispatch=s,[t.memoizedState,s]},useDebugValue:Lc,useDeferredValue:function(t,a){var s=da();return Bc(s,t,a)},useTransition:function(){var t=qc(!1);return t=Zu.bind(null,Je,t.queue,!0,!1),da().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,a,s){var n=Je,i=da();if(rt){if(s===void 0)throw Error(c(407));s=s()}else{if(s=a(),Nt===null)throw Error(c(349));(st&127)!==0||Nu(n,a,s)}i.memoizedState=s;var d={value:s,getSnapshot:a};return i.queue=d,Bu(Cu.bind(null,n,d,t),[t]),n.flags|=2048,Pn(9,{destroy:void 0},Su.bind(null,n,d,s,a),null),s},useId:function(){var t=da(),a=Nt.identifierPrefix;if(rt){var s=Xa,n=Qa;s=(n&~(1<<32-_t(n)-1)).toString(32)+s,a="_"+a+"R_"+s,s=Hr++,0<s&&(a+="H"+s.toString(32)),a+="_"}else s=tg++,a="_"+a+"r_"+s.toString(32)+"_";return t.memoizedState=a},useHostTransitionStatus:Fc,useFormState:zu,useActionState:zu,useOptimistic:function(t){var a=da();a.memoizedState=a.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=s,a=$c.bind(null,Je,!0,s),s.dispatch=a,[t,a]},useMemoCache:Ac,useCacheRefresh:function(){return da().memoizedState=ig.bind(null,Je)},useEffectEvent:function(t){var a=da(),s={impl:t};return a.memoizedState=s,function(){if((mt&2)!==0)throw Error(c(440));return s.impl.apply(void 0,arguments)}}},Vc={readContext:na,use:$r,useCallback:Yu,useContext:na,useEffect:Uc,useImperativeHandle:Gu,useInsertionEffect:Fu,useLayoutEffect:$u,useMemo:Qu,useReducer:Vr,useRef:Lu,useState:function(){return Vr(ds)},useDebugValue:Lc,useDeferredValue:function(t,a){var s=Vt();return Xu(s,jt.memoizedState,t,a)},useTransition:function(){var t=Vr(ds)[0],a=Vt().memoizedState;return[typeof t=="boolean"?t:Ol(t),a]},useSyncExternalStore:_u,useId:Ju,useHostTransitionStatus:Fc,useFormState:qu,useActionState:qu,useOptimistic:function(t,a){var s=Vt();return Eu(s,jt,t,a)},useMemoCache:Ac,useCacheRefresh:Ku};Vc.useEffectEvent=Hu;var sm={readContext:na,use:$r,useCallback:Yu,useContext:na,useEffect:Uc,useImperativeHandle:Gu,useInsertionEffect:Fu,useLayoutEffect:$u,useMemo:Qu,useReducer:zc,useRef:Lu,useState:function(){return zc(ds)},useDebugValue:Lc,useDeferredValue:function(t,a){var s=Vt();return jt===null?Bc(s,t,a):Xu(s,jt.memoizedState,t,a)},useTransition:function(){var t=zc(ds)[0],a=Vt().memoizedState;return[typeof t=="boolean"?t:Ol(t),a]},useSyncExternalStore:_u,useId:Ju,useHostTransitionStatus:Fc,useFormState:Uu,useActionState:Uu,useOptimistic:function(t,a){var s=Vt();return jt!==null?Eu(s,jt,t,a):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:Ac,useCacheRefresh:Ku};sm.useEffectEvent=Hu;function Gc(t,a,s,n){a=t.memoizedState,s=s(n,a),s=s==null?a:R({},a,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var Yc={enqueueSetState:function(t,a,s){t=t._reactInternals;var n=Ca(),i=As(n);i.payload=a,s!=null&&(i.callback=s),a=Rs(t,i,n),a!==null&&(xa(a,t,n),Al(a,t,n))},enqueueReplaceState:function(t,a,s){t=t._reactInternals;var n=Ca(),i=As(n);i.tag=1,i.payload=a,s!=null&&(i.callback=s),a=Rs(t,i,n),a!==null&&(xa(a,t,n),Al(a,t,n))},enqueueForceUpdate:function(t,a){t=t._reactInternals;var s=Ca(),n=As(s);n.tag=2,a!=null&&(n.callback=a),a=Rs(t,n,s),a!==null&&(xa(a,t,s),Al(a,t,s))}};function nm(t,a,s,n,i,d,h){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,d,h):a.prototype&&a.prototype.isPureReactComponent?!Sl(s,n)||!Sl(i,d):!0}function lm(t,a,s,n){t=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(s,n),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(s,n),a.state!==t&&Yc.enqueueReplaceState(a,a.state,null)}function gn(t,a){var s=a;if("ref"in a){s={};for(var n in a)n!=="ref"&&(s[n]=a[n])}if(t=t.defaultProps){s===a&&(s=R({},s));for(var i in t)s[i]===void 0&&(s[i]=t[i])}return s}function rm(t){Sr(t)}function im(t){console.error(t)}function cm(t){Sr(t)}function Xr(t,a){try{var s=t.onUncaughtError;s(a.value,{componentStack:a.stack})}catch(n){setTimeout(function(){throw n})}}function om(t,a,s){try{var n=t.onCaughtError;n(s.value,{componentStack:s.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function Qc(t,a,s){return s=As(s),s.tag=3,s.payload={element:null},s.callback=function(){Xr(t,a)},s}function dm(t){return t=As(t),t.tag=3,t}function um(t,a,s,n){var i=s.type.getDerivedStateFromError;if(typeof i=="function"){var d=n.value;t.payload=function(){return i(d)},t.callback=function(){om(a,s,n)}}var h=s.stateNode;h!==null&&typeof h.componentDidCatch=="function"&&(t.callback=function(){om(a,s,n),typeof i!="function"&&(Bs===null?Bs=new Set([this]):Bs.add(this));var b=n.stack;this.componentDidCatch(n.value,{componentStack:b!==null?b:""})})}function og(t,a,s,n,i){if(s.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(a=s.alternate,a!==null&&Fn(a,s,i,!0),s=ba.current,s!==null){switch(s.tag){case 31:case 13:return Ra===null?li():s.alternate===null&&Ht===0&&(Ht=3),s.flags&=-257,s.flags|=65536,s.lanes=i,n===zr?s.flags|=16384:(a=s.updateQueue,a===null?s.updateQueue=new Set([n]):a.add(n),jo(t,n,i)),!1;case 22:return s.flags|=65536,n===zr?s.flags|=16384:(a=s.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([n])},s.updateQueue=a):(s=a.retryQueue,s===null?a.retryQueue=new Set([n]):s.add(n)),jo(t,n,i)),!1}throw Error(c(435,s.tag))}return jo(t,n,i),li(),!1}if(rt)return a=ba.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=i,n!==uc&&(t=Error(c(422),{cause:n}),kl(Da(t,s)))):(n!==uc&&(a=Error(c(423),{cause:n}),kl(Da(a,s))),t=t.current.alternate,t.flags|=65536,i&=-i,t.lanes|=i,n=Da(n,s),i=Qc(t.stateNode,n,i),_c(t,i),Ht!==4&&(Ht=2)),!1;var d=Error(c(520),{cause:n});if(d=Da(d,s),Ql===null?Ql=[d]:Ql.push(d),Ht!==4&&(Ht=2),a===null)return!0;n=Da(n,s),s=a;do{switch(s.tag){case 3:return s.flags|=65536,t=i&-i,s.lanes|=t,t=Qc(s.stateNode,n,t),_c(s,t),!1;case 1:if(a=s.type,d=s.stateNode,(s.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(Bs===null||!Bs.has(d))))return s.flags|=65536,i&=-i,s.lanes|=i,i=dm(i),um(i,t,s,n),_c(s,i),!1}s=s.return}while(s!==null);return!1}var Xc=Error(c(461)),Zt=!1;function la(t,a,s,n){a.child=t===null?pu(a,null,s,n):fn(a,t.child,s,n)}function mm(t,a,s,n,i){s=s.render;var d=a.ref;if("ref"in n){var h={};for(var b in n)b!=="ref"&&(h[b]=n[b])}else h=n;return dn(a),n=Ec(t,a,s,h,d,i),b=Dc(),t!==null&&!Zt?(Mc(t,a,i),us(t,a,i)):(rt&&b&&oc(a),a.flags|=1,la(t,a,n,i),a.child)}function hm(t,a,s,n,i){if(t===null){var d=s.type;return typeof d=="function"&&!rc(d)&&d.defaultProps===void 0&&s.compare===null?(a.tag=15,a.type=d,fm(t,a,d,n,i)):(t=Er(s.type,null,n,a,a.mode,i),t.ref=a.ref,t.return=a,a.child=t)}if(d=t.child,!to(t,i)){var h=d.memoizedProps;if(s=s.compare,s=s!==null?s:Sl,s(h,n)&&t.ref===a.ref)return us(t,a,i)}return a.flags|=1,t=ls(d,n),t.ref=a.ref,t.return=a,a.child=t}function fm(t,a,s,n,i){if(t!==null){var d=t.memoizedProps;if(Sl(d,n)&&t.ref===a.ref)if(Zt=!1,a.pendingProps=n=d,to(t,i))(t.flags&131072)!==0&&(Zt=!0);else return a.lanes=t.lanes,us(t,a,i)}return Zc(t,a,s,n,i)}function pm(t,a,s,n){var i=n.children,d=t!==null?t.memoizedState:null;if(t===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((a.flags&128)!==0){if(d=d!==null?d.baseLanes|s:s,t!==null){for(n=a.child=t.child,i=0;n!==null;)i=i|n.lanes|n.childLanes,n=n.sibling;n=i&~d}else n=0,a.child=null;return gm(t,a,d,s,n)}if((s&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},t!==null&&Ar(a,d!==null?d.cachePool:null),d!==null?ju(a,d):Sc(),vu(a);else return n=a.lanes=536870912,gm(t,a,d!==null?d.baseLanes|s:s,s,n)}else d!==null?(Ar(a,d.cachePool),ju(a,d),qs(),a.memoizedState=null):(t!==null&&Ar(a,null),Sc(),qs());return la(t,a,i,s),a.child}function Bl(t,a){return t!==null&&t.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function gm(t,a,s,n,i){var d=jc();return d=d===null?null:{parent:Qt._currentValue,pool:d},a.memoizedState={baseLanes:s,cachePool:d},t!==null&&Ar(a,null),Sc(),vu(a),t!==null&&Fn(t,a,n,!0),a.childLanes=i,null}function Zr(t,a){return a=Ir({mode:a.mode,children:a.children},t.mode),a.ref=t.ref,t.child=a,a.return=t,a}function xm(t,a,s){return fn(a,t.child,null,s),t=Zr(a,a.pendingProps),t.flags|=2,_a(a),a.memoizedState=null,t}function dg(t,a,s){var n=a.pendingProps,i=(a.flags&128)!==0;if(a.flags&=-129,t===null){if(rt){if(n.mode==="hidden")return t=Zr(a,n),a.lanes=536870912,Bl(null,t);if(wc(a),(t=Dt)?(t=Dh(t,Aa),t=t!==null&&t.data==="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:ks!==null?{id:Qa,overflow:Xa}:null,retryLane:536870912,hydrationErrors:null},s=eu(t),s.return=a,a.child=s,sa=a,Dt=null)):t=null,t===null)throw Ds(a);return a.lanes=536870912,null}return Zr(a,n)}var d=t.memoizedState;if(d!==null){var h=d.dehydrated;if(wc(a),i)if(a.flags&256)a.flags&=-257,a=xm(t,a,s);else if(a.memoizedState!==null)a.child=t.child,a.flags|=128,a=null;else throw Error(c(558));else if(Zt||Fn(t,a,s,!1),i=(s&t.childLanes)!==0,Zt||i){if(n=Nt,n!==null&&(h=Re(n,s),h!==0&&h!==d.retryLane))throw d.retryLane=h,ln(t,h),xa(n,t,h),Xc;li(),a=xm(t,a,s)}else t=d.treeContext,Dt=za(h.nextSibling),sa=a,rt=!0,Es=null,Aa=!1,t!==null&&su(a,t),a=Zr(a,n),a.flags|=4096;return a}return t=ls(t.child,{mode:n.mode,children:n.children}),t.ref=a.ref,a.child=t,t.return=a,t}function Pr(t,a){var s=a.ref;if(s===null)t!==null&&t.ref!==null&&(a.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(c(284));(t===null||t.ref!==s)&&(a.flags|=4194816)}}function Zc(t,a,s,n,i){return dn(a),s=Ec(t,a,s,n,void 0,i),n=Dc(),t!==null&&!Zt?(Mc(t,a,i),us(t,a,i)):(rt&&n&&oc(a),a.flags|=1,la(t,a,s,i),a.child)}function jm(t,a,s,n,i,d){return dn(a),a.updateQueue=null,s=bu(a,n,s,i),yu(t),n=Dc(),t!==null&&!Zt?(Mc(t,a,d),us(t,a,d)):(rt&&n&&oc(a),a.flags|=1,la(t,a,s,d),a.child)}function vm(t,a,s,n,i){if(dn(a),a.stateNode===null){var d=Un,h=s.contextType;typeof h=="object"&&h!==null&&(d=na(h)),d=new s(n,d),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Yc,a.stateNode=d,d._reactInternals=a,d=a.stateNode,d.props=n,d.state=a.memoizedState,d.refs={},yc(a),h=s.contextType,d.context=typeof h=="object"&&h!==null?na(h):Un,d.state=a.memoizedState,h=s.getDerivedStateFromProps,typeof h=="function"&&(Gc(a,s,h,n),d.state=a.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(h=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),h!==d.state&&Yc.enqueueReplaceState(d,d.state,null),zl(a,n,d,i),Rl(),d.state=a.memoizedState),typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!0}else if(t===null){d=a.stateNode;var b=a.memoizedProps,z=gn(s,b);d.props=z;var ie=d.context,ge=s.contextType;h=Un,typeof ge=="object"&&ge!==null&&(h=na(ge));var ye=s.getDerivedStateFromProps;ge=typeof ye=="function"||typeof d.getSnapshotBeforeUpdate=="function",b=a.pendingProps!==b,ge||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(b||ie!==h)&&lm(a,d,n,h),Ts=!1;var oe=a.memoizedState;d.state=oe,zl(a,n,d,i),Rl(),ie=a.memoizedState,b||oe!==ie||Ts?(typeof ye=="function"&&(Gc(a,s,ye,n),ie=a.memoizedState),(z=Ts||nm(a,s,z,n,oe,ie,h))?(ge||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(a.flags|=4194308)):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=n,a.memoizedState=ie),d.props=n,d.state=ie,d.context=h,n=z):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!1)}else{d=a.stateNode,bc(t,a),h=a.memoizedProps,ge=gn(s,h),d.props=ge,ye=a.pendingProps,oe=d.context,ie=s.contextType,z=Un,typeof ie=="object"&&ie!==null&&(z=na(ie)),b=s.getDerivedStateFromProps,(ie=typeof b=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==ye||oe!==z)&&lm(a,d,n,z),Ts=!1,oe=a.memoizedState,d.state=oe,zl(a,n,d,i),Rl();var de=a.memoizedState;h!==ye||oe!==de||Ts||t!==null&&t.dependencies!==null&&Mr(t.dependencies)?(typeof b=="function"&&(Gc(a,s,b,n),de=a.memoizedState),(ge=Ts||nm(a,s,ge,n,oe,de,z)||t!==null&&t.dependencies!==null&&Mr(t.dependencies))?(ie||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,de,z),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,de,z)),typeof d.componentDidUpdate=="function"&&(a.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=1024),a.memoizedProps=n,a.memoizedState=de),d.props=n,d.state=de,d.context=z,n=ge):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=1024),n=!1)}return d=n,Pr(t,a),n=(a.flags&128)!==0,d||n?(d=a.stateNode,s=n&&typeof s.getDerivedStateFromError!="function"?null:d.render(),a.flags|=1,t!==null&&n?(a.child=fn(a,t.child,null,i),a.child=fn(a,null,s,i)):la(t,a,s,i),a.memoizedState=d.state,t=a.child):t=us(t,a,i),t}function ym(t,a,s,n){return cn(),a.flags|=256,la(t,a,s,n),a.child}var Pc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ic(t){return{baseLanes:t,cachePool:ou()}}function Jc(t,a,s){return t=t!==null?t.childLanes&~s:0,a&&(t|=Sa),t}function bm(t,a,s){var n=a.pendingProps,i=!1,d=(a.flags&128)!==0,h;if((h=d)||(h=t!==null&&t.memoizedState===null?!1:($t.current&2)!==0),h&&(i=!0,a.flags&=-129),h=(a.flags&32)!==0,a.flags&=-33,t===null){if(rt){if(i?zs(a):qs(),(t=Dt)?(t=Dh(t,Aa),t=t!==null&&t.data!=="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:ks!==null?{id:Qa,overflow:Xa}:null,retryLane:536870912,hydrationErrors:null},s=eu(t),s.return=a,a.child=s,sa=a,Dt=null)):t=null,t===null)throw Ds(a);return zo(t)?a.lanes=32:a.lanes=536870912,null}var b=n.children;return n=n.fallback,i?(qs(),i=a.mode,b=Ir({mode:"hidden",children:b},i),n=rn(n,i,s,null),b.return=a,n.return=a,b.sibling=n,a.child=b,n=a.child,n.memoizedState=Ic(s),n.childLanes=Jc(t,h,s),a.memoizedState=Pc,Bl(null,n)):(zs(a),Kc(a,b))}var z=t.memoizedState;if(z!==null&&(b=z.dehydrated,b!==null)){if(d)a.flags&256?(zs(a),a.flags&=-257,a=Wc(t,a,s)):a.memoizedState!==null?(qs(),a.child=t.child,a.flags|=128,a=null):(qs(),b=n.fallback,i=a.mode,n=Ir({mode:"visible",children:n.children},i),b=rn(b,i,s,null),b.flags|=2,n.return=a,b.return=a,n.sibling=b,a.child=n,fn(a,t.child,null,s),n=a.child,n.memoizedState=Ic(s),n.childLanes=Jc(t,h,s),a.memoizedState=Pc,a=Bl(null,n));else if(zs(a),zo(b)){if(h=b.nextSibling&&b.nextSibling.dataset,h)var ie=h.dgst;h=ie,n=Error(c(419)),n.stack="",n.digest=h,kl({value:n,source:null,stack:null}),a=Wc(t,a,s)}else if(Zt||Fn(t,a,s,!1),h=(s&t.childLanes)!==0,Zt||h){if(h=Nt,h!==null&&(n=Re(h,s),n!==0&&n!==z.retryLane))throw z.retryLane=n,ln(t,n),xa(h,t,n),Xc;Ro(b)||li(),a=Wc(t,a,s)}else Ro(b)?(a.flags|=192,a.child=t.child,a=null):(t=z.treeContext,Dt=za(b.nextSibling),sa=a,rt=!0,Es=null,Aa=!1,t!==null&&su(a,t),a=Kc(a,n.children),a.flags|=4096);return a}return i?(qs(),b=n.fallback,i=a.mode,z=t.child,ie=z.sibling,n=ls(z,{mode:"hidden",children:n.children}),n.subtreeFlags=z.subtreeFlags&65011712,ie!==null?b=ls(ie,b):(b=rn(b,i,s,null),b.flags|=2),b.return=a,n.return=a,n.sibling=b,a.child=n,Bl(null,n),n=a.child,b=t.child.memoizedState,b===null?b=Ic(s):(i=b.cachePool,i!==null?(z=Qt._currentValue,i=i.parent!==z?{parent:z,pool:z}:i):i=ou(),b={baseLanes:b.baseLanes|s,cachePool:i}),n.memoizedState=b,n.childLanes=Jc(t,h,s),a.memoizedState=Pc,Bl(t.child,n)):(zs(a),s=t.child,t=s.sibling,s=ls(s,{mode:"visible",children:n.children}),s.return=a,s.sibling=null,t!==null&&(h=a.deletions,h===null?(a.deletions=[t],a.flags|=16):h.push(t)),a.child=s,a.memoizedState=null,s)}function Kc(t,a){return a=Ir({mode:"visible",children:a},t.mode),a.return=t,t.child=a}function Ir(t,a){return t=ya(22,t,null,a),t.lanes=0,t}function Wc(t,a,s){return fn(a,t.child,null,s),t=Kc(a,a.pendingProps.children),t.flags|=2,a.memoizedState=null,t}function _m(t,a,s){t.lanes|=a;var n=t.alternate;n!==null&&(n.lanes|=a),fc(t.return,a,s)}function eo(t,a,s,n,i,d){var h=t.memoizedState;h===null?t.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:i,treeForkCount:d}:(h.isBackwards=a,h.rendering=null,h.renderingStartTime=0,h.last=n,h.tail=s,h.tailMode=i,h.treeForkCount=d)}function Nm(t,a,s){var n=a.pendingProps,i=n.revealOrder,d=n.tail;n=n.children;var h=$t.current,b=(h&2)!==0;if(b?(h=h&1|2,a.flags|=128):h&=1,H($t,h),la(t,a,n,s),n=rt?wl:0,!b&&t!==null&&(t.flags&128)!==0)e:for(t=a.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&_m(t,s,a);else if(t.tag===19)_m(t,s,a);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===a)break e;for(;t.sibling===null;){if(t.return===null||t.return===a)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(i){case"forwards":for(s=a.child,i=null;s!==null;)t=s.alternate,t!==null&&Lr(t)===null&&(i=s),s=s.sibling;s=i,s===null?(i=a.child,a.child=null):(i=s.sibling,s.sibling=null),eo(a,!1,i,s,d,n);break;case"backwards":case"unstable_legacy-backwards":for(s=null,i=a.child,a.child=null;i!==null;){if(t=i.alternate,t!==null&&Lr(t)===null){a.child=i;break}t=i.sibling,i.sibling=s,s=i,i=t}eo(a,!0,s,null,d,n);break;case"together":eo(a,!1,null,null,void 0,n);break;default:a.memoizedState=null}return a.child}function us(t,a,s){if(t!==null&&(a.dependencies=t.dependencies),Ls|=a.lanes,(s&a.childLanes)===0)if(t!==null){if(Fn(t,a,s,!1),(s&a.childLanes)===0)return null}else return null;if(t!==null&&a.child!==t.child)throw Error(c(153));if(a.child!==null){for(t=a.child,s=ls(t,t.pendingProps),a.child=s,s.return=a;t.sibling!==null;)t=t.sibling,s=s.sibling=ls(t,t.pendingProps),s.return=a;s.sibling=null}return a.child}function to(t,a){return(t.lanes&a)!==0?!0:(t=t.dependencies,!!(t!==null&&Mr(t)))}function ug(t,a,s){switch(a.tag){case 3:Pe(a,a.stateNode.containerInfo),Ms(a,Qt,t.memoizedState.cache),cn();break;case 27:case 5:Te(a);break;case 4:Pe(a,a.stateNode.containerInfo);break;case 10:Ms(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,wc(a),null;break;case 13:var n=a.memoizedState;if(n!==null)return n.dehydrated!==null?(zs(a),a.flags|=128,null):(s&a.child.childLanes)!==0?bm(t,a,s):(zs(a),t=us(t,a,s),t!==null?t.sibling:null);zs(a);break;case 19:var i=(t.flags&128)!==0;if(n=(s&a.childLanes)!==0,n||(Fn(t,a,s,!1),n=(s&a.childLanes)!==0),i){if(n)return Nm(t,a,s);a.flags|=128}if(i=a.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),H($t,$t.current),n)break;return null;case 22:return a.lanes=0,pm(t,a,s,a.pendingProps);case 24:Ms(a,Qt,t.memoizedState.cache)}return us(t,a,s)}function Sm(t,a,s){if(t!==null)if(t.memoizedProps!==a.pendingProps)Zt=!0;else{if(!to(t,s)&&(a.flags&128)===0)return Zt=!1,ug(t,a,s);Zt=(t.flags&131072)!==0}else Zt=!1,rt&&(a.flags&1048576)!==0&&au(a,wl,a.index);switch(a.lanes=0,a.tag){case 16:e:{var n=a.pendingProps;if(t=mn(a.elementType),a.type=t,typeof t=="function")rc(t)?(n=gn(t,n),a.tag=1,a=vm(null,a,t,n,s)):(a.tag=0,a=Zc(null,a,t,n,s));else{if(t!=null){var i=t.$$typeof;if(i===w){a.tag=11,a=mm(null,a,t,n,s);break e}else if(i===P){a.tag=14,a=hm(null,a,t,n,s);break e}}throw a=S(t)||t,Error(c(306,a,""))}}return a;case 0:return Zc(t,a,a.type,a.pendingProps,s);case 1:return n=a.type,i=gn(n,a.pendingProps),vm(t,a,n,i,s);case 3:e:{if(Pe(a,a.stateNode.containerInfo),t===null)throw Error(c(387));n=a.pendingProps;var d=a.memoizedState;i=d.element,bc(t,a),zl(a,n,null,s);var h=a.memoizedState;if(n=h.cache,Ms(a,Qt,n),n!==d.cache&&pc(a,[Qt],s,!0),Rl(),n=h.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:h.cache},a.updateQueue.baseState=d,a.memoizedState=d,a.flags&256){a=ym(t,a,n,s);break e}else if(n!==i){i=Da(Error(c(424)),a),kl(i),a=ym(t,a,n,s);break e}else{switch(t=a.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Dt=za(t.firstChild),sa=a,rt=!0,Es=null,Aa=!0,s=pu(a,null,n,s),a.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(cn(),n===i){a=us(t,a,s);break e}la(t,a,n,s)}a=a.child}return a;case 26:return Pr(t,a),t===null?(s=qh(a.type,null,a.pendingProps,null))?a.memoizedState=s:rt||(s=a.type,t=a.pendingProps,n=mi(Ae.current).createElement(s),n[Fe]=a,n[pt]=t,ra(n,s,t),Lt(n),a.stateNode=n):a.memoizedState=qh(a.type,t.memoizedProps,a.pendingProps,t.memoizedState),null;case 27:return Te(a),t===null&&rt&&(n=a.stateNode=Ah(a.type,a.pendingProps,Ae.current),sa=a,Aa=!0,i=Dt,Vs(a.type)?(qo=i,Dt=za(n.firstChild)):Dt=i),la(t,a,a.pendingProps.children,s),Pr(t,a),t===null&&(a.flags|=4194304),a.child;case 5:return t===null&&rt&&((i=n=Dt)&&(n=Fg(n,a.type,a.pendingProps,Aa),n!==null?(a.stateNode=n,sa=a,Dt=za(n.firstChild),Aa=!1,i=!0):i=!1),i||Ds(a)),Te(a),i=a.type,d=a.pendingProps,h=t!==null?t.memoizedProps:null,n=d.children,Mo(i,d)?n=null:h!==null&&Mo(i,h)&&(a.flags|=32),a.memoizedState!==null&&(i=Ec(t,a,ag,null,null,s),er._currentValue=i),Pr(t,a),la(t,a,n,s),a.child;case 6:return t===null&&rt&&((t=s=Dt)&&(s=$g(s,a.pendingProps,Aa),s!==null?(a.stateNode=s,sa=a,Dt=null,t=!0):t=!1),t||Ds(a)),null;case 13:return bm(t,a,s);case 4:return Pe(a,a.stateNode.containerInfo),n=a.pendingProps,t===null?a.child=fn(a,null,n,s):la(t,a,n,s),a.child;case 11:return mm(t,a,a.type,a.pendingProps,s);case 7:return la(t,a,a.pendingProps,s),a.child;case 8:return la(t,a,a.pendingProps.children,s),a.child;case 12:return la(t,a,a.pendingProps.children,s),a.child;case 10:return n=a.pendingProps,Ms(a,a.type,n.value),la(t,a,n.children,s),a.child;case 9:return i=a.type._context,n=a.pendingProps.children,dn(a),i=na(i),n=n(i),a.flags|=1,la(t,a,n,s),a.child;case 14:return hm(t,a,a.type,a.pendingProps,s);case 15:return fm(t,a,a.type,a.pendingProps,s);case 19:return Nm(t,a,s);case 31:return dg(t,a,s);case 22:return pm(t,a,s,a.pendingProps);case 24:return dn(a),n=na(Qt),t===null?(i=jc(),i===null&&(i=Nt,d=gc(),i.pooledCache=d,d.refCount++,d!==null&&(i.pooledCacheLanes|=s),i=d),a.memoizedState={parent:n,cache:i},yc(a),Ms(a,Qt,i)):((t.lanes&s)!==0&&(bc(t,a),zl(a,null,null,s),Rl()),i=t.memoizedState,d=a.memoizedState,i.parent!==n?(i={parent:n,cache:n},a.memoizedState=i,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=i),Ms(a,Qt,n)):(n=d.cache,Ms(a,Qt,n),n!==i.cache&&pc(a,[Qt],s,!0))),la(t,a,a.pendingProps.children,s),a.child;case 29:throw a.pendingProps}throw Error(c(156,a.tag))}function ms(t){t.flags|=4}function ao(t,a,s,n,i){if((a=(t.mode&32)!==0)&&(a=!1),a){if(t.flags|=16777216,(i&335544128)===i)if(t.stateNode.complete)t.flags|=8192;else if(Jm())t.flags|=8192;else throw hn=zr,vc}else t.flags&=-16777217}function Cm(t,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!Hh(a))if(Jm())t.flags|=8192;else throw hn=zr,vc}function Jr(t,a){a!==null&&(t.flags|=4),t.flags&16384&&(a=t.tag!==22?N():536870912,t.lanes|=a,Wn|=a)}function Hl(t,a){if(!rt)switch(t.tailMode){case"hidden":a=t.tail;for(var s=null;a!==null;)a.alternate!==null&&(s=a),a=a.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?a||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Mt(t){var a=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(a)for(var i=t.child;i!==null;)s|=i.lanes|i.childLanes,n|=i.subtreeFlags&65011712,n|=i.flags&65011712,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)s|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=n,t.childLanes=s,a}function mg(t,a,s){var n=a.pendingProps;switch(dc(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mt(a),null;case 1:return Mt(a),null;case 3:return s=a.stateNode,n=null,t!==null&&(n=t.memoizedState.cache),a.memoizedState.cache!==n&&(a.flags|=2048),cs(Qt),Ve(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(Hn(a)?ms(a):t===null||t.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,mc())),Mt(a),null;case 26:var i=a.type,d=a.memoizedState;return t===null?(ms(a),d!==null?(Mt(a),Cm(a,d)):(Mt(a),ao(a,i,null,n,s))):d?d!==t.memoizedState?(ms(a),Mt(a),Cm(a,d)):(Mt(a),a.flags&=-16777217):(t=t.memoizedProps,t!==n&&ms(a),Mt(a),ao(a,i,t,n,s)),null;case 27:if(ht(a),s=Ae.current,i=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&ms(a);else{if(!n){if(a.stateNode===null)throw Error(c(166));return Mt(a),null}t=ve.current,Hn(a)?nu(a):(t=Ah(i,n,s),a.stateNode=t,ms(a))}return Mt(a),null;case 5:if(ht(a),i=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&ms(a);else{if(!n){if(a.stateNode===null)throw Error(c(166));return Mt(a),null}if(d=ve.current,Hn(a))nu(a);else{var h=mi(Ae.current);switch(d){case 1:d=h.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:d=h.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":d=h.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":d=h.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":d=h.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof n.is=="string"?h.createElement("select",{is:n.is}):h.createElement("select"),n.multiple?d.multiple=!0:n.size&&(d.size=n.size);break;default:d=typeof n.is=="string"?h.createElement(i,{is:n.is}):h.createElement(i)}}d[Fe]=a,d[pt]=n;e:for(h=a.child;h!==null;){if(h.tag===5||h.tag===6)d.appendChild(h.stateNode);else if(h.tag!==4&&h.tag!==27&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break e;for(;h.sibling===null;){if(h.return===null||h.return===a)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}a.stateNode=d;e:switch(ra(d,i,n),i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&ms(a)}}return Mt(a),ao(a,a.type,t===null?null:t.memoizedProps,a.pendingProps,s),null;case 6:if(t&&a.stateNode!=null)t.memoizedProps!==n&&ms(a);else{if(typeof n!="string"&&a.stateNode===null)throw Error(c(166));if(t=Ae.current,Hn(a)){if(t=a.stateNode,s=a.memoizedProps,n=null,i=sa,i!==null)switch(i.tag){case 27:case 5:n=i.memoizedProps}t[Fe]=a,t=!!(t.nodeValue===s||n!==null&&n.suppressHydrationWarning===!0||bh(t.nodeValue,s)),t||Ds(a,!0)}else t=mi(t).createTextNode(n),t[Fe]=a,a.stateNode=t}return Mt(a),null;case 31:if(s=a.memoizedState,t===null||t.memoizedState!==null){if(n=Hn(a),s!==null){if(t===null){if(!n)throw Error(c(318));if(t=a.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(557));t[Fe]=a}else cn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Mt(a),t=!1}else s=mc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),t=!0;if(!t)return a.flags&256?(_a(a),a):(_a(a),null);if((a.flags&128)!==0)throw Error(c(558))}return Mt(a),null;case 13:if(n=a.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(i=Hn(a),n!==null&&n.dehydrated!==null){if(t===null){if(!i)throw Error(c(318));if(i=a.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(c(317));i[Fe]=a}else cn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Mt(a),i=!1}else i=mc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=i),i=!0;if(!i)return a.flags&256?(_a(a),a):(_a(a),null)}return _a(a),(a.flags&128)!==0?(a.lanes=s,a):(s=n!==null,t=t!==null&&t.memoizedState!==null,s&&(n=a.child,i=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(i=n.alternate.memoizedState.cachePool.pool),d=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(d=n.memoizedState.cachePool.pool),d!==i&&(n.flags|=2048)),s!==t&&s&&(a.child.flags|=8192),Jr(a,a.updateQueue),Mt(a),null);case 4:return Ve(),t===null&&Co(a.stateNode.containerInfo),Mt(a),null;case 10:return cs(a.type),Mt(a),null;case 19:if($($t),n=a.memoizedState,n===null)return Mt(a),null;if(i=(a.flags&128)!==0,d=n.rendering,d===null)if(i)Hl(n,!1);else{if(Ht!==0||t!==null&&(t.flags&128)!==0)for(t=a.child;t!==null;){if(d=Lr(t),d!==null){for(a.flags|=128,Hl(n,!1),t=d.updateQueue,a.updateQueue=t,Jr(a,t),a.subtreeFlags=0,t=s,s=a.child;s!==null;)Wd(s,t),s=s.sibling;return H($t,$t.current&1|2),rt&&rs(a,n.treeForkCount),a.child}t=t.sibling}n.tail!==null&&_e()>ai&&(a.flags|=128,i=!0,Hl(n,!1),a.lanes=4194304)}else{if(!i)if(t=Lr(d),t!==null){if(a.flags|=128,i=!0,t=t.updateQueue,a.updateQueue=t,Jr(a,t),Hl(n,!0),n.tail===null&&n.tailMode==="hidden"&&!d.alternate&&!rt)return Mt(a),null}else 2*_e()-n.renderingStartTime>ai&&s!==536870912&&(a.flags|=128,i=!0,Hl(n,!1),a.lanes=4194304);n.isBackwards?(d.sibling=a.child,a.child=d):(t=n.last,t!==null?t.sibling=d:a.child=d,n.last=d)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=_e(),t.sibling=null,s=$t.current,H($t,i?s&1|2:s&1),rt&&rs(a,n.treeForkCount),t):(Mt(a),null);case 22:case 23:return _a(a),Cc(),n=a.memoizedState!==null,t!==null?t.memoizedState!==null!==n&&(a.flags|=8192):n&&(a.flags|=8192),n?(s&536870912)!==0&&(a.flags&128)===0&&(Mt(a),a.subtreeFlags&6&&(a.flags|=8192)):Mt(a),s=a.updateQueue,s!==null&&Jr(a,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),n=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(n=a.memoizedState.cachePool.pool),n!==s&&(a.flags|=2048),t!==null&&$(un),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),a.memoizedState.cache!==s&&(a.flags|=2048),cs(Qt),Mt(a),null;case 25:return null;case 30:return null}throw Error(c(156,a.tag))}function hg(t,a){switch(dc(a),a.tag){case 1:return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 3:return cs(Qt),Ve(),t=a.flags,(t&65536)!==0&&(t&128)===0?(a.flags=t&-65537|128,a):null;case 26:case 27:case 5:return ht(a),null;case 31:if(a.memoizedState!==null){if(_a(a),a.alternate===null)throw Error(c(340));cn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 13:if(_a(a),t=a.memoizedState,t!==null&&t.dehydrated!==null){if(a.alternate===null)throw Error(c(340));cn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 19:return $($t),null;case 4:return Ve(),null;case 10:return cs(a.type),null;case 22:case 23:return _a(a),Cc(),t!==null&&$(un),t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 24:return cs(Qt),null;case 25:return null;default:return null}}function wm(t,a){switch(dc(a),a.tag){case 3:cs(Qt),Ve();break;case 26:case 27:case 5:ht(a);break;case 4:Ve();break;case 31:a.memoizedState!==null&&_a(a);break;case 13:_a(a);break;case 19:$($t);break;case 10:cs(a.type);break;case 22:case 23:_a(a),Cc(),t!==null&&$(un);break;case 24:cs(Qt)}}function Fl(t,a){try{var s=a.updateQueue,n=s!==null?s.lastEffect:null;if(n!==null){var i=n.next;s=i;do{if((s.tag&t)===t){n=void 0;var d=s.create,h=s.inst;n=d(),h.destroy=n}s=s.next}while(s!==i)}}catch(b){xt(a,a.return,b)}}function Os(t,a,s){try{var n=a.updateQueue,i=n!==null?n.lastEffect:null;if(i!==null){var d=i.next;n=d;do{if((n.tag&t)===t){var h=n.inst,b=h.destroy;if(b!==void 0){h.destroy=void 0,i=a;var z=s,ie=b;try{ie()}catch(ge){xt(i,z,ge)}}}n=n.next}while(n!==d)}}catch(ge){xt(a,a.return,ge)}}function km(t){var a=t.updateQueue;if(a!==null){var s=t.stateNode;try{xu(a,s)}catch(n){xt(t,t.return,n)}}}function Em(t,a,s){s.props=gn(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(n){xt(t,a,n)}}function $l(t,a){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var n=t.stateNode;break;case 30:n=t.stateNode;break;default:n=t.stateNode}typeof s=="function"?t.refCleanup=s(n):s.current=n}}catch(i){xt(t,a,i)}}function Za(t,a){var s=t.ref,n=t.refCleanup;if(s!==null)if(typeof n=="function")try{n()}catch(i){xt(t,a,i)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(i){xt(t,a,i)}else s.current=null}function Dm(t){var a=t.type,s=t.memoizedProps,n=t.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break e;case"img":s.src?n.src=s.src:s.srcSet&&(n.srcset=s.srcSet)}}catch(i){xt(t,t.return,i)}}function so(t,a,s){try{var n=t.stateNode;qg(n,t.type,s,a),n[pt]=a}catch(i){xt(t,t.return,i)}}function Mm(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Vs(t.type)||t.tag===4}function no(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Mm(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Vs(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function lo(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,a):(a=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,a.appendChild(t),s=s._reactRootContainer,s!=null||a.onclick!==null||(a.onclick=ss));else if(n!==4&&(n===27&&Vs(t.type)&&(s=t.stateNode,a=null),t=t.child,t!==null))for(lo(t,a,s),t=t.sibling;t!==null;)lo(t,a,s),t=t.sibling}function Kr(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?s.insertBefore(t,a):s.appendChild(t);else if(n!==4&&(n===27&&Vs(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(Kr(t,a,s),t=t.sibling;t!==null;)Kr(t,a,s),t=t.sibling}function Tm(t){var a=t.stateNode,s=t.memoizedProps;try{for(var n=t.type,i=a.attributes;i.length;)a.removeAttributeNode(i[0]);ra(a,n,s),a[Fe]=t,a[pt]=s}catch(d){xt(t,t.return,d)}}var hs=!1,Pt=!1,ro=!1,Am=typeof WeakSet=="function"?WeakSet:Set,ea=null;function fg(t,a){if(t=t.containerInfo,Eo=vi,t=Gd(t),Wi(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var i=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var h=0,b=-1,z=-1,ie=0,ge=0,ye=t,oe=null;t:for(;;){for(var de;ye!==s||i!==0&&ye.nodeType!==3||(b=h+i),ye!==d||n!==0&&ye.nodeType!==3||(z=h+n),ye.nodeType===3&&(h+=ye.nodeValue.length),(de=ye.firstChild)!==null;)oe=ye,ye=de;for(;;){if(ye===t)break t;if(oe===s&&++ie===i&&(b=h),oe===d&&++ge===n&&(z=h),(de=ye.nextSibling)!==null)break;ye=oe,oe=ye.parentNode}ye=de}s=b===-1||z===-1?null:{start:b,end:z}}else s=null}s=s||{start:0,end:0}}else s=null;for(Do={focusedElem:t,selectionRange:s},vi=!1,ea=a;ea!==null;)if(a=ea,t=a.child,(a.subtreeFlags&1028)!==0&&t!==null)t.return=a,ea=t;else for(;ea!==null;){switch(a=ea,d=a.alternate,t=a.flags,a.tag){case 0:if((t&4)!==0&&(t=a.updateQueue,t=t!==null?t.events:null,t!==null))for(s=0;s<t.length;s++)i=t[s],i.ref.impl=i.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&d!==null){t=void 0,s=a,i=d.memoizedProps,d=d.memoizedState,n=s.stateNode;try{var ze=gn(s.type,i);t=n.getSnapshotBeforeUpdate(ze,d),n.__reactInternalSnapshotBeforeUpdate=t}catch(Qe){xt(s,s.return,Qe)}}break;case 3:if((t&1024)!==0){if(t=a.stateNode.containerInfo,s=t.nodeType,s===9)Ao(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Ao(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(c(163))}if(t=a.sibling,t!==null){t.return=a.return,ea=t;break}ea=a.return}}function Rm(t,a,s){var n=s.flags;switch(s.tag){case 0:case 11:case 15:ps(t,s),n&4&&Fl(5,s);break;case 1:if(ps(t,s),n&4)if(t=s.stateNode,a===null)try{t.componentDidMount()}catch(h){xt(s,s.return,h)}else{var i=gn(s.type,a.memoizedProps);a=a.memoizedState;try{t.componentDidUpdate(i,a,t.__reactInternalSnapshotBeforeUpdate)}catch(h){xt(s,s.return,h)}}n&64&&km(s),n&512&&$l(s,s.return);break;case 3:if(ps(t,s),n&64&&(t=s.updateQueue,t!==null)){if(a=null,s.child!==null)switch(s.child.tag){case 27:case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}try{xu(t,a)}catch(h){xt(s,s.return,h)}}break;case 27:a===null&&n&4&&Tm(s);case 26:case 5:ps(t,s),a===null&&n&4&&Dm(s),n&512&&$l(s,s.return);break;case 12:ps(t,s);break;case 31:ps(t,s),n&4&&Om(t,s);break;case 13:ps(t,s),n&4&&Um(t,s),n&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=Ng.bind(null,s),Vg(t,s))));break;case 22:if(n=s.memoizedState!==null||hs,!n){a=a!==null&&a.memoizedState!==null||Pt,i=hs;var d=Pt;hs=n,(Pt=a)&&!d?gs(t,s,(s.subtreeFlags&8772)!==0):ps(t,s),hs=i,Pt=d}break;case 30:break;default:ps(t,s)}}function zm(t){var a=t.alternate;a!==null&&(t.alternate=null,zm(a)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(a=t.stateNode,a!==null&&hl(a)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var qt=null,ha=!1;function fs(t,a,s){for(s=s.child;s!==null;)qm(t,a,s),s=s.sibling}function qm(t,a,s){if(ut&&typeof ut.onCommitFiberUnmount=="function")try{ut.onCommitFiberUnmount(Ut,s)}catch{}switch(s.tag){case 26:Pt||Za(s,a),fs(t,a,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:Pt||Za(s,a);var n=qt,i=ha;Vs(s.type)&&(qt=s.stateNode,ha=!1),fs(t,a,s),Jl(s.stateNode),qt=n,ha=i;break;case 5:Pt||Za(s,a);case 6:if(n=qt,i=ha,qt=null,fs(t,a,s),qt=n,ha=i,qt!==null)if(ha)try{(qt.nodeType===9?qt.body:qt.nodeName==="HTML"?qt.ownerDocument.body:qt).removeChild(s.stateNode)}catch(d){xt(s,a,d)}else try{qt.removeChild(s.stateNode)}catch(d){xt(s,a,d)}break;case 18:qt!==null&&(ha?(t=qt,kh(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),il(t)):kh(qt,s.stateNode));break;case 4:n=qt,i=ha,qt=s.stateNode.containerInfo,ha=!0,fs(t,a,s),qt=n,ha=i;break;case 0:case 11:case 14:case 15:Os(2,s,a),Pt||Os(4,s,a),fs(t,a,s);break;case 1:Pt||(Za(s,a),n=s.stateNode,typeof n.componentWillUnmount=="function"&&Em(s,a,n)),fs(t,a,s);break;case 21:fs(t,a,s);break;case 22:Pt=(n=Pt)||s.memoizedState!==null,fs(t,a,s),Pt=n;break;default:fs(t,a,s)}}function Om(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{il(t)}catch(s){xt(a,a.return,s)}}}function Um(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{il(t)}catch(s){xt(a,a.return,s)}}function pg(t){switch(t.tag){case 31:case 13:case 19:var a=t.stateNode;return a===null&&(a=t.stateNode=new Am),a;case 22:return t=t.stateNode,a=t._retryCache,a===null&&(a=t._retryCache=new Am),a;default:throw Error(c(435,t.tag))}}function Wr(t,a){var s=pg(t);a.forEach(function(n){if(!s.has(n)){s.add(n);var i=Sg.bind(null,t,n);n.then(i,i)}})}function fa(t,a){var s=a.deletions;if(s!==null)for(var n=0;n<s.length;n++){var i=s[n],d=t,h=a,b=h;e:for(;b!==null;){switch(b.tag){case 27:if(Vs(b.type)){qt=b.stateNode,ha=!1;break e}break;case 5:qt=b.stateNode,ha=!1;break e;case 3:case 4:qt=b.stateNode.containerInfo,ha=!0;break e}b=b.return}if(qt===null)throw Error(c(160));qm(d,h,i),qt=null,ha=!1,d=i.alternate,d!==null&&(d.return=null),i.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Lm(a,t),a=a.sibling}var Ha=null;function Lm(t,a){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:fa(a,t),pa(t),n&4&&(Os(3,t,t.return),Fl(3,t),Os(5,t,t.return));break;case 1:fa(a,t),pa(t),n&512&&(Pt||s===null||Za(s,s.return)),n&64&&hs&&(t=t.updateQueue,t!==null&&(n=t.callbacks,n!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?n:s.concat(n))));break;case 26:var i=Ha;if(fa(a,t),pa(t),n&512&&(Pt||s===null||Za(s,s.return)),n&4){var d=s!==null?s.memoizedState:null;if(n=t.memoizedState,s===null)if(n===null)if(t.stateNode===null){e:{n=t.type,s=t.memoizedProps,i=i.ownerDocument||i;t:switch(n){case"title":d=i.getElementsByTagName("title")[0],(!d||d[Va]||d[Fe]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=i.createElement(n),i.head.insertBefore(d,i.querySelector("head > title"))),ra(d,n,s),d[Fe]=t,Lt(d),n=d;break e;case"link":var h=Lh("link","href",i).get(n+(s.href||""));if(h){for(var b=0;b<h.length;b++)if(d=h[b],d.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&d.getAttribute("rel")===(s.rel==null?null:s.rel)&&d.getAttribute("title")===(s.title==null?null:s.title)&&d.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){h.splice(b,1);break t}}d=i.createElement(n),ra(d,n,s),i.head.appendChild(d);break;case"meta":if(h=Lh("meta","content",i).get(n+(s.content||""))){for(b=0;b<h.length;b++)if(d=h[b],d.getAttribute("content")===(s.content==null?null:""+s.content)&&d.getAttribute("name")===(s.name==null?null:s.name)&&d.getAttribute("property")===(s.property==null?null:s.property)&&d.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&d.getAttribute("charset")===(s.charSet==null?null:s.charSet)){h.splice(b,1);break t}}d=i.createElement(n),ra(d,n,s),i.head.appendChild(d);break;default:throw Error(c(468,n))}d[Fe]=t,Lt(d),n=d}t.stateNode=n}else Bh(i,t.type,t.stateNode);else t.stateNode=Uh(i,n,t.memoizedProps);else d!==n?(d===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):d.count--,n===null?Bh(i,t.type,t.stateNode):Uh(i,n,t.memoizedProps)):n===null&&t.stateNode!==null&&so(t,t.memoizedProps,s.memoizedProps)}break;case 27:fa(a,t),pa(t),n&512&&(Pt||s===null||Za(s,s.return)),s!==null&&n&4&&so(t,t.memoizedProps,s.memoizedProps);break;case 5:if(fa(a,t),pa(t),n&512&&(Pt||s===null||Za(s,s.return)),t.flags&32){i=t.stateNode;try{Mn(i,"")}catch(ze){xt(t,t.return,ze)}}n&4&&t.stateNode!=null&&(i=t.memoizedProps,so(t,i,s!==null?s.memoizedProps:i)),n&1024&&(ro=!0);break;case 6:if(fa(a,t),pa(t),n&4){if(t.stateNode===null)throw Error(c(162));n=t.memoizedProps,s=t.stateNode;try{s.nodeValue=n}catch(ze){xt(t,t.return,ze)}}break;case 3:if(pi=null,i=Ha,Ha=hi(a.containerInfo),fa(a,t),Ha=i,pa(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{il(a.containerInfo)}catch(ze){xt(t,t.return,ze)}ro&&(ro=!1,Bm(t));break;case 4:n=Ha,Ha=hi(t.stateNode.containerInfo),fa(a,t),pa(t),Ha=n;break;case 12:fa(a,t),pa(t);break;case 31:fa(a,t),pa(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Wr(t,n)));break;case 13:fa(a,t),pa(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(ti=_e()),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Wr(t,n)));break;case 22:i=t.memoizedState!==null;var z=s!==null&&s.memoizedState!==null,ie=hs,ge=Pt;if(hs=ie||i,Pt=ge||z,fa(a,t),Pt=ge,hs=ie,pa(t),n&8192)e:for(a=t.stateNode,a._visibility=i?a._visibility&-2:a._visibility|1,i&&(s===null||z||hs||Pt||xn(t)),s=null,a=t;;){if(a.tag===5||a.tag===26){if(s===null){z=s=a;try{if(d=z.stateNode,i)h=d.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none";else{b=z.stateNode;var ye=z.memoizedProps.style,oe=ye!=null&&ye.hasOwnProperty("display")?ye.display:null;b.style.display=oe==null||typeof oe=="boolean"?"":(""+oe).trim()}}catch(ze){xt(z,z.return,ze)}}}else if(a.tag===6){if(s===null){z=a;try{z.stateNode.nodeValue=i?"":z.memoizedProps}catch(ze){xt(z,z.return,ze)}}}else if(a.tag===18){if(s===null){z=a;try{var de=z.stateNode;i?Eh(de,!0):Eh(z.stateNode,!1)}catch(ze){xt(z,z.return,ze)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===t)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break e;for(;a.sibling===null;){if(a.return===null||a.return===t)break e;s===a&&(s=null),a=a.return}s===a&&(s=null),a.sibling.return=a.return,a=a.sibling}n&4&&(n=t.updateQueue,n!==null&&(s=n.retryQueue,s!==null&&(n.retryQueue=null,Wr(t,s))));break;case 19:fa(a,t),pa(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Wr(t,n)));break;case 30:break;case 21:break;default:fa(a,t),pa(t)}}function pa(t){var a=t.flags;if(a&2){try{for(var s,n=t.return;n!==null;){if(Mm(n)){s=n;break}n=n.return}if(s==null)throw Error(c(160));switch(s.tag){case 27:var i=s.stateNode,d=no(t);Kr(t,d,i);break;case 5:var h=s.stateNode;s.flags&32&&(Mn(h,""),s.flags&=-33);var b=no(t);Kr(t,b,h);break;case 3:case 4:var z=s.stateNode.containerInfo,ie=no(t);lo(t,ie,z);break;default:throw Error(c(161))}}catch(ge){xt(t,t.return,ge)}t.flags&=-3}a&4096&&(t.flags&=-4097)}function Bm(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var a=t;Bm(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),t=t.sibling}}function ps(t,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Rm(t,a.alternate,a),a=a.sibling}function xn(t){for(t=t.child;t!==null;){var a=t;switch(a.tag){case 0:case 11:case 14:case 15:Os(4,a,a.return),xn(a);break;case 1:Za(a,a.return);var s=a.stateNode;typeof s.componentWillUnmount=="function"&&Em(a,a.return,s),xn(a);break;case 27:Jl(a.stateNode);case 26:case 5:Za(a,a.return),xn(a);break;case 22:a.memoizedState===null&&xn(a);break;case 30:xn(a);break;default:xn(a)}t=t.sibling}}function gs(t,a,s){for(s=s&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var n=a.alternate,i=t,d=a,h=d.flags;switch(d.tag){case 0:case 11:case 15:gs(i,d,s),Fl(4,d);break;case 1:if(gs(i,d,s),n=d,i=n.stateNode,typeof i.componentDidMount=="function")try{i.componentDidMount()}catch(ie){xt(n,n.return,ie)}if(n=d,i=n.updateQueue,i!==null){var b=n.stateNode;try{var z=i.shared.hiddenCallbacks;if(z!==null)for(i.shared.hiddenCallbacks=null,i=0;i<z.length;i++)gu(z[i],b)}catch(ie){xt(n,n.return,ie)}}s&&h&64&&km(d),$l(d,d.return);break;case 27:Tm(d);case 26:case 5:gs(i,d,s),s&&n===null&&h&4&&Dm(d),$l(d,d.return);break;case 12:gs(i,d,s);break;case 31:gs(i,d,s),s&&h&4&&Om(i,d);break;case 13:gs(i,d,s),s&&h&4&&Um(i,d);break;case 22:d.memoizedState===null&&gs(i,d,s),$l(d,d.return);break;case 30:break;default:gs(i,d,s)}a=a.sibling}}function io(t,a){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(t=a.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&El(s))}function co(t,a){t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&El(t))}function Fa(t,a,s,n){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Hm(t,a,s,n),a=a.sibling}function Hm(t,a,s,n){var i=a.flags;switch(a.tag){case 0:case 11:case 15:Fa(t,a,s,n),i&2048&&Fl(9,a);break;case 1:Fa(t,a,s,n);break;case 3:Fa(t,a,s,n),i&2048&&(t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&El(t)));break;case 12:if(i&2048){Fa(t,a,s,n),t=a.stateNode;try{var d=a.memoizedProps,h=d.id,b=d.onPostCommit;typeof b=="function"&&b(h,a.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(z){xt(a,a.return,z)}}else Fa(t,a,s,n);break;case 31:Fa(t,a,s,n);break;case 13:Fa(t,a,s,n);break;case 23:break;case 22:d=a.stateNode,h=a.alternate,a.memoizedState!==null?d._visibility&2?Fa(t,a,s,n):Vl(t,a):d._visibility&2?Fa(t,a,s,n):(d._visibility|=2,In(t,a,s,n,(a.subtreeFlags&10256)!==0||!1)),i&2048&&io(h,a);break;case 24:Fa(t,a,s,n),i&2048&&co(a.alternate,a);break;default:Fa(t,a,s,n)}}function In(t,a,s,n,i){for(i=i&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var d=t,h=a,b=s,z=n,ie=h.flags;switch(h.tag){case 0:case 11:case 15:In(d,h,b,z,i),Fl(8,h);break;case 23:break;case 22:var ge=h.stateNode;h.memoizedState!==null?ge._visibility&2?In(d,h,b,z,i):Vl(d,h):(ge._visibility|=2,In(d,h,b,z,i)),i&&ie&2048&&io(h.alternate,h);break;case 24:In(d,h,b,z,i),i&&ie&2048&&co(h.alternate,h);break;default:In(d,h,b,z,i)}a=a.sibling}}function Vl(t,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var s=t,n=a,i=n.flags;switch(n.tag){case 22:Vl(s,n),i&2048&&io(n.alternate,n);break;case 24:Vl(s,n),i&2048&&co(n.alternate,n);break;default:Vl(s,n)}a=a.sibling}}var Gl=8192;function Jn(t,a,s){if(t.subtreeFlags&Gl)for(t=t.child;t!==null;)Fm(t,a,s),t=t.sibling}function Fm(t,a,s){switch(t.tag){case 26:Jn(t,a,s),t.flags&Gl&&t.memoizedState!==null&&tx(s,Ha,t.memoizedState,t.memoizedProps);break;case 5:Jn(t,a,s);break;case 3:case 4:var n=Ha;Ha=hi(t.stateNode.containerInfo),Jn(t,a,s),Ha=n;break;case 22:t.memoizedState===null&&(n=t.alternate,n!==null&&n.memoizedState!==null?(n=Gl,Gl=16777216,Jn(t,a,s),Gl=n):Jn(t,a,s));break;default:Jn(t,a,s)}}function $m(t){var a=t.alternate;if(a!==null&&(t=a.child,t!==null)){a.child=null;do a=t.sibling,t.sibling=null,t=a;while(t!==null)}}function Yl(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];ea=n,Gm(n,t)}$m(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Vm(t),t=t.sibling}function Vm(t){switch(t.tag){case 0:case 11:case 15:Yl(t),t.flags&2048&&Os(9,t,t.return);break;case 3:Yl(t);break;case 12:Yl(t);break;case 22:var a=t.stateNode;t.memoizedState!==null&&a._visibility&2&&(t.return===null||t.return.tag!==13)?(a._visibility&=-3,ei(t)):Yl(t);break;default:Yl(t)}}function ei(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];ea=n,Gm(n,t)}$m(t)}for(t=t.child;t!==null;){switch(a=t,a.tag){case 0:case 11:case 15:Os(8,a,a.return),ei(a);break;case 22:s=a.stateNode,s._visibility&2&&(s._visibility&=-3,ei(a));break;default:ei(a)}t=t.sibling}}function Gm(t,a){for(;ea!==null;){var s=ea;switch(s.tag){case 0:case 11:case 15:Os(8,s,a);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var n=s.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:El(s.memoizedState.cache)}if(n=s.child,n!==null)n.return=s,ea=n;else e:for(s=t;ea!==null;){n=ea;var i=n.sibling,d=n.return;if(zm(n),n===s){ea=null;break e}if(i!==null){i.return=d,ea=i;break e}ea=d}}}var gg={getCacheForType:function(t){var a=na(Qt),s=a.data.get(t);return s===void 0&&(s=t(),a.data.set(t,s)),s},cacheSignal:function(){return na(Qt).controller.signal}},xg=typeof WeakMap=="function"?WeakMap:Map,mt=0,Nt=null,tt=null,st=0,gt=0,Na=null,Us=!1,Kn=!1,oo=!1,xs=0,Ht=0,Ls=0,jn=0,uo=0,Sa=0,Wn=0,Ql=null,ga=null,mo=!1,ti=0,Ym=0,ai=1/0,si=null,Bs=null,Kt=0,Hs=null,el=null,js=0,ho=0,fo=null,Qm=null,Xl=0,po=null;function Ca(){return(mt&2)!==0&&st!==0?st&-st:k.T!==null?bo():Ee()}function Xm(){if(Sa===0)if((st&536870912)===0||rt){var t=St;St<<=1,(St&3932160)===0&&(St=262144),Sa=t}else Sa=536870912;return t=ba.current,t!==null&&(t.flags|=32),Sa}function xa(t,a,s){(t===Nt&&(gt===2||gt===9)||t.cancelPendingCommit!==null)&&(tl(t,0),Fs(t,st,Sa,!1)),W(t,s),((mt&2)===0||t!==Nt)&&(t===Nt&&((mt&2)===0&&(jn|=s),Ht===4&&Fs(t,st,Sa,!1)),Pa(t))}function Zm(t,a,s){if((mt&6)!==0)throw Error(c(327));var n=!s&&(a&127)===0&&(a&t.expiredLanes)===0||Jt(t,a),i=n?yg(t,a):xo(t,a,!0),d=n;do{if(i===0){Kn&&!n&&Fs(t,a,0,!1);break}else{if(s=t.current.alternate,d&&!jg(s)){i=xo(t,a,!1),d=!1;continue}if(i===2){if(d=a,t.errorRecoveryDisabledLanes&d)var h=0;else h=t.pendingLanes&-536870913,h=h!==0?h:h&536870912?536870912:0;if(h!==0){a=h;e:{var b=t;i=Ql;var z=b.current.memoizedState.isDehydrated;if(z&&(tl(b,h).flags|=256),h=xo(b,h,!1),h!==2){if(oo&&!z){b.errorRecoveryDisabledLanes|=d,jn|=d,i=4;break e}d=ga,ga=i,d!==null&&(ga===null?ga=d:ga.push.apply(ga,d))}i=h}if(d=!1,i!==2)continue}}if(i===1){tl(t,0),Fs(t,a,0,!0);break}e:{switch(n=t,d=i,d){case 0:case 1:throw Error(c(345));case 4:if((a&4194048)!==a)break;case 6:Fs(n,a,Sa,!Us);break e;case 2:ga=null;break;case 3:case 5:break;default:throw Error(c(329))}if((a&62914560)===a&&(i=ti+300-_e(),10<i)){if(Fs(n,a,Sa,!Us),It(n,0,!0)!==0)break e;js=a,n.timeoutHandle=Ch(Pm.bind(null,n,s,ga,si,mo,a,Sa,jn,Wn,Us,d,"Throttled",-0,0),i);break e}Pm(n,s,ga,si,mo,a,Sa,jn,Wn,Us,d,null,-0,0)}}break}while(!0);Pa(t)}function Pm(t,a,s,n,i,d,h,b,z,ie,ge,ye,oe,de){if(t.timeoutHandle=-1,ye=a.subtreeFlags,ye&8192||(ye&16785408)===16785408){ye={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ss},Fm(a,d,ye);var ze=(d&62914560)===d?ti-_e():(d&4194048)===d?Ym-_e():0;if(ze=ax(ye,ze),ze!==null){js=d,t.cancelPendingCommit=ze(sh.bind(null,t,a,d,s,n,i,h,b,z,ge,ye,null,oe,de)),Fs(t,d,h,!ie);return}}sh(t,a,d,s,n,i,h,b,z)}function jg(t){for(var a=t;;){var s=a.tag;if((s===0||s===11||s===15)&&a.flags&16384&&(s=a.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var n=0;n<s.length;n++){var i=s[n],d=i.getSnapshot;i=i.value;try{if(!va(d(),i))return!1}catch{return!1}}if(s=a.child,a.subtreeFlags&16384&&s!==null)s.return=a,a=s;else{if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Fs(t,a,s,n){a&=~uo,a&=~jn,t.suspendedLanes|=a,t.pingedLanes&=~a,n&&(t.warmLanes|=a),n=t.expirationTimes;for(var i=a;0<i;){var d=31-_t(i),h=1<<d;n[d]=-1,i&=~h}s!==0&&Ce(t,s,a)}function ni(){return(mt&6)===0?(Zl(0),!1):!0}function go(){if(tt!==null){if(gt===0)var t=tt.return;else t=tt,is=on=null,Tc(t),Yn=null,Ml=0,t=tt;for(;t!==null;)wm(t.alternate,t),t=t.return;tt=null}}function tl(t,a){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,Lg(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),js=0,go(),Nt=t,tt=s=ls(t.current,null),st=a,gt=0,Na=null,Us=!1,Kn=Jt(t,a),oo=!1,Wn=Sa=uo=jn=Ls=Ht=0,ga=Ql=null,mo=!1,(a&8)!==0&&(a|=a&32);var n=t.entangledLanes;if(n!==0)for(t=t.entanglements,n&=a;0<n;){var i=31-_t(n),d=1<<i;a|=t[i],n&=~d}return xs=a,Cr(),s}function Im(t,a){Je=null,k.H=Ll,a===Gn||a===Rr?(a=mu(),gt=3):a===vc?(a=mu(),gt=4):gt=a===Xc?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Na=a,tt===null&&(Ht=1,Xr(t,Da(a,t.current)))}function Jm(){var t=ba.current;return t===null?!0:(st&4194048)===st?Ra===null:(st&62914560)===st||(st&536870912)!==0?t===Ra:!1}function Km(){var t=k.H;return k.H=Ll,t===null?Ll:t}function Wm(){var t=k.A;return k.A=gg,t}function li(){Ht=4,Us||(st&4194048)!==st&&ba.current!==null||(Kn=!0),(Ls&134217727)===0&&(jn&134217727)===0||Nt===null||Fs(Nt,st,Sa,!1)}function xo(t,a,s){var n=mt;mt|=2;var i=Km(),d=Wm();(Nt!==t||st!==a)&&(si=null,tl(t,a)),a=!1;var h=Ht;e:do try{if(gt!==0&&tt!==null){var b=tt,z=Na;switch(gt){case 8:go(),h=6;break e;case 3:case 2:case 9:case 6:ba.current===null&&(a=!0);var ie=gt;if(gt=0,Na=null,al(t,b,z,ie),s&&Kn){h=0;break e}break;default:ie=gt,gt=0,Na=null,al(t,b,z,ie)}}vg(),h=Ht;break}catch(ge){Im(t,ge)}while(!0);return a&&t.shellSuspendCounter++,is=on=null,mt=n,k.H=i,k.A=d,tt===null&&(Nt=null,st=0,Cr()),h}function vg(){for(;tt!==null;)eh(tt)}function yg(t,a){var s=mt;mt|=2;var n=Km(),i=Wm();Nt!==t||st!==a?(si=null,ai=_e()+500,tl(t,a)):Kn=Jt(t,a);e:do try{if(gt!==0&&tt!==null){a=tt;var d=Na;t:switch(gt){case 1:gt=0,Na=null,al(t,a,d,1);break;case 2:case 9:if(du(d)){gt=0,Na=null,th(a);break}a=function(){gt!==2&&gt!==9||Nt!==t||(gt=7),Pa(t)},d.then(a,a);break e;case 3:gt=7;break e;case 4:gt=5;break e;case 7:du(d)?(gt=0,Na=null,th(a)):(gt=0,Na=null,al(t,a,d,7));break;case 5:var h=null;switch(tt.tag){case 26:h=tt.memoizedState;case 5:case 27:var b=tt;if(h?Hh(h):b.stateNode.complete){gt=0,Na=null;var z=b.sibling;if(z!==null)tt=z;else{var ie=b.return;ie!==null?(tt=ie,ri(ie)):tt=null}break t}}gt=0,Na=null,al(t,a,d,5);break;case 6:gt=0,Na=null,al(t,a,d,6);break;case 8:go(),Ht=6;break e;default:throw Error(c(462))}}bg();break}catch(ge){Im(t,ge)}while(!0);return is=on=null,k.H=n,k.A=i,mt=s,tt!==null?0:(Nt=null,st=0,Cr(),Ht)}function bg(){for(;tt!==null&&!xe();)eh(tt)}function eh(t){var a=Sm(t.alternate,t,xs);t.memoizedProps=t.pendingProps,a===null?ri(t):tt=a}function th(t){var a=t,s=a.alternate;switch(a.tag){case 15:case 0:a=jm(s,a,a.pendingProps,a.type,void 0,st);break;case 11:a=jm(s,a,a.pendingProps,a.type.render,a.ref,st);break;case 5:Tc(a);default:wm(s,a),a=tt=Wd(a,xs),a=Sm(s,a,xs)}t.memoizedProps=t.pendingProps,a===null?ri(t):tt=a}function al(t,a,s,n){is=on=null,Tc(a),Yn=null,Ml=0;var i=a.return;try{if(og(t,i,a,s,st)){Ht=1,Xr(t,Da(s,t.current)),tt=null;return}}catch(d){if(i!==null)throw tt=i,d;Ht=1,Xr(t,Da(s,t.current)),tt=null;return}a.flags&32768?(rt||n===1?t=!0:Kn||(st&536870912)!==0?t=!1:(Us=t=!0,(n===2||n===9||n===3||n===6)&&(n=ba.current,n!==null&&n.tag===13&&(n.flags|=16384))),ah(a,t)):ri(a)}function ri(t){var a=t;do{if((a.flags&32768)!==0){ah(a,Us);return}t=a.return;var s=mg(a.alternate,a,xs);if(s!==null){tt=s;return}if(a=a.sibling,a!==null){tt=a;return}tt=a=t}while(a!==null);Ht===0&&(Ht=5)}function ah(t,a){do{var s=hg(t.alternate,t);if(s!==null){s.flags&=32767,tt=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!a&&(t=t.sibling,t!==null)){tt=t;return}tt=t=s}while(t!==null);Ht=6,tt=null}function sh(t,a,s,n,i,d,h,b,z){t.cancelPendingCommit=null;do ii();while(Kt!==0);if((mt&6)!==0)throw Error(c(327));if(a!==null){if(a===t.current)throw Error(c(177));if(d=a.lanes|a.childLanes,d|=nc,he(t,s,d,h,b,z),t===Nt&&(tt=Nt=null,st=0),el=a,Hs=t,js=s,ho=d,fo=i,Qm=n,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,Cg(wt,function(){return ch(),null})):(t.callbackNode=null,t.callbackPriority=0),n=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||n){n=k.T,k.T=null,i=M.p,M.p=2,h=mt,mt|=4;try{fg(t,a,s)}finally{mt=h,M.p=i,k.T=n}}Kt=1,nh(),lh(),rh()}}function nh(){if(Kt===1){Kt=0;var t=Hs,a=el,s=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||s){s=k.T,k.T=null;var n=M.p;M.p=2;var i=mt;mt|=4;try{Lm(a,t);var d=Do,h=Gd(t.containerInfo),b=d.focusedElem,z=d.selectionRange;if(h!==b&&b&&b.ownerDocument&&Vd(b.ownerDocument.documentElement,b)){if(z!==null&&Wi(b)){var ie=z.start,ge=z.end;if(ge===void 0&&(ge=ie),"selectionStart"in b)b.selectionStart=ie,b.selectionEnd=Math.min(ge,b.value.length);else{var ye=b.ownerDocument||document,oe=ye&&ye.defaultView||window;if(oe.getSelection){var de=oe.getSelection(),ze=b.textContent.length,Qe=Math.min(z.start,ze),yt=z.end===void 0?Qe:Math.min(z.end,ze);!de.extend&&Qe>yt&&(h=yt,yt=Qe,Qe=h);var te=$d(b,Qe),Y=$d(b,yt);if(te&&Y&&(de.rangeCount!==1||de.anchorNode!==te.node||de.anchorOffset!==te.offset||de.focusNode!==Y.node||de.focusOffset!==Y.offset)){var re=ye.createRange();re.setStart(te.node,te.offset),de.removeAllRanges(),Qe>yt?(de.addRange(re),de.extend(Y.node,Y.offset)):(re.setEnd(Y.node,Y.offset),de.addRange(re))}}}}for(ye=[],de=b;de=de.parentNode;)de.nodeType===1&&ye.push({element:de,left:de.scrollLeft,top:de.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<ye.length;b++){var je=ye[b];je.element.scrollLeft=je.left,je.element.scrollTop=je.top}}vi=!!Eo,Do=Eo=null}finally{mt=i,M.p=n,k.T=s}}t.current=a,Kt=2}}function lh(){if(Kt===2){Kt=0;var t=Hs,a=el,s=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||s){s=k.T,k.T=null;var n=M.p;M.p=2;var i=mt;mt|=4;try{Rm(t,a.alternate,a)}finally{mt=i,M.p=n,k.T=s}}Kt=3}}function rh(){if(Kt===4||Kt===3){Kt=0,G();var t=Hs,a=el,s=js,n=Qm;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Kt=5:(Kt=0,el=Hs=null,ih(t,t.pendingLanes));var i=t.pendingLanes;if(i===0&&(Bs=null),Ze(s),a=a.stateNode,ut&&typeof ut.onCommitFiberRoot=="function")try{ut.onCommitFiberRoot(Ut,a,void 0,(a.current.flags&128)===128)}catch{}if(n!==null){a=k.T,i=M.p,M.p=2,k.T=null;try{for(var d=t.onRecoverableError,h=0;h<n.length;h++){var b=n[h];d(b.value,{componentStack:b.stack})}}finally{k.T=a,M.p=i}}(js&3)!==0&&ii(),Pa(t),i=t.pendingLanes,(s&261930)!==0&&(i&42)!==0?t===po?Xl++:(Xl=0,po=t):Xl=0,Zl(0)}}function ih(t,a){(t.pooledCacheLanes&=a)===0&&(a=t.pooledCache,a!=null&&(t.pooledCache=null,El(a)))}function ii(){return nh(),lh(),rh(),ch()}function ch(){if(Kt!==5)return!1;var t=Hs,a=ho;ho=0;var s=Ze(js),n=k.T,i=M.p;try{M.p=32>s?32:s,k.T=null,s=fo,fo=null;var d=Hs,h=js;if(Kt=0,el=Hs=null,js=0,(mt&6)!==0)throw Error(c(331));var b=mt;if(mt|=4,Vm(d.current),Hm(d,d.current,h,s),mt=b,Zl(0,!1),ut&&typeof ut.onPostCommitFiberRoot=="function")try{ut.onPostCommitFiberRoot(Ut,d)}catch{}return!0}finally{M.p=i,k.T=n,ih(t,a)}}function oh(t,a,s){a=Da(s,a),a=Qc(t.stateNode,a,2),t=Rs(t,a,2),t!==null&&(W(t,2),Pa(t))}function xt(t,a,s){if(t.tag===3)oh(t,t,s);else for(;a!==null;){if(a.tag===3){oh(a,t,s);break}else if(a.tag===1){var n=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Bs===null||!Bs.has(n))){t=Da(s,t),s=dm(2),n=Rs(a,s,2),n!==null&&(um(s,n,a,t),W(n,2),Pa(n));break}}a=a.return}}function jo(t,a,s){var n=t.pingCache;if(n===null){n=t.pingCache=new xg;var i=new Set;n.set(a,i)}else i=n.get(a),i===void 0&&(i=new Set,n.set(a,i));i.has(s)||(oo=!0,i.add(s),t=_g.bind(null,t,a,s),a.then(t,t))}function _g(t,a,s){var n=t.pingCache;n!==null&&n.delete(a),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,Nt===t&&(st&s)===s&&(Ht===4||Ht===3&&(st&62914560)===st&&300>_e()-ti?(mt&2)===0&&tl(t,0):uo|=s,Wn===st&&(Wn=0)),Pa(t)}function dh(t,a){a===0&&(a=N()),t=ln(t,a),t!==null&&(W(t,a),Pa(t))}function Ng(t){var a=t.memoizedState,s=0;a!==null&&(s=a.retryLane),dh(t,s)}function Sg(t,a){var s=0;switch(t.tag){case 31:case 13:var n=t.stateNode,i=t.memoizedState;i!==null&&(s=i.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(c(314))}n!==null&&n.delete(a),dh(t,s)}function Cg(t,a){return E(t,a)}var ci=null,sl=null,vo=!1,oi=!1,yo=!1,$s=0;function Pa(t){t!==sl&&t.next===null&&(sl===null?ci=sl=t:sl=sl.next=t),oi=!0,vo||(vo=!0,kg())}function Zl(t,a){if(!yo&&oi){yo=!0;do for(var s=!1,n=ci;n!==null;){if(t!==0){var i=n.pendingLanes;if(i===0)var d=0;else{var h=n.suspendedLanes,b=n.pingedLanes;d=(1<<31-_t(42|t)+1)-1,d&=i&~(h&~b),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(s=!0,fh(n,d))}else d=st,d=It(n,n===Nt?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(d&3)===0||Jt(n,d)||(s=!0,fh(n,d));n=n.next}while(s);yo=!1}}function wg(){uh()}function uh(){oi=vo=!1;var t=0;$s!==0&&Ug()&&(t=$s);for(var a=_e(),s=null,n=ci;n!==null;){var i=n.next,d=mh(n,a);d===0?(n.next=null,s===null?ci=i:s.next=i,i===null&&(sl=s)):(s=n,(t!==0||(d&3)!==0)&&(oi=!0)),n=i}Kt!==0&&Kt!==5||Zl(t),$s!==0&&($s=0)}function mh(t,a){for(var s=t.suspendedLanes,n=t.pingedLanes,i=t.expirationTimes,d=t.pendingLanes&-62914561;0<d;){var h=31-_t(d),b=1<<h,z=i[h];z===-1?((b&s)===0||(b&n)!==0)&&(i[h]=ta(b,a)):z<=a&&(t.expiredLanes|=b),d&=~b}if(a=Nt,s=st,s=It(t,t===a?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n=t.callbackNode,s===0||t===a&&(gt===2||gt===9)||t.cancelPendingCommit!==null)return n!==null&&n!==null&&fe(n),t.callbackNode=null,t.callbackPriority=0;if((s&3)===0||Jt(t,s)){if(a=s&-s,a===t.callbackPriority)return a;switch(n!==null&&fe(n),Ze(s)){case 2:case 8:s=We;break;case 32:s=wt;break;case 268435456:s=kt;break;default:s=wt}return n=hh.bind(null,t),s=E(s,n),t.callbackPriority=a,t.callbackNode=s,a}return n!==null&&n!==null&&fe(n),t.callbackPriority=2,t.callbackNode=null,2}function hh(t,a){if(Kt!==0&&Kt!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(ii()&&t.callbackNode!==s)return null;var n=st;return n=It(t,t===Nt?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n===0?null:(Zm(t,n,a),mh(t,_e()),t.callbackNode!=null&&t.callbackNode===s?hh.bind(null,t):null)}function fh(t,a){if(ii())return null;Zm(t,a,!0)}function kg(){Bg(function(){(mt&6)!==0?E(qe,wg):uh()})}function bo(){if($s===0){var t=$n;t===0&&(t=Xe,Xe<<=1,(Xe&261888)===0&&(Xe=256)),$s=t}return $s}function ph(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:xr(""+t)}function gh(t,a){var s=a.ownerDocument.createElement("input");return s.name=a.name,s.value=a.value,t.id&&s.setAttribute("form",t.id),a.parentNode.insertBefore(s,a),t=new FormData(t),s.parentNode.removeChild(s),t}function Eg(t,a,s,n,i){if(a==="submit"&&s&&s.stateNode===i){var d=ph((i[pt]||null).action),h=n.submitter;h&&(a=(a=h[pt]||null)?ph(a.formAction):h.getAttribute("formAction"),a!==null&&(d=a,h=null));var b=new br("action","action",null,n,i);t.push({event:b,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if($s!==0){var z=h?gh(i,h):new FormData(i);Hc(s,{pending:!0,data:z,method:i.method,action:d},null,z)}}else typeof d=="function"&&(b.preventDefault(),z=h?gh(i,h):new FormData(i),Hc(s,{pending:!0,data:z,method:i.method,action:d},d,z))},currentTarget:i}]})}}for(var _o=0;_o<sc.length;_o++){var No=sc[_o],Dg=No.toLowerCase(),Mg=No[0].toUpperCase()+No.slice(1);Ba(Dg,"on"+Mg)}Ba(Xd,"onAnimationEnd"),Ba(Zd,"onAnimationIteration"),Ba(Pd,"onAnimationStart"),Ba("dblclick","onDoubleClick"),Ba("focusin","onFocus"),Ba("focusout","onBlur"),Ba(Qp,"onTransitionRun"),Ba(Xp,"onTransitionStart"),Ba(Zp,"onTransitionCancel"),Ba(Id,"onTransitionEnd"),as("onMouseEnter",["mouseout","mouseover"]),as("onMouseLeave",["mouseout","mouseover"]),as("onPointerEnter",["pointerout","pointerover"]),as("onPointerLeave",["pointerout","pointerover"]),ts("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ts("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ts("onBeforeInput",["compositionend","keypress","textInput","paste"]),ts("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ts("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ts("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Tg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Pl));function xh(t,a){a=(a&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],i=n.event;n=n.listeners;e:{var d=void 0;if(a)for(var h=n.length-1;0<=h;h--){var b=n[h],z=b.instance,ie=b.currentTarget;if(b=b.listener,z!==d&&i.isPropagationStopped())break e;d=b,i.currentTarget=ie;try{d(i)}catch(ge){Sr(ge)}i.currentTarget=null,d=z}else for(h=0;h<n.length;h++){if(b=n[h],z=b.instance,ie=b.currentTarget,b=b.listener,z!==d&&i.isPropagationStopped())break e;d=b,i.currentTarget=ie;try{d(i)}catch(ge){Sr(ge)}i.currentTarget=null,d=z}}}}function at(t,a){var s=a[Me];s===void 0&&(s=a[Me]=new Set);var n=t+"__bubble";s.has(n)||(jh(a,t,2,!1),s.add(n))}function So(t,a,s){var n=0;a&&(n|=4),jh(s,t,n,a)}var di="_reactListening"+Math.random().toString(36).slice(2);function Co(t){if(!t[di]){t[di]=!0,fl.forEach(function(s){s!=="selectionchange"&&(Tg.has(s)||So(s,!1,t),So(s,!0,t))});var a=t.nodeType===9?t:t.ownerDocument;a===null||a[di]||(a[di]=!0,So("selectionchange",!1,a))}}function jh(t,a,s,n){switch(Xh(a)){case 2:var i=lx;break;case 8:i=rx;break;default:i=Ho}s=i.bind(null,a,s,t),i=void 0,!Gi||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(i=!0),n?i!==void 0?t.addEventListener(a,s,{capture:!0,passive:i}):t.addEventListener(a,s,!0):i!==void 0?t.addEventListener(a,s,{passive:i}):t.addEventListener(a,s,!1)}function wo(t,a,s,n,i){var d=n;if((a&1)===0&&(a&2)===0&&n!==null)e:for(;;){if(n===null)return;var h=n.tag;if(h===3||h===4){var b=n.stateNode.containerInfo;if(b===i)break;if(h===4)for(h=n.return;h!==null;){var z=h.tag;if((z===3||z===4)&&h.stateNode.containerInfo===i)return;h=h.return}for(;b!==null;){if(h=Ga(b),h===null)return;if(z=h.tag,z===5||z===6||z===26||z===27){n=d=h;continue e}b=b.parentNode}}n=n.return}Nd(function(){var ie=d,ge=$i(s),ye=[];e:{var oe=Jd.get(t);if(oe!==void 0){var de=br,ze=t;switch(t){case"keypress":if(vr(s)===0)break e;case"keydown":case"keyup":de=Sp;break;case"focusin":ze="focus",de=Zi;break;case"focusout":ze="blur",de=Zi;break;case"beforeblur":case"afterblur":de=Zi;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":de=wd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":de=mp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":de=kp;break;case Xd:case Zd:case Pd:de=pp;break;case Id:de=Dp;break;case"scroll":case"scrollend":de=dp;break;case"wheel":de=Tp;break;case"copy":case"cut":case"paste":de=xp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":de=Ed;break;case"toggle":case"beforetoggle":de=Rp}var Qe=(a&4)!==0,yt=!Qe&&(t==="scroll"||t==="scrollend"),te=Qe?oe!==null?oe+"Capture":null:oe;Qe=[];for(var Y=ie,re;Y!==null;){var je=Y;if(re=je.stateNode,je=je.tag,je!==5&&je!==26&&je!==27||re===null||te===null||(je=xl(Y,te),je!=null&&Qe.push(Il(Y,je,re))),yt)break;Y=Y.return}0<Qe.length&&(oe=new de(oe,ze,null,s,ge),ye.push({event:oe,listeners:Qe}))}}if((a&7)===0){e:{if(oe=t==="mouseover"||t==="pointerover",de=t==="mouseout"||t==="pointerout",oe&&s!==Fi&&(ze=s.relatedTarget||s.fromElement)&&(Ga(ze)||ze[zt]))break e;if((de||oe)&&(oe=ge.window===ge?ge:(oe=ge.ownerDocument)?oe.defaultView||oe.parentWindow:window,de?(ze=s.relatedTarget||s.toElement,de=ie,ze=ze?Ga(ze):null,ze!==null&&(yt=u(ze),Qe=ze.tag,ze!==yt||Qe!==5&&Qe!==27&&Qe!==6)&&(ze=null)):(de=null,ze=ie),de!==ze)){if(Qe=wd,je="onMouseLeave",te="onMouseEnter",Y="mouse",(t==="pointerout"||t==="pointerover")&&(Qe=Ed,je="onPointerLeave",te="onPointerEnter",Y="pointer"),yt=de==null?oe:Cs(de),re=ze==null?oe:Cs(ze),oe=new Qe(je,Y+"leave",de,s,ge),oe.target=yt,oe.relatedTarget=re,je=null,Ga(ge)===ie&&(Qe=new Qe(te,Y+"enter",ze,s,ge),Qe.target=re,Qe.relatedTarget=yt,je=Qe),yt=je,de&&ze)t:{for(Qe=Ag,te=de,Y=ze,re=0,je=te;je;je=Qe(je))re++;je=0;for(var $e=Y;$e;$e=Qe($e))je++;for(;0<re-je;)te=Qe(te),re--;for(;0<je-re;)Y=Qe(Y),je--;for(;re--;){if(te===Y||Y!==null&&te===Y.alternate){Qe=te;break t}te=Qe(te),Y=Qe(Y)}Qe=null}else Qe=null;de!==null&&vh(ye,oe,de,Qe,!1),ze!==null&&yt!==null&&vh(ye,yt,ze,Qe,!0)}}e:{if(oe=ie?Cs(ie):window,de=oe.nodeName&&oe.nodeName.toLowerCase(),de==="select"||de==="input"&&oe.type==="file")var ot=Od;else if(zd(oe))if(Ud)ot=Vp;else{ot=Fp;var Oe=Hp}else de=oe.nodeName,!de||de.toLowerCase()!=="input"||oe.type!=="checkbox"&&oe.type!=="radio"?ie&&Hi(ie.elementType)&&(ot=Od):ot=$p;if(ot&&(ot=ot(t,ie))){qd(ye,ot,s,ge);break e}Oe&&Oe(t,oe,ie),t==="focusout"&&ie&&oe.type==="number"&&ie.memoizedProps.value!=null&&Bi(oe,"number",oe.value)}switch(Oe=ie?Cs(ie):window,t){case"focusin":(zd(Oe)||Oe.contentEditable==="true")&&(zn=Oe,ec=ie,Cl=null);break;case"focusout":Cl=ec=zn=null;break;case"mousedown":tc=!0;break;case"contextmenu":case"mouseup":case"dragend":tc=!1,Yd(ye,s,ge);break;case"selectionchange":if(Yp)break;case"keydown":case"keyup":Yd(ye,s,ge)}var Ke;if(Ii)e:{switch(t){case"compositionstart":var nt="onCompositionStart";break e;case"compositionend":nt="onCompositionEnd";break e;case"compositionupdate":nt="onCompositionUpdate";break e}nt=void 0}else Rn?Ad(t,s)&&(nt="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(nt="onCompositionStart");nt&&(Dd&&s.locale!=="ko"&&(Rn||nt!=="onCompositionStart"?nt==="onCompositionEnd"&&Rn&&(Ke=Sd()):(ws=ge,Yi="value"in ws?ws.value:ws.textContent,Rn=!0)),Oe=ui(ie,nt),0<Oe.length&&(nt=new kd(nt,t,null,s,ge),ye.push({event:nt,listeners:Oe}),Ke?nt.data=Ke:(Ke=Rd(s),Ke!==null&&(nt.data=Ke)))),(Ke=qp?Op(t,s):Up(t,s))&&(nt=ui(ie,"onBeforeInput"),0<nt.length&&(Oe=new kd("onBeforeInput","beforeinput",null,s,ge),ye.push({event:Oe,listeners:nt}),Oe.data=Ke)),Eg(ye,t,ie,s,ge)}xh(ye,a)})}function Il(t,a,s){return{instance:t,listener:a,currentTarget:s}}function ui(t,a){for(var s=a+"Capture",n=[];t!==null;){var i=t,d=i.stateNode;if(i=i.tag,i!==5&&i!==26&&i!==27||d===null||(i=xl(t,s),i!=null&&n.unshift(Il(t,i,d)),i=xl(t,a),i!=null&&n.push(Il(t,i,d))),t.tag===3)return n;t=t.return}return[]}function Ag(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function vh(t,a,s,n,i){for(var d=a._reactName,h=[];s!==null&&s!==n;){var b=s,z=b.alternate,ie=b.stateNode;if(b=b.tag,z!==null&&z===n)break;b!==5&&b!==26&&b!==27||ie===null||(z=ie,i?(ie=xl(s,d),ie!=null&&h.unshift(Il(s,ie,z))):i||(ie=xl(s,d),ie!=null&&h.push(Il(s,ie,z)))),s=s.return}h.length!==0&&t.push({event:a,listeners:h})}var Rg=/\r\n?/g,zg=/\u0000|\uFFFD/g;function yh(t){return(typeof t=="string"?t:""+t).replace(Rg,`
`).replace(zg,"")}function bh(t,a){return a=yh(a),yh(t)===a}function vt(t,a,s,n,i,d){switch(s){case"children":typeof n=="string"?a==="body"||a==="textarea"&&n===""||Mn(t,n):(typeof n=="number"||typeof n=="bigint")&&a!=="body"&&Mn(t,""+n);break;case"className":ua(t,"class",n);break;case"tabIndex":ua(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":ua(t,s,n);break;case"style":bd(t,n,d);break;case"data":if(a!=="object"){ua(t,"data",n);break}case"src":case"href":if(n===""&&(a!=="a"||s!=="href")){t.removeAttribute(s);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=xr(""+n),t.setAttribute(s,n);break;case"action":case"formAction":if(typeof n=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(s==="formAction"?(a!=="input"&&vt(t,a,"name",i.name,i,null),vt(t,a,"formEncType",i.formEncType,i,null),vt(t,a,"formMethod",i.formMethod,i,null),vt(t,a,"formTarget",i.formTarget,i,null)):(vt(t,a,"encType",i.encType,i,null),vt(t,a,"method",i.method,i,null),vt(t,a,"target",i.target,i,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=xr(""+n),t.setAttribute(s,n);break;case"onClick":n!=null&&(t.onclick=ss);break;case"onScroll":n!=null&&at("scroll",t);break;case"onScrollEnd":n!=null&&at("scrollend",t);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(c(61));if(s=n.__html,s!=null){if(i.children!=null)throw Error(c(60));t.innerHTML=s}}break;case"multiple":t.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":t.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){t.removeAttribute("xlink:href");break}s=xr(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""+n):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":n===!0?t.setAttribute(s,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,n):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?t.setAttribute(s,n):t.removeAttribute(s);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?t.removeAttribute(s):t.setAttribute(s,n);break;case"popover":at("beforetoggle",t),at("toggle",t),ja(t,"popover",n);break;case"xlinkActuate":La(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":La(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":La(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":La(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":La(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":La(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":La(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":La(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":La(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":ja(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=cp.get(s)||s,ja(t,s,n))}}function ko(t,a,s,n,i,d){switch(s){case"style":bd(t,n,d);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(c(61));if(s=n.__html,s!=null){if(i.children!=null)throw Error(c(60));t.innerHTML=s}}break;case"children":typeof n=="string"?Mn(t,n):(typeof n=="number"||typeof n=="bigint")&&Mn(t,""+n);break;case"onScroll":n!=null&&at("scroll",t);break;case"onScrollEnd":n!=null&&at("scrollend",t);break;case"onClick":n!=null&&(t.onclick=ss);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!pl.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(i=s.endsWith("Capture"),a=s.slice(2,i?s.length-7:void 0),d=t[pt]||null,d=d!=null?d[s]:null,typeof d=="function"&&t.removeEventListener(a,d,i),typeof n=="function")){typeof d!="function"&&d!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(a,n,i);break e}s in t?t[s]=n:n===!0?t.setAttribute(s,""):ja(t,s,n)}}}function ra(t,a,s){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":at("error",t),at("load",t);var n=!1,i=!1,d;for(d in s)if(s.hasOwnProperty(d)){var h=s[d];if(h!=null)switch(d){case"src":n=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(c(137,a));default:vt(t,a,d,h,s,null)}}i&&vt(t,a,"srcSet",s.srcSet,s,null),n&&vt(t,a,"src",s.src,s,null);return;case"input":at("invalid",t);var b=d=h=i=null,z=null,ie=null;for(n in s)if(s.hasOwnProperty(n)){var ge=s[n];if(ge!=null)switch(n){case"name":i=ge;break;case"type":h=ge;break;case"checked":z=ge;break;case"defaultChecked":ie=ge;break;case"value":d=ge;break;case"defaultValue":b=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(c(137,a));break;default:vt(t,a,n,ge,s,null)}}xd(t,d,b,z,ie,h,i,!1);return;case"select":at("invalid",t),n=h=d=null;for(i in s)if(s.hasOwnProperty(i)&&(b=s[i],b!=null))switch(i){case"value":d=b;break;case"defaultValue":h=b;break;case"multiple":n=b;default:vt(t,a,i,b,s,null)}a=d,s=h,t.multiple=!!n,a!=null?Dn(t,!!n,a,!1):s!=null&&Dn(t,!!n,s,!0);return;case"textarea":at("invalid",t),d=i=n=null;for(h in s)if(s.hasOwnProperty(h)&&(b=s[h],b!=null))switch(h){case"value":n=b;break;case"defaultValue":i=b;break;case"children":d=b;break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(c(91));break;default:vt(t,a,h,b,s,null)}vd(t,n,i,d);return;case"option":for(z in s)if(s.hasOwnProperty(z)&&(n=s[z],n!=null))switch(z){case"selected":t.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:vt(t,a,z,n,s,null)}return;case"dialog":at("beforetoggle",t),at("toggle",t),at("cancel",t),at("close",t);break;case"iframe":case"object":at("load",t);break;case"video":case"audio":for(n=0;n<Pl.length;n++)at(Pl[n],t);break;case"image":at("error",t),at("load",t);break;case"details":at("toggle",t);break;case"embed":case"source":case"link":at("error",t),at("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ie in s)if(s.hasOwnProperty(ie)&&(n=s[ie],n!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":throw Error(c(137,a));default:vt(t,a,ie,n,s,null)}return;default:if(Hi(a)){for(ge in s)s.hasOwnProperty(ge)&&(n=s[ge],n!==void 0&&ko(t,a,ge,n,s,void 0));return}}for(b in s)s.hasOwnProperty(b)&&(n=s[b],n!=null&&vt(t,a,b,n,s,null))}function qg(t,a,s,n){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,d=null,h=null,b=null,z=null,ie=null,ge=null;for(de in s){var ye=s[de];if(s.hasOwnProperty(de)&&ye!=null)switch(de){case"checked":break;case"value":break;case"defaultValue":z=ye;default:n.hasOwnProperty(de)||vt(t,a,de,null,n,ye)}}for(var oe in n){var de=n[oe];if(ye=s[oe],n.hasOwnProperty(oe)&&(de!=null||ye!=null))switch(oe){case"type":d=de;break;case"name":i=de;break;case"checked":ie=de;break;case"defaultChecked":ge=de;break;case"value":h=de;break;case"defaultValue":b=de;break;case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(c(137,a));break;default:de!==ye&&vt(t,a,oe,de,n,ye)}}Li(t,h,b,z,ie,ge,d,i);return;case"select":de=h=b=oe=null;for(d in s)if(z=s[d],s.hasOwnProperty(d)&&z!=null)switch(d){case"value":break;case"multiple":de=z;default:n.hasOwnProperty(d)||vt(t,a,d,null,n,z)}for(i in n)if(d=n[i],z=s[i],n.hasOwnProperty(i)&&(d!=null||z!=null))switch(i){case"value":oe=d;break;case"defaultValue":b=d;break;case"multiple":h=d;default:d!==z&&vt(t,a,i,d,n,z)}a=b,s=h,n=de,oe!=null?Dn(t,!!s,oe,!1):!!n!=!!s&&(a!=null?Dn(t,!!s,a,!0):Dn(t,!!s,s?[]:"",!1));return;case"textarea":de=oe=null;for(b in s)if(i=s[b],s.hasOwnProperty(b)&&i!=null&&!n.hasOwnProperty(b))switch(b){case"value":break;case"children":break;default:vt(t,a,b,null,n,i)}for(h in n)if(i=n[h],d=s[h],n.hasOwnProperty(h)&&(i!=null||d!=null))switch(h){case"value":oe=i;break;case"defaultValue":de=i;break;case"children":break;case"dangerouslySetInnerHTML":if(i!=null)throw Error(c(91));break;default:i!==d&&vt(t,a,h,i,n,d)}jd(t,oe,de);return;case"option":for(var ze in s)if(oe=s[ze],s.hasOwnProperty(ze)&&oe!=null&&!n.hasOwnProperty(ze))switch(ze){case"selected":t.selected=!1;break;default:vt(t,a,ze,null,n,oe)}for(z in n)if(oe=n[z],de=s[z],n.hasOwnProperty(z)&&oe!==de&&(oe!=null||de!=null))switch(z){case"selected":t.selected=oe&&typeof oe!="function"&&typeof oe!="symbol";break;default:vt(t,a,z,oe,n,de)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Qe in s)oe=s[Qe],s.hasOwnProperty(Qe)&&oe!=null&&!n.hasOwnProperty(Qe)&&vt(t,a,Qe,null,n,oe);for(ie in n)if(oe=n[ie],de=s[ie],n.hasOwnProperty(ie)&&oe!==de&&(oe!=null||de!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(c(137,a));break;default:vt(t,a,ie,oe,n,de)}return;default:if(Hi(a)){for(var yt in s)oe=s[yt],s.hasOwnProperty(yt)&&oe!==void 0&&!n.hasOwnProperty(yt)&&ko(t,a,yt,void 0,n,oe);for(ge in n)oe=n[ge],de=s[ge],!n.hasOwnProperty(ge)||oe===de||oe===void 0&&de===void 0||ko(t,a,ge,oe,n,de);return}}for(var te in s)oe=s[te],s.hasOwnProperty(te)&&oe!=null&&!n.hasOwnProperty(te)&&vt(t,a,te,null,n,oe);for(ye in n)oe=n[ye],de=s[ye],!n.hasOwnProperty(ye)||oe===de||oe==null&&de==null||vt(t,a,ye,oe,n,de)}function _h(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Og(){if(typeof performance.getEntriesByType=="function"){for(var t=0,a=0,s=performance.getEntriesByType("resource"),n=0;n<s.length;n++){var i=s[n],d=i.transferSize,h=i.initiatorType,b=i.duration;if(d&&b&&_h(h)){for(h=0,b=i.responseEnd,n+=1;n<s.length;n++){var z=s[n],ie=z.startTime;if(ie>b)break;var ge=z.transferSize,ye=z.initiatorType;ge&&_h(ye)&&(z=z.responseEnd,h+=ge*(z<b?1:(b-ie)/(z-ie)))}if(--n,a+=8*(d+h)/(i.duration/1e3),t++,10<t)break}}if(0<t)return a/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var Eo=null,Do=null;function mi(t){return t.nodeType===9?t:t.ownerDocument}function Nh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Sh(t,a){if(t===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&a==="foreignObject"?0:t}function Mo(t,a){return t==="textarea"||t==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var To=null;function Ug(){var t=window.event;return t&&t.type==="popstate"?t===To?!1:(To=t,!0):(To=null,!1)}var Ch=typeof setTimeout=="function"?setTimeout:void 0,Lg=typeof clearTimeout=="function"?clearTimeout:void 0,wh=typeof Promise=="function"?Promise:void 0,Bg=typeof queueMicrotask=="function"?queueMicrotask:typeof wh<"u"?function(t){return wh.resolve(null).then(t).catch(Hg)}:Ch;function Hg(t){setTimeout(function(){throw t})}function Vs(t){return t==="head"}function kh(t,a){var s=a,n=0;do{var i=s.nextSibling;if(t.removeChild(s),i&&i.nodeType===8)if(s=i.data,s==="/$"||s==="/&"){if(n===0){t.removeChild(i),il(a);return}n--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")n++;else if(s==="html")Jl(t.ownerDocument.documentElement);else if(s==="head"){s=t.ownerDocument.head,Jl(s);for(var d=s.firstChild;d;){var h=d.nextSibling,b=d.nodeName;d[Va]||b==="SCRIPT"||b==="STYLE"||b==="LINK"&&d.rel.toLowerCase()==="stylesheet"||s.removeChild(d),d=h}}else s==="body"&&Jl(t.ownerDocument.body);s=i}while(s);il(a)}function Eh(t,a){var s=t;t=0;do{var n=s.nextSibling;if(s.nodeType===1?a?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(a?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),n&&n.nodeType===8)if(s=n.data,s==="/$"){if(t===0)break;t--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||t++;s=n}while(s)}function Ao(t){var a=t.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var s=a;switch(a=a.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":Ao(s),hl(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function Fg(t,a,s,n){for(;t.nodeType===1;){var i=s;if(t.nodeName.toLowerCase()!==a.toLowerCase()){if(!n&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(n){if(!t[Va])switch(a){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(d=t.getAttribute("rel"),d==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(d!==i.rel||t.getAttribute("href")!==(i.href==null||i.href===""?null:i.href)||t.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin)||t.getAttribute("title")!==(i.title==null?null:i.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(d=t.getAttribute("src"),(d!==(i.src==null?null:i.src)||t.getAttribute("type")!==(i.type==null?null:i.type)||t.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin))&&d&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(a==="input"&&t.type==="hidden"){var d=i.name==null?null:""+i.name;if(i.type==="hidden"&&t.getAttribute("name")===d)return t}else return t;if(t=za(t.nextSibling),t===null)break}return null}function $g(t,a,s){if(a==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=za(t.nextSibling),t===null))return null;return t}function Dh(t,a){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!a||(t=za(t.nextSibling),t===null))return null;return t}function Ro(t){return t.data==="$?"||t.data==="$~"}function zo(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function Vg(t,a){var s=t.ownerDocument;if(t.data==="$~")t._reactRetry=a;else if(t.data!=="$?"||s.readyState!=="loading")a();else{var n=function(){a(),s.removeEventListener("DOMContentLoaded",n)};s.addEventListener("DOMContentLoaded",n),t._reactRetry=n}}function za(t){for(;t!=null;t=t.nextSibling){var a=t.nodeType;if(a===1||a===3)break;if(a===8){if(a=t.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return t}var qo=null;function Mh(t){t=t.nextSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"||s==="/&"){if(a===0)return za(t.nextSibling);a--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||a++}t=t.nextSibling}return null}function Th(t){t=t.previousSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(a===0)return t;a--}else s!=="/$"&&s!=="/&"||a++}t=t.previousSibling}return null}function Ah(t,a,s){switch(a=mi(s),t){case"html":if(t=a.documentElement,!t)throw Error(c(452));return t;case"head":if(t=a.head,!t)throw Error(c(453));return t;case"body":if(t=a.body,!t)throw Error(c(454));return t;default:throw Error(c(451))}}function Jl(t){for(var a=t.attributes;a.length;)t.removeAttributeNode(a[0]);hl(t)}var qa=new Map,Rh=new Set;function hi(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var vs=M.d;M.d={f:Gg,r:Yg,D:Qg,C:Xg,L:Zg,m:Pg,X:Jg,S:Ig,M:Kg};function Gg(){var t=vs.f(),a=ni();return t||a}function Yg(t){var a=Ss(t);a!==null&&a.tag===5&&a.type==="form"?Iu(a):vs.r(t)}var nl=typeof document>"u"?null:document;function zh(t,a,s){var n=nl;if(n&&typeof a=="string"&&a){var i=ka(a);i='link[rel="'+t+'"][href="'+i+'"]',typeof s=="string"&&(i+='[crossorigin="'+s+'"]'),Rh.has(i)||(Rh.add(i),t={rel:t,crossOrigin:s,href:a},n.querySelector(i)===null&&(a=n.createElement("link"),ra(a,"link",t),Lt(a),n.head.appendChild(a)))}}function Qg(t){vs.D(t),zh("dns-prefetch",t,null)}function Xg(t,a){vs.C(t,a),zh("preconnect",t,a)}function Zg(t,a,s){vs.L(t,a,s);var n=nl;if(n&&t&&a){var i='link[rel="preload"][as="'+ka(a)+'"]';a==="image"&&s&&s.imageSrcSet?(i+='[imagesrcset="'+ka(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(i+='[imagesizes="'+ka(s.imageSizes)+'"]')):i+='[href="'+ka(t)+'"]';var d=i;switch(a){case"style":d=ll(t);break;case"script":d=rl(t)}qa.has(d)||(t=R({rel:"preload",href:a==="image"&&s&&s.imageSrcSet?void 0:t,as:a},s),qa.set(d,t),n.querySelector(i)!==null||a==="style"&&n.querySelector(Kl(d))||a==="script"&&n.querySelector(Wl(d))||(a=n.createElement("link"),ra(a,"link",t),Lt(a),n.head.appendChild(a)))}}function Pg(t,a){vs.m(t,a);var s=nl;if(s&&t){var n=a&&typeof a.as=="string"?a.as:"script",i='link[rel="modulepreload"][as="'+ka(n)+'"][href="'+ka(t)+'"]',d=i;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=rl(t)}if(!qa.has(d)&&(t=R({rel:"modulepreload",href:t},a),qa.set(d,t),s.querySelector(i)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(Wl(d)))return}n=s.createElement("link"),ra(n,"link",t),Lt(n),s.head.appendChild(n)}}}function Ig(t,a,s){vs.S(t,a,s);var n=nl;if(n&&t){var i=Ya(n).hoistableStyles,d=ll(t);a=a||"default";var h=i.get(d);if(!h){var b={loading:0,preload:null};if(h=n.querySelector(Kl(d)))b.loading=5;else{t=R({rel:"stylesheet",href:t,"data-precedence":a},s),(s=qa.get(d))&&Oo(t,s);var z=h=n.createElement("link");Lt(z),ra(z,"link",t),z._p=new Promise(function(ie,ge){z.onload=ie,z.onerror=ge}),z.addEventListener("load",function(){b.loading|=1}),z.addEventListener("error",function(){b.loading|=2}),b.loading|=4,fi(h,a,n)}h={type:"stylesheet",instance:h,count:1,state:b},i.set(d,h)}}}function Jg(t,a){vs.X(t,a);var s=nl;if(s&&t){var n=Ya(s).hoistableScripts,i=rl(t),d=n.get(i);d||(d=s.querySelector(Wl(i)),d||(t=R({src:t,async:!0},a),(a=qa.get(i))&&Uo(t,a),d=s.createElement("script"),Lt(d),ra(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(i,d))}}function Kg(t,a){vs.M(t,a);var s=nl;if(s&&t){var n=Ya(s).hoistableScripts,i=rl(t),d=n.get(i);d||(d=s.querySelector(Wl(i)),d||(t=R({src:t,async:!0,type:"module"},a),(a=qa.get(i))&&Uo(t,a),d=s.createElement("script"),Lt(d),ra(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(i,d))}}function qh(t,a,s,n){var i=(i=Ae.current)?hi(i):null;if(!i)throw Error(c(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(a=ll(s.href),s=Ya(i).hoistableStyles,n=s.get(a),n||(n={type:"style",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=ll(s.href);var d=Ya(i).hoistableStyles,h=d.get(t);if(h||(i=i.ownerDocument||i,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(t,h),(d=i.querySelector(Kl(t)))&&!d._p&&(h.instance=d,h.state.loading=5),qa.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},qa.set(t,s),d||Wg(i,t,s,h.state))),a&&n===null)throw Error(c(528,""));return h}if(a&&n!==null)throw Error(c(529,""));return null;case"script":return a=s.async,s=s.src,typeof s=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=rl(s),s=Ya(i).hoistableScripts,n=s.get(a),n||(n={type:"script",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(c(444,t))}}function ll(t){return'href="'+ka(t)+'"'}function Kl(t){return'link[rel="stylesheet"]['+t+"]"}function Oh(t){return R({},t,{"data-precedence":t.precedence,precedence:null})}function Wg(t,a,s,n){t.querySelector('link[rel="preload"][as="style"]['+a+"]")?n.loading=1:(a=t.createElement("link"),n.preload=a,a.addEventListener("load",function(){return n.loading|=1}),a.addEventListener("error",function(){return n.loading|=2}),ra(a,"link",s),Lt(a),t.head.appendChild(a))}function rl(t){return'[src="'+ka(t)+'"]'}function Wl(t){return"script[async]"+t}function Uh(t,a,s){if(a.count++,a.instance===null)switch(a.type){case"style":var n=t.querySelector('style[data-href~="'+ka(s.href)+'"]');if(n)return a.instance=n,Lt(n),n;var i=R({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return n=(t.ownerDocument||t).createElement("style"),Lt(n),ra(n,"style",i),fi(n,s.precedence,t),a.instance=n;case"stylesheet":i=ll(s.href);var d=t.querySelector(Kl(i));if(d)return a.state.loading|=4,a.instance=d,Lt(d),d;n=Oh(s),(i=qa.get(i))&&Oo(n,i),d=(t.ownerDocument||t).createElement("link"),Lt(d);var h=d;return h._p=new Promise(function(b,z){h.onload=b,h.onerror=z}),ra(d,"link",n),a.state.loading|=4,fi(d,s.precedence,t),a.instance=d;case"script":return d=rl(s.src),(i=t.querySelector(Wl(d)))?(a.instance=i,Lt(i),i):(n=s,(i=qa.get(d))&&(n=R({},s),Uo(n,i)),t=t.ownerDocument||t,i=t.createElement("script"),Lt(i),ra(i,"link",n),t.head.appendChild(i),a.instance=i);case"void":return null;default:throw Error(c(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(n=a.instance,a.state.loading|=4,fi(n,s.precedence,t));return a.instance}function fi(t,a,s){for(var n=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=n.length?n[n.length-1]:null,d=i,h=0;h<n.length;h++){var b=n[h];if(b.dataset.precedence===a)d=b;else if(d!==i)break}d?d.parentNode.insertBefore(t,d.nextSibling):(a=s.nodeType===9?s.head:s,a.insertBefore(t,a.firstChild))}function Oo(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.title==null&&(t.title=a.title)}function Uo(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.integrity==null&&(t.integrity=a.integrity)}var pi=null;function Lh(t,a,s){if(pi===null){var n=new Map,i=pi=new Map;i.set(s,n)}else i=pi,n=i.get(s),n||(n=new Map,i.set(s,n));if(n.has(t))return n;for(n.set(t,null),s=s.getElementsByTagName(t),i=0;i<s.length;i++){var d=s[i];if(!(d[Va]||d[Fe]||t==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var h=d.getAttribute(a)||"";h=t+h;var b=n.get(h);b?b.push(d):n.set(h,[d])}}return n}function Bh(t,a,s){t=t.ownerDocument||t,t.head.insertBefore(s,a==="title"?t.querySelector("head > title"):null)}function ex(t,a,s){if(s===1||a.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return t=a.disabled,typeof a.precedence=="string"&&t==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Hh(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function tx(t,a,s,n){if(s.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var i=ll(n.href),d=a.querySelector(Kl(i));if(d){a=d._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(t.count++,t=gi.bind(t),a.then(t,t)),s.state.loading|=4,s.instance=d,Lt(d);return}d=a.ownerDocument||a,n=Oh(n),(i=qa.get(i))&&Oo(n,i),d=d.createElement("link"),Lt(d);var h=d;h._p=new Promise(function(b,z){h.onload=b,h.onerror=z}),ra(d,"link",n),s.instance=d}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(s,a),(a=s.state.preload)&&(s.state.loading&3)===0&&(t.count++,s=gi.bind(t),a.addEventListener("load",s),a.addEventListener("error",s))}}var Lo=0;function ax(t,a){return t.stylesheets&&t.count===0&&ji(t,t.stylesheets),0<t.count||0<t.imgCount?function(s){var n=setTimeout(function(){if(t.stylesheets&&ji(t,t.stylesheets),t.unsuspend){var d=t.unsuspend;t.unsuspend=null,d()}},6e4+a);0<t.imgBytes&&Lo===0&&(Lo=62500*Og());var i=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&ji(t,t.stylesheets),t.unsuspend)){var d=t.unsuspend;t.unsuspend=null,d()}},(t.imgBytes>Lo?50:800)+a);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(n),clearTimeout(i)}}:null}function gi(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ji(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var xi=null;function ji(t,a){t.stylesheets=null,t.unsuspend!==null&&(t.count++,xi=new Map,a.forEach(sx,t),xi=null,gi.call(t))}function sx(t,a){if(!(a.state.loading&4)){var s=xi.get(t);if(s)var n=s.get(null);else{s=new Map,xi.set(t,s);for(var i=t.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<i.length;d++){var h=i[d];(h.nodeName==="LINK"||h.getAttribute("media")!=="not all")&&(s.set(h.dataset.precedence,h),n=h)}n&&s.set(null,n)}i=a.instance,h=i.getAttribute("data-precedence"),d=s.get(h)||n,d===n&&s.set(null,i),s.set(h,i),this.count++,n=gi.bind(this),i.addEventListener("load",n),i.addEventListener("error",n),d?d.parentNode.insertBefore(i,d.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(i,t.firstChild)),a.state.loading|=4}}var er={$$typeof:D,Provider:null,Consumer:null,_currentValue:C,_currentValue2:C,_threadCount:0};function nx(t,a,s,n,i,d,h,b,z){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=pe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pe(0),this.hiddenUpdates=pe(null),this.identifierPrefix=n,this.onUncaughtError=i,this.onCaughtError=d,this.onRecoverableError=h,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=z,this.incompleteTransitions=new Map}function Fh(t,a,s,n,i,d,h,b,z,ie,ge,ye){return t=new nx(t,a,s,h,z,ie,ge,ye,b),a=1,d===!0&&(a|=24),d=ya(3,null,null,a),t.current=d,d.stateNode=t,a=gc(),a.refCount++,t.pooledCache=a,a.refCount++,d.memoizedState={element:n,isDehydrated:s,cache:a},yc(d),t}function $h(t){return t?(t=Un,t):Un}function Vh(t,a,s,n,i,d){i=$h(i),n.context===null?n.context=i:n.pendingContext=i,n=As(a),n.payload={element:s},d=d===void 0?null:d,d!==null&&(n.callback=d),s=Rs(t,n,a),s!==null&&(xa(s,t,a),Al(s,t,a))}function Gh(t,a){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<a?s:a}}function Bo(t,a){Gh(t,a),(t=t.alternate)&&Gh(t,a)}function Yh(t){if(t.tag===13||t.tag===31){var a=ln(t,67108864);a!==null&&xa(a,t,67108864),Bo(t,67108864)}}function Qh(t){if(t.tag===13||t.tag===31){var a=Ca();a=et(a);var s=ln(t,a);s!==null&&xa(s,t,a),Bo(t,a)}}var vi=!0;function lx(t,a,s,n){var i=k.T;k.T=null;var d=M.p;try{M.p=2,Ho(t,a,s,n)}finally{M.p=d,k.T=i}}function rx(t,a,s,n){var i=k.T;k.T=null;var d=M.p;try{M.p=8,Ho(t,a,s,n)}finally{M.p=d,k.T=i}}function Ho(t,a,s,n){if(vi){var i=Fo(n);if(i===null)wo(t,a,n,yi,s),Zh(t,n);else if(cx(i,t,a,s,n))n.stopPropagation();else if(Zh(t,n),a&4&&-1<ix.indexOf(t)){for(;i!==null;){var d=Ss(i);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var h=ct(d.pendingLanes);if(h!==0){var b=d;for(b.pendingLanes|=2,b.entangledLanes|=2;h;){var z=1<<31-_t(h);b.entanglements[1]|=z,h&=~z}Pa(d),(mt&6)===0&&(ai=_e()+500,Zl(0))}}break;case 31:case 13:b=ln(d,2),b!==null&&xa(b,d,2),ni(),Bo(d,2)}if(d=Fo(n),d===null&&wo(t,a,n,yi,s),d===i)break;i=d}i!==null&&n.stopPropagation()}else wo(t,a,n,null,s)}}function Fo(t){return t=$i(t),$o(t)}var yi=null;function $o(t){if(yi=null,t=Ga(t),t!==null){var a=u(t);if(a===null)t=null;else{var s=a.tag;if(s===13){if(t=x(a),t!==null)return t;t=null}else if(s===31){if(t=g(a),t!==null)return t;t=null}else if(s===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;t=null}else a!==t&&(t=null)}}return yi=t,null}function Xh(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ye()){case qe:return 2;case We:return 8;case wt:case Ie:return 32;case kt:return 268435456;default:return 32}default:return 32}}var Vo=!1,Gs=null,Ys=null,Qs=null,tr=new Map,ar=new Map,Xs=[],ix="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Zh(t,a){switch(t){case"focusin":case"focusout":Gs=null;break;case"dragenter":case"dragleave":Ys=null;break;case"mouseover":case"mouseout":Qs=null;break;case"pointerover":case"pointerout":tr.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":ar.delete(a.pointerId)}}function sr(t,a,s,n,i,d){return t===null||t.nativeEvent!==d?(t={blockedOn:a,domEventName:s,eventSystemFlags:n,nativeEvent:d,targetContainers:[i]},a!==null&&(a=Ss(a),a!==null&&Yh(a)),t):(t.eventSystemFlags|=n,a=t.targetContainers,i!==null&&a.indexOf(i)===-1&&a.push(i),t)}function cx(t,a,s,n,i){switch(a){case"focusin":return Gs=sr(Gs,t,a,s,n,i),!0;case"dragenter":return Ys=sr(Ys,t,a,s,n,i),!0;case"mouseover":return Qs=sr(Qs,t,a,s,n,i),!0;case"pointerover":var d=i.pointerId;return tr.set(d,sr(tr.get(d)||null,t,a,s,n,i)),!0;case"gotpointercapture":return d=i.pointerId,ar.set(d,sr(ar.get(d)||null,t,a,s,n,i)),!0}return!1}function Ph(t){var a=Ga(t.target);if(a!==null){var s=u(a);if(s!==null){if(a=s.tag,a===13){if(a=x(s),a!==null){t.blockedOn=a,De(t.priority,function(){Qh(s)});return}}else if(a===31){if(a=g(s),a!==null){t.blockedOn=a,De(t.priority,function(){Qh(s)});return}}else if(a===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function bi(t){if(t.blockedOn!==null)return!1;for(var a=t.targetContainers;0<a.length;){var s=Fo(t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);Fi=n,s.target.dispatchEvent(n),Fi=null}else return a=Ss(s),a!==null&&Yh(a),t.blockedOn=s,!1;a.shift()}return!0}function Ih(t,a,s){bi(t)&&s.delete(a)}function ox(){Vo=!1,Gs!==null&&bi(Gs)&&(Gs=null),Ys!==null&&bi(Ys)&&(Ys=null),Qs!==null&&bi(Qs)&&(Qs=null),tr.forEach(Ih),ar.forEach(Ih)}function _i(t,a){t.blockedOn===a&&(t.blockedOn=null,Vo||(Vo=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,ox)))}var Ni=null;function Jh(t){Ni!==t&&(Ni=t,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){Ni===t&&(Ni=null);for(var a=0;a<t.length;a+=3){var s=t[a],n=t[a+1],i=t[a+2];if(typeof n!="function"){if($o(n||s)===null)continue;break}var d=Ss(s);d!==null&&(t.splice(a,3),a-=3,Hc(d,{pending:!0,data:i,method:s.method,action:n},n,i))}}))}function il(t){function a(z){return _i(z,t)}Gs!==null&&_i(Gs,t),Ys!==null&&_i(Ys,t),Qs!==null&&_i(Qs,t),tr.forEach(a),ar.forEach(a);for(var s=0;s<Xs.length;s++){var n=Xs[s];n.blockedOn===t&&(n.blockedOn=null)}for(;0<Xs.length&&(s=Xs[0],s.blockedOn===null);)Ph(s),s.blockedOn===null&&Xs.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(n=0;n<s.length;n+=3){var i=s[n],d=s[n+1],h=i[pt]||null;if(typeof d=="function")h||Jh(s);else if(h){var b=null;if(d&&d.hasAttribute("formAction")){if(i=d,h=d[pt]||null)b=h.formAction;else if($o(i)!==null)continue}else b=h.action;typeof b=="function"?s[n+1]=b:(s.splice(n,3),n-=3),Jh(s)}}}function Kh(){function t(d){d.canIntercept&&d.info==="react-transition"&&d.intercept({handler:function(){return new Promise(function(h){return i=h})},focusReset:"manual",scroll:"manual"})}function a(){i!==null&&(i(),i=null),n||setTimeout(s,20)}function s(){if(!n&&!navigation.transition){var d=navigation.currentEntry;d&&d.url!=null&&navigation.navigate(d.url,{state:d.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,i=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(s,100),function(){n=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),i!==null&&(i(),i=null)}}}function Go(t){this._internalRoot=t}Si.prototype.render=Go.prototype.render=function(t){var a=this._internalRoot;if(a===null)throw Error(c(409));var s=a.current,n=Ca();Vh(s,n,t,a,null,null)},Si.prototype.unmount=Go.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var a=t.containerInfo;Vh(t.current,2,null,t,null,null),ni(),a[zt]=null}};function Si(t){this._internalRoot=t}Si.prototype.unstable_scheduleHydration=function(t){if(t){var a=Ee();t={blockedOn:null,target:t,priority:a};for(var s=0;s<Xs.length&&a!==0&&a<Xs[s].priority;s++);Xs.splice(s,0,t),s===0&&Ph(t)}};var Wh=r.version;if(Wh!=="19.2.0")throw Error(c(527,Wh,"19.2.0"));M.findDOMNode=function(t){var a=t._reactInternals;if(a===void 0)throw typeof t.render=="function"?Error(c(188)):(t=Object.keys(t).join(","),Error(c(268,t)));return t=v(a),t=t!==null?y(t):null,t=t===null?null:t.stateNode,t};var dx={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ci=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ci.isDisabled&&Ci.supportsFiber)try{Ut=Ci.inject(dx),ut=Ci}catch{}}return lr.createRoot=function(t,a){if(!m(t))throw Error(c(299));var s=!1,n="",i=rm,d=im,h=cm;return a!=null&&(a.unstable_strictMode===!0&&(s=!0),a.identifierPrefix!==void 0&&(n=a.identifierPrefix),a.onUncaughtError!==void 0&&(i=a.onUncaughtError),a.onCaughtError!==void 0&&(d=a.onCaughtError),a.onRecoverableError!==void 0&&(h=a.onRecoverableError)),a=Fh(t,1,!1,null,null,s,n,null,i,d,h,Kh),t[zt]=a.current,Co(t),new Go(a)},lr.hydrateRoot=function(t,a,s){if(!m(t))throw Error(c(299));var n=!1,i="",d=rm,h=im,b=cm,z=null;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(i=s.identifierPrefix),s.onUncaughtError!==void 0&&(d=s.onUncaughtError),s.onCaughtError!==void 0&&(h=s.onCaughtError),s.onRecoverableError!==void 0&&(b=s.onRecoverableError),s.formState!==void 0&&(z=s.formState)),a=Fh(t,1,!0,a,s??null,n,i,z,d,h,b,Kh),a.context=$h(null),s=a.current,n=Ca(),n=et(n),i=As(n),i.callback=null,Rs(s,i,n),s=n,a.current.lanes=s,W(a,s),Pa(a),t[zt]=a.current,Co(t),new Si(a)},lr.version="19.2.0",lr}var lf;function _x(){if(lf)return Qo.exports;lf=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(r){console.error(r)}}return l(),Qo.exports=bx(),Qo.exports}var Nx=_x();const Sx=zf(Nx),Cx="fieldsync-offline",wx=1,Gt={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let _n=null;const Ns=()=>new Promise((l,r)=>{if(_n){l(_n);return}const o=indexedDB.open(Cx,wx);o.onerror=()=>{console.error("Failed to open offline database"),r(o.error)},o.onsuccess=()=>{_n=o.result,console.log("Offline database initialized"),l(_n)},o.onupgradeneeded=c=>{const m=c.target.result;if(m.objectStoreNames.contains(Gt.PROJECTS)||m.createObjectStore(Gt.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),m.objectStoreNames.contains(Gt.AREAS)||m.createObjectStore(Gt.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),m.objectStoreNames.contains(Gt.CREW_CHECKINS)||m.createObjectStore(Gt.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!m.objectStoreNames.contains(Gt.PENDING_ACTIONS)){const u=m.createObjectStore(Gt.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});u.createIndex("type","type",{unique:!1}),u.createIndex("created_at","created_at",{unique:!1})}m.objectStoreNames.contains(Gt.CACHED_DATA)||m.createObjectStore(Gt.CACHED_DATA,{keyPath:"key"})}}),Sn=(l,r="readonly")=>{if(!_n)throw new Error("Database not initialized");return _n.transaction(l,r).objectStore(l)},kx=async(l,r)=>(await Ns(),new Promise((o,c)=>{const u=Sn(l,"readwrite").put(r);u.onsuccess=()=>o(u.result),u.onerror=()=>c(u.error)})),qf=async(l,r)=>(await Ns(),new Promise((o,c)=>{const m=_n.transaction(l,"readwrite"),u=m.objectStore(l);r.forEach(x=>u.put(x)),m.oncomplete=()=>o(),m.onerror=()=>c(m.error)})),Ex=async(l,r)=>(await Ns(),new Promise((o,c)=>{const u=Sn(l).get(r);u.onsuccess=()=>o(u.result),u.onerror=()=>c(u.error)})),Of=async l=>(await Ns(),new Promise((r,o)=>{const m=Sn(l).getAll();m.onsuccess=()=>r(m.result||[]),m.onerror=()=>o(m.error)})),Uf=async(l,r,o)=>(await Ns(),new Promise((c,m)=>{const g=Sn(l).index(r).getAll(o);g.onsuccess=()=>c(g.result||[]),g.onerror=()=>m(g.error)})),Dx=async(l,r)=>(await Ns(),new Promise((o,c)=>{const u=Sn(l,"readwrite").delete(r);u.onsuccess=()=>o(),u.onerror=()=>c(u.error)})),Ws={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},rf=async(l,r,o={})=>{await Ns();const c={type:l,payload:r,metadata:o,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((m,u)=>{const g=Sn(Gt.PENDING_ACTIONS,"readwrite").add(c);g.onsuccess=()=>{console.log(`Queued offline action: ${l}`),m(g.result)},g.onerror=()=>u(g.error)})},Lf=async()=>Of(Gt.PENDING_ACTIONS),Po=async()=>(await Lf()).length,Mx=async l=>Dx(Gt.PENDING_ACTIONS,l),Tx=async(l,r)=>(await Ns(),new Promise((o,c)=>{const m=Sn(Gt.PENDING_ACTIONS,"readwrite"),u=m.get(l);u.onsuccess=()=>{const x=u.result;if(x){const g={...x,...r},f=m.put(g);f.onsuccess=()=>o(g),f.onerror=()=>c(f.error)}else c(new Error("Action not found"))},u.onerror=()=>c(u.error)})),Ax=async l=>qf(Gt.PROJECTS,l),cf=async l=>l?Uf(Gt.PROJECTS,"company_id",l):Of(Gt.PROJECTS),Rx=async l=>qf(Gt.AREAS,l),of=async l=>Uf(Gt.AREAS,"project_id",l),Io=async(l,r)=>{const o=await Ex(Gt.AREAS,l);return o&&(o.status=r,o.updated_at=new Date().toISOString(),await kx(Gt.AREAS,o)),o};let md=navigator.onLine;const od=new Set,Bf=l=>(od.add(l),()=>od.delete(l)),cr=()=>md,df=l=>{md=l,od.forEach(r=>r(l))};typeof window<"u"&&(window.addEventListener("online",()=>{console.log("Connection restored"),df(!0)}),window.addEventListener("offline",()=>{console.log("Connection lost"),df(!1)}));let Jo=!1;const zx=async l=>{if(Jo||!md)return{synced:0,failed:0};Jo=!0;const r={synced:0,failed:0};try{const o=await Lf();console.log(`Syncing ${o.length} pending actions...`);for(const c of o)try{await qx(c,l),await Mx(c.id),r.synced++,console.log(`Synced action: ${c.type}`)}catch(m){console.error(`Failed to sync action ${c.type}:`,m),r.failed++,await Tx(c.id,{attempts:(c.attempts||0)+1,last_error:m.message,last_attempt:new Date().toISOString()})}}finally{Jo=!1}return r},qx=async(l,r)=>{const{type:o,payload:c}=l;switch(o){case Ws.UPDATE_AREA_STATUS:return r.updateAreaStatus(c.areaId,c.status);case Ws.CREATE_TM_TICKET:const m=await r.createTMTicket(c.ticket);return c.workers?.length>0&&await r.addTMWorkers(m.id,c.workers),c.items?.length>0&&await r.addTMItems(m.id,c.items),m;case Ws.SAVE_CREW_CHECKIN:return r.saveCrewCheckin(c.projectId,c.workers,c.checkInDate);case Ws.SUBMIT_DAILY_REPORT:return await r.saveDailyReport(c.projectId,c.reportData),r.submitDailyReport(c.projectId,c.submittedBy);case Ws.SEND_MESSAGE:return r.sendMessage(c.projectId,c.senderType,c.senderName,c.content);case Ws.CREATE_MATERIAL_REQUEST:return r.createMaterialRequest(c.projectId,c.items,c.requestedBy,c.neededBy,c.priority,c.notes);default:throw new Error(`Unknown action type: ${o}`)}},Ox="https://cegifnrcwdilromcyouq.supabase.co",Hf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlZ2lmbnJjd2RpbHJvbWN5b3VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTQ5OTAsImV4cCI6MjA4MDIzMDk5MH0.qAiBG5XaB0C1E0U2tQbQkrhpm1iUhM6A2MXngEHhX4A",K=!!Hf;Ns().catch(l=>console.error("Failed to init offline DB:",l));const U=K?hx(Ox,Hf):null,Ff="fieldsync_data",dd="fieldsync_user",Ue=()=>{const l=localStorage.getItem(Ff);return l?JSON.parse(l):{projects:[],areas:[],users:[],assignments:[]}},it=l=>{localStorage.setItem(Ff,JSON.stringify(l))},wi=()=>{const l=localStorage.getItem(dd);return l?JSON.parse(l):null},ki=l=>{l?localStorage.setItem(dd,JSON.stringify(l)):localStorage.removeItem(dd)},Ux={async signUp(l,r,o,c){if(K){const{data:m,error:u}=await U.auth.signUp({email:l,password:r,options:{data:{name:o,role:c}}});if(u)throw u;return m}else{const m=Ue(),u={id:crypto.randomUUID(),email:l,name:o,role:c,created_at:new Date().toISOString()};return m.users.push(u),it(m),ki(u),{user:u}}},async signIn(l,r){if(K){const{data:o,error:c}=await U.auth.signInWithPassword({email:l,password:r});if(c)throw c;return o}else{const c=Ue().users.find(m=>m.email===l);if(!c)throw new Error("User not found");return ki(c),{user:c}}},async signOut(){if(K){const{error:l}=await U.auth.signOut();if(l)throw l}else ki(null)},async getUser(){if(K){const{data:{user:l}}=await U.auth.getUser();return l}else return wi()},async getProfile(){if(K){const{data:{user:l}}=await U.auth.getUser();if(!l)return null;const{data:r,error:o}=await U.from("users").select("*").eq("id",l.id).single();return o?{id:l.id,email:l.email,name:l.user_metadata?.name||"",role:l.user_metadata?.role||"foreman"}:r}else return wi()},async updateRole(l,r){if(K){const{data:o,error:c}=await U.from("users").update({role:r}).eq("id",l).select().single();if(c)throw c;return o}else{const o=Ue(),c=o.users.find(m=>m.id===l);return c&&(c.role=r,it(o),wi()?.id===l&&ki(c)),c}},onAuthStateChange(l){if(K)return U.auth.onAuthStateChange(l);{const r=wi();return l(r?"SIGNED_IN":"SIGNED_OUT",{user:r}),{data:{subscription:{unsubscribe:()=>{}}}}}}},ce={async getProjects(l=null,r=!1){if(K){if(!cr()){console.log("Offline: returning cached projects");const u=await cf(l);return r?u:u.filter(x=>x.status!=="archived")}let o=U.from("projects").select("*").order("created_at",{ascending:!1});l&&(o=o.eq("company_id",l)),r||(o=o.eq("status","active"));const{data:c,error:m}=await o;if(m){console.log("Error fetching projects, trying cache:",m.message);const u=await cf(l);if(u.length>0)return u;throw m}return c?.length>0&&Ax(c).catch(u=>console.error("Failed to cache projects:",u)),c}else{const o=Ue().projects;return r?o:o.filter(c=>c.status!=="archived")}},async getArchivedProjects(l){if(K){const{data:r,error:o}=await U.from("projects").select("*").eq("company_id",l).eq("status","archived").order("archived_at",{ascending:!1});if(o)throw o;return r}else return Ue().projects.filter(r=>r.status==="archived")},async getProjectCount(l){if(K){const{count:r,error:o}=await U.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",l).in("status",["active","archived"]);if(o)throw o;return r||0}else return Ue().projects.filter(o=>o.company_id===l&&o.status!=="deleted").length},async archiveProject(l){if(K){const{data:r,error:o}=await U.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",l).select().single();if(o)throw o;return r}else{const r=Ue(),o=r.projects.find(c=>c.id===l);return o&&(o.status="archived",o.archived_at=new Date().toISOString(),it(r)),o}},async restoreProject(l){if(K){const{data:r,error:o}=await U.from("projects").update({status:"active",archived_at:null}).eq("id",l).select().single();if(o)throw o;return r}else{const r=Ue(),o=r.projects.find(c=>c.id===l);return o&&(o.status="active",o.archived_at=null,it(r)),o}},async getProject(l){if(K){const{data:r,error:o}=await U.from("projects").select("*").eq("id",l).single();if(o)throw o;return r}else return Ue().projects.find(r=>r.id===l)},async createProject(l){if(K){console.log("Creating project with data:",l);const{data:r,error:o}=await U.from("projects").insert({...l,status:"active"}).select().single();if(o)throw console.error("Supabase createProject error:",o.message,o.details,o.hint),o;return r}else{const r=Ue(),o={...l,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return r.projects.push(o),it(r),o}},async getProjectByPin(l){if(K){const{data:r,error:o}=await U.from("projects").select("*").eq("pin",l).eq("status","active").single();return o?null:r}else return Ue().projects.find(o=>o.pin===l&&o.status==="active")||null},async getProjectByPinAndCompany(l,r){if(K){const{data:o,error:c}=await U.from("projects").select("*").eq("pin",l).eq("company_id",r).eq("status","active").single();return c?null:o}else return Ue().projects.find(c=>c.pin===l&&c.company_id===r&&c.status==="active")||null},async isPinAvailable(l,r=null){if(K){let o=U.from("projects").select("id").eq("pin",l);r&&(o=o.neq("id",r));const{data:c,error:m}=await o;if(m)throw m;return c.length===0}else return!Ue().projects.some(c=>c.pin===l&&c.id!==r)},async updateProjectPin(l,r){if(K){const{data:o,error:c}=await U.from("projects").update({pin:r}).eq("id",l).select().single();if(c)throw c;return o}else{const o=Ue(),c=o.projects.find(m=>m.id===l);return c&&(c.pin=r,it(o)),c}},async updateProject(l,r){if(K){const{data:o,error:c}=await U.from("projects").update(r).eq("id",l).select().single();if(c)throw console.error("Error updating project:",c),c;return o}else{const o=Ue(),c=o.projects.find(m=>m.id===l);return c&&(Object.assign(c,r),it(o)),c}},async deleteProject(l){if(K){const{error:r}=await U.from("projects").delete().eq("id",l);if(r)throw r}else{const r=Ue();r.projects=r.projects.filter(o=>o.id!==l),r.areas=r.areas.filter(o=>o.project_id!==l),it(r)}},async getAreas(l){if(K){if(!cr())return console.log("Offline: returning cached areas"),of(l);const{data:r,error:o}=await U.from("areas").select("*").eq("project_id",l).order("sort_order",{ascending:!0});if(o){console.log("Error fetching areas, trying cache:",o.message);const c=await of(l);if(c.length>0)return c;throw o}return r?.length>0&&Rx(r).catch(c=>console.error("Failed to cache areas:",c)),r}else return Ue().areas.filter(r=>r.project_id===l)},async createArea(l){if(K){const{data:r,error:o}=await U.from("areas").insert(l).select().single();if(o)throw o;return r}else{const r=Ue(),o={...l,id:crypto.randomUUID(),created_at:new Date().toISOString()};return r.areas.push(o),it(r),o}},async updateAreaStatus(l,r){if(K){if(!cr()){console.log("Offline: queuing area status update");const m=await Io(l,r);return await rf(Ws.UPDATE_AREA_STATUS,{areaId:l,status:r}),m}const{data:o,error:c}=await U.from("areas").update({status:r}).eq("id",l).select().single();if(c){if(c.message?.includes("fetch")||c.message?.includes("network")){console.log("Network error: queuing area status update");const m=await Io(l,r);return await rf(Ws.UPDATE_AREA_STATUS,{areaId:l,status:r}),m}throw c}return o&&Io(l,r).catch(m=>console.error("Failed to update cached area:",m)),o}else{const o=Ue(),c=o.areas.find(m=>m.id===l);return c&&(c.status=r,c.updated_at=new Date().toISOString()),it(o),c}},async updateArea(l,r){if(K){const{data:o,error:c}=await U.from("areas").update(r).eq("id",l).select().single();if(c)throw c;return o}else{const o=Ue(),c=o.areas.find(m=>m.id===l);return c&&(Object.assign(c,r),c.updated_at=new Date().toISOString()),it(o),c}},async deleteArea(l){if(K){const{error:r}=await U.from("areas").delete().eq("id",l);if(r)throw r}else{const r=Ue();r.areas=r.areas.filter(o=>o.id!==l),it(r)}},subscribeToAreas(l,r){return K?U.channel(`areas:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${l}`},r).subscribe():null},subscribeToMessages(l,r){return K?U.channel(`messages:${l}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${l}`},r).subscribe():null},subscribeToMaterialRequests(l,r){return K?U.channel(`material_requests:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${l}`},r).subscribe():null},subscribeToDailyReports(l,r){return K?U.channel(`daily_reports:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${l}`},r).subscribe():null},subscribeToCrewCheckins(l,r){return K?U.channel(`crew_checkins:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${l}`},r).subscribe():null},subscribeToInjuryReports(l,r){return K?U.channel(`injury_reports:${l}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${l}`},r).subscribe():null},subscribeToTMTickets(l,r){return K?U.channel(`tm_tickets:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${l}`},r).subscribe():null},subscribeToCompanyActivity(l,r,o){if(!K||!r||r.length===0)return null;const c=U.channel(`company_activity:${l}`);return r.forEach(m=>{c.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${m}`},u=>o.onMessage?.(u)),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"material_requests",filter:`project_id=eq.${m}`},u=>o.onMaterialRequest?.(u)),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${m}`},u=>o.onTMTicket?.(u))}),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${l}`},m=>o.onInjuryReport?.(m)),c.subscribe()},unsubscribe(l){l&&K&&U.removeChannel(l)},async getAssignedProjects(l){if(K){const{data:r,error:o}=await U.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",l);if(o)throw o;return r.map(c=>c.projects)}else{const r=Ue();return(r.assignments?.filter(c=>c.user_id===l)||[]).map(c=>r.projects.find(m=>m.id===c.project_id)).filter(Boolean)}},async assignUserToProject(l,r,o){if(K){const{data:c,error:m}=await U.from("project_assignments").insert({project_id:l,user_id:r,assigned_by:o}).select().single();if(m)throw m;return c}else{const c=Ue();c.assignments||(c.assignments=[]);const m={id:crypto.randomUUID(),project_id:l,user_id:r,assigned_by:o,assigned_at:new Date().toISOString()};return c.assignments.push(m),it(c),m}},async removeUserFromProject(l,r){if(K){const{error:o}=await U.from("project_assignments").delete().eq("project_id",l).eq("user_id",r);if(o)throw o}else{const o=Ue();o.assignments=o.assignments?.filter(c=>!(c.project_id===l&&c.user_id===r))||[],it(o)}},async getProjectAssignments(l){if(K){const{data:r,error:o}=await U.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",l);if(o)throw o;return r.map(c=>c.users)}else{const r=Ue();return(r.assignments?.filter(c=>c.project_id===l)||[]).map(c=>r.users.find(m=>m.id===c.user_id)).filter(Boolean)}},async getAllUsers(){if(K){const{data:l,error:r}=await U.from("users").select("*").order("name");if(r)throw r;return l}else return Ue().users||[]},async getForemen(){if(K){const{data:l,error:r}=await U.from("users").select("*").eq("role","foreman").order("name");if(r)throw r;return l}else return(Ue().users||[]).filter(l=>l.role==="foreman")},async logActivity(l,r,o,c,m,u){if(K){const{error:x}=await U.from("activity_log").insert({user_id:l,project_id:r,area_id:o,action:c,old_value:m,new_value:u});x&&console.error("Error logging activity:",x)}},async getProjectActivity(l,r=50){if(K){const{data:o,error:c}=await U.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",l).order("created_at",{ascending:!1}).limit(r);if(c)throw c;return o}return[]},async getMaterialsEquipment(l){if(K){const{data:r,error:o}=await U.from("materials_equipment").select("*").eq("company_id",l).eq("active",!0).order("category").order("name");if(o)throw o;return r}return[]},async getMaterialsEquipmentByCategory(l,r){if(K){const{data:o,error:c}=await U.from("materials_equipment").select("*").eq("company_id",l).eq("category",r).eq("active",!0).order("name");if(c)throw c;return o}return[]},async getAllMaterialsEquipment(l){if(K){const{data:r,error:o}=await U.from("materials_equipment").select("*").eq("company_id",l).order("category").order("name");if(o)throw o;return r}return[]},async createMaterialEquipment(l){if(K){const{data:r,error:o}=await U.from("materials_equipment").insert(l).select().single();if(o)throw o;return r}return null},async updateMaterialEquipment(l,r){if(K){const{data:o,error:c}=await U.from("materials_equipment").update(r).eq("id",l).select().single();if(c)throw c;return o}return null},async deleteMaterialEquipment(l){if(K){const{error:r}=await U.from("materials_equipment").update({active:!1}).eq("id",l);if(r)throw r}},async getTMTickets(l){if(K){const{data:r,error:o}=await U.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",l).order("created_at",{ascending:!1});if(o)throw o;return r}return[]},async getChangeOrderTotals(l){if(K){const{data:r,error:o}=await U.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",l).not("ce_pco_number","is",null).neq("ce_pco_number","");if(o)throw o;const c={};let m=0,u=0;return r?.forEach(x=>{const g=x.ce_pco_number;if(c[g]||(c[g]={approved:0,pending:0,count:0}),c[g].count++,x.status==="approved"||x.status==="billed"){const f=parseFloat(x.change_order_value)||0;c[g].approved+=f,m+=f}else x.status==="pending"&&u++}),{changeOrders:c,totalApprovedValue:m,pendingCount:u}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(l,r){if(K){const{data:o,error:c}=await U.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",l).eq("status",r).order("created_at",{ascending:!1});if(c)throw c;return o}return[]},async getCORTickets(l){if(K){const{data:r,error:o}=await U.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",l).order("work_date",{ascending:!0});if(o)throw o;return r||[]}return[]},async createTMTicket(l){if(K){const{data:r,error:o}=await U.from("t_and_m_tickets").insert({project_id:l.project_id,work_date:l.work_date,ce_pco_number:l.ce_pco_number||null,assigned_cor_id:l.assigned_cor_id||null,notes:l.notes,photos:l.photos||[],status:"pending",created_by_name:l.created_by_name||"Field User"}).select().single();if(o)throw o;return r}return null},async addTMWorkers(l,r){if(K){const o=r.map(m=>({ticket_id:l,name:m.name,hours:m.hours,overtime_hours:m.overtime_hours||0,time_started:m.time_started||null,time_ended:m.time_ended||null,role:m.role||"Laborer"})),{error:c}=await U.from("t_and_m_workers").insert(o);if(c)throw c}},async addTMItems(l,r){if(K){const o=r.map(m=>({ticket_id:l,material_equipment_id:m.material_equipment_id||null,custom_name:m.custom_name||null,custom_category:m.custom_category||null,quantity:m.quantity})),{error:c}=await U.from("t_and_m_items").insert(o);if(c)throw c}},async updateTMTicketStatus(l,r){if(K){const{data:o,error:c}=await U.from("t_and_m_tickets").update({status:r}).eq("id",l).select().single();if(c)throw c;return o}return null},async approveTMTicket(l,r,o,c=null){if(K){const m={status:"approved",approved_by_user_id:r,approved_by_name:o,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};c!==null&&(m.change_order_value=parseFloat(c)||0);const{data:u,error:x}=await U.from("t_and_m_tickets").update(m).eq("id",l).select().single();if(x)throw x;return u}return null},async rejectTMTicket(l,r,o,c=""){if(K){const{data:m,error:u}=await U.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:r,rejected_by_name:o,rejected_at:new Date().toISOString(),rejection_reason:c,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",l).select().single();if(u)throw u;return m}return null},canApproveTickets(l){return["owner","admin","manager"].includes(l)},async updateTMTicketPhotos(l,r){if(K){const{data:o,error:c}=await U.from("t_and_m_tickets").update({photos:r}).eq("id",l).select().single();if(c)throw c;return o}return null},async deleteTMTicket(l){if(K){const{error:r}=await U.from("t_and_m_tickets").delete().eq("id",l);if(r)throw r}},async isTicketEditable(l){if(!l?.assigned_cor_id)return{editable:!0};if(K)try{const{data:r,error:o}=await U.from("change_orders").select("id, status, cor_number").eq("id",l.assigned_cor_id).single();if(o||!r)return{editable:!0};const m=["draft","pending_approval"].includes(r.status);return{editable:m,lockedBy:m?null:r,reason:m?null:`This ticket is linked to ${r.cor_number} which has been ${r.status==="approved"?"approved":r.status}`}}catch(r){return console.error("Error checking ticket editability:",r),{editable:!0}}return{editable:!0}},async getCompanyByCode(l){if(K){const{data:r,error:o}=await U.from("companies").select("*").eq("code",l).single();return o?null:r}return null},async getCompany(l){if(K){const{data:r,error:o}=await U.from("companies").select("*").eq("id",l).single();if(o)throw o;return r}return null},async getUserCompanies(l){if(K){const{data:r,error:o}=await U.from("user_companies").select(`
          id,
          role,
          company_id,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",l).order("created_at",{ascending:!0});return o?(console.error("Error fetching user companies:",o),[]):r.map(c=>({id:c.companies.id,name:c.companies.name,code:c.companies.code,role:c.role}))}return[]},async uploadPhoto(l,r,o,c){if(!K)return null;const m=Date.now(),u=Math.random().toString(36).substring(7),x=c.name?.split(".").pop()||"jpg",g=`${m}-${u}.${x}`,f=`${l}/${r}/${o}/${g}`,{data:v,error:y}=await U.storage.from("tm-photos").upload(f,c,{cacheControl:"3600",upsert:!1});if(y)throw y;const{data:R}=U.storage.from("tm-photos").getPublicUrl(f);return R.publicUrl},async uploadPhotoBase64(l,r,o,c,m="photo.jpg"){if(!K)return null;const x=await(await fetch(c)).blob(),g=Date.now(),f=Math.random().toString(36).substring(7),v=m.split(".").pop()||"jpg",y=`${g}-${f}.${v}`,R=`${l}/${r}/${o}/${y}`,{data:X,error:B}=await U.storage.from("tm-photos").upload(R,x,{cacheControl:"3600",upsert:!1,contentType:x.type});if(B)throw B;const{data:V}=U.storage.from("tm-photos").getPublicUrl(R);return V.publicUrl},async deletePhoto(l){if(!K)return;const o=new URL(l).pathname.match(/\/tm-photos\/(.+)$/);if(!o)return;const c=o[1],{error:m}=await U.storage.from("tm-photos").remove([c]);if(m)throw m},async getCrewCheckin(l,r=null){if(!K)return null;const o=r||new Date().toISOString().split("T")[0],{data:c,error:m}=await U.from("crew_checkins").select("*").eq("project_id",l).eq("check_in_date",o).single();return m&&m.code!=="PGRST116"&&console.error("Error fetching crew checkin:",m),c},async saveCrewCheckin(l,r,o=null,c=null){if(!K)return null;const m=c||new Date().toISOString().split("T")[0],{data:u,error:x}=await U.from("crew_checkins").upsert({project_id:l,check_in_date:m,workers:r,created_by:o,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(x)throw console.error("Error saving crew checkin:",x),x;return u},async addCrewMember(l,r,o=null){if(!K)return null;const c=await this.getCrewCheckin(l),m=c?.workers||[];return m.find(u=>u.name.toLowerCase()===r.name.toLowerCase())?c:(m.push(r),await this.saveCrewCheckin(l,m,o))},async removeCrewMember(l,r){if(!K)return null;const o=await this.getCrewCheckin(l);if(!o)return null;const c=o.workers.filter(m=>m.name.toLowerCase()!==r.toLowerCase());return await this.saveCrewCheckin(l,c,o.created_by)},async getCrewCheckinHistory(l,r=30){if(!K)return[];const{data:o,error:c}=await U.from("crew_checkins").select("*").eq("project_id",l).order("check_in_date",{ascending:!1}).limit(r);return c?(console.error("Error fetching crew history:",c),[]):o||[]},async getLaborRates(l,r=null,o=null){if(!K)return[];let c=U.from("labor_rates").select("*").eq("company_id",l);r&&(c=c.eq("work_type",r)),o&&(c=c.eq("job_type",o));const{data:m,error:u}=await c;return u?(console.error("Error fetching labor rates:",u),[]):m||[]},async calculateManDayCosts(l,r,o,c){if(!K)return{totalCost:0,totalManDays:0,breakdown:[]};const m=await this.getCrewCheckinHistory(l,365),u=await this.getLaborRates(r,o,c),x={};u.forEach(R=>{x[R.role.toLowerCase()]=parseFloat(R.regular_rate)||0});let g=0,f=0;const v={},y=[];return m.forEach(R=>{const X=R.workers||[];let B=0;const V={};X.forEach(L=>{const q=(L.role||"laborer").toLowerCase(),ee=x[q]||0;V[q]||(V[q]={count:0,cost:0}),V[q].count++,V[q].cost+=ee,B+=ee,v[q]||(v[q]={count:0,cost:0,rate:ee}),v[q].count++,v[q].cost+=ee}),g+=B,f+=X.length,y.push({date:R.check_in_date,workers:X.length,cost:B,breakdown:V})}),{totalCost:g,totalManDays:f,byRole:v,byDate:y,daysWorked:m.length}},async getDailyReport(l,r=null){if(!K)return null;const o=r||new Date().toISOString().split("T")[0],{data:c,error:m}=await U.from("daily_reports").select("*").eq("project_id",l).eq("report_date",o).single();return m&&m.code!=="PGRST116"&&console.error("Error fetching daily report:",m),c},async compileDailyReport(l,r=null){if(!K)return null;const o=r||new Date().toISOString().split("T")[0],c=await this.getCrewCheckin(l,o),{data:m}=await U.from("areas").select("*").eq("project_id",l),u=m?.filter(f=>f.status==="done"&&f.completed_at?.startsWith(o))||[],{data:x}=await U.from("t_and_m_tickets").select("*").eq("project_id",l).eq("work_date",o),g=x?.reduce((f,v)=>f+(v.photos?.length||0),0)||0;return{crew_count:c?.workers?.length||0,crew_list:c?.workers||[],tasks_completed:u.length,tasks_total:m?.length||0,completed_tasks:u.map(f=>({name:f.name,group:f.group_name})),tm_tickets_count:x?.length||0,photos_count:g}},async saveDailyReport(l,r,o=null){if(!K)return null;const c=o||new Date().toISOString().split("T")[0],{data:m,error:u}=await U.from("daily_reports").upsert({project_id:l,report_date:c,...r,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(u)throw console.error("Error saving daily report:",u),u;return m},async submitDailyReport(l,r,o=null){if(!K)return null;const c=o||new Date().toISOString().split("T")[0],m=await this.compileDailyReport(l,c),{data:u,error:x}=await U.from("daily_reports").upsert({project_id:l,report_date:c,...m,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:r,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(x)throw console.error("Error submitting daily report:",x),x;return u},async getDailyReports(l,r=30){if(!K)return[];const{data:o,error:c}=await U.from("daily_reports").select("*").eq("project_id",l).order("report_date",{ascending:!1}).limit(r);return c?(console.error("Error fetching daily reports:",c),[]):o||[]},async sendMessage(l,r,o,c,m=null,u=null,x="general",g=null){if(!K)return null;const{data:f,error:v}=await U.from("messages").insert({project_id:l,sender_type:o,sender_name:c,sender_user_id:m,message:r,photo_url:u,message_type:x,parent_message_id:g}).select().single();if(v)throw console.error("Error sending message:",v),v;return f},async getMessages(l,r=50){if(!K)return[];const{data:o,error:c}=await U.from("messages").select("*").eq("project_id",l).order("created_at",{ascending:!1}).limit(r);return c?(console.error("Error fetching messages:",c),[]):o||[]},async getUnreadCount(l,r){if(!K)return 0;const o=r==="field"?"office":"field",{count:c,error:m}=await U.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",l).eq("sender_type",o).eq("is_read",!1);return m?(console.error("Error getting unread count:",m),0):c||0},async markMessagesRead(l,r){if(!K)return;const o=r==="field"?"office":"field",{error:c}=await U.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",l).eq("sender_type",o).eq("is_read",!1);c&&console.error("Error marking messages read:",c)},async createMaterialRequest(l,r,o,c=null,m="normal",u=null){if(!K)return null;const{data:x,error:g}=await U.from("material_requests").insert({project_id:l,items:r,requested_by:o,needed_by:c,priority:m,notes:u}).select().single();if(g)throw console.error("Error creating material request:",g),g;return x},async getMaterialRequests(l,r=null){if(!K)return[];let o=U.from("material_requests").select("*").eq("project_id",l).order("created_at",{ascending:!1});r&&(o=o.eq("status",r));const{data:c,error:m}=await o;return m?(console.error("Error fetching material requests:",m),[]):c||[]},async getPendingRequestsCount(l){if(!K)return 0;const{count:r,error:o}=await U.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",l).eq("status","pending");return o?0:r||0},async updateMaterialRequest(l,r,o,c=null,m=null){if(!K)return null;const u={status:r,responded_by:o,responded_at:new Date().toISOString(),response_notes:c,updated_at:new Date().toISOString()};m&&(u.expected_delivery=m),r==="delivered"&&(u.delivered_at=new Date().toISOString());const{data:x,error:g}=await U.from("material_requests").update(u).eq("id",l).select().single();if(g)throw console.error("Error updating material request:",g),g;return x},generateShareToken(){const l="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let r="";for(let o=0;o<12;o++)r+=l.charAt(Math.floor(Math.random()*l.length));return r},async createProjectShare(l,r,o,c=null){if(!K){const f=Ue();f.projectShares||(f.projectShares=[]);const v={id:crypto.randomUUID(),project_id:l,share_token:this.generateShareToken(),created_by:r,expires_at:c,is_active:!0,permissions:o,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return f.projectShares.push(v),it(f),v}const{data:m,error:u}=await U.rpc("generate_share_token");if(u)throw console.error("Error generating share token:",u),u;const{data:x,error:g}=await U.from("project_shares").insert({project_id:l,share_token:m,created_by:r,expires_at:c,permissions:o}).select().single();if(g)throw console.error("Error creating project share:",g),g;return x},async getShareByToken(l){if(!K){const c=Ue();if(!c.projectShares)return null;const m=c.projectShares.find(u=>u.share_token===l&&u.is_active&&(!u.expires_at||new Date(u.expires_at)>new Date));return m&&(m.view_count++,m.last_viewed_at=new Date().toISOString(),it(c)),m}const{data:r,error:o}=await U.from("project_shares").select("*, projects(*)").eq("share_token",l).eq("is_active",!0).single();return o?(console.error("Error fetching share by token:",o),null):r.expires_at&&new Date(r.expires_at)<new Date?null:(await U.rpc("increment_share_view_count",{token:l}),r)},async getProjectShares(l){if(!K){const c=Ue();return c.projectShares?c.projectShares.filter(m=>m.project_id===l):[]}const{data:r,error:o}=await U.from("project_shares").select("*, users(name, email)").eq("project_id",l).order("created_at",{ascending:!1});return o?(console.error("Error fetching project shares:",o),[]):r||[]},async updateProjectShare(l,r){if(!K){const m=Ue();if(!m.projectShares)return null;const u=m.projectShares.findIndex(x=>x.id===l);return u===-1?null:(m.projectShares[u]={...m.projectShares[u],...r,updated_at:new Date().toISOString()},it(m),m.projectShares[u])}const{data:o,error:c}=await U.from("project_shares").update(r).eq("id",l).select().single();if(c)throw console.error("Error updating project share:",c),c;return o},async revokeProjectShare(l){return this.updateProjectShare(l,{is_active:!1})},async deleteProjectShare(l){if(!K){const o=Ue();if(!o.projectShares)return;o.projectShares=o.projectShares.filter(c=>c.id!==l),it(o);return}const{error:r}=await U.from("project_shares").delete().eq("id",l);if(r)throw console.error("Error deleting project share:",r),r},async getPublicProjectData(l){const r=await this.getShareByToken(l);if(!r)return null;const o=r.project_id||r.projects?.id;if(!K){const u=Ue(),x=u.projects.find(R=>R.id===o);if(!x)return null;const g=u.areas.filter(R=>R.project_id===o),f=g.reduce((R,X)=>R+parseFloat(X.weight||0),0),v=g.filter(R=>R.status==="done").reduce((R,X)=>R+parseFloat(X.weight||0),0),y=f>0?Math.round(v/f*100):0;return{share:r,project:x,progress:y,areas:r.permissions.progress?g:[],photos:[],dailyReports:[],tmTickets:[]}}const c=r.projects||await this.getProject(o);if(!c)return null;const m={share:r,project:c,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(r.permissions.progress){m.areas=await this.getAreas(o);const u=m.areas.reduce((g,f)=>g+parseFloat(f.weight||0),0),x=m.areas.filter(g=>g.status==="done").reduce((g,f)=>g+parseFloat(f.weight||0),0);m.progress=u>0?Math.round(x/u*100):0}if(r.permissions.photos){const{data:u}=await U.from("t_and_m_tickets").select("photos, work_date").eq("project_id",o).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);m.photos=u?.flatMap(x=>(x.photos||[]).map(g=>({url:g,date:x.work_date})))||[]}if(r.permissions.daily_reports){const{data:u}=await U.from("daily_reports").select("*").eq("project_id",o).order("report_date",{ascending:!1}).limit(10);m.dailyReports=u||[]}return r.permissions.tm_tickets&&(m.tmTickets=await this.getTMTickets(o)),m},async createInjuryReport(l){if(!K){const c=Ue();c.injuryReports||(c.injuryReports=[]);const m={id:crypto.randomUUID(),...l,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return c.injuryReports.push(m),it(c),m}const{data:r,error:o}=await U.from("injury_reports").insert(l).select().single();if(o)throw console.error("Error creating injury report:",o),o;return r},async getInjuryReports(l){if(!K){const c=Ue();return c.injuryReports?c.injuryReports.filter(m=>m.project_id===l).sort((m,u)=>new Date(u.incident_date)-new Date(m.incident_date)):[]}const{data:r,error:o}=await U.from("injury_reports").select("*").eq("project_id",l).order("incident_date",{ascending:!1});return o?(console.error("Error fetching injury reports:",o),[]):r||[]},async getCompanyInjuryReports(l,r=null){if(!K){const u=Ue();if(!u.injuryReports)return[];let x=u.injuryReports.filter(g=>g.company_id===l);return r&&(x=x.filter(g=>g.status===r)),x.sort((g,f)=>new Date(f.incident_date)-new Date(g.incident_date))}let o=U.from("injury_reports").select("*, projects(name)").eq("company_id",l).order("incident_date",{ascending:!1});r&&(o=o.eq("status",r));const{data:c,error:m}=await o;return m?(console.error("Error fetching company injury reports:",m),[]):c||[]},async getInjuryReport(l){if(!K){const c=Ue();return c.injuryReports?c.injuryReports.find(m=>m.id===l):null}const{data:r,error:o}=await U.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",l).single();return o?(console.error("Error fetching injury report:",o),null):r},async updateInjuryReport(l,r){if(!K){const m=Ue();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(x=>x.id===l);return u===-1?null:(m.injuryReports[u]={...m.injuryReports[u],...r,updated_at:new Date().toISOString()},it(m),m.injuryReports[u])}const{data:o,error:c}=await U.from("injury_reports").update(r).eq("id",l).select().single();if(c)throw console.error("Error updating injury report:",c),c;return o},async closeInjuryReport(l,r){return this.updateInjuryReport(l,{status:"closed",closed_at:new Date().toISOString(),closed_by:r})},async deleteInjuryReport(l){if(!K){const o=Ue();if(!o.injuryReports)return;o.injuryReports=o.injuryReports.filter(c=>c.id!==l),it(o);return}const{error:r}=await U.from("injury_reports").delete().eq("id",l);if(r)throw console.error("Error deleting injury report:",r),r},async getInjuryStatistics(l,r=null,o=null){if(!K){const u=Ue();if(!u.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let x=u.injuryReports.filter(g=>g.company_id===l);return r&&(x=x.filter(g=>new Date(g.incident_date)>=new Date(r))),o&&(x=x.filter(g=>new Date(g.incident_date)<=new Date(o))),{total_incidents:x.length,minor_injuries:x.filter(g=>g.injury_type==="minor").length,serious_injuries:x.filter(g=>g.injury_type==="serious").length,critical_injuries:x.filter(g=>g.injury_type==="critical").length,near_misses:x.filter(g=>g.injury_type==="near_miss").length,osha_recordable:x.filter(g=>g.osha_recordable).length,total_days_away:x.reduce((g,f)=>g+(f.days_away_from_work||0),0),total_restricted_days:x.reduce((g,f)=>g+(f.restricted_work_days||0),0)}}const{data:c,error:m}=await U.rpc("get_injury_statistics",{comp_id:l,start_date:r,end_date:o});return m?(console.error("Error fetching injury statistics:",m),null):c[0]||null},async addWitness(l,r){if(!K){const m=Ue();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(f=>f.id===l);if(u===-1)return null;const x=m.injuryReports[u],g=x.witnesses||[];return g.push(r),m.injuryReports[u]={...x,witnesses:g,updated_at:new Date().toISOString()},it(m),m.injuryReports[u]}const o=await this.getInjuryReport(l);if(!o)return null;const c=o.witnesses||[];return c.push(r),this.updateInjuryReport(l,{witnesses:c})},async removeWitness(l,r){if(!K){const m=Ue();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(f=>f.id===l);if(u===-1)return null;const x=m.injuryReports[u],g=x.witnesses||[];return g.splice(r,1),m.injuryReports[u]={...x,witnesses:g,updated_at:new Date().toISOString()},it(m),m.injuryReports[u]}const o=await this.getInjuryReport(l);if(!o)return null;const c=o.witnesses||[];return c.splice(r,1),this.updateInjuryReport(l,{witnesses:c})},async getCompanyUsers(l){if(K){const{data:r,error:o}=await U.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",l);return o?(console.error("Error fetching company users:",o),[]):r?.map(c=>({id:c.user_id,name:c.users?.name||c.users?.email,email:c.users?.email,role:c.role}))||[]}return[]},async getProjectNotificationPreferences(l){if(K){const{data:o,error:c}=await U.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",l);return c?(console.error("Error fetching notification preferences:",c),[]):o||[]}const r=Ue();return r.notificationPreferences?r.notificationPreferences.filter(o=>o.project_id===l):[]},async getUserNotificationPreferences(l){if(K){const{data:o,error:c}=await U.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",l);return c?(console.error("Error fetching user notification preferences:",c),[]):o||[]}const r=Ue();return r.notificationPreferences?r.notificationPreferences.filter(o=>o.user_id===l):[]},async setNotificationPreference(l,r,o){if(K){const{data:x,error:g}=await U.from("notification_preferences").upsert({project_id:l,user_id:r,notification_types:o,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(g)throw console.error("Error setting notification preference:",g),g;return x}const c=Ue();c.notificationPreferences||(c.notificationPreferences=[]);const m=c.notificationPreferences.findIndex(x=>x.project_id===l&&x.user_id===r),u={id:m>=0?c.notificationPreferences[m].id:crypto.randomUUID(),project_id:l,user_id:r,notification_types:o,created_at:m>=0?c.notificationPreferences[m].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return m>=0?c.notificationPreferences[m]=u:c.notificationPreferences.push(u),it(c),u},async removeNotificationPreference(l,r){if(K){const{error:c}=await U.from("notification_preferences").delete().eq("project_id",l).eq("user_id",r);if(c)throw console.error("Error removing notification preference:",c),c;return!0}const o=Ue();return o.notificationPreferences&&(o.notificationPreferences=o.notificationPreferences.filter(c=>!(c.project_id===l&&c.user_id===r)),it(o)),!0},async setProjectNotificationPreferences(l,r){const o=[];for(const c of r)if(c.notificationTypes&&c.notificationTypes.length>0){const m=await this.setNotificationPreference(l,c.userId,c.notificationTypes);o.push(m)}else await this.removeNotificationPreference(l,c.userId);return o},async getNotificationPresets(l){if(K){const{data:o,error:c}=await U.from("notification_presets").select("*").eq("company_id",l).order("name");return c?(console.error("Error fetching notification presets:",c),[]):o||[]}const r=Ue();return r.notificationPresets?r.notificationPresets.filter(o=>o.company_id===l):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:l},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:l},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:l},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:l}]},async createNotificationPreset(l,r,o){if(K){const{data:u,error:x}=await U.from("notification_presets").insert({company_id:l,name:r,notification_types:o}).select().single();if(x)throw console.error("Error creating notification preset:",x),x;return u}const c=Ue();c.notificationPresets||(c.notificationPresets=[]);const m={id:crypto.randomUUID(),company_id:l,name:r,notification_types:o,created_at:new Date().toISOString()};return c.notificationPresets.push(m),it(c),m},async updateNotificationPreset(l,r,o){if(K){const{data:u,error:x}=await U.from("notification_presets").update({name:r,notification_types:o,updated_at:new Date().toISOString()}).eq("id",l).select().single();if(x)throw console.error("Error updating notification preset:",x),x;return u}const c=Ue();if(!c.notificationPresets)return null;const m=c.notificationPresets.findIndex(u=>u.id===l);return m===-1?null:(c.notificationPresets[m]={...c.notificationPresets[m],name:r,notification_types:o,updated_at:new Date().toISOString()},it(c),c.notificationPresets[m])},async deleteNotificationPreset(l){if(K){const{error:o}=await U.from("notification_presets").delete().eq("id",l);if(o)throw console.error("Error deleting notification preset:",o),o;return!0}const r=Ue();return r.notificationPresets&&(r.notificationPresets=r.notificationPresets.filter(o=>o.id!==l),it(r)),!0},async getDumpSites(l){if(K){const{data:o,error:c}=await U.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",l).eq("active",!0).order("name");return c?(console.error("Error fetching dump sites:",c),[]):o||[]}return(Ue().dumpSites||[]).filter(o=>o.company_id===l&&o.active)},async createDumpSite(l,r,o="",c=""){if(K){const{data:x,error:g}=await U.from("dump_sites").insert({company_id:l,name:r,address:o,notes:c,active:!0}).select().single();if(g)throw console.error("Error creating dump site:",g),g;return x}const m=Ue();m.dumpSites||(m.dumpSites=[]);const u={id:crypto.randomUUID(),company_id:l,name:r,address:o,notes:c,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return m.dumpSites.push(u),it(m),u},async updateDumpSite(l,r){if(K){const{data:m,error:u}=await U.from("dump_sites").update({...r,updated_at:new Date().toISOString()}).eq("id",l).select().single();if(u)throw console.error("Error updating dump site:",u),u;return m}const o=Ue();if(!o.dumpSites)return null;const c=o.dumpSites.findIndex(m=>m.id===l);return c===-1?null:(o.dumpSites[c]={...o.dumpSites[c],...r},it(o),o.dumpSites[c])},async deleteDumpSite(l){return this.updateDumpSite(l,{active:!1})},async setDumpSiteRate(l,r,o,c="load"){if(K){const{data:g}=await U.from("dump_site_rates").select("id").eq("dump_site_id",l).eq("waste_type",r).maybeSingle();if(g){const{data:f,error:v}=await U.from("dump_site_rates").update({estimated_cost_per_load:o,unit:c}).eq("id",g.id).select().single();if(v)throw console.error("Error updating dump site rate:",v),v;return f}else{const{data:f,error:v}=await U.from("dump_site_rates").insert({dump_site_id:l,waste_type:r,estimated_cost_per_load:o,unit:c}).select().single();if(v)throw console.error("Error inserting dump site rate:",v),v;return f}}const m=Ue();m.dumpSiteRates||(m.dumpSiteRates=[]);const u=m.dumpSiteRates.findIndex(g=>g.dump_site_id===l&&g.waste_type===r),x={id:u>=0?m.dumpSiteRates[u].id:crypto.randomUUID(),dump_site_id:l,waste_type:r,estimated_cost_per_load:o,unit:c,created_at:new Date().toISOString()};return u>=0?m.dumpSiteRates[u]=x:m.dumpSiteRates.push(x),it(m),x},async getDumpSiteRates(l){if(K){const{data:o,error:c}=await U.from("dump_site_rates").select("*").eq("dump_site_id",l);return c?(console.error("Error fetching dump site rates:",c),[]):o||[]}return(Ue().dumpSiteRates||[]).filter(o=>o.dump_site_id===l)},async getHaulOffs(l){if(K){const{data:o,error:c}=await U.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",l).order("work_date",{ascending:!1});return c?(console.error("Error fetching haul-offs:",c),[]):o||[]}return(Ue().haulOffs||[]).filter(o=>o.project_id===l).sort((o,c)=>new Date(c.work_date)-new Date(o.work_date))},async createHaulOff(l,r){const o={project_id:l,dump_site_id:r.dumpSiteId,waste_type:r.wasteType,loads:r.loads,hauling_company:r.haulingCompany||"",work_date:r.workDate,notes:r.notes||"",estimated_cost:r.estimatedCost||0,created_by:r.createdBy||""};if(K){const{data:u,error:x}=await U.from("haul_offs").insert(o).select().single();if(x)throw console.error("Error creating haul-off:",x),x;return u}const c=Ue();c.haulOffs||(c.haulOffs=[]);const m={...o,id:crypto.randomUUID(),created_at:new Date().toISOString()};return c.haulOffs.push(m),it(c),m},async calculateHaulOffCosts(l){const r=await this.getHaulOffs(l);let o=0,c=0;const m={},u=[],x={};r.forEach(f=>{const v=parseFloat(f.estimated_cost)||0,y=parseInt(f.loads)||0;o+=v,c+=y,m[f.waste_type]||(m[f.waste_type]={loads:0,cost:0}),m[f.waste_type].loads+=y,m[f.waste_type].cost+=v,x[f.work_date]||(x[f.work_date]={date:f.work_date,loads:0,cost:0}),x[f.work_date].loads+=y,x[f.work_date].cost+=v}),Object.values(x).sort((f,v)=>new Date(v.date)-new Date(f.date)).forEach(f=>u.push(f));const g=u.length;return{totalCost:o,totalLoads:c,byWasteType:m,byDate:u,daysWithHaulOff:g,avgDailyHaulOffCost:g>0?o/g:0}},subscribeToHaulOffs(l,r){return K?U.channel(`haul_offs:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${l}`},r).subscribe():null},async createCOR(l){if(K){const{data:r,error:o}=await U.from("change_orders").insert({company_id:l.company_id,project_id:l.project_id,area_id:l.area_id||null,cor_number:l.cor_number,title:l.title,description:l.description||"",scope_of_work:l.scope_of_work,period_start:l.period_start,period_end:l.period_end,status:"draft",labor_markup_percent:l.labor_markup_percent??1500,materials_markup_percent:l.materials_markup_percent??1500,equipment_markup_percent:l.equipment_markup_percent??1500,subcontractors_markup_percent:l.subcontractors_markup_percent??500,liability_insurance_percent:l.liability_insurance_percent??144,bond_percent:l.bond_percent??100,license_fee_percent:l.license_fee_percent??10,created_by:l.created_by||null}).select().single();if(o)throw o;return r}return null},async updateCOR(l,r){if(K){const{data:o,error:c}=await U.from("change_orders").update({...r,updated_at:new Date().toISOString()}).eq("id",l).select().single();if(c)throw c;return o}return null},async deleteCOR(l){if(K){const{error:r}=await U.from("change_orders").delete().eq("id",l);if(r)throw r}},async getCORs(l,r={}){if(K){let o=U.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",l);r.status&&(o=o.eq("status",r.status)),r.area_id&&(o=o.eq("area_id",r.area_id)),r.date_start&&(o=o.gte("period_start",r.date_start)),r.date_end&&(o=o.lte("period_end",r.date_end)),o=o.order("created_at",{ascending:!1});const{data:c,error:m}=await o;if(m)throw m;return c}return[]},async getCORById(l){if(K){const{data:r,error:o}=await U.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              id, work_date, ce_pco_number, status, notes
            )
          )
        `).eq("id",l).single();if(o)throw o;return r}return null},async getCORsByArea(l,r){if(K){const{data:o,error:c}=await U.from("change_orders").select("*").eq("project_id",l).eq("area_id",r).order("created_at",{ascending:!1});if(c)throw c;return o}return[]},async getAssignableCORs(l){if(K){const{data:r,error:o}=await U.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",l).order("cor_number",{ascending:!0});if(o)throw o;return r||[]}return[]},async getNextCORNumber(l){if(K){const{data:r,error:o}=await U.from("change_orders").select("cor_number").eq("project_id",l).order("created_at",{ascending:!1}).limit(1);if(o)throw o;if(r&&r.length>0){const c=r[0].cor_number.match(/COR #(\d+)/);if(c)return`COR #${parseInt(c[1])+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(l,r){if(K){const o=Math.round(r.regular_hours*r.regular_rate),c=Math.round(r.overtime_hours*r.overtime_rate),m=o+c,{data:u,error:x}=await U.from("change_order_labor").insert({change_order_id:l,labor_class:r.labor_class,wage_type:r.wage_type||"standard",regular_hours:r.regular_hours||0,overtime_hours:r.overtime_hours||0,regular_rate:r.regular_rate||0,overtime_rate:r.overtime_rate||0,regular_total:o,overtime_total:c,total:m,sort_order:r.sort_order||0,source_ticket_id:r.source_ticket_id||null}).select().single();if(x)throw x;return u}return null},async updateCORLaborItem(l,r){if(K){let o={...r};if(r.regular_hours!==void 0||r.regular_rate!==void 0||r.overtime_hours!==void 0||r.overtime_rate!==void 0){const{data:u}=await U.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",l).single(),x=r.regular_hours??u?.regular_hours??0,g=r.overtime_hours??u?.overtime_hours??0,f=r.regular_rate??u?.regular_rate??0,v=r.overtime_rate??u?.overtime_rate??0;o.regular_total=Math.round(x*f),o.overtime_total=Math.round(g*v),o.total=o.regular_total+o.overtime_total}const{data:c,error:m}=await U.from("change_order_labor").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async deleteCORLaborItem(l){if(K){const{error:r}=await U.from("change_order_labor").delete().eq("id",l);if(r)throw r}},async addCORMaterialItem(l,r){if(K){const o=Math.round(r.quantity*r.unit_cost),{data:c,error:m}=await U.from("change_order_materials").insert({change_order_id:l,description:r.description,quantity:r.quantity||1,unit:r.unit||"each",unit_cost:r.unit_cost||0,total:o,source_type:r.source_type||"custom",source_reference:r.source_reference||null,source_ticket_id:r.source_ticket_id||null,sort_order:r.sort_order||0}).select().single();if(m)throw m;return c}return null},async updateCORMaterialItem(l,r){if(K){let o={...r};if(r.quantity!==void 0||r.unit_cost!==void 0){const{data:u}=await U.from("change_order_materials").select("quantity, unit_cost").eq("id",l).single(),x=r.quantity??u?.quantity??1,g=r.unit_cost??u?.unit_cost??0;o.total=Math.round(x*g)}const{data:c,error:m}=await U.from("change_order_materials").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async deleteCORMaterialItem(l){if(K){const{error:r}=await U.from("change_order_materials").delete().eq("id",l);if(r)throw r}},async addCOREquipmentItem(l,r){if(K){const o=Math.round(r.quantity*r.unit_cost),{data:c,error:m}=await U.from("change_order_equipment").insert({change_order_id:l,description:r.description,quantity:r.quantity||1,unit:r.unit||"day",unit_cost:r.unit_cost||0,total:o,source_type:r.source_type||"custom",source_reference:r.source_reference||null,source_ticket_id:r.source_ticket_id||null,sort_order:r.sort_order||0}).select().single();if(m)throw m;return c}return null},async updateCOREquipmentItem(l,r){if(K){let o={...r};if(r.quantity!==void 0||r.unit_cost!==void 0){const{data:u}=await U.from("change_order_equipment").select("quantity, unit_cost").eq("id",l).single(),x=r.quantity??u?.quantity??1,g=r.unit_cost??u?.unit_cost??0;o.total=Math.round(x*g)}const{data:c,error:m}=await U.from("change_order_equipment").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async deleteCOREquipmentItem(l){if(K){const{error:r}=await U.from("change_order_equipment").delete().eq("id",l);if(r)throw r}},async addCORSubcontractorItem(l,r){if(K){const o=Math.round(r.quantity*r.unit_cost),{data:c,error:m}=await U.from("change_order_subcontractors").insert({change_order_id:l,description:r.description,quantity:r.quantity||1,unit:r.unit||"lump sum",unit_cost:r.unit_cost||0,total:o,source_type:r.source_type||"custom",source_reference:r.source_reference||null,sort_order:r.sort_order||0}).select().single();if(m)throw m;return c}return null},async updateCORSubcontractorItem(l,r){if(K){let o={...r};if(r.quantity!==void 0||r.unit_cost!==void 0){const{data:u}=await U.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",l).single(),x=r.quantity??u?.quantity??1,g=r.unit_cost??u?.unit_cost??0;o.total=Math.round(x*g)}const{data:c,error:m}=await U.from("change_order_subcontractors").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async deleteCORSubcontractorItem(l){if(K){const{error:r}=await U.from("change_order_subcontractors").delete().eq("id",l);if(r)throw r}},async addBulkLaborItems(l,r){if(K&&r.length>0){const o=r.map((u,x)=>{const g=Math.round(u.regular_hours*u.regular_rate),f=Math.round(u.overtime_hours*u.overtime_rate);return{change_order_id:l,labor_class:u.labor_class,wage_type:u.wage_type||"standard",regular_hours:u.regular_hours||0,overtime_hours:u.overtime_hours||0,regular_rate:u.regular_rate||0,overtime_rate:u.overtime_rate||0,regular_total:g,overtime_total:f,total:g+f,sort_order:u.sort_order??x,source_ticket_id:u.source_ticket_id||null}}),{data:c,error:m}=await U.from("change_order_labor").insert(o).select();if(m)throw m;return c}return[]},async addBulkMaterialItems(l,r){if(K&&r.length>0){const o=r.map((u,x)=>({change_order_id:l,description:u.description,quantity:u.quantity||1,unit:u.unit||"each",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,source_ticket_id:u.source_ticket_id||null,sort_order:u.sort_order??x})),{data:c,error:m}=await U.from("change_order_materials").insert(o).select();if(m)throw m;return c}return[]},async addBulkEquipmentItems(l,r){if(K&&r.length>0){const o=r.map((u,x)=>({change_order_id:l,description:u.description,quantity:u.quantity||1,unit:u.unit||"day",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,source_ticket_id:u.source_ticket_id||null,sort_order:u.sort_order??x})),{data:c,error:m}=await U.from("change_order_equipment").insert(o).select();if(m)throw m;return c}return[]},async addBulkSubcontractorItems(l,r){if(K&&r.length>0){const o=r.map((u,x)=>({change_order_id:l,description:u.description,quantity:u.quantity||1,unit:u.unit||"lump sum",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,sort_order:u.sort_order??x})),{data:c,error:m}=await U.from("change_order_subcontractors").insert(o).select();if(m)throw m;return c}return[]},async clearCORLineItems(l){K&&(await U.from("change_order_labor").delete().eq("change_order_id",l),await U.from("change_order_materials").delete().eq("change_order_id",l),await U.from("change_order_equipment").delete().eq("change_order_id",l),await U.from("change_order_subcontractors").delete().eq("change_order_id",l))},async saveCORLineItems(l,{laborItems:r,materialItems:o,equipmentItems:c,subcontractorItems:m}){if(K){await this.clearCORLineItems(l);const u=await Promise.all([r?.length>0?this.addBulkLaborItems(l,r):[],o?.length>0?this.addBulkMaterialItems(l,o):[],c?.length>0?this.addBulkEquipmentItems(l,c):[],m?.length>0?this.addBulkSubcontractorItems(l,m):[]]);return{labor:u[0],materials:u[1],equipment:u[2],subcontractors:u[3]}}return null},async assignTicketToCOR(l,r){if(K){const{data:o,error:c}=await U.from("change_order_ticket_associations").insert({change_order_id:r,ticket_id:l,data_imported:!1}).select().single();if(c)throw c;const{error:m}=await U.from("t_and_m_tickets").update({assigned_cor_id:r}).eq("id",l);if(m)throw m;return o}return null},async unassignTicketFromCOR(l,r){if(K){const{error:o}=await U.from("change_order_ticket_associations").delete().eq("ticket_id",l).eq("change_order_id",r);if(o)throw o;const{error:c}=await U.from("t_and_m_tickets").update({assigned_cor_id:null}).eq("id",l);if(c)throw c}},async getTicketsForCOR(l){if(K){const{data:r,error:o}=await U.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",l);if(o)throw o;return r}return[]},async getUnassignedTickets(l){if(K){const{data:r,error:o}=await U.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",l).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(o)throw o;return r}return[]},async importTicketDataToCOR(l,r,o,c,m){if(K){const{data:u,error:x}=await U.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",l).single();if(x)throw x;const{data:g,error:f}=await U.from("labor_rates").select("*").eq("company_id",o).eq("work_type",c||"demolition").eq("job_type",m||"standard");if(f)throw f;const v={};g?.forEach(L=>{v[L.role.toLowerCase()]=L});const y={};u.t_and_m_workers?.forEach(L=>{const q=(L.role||"laborer").toLowerCase();y[q]||(y[q]={regular_hours:0,overtime_hours:0}),y[q].regular_hours+=parseFloat(L.hours)||0,y[q].overtime_hours+=parseFloat(L.overtime_hours)||0});const R=Object.entries(y).map(([L,q])=>{const ee=v[L]||{regular_rate:0,overtime_rate:0},T=Math.round((parseFloat(ee.regular_rate)||0)*100),D=Math.round((parseFloat(ee.overtime_rate)||0)*100);return{labor_class:L.charAt(0).toUpperCase()+L.slice(1),wage_type:m||"standard",regular_hours:q.regular_hours,overtime_hours:q.overtime_hours,regular_rate:T,overtime_rate:D,source_ticket_id:l}});R.length>0&&await this.addBulkLaborItems(r,R);const X=[],B=[];u.t_and_m_items?.forEach(L=>{const q=L.custom_name||L.materials_equipment?.name||"Unknown Item",ee=L.custom_category||L.materials_equipment?.category||"Other",T=L.materials_equipment?.unit||"each",D=Math.round((parseFloat(L.materials_equipment?.cost_per_unit)||0)*100),w={description:q,quantity:L.quantity||1,unit:T,unit_cost:D,source_type:"backup_sheet",source_ticket_id:l};ee==="Equipment"?B.push(w):X.push(w)}),X.length>0&&await this.addBulkMaterialItems(r,X),B.length>0&&await this.addBulkEquipmentItems(r,B);const{error:V}=await U.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString()}).eq("change_order_id",r).eq("ticket_id",l);if(V)throw V;return{laborItems:R,materialItems:X,equipmentItems:B}}return null},async reimportTicketDataToCOR(l,r,o,c,m){return K?(await U.from("change_order_labor").delete().eq("change_order_id",r).eq("source_ticket_id",l),await U.from("change_order_materials").delete().eq("change_order_id",r).eq("source_ticket_id",l),await U.from("change_order_equipment").delete().eq("change_order_id",r).eq("source_ticket_id",l),this.importTicketDataToCOR(l,r,o,c,m)):null},async recalculateCOR(l){if(K){const{error:r}=await U.rpc("recalculate_cor_totals",{cor_id:l});if(r)throw r;return this.getCORById(l)}return null},async updateCORMarkupPercentages(l,r){if(K){const o={};r.labor!==void 0&&(o.labor_markup_percent=r.labor),r.materials!==void 0&&(o.materials_markup_percent=r.materials),r.equipment!==void 0&&(o.equipment_markup_percent=r.equipment),r.subcontractors!==void 0&&(o.subcontractors_markup_percent=r.subcontractors);const{data:c,error:m}=await U.from("change_orders").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async updateCORFeePercentages(l,r){if(K){const o={};r.liabilityInsurance!==void 0&&(o.liability_insurance_percent=r.liabilityInsurance),r.bond!==void 0&&(o.bond_percent=r.bond),r.licenseFee!==void 0&&(o.license_fee_percent=r.licenseFee);const{data:c,error:m}=await U.from("change_orders").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async submitCORForApproval(l){if(K){const{data:r,error:o}=await U.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",l).select().single();if(o)throw o;return r}return null},async approveCOR(l,r){if(K){const{data:o,error:c}=await U.from("change_orders").update({status:"approved",approved_by:r,approved_at:new Date().toISOString()}).eq("id",l).select().single();if(c)throw c;return o}return null},async rejectCOR(l,r=null){if(K){const{data:o,error:c}=await U.from("change_orders").update({status:"rejected",rejection_reason:r}).eq("id",l).select().single();if(c)throw c;return o}return null},async markCORAsBilled(l){if(K){const{data:r,error:o}=await U.from("change_orders").update({status:"billed"}).eq("id",l).select().single();if(o)throw o;return r}return null},async closeCOR(l){if(K){const{data:r,error:o}=await U.from("change_orders").update({status:"closed"}).eq("id",l).select().single();if(o)throw o;return r}return null},async saveCORSignature(l,r,o){if(K){const{data:c,error:m}=await U.from("change_orders").update({gc_signature_data:r,gc_signature_name:o,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",l).select().single();if(m)throw m;return c}return null},async getCORStats(l){if(K){const{data:r,error:o}=await U.from("change_orders").select("status, cor_total").eq("project_id",l);if(o)throw o;const c={total_cors:r.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return r.forEach(m=>{switch(m.status){case"draft":c.draft_count++;break;case"pending_approval":c.pending_count++,c.total_pending_value+=m.cor_total||0;break;case"approved":c.approved_count++,c.total_approved_value+=m.cor_total||0;break;case"rejected":c.rejected_count++;break;case"billed":case"closed":c.billed_count++,c.total_billed_value+=m.cor_total||0;break}}),c}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(l,r){return K?U.channel(`change_orders:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${l}`},r).subscribe():null},subscribeToCorTickets(l,r){return K?U.channel(`cor-tickets:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${l}`},r).subscribe():null},async createSignatureRequest(l,r,o,c,m=null,u=null){if(K){const{data:x,error:g}=await U.rpc("generate_signature_token");if(g)throw g;const{data:f,error:v}=await U.from("signature_requests").insert({document_type:l,document_id:r,company_id:o,project_id:c,signature_token:x,expires_at:u,created_by:m}).select().single();if(v)throw v;return f}return null},async getSignatureRequestByToken(l){if(K){await U.rpc("increment_signature_view_count",{token:l});const{data:r,error:o}=await U.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",l).single();if(o)throw o;return r}return null},async getSignatureRequestsForDocument(l,r){if(K){const{data:o,error:c}=await U.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",l).eq("document_id",r).order("created_at",{ascending:!1});if(c)throw c;return o||[]}return[]},async addSignature(l,r,o){if(K){const{data:c,error:m}=await U.from("signatures").insert({signature_request_id:l,signature_slot:r,signature_image:o.signature,signer_name:o.signerName,signer_title:o.signerTitle||null,signer_company:o.signerCompany||null,signed_at:o.signedAt||new Date().toISOString(),ip_address:o.ipAddress||null,user_agent:o.userAgent||null}).select().single();if(m)throw m;return c}return null},async syncSignatureToDocument(l,r){if(!K)return null;const{document_type:o,document_id:c}=r,m=l.signature_slot,u={};m===1?(u.gc_signature_data=l.signature_image,u.gc_signature_name=l.signer_name,u.gc_signature_title=l.signer_title,u.gc_signature_company=l.signer_company,u.gc_signature_date=l.signed_at,u.gc_signature_ip=l.ip_address):m===2&&(u.client_signature_data=l.signature_image,u.client_signature_name=l.signer_name,u.client_signature_title=l.signer_title,u.client_signature_company=l.signer_company,u.client_signature_date=l.signed_at,u.client_signature_ip=l.ip_address);const x=o==="cor"?"change_orders":"t_and_m_tickets",{data:g,error:f}=await U.from(x).update(u).eq("id",c).select().single();if(f)throw f;return g},async revokeSignatureRequest(l){if(K){const{data:r,error:o}=await U.from("signature_requests").update({status:"revoked"}).eq("id",l).select().single();if(o)throw o;return r}return null},async getDocumentForSigning(l,r){if(!K)return null;if(l==="cor"){const{data:o,error:c}=await U.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",r).single();if(c)throw c;return o}else if(l==="tm_ticket"){const{data:o,error:c}=await U.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (*)
        `).eq("id",r).single();if(c)throw c;return o}return null},async getProjectCosts(l){if(K){const{data:o,error:c}=await U.from("project_costs").select("*").eq("project_id",l).order("cost_date",{ascending:!1});return c?(console.error("Error fetching project costs:",c),[]):o||[]}return(Ue().projectCosts||[]).filter(o=>o.project_id===l).sort((o,c)=>new Date(c.cost_date)-new Date(o.cost_date))},async addProjectCost(l,r,o){const c={project_id:l,company_id:r,category:o.category,description:o.description,amount:parseFloat(o.amount),cost_date:o.cost_date||new Date().toISOString().split("T")[0],notes:o.notes||null,created_by:o.created_by||null};if(K){const{data:x,error:g}=await U.from("project_costs").insert(c).select().single();if(g)throw console.error("Error adding project cost:",g),g;return x}const m=Ue();m.projectCosts||(m.projectCosts=[]);const u={...c,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return m.projectCosts.push(u),it(m),u},async updateProjectCost(l,r){const o={category:r.category,description:r.description,amount:parseFloat(r.amount),cost_date:r.cost_date,notes:r.notes||null,updated_at:new Date().toISOString()};if(K){const{data:u,error:x}=await U.from("project_costs").update(o).eq("id",l).select().single();if(x)throw console.error("Error updating project cost:",x),x;return u}const c=Ue();if(!c.projectCosts)return null;const m=c.projectCosts.findIndex(u=>u.id===l);return m===-1?null:(c.projectCosts[m]={...c.projectCosts[m],...o},it(c),c.projectCosts[m])},async deleteProjectCost(l){if(K){const{error:o}=await U.from("project_costs").delete().eq("id",l);if(o)throw console.error("Error deleting project cost:",o),o;return!0}const r=Ue();return r.projectCosts&&(r.projectCosts=r.projectCosts.filter(o=>o.id!==l),it(r)),!0},async getProjectCostsSummary(l){const r=await this.getProjectCosts(l),o={};let c=0;return r.forEach(m=>{const u=parseFloat(m.amount)||0;c+=u,o[m.category]||(o[m.category]={category:m.category,total:0,count:0,items:[]}),o[m.category].total+=u,o[m.category].count++,o[m.category].items.push(m)}),Object.values(o).forEach(m=>{m.percentage=c>0?m.total/c*100:0}),{totalCost:c,byCategory:o,itemCount:r.length}}};Bf(async l=>{if(l&&K){console.log("Back online - syncing pending actions...");try{const r=await zx(ce);r.synced>0&&console.log(`Synced ${r.synced} pending actions`),r.failed>0&&console.warn(`Failed to sync ${r.failed} actions`)}catch(r){console.error("Error syncing pending actions:",r)}}});const $f=p.createContext(),wa={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function cl({children:l,companyId:r}){const[o,c]=p.useState(wa),[m,u]=p.useState(!0);p.useEffect(()=>{r?x(r):g()},[r]),p.useEffect(()=>{y(o)},[o]);const x=async B=>{try{if(u(!0),!K){c(wa),u(!1);return}const{data:V,error:L}=await U.from("company_branding").select("*").eq("company_id",B).single();L?(L.code==="PGRST116"?await f(B):console.error("Error loading branding:",L),c(wa)):c({...wa,...V})}catch(V){console.error("Error in loadBranding:",V),c(wa)}finally{u(!1)}},g=async()=>{try{u(!0);const B=window.location.hostname;if(B==="localhost"||B==="127.0.0.1"){c(wa),u(!1);return}if(!K){c(wa),u(!1);return}const{data:V,error:L}=await U.rpc("get_branding_by_domain",{domain_name:B});L||!V||V.length===0?c(wa):c({...wa,...V[0]})}catch(B){console.error("Error loading branding by domain:",B),c(wa)}finally{u(!1)}},f=async B=>{try{const{data:V,error:L}=await U.from("company_branding").insert({company_id:B,...wa}).select().single();L&&console.error("Error creating default branding:",L)}catch(V){console.error("Error in createDefaultBranding:",V)}},v=async B=>{try{if(!K)return c(w=>({...w,...B})),{success:!0};if(!r)return{success:!1,error:"No company ID"};const V={},L=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const w of L)B[w]!==void 0&&(V[w]=B[w]);const{data:q,error:ee}=await U.from("company_branding").select("id").eq("company_id",r).single();if(ee&&ee.code==="PGRST116"){const{data:w,error:se}=await U.from("company_branding").insert({company_id:r,...V}).select().single();return se?(console.error("Error creating branding:",se),{success:!1,error:se.message}):(c({...wa,...w}),{success:!0,data:w})}const{data:T,error:D}=await U.from("company_branding").update(V).eq("company_id",r).select().single();return D?(console.error("Error updating branding:",D),{success:!1,error:D.message}):(c({...wa,...T}),{success:!0,data:T})}catch(V){return console.error("Error in updateBranding:",V),{success:!1,error:V.message}}},y=B=>{const V=document.documentElement;if(V.style.setProperty("--primary-color",B.primary_color),V.style.setProperty("--secondary-color",B.secondary_color),B.favicon_url){let L=document.querySelector("link[rel*='icon']");L||(L=document.createElement("link"),L.rel="icon",document.head.appendChild(L)),L.href=B.favicon_url}document.title=B.custom_app_name||"FieldSync"},X={branding:o,loading:m,updateBranding:v,uploadBrandingImage:async(B,V)=>{try{if(!K)return{success:!0,url:URL.createObjectURL(B)};const L=B.name.split(".").pop(),ee=`branding/${`${r}/${V}-${Date.now()}.${L}`}`,{data:T,error:D}=await U.storage.from("public").upload(ee,B,{cacheControl:"3600",upsert:!0});if(D)return console.error("Error uploading image:",D),{success:!1,error:D.message};const{data:{publicUrl:w}}=U.storage.from("public").getPublicUrl(ee);return{success:!0,url:w}}catch(L){return console.error("Error in uploadBrandingImage:",L),{success:!1,error:L.message}}},refreshBranding:()=>r?x(r):g()};return e.jsx($f.Provider,{value:X,children:l})}function ul(){const l=p.useContext($f);if(!l)throw new Error("useBranding must be used within a BrandingProvider");return l}const Lx=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Bx=l=>l.replace(/^([A-Z])|[\s-_]+(\w)/g,(r,o,c)=>c?c.toUpperCase():o.toLowerCase()),uf=l=>{const r=Bx(l);return r.charAt(0).toUpperCase()+r.slice(1)},Vf=(...l)=>l.filter((r,o,c)=>!!r&&r.trim()!==""&&c.indexOf(r)===o).join(" ").trim(),Hx=l=>{for(const r in l)if(r.startsWith("aria-")||r==="role"||r==="title")return!0};var Fx={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const $x=p.forwardRef(({color:l="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:c,className:m="",children:u,iconNode:x,...g},f)=>p.createElement("svg",{ref:f,...Fx,width:r,height:r,stroke:l,strokeWidth:c?Number(o)*24/Number(r):o,className:Vf("lucide",m),...!u&&!Hx(g)&&{"aria-hidden":"true"},...g},[...x.map(([v,y])=>p.createElement(v,y)),...Array.isArray(u)?u:[u]]));const He=(l,r)=>{const o=p.forwardRef(({className:c,...m},u)=>p.createElement($x,{ref:u,iconNode:r,className:Vf(`lucide-${Lx(uf(l))}`,`lucide-${l}`,c),...m}));return o.displayName=uf(l),o};const Vx=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Gx=He("bell",Vx);const Yx=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],dl=He("briefcase",Yx);const Qx=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Ai=He("building-2",Qx);const Xx=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ur=He("calendar",Xx);const Zx=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],or=He("camera",Zx);const Px=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],dr=He("check",Px);const Ix=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],tn=He("chevron-down",Ix);const Jx=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Kx=He("chevron-left",Jx);const Wx=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Cn=He("chevron-right",Wx);const ej=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Gf=He("chevron-up",ej);const tj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ml=He("circle-alert",tj);const aj=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ja=He("circle-check-big",aj);const sj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],mf=He("circle-x",sj);const nj=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],Oa=He("clipboard-list",nj);const lj=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Nn=He("clock",lj);const rj=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],hf=He("copy",rj);const ij=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],ol=He("dollar-sign",ij);const cj=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Yf=He("download",cj);const oj=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Qf=He("ellipsis",oj);const dj=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],ff=He("external-link",dj);const uj=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],mj=He("eye",uj);const hj=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ua=He("file-text",hj);const fj=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],pj=He("flame",fj);const gj=[["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["rect",{x:"2",y:"15",width:"20",height:"4",rx:"1",key:"g3x8cw"}]],ca=He("hard-hat",gj);const xj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ud=He("info",xj);const jj=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],pf=He("layout-grid",jj);const vj=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],hd=He("link",vj);const yj=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],gf=He("lock",yj);const bj=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],_j=He("map-pin",bj);const Nj=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ys=He("message-square",Nj);const Sj=[["path",{d:"M5 12h14",key:"1ays0h"}]],Cj=He("minus",Sj);const wj=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Wa=He("package",wj);const kj=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],fd=He("pen-line",kj);const Ej=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Dj=He("pen-tool",Ej);const Mj=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Xf=He("pen",Mj);const Tj=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Zf=He("pencil",Tj);const Aj=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],Rj=He("percent",Aj);const zj=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],qj=He("phone",zj);const Oj=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],$a=He("plus",Oj);const Uj=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Lj=He("refresh-cw",Uj);const Bj=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Pf=He("rotate-ccw",Bj);const Hj=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],xf=He("save",Hj);const Fj=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],$j=He("search",Fj);const Vj=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],If=He("send",Vj);const Gj=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Jf=He("shield",Gj);const Yj=[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]],Qj=He("stamp",Yj);const Xj=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],_s=He("trash-2",Xj);const Zj=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Kf=He("trending-down",Zj);const Pj=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Ij=He("trending-up",Pj);const Jj=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],zi=He("triangle-alert",Jj);const Kj=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],wn=He("truck",Kj);const Wj=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ev=He("upload",Wj);const tv=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],av=He("user-check",tv);const sv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],mr=He("users",sv);const nv=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],hr=He("wrench",nv);const lv=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],kn=He("x",lv);const rv=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],iv=He("zap",rv);function Ia({className:l="",showPoweredBy:r=!1}){const{branding:o}=ul();return e.jsxs("div",{className:`app-logo ${l}`,children:[o.logo_url?e.jsx("img",{src:o.logo_url,alt:o.custom_app_name||"Logo",className:"custom-logo"}):e.jsxs("div",{className:"logo",children:[o.custom_app_name||"Field",e.jsx("span",{children:"Sync"})]}),r&&!o.hide_fieldsync_branding&&e.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function cv({onForemanAccess:l,onOfficeLogin:r,onShowToast:o}){const[c,m]=p.useState(null),[u,x]=p.useState(""),[g,f]=p.useState(null),[v,y]=p.useState(""),[R,X]=p.useState(!1),[B,V]=p.useState(""),[L,q]=p.useState(""),[ee,T]=p.useState(1),[D,w]=p.useState(null),[se,ne]=p.useState(""),[P,I]=p.useState(""),[F,J]=p.useState(""),[Z,j]=p.useState(""),_=H=>{const ve=H.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);x(ve)},S=async()=>{if(u.length<2){o("Enter company code","error");return}X(!0);try{const H=await ce.getCompanyByCode(u);H?f(H):(o("Invalid company code","error"),x(""))}catch{o("Error checking code","error")}finally{X(!1)}},ae=async H=>{if(H.length===4){X(!0);try{const ve=await ce.getProjectByPinAndCompany(H,g.id);ve?l(ve):(o("Invalid PIN","error"),y(""))}catch{o("Error checking PIN","error")}finally{X(!1)}}},k=H=>{if(v.length<4){const ve=v+H;y(ve),ve.length===4&&setTimeout(()=>ae(ve),200)}},M=()=>{y(H=>H.slice(0,-1))},C=()=>{f(null),y("")},me=()=>{if(!B.trim()||!L.trim()){o("Enter email and password","error");return}r(B,L)},Q=async()=>{if(u.length<2){o("Enter company code","error");return}X(!0);try{const H=await ce.getCompanyByCode(u);H?(w(H),T(2)):(o("Invalid company code","error"),x(""))}catch{o("Error checking code","error")}finally{X(!1)}},O=async()=>{if(!se.trim()){o("Enter office code","error");return}X(!0);try{const{data:H,error:ve}=await U.rpc("verify_office_code",{company_id:D.id,code:se.trim()});if(ve)throw ve;H===!0?T(3):(o("Invalid office code","error"),ne(""))}catch{o("Error verifying code","error")}finally{X(!1)}},$=async()=>{if(!P.trim()){o("Enter your name","error");return}if(!F.trim()||!F.includes("@")){o("Enter valid email","error");return}if(Z.length<6){o("Password must be 6+ characters","error");return}X(!0);try{const{data:H,error:ve}=await U.auth.signUp({email:F,password:Z});if(ve)throw ve;const Ne=H.user?.id;if(!Ne)throw new Error("Failed to create user");const{error:Ae}=await U.from("users").insert({id:Ne,email:F,password_hash:"managed_by_supabase_auth",name:P.trim(),company_id:D.id,role:"member",is_active:!0});if(Ae)throw Ae;const{error:be}=await U.from("user_companies").insert({user_id:Ne,company_id:D.id,role:"member"});be&&console.error("Error adding to user_companies:",be),o("Account created! Logging you in...","success"),setTimeout(()=>{window.location.reload()},1e3)}catch(H){console.error("Join error:",H),o(H.message||"Error creating account","error")}finally{X(!1)}};if(c===null)return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx(Ia,{className:"entry-logo",showPoweredBy:!1}),e.jsxs("div",{className:"entry-buttons",children:[e.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>m("foreman"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(ca,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Foreman"}),e.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),e.jsxs("button",{className:"entry-mode-btn office",onClick:()=>m("office"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(dl,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Office"}),e.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(c==="foreman")return g?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:C,children:""}),e.jsx(Ia,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:g.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),e.jsx("div",{className:"pin-display",children:[0,1,2,3].map(H=>e.jsx("div",{className:`pin-dot ${v.length>H?"filled":""}`,children:v.length>H?"":""},H))}),e.jsxs("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map(H=>e.jsx("button",{className:"num-btn",onClick:()=>k(H.toString()),disabled:R,children:H},H)),e.jsx("button",{className:"num-btn empty",disabled:!0}),e.jsx("button",{className:"num-btn",onClick:()=>k("0"),disabled:R,children:"0"}),e.jsx("button",{className:"num-btn backspace",onClick:M,disabled:R||v.length===0,children:""})]}),R&&e.jsx("div",{className:"entry-loading",children:e.jsx("div",{className:"spinner"})})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m(null),children:""}),e.jsx(Ia,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:u,onChange:H=>_(H.target.value),placeholder:"Company Code",disabled:R,autoFocus:!0,onKeyDown:H=>{H.key==="Enter"&&S()}}),e.jsx("button",{className:"entry-submit-btn",onClick:S,disabled:R||u.length<2,children:R?"...":""})]})]})});if(c==="office")return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m(null),children:""}),e.jsx(Ia,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"email",value:B,onChange:H=>V(H.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:H=>{H.key==="Enter"&&me()}}),e.jsx("input",{type:"password",value:L,onChange:H=>q(H.target.value),placeholder:"Password",onKeyDown:H=>{H.key==="Enter"&&me()}}),e.jsx("button",{className:"entry-login-btn",onClick:me,children:"Sign In"})]}),e.jsxs("div",{className:"entry-signup-hint",children:[e.jsx("p",{children:"New employee?"}),e.jsx("button",{className:"entry-join-link",onClick:()=>m("join"),children:"Join your company"})]})]})});if(c==="join")return ee===1?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m("office"),children:""}),e.jsx(Ia,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),e.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:u,onChange:H=>_(H.target.value),placeholder:"Company Code",disabled:R,autoFocus:!0,onKeyDown:H=>{H.key==="Enter"&&Q()}}),e.jsx("button",{className:"entry-submit-btn",onClick:Q,disabled:R||u.length<2,children:R?"...":""})]})]})}):ee===2?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{T(1),w(null),ne("")},children:""}),e.jsx(Ia,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:D?.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),e.jsx("p",{className:"entry-hint",children:"This code is only for office staff"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"password",value:se,onChange:H=>ne(H.target.value),placeholder:"Office Code",disabled:R,autoFocus:!0,onKeyDown:H=>{H.key==="Enter"&&O()}}),e.jsx("button",{className:"entry-submit-btn",onClick:O,disabled:R||!se.trim(),children:R?"...":""})]})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{T(2),ne("")},children:""}),e.jsx(Ia,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:D?.name}),e.jsx("p",{className:"entry-subtitle",children:"Create your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"text",value:P,onChange:H=>I(H.target.value),placeholder:"Your Name",autoFocus:!0}),e.jsx("input",{type:"email",value:F,onChange:H=>J(H.target.value),placeholder:"Email"}),e.jsx("input",{type:"password",value:Z,onChange:H=>j(H.target.value),placeholder:"Password (6+ characters)",onKeyDown:H=>{H.key==="Enter"&&$()}}),e.jsx("button",{className:"entry-login-btn",onClick:$,disabled:R,children:R?"Creating...":"Join Company"})]}),e.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})})}function Ct(l){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)}function ov(l){if(!l||l.length===0)return 0;let r=0;return l.forEach(o=>{o.status==="done"&&(r+=o.weight)}),Math.round(r)}function jf(l){if(!l||l.length===0)return{progress:0,earnedValue:0,totalValue:0,isValueBased:!1};if(l.some(c=>c.scheduled_value>0)){const c=l.reduce((x,g)=>x+(g.scheduled_value||0),0),m=l.filter(x=>x.status==="done").reduce((x,g)=>x+(g.scheduled_value||0),0);return{progress:c>0?Math.round(m/c*100):0,earnedValue:m,totalValue:c,isValueBased:!0}}const o=l.filter(c=>c.status==="done").reduce((c,m)=>c+(m.weight||0),0);return{progress:Math.round(o),earnedValue:0,totalValue:0,isValueBased:!1}}function Wf(l){if(!l||l.length===0)return"not_started";const r=l.some(m=>m.status==="working"),o=l.some(m=>m.status==="done");return l.every(m=>m.status==="done")?"done":r||o?"working":"not_started"}function dv(l){const r=Wf(l);return r==="done"?"Complete":r==="working"?"In Progress":"Not Started"}function uv(l,r=0){const o=new Date;o.setHours(0,0,0,0);const c={scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1};if(l.start_date&&l.end_date){const m=new Date(l.start_date),u=new Date(l.end_date);m.setHours(0,0,0,0),u.setHours(0,0,0,0);const x=Math.max(1,Math.ceil((u-m)/(1e3*60*60*24))),g=Math.max(0,Math.ceil((o-m)/(1e3*60*60*24))),f=Math.min(100,g/x*100),y=(l.progress||0)-f;c.scheduleVariance=Math.round(y),c.hasScheduleData=!0,y>5?(c.scheduleStatus="ahead",c.scheduleLabel=`Ahead of Schedule (+${c.scheduleVariance}%)`):y<-5?(c.scheduleStatus="behind",c.scheduleLabel=`Behind Schedule (${c.scheduleVariance}%)`):(c.scheduleStatus="on_track",c.scheduleLabel="On Track")}if(l.planned_man_days&&l.planned_man_days>0){const u=(l.progress||0)/100*l.planned_man_days;if(u>0&&r>0){const x=(r-u)/u*100;c.laborVariance=Math.round(x),c.hasLaborData=!0,x>10?(c.laborStatus="over",c.laborLabel=`Over Planned (+${c.laborVariance}% man-days)`):x<-10?(c.laborStatus="under",c.laborLabel=`Under Planned (${c.laborVariance}% man-days)`):(c.laborStatus="on_track",c.laborLabel="Labor On Track")}else r>0&&(c.hasLaborData=!0,c.laborLabel=`${r} man-days used`)}return c}function mv(l,r=30){if(l.status==="archived"||l.progress<100)return!1;const o=l.areas||[];if(o.length===0||!o.every(x=>x.status==="done"))return!1;const m=o.reduce((x,g)=>{const f=new Date(g.updated_at);return f>x?f:x},new Date(0));return m.getTime()===0?!1:Math.floor((Date.now()-m.getTime())/(1e3*60*60*24))>=r}async function hv(l,r=1920,o=.8){return!l.type.startsWith("image/")||l.size<500*1024?l:new Promise(c=>{const m=document.createElement("canvas"),u=m.getContext("2d"),x=new Image;x.onload=()=>{let{width:g,height:f}=x;g>r&&(f=Math.round(f*r/g),g=r);const v=1920;f>v&&(g=Math.round(g*v/f),f=v),m.width=g,m.height=f,u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.drawImage(x,0,0,g,f),m.toBlob(y=>{if(y){const R=l.name.replace(/\.[^/.]+$/,""),X=new File([y],`${R}.jpg`,{type:"image/jpeg",lastModified:Date.now()}),B=((1-y.size/l.size)*100).toFixed(1);console.log(`Image compressed: ${l.name} - ${(l.size/1024).toFixed(0)}KB  ${(y.size/1024).toFixed(0)}KB (${B}% smaller)`),c(X)}else console.warn("Image compression failed, using original"),c(l)},"image/jpeg",o),URL.revokeObjectURL(x.src)},x.onerror=()=>{console.warn("Failed to load image for compression, using original"),URL.revokeObjectURL(x.src),c(l)},x.src=URL.createObjectURL(l)})}const vf=["Containment","PPE","Disposal","Equipment"];function fv({project:l,companyId:r,maxPhotos:o=10,onSubmit:c,onCancel:m,onShowToast:u}){const[x,g]=p.useState(1),[f,v]=p.useState(new Date().toISOString().split("T")[0]),[y,R]=p.useState(""),[X,B]=p.useState(""),[V,L]=p.useState(""),[q,ee]=p.useState([]),[T,D]=p.useState(!1),[w,se]=p.useState(!1),[ne,P]=p.useState({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),[I,F]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}]),[J,Z]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[j,_]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[S,ae]=p.useState([]),[k,M]=p.useState(""),[C,me]=p.useState([]),[Q,O]=p.useState(!1),[$,H]=p.useState(""),[ve,Ne]=p.useState([]),[Ae,be]=p.useState(!1),[Pe,Ve]=p.useState(null),[Te,ht]=p.useState([]),[Yt,Tt]=p.useState(!1),[ft,At]=p.useState(!1),[lt,Le]=p.useState({name:"",category:"",quantity:""});p.useEffect(()=>{E(),Wt()},[l.id]);const Wt=async()=>{D(!0);try{const N=await ce.getAssignableCORs(l.id);ee(N||[])}catch(N){console.error("Error loading assignable CORs:",N)}finally{D(!1)}},A=()=>{const{timeStarted:N,timeEnded:pe,hours:W,overtimeHours:he}=ne;F(I.map(ke=>ke.name.trim()?{...ke,timeStarted:N,timeEnded:pe,hours:W,overtimeHours:he}:ke)),Z(J.map(ke=>ke.name.trim()?{...ke,timeStarted:N,timeEnded:pe,hours:W,overtimeHours:he}:ke)),_(j.map(ke=>ke.name.trim()?{...ke,timeStarted:N,timeEnded:pe,hours:W,overtimeHours:he}:ke));const Ce=[...I.filter(ke=>ke.name.trim()),...J.filter(ke=>ke.name.trim()),...j.filter(ke=>ke.name.trim())].length;se(!1),P({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),u(`Applied hours to ${Ce} worker${Ce!==1?"s":""}`,"success")},E=async()=>{try{const N=await ce.getCrewCheckin(l.id);N?.workers&&Ne(N.workers)}catch(N){console.error("Error loading crew:",N)}};p.useEffect(()=>{Pe&&r&&fe(Pe)},[Pe,r]);const fe=async N=>{Tt(!0);try{const pe=await ce.getMaterialsEquipmentByCategory(r,N);ht(pe)}catch(pe){console.error("Error loading items:",pe),u("Error loading items","error")}finally{Tt(!1)}},xe=()=>{F([...I,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},G=(N,pe,W)=>{F(I.map((he,Ce)=>Ce===N?{...he,[pe]:W}:he))},_e=N=>{I.length>1?F(I.filter((pe,W)=>W!==N)):F([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},Ye=()=>{_([...j,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},qe=(N,pe,W)=>{_(j.map((he,Ce)=>Ce===N?{...he,[pe]:W}:he))},We=N=>{j.length>1?_(j.filter((pe,W)=>W!==N)):_([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},wt=()=>{Z([...J,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Ie=(N,pe,W)=>{Z(J.map((he,Ce)=>Ce===N?{...he,[pe]:W}:he))},kt=N=>{J.length>1?Z(J.filter((pe,W)=>W!==N)):Z([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Ft=N=>{const pe=S.findIndex(W=>W.material_equipment_id===N.id);pe>=0?ae(S.map((W,he)=>he===pe?{...W,quantity:W.quantity+1}:W)):ae([...S,{material_equipment_id:N.id,name:N.name,unit:N.unit,category:N.category,quantity:1,isCustom:!1}]),u(`Added ${N.name}`,"success")},Ot=()=>{if(!lt.name||!lt.category||!lt.quantity){u("Fill in all fields","error");return}ae([...S,{material_equipment_id:null,custom_name:lt.name,custom_category:lt.category,name:lt.name,category:lt.category,quantity:parseFloat(lt.quantity),unit:"each",isCustom:!0}]),Le({name:"",category:"",quantity:""}),At(!1),Ve(null),u("Custom item added","success")},Ut=(N,pe)=>{const W=parseFloat(pe)||0;W<=0?ut(N):ae(S.map((he,Ce)=>Ce===N?{...he,quantity:W}:he))},ut=N=>{ae(S.filter((pe,W)=>W!==N))},Rt=N=>{const pe=Array.from(N.target.files);if(pe.length===0)return;const W=o===-1?1/0:o-C.length;if(W<=0){u(`Photo limit reached (${o} max)`,"error"),N.target.value="";return}const he=pe.slice(0,W);he.length<pe.length&&u(`Only ${he.length} photo(s) added (${o} max)`,"error"),he.forEach(Ce=>{if(!Ce.type.startsWith("image/")){u("Please select an image file","error");return}const ke=URL.createObjectURL(Ce);me(Re=>[...Re,{id:Date.now()+Math.random(),file:Ce,previewUrl:ke,name:Ce.name}])}),N.target.value=""},_t=N=>{const pe=C.find(W=>W.id===N);pe?.previewUrl&&URL.revokeObjectURL(pe.previewUrl),me(C.filter(W=>W.id!==N))},le=()=>{if(x===1){const N=I.some(he=>he.name.trim()&&(parseFloat(he.hours)>0||parseFloat(he.overtimeHours)>0)),pe=J.some(he=>he.name.trim()&&(parseFloat(he.hours)>0||parseFloat(he.overtimeHours)>0)),W=j.some(he=>he.name.trim()&&(parseFloat(he.hours)>0||parseFloat(he.overtimeHours)>0));return N||pe||W}return!0},Se=()=>{x<3&&g(x+1)},ue=()=>{Pe?(Ve(null),At(!1)):ft?At(!1):x>1?g(x-1):m()},Xe=async()=>{if(!X.trim()){u("Enter your name to submit","error");return}const N=I.filter(he=>he.name.trim()&&(parseFloat(he.hours)>0||parseFloat(he.overtimeHours)>0)),pe=J.filter(he=>he.name.trim()&&(parseFloat(he.hours)>0||parseFloat(he.overtimeHours)>0)),W=j.filter(he=>he.name.trim()&&(parseFloat(he.hours)>0||parseFloat(he.overtimeHours)>0));if(N.length===0&&pe.length===0&&W.length===0){u("Add at least one worker","error");return}O(!0),H("Creating ticket...");try{const he=await ce.createTMTicket({project_id:l.id,work_date:f,ce_pco_number:y.trim()||null,assigned_cor_id:V||null,notes:k.trim()||null,photos:[],created_by_name:X.trim()});let Ce=[];if(C.length>0){H(`Compressing ${C.length} photo${C.length>1?"s":""}...`);const Re=await Promise.all(C.map(async(De,Be)=>{try{const Fe=await hv(De.file);return{...De,file:Fe}}catch(Fe){return console.warn(`Failed to compress photo ${Be+1}, using original:`,Fe),De}}));H(`Uploading ${C.length} photo${C.length>1?"s":""}...`);let et=0;const Ze=Re.map(async(De,Be)=>{try{const Fe=await ce.uploadPhoto(r,l.id,he.id,De.file);return et++,H(`Uploading ${et}/${C.length} photos...`),console.log(`Photo ${Be+1} uploaded successfully:`,Fe),Fe}catch(Fe){return console.error(`Photo ${Be+1} upload failed:`,Fe),u(`Photo ${Be+1} failed to upload`,"error"),null}});Ce=(await Promise.all(Ze)).filter(De=>De!==null),Ce.length<C.length&&Ce.length>0&&u(`${Ce.length}/${C.length} photos uploaded`,"warning")}Ce.length>0&&(H("Saving photos..."),await ce.updateTMTicketPhotos(he.id,Ce));const ke=[...N.map(Re=>({name:Re.name.trim(),hours:parseFloat(Re.hours)||0,overtime_hours:parseFloat(Re.overtimeHours)||0,time_started:Re.timeStarted||null,time_ended:Re.timeEnded||null,role:Re.role})),...pe.map(Re=>({name:Re.name.trim(),hours:parseFloat(Re.hours)||0,overtime_hours:parseFloat(Re.overtimeHours)||0,time_started:Re.timeStarted||null,time_ended:Re.timeEnded||null,role:"Operator"})),...W.map(Re=>({name:Re.name.trim(),hours:parseFloat(Re.hours)||0,overtime_hours:parseFloat(Re.overtimeHours)||0,time_started:Re.timeStarted||null,time_ended:Re.timeEnded||null,role:"Laborer"}))];if(H("Saving workers..."),await ce.addTMWorkers(he.id,ke),S.length>0&&(H("Saving materials..."),await ce.addTMItems(he.id,S.map(Re=>({material_equipment_id:Re.material_equipment_id,custom_name:Re.custom_name||null,custom_category:Re.custom_category||null,quantity:Re.quantity})))),V){H("Importing to COR...");try{await ce.importTicketDataToCOR(he.id,V,r,l.work_type||"demolition",l.job_type||"standard")}catch(Re){console.error("Error importing to COR:",Re),u("T&M saved, but COR import failed","warning")}}C.forEach(Re=>{Re.previewUrl&&URL.revokeObjectURL(Re.previewUrl)}),u("T&M submitted!","success"),c()}catch(he){console.error("Error submitting T&M:",he),u("Error submitting T&M","error")}finally{O(!1),H("")}},St=I.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),Et=J.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),ct=j.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),It=St.length+Et.length+ct.length,Jt=[...St,...Et,...ct].reduce((N,pe)=>N+parseFloat(pe.hours||0),0),ta=[...St,...Et,...ct].reduce((N,pe)=>N+parseFloat(pe.overtimeHours||0),0);return S.reduce((N,pe)=>N+pe.quantity,0),x===2&&(Pe||ft)?e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[e.jsx("button",{className:"tm-back-btn",onClick:ue,children:""}),e.jsx("h2",{children:ft?"Add Custom Item":Pe}),e.jsxs("div",{className:"tm-item-count",children:[S.length," items"]})]}),ft?e.jsxs("div",{className:"tm-custom-form",children:[e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Item Name"}),e.jsx("input",{type:"text",placeholder:"What did you use?",value:lt.name,onChange:N=>Le({...lt,name:N.target.value}),autoFocus:!0})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Category"}),e.jsx("div",{className:"tm-category-select",children:vf.map(N=>e.jsx("button",{className:`tm-cat-chip ${lt.category===N?"active":""}`,onClick:()=>Le({...lt,category:N}),children:N},N))})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",placeholder:"How many?",value:lt.quantity,onChange:N=>Le({...lt,quantity:N.target.value})})]}),e.jsx("button",{className:"tm-big-btn primary",onClick:Ot,children:"Add Custom Item"})]}):e.jsx("div",{className:"tm-item-grid",children:Yt?e.jsx("div",{className:"tm-loading",children:"Loading..."}):e.jsxs(e.Fragment,{children:[Te.map(N=>{const pe=S.find(W=>W.material_equipment_id===N.id);return e.jsxs("button",{className:`tm-item-card ${pe?"added":""}`,onClick:()=>Ft(N),children:[e.jsx("span",{className:"tm-item-name",children:N.name}),e.jsx("span",{className:"tm-item-unit",children:N.unit}),pe&&e.jsx("span",{className:"tm-item-badge",children:pe.quantity})]},N.id)}),e.jsxs("button",{className:"tm-item-card custom",onClick:()=>At(!0),children:[e.jsx("span",{className:"tm-item-name",children:"+ Add Other"}),e.jsx("span",{className:"tm-item-unit",children:"Not on list"})]})]})}),!ft&&S.length>0&&e.jsx("div",{className:"tm-wizard-footer",children:e.jsxs("button",{className:"tm-big-btn primary",onClick:()=>Ve(null),children:["Done Adding (",S.length," items)"]})})]}):e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[e.jsx("button",{className:"tm-back-btn",onClick:ue,children:""}),e.jsxs("h2",{children:[x===1&&"Workers",x===2&&"Materials & Equipment",x===3&&"Review"]}),e.jsxs("div",{className:"tm-step-dots",children:[e.jsx("span",{className:`tm-dot ${x>=1?"active":""}`}),e.jsx("span",{className:`tm-dot ${x>=2?"active":""}`}),e.jsx("span",{className:`tm-dot ${x>=3?"active":""}`})]})]}),x===1&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-project-info",children:[l.job_number&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Job #"}),e.jsx("span",{className:"tm-project-value",children:l.job_number})]}),e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Project"}),e.jsx("span",{className:"tm-project-value",children:l.name})]}),l.address&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Address"}),e.jsx("span",{className:"tm-project-value",children:l.address})]}),l.general_contractor&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"GC"}),e.jsx("span",{className:"tm-project-value",children:l.general_contractor})]})]}),e.jsxs("div",{className:"tm-field-row",children:[e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:f,onChange:N=>v(N.target.value),className:"tm-date"})]}),e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"CE / PCO #"}),e.jsx("input",{type:"text",placeholder:"Change Event / PCO",value:y,onChange:N=>R(N.target.value),className:"tm-input"})]})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Link to Change Order Request (Optional)"}),e.jsxs("div",{className:"tm-cor-row",children:[e.jsxs("select",{value:V,onChange:N=>L(N.target.value),className:"tm-input tm-select",children:[e.jsx("option",{value:"",children:"-- No COR --"}),q.map(N=>e.jsxs("option",{value:N.id,children:[N.cor_number,": ",N.title||"Untitled"," (",N.status,")"]},N.id))]}),e.jsx("button",{type:"button",className:"tm-refresh-btn",onClick:Wt,disabled:T,title:"Refresh COR list",children:e.jsx(Lj,{size:16,className:T?"spinning":""})})]}),e.jsx("span",{className:"tm-field-hint",children:"T&M data will be imported into the selected COR"})]}),ve.length>0&&e.jsxs("div",{className:"tm-crew-picker",children:[e.jsxs("button",{className:"tm-crew-picker-btn",onClick:()=>be(!Ae),children:[e.jsx(ca,{size:16})," ",Ae?"Hide":"Select from"," Today's Crew (",ve.length,")"]}),Ae&&e.jsx("div",{className:"tm-crew-list",children:ve.map((N,pe)=>{const W=I.some(he=>he.name.toLowerCase()===N.name.toLowerCase())||J.some(he=>he.name.toLowerCase()===N.name.toLowerCase())||j.some(he=>he.name.toLowerCase()===N.name.toLowerCase());return e.jsxs("button",{className:`tm-crew-item ${W?"added":""}`,onClick:()=>{if(!W){if(N.role==="Foreman"||N.role==="Supervisor"){const he=I.findIndex(Ce=>!Ce.name.trim());he>=0?G(he,"name",N.name):F([...I,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:N.role==="Supervisor"?"Superintendent":"Foreman"}])}else if(N.role==="Operator"){const he=J.findIndex(Ce=>!Ce.name.trim());he>=0?Ie(he,"name",N.name):Z([...J,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}else{const he=j.findIndex(Ce=>!Ce.name.trim());he>=0?qe(he,"name",N.name):_([...j,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}u(`Added ${N.name}`,"success")}},disabled:W,children:[e.jsx("span",{className:"tm-crew-item-name",children:N.name}),e.jsx("span",{className:`tm-crew-item-role ${(N.role||"laborer").toLowerCase()}`,children:N.role||"Laborer"}),W&&e.jsx("span",{className:"tm-crew-item-check",children:""})]},pe)})})]}),e.jsxs("div",{className:"tm-batch-hours-panel",children:[e.jsxs("div",{className:"tm-batch-hours-header",children:[e.jsx(Nn,{size:18}),e.jsx("span",{children:"Quick Hours Entry"})]}),e.jsx("button",{type:"button",className:"tm-batch-hours-btn",onClick:()=>se(!0),children:"Set hours for entire crew at once"})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Supervision"}),e.jsx("div",{className:"tm-workers-list",children:I.map((N,pe)=>e.jsxs("div",{className:"tm-worker-card-expanded",children:[e.jsxs("div",{className:"tm-worker-row-top",children:[e.jsx("div",{className:"tm-role-select",children:e.jsxs("select",{value:N.role,onChange:W=>G(pe,"role",W.target.value),children:[e.jsx("option",{value:"Foreman",children:"Foreman"}),e.jsx("option",{value:"Superintendent",children:"Superintendent"})]})}),e.jsx("input",{type:"text",placeholder:"First & Last Name",value:N.name,onChange:W=>G(pe,"name",W.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>_e(pe),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:W=>G(pe,"timeStarted",W.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:W=>G(pe,"timeEnded",W.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Reg Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:W=>G(pe,"hours",W.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"OT Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:W=>G(pe,"overtimeHours",W.target.value)})]})]})]},pe))}),e.jsx("button",{className:"tm-add-btn",onClick:xe,children:"+ Add Supervision"})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Operators"}),e.jsx("div",{className:"tm-workers-list",children:J.map((N,pe)=>e.jsxs("div",{className:"tm-worker-card-expanded",children:[e.jsxs("div",{className:"tm-worker-row-top",children:[e.jsx("input",{type:"text",placeholder:"First & Last Name",value:N.name,onChange:W=>Ie(pe,"name",W.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>kt(pe),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:W=>Ie(pe,"timeStarted",W.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:W=>Ie(pe,"timeEnded",W.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Reg Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:W=>Ie(pe,"hours",W.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"OT Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:W=>Ie(pe,"overtimeHours",W.target.value)})]})]})]},pe))}),e.jsx("button",{className:"tm-add-btn",onClick:wt,children:"+ Add Operator"})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Laborers"}),e.jsx("div",{className:"tm-workers-list",children:j.map((N,pe)=>e.jsxs("div",{className:"tm-worker-card-expanded",children:[e.jsxs("div",{className:"tm-worker-row-top",children:[e.jsx("input",{type:"text",placeholder:"First & Last Name",value:N.name,onChange:W=>qe(pe,"name",W.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>We(pe),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:W=>qe(pe,"timeStarted",W.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:W=>qe(pe,"timeEnded",W.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Reg Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:W=>qe(pe,"hours",W.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"OT Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:W=>qe(pe,"overtimeHours",W.target.value)})]})]})]},pe))}),e.jsx("button",{className:"tm-add-btn",onClick:Ye,children:"+ Add Laborer"})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Description of Work"}),e.jsx("textarea",{placeholder:"What work was performed today?",value:k,onChange:N=>M(N.target.value),rows:3,className:"tm-description"})]}),e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:[e.jsx(or,{size:16,className:"inline-icon"})," Photos",o!==-1&&e.jsxs("span",{className:"tm-photo-count",children:["(",C.length,"/",o,")"]})]}),C.length>0&&e.jsx("div",{className:"tm-photo-grid",children:C.map(N=>e.jsxs("div",{className:"tm-photo-item",children:[e.jsx("img",{src:N.previewUrl,alt:N.name}),e.jsx("button",{className:"tm-photo-remove",onClick:()=>_t(N.id),children:""})]},N.id))}),(o===-1||C.length<o)&&e.jsxs("label",{className:"tm-photo-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:Rt,style:{display:"none"}}),e.jsx(or,{size:16,className:"inline-icon"})," ",C.length>0?"Add More Photos":"Add Photos"]}),o!==-1&&C.length>=o&&e.jsxs("div",{className:"tm-photo-limit-reached",children:["Photo limit reached (",o," max)"]})]})]}),x===2&&!Pe&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"What was used?"}),e.jsx("div",{className:"tm-category-grid",children:vf.map(N=>{const pe=S.filter(W=>W.category===N);return e.jsxs("button",{className:"tm-category-card",onClick:()=>Ve(N),children:[e.jsx("span",{className:"tm-cat-name",children:N}),pe.length>0&&e.jsx("span",{className:"tm-cat-count",children:pe.length})]},N)})})]}),S.length>0&&e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:["Added Items (",S.length,")"]}),e.jsx("div",{className:"tm-added-list",children:S.map((N,pe)=>e.jsxs("div",{className:"tm-added-item",children:[e.jsxs("div",{className:"tm-added-info",children:[N.isCustom&&e.jsx("span",{className:"tm-custom-badge",children:"Custom"}),e.jsx("span",{className:"tm-added-name",children:N.name})]}),e.jsxs("div",{className:"tm-added-qty",children:[e.jsx("button",{onClick:()=>Ut(pe,N.quantity-1),children:""}),e.jsx("span",{children:N.quantity}),e.jsx("button",{onClick:()=>Ut(pe,N.quantity+1),children:"+"})]})]},pe))})]})]}),x===3&&e.jsxs("div",{className:"tm-step-content",children:[e.jsx("div",{className:"tm-review-section",children:e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Date"}),e.jsx("span",{children:new Date(f).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]})}),k&&e.jsxs("div",{className:"tm-review-section",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(Ua,{size:16,className:"inline-icon"})," Description"]})}),e.jsx("div",{className:"tm-review-notes",children:k})]}),C.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(or,{size:16,className:"inline-icon"})," Photos"]}),e.jsx("span",{children:C.length})]}),e.jsx("div",{className:"tm-review-photos",children:C.map(N=>e.jsx("img",{src:N.previewUrl,alt:N.name},N.id))})]}),St.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(av,{size:16,className:"inline-icon"})," Supervision"]}),e.jsxs("span",{children:[St.reduce((N,pe)=>N+parseFloat(pe.hours||0)+parseFloat(pe.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:St.map((N,pe)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsxs("div",{className:"tm-review-worker-name",children:[e.jsx("span",{className:"tm-role-badge",children:N.role})," ",N.name]}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},pe))})]}),Et.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Operators"}),e.jsxs("span",{children:[Et.reduce((N,pe)=>N+parseFloat(pe.hours||0)+parseFloat(pe.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:Et.map((N,pe)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:N.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},pe))})]}),ct.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(ca,{size:16,className:"inline-icon"})," Laborers"]}),e.jsxs("span",{children:[ct.reduce((N,pe)=>N+parseFloat(pe.hours||0)+parseFloat(pe.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:ct.map((N,pe)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:N.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},pe))})]}),S.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(hr,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsxs("span",{children:[S.length," items"]})]}),e.jsx("div",{className:"tm-review-list",children:S.map((N,pe)=>e.jsxs("div",{className:"tm-review-row",children:[e.jsxs("span",{children:[N.isCustom&&e.jsxs(e.Fragment,{children:[e.jsx(iv,{size:14,className:"inline-icon"})," "]}),N.name]}),e.jsxs("span",{children:[N.quantity," ",N.unit]})]},pe))})]}),e.jsxs("div",{className:"tm-review-section tm-certification",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(fd,{size:16,className:"inline-icon"})," Submitted By"]})}),e.jsx("input",{type:"text",className:"tm-certification-input",placeholder:"Enter your name",value:X,onChange:N=>B(N.target.value)}),e.jsx("p",{className:"tm-certification-note",children:"By submitting, you certify this T&M is accurate."})]})]}),e.jsxs("div",{className:"tm-wizard-footer",children:[x<3?e.jsx("button",{className:"tm-big-btn primary",onClick:Se,disabled:x===1&&!le(),children:x===1?`Next: Materials (${It} workers, ${Jt+ta} hrs)`:x===2?`Review (${S.length} items)`:"Next"}):e.jsx("button",{className:"tm-big-btn submit",onClick:Xe,disabled:Q,children:Q?$||"Submitting...":" Submit T&M"}),x===2&&e.jsx("button",{className:"tm-skip-btn",onClick:Se,children:"Skip (no materials)"})]}),w&&e.jsx("div",{className:"tm-modal-overlay",onClick:()=>se(!1),children:e.jsxs("div",{className:"tm-batch-modal",onClick:N=>N.stopPropagation(),children:[e.jsxs("h3",{children:[e.jsx(Nn,{size:18})," Apply Same Hours"]}),e.jsx("p",{className:"tm-batch-description",children:"Set hours for all workers with names entered. Individual times can still be adjusted afterwards."}),e.jsxs("div",{className:"tm-batch-form",children:[e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:"Start Time"}),e.jsx("input",{type:"time",value:ne.timeStarted,onChange:N=>P({...ne,timeStarted:N.target.value})})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:"End Time"}),e.jsx("input",{type:"time",value:ne.timeEnded,onChange:N=>P({...ne,timeEnded:N.target.value})})]})]}),e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:"Regular Hours"}),e.jsx("input",{type:"number",placeholder:"8",value:ne.hours,onChange:N=>P({...ne,hours:N.target.value})})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:"OT Hours"}),e.jsx("input",{type:"number",placeholder:"0",value:ne.overtimeHours,onChange:N=>P({...ne,overtimeHours:N.target.value})})]})]})]}),e.jsxs("div",{className:"tm-batch-preview",children:[e.jsx("strong",{children:"Will apply to:"}),e.jsxs("span",{children:[[...I.filter(N=>N.name.trim()),...J.filter(N=>N.name.trim()),...j.filter(N=>N.name.trim())].length," worker(s) with names entered"]})]}),e.jsxs("div",{className:"tm-batch-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>se(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:A,disabled:!ne.hours&&!ne.overtimeHours,children:"Apply Hours"})]})]})})]})}function pv({project:l,onShowToast:r}){const[o,c]=p.useState([]),[m,u]=p.useState(!0),[x,g]=p.useState(!1),[f,v]=p.useState(!1),[y,R]=p.useState({name:"",role:"Laborer"});p.useEffect(()=>{X()},[l.id]);const X=async()=>{try{const q=await ce.getCrewCheckin(l.id);q?.workers&&c(q.workers)}catch(q){console.error("Error loading crew:",q)}finally{u(!1)}},B=async()=>{if(!y.name.trim()){r("Enter worker name","error");return}if(o.find(q=>q.name.toLowerCase()===y.name.trim().toLowerCase())){r("Worker already added","error");return}g(!0);try{const q=[...o,{name:y.name.trim(),role:y.role}];await ce.saveCrewCheckin(l.id,q),c(q),R({name:"",role:"Laborer"}),v(!1),r("Crew member added","success")}catch(q){console.error("Error adding worker:",q),r("Error adding crew member","error")}finally{g(!1)}},V=async q=>{g(!0);try{const ee=o.filter(T=>T.name.toLowerCase()!==q.toLowerCase());await ce.saveCrewCheckin(l.id,ee),c(ee),r("Crew member removed","success")}catch(ee){console.error("Error removing worker:",ee),r("Error removing crew member","error")}finally{g(!1)}},L=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"});return m?e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(ca,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:L})]}),e.jsx("div",{className:"crew-loading",children:"Loading..."})]}):e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(ca,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:L})]}),o.length===0?e.jsxs("div",{className:"crew-empty",children:[e.jsx("p",{children:"No crew checked in yet"}),e.jsx("p",{className:"crew-empty-hint",children:"Add your crew for the day"})]}):e.jsx("div",{className:"crew-list",children:o.map(q=>e.jsxs("div",{className:"crew-member",children:[e.jsxs("div",{className:"crew-member-info",children:[e.jsx("span",{className:"crew-member-name",children:q.name}),e.jsx("span",{className:`crew-member-role ${q.role.toLowerCase()}`,children:q.role})]}),e.jsx("button",{className:"crew-remove-btn",onClick:()=>V(q.name),disabled:x,children:""})]},q.name))}),f?e.jsxs("div",{className:"crew-add-form",children:[e.jsx("input",{type:"text",value:y.name,onChange:q=>R({...y,name:q.target.value}),placeholder:"Name",autoFocus:!0}),e.jsxs("select",{value:y.role,onChange:q=>R({...y,role:q.target.value}),children:[e.jsx("option",{value:"Foreman",children:"Foreman"}),e.jsx("option",{value:"Laborer",children:"Laborer"}),e.jsx("option",{value:"Supervisor",children:"Supervisor"}),e.jsx("option",{value:"Operator",children:"Operator"})]}),e.jsxs("div",{className:"crew-add-buttons",children:[e.jsx("button",{className:"crew-add-confirm",onClick:B,disabled:x,children:x?"...":"Add"}),e.jsx("button",{className:"crew-add-cancel",onClick:()=>{v(!1),R({name:"",role:"Laborer"})},children:"Cancel"})]})]}):e.jsx("button",{className:"crew-add-btn",onClick:()=>v(!0),children:"+ Add Crew Member"}),e.jsxs("div",{className:"crew-count",children:[o.length," ",o.length===1?"person":"people"," on site"]})]})}function gv({project:l,onShowToast:r,onClose:o}){const[c,m]=p.useState(!0),[u,x]=p.useState(!1),[g,f]=p.useState(null),[v,y]=p.useState(""),[R,X]=p.useState("");p.useEffect(()=>{B()},[l.id]);const B=async()=>{try{const ee=await ce.getDailyReport(l.id);if(ee)f(ee),y(ee.field_notes||""),X(ee.issues||"");else{const T=await ce.compileDailyReport(l.id);f({...T,status:"draft"})}}catch(ee){console.error("Error loading report:",ee),r("Error loading report","error")}finally{m(!1)}},V=async()=>{if(!K){r("Demo Mode: Report saved locally only - won't reach office","info"),o();return}x(!0);try{await ce.saveDailyReport(l.id,{field_notes:v,issues:R}),await ce.submitDailyReport(l.id,"Field")?(r("Daily report submitted!","success"),o()):r("Report not sent - check connection","error")}catch(ee){console.error("Error submitting report:",ee),r("Error submitting report","error")}finally{x(!1)}},L=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});if(c)return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),e.jsx("h2",{children:"Daily Report"})]}),e.jsx("div",{className:"daily-report-loading",children:"Compiling report..."})]});const q=g?.status==="submitted";return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),e.jsxs("div",{children:[e.jsx("h2",{children:"Daily Report"}),e.jsx("p",{className:"daily-report-date",children:L})]})]}),q&&e.jsxs("div",{className:"daily-report-submitted-banner",children:[" Submitted ",new Date(g.submitted_at).toLocaleTimeString()]}),e.jsxs("div",{className:"daily-report-content",children:[e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.crew_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.tasks_completed||0}),e.jsx("div",{className:"daily-report-card-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.tm_tickets_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.photos_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Photos"})]})]}),g.crew_list?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(ca,{size:18,className:"inline-icon"})," Crew"]}),e.jsx("div",{className:"daily-report-crew",children:g.crew_list.map((ee,T)=>e.jsxs("div",{className:"daily-report-crew-item",children:[e.jsx("span",{children:ee.name}),e.jsx("span",{className:"daily-report-crew-role",children:ee.role})]},T))})]}),g.completed_tasks?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Ja,{size:18,className:"inline-icon"})," Completed Today"]}),e.jsx("ul",{className:"daily-report-tasks",children:g.completed_tasks.map((ee,T)=>e.jsxs("li",{children:[ee.name,ee.group&&e.jsx("span",{className:"daily-report-task-group",children:ee.group})]},T))})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Ua,{size:18,className:"inline-icon"})," Notes"]}),e.jsx("textarea",{value:v,onChange:ee=>y(ee.target.value),placeholder:"Any notes about today's work...",rows:3,disabled:q})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(zi,{size:18,className:"inline-icon"})," Issues / Concerns"]}),e.jsx("textarea",{value:R,onChange:ee=>X(ee.target.value),placeholder:"Any problems, delays, or concerns...",rows:3,disabled:q})]})]}),!q&&e.jsxs("div",{className:"daily-report-footer",children:[e.jsx("button",{className:"btn btn-primary daily-report-submit",onClick:V,disabled:u,children:u?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(ev,{size:16,className:"inline-icon"})," Submit Report"]})}),e.jsx("p",{className:"daily-report-hint",children:"This will be sent to the office"})]})]})}function xv({project:l,viewerType:r,viewerName:o,onShowToast:c,onClose:m}){const[u,x]=p.useState([]),[g,f]=p.useState(!0),[v,y]=p.useState(!1),[R,X]=p.useState(""),B=p.useRef(null);p.useEffect(()=>{V(),ce.markMessagesRead(l.id,r)},[l.id]),p.useEffect(()=>{B.current?.scrollIntoView({behavior:"smooth"})},[u]);const V=async()=>{try{const T=await ce.getMessages(l.id);x(T.reverse())}catch(T){console.error("Error loading messages:",T)}finally{f(!1)}},L=async()=>{if(R.trim()){if(!K){c("Demo Mode: Messages won't sync to other users","info");const T={id:Date.now(),project_id:l.id,message:R.trim(),sender_type:r,sender_name:o,created_at:new Date().toISOString()};x([...u,T]),X("");return}y(!0);try{const T=await ce.sendMessage(l.id,R.trim(),r,o);T?(x([...u,T]),X("")):c("Message not sent - check connection","error")}catch(T){console.error("Error sending message:",T),c("Error sending message","error")}finally{y(!1)}}},q=T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),L())},ee=T=>{const D=new Date(T),w=new Date;return D.toDateString()===w.toDateString()?D.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):D.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})};return e.jsxs("div",{className:"messages-container",children:[e.jsxs("div",{className:"messages-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:m,children:""}),e.jsxs("div",{children:[e.jsx("h2",{children:"Messages"}),e.jsx("p",{className:"messages-project",children:l.name})]})]}),e.jsxs("div",{className:"messages-list",children:[g?e.jsx("div",{className:"messages-loading",children:"Loading..."}):u.length===0?e.jsxs("div",{className:"messages-empty",children:[e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"messages-empty-hint",children:r==="field"?"Messages from the office will appear here":"Send a message to the field crew"})]}):u.map(T=>e.jsx("div",{className:`message ${T.sender_type===r?"sent":"received"}`,children:e.jsxs("div",{className:"message-bubble",children:[e.jsxs("div",{className:"message-sender",children:[T.sender_type==="office"?e.jsx(dl,{size:14,className:"inline-icon"}):e.jsx(ca,{size:14,className:"inline-icon"})," ",T.sender_name]}),e.jsx("div",{className:"message-text",children:T.message}),T.photo_url&&e.jsx("img",{src:T.photo_url,alt:"Attached",className:"message-photo"}),e.jsx("div",{className:"message-time",children:ee(T.created_at)})]})},T.id)),e.jsx("div",{ref:B})]}),e.jsxs("div",{className:"messages-input-container",children:[e.jsx("textarea",{value:R,onChange:T=>X(T.target.value),onKeyDown:q,placeholder:"Type a message...",rows:1,disabled:v}),e.jsx("button",{className:"messages-send-btn",onClick:L,disabled:v||!R.trim(),children:v?"...":""})]})]})}function jv({project:l,requestedBy:r,onShowToast:o,onClose:c}){const[m,u]=p.useState([{name:"",quantity:"",unit:"each"}]),[x,g]=p.useState(""),[f,v]=p.useState("normal"),[y,R]=p.useState(""),[X,B]=p.useState(!1),V=()=>{u([...m,{name:"",quantity:"",unit:"each"}])},L=(T,D,w)=>{u(m.map((se,ne)=>ne===T?{...se,[D]:w}:se))},q=T=>{m.length>1&&u(m.filter((D,w)=>w!==T))},ee=async()=>{const T=m.filter(D=>D.name.trim()&&parseFloat(D.quantity)>0);if(T.length===0){o("Add at least one item with quantity","error");return}if(!K){o("Demo Mode: Request saved locally only - won't reach office","info"),c();return}B(!0);try{await ce.createMaterialRequest(l.id,T,r,x||null,f,y||null)?(o("Request submitted!","success"),c()):o("Request not sent - check connection","error")}catch(D){console.error("Error submitting request:",D),o("Error submitting request","error")}finally{B(!1)}};return e.jsxs("div",{className:"material-request",children:[e.jsxs("div",{className:"material-request-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsx("h2",{children:"Request Materials"})]}),e.jsxs("div",{className:"material-request-content",children:[e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"What do you need?"}),m.map((T,D)=>e.jsxs("div",{className:"material-request-item",children:[e.jsx("input",{type:"text",placeholder:"Item name",value:T.name,onChange:w=>L(D,"name",w.target.value),className:"material-request-name"}),e.jsx("input",{type:"number",placeholder:"Qty",value:T.quantity,onChange:w=>L(D,"quantity",w.target.value),className:"material-request-qty"}),e.jsxs("select",{value:T.unit,onChange:w=>L(D,"unit",w.target.value),className:"material-request-unit",children:[e.jsx("option",{value:"each",children:"each"}),e.jsx("option",{value:"rolls",children:"rolls"}),e.jsx("option",{value:"boxes",children:"boxes"}),e.jsx("option",{value:"bags",children:"bags"}),e.jsx("option",{value:"sheets",children:"sheets"}),e.jsx("option",{value:"gallons",children:"gal"}),e.jsx("option",{value:"feet",children:"ft"}),e.jsx("option",{value:"lbs",children:"lbs"})]}),e.jsx("button",{className:"material-request-remove",onClick:()=>q(D),children:""})]},D)),e.jsx("button",{className:"material-request-add",onClick:V,children:"+ Add Another Item"})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Priority"}),e.jsx("div",{className:"material-request-priority",children:["low","normal","urgent"].map(T=>e.jsxs("button",{className:`priority-btn ${f===T?"active":""} ${T}`,onClick:()=>v(T),children:[T==="urgent"&&" ",T==="normal"&&" ",T==="low"&&" ",T.charAt(0).toUpperCase()+T.slice(1)]},T))})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Needed By (optional)"}),e.jsx("input",{type:"date",value:x,onChange:T=>g(T.target.value),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Notes (optional)"}),e.jsx("textarea",{value:y,onChange:T=>R(T.target.value),placeholder:"Any additional details...",rows:2})]})]}),e.jsx("div",{className:"material-request-footer",children:e.jsx("button",{className:"btn btn-primary",onClick:ee,disabled:X,children:X?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(Wa,{size:16,className:"inline-icon"})," Submit Request"]})})})]})}const vv=p.createContext({}),ep=()=>p.useContext(vv);function en({message:l,type:r="",onClose:o}){return p.useEffect(()=>{const c=setTimeout(o,3e3);return()=>clearTimeout(c)},[o]),e.jsx("div",{className:"toast-container",children:e.jsx("div",{className:`toast ${r}`,children:l})})}function tp({project:l,companyId:r,onClose:o,onReportCreated:c}){const{user:m}=ep(),[u,x]=p.useState(!1),[g,f]=p.useState(null),[v,y]=p.useState(1),[R,X]=p.useState(new Date().toISOString().split("T")[0]),[B,V]=p.useState(new Date().toTimeString().split(" ")[0].substring(0,5)),[L,q]=p.useState(""),[ee,T]=p.useState(""),[D,w]=p.useState("minor"),[se,ne]=p.useState(""),[P,I]=p.useState(""),[F,J]=p.useState(""),[Z,j]=p.useState(""),[_,S]=p.useState(""),[ae,k]=p.useState(""),[M,C]=p.useState(""),[me,Q]=p.useState(m?.name||""),[O,$]=p.useState(""),[H,ve]=p.useState(""),[Ne,Ae]=p.useState(m?.email||""),[be,Pe]=p.useState([]),[Ve,Te]=p.useState(""),[ht,Yt]=p.useState(""),[Tt,ft]=p.useState(""),[At,lt]=p.useState(""),[Le,Wt]=p.useState(!1),[A,E]=p.useState(""),[fe,xe]=p.useState(""),[G,_e]=p.useState(!1),[Ye,qe]=p.useState(""),[We,wt]=p.useState(""),[Ie,kt]=p.useState(""),[Ft,Ot]=p.useState(""),[Ut,ut]=p.useState(!1),[Rt,_t]=p.useState(!1),[le,Se]=p.useState(0),[ue,Xe]=p.useState(0),St=()=>{if(!Ve.trim()){f({type:"error",message:"Please enter witness name"});return}const N={name:Ve,phone:ht,email:Tt,testimony:At};Pe([...be,N]),Te(""),Yt(""),ft(""),lt(""),f({type:"success",message:"Witness added"})},Et=N=>{Pe(be.filter((pe,W)=>W!==N))},ct=N=>{switch(N){case 1:if(!L.trim()||!ee.trim())return f({type:"error",message:"Please fill in all incident details"}),!1;break;case 2:if(!P.trim()||!ae.trim())return f({type:"error",message:"Please fill in employee name and job title"}),!1;break;case 3:if(!me.trim()||!O.trim())return f({type:"error",message:"Please fill in supervisor name and title"}),!1;break}return!0},It=()=>{ct(v)&&y(v+1)},Jt=()=>{y(v-1)},ta=async()=>{if(ct(v)){if(!K){f({type:"info",message:"Demo Mode: Report saved locally only - won't reach office"}),setTimeout(()=>{o()},1500);return}x(!0);try{const N={project_id:l.id,company_id:r,incident_date:R,incident_time:B,incident_location:L,incident_description:ee,injury_type:D,body_part_affected:se||null,employee_name:P,employee_phone:F||null,employee_email:Z||null,employee_address:_||null,employee_job_title:ae,employee_hire_date:M||null,medical_treatment_required:Le,medical_facility_name:A||null,medical_facility_address:fe||null,hospitalized:G,reported_by_name:me,reported_by_title:O,reported_by_phone:H||null,reported_by_email:Ne||null,witnesses:be,immediate_actions_taken:Ye||null,corrective_actions_planned:We||null,safety_equipment_used:Ie||null,safety_equipment_failed:Ft||null,osha_recordable:Ut,workers_comp_claim:Rt,days_away_from_work:parseInt(le)||0,restricted_work_days:parseInt(ue)||0,status:"reported",created_by:m?.id},pe=await ce.createInjuryReport(N);f({type:"success",message:"Injury report submitted successfully"}),c&&c(pe),setTimeout(()=>{o()},1500)}catch(N){console.error("Error submitting injury report:",N),f({type:"error",message:"Failed to submit injury report"})}finally{x(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:o,children:e.jsxs("div",{className:"modal-content injury-report-modal",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Workplace Injury/Incident Report"}),e.jsx("button",{className:"close-btn",onClick:o,children:""})]}),e.jsxs("div",{className:"progress-steps",children:[e.jsx("div",{className:`step ${v>=1?"active":""}`,children:"1. Incident"}),e.jsx("div",{className:`step ${v>=2?"active":""}`,children:"2. Employee"}),e.jsx("div",{className:`step ${v>=3?"active":""}`,children:"3. Supervisor"}),e.jsx("div",{className:`step ${v>=4?"active":""}`,children:"4. Witnesses"}),e.jsx("div",{className:`step ${v>=5?"active":""}`,children:"5. Medical & Safety"})]}),e.jsxs("div",{className:"modal-body",children:[v===1&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Incident Details"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date of Incident *"}),e.jsx("input",{type:"date",value:R,onChange:N=>X(N.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Time of Incident *"}),e.jsx("input",{type:"time",value:B,onChange:N=>V(N.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Location on Site *"}),e.jsx("input",{type:"text",value:L,onChange:N=>q(N.target.value),placeholder:"e.g., Floor 2, near elevator shaft"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Incident Description *"}),e.jsx("textarea",{value:ee,onChange:N=>T(N.target.value),rows:4,placeholder:"Describe what happened in detail..."})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Injury Type *"}),e.jsxs("select",{value:D,onChange:N=>w(N.target.value),children:[e.jsx("option",{value:"minor",children:"Minor Injury"}),e.jsx("option",{value:"serious",children:"Serious Injury"}),e.jsx("option",{value:"critical",children:"Critical Injury"}),e.jsx("option",{value:"near_miss",children:"Near Miss (No Injury)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("input",{type:"text",value:se,onChange:N=>ne(N.target.value),placeholder:"e.g., Left hand, lower back"})]})]})]}),v===2&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Injured Employee Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:P,onChange:N=>I(N.target.value),placeholder:"First and last name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:F,onChange:N=>J(N.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:Z,onChange:N=>j(N.target.value),placeholder:"email@example.com"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Home Address"}),e.jsx("input",{type:"text",value:_,onChange:N=>S(N.target.value),placeholder:"Street address, city, state, zip"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Title *"}),e.jsx("input",{type:"text",value:ae,onChange:N=>k(N.target.value),placeholder:"e.g., Carpenter, Electrician"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Hire Date"}),e.jsx("input",{type:"date",value:M,onChange:N=>C(N.target.value)})]})]})]}),v===3&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Foreman/Supervisor Making Report"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Name *"}),e.jsx("input",{type:"text",value:me,onChange:N=>Q(N.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Title *"}),e.jsx("input",{type:"text",value:O,onChange:N=>$(N.target.value),placeholder:"e.g., Site Foreman, Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Phone Number"}),e.jsx("input",{type:"tel",value:H,onChange:N=>ve(N.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Email Address"}),e.jsx("input",{type:"email",value:Ne,onChange:N=>Ae(N.target.value),placeholder:"email@example.com"})]})]}),v===4&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Witness Testimonies (Optional)"}),be.length>0&&e.jsx("div",{className:"witnesses-list",children:be.map((N,pe)=>e.jsxs("div",{className:"witness-item",children:[e.jsxs("div",{className:"witness-info",children:[e.jsx("strong",{children:N.name}),N.phone&&e.jsxs("span",{children:["  ",N.phone]}),N.testimony&&e.jsxs("p",{className:"witness-testimony",children:['"',N.testimony,'"']})]}),e.jsx("button",{className:"btn-danger btn-small",onClick:()=>Et(pe),children:"Remove"})]},pe))}),e.jsxs("div",{className:"add-witness-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Name"}),e.jsx("input",{type:"text",value:Ve,onChange:N=>Te(N.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:ht,onChange:N=>Yt(N.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:Tt,onChange:N=>ft(N.target.value),placeholder:"email@example.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Testimony"}),e.jsx("textarea",{value:At,onChange:N=>lt(N.target.value),rows:3,placeholder:"What did the witness see or hear?"})]}),e.jsx("button",{className:"btn-secondary",onClick:St,children:"+ Add Witness"})]})]}),v===5&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Medical Treatment & Safety"}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Le,onChange:N=>Wt(N.target.checked)}),"Medical treatment required"]})}),Le&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Name"}),e.jsx("input",{type:"text",value:A,onChange:N=>E(N.target.value),placeholder:"Hospital or clinic name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Address"}),e.jsx("input",{type:"text",value:fe,onChange:N=>xe(N.target.value),placeholder:"Street address"})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:G,onChange:N=>_e(N.target.checked)}),"Employee was hospitalized"]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("textarea",{value:Ye,onChange:N=>qe(N.target.value),rows:2,placeholder:"What was done immediately after the incident?"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("textarea",{value:We,onChange:N=>wt(N.target.value),rows:2,placeholder:"What will be done to prevent this in the future?"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("input",{type:"text",value:Ie,onChange:N=>kt(N.target.value),placeholder:"e.g., Hard hat, gloves, harness"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("input",{type:"text",value:Ft,onChange:N=>Ot(N.target.value),placeholder:"Equipment that failed, if any"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("input",{type:"number",min:"0",value:le,onChange:N=>Se(N.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("input",{type:"number",min:"0",value:ue,onChange:N=>Xe(N.target.value)})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Ut,onChange:N=>ut(N.target.checked)}),"OSHA Recordable Incident"]})}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Rt,onChange:N=>_t(N.target.checked)}),"Workers' Compensation Claim Filed"]})})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"form-actions",children:[v>1&&e.jsx("button",{className:"btn-secondary",onClick:Jt,children:" Back"}),e.jsx("button",{className:"btn-secondary",onClick:o,children:"Cancel"}),v<5?e.jsx("button",{className:"btn-primary",onClick:It,children:"Next "}):e.jsx("button",{className:"btn-primary",onClick:ta,disabled:u,children:u?"Submitting...":"Submit Report"})]})})]})}),g&&e.jsx(en,{message:g.message,type:g.type,onClose:()=>f(null)}),e.jsx("style",{children:`
        .injury-report-modal {
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid var(--border-color);
          background-color: var(--bg-elevated);
          overflow-x: auto;
        }

        .progress-steps .step {
          font-size: 0.875rem;
          color: var(--text-muted);
          font-weight: 500;
          white-space: nowrap;
          padding: 0.5rem;
        }

        .progress-steps .step.active {
          color: var(--accent-primary);
          font-weight: 600;
        }

        .form-step h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          color: var(--text-primary);
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 1rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-group textarea {
          resize: vertical;
        }

        .checkbox-group label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: normal;
          cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
          width: auto;
          margin: 0;
        }

        .witnesses-list {
          margin-bottom: 1.5rem;
        }

        .witness-item {
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .witness-info {
          flex: 1;
          color: var(--text-primary);
        }

        .witness-testimony {
          margin-top: 0.5rem;
          color: var(--text-secondary);
          font-style: italic;
          font-size: 0.875rem;
        }

        .add-witness-form {
          border: 2px dashed var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          background-color: var(--bg-elevated);
        }

        .modal-footer {
          border-top: 1px solid var(--border-color);
          padding: 1rem 1.5rem;
        }

        .form-actions {
          display: flex;
          justify-content: space-between;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
        }

        @media (max-width: 768px) {
          .injury-report-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }

          .form-row {
            grid-template-columns: 1fr;
          }

          .progress-steps .step {
            font-size: 0.75rem;
            padding: 0.25rem;
          }
        }
      `})]})}const yf=[{id:"trash",label:"Trash",description:"General debris"},{id:"metal",label:"Metal",description:"Scrap metal (recyclable)"},{id:"copper",label:"Copper",description:"Copper scrap (recyclable)"},{id:"concrete",label:"Concrete",description:"Concrete/masonry"},{id:"hazardous",label:"Hazardous",description:"Hazardous materials"}];function yv({project:l,companyId:r,onClose:o,onSubmit:c,onShowToast:m}){const[u,x]=p.useState(!1),[g,f]=p.useState([]),[v,y]=p.useState(!0),[R,X]=p.useState(new Date().toISOString().split("T")[0]),[B,V]=p.useState("trash"),[L,q]=p.useState(1),[ee,T]=p.useState(""),[D,w]=p.useState(l.default_dump_site_id||""),[se,ne]=p.useState(""),[P,I]=p.useState(null),[F,J]=p.useState(null);p.useEffect(()=>{Z()},[r]),p.useEffect(()=>{j()},[D,B,L,g]);const Z=async()=>{try{const M=await ce.getDumpSites(r);f(M||[]),l.default_dump_site_id?w(l.default_dump_site_id):M&&M.length>0&&w(M[0].id)}catch(M){console.error("Error loading dump sites:",M)}finally{y(!1)}},j=()=>{if(!D||!B||!L){I(null),J(null);return}const M=g.find(me=>me.id===D);if(!M||!M.dump_site_rates){I(null),J(null);return}const C=M.dump_site_rates.find(me=>me.waste_type===B);if(C&&C.estimated_cost_per_load!==null){const me=parseFloat(C.estimated_cost_per_load);J(me),I(me*parseInt(L))}else I(null),J(null)},_=M=>M==null?"--":M<0?`-$${Math.abs(M).toFixed(0)}`:`$${M.toFixed(0)}`,S=async M=>{if(M.preventDefault(),!D){m("Please select a dump site","error");return}if(!L||L<1){m("Please enter number of loads","error");return}x(!0);try{await ce.createHaulOff(l.id,{dump_site_id:D,waste_type:B,loads:parseInt(L),hauling_company:ee.trim()||null,work_date:R,notes:se.trim()||null,estimated_cost:P,created_by:"Field"}),m("Haul-off logged successfully","success"),c&&c(),o()}catch(C){console.error("Error logging haul-off:",C),m("Error logging haul-off","error")}finally{x(!1)}},ae=g.find(M=>M.id===D),k=yf.find(M=>M.id===B);return e.jsxs("div",{className:"hauloff-form-container",children:[e.jsxs("div",{className:"hauloff-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),e.jsx("h2",{children:"Log Haul-Off"})]}),e.jsxs("form",{onSubmit:S,className:"hauloff-form",children:[e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:R,onChange:M=>X(M.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Waste Type"}),e.jsx("div",{className:"waste-type-grid",children:yf.map(M=>e.jsxs("button",{type:"button",className:`waste-type-btn ${B===M.id?"active":""} ${M.id==="metal"||M.id==="copper"?"recyclable":""}`,onClick:()=>V(M.id),children:[e.jsx("span",{className:"waste-label",children:M.label}),(M.id==="metal"||M.id==="copper")&&e.jsx("span",{className:"waste-badge",children:"$"})]},M.id))})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Number of Loads"}),e.jsxs("div",{className:"loads-input-row",children:[e.jsx("button",{type:"button",className:"loads-btn",onClick:()=>q(Math.max(1,L-1)),children:""}),e.jsx("input",{type:"number",value:L,onChange:M=>q(Math.max(1,parseInt(M.target.value)||1)),min:"1",className:"loads-input"}),e.jsx("button",{type:"button",className:"loads-btn",onClick:()=>q(L+1),children:"+"})]})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Dump Site"}),v?e.jsx("div",{className:"loading-inline",children:"Loading sites..."}):g.length===0?e.jsx("div",{className:"no-sites-warning",children:"No dump sites configured. Ask office to add dump sites."}):e.jsxs("select",{value:D,onChange:M=>w(M.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),g.map(M=>e.jsx("option",{value:M.id,children:M.name},M.id))]}),ae?.address&&e.jsx("span",{className:"field-hint",children:ae.address})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Hauling Company (Optional)"}),e.jsx("input",{type:"text",value:ee,onChange:M=>T(M.target.value),placeholder:"e.g., ABC Trucking"})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Notes (Optional)"}),e.jsx("textarea",{value:se,onChange:M=>ne(M.target.value),placeholder:"Any additional notes...",rows:2})]}),e.jsxs("div",{className:"hauloff-estimate",children:[e.jsx("div",{className:"estimate-header",children:"Estimated Cost"}),P!==null?e.jsxs("div",{className:`estimate-value ${P<0?"revenue":""}`,children:[e.jsx("span",{className:"estimate-amount",children:_(P)}),e.jsxs("span",{className:"estimate-breakdown",children:[_(F),"/load  ",L," load",L>1?"s":""]}),P<0&&e.jsx("span",{className:"estimate-note revenue-note",children:"Revenue from recyclables"})]}):e.jsxs("div",{className:"estimate-value",children:[e.jsx("span",{className:"estimate-amount",children:"--"}),e.jsx("span",{className:"estimate-breakdown",children:D?ae?.dump_site_rates?.find(M=>M.waste_type===B)?"Unable to calculate":`No rate set for ${k?.label||B}`:"Select a dump site"})]}),e.jsx("div",{className:"estimate-disclaimer",children:"This is an estimate for burn rate tracking, not an invoice amount."})]}),e.jsxs("div",{className:"hauloff-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:o,disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:u||!D,children:u?"Saving...":"Log Haul-Off"})]})]})]})}function bv({project:l,companyId:r,onShowToast:o,onExit:c}){const[m,u]=p.useState([]),[x,g]=p.useState(!0),[f,v]=p.useState(null),[y,R]=p.useState({}),[X,B]=p.useState(!1),[V,L]=p.useState(!0),[q,ee]=p.useState(!1),[T,D]=p.useState(!1),[w,se]=p.useState(!1),[ne,P]=p.useState(!1),[I,F]=p.useState(!1),[J,Z]=p.useState(!1),[j,_]=p.useState(0);p.useEffect(()=>{S(),ae()},[l.id]);const S=async()=>{try{const Ne=await ce.getAreas(l.id);u(Ne);const Ae=[...new Set(Ne.map(Pe=>Pe.group_name||"General"))],be={};Ae.forEach(Pe=>be[Pe]=!1),R(be)}catch(Ne){console.error("Error loading areas:",Ne),o("Error loading areas","error")}finally{g(!1)}},ae=async()=>{const Ne=await ce.getUnreadCount(l.id,"field");_(Ne)},k=async(Ne,Ae)=>{const be=m.find(Ve=>Ve.id===Ne);if(!be)return;const Pe=be.status===Ae?"not_started":Ae;v(Ne);try{await ce.updateAreaStatus(Ne,Pe),u(Ve=>Ve.map(Te=>Te.id===Ne?{...Te,status:Pe}:Te)),o("Updated","success")}catch(Ve){console.error("Error updating status:",Ve),o("Error updating","error")}finally{v(null)}},M=Ne=>{R(Ae=>({...Ae,[Ne]:!Ae[Ne]}))};if(x)return e.jsx("div",{className:"foreman-container",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading..."]})});if(X)return e.jsx("div",{className:"foreman-container",children:e.jsx(fv,{project:l,companyId:r,onSubmit:()=>B(!1),onCancel:()=>B(!1),onShowToast:o})});if(q)return e.jsx(gv,{project:l,onShowToast:o,onClose:()=>ee(!1)});if(T)return e.jsx(xv,{project:l,viewerType:"field",viewerName:"Field",onShowToast:o,onClose:()=>{D(!1),ae()}});if(w)return e.jsx(jv,{project:l,requestedBy:"Field",onShowToast:o,onClose:()=>se(!1)});if(ne)return e.jsx("div",{className:"foreman-container",children:e.jsx(tp,{project:l,companyId:r,onClose:()=>P(!1),onReportCreated:()=>{P(!1),o("Injury report submitted","success")}})});if(I)return e.jsx("div",{className:"foreman-container",children:e.jsx(yv,{project:l,companyId:r,onClose:()=>F(!1),onSubmit:()=>F(!1),onShowToast:o})});const C=ov(m),me=m.reduce((Ne,Ae)=>{const be=Ae.group_name||"General";return Ne[be]||(Ne[be]=[]),Ne[be].push(Ae),Ne},{}),Q=Object.keys(me).length>1||Object.keys(me).length===1&&!me.General,O=Ne=>`${Ne.filter(be=>be.status==="done").length}/${Ne.length}`,$=m.filter(Ne=>Ne.status==="done").length,H=m.filter(Ne=>Ne.status==="working").length,ve=m.length-$;return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsxs("div",{className:"foreman-header-info",children:[e.jsx("div",{className:"foreman-project-name",children:l.name}),e.jsxs("div",{className:"foreman-progress",children:[C,"% Complete"]})]}),e.jsx("button",{className:"foreman-info-btn",onClick:()=>Z(!J),children:e.jsx(ud,{size:20})})]}),J&&e.jsxs("div",{className:"foreman-project-info",children:[l.job_number&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Job #"}),e.jsx("span",{className:"foreman-info-value",children:l.job_number})]}),l.address&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Address"}),e.jsx("span",{className:"foreman-info-value",children:l.address})]}),l.general_contractor&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"GC / Client"}),e.jsx("span",{className:"foreman-info-value",children:l.general_contractor})]}),l.client_contact&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Contact"}),e.jsx("span",{className:"foreman-info-value",children:l.client_contact})]}),l.client_phone&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Phone"}),e.jsx("a",{href:`tel:${l.client_phone}`,className:"foreman-info-value foreman-info-link",children:l.client_phone})]})]}),e.jsxs("div",{className:"foreman-stats",children:[e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value working",children:H}),e.jsx("div",{className:"foreman-stat-label",children:"Working"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value done",children:$}),e.jsx("div",{className:"foreman-stat-label",children:"Done"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value remaining",children:ve}),e.jsx("div",{className:"foreman-stat-label",children:"Remaining"})]})]}),e.jsxs("div",{className:"field-actions",children:[e.jsxs("button",{className:"field-action-btn",onClick:()=>B(!0),children:[e.jsx(Ua,{size:20,className:"icon"}),"T&M Ticket"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>D(!0),children:[e.jsx(ys,{size:20,className:"icon"}),"Messages",j>0&&e.jsx("span",{className:"badge",children:j})]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>se(!0),children:[e.jsx(Wa,{size:20,className:"icon"}),"Materials"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>ee(!0),children:[e.jsx(Oa,{size:20,className:"icon"}),"Daily Report"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>F(!0),children:[e.jsx(wn,{size:20,className:"icon"}),"Haul-Off"]}),e.jsxs("button",{className:"field-action-btn danger",onClick:()=>P(!0),children:[e.jsx(zi,{size:20,className:"icon"}),"Report Injury"]})]}),e.jsx(pv,{project:l,onShowToast:o}),e.jsx("div",{className:"foreman-areas",children:Q?Object.entries(me).map(([Ne,Ae])=>e.jsxs("div",{className:"foreman-group",children:[e.jsxs("div",{className:"foreman-group-header",onClick:()=>M(Ne),children:[e.jsxs("div",{className:"foreman-group-title",children:[e.jsx("span",{className:"foreman-group-arrow",children:y[Ne]?"":""}),e.jsx("span",{className:"foreman-group-name",children:Ne})]}),e.jsx("span",{className:"foreman-group-progress",children:O(Ae)})]}),y[Ne]&&e.jsx("div",{className:"foreman-group-tasks",children:Ae.map(be=>e.jsxs("div",{className:`foreman-area-card ${be.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:be.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${be.status==="working"?"active":""}`,onClick:()=>k(be.id,"working"),disabled:f===be.id,children:f===be.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${be.status==="done"?"active":""}`,onClick:()=>k(be.id,"done"),disabled:f===be.id,children:f===be.id?"...":"Done"})]})]},be.id))})]},Ne)):m.map(Ne=>e.jsxs("div",{className:`foreman-area-card ${Ne.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:Ne.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${Ne.status==="working"?"active":""}`,onClick:()=>k(Ne.id,"working"),disabled:f===Ne.id,children:f===Ne.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${Ne.status==="done"?"active":""}`,onClick:()=>k(Ne.id,"done"),disabled:f===Ne.id,children:f===Ne.id?"...":"Done"})]})]},Ne.id))}),m.length===0&&e.jsxs("div",{className:"foreman-empty",children:[e.jsx(Oa,{size:48,className:"foreman-empty-icon"}),e.jsx("div",{className:"foreman-empty-text",children:"No areas yet"}),e.jsx("div",{className:"foreman-empty-subtext",children:"Office needs to add areas to this project"})]})]})}const bf=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";function ap({documentType:l,documentId:r,companyId:o,projectId:c,documentTitle:m="",onClose:u,onShowToast:x}){const[g,f]=p.useState(!0),[v,y]=p.useState(!1),[R,X]=p.useState([]),[B,V]=p.useState(null),[L,q]=p.useState(!1),[ee,T]=p.useState("never");p.useEffect(()=>{D()},[l,r]);const D=async()=>{try{f(!0);const F=await ce.getSignatureRequestsForDocument(l,r);X(F||[])}catch(F){console.error("Error loading signature requests:",F)}finally{f(!1)}},w=async()=>{try{y(!0);let F=null;if(ee!=="never"){const Z=parseInt(ee);F=new Date,F.setDate(F.getDate()+Z),F=F.toISOString()}const J=await ce.createSignatureRequest(l,r,o,c,null,F);if(J){const Z=`${window.location.origin}/sign/${J.signature_token}`;V(Z),await D(),x?.("Signature link created","success")}}catch(F){console.error("Error generating signature link:",F),x?.("Failed to create signature link","error")}finally{y(!1)}},se=async F=>{try{await navigator.clipboard.writeText(F),q(!0),x?.("Link copied to clipboard","success"),setTimeout(()=>q(!1),2e3)}catch(J){console.error("Error copying to clipboard:",J)}},ne=async F=>{if(confirm("Are you sure you want to revoke this signature link? It will no longer be usable."))try{await ce.revokeSignatureRequest(F),await D(),x?.("Signature link revoked","success")}catch(J){console.error("Error revoking signature request:",J),x?.("Failed to revoke link","error")}},P=F=>{switch(F){case"pending":return{label:"Awaiting Signatures",color:"#f59e0b",bg:"#fef3c7"};case"partially_signed":return{label:"1 of 2 Signed",color:"#3b82f6",bg:"#dbeafe"};case"completed":return{label:"Fully Signed",color:"#10b981",bg:"#d1fae5"};case"revoked":return{label:"Revoked",color:"#ef4444",bg:"#fee2e2"};case"expired":return{label:"Expired",color:"#6b7280",bg:"#f3f4f6"};default:return{label:F,color:"#6b7280",bg:"#f3f4f6"}}},I=l==="cor"?"Change Order":"T&M Ticket";return e.jsx("div",{className:"modal-overlay",onClick:u,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content signature-link-modal",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Get Signature Link"}),m&&e.jsx("span",{className:"modal-subtitle",children:m})]}),e.jsx("button",{className:"close-btn",onClick:u,"aria-label":"Close",children:e.jsx(kn,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(hd,{size:16}),"Create New Signature Link"]}),e.jsxs("p",{className:"section-description",children:["Generate a secure link that allows GC/Client to sign this ",I," without logging in."]}),e.jsxs("div",{className:"link-options",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("select",{value:ee,onChange:F=>T(F.target.value),disabled:v,children:[e.jsx("option",{value:"never",children:"Never expires"}),e.jsx("option",{value:"7",children:"7 days"}),e.jsx("option",{value:"30",children:"30 days"}),e.jsx("option",{value:"90",children:"90 days"})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:w,disabled:v,children:v?"Generating...":"Generate Link"})]}),B&&e.jsxs("div",{className:"new-link-box",children:[e.jsxs("div",{className:"link-display",children:[e.jsx("input",{type:"text",value:B,readOnly:!0,className:"link-input"}),e.jsxs("button",{className:"btn btn-secondary copy-btn",onClick:()=>se(B),children:[L?e.jsx(dr,{size:16}):e.jsx(hf,{size:16}),L?"Copied!":"Copy"]})]}),e.jsxs("a",{href:B,target:"_blank",rel:"noopener noreferrer",className:"preview-link",children:[e.jsx(ff,{size:14}),"Preview link"]})]})]}),e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(Nn,{size:16}),"Existing Signature Links"]}),g?e.jsx("div",{className:"loading-inline",children:"Loading..."}):R.length===0?e.jsxs("p",{className:"empty-state",children:["No signature links have been created for this ",I,"."]}):e.jsx("div",{className:"existing-links-list",children:R.map(F=>{const J=P(F.status),Z=`${window.location.origin}/sign/${F.signature_token}`,j=F.signatures?.length||0;return e.jsxs("div",{className:"existing-link-card",children:[e.jsxs("div",{className:"link-card-header",children:[e.jsx("span",{className:"status-badge",style:{color:J.color,backgroundColor:J.bg},children:J.label}),e.jsxs("span",{className:"link-created",children:["Created ",bf(F.created_at)]})]}),e.jsxs("div",{className:"link-card-body",children:[e.jsxs("div",{className:"link-info",children:[e.jsxs("span",{className:"link-token",children:["...",F.signature_token.slice(-8)]}),F.expires_at&&e.jsxs("span",{className:"link-expires",children:["Expires ",bf(F.expires_at)]}),e.jsxs("span",{className:"link-views",children:[F.view_count," view",F.view_count!==1?"s":""]})]}),j>0&&e.jsx("div",{className:"signatures-summary",children:F.signatures.map(_=>e.jsxs("div",{className:"sig-item",children:[e.jsx(dr,{size:12}),e.jsxs("span",{children:["Slot ",_.signature_slot,": ",_.signer_name,_.signer_company&&` (${_.signer_company})`]})]},_.id))})]}),e.jsxs("div",{className:"link-card-actions",children:[F.status!=="revoked"&&F.status!=="expired"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>se(Z),children:[e.jsx(hf,{size:14})," Copy"]}),e.jsxs("a",{href:Z,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-small",children:[e.jsx(ff,{size:14})," Open"]})]}),F.status!=="completed"&&F.status!=="revoked"&&e.jsxs("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>ne(F.id),children:[e.jsx(_s,{size:14})," Revoke"]})]})]},F.id)})})]}),e.jsxs("div",{className:"signature-info-box",children:[e.jsx(ml,{size:16}),e.jsxs("div",{children:[e.jsx("strong",{children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Share the link with your GC or Client"}),e.jsx("li",{children:"They can view the document and sign without logging in"}),e.jsx("li",{children:"Supports 2 signatures (GC + Client)"}),e.jsx("li",{children:"Signatures are recorded with name, title, company, date, and IP"})]})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:u,children:"Close"})})]})})}const _f=l=>{const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return r?[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]:[30,41,59]},_v=l=>new Promise(r=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),r(c.toDataURL("image/png"))},o.onerror=()=>r(null),o.src=l});function Nv({project:l,company:r,onShowToast:o}){const{branding:c}=ul(),[m,u]=p.useState([]),[x,g]=p.useState(!0),[f,v]=p.useState("all"),[y,R]=p.useState(null),[X,B]=p.useState(new Set),[V,L]=p.useState("recent"),[q,ee]=p.useState(new Set),[T,D]=p.useState({start:"",end:""}),[w,se]=p.useState(!1),[ne,P]=p.useState(null),[I,F]=p.useState(""),[J,Z]=p.useState(!1),[j,_]=p.useState(null),[S,ae]=p.useState({});p.useEffect(()=>{k();const A=ce.subscribeToTMTickets?.(l.id,()=>{k()});return()=>{A&&ce.unsubscribe?.(A)}},[l.id]);const k=async()=>{try{const A=await ce.getTMTickets(l.id);u(A);const E=A.filter(fe=>fe.assigned_cor_id);if(E.length>0){const fe={};await Promise.all(E.map(async xe=>{const G=await ce.isTicketEditable(xe);G.editable||(fe[xe.id]=G)})),ae(fe)}}catch(A){console.error("Error loading tickets:",A),o("Error loading T&M tickets","error")}finally{g(!1)}},M=async(A,E)=>{if(S[A]){o(S[A].reason||"This ticket is locked (COR approved)","error");return}try{await ce.updateTMTicketStatus(A,E),u(m.map(fe=>fe.id===A?{...fe,status:E}:fe)),o(`Ticket ${E}`,"success")}catch(fe){console.error("Error updating status:",fe),o("Error updating status","error")}},C=A=>{if(S[A.id]){o(S[A.id].reason||"This ticket is locked (COR approved)","error");return}M(A.id,"approved")},me=async()=>{if(ne)try{const A=parseFloat(I)||0;await ce.approveTMTicket(ne.id,null,null,A),u(m.map(E=>E.id===ne.id?{...E,status:"approved",change_order_value:A}:E)),o(`Ticket approved with $${A.toLocaleString()} change order`,"success"),se(!1),P(null),F("")}catch(A){console.error("Error approving ticket:",A),o("Error approving ticket","error")}},Q=async A=>{if(S[A]){o(S[A].reason||"This ticket is locked (COR approved)","error");return}if(confirm("Delete this T&M ticket?"))try{await ce.deleteTMTicket(A),u(m.filter(E=>E.id!==A)),o("Ticket deleted","success")}catch(E){console.error("Error deleting ticket:",E),o("Error deleting ticket","error")}},O=A=>{let E=0;return A.t_and_m_items&&A.t_and_m_items.forEach(fe=>{fe.materials_equipment?.cost_per_unit&&(E+=fe.quantity*fe.materials_equipment.cost_per_unit)}),E},$=A=>A.t_and_m_workers?A.t_and_m_workers.reduce((E,fe)=>{const xe=parseFloat(fe.hours)||0,G=parseFloat(fe.overtime_hours)||0;return E+xe+G},0):0,H=A=>new Date(A).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),ve=(A,E)=>{E.stopPropagation(),B(fe=>{const xe=new Set(fe);return xe.has(A)?xe.delete(A):xe.add(A),xe})},Ne=()=>{const A=f==="all"?m:m.filter(fe=>fe.status===f),E=A.every(fe=>X.has(fe.id));B(E?new Set:new Set(A.map(fe=>fe.id)))},Ae=()=>{B(new Set)},be=()=>{const A=f==="all"?m:m.filter(E=>E.status===f);return X.size>0?A.filter(E=>X.has(E.id)):A},Pe=()=>{const A=be();if(A.length===0){o("No tickets to export","error");return}const E=[],fe=[],xe=[];A.forEach(qe=>{const We=H(qe.work_date),wt=qe.status;qe.t_and_m_workers&&qe.t_and_m_workers.forEach(Ie=>{const kt=parseFloat(Ie.hours)||0,Ft=parseFloat(Ie.overtime_hours)||0;E.push({Date:We,Status:wt,"Worker Name":Ie.name,Role:Ie.role||"Laborer","Regular Hours":kt,"OT Hours":Ft,"Total Hours":kt+Ft})}),qe.t_and_m_items&&qe.t_and_m_items.forEach(Ie=>{const kt=Ie.custom_name||Ie.materials_equipment?.name||"Unknown",Ft=Ie.custom_category||Ie.materials_equipment?.category||"Unknown",Ot=Ie.materials_equipment?.unit||"each",Ut=Ie.materials_equipment?.cost_per_unit||0,ut=Ie.quantity*Ut;fe.push({Date:We,Status:wt,Category:Ft,Item:kt,Quantity:Ie.quantity,Unit:Ot,"Cost/Unit":Ut,Total:ut})}),xe.push({Date:We,Status:wt,Workers:qe.t_and_m_workers?.length||0,"Total Hours":$(qe),Items:qe.t_and_m_items?.length||0,"Materials Cost":O(qe),Notes:qe.notes||""})});const G=Is.book_new(),_e=Is.json_to_sheet(xe);if(Is.book_append_sheet(G,_e,"Summary"),E.length>0){const qe=Is.json_to_sheet(E);Is.book_append_sheet(G,qe,"Workers")}if(fe.length>0){const qe=Is.json_to_sheet(fe);Is.book_append_sheet(G,qe,"Materials & Equipment")}const Ye=`${l.name}_TM_${new Date().toISOString().split("T")[0]}.xlsx`;fx(G,Ye),o("Export downloaded!","success")},Ve=async()=>{const A=be();if(A.length===0){o("No tickets to export","error");return}o("Generating PDF...","info");const E=new Ri,fe=E.internal.pageSize.getWidth(),xe=E.internal.pageSize.getHeight(),G=20;let _e=G;const Ye=_f(c?.primary_color||"#3B82F6"),qe=_f(c?.secondary_color||"#1E40AF");E.setFillColor(...Ye),E.rect(0,0,fe,45,"F"),E.setFillColor(...qe),E.rect(0,42,fe,3,"F");let We=G;if(c?.logo_url)try{const Ee=await _v(c.logo_url);Ee&&(E.addImage(Ee,"PNG",G,7,30,30),We=G+30+10)}catch(Ee){console.error("Error adding logo:",Ee)}E.setTextColor(255,255,255),E.setFontSize(22),E.setFont("helvetica","bold"),E.text(r?.name||"Company Name",We,20),E.setFontSize(10),E.setFont("helvetica","normal"),E.text("TIME & MATERIALS REPORT",We,30),E.setFontSize(9),E.text(`Report Date: ${new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,fe-G,18,{align:"right"}),l.job_number&&E.text(`Job #: ${l.job_number}`,fe-G,26,{align:"right"}),E.text(`Status: ${f.charAt(0).toUpperCase()+f.slice(1)}`,fe-G,34,{align:"right"}),_e=55,E.setFillColor(248,250,252),E.rect(G,_e-5,fe-G*2,30,"F"),E.setDrawColor(...Ye),E.setLineWidth(.5),E.rect(G,_e-5,fe-G*2,30,"S"),E.setTextColor(...Ye),E.setFontSize(14),E.setFont("helvetica","bold"),E.text(`Project: ${l.name}`,G+5,_e+7),E.setFontSize(10),E.setFont("helvetica","normal"),E.setTextColor(51,65,85);const wt=A.map(Ee=>new Date(Ee.work_date)).sort((Ee,De)=>Ee-De),Ie=wt[0]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),kt=wt[wt.length-1]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});E.text(`Date Range: ${Ie} - ${kt}`,G+5,_e+17),E.text(`Total Tickets: ${A.length}`,fe-G-5,_e+7,{align:"right"}),_e+=40;const Ft=A.reduce((Ee,De)=>Ee+$(De),0),Ot=A.reduce((Ee,De)=>Ee+O(De),0),Ut=new Set(A.flatMap(Ee=>Ee.t_and_m_workers?.map(De=>De.name)||[])).size;E.setTextColor(...Ye),E.setFontSize(12),E.setFont("helvetica","bold"),E.text("SUMMARY",G,_e),_e+=8;const ut=(fe-G*2-20)/3,Rt=[{label:"Total Labor Hours",value:Ft.toFixed(1)},{label:"Unique Workers",value:Ut.toString()},{label:"Materials Cost",value:`$${Ot.toFixed(2)}`}],_t=Ye.map(Ee=>Math.min(255,Ee+180));Rt.forEach((Ee,De)=>{const Be=G+De*(ut+10);E.setFillColor(..._t),E.rect(Be,_e,ut,25,"F"),E.setDrawColor(...Ye),E.setLineWidth(.5),E.rect(Be,_e,ut,25,"S"),E.setTextColor(...Ye),E.setFontSize(16),E.setFont("helvetica","bold"),E.text(Ee.value,Be+ut/2,_e+12,{align:"center"}),E.setTextColor(100,116,139),E.setFontSize(8),E.setFont("helvetica","normal"),E.text(Ee.label,Be+ut/2,_e+20,{align:"center"})}),_e+=35;const le=[],Se=[],ue=[];let Xe=0,St=0,Et=0,ct=0,It=0,Jt=0;A.forEach(Ee=>{Ee.t_and_m_workers&&Ee.t_and_m_workers.forEach(De=>{const Be=parseFloat(De.hours)||0,Fe=parseFloat(De.overtime_hours)||0,pt=De.role||"Laborer",zt=[H(Ee.work_date),De.name,Be.toString(),Fe>0?Fe.toString():"-",(Be+Fe).toString()];pt==="Foreman"||pt==="Superintendent"?(le.push(zt),Xe+=Be,St+=Fe):pt==="Operator"?(Se.push(zt),Et+=Be,ct+=Fe):(ue.push(zt),It+=Be,Jt+=Fe)})});const ta=(Ee,De,Be,Fe)=>{De.length!==0&&(_e>xe-80&&(E.addPage(),_e=G),E.setTextColor(...Ye),E.setFontSize(11),E.setFont("helvetica","bold"),E.text(Ee,G,_e),_e+=5,Ks(E,{startY:_e,head:[["Date","Name","Reg Hrs","OT Hrs","Total"]],body:De,margin:{left:G,right:G},headStyles:{fillColor:Ye,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:30},2:{halign:"center",cellWidth:22},3:{halign:"center",cellWidth:22},4:{halign:"center",cellWidth:22}},foot:[["","SUBTOTAL:",Be.toString(),Fe>0?Fe.toString():"-",(Be+Fe).toString()]],footStyles:{fillColor:qe,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),_e=E.lastAutoTable.finalY+10)};if(le.length>0||Se.length>0||ue.length>0){E.setTextColor(...Ye),E.setFontSize(12),E.setFont("helvetica","bold"),E.text("LABOR",G,_e),_e+=8,ta("SUPERVISION",le,Xe,St),ta("OPERATORS",Se,Et,ct),ta("LABORERS",ue,It,Jt);const Ee=Xe+Et+It,De=St+ct+Jt;E.setFillColor(...Ye),E.rect(G,_e,fe-G*2,12,"F"),E.setTextColor(255,255,255),E.setFontSize(10),E.setFont("helvetica","bold"),E.text("LABOR TOTAL:",G+5,_e+8),E.text(`${Ee} Reg + ${De} OT = ${Ee+De} Hours`,fe-G-5,_e+8,{align:"right"}),_e+=20}_e>xe-100&&(E.addPage(),_e=G);const N={},pe={},W=["Containment","PPE","Disposal","Equipment","Other"];A.forEach(Ee=>{Ee.t_and_m_items&&Ee.t_and_m_items.forEach(De=>{const Be=De.custom_name||De.materials_equipment?.name||"Unknown",Fe=De.custom_category||De.materials_equipment?.category||"Other",pt=De.materials_equipment?.unit||"each",zt=De.materials_equipment?.cost_per_unit||0,Me=De.quantity*zt;N[Fe]||(N[Fe]=[],pe[Fe]=0),N[Fe].push([H(Ee.work_date),Be,De.quantity.toString(),pt,`$${zt.toFixed(2)}`,`$${Me.toFixed(2)}`]),pe[Fe]+=Me})});const he=(Ee,De,Be)=>{!De||De.length===0||(_e>xe-80&&(E.addPage(),_e=G),E.setTextColor(...Ye),E.setFontSize(11),E.setFont("helvetica","bold"),E.text(Ee.toUpperCase(),G,_e),_e+=5,Ks(E,{startY:_e,head:[["Date","Item","Qty","Unit","Rate","Total"]],body:De,margin:{left:G,right:G},headStyles:{fillColor:Ye,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{2:{halign:"center",cellWidth:20},3:{halign:"center",cellWidth:25},4:{halign:"right",cellWidth:25},5:{halign:"right",cellWidth:30}},foot:[["","","","","Subtotal:",`$${Be.toFixed(2)}`]],footStyles:{fillColor:qe,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),_e=E.lastAutoTable.finalY+10)};Object.keys(N).length>0&&(E.setTextColor(...Ye),E.setFontSize(12),E.setFont("helvetica","bold"),E.text("MATERIALS & EQUIPMENT",G,_e),_e+=8,W.forEach(Ee=>{N[Ee]&&he(Ee,N[Ee],pe[Ee])}),Object.keys(N).forEach(Ee=>{W.includes(Ee)||he(Ee,N[Ee],pe[Ee])}),E.setFillColor(...Ye),E.rect(G,_e,fe-G*2,12,"F"),E.setTextColor(255,255,255),E.setFontSize(10),E.setFont("helvetica","bold"),E.text("MATERIALS TOTAL:",G+5,_e+8),E.text(`$${Ot.toFixed(2)}`,fe-G-5,_e+8,{align:"right"}),_e+=20),_e>xe-80&&(E.addPage(),_e=G),_e+=10,E.setDrawColor(...Ye),E.setLineWidth(1),E.line(G,_e,fe-G,_e),_e+=15,E.setTextColor(...Ye),E.setFontSize(12),E.setFont("helvetica","bold"),E.text("AUTHORIZATION",G,_e),_e+=10,E.setFontSize(10),E.setFont("helvetica","normal"),E.setTextColor(71,85,105),E.text("I hereby authorize the above time and materials charges as accurate and approved for billing.",G,_e),_e+=20;const ke=ticketsToExport[0]||{},Re=(Ee,De,Be,Fe,pt,zt,Me)=>{E.setFont("helvetica","bold"),E.setFontSize(8),E.setTextColor(...Ye),E.text(De,G,Ee),E.setFont("helvetica","normal"),E.setFontSize(9),E.setTextColor(100,116,139);const Ge=Ee+18;if(E.setDrawColor(...qe),E.setLineWidth(.5),E.line(G,Ge,G+70,Ge),E.text("Signature",G,Ge+8),E.line(G+85,Ge,G+145,Ge),E.text("Title / Company",G+85,Ge+8),E.line(fe-G-40,Ge,fe-G,Ge),E.text("Date",fe-G-40,Ge+8),Be)try{if(E.addImage(Be,"PNG",G,Ge-16,60,16),Fe&&(E.setFontSize(8),E.text(Fe,G,Ge+15)),pt||zt){const aa=[pt,zt].filter(Boolean).join(" - ");E.text(aa,G+85,Ge-5)}if(Me){const aa=new Date(Me).toLocaleDateString();E.text(aa,fe-G-40,Ge-5)}}catch(aa){console.error("Error adding signature to PDF:",aa)}return Ge+25};_e=Re(_e,"GC AUTHORIZATION",ke.gc_signature_data,ke.gc_signature_name,ke.gc_signature_title,ke.gc_signature_company,ke.gc_signature_date),_e+=8,_e=Re(_e,"CLIENT AUTHORIZATION",ke.client_signature_data,ke.client_signature_name,ke.client_signature_title,ke.client_signature_company,ke.client_signature_date);const et=E.internal.getNumberOfPages();for(let Ee=1;Ee<=et;Ee++){E.setPage(Ee);const De=xe-15;E.setFontSize(8),E.setTextColor(148,163,184),E.text(`${r?.name||"Company"} - T&M Report - ${l.name}`,G,De),E.text(`Page ${Ee} of ${et}`,fe-G,De,{align:"right"})}const Ze=`${l.name}_TM_Report_${new Date().toISOString().split("T")[0]}.pdf`;E.save(Ze),o("PDF exported!","success")},Te=p.useMemo(()=>{let A=f==="all"?[...m]:m.filter(E=>E.status===f);if(T.start){const E=new Date(T.start);E.setHours(0,0,0,0),A=A.filter(fe=>new Date(fe.work_date)>=E)}if(T.end){const E=new Date(T.end);E.setHours(23,59,59,999),A=A.filter(fe=>new Date(fe.work_date)<=E)}if(V==="recent"){const E=new Date;E.setDate(E.getDate()-7),E.setHours(0,0,0,0),A=A.filter(fe=>new Date(fe.work_date)>=E)}return A},[m,f,V,T]),ht=p.useMemo(()=>{if(V!=="all")return null;const A={};return Te.forEach(E=>{const fe=new Date(E.work_date),xe=`${fe.getFullYear()}-${String(fe.getMonth()+1).padStart(2,"0")}`,G=fe.toLocaleDateString("en-US",{month:"long",year:"numeric"});A[xe]||(A[xe]={label:G,tickets:[],hours:0,cost:0}),A[xe].tickets.push(E),A[xe].hours+=$(E),A[xe].cost+=O(E)}),Object.entries(A).sort((E,fe)=>fe[0].localeCompare(E[0]))},[Te,V]);p.useEffect(()=>{if(ht&&ht.length>0){const A=ht[0][0];ee(new Set([A]))}},[ht]);const Yt=A=>{const E=new Set(q);E.has(A)?E.delete(A):E.add(A),ee(E)},Tt=Te.reduce((A,E)=>A+$(E),0),ft=Te.reduce((A,E)=>A+O(E),0),At=f==="all"?m.length:m.filter(A=>A.status===f).length;if(x)return e.jsx("div",{className:"loading",children:"Loading T&M tickets..."});const lt=Te.length>0&&Te.every(A=>X.has(A.id)),Le=X.size>0,Wt=A=>{const E=!!S[A.id],fe=S[A.id];return e.jsxs("div",{className:`tm-ticket-card ${A.status} ${X.has(A.id)?"selected":""} ${E?"locked":""}`,children:[e.jsxs("div",{className:"tm-ticket-header",onClick:()=>R(y===A.id?null:A.id),children:[e.jsx("input",{type:"checkbox",checked:X.has(A.id),onChange:xe=>ve(A.id,xe),onClick:xe=>xe.stopPropagation(),className:"tm-checkbox"}),e.jsxs("div",{className:"tm-ticket-info",children:[e.jsx("span",{className:"tm-ticket-date",children:H(A.work_date)}),A.ce_pco_number&&e.jsx("span",{className:"tm-ce-badge",children:A.ce_pco_number}),A.assigned_cor_id&&fe?.lockedBy&&e.jsxs("span",{className:`tm-cor-badge ${E?"locked":""}`,title:fe.reason,children:[E&&e.jsx(gf,{size:10}),fe.lockedBy.cor_number]}),A.photos?.length>0&&e.jsxs("span",{className:"tm-photo-badge",title:`${A.photos.length} photo${A.photos.length>1?"s":""}`,children:[e.jsx(or,{size:12})," ",A.photos.length]}),e.jsx("span",{className:`tm-ticket-status ${A.status}`,children:A.status})]}),e.jsxs("div",{className:"tm-ticket-summary",children:[e.jsxs("span",{className:"tm-ticket-hours",children:[$(A)," hrs"]}),e.jsxs("span",{className:"tm-ticket-total",children:["$",O(A).toFixed(2)]}),e.jsx("span",{className:"tm-expand-arrow",children:y===A.id?"":""})]})]}),y===A.id&&e.jsxs("div",{className:"tm-ticket-details",children:[A.t_and_m_workers?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(ca,{size:16,className:"inline-icon"})," Workers"]}),e.jsx("div",{className:"tm-detail-list",children:A.t_and_m_workers.map(xe=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsxs("span",{children:[xe.role&&xe.role!=="Laborer"&&e.jsx("span",{className:"tm-role-badge",children:xe.role}),xe.name]}),e.jsxs("span",{children:[xe.hours," hrs",parseFloat(xe.overtime_hours)>0&&e.jsxs("span",{className:"tm-ot-badge",children:[" +",xe.overtime_hours," OT"]})]})]},xe.id))})]}),A.t_and_m_items?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(hr,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsx("div",{className:"tm-detail-list",children:A.t_and_m_items.map(xe=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsx("span",{children:xe.custom_name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"tm-custom-badge",children:"Custom"})," ",xe.custom_name]}):xe.materials_equipment?.name}),e.jsxs("span",{className:"tm-detail-qty",children:[xe.quantity," ",xe.materials_equipment?.unit||"each",xe.materials_equipment?.cost_per_unit>0&&e.jsxs("span",{className:"tm-item-cost",children:["$",(xe.quantity*xe.materials_equipment.cost_per_unit).toFixed(2)]})]})]},xe.id))})]}),A.notes&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Ua,{size:16,className:"inline-icon"})," Description"]}),e.jsx("p",{className:"tm-notes-text",children:A.notes})]}),A.photos&&A.photos.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(or,{size:16,className:"inline-icon"})," Photos (",A.photos.length,")"]}),e.jsx("div",{className:"tm-photos-grid",children:A.photos.map((xe,G)=>e.jsx("a",{href:xe,target:"_blank",rel:"noopener noreferrer",className:"tm-photo-thumb",children:e.jsx("img",{src:xe,alt:`Photo ${G+1}`,onError:_e=>{_e.target.onerror=null,_e.target.classList.add("photo-error"),_e.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg==",console.error("Failed to load photo:",xe)}})},G))})]}),A.ce_pco_number&&A.change_order_value>0&&e.jsxs("div",{className:"tm-change-order-value",children:[e.jsx("span",{className:"tm-co-label",children:"Change Order Value:"}),e.jsxs("span",{className:"tm-co-amount",children:["$",A.change_order_value.toLocaleString()]})]}),E&&e.jsxs("div",{className:"tm-lock-notice",children:[e.jsx(gf,{size:14}),e.jsx("span",{children:fe?.reason||"This ticket is locked (COR approved)"})]}),e.jsxs("div",{className:"tm-ticket-actions",children:[A.status==="pending"&&!E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:xe=>{xe.stopPropagation(),C(A)},children:"Approve"}),e.jsx("button",{className:"btn btn-warning btn-small",onClick:xe=>{xe.stopPropagation(),M(A.id,"rejected")},children:"Reject"})]}),A.status==="approved"&&!E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary btn-small",onClick:xe=>{xe.stopPropagation(),M(A.id,"billed")},children:"Mark Billed"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:xe=>{xe.stopPropagation(),_(A),Z(!0)},children:[e.jsx(hd,{size:14})," Signature Link"]})]}),A.status==="rejected"&&!E&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:xe=>{xe.stopPropagation(),M(A.id,"pending")},children:"Restore"}),!E&&e.jsx("button",{className:"btn btn-danger btn-small",onClick:xe=>{xe.stopPropagation(),Q(A.id)},children:"Delete"})]})]})]},A.id)};return e.jsxs("div",{className:"tm-list",children:[e.jsxs("div",{className:"tm-list-header",children:[e.jsxs("div",{className:"tm-list-title",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("div",{className:"tm-export-buttons",children:[Le&&e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:Ae,children:["Clear (",X.size,")"]}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:Pe,children:["Excel ",Le?`(${X.size})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:Ve,children:["PDF ",Le?`(${X.size})`:""]})]})]}),e.jsx("div",{className:"tm-filter-tabs",children:["all","pending","approved","billed","rejected"].map(A=>e.jsxs("button",{className:`tm-filter-tab ${f===A?"active":""}`,onClick:()=>{v(A),Ae()},children:[A.charAt(0).toUpperCase()+A.slice(1),e.jsx("span",{className:"tm-filter-count",children:A==="all"?m.length:m.filter(E=>E.status===A).length})]},A))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${V==="recent"?"active":""}`,onClick:()=>{L("recent"),D({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${V==="all"?"active":""}`,onClick:()=>L("all"),children:["All (",At,")"]})]}),V==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(ur,{size:16}),e.jsx("input",{type:"date",value:T.start,onChange:A=>D(E=>({...E,start:A.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:T.end,onChange:A=>D(E=>({...E,end:A.target.value})),placeholder:"End date"}),(T.start||T.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>D({start:"",end:""}),children:"Clear"})]})]})]}),Te.length>0&&e.jsxs("div",{className:"tm-summary-bar",children:[e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Tickets"}),e.jsx("span",{className:"tm-summary-value",children:Te.length})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Total Hours"}),e.jsx("span",{className:"tm-summary-value",children:Tt.toFixed(1)})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Materials Cost"}),e.jsxs("span",{className:"tm-summary-value",children:["$",ft.toFixed(2)]})]})]}),Te.length===0?e.jsxs("div",{className:"tm-empty-state",children:[e.jsxs("p",{children:["No ",f==="all"?"":f," T&M tickets",V==="recent"?" in the last 7 days":""]}),V==="recent"&&At>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>L("all"),children:"View All Tickets"})]}):e.jsxs("div",{className:"tm-tickets",children:[e.jsx("div",{className:"tm-select-all-row",children:e.jsxs("label",{className:"tm-checkbox-label",onClick:Ne,children:[e.jsx("input",{type:"checkbox",checked:lt,onChange:Ne,className:"tm-checkbox"}),e.jsxs("span",{children:["Select All (",Te.length,")"]})]})}),V==="all"&&ht?ht.map(([A,E])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>Yt(A),children:[e.jsxs("div",{className:"month-header-left",children:[q.has(A)?e.jsx(tn,{size:18}):e.jsx(Cn,{size:18}),e.jsx("span",{className:"month-label",children:E.label}),e.jsxs("span",{className:"month-count",children:[E.tickets.length," tickets"]})]}),e.jsxs("div",{className:"month-header-right",children:[e.jsxs("span",{className:"month-stat",children:[E.hours.toFixed(1)," hrs"]}),e.jsxs("span",{className:"month-stat",children:["$",E.cost.toFixed(2)]})]})]}),q.has(A)&&e.jsx("div",{className:"month-tickets",children:E.tickets.map(fe=>Wt(fe))})]},A)):Te.map(A=>Wt(A))]}),w&&ne&&e.jsx("div",{className:"modal-overlay",onClick:()=>se(!1),children:e.jsxs("div",{className:"modal change-order-modal",onClick:A=>A.stopPropagation(),children:[e.jsx("h3",{children:"Approve Change Order Work"}),e.jsxs("p",{className:"modal-subtitle",children:["This T&M ticket is associated with ",e.jsx("strong",{children:ne.ce_pco_number})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Change Order Value ($)"}),e.jsx("input",{type:"number",value:I,onChange:A=>F(A.target.value),placeholder:"Enter the change order amount",autoFocus:!0}),e.jsx("p",{className:"form-help",children:"This amount will be added to the project's total contract value."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>se(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:me,children:["Approve with $",parseFloat(I||0).toLocaleString()]})]})]})}),J&&j&&e.jsx(ap,{documentType:"tm_ticket",documentId:j.id,companyId:r?.id,projectId:l?.id,documentTitle:`T&M Ticket - ${new Date(j.work_date).toLocaleDateString()}${j.ce_pco_number?` (${j.ce_pco_number})`:""}`,onClose:()=>{Z(!1),_(null)},onShowToast:o})]})}function Sv({project:l,onClose:r,onShareCreated:o}){const{user:c}=ep(),[m,u]=p.useState(!1),[x,g]=p.useState(null),[f,v]=p.useState([]),[y,R]=p.useState(!1),[X,B]=p.useState({progress:!0,photos:!0,daily_reports:!0,tm_tickets:!1,crew_info:!1}),[V,L]=p.useState("never"),[q,ee]=p.useState("");p.useEffect(()=>{T()},[l.id]);const T=async()=>{try{const j=await ce.getProjectShares(l.id);v(j)}catch(j){console.error("Error loading shares:",j)}},D=j=>{B(_=>({..._,[j]:!_[j]}))},w=()=>{if(V==="never")return null;const j=new Date;if(V==="30days")j.setDate(j.getDate()+30);else if(V==="90days")j.setDate(j.getDate()+90);else if(V==="custom"&&q)return new Date(q).toISOString();return j.toISOString()},se=async()=>{u(!0);try{const j=w(),_=await ce.createProjectShare(l.id,c.id,X,j);g({type:"success",message:"Share link created!"}),R(!1),T(),o&&o(_)}catch(j){console.error("Error creating share:",j),g({type:"error",message:"Failed to create share link"})}finally{u(!1)}},ne=j=>{const _=`${window.location.origin}/view/${j}`;navigator.clipboard.writeText(_),g({type:"success",message:"Link copied to clipboard!"})},P=async j=>{if(confirm("Are you sure you want to revoke this share link?"))try{await ce.revokeProjectShare(j),g({type:"success",message:"Share link revoked"}),T()}catch(_){console.error("Error revoking share:",_),g({type:"error",message:"Failed to revoke share link"})}},I=async j=>{if(confirm("Are you sure you want to permanently delete this share link?"))try{await ce.deleteProjectShare(j),g({type:"success",message:"Share link deleted"}),T()}catch(_){console.error("Error deleting share:",_),g({type:"error",message:"Failed to delete share link"})}},F=j=>j?new Date(j).toLocaleDateString():"Never",J=j=>j?new Date(j)<new Date:!1,Z=j=>{const _=[];return j.progress&&_.push("Progress"),j.photos&&_.push("Photos"),j.daily_reports&&_.push("Reports"),j.tm_tickets&&_.push("T&M"),j.crew_info&&_.push("Crew"),_.join(", ")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:r,children:e.jsxs("div",{className:"modal-content share-modal",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Share Project: ",l.name]}),e.jsx("button",{className:"close-btn",onClick:r,children:""})]}),e.jsxs("div",{className:"modal-body",children:[f.length>0&&e.jsxs("div",{className:"existing-shares",children:[e.jsx("h3",{children:"Active Share Links"}),e.jsx("div",{className:"shares-list",children:f.map(j=>e.jsxs("div",{className:`share-item ${!j.is_active||J(j.expires_at)?"inactive":""}`,children:[e.jsxs("div",{className:"share-info",children:[e.jsxs("div",{className:"share-token",children:[e.jsxs("code",{children:[window.location.origin,"/view/",j.share_token]}),e.jsx("button",{className:"btn-small",onClick:()=>ne(j.share_token),disabled:!j.is_active||J(j.expires_at),children:"Copy"})]}),e.jsxs("div",{className:"share-meta",children:[e.jsx("span",{className:"permissions",children:Z(j.permissions)}),e.jsxs("span",{className:"expiry",children:["Expires: ",F(j.expires_at)]}),e.jsxs("span",{className:"views",children:["Views: ",j.view_count||0,j.last_viewed_at&&` (Last: ${F(j.last_viewed_at)})`]})]}),!j.is_active&&e.jsx("div",{className:"status-badge revoked",children:"Revoked"}),J(j.expires_at)&&j.is_active&&e.jsx("div",{className:"status-badge expired",children:"Expired"})]}),e.jsxs("div",{className:"share-actions",children:[j.is_active&&!J(j.expires_at)&&e.jsx("button",{className:"btn-secondary",onClick:()=>P(j.id),children:"Revoke"}),e.jsx("button",{className:"btn-danger",onClick:()=>I(j.id),children:"Delete"})]})]},j.id))})]}),!y&&e.jsx("button",{className:"btn-primary",onClick:()=>R(!0),children:"+ Create New Share Link"}),y&&e.jsxs("div",{className:"new-share-form",children:[e.jsx("h3",{children:"Create New Share Link"}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Permissions"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:X.progress,onChange:()=>D("progress")}),"Progress/completion status"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:X.photos,onChange:()=>D("photos")}),"Photos feed"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:X.daily_reports,onChange:()=>D("daily_reports")}),"Daily reports"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:X.tm_tickets,onChange:()=>D("tm_tickets")}),"T&M tickets"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:X.crew_info,onChange:()=>D("crew_info")}),"Crew information"]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"never",checked:V==="never",onChange:j=>L(j.target.value)}),"Never expires"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"30days",checked:V==="30days",onChange:j=>L(j.target.value)}),"30 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"90days",checked:V==="90days",onChange:j=>L(j.target.value)}),"90 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"custom",checked:V==="custom",onChange:j=>L(j.target.value)}),"Custom date"]})]}),V==="custom"&&e.jsx("input",{type:"date",value:q,onChange:j=>ee(j.target.value),min:new Date().toISOString().split("T")[0],className:"date-input"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>R(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:se,disabled:m,children:m?"Generating...":"Generate Share Link"})]})]})]})]})}),x&&e.jsx(en,{message:x.message,type:x.type,onClose:()=>g(null)}),e.jsx("style",{children:`
        .share-modal {
          max-width: 700px;
          max-height: 80vh;
          overflow-y: auto;
        }

        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1.5rem;
          border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .close-btn {
          background: none;
          border: none;
          font-size: 2rem;
          cursor: pointer;
          color: var(--text-secondary);
          padding: 0;
          width: 2rem;
          height: 2rem;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .close-btn:hover {
          color: var(--text-primary);
        }

        .modal-body {
          padding: 1.5rem;
        }

        .existing-shares {
          margin-bottom: 2rem;
        }

        .existing-shares h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .shares-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .share-item {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          gap: 1rem;
          background: var(--bg-card);
        }

        .share-item.inactive {
          opacity: 0.6;
          background-color: var(--bg-elevated);
        }

        .share-info {
          flex: 1;
        }

        .share-token {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-bottom: 0.5rem;
        }

        .share-token code {
          background-color: var(--bg-elevated);
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.875rem;
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          color: var(--text-primary);
        }

        .share-meta {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .status-badge {
          display: inline-block;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 500;
          margin-top: 0.5rem;
        }

        .status-badge.revoked {
          background-color: #fee2e2;
          color: #991b1b;
        }

        .status-badge.expired {
          background-color: #fef3c7;
          color: #92400e;
        }

        .share-actions {
          display: flex;
          gap: 0.5rem;
          flex-shrink: 0;
        }

        .new-share-form {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          background-color: var(--bg-elevated);
        }

        .new-share-form h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .form-section {
          margin-bottom: 1.5rem;
        }

        .form-section label {
          display: block;
          font-weight: 500;
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .checkbox-group,
        .radio-group {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .checkbox-group label,
        .radio-group label {
          font-weight: normal;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .checkbox-group input[type="checkbox"],
        .radio-group input[type="radio"] {
          margin: 0;
        }

        .date-input {
          margin-top: 0.5rem;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          width: 100%;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-actions {
          display: flex;
          justify-content: flex-end;
          gap: 0.5rem;
          margin-top: 1.5rem;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
          border: 1px solid var(--border-color);
          background-color: var(--bg-card);
          color: var(--text-primary);
          border-radius: 4px;
          cursor: pointer;
        }

        .btn-small:hover:not(:disabled) {
          background-color: var(--bg-elevated);
        }

        .btn-small:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }
      `})]})}const Ko=l=>{const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return r?[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]:[30,41,59]},Cv=l=>new Promise(r=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),r(c.toDataURL("image/png"))},o.onerror=()=>r(null),o.src=l});function wv({project:l,companyId:r,company:o,onShowToast:c}){const{branding:m}=ul(),[u,x]=p.useState([]),[g,f]=p.useState(null),[v,y]=p.useState(!1),[R,X]=p.useState(!0),[B,V]=p.useState(null),[L,q]=p.useState("recent"),[ee,T]=p.useState(new Set),[D,w]=p.useState({start:"",end:""});p.useEffect(()=>{se();const C=r||l?.company_id,me=C?ce.subscribeToInjuryReports?.(C,()=>{se()}):null;return()=>{me&&ce.unsubscribe?.(me)}},[l?.id,r]);const se=async()=>{X(!0);try{const C=l?await ce.getInjuryReports(l.id):await ce.getCompanyInjuryReports(r);x(C)}catch(C){console.error("Error loading injury reports:",C),V({type:"error",message:"Failed to load injury reports"})}finally{X(!1)}},ne=()=>{se(),y(!1),V({type:"success",message:"Injury report created successfully"})},P=C=>{f(C)},I=()=>{f(null)},F=C=>C?new Date(C).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",J=C=>C?new Date(`2000-01-01T${C}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",Z=C=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[C]||C,j=C=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[C]||"#9ca3af",_=C=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[C]||"#9ca3af",S=p.useMemo(()=>{let C=[...u];if(D.start){const me=new Date(D.start);me.setHours(0,0,0,0),C=C.filter(Q=>new Date(Q.incident_date)>=me)}if(D.end){const me=new Date(D.end);me.setHours(23,59,59,999),C=C.filter(Q=>new Date(Q.incident_date)<=me)}if(L==="recent"){const me=new Date;me.setDate(me.getDate()-7),me.setHours(0,0,0,0),C=C.filter(Q=>new Date(Q.incident_date)>=me)}return C},[u,L,D]),ae=p.useMemo(()=>{if(L!=="all")return null;const C={};return S.forEach(me=>{const Q=new Date(me.incident_date),O=`${Q.getFullYear()}-${String(Q.getMonth()+1).padStart(2,"0")}`,$=Q.toLocaleDateString("en-US",{month:"long",year:"numeric"});C[O]||(C[O]={label:$,reports:[]}),C[O].reports.push(me)}),Object.entries(C).sort((me,Q)=>Q[0].localeCompare(me[0]))},[S,L]);p.useEffect(()=>{if(ae&&ae.length>0){const C=ae[0][0];T(new Set([C]))}},[ae]);const k=C=>{const me=new Set(ee);me.has(C)?me.delete(C):me.add(C),T(me)},M=async()=>{if(u.length===0){V({type:"error",message:"No reports to export"});return}V({type:"info",message:"Generating PDF..."});const C=new Ri,me=C.internal.pageSize.getWidth(),Q=20;let O=Q;const $=Ko(m?.primary_color||"#3B82F6"),H=Ko(m?.secondary_color||"#1E40AF");C.setFillColor(...$),C.rect(0,0,me,45,"F"),C.setFillColor(...H),C.rect(0,42,me,3,"F");let ve=Q;if(m?.logo_url)try{const be=await Cv(m.logo_url);be&&(C.addImage(be,"PNG",Q,7,30,30),ve=Q+40)}catch(be){console.error("Error adding logo:",be)}C.setTextColor(255,255,255),C.setFontSize(22),C.setFont("helvetica","bold"),C.text(o?.name||"Company",ve,20),C.setFontSize(10),C.setFont("helvetica","normal"),C.text("INJURY & INCIDENT REPORTS",ve,30),C.setFontSize(9),C.text(`Generated: ${new Date().toLocaleDateString()}`,me-Q,20,{align:"right"}),C.text(`Total Reports: ${u.length}`,me-Q,28,{align:"right"}),O=55,l&&(C.setFillColor(248,250,252),C.rect(Q,O-5,me-Q*2,15,"F"),C.setTextColor(...$),C.setFontSize(12),C.setFont("helvetica","bold"),C.text(`Project: ${l.name}`,Q+5,O+5),O+=20),u.forEach(be=>{O>200&&(C.addPage(),O=Q);const Pe=Ko(_(be.injury_type));C.setFillColor(...Pe),C.rect(Q,O,me-Q*2,12,"F"),C.setTextColor(255,255,255),C.setFontSize(11),C.setFont("helvetica","bold"),C.text(`${be.employee_name} - ${Z(be.injury_type)}`,Q+5,O+8),C.text(F(be.incident_date),me-Q-5,O+8,{align:"right"}),O+=17,C.setTextColor(50,50,50),C.setFontSize(9),C.setFont("helvetica","normal"),C.text(`Location: ${be.incident_location}`,Q+5,O),be.incident_time&&C.text(`Time: ${J(be.incident_time)}`,Q+100,O),O+=6,C.setFont("helvetica","bold"),C.text("Description:",Q+5,O),C.setFont("helvetica","normal"),O+=5;const Ve=C.splitTextToSize(be.incident_description,me-Q*2-10);C.text(Ve,Q+5,O),O+=Ve.length*4+3;const Te=[];be.body_part_affected&&Te.push(`Body Part: ${be.body_part_affected}`),be.osha_recordable&&Te.push("OSHA Recordable"),be.workers_comp_claim&&Te.push("Workers' Comp Filed"),be.medical_treatment_required&&Te.push("Medical Treatment Required"),Te.length>0&&(C.setFontSize(8),C.setTextColor(100,100,100),C.text(Te.join("  |  "),Q+5,O),O+=5),C.setFontSize(8),C.text(`Reported by: ${be.reported_by_name} (${be.reported_by_title})`,Q+5,O),O+=12});const Ne=C.internal.getNumberOfPages();for(let be=1;be<=Ne;be++)C.setPage(be),C.setFontSize(8),C.setTextColor(150,150,150),C.text(`Page ${be} of ${Ne}`,me/2,C.internal.pageSize.getHeight()-10,{align:"center"}),C.text("CONFIDENTIAL - Injury Report",Q,C.internal.pageSize.getHeight()-10);const Ae=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;C.save(Ae),V({type:"success",message:"PDF exported!"})};return R?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[u.length>0&&e.jsx("button",{className:"btn-secondary",onClick:M,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>y(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${L==="recent"?"active":""}`,onClick:()=>{q("recent"),w({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${L==="all"?"active":""}`,onClick:()=>q("all"),children:["All (",u.length,")"]})]}),L==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(ur,{size:16}),e.jsx("input",{type:"date",value:D.start,onChange:C=>w(me=>({...me,start:C.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:D.end,onChange:C=>w(me=>({...me,end:C.target.value})),placeholder:"End date"}),(D.start||D.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>w({start:"",end:""}),children:"Clear"})]})]}),S.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:""}),e.jsxs("h4",{children:["No Injury Reports",L==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),L==="recent"&&u.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>q("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:L==="all"&&ae?ae.map(([C,me])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>k(C),children:e.jsxs("div",{className:"month-header-left",children:[ee.has(C)?e.jsx(tn,{size:18}):e.jsx(Cn,{size:18}),e.jsx("span",{className:"month-label",children:me.label}),e.jsxs("span",{className:"month-count",children:[me.reports.length," reports"]})]})}),ee.has(C)&&e.jsx("div",{className:"month-reports",children:me.reports.map(Q=>e.jsxs("div",{className:"report-card",onClick:()=>P(Q),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[F(Q.incident_date)," at ",J(Q.incident_time)]}),e.jsx("div",{className:"employee-name",children:Q.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:_(Q.injury_type)},children:Z(Q.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:j(Q.status)},children:Q.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",Q.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",Q.reported_by_name," (",Q.reported_by_title,")"]}),Q.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",Q.body_part_affected]}),Q.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[Q.incident_description.substring(0,150),Q.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},Q.id))})]},C)):S.map(C=>e.jsxs("div",{className:"report-card",onClick:()=>P(C),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[F(C.incident_date)," at ",J(C.incident_time)]}),e.jsx("div",{className:"employee-name",children:C.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:_(C.injury_type)},children:Z(C.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:j(C.status)},children:C.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",C.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",C.reported_by_name," (",C.reported_by_title,")"]}),C.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",C.body_part_affected]}),C.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[C.incident_description.substring(0,150),C.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},C.id))}),g&&e.jsx("div",{className:"modal-overlay",onClick:I,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:I,children:""})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[F(g.incident_date)," at ",J(g.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:g.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:_(g.injury_type)},children:Z(g.injury_type)})})]}),g.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:g.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:g.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:g.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:g.employee_job_title})]}),g.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:g.employee_phone})]}),g.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:g.employee_email})]}),g.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:g.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:g.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:g.reported_by_title})]}),g.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:g.reported_by_phone})]}),g.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:g.reported_by_email})]})]})]}),g.witnesses&&g.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),g.witnesses.map((C,me)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:C.name}),C.phone&&e.jsxs("span",{children:["  ",C.phone]}),C.email&&e.jsxs("span",{children:["  ",C.email]})]}),C.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',C.testimony,'"']})})]},me))]}),g.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[g.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:g.medical_facility_name})]}),g.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:g.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:g.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),g.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:g.immediate_actions_taken})]}),g.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:g.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[g.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:g.safety_equipment_used})]}),g.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:g.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:g.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:g.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:g.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:g.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",F(g.created_at)]})]})]})}),v&&e.jsx(tp,{project:l,companyId:r,onClose:()=>y(!1),onReportCreated:ne}),B&&e.jsx(en,{message:B.message,type:B.type,onClose:()=>V(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const Wo=[{id:"message",label:"Messages",Icon:ys,description:"Chat messages from field"},{id:"material_request",label:"Material Requests",Icon:Wa,description:"Equipment and material requests"},{id:"injury_report",label:"Safety Reports",Icon:ml,description:"Injury and safety incident reports"},{id:"tm_ticket",label:"T&M Tickets",Icon:Oa,description:"Time and materials tickets"}];function kv({project:l,company:r,onShowToast:o,onClose:c}){const[m,u]=p.useState([]),[x,g]=p.useState({}),[f,v]=p.useState([]),[y,R]=p.useState(!0),[X,B]=p.useState(!1);p.useEffect(()=>{V()},[l?.id,r?.id]);const V=async()=>{if(!(!l?.id||!r?.id))try{R(!0);const D=await ce.getCompanyUsers(r.id);u(D);const w=await ce.getProjectNotificationPreferences(l.id),se={};w.forEach(P=>{se[P.user_id]={types:P.notification_types||[],presetId:null}}),g(se);const ne=await ce.getNotificationPresets(r.id);v(ne)}catch(D){console.error("Error loading notification settings:",D),o?.("Error loading notification settings","error")}finally{R(!1)}},L=(D,w)=>{g(se=>{const ne=se[D]||{types:[]},P=ne.types.includes(w)?ne.types.filter(I=>I!==w):[...ne.types,w];return{...se,[D]:{types:P,presetId:null}}})},q=(D,w)=>{const se=f.find(ne=>ne.id===w);se&&g(ne=>({...ne,[D]:{types:[...se.notification_types],presetId:w}}))},ee=(D,w)=>{g(se=>({...se,[D]:{types:w?Wo.map(ne=>ne.id):[],presetId:null}}))},T=async()=>{try{B(!0);const D=Object.entries(x).map(([w,se])=>({userId:w,notificationTypes:se.types}));await ce.setProjectNotificationPreferences(l.id,D),o?.("Notification settings saved","success"),c?.()}catch(D){console.error("Error saving notification settings:",D),o?.("Error saving notification settings","error")}finally{B(!1)}};return y?e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsx("button",{className:"close-btn",onClick:c,children:""})]}),e.jsx("div",{className:"loading-message",children:"Loading..."})]}):e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsxs("h3",{children:["Notification Settings for ",l?.name]}),e.jsx("button",{className:"close-btn",onClick:c,children:""})]}),e.jsx("p",{className:"settings-description",children:"Choose who receives notifications when field workers send messages, request materials, submit safety reports, or create T&M tickets for this project."}),m.length===0?e.jsxs("div",{className:"no-users-message",children:[e.jsx("p",{children:"No users found in this company."}),e.jsx("small",{children:"Users need to be added to the company to receive notifications."})]}):e.jsx("div",{className:"notification-users-list",children:m.map(D=>{const w=x[D.id]||{types:[],presetId:null},se=w.types.length===Wo.length,ne=w.types.length>0&&!se;return e.jsxs("div",{className:"notification-user-row",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:D.name?.charAt(0).toUpperCase()||D.email?.charAt(0).toUpperCase()}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:D.name||D.email}),D.role&&e.jsx("span",{className:"user-role",children:D.role})]})]}),e.jsxs("div",{className:"notification-controls",children:[e.jsxs("select",{className:"preset-select",value:w.presetId||"",onChange:P=>P.target.value&&q(D.id,P.target.value),children:[e.jsx("option",{value:"",children:"Apply preset..."}),f.map(P=>e.jsx("option",{value:P.id,children:P.name},P.id))]}),e.jsx("button",{className:`toggle-all-btn ${se?"all-on":ne?"some-on":""}`,onClick:()=>ee(D.id,!se),title:se?"Disable all":"Enable all",children:se?"All On":ne?"Some":"None"})]}),e.jsx("div",{className:"notification-types",children:Wo.map(P=>e.jsxs("label",{className:`notification-type-toggle ${w.types.includes(P.id)?"active":""}`,title:P.description,children:[e.jsx("input",{type:"checkbox",checked:w.types.includes(P.id),onChange:()=>L(D.id,P.id)}),e.jsx("span",{className:"type-icon",children:e.jsx(P.Icon,{size:16})}),e.jsx("span",{className:"type-label",children:P.label})]},P.id))})]},D.id)})}),e.jsxs("div",{className:"notification-settings-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:c,children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:T,disabled:X,children:X?"Saving...":"Save Settings"})]})]})}function Ev({project:l,company:r,onShowToast:o}){const[c,m]=p.useState([]),[u,x]=p.useState(!0),[g,f]=p.useState("all"),[v,y]=p.useState(null),[R,X]=p.useState("recent"),[B,V]=p.useState(new Set),[L,q]=p.useState({start:"",end:""});p.useEffect(()=>{ee();const _=ce.subscribeToMaterialRequests?.(l.id,()=>{ee()});return()=>{_&&ce.unsubscribe?.(_)}},[l.id]);const ee=async()=>{try{const _=await ce.getMaterialRequests(l.id);m(_||[])}catch(_){console.error("Error loading material requests:",_),o?.("Error loading material requests","error")}finally{x(!1)}},T=async(_,S)=>{try{await ce.updateMaterialRequest(_,S,"Office"),m(c.map(ae=>ae.id===_?{...ae,status:S}:ae)),o?.(`Request ${S}`,"success")}catch(ae){console.error("Error updating status:",ae),o?.("Error updating status","error")}},D=_=>new Date(_).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),w=_=>new Date(_).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),se=_=>{switch(_){case"urgent":return"priority-urgent";case"low":return"priority-low";default:return"priority-normal"}},ne=_=>{switch(_){case"urgent":return"";case"low":return"";default:return""}},P=p.useMemo(()=>{let _=g==="all"?[...c]:c.filter(S=>S.status===g);if(L.start){const S=new Date(L.start);S.setHours(0,0,0,0),_=_.filter(ae=>new Date(ae.created_at)>=S)}if(L.end){const S=new Date(L.end);S.setHours(23,59,59,999),_=_.filter(ae=>new Date(ae.created_at)<=S)}if(R==="recent"){const S=new Date;S.setDate(S.getDate()-7),S.setHours(0,0,0,0),_=_.filter(ae=>new Date(ae.created_at)>=S)}return _},[c,g,R,L]),I=p.useMemo(()=>{if(R!=="all")return null;const _={};return P.forEach(S=>{const ae=new Date(S.created_at),k=`${ae.getFullYear()}-${String(ae.getMonth()+1).padStart(2,"0")}`,M=ae.toLocaleDateString("en-US",{month:"long",year:"numeric"});_[k]||(_[k]={label:M,requests:[],itemCount:0}),_[k].requests.push(S),_[k].itemCount+=S.items?.length||0}),Object.entries(_).sort((S,ae)=>ae[0].localeCompare(S[0]))},[P,R]);p.useEffect(()=>{if(I&&I.length>0){const _=I[0][0];V(new Set([_]))}},[I]);const F=_=>{const S=new Set(B);S.has(_)?S.delete(_):S.add(_),V(S)},J={all:c.length,pending:c.filter(_=>_.status==="pending").length,ordered:c.filter(_=>_.status==="ordered").length,delivered:c.filter(_=>_.status==="delivered").length,cancelled:c.filter(_=>_.status==="cancelled").length},Z=g==="all"?c.length:c.filter(_=>_.status===g).length;if(u)return e.jsx("div",{className:"loading",children:"Loading material requests..."});const j=_=>e.jsxs("div",{className:`material-request-card ${_.status} ${_.priority==="urgent"?"urgent":""}`,children:[e.jsxs("div",{className:"material-request-header-row",onClick:()=>y(v===_.id?null:_.id),children:[e.jsxs("div",{className:"material-request-info",children:[e.jsxs("span",{className:`material-priority-badge ${se(_.priority)}`,children:[ne(_.priority)," ",_.priority]}),e.jsx("span",{className:"material-request-date",children:D(_.created_at)}),e.jsx("span",{className:"material-request-time",children:w(_.created_at)})]}),e.jsxs("div",{className:"material-request-summary",children:[e.jsxs("span",{className:"material-items-count",children:[_.items?.length||0," item",(_.items?.length||0)!==1?"s":""]}),e.jsx("span",{className:`material-status ${_.status}`,children:_.status}),e.jsx("span",{className:"material-expand-arrow",children:v===_.id?"":""})]})]}),v===_.id&&e.jsxs("div",{className:"material-request-details",children:[e.jsxs("div",{className:"material-detail-section",children:[e.jsxs("div",{className:"material-requester",children:[e.jsx("span",{className:"requester-label",children:"Requested by:"}),e.jsx("span",{className:"requester-name",children:_.requested_by||"Field"})]}),_.needed_by&&e.jsxs("div",{className:"material-needed-by",children:[e.jsx("span",{className:"needed-label",children:"Needed by:"}),e.jsx("span",{className:"needed-date",children:D(_.needed_by)})]})]}),_.items?.length>0&&e.jsxs("div",{className:"material-detail-section",children:[e.jsx("h4",{children:"Items Requested"}),e.jsx("div",{className:"material-items-list",children:_.items.map((S,ae)=>e.jsxs("div",{className:"material-item-row",children:[e.jsx("span",{className:"item-name",children:S.name}),e.jsxs("span",{className:"item-quantity",children:[S.quantity," ",S.unit]})]},ae))})]}),_.notes&&e.jsxs("div",{className:"material-detail-section",children:[e.jsx("h4",{children:"Notes"}),e.jsx("p",{className:"material-notes",children:_.notes})]}),e.jsxs("div",{className:"material-request-actions",children:[_.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:S=>{S.stopPropagation(),T(_.id,"ordered")},children:"Mark Ordered"}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:S=>{S.stopPropagation(),T(_.id,"cancelled")},children:"Cancel"})]}),_.status==="ordered"&&e.jsx("button",{className:"btn btn-success btn-small",onClick:S=>{S.stopPropagation(),T(_.id,"delivered")},children:"Mark Delivered"}),_.status==="cancelled"&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:S=>{S.stopPropagation(),T(_.id,"pending")},children:"Restore"})]})]})]},_.id);return e.jsxs("div",{className:"material-requests-list card",children:[e.jsxs("div",{className:"material-requests-header",children:[e.jsxs("div",{className:"material-requests-title",children:[e.jsx("h3",{children:"Material Requests"}),J.pending>0&&e.jsxs("span",{className:"pending-badge",children:[J.pending," pending"]})]}),e.jsx("div",{className:"material-filter-tabs",children:["all","pending","ordered","delivered","cancelled"].map(_=>e.jsxs("button",{className:`material-filter-tab ${g===_?"active":""}`,onClick:()=>f(_),children:[_.charAt(0).toUpperCase()+_.slice(1),e.jsx("span",{className:"material-filter-count",children:J[_]})]},_))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${R==="recent"?"active":""}`,onClick:()=>{X("recent"),q({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${R==="all"?"active":""}`,onClick:()=>X("all"),children:["All (",Z,")"]})]}),R==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(ur,{size:16}),e.jsx("input",{type:"date",value:L.start,onChange:_=>q(S=>({...S,start:_.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:L.end,onChange:_=>q(S=>({...S,end:_.target.value})),placeholder:"End date"}),(L.start||L.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>q({start:"",end:""}),children:"Clear"})]})]})]}),P.length===0?e.jsxs("div",{className:"material-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Wa,{size:32})}),e.jsxs("p",{children:["No ",g==="all"?"":g," material requests",R==="recent"?" in the last 7 days":""]}),R==="recent"&&Z>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>X("all"),children:"View All Requests"})]}):e.jsx("div",{className:"material-requests",children:R==="all"&&I?I.map(([_,S])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>F(_),children:[e.jsxs("div",{className:"month-header-left",children:[B.has(_)?e.jsx(tn,{size:18}):e.jsx(Cn,{size:18}),e.jsx("span",{className:"month-label",children:S.label}),e.jsxs("span",{className:"month-count",children:[S.requests.length," requests"]})]}),e.jsx("div",{className:"month-header-right",children:e.jsxs("span",{className:"month-stat",children:[S.itemCount," items"]})})]}),B.has(_)&&e.jsx("div",{className:"month-requests",children:S.requests.map(ae=>j(ae))})]},_)):P.map(_=>j(_))})]})}const Nf=l=>{const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return r?[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]:[30,41,59]},Dv=l=>new Promise(r=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),r(c.toDataURL("image/png"))},o.onerror=()=>r(null),o.src=l});function Mv({project:l,company:r,onShowToast:o}){const{branding:c}=ul(),[m,u]=p.useState([]),[x,g]=p.useState(!0),[f,v]=p.useState(null),[y,R]=p.useState(new Set),[X,B]=p.useState(!1),[V,L]=p.useState("recent"),[q,ee]=p.useState(new Set),[T,D]=p.useState({start:"",end:""});p.useEffect(()=>{w();const Q=ce.subscribeToDailyReports?.(l.id,()=>{w()});return()=>{Q&&ce.unsubscribe?.(Q)}},[l.id]);const w=async()=>{try{const Q=await ce.getDailyReports(l.id,365);u(Q||[])}catch(Q){console.error("Error loading daily reports:",Q),o?.("Error loading daily reports","error")}finally{g(!1)}},se=p.useMemo(()=>{let Q=[...m];if(T.start){const O=new Date(T.start);O.setHours(0,0,0,0),Q=Q.filter($=>new Date($.report_date||$.created_at)>=O)}if(T.end){const O=new Date(T.end);O.setHours(23,59,59,999),Q=Q.filter($=>new Date($.report_date||$.created_at)<=O)}if(V==="recent"){const O=new Date;O.setDate(O.getDate()-7),O.setHours(0,0,0,0),Q=Q.filter($=>new Date($.report_date||$.created_at)>=O)}return Q},[m,V,T]),ne=p.useMemo(()=>{if(V!=="all")return null;const Q={};return se.forEach(O=>{const $=new Date(O.report_date||O.created_at),H=`${$.getFullYear()}-${String($.getMonth()+1).padStart(2,"0")}`,ve=$.toLocaleDateString("en-US",{month:"long",year:"numeric"});Q[H]||(Q[H]={label:ve,reports:[]}),Q[H].reports.push(O)}),Object.entries(Q).sort((O,$)=>$[0].localeCompare(O[0]))},[se,V]);p.useEffect(()=>{if(ne&&ne.length>0){const Q=ne[0][0];ee(new Set([Q]))}},[ne]);const P=()=>{B(!X),X&&R(new Set)},I=Q=>{const O=new Set(y);O.has(Q)?O.delete(Q):O.add(Q),R(O)},F=()=>{y.size===se.length?R(new Set):R(new Set(se.map(Q=>Q.id)))},J=Q=>{const O=new Set(q);O.has(Q)?O.delete(Q):O.add(Q),ee(O)},Z=()=>y.size>0?se.filter(Q=>y.has(Q.id)):se,j=Q=>new Date(Q).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),_=Q=>new Date(Q).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),S=Q=>{switch(Q){case"submitted":return"";case"reviewed":return"";case"draft":return"";default:return""}},ae=Q=>{switch(Q){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return Q}},k=async()=>{const Q=Z();if(Q.length===0){o?.("No reports to export","error");return}o?.("Generating PDF...","info");const O=new Ri,$=O.internal.pageSize.getWidth(),H=20;let ve=H;const Ne=Nf(c?.primary_color||"#3B82F6"),Ae=Nf(c?.secondary_color||"#1E40AF");O.setFillColor(...Ne),O.rect(0,0,$,45,"F"),O.setFillColor(...Ae),O.rect(0,42,$,3,"F");let be=H;if(c?.logo_url)try{const Te=await Dv(c.logo_url);Te&&(O.addImage(Te,"PNG",H,7,30,30),be=H+40)}catch(Te){console.error("Error adding logo:",Te)}O.setTextColor(255,255,255),O.setFontSize(22),O.setFont("helvetica","bold"),O.text(r?.name||"Company Name",be,20),O.setFontSize(10),O.setFont("helvetica","normal"),O.text("DAILY REPORTS SUMMARY",be,30),O.setFontSize(9),O.text(`Generated: ${new Date().toLocaleDateString()}`,$-H,20,{align:"right"}),l.job_number&&O.text(`Job #: ${l.job_number}`,$-H,28,{align:"right"}),ve=55,O.setFillColor(248,250,252),O.rect(H,ve-5,$-H*2,20,"F"),O.setTextColor(...Ne),O.setFontSize(14),O.setFont("helvetica","bold"),O.text(`Project: ${l.name}`,H+5,ve+7),O.setFontSize(10),O.setTextColor(100,100,100),O.text(`${Q.length} Report${Q.length!==1?"s":""}`,$-H-5,ve+7,{align:"right"}),ve+=25,Q.forEach((Te,ht)=>{ve>250&&(O.addPage(),ve=H),O.setFillColor(...Ne),O.setTextColor(255,255,255),O.rect(H,ve,$-H*2,10,"F"),O.setFontSize(11),O.setFont("helvetica","bold"),O.text(j(Te.report_date||Te.created_at),H+5,ve+7),O.text(ae(Te.status),$-H-5,ve+7,{align:"right"}),ve+=15,O.setTextColor(50,50,50),O.setFontSize(10),O.setFont("helvetica","normal");const Yt=`Crew: ${Te.crew_count||0}  |  Tasks: ${Te.tasks_completed||0}  |  T&M: ${Te.tm_tickets_count||0}  |  Photos: ${Te.photos_count||0}`;if(O.text(Yt,H+5,ve),ve+=8,Te.crew_list?.length>0){O.setFont("helvetica","bold"),O.text("Crew:",H+5,ve),O.setFont("helvetica","normal");const Tt=Te.crew_list.map(At=>`${At.name} (${At.role})`).join(", "),ft=O.splitTextToSize(Tt,$-H*2-30);O.text(ft,H+25,ve),ve+=ft.length*5+3}if(Te.field_notes){O.setFont("helvetica","bold"),O.text("Notes:",H+5,ve),O.setFont("helvetica","normal");const Tt=O.splitTextToSize(Te.field_notes,$-H*2-30);O.text(Tt,H+25,ve),ve+=Tt.length*5+3}if(Te.issues){O.setTextColor(180,50,50),O.setFont("helvetica","bold"),O.text("Issues:",H+5,ve),O.setFont("helvetica","normal");const Tt=O.splitTextToSize(Te.issues,$-H*2-30);O.text(Tt,H+25,ve),O.setTextColor(50,50,50),ve+=Tt.length*5+3}ve+=10});const Pe=O.internal.getNumberOfPages();for(let Te=1;Te<=Pe;Te++)O.setPage(Te),O.setFontSize(8),O.setTextColor(150,150,150),O.text(`Page ${Te} of ${Pe}`,$/2,O.internal.pageSize.getHeight()-10,{align:"center"});const Ve=`${l.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;O.save(Ve),o?.("PDF exported!","success")},M=Q=>e.jsxs("div",{className:`daily-report-card ${Q.status} ${y.has(Q.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>v(f===Q.id?null:Q.id),children:[X&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:y.has(Q.id),onChange:O=>{O.stopPropagation(),I(Q.id)},onClick:O=>O.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:j(Q.report_date||Q.created_at)}),e.jsxs("span",{className:`report-status ${Q.status}`,children:[S(Q.status)," ",ae(Q.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[Q.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[Q.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:f===Q.id?"":""})]})]}),f===Q.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:Q.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:Q.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:Q.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:Q.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),Q.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:Q.crew_list.map((O,$)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:O.name}),e.jsx("span",{className:"crew-role",children:O.role})]},$))})]}),Q.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:Q.completed_tasks.map((O,$)=>e.jsxs("li",{children:[O.name,O.group&&e.jsx("span",{className:"task-group",children:O.group})]},$))})]}),Q.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:Q.field_notes})]}),Q.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:Q.issues})]}),Q.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",Q.submitted_by||"Field"," at ",_(Q.submitted_at)]})})]})]},Q.id);if(x)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});const C=m.length,me=se.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${X?"btn-primary":"btn-secondary"}`,onClick:P,children:X?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:k,children:["PDF",y.size>0?` (${y.size})`:""]})]})})]}),m.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${V==="recent"?"active":""}`,onClick:()=>L("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${V==="all"?"active":""}`,onClick:()=>L("all"),children:["All (",C,")"]})]}),V==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(ur,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:T.start,onChange:Q=>D(O=>({...O,start:Q.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:T.end,onChange:Q=>D(O=>({...O,end:Q.target.value})),className:"date-input"}),(T.start||T.end)&&e.jsx("button",{className:"date-clear",onClick:()=>D({start:"",end:""}),children:"Clear"})]})]}),X&&se.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:y.size===se.length&&se.length>0,onChange:F}),"Select All (",se.length,")"]}),y.size>0&&e.jsxs("span",{className:"selected-count",children:[y.size," selected"]})]}),m.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Oa,{size:32})}),e.jsx("p",{children:"No daily reports yet"}),e.jsx("small",{children:"Reports from the field will appear here"})]}):se.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Oa,{size:32})}),e.jsx("p",{children:"No reports in this time period"}),e.jsx("small",{children:V==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"})]}):V==="recent"?e.jsxs("div",{className:"daily-reports",children:[se.map(Q=>M(Q)),C>me&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>L("all"),children:["View All ",C," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:ne?.map(([Q,{label:O,reports:$}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>J(Q),children:[q.has(Q)?e.jsx(tn,{size:18,className:"month-chevron"}):e.jsx(Cn,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:O}),e.jsxs("span",{className:"month-count",children:[$.length," report",$.length!==1?"s":""]})]}),q.has(Q)&&e.jsx("div",{className:"month-reports",children:$.map(H=>M(H))})]},Q))})]})}function Tv({project:l,company:r,userName:o,onShowToast:c}){const[m,u]=p.useState([]),[x,g]=p.useState(!0),[f,v]=p.useState(!1),[y,R]=p.useState(""),[X,B]=p.useState(0),[V,L]=p.useState(!1),q=p.useRef(null);p.useEffect(()=>{ee();const ne=ce.subscribeToMessages?.(l.id,P=>{P.new&&(u(I=>[...I,P.new]),P.new.sender_type==="field"&&B(I=>I+1))});return()=>{ne&&ce.unsubscribe?.(ne)}},[l.id]),p.useEffect(()=>{V&&(q.current?.scrollIntoView({behavior:"smooth"}),ce.markMessagesRead?.(l.id,"office"),B(0))},[m,V]);const ee=async()=>{try{const P=(await ce.getMessages(l.id,50)||[]).sort((F,J)=>new Date(F.created_at)-new Date(J.created_at));u(P);const I=P.filter(F=>F.sender_type==="field"&&!F.is_read).length;B(I)}catch(ne){console.error("Error loading messages:",ne)}finally{g(!1)}},T=async()=>{if(y.trim()){v(!0);try{const ne=await ce.sendMessage(l.id,y.trim(),"office",o||"Office");u(P=>[...P,ne]),R("")}catch(ne){console.error("Error sending message:",ne),c?.("Error sending message","error")}finally{v(!1)}}},D=ne=>{ne.key==="Enter"&&!ne.shiftKey&&(ne.preventDefault(),T())},w=ne=>{const P=new Date(ne),I=new Date;return P.toDateString()===I.toDateString()?P.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):P.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})},se=m.slice(-3);return x?e.jsxs("div",{className:"project-messages card",children:[e.jsx("div",{className:"project-messages-header",children:e.jsx("h3",{children:"Messages"})}),e.jsx("div",{className:"loading",children:"Loading messages..."})]}):e.jsxs("div",{className:`project-messages card ${V?"expanded":""}`,children:[e.jsxs("div",{className:"project-messages-header",onClick:()=>L(!V),children:[e.jsxs("div",{className:"messages-title-row",children:[e.jsx("h3",{children:"Messages"}),X>0&&e.jsxs("span",{className:"messages-unread-badge",children:[X," new"]})]}),e.jsx("button",{className:"messages-toggle-btn",children:V?" Collapse":" Expand"})]}),!V&&m.length>0&&e.jsxs("div",{className:"messages-preview",children:[se.map(ne=>e.jsxs("div",{className:`preview-message ${ne.sender_type}`,children:[e.jsxs("span",{className:"preview-sender",children:[ne.sender_type==="office"?e.jsx(dl,{size:12,className:"inline-icon"}):e.jsx(ca,{size:12,className:"inline-icon"})," ",ne.sender_name,":"]}),e.jsxs("span",{className:"preview-text",children:[ne.message?.slice(0,50),ne.message?.length>50?"...":""]})]},ne.id)),m.length===0&&e.jsx("p",{className:"no-messages-hint",children:"No messages yet. Click to start chatting."})]}),V&&e.jsxs("div",{className:"messages-full",children:[e.jsxs("div",{className:"messages-list-container",children:[m.length===0?e.jsxs("div",{className:"messages-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(ys,{size:32})}),e.jsx("p",{children:"No messages yet"}),e.jsx("small",{children:"Send a message to the field crew"})]}):m.map(ne=>e.jsxs("div",{className:`message-bubble ${ne.sender_type==="office"?"sent":"received"}`,children:[e.jsxs("div",{className:"message-sender",children:[ne.sender_type==="office"?e.jsx(dl,{size:14,className:"inline-icon"}):e.jsx(ca,{size:14,className:"inline-icon"})," ",ne.sender_name]}),e.jsx("div",{className:"message-text",children:ne.message}),ne.photo_url&&e.jsx("img",{src:ne.photo_url,alt:"Attached",className:"message-photo"}),e.jsx("div",{className:"message-time",children:w(ne.created_at)})]},ne.id)),e.jsx("div",{ref:q})]}),e.jsxs("div",{className:"messages-input-row",children:[e.jsx("textarea",{value:y,onChange:ne=>R(ne.target.value),onKeyDown:D,placeholder:"Type a message...",rows:1,disabled:f}),e.jsx("button",{className:"btn btn-primary send-btn",onClick:T,disabled:f||!y.trim(),children:f?"...":"Send"})]})]})]})}function Av({project:l,company:r,onShowToast:o}){const[c,m]=p.useState(null),[u,x]=p.useState(!0),[g,f]=p.useState(!1);p.useEffect(()=>{if(l?.id&&r?.id){v();const V=ce.subscribeToCrewCheckins?.(l.id,()=>{v()});return()=>{V&&ce.unsubscribe?.(V)}}},[l?.id,r?.id]);const v=async()=>{try{const V=await ce.calculateManDayCosts(l.id,r.id,l.work_type||"demolition",l.job_type||"standard");m(V)}catch(V){console.error("Error loading man day costs:",V)}finally{x(!1)}},y=V=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(V),R=V=>new Date(V).toLocaleDateString("en-US",{month:"short",day:"numeric"}),X=V=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[V]||V.charAt(0).toUpperCase()+V.slice(1);if(u)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!c||c.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(ca,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const B=Object.entries(c.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>f(!g),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:y(c.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:g?" Collapse":" Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:c.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:c.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:y(c.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:c.daysWorked>0?y(c.totalCost/c.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),g&&e.jsxs("div",{className:"man-day-details",children:[B.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:B.map(([V,L])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:X(V)}),e.jsxs("span",{className:"role-rate",children:[y(L.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[L.count," days"]}),e.jsx("span",{className:"role-cost",children:y(L.cost)})]})]},V))})]}),c.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:c.byDate.slice(0,7).map((V,L)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:R(V.date)}),e.jsxs("span",{className:"date-workers",children:[V.workers," crew"]}),e.jsx("span",{className:"date-cost",children:y(V.cost)})]},L))}),c.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",c.byDate.length-7," more days"]})]})]})]})}const ia=l=>((l||0)/100).toFixed(2),we=l=>{const r=(l||0)/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(r)},bs=l=>Math.round((parseFloat(l)||0)*100),Js=l=>((l||0)/100).toFixed(2),bt=l=>`${Js(l)}%`,vn=l=>Math.round((parseFloat(l)||0)*100),Rv=(l,r,o,c)=>{const m=parseFloat(l)||0,u=parseFloat(r)||0,x=parseInt(o)||0,g=parseInt(c)||0,f=Math.round(m*x),v=Math.round(u*g),y=f+v;return{regularTotal:f,overtimeTotal:v,total:y}},Sf=(l,r)=>{const o=parseFloat(l)||0,c=parseInt(r)||0;return Math.round(o*c)},Ei=(l,r)=>{const o=parseInt(l)||0,c=parseInt(r)||0;return Math.round(o*c/1e4)},ed=(l,r)=>{const o=parseInt(l)||0,c=parseInt(r)||0;return Math.round(o*c/1e4)},fr=l=>{const r=(l.change_order_labor||[]).reduce((L,q)=>L+(parseInt(q.total)||0),0),o=(l.change_order_materials||[]).reduce((L,q)=>L+(parseInt(q.total)||0),0),c=(l.change_order_equipment||[]).reduce((L,q)=>L+(parseInt(q.total)||0),0),m=(l.change_order_subcontractors||[]).reduce((L,q)=>L+(parseInt(q.total)||0),0),u=Ei(r,l.labor_markup_percent||1500),x=Ei(o,l.materials_markup_percent||1500),g=Ei(c,l.equipment_markup_percent||1500),f=Ei(m,l.subcontractors_markup_percent||500),v=r+o+c+m+u+x+g+f,y=ed(v,l.liability_insurance_percent||144),R=ed(v,l.bond_percent||100),X=ed(v,l.license_fee_percent||10),B=y+R+X,V=v+B;return{labor_subtotal:r,materials_subtotal:o,equipment_subtotal:c,subcontractors_subtotal:m,labor_markup_amount:u,materials_markup_amount:x,equipment_markup_amount:g,subcontractors_markup_amount:f,liability_insurance_amount:y,bond_amount:R,license_fee_amount:X,additional_fees_total:B,cor_subtotal:v,cor_total:V}},td=l=>{const r=[];if(l.title?.trim()||r.push("Title is required"),l.scope_of_work?.trim()||r.push("Scope of work is required"),l.period_start||r.push("Start date is required"),l.period_end||r.push("End date is required"),l.period_start&&l.period_end){const f=new Date(l.period_start);new Date(l.period_end)<f&&r.push("End date must be after start date")}const o=(l.change_order_labor||[]).length>0,c=(l.change_order_materials||[]).length>0,m=(l.change_order_equipment||[]).length>0,u=(l.change_order_subcontractors||[]).length>0;!o&&!c&&!m&&!u&&r.push("At least one line item (labor, materials, equipment, or subcontractor) is required"),fr(l).cor_total<=0&&r.push("COR total must be greater than zero");const g=5e3;return l.labor_markup_percent>g&&r.push("Labor markup percentage seems too high (>50%)"),l.materials_markup_percent>g&&r.push("Materials markup percentage seems too high (>50%)"),l.equipment_markup_percent>g&&r.push("Equipment markup percentage seems too high (>50%)"),l.subcontractors_markup_percent>g&&r.push("Subcontractors markup percentage seems too high (>50%)"),{valid:r.length===0,errors:r}},sp=l=>{const r={draft:{label:"Draft",color:"#6b7280",bgColor:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bgColor:"#fef3c7"},approved:{label:"Approved",color:"#059669",bgColor:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bgColor:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bgColor:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bgColor:"#e5e7eb"}};return r[l]||r.draft},Ka=l=>l?new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",qi=(l,r)=>{const o=Ka(l),c=Ka(r);return o&&c?`${o} - ${c}`:o||c||""},yn={labor_markup:1500,materials_markup:1500,equipment_markup:1500,subcontractors_markup:500,liability_insurance:144,bond:100,license_fee:10},Cf=["Foreman","Superintendent","Operator","Laborer"],zv=[{value:"standard",label:"Standard"},{value:"pla",label:"PLA (Project Labor Agreement)"},{value:"prevailing",label:"Prevailing Wage"}],ad={materials:[{value:"backup_sheet",label:"Backup Sheet"},{value:"invoice",label:"Invoice"},{value:"mobilization",label:"Mobilization"},{value:"custom",label:"Custom Entry"}],equipment:[{value:"backup_sheet",label:"Backup Sheet"},{value:"invoice",label:"Invoice"},{value:"custom",label:"Custom Entry"}],subcontractors:[{value:"invoice",label:"Invoice"},{value:"quote",label:"Quote"},{value:"custom",label:"Custom Entry"}]},wf=["each","day","week","month","hour","sqft","lf","gallon","pound","ton","cy","lump sum"];function qv({project:l,company:r,areas:o,refreshKey:c,onShowToast:m,onCreateCOR:u,onViewCOR:x,onEditCOR:g}){const[f,v]=p.useState([]),[y,R]=p.useState(!0),[X,B]=p.useState("all"),[V,L]=p.useState("all"),[q,ee]=p.useState(null),[T,D]=p.useState(new Set),[w,se]=p.useState("recent"),[ne,P]=p.useState(new Set),[I,F]=p.useState({start:"",end:""}),[J,Z]=p.useState(null);p.useEffect(()=>{j(),_();const $=ce.subscribeToCORs?.(l.id,()=>{j(),_()});return()=>{$&&ce.unsubscribe?.($)}},[l.id,c]);const j=async()=>{try{const $=await ce.getCORs(l.id);v($||[])}catch($){console.error("Error loading CORs:",$),m?.("Error loading change order requests","error")}finally{R(!1)}},_=async()=>{try{const $=await ce.getCORStats?.(l.id);Z($)}catch($){console.error("Error loading COR stats:",$)}},S=async($,H)=>{if(H?.stopPropagation(),!!confirm("Are you sure you want to delete this COR? This action cannot be undone."))try{await ce.deleteCOR($),v(f.filter(ve=>ve.id!==$)),m?.("COR deleted","success"),_()}catch(ve){console.error("Error deleting COR:",ve),m?.("Error deleting COR","error")}},ae=async($,H)=>{H?.stopPropagation();try{await ce.submitCORForApproval($),await j(),m?.("COR submitted for approval","success"),_()}catch(ve){console.error("Error submitting COR:",ve?.message||ve),m?.(ve?.message||"Error submitting COR","error")}},k=p.useMemo(()=>{let $=[...f];if(X!=="all"&&($=$.filter(H=>H.status===X)),V!=="all"&&($=$.filter(H=>H.area_id===V)),I.start){const H=new Date(I.start);H.setHours(0,0,0,0),$=$.filter(ve=>new Date(ve.created_at)>=H)}if(I.end){const H=new Date(I.end);H.setHours(23,59,59,999),$=$.filter(ve=>new Date(ve.created_at)<=H)}if(w==="recent"){const H=new Date;H.setDate(H.getDate()-7),H.setHours(0,0,0,0),$=$.filter(ve=>new Date(ve.created_at)>=H)}return $.sort((H,ve)=>new Date(ve.created_at)-new Date(H.created_at)),$},[f,X,V,w,I]),M=p.useMemo(()=>{if(w!=="all")return null;const $={};return k.forEach(H=>{const ve=new Date(H.created_at),Ne=`${ve.getFullYear()}-${String(ve.getMonth()+1).padStart(2,"0")}`,Ae=ve.toLocaleDateString("en-US",{month:"long",year:"numeric"});$[Ne]||($[Ne]={label:Ae,cors:[],totalAmount:0}),$[Ne].cors.push(H),$[Ne].totalAmount+=H.cor_total||0}),Object.entries($).sort((H,ve)=>ve[0].localeCompare(H[0]))},[k,w]);p.useEffect(()=>{if(M&&M.length>0){const $=M[0][0];P(new Set([$]))}},[M]);const C=$=>{const H=new Set(ne);H.has($)?H.delete($):H.add($),P(H)},me=p.useMemo(()=>({all:f.length,draft:f.filter($=>$.status==="draft").length,pending_approval:f.filter($=>$.status==="pending_approval").length,approved:f.filter($=>$.status==="approved").length,rejected:f.filter($=>$.status==="rejected").length,billed:f.filter($=>$.status==="billed").length,closed:f.filter($=>$.status==="closed").length}),[f]);X==="all"?f.length:f.filter($=>$.status===X).length;const Q=$=>o?.find(ve=>ve.id===$)?.name||"No Area",O=$=>{const H=sp($.status);$.id;const ve=$.status==="draft",Ne=["draft","pending_approval","rejected"].includes($.status),Ae=$.status==="draft";return e.jsxs("div",{className:`cor-card ${$.status}`,onClick:()=>x?.($),onKeyDown:be=>{(be.key==="Enter"||be.key===" ")&&(be.preventDefault(),x?.($))},tabIndex:0,role:"button","aria-label":`View COR ${$.cor_number}: ${$.title||"Untitled"}, ${H.label}, ${we($.cor_total||0)}`,children:[e.jsxs("div",{className:"cor-card-header",children:[e.jsxs("div",{className:"cor-card-left",children:[e.jsx("span",{className:"cor-number",children:$.cor_number}),e.jsx("span",{className:"cor-status-badge",style:{backgroundColor:H.bgColor,color:H.color},children:H.label})]}),e.jsx("div",{className:"cor-card-right",children:e.jsx("span",{className:"cor-total",children:we($.cor_total||0)})})]}),e.jsxs("div",{className:"cor-card-body",children:[e.jsx("h4",{className:"cor-title",children:$.title||"Untitled COR"}),e.jsxs("div",{className:"cor-meta",children:[$.area_id&&e.jsx("span",{className:"cor-area",children:Q($.area_id)}),e.jsx("span",{className:"cor-period",children:qi($.period_start,$.period_end)})]})]}),e.jsxs("div",{className:"cor-card-footer",children:[e.jsx("span",{className:"cor-created",children:Ka($.created_at)}),e.jsxs("div",{className:"cor-actions",onClick:be=>be.stopPropagation(),children:[Ae&&e.jsx("button",{className:"cor-action-btn submit",onClick:be=>ae($.id,be),title:"Submit for Approval","aria-label":`Submit COR ${$.cor_number} for approval`,children:e.jsx(If,{size:14,"aria-hidden":"true"})}),ve&&e.jsx("button",{className:"cor-action-btn edit",onClick:be=>{be.stopPropagation(),g?.($)},title:"Edit","aria-label":`Edit COR ${$.cor_number}`,children:e.jsx(fd,{size:14,"aria-hidden":"true"})}),e.jsx("button",{className:"cor-action-btn view",onClick:be=>{be.stopPropagation(),x?.($)},title:"View Details","aria-label":`View COR ${$.cor_number} details`,children:e.jsx(mj,{size:14,"aria-hidden":"true"})}),Ne&&e.jsx("button",{className:"cor-action-btn delete",onClick:be=>S($.id,be),title:"Delete","aria-label":`Delete COR ${$.cor_number}`,children:e.jsx(_s,{size:14,"aria-hidden":"true"})})]})]})]},$.id)};return y?e.jsx("div",{className:"loading",children:"Loading change order requests..."}):e.jsxs("div",{className:"cor-list",children:[e.jsxs("div",{className:"cor-list-header",children:[e.jsxs("div",{className:"cor-list-info",children:[e.jsx("h3",{children:"Change Orders"}),e.jsxs("div",{className:"cor-stats-inline",children:[e.jsxs("span",{className:"cor-stat-item",children:[me.all," total"]}),me.pending_approval>0&&e.jsxs("span",{className:"cor-stat-item pending",children:[me.pending_approval," pending"]}),J?.totalApproved>0&&e.jsx("span",{className:"cor-stat-item approved",children:we(J.totalApproved)})]})]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:u,children:[e.jsx($a,{size:14})," New COR"]})]}),e.jsxs("div",{className:"cor-controls",children:[e.jsx("div",{className:"cor-filter-pills",role:"tablist",children:[{id:"all",label:"All"},{id:"draft",label:"Draft"},{id:"pending_approval",label:"Pending"},{id:"approved",label:"Approved"}].map($=>e.jsxs("button",{role:"tab","aria-selected":X===$.id,className:`cor-pill ${X===$.id?"active":""}`,onClick:()=>B($.id),children:[$.label,me[$.id]>0&&e.jsx("span",{className:"cor-pill-count",children:me[$.id]})]},$.id))}),e.jsxs("div",{className:"cor-view-toggle",children:[e.jsx("button",{className:`cor-toggle-btn ${w==="recent"?"active":""}`,onClick:()=>{se("recent"),F({start:"",end:""})},children:"Recent"}),e.jsx("button",{className:`cor-toggle-btn ${w==="all"?"active":""}`,onClick:()=>se("all"),children:"All"})]})]}),w==="all"&&e.jsxs("div",{className:"cor-date-filter",children:[e.jsx(ur,{size:14}),e.jsx("input",{type:"date",value:I.start,onChange:$=>F(H=>({...H,start:$.target.value}))}),e.jsx("span",{className:"cor-date-sep",children:"to"}),e.jsx("input",{type:"date",value:I.end,onChange:$=>F(H=>({...H,end:$.target.value}))}),(I.start||I.end)&&e.jsx("button",{className:"cor-clear-btn",onClick:()=>F({start:"",end:""}),children:"Clear"})]}),k.length===0?e.jsxs("div",{className:"cor-empty",children:[e.jsx(Ua,{size:24,className:"cor-empty-icon"}),e.jsxs("p",{children:["No change orders ",X!=="all"?`(${X.replace("_"," ")})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:u,children:[e.jsx($a,{size:14})," Create COR"]})]}):e.jsx("div",{className:"cor-cards",children:w==="all"&&M?M.map(([$,H])=>e.jsxs("div",{className:"cor-month-group",children:[e.jsxs("button",{className:"cor-month-header",onClick:()=>C($),children:[e.jsxs("div",{className:"cor-month-left",children:[ne.has($)?e.jsx(tn,{size:16}):e.jsx(Cn,{size:16}),e.jsx("span",{children:H.label}),e.jsx("span",{className:"cor-month-count",children:H.cors.length})]}),e.jsx("span",{className:"cor-month-total",children:we(H.totalAmount)})]}),ne.has($)&&e.jsx("div",{className:"cor-month-items",children:H.cors.map(ve=>O(ve))})]},$)):k.map($=>O($))})]})}function Ov({projectId:l,corId:r,onImport:o,onClose:c,onShowToast:m}){const[u,x]=p.useState([]),[g,f]=p.useState(!0),[v,y]=p.useState(new Set),[R,X]=p.useState(null),[B,V]=p.useState(""),[L,q]=p.useState("unassigned");p.useEffect(()=>{ee()},[l]);const ee=async()=>{try{const I=await ce.getTMTickets(l);x(I||[])}catch(I){console.error("Error loading tickets:",I),m?.("Error loading tickets","error")}finally{f(!1)}},T=p.useMemo(()=>{let I=[...u];if(L==="unassigned"?I=I.filter(F=>!F.assigned_cor_id):L==="approved"&&(I=I.filter(F=>F.status==="approved")),B){const F=B.toLowerCase();I=I.filter(J=>J.work_description?.toLowerCase().includes(F)||J.ce_pco_number?.toLowerCase().includes(F)||J.ticket_date?.includes(F))}return I.sort((F,J)=>new Date(J.ticket_date)-new Date(F.ticket_date)),I},[u,L,B]),D=I=>{const F=new Set(v);F.has(I)?F.delete(I):F.add(I),y(F)},w=()=>{v.size===T.length?y(new Set):y(new Set(T.map(I=>I.id)))},se=I=>new Date(I).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),ne=I=>{const F=I.workers?.length||0,J=I.items?.length||0,Z=I.materials_equipment?.filter(_=>_.type==="equipment")?.length||0;let j=0;return I.workers?.forEach(_=>{j+=(parseFloat(_.regular_hours)||0)+(parseFloat(_.overtime_hours)||0)}),{workerCount:F,itemCount:J,equipmentCount:Z,laborHours:j}},P=()=>{if(v.size===0){m?.("Please select at least one ticket","error");return}const I=u.filter(j=>v.has(j.id)),F=[],J=[],Z=[];I.forEach(j=>{j.workers?.forEach(_=>{F.push({id:`import-${j.id}-${_.id||Date.now()}`,labor_class:_.role||"Laborer",wage_type:"standard",regular_hours:parseFloat(_.regular_hours)||0,overtime_hours:parseFloat(_.overtime_hours)||0,regular_rate:0,overtime_rate:0,total:0,source_ticket_id:j.id,source_ticket_date:j.ticket_date})}),j.items?.forEach(_=>{J.push({id:`import-${j.id}-${_.id||Date.now()}`,description:_.description||_.name,source_type:"backup_sheet",source_reference:`Ticket ${se(j.ticket_date)}`,quantity:parseFloat(_.quantity)||1,unit:_.unit||"each",unit_cost:bs(_.unit_cost||0),total:bs((_.quantity||1)*(_.unit_cost||0)),source_ticket_id:j.id})}),j.materials_equipment?.filter(_=>_.type==="equipment").forEach(_=>{Z.push({id:`import-${j.id}-${_.id||Date.now()}`,description:_.description||_.name,source_type:"backup_sheet",source_reference:`Ticket ${se(j.ticket_date)}`,quantity:parseFloat(_.quantity)||1,unit:_.unit||"day",unit_cost:bs(_.unit_cost||_.cost||0),total:bs((_.quantity||1)*(_.unit_cost||_.cost||0)),source_ticket_id:j.id})})}),o?.({ticketIds:Array.from(v),laborItems:F,materialsItems:J,equipmentItems:Z}),c?.()};return g?e.jsx("div",{className:"modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-label":"Loading tickets",children:e.jsx("div",{className:"modal-content ticket-selector-modal",onClick:I=>I.stopPropagation(),children:e.jsx("div",{className:"loading",role:"status","aria-live":"polite",children:"Loading tickets..."})})}):e.jsx("div",{className:"modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-labelledby":"ticket-selector-title",children:e.jsxs("div",{className:"modal-content ticket-selector-modal",onClick:I=>I.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"ticket-selector-title",children:"Import from T&M Tickets"}),e.jsx("button",{className:"close-btn",onClick:c,"aria-label":"Close ticket selector",children:e.jsx(kn,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"ticket-selector-controls",children:[e.jsxs("div",{className:"ticket-search",children:[e.jsx($j,{size:16,"aria-hidden":"true"}),e.jsx("input",{type:"text",placeholder:"Search tickets...",value:B,onChange:I=>V(I.target.value),"aria-label":"Search tickets"})]}),e.jsxs("div",{className:"ticket-filters",role:"group","aria-label":"Filter tickets by status",children:[e.jsx("button",{className:`filter-btn ${L==="unassigned"?"active":""}`,onClick:()=>q("unassigned"),"aria-pressed":L==="unassigned",children:"Unassigned"}),e.jsx("button",{className:`filter-btn ${L==="approved"?"active":""}`,onClick:()=>q("approved"),"aria-pressed":L==="approved",children:"Approved"}),e.jsx("button",{className:`filter-btn ${L==="all"?"active":""}`,onClick:()=>q("all"),"aria-pressed":L==="all",children:"All"})]})]}),e.jsxs("div",{className:"ticket-selector-header",children:[e.jsxs("label",{className:"select-all",children:[e.jsx("input",{type:"checkbox",checked:v.size===T.length&&T.length>0,onChange:w,"aria-label":`Select all ${T.length} tickets`}),e.jsxs("span",{children:["Select All (",T.length,")"]})]}),e.jsxs("span",{className:"selected-count",children:[v.size," selected"]})]}),e.jsx("div",{className:"modal-body ticket-selector-body",children:T.length===0?e.jsxs("div",{className:"ticket-empty",children:[e.jsx(Ua,{size:32}),e.jsx("p",{children:"No tickets found"}),L==="unassigned"&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>q("all"),children:"Show all tickets"})]}):e.jsx("div",{className:"ticket-list",children:T.map(I=>{const F=ne(I),J=v.has(I.id),Z=R===I.id;return e.jsxs("div",{className:`ticket-item ${J?"selected":""} ${I.assigned_cor_id?"assigned":""}`,children:[e.jsxs("div",{className:"ticket-item-main",children:[e.jsx("label",{className:"ticket-checkbox",children:e.jsx("input",{type:"checkbox",checked:J,onChange:()=>D(I.id),disabled:I.assigned_cor_id&&I.assigned_cor_id!==r})}),e.jsxs("div",{className:"ticket-item-info",onClick:()=>X(Z?null:I.id),children:[e.jsxs("div",{className:"ticket-item-header",children:[e.jsx("span",{className:"ticket-date",children:se(I.ticket_date)}),e.jsx("span",{className:`ticket-status ${I.status}`,children:I.status}),I.ce_pco_number&&e.jsxs("span",{className:"ticket-pco",children:["CE/PCO: ",I.ce_pco_number]})]}),e.jsx("div",{className:"ticket-item-desc",children:I.work_description||"No description"}),e.jsxs("div",{className:"ticket-item-summary",children:[F.workerCount>0&&e.jsxs("span",{children:[e.jsx(mr,{size:12})," ",F.workerCount," workers"]}),F.itemCount>0&&e.jsxs("span",{children:[e.jsx(Wa,{size:12})," ",F.itemCount," items"]}),F.equipmentCount>0&&e.jsxs("span",{children:[e.jsx(wn,{size:12})," ",F.equipmentCount," equipment"]}),F.laborHours>0&&e.jsxs("span",{children:[F.laborHours," hrs"]})]})]}),e.jsx("button",{className:"ticket-expand-btn",onClick:()=>X(Z?null:I.id),children:Z?e.jsx(tn,{size:16}):e.jsx(Cn,{size:16})})]}),Z&&e.jsxs("div",{className:"ticket-item-details",children:[I.workers?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Workers"}),e.jsx("ul",{children:I.workers.map((j,_)=>e.jsxs("li",{children:[j.name||j.role," - ",j.regular_hours||0," reg hrs",j.overtime_hours>0&&`, ${j.overtime_hours} OT hrs`]},_))})]}),I.items?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Materials"}),e.jsx("ul",{children:I.items.map((j,_)=>e.jsxs("li",{children:[j.description||j.name," - ",j.quantity," ",j.unit]},_))})]}),I.materials_equipment?.filter(j=>j.type==="equipment").length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Equipment"}),e.jsx("ul",{children:I.materials_equipment.filter(j=>j.type==="equipment").map((j,_)=>e.jsx("li",{children:j.description||j.name},_))})]})]})]},I.id)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:c,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:P,disabled:v.size===0,children:[e.jsx(dr,{size:16})," Import ",v.size," Ticket",v.size!==1?"s":""]})]})]})})}const Di=[{id:1,label:"Title & Info",shortLabel:"Info"},{id:2,label:"Period",shortLabel:"Period"},{id:3,label:"Labor",shortLabel:"Labor"},{id:4,label:"Materials",shortLabel:"Materials"},{id:5,label:"Equipment",shortLabel:"Equipment"},{id:6,label:"Subcontractors",shortLabel:"Subs"},{id:7,label:"Markups & Fees",shortLabel:"Markups"},{id:8,label:"Summary",shortLabel:"Summary"},{id:9,label:"Submit",shortLabel:"Submit"}];function Uv({project:l,company:r,areas:o,existingCOR:c,onClose:m,onSaved:u,onShowToast:x}){const[g,f]=p.useState(1),[v,y]=p.useState(!1),[R,X]=p.useState([]),[B,V]=p.useState(!1),[L,q]=p.useState(c?.title||""),[ee,T]=p.useState(c?.scope_of_work||""),[D,w]=p.useState(c?.area_id||""),[se,ne]=p.useState(c?.cor_number||""),[P,I]=p.useState(c?.period_start||""),[F,J]=p.useState(c?.period_end||""),[Z,j]=p.useState(c?.change_order_labor||[]),[_,S]=p.useState(c?.change_order_materials||[]),[ae,k]=p.useState(c?.change_order_equipment||[]),[M,C]=p.useState(c?.change_order_subcontractors||[]),[me,Q]=p.useState(c?.labor_markup_percent??yn.labor_markup),[O,$]=p.useState(c?.materials_markup_percent??yn.materials_markup),[H,ve]=p.useState(c?.equipment_markup_percent??yn.equipment_markup),[Ne,Ae]=p.useState(c?.subcontractors_markup_percent??yn.subcontractors_markup),[be,Pe]=p.useState(c?.liability_insurance_percent??yn.liability_insurance),[Ve,Te]=p.useState(c?.bond_percent??yn.bond),[ht,Yt]=p.useState(c?.license_fee_percent??yn.license_fee);p.useEffect(()=>{Tt(),c||At()},[]);const Tt=async()=>{try{const le=await ce.getLaborRates?.(r?.id,l?.work_type,l?.job_type);X(le||[])}catch(le){console.error("Error loading labor rates:",le)}},ft=le=>{const Se=le?.toLowerCase()||"";return R.find(ue=>ue.role?.toLowerCase()===Se)||null},At=async()=>{try{const le=await ce.getNextCORNumber?.(l.id);ne(le||`COR-${Date.now()}`)}catch(le){console.error("Error generating COR number:",le),ne(`COR-${Date.now()}`)}},lt=p.useMemo(()=>({title:L,scope_of_work:ee,area_id:D||null,cor_number:se,period_start:P,period_end:F,change_order_labor:Z,change_order_materials:_,change_order_equipment:ae,change_order_subcontractors:M,labor_markup_percent:me,materials_markup_percent:O,equipment_markup_percent:H,subcontractors_markup_percent:Ne,liability_insurance_percent:be,bond_percent:Ve,license_fee_percent:ht}),[L,ee,D,se,P,F,Z,_,ae,M,me,O,H,Ne,be,Ve,ht]),Le=p.useMemo(()=>fr(lt),[lt]),Wt=le=>{switch(le){case 1:return L.trim()?ee.trim()?!0:(x?.("Scope of work is required","error"),!1):(x?.("Title is required","error"),!1);case 2:return P?F?new Date(F)<new Date(P)?(x?.("End date must be after start date","error"),!1):!0:(x?.("End date is required","error"),!1):(x?.("Start date is required","error"),!1);default:return!0}},A=()=>{Wt(g)&&f(Math.min(g+1,Di.length))},E=()=>{f(Math.max(g-1,1))},fe=le=>{if(le<g)f(le);else if(le>g){for(let Se=g;Se<le;Se++)if(!Wt(Se))return;f(le)}},xe=()=>{const le=Cf[0],Se=ft(le);j([...Z,{id:`temp-${Date.now()}`,labor_class:le,wage_type:"standard",regular_hours:0,overtime_hours:0,regular_rate:Se?Math.round((parseFloat(Se.regular_rate)||0)*100):0,overtime_rate:Se?Math.round((parseFloat(Se.overtime_rate)||0)*100):0,total:0}])},G=(le,Se,ue)=>{const Xe=[...Z];if(Xe[le]={...Xe[le],[Se]:ue},Se==="labor_class"){const Et=ft(ue);Et&&(Xe[le].regular_rate=Math.round((parseFloat(Et.regular_rate)||0)*100),Xe[le].overtime_rate=Math.round((parseFloat(Et.overtime_rate)||0)*100))}const{total:St}=Rv(Xe[le].regular_hours,Xe[le].overtime_hours,Xe[le].regular_rate,Xe[le].overtime_rate);Xe[le].total=St,j(Xe)},_e=le=>{j(Z.filter((Se,ue)=>ue!==le))},Ye=()=>{S([..._,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"each",unit_cost:0,total:0}])},qe=(le,Se,ue)=>{const Xe=[..._];Xe[le]={...Xe[le],[Se]:ue},Xe[le].total=Sf(Xe[le].quantity,Xe[le].unit_cost),S(Xe)},We=le=>{S(_.filter((Se,ue)=>ue!==le))},wt=()=>{k([...ae,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"day",unit_cost:0,total:0}])},Ie=(le,Se,ue)=>{const Xe=[...ae];Xe[le]={...Xe[le],[Se]:ue},Xe[le].total=Sf(Xe[le].quantity,Xe[le].unit_cost),k(Xe)},kt=le=>{k(ae.filter((Se,ue)=>ue!==le))},Ft=()=>{C([...M,{id:`temp-${Date.now()}`,company_name:"",description:"",source_type:"invoice",source_reference:"",amount:0,total:0}])},Ot=(le,Se,ue)=>{const Xe=[...M];Xe[le]={...Xe[le],[Se]:ue},Se==="amount"&&(Xe[le].total=parseInt(ue)||0),C(Xe)},Ut=le=>{C(M.filter((Se,ue)=>ue!==le))},ut=le=>{le.laborItems?.length>0&&j([...Z,...le.laborItems]),le.materialsItems?.length>0&&S([..._,...le.materialsItems]),le.equipmentItems?.length>0&&k([...ae,...le.equipmentItems]),x?.(`Imported data from ${le.ticketIds.length} ticket(s)`,"success")},Rt=async()=>{y(!0);try{const le={company_id:r.id,project_id:l.id,...lt,...Le,status:"draft"};let Se;c?.id?Se=await ce.updateCOR(c.id,le):Se=await ce.createCOR(le),Se?.id&&await ce.saveCORLineItems(Se.id,{laborItems:Z,materialItems:_,equipmentItems:ae,subcontractorItems:M}),x?.("COR saved as draft","success"),u?.(Se),m?.()}catch(le){console.error("Error saving COR:",le),x?.("Error saving COR","error")}finally{y(!1)}},_t=async()=>{const le=td(lt);if(!le.valid){x?.(le.errors[0],"error");return}y(!0);try{const Se={company_id:r.id,project_id:l.id,...lt,...Le,status:"pending_approval"};let ue;c?.id?(ue=await ce.updateCOR(c.id,{...Se,status:"draft"}),await ce.saveCORLineItems(c.id,{laborItems:Z,materialItems:_,equipmentItems:ae,subcontractorItems:M}),await ce.submitCORForApproval(c.id)):(ue=await ce.createCOR({...Se,status:"draft"}),ue?.id&&(await ce.saveCORLineItems(ue.id,{laborItems:Z,materialItems:_,equipmentItems:ae,subcontractorItems:M}),await ce.submitCORForApproval(ue.id))),x?.("COR submitted for approval","success"),u?.(ue),m?.()}catch(Se){console.error("Error submitting COR:",Se),x?.("Error submitting COR","error")}finally{y(!1)}};return e.jsxs("div",{className:"modal-overlay",onClick:m,children:[e.jsxs("div",{className:"modal-content cor-form-modal",onClick:le=>le.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:c?"Edit Change Order Request":"New Change Order Request"}),e.jsx("button",{className:"close-btn",onClick:m,children:e.jsx(kn,{size:20})})]}),e.jsx("div",{className:"cor-progress-steps",children:Di.map(le=>e.jsxs("div",{className:`cor-step ${g>=le.id?"active":""} ${g===le.id?"current":""}`,onClick:()=>fe(le.id),children:[e.jsx("span",{className:"cor-step-number",children:le.id}),e.jsx("span",{className:"cor-step-label",children:le.shortLabel})]},le.id))}),e.jsxs("div",{className:"modal-body cor-form-body",children:[g===1&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Basic Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"COR Number"}),e.jsx("input",{type:"text",value:se,onChange:le=>ne(le.target.value),placeholder:"Auto-generated",className:"input-readonly",readOnly:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title *"}),e.jsx("input",{type:"text",value:L,onChange:le=>q(le.target.value),placeholder:"e.g., Additional Demolition Work - Building A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Scope of Work *"}),e.jsx("textarea",{value:ee,onChange:le=>T(le.target.value),rows:4,placeholder:"Describe the scope of work covered by this change order..."})]}),o&&o.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Area (Optional)"}),e.jsxs("select",{value:D,onChange:le=>w(le.target.value),children:[e.jsx("option",{value:"",children:"No specific area"}),o.map(le=>e.jsx("option",{value:le.id,children:le.name},le.id))]})]})]}),g===2&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Work Period"}),e.jsx("p",{className:"step-description",children:"Specify the date range for this change order work."}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Start Date *"}),e.jsx("input",{type:"date",value:P,onChange:le=>I(le.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"End Date *"}),e.jsx("input",{type:"date",value:F,onChange:le=>J(le.target.value),min:P})]})]})]}),g===3&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Labor"}),e.jsx("p",{className:"step-description",children:"Add labor costs for this change order."})]}),e.jsxs("div",{className:"step-header-actions",children:[e.jsxs("button",{className:"btn btn-ghost",onClick:()=>V(!0),children:[e.jsx(Ua,{size:16})," Import from Tickets"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:xe,children:[e.jsx($a,{size:16})," Add Labor"]})]})]}),Z.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No labor items added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:xe,children:[e.jsx($a,{size:16})," Add First Labor Item"]})]}):e.jsx("div",{className:"line-items-list",children:Z.map((le,Se)=>e.jsxs("div",{className:"line-item labor-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",Se+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>_e(Se),children:e.jsx(_s,{size:14})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Labor Class"}),e.jsx("select",{value:le.labor_class,onChange:ue=>G(Se,"labor_class",ue.target.value),children:Cf.map(ue=>e.jsx("option",{value:ue,children:ue},ue))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Wage Type"}),e.jsx("select",{value:le.wage_type,onChange:ue=>G(Se,"wage_type",ue.target.value),children:zv.map(ue=>e.jsx("option",{value:ue.value,children:ue.label},ue.value))})]})]}),e.jsxs("div",{className:"form-row four-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reg Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:le.regular_hours,onChange:ue=>G(Se,"regular_hours",ue.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reg Rate ($/hr)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ia(le.regular_rate),onChange:ue=>G(Se,"regular_rate",bs(ue.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"OT Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:le.overtime_hours,onChange:ue=>G(Se,"overtime_hours",ue.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"OT Rate ($/hr)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ia(le.overtime_rate),onChange:ue=>G(Se,"overtime_rate",bs(ue.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:we(le.total)})]})]},le.id||Se))}),e.jsxs("div",{className:"section-subtotal",children:["Labor Subtotal: ",e.jsx("strong",{children:we(Le.labor_subtotal)})]})]}),g===4&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Materials"}),e.jsx("p",{className:"step-description",children:"Add material costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:Ye,children:[e.jsx($a,{size:16})," Add Material"]})]}),_.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No materials added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:Ye,children:[e.jsx($a,{size:16})," Add First Material"]})]}):e.jsx("div",{className:"line-items-list",children:_.map((le,Se)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",Se+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>We(Se),children:e.jsx(_s,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{type:"text",value:le.description,onChange:ue=>qe(Se,"description",ue.target.value),placeholder:"Material description"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:le.source_type,onChange:ue=>qe(Se,"source_type",ue.target.value),children:ad.materials.map(ue=>e.jsx("option",{value:ue.value,children:ue.label},ue.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:le.source_reference,onChange:ue=>qe(Se,"source_reference",ue.target.value),placeholder:"Ticket #, Invoice #"})]})]}),e.jsxs("div",{className:"form-row three-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:le.quantity,onChange:ue=>qe(Se,"quantity",ue.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit"}),e.jsx("select",{value:le.unit,onChange:ue=>qe(Se,"unit",ue.target.value),children:wf.map(ue=>e.jsx("option",{value:ue,children:ue},ue))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit Cost ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ia(le.unit_cost),onChange:ue=>qe(Se,"unit_cost",bs(ue.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:we(le.total)})]})]},le.id||Se))}),e.jsxs("div",{className:"section-subtotal",children:["Materials Subtotal: ",e.jsx("strong",{children:we(Le.materials_subtotal)})]})]}),g===5&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Equipment"}),e.jsx("p",{className:"step-description",children:"Add equipment rental costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:wt,children:[e.jsx($a,{size:16})," Add Equipment"]})]}),ae.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No equipment added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:wt,children:[e.jsx($a,{size:16})," Add First Equipment"]})]}):e.jsx("div",{className:"line-items-list",children:ae.map((le,Se)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",Se+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>kt(Se),children:e.jsx(_s,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{type:"text",value:le.description,onChange:ue=>Ie(Se,"description",ue.target.value),placeholder:"Equipment description"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:le.source_type,onChange:ue=>Ie(Se,"source_type",ue.target.value),children:ad.equipment.map(ue=>e.jsx("option",{value:ue.value,children:ue.label},ue.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:le.source_reference,onChange:ue=>Ie(Se,"source_reference",ue.target.value),placeholder:"Ticket #, Invoice #"})]})]}),e.jsxs("div",{className:"form-row three-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:le.quantity,onChange:ue=>Ie(Se,"quantity",ue.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit"}),e.jsx("select",{value:le.unit,onChange:ue=>Ie(Se,"unit",ue.target.value),children:wf.map(ue=>e.jsx("option",{value:ue,children:ue},ue))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit Cost ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ia(le.unit_cost),onChange:ue=>Ie(Se,"unit_cost",bs(ue.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:we(le.total)})]})]},le.id||Se))}),e.jsxs("div",{className:"section-subtotal",children:["Equipment Subtotal: ",e.jsx("strong",{children:we(Le.equipment_subtotal)})]})]}),g===6&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Subcontractors"}),e.jsx("p",{className:"step-description",children:"Add subcontractor costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:Ft,children:[e.jsx($a,{size:16})," Add Subcontractor"]})]}),M.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No subcontractors added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:Ft,children:[e.jsx($a,{size:16})," Add First Subcontractor"]})]}):e.jsx("div",{className:"line-items-list",children:M.map((le,Se)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",Se+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>Ut(Se),children:e.jsx(_s,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Company Name"}),e.jsx("input",{type:"text",value:le.company_name,onChange:ue=>Ot(Se,"company_name",ue.target.value),placeholder:"Subcontractor company name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description of Work"}),e.jsx("input",{type:"text",value:le.description,onChange:ue=>Ot(Se,"description",ue.target.value),placeholder:"Work performed"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:le.source_type,onChange:ue=>Ot(Se,"source_type",ue.target.value),children:ad.subcontractors.map(ue=>e.jsx("option",{value:ue.value,children:ue.label},ue.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:le.source_reference,onChange:ue=>Ot(Se,"source_reference",ue.target.value),placeholder:"Invoice #, Quote #"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Amount ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ia(le.amount),onChange:ue=>Ot(Se,"amount",bs(ue.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:we(le.total)})]})]},le.id||Se))}),e.jsxs("div",{className:"section-subtotal",children:["Subcontractors Subtotal: ",e.jsx("strong",{children:we(Le.subcontractors_subtotal)})]})]}),g===7&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Markups & Fees"}),e.jsx("p",{className:"step-description",children:"Configure markup percentages and additional fees."}),e.jsxs("div",{className:"markups-section",children:[e.jsx("h4",{children:"Markups"}),e.jsxs("div",{className:"markups-grid",children:[e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Labor Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Js(me),onChange:le=>Q(vn(le.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",we(Le.labor_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Materials Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Js(O),onChange:le=>$(vn(le.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",we(Le.materials_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Equipment Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Js(H),onChange:le=>ve(vn(le.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",we(Le.equipment_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Subcontractors Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Js(Ne),onChange:le=>Ae(vn(le.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",we(Le.subcontractors_markup_amount)]})]})]})]}),e.jsxs("div",{className:"fees-section",children:[e.jsx("h4",{children:"Additional Fees"}),e.jsxs("div",{className:"fees-grid",children:[e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"Liability Insurance"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Js(be),onChange:le=>Pe(vn(le.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",we(Le.liability_insurance_amount)]})]}),e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"Bond"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Js(Ve),onChange:le=>Te(vn(le.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",we(Le.bond_amount)]})]}),e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"City License Fee"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.001",min:"0",max:"100",value:Js(ht),onChange:le=>Yt(vn(le.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",we(Le.license_fee_amount)]})]})]})]})]}),g===8&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Summary"}),e.jsxs("div",{className:"cor-summary",children:[e.jsxs("div",{className:"summary-header",children:[e.jsx("div",{className:"summary-title",children:L||"Untitled COR"}),e.jsx("div",{className:"summary-number",children:se})]}),e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"Costs Breakdown"}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Labor (",Z.length," items)"]}),e.jsx("span",{children:we(Le.labor_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",bt(me),")"]}),e.jsx("span",{children:we(Le.labor_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Materials (",_.length," items)"]}),e.jsx("span",{children:we(Le.materials_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",bt(O),")"]}),e.jsx("span",{children:we(Le.materials_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Equipment (",ae.length," items)"]}),e.jsx("span",{children:we(Le.equipment_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",bt(H),")"]}),e.jsx("span",{children:we(Le.equipment_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Subcontractors (",M.length," items)"]}),e.jsx("span",{children:we(Le.subcontractors_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",bt(Ne),")"]}),e.jsx("span",{children:we(Le.subcontractors_markup_amount)})]})]}),e.jsxs("div",{className:"summary-subtotal",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:we(Le.cor_subtotal)})]}),e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"Additional Fees"}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Liability Insurance (",bt(be),")"]}),e.jsx("span",{children:we(Le.liability_insurance_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Bond (",bt(Ve),")"]}),e.jsx("span",{children:we(Le.bond_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["City License Fee (",bt(ht),")"]}),e.jsx("span",{children:we(Le.license_fee_amount)})]})]}),e.jsxs("div",{className:"summary-total",children:[e.jsx("span",{children:"COR Total"}),e.jsx("span",{children:we(Le.cor_total)})]})]})]}),g===9&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Submit Change Order Request"}),e.jsxs("div",{className:"submit-preview",children:[e.jsxs("div",{className:"preview-card",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx("span",{className:"preview-number",children:se}),e.jsx("span",{className:"preview-total",children:we(Le.cor_total)})]}),e.jsx("div",{className:"preview-title",children:L}),e.jsx("div",{className:"preview-scope",children:ee})]}),(()=>{const le=td(lt);return le.valid?e.jsx("div",{className:"validation-success",children:"Ready to submit for approval!"}):e.jsxs("div",{className:"validation-errors",children:[e.jsx(ml,{size:20}),e.jsxs("div",{children:[e.jsx("strong",{children:"Please fix the following issues:"}),e.jsx("ul",{children:le.errors.map((Se,ue)=>e.jsx("li",{children:Se},ue))})]})]})})(),e.jsxs("div",{className:"submit-actions",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:Rt,disabled:v,children:[e.jsx(xf,{size:16})," Save as Draft"]}),e.jsxs("button",{className:"btn btn-primary",onClick:_t,disabled:v||!td(lt).valid,children:[e.jsx(If,{size:16})," Submit for Approval"]})]})]})]})]}),e.jsxs("div",{className:"modal-footer cor-form-footer",children:[e.jsx("div",{className:"footer-left",children:g>1&&e.jsxs("button",{className:"btn btn-secondary",onClick:E,disabled:v,children:[e.jsx(Kx,{size:16})," Back"]})}),e.jsx("div",{className:"footer-center",children:e.jsxs("span",{className:"step-indicator",children:["Step ",g," of ",Di.length]})}),e.jsxs("div",{className:"footer-right",children:[g<Di.length&&e.jsxs("button",{className:"btn btn-primary",onClick:A,disabled:v,children:["Next ",e.jsx(Cn,{size:16})]}),g>1&&g<9&&e.jsxs("button",{className:"btn btn-ghost",onClick:Rt,disabled:v,children:[e.jsx(xf,{size:14})," Save Draft"]})]})]})]}),B&&e.jsx(Ov,{projectId:l.id,corId:c?.id,onImport:ut,onClose:()=>V(!1),onShowToast:x})]})}const Lv=l=>{const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return r?[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]:[30,41,59]},kf=l=>new Promise(r=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),r(c.toDataURL("image/png"))},o.onerror=()=>r(null),o.src=l});async function np(l,r,o,c={},m=null){const u=new Ri,x=u.internal.pageSize.getWidth(),g=u.internal.pageSize.getHeight(),f=20;let v=f;const y=fr(l),R=c.primaryColor?Lv(c.primaryColor):[30,58,138],X=[241,245,249];let B=null;if(c.logoUrl)try{B=await kf(c.logoUrl)}catch(P){console.error("Error loading logo:",P)}if(B)try{u.addImage(B,"PNG",f,v,40,15),v+=20}catch{u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...R),u.text(o?.name||"Company Name",f,v+10),v+=20}else u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...R),u.text(o?.name||"Company Name",f,v+10),v+=20;u.setFontSize(20),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("CHANGE ORDER REQUEST",f,v),v+=10,u.setFontSize(12),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(l.cor_number||"COR-XXXX",f,v);const V=l.status?.replace("_"," ").toUpperCase()||"DRAFT";u.setTextColor(...R),u.text(V,x-f-u.getTextWidth(V),v),v+=12,u.setDrawColor(...R),u.setLineWidth(.5),u.line(f,v,x-f,v),v+=10,u.setFontSize(10),u.setTextColor(0,0,0);const L=f,q=x/2;u.setFont("helvetica","bold"),u.text("Project:",L,v),u.setFont("helvetica","normal"),u.text(r?.name||"Project Name",L+25,v),u.setFont("helvetica","bold"),u.text("Job #:",q,v),u.setFont("helvetica","normal"),u.text(r?.job_number||"N/A",q+25,v),v+=6,u.setFont("helvetica","bold"),u.text("Period:",L,v),u.setFont("helvetica","normal"),u.text(qi(l.period_start,l.period_end),L+25,v),u.setFont("helvetica","bold"),u.text("Date:",q,v),u.setFont("helvetica","normal"),u.text(Ka(l.created_at),q+25,v),v+=10,u.setFont("helvetica","bold"),u.setFontSize(12),u.text(l.title||"Untitled Change Order",f,v),v+=8,u.setFont("helvetica","normal"),u.setFontSize(10),u.setTextColor(80,80,80);const ee=u.splitTextToSize(l.scope_of_work||"No scope of work provided.",x-f*2);u.text(ee,f,v),v+=ee.length*5+10,l.change_order_labor?.length>0&&(u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("LABOR",f,v),v+=6,Ks(u,{startY:v,head:[["Class","Type","Reg Hrs","Reg Rate","OT Hrs","OT Rate","Total"]],body:l.change_order_labor.map(P=>[P.labor_class,P.wage_type,P.regular_hours.toString(),`$${ia(P.regular_rate)}/hr`,P.overtime_hours?.toString()||"-",P.overtime_hours?`$${ia(P.overtime_rate)}/hr`:"-",we(P.total)]),foot:[[{content:`Subtotal: ${we(y.labor_subtotal)}`,colSpan:5,styles:{halign:"right",fontStyle:"bold"}},{content:`+${bt(l.labor_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:we(y.labor_subtotal+y.labor_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:f,right:f},headStyles:{fillColor:R,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:X,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),l.change_order_materials?.length>0&&(v>g-80&&(u.addPage(),v=f),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("MATERIALS",f,v),v+=6,Ks(u,{startY:v,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:l.change_order_materials.map(P=>[P.description,P.source_reference||P.source_type,P.quantity.toString(),P.unit,`$${ia(P.unit_cost)}`,we(P.total)]),foot:[[{content:`Subtotal: ${we(y.materials_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${bt(l.materials_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:we(y.materials_subtotal+y.materials_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:f,right:f},headStyles:{fillColor:R,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:X,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),l.change_order_equipment?.length>0&&(v>g-80&&(u.addPage(),v=f),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("EQUIPMENT",f,v),v+=6,Ks(u,{startY:v,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:l.change_order_equipment.map(P=>[P.description,P.source_reference||P.source_type,P.quantity.toString(),P.unit,`$${ia(P.unit_cost)}`,we(P.total)]),foot:[[{content:`Subtotal: ${we(y.equipment_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${bt(l.equipment_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:we(y.equipment_subtotal+y.equipment_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:f,right:f},headStyles:{fillColor:R,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:X,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),l.change_order_subcontractors?.length>0&&(v>g-80&&(u.addPage(),v=f),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("SUBCONTRACTORS",f,v),v+=6,Ks(u,{startY:v,head:[["Company","Description","Source","Amount"]],body:l.change_order_subcontractors.map(P=>[P.company_name,P.description,P.source_reference||P.source_type,we(P.total)]),foot:[[{content:`Subtotal: ${we(y.subcontractors_subtotal)}`,colSpan:2,styles:{halign:"right",fontStyle:"bold"}},{content:`+${bt(l.subcontractors_markup_percent||500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:we(y.subcontractors_subtotal+y.subcontractors_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:f,right:f},headStyles:{fillColor:R,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:X,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),v>g-100&&(u.addPage(),v=f),u.setFillColor(...X),u.roundedRect(f,v,x-f*2,70,3,3,"F"),v+=10,u.setFontSize(10),u.setFont("helvetica","normal"),u.setTextColor(0,0,0);const T=f+10,D=x-f-60;u.text("COR Subtotal:",T,v),u.setFont("helvetica","bold"),u.text(we(y.cor_subtotal),D,v,{align:"right"}),v+=8,u.setFont("helvetica","normal"),u.setFontSize(9),u.text(`Liability Insurance (${bt(l.liability_insurance_percent||144)}):`,T,v),u.text(we(y.liability_insurance_amount),D,v,{align:"right"}),v+=6,u.text(`Bond (${bt(l.bond_percent||100)}):`,T,v),u.text(we(y.bond_amount),D,v,{align:"right"}),v+=6,u.text(`City License Fee (${bt(l.license_fee_percent||10)}):`,T,v),u.text(we(y.license_fee_amount),D,v,{align:"right"}),v+=10,u.setFillColor(...R),u.roundedRect(T-5,v-3,x-f*2-10,16,2,2,"F"),u.setTextColor(255,255,255),u.setFontSize(12),u.setFont("helvetica","bold"),u.text("COR TOTAL:",T,v+8),u.text(we(y.cor_total),D,v+8,{align:"right"}),v+=25,v>g-120&&(u.addPage(),v=f),v+=10,u.setTextColor(0,0,0),u.setFontSize(10),u.setFont("helvetica","bold"),u.text("AUTHORIZATION",f,v),v+=15,u.setFont("helvetica","normal"),u.setFontSize(9),u.setDrawColor(0,0,0);const w=(P,I,F,J,Z,j,_)=>{u.setFont("helvetica","bold"),u.setFontSize(8),u.text(I,f,P),u.setFont("helvetica","normal"),u.setFontSize(9);const S=P+20;if(u.line(f,S,f+70,S),u.text("Signature",f,S+8),u.line(f+85,S,f+145,S),u.text("Title / Company",f+85,S+8),u.line(x-f-40,S,x-f,S),u.text("Date",x-f-40,S+8),F)try{if(u.addImage(F,"PNG",f,S-18,60,18),J&&(u.setFontSize(8),u.text(J,f,S+15)),Z||j){const ae=[Z,j].filter(Boolean).join(" - ");u.text(ae,f+85,S-5)}_&&u.text(Ka(_),x-f-40,S-5)}catch(ae){console.error("Error adding signature:",ae)}return S+25};if(v=w(v,"GC AUTHORIZATION",l.gc_signature_data||l.gc_signature,l.gc_signature_name||l.gc_signer_name,l.gc_signature_title,l.gc_signature_company,l.gc_signature_date||l.signed_at),v+=10,v=w(v,"CLIENT AUTHORIZATION",l.client_signature_data,l.client_signature_name,l.client_signature_title,l.client_signature_company,l.client_signature_date),m&&m.length>0){u.addPage(),v=f,u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...R),u.text("T&M BACKUP DOCUMENTATION",f,v),v+=8,u.setFontSize(10),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(`${m.length} T&M ticket${m.length>1?"s":""} associated with this COR`,f,v),v+=12,u.setDrawColor(...R),u.setLineWidth(.5),u.line(f,v,x-f,v),v+=10;for(const P of m){v>g-100&&(u.addPage(),v=f),u.setFillColor(245,247,250),u.roundedRect(f,v,x-f*2,18,2,2,"F"),u.setFontSize(11),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text(`T&M Ticket  ${Ka(P.work_date)}`,f+5,v+7),P.ce_pco_number&&(u.setFontSize(9),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(`CE/PCO: ${P.ce_pco_number}`,f+5,v+14));const F={pending:[217,119,6],approved:[5,150,105],billed:[37,99,235]}[P.status]||[100,100,100];if(u.setFontSize(8),u.setTextColor(...F),u.text(P.status?.toUpperCase()||"PENDING",x-f-30,v+10),v+=24,P.notes){u.setFontSize(9),u.setFont("helvetica","italic"),u.setTextColor(80,80,80);const J=u.splitTextToSize(P.notes,x-f*2-10);u.text(J,f+5,v),v+=J.length*4+6}if(P.t_and_m_workers?.length>0&&(u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("Labor:",f+5,v),v+=4,Ks(u,{startY:v,head:[["Worker","Class","Hours","Rate","OT Hrs","OT Rate"]],body:P.t_and_m_workers.map(J=>[J.name,J.labor_class||"-",J.hours?.toString()||"0",J.rate?`$${J.rate}/hr`:"-",J.overtime_hours?.toString()||"-",J.overtime_rate?`$${J.overtime_rate}/hr`:"-"]),margin:{left:f+5,right:f},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),v=u.lastAutoTable.finalY+8),P.t_and_m_items?.length>0&&(v>g-60&&(u.addPage(),v=f),u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("Materials/Equipment:",f+5,v),v+=4,Ks(u,{startY:v,head:[["Item","Qty","Unit","Unit Cost","Total"]],body:P.t_and_m_items.map(J=>[J.materials_equipment?.name||J.description||"Item",J.quantity?.toString()||"1",J.materials_equipment?.unit||"ea",J.materials_equipment?.cost_per_unit?`$${J.materials_equipment.cost_per_unit}`:"-",J.materials_equipment?.cost_per_unit&&J.quantity?`$${(J.quantity*J.materials_equipment.cost_per_unit).toFixed(2)}`:"-"]),margin:{left:f+5,right:f},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),v=u.lastAutoTable.finalY+8),P.photos?.length>0){v>g-80&&(u.addPage(),v=f),u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text(`Photos (${P.photos.length}):`,f+5,v),v+=6;let J=f+5;const Z=45,j=35,_=3;for(let S=0;S<P.photos.length;S++){S>0&&S%_===0&&(J=f+5,v+=j+5),v+j>g-20&&(u.addPage(),v=f,J=f+5);try{const ae=await kf(P.photos[S]);ae?u.addImage(ae,"JPEG",J,v,Z,j):(u.setFillColor(240,240,240),u.rect(J,v,Z,j,"F"),u.setFontSize(7),u.setTextColor(150,150,150),u.text("Photo unavailable",J+5,v+j/2))}catch{u.setFillColor(240,240,240),u.rect(J,v,Z,j,"F"),u.setFontSize(7),u.setTextColor(150,150,150),u.text("Photo unavailable",J+5,v+j/2)}J+=Z+5}v+=j+10}v+=5,u.setDrawColor(200,200,200),u.setLineWidth(.2),u.line(f,v,x-f,v),v+=10}}const se=u.internal.getNumberOfPages();for(let P=1;P<=se;P++){u.setPage(P);const I=g-10;u.setFontSize(8),u.setTextColor(150,150,150),u.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,f,I),u.text(`Page ${P} of ${se}`,x-f,I,{align:"right"})}const ne=`${l.cor_number||"COR"}_${r?.job_number||"export"}${m?.length?"_with_backup":""}.pdf`;u.save(ne)}function Bv({onSave:l,onClose:r,signerName:o=""}){const c=p.useRef(null),[m,u]=p.useState(o),[x,g]=p.useState(!1),[f,v]=p.useState(!1),y=()=>{const T=c.current;return T?T.getContext("2d"):null},R=T=>{const D=c.current;if(!D)return{x:0,y:0};const w=D.getBoundingClientRect(),se=D.width/w.width,ne=D.height/w.height,P=T.touches?T.touches[0].clientX:T.clientX,I=T.touches?T.touches[0].clientY:T.clientY;return{x:(P-w.left)*se,y:(I-w.top)*ne}},X=T=>{T.preventDefault();const D=y();if(!D)return;const{x:w,y:se}=R(T);D.beginPath(),D.moveTo(w,se),v(!0),g(!0)},B=T=>{if(!f)return;T.preventDefault();const D=y();if(!D)return;const{x:w,y:se}=R(T);D.lineTo(w,se),D.stroke()},V=()=>{v(!1)},L=()=>{const T=c.current,D=y();!T||!D||(D.clearRect(0,0,T.width,T.height),g(!1))},q=T=>{if(!T)return;c.current=T;const D=T.getContext("2d");D.strokeStyle="#1e293b",D.lineWidth=2,D.lineCap="round",D.lineJoin="round"},ee=()=>{if(!x||!m.trim())return;const T=c.current;if(!T)return;const D=T.toDataURL("image/png");l({signature:D,signerName:m.trim(),signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:r,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"signature-title",children:"GC Signature"}),e.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close signature modal",children:e.jsx(kn,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Signer Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:m,onChange:T=>u(T.target.value),placeholder:"Enter full name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(Xf,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Sign below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:q,width:500,height:200,className:"signature-canvas",onMouseDown:X,onMouseMove:B,onMouseUp:V,onMouseLeave:V,onTouchStart:X,onTouchMove:B,onTouchEnd:V,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!x&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:L,disabled:!x,"aria-label":"Clear signature",children:[e.jsx(Pf,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("p",{className:"signature-legal",role:"note",children:"By signing above, I acknowledge that I have reviewed and approve this Change Order Request."})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:r,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:ee,disabled:!x||!m.trim(),"aria-label":"Save signature",children:[e.jsx(dr,{size:16,"aria-hidden":"true"})," Save Signature"]})]})]})})}function Hv({cor:l,project:r,company:o,areas:c,onClose:m,onEdit:u,onShowToast:x,onStatusChange:g}){const[f,v]=p.useState(!0),[y,R]=p.useState(l),[X,B]=p.useState(!1),[V,L]=p.useState(!1),q=p.useCallback(async()=>{try{const j=await ce.getCORById(l.id);j&&R(j)}catch(j){console.error("Error fetching COR details:",j),x?.("Error loading COR details","error")}finally{v(!1)}},[l.id,x]);p.useEffect(()=>{q()},[q]),p.useEffect(()=>{const j=ce.subscribeToCorTickets?.(l.id,()=>{q()});return()=>{j&&ce.unsubscribe?.(j)}},[l.id,q]);const ee=p.useMemo(()=>fr(y),[y]),T=sp(y.status),D=y.status==="pending_approval",w=y.status==="draft",se=j=>c?.find(S=>S.id===j)?.name||null,ne=async()=>{if(confirm("Approve this change order request?")){v(!0);try{await ce.approveCOR(y.id),R({...y,status:"approved",approved_at:new Date().toISOString()}),x?.("COR approved","success"),g?.()}catch(j){console.error("Error approving COR:",j),x?.("Error approving COR","error")}finally{v(!1)}}},P=async()=>{const j=prompt("Enter rejection reason (optional):");if(j!==null){v(!0);try{await ce.rejectCOR(y.id,j),R({...y,status:"rejected",rejection_reason:j}),x?.("COR rejected","success"),g?.()}catch(_){console.error("Error rejecting COR:",_),x?.("Error rejecting COR","error")}finally{v(!1)}}},I=async()=>{if(confirm("Mark this COR as billed?")){v(!0);try{await ce.markCORAsBilled(y.id),R({...y,status:"billed"}),x?.("COR marked as billed","success"),g?.()}catch(j){console.error("Error marking COR as billed:",j),x?.("Error updating status","error")}finally{v(!1)}}},F=async j=>{v(!0);try{await ce.saveCORSignature?.(y.id,{gc_signature:j.signature,gc_signer_name:j.signerName,signed_at:j.signedAt}),R({...y,gc_signature:j.signature,gc_signer_name:j.signerName,signed_at:j.signedAt}),B(!1),x?.("Signature saved","success"),g?.()}catch(_){console.error("Error saving signature:",_),x?.("Error saving signature","error")}finally{v(!1)}},J=y.status==="approved"&&!y.gc_signature,Z=async()=>{try{x?.("Generating PDF...","info"),await np(y,r,o),x?.("PDF downloaded","success")}catch(j){console.error("Error exporting PDF:",j),x?.("Error generating PDF","error")}};return f?e.jsx("div",{className:"modal-overlay",onClick:m,children:e.jsx("div",{className:"modal-content cor-detail-modal",onClick:j=>j.stopPropagation(),children:e.jsx("div",{className:"cor-detail-loading",children:"Loading COR details..."})})}):e.jsxs("div",{className:"modal-overlay",onClick:m,role:"dialog","aria-modal":"true","aria-labelledby":"cor-detail-title",children:[e.jsxs("div",{className:"modal-content cor-detail-modal",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"modal-header cor-detail-header",children:[e.jsxs("div",{className:"cor-detail-title-row",children:[e.jsxs("div",{children:[e.jsx("div",{className:"cor-detail-number",children:y.cor_number}),e.jsx("h2",{id:"cor-detail-title",children:y.title||"Untitled COR"})]}),e.jsx("button",{className:"close-btn",onClick:m,"aria-label":"Close COR details",children:e.jsx(kn,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"cor-detail-meta",children:[e.jsx("span",{className:"cor-detail-status",style:{backgroundColor:T.bgColor,color:T.color},children:T.label}),se(y.area_id)&&e.jsx("span",{className:"cor-detail-area",children:se(y.area_id)}),e.jsxs("span",{className:"cor-detail-period",children:[e.jsx(Nn,{size:14})," ",qi(y.period_start,y.period_end)]})]})]}),e.jsxs("div",{className:"modal-body cor-detail-body",children:[e.jsxs("div",{className:"cor-detail-section",children:[e.jsxs("h3",{children:[e.jsx(Ua,{size:18})," Scope of Work"]}),e.jsx("p",{className:"cor-scope-text",children:y.scope_of_work||"No scope of work provided."})]}),e.jsxs("div",{className:"cor-detail-section pricing-breakdown",children:[e.jsxs("h3",{children:[e.jsx(ol,{size:18})," Pricing Breakdown"]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(mr,{size:16}),e.jsx("span",{children:"Labor"})]}),e.jsx("span",{className:"category-subtotal",children:we(ee.labor_subtotal)})]}),y.change_order_labor?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"Reg Rate"}),e.jsx("th",{children:"OT Hrs"}),e.jsx("th",{children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:y.change_order_labor.map((j,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:j.labor_class}),e.jsx("td",{children:j.wage_type}),e.jsx("td",{children:j.regular_hours}),e.jsxs("td",{children:["$",ia(j.regular_rate),"/hr"]}),e.jsx("td",{children:j.overtime_hours||"-"}),e.jsx("td",{children:j.overtime_hours?`$${ia(j.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:we(j.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No labor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",bt(y.labor_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",we(ee.labor_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Wa,{size:16}),e.jsx("span",{children:"Materials"})]}),e.jsx("span",{className:"category-subtotal",children:we(ee.materials_subtotal)})]}),y.change_order_materials?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:y.change_order_materials.map((j,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:j.description}),e.jsx("td",{children:j.source_reference||j.source_type}),e.jsx("td",{children:j.quantity}),e.jsx("td",{children:j.unit}),e.jsxs("td",{children:["$",ia(j.unit_cost)]}),e.jsx("td",{className:"text-right",children:we(j.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No material items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",bt(y.materials_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",we(ee.materials_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(wn,{size:16}),e.jsx("span",{children:"Equipment"})]}),e.jsx("span",{className:"category-subtotal",children:we(ee.equipment_subtotal)})]}),y.change_order_equipment?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:y.change_order_equipment.map((j,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:j.description}),e.jsx("td",{children:j.source_reference||j.source_type}),e.jsx("td",{children:j.quantity}),e.jsx("td",{children:j.unit}),e.jsxs("td",{children:["$",ia(j.unit_cost)]}),e.jsx("td",{className:"text-right",children:we(j.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No equipment items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",bt(y.equipment_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",we(ee.equipment_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(dl,{size:16}),e.jsx("span",{children:"Subcontractors"})]}),e.jsx("span",{className:"category-subtotal",children:we(ee.subcontractors_subtotal)})]}),y.change_order_subcontractors?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:y.change_order_subcontractors.map((j,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:j.company_name}),e.jsx("td",{children:j.description}),e.jsx("td",{children:j.source_reference||j.source_type}),e.jsx("td",{className:"text-right",children:we(j.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No subcontractor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",bt(y.subcontractors_markup_percent||500),")"]}),e.jsxs("span",{children:["+",we(ee.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"cor-subtotal-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:we(ee.cor_subtotal)})]}),e.jsxs("div",{className:"pricing-category fees-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Rj,{size:16}),e.jsx("span",{children:"Additional Fees"})]}),e.jsx("span",{className:"category-subtotal",children:we(ee.additional_fees_total)})]}),e.jsxs("div",{className:"fees-list",children:[e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Jf,{size:14}),e.jsxs("span",{children:["Liability Insurance (",bt(y.liability_insurance_percent||144),")"]})]}),e.jsx("span",{className:"fee-amount",children:we(ee.liability_insurance_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Ua,{size:14}),e.jsxs("span",{children:["Bond (",bt(y.bond_percent||100),")"]})]}),e.jsx("span",{className:"fee-amount",children:we(ee.bond_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Ai,{size:14}),e.jsxs("span",{children:["City License Fee (",bt(y.license_fee_percent||10),")"]})]}),e.jsx("span",{className:"fee-amount",children:we(ee.license_fee_amount)})]})]})]}),e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:we(ee.cor_total)})]})]}),(y.gc_signature_data||y.gc_signature||y.client_signature_data)&&e.jsxs("div",{className:"cor-detail-section signature-section",children:[e.jsxs("h3",{children:[e.jsx(Qj,{size:18})," Signatures"]}),e.jsxs("div",{className:"dual-signatures",children:[(y.gc_signature_data||y.gc_signature)&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"GC Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:y.gc_signature_data||y.gc_signature,alt:"GC Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:y.gc_signature_name||y.gc_signer_name}),(y.gc_signature_title||y.gc_signature_company)&&e.jsxs("span",{className:"signer-org",children:[y.gc_signature_title,y.gc_signature_title&&y.gc_signature_company&&" - ",y.gc_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",Ka(y.gc_signature_date||y.signed_at)]})]})]})]}),y.client_signature_data&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"Client Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:y.client_signature_data,alt:"Client Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:y.client_signature_name}),(y.client_signature_title||y.client_signature_company)&&e.jsxs("span",{className:"signer-org",children:[y.client_signature_title,y.client_signature_title&&y.client_signature_company&&" - ",y.client_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",Ka(y.client_signature_date)]})]})]})]})]})]}),y.status==="rejected"&&y.rejection_reason&&e.jsxs("div",{className:"cor-detail-section rejection-section",children:[e.jsxs("h3",{children:[e.jsx(mf,{size:18})," Rejection Reason"]}),e.jsx("p",{className:"rejection-text",children:y.rejection_reason})]})]}),e.jsxs("div",{className:"modal-footer cor-detail-footer",children:[e.jsxs("div",{className:"footer-info",children:[e.jsxs("span",{children:["Created: ",Ka(y.created_at)]}),y.approved_at&&e.jsxs("span",{children:["Approved: ",Ka(y.approved_at)]})]}),e.jsxs("div",{className:"footer-actions",role:"group","aria-label":"COR actions",children:[w&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>u?.(y),disabled:f,"aria-label":"Edit this COR",children:[e.jsx(fd,{size:16,"aria-hidden":"true"})," Edit"]}),D&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-danger",onClick:P,disabled:f,"aria-label":"Reject this COR",children:[e.jsx(mf,{size:16,"aria-hidden":"true"})," Reject"]}),e.jsxs("button",{className:"btn btn-success",onClick:ne,disabled:f,"aria-label":"Approve this COR",children:[e.jsx(Ja,{size:16,"aria-hidden":"true"})," Approve"]})]}),J&&e.jsxs("button",{className:"btn btn-success",onClick:()=>B(!0),disabled:f,"aria-label":"Get GC signature for this COR",children:[e.jsx(Dj,{size:16,"aria-hidden":"true"})," Get GC Signature"]}),(y.status==="approved"||y.status==="pending_approval")&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>L(!0),disabled:f,"aria-label":"Get shareable signature link",children:[e.jsx(hd,{size:16,"aria-hidden":"true"})," Get Signature Link"]}),y.status==="approved"&&e.jsxs("button",{className:"btn btn-primary",onClick:I,disabled:f,"aria-label":"Mark this COR as billed",children:[e.jsx(ol,{size:16,"aria-hidden":"true"})," Mark Billed"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:Z,"aria-label":"Export COR to PDF",children:[e.jsx(Yf,{size:16,"aria-hidden":"true"})," Export PDF"]})]})]})]}),X&&e.jsx(Bv,{onSave:F,onClose:()=>B(!1),signerName:""}),V&&e.jsx(ap,{documentType:"cor",documentId:y.id,companyId:o?.id,projectId:r?.id,documentTitle:`COR ${y.cor_number}: ${y.title||"Untitled"}`,onClose:()=>L(!1),onShowToast:x})]})}const Ps=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l||0),Fv=l=>new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric"});function $v({dailyBurn:l,totalBurn:r,daysWorked:o,laborCost:c,haulOffCost:m,progress:u,contractValue:x,laborByDate:g=[],haulOffByDate:f=[]}){const[v,y]=p.useState(!1),R=x*(u/100)*.6,X=r<=R?"on-budget":r<=R*1.2?"warning":"over-budget",B={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[X],V=X==="on-budget"?Kf:X==="warning"?Cj:Ij,q=u>0?r/(u/100):0,ee=[],T={};g.forEach(w=>{T[w.date]||(T[w.date]={date:w.date,labor:0,haulOff:0,total:0}),T[w.date].labor=w.cost||0,T[w.date].total+=w.cost||0}),f.forEach(w=>{T[w.date]||(T[w.date]={date:w.date,labor:0,haulOff:0,total:0}),T[w.date].haulOff=w.cost||0,T[w.date].total+=w.cost||0}),Object.values(T).sort((w,se)=>new Date(se.date)-new Date(w.date)).slice(0,10).forEach(w=>ee.push(w));const D=Math.max(...ee.map(w=>w.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(pj,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${X}`,children:[e.jsx(V,{size:14}),e.jsx("span",{children:B})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:Ps(l)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),o>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",o," work day",o!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:Ps(r)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:Ps(c)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Disposal"}),e.jsx("span",{className:"burn-summary-value",children:Ps(m)})]})]}),u>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${q>x*.7?"warning":""}`,children:Ps(q)})]}),ee.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>y(!v),children:[v?e.jsx(Gf,{size:16}):e.jsx(tn,{size:16}),e.jsxs("span",{children:[v?"Hide":"View"," Daily Breakdown"]})]}),v&&ee.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Disposal"}),e.jsx("span",{children:"Total"})]}),ee.map(w=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:Fv(w.date)}),e.jsx("span",{className:"burn-labor",children:w.labor>0?Ps(w.labor):"-"}),e.jsx("span",{className:"burn-hauloff",children:w.haulOff>0?Ps(w.haulOff):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${w.total/D*100}%`}}),e.jsx("span",{className:"burn-amount",children:Ps(w.total)})]})]},w.date))]})]})}const sd=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l||0),Mi={labor:{label:"Labor",Icon:ca,color:"#3b82f6"},disposal:{label:"Disposal",Icon:wn,color:"#10b981"},equipment:{label:"Equipment",Icon:hr,color:"#f59e0b"},materials:{label:"Materials",Icon:Wa,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:mr,color:"#ec4899"},other:{label:"Other",Icon:Qf,color:"#6b7280"}};function Vv({laborCost:l=0,haulOffCost:r=0,customCosts:o=[],onAddCost:c,onDeleteCost:m}){const[u,x]=p.useState(!1),[g,f]=p.useState(null),v=[];l>0&&v.push({category:"labor",label:"Labor",amount:l,source:"auto",description:"From crew check-ins"}),r>0&&v.push({category:"disposal",label:"Disposal",amount:r,source:"auto",description:"From haul-off logs"});const y={};o.forEach(B=>{y[B.category]||(y[B.category]={category:B.category,items:[],total:0}),y[B.category].items.push(B),y[B.category].total+=parseFloat(B.amount)||0}),Object.values(y).forEach(B=>{const V=Mi[B.category]||Mi.other;v.push({category:B.category,label:V.label,amount:B.total,source:"manual",items:B.items})});const R=v.reduce((B,V)=>B+V.amount,0);v.forEach(B=>{B.percentage=R>0?B.amount/R*100:0}),v.sort((B,V)=>V.amount-B.amount);const X=B=>{f(g===B?null:B)};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:sd(R)})]}),v.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):e.jsx("div",{className:"cost-breakdown",children:v.map(B=>{const V=Mi[B.category]||Mi.other,L=V.Icon,q=B.items&&B.items.length>0,ee=g===B.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${q?"expandable":""}`,onClick:()=>q&&X(B.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(B.percentage,2)}%`,backgroundColor:V.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(L,{size:14,style:{color:V.color}}),e.jsx("span",{children:B.label}),B.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),q&&(ee?e.jsx(Gf,{size:14}):e.jsx(tn,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:sd(B.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(B.percentage),"%"]})]})]})]}),ee&&q&&e.jsx("div",{className:"cost-category-items",children:B.items.map(T=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:T.description}),e.jsx("span",{className:"cost-item-date",children:new Date(T.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:sd(T.amount)}),m&&e.jsx("button",{className:"cost-item-delete",onClick:D=>{D.stopPropagation(),confirm("Delete this cost entry?")&&m(T.id)},children:e.jsx(_s,{size:14})})]})]},T.id))})]},B.category)})}),c&&e.jsxs("button",{className:"cost-add-btn",onClick:c,children:[e.jsx($a,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const bn=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l||0);function Gv({revenue:l,totalCosts:r,contractValue:o,progress:c}){const m=l-r,u=l>0?m/l*100:0,x=o,g=c>0?r/(c/100):r,f=x-g,v=x>0?f/x*100:0,y=u>=20,R=u>=0&&u<20,X=u<0,B=y?"healthy":R?"warning":"loss",V=y?"On Track":R?"Watch Margin":"Over Cost",L=y?Ja:R?ml:Kf;return e.jsxs("div",{className:`profitability-card ${B}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${B}`,children:[e.jsx(L,{size:14}),e.jsx("span",{children:V})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${u<0?"negative":""}`,children:[Math.round(u),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${u<0?"negative":u<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(u),100)}%`}})})]}),c>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${v<0?"negative":""}`,children:[Math.round(v),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${v<0?"negative":v<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(v),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:bn(l)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",bn(r)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${m<0?"negative":"positive"}`,children:[m>=0?"":"-",bn(Math.abs(m))]})]})]}),c>10&&e.jsxs("div",{className:"profitability-insight",children:[y&&e.jsxs("p",{children:["At ",Math.round(c),"% complete, you're at ",bn(m)," profit.",f>0&&` Projected final profit: ${bn(f)}`]}),R&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",f<0&&` Trending toward ${bn(f)} loss.`]}),X&&e.jsxs("p",{children:["Currently over cost by ",bn(Math.abs(m)),". Immediate review recommended."]})]})]})}const Yv=[{value:"labor",label:"Labor",Icon:ca,description:"Additional labor costs"},{value:"materials",label:"Materials",Icon:Wa,description:"Materials and supplies"},{value:"equipment",label:"Equipment",Icon:hr,description:"Equipment rental or purchase"},{value:"subcontractor",label:"Subcontractor",Icon:mr,description:"Subcontractor work"},{value:"disposal",label:"Disposal",Icon:wn,description:"Additional disposal costs"},{value:"other",label:"Other",Icon:Qf,description:"Miscellaneous costs"}];function Qv({onClose:l,onSave:r,saving:o=!1}){const[c,m]=p.useState({category:"materials",description:"",amount:"",cost_date:new Date().toISOString().split("T")[0],notes:""}),[u,x]=p.useState({}),g=(y,R)=>{m(X=>({...X,[y]:R})),u[y]&&x(X=>({...X,[y]:null}))},f=()=>{const y={};c.description.trim()||(y.description="Description is required");const R=parseFloat(c.amount);return(isNaN(R)||R<=0)&&(y.amount="Enter a valid amount"),c.cost_date||(y.cost_date="Date is required"),x(y),Object.keys(y).length===0},v=y=>{y.preventDefault(),f()&&r(c)};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content add-cost-modal",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(ol,{size:20}),"Add Cost"]}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close",children:e.jsx(kn,{size:20})})]}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category *"}),e.jsx("div",{className:"category-grid",children:Yv.map(y=>{const R=y.Icon,X=c.category===y.value;return e.jsxs("button",{type:"button",className:`category-option ${X?"selected":""}`,onClick:()=>g("category",y.value),children:[e.jsx(R,{size:18}),e.jsx("span",{className:"category-label",children:y.label})]},y.value)})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-description",children:"Description *"}),e.jsx("input",{id:"cost-description",type:"text",value:c.description,onChange:y=>g("description",y.target.value),placeholder:"e.g., Excavator rental - Week 1",className:u.description?"error":""}),u.description&&e.jsx("span",{className:"form-error",children:u.description})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-amount",children:"Amount *"}),e.jsxs("div",{className:"input-with-prefix",children:[e.jsx("span",{className:"input-prefix",children:"$"}),e.jsx("input",{id:"cost-amount",type:"number",step:"0.01",min:"0",value:c.amount,onChange:y=>g("amount",y.target.value),placeholder:"0.00",className:u.amount?"error":""})]}),u.amount&&e.jsx("span",{className:"form-error",children:u.amount})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-date",children:"Date *"}),e.jsx("input",{id:"cost-date",type:"date",value:c.cost_date,onChange:y=>g("cost_date",y.target.value),className:u.cost_date?"error":""}),u.cost_date&&e.jsx("span",{className:"form-error",children:u.cost_date})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-notes",children:"Notes (optional)"}),e.jsx("textarea",{id:"cost-notes",value:c.notes,onChange:y=>g("notes",y.target.value),placeholder:"Additional details...",rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:l,disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?"Saving...":"Add Cost"})]})]})]})})}function Xv({company:l,onShowToast:r,navigateToProjectId:o,onProjectNavigated:c}){const[m,u]=p.useState([]),[x,g]=p.useState([]),[f,v]=p.useState(null),[y,R]=p.useState([]),[X,B]=p.useState(!0),[V,L]=p.useState(!1),[q,ee]=p.useState(null),[T,D]=p.useState(!1),[w,se]=p.useState(!1),[ne,P]=p.useState(!1),[I,F]=p.useState("overview"),[J,Z]=p.useState([]),[j,_]=p.useState(!1),[S,ae]=p.useState(null),[k,M]=p.useState(!1),[C,me]=p.useState(null),[Q,O]=p.useState(0),[$,H]=p.useState(!1),[ve,Ne]=p.useState(!1),Ae=p.useRef(null),be=p.useRef(!1),Pe=p.useRef(!1),Ve=p.useCallback((W={})=>{const{refreshAreas:he=!1,refreshCOR:Ce=!1,projectId:ke=null}=W;he&&ke&&(be.current=ke),Ce&&(Pe.current=!0),Ae.current&&clearTimeout(Ae.current),Ae.current=setTimeout(async()=>{be.current&&(await Yt(be.current),be.current=!1),Pe.current&&(O(Re=>Re+1),Pe.current=!1),await ht()},150)},[]);p.useEffect(()=>()=>{Ae.current&&clearTimeout(Ae.current)},[]),p.useEffect(()=>{if(l?.id){ht(),Te();const W=m.map(Ce=>Ce.id),he=W.length>0?ce.subscribeToCompanyActivity?.(l.id,W,{onMessage:()=>Ve(),onMaterialRequest:()=>Ve(),onTMTicket:()=>Ve(),onInjuryReport:()=>Ve()}):null;return()=>{he&&ce.unsubscribe?.(he)}}},[l?.id,m.length,Ve]);const Te=async()=>{try{const W=await ce.getDumpSites(l.id);Z(W||[])}catch(W){console.error("Error loading dump sites:",W)}};p.useEffect(()=>{if(o&&m.length>0){const W=m.find(he=>he.id===o);W&&(v(W),c?.())}},[o,m]),p.useEffect(()=>{if(f){Yt(f.id);const W=[],he=f.id,Ce=ce.subscribeToAreas?.(he,()=>{Ve({refreshAreas:!0,projectId:he})});Ce&&W.push(Ce);const ke=ce.subscribeToDailyReports?.(he,()=>{Ve()});ke&&W.push(ke);const Re=ce.subscribeToCrewCheckins?.(he,()=>{Ve()});Re&&W.push(Re);const et=ce.subscribeToHaulOffs?.(he,()=>{Ve()});et&&W.push(et);const Ze=ce.subscribeToCORs?.(he,()=>{Ve({refreshCOR:!0})});return Ze&&W.push(Ze),()=>{W.forEach(Ee=>ce.unsubscribe?.(Ee))}}},[f,Ve]);const ht=async()=>{try{const W=await ce.getProjects(l?.id);u(W);const he=await Promise.all(W.map(async Ce=>{try{const[ke,Re,et,Ze,Ee,De,Be,Fe,pt,zt]=await Promise.all([ce.getAreas(Ce.id).catch(()=>[]),ce.getTMTickets(Ce.id).catch(()=>[]),ce.getChangeOrderTotals(Ce.id).catch(()=>null),ce.getDailyReports(Ce.id,100).catch(()=>[]),ce.getInjuryReports(Ce.id).catch(()=>[]),ce.getMaterialRequests(Ce.id).catch(()=>[]),ce.calculateManDayCosts(Ce.id,l?.id,Ce.work_type||"demolition",Ce.job_type||"standard").catch(()=>null),ce.calculateHaulOffCosts(Ce.id).catch(()=>null),ce.getProjectCosts(Ce.id).catch(()=>[]),ce.getCORStats(Ce.id).catch(()=>null)]),Me=jf(ke),Ge=Me.progress,aa=et?.totalApprovedValue||0,es=Ce.contract_value+aa,Va=Me.isValueBased?Me.earnedValue:Ge/100*es,hl=Re.filter(ua=>ua.status==="pending").length,Ga=new Date;Ga.setDate(Ga.getDate()-7);const Ss=Ze.filter(ua=>new Date(ua.report_date)>=Ga).length,Cs=pt.reduce((ua,La)=>{const oa=parseFloat(La.amount);return ua+(isNaN(oa)?0:oa)},0),Ya=Be?.totalCost||0,Lt=Fe?.totalCost||0,fl=Ya+Lt+Cs,pl=Va-fl,ts=Va>0?pl/Va*100:0,as=Be?.byDate?.length||0,pr=Fe?.daysWithHaulOff||0,En=Math.max(as,pr),gl=Ya+Lt,Oi=En>0?gl/En:0,ja=uv({...Ce,progress:Ge},Be?.totalManDays||0);return{...Ce,areas:ke,progress:Ge,billable:Va,changeOrderValue:aa,revisedContractValue:es,changeOrderPending:et?.pendingCount||0,totalTickets:Re.length,pendingTickets:hl,approvedTickets:Re.filter(ua=>ua.status==="approved").length,dailyReportsCount:Ze.length,recentDailyReports:Ss,injuryReportsCount:Ee.length,lastDailyReport:Ze[0]?.report_date||null,pendingMaterialRequests:De.filter(ua=>ua.status==="pending").length,totalMaterialRequests:De.length,isValueBased:Me.isValueBased,earnedValue:Me.earnedValue,totalSOVValue:Me.totalValue,laborCost:Ya,laborDaysWorked:as,laborManDays:Be?.totalManDays||0,laborByDate:Be?.byDate||[],dailyBurn:Oi,haulOffCost:Lt,haulOffLoads:Fe?.totalLoads||0,haulOffDays:pr,haulOffByType:Fe?.byWasteType||{},haulOffByDate:Fe?.byDate||[],customCosts:pt,customCostTotal:Cs,totalBurn:gl,totalBurnDays:En,allCostsTotal:fl,currentProfit:pl,profitMargin:ts,corPendingValue:zt?.total_pending_value||0,corPendingCount:zt?.pending_count||0,corApprovedValue:zt?.total_approved_value||0,corBilledValue:zt?.total_billed_value||0,corTotalCount:zt?.total_cors||0,scheduleStatus:ja.scheduleStatus,scheduleVariance:ja.scheduleVariance,scheduleLabel:ja.scheduleLabel,laborStatus:ja.laborStatus,laborVariance:ja.laborVariance,laborLabel:ja.laborLabel,hasScheduleData:ja.hasScheduleData,hasLaborData:ja.hasLaborData,actualManDays:Be?.totalManDays||0,hasError:!1}}catch(ke){return console.error(`Error loading data for project ${Ce.id}:`,ke),{...Ce,areas:[],progress:0,billable:0,changeOrderValue:0,revisedContractValue:Ce.contract_value,changeOrderPending:0,totalTickets:0,pendingTickets:0,approvedTickets:0,dailyReportsCount:0,recentDailyReports:0,injuryReportsCount:0,lastDailyReport:null,pendingMaterialRequests:0,totalMaterialRequests:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corTotalCount:0,hasError:!0}}}));g(he)}catch(W){console.error("Error loading projects:",W),r("Error loading projects","error")}finally{B(!1)}},Yt=async W=>{try{const he=await ce.getAreas(W);R(he)}catch(he){console.error("Error loading areas:",he)}},Tt=W=>{v(W)},ft=()=>{v(null),R([]),L(!1),ee(null),F("overview"),ht()},At=()=>{ee({name:f.name,job_number:f.job_number||"",address:f.address||"",general_contractor:f.general_contractor||"",client_contact:f.client_contact||"",client_phone:f.client_phone||"",contract_value:f.contract_value,work_type:f.work_type||"demolition",job_type:f.job_type||"standard",pin:f.pin||"",default_dump_site_id:f.default_dump_site_id||"",areas:y.map(W=>({id:W.id,name:W.name,weight:W.weight,isNew:!1}))}),L(!0)},lt=()=>{L(!1),ee(null)},Le=(W,he)=>{ee(Ce=>({...Ce,[W]:he}))},Wt=(W,he,Ce)=>{ee(ke=>({...ke,areas:ke.areas.map((Re,et)=>et===W?{...Re,[he]:Ce}:Re)}))},A=()=>{ee(W=>({...W,areas:[...W.areas,{id:null,name:"",weight:"",isNew:!0}]}))},E=W=>{q.areas.length>1&&ee(he=>({...he,areas:he.areas.filter((Ce,ke)=>ke!==W)}))},fe=async()=>{if(!q.name.trim()){r("Please enter a project name","error");return}const W=parseFloat(q.contract_value);if(!W||W<=0){r("Please enter a valid contract value","error");return}if(q.pin&&q.pin.length!==4){r("PIN must be 4 digits","error");return}if(q.pin&&q.pin!==f.pin&&!await ce.isPinAvailable(q.pin,f.id)){r("This PIN is already in use","error");return}const he=q.areas.filter(ke=>ke.name.trim()&&parseFloat(ke.weight)>0);if(he.length===0){r("Please add at least one area","error");return}if(he.reduce((ke,Re)=>ke+parseFloat(Re.weight),0)!==100){r("Area weights must total 100%","error");return}D(!0);try{await ce.updateProject(f.id,{name:q.name.trim(),job_number:q.job_number?.trim()||null,address:q.address?.trim()||null,general_contractor:q.general_contractor?.trim()||null,client_contact:q.client_contact?.trim()||null,client_phone:q.client_phone?.trim()||null,contract_value:W,work_type:q.work_type||"demolition",job_type:q.job_type||"standard",pin:q.pin||null,default_dump_site_id:q.default_dump_site_id||null});const ke=y.map(Ze=>Ze.id),Re=q.areas.filter(Ze=>Ze.id).map(Ze=>Ze.id);for(const Ze of ke)Re.includes(Ze)||await ce.deleteArea(Ze);for(let Ze=0;Ze<he.length;Ze++){const Ee=he[Ze];Ee.id?await ce.updateArea(Ee.id,{name:Ee.name.trim(),weight:parseFloat(Ee.weight),sort_order:Ze}):await ce.createArea({project_id:f.id,name:Ee.name.trim(),weight:parseFloat(Ee.weight),status:"not_started",sort_order:Ze})}const et=await ce.getProject(f.id);v(et),await Yt(f.id),L(!1),ee(null),r("Project updated!","success")}catch(ke){console.error("Error saving project:",ke?.message||ke),r(ke?.message||"Error saving changes","error")}finally{D(!1)}},xe=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await ce.deleteProject(f.id),r("Project deleted","success"),ft()}catch(W){console.error("Error deleting project:",W),r("Error deleting project","error")}},G=p.useMemo(()=>f?x.find(W=>W.id===f.id):null,[f,x]),_e=p.useMemo(()=>{if(!f)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const W=jf(y),he=W.progress,Ce=G?.changeOrderValue||0,ke=f.contract_value+Ce,Re=W.isValueBased?W.earnedValue:he/100*ke;return{progress:he,billable:Re,changeOrderValue:Ce,revisedContractValue:ke,isValueBased:W.isValueBased,earnedValue:W.earnedValue,totalSOVValue:W.totalValue}},[f,y,G]),Ye=p.useMemo(()=>{const W=x.reduce((De,Be)=>De+(Be.contract_value||0),0),he=x.reduce((De,Be)=>De+(Be.changeOrderValue||0),0),Ce=W+he,ke=x.reduce((De,Be)=>De+(Be.billable||0),0),Re=Ce-ke,et=Ce>0?Math.round(ke/Ce*100):0,Ze=x.reduce((De,Be)=>De+(Be.corPendingValue||0),0),Ee=x.reduce((De,Be)=>De+(Be.corPendingCount||0),0);return{totalOriginalContract:W,totalChangeOrders:he,totalPortfolioValue:Ce,totalEarned:ke,totalRemaining:Re,weightedCompletion:et,totalPendingCORValue:Ze,totalPendingCORCount:Ee}},[x]),qe=p.useMemo(()=>{let W=0,he=0,Ce=0,ke=0,Re=0;for(const et of x){const Ze=et.revisedContractValue||et.contract_value;et.progress>=100&&W++,et.progress<100&&et.billable<=Ze*(et.progress/100)*1.1&&he++,et.billable>Ze*.9&&et.progress<90&&Ce++,et.billable>Ze&&ke++,(et.changeOrderValue||0)>0&&Re++}return{projectsComplete:W,projectsOnTrack:he,projectsAtRisk:Ce,projectsOverBudget:ke,projectsWithChangeOrders:Re}},[x]),We=p.useMemo(()=>{let W=0,he=0,Ce=0,ke=0,Re=0,et=0;for(const Ze of x)Ze.hasScheduleData&&(Ze.scheduleStatus==="ahead"?W++:Ze.scheduleStatus==="behind"?Ce++:he++),Ze.hasLaborData&&(Ze.laborStatus==="over"?ke++:Ze.laborStatus==="under"?Re++:et++);return{scheduleAhead:W,scheduleOnTrack:he,scheduleBehind:Ce,laborOver:ke,laborUnder:Re,laborOnTrack:et,hasAnyScheduleData:W+he+Ce>0,hasAnyLaborData:ke+Re+et>0}},[x]);p.useEffect(()=>{const W=async()=>{for(const he of x)if(mv(he,30)){console.log(`Auto-archiving completed project: ${he.name}`);try{await ce.archiveProject(he.id),r(`Project "${he.name}" has been auto-archived after 30 days of completion`,"info")}catch(Ce){console.error("Failed to auto-archive project:",Ce)}}};x.length>0&&W()},[]);const{totalOriginalContract:wt,totalChangeOrders:Ie,totalPortfolioValue:kt,totalEarned:Ft,totalRemaining:Ot,weightedCompletion:Ut,totalPendingCORValue:ut,totalPendingCORCount:Rt}=Ye,{projectsComplete:_t,projectsOnTrack:le,projectsAtRisk:Se,projectsOverBudget:ue,projectsWithChangeOrders:Xe}=qe,{scheduleAhead:St,scheduleOnTrack:Et,scheduleBehind:ct,laborOver:It,laborUnder:Jt,laborOnTrack:ta,hasAnyScheduleData:N,hasAnyLaborData:pe}=We;if(X)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(f){const{progress:W,billable:he,changeOrderValue:Ce,revisedContractValue:ke,isValueBased:Re,earnedValue:et,totalSOVValue:Ze}=_e;if(V&&q){const Me=q.areas.reduce((Ge,aa)=>Ge+(parseFloat(aa.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:lt,style:{marginBottom:"1.5rem"},children:" Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:q.name,onChange:Ge=>Le("name",Ge.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:q.job_number,onChange:Ge=>Le("job_number",Ge.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:q.address,onChange:Ge=>Le("address",Ge.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:q.general_contractor,onChange:Ge=>Le("general_contractor",Ge.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:q.client_contact,onChange:Ge=>Le("client_contact",Ge.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:q.client_phone,onChange:Ge=>Le("client_phone",Ge.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:q.contract_value,onChange:Ge=>Le("contract_value",Ge.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:q.pin,onChange:Ge=>Le("pin",Ge.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:q.work_type,onChange:Ge=>Le("work_type",Ge.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:q.job_type,onChange:Ge=>Le("job_type",Ge.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:q.default_dump_site_id,onChange:Ge=>Le("default_dump_site_id",Ge.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),J.map(Ge=>e.jsx("option",{value:Ge.id,children:Ge.name},Ge.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),q.areas.map((Ge,aa)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:Ge.name,onChange:es=>Wt(aa,"name",es.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:Ge.weight,onChange:es=>Wt(aa,"weight",es.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>E(aa),children:""})]},aa)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Me===100?"valid":"invalid"}`,children:[Me,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:A,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:fe,disabled:T,style:{flex:1},children:T?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:xe,children:"Delete Project"})]})}const Ee=y.filter(Me=>Me.status==="done").length,De=y.filter(Me=>Me.status==="working").length,Be=y.filter(Me=>Me.status==="not_started").length,Fe=ke>0?Math.round(he/ke*100):0,pt=Ce>0,zt=[{id:"overview",label:"Overview",Icon:pf},{id:"financials",label:"Financials",Icon:ol},{id:"reports",label:"Reports",Icon:Oa},{id:"activity",label:"Activity",Icon:ys},{id:"info",label:"Info",Icon:ud}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:ft,children:[e.jsx("span",{children:""}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>se(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>P(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:At,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:f.name}),(f.job_number||f.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[f.job_number&&`Job #${f.job_number}`,f.job_number&&f.work_type&&"  ",f.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[W,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:Ct(he)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:Ct(ke-he)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:zt.map(Me=>e.jsxs("button",{className:`pv-tab ${I===Me.id?"active":""}`,onClick:()=>F(Me.id),children:[e.jsx(Me.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:Me.label})]},Me.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[I==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab",children:[e.jsx("div",{className:"overview-hero",children:e.jsxs("div",{className:"overview-hero-grid",children:[e.jsxs("div",{className:"overview-metric primary",children:[e.jsxs("div",{className:"overview-metric-value",children:[W,"%"]}),e.jsx("div",{className:"overview-metric-label",children:"Complete"}),e.jsx("div",{className:"overview-metric-bar",children:e.jsx("div",{className:"overview-metric-fill",style:{width:`${W}%`}})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsxs("div",{className:"overview-metric-value",children:[Ee,"/",y.length]}),e.jsx("div",{className:"overview-metric-label",children:"Areas Done"}),e.jsx("div",{className:"overview-metric-detail",children:De>0&&e.jsxs("span",{className:"working",children:[De," active"]})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value",children:Ct(ke)}),e.jsx("div",{className:"overview-metric-label",children:"Contract"}),pt&&e.jsxs("div",{className:"overview-metric-detail green",children:["+",Ct(Ce)," COs"]})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value green",children:Ct(he)}),e.jsx("div",{className:"overview-metric-label",children:"Earned"}),e.jsx("div",{className:"overview-metric-detail",children:Re?e.jsxs("span",{children:["of ",Ct(Ze)," SOV"]}):e.jsxs("span",{children:[Fe,"% billed"]})})]})]})}),(G?.pendingTickets>0||G?.pendingMaterialRequests>0||G?.changeOrderPending>0)&&e.jsxs("div",{className:"overview-attention-card",children:[e.jsxs("div",{className:"attention-header",children:[e.jsx("h3",{children:"Needs Attention"}),e.jsxs("span",{className:"attention-count",children:[(G?.pendingTickets||0)+(G?.pendingMaterialRequests||0)+(G?.changeOrderPending||0)," items"]})]}),e.jsxs("div",{className:"attention-items",children:[G?.pendingTickets>0&&e.jsxs("div",{className:"attention-item",onClick:()=>F("financials"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(Oa,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[G.pendingTickets," T&M ticket",G.pendingTickets!==1?"s":""," awaiting approval"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]}),G?.changeOrderPending>0&&e.jsxs("div",{className:"attention-item",onClick:()=>F("financials"),children:[e.jsx("div",{className:"attention-item-icon info",children:e.jsx(Ua,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[G.changeOrderPending," change order",G.changeOrderPending!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]}),G?.pendingMaterialRequests>0&&e.jsxs("div",{className:"attention-item",onClick:()=>F("activity"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(ys,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[G.pendingMaterialRequests," material request",G.pendingMaterialRequests!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Activity"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]})]})]}),e.jsxs("div",{className:"overview-section-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[Ee>0&&e.jsxs("span",{className:"section-badge done",children:[Ee," Complete"]}),De>0&&e.jsxs("span",{className:"section-badge working",children:[De," Active"]}),Be>0&&e.jsxs("span",{className:"section-badge pending",children:[Be," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list",children:y.map(Me=>e.jsxs("div",{className:`work-area-item ${Me.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[Me.status==="done"&&e.jsx("span",{className:"status-icon done",children:""}),Me.status==="working"&&e.jsx("span",{className:"status-icon working",children:""}),Me.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:""})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:Me.name}),e.jsx("span",{className:"work-area-weight",children:Me.scheduled_value?Ct(Me.scheduled_value):`${Me.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${Me.status}`,style:{width:Me.status==="done"?"100%":Me.status==="working"?"50%":"0%"}})})]},Me.id))})]}),e.jsxs("div",{className:"overview-stats-row",children:[e.jsxs("div",{className:"quick-stat-card",onClick:()=>F("reports"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(Oa,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:G?.dailyReportsCount||0}),e.jsx("span",{className:"quick-stat-label",children:"Daily Reports"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>F("financials"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(ol,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:G?.totalTickets||0}),e.jsx("span",{className:"quick-stat-label",children:"T&M Tickets"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>F("activity"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(ys,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:G?.totalMaterialRequests||0}),e.jsx("span",{className:"quick-stat-label",children:"Material Requests"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]})]})]}),I==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsx("div",{className:"financials-hero",children:e.jsxs("div",{className:"financials-hero-grid",children:[e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Contract"}),e.jsx("div",{className:"fin-metric-value",children:Ct(ke)}),pt&&e.jsxs("div",{className:"fin-metric-detail green",children:["+",Ct(Ce)," COs"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Earned"}),e.jsx("div",{className:"fin-metric-value",children:Ct(he)}),e.jsx("div",{className:"fin-metric-bar",children:e.jsx("div",{className:"fin-metric-fill",style:{width:`${Fe}%`}})})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Costs"}),e.jsx("div",{className:"fin-metric-value",children:Ct(G?.allCostsTotal||0)}),he>0&&e.jsxs("div",{className:`fin-metric-detail ${(G?.allCostsTotal||0)/he>.6?"warning":""}`,children:[Math.round((G?.allCostsTotal||0)/he*100),"% of revenue"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Profit"}),e.jsx("div",{className:`fin-metric-value ${(G?.currentProfit||0)<0?"negative":"positive"}`,children:Ct(G?.currentProfit||0)}),e.jsxs("div",{className:`fin-metric-detail ${(G?.profitMargin||0)<20?"warning":""}`,children:[Math.round(G?.profitMargin||0),"% margin"]})]})]})}),e.jsxs("div",{className:"financials-analysis-row",children:[e.jsx($v,{dailyBurn:G?.dailyBurn||0,totalBurn:G?.totalBurn||0,daysWorked:G?.totalBurnDays||0,laborCost:G?.laborCost||0,haulOffCost:G?.haulOffCost||0,progress:W,contractValue:ke,laborByDate:G?.laborByDate||[],haulOffByDate:G?.haulOffByDate||[]}),e.jsx(Gv,{revenue:he,totalCosts:G?.allCostsTotal||0,contractValue:ke,progress:W})]}),e.jsx(Vv,{laborCost:G?.laborCost||0,haulOffCost:G?.haulOffCost||0,customCosts:G?.customCosts||[],onAddCost:()=>H(!0),onDeleteCost:async Me=>{try{await ce.deleteProjectCost(Me),ht(),r("Cost deleted","success")}catch{r("Error deleting cost","error")}}}),e.jsxs("div",{className:"financials-pipeline",children:[e.jsxs("div",{className:"pipeline-header",children:[e.jsx("h2",{children:"Extra Work"}),e.jsxs("div",{className:"pipeline-flow",children:[e.jsx("span",{className:"pipeline-step",children:"T&M Tickets"}),e.jsx("span",{className:"pipeline-arrow",children:""}),e.jsx("span",{className:"pipeline-step active",children:"Change Orders"})]})]}),e.jsxs("div",{className:"pipeline-content",children:[e.jsxs("div",{className:"pipeline-section",children:[e.jsxs("div",{className:"pipeline-section-header",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("span",{className:"pipeline-badge",children:[G?.totalTickets||0," total",G?.pendingTickets>0&&`  ${G.pendingTickets} pending`]})]}),e.jsx(Nv,{project:f,company:l,onShowToast:r})]}),e.jsx("div",{className:"pipeline-section",children:e.jsx(qv,{project:f,company:l,areas:y,refreshKey:Q,onShowToast:r,onCreateCOR:()=>{ae(null),_(!0)},onViewCOR:Me=>{me(Me),M(!0)},onEditCOR:Me=>{ae(Me),_(!0)}})})]})]}),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(ca,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:Ct(G?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(Av,{project:f,company:l,onShowToast:r})})]})]}),I==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(Oa,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:G?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:G?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((G?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:`reports-metric ${(G?.injuryReportsCount||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"reports-metric-value",children:G?.injuryReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Injuries"}),e.jsx("div",{className:"reports-metric-status",children:(G?.injuryReportsCount||0)===0?"No incidents":"Review required"})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value small",children:G?.lastDailyReport?new Date(G.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"None"}),e.jsx("div",{className:"reports-metric-label",children:"Last Filed"}),G?.lastDailyReport&&e.jsxs("div",{className:"reports-metric-detail",children:[Math.floor((new Date-new Date(G.lastDailyReport))/(1e3*60*60*24))," days ago"]})]})]})}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(Oa,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[G?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(Mv,{project:f,company:l,onShowToast:r})})]}),e.jsxs("div",{className:`reports-section-card ${(G?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(G?.injuryReportsCount||0)>0?"warning":"success"}`,children:(G?.injuryReportsCount||0)>0?"":""}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(G?.injuryReportsCount||0)>0?"warning":"success"}`,children:(G?.injuryReportsCount||0)>0?`${G.injuryReportsCount} incident${G.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(wv,{project:f,companyId:l?.id||f?.company_id,company:l,onShowToast:r})})]})]}),I==="activity"&&e.jsxs("div",{className:"pv-tab-panel activity-tab",children:[e.jsx("div",{className:"activity-hero",children:e.jsxs("div",{className:"activity-hero-grid",children:[e.jsxs("div",{className:`activity-metric ${(G?.pendingMaterialRequests||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"activity-metric-icon",children:(G?.pendingMaterialRequests||0)>0?"!":""}),e.jsxs("div",{className:"activity-metric-content",children:[e.jsx("div",{className:"activity-metric-value",children:G?.pendingMaterialRequests||0}),e.jsx("div",{className:"activity-metric-label",children:"Pending"})]})]}),e.jsxs("div",{className:"activity-metric",children:[e.jsx("div",{className:"activity-metric-value",children:G?.totalMaterialRequests||0}),e.jsx("div",{className:"activity-metric-label",children:"Total Requests"})]}),e.jsxs("div",{className:"activity-metric",children:[e.jsxs("div",{className:"activity-metric-value",children:[G?.totalMaterialRequests>0?Math.round((G.totalMaterialRequests-(G.pendingMaterialRequests||0))/G.totalMaterialRequests*100):100,"%"]}),e.jsx("div",{className:"activity-metric-label",children:"Fulfilled"}),e.jsx("div",{className:"activity-metric-bar",children:e.jsx("div",{className:"activity-metric-fill",style:{width:`${G?.totalMaterialRequests>0?(G.totalMaterialRequests-(G.pendingMaterialRequests||0))/G.totalMaterialRequests*100:100}%`}})})]}),e.jsxs("div",{className:"activity-metric status",children:[e.jsx("div",{className:"activity-metric-status-icon",children:e.jsx(ys,{size:20})}),e.jsx("div",{className:"activity-metric-label",children:"Messages Active"})]})]})}),(G?.pendingMaterialRequests||0)>0&&e.jsxs("div",{className:"activity-attention-banner",children:[e.jsx("span",{className:"attention-icon",children:"!"}),e.jsxs("span",{className:"attention-text",children:[G.pendingMaterialRequests," material request",G.pendingMaterialRequests!==1?"s":""," awaiting response"]})]}),e.jsxs("div",{className:`activity-section-card ${(G?.pendingMaterialRequests||0)>0?"has-pending":""}`,children:[e.jsxs("div",{className:"activity-section-header",children:[e.jsxs("div",{className:"activity-section-title",children:[e.jsx(ca,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("div",{className:"activity-section-badges",children:[(G?.pendingMaterialRequests||0)>0&&e.jsxs("span",{className:"activity-badge pending",children:[G.pendingMaterialRequests," pending"]}),e.jsxs("span",{className:"activity-badge total",children:[G?.totalMaterialRequests||0," total"]})]})]}),e.jsx("div",{className:"activity-section-content",children:e.jsx(Ev,{project:f,company:l,onShowToast:r})})]}),e.jsxs("div",{className:"activity-section-card messages",children:[e.jsx("div",{className:"activity-section-header",children:e.jsxs("div",{className:"activity-section-title",children:[e.jsx(ys,{size:18}),e.jsx("h3",{children:"Project Messages"})]})}),e.jsx("div",{className:"activity-section-content",children:e.jsx(Tv,{project:f,company:l,userName:l?.name||"Office",onShowToast:r})})]})]}),I==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:f.name}),f.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",f.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:At,children:e.jsx("span",{children:"Edit Project"})})]}),f.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(_j,{size:14}),e.jsx("span",{children:f.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ca,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:f.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Ua,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:f.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ol,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:Ct(ke)}),e.jsx("span",{className:"info-quick-label",children:Ce>0?`Incl. +${Ct(Ce)} COs`:"Contract Value"})]})]}),f.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:f.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Ai,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[f.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:f.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),f.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:f.client_contact})]}),f.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(qj,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${f.client_phone}`,className:"info-detail-value link",children:f.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(pf,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[Ee>0&&e.jsxs("span",{className:"info-badge done",children:[Ee," Done"]}),De>0&&e.jsxs("span",{className:"info-badge working",children:[De," Active"]}),Be>0&&e.jsxs("span",{className:"info-badge pending",children:[Be," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:y.map(Me=>e.jsxs("div",{className:`info-area-item ${Me.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[Me.status==="done"&&e.jsx("span",{className:"status-dot done",children:""}),Me.status==="working"&&e.jsx("span",{className:"status-dot working",children:""}),Me.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:""})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:Me.name}),e.jsx("span",{className:`info-area-status-label ${Me.status}`,children:Me.status==="done"?"Complete":Me.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[Me.weight,"%"]})]},Me.id))})]}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(ud,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:Ct(f.contract_value)})]}),Ce>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",Ct(Ce)]})]}),f.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:J.find(Me=>Me.id===f.default_dump_site_id)?.name||"Unknown"})]})]})]})]})]}),w&&e.jsx(Sv,{project:f,onClose:()=>se(!1),onShareCreated:Me=>{r("Share link created successfully!","success")}}),ne&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(kv,{project:f,company:l,onShowToast:r,onClose:()=>P(!1)})}),j&&e.jsx(Uv,{project:f,company:l,areas:y,existingCOR:S,onClose:()=>{_(!1),ae(null)},onSaved:()=>{_(!1),ae(null),O(Me=>Me+1)},onShowToast:r}),k&&C&&e.jsx(Hv,{cor:C,project:f,company:l,areas:y,onClose:()=>{M(!1),me(null)},onEdit:Me=>{M(!1),me(null),ae(Me),_(!0)},onShowToast:r,onStatusChange:()=>{}}),$&&e.jsx(Qv,{onClose:()=>H(!1),saving:ve,onSave:async Me=>{try{Ne(!0),await ce.addProjectCost(f.id,l.id,Me),H(!1),ht(),r("Cost added successfully","success")}catch(Ge){console.error("Error adding cost:",Ge),r("Error adding cost","error")}finally{Ne(!1)}}})]})}return m.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Oa,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("div",{className:"bo-project-count",children:[m.length," Active Project",m.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(Ut,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Ct(Ft)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Ct(kt)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:Ct(Ot)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Ie>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:Ct(wt)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",Xe," project",Xe!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",Ct(Ie)]})]})]}),Rt>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:Ct(ut)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",Rt," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[_t>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:_t}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),le>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:le}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Se>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:Se}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),ue>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:ue}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),N&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[St>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:St}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),Et>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Et}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),ct>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:ct}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),pe&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),Jt>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[Jt," under"]}),ta>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[ta," on track"]}),It>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[It," over"]})]})]})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[m.length," active"]})]}),e.jsx("div",{className:"project-list",children:x.map(W=>e.jsx(Zv,{project:W,onClick:()=>Tt(W)},W.id))})]})}function Zv({project:l,onClick:r}){const o=Wf(l.areas||[]),c=dv(l.areas||[]),m=l.contract_value-l.billable,u=l.billable>l.contract_value*.9&&l.progress<90;return e.jsxs("div",{className:`project-card enhanced ${u?"at-risk":""}`,onClick:r,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:l.name}),e.jsx("div",{className:"project-card-value",children:Ct(l.contract_value)})]}),e.jsx("span",{className:`status-badge ${o}`,children:c})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[l.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:Ct(l.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${m<0?"negative":""}`,children:Ct(Math.abs(m))}),e.jsx("span",{className:"stat-label",children:m>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${l.progress}%`}})}),(l.pendingTickets>0||l.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[l.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[l.pendingTickets," Pending T&M"]}),l.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[l.approvedTickets," Approved T&M"]})]}),l.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${l.scheduleStatus}`,children:l.scheduleLabel}),l.hasLaborData&&l.laborLabel&&e.jsx("span",{className:`labor-indicator ${l.laborStatus}`,children:l.laborLabel})]})]})}const nd=l=>{if(l==null||l==="")return"";const r=parseFloat(l);return isNaN(r)?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)},Ef=l=>{if(!l)return null;const r=String(l).replace(/[$,\s]/g,""),o=parseFloat(r);return isNaN(o)?null:o};function Pv({company:l,user:r,onProjectCreated:o,onShowToast:c}){const[m,u]=p.useState(""),[x,g]=p.useState(""),[f,v]=p.useState(""),[y,R]=p.useState(""),[X,B]=p.useState(""),[V,L]=p.useState(""),[q,ee]=p.useState("demolition"),[T,D]=p.useState("standard"),[w,se]=p.useState([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),[ne,P]=p.useState(!1),[I,F]=p.useState(!1),[J,Z]=p.useState(!1),[j,_]=p.useState([]),[S,ae]=p.useState(!1),[k,M]=p.useState(""),[C,me]=p.useState(""),[Q,O]=p.useState(""),$=p.useRef(null),H=w.reduce((A,E)=>A+(parseFloat(E.weight)||0),0),ve=A=>{const E=A.replace(/\D/g,"").slice(0,4);L(E)},Ne=()=>{const A=Math.floor(1e3+Math.random()*9e3).toString();L(A)},Ae=(A,E,fe)=>{se(xe=>xe.map((G,_e)=>_e===A?{...G,[E]:fe}:G))},be=()=>{se(A=>[...A,{name:"",weight:"",group:"",scheduledValue:null}])},Pe=A=>{w.length>1&&se(E=>E.filter((fe,xe)=>xe!==A))},Ve=(A="value")=>{const E=w.filter(Ye=>Ye.name.trim());if(E.length===0){c("Add tasks first","error");return}let fe=[...w];const xe=w.map((Ye,qe)=>Ye.name.trim()?qe:-1).filter(Ye=>Ye>=0);if(A==="value"){const Ye=E.reduce((qe,We)=>qe+(parseFloat(We.scheduledValue)||0),0);if(Ye===0)c("No scheduled values - using equal distribution","info"),A="equal";else{let qe=0;xe.forEach((We,wt)=>{const Ie=parseFloat(w[We].scheduledValue)||0;let kt;wt===xe.length-1?kt=100-qe:(kt=Math.round(Ie/Ye*1e4)/100,qe+=kt),fe[We]={...fe[We],weight:kt.toFixed(2)}}),se(fe),ae(!1),c("Weights calculated by value","success");return}}const G=Math.round(100/xe.length*100)/100;let _e=0;xe.forEach((Ye,qe)=>{let We;qe===xe.length-1?We=100-_e:(We=G,_e+=We),fe[Ye]={...fe[Ye],weight:We.toFixed(2)}}),se(fe),ae(!1),c("Weights distributed equally","success")},Te=()=>{u(""),g(""),v(""),R(""),B(""),L(""),ee("demolition"),D("standard"),M(""),me(""),O(""),se([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),Z(!1),_([])},ht=()=>{$.current?.click()},Yt=A=>new Promise((E,fe)=>{const xe=new FileReader;xe.onload=G=>{try{const _e=new Uint8Array(G.target.result),Ye=px(_e,{type:"array"}),qe=Ye.SheetNames[0],We=Ye.Sheets[qe],wt=Is.sheet_to_json(We,{header:1}),Ie=[];let kt="General";const Ft=/^\$?\d{1,3}(,\d{3})*(\.\d{2})?$/,Ot=/^(\d+\.?\d*|[A-Z]\.?\d*)$/i,Ut=/^(SF|LF|EA|LS|Days?|MD|Load|CY|SY|GAL|TON)$/i,ut=/^\d{1,3}(,\d{3})*$|^\d+$/,Rt=/^(Item|#|No\.?|Description|Scheduled|Value|Amount|Quantity|Unit|Total|Application|Balance|Completed|Stored|Retainage)/i;for(const Se of wt){if(!Se||Se.length===0)continue;const ue=Se.map(pe=>pe==null?"":String(pe).trim()).filter(pe=>pe.length>0);if(ue.length===0)continue;const Xe=ue.join(" ");if(Rt.test(ue[0])||ue.length>1&&Rt.test(ue[1])||/^(Total|Subtotal|Grand Total|Base Bid|Contract Sum)/i.test(Xe))continue;const St=ue.some(pe=>Ft.test(pe.replace(/[$,]/g,"")+(pe.includes(".")?"":".00")));if((!St&&ue.length<=3&&/^(L\d|Level|Floor|\d+(?:st|nd|rd|th)|Plaza|Street|Basement|Roof|Penthouse|Site|Exterior|Interior|Misc|MEP|ABATEMENT|DEMOLITION|UNIVERSAL|SOFT|TRASH|DEMO|Phase|Division|Section|Area|Building|Wing)/i.test(ue[0])||ue.length===2&&Ot.test(ue[0])&&!St&&!/^\d+\.\d+$/.test(ue[0]))&&!St){kt=(ue.find(W=>!Ot.test(W)&&W.length>1)||ue.join(" ")).replace(/\s*\(\d{1,3}(?:,\d{3})*\s*SF\)\s*$/i,"").replace(/\s*[-:]\s*$/,"").trim();continue}let ct="",It=!1,Jt="",ta=null;const N=[];for(let pe=0;pe<ue.length;pe++){const W=ue[pe];if(pe===0&&Ot.test(W)){Jt=W;continue}if(!/^ID-\d+$/i.test(W)&&!/^KN\s*\d+$/i.test(W)){if(Ft.test(W.replace(/[$,]/g,"")+(W.includes(".")?"":".00"))||/^\$/.test(W)){const he=W.replace(/[$,]/g,""),Ce=parseFloat(he);!isNaN(Ce)&&Ce>100&&(ta===null||Ce>ta)&&(ta=Ce),It=!0;continue}if(ut.test(W.replace(/,/g,""))){It=!0;continue}Ut.test(W)||/^\d+\.?\d*%$/.test(W)||W.length>1&&!Ot.test(W)&&N.push(W)}}ct=N.join(" ").trim(),ct=ct.replace(/\s+/g," ").replace(/^[-]\s*/,"").trim(),!(ct.length<3)&&(/^(Plan|Page|Total|Base Bid|Payment|Condition|Exclusion|Subtotal)/i.test(ct)||It&&ct.length>=3&&Ie.push({name:ct,group:kt,itemNumber:Jt,scheduledValue:ta,selected:!0}))}const _t=new Set,le=Ie.filter(Se=>{const ue=`${Se.group}:${Se.name}`;return _t.has(ue)?!1:(_t.add(ue),!0)});E(le)}catch(_e){fe(_e)}},xe.onerror=()=>fe(new Error("Failed to read file")),xe.readAsArrayBuffer(A)}),Tt=async A=>{const E=A.target.files?.[0];if(!E)return;const fe=E.name.split(".").pop().toLowerCase();if(!["xlsx","xls","csv"].includes(fe)){c("Please upload an Excel file (.xlsx, .xls, or .csv)","error");return}F(!0);try{const xe=await Yt(E);if(xe.length===0){c("No tasks found. Check Excel format.","error"),F(!1);return}_(xe),Z(!0),c(`Found ${xe.length} tasks`,"success")}catch(xe){console.error("Excel import error:",xe),c("Error reading Excel file","error")}finally{F(!1),$.current&&($.current.value="")}},ft=A=>{_(E=>E.map((fe,xe)=>xe===A?{...fe,selected:!fe.selected}:fe))},At=()=>{const A=j.filter(G=>G.selected);if(A.length===0){c("Please select at least one task","error");return}const E=A.reduce((G,_e)=>G+(_e.scheduledValue||0),0),fe=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});let xe;if(E>0){let G=0;xe=A.map((_e,Ye)=>{const qe=_e.scheduledValue||0;let We;return Ye===A.length-1?We=100-G:(We=Math.round(qe/E*1e4)/100,G+=We),{name:_e.name,weight:We.toFixed(2),group:_e.group,scheduledValue:_e.scheduledValue||null}}),c(`Tasks imported with value-based weights! Total SOV: ${fe.format(E)}`,"success")}else{const G=Math.round(100/A.length*100)/100;xe=A.map((_e,Ye)=>({name:_e.name,weight:Ye===A.length-1?(100-G*(A.length-1)).toFixed(2):G.toFixed(2),group:_e.group,scheduledValue:_e.scheduledValue||null})),c("Tasks imported with equal weights","success")}se(xe),Z(!1)},lt=async()=>{if(!l?.id){c("No company selected. Please log in again.","error");return}if(!m.trim()){c("Please enter a project name","error");return}const A=parseFloat(X);if(!A||A<=0){c("Please enter a valid contract value","error");return}if(V.length!==4){c("Please enter a 4-digit PIN","error");return}if(!await ce.isPinAvailable(V)){c("This PIN is already in use. Try another.","error");return}const fe=w.filter(xe=>xe.name.trim()&&parseFloat(xe.weight)>0);if(fe.length===0){c("Please add at least one area","error");return}if(Math.abs(H-100)>.1){c("Area weights must total 100%","error");return}if(!k||!C){c("Start date and end date are required","error");return}if(new Date(C)<new Date(k)){c("End date must be on or after start date","error");return}P(!0);try{const xe=await ce.createProject({name:m.trim(),job_number:x.trim()||null,address:f.trim()||null,general_contractor:y.trim()||null,contract_value:A,pin:V,work_type:q,job_type:T,company_id:l?.id,created_by:r?.id,start_date:k,end_date:C,planned_man_days:Q?parseInt(Q):null});for(let G=0;G<fe.length;G++)await ce.createArea({project_id:xe.id,name:fe[G].name.trim(),weight:parseFloat(fe[G].weight),scheduled_value:fe[G].scheduledValue||null,group_name:fe[G].group||null,status:"not_started",sort_order:G});c("Project created!","success"),Te(),o()}catch(xe){console.error("Error creating project:",xe),c("Error creating project","error")}finally{P(!1)}};if(J){const A=[...new Set(j.map(G=>G.group))],E=j.filter(G=>G.selected).length,fe=j.reduce((G,_e)=>G+(_e.scheduledValue||0),0),xe=j.filter(G=>G.selected).reduce((G,_e)=>G+(_e.scheduledValue||0),0);return e.jsxs("div",{children:[e.jsx("h1",{children:"Review Imported Tasks"}),e.jsx("p",{className:"subtitle",children:"Select the tasks to include in your project"}),e.jsxs("div",{className:"import-summary",children:[e.jsxs("span",{children:[E," of ",j.length," tasks selected"]}),fe>0&&e.jsxs("span",{className:"import-sov-total",children:[" Total SOV: ",new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(xe)]})]}),A.map(G=>{const _e=j.filter(qe=>qe.group===G),Ye=_e.filter(qe=>qe.selected).length;return e.jsxs("div",{className:"card import-group",children:[e.jsxs("div",{className:"import-group-header",children:[e.jsx("h3",{children:G}),e.jsxs("span",{className:"import-group-count",children:[Ye,"/",_e.length]})]}),e.jsx("div",{className:"import-task-list",children:_e.map(qe=>{const We=j.indexOf(qe);return e.jsxs("label",{className:"import-task-item",children:[e.jsx("input",{type:"checkbox",checked:qe.selected,onChange:()=>ft(We)}),e.jsx("span",{className:"import-task-name",children:qe.name}),qe.scheduledValue>0&&e.jsx("span",{className:"import-task-value",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(qe.scheduledValue)})]},We)})})]},G)}),e.jsxs("div",{className:"import-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>Z(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:At,children:["Use Selected Tasks (",E,")"]})]})]})}const Le=w.reduce((A,E,fe)=>{const xe=E.group||"General";return A[xe]||(A[xe]=[]),A[xe].push({...E,originalIndex:fe}),A},{}),Wt=Object.keys(Le).length>1||Object.keys(Le).length===1&&!Le.General;return e.jsxs("div",{children:[e.jsx("h1",{children:"New Project"}),e.jsx("p",{className:"subtitle",children:"Set up a new project to track"}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Name"}),e.jsx("input",{type:"text",placeholder:"e.g., Sunrise Apartments",value:m,onChange:A=>u(A.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",placeholder:"e.g., 4032",value:x,onChange:A=>g(A.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($)"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"e.g., 365000",value:X,onChange:A=>{const E=A.target.value.replace(/[^0-9.]/g,"");B(E)},className:"currency-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",placeholder:"e.g., 123 Main St, Los Angeles, CA 90001",value:f,onChange:A=>v(A.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",placeholder:"e.g., ABC Construction Inc.",value:y,onChange:A=>R(A.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Start Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:k,onChange:A=>M(A.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["End Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:C,onChange:A=>me(A.target.value),min:k||void 0,required:!0}),k&&C&&new Date(C)<new Date(k)&&e.jsx("span",{className:"error-text",children:"End date must be after start date"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Planned Man-Days ",e.jsx("span",{className:"optional",children:"(optional)"})]}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Total estimated man-days to complete the project"}),e.jsx("input",{type:"number",inputMode:"numeric",placeholder:"e.g., 120",value:Q,onChange:A=>O(A.target.value.replace(/\D/g,"")),min:"1"})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${q==="demolition"?"active":""}`,onClick:()=>ee("demolition"),children:"Demolition"}),e.jsx("button",{type:"button",className:`toggle-btn ${q==="abatement"?"active":""}`,onClick:()=>ee("abatement"),children:"Abatement"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${T==="standard"?"active":""}`,onClick:()=>D("standard"),children:"Standard"}),e.jsx("button",{type:"button",className:`toggle-btn ${T==="pla"?"active":""}`,onClick:()=>D("pla"),children:"PLA"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN (4 digits)"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Foremen will enter this PIN to access this project"}),e.jsxs("div",{className:"pin-input-row",children:[e.jsx("input",{type:"text",placeholder:"e.g., 2847",value:V,onChange:A=>ve(A.target.value),maxLength:4,className:"pin-input"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Ne,children:"Generate"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"areas-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Areas / Tasks"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginTop:"0.25rem"},children:"Define the areas for this project. Weights must total 100%."})]}),e.jsxs("div",{className:"import-btn-container",children:[e.jsx("input",{ref:$,type:"file",accept:".xlsx,.xls,.csv",onChange:Tt,style:{display:"none"}}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:ht,disabled:I,children:I?"Reading...":" Import Excel"})]})]}),Wt?Object.entries(Le).map(([A,E])=>e.jsxs("div",{className:"area-group",children:[e.jsx("div",{className:"area-group-header",children:A}),E.map(fe=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Task name",value:fe.name,onChange:xe=>Ae(fe.originalIndex,"name",xe.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:fe.scheduledValue?nd(fe.scheduledValue):"",onChange:xe=>Ae(fe.originalIndex,"scheduledValue",Ef(xe.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:fe.weight,onChange:xe=>Ae(fe.originalIndex,"weight",xe.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>Pe(fe.originalIndex),children:""})]},fe.originalIndex))]},A)):w.map((A,E)=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Area name (e.g., Level 1)",value:A.name,onChange:fe=>Ae(E,"name",fe.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:A.scheduledValue?nd(A.scheduledValue):"",onChange:fe=>Ae(E,"scheduledValue",Ef(fe.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:A.weight,onChange:fe=>Ae(E,"weight",fe.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>Pe(E),children:""})]},E)),e.jsxs("div",{className:"weight-total-row",children:[e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Math.abs(H-100)<.1?"valid":"invalid"}`,children:[H.toFixed(1),"%"]}),w.some(A=>A.scheduledValue>0)&&e.jsxs("span",{className:"sov-total",children:[" SOV: ",nd(w.reduce((A,E)=>A+(parseFloat(E.scheduledValue)||0),0))]})]}),e.jsxs("div",{className:"auto-weight-dropdown",children:[e.jsx("button",{type:"button",className:"btn btn-secondary btn-small",onClick:()=>ae(!S),children:"Auto-Calculate "}),S&&e.jsxs("div",{className:"weight-dropdown-menu",children:[e.jsxs("button",{onClick:()=>Ve("value"),children:["By Value ",e.jsx("span",{className:"dropdown-hint",children:"(Recommended)"})]}),e.jsx("button",{onClick:()=>Ve("equal"),children:"Equal Distribution"})]})]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:be,children:"+ Add Area"})]}),e.jsx("button",{className:"btn btn-primary btn-full",onClick:lt,disabled:ne,children:ne?"Creating...":"Create Project"})]})}function Iv({company:l,onShowToast:r}){const{branding:o,updateBranding:c,uploadBrandingImage:m,loading:u}=ul(),[x,g]=p.useState(!1),[f,v]=p.useState(!1),[y,R]=p.useState(o),[X,B]=p.useState(""),[V,L]=p.useState(!1),q=p.useRef(null),ee=p.useRef(null),T=p.useRef(null);p.useEffect(()=>{l?.id&&D()},[l?.id]);const D=async()=>{try{const{data:S,error:ae}=await U.from("companies").select("office_code").eq("id",l.id).single();!ae&&S?.office_code&&B(S.office_code)}catch(S){console.error("Error loading office code:",S)}},w=async()=>{if(confirm("Regenerate office code? Current code will stop working immediately.")){L(!0);try{const S=Math.random().toString(36).substring(2,8).toUpperCase(),{error:ae}=await U.from("companies").update({office_code:S}).eq("id",l.id);if(ae)throw ae;B(S),r?.("Office code regenerated","success")}catch(S){console.error("Error regenerating code:",S),r?.("Error regenerating code","error")}finally{L(!1)}}},se=()=>{navigator.clipboard.writeText(X),r?.("Office code copied to clipboard","success")},ne=l?.subscription_tier||"free",P=["pro","business","enterprise"].includes(ne),I=["business","enterprise"].includes(ne),F=ne==="enterprise",J=(S,ae)=>{R(k=>({...k,[S]:ae}))},Z=async(S,ae)=>{if(S){if(S.size>5*1024*1024){r?.("Image must be smaller than 5MB","error");return}if(!S.type.startsWith("image/")){r?.("Please upload an image file","error");return}try{const k=await m(S,ae);k.success?(J(`${ae}_url`,k.url),r?.(`${ae.charAt(0).toUpperCase()+ae.slice(1)} uploaded successfully`,"success")):r?.(k.error||"Failed to upload image","error")}catch(k){console.error("Upload error:",k),r?.("Failed to upload image","error")}}},j=async()=>{try{g(!0);const S=/^#[0-9A-F]{6}$/i;if(!S.test(y.primary_color)){r?.("Primary color must be a valid hex color (e.g., #3B82F6)","error");return}if(!S.test(y.secondary_color)){r?.("Secondary color must be a valid hex color (e.g., #1E40AF)","error");return}const ae=await c(y);ae.success?r?.("Branding settings saved successfully!","success"):r?.(ae.error||"Failed to save branding settings","error")}catch(S){console.error("Save error:",S),r?.("Failed to save branding settings","error")}finally{g(!1)}},_=()=>{f?(document.documentElement.style.setProperty("--primary-color",o.primary_color),document.documentElement.style.setProperty("--secondary-color",o.secondary_color),document.title=o.custom_app_name||"FieldSync"):(document.documentElement.style.setProperty("--primary-color",y.primary_color),document.documentElement.style.setProperty("--secondary-color",y.secondary_color),document.title=y.custom_app_name||"FieldSync"),v(!f)};return u?e.jsxs("div",{className:"settings-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading branding settings..."})]}):e.jsxs("div",{className:"branding-settings",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("h2",{children:" Branding Settings"}),ne==="free"&&e.jsx("div",{className:"tier-badge tier-free",children:"Free Plan - Upgrade for branding options"}),ne==="pro"&&e.jsx("div",{className:"tier-badge tier-pro",children:"Pro Plan"}),ne==="business"&&e.jsx("div",{className:"tier-badge tier-business",children:"Business Plan"}),ne==="enterprise"&&e.jsx("div",{className:"tier-badge tier-enterprise",children:"Enterprise Plan"})]}),e.jsxs("div",{className:"settings-section security-section",children:[e.jsx("h3",{children:"Security"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Office Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Share this code with office staff only. Required to create new office accounts."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:X||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:se,disabled:!X,children:"Copy"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:w,disabled:V,children:V?"...":"Regenerate"})]}),e.jsx("p",{className:"help-text",style:{marginTop:"0.5rem",color:"var(--accent-amber)"},children:"Field workers should NOT have this code - they use project PINs only."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Company Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Public code for employees to find your company."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:l?.code||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:()=>{navigator.clipboard.writeText(l?.code||""),r?.("Company code copied","success")},disabled:!l?.code,children:"Copy"})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Visual Identity"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Logo"}),P?e.jsxs(e.Fragment,{children:[y.logo_url&&e.jsx("div",{className:"logo-preview",children:e.jsx("img",{src:y.logo_url,alt:"Logo preview"})}),e.jsx("input",{ref:q,type:"file",accept:"image/*",style:{display:"none"},onChange:S=>Z(S.target.files[0],"logo")}),e.jsx("button",{className:"btn-secondary",onClick:()=>q.current?.click(),children:y.logo_url?"Change Logo":"Upload Logo"}),e.jsx("p",{className:"help-text",children:"Recommended: 200x60px, PNG with transparent background"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your logo"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"app-name",children:"App Name"}),P?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"app-name",type:"text",className:"input",value:y.custom_app_name||"",onChange:S=>J("custom_app_name",S.target.value),placeholder:"FieldSync",maxLength:50}),e.jsx("p",{className:"help-text",children:"This name appears in the browser tab and throughout the app"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your app name"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"primary-color",children:"Primary Color"}),P?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"primary-color",type:"color",value:y.primary_color||"#3B82F6",onChange:S=>J("primary_color",S.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:y.primary_color||"#3B82F6",onChange:S=>J("primary_color",S.target.value),placeholder:"#3B82F6",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"secondary-color",children:"Secondary Color"}),P?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"secondary-color",type:"color",value:y.secondary_color||"#1E40AF",onChange:S=>J("secondary_color",S.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:y.secondary_color||"#1E40AF",onChange:S=>J("secondary_color",S.target.value),placeholder:"#1E40AF",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Favicon"}),P?e.jsxs(e.Fragment,{children:[y.favicon_url&&e.jsx("div",{className:"favicon-preview",children:e.jsx("img",{src:y.favicon_url,alt:"Favicon preview"})}),e.jsx("input",{ref:ee,type:"file",accept:"image/*",style:{display:"none"},onChange:S=>Z(S.target.files[0],"favicon")}),e.jsx("button",{className:"btn-secondary",onClick:()=>ee.current?.click(),children:y.favicon_url?"Change Favicon":"Upload Favicon"}),e.jsx("p",{className:"help-text",children:"Recommended: 32x32px or 64x64px, PNG or ICO format"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your favicon"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Login Background"}),I?e.jsxs(e.Fragment,{children:[y.login_background_url&&e.jsx("div",{className:"background-preview",children:e.jsx("img",{src:y.login_background_url,alt:"Background preview"})}),e.jsx("input",{ref:T,type:"file",accept:"image/*",style:{display:"none"},onChange:S=>Z(S.target.files[0],"login_background")}),e.jsx("button",{className:"btn-secondary",onClick:()=>T.current?.click(),children:y.login_background_url?"Change Background":"Upload Background"}),e.jsx("p",{className:"help-text",children:"Recommended: 1920x1080px, JPG or PNG"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Business or Enterprise to customize login background"})})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"White-Label Options"}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:y.hide_fieldsync_branding||!1,onChange:S=>J("hide_fieldsync_branding",S.target.checked),disabled:!I}),e.jsx("span",{children:'Hide "Powered by FieldSync"'})]}),!I&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Email Branding"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-name",children:"From Name"}),e.jsx("input",{id:"email-from-name",type:"text",className:"input",value:y.email_from_name||"",onChange:S=>J("email_from_name",S.target.value),placeholder:"Your Company Name",disabled:!I}),!I&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-address",children:"From Email"}),e.jsx("input",{id:"email-from-address",type:"email",className:"input",value:y.email_from_address||"",onChange:S=>J("email_from_address",S.target.value),placeholder:"noreply@yourcompany.com",disabled:!I}),!I&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Custom Domain"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"custom-domain",children:"Domain"}),F?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"custom-domain",type:"text",className:"input",value:y.custom_domain||"",onChange:S=>J("custom_domain",S.target.value),placeholder:"app.yourcompany.com"}),y.custom_domain&&e.jsx("div",{className:`domain-status ${y.domain_verified?"verified":"pending"}`,children:y.domain_verified?e.jsx(e.Fragment,{children:" Connected"}):e.jsx(e.Fragment,{children:" DNS setup required"})}),e.jsx("p",{className:"help-text",children:"Contact support to configure DNS and SSL certificate for your custom domain"})]}):e.jsxs("div",{className:"upgrade-notice",children:[e.jsx("p",{children:" Enterprise plan required for custom domain support"}),e.jsx("p",{className:"help-text",children:"Custom domains allow you to host the app at your own URL (e.g., app.yourcompany.com)"})]})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:_,children:f?"Exit Preview":"Preview Changes"}),e.jsx("button",{className:"btn-primary",onClick:j,disabled:x||!P,children:x?"Saving...":"Save Changes"})]}),f&&e.jsx("div",{className:"preview-banner",children:"Preview Mode Active - Your changes are not yet saved"})]})}const ld=["foreman","operator","laborer"],rd=["demolition","abatement"],id=["standard","pla"];function Jv({company:l,onShowToast:r}){const[o,c]=p.useState({}),[m,u]=p.useState(!1),[x,g]=p.useState(!1),[f,v]=p.useState("demolition"),[y,R]=p.useState(!0);p.useEffect(()=>{l?.id&&B()},[l?.id]);const X=()=>{const D={};return rd.forEach(w=>{D[w]={},id.forEach(se=>{D[w][se]={},ld.forEach(ne=>{D[w][se][ne]={regular:"",overtime:""}})})}),D},B=async()=>{if(!K){c(X()),R(!1);return}const D=X();try{const{data:w,error:se}=await U.from("labor_rates").select("*").eq("company_id",l.id);if(se){c(D),R(!1);return}w&&w.length>0&&w.forEach(ne=>{D[ne.work_type]&&D[ne.work_type][ne.job_type]&&D[ne.work_type][ne.job_type][ne.role]&&(D[ne.work_type][ne.job_type][ne.role]={regular:ne.regular_rate||"",overtime:ne.overtime_rate||""})}),c(D)}catch(w){console.error("Error loading labor rates:",w),c(D)}finally{R(!1)}},V=async()=>{if(!K){r("Labor rates require database connection","error");return}g(!0);try{await U.from("labor_rates").delete().eq("company_id",l.id);const D=[];rd.forEach(se=>{id.forEach(ne=>{ld.forEach(P=>{const I=o[se]?.[ne]?.[P]||{regular:0,overtime:0};D.push({company_id:l.id,role:P,work_type:se,job_type:ne,regular_rate:parseFloat(I.regular)||0,overtime_rate:parseFloat(I.overtime)||0})})})});const{error:w}=await U.from("labor_rates").insert(D);if(w)throw w;r("Labor rates saved","success"),u(!1)}catch(D){console.error("Error saving labor rates:",D),r("Error saving rates: "+(D.message||"Unknown error"),"error")}finally{g(!1)}},L=(D,w,se,ne,P)=>{c(I=>({...I,[D]:{...I[D],[w]:{...I[D]?.[w],[se]:{...I[D]?.[w]?.[se],[ne]:P}}}}))},q=D=>D.charAt(0).toUpperCase()+D.slice(1),ee=D=>D.charAt(0).toUpperCase()+D.slice(1),T=D=>D==="pla"?"PLA (Prevailing Wage)":"Standard (Private)";return y?e.jsx("div",{className:"loading",children:"Loading labor rates..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"pricing-section-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Labor Rates"}),e.jsx("p",{className:"section-desc",children:"Configure hourly rates by role, work type, and job classification"})]}),m?e.jsxs("div",{className:"rate-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>{u(!1),B()},children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:V,disabled:x,children:x?"Saving...":"Save All Rates"})]}):e.jsx("button",{className:"btn btn-primary",onClick:()=>u(!0),children:"Edit Rates"})]}),e.jsx("div",{className:"work-type-tabs",children:rd.map(D=>e.jsx("button",{className:`work-type-tab ${f===D?"active":""}`,onClick:()=>v(D),children:ee(D)},D))}),e.jsx("div",{className:"labor-rates-container",children:id.map(D=>e.jsxs("div",{className:"job-type-section",children:[e.jsx("h3",{className:"job-type-header",children:T(D)}),e.jsxs("div",{className:"rates-table",children:[e.jsxs("div",{className:"rates-table-header",children:[e.jsx("div",{className:"rate-cell role-cell",children:"Role"}),e.jsx("div",{className:"rate-cell",children:"Regular"}),e.jsx("div",{className:"rate-cell",children:"Overtime"})]}),ld.map(w=>{const se=o[f]?.[D]?.[w]||{regular:"",overtime:""};return e.jsxs("div",{className:"rates-table-row",children:[e.jsx("div",{className:"rate-cell role-cell",children:q(w)}),e.jsx("div",{className:"rate-cell",children:m?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"number",value:se.regular,onChange:ne=>L(f,D,w,"regular",ne.target.value),placeholder:"0.00",step:"0.01"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value",children:["$",(parseFloat(se.regular)||0).toFixed(2),"/hr"]})}),e.jsx("div",{className:"rate-cell",children:m?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"number",value:se.overtime,onChange:ne=>L(f,D,w,"overtime",ne.target.value),placeholder:"0.00",step:"0.01"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value ot",children:["$",(parseFloat(se.overtime)||0).toFixed(2),"/hr"]})})]},w)})]})]},D))})]})}const Ti=["Containment","PPE","Disposal","Equipment"];function Kv({company:l,onShowToast:r}){const[o,c]=p.useState([]),[m,u]=p.useState(!0),[x,g]=p.useState("all"),[f,v]=p.useState(null),[y,R]=p.useState(!1),[X,B]=p.useState({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),[V,L]=p.useState([]),[q,ee]=p.useState(!1);p.useEffect(()=>{l?.id&&T()},[l?.id]);const T=async()=>{u(!0);try{const Z=await ce.getAllMaterialsEquipment(l.id);c(Z||[]),D(Z||[])}catch(Z){console.error("Error loading items:",Z),r("Error loading materials","error")}finally{u(!1)}},D=Z=>{const j={},_=[];Z.filter(ae=>ae.active!==!1).forEach(ae=>{const k=ae.name.toLowerCase().trim();j[k]||(j[k]=[]),j[k].push(ae)}),Object.entries(j).forEach(([ae,k])=>{k.length>1&&_.push({name:ae,items:k})}),L(_)},w=async Z=>{try{const j=Z.items.filter(ae=>ae.cost_per_unit>0),_=j.length>0?j[0]:Z.items[0],S=Z.items.filter(ae=>ae.id!==_.id);for(const ae of S)await ce.deleteMaterialEquipment(ae.id);r(`Merged ${Z.items.length} items into one`,"success"),T()}catch(j){console.error("Error merging duplicates:",j),r("Error merging duplicates","error")}},se=async()=>{if(confirm(`Merge all ${V.length} duplicate groups?`))try{for(const Z of V){const j=Z.items.filter(ae=>ae.cost_per_unit>0),_=j.length>0?j[0]:Z.items[0],S=Z.items.filter(ae=>ae.id!==_.id);for(const ae of S)await ce.deleteMaterialEquipment(ae.id)}r("All duplicates merged!","success"),T(),ee(!1)}catch(Z){console.error("Error merging all duplicates:",Z),r("Error merging duplicates","error")}},ne=async()=>{if(!X.name.trim()){r("Enter item name","error");return}try{await ce.createMaterialEquipment({company_id:l.id,name:X.name.trim(),category:X.category,unit:X.unit||"each",cost_per_unit:parseFloat(X.cost_per_unit)||0,active:!0}),r("Item added","success"),B({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),R(!1),T()}catch(Z){console.error("Error adding item:",Z),r("Error adding item","error")}},P=async Z=>{try{await ce.updateMaterialEquipment(Z.id,{name:Z.name,category:Z.category,unit:Z.unit,cost_per_unit:parseFloat(Z.cost_per_unit)||0}),r("Item updated","success"),v(null),T()}catch(j){console.error("Error updating item:",j),r("Error updating item","error")}},I=async Z=>{if(confirm("Delete this item?"))try{await ce.deleteMaterialEquipment(Z),r("Item deleted","success"),T()}catch(j){console.error("Error deleting item:",j),r("Error deleting item","error")}},F=x==="all"?o.filter(Z=>Z.active!==!1):o.filter(Z=>Z.category===x&&Z.active!==!1),J=F.reduce((Z,j)=>{const _=j.category||"Other";return Z[_]||(Z[_]=[]),Z[_].push(j),Z},{});return m?e.jsx("div",{className:"loading",children:"Loading materials..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"materials-header",children:[e.jsxs("div",{className:"materials-title",children:[e.jsx("h2",{children:"Materials & Equipment"}),e.jsxs("span",{className:"materials-count",children:[o.filter(Z=>Z.active!==!1).length," items"]})]}),e.jsxs("div",{className:"materials-actions",children:[V.length>0&&e.jsxs("button",{className:`btn btn-warning ${q?"active":""}`,onClick:()=>ee(!q),children:[V.length," Duplicates"]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>R(!0),children:"+ Add Item"})]})]}),q&&V.length>0&&e.jsxs("div",{className:"duplicates-panel",children:[e.jsxs("div",{className:"duplicates-header",children:[e.jsx("h3",{children:"Duplicate Items Found"}),e.jsxs("button",{className:"btn btn-success btn-small",onClick:se,children:["Merge All (",V.length,")"]})]}),e.jsx("div",{className:"duplicates-list",children:V.map((Z,j)=>e.jsxs("div",{className:"duplicate-group",children:[e.jsxs("div",{className:"duplicate-name",children:['"',Z.name,'" x ',Z.items.length]}),e.jsx("div",{className:"duplicate-items",children:Z.items.map(_=>e.jsxs("span",{className:"duplicate-item",children:[_.category," - $",_.cost_per_unit||0]},_.id))}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>w(Z),children:"Merge"})]},j))})]}),y&&e.jsxs("div",{className:"add-item-form",children:[e.jsx("h3",{children:"Add New Item"}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Item Name",value:X.name,onChange:Z=>B({...X,name:Z.target.value}),autoFocus:!0}),e.jsx("select",{value:X.category,onChange:Z=>B({...X,category:Z.target.value}),children:Ti.map(Z=>e.jsx("option",{value:Z,children:Z},Z))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Unit (e.g., each, day, hour)",value:X.unit,onChange:Z=>B({...X,unit:Z.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per unit",value:X.cost_per_unit,onChange:Z=>B({...X,cost_per_unit:Z.target.value}),step:"0.01"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>R(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:ne,children:"Add Item"})]})]}),e.jsxs("div",{className:"materials-filter",children:[e.jsx("button",{className:`filter-tab ${x==="all"?"active":""}`,onClick:()=>g("all"),children:"All"}),Ti.map(Z=>e.jsxs("button",{className:`filter-tab ${x===Z?"active":""}`,onClick:()=>g(Z),children:[Z,e.jsx("span",{className:"filter-count",children:o.filter(j=>j.category===Z&&j.active!==!1).length})]},Z))]}),e.jsxs("div",{className:"materials-list",children:[x==="all"?Object.entries(J).map(([Z,j])=>e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:Z}),e.jsx("div",{className:"category-items",children:j.map(_=>e.jsx(Df,{item:_,editingItem:f,setEditingItem:v,handleUpdateItem:P,handleDeleteItem:I,categories:Ti},_.id))})]},Z)):e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:x}),e.jsx("div",{className:"category-items",children:F.map(Z=>e.jsx(Df,{item:Z,editingItem:f,setEditingItem:v,handleUpdateItem:P,handleDeleteItem:I,categories:Ti},Z.id))})]}),F.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No items in this category"})})]})]})}function Df({item:l,editingItem:r,setEditingItem:o,handleUpdateItem:c,handleDeleteItem:m,categories:u}){return r?.id===l.id?e.jsx("div",{className:"material-item",children:e.jsxs("div",{className:"item-edit-form",children:[e.jsx("input",{type:"text",value:r.name,onChange:x=>o({...r,name:x.target.value})}),e.jsx("select",{value:r.category,onChange:x=>o({...r,category:x.target.value}),children:u.map(x=>e.jsx("option",{value:x,children:x},x))}),e.jsx("input",{type:"text",value:r.unit,onChange:x=>o({...r,unit:x.target.value}),placeholder:"Unit"}),e.jsx("input",{type:"number",value:r.cost_per_unit,onChange:x=>o({...r,cost_per_unit:x.target.value}),placeholder:"Cost",step:"0.01"}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>c(r),children:"Save"}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>o(null),children:"Cancel"})]})]})}):e.jsxs("div",{className:"material-item",children:[e.jsxs("div",{className:"item-info",children:[e.jsx("span",{className:"item-name",children:l.name}),e.jsx("span",{className:"item-unit",children:l.unit||"each"})]}),e.jsxs("div",{className:"item-cost",children:["$",(l.cost_per_unit||0).toFixed(2)]}),e.jsxs("div",{className:"item-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>o({...l}),title:"Edit",children:e.jsx(Zf,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:()=>m(l.id),title:"Delete",children:e.jsx(_s,{size:16})})]})]})}const Wv=[{id:"trash",label:"Trash",description:"General debris"},{id:"metal",label:"Metal",description:"Scrap metal (recyclable)"},{id:"copper",label:"Copper",description:"Copper scrap (recyclable)"},{id:"concrete",label:"Concrete",description:"Concrete/masonry"},{id:"hazardous",label:"Hazardous",description:"Hazardous materials"}];function ey({company:l,onShowToast:r}){const[o,c]=p.useState([]),[m,u]=p.useState(!0),[x,g]=p.useState(!1),[f,v]=p.useState(null),[y,R]=p.useState({name:"",address:"",notes:""}),[X,B]=p.useState(!1),[V,L]=p.useState({}),q=p.useRef({});p.useEffect(()=>{l?.id&&ee()},[l?.id]),p.useEffect(()=>()=>{Object.values(q.current).forEach(F=>clearTimeout(F))},[]);const ee=async()=>{u(!0);try{const F=await ce.getDumpSites(l.id);c(F||[])}catch(F){console.error("Error loading dump sites:",F),r("Error loading dump sites","error")}finally{u(!1)}},T=async()=>{if(!y.name.trim()){r("Please enter a site name","error");return}B(!0);try{await ce.createDumpSite(l.id,y.name,y.address,y.notes),r("Dump site added","success"),R({name:"",address:"",notes:""}),g(!1),ee()}catch(F){console.error("Error adding dump site:",F),r("Error adding dump site","error")}finally{B(!1)}},D=async()=>{if(!f?.name.trim()){r("Please enter a site name","error");return}B(!0);try{await ce.updateDumpSite(f.id,{name:f.name,address:f.address,notes:f.notes}),r("Dump site updated","success"),v(null),ee()}catch(F){console.error("Error updating dump site:",F),r("Error updating dump site","error")}finally{B(!1)}},w=async F=>{if(confirm("Are you sure you want to delete this dump site?"))try{await ce.deleteDumpSite(F),r("Dump site deleted","success"),ee()}catch(J){console.error("Error deleting dump site:",J),r("Error deleting dump site","error")}},se=p.useCallback(async(F,J,Z)=>{try{await ce.setDumpSiteRate(F,J,Z),c(j=>j.map(_=>{if(_.id===F){const S=[..._.dump_site_rates||[]],ae=S.findIndex(k=>k.waste_type===J);return ae>=0?S[ae]={...S[ae],estimated_cost_per_load:Z}:S.push({waste_type:J,estimated_cost_per_load:Z}),{..._,dump_site_rates:S}}return _})),L(j=>{const _={...j};return delete _[`${F}-${J}`],_})}catch(j){console.error("Error saving rate:",j?.message||j),r("Error saving rate","error")}},[r]),ne=(F,J,Z)=>{const j=`${F}-${J}`;L(_=>({..._,[j]:Z})),q.current[j]&&clearTimeout(q.current[j]),q.current[j]=setTimeout(()=>{const _=parseFloat(Z)||0;se(F,J,_)},500)},P=(F,J)=>{const Z=`${F.id}-${J}`;return V[Z]!==void 0?V[Z]:F.dump_site_rates?.find(_=>_.waste_type===J)?.estimated_cost_per_load??""},I=F=>{if(F===""||F===null||F===void 0)return"";const J=parseFloat(F);return J<0?`-$${Math.abs(J).toFixed(0)}`:`$${J.toFixed(0)}`};return m?e.jsx("div",{className:"loading",children:"Loading dump sites..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"dump-site-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Disposal & Haul-Off"}),e.jsx("p",{className:"section-desc",children:"Configure dump sites and estimated costs per load for each waste type. Use negative values for recyclables (metal, copper) to indicate revenue."})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>g(!0),children:"+ Add Dump Site"})]}),x&&e.jsxs("div",{className:"dump-site-form card",children:[e.jsx("h4",{children:"Add Dump Site"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:y.name,onChange:F=>R({...y,name:F.target.value}),placeholder:"e.g., Metro Landfill"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:y.address,onChange:F=>R({...y,address:F.target.value}),placeholder:"123 Main St, City"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:y.notes,onChange:F=>R({...y,notes:F.target.value}),placeholder:"Operating hours, contact, etc."})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>g(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:T,disabled:X,children:X?"Adding...":"Add Site"})]})]}),o.length===0?e.jsxs("div",{className:"dump-site-empty",children:[e.jsx("p",{children:"No dump sites configured yet."}),e.jsx("p",{children:"Add a dump site to start tracking haul-off costs."})]}):e.jsx("div",{className:"dump-sites-list",children:o.map(F=>e.jsxs("div",{className:"dump-site-card card",children:[f?.id===F.id?e.jsxs("div",{className:"dump-site-edit",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:f.name,onChange:J=>v({...f,name:J.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:f.address||"",onChange:J=>v({...f,address:J.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:f.notes||"",onChange:J=>v({...f,notes:J.target.value})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>v(null),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:D,disabled:X,children:X?"Saving...":"Save"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dump-site-info",children:[e.jsx("div",{className:"dump-site-name",children:F.name}),F.address&&e.jsx("div",{className:"dump-site-address",children:F.address}),F.notes&&e.jsx("div",{className:"dump-site-notes",children:F.notes})]}),e.jsxs("div",{className:"dump-site-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>v({...F}),title:"Edit",children:e.jsx(Zf,{size:16})}),e.jsx("button",{className:"btn-icon",onClick:()=>w(F.id),title:"Delete",children:e.jsx(_s,{size:16})})]})]}),e.jsxs("div",{className:"dump-site-rates",children:[e.jsx("div",{className:"rates-header",children:"Estimated Cost per Load"}),e.jsx("div",{className:"rates-grid",children:Wv.map(J=>e.jsxs("div",{className:"rate-item",children:[e.jsxs("label",{children:[e.jsx("span",{className:"rate-label",children:J.label}),e.jsx("span",{className:"rate-desc",children:J.description})]}),e.jsxs("div",{className:"rate-input-wrapper",children:[e.jsx("span",{className:"rate-prefix",children:"$"}),e.jsx("input",{type:"number",className:"rate-input",value:P(F,J.id),onChange:Z=>ne(F.id,J.id,Z.target.value),placeholder:"0"})]}),P(F,J.id)!==""&&e.jsxs("span",{className:`rate-preview ${parseFloat(P(F,J.id))<0?"revenue":"cost"}`,children:[I(P(F,J.id)),"/load"]})]},J.id))}),e.jsx("div",{className:"rates-note",children:"Tip: Use negative values for recyclables that generate revenue (e.g., -50 for metal)"})]})]},F.id))})]})}const ty=[{id:"labor",label:"Labor Rates",Icon:ca},{id:"materials",label:"Materials & Equipment",Icon:hr},{id:"disposal",label:"Disposal & Haul-Off",Icon:wn}];function ay({company:l,onShowToast:r}){const[o,c]=p.useState("labor");return e.jsxs("div",{className:"pricing-manager",children:[e.jsxs("div",{className:"pricing-header",children:[e.jsx("h1",{children:"Pricing Configuration"}),e.jsx("p",{className:"pricing-subtitle",children:"Set up labor rates, materials pricing, and disposal costs"})]}),e.jsx("div",{className:"pricing-tabs",children:ty.map(m=>e.jsxs("button",{className:`pricing-tab ${o===m.id?"active":""}`,onClick:()=>c(m.id),children:[e.jsx(m.Icon,{size:18,className:"pricing-tab-icon"}),e.jsx("span",{className:"pricing-tab-label",children:m.label})]},m.id))}),e.jsxs("div",{className:"pricing-content",children:[o==="labor"&&e.jsx(Jv,{company:l,onShowToast:r}),o==="materials"&&e.jsx(Kv,{company:l,onShowToast:r}),o==="disposal"&&e.jsx(ey,{company:l,onShowToast:r})]})]})}function sy({shareToken:l}){const[r,o]=p.useState(!0),[c,m]=p.useState(null),[u,x]=p.useState(null),[g,f]=p.useState(0),{branding:v}=ul();p.useEffect(()=>{y()},[l]);const y=async()=>{o(!0),m(null);try{const w=await ce.getPublicProjectData(l);if(!w){m("This share link is invalid or has expired.");return}x(w)}catch(w){console.error("Error loading public data:",w),m("Failed to load project data.")}finally{o(!1)}},R=w=>w?new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",X=w=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(w);if(r)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading project..."})]}),e.jsx("style",{children:cd})]});if(c)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx(zi,{size:48})}),e.jsx("h2",{children:c}),e.jsx("p",{children:"Please contact the project owner for a valid link."})]}),e.jsx("style",{children:cd})]});const{share:B,project:V,progress:L,areas:q,photos:ee,dailyReports:T,tmTickets:D}=u;return e.jsxs("div",{className:"public-view",children:[e.jsx("header",{className:"public-header",children:e.jsxs("div",{className:"container",children:[e.jsx(Ia,{size:"large"}),e.jsx("div",{className:"header-meta",children:e.jsxs("span",{className:"last-updated",children:["Last updated: ",R(V.updated_at||V.created_at)]})})]})}),e.jsx("main",{className:"public-main",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"project-header",children:[e.jsx("h1",{children:V.name}),V.address&&e.jsx("p",{className:"project-address",children:V.address})]}),B.permissions.progress&&e.jsxs("div",{className:"public-card progress-card",children:[e.jsx("h2",{children:"Project Progress"}),e.jsxs("div",{className:"progress-visual",children:[e.jsxs("div",{className:"progress-circle",children:[e.jsxs("svg",{viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"var(--primary-color, #3b82f6)",strokeWidth:"8",strokeDasharray:`${L*2.827} 282.7`,strokeLinecap:"round",transform:"rotate(-90 50 50)"})]}),e.jsxs("div",{className:"progress-percentage",children:[L,"%"]})]}),e.jsxs("div",{className:"progress-details",children:[e.jsx("div",{className:"progress-label",children:"Complete"}),q&&q.length>0&&e.jsxs("div",{className:"areas-summary",children:[q.filter(w=>w.status==="done").length," of ",q.length," areas completed"]})]})]}),q&&q.length>0&&e.jsxs("div",{className:"areas-list",children:[e.jsx("h3",{children:"Work Areas"}),q.map(w=>e.jsxs("div",{className:"area-item",children:[e.jsxs("div",{className:"area-info",children:[e.jsx("span",{className:"area-name",children:w.name}),e.jsxs("span",{className:"area-weight",children:[w.weight,"%"]})]}),e.jsx("div",{className:`area-status status-${w.status}`,children:w.status==="done"?" Complete":w.status==="working"?" In Progress":" Not Started"})]},w.id))]})]}),B.permissions.photos&&ee&&ee.length>0&&e.jsxs("div",{className:"public-card photos-card",children:[e.jsx("h2",{children:"Recent Photos"}),e.jsxs("div",{className:"photos-carousel",children:[e.jsxs("div",{className:"carousel-main",children:[ee[g]&&e.jsx("img",{src:ee[g].url,alt:`Project photo from ${R(ee[g].date)}`,className:"carousel-image"}),e.jsx("div",{className:"carousel-date",children:R(ee[g]?.date)})]}),e.jsx("div",{className:"carousel-thumbnails",children:ee.slice(0,10).map((w,se)=>e.jsx("div",{className:`thumbnail ${se===g?"active":""}`,onClick:()=>f(se),children:e.jsx("img",{src:w.url,alt:`Thumbnail ${se+1}`})},se))}),ee.length>1&&e.jsxs("div",{className:"carousel-controls",children:[e.jsx("button",{onClick:()=>f(w=>w>0?w-1:ee.length-1),className:"carousel-btn",children:""}),e.jsxs("span",{className:"carousel-counter",children:[g+1," / ",ee.length]}),e.jsx("button",{onClick:()=>f(w=>w<ee.length-1?w+1:0),className:"carousel-btn",children:""})]})]})]}),B.permissions.daily_reports&&T&&T.length>0&&e.jsxs("div",{className:"public-card reports-card",children:[e.jsx("h2",{children:"Daily Reports"}),e.jsx("div",{className:"reports-list",children:T.map((w,se)=>e.jsxs("div",{className:"report-item",children:[e.jsx("div",{className:"report-date",children:R(w.report_date)}),e.jsxs("div",{className:"report-content",children:[w.crew_count&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Crew:"})," ",w.crew_count," workers"]}),w.tasks_completed&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Tasks Completed:"})," ",w.tasks_completed]}),w.weather&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Weather:"})," ",w.weather]}),w.notes&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Notes:"})," ",w.notes]})]})]},se))})]}),B.permissions.tm_tickets&&D&&D.length>0&&e.jsxs("div",{className:"public-card tm-card",children:[e.jsx("h2",{children:"Time & Materials Tickets"}),e.jsx("div",{className:"tm-list",children:D.map((w,se)=>e.jsxs("div",{className:"tm-item",children:[e.jsxs("div",{className:"tm-header",children:[e.jsx("span",{className:"tm-date",children:R(w.work_date)}),e.jsx("span",{className:`tm-status status-${w.status}`,children:w.status})]}),w.description&&e.jsx("div",{className:"tm-description",children:w.description}),w.total_amount&&e.jsxs("div",{className:"tm-amount",children:["Total: ",X(w.total_amount)]})]},se))})]})]})}),e.jsx("footer",{className:"public-footer",children:e.jsx("div",{className:"container",children:!v?.hide_fieldsync_branding&&e.jsx("p",{children:"Powered by FieldSync"})})}),e.jsx("style",{children:cd})]})}const cd=`
  .public-view {
    min-height: 100vh;
    background-color: #f9fafb;
    display: flex;
    flex-direction: column;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 1rem;
    width: 100%;
  }

  /* Header */
  .public-header {
    background-color: white;
    border-bottom: 1px solid #e5e7eb;
    padding: 1.5rem 0;
  }

  .public-header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header-meta {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Main Content */
  .public-main {
    flex: 1;
    padding: 2rem 0;
  }

  .project-header {
    margin-bottom: 2rem;
  }

  .project-header h1 {
    font-size: 2rem;
    margin: 0 0 0.5rem 0;
    color: #111827;
  }

  .project-address {
    font-size: 1rem;
    color: #6b7280;
    margin: 0;
  }

  /* Cards */
  .public-card {
    background-color: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .public-card h2 {
    font-size: 1.5rem;
    margin: 0 0 1.5rem 0;
    color: #111827;
  }

  .public-card h3 {
    font-size: 1.125rem;
    margin: 1.5rem 0 1rem 0;
    color: #374151;
  }

  /* Progress Card */
  .progress-visual {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .progress-circle {
    position: relative;
    width: 150px;
    height: 150px;
    flex-shrink: 0;
  }

  .progress-circle svg {
    width: 100%;
    height: 100%;
  }

  .progress-percentage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary-color, #3b82f6);
  }

  .progress-details {
    flex: 1;
  }

  .progress-label {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.5rem;
  }

  .areas-summary {
    font-size: 1rem;
    color: #6b7280;
  }

  /* Areas List */
  .areas-list {
    border-top: 1px solid #e5e7eb;
    padding-top: 1rem;
  }

  .area-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f3f4f6;
  }

  .area-item:last-child {
    border-bottom: none;
  }

  .area-info {
    flex: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-right: 1rem;
  }

  .area-name {
    font-weight: 500;
    color: #374151;
  }

  .area-weight {
    color: #6b7280;
    font-size: 0.875rem;
  }

  .area-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
  }

  .area-status.status-done {
    background-color: #d1fae5;
    color: #065f46;
  }

  .area-status.status-working {
    background-color: #fef3c7;
    color: #92400e;
  }

  .area-status.status-not_started {
    background-color: #f3f4f6;
    color: #6b7280;
  }

  /* Photos Carousel */
  .photos-carousel {
    position: relative;
  }

  .carousel-main {
    position: relative;
    width: 100%;
    height: 400px;
    background-color: #111827;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .carousel-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .carousel-date {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
    color: white;
    padding: 1rem;
    text-align: center;
  }

  .carousel-thumbnails {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
  }

  .thumbnail {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s;
  }

  .thumbnail:hover {
    border-color: #d1d5db;
  }

  .thumbnail.active {
    border-color: var(--primary-color, #3b82f6);
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .carousel-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
  }

  .carousel-btn {
    background-color: white;
    border: 1px solid #d1d5db;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.25rem;
    transition: background-color 0.2s;
  }

  .carousel-btn:hover {
    background-color: #f3f4f6;
  }

  .carousel-counter {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Daily Reports */
  .reports-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .report-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .report-date {
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.75rem;
    font-size: 1.125rem;
  }

  .report-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .report-field {
    color: #374151;
    line-height: 1.5;
  }

  .report-field strong {
    color: #111827;
  }

  /* T&M Tickets */
  .tm-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .tm-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .tm-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .tm-date {
    font-weight: 600;
    color: #111827;
  }

  .tm-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: capitalize;
  }

  .tm-status.status-approved {
    background-color: #d1fae5;
    color: #065f46;
  }

  .tm-status.status-pending {
    background-color: #fef3c7;
    color: #92400e;
  }

  .tm-status.status-rejected {
    background-color: #fee2e2;
    color: #991b1b;
  }

  .tm-description {
    color: #374151;
    margin-bottom: 0.5rem;
  }

  .tm-amount {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--primary-color, #3b82f6);
  }

  /* Footer */
  .public-footer {
    background-color: white;
    border-top: 1px solid #e5e7eb;
    padding: 2rem 0;
    margin-top: auto;
  }

  .public-footer p {
    text-align: center;
    color: #6b7280;
    margin: 0;
    font-size: 0.875rem;
  }

  /* Loading & Error States */
  .loading-container,
  .error-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 2rem;
  }

  .spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #e5e7eb;
    border-top-color: var(--primary-color, #3b82f6);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .loading-container p {
    margin-top: 1rem;
    color: #6b7280;
  }

  .error-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .error-container h2 {
    color: #111827;
    margin: 0 0 0.5rem 0;
  }

  .error-container p {
    color: #6b7280;
    margin: 0;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .project-header h1 {
      font-size: 1.5rem;
    }

    .public-card {
      padding: 1.5rem;
    }

    .progress-visual {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .progress-circle {
      width: 120px;
      height: 120px;
    }

    .progress-percentage {
      font-size: 1.5rem;
    }

    .carousel-main {
      height: 300px;
    }

    .area-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .area-info {
      width: 100%;
      margin-right: 0;
    }
  }
`;function Mf({onSave:l,onClose:r,slot:o=1,documentType:c="cor",documentTitle:m="",signerName:u="",signerTitle:x="",signerCompany:g=""}){const f=p.useRef(null),[v,y]=p.useState(u),[R,X]=p.useState(x),[B,V]=p.useState(g),[L,q]=p.useState(!1),[ee,T]=p.useState(!1),[D,w]=p.useState(!1),se=o===1?"GC Authorization":"Client Authorization",ne=c==="cor"?"Change Order Request":"T&M Work Order",P=()=>{const k=f.current;return k?k.getContext("2d"):null},I=k=>{const M=f.current;if(!M)return{x:0,y:0};const C=M.getBoundingClientRect(),me=M.width/C.width,Q=M.height/C.height,O=k.touches?k.touches[0].clientX:k.clientX,$=k.touches?k.touches[0].clientY:k.clientY;return{x:(O-C.left)*me,y:($-C.top)*Q}},F=k=>{k.preventDefault();const M=P();if(!M)return;const{x:C,y:me}=I(k);M.beginPath(),M.moveTo(C,me),T(!0),q(!0)},J=k=>{if(!ee)return;k.preventDefault();const M=P();if(!M)return;const{x:C,y:me}=I(k);M.lineTo(C,me),M.stroke()},Z=()=>{T(!1)},j=()=>{const k=f.current,M=P();!k||!M||(M.clearRect(0,0,k.width,k.height),q(!1))},_=k=>{if(!k)return;f.current=k;const M=k.getContext("2d");M.strokeStyle="#1e293b",M.lineWidth=2,M.lineCap="round",M.lineJoin="round"},S=L&&v.trim()&&D,ae=()=>{if(!S)return;const k=f.current;if(!k)return;const M=k.toDataURL("image/png");l({signature:M,signerName:v.trim(),signerTitle:R.trim()||null,signerCompany:B.trim()||null,signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:r,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal enhanced",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"signature-header-info",children:[e.jsx("h2",{id:"signature-title",children:se}),m&&e.jsx("span",{className:"signature-doc-ref",children:m})]}),e.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close signature modal",children:e.jsx(kn,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"signature-slot-badge",children:[e.jsx(Jf,{size:14}),e.jsxs("span",{children:["Signature ",o," of 2"]})]}),e.jsxs("div",{className:"signature-fields",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Print Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:v,onChange:k=>y(k.target.value),placeholder:"Enter your full legal name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-fields-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-title",children:"Title"}),e.jsx("input",{id:"signer-title",type:"text",value:R,onChange:k=>X(k.target.value),placeholder:"e.g., Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-company",children:"Company"}),e.jsx("input",{id:"signer-company",type:"text",value:B,onChange:k=>V(k.target.value),placeholder:"e.g., ABC Construction"})]})]})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(Xf,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Draw your signature below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:_,width:500,height:180,className:"signature-canvas",onMouseDown:F,onMouseMove:J,onMouseUp:Z,onMouseLeave:Z,onTouchStart:F,onTouchMove:J,onTouchEnd:Z,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!L&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:j,disabled:!L,"aria-label":"Clear signature",children:[e.jsx(Pf,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("div",{className:"signature-acknowledgment",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:k=>w(k.target.checked)}),e.jsxs("span",{children:["I acknowledge that this electronic signature is legally binding and that I have reviewed and approve this ",ne,". I understand that my signature, name, and IP address will be recorded for verification purposes."]})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:r,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:ae,disabled:!S,"aria-label":"Submit signature",children:[e.jsx(dr,{size:16,"aria-hidden":"true"})," Submit Signature"]})]})]})})}const ir=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",ny=({status:l})=>{const r={draft:{label:"Draft",color:"#6b7280",bg:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bg:"#fef3c7"},approved:{label:"Approved",color:"#059669",bg:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bg:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bg:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bg:"#e5e7eb"}},o=r[l]||r.draft;return e.jsx("span",{className:"cor-status-badge",style:{color:o.color,backgroundColor:o.bg},children:o.label})};function ly({signatureToken:l}){const[r,o]=p.useState(!0),[c,m]=p.useState(null),[u,x]=p.useState(null),[g,f]=p.useState(null),[v,y]=p.useState(!1),[R,X]=p.useState(null),[B,V]=p.useState(!1),[L,q]=p.useState(null),[ee,T]=p.useState(!1);p.useEffect(()=>{D()},[l]);const D=async()=>{try{o(!0),m(null);const M=await ce.getSignatureRequestByToken(l);if(!M){m("This signature link is invalid or has expired.");return}if(M.status==="completed"){m("This document has already been fully signed.");return}if(M.status==="revoked"){m("This signature link has been revoked.");return}if(M.status==="expired"){m("This signature link has expired.");return}x(M);const C=await ce.getDocumentForSigning(M.document_type,M.document_id);if(!C){m("The document associated with this link could not be found.");return}f(C)}catch(M){console.error("Error loading signature data:",M),m("Unable to load signature request. Please try again.")}finally{o(!1)}},w=p.useMemo(()=>!g||u?.document_type!=="cor"?null:fr(g),[g,u]),se=()=>{if(!u)return{slot1:null,slot2:null,availableSlots:[]};const M=u.signatures||[],C=M.find(O=>O.signature_slot===1),me=M.find(O=>O.signature_slot===2),Q=[];return C||Q.push(1),me||Q.push(2),{slot1:C,slot2:me,availableSlots:Q}},ne=async()=>{try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return null}},P=async M=>{if(!(!u||!R))try{V(!0);const C=await ne(),me=await ce.addSignature(u.id,R,{...M,ipAddress:C,userAgent:navigator.userAgent});await ce.syncSignatureToDocument(me,u),await D(),y(!1),X(null),q(`Signature ${R} has been recorded successfully.`),setTimeout(()=>q(null),5e3)}catch(C){console.error("Error submitting signature:",C),m("Failed to submit signature. Please try again.")}finally{V(!1)}},I=M=>{X(M),y(!0)},F=async()=>{if(!(!g||!u))try{T(!0);let M=null;if(S)try{M=await ce.getCORTickets(g.id)}catch(me){console.warn("Failed to fetch T&M tickets for backup:",me)}const C={logoUrl:ae?.logo_url,primaryColor:ae?.branding_color};await np(g,k,ae,C,M),q("PDF downloaded successfully!"),setTimeout(()=>q(null),3e3)}catch(M){console.error("Download failed:",M),m("Failed to generate PDF. Please try again.")}finally{T(!1)}};if(r)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading document..."})]})});if(c)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-error",children:[e.jsx(ml,{size:48}),e.jsx("h2",{children:"Unable to Load Document"}),e.jsx("p",{children:c})]})});const{slot1:J,slot2:Z,availableSlots:j}=se(),_=j.length===0,S=u?.document_type==="cor",ae=g?.projects?.companies,k=g?.projects;if(!S){const M=g.t_and_m_workers?.length||0,C=g.t_and_m_workers?.reduce((me,Q)=>me+(Q.hours||0),0)||0;return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[ae?.logo_url?e.jsx("img",{src:ae.logo_url,alt:ae.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Ai,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:ae?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"T&M Ticket Signature"})]})]}),L&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(Ja,{size:18}),L]}),e.jsxs("main",{className:"signature-page-content",children:[e.jsxs("div",{className:"signature-document-card",children:[e.jsxs("div",{className:"document-card-header",children:[e.jsx(Ua,{size:20}),e.jsxs("div",{className:"document-card-title",children:[e.jsx("h2",{children:"T&M Ticket"}),e.jsx("span",{className:"document-subtitle",children:g.ce_pco_number?`CE/PCO: ${g.ce_pco_number}`:"Time & Materials"})]})]}),e.jsxs("div",{className:"document-card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Project"}),e.jsx("span",{className:"detail-value",children:k?.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Work Date"}),e.jsx("span",{className:"detail-value",children:ir(g.work_date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Workers"}),e.jsxs("span",{className:"detail-value",children:[M," (",C," hrs)"]})]}),g.notes&&e.jsxs("div",{className:"detail-row full-width",children:[e.jsx("span",{className:"detail-label",children:"Description"}),e.jsx("span",{className:"detail-value",children:g.notes})]})]})]}),e.jsxs("div",{className:"signature-status-section",children:[e.jsx("h3",{children:"Signatures Required"}),Tf(1,J,"GC Authorization",I,B),Tf(2,Z,"Client Authorization",I,B),_&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Ja,{size:24}),e.jsx("p",{children:"This document has been fully signed by all parties."})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),v&&R&&e.jsx(Mf,{slot:R,documentType:"tm_ticket",documentTitle:"T&M Ticket",onSave:P,onClose:()=>{y(!1),X(null)}})]})}return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[ae?.logo_url?e.jsx("img",{src:ae.logo_url,alt:ae.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Ai,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:ae?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"Change Order Request"})]})]}),L&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(Ja,{size:18}),L]}),e.jsxs("main",{className:"signature-page-content cor-full-document",children:[e.jsxs("div",{className:"cor-header-card",children:[e.jsxs("div",{className:"cor-header-top",children:[e.jsxs("div",{className:"cor-title-section",children:[e.jsx("h2",{className:"cor-number",children:g.cor_number}),e.jsx(ny,{status:g.status})]}),e.jsxs("div",{className:"cor-date",children:["Created ",ir(g.created_at)]})]}),e.jsx("h3",{className:"cor-title",children:g.title||"Untitled Change Order"}),e.jsxs("div",{className:"cor-info-grid",children:[e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Project"}),e.jsx("span",{className:"cor-info-value",children:k?.name})]}),k?.job_number&&e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Job #"}),e.jsx("span",{className:"cor-info-value",children:k.job_number})]}),e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Period"}),e.jsx("span",{className:"cor-info-value",children:qi(g.period_start,g.period_end)})]})]}),g.scope_of_work&&e.jsxs("div",{className:"cor-scope",children:[e.jsx("h4",{children:"Scope of Work"}),e.jsx("p",{children:g.scope_of_work})]})]}),g.change_order_labor?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(mr,{size:18}),e.jsx("h4",{children:"Labor"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{className:"text-right",children:"Reg Hrs"}),e.jsx("th",{className:"text-right",children:"Reg Rate"}),e.jsx("th",{className:"text-right",children:"OT Hrs"}),e.jsx("th",{className:"text-right",children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_labor.map((M,C)=>e.jsxs("tr",{children:[e.jsx("td",{children:M.labor_class}),e.jsx("td",{children:M.wage_type}),e.jsx("td",{className:"text-right",children:M.regular_hours}),e.jsxs("td",{className:"text-right",children:["$",ia(M.regular_rate),"/hr"]}),e.jsx("td",{className:"text-right",children:M.overtime_hours||"-"}),e.jsx("td",{className:"text-right",children:M.overtime_hours?`$${ia(M.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:we(M.total)})]},C))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(w.labor_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"5",className:"text-right",children:["+ ",bt(g.labor_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(w.labor_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"5",className:"text-right",children:e.jsx("strong",{children:"Labor Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:we(w.labor_subtotal+w.labor_markup_amount)})})]})]})]})})]}),g.change_order_materials?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Wa,{size:18}),e.jsx("h4",{children:"Materials"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_materials.map((M,C)=>e.jsxs("tr",{children:[e.jsx("td",{children:M.description}),e.jsx("td",{children:M.source_reference||M.source_type}),e.jsx("td",{className:"text-right",children:M.quantity}),e.jsx("td",{children:M.unit}),e.jsxs("td",{className:"text-right",children:["$",ia(M.unit_cost)]}),e.jsx("td",{className:"text-right",children:we(M.total)})]},C))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(w.materials_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",bt(g.materials_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(w.materials_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Materials Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:we(w.materials_subtotal+w.materials_markup_amount)})})]})]})]})})]}),g.change_order_equipment?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(wn,{size:18}),e.jsx("h4",{children:"Equipment"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_equipment.map((M,C)=>e.jsxs("tr",{children:[e.jsx("td",{children:M.description}),e.jsx("td",{children:M.source_reference||M.source_type}),e.jsx("td",{className:"text-right",children:M.quantity}),e.jsx("td",{children:M.unit}),e.jsxs("td",{className:"text-right",children:["$",ia(M.unit_cost)]}),e.jsx("td",{className:"text-right",children:we(M.total)})]},C))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(w.equipment_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",bt(g.equipment_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(w.equipment_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Equipment Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:we(w.equipment_subtotal+w.equipment_markup_amount)})})]})]})]})})]}),g.change_order_subcontractors?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(dl,{size:18}),e.jsx("h4",{children:"Subcontractors"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:g.change_order_subcontractors.map((M,C)=>e.jsxs("tr",{children:[e.jsx("td",{children:M.company_name}),e.jsx("td",{children:M.description}),e.jsx("td",{children:M.source_reference||M.source_type}),e.jsx("td",{className:"text-right",children:we(M.total)})]},C))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(w.subcontractors_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"2",className:"text-right",children:["+ ",bt(g.subcontractors_markup_percent||500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(w.subcontractors_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"2",className:"text-right",children:e.jsx("strong",{children:"Subcontractors Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:we(w.subcontractors_subtotal+w.subcontractors_markup_amount)})})]})]})]})})]}),e.jsxs("div",{className:"cor-totals-card",children:[e.jsx("h4",{children:"COR Summary"}),e.jsxs("div",{className:"cor-totals-grid",children:[e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:we(w.cor_subtotal)})]}),e.jsxs("div",{className:"cor-fees-section",children:[e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Liability Insurance (",bt(g.liability_insurance_percent||144),")"]}),e.jsx("span",{children:we(w.liability_insurance_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Bond (",bt(g.bond_percent||100),")"]}),e.jsx("span",{children:we(w.bond_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["City License Fee (",bt(g.license_fee_percent||10),")"]}),e.jsx("span",{children:we(w.license_fee_amount)})]})]}),e.jsxs("div",{className:"cor-grand-total",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:we(w.cor_total)})]})]})]}),e.jsxs("div",{className:"cor-signature-section",children:[e.jsx("h4",{children:"Authorization"}),e.jsx("p",{className:"signature-instruction",children:"By signing below, you authorize the above change order request and agree to the terms and costs outlined."}),e.jsxs("div",{className:"signature-slots-grid",children:[e.jsxs("div",{className:`signature-slot-card ${J?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[J?e.jsx(Ja,{size:20,className:"status-icon signed"}):e.jsx(Nn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Signature 1  GC Authorization"})]}),J?e.jsxs("div",{className:"slot-signed-info",children:[J.signature_data&&e.jsx("img",{src:J.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:J.signer_name}),(J.signer_title||J.signer_company)&&e.jsxs("span",{className:"signer-org",children:[J.signer_title,J.signer_title&&J.signer_company&&"  ",J.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",ir(J.signed_at)]})]}):e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>I(1),disabled:B,children:"Sign as GC"})]}),e.jsxs("div",{className:`signature-slot-card ${Z?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[Z?e.jsx(Ja,{size:20,className:"status-icon signed"}):e.jsx(Nn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Signature 2  Client Authorization"})]}),Z?e.jsxs("div",{className:"slot-signed-info",children:[Z.signature_data&&e.jsx("img",{src:Z.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:Z.signer_name}),(Z.signer_title||Z.signer_company)&&e.jsxs("span",{className:"signer-org",children:[Z.signer_title,Z.signer_title&&Z.signer_company&&"  ",Z.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",ir(Z.signed_at)]})]}):e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>I(2),disabled:B,children:"Sign as Client"})]})]}),_&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Ja,{size:24}),e.jsx("p",{children:"This change order request has been fully signed by all parties."})]}),_&&e.jsxs("div",{className:"cor-download-section",children:[e.jsx("h4",{children:"Download Your Copy"}),e.jsx("p",{className:"download-description",children:"Download a PDF copy of this signed COR including all T&M backup documentation."}),e.jsx("button",{className:"btn btn-primary download-btn",onClick:F,disabled:ee,children:ee?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"download-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Yf,{size:18}),"Download COR + Backup"]})})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),v&&R&&e.jsx(Mf,{slot:R,documentType:u.document_type,documentTitle:`${g.cor_number} - ${g.title}`,onSave:P,onClose:()=>{y(!1),X(null)}})]})}function Tf(l,r,o,c,m){return e.jsxs("div",{className:`signature-slot-card ${r?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[r?e.jsx(Ja,{size:20,className:"status-icon signed"}):e.jsx(Nn,{size:20,className:"status-icon pending"}),e.jsxs("span",{className:"slot-label",children:["Signature ",l,"  ",o]})]}),r?e.jsxs("div",{className:"slot-signed-info",children:[e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:r.signer_name}),(r.signer_title||r.signer_company)&&e.jsxs("span",{className:"signer-org",children:[r.signer_title,r.signer_title&&r.signer_company&&"  ",r.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",ir(r.signed_at)]})]}):e.jsxs("button",{className:"btn btn-primary sign-btn",onClick:()=>c(l),disabled:m,children:["Sign as ",l===1?"GC":"Client"]})]})}function ry({company:l,projects:r,userId:o,onNotificationClick:c,onShowToast:m}){const[u,x]=p.useState([]),[g,f]=p.useState(0),[v,y]=p.useState(!1),[R,X]=p.useState(!1),[B,V]=p.useState({}),L=p.useRef(null);p.useRef(null);const q=p.useRef(null);p.useEffect(()=>{o&&ee()},[o]);const ee=async()=>{try{const j=await ce.getUserNotificationPreferences(o),_={};j.forEach(S=>{_[S.project_id]=S.notification_types||[]}),V(_)}catch(j){console.error("Error loading user preferences:",j)}},T=(j,_)=>B[j]?B[j].length===0?!1:B[j].includes(_):!0;p.useEffect(()=>{if(!l?.id||!r||r.length===0)return;D();const j=w();return()=>{j&&ce.unsubscribe(j)}},[l?.id,r,B]),p.useEffect(()=>()=>{q.current&&(q.current.close().catch(()=>{}),q.current=null)},[]),p.useEffect(()=>{function j(_){L.current&&!L.current.contains(_.target)&&y(!1)}return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]);const D=async()=>{if(!r||r.length===0)return;const j=[];for(const _ of r)try{T(_.id,"message")&&(await ce.getMessages(_.id,20)).filter(k=>k.sender_type==="field"&&!k.is_read).forEach(k=>{j.push({id:`msg-${k.id}`,type:"message",title:"New Message",message:k.message?.slice(0,50)+(k.message?.length>50?"...":""),projectId:_.id,projectName:_.name,senderName:k.sender_name,createdAt:k.created_at,isRead:k.is_read,data:k})}),T(_.id,"material_request")&&(await ce.getMaterialRequests(_.id,"pending")).forEach(ae=>{j.push({id:`req-${ae.id}`,type:"material_request",title:"Material Request",message:`${ae.items?.length||0} items requested`,projectId:_.id,projectName:_.name,senderName:ae.requested_by,priority:ae.priority,createdAt:ae.created_at,isRead:!1,data:ae})})}catch(S){console.error("Error loading notifications for project:",_.id,S)}try{(await ce.getCompanyInjuryReports(l.id,"open")).slice(0,5).forEach(S=>{if(T(S.project_id,"injury_report")){const ae=r.find(k=>k.id===S.project_id);j.push({id:`injury-${S.id}`,type:"injury_report",title:"Safety Report",message:`${S.injury_type} - ${S.injured_person_name}`,projectId:S.project_id,projectName:ae?.name||"Unknown Project",senderName:S.reported_by_name,createdAt:S.created_at,isRead:S.status!=="open",data:S})}})}catch(_){console.error("Error loading injury reports:",_)}j.sort((_,S)=>new Date(S.createdAt)-new Date(_.createdAt)),x(j.slice(0,50)),f(j.filter(_=>!_.isRead).length)},w=()=>{if(!l?.id||!r||r.length===0)return null;const j=r.map(S=>S.id),_=ce.subscribeToCompanyActivity(l.id,j,{onMessage:S=>{if(S.new?.sender_type==="field"){if(!T(S.new.project_id,"message"))return;se({id:`msg-${S.new.id}`,type:"message",title:"New Message",message:S.new.message?.slice(0,50)+(S.new.message?.length>50?"...":""),projectId:S.new.project_id,projectName:r.find(ae=>ae.id===S.new.project_id)?.name||"Project",senderName:S.new.sender_name,createdAt:S.new.created_at,isRead:!1,data:S.new})}},onMaterialRequest:S=>{T(S.new.project_id,"material_request")&&se({id:`req-${S.new.id}`,type:"material_request",title:"Material Request",message:`${S.new.items?.length||0} items requested`,projectId:S.new.project_id,projectName:r.find(ae=>ae.id===S.new.project_id)?.name||"Project",senderName:S.new.requested_by,priority:S.new.priority,createdAt:S.new.created_at,isRead:!1,data:S.new})},onTMTicket:S=>{if(S.eventType==="INSERT"){if(!T(S.new.project_id,"tm_ticket"))return;se({id:`tm-${S.new.id}`,type:"tm_ticket",title:"New T&M Ticket",message:`Submitted by ${S.new.created_by_name||"Field"}`,projectId:S.new.project_id,projectName:r.find(ae=>ae.id===S.new.project_id)?.name||"Project",senderName:S.new.created_by_name,createdAt:S.new.created_at,isRead:!1,data:S.new})}},onInjuryReport:S=>{T(S.new.project_id,"injury_report")&&se({id:`injury-${S.new.id}`,type:"injury_report",title:"Safety Report",message:`${S.new.injury_type} - ${S.new.injured_person_name}`,projectId:S.new.project_id,projectName:r.find(ae=>ae.id===S.new.project_id)?.name||"Project",senderName:S.new.reported_by_name,createdAt:S.new.created_at,isRead:!1,data:S.new})}});return _&&X(!0),_},se=j=>{x(S=>[j,...S.slice(0,49)]),f(S=>S+1),ne();const _=P(j.type);m?.(`${_} ${j.title}: ${j.message}`,"info")},ne=()=>{try{(!q.current||q.current.state==="closed")&&(q.current=new(window.AudioContext||window.webkitAudioContext));const j=q.current;j.state==="suspended"&&j.resume();const _=j.createOscillator(),S=j.createGain();_.connect(S),S.connect(j.destination),_.frequency.value=800,_.type="sine",S.gain.value=.3,_.start(),_.stop(j.currentTime+.15),setTimeout(()=>{if(!q.current||q.current.state==="closed")return;const ae=q.current.createOscillator(),k=q.current.createGain();ae.connect(k),k.connect(q.current.destination),ae.frequency.value=1e3,ae.type="sine",k.gain.value=.3,ae.start(),ae.stop(q.current.currentTime+.15)},150)}catch{}},P=j=>{switch(j){case"message":return e.jsx(ys,{size:16});case"material_request":return e.jsx(Wa,{size:16});case"injury_report":return e.jsx(ml,{size:16});case"tm_ticket":return e.jsx(Oa,{size:16});default:return e.jsx(Gx,{size:16})}},I=j=>{switch(j){case"message":return"blue";case"material_request":return"orange";case"injury_report":return"red";case"tm_ticket":return"green";default:return"gray"}},F=j=>{x(_=>_.map(S=>S.id===j.id?{...S,isRead:!0}:S)),f(_=>Math.max(0,_-1)),y(!1),c?.(j)},J=async()=>{for(const j of r)try{await ce.markMessagesRead(j.id,"office")}catch{}x(j=>j.map(_=>({..._,isRead:!0}))),f(0)},Z=j=>{const _=new Date(j),ae=new Date-_,k=Math.floor(ae/6e4),M=Math.floor(ae/36e5),C=Math.floor(ae/864e5);return k<1?"Just now":k<60?`${k}m ago`:M<24?`${M}h ago`:C<7?`${C}d ago`:_.toLocaleDateString()};return e.jsxs("div",{className:"notification-center",ref:L,children:[e.jsxs("button",{className:`notification-bell ${g>0?"has-notifications":""}`,onClick:()=>y(!v),title:`${g} unread notifications`,children:[e.jsx("span",{className:"bell-icon",children:""}),g>0&&e.jsx("span",{className:"notification-badge",children:g>99?"99+":g}),R&&e.jsx("span",{className:"connection-dot"})]}),v&&e.jsxs("div",{className:"notification-dropdown",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h4",{children:"Notifications"}),g>0&&e.jsx("button",{className:"mark-all-read",onClick:J,children:"Mark all read"})]}),e.jsx("div",{className:"notification-list",children:u.length===0?e.jsxs("div",{className:"notification-empty",children:[e.jsx("span",{className:"empty-icon",children:""}),e.jsx("p",{children:"No notifications yet"}),e.jsx("small",{children:"You'll see updates from the field here"})]}):u.map(j=>e.jsxs("div",{className:`notification-item ${j.isRead?"read":"unread"} ${I(j.type)}`,onClick:()=>F(j),children:[e.jsx("div",{className:"notification-icon",children:P(j.type)}),e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"notification-title",children:[j.title,j.priority==="urgent"&&e.jsx("span",{className:"priority-badge urgent",children:"URGENT"})]}),e.jsx("div",{className:"notification-message",children:j.message}),e.jsxs("div",{className:"notification-meta",children:[e.jsx("span",{className:"notification-project",children:j.projectName}),e.jsx("span",{className:"notification-time",children:Z(j.createdAt)})]})]}),!j.isRead&&e.jsx("div",{className:"unread-dot"})]},j.id))}),u.length>0&&e.jsx("div",{className:"notification-footer",children:e.jsx("button",{className:"view-all-btn",onClick:()=>{y(!1),c?.({type:"view_all"})},children:"View All Activity"})})]})]})}class rr extends p.Component{constructor(r){super(r),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,o){this.setState({error:r,errorInfo:o}),console.error("ErrorBoundary caught an error:",r,o)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("div",{className:"error-icon",children:e.jsx(zi,{size:48})}),e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),e.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function Af(){const[l,r]=p.useState(cr()),[o,c]=p.useState(0),[m,u]=p.useState(!1),[x,g]=p.useState(!1);return p.useEffect(()=>{const f=Bf(async y=>{r(y),y&&x&&(u(!0),setTimeout(()=>u(!1),3e3)),y||g(!0);const R=await Po();c(R)});Po().then(c);const v=setInterval(async()=>{if(!cr()){const y=await Po();c(y)}},5e3);return()=>{f(),clearInterval(v)}},[x]),l&&o===0&&!m?null:e.jsxs("div",{className:`offline-indicator ${l?"online":"offline"} ${m?"synced":""}`,children:[e.jsx("div",{className:"offline-indicator-content",children:l?m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"online-icon",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):o>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"syncing-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),e.jsxs("span",{className:"offline-text",children:["Syncing ",o,"..."]})]}):null:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"offline-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),e.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),e.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),e.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),e.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),e.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),e.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),e.jsxs("span",{className:"offline-text",children:["Offline",o>0&&e.jsxs("span",{className:"pending-badge",children:[o," pending"]})]})]})}),e.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function iy(){const[l,r]=p.useState("entry"),[o,c]=p.useState(null),[m,u]=p.useState(null),[x,g]=p.useState([]),[f,v]=p.useState([]),[y,R]=p.useState(null),[X,B]=p.useState(null),[V,L]=p.useState(null),[q,ee]=p.useState(!0),[T,D]=p.useState("dashboard"),[w,se]=p.useState(null),[ne,P]=p.useState(!1),[I,F]=p.useState(null);p.useEffect(()=>{const O=window.location.pathname,$=O.match(/^\/view\/([a-zA-Z0-9_-]+)$/),H=O.match(/^\/sign\/([a-zA-Z0-9_-]+)$/);$?(B($[1]),r("public"),ee(!1)):H?(L(H[1]),r("signature"),ee(!1)):J()},[]);const J=async()=>{try{const{data:{user:O}}=await U.auth.getUser();if(!O){ee(!1);return}const{data:$,error:H}=await U.from("users").select("*").eq("id",O.id).single();if($){c($);const ve=await ce.getUserCompanies(O.id);g(ve);const Ne=localStorage.getItem("selectedCompanyId");let Ae=null;if(Ne&&ve.find(be=>be.id===Ne))Ae=ve.find(be=>be.id===Ne);else if(ve.length>0)Ae=ve[0];else if($.company_id){const{data:be}=await U.from("companies").select("*").eq("id",$.company_id).single();Ae=be}if(Ae){const{data:be}=await U.from("companies").select("*").eq("id",Ae.id).single();u(be),r("office")}}}catch(O){console.error("Auth check error:",O)}finally{ee(!1)}},Z=O=>{R(O),r("foreman")},j=async(O,$)=>{try{const{data:H,error:ve}=await U.auth.signInWithPassword({email:O,password:$});if(ve){k(ve.message||"Invalid credentials","error");return}const{data:Ne,error:Ae}=await U.from("users").select("*").eq("id",H.user.id).single();if(Ae){console.error("User fetch error:",Ae),k("Error loading profile","error");return}if(Ne){c(Ne);const be=await ce.getUserCompanies(H.user.id);g(be);const Pe=localStorage.getItem("selectedCompanyId");let Ve=null;if(Pe&&be.find(Te=>Te.id===Pe))Ve=be.find(Te=>Te.id===Pe);else if(be.length>0)Ve=be[0];else if(Ne.company_id){const{data:Te}=await U.from("companies").select("*").eq("id",Ne.company_id).single();Ve=Te}if(Ve){const{data:Te}=await U.from("companies").select("*").eq("id",Ve.id).single();u(Te),r("office")}else k("No company access. Please contact admin.","error")}else k("Profile not found. Please contact admin.","error")}catch(H){console.error("Login error:",H),k("Login failed","error")}},_=async O=>{try{const{data:$}=await U.from("companies").select("*").eq("id",O).single();$&&(u($),localStorage.setItem("selectedCompanyId",O),P(!1),D("dashboard"),k(`Switched to ${$.name}`,"success"))}catch($){console.error("Switch company error:",$),k("Error switching company","error")}},S=async()=>{try{await Ux.signOut(),c(null),u(null),g([]),r("entry"),D("dashboard"),localStorage.removeItem("selectedCompanyId")}catch(O){console.error("Logout error:",O),k("Error signing out","error")}},ae=()=>{R(null),r("entry")},k=(O,$="")=>{se({message:O,type:$})},M=()=>{D("dashboard"),m?.id&&C()},C=async()=>{if(m?.id)try{const O=await ce.getProjects(m.id);v(O)}catch(O){console.error("Error loading projects:",O)}};p.useEffect(()=>{m?.id&&l==="office"&&C()},[m?.id,l]);const me=O=>{if(O.type==="view_all"){D("dashboard"),F(null);return}D("dashboard"),O.projectId&&F(O.projectId)},Q=()=>{F(null)};return q?e.jsx(cl,{companyId:m?.id,children:e.jsxs("div",{className:"loading-screen",children:[e.jsx(Ia,{className:"loading-logo"}),e.jsx("div",{className:"spinner"})]})}):l==="entry"?e.jsxs(cl,{children:[e.jsx(rr,{children:e.jsx(cv,{onForemanAccess:Z,onOfficeLogin:j,onShowToast:k})}),w&&e.jsx(en,{message:w.message,type:w.type,onClose:()=>se(null)})]}):l==="public"&&X?e.jsxs(cl,{children:[e.jsx(rr,{children:e.jsx(sy,{shareToken:X})}),w&&e.jsx(en,{message:w.message,type:w.type,onClose:()=>se(null)})]}):l==="signature"&&V?e.jsxs(cl,{children:[e.jsx(rr,{children:e.jsx(ly,{signatureToken:V})}),w&&e.jsx(en,{message:w.message,type:w.type,onClose:()=>se(null)})]}):l==="foreman"&&y?e.jsxs(cl,{companyId:y.company_id,children:[e.jsx(rr,{children:e.jsx(bv,{project:y,companyId:y.company_id,onShowToast:k,onExit:ae})}),e.jsx(Af,{}),w&&e.jsx(en,{message:w.message,type:w.type,onClose:()=>se(null)})]}):e.jsx(cl,{companyId:m?.id,children:e.jsxs("div",{children:[!K&&e.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),e.jsx("nav",{className:"nav",children:e.jsxs("div",{className:"nav-content",children:[e.jsx(Ia,{}),e.jsxs("div",{className:"nav-tabs",children:[e.jsx("button",{className:`nav-tab ${T==="dashboard"?"active":""}`,onClick:()=>D("dashboard"),children:"Dashboard"}),e.jsx("button",{className:`nav-tab ${T==="setup"?"active":""}`,onClick:()=>D("setup"),children:"+ New Project"}),e.jsx("button",{className:`nav-tab ${T==="pricing"?"active":""}`,onClick:()=>D("pricing"),children:"Pricing"}),e.jsx("button",{className:`nav-tab ${T==="branding"?"active":""}`,onClick:()=>D("branding"),children:"Branding"})]}),e.jsxs("div",{className:"nav-user",children:[e.jsx(ry,{company:m,projects:f,userId:o?.id,onNotificationClick:me,onShowToast:k}),x.length>1&&e.jsxs("div",{className:"company-switcher",children:[e.jsxs("button",{className:"company-switcher-btn",onClick:()=>P(!ne),children:[m?.name||"Select Company",e.jsx("span",{className:"switcher-arrow",children:""})]}),ne&&e.jsx("div",{className:"company-dropdown",children:x.map(O=>e.jsxs("button",{className:`company-option ${O.id===m?.id?"active":""}`,onClick:()=>_(O.id),children:[O.name,O.id===m?.id&&e.jsx("span",{className:"check",children:""})]},O.id))})]}),x.length<=1&&m&&e.jsx("span",{className:"nav-company-name",children:m.name}),e.jsx("span",{className:"nav-user-name",children:o?.name||o?.email}),e.jsx("button",{className:"nav-logout",onClick:S,children:"Sign Out"})]})]})}),e.jsx(rr,{children:e.jsxs("div",{className:"container",children:[T==="dashboard"&&e.jsx(Xv,{company:m,onShowToast:k,navigateToProjectId:I,onProjectNavigated:Q}),T==="setup"&&e.jsx(Pv,{company:m,user:o,onProjectCreated:M,onShowToast:k}),T==="pricing"&&e.jsx(ay,{company:m,onShowToast:k}),T==="branding"&&e.jsx(Iv,{company:m,onShowToast:k})]},m?.id)}),e.jsx(Af,{}),w&&e.jsx(en,{message:w.message,type:w.type,onClose:()=>se(null)})]})})}Sx.createRoot(document.getElementById("root")).render(e.jsx(jx.StrictMode,{children:e.jsx(iy,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(l=>{console.log("SW registered:",l.scope),setInterval(()=>{l.update()},6e4)}).catch(l=>{console.log("SW registration failed:",l)})});
