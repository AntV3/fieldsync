import{d,j as e}from"./index-BQ9XEaVB.js";import{r as n}from"./router-D4FaBdHo.js";import{L as v,T as S,N as _,i as E,aH as R,av as B,aG as $,d as A,F as C,aF as O,aD as t,A as G,D as M,C as I,ax as P,ad as H,aA as K}from"./icons-C1b61Abg.js";const y={folder:t,plans:O,specs:C,permits:A,contracts:$,submittals:B,rfis:R,photos:E,reports:_,safety:S},h={blue:"#3b82f6",green:"#10b981",yellow:"#f59e0b",red:"#ef4444",purple:"#8b5cf6",pink:"#ec4899",gray:"#6b7280",orange:"#f97316"},Q=c=>c?.startsWith("image/")?P:c?.includes("spreadsheet")||c?.includes("excel")?H:c?.includes("pdf")?C:K,W=c=>{if(!c)return"0 B";const r=["B","KB","MB","GB"];let o=c,a=0;for(;o>=1024&&a<r.length-1;)o/=1024,a++;return`${o.toFixed(o<10?1:0)} ${r[a]}`};function V({projectId:c,onShowToast:r}){const[o,a]=n.useState([]),[D,b]=n.useState(!0),[u,N]=n.useState(null),[j,g]=n.useState([]),[w,F]=n.useState(!1),f=n.useRef(null),m=n.useCallback(async()=>{b(!0);try{const s=await d.getProjectFolders(c);a(s)}catch(s){console.error("Error loading folders:",s),r?.("Failed to load folders","error")}finally{b(!1)}},[c,r]),p=n.useCallback(async s=>{if(s){F(!0);try{const l=await d.getFolderDocuments(s);g(l.documents)}catch(l){console.error("Error loading documents:",l),r?.("Failed to load documents","error")}finally{F(!1)}}},[r]);n.useEffect(()=>{m();const s=d.subscribeToDocumentFolders?.(c,()=>{m()}),l=d.subscribeToDocuments?.(c,()=>{m(),f.current&&p(f.current.id)});return()=>{s?.unsubscribe?.(),l?.unsubscribe?.()}},[c,m,p]);const z=async s=>{N(s),f.current=s,await p(s.id)},L=async s=>{try{await d.logDocumentAccess(s.id,"downloaded");const l=s.url||`/storage/v1/object/public/project-documents/${s.storage_path}`;window.open(l,"_blank")}catch(l){console.error("Download error:",l)}},k=()=>{N(null),f.current=null,g([])};if(D)return e.jsx("div",{className:"field-docs",children:e.jsxs("div",{className:"field-docs-loading",children:[e.jsx(v,{size:24,className:"spinner"}),e.jsx("span",{children:"Loading..."})]})});if(u){const s=y[u.icon]||t,l=h[u.color]||h.blue;return e.jsxs("div",{className:"field-docs",children:[e.jsxs("div",{className:"field-docs-header",children:[e.jsx("button",{className:"field-docs-back",onClick:k,children:e.jsx(G,{size:20})}),e.jsxs("div",{className:"field-docs-title",children:[e.jsx("div",{className:"field-docs-title-icon",style:{backgroundColor:`${l}15`},children:e.jsx(s,{size:20,style:{color:l}})}),e.jsxs("div",{className:"field-docs-title-text",children:[e.jsx("h2",{children:u.name}),e.jsxs("span",{children:[j.length," files"]})]})]})]}),e.jsx("div",{className:"field-docs-list",children:w?e.jsxs("div",{className:"field-docs-loading",children:[e.jsx(v,{size:24,className:"spinner"}),e.jsx("span",{children:"Loading..."})]}):j.length===0?e.jsxs("div",{className:"field-docs-empty",children:[e.jsx(t,{size:48,style:{color:l,opacity:.3}}),e.jsx("p",{children:"No documents yet"})]}):j.map(i=>{const x=Q(i.mime_type);return e.jsxs("button",{className:"field-doc-item",onClick:()=>L(i),children:[e.jsx("div",{className:"field-doc-icon",children:e.jsx(x,{size:22})}),e.jsxs("div",{className:"field-doc-info",children:[e.jsx("span",{className:"field-doc-name",children:i.name}),e.jsx("span",{className:"field-doc-size",children:W(i.file_size_bytes)})]}),e.jsx(M,{size:20,className:"field-doc-download"})]},i.id)})})]})}return e.jsx("div",{className:"field-docs",children:e.jsx("div",{className:"field-docs-grid",children:o.length===0?e.jsxs("div",{className:"field-docs-empty",children:[e.jsx(t,{size:56}),e.jsx("h3",{children:"No documents"}),e.jsx("p",{children:"Documents will appear here when added"})]}):o.map(s=>{const l=y[s.icon]||t,i=h[s.color]||h.blue,x=s.document_count||0;return e.jsxs("button",{className:"field-folder-card",onClick:()=>z(s),children:[e.jsx("div",{className:"field-folder-icon",style:{backgroundColor:`${i}12`},children:e.jsx(l,{size:28,style:{color:i}})}),e.jsxs("div",{className:"field-folder-info",children:[e.jsx("span",{className:"field-folder-name",children:s.name}),e.jsxs("span",{className:"field-folder-count",children:[x," ",x===1?"file":"files"]})]}),e.jsx(I,{size:20,className:"field-folder-arrow"})]},s.id)})})})}export{V as F};
