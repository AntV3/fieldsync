import{u as q,i as F,j as e}from"./index-CycIrh0T.js";import{r as t}from"./icons-CJNREYZA.js";import"./react-DXGY7bZi.js";import"./pdf-ChZ1zkDw.js";import"./supabase-VuevzHjS.js";function W({company:o,onShowToast:a}){const{branding:p,updateBranding:k,uploadBrandingImage:B,loading:P}=q(),[x,f]=t.useState(!1),[u,E]=t.useState(!1),[r,w]=t.useState(p),[g,j]=t.useState(""),[y,v]=t.useState(!1),N=t.useRef(null),b=t.useRef(null),_=t.useRef(null);t.useEffect(()=>{o?.id&&R()},[o?.id]);const R=async()=>{try{const{data:s,error:i}=await F.from("companies").select("office_code").eq("id",o.id).single();!i&&s?.office_code&&j(s.office_code)}catch(s){console.error("Error loading office code:",s)}},U=async()=>{if(confirm("Regenerate office code? Current code will stop working immediately.")){v(!0);try{const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",i=new Uint8Array(6);crypto.getRandomValues(i);const c=Array.from(i,O=>s[O%s.length]).join(""),{error:C}=await F.from("companies").update({office_code:c}).eq("id",o.id);if(C)throw C;j(c),a?.("Office code regenerated","success")}catch{a?.("Error regenerating code","error")}finally{v(!1)}}},L=()=>{navigator.clipboard.writeText(g),a?.("Office code copied to clipboard","success")},l=o?.subscription_tier||"free",m=["pro","business","enterprise"].includes(l),d=["business","enterprise"].includes(l),A=l==="enterprise",n=(s,i)=>{w(c=>({...c,[s]:i}))},h=async(s,i)=>{if(s){if(s.size>5*1024*1024){a?.("Image must be smaller than 5MB","error");return}if(!s.type.startsWith("image/")){a?.("Please upload an image file","error");return}try{const c=await B(s,i);c.success?(n(`${i}_url`,c.url),a?.(`${i.charAt(0).toUpperCase()+i.slice(1)} uploaded successfully`,"success")):a?.(c.error||"Failed to upload image","error")}catch(c){console.error("Upload error:",c),a?.("Failed to upload image","error")}}},S=async()=>{try{f(!0);const s=/^#[0-9A-F]{6}$/i;if(!s.test(r.primary_color)){a?.("Primary color must be a valid hex color (e.g., #3B82F6)","error");return}if(!s.test(r.secondary_color)){a?.("Secondary color must be a valid hex color (e.g., #1E40AF)","error");return}const i=await k(r);i.success?a?.("Branding settings saved successfully!","success"):a?.(i.error||"Failed to save branding settings","error")}catch(s){console.error("Save error:",s),a?.("Failed to save branding settings","error")}finally{f(!1)}},I=()=>{u?(document.documentElement.style.setProperty("--primary-color",p.primary_color),document.documentElement.style.setProperty("--secondary-color",p.secondary_color),document.title=p.custom_app_name||"FieldSync"):(document.documentElement.style.setProperty("--primary-color",r.primary_color),document.documentElement.style.setProperty("--secondary-color",r.secondary_color),document.title=r.custom_app_name||"FieldSync"),E(!u)};return P?e.jsxs("div",{className:"settings-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading branding settings..."})]}):e.jsxs("div",{className:"branding-settings",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("h2",{children:"ðŸŽ¨ Branding Settings"}),l==="free"&&e.jsx("div",{className:"tier-badge tier-free",children:"Free Plan - Upgrade for branding options"}),l==="pro"&&e.jsx("div",{className:"tier-badge tier-pro",children:"Pro Plan"}),l==="business"&&e.jsx("div",{className:"tier-badge tier-business",children:"Business Plan"}),l==="enterprise"&&e.jsx("div",{className:"tier-badge tier-enterprise",children:"Enterprise Plan"})]}),e.jsxs("div",{className:"settings-section security-section",children:[e.jsx("h3",{children:"Security"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Office Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Share this code with office staff only. Required to create new office accounts."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:g||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:L,disabled:!g,children:"Copy"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:U,disabled:y,children:y?"...":"Regenerate"})]}),e.jsx("p",{className:"help-text",style:{marginTop:"0.5rem",color:"var(--accent-amber)"},children:"Field workers should NOT have this code - they use project PINs only."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Company Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Public code for employees to find your company."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:o?.code||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:()=>{navigator.clipboard.writeText(o?.code||""),a?.("Company code copied","success")},disabled:!o?.code,children:"Copy"})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Visual Identity"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Logo"}),m?e.jsxs(e.Fragment,{children:[r.logo_url&&e.jsx("div",{className:"logo-preview",children:e.jsx("img",{src:r.logo_url,alt:"Logo preview"})}),e.jsx("input",{ref:N,type:"file",accept:"image/*",style:{display:"none"},onChange:s=>h(s.target.files[0],"logo")}),e.jsx("button",{className:"btn-secondary",onClick:()=>N.current?.click(),children:r.logo_url?"Change Logo":"Upload Logo"}),e.jsx("p",{className:"help-text",children:"Recommended: 200x60px, PNG with transparent background"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:"ðŸ”’ Upgrade to Pro, Business, or Enterprise to customize your logo"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"app-name",children:"App Name"}),m?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"app-name",type:"text",className:"input",value:r.custom_app_name||"",onChange:s=>n("custom_app_name",s.target.value),placeholder:"FieldSync",maxLength:50}),e.jsx("p",{className:"help-text",children:"This name appears in the browser tab and throughout the app"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:"ðŸ”’ Upgrade to Pro, Business, or Enterprise to customize your app name"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"primary-color",children:"Primary Color"}),m?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"primary-color",type:"color",value:r.primary_color||"#3B82F6",onChange:s=>n("primary_color",s.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:r.primary_color||"#3B82F6",onChange:s=>n("primary_color",s.target.value),placeholder:"#3B82F6",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:"ðŸ”’ Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"secondary-color",children:"Secondary Color"}),m?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"secondary-color",type:"color",value:r.secondary_color||"#1E40AF",onChange:s=>n("secondary_color",s.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:r.secondary_color||"#1E40AF",onChange:s=>n("secondary_color",s.target.value),placeholder:"#1E40AF",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:"ðŸ”’ Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Favicon"}),m?e.jsxs(e.Fragment,{children:[r.favicon_url&&e.jsx("div",{className:"favicon-preview",children:e.jsx("img",{src:r.favicon_url,alt:"Favicon preview"})}),e.jsx("input",{ref:b,type:"file",accept:"image/*",style:{display:"none"},onChange:s=>h(s.target.files[0],"favicon")}),e.jsx("button",{className:"btn-secondary",onClick:()=>b.current?.click(),children:r.favicon_url?"Change Favicon":"Upload Favicon"}),e.jsx("p",{className:"help-text",children:"Recommended: 32x32px or 64x64px, PNG or ICO format"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:"ðŸ”’ Upgrade to Pro, Business, or Enterprise to customize your favicon"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Login Background"}),d?e.jsxs(e.Fragment,{children:[r.login_background_url&&e.jsx("div",{className:"background-preview",children:e.jsx("img",{src:r.login_background_url,alt:"Background preview"})}),e.jsx("input",{ref:_,type:"file",accept:"image/*",style:{display:"none"},onChange:s=>h(s.target.files[0],"login_background")}),e.jsx("button",{className:"btn-secondary",onClick:()=>_.current?.click(),children:r.login_background_url?"Change Background":"Upload Background"}),e.jsx("p",{className:"help-text",children:"Recommended: 1920x1080px, JPG or PNG"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:"ðŸ”’ Upgrade to Business or Enterprise to customize login background"})})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"White-Label Options"}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:r.hide_fieldsync_branding||!1,onChange:s=>n("hide_fieldsync_branding",s.target.checked),disabled:!d}),e.jsx("span",{children:'Hide "Powered by FieldSync"'})]}),!d&&e.jsx("p",{className:"help-text",children:"ðŸ”’ Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Email Branding"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-name",children:"From Name"}),e.jsx("input",{id:"email-from-name",type:"text",className:"input",value:r.email_from_name||"",onChange:s=>n("email_from_name",s.target.value),placeholder:"Your Company Name",disabled:!d}),!d&&e.jsx("p",{className:"help-text",children:"ðŸ”’ Business or Enterprise plan required"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-address",children:"From Email"}),e.jsx("input",{id:"email-from-address",type:"email",className:"input",value:r.email_from_address||"",onChange:s=>n("email_from_address",s.target.value),placeholder:"noreply@yourcompany.com",disabled:!d}),!d&&e.jsx("p",{className:"help-text",children:"ðŸ”’ Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Custom Domain"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"custom-domain",children:"Domain"}),A?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"custom-domain",type:"text",className:"input",value:r.custom_domain||"",onChange:s=>n("custom_domain",s.target.value),placeholder:"app.yourcompany.com"}),r.custom_domain&&e.jsx("div",{className:`domain-status ${r.domain_verified?"verified":"pending"}`,children:r.domain_verified?e.jsx(e.Fragment,{children:"âœ“ Connected"}):e.jsx(e.Fragment,{children:"âš  DNS setup required"})}),e.jsx("p",{className:"help-text",children:"Contact support to configure DNS and SSL certificate for your custom domain"})]}):e.jsxs("div",{className:"upgrade-notice",children:[e.jsx("p",{children:"ðŸ”’ Enterprise plan required for custom domain support"}),e.jsx("p",{className:"help-text",children:"Custom domains allow you to host the app at your own URL (e.g., app.yourcompany.com)"})]})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:I,children:u?"Exit Preview":"Preview Changes"}),e.jsx("button",{className:"btn-primary",onClick:S,disabled:x||!m,children:x?"Saving...":"Save Changes"})]}),u&&e.jsx("div",{className:"preview-banner",children:"Preview Mode Active - Your changes are not yet saved"})]})}export{W as default};
//# sourceMappingURL=BrandingSettings-DQbfDram.js.map
