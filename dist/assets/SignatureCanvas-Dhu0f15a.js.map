{"version":3,"file":"SignatureCanvas-Dhu0f15a.js","sources":["../../src/components/ui/SignatureCanvas.jsx"],"sourcesContent":["import { useState, useRef, useEffect } from 'react'\nimport { X, Check, RotateCcw, Pen, Shield } from 'lucide-react'\n\n/**\n * Unified Signature Capture Component\n *\n * Consolidates all signature implementations into one reusable component.\n * Supports simple mode (name + signature) and enhanced mode (name, title, company, acknowledgment).\n *\n * Usage:\n *   <SignatureCanvas onSave={handleSave} onClose={handleClose} />\n *   <SignatureCanvas onSave={handleSave} onClose={handleClose} enhanced title=\"GC Authorization\" />\n */\nexport default function SignatureCanvas({\n  onSave,\n  onClose,\n  // Display options\n  title = 'Signature',\n  enhanced = false,\n  slot = null,\n  documentType = null,\n  documentTitle = '',\n  // Pre-fill values\n  signerName: initialName = '',\n  signerTitle: initialTitle = '',\n  signerCompany: initialCompany = '',\n  // Customization\n  legalText = null,\n  requireAcknowledgment = false,\n  canvasWidth = 500,\n  canvasHeight = 180,\n  lockBodyScroll = false\n}) {\n  const canvasRef = useRef(null)\n  const [signerName, setSignerName] = useState(initialName)\n  const [signerTitle, setSignerTitle] = useState(initialTitle)\n  const [signerCompany, setSignerCompany] = useState(initialCompany)\n  const [hasSignature, setHasSignature] = useState(false)\n  const [isDrawing, setIsDrawing] = useState(false)\n  const [acknowledged, setAcknowledged] = useState(!requireAcknowledgment)\n\n  // Derive display strings\n  const displayTitle = slot\n    ? (slot === 1 ? 'GC Authorization' : 'Client Authorization')\n    : title\n\n  const docTypeLabel = documentType === 'cor'\n    ? 'Change Order Request'\n    : documentType === 'tm_ticket'\n      ? 'Time & Material Ticket'\n      : 'document'\n\n  const defaultLegalText = `I acknowledge that this electronic signature is legally binding and that I have reviewed and approve this ${docTypeLabel}. I understand that my signature, name, and IP address will be recorded for verification purposes.`\n\n  // Lock body scroll when modal is open (for mobile)\n  useEffect(() => {\n    if (!lockBodyScroll) return\n\n    const originalOverflow = document.body.style.overflow\n    const originalPosition = document.body.style.position\n    const originalTop = document.body.style.top\n    const scrollY = window.scrollY\n\n    document.body.style.overflow = 'hidden'\n    document.body.style.position = 'fixed'\n    document.body.style.top = `-${scrollY}px`\n    document.body.style.width = '100%'\n\n    return () => {\n      document.body.style.overflow = originalOverflow\n      document.body.style.position = originalPosition\n      document.body.style.top = originalTop\n      document.body.style.width = ''\n      window.scrollTo(0, scrollY)\n    }\n  }, [lockBodyScroll])\n\n  const getContext = () => {\n    const canvas = canvasRef.current\n    if (!canvas) return null\n    return canvas.getContext('2d')\n  }\n\n  const getPosition = (e) => {\n    const canvas = canvasRef.current\n    if (!canvas) return { x: 0, y: 0 }\n\n    const rect = canvas.getBoundingClientRect()\n    const scaleX = canvas.width / rect.width\n    const scaleY = canvas.height / rect.height\n\n    const clientX = e.touches?.length ? e.touches[0].clientX : e.clientX\n    const clientY = e.touches?.length ? e.touches[0].clientY : e.clientY\n\n    return {\n      x: (clientX - rect.left) * scaleX,\n      y: (clientY - rect.top) * scaleY\n    }\n  }\n\n  const startDrawing = (e) => {\n    e.preventDefault()\n    const ctx = getContext()\n    if (!ctx) return\n    const { x, y } = getPosition(e)\n    ctx.beginPath()\n    ctx.moveTo(x, y)\n    setIsDrawing(true)\n    setHasSignature(true)\n  }\n\n  const draw = (e) => {\n    if (!isDrawing) return\n    e.preventDefault()\n    const ctx = getContext()\n    if (!ctx) return\n    const { x, y } = getPosition(e)\n    ctx.lineTo(x, y)\n    ctx.stroke()\n  }\n\n  const stopDrawing = () => {\n    setIsDrawing(false)\n  }\n\n  const clearSignature = () => {\n    const canvas = canvasRef.current\n    const ctx = getContext()\n    if (!canvas || !ctx) return\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    setHasSignature(false)\n  }\n\n  const initCanvas = (canvas) => {\n    if (!canvas) return\n    canvasRef.current = canvas\n    const ctx = canvas.getContext('2d')\n    ctx.strokeStyle = '#1e293b'\n    ctx.lineWidth = 2\n    ctx.lineCap = 'round'\n    ctx.lineJoin = 'round'\n  }\n\n  const isValid = hasSignature && signerName.trim() && acknowledged\n\n  const handleSave = () => {\n    if (!isValid) return\n    const canvas = canvasRef.current\n    if (!canvas) return\n\n    const signatureData = canvas.toDataURL('image/png')\n\n    const result = {\n      signature: signatureData,\n      signerName: signerName.trim(),\n      signedAt: new Date().toISOString()\n    }\n\n    if (enhanced) {\n      result.signerTitle = signerTitle.trim() || null\n      result.signerCompany = signerCompany.trim() || null\n    }\n\n    onSave(result)\n  }\n\n  return (\n    <div className=\"modal-overlay\" onClick={onClose} role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"signature-title\">\n      <div className={`modal-content signature-modal${enhanced ? ' enhanced' : ''}`} onClick={e => e.stopPropagation()}>\n        <div className=\"modal-header\">\n          <div className=\"signature-header-info\">\n            <h2 id=\"signature-title\">{displayTitle}</h2>\n            {documentTitle && (\n              <span className=\"signature-doc-ref\">{documentTitle}</span>\n            )}\n          </div>\n          <button className=\"close-btn\" onClick={onClose} aria-label=\"Close signature modal\">\n            <X size={20} aria-hidden=\"true\" />\n          </button>\n        </div>\n\n        <div className=\"modal-body signature-body\">\n          {slot && (\n            <div className=\"signature-slot-badge\">\n              <Shield size={14} />\n              <span>Signature {slot} of 2</span>\n            </div>\n          )}\n\n          {/* Signer info fields */}\n          <div className=\"signature-fields\">\n            <div className=\"form-group required\">\n              <label htmlFor=\"sig-name\">{enhanced ? 'Print Name' : 'Signer Name *'}</label>\n              <input\n                id=\"sig-name\"\n                type=\"text\"\n                value={signerName}\n                onChange={(e) => setSignerName(e.target.value)}\n                placeholder={enhanced ? 'Enter your full legal name' : 'Enter full name'}\n                aria-required=\"true\"\n                className=\"input-required\"\n              />\n            </div>\n\n            {enhanced && (\n              <div className=\"signature-fields-row\">\n                <div className=\"form-group\">\n                  <label htmlFor=\"sig-title\">Title</label>\n                  <input\n                    id=\"sig-title\"\n                    type=\"text\"\n                    value={signerTitle}\n                    onChange={(e) => setSignerTitle(e.target.value)}\n                    placeholder=\"e.g., Project Manager\"\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label htmlFor=\"sig-company\">Company</label>\n                  <input\n                    id=\"sig-company\"\n                    type=\"text\"\n                    value={signerCompany}\n                    onChange={(e) => setSignerCompany(e.target.value)}\n                    placeholder=\"e.g., ABC Construction\"\n                  />\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Signature canvas */}\n          <div className=\"signature-area\">\n            <div className=\"signature-label\" id=\"signature-instructions\">\n              <Pen size={16} aria-hidden=\"true\" />\n              <span>{enhanced ? 'Draw your signature below' : 'Sign below'}</span>\n            </div>\n\n            <div className=\"signature-canvas-container\">\n              <canvas\n                ref={initCanvas}\n                width={canvasWidth}\n                height={canvasHeight}\n                className=\"signature-canvas\"\n                onMouseDown={startDrawing}\n                onMouseMove={draw}\n                onMouseUp={stopDrawing}\n                onMouseLeave={stopDrawing}\n                onTouchStart={startDrawing}\n                onTouchMove={draw}\n                onTouchEnd={stopDrawing}\n                role=\"img\"\n                aria-label=\"Signature drawing area. Use mouse or touch to draw your signature.\"\n                aria-describedby=\"signature-instructions\"\n                tabIndex={0}\n              />\n              {!hasSignature && (\n                <div className=\"signature-placeholder\">Sign here</div>\n              )}\n            </div>\n\n            <button\n              className=\"btn btn-ghost btn-small\"\n              onClick={clearSignature}\n              disabled={!hasSignature}\n              aria-label=\"Clear signature\"\n            >\n              <RotateCcw size={14} aria-hidden=\"true\" /> Clear\n            </button>\n          </div>\n\n          {/* Legal acknowledgment */}\n          {requireAcknowledgment ? (\n            <div className=\"signature-acknowledgment\">\n              <label className=\"checkbox-label\">\n                <input\n                  type=\"checkbox\"\n                  checked={acknowledged}\n                  onChange={(e) => setAcknowledged(e.target.checked)}\n                />\n                <span>{legalText || defaultLegalText}</span>\n              </label>\n            </div>\n          ) : (\n            <p className=\"signature-legal\" role=\"note\">\n              {legalText || `By signing above, I acknowledge that I have reviewed and approve this ${docTypeLabel}.`}\n            </p>\n          )}\n        </div>\n\n        <div className=\"modal-footer\">\n          <button className=\"btn btn-secondary\" onClick={onClose} aria-label=\"Cancel and close\">\n            Cancel\n          </button>\n          <button\n            className=\"btn btn-primary\"\n            onClick={handleSave}\n            disabled={!isValid}\n            aria-label={enhanced ? 'Submit signature' : 'Save signature'}\n          >\n            <Check size={16} aria-hidden=\"true\" /> {enhanced ? 'Submit Signature' : 'Save Signature'}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":["SignatureCanvas","onSave","onClose","title","enhanced","slot","documentType","documentTitle","initialName","initialTitle","initialCompany","legalText","requireAcknowledgment","canvasWidth","canvasHeight","lockBodyScroll","canvasRef","useRef","signerName","setSignerName","useState","signerTitle","setSignerTitle","signerCompany","setSignerCompany","hasSignature","setHasSignature","isDrawing","setIsDrawing","acknowledged","setAcknowledged","displayTitle","docTypeLabel","defaultLegalText","useEffect","originalOverflow","originalPosition","originalTop","scrollY","getContext","canvas","getPosition","e","rect","scaleX","scaleY","clientX","clientY","startDrawing","ctx","x","y","draw","stopDrawing","clearSignature","initCanvas","isValid","handleSave","result","jsx","jsxs","X","Shield","Pen","RotateCcw","Check"],"mappings":"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"}