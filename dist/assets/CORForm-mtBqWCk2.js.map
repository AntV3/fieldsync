{"version":3,"file":"CORForm-mtBqWCk2.js","sources":["../../src/components/cor/TicketSelector.jsx","../../src/components/cor/CORForm.jsx"],"sourcesContent":["import { useState, useEffect, useMemo } from 'react'\nimport { X, Check, Search, FileText, Users, Package, Truck, ChevronDown, ChevronRight } from 'lucide-react'\nimport { db } from '../../lib/supabase'\nimport { formatCurrency, dollarsToCents } from '../../lib/corCalculations'\n\n// Generate secure random ID suffix\nconst generateRandomId = () => {\n  const array = new Uint8Array(6)\n  crypto.getRandomValues(array)\n  return Array.from(array, b => b.toString(36)).join('')\n}\n\nexport default function TicketSelector({ projectId, corId, onImport, onClose, onShowToast }) {\n  const [tickets, setTickets] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [selectedTickets, setSelectedTickets] = useState(new Set())\n  const [expandedTicket, setExpandedTicket] = useState(null)\n  const [searchTerm, setSearchTerm] = useState('')\n  const [filter, setFilter] = useState('unassigned') // 'all' | 'unassigned' | 'approved'\n\n  useEffect(() => {\n    loadTickets()\n  }, [projectId])\n\n  const loadTickets = async () => {\n    try {\n      // Get all tickets for the project\n      const allTickets = await db.getTMTickets(projectId)\n      setTickets(allTickets || [])\n    } catch (error) {\n      console.error('Error loading tickets:', error)\n      onShowToast?.('Error loading tickets', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Filter tickets\n  const filteredTickets = useMemo(() => {\n    let filtered = [...tickets]\n\n    // Status filter\n    if (filter === 'unassigned') {\n      filtered = filtered.filter(t => !t.assigned_cor_id)\n    } else if (filter === 'approved') {\n      filtered = filtered.filter(t => t.status === 'approved')\n    }\n\n    // Search filter\n    if (searchTerm) {\n      const term = searchTerm.toLowerCase()\n      filtered = filtered.filter(t =>\n        t.work_description?.toLowerCase().includes(term) ||\n        t.ce_pco_number?.toLowerCase().includes(term) ||\n        t.ticket_date?.includes(term)\n      )\n    }\n\n    // Sort by date descending\n    filtered.sort((a, b) => new Date(b.ticket_date) - new Date(a.ticket_date))\n\n    return filtered\n  }, [tickets, filter, searchTerm])\n\n  const toggleTicket = (ticketId) => {\n    const newSelected = new Set(selectedTickets)\n    if (newSelected.has(ticketId)) {\n      newSelected.delete(ticketId)\n    } else {\n      newSelected.add(ticketId)\n    }\n    setSelectedTickets(newSelected)\n  }\n\n  const toggleAll = () => {\n    if (selectedTickets.size === filteredTickets.length) {\n      setSelectedTickets(new Set())\n    } else {\n      setSelectedTickets(new Set(filteredTickets.map(t => t.id)))\n    }\n  }\n\n  const formatDate = (dateStr) => {\n    return new Date(dateStr).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric'\n    })\n  }\n\n  // Calculate ticket totals\n  const getTicketSummary = (ticket) => {\n    // Use correct field names from Supabase join\n    const workers = ticket.t_and_m_workers || ticket.workers || []\n    const items = ticket.t_and_m_items || ticket.items || []\n\n    const workerCount = workers.length\n    const itemCount = items.length\n\n    // Count equipment items based on category\n    const equipmentCount = items.filter(item => {\n      const category = (item.materials_equipment?.category || item.category || '').toLowerCase()\n      return category === 'equipment' || category === 'rental'\n    }).length\n\n    // Calculate total labor hours\n    let laborHours = 0\n    workers.forEach(w => {\n      laborHours += (parseFloat(w.regular_hours) || parseFloat(w.hours) || 0) + (parseFloat(w.overtime_hours) || 0)\n    })\n\n    return { workerCount, itemCount, equipmentCount, laborHours }\n  }\n\n  // Import selected tickets' data\n  const handleImport = () => {\n    if (selectedTickets.size === 0) {\n      onShowToast?.('Please select at least one ticket', 'error')\n      return\n    }\n\n    const ticketsToImport = tickets.filter(t => selectedTickets.has(t.id))\n\n    // Aggregate data from selected tickets\n    const laborItems = []\n    const materialsItems = []\n    const equipmentItems = []\n\n    ticketsToImport.forEach(ticket => {\n      // Extract labor from t_and_m_workers (correct table name from Supabase join)\n      const workers = ticket.t_and_m_workers || ticket.workers || []\n      workers.forEach(worker => {\n        laborItems.push({\n          id: `import-${ticket.id}-${worker.id || Date.now()}-${generateRandomId()}`,\n          worker_name: worker.name || worker.worker_name || '',\n          labor_class: worker.role || worker.labor_class || 'Laborer',\n          wage_type: 'standard',\n          regular_hours: parseFloat(worker.regular_hours) || parseFloat(worker.hours) || 0,\n          overtime_hours: parseFloat(worker.overtime_hours) || 0,\n          regular_rate: parseFloat(worker.regular_rate) || 0,\n          overtime_rate: parseFloat(worker.overtime_rate) || 0,\n          total: 0,\n          source_ticket_id: ticket.id,\n          source_ticket_date: ticket.ticket_date || ticket.work_date\n        })\n      })\n\n      // Extract materials from t_and_m_items (correct table name from Supabase join)\n      const items = ticket.t_and_m_items || ticket.items || []\n      items.forEach(item => {\n        // Get material info from nested materials_equipment if available\n        const materialInfo = item.materials_equipment || {}\n        // Priority: custom_name (user override) > library name > fallback\n        const itemDescription = item.custom_name || materialInfo.name || item.description || item.name || 'Unnamed item'\n        const itemUnit = item.unit || materialInfo.unit || 'each'\n        const itemCost = parseFloat(item.unit_cost) || parseFloat(materialInfo.cost_per_unit) || 0\n        const itemQty = parseFloat(item.quantity) || 1\n\n        // Determine if this is equipment or material based on category\n        const category = (materialInfo.category || item.category || '').toLowerCase()\n        const isEquipment = category === 'equipment' || category === 'rental'\n\n        if (isEquipment) {\n          equipmentItems.push({\n            id: `import-${ticket.id}-${item.id || Date.now()}-${generateRandomId()}`,\n            description: itemDescription,\n            source_type: 'T&M Ticket',\n            source_reference: `T&M #${ticket.id?.slice(-6) || ''} - ${formatDate(ticket.ticket_date || ticket.work_date)}`,\n            quantity: itemQty,\n            unit: itemUnit,\n            unit_cost: dollarsToCents(itemCost),\n            total: dollarsToCents(itemQty * itemCost),\n            source_ticket_id: ticket.id\n          })\n        } else {\n          materialsItems.push({\n            id: `import-${ticket.id}-${item.id || Date.now()}-${generateRandomId()}`,\n            description: itemDescription,\n            source_type: 'T&M Ticket',\n            source_reference: `T&M #${ticket.id?.slice(-6) || ''} - ${formatDate(ticket.ticket_date || ticket.work_date)}`,\n            quantity: itemQty,\n            unit: itemUnit,\n            unit_cost: dollarsToCents(itemCost),\n            total: dollarsToCents(itemQty * itemCost),\n            source_ticket_id: ticket.id\n          })\n        }\n      })\n    })\n\n    onImport?.({\n      ticketIds: Array.from(selectedTickets),\n      laborItems,\n      materialsItems,\n      equipmentItems\n    })\n\n    onClose?.()\n  }\n\n  if (loading) {\n    return (\n      <div className=\"modal-overlay\" onClick={onClose} role=\"dialog\" aria-modal=\"true\" aria-label=\"Loading tickets\">\n        <div className=\"modal-content ticket-selector-modal\" onClick={e => e.stopPropagation()}>\n          <div className=\"loading\" role=\"status\" aria-live=\"polite\">Loading tickets...</div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"modal-overlay\" onClick={onClose} role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"ticket-selector-title\">\n      <div className=\"modal-content ticket-selector-modal\" onClick={e => e.stopPropagation()}>\n        <div className=\"modal-header\">\n          <h2 id=\"ticket-selector-title\">Import from T&M Tickets</h2>\n          <button className=\"close-btn\" onClick={onClose} aria-label=\"Close ticket selector\"><X size={20} aria-hidden=\"true\" /></button>\n        </div>\n\n        <div className=\"ticket-selector-controls\">\n          <div className=\"ticket-search\">\n            <Search size={16} aria-hidden=\"true\" />\n            <input\n              type=\"text\"\n              placeholder=\"Search tickets...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              aria-label=\"Search tickets\"\n            />\n          </div>\n\n          <div className=\"ticket-filters\" role=\"group\" aria-label=\"Filter tickets by status\">\n            <button\n              className={`filter-btn ${filter === 'unassigned' ? 'active' : ''}`}\n              onClick={() => setFilter('unassigned')}\n              aria-pressed={filter === 'unassigned'}\n            >\n              Unassigned\n            </button>\n            <button\n              className={`filter-btn ${filter === 'approved' ? 'active' : ''}`}\n              onClick={() => setFilter('approved')}\n              aria-pressed={filter === 'approved'}\n            >\n              Approved\n            </button>\n            <button\n              className={`filter-btn ${filter === 'all' ? 'active' : ''}`}\n              onClick={() => setFilter('all')}\n              aria-pressed={filter === 'all'}\n            >\n              All\n            </button>\n          </div>\n        </div>\n\n        <div className=\"ticket-selector-header\">\n          <label className=\"select-all\">\n            <input\n              type=\"checkbox\"\n              checked={selectedTickets.size === filteredTickets.length && filteredTickets.length > 0}\n              onChange={toggleAll}\n              aria-label={`Select all ${filteredTickets.length} tickets`}\n            />\n            <span>Select All ({filteredTickets.length})</span>\n          </label>\n          <span className=\"selected-count\">\n            {selectedTickets.size} selected\n          </span>\n        </div>\n\n        <div className=\"modal-body ticket-selector-body\">\n          {filteredTickets.length === 0 ? (\n            <div className=\"ticket-empty\">\n              <FileText size={32} />\n              <p>No tickets found</p>\n              {filter === 'unassigned' && (\n                <button className=\"btn btn-ghost btn-small\" onClick={() => setFilter('all')}>\n                  Show all tickets\n                </button>\n              )}\n            </div>\n          ) : (\n            <div className=\"ticket-list\">\n              {filteredTickets.map(ticket => {\n                const summary = getTicketSummary(ticket)\n                const isSelected = selectedTickets.has(ticket.id)\n                const isExpanded = expandedTicket === ticket.id\n\n                return (\n                  <div\n                    key={ticket.id}\n                    className={`ticket-item ${isSelected ? 'selected' : ''} ${ticket.assigned_cor_id ? 'assigned' : ''}`}\n                  >\n                    <div className=\"ticket-item-main\">\n                      <label className=\"ticket-checkbox\">\n                        <input\n                          type=\"checkbox\"\n                          checked={isSelected}\n                          onChange={() => toggleTicket(ticket.id)}\n                          disabled={ticket.assigned_cor_id && ticket.assigned_cor_id !== corId}\n                        />\n                      </label>\n\n                      <div className=\"ticket-item-info\" onClick={() => setExpandedTicket(isExpanded ? null : ticket.id)}>\n                        <div className=\"ticket-item-header\">\n                          <span className=\"ticket-date\">{formatDate(ticket.ticket_date)}</span>\n                          <span className={`ticket-status ${ticket.status}`}>{ticket.status}</span>\n                          {ticket.ce_pco_number && (\n                            <span className=\"ticket-pco\">CE/PCO: {ticket.ce_pco_number}</span>\n                          )}\n                        </div>\n\n                        <div className=\"ticket-item-desc\">\n                          {ticket.work_description || 'No description'}\n                        </div>\n\n                        <div className=\"ticket-item-summary\">\n                          {summary.workerCount > 0 && (\n                            <span><Users size={12} /> {summary.workerCount} workers</span>\n                          )}\n                          {summary.itemCount > 0 && (\n                            <span><Package size={12} /> {summary.itemCount} items</span>\n                          )}\n                          {summary.equipmentCount > 0 && (\n                            <span><Truck size={12} /> {summary.equipmentCount} equipment</span>\n                          )}\n                          {summary.laborHours > 0 && (\n                            <span>{summary.laborHours} hrs</span>\n                          )}\n                        </div>\n                      </div>\n\n                      <button\n                        className=\"ticket-expand-btn\"\n                        onClick={() => setExpandedTicket(isExpanded ? null : ticket.id)}\n                      >\n                        {isExpanded ? <ChevronDown size={16} /> : <ChevronRight size={16} />}\n                      </button>\n                    </div>\n\n                    {isExpanded && (\n                      <div className=\"ticket-item-details\">\n                        {(ticket.t_and_m_workers || ticket.workers)?.length > 0 && (\n                          <div className=\"ticket-detail-section\">\n                            <h5>Workers</h5>\n                            <ul>\n                              {(ticket.t_and_m_workers || ticket.workers).map((w, i) => (\n                                <li key={i}>\n                                  {w.name || w.role} - {w.regular_hours || 0} reg hrs\n                                  {w.overtime_hours > 0 && `, ${w.overtime_hours} OT hrs`}\n                                </li>\n                              ))}\n                            </ul>\n                          </div>\n                        )}\n\n                        {(ticket.t_and_m_items || ticket.items)?.length > 0 && (\n                          <div className=\"ticket-detail-section\">\n                            <h5>Materials</h5>\n                            <ul>\n                              {(ticket.t_and_m_items || ticket.items).map((item, i) => (\n                                <li key={i}>\n                                  {item.description || item.name} - {item.quantity} {item.unit}\n                                </li>\n                              ))}\n                            </ul>\n                          </div>\n                        )}\n\n                        {ticket.materials_equipment?.filter(m => m.type === 'equipment').length > 0 && (\n                          <div className=\"ticket-detail-section\">\n                            <h5>Equipment</h5>\n                            <ul>\n                              {ticket.materials_equipment.filter(m => m.type === 'equipment').map((e, i) => (\n                                <li key={i}>\n                                  {e.description || e.name}\n                                </li>\n                              ))}\n                            </ul>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                )\n              })}\n            </div>\n          )}\n        </div>\n\n        <div className=\"modal-footer\">\n          <button className=\"btn btn-secondary\" onClick={onClose}>\n            Cancel\n          </button>\n          <button\n            className=\"btn btn-primary\"\n            onClick={handleImport}\n            disabled={selectedTickets.size === 0}\n          >\n            <Check size={16} /> Import {selectedTickets.size} Ticket{selectedTickets.size !== 1 ? 's' : ''}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { useState, useEffect, useMemo } from 'react'\nimport { X, Plus, Trash2, Save, Send, AlertCircle, FileText, Search, ChevronDown, ChevronRight } from 'lucide-react'\nimport { db } from '../../lib/supabase'\nimport {\n  formatCurrency,\n  formatPercent,\n  basisPointsToPercent,\n  percentToBasisPoints,\n  calculateLaborItemTotal,\n  calculateLineItemTotal,\n  calculateCORTotals,\n  validateCOR,\n  DEFAULT_PERCENTAGES,\n  LABOR_CLASSES,\n  WAGE_TYPES,\n  SOURCE_TYPES,\n  COMMON_UNITS\n} from '../../lib/corCalculations'\nimport TicketSelector from './TicketSelector'\n\nexport default function CORForm({ project, company, areas, existingCOR, onClose, onSaved, onShowToast }) {\n  const [loading, setLoading] = useState(false)\n  const [initialLoading, setInitialLoading] = useState(!!existingCOR?.id)\n  const [laborRates, setLaborRates] = useState([])\n  const [showTicketSelector, setShowTicketSelector] = useState(false)\n  const [importedTicketIds, setImportedTicketIds] = useState([]) // Track tickets imported for backup docs\n\n  // Expandable sections\n  const [expandedSections, setExpandedSections] = useState({\n    labor: existingCOR?.change_order_labor?.length > 0,\n    materials: existingCOR?.change_order_materials?.length > 0,\n    equipment: existingCOR?.change_order_equipment?.length > 0,\n    subcontractors: existingCOR?.change_order_subcontractors?.length > 0,\n    markups: false\n  })\n\n  // Quick select state for materials/equipment\n  const [companyMaterials, setCompanyMaterials] = useState([])\n  const [materialSearch, setMaterialSearch] = useState('')\n  const [materialCategory, setMaterialCategory] = useState('all')\n  const [equipmentSearch, setEquipmentSearch] = useState('')\n\n  // Basic Info (required)\n  const [title, setTitle] = useState(existingCOR?.title || '')\n  const [scopeOfWork, setScopeOfWork] = useState(existingCOR?.scope_of_work || '')\n  const [corNumber, setCORNumber] = useState(existingCOR?.cor_number || '')\n  const [groupName, setGroupName] = useState(existingCOR?.group_name || '')\n  const [areaId, setAreaId] = useState(existingCOR?.area_id || '')\n\n  // Period (optional)\n  const [periodStart, setPeriodStart] = useState(existingCOR?.period_start || '')\n  const [periodEnd, setPeriodEnd] = useState(existingCOR?.period_end || '')\n\n  // Labor Items\n  const [laborItems, setLaborItems] = useState(existingCOR?.change_order_labor || [])\n\n  // Materials Items\n  const [materialsItems, setMaterialsItems] = useState(existingCOR?.change_order_materials || [])\n\n  // Equipment Items\n  const [equipmentItems, setEquipmentItems] = useState(existingCOR?.change_order_equipment || [])\n\n  // Subcontractors Items\n  const [subcontractorsItems, setSubcontractorsItems] = useState(existingCOR?.change_order_subcontractors || [])\n\n  // Markups & Fees\n  const [laborMarkupPercent, setLaborMarkupPercent] = useState(\n    existingCOR?.labor_markup_percent ?? DEFAULT_PERCENTAGES.labor_markup\n  )\n  const [materialsMarkupPercent, setMaterialsMarkupPercent] = useState(\n    existingCOR?.materials_markup_percent ?? DEFAULT_PERCENTAGES.materials_markup\n  )\n  const [equipmentMarkupPercent, setEquipmentMarkupPercent] = useState(\n    existingCOR?.equipment_markup_percent ?? DEFAULT_PERCENTAGES.equipment_markup\n  )\n  const [subcontractorsMarkupPercent, setSubcontractorsMarkupPercent] = useState(\n    existingCOR?.subcontractors_markup_percent ?? DEFAULT_PERCENTAGES.subcontractors_markup\n  )\n  const [liabilityInsurancePercent, setLiabilityInsurancePercent] = useState(\n    existingCOR?.liability_insurance_percent ?? DEFAULT_PERCENTAGES.liability_insurance\n  )\n  const [bondPercent, setBondPercent] = useState(\n    existingCOR?.bond_percent ?? DEFAULT_PERCENTAGES.bond\n  )\n  const [licenseFeePercent, setLicenseFeePercent] = useState(\n    existingCOR?.license_fee_percent ?? DEFAULT_PERCENTAGES.license_fee\n  )\n\n  // When editing, fetch full COR data if line items are missing (e.g., opened from list view)\n  useEffect(() => {\n    const fetchFullCOR = async () => {\n      if (!existingCOR?.id) {\n        setInitialLoading(false)\n        return\n      }\n      // Check if we already have line items loaded (e.g., opened from CORDetail)\n      const hasLineItems = existingCOR.change_order_labor?.length > 0 ||\n                           existingCOR.change_order_materials?.length > 0 ||\n                           existingCOR.change_order_equipment?.length > 0 ||\n                           existingCOR.change_order_subcontractors?.length > 0\n      // If we have line item counts but no actual data, fetch the full COR\n      const hasCountsOnly = !hasLineItems && (\n        existingCOR.labor_count?.[0]?.count > 0 ||\n        existingCOR.materials_count?.[0]?.count > 0 ||\n        existingCOR.equipment_count?.[0]?.count > 0 ||\n        existingCOR.subcontractors_count?.[0]?.count > 0\n      )\n\n      if (hasCountsOnly) {\n        try {\n          const fullCOR = await db.getCORById(existingCOR.id)\n          if (fullCOR) {\n            setLaborItems(fullCOR.change_order_labor || [])\n            setMaterialsItems(fullCOR.change_order_materials || [])\n            setEquipmentItems(fullCOR.change_order_equipment || [])\n            setSubcontractorsItems(fullCOR.change_order_subcontractors || [])\n            setExpandedSections({\n              labor: fullCOR.change_order_labor?.length > 0,\n              materials: fullCOR.change_order_materials?.length > 0,\n              equipment: fullCOR.change_order_equipment?.length > 0,\n              subcontractors: fullCOR.change_order_subcontractors?.length > 0,\n              markups: false\n            })\n          }\n        } catch (error) {\n          console.error('Error fetching full COR data for editing:', error)\n          onShowToast?.('Error loading COR details for editing', 'error')\n        }\n      }\n      setInitialLoading(false)\n    }\n    fetchFullCOR()\n  }, [existingCOR?.id])\n\n  // Load labor rates and company materials on mount\n  useEffect(() => {\n    loadLaborRates()\n    loadCompanyMaterials()\n    if (!existingCOR) {\n      generateCORNumber()\n    }\n  }, [])\n\n  const loadCompanyMaterials = async () => {\n    try {\n      const data = await db.getAllMaterialsEquipment(company?.id)\n      setCompanyMaterials(data || [])\n    } catch (error) {\n      console.error('Error loading company materials:', error)\n    }\n  }\n\n  // Filter company materials for quick select\n  const filteredMaterials = useMemo(() => {\n    return companyMaterials.filter(item => {\n      if (!['Containment', 'PPE', 'Disposal'].includes(item.category)) return false\n      if (item.active === false) return false\n      if (materialCategory !== 'all' && item.category !== materialCategory) return false\n      if (materialSearch) {\n        return item.name.toLowerCase().includes(materialSearch.toLowerCase())\n      }\n      return true\n    })\n  }, [companyMaterials, materialSearch, materialCategory])\n\n  // Filter company equipment for quick select\n  const filteredEquipment = useMemo(() => {\n    return companyMaterials.filter(item => {\n      if (item.category !== 'Equipment') return false\n      if (item.active === false) return false\n      if (equipmentSearch) {\n        return item.name.toLowerCase().includes(equipmentSearch.toLowerCase())\n      }\n      return true\n    })\n  }, [companyMaterials, equipmentSearch])\n\n  const addMaterialFromLibrary = (libraryItem) => {\n    setMaterialsItems([...materialsItems, {\n      description: libraryItem.name,\n      source_type: 'field_ticket',\n      source_reference: '',\n      quantity: 1,\n      unit: libraryItem.unit || 'each',\n      unit_cost: libraryItem.cost_per_unit || 0,\n      total: libraryItem.cost_per_unit || 0\n    }])\n  }\n\n  const addEquipmentFromLibrary = (libraryItem) => {\n    setEquipmentItems([...equipmentItems, {\n      description: libraryItem.name,\n      source_type: 'rental',\n      source_reference: '',\n      quantity: 1,\n      unit: libraryItem.unit || 'day',\n      unit_cost: libraryItem.cost_per_unit || 0,\n      total: libraryItem.cost_per_unit || 0\n    }])\n  }\n\n  const loadLaborRates = async () => {\n    try {\n      const rates = await db.getLaborRates?.(company?.id, project?.work_type, project?.job_type)\n      setLaborRates(rates || [])\n    } catch (error) {\n      console.error('Error loading labor rates:', error)\n    }\n  }\n\n  const getRateForClass = (laborClass) => {\n    const classLower = laborClass?.toLowerCase() || ''\n    return laborRates.find(r => r.role?.toLowerCase() === classLower) || null\n  }\n\n  const generateCORNumber = async () => {\n    try {\n      const nextNumber = await db.getNextCORNumber?.(project.id)\n      setCORNumber(nextNumber || `COR-${Date.now()}`)\n    } catch (error) {\n      console.error('Error generating COR number:', error)\n      setCORNumber(`COR-${Date.now()}`)\n    }\n  }\n\n  // Toggle section expansion\n  const toggleSection = (section) => {\n    setExpandedSections(prev => ({\n      ...prev,\n      [section]: !prev[section]\n    }))\n  }\n\n  // Build COR object for calculations\n  const corData = useMemo(() => ({\n    title,\n    scope_of_work: scopeOfWork,\n    area_id: areaId || null,\n    cor_number: corNumber,\n    group_name: groupName || null,\n    period_start: periodStart || null,\n    period_end: periodEnd || null,\n    change_order_labor: laborItems,\n    change_order_materials: materialsItems,\n    change_order_equipment: equipmentItems,\n    change_order_subcontractors: subcontractorsItems,\n    labor_markup_percent: laborMarkupPercent,\n    materials_markup_percent: materialsMarkupPercent,\n    equipment_markup_percent: equipmentMarkupPercent,\n    subcontractors_markup_percent: subcontractorsMarkupPercent,\n    liability_insurance_percent: liabilityInsurancePercent,\n    bond_percent: bondPercent,\n    license_fee_percent: licenseFeePercent\n  }), [\n    title, scopeOfWork, areaId, corNumber, groupName, periodStart, periodEnd,\n    laborItems, materialsItems, equipmentItems, subcontractorsItems,\n    laborMarkupPercent, materialsMarkupPercent, equipmentMarkupPercent, subcontractorsMarkupPercent,\n    liabilityInsurancePercent, bondPercent, licenseFeePercent\n  ])\n\n  // Calculate totals\n  const totals = useMemo(() => calculateCORTotals(corData), [corData])\n\n  // Labor item management\n  const addLaborItem = () => {\n    const defaultClass = LABOR_CLASSES[0]\n    const rate = getRateForClass(defaultClass)\n    setLaborItems([...laborItems, {\n      id: `temp-${Date.now()}`,\n      labor_class: defaultClass,\n      wage_type: 'standard',\n      regular_hours: 0,\n      overtime_hours: 0,\n      regular_rate: rate ? Math.round((parseFloat(rate.regular_rate) || 0) * 100) : 0,\n      overtime_rate: rate ? Math.round((parseFloat(rate.overtime_rate) || 0) * 100) : 0,\n      total: 0\n    }])\n    if (!expandedSections.labor) toggleSection('labor')\n  }\n\n  const updateLaborItem = (index, field, value) => {\n    const newItems = [...laborItems]\n    newItems[index] = { ...newItems[index], [field]: value }\n\n    if (field === 'labor_class') {\n      const rate = getRateForClass(value)\n      if (rate) {\n        newItems[index].regular_rate = Math.round((parseFloat(rate.regular_rate) || 0) * 100)\n        newItems[index].overtime_rate = Math.round((parseFloat(rate.overtime_rate) || 0) * 100)\n      }\n    }\n\n    const { total } = calculateLaborItemTotal(\n      newItems[index].regular_hours,\n      newItems[index].overtime_hours,\n      newItems[index].regular_rate,\n      newItems[index].overtime_rate\n    )\n    newItems[index].total = total\n\n    setLaborItems(newItems)\n  }\n\n  const removeLaborItem = (index) => {\n    setLaborItems(laborItems.filter((_, i) => i !== index))\n  }\n\n  // Materials item management\n  const addMaterialsItem = () => {\n    setMaterialsItems([...materialsItems, {\n      id: `temp-${Date.now()}`,\n      description: '',\n      source_type: 'backup_sheet',\n      source_reference: '',\n      quantity: 1,\n      unit: 'each',\n      unit_cost: 0,\n      total: 0\n    }])\n    if (!expandedSections.materials) toggleSection('materials')\n  }\n\n  const updateMaterialsItem = (index, field, value) => {\n    const newItems = [...materialsItems]\n    newItems[index] = { ...newItems[index], [field]: value }\n    newItems[index].total = calculateLineItemTotal(\n      newItems[index].quantity,\n      newItems[index].unit_cost\n    )\n    setMaterialsItems(newItems)\n  }\n\n  const removeMaterialsItem = (index) => {\n    setMaterialsItems(materialsItems.filter((_, i) => i !== index))\n  }\n\n  // Equipment item management\n  const addEquipmentItem = () => {\n    setEquipmentItems([...equipmentItems, {\n      id: `temp-${Date.now()}`,\n      description: '',\n      source_type: 'backup_sheet',\n      source_reference: '',\n      quantity: 1,\n      unit: 'day',\n      unit_cost: 0,\n      total: 0\n    }])\n    if (!expandedSections.equipment) toggleSection('equipment')\n  }\n\n  const updateEquipmentItem = (index, field, value) => {\n    const newItems = [...equipmentItems]\n    newItems[index] = { ...newItems[index], [field]: value }\n    newItems[index].total = calculateLineItemTotal(\n      newItems[index].quantity,\n      newItems[index].unit_cost\n    )\n    setEquipmentItems(newItems)\n  }\n\n  const removeEquipmentItem = (index) => {\n    setEquipmentItems(equipmentItems.filter((_, i) => i !== index))\n  }\n\n  // Subcontractors item management\n  const addSubcontractorsItem = () => {\n    setSubcontractorsItems([...subcontractorsItems, {\n      id: `temp-${Date.now()}`,\n      company_name: '',\n      description: '',\n      source_type: 'invoice',\n      source_reference: '',\n      amount: 0,\n      total: 0\n    }])\n    if (!expandedSections.subcontractors) toggleSection('subcontractors')\n  }\n\n  const updateSubcontractorsItem = (index, field, value) => {\n    const newItems = [...subcontractorsItems]\n    newItems[index] = { ...newItems[index], [field]: value }\n    if (field === 'amount') {\n      newItems[index].total = parseInt(value) || 0\n    }\n    setSubcontractorsItems(newItems)\n  }\n\n  const removeSubcontractorsItem = (index) => {\n    setSubcontractorsItems(subcontractorsItems.filter((_, i) => i !== index))\n  }\n\n  // Import from T&M tickets\n  const handleTicketImport = (importData) => {\n    // Store imported ticket IDs for linking after save\n    if (importData.ticketIds?.length > 0) {\n      setImportedTicketIds(prev => [...new Set([...prev, ...importData.ticketIds])])\n    }\n\n    if (importData.laborItems?.length > 0) {\n      setLaborItems([...laborItems, ...importData.laborItems])\n      setExpandedSections(prev => ({ ...prev, labor: true }))\n    }\n    if (importData.materialsItems?.length > 0) {\n      setMaterialsItems([...materialsItems, ...importData.materialsItems])\n      setExpandedSections(prev => ({ ...prev, materials: true }))\n    }\n    if (importData.equipmentItems?.length > 0) {\n      setEquipmentItems([...equipmentItems, ...importData.equipmentItems])\n      setExpandedSections(prev => ({ ...prev, equipment: true }))\n    }\n\n    const itemCount = (importData.laborItems?.length || 0) +\n                      (importData.materialsItems?.length || 0) +\n                      (importData.equipmentItems?.length || 0)\n\n    onShowToast?.(`Imported ${itemCount} item(s) from ${importData.ticketIds.length} ticket(s)`, 'success')\n  }\n\n  // Check if title is provided (minimum requirement)\n  const canSave = title.trim().length > 0\n\n  // Build database payload (excludes relation fields that aren't columns)\n  const buildPayload = () => ({\n    company_id: company.id,\n    project_id: project.id,\n    title,\n    scope_of_work: scopeOfWork || '',\n    area_id: areaId || null,\n    cor_number: corNumber,\n    group_name: groupName || null,\n    period_start: periodStart || new Date().toISOString().split('T')[0],\n    period_end: periodEnd || new Date().toISOString().split('T')[0],\n    labor_markup_percent: laborMarkupPercent,\n    materials_markup_percent: materialsMarkupPercent,\n    equipment_markup_percent: equipmentMarkupPercent,\n    subcontractors_markup_percent: subcontractorsMarkupPercent,\n    liability_insurance_percent: liabilityInsurancePercent,\n    bond_percent: bondPercent,\n    license_fee_percent: licenseFeePercent,\n    ...totals\n  })\n\n  // Save COR - preserves current status when editing, defaults to draft for new\n  const handleSave = async () => {\n    if (!canSave) {\n      onShowToast?.('Title is required', 'error')\n      return\n    }\n\n    setLoading(true)\n    try {\n      const corPayload = buildPayload()\n\n      let savedCOR\n      if (existingCOR?.id) {\n        // Preserve existing status when editing - don't reset to draft\n        savedCOR = await db.updateCOR(existingCOR.id, corPayload)\n      } else {\n        // New CORs start as draft\n        corPayload.status = 'draft'\n        savedCOR = await db.createCOR(corPayload)\n      }\n\n      if (savedCOR?.id) {\n        await db.saveCORLineItems(savedCOR.id, {\n          laborItems,\n          materialItems: materialsItems,\n          equipmentItems,\n          subcontractorItems: subcontractorsItems\n        })\n\n        // Link imported tickets to this COR as backup documentation\n        if (importedTicketIds.length > 0) {\n          for (const ticketId of importedTicketIds) {\n            try {\n              await db.assignTicketToCOR(ticketId, savedCOR.id)\n            } catch (linkError) {\n              console.warn(`Could not link ticket ${ticketId} to COR:`, linkError)\n            }\n          }\n        }\n      }\n\n      onShowToast?.(existingCOR?.id ? 'COR saved' : 'COR saved as draft', 'success')\n      onSaved?.(savedCOR)\n      onClose?.()\n    } catch (error) {\n      console.error('Error saving COR:', error)\n      onShowToast?.('Error saving COR', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Submit for approval\n  const handleSubmit = async () => {\n    const validation = validateCOR(corData)\n    if (!validation.valid) {\n      onShowToast?.(validation.errors[0], 'error')\n      return\n    }\n\n    setLoading(true)\n    try {\n      const corPayload = buildPayload()\n\n      let savedCOR\n      let corIdToUse\n      if (existingCOR?.id) {\n        // Save line items and then submit for approval\n        savedCOR = await db.updateCOR(existingCOR.id, corPayload)\n        corIdToUse = existingCOR.id\n        await db.saveCORLineItems(existingCOR.id, {\n          laborItems,\n          materialItems: materialsItems,\n          equipmentItems,\n          subcontractorItems: subcontractorsItems\n        })\n        await db.submitCORForApproval(existingCOR.id)\n      } else {\n        // New COR - create as draft then submit\n        corPayload.status = 'draft'\n        savedCOR = await db.createCOR(corPayload)\n        if (savedCOR?.id) {\n          corIdToUse = savedCOR.id\n          await db.saveCORLineItems(savedCOR.id, {\n            laborItems,\n            materialItems: materialsItems,\n            equipmentItems,\n            subcontractorItems: subcontractorsItems\n          })\n          await db.submitCORForApproval(savedCOR.id)\n        }\n      }\n\n      // Link imported tickets to this COR as backup documentation\n      if (corIdToUse && importedTicketIds.length > 0) {\n        for (const ticketId of importedTicketIds) {\n          try {\n            await db.assignTicketToCOR(ticketId, corIdToUse)\n          } catch (linkError) {\n            console.warn(`Could not link ticket ${ticketId} to COR:`, linkError)\n          }\n        }\n      }\n\n      onShowToast?.('COR submitted for approval', 'success')\n      onSaved?.(savedCOR)\n      onClose?.()\n    } catch (error) {\n      console.error('Error submitting COR:', error)\n      onShowToast?.('Error submitting COR', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Section header component\n  const SectionHeader = ({ section, label, count, subtotal }) => (\n    <div\n      className={`cor-section-header ${expandedSections[section] ? 'expanded' : ''}`}\n      onClick={() => toggleSection(section)}\n    >\n      <div className=\"cor-section-title\">\n        {expandedSections[section] ? <ChevronDown size={18} /> : <ChevronRight size={18} />}\n        <span>{label}</span>\n        {count > 0 && <span className=\"cor-section-count\">{count}</span>}\n      </div>\n      {subtotal > 0 && (\n        <span className=\"cor-section-subtotal\">{formatCurrency(subtotal)}</span>\n      )}\n    </div>\n  )\n\n  if (initialLoading) {\n    return (\n      <div className=\"modal-overlay\" onClick={onClose}>\n        <div className=\"modal-content cor-form-modal cor-form-simplified\" onClick={e => e.stopPropagation()}>\n          <div className=\"modal-header\">\n            <h2>Loading COR...</h2>\n            <button className=\"close-btn\" onClick={onClose}><X size={20} /></button>\n          </div>\n          <div className=\"modal-body cor-form-body\" style={{ padding: '2rem', textAlign: 'center', color: 'var(--text-secondary)' }}>\n            Loading change order data for editing...\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"modal-overlay\" onClick={onClose}>\n      <div className=\"modal-content cor-form-modal cor-form-simplified\" onClick={e => e.stopPropagation()}>\n        <div className=\"modal-header\">\n          <h2>{existingCOR ? 'Edit Change Order Request' : 'New Change Order Request'}</h2>\n          <button className=\"close-btn\" onClick={onClose}><X size={20} /></button>\n        </div>\n\n        <div className=\"modal-body cor-form-body\">\n          {/* Required: Title and Description */}\n          <div className=\"cor-form-required\">\n            <div className=\"form-row\">\n              <div className=\"form-group cor-number-field\">\n                <label>COR #</label>\n                <input\n                  type=\"text\"\n                  value={corNumber}\n                  onChange={(e) => setCORNumber(e.target.value)}\n                  className=\"input-small\"\n                />\n              </div>\n              <div className=\"form-group flex-grow required\">\n                <label>Title</label>\n                <input\n                  type=\"text\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                  placeholder=\"e.g., Additional Demolition Work - Building A\"\n                  className=\"input-required\"\n                />\n              </div>\n            </div>\n\n            <div className=\"form-group required\">\n              <label>Description</label>\n              <textarea\n                value={scopeOfWork}\n                onChange={(e) => setScopeOfWork(e.target.value)}\n                rows={2}\n                placeholder=\"Describe the scope of work\"\n                className=\"input-required\"\n              />\n            </div>\n\n            <div className=\"form-row form-row-compact\">\n              {areas && areas.length > 0 && (\n                <div className=\"form-group\">\n                  <label>Area</label>\n                  <select value={areaId} onChange={(e) => setAreaId(e.target.value)}>\n                    <option value=\"\">None</option>\n                    {areas.map(area => (\n                      <option key={area.id} value={area.id}>{area.name}</option>\n                    ))}\n                  </select>\n                </div>\n              )}\n              <div className=\"form-group\">\n                <label>Group</label>\n                <input\n                  type=\"text\"\n                  value={groupName}\n                  onChange={(e) => setGroupName(e.target.value)}\n                  placeholder=\"e.g., Phase 1\"\n                />\n              </div>\n              <div className=\"form-group\">\n                <label>Start</label>\n                <input\n                  type=\"date\"\n                  value={periodStart}\n                  onChange={(e) => setPeriodStart(e.target.value)}\n                />\n              </div>\n              <div className=\"form-group\">\n                <label>End</label>\n                <input\n                  type=\"date\"\n                  value={periodEnd}\n                  onChange={(e) => setPeriodEnd(e.target.value)}\n                  min={periodStart}\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Import from Tickets button */}\n          <div className=\"cor-import-bar\">\n            <button className=\"btn btn-ghost\" onClick={() => setShowTicketSelector(true)}>\n              <FileText size={16} /> Import from T&M Tickets\n            </button>\n          </div>\n\n          {/* Expandable Sections */}\n          <div className=\"cor-sections\">\n            {/* Labor Section */}\n            <div className=\"cor-section\">\n              <SectionHeader\n                section=\"labor\"\n                label=\"Labor\"\n                count={laborItems.length}\n                subtotal={totals.labor_subtotal}\n              />\n              {expandedSections.labor && (\n                <div className=\"cor-section-content\">\n                  {laborItems.map((item, index) => (\n                    <div key={item.id || index} className=\"line-item compact\">\n                      <div className=\"line-item-row\">\n                        <select\n                          value={item.labor_class}\n                          onChange={(e) => updateLaborItem(index, 'labor_class', e.target.value)}\n                        >\n                          {LABOR_CLASSES.map(lc => (\n                            <option key={lc} value={lc}>{lc}</option>\n                          ))}\n                        </select>\n                        <select\n                          value={item.wage_type}\n                          onChange={(e) => updateLaborItem(index, 'wage_type', e.target.value)}\n                        >\n                          {WAGE_TYPES.map(wt => (\n                            <option key={wt.value} value={wt.value}>{wt.label}</option>\n                          ))}\n                        </select>\n                        <input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"Reg hrs\"\n                          value={item.regular_hours || ''}\n                          onChange={(e) => updateLaborItem(index, 'regular_hours', e.target.value)}\n                          className=\"input-small\"\n                        />\n                        <span className=\"input-label\">@</span>\n                        <input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"$/hr\"\n                          value={item.regular_rate ? (item.regular_rate / 100).toFixed(2) : ''}\n                          onChange={(e) => {\n                            const val = e.target.value\n                            updateLaborItem(index, 'regular_rate', Math.round(parseFloat(val || 0) * 100))\n                          }}\n                          className=\"input-small\"\n                        />\n                        <input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"OT hrs\"\n                          value={item.overtime_hours || ''}\n                          onChange={(e) => updateLaborItem(index, 'overtime_hours', e.target.value)}\n                          className=\"input-small\"\n                        />\n                        <span className=\"input-label\">@</span>\n                        <input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"$/hr\"\n                          value={item.overtime_rate ? (item.overtime_rate / 100).toFixed(2) : ''}\n                          onChange={(e) => {\n                            const val = e.target.value\n                            updateLaborItem(index, 'overtime_rate', Math.round(parseFloat(val || 0) * 100))\n                          }}\n                          className=\"input-small\"\n                        />\n                        <span className=\"line-item-total\">{formatCurrency(item.total)}</span>\n                        <button className=\"btn-icon\" onClick={() => removeLaborItem(index)}>\n                          <Trash2 size={14} />\n                        </button>\n                      </div>\n                    </div>\n                  ))}\n                  <button className=\"btn btn-ghost btn-add\" onClick={addLaborItem}>\n                    <Plus size={14} /> Add Labor\n                  </button>\n                </div>\n              )}\n            </div>\n\n            {/* Materials Section */}\n            <div className=\"cor-section\">\n              <SectionHeader\n                section=\"materials\"\n                label=\"Materials\"\n                count={materialsItems.length}\n                subtotal={totals.materials_subtotal}\n              />\n              {expandedSections.materials && (\n                <div className=\"cor-section-content\">\n                  {/* Quick select */}\n                  {companyMaterials.filter(m => ['Containment', 'PPE', 'Disposal'].includes(m.category) && m.active !== false).length > 0 && (\n                    <div className=\"quick-select-compact\">\n                      <div className=\"quick-select-search\">\n                        <Search size={14} />\n                        <input\n                          type=\"text\"\n                          placeholder=\"Search materials...\"\n                          value={materialSearch}\n                          onChange={(e) => setMaterialSearch(e.target.value)}\n                        />\n                      </div>\n                      <div className=\"quick-select-items\">\n                        {filteredMaterials.slice(0, 8).map(item => (\n                          <button\n                            key={item.id}\n                            className=\"quick-item\"\n                            onClick={() => addMaterialFromLibrary(item)}\n                          >\n                            {item.name}\n                          </button>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n\n                  {materialsItems.map((item, index) => (\n                    <div key={item.id || index} className=\"line-item compact\">\n                      <div className=\"line-item-row\">\n                        <input\n                          type=\"text\"\n                          placeholder=\"Description\"\n                          value={item.description}\n                          onChange={(e) => updateMaterialsItem(index, 'description', e.target.value)}\n                          className=\"input-wide\"\n                        />\n                        <input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"Qty\"\n                          value={item.quantity || ''}\n                          onChange={(e) => updateMaterialsItem(index, 'quantity', e.target.value)}\n                          className=\"input-small\"\n                        />\n                        <select\n                          value={item.unit}\n                          onChange={(e) => updateMaterialsItem(index, 'unit', e.target.value)}\n                        >\n                          {COMMON_UNITS.map(u => (\n                            <option key={u} value={u}>{u}</option>\n                          ))}\n                        </select>\n                        <span className=\"input-label\">@</span>\n                        <input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"$/unit\"\n                          value={item.unit_cost ? (item.unit_cost / 100).toFixed(2) : ''}\n                          onChange={(e) => {\n                            const val = e.target.value\n                            updateMaterialsItem(index, 'unit_cost', Math.round(parseFloat(val || 0) * 100))\n                          }}\n                          className=\"input-small\"\n                        />\n                        <span className=\"line-item-total\">{formatCurrency(item.total)}</span>\n                        <button className=\"btn-icon\" onClick={() => removeMaterialsItem(index)}>\n                          <Trash2 size={14} />\n                        </button>\n                      </div>\n                    </div>\n                  ))}\n                  <button className=\"btn btn-ghost btn-add\" onClick={addMaterialsItem}>\n                    <Plus size={14} /> Add Material\n                  </button>\n                </div>\n              )}\n            </div>\n\n            {/* Equipment Section */}\n            <div className=\"cor-section\">\n              <SectionHeader\n                section=\"equipment\"\n                label=\"Equipment\"\n                count={equipmentItems.length}\n                subtotal={totals.equipment_subtotal}\n              />\n              {expandedSections.equipment && (\n                <div className=\"cor-section-content\">\n                  {/* Quick select */}\n                  {companyMaterials.filter(m => m.category === 'Equipment' && m.active !== false).length > 0 && (\n                    <div className=\"quick-select-compact\">\n                      <div className=\"quick-select-search\">\n                        <Search size={14} />\n                        <input\n                          type=\"text\"\n                          placeholder=\"Search equipment...\"\n                          value={equipmentSearch}\n                          onChange={(e) => setEquipmentSearch(e.target.value)}\n                        />\n                      </div>\n                      <div className=\"quick-select-items\">\n                        {filteredEquipment.slice(0, 8).map(item => (\n                          <button\n                            key={item.id}\n                            className=\"quick-item\"\n                            onClick={() => addEquipmentFromLibrary(item)}\n                          >\n                            {item.name}\n                          </button>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n\n                  {equipmentItems.map((item, index) => (\n                    <div key={item.id || index} className=\"line-item compact\">\n                      <div className=\"line-item-row\">\n                        <input\n                          type=\"text\"\n                          placeholder=\"Description\"\n                          value={item.description}\n                          onChange={(e) => updateEquipmentItem(index, 'description', e.target.value)}\n                          className=\"input-wide\"\n                        />\n                        <input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"Qty\"\n                          value={item.quantity || ''}\n                          onChange={(e) => updateEquipmentItem(index, 'quantity', e.target.value)}\n                          className=\"input-small\"\n                        />\n                        <select\n                          value={item.unit}\n                          onChange={(e) => updateEquipmentItem(index, 'unit', e.target.value)}\n                        >\n                          {COMMON_UNITS.map(u => (\n                            <option key={u} value={u}>{u}</option>\n                          ))}\n                        </select>\n                        <span className=\"input-label\">@</span>\n                        <input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"$/unit\"\n                          value={item.unit_cost ? (item.unit_cost / 100).toFixed(2) : ''}\n                          onChange={(e) => {\n                            const val = e.target.value\n                            updateEquipmentItem(index, 'unit_cost', Math.round(parseFloat(val || 0) * 100))\n                          }}\n                          className=\"input-small\"\n                        />\n                        <span className=\"line-item-total\">{formatCurrency(item.total)}</span>\n                        <button className=\"btn-icon\" onClick={() => removeEquipmentItem(index)}>\n                          <Trash2 size={14} />\n                        </button>\n                      </div>\n                    </div>\n                  ))}\n                  <button className=\"btn btn-ghost btn-add\" onClick={addEquipmentItem}>\n                    <Plus size={14} /> Add Equipment\n                  </button>\n                </div>\n              )}\n            </div>\n\n            {/* Subcontractors Section */}\n            <div className=\"cor-section\">\n              <SectionHeader\n                section=\"subcontractors\"\n                label=\"Subcontractors\"\n                count={subcontractorsItems.length}\n                subtotal={totals.subcontractors_subtotal}\n              />\n              {expandedSections.subcontractors && (\n                <div className=\"cor-section-content\">\n                  {subcontractorsItems.map((item, index) => (\n                    <div key={item.id || index} className=\"line-item compact\">\n                      <div className=\"line-item-row\">\n                        <input\n                          type=\"text\"\n                          placeholder=\"Company\"\n                          value={item.company_name}\n                          onChange={(e) => updateSubcontractorsItem(index, 'company_name', e.target.value)}\n                          className=\"input-wide\"\n                        />\n                        <input\n                          type=\"text\"\n                          placeholder=\"Description\"\n                          value={item.description}\n                          onChange={(e) => updateSubcontractorsItem(index, 'description', e.target.value)}\n                          className=\"input-wide\"\n                        />\n                        <input\n                          type=\"text\"\n                          placeholder=\"Invoice #\"\n                          value={item.source_reference || ''}\n                          onChange={(e) => updateSubcontractorsItem(index, 'source_reference', e.target.value)}\n                          className=\"input-small\"\n                        />\n                        <input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"Amount\"\n                          value={item.amount ? (item.amount / 100).toFixed(2) : ''}\n                          onChange={(e) => {\n                            const val = e.target.value\n                            updateSubcontractorsItem(index, 'amount', Math.round(parseFloat(val || 0) * 100))\n                          }}\n                          className=\"input-small\"\n                        />\n                        <span className=\"line-item-total\">{formatCurrency(item.total)}</span>\n                        <button className=\"btn-icon\" onClick={() => removeSubcontractorsItem(index)}>\n                          <Trash2 size={14} />\n                        </button>\n                      </div>\n                    </div>\n                  ))}\n                  <button className=\"btn btn-ghost btn-add\" onClick={addSubcontractorsItem}>\n                    <Plus size={14} /> Add Subcontractor\n                  </button>\n                </div>\n              )}\n            </div>\n\n            {/* Markups & Fees Section */}\n            <div className=\"cor-section\">\n              <SectionHeader\n                section=\"markups\"\n                label=\"Markups & Fees\"\n                count={0}\n                subtotal={totals.total_markup_amount + totals.total_fees}\n              />\n              {expandedSections.markups && (\n                <div className=\"cor-section-content markups-content\">\n                  <div className=\"markups-grid-compact\">\n                    <div className=\"markup-row\">\n                      <span>Labor Markup</span>\n                      <div className=\"markup-input-compact\">\n                        <input\n                          type=\"text\"\n                          inputMode=\"decimal\"\n                          value={basisPointsToPercent(laborMarkupPercent)}\n                          onChange={(e) => setLaborMarkupPercent(percentToBasisPoints(e.target.value.replace(/[^0-9.]/g, '')))}\n                        />\n                        <span>%</span>\n                      </div>\n                      <span className=\"markup-result\">+{formatCurrency(totals.labor_markup_amount)}</span>\n                    </div>\n                    <div className=\"markup-row\">\n                      <span>Materials Markup</span>\n                      <div className=\"markup-input-compact\">\n                        <input\n                          type=\"text\"\n                          inputMode=\"decimal\"\n                          value={basisPointsToPercent(materialsMarkupPercent)}\n                          onChange={(e) => setMaterialsMarkupPercent(percentToBasisPoints(e.target.value.replace(/[^0-9.]/g, '')))}\n                        />\n                        <span>%</span>\n                      </div>\n                      <span className=\"markup-result\">+{formatCurrency(totals.materials_markup_amount)}</span>\n                    </div>\n                    <div className=\"markup-row\">\n                      <span>Equipment Markup</span>\n                      <div className=\"markup-input-compact\">\n                        <input\n                          type=\"text\"\n                          inputMode=\"decimal\"\n                          value={basisPointsToPercent(equipmentMarkupPercent)}\n                          onChange={(e) => setEquipmentMarkupPercent(percentToBasisPoints(e.target.value.replace(/[^0-9.]/g, '')))}\n                        />\n                        <span>%</span>\n                      </div>\n                      <span className=\"markup-result\">+{formatCurrency(totals.equipment_markup_amount)}</span>\n                    </div>\n                    <div className=\"markup-row\">\n                      <span>Subcontractors Markup</span>\n                      <div className=\"markup-input-compact\">\n                        <input\n                          type=\"text\"\n                          inputMode=\"decimal\"\n                          value={basisPointsToPercent(subcontractorsMarkupPercent)}\n                          onChange={(e) => setSubcontractorsMarkupPercent(percentToBasisPoints(e.target.value.replace(/[^0-9.]/g, '')))}\n                        />\n                        <span>%</span>\n                      </div>\n                      <span className=\"markup-result\">+{formatCurrency(totals.subcontractors_markup_amount)}</span>\n                    </div>\n                  </div>\n                  <div className=\"fees-grid-compact\">\n                    <div className=\"markup-row\">\n                      <span>Liability Insurance</span>\n                      <div className=\"markup-input-compact\">\n                        <input\n                          type=\"text\"\n                          inputMode=\"decimal\"\n                          value={basisPointsToPercent(liabilityInsurancePercent)}\n                          onChange={(e) => setLiabilityInsurancePercent(percentToBasisPoints(e.target.value.replace(/[^0-9.]/g, '')))}\n                        />\n                        <span>%</span>\n                      </div>\n                      <span className=\"markup-result\">+{formatCurrency(totals.liability_insurance_amount)}</span>\n                    </div>\n                    <div className=\"markup-row\">\n                      <span>Bond</span>\n                      <div className=\"markup-input-compact\">\n                        <input\n                          type=\"text\"\n                          inputMode=\"decimal\"\n                          value={basisPointsToPercent(bondPercent)}\n                          onChange={(e) => setBondPercent(percentToBasisPoints(e.target.value.replace(/[^0-9.]/g, '')))}\n                        />\n                        <span>%</span>\n                      </div>\n                      <span className=\"markup-result\">+{formatCurrency(totals.bond_amount)}</span>\n                    </div>\n                    <div className=\"markup-row\">\n                      <span>City License Fee</span>\n                      <div className=\"markup-input-compact\">\n                        <input\n                          type=\"text\"\n                          inputMode=\"decimal\"\n                          value={basisPointsToPercent(licenseFeePercent)}\n                          onChange={(e) => setLicenseFeePercent(percentToBasisPoints(e.target.value.replace(/[^0-9.]/g, '')))}\n                        />\n                        <span>%</span>\n                      </div>\n                      <span className=\"markup-result\">+{formatCurrency(totals.license_fee_amount)}</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Summary Footer */}\n          <div className=\"cor-summary-bar\">\n            <div className=\"cor-summary-item\">\n              <span>Subtotal</span>\n              <span>{formatCurrency(totals.cor_subtotal)}</span>\n            </div>\n            <div className=\"cor-summary-item total\">\n              <span>Total</span>\n              <span>{formatCurrency(totals.cor_total)}</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Footer Actions */}\n        <div className=\"modal-footer cor-form-footer\">\n          <button className=\"btn btn-secondary\" onClick={onClose} disabled={loading}>\n            Cancel\n          </button>\n          <div className=\"footer-actions\">\n            <button\n              className=\"btn btn-secondary\"\n              onClick={handleSave}\n              disabled={loading || !canSave}\n            >\n              <Save size={16} /> Save Draft\n            </button>\n            <button\n              className=\"btn btn-primary\"\n              onClick={handleSubmit}\n              disabled={loading || !validateCOR(corData).valid}\n            >\n              <Send size={16} /> Submit\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Ticket Selector Modal */}\n      {showTicketSelector && (\n        <TicketSelector\n          projectId={project.id}\n          corId={existingCOR?.id}\n          onImport={handleTicketImport}\n          onClose={() => setShowTicketSelector(false)}\n          onShowToast={onShowToast}\n        />\n      )}\n    </div>\n  )\n}\n"],"names":["generateRandomId","array","b","TicketSelector","projectId","corId","onImport","onClose","onShowToast","tickets","setTickets","useState","loading","setLoading","selectedTickets","setSelectedTickets","expandedTicket","setExpandedTicket","searchTerm","setSearchTerm","filter","setFilter","useEffect","loadTickets","allTickets","db","error","filteredTickets","useMemo","filtered","t","term","a","toggleTicket","ticketId","newSelected","toggleAll","formatDate","dateStr","getTicketSummary","ticket","workers","items","workerCount","itemCount","equipmentCount","item","category","laborHours","w","handleImport","ticketsToImport","laborItems","materialsItems","equipmentItems","worker","materialInfo","itemDescription","itemUnit","itemCost","itemQty","dollarsToCents","jsx","e","jsxs","X","Search","FileText","summary","isSelected","isExpanded","Users","Package","Truck","ChevronDown","ChevronRight","i","m","Check","CORForm","project","company","areas","existingCOR","onSaved","initialLoading","setInitialLoading","laborRates","setLaborRates","showTicketSelector","setShowTicketSelector","importedTicketIds","setImportedTicketIds","expandedSections","setExpandedSections","companyMaterials","setCompanyMaterials","materialSearch","setMaterialSearch","materialCategory","setMaterialCategory","equipmentSearch","setEquipmentSearch","title","setTitle","scopeOfWork","setScopeOfWork","corNumber","setCORNumber","groupName","setGroupName","areaId","setAreaId","periodStart","setPeriodStart","periodEnd","setPeriodEnd","setLaborItems","setMaterialsItems","setEquipmentItems","subcontractorsItems","setSubcontractorsItems","laborMarkupPercent","setLaborMarkupPercent","DEFAULT_PERCENTAGES","materialsMarkupPercent","setMaterialsMarkupPercent","equipmentMarkupPercent","setEquipmentMarkupPercent","subcontractorsMarkupPercent","setSubcontractorsMarkupPercent","liabilityInsurancePercent","setLiabilityInsurancePercent","bondPercent","setBondPercent","licenseFeePercent","setLicenseFeePercent","fullCOR","loadLaborRates","loadCompanyMaterials","generateCORNumber","data","filteredMaterials","filteredEquipment","addMaterialFromLibrary","libraryItem","addEquipmentFromLibrary","rates","getRateForClass","laborClass","classLower","r","nextNumber","toggleSection","section","prev","corData","totals","calculateCORTotals","addLaborItem","defaultClass","LABOR_CLASSES","rate","updateLaborItem","index","field","value","newItems","total","calculateLaborItemTotal","removeLaborItem","_","addMaterialsItem","updateMaterialsItem","calculateLineItemTotal","removeMaterialsItem","addEquipmentItem","updateEquipmentItem","removeEquipmentItem","addSubcontractorsItem","updateSubcontractorsItem","removeSubcontractorsItem","handleTicketImport","importData","canSave","buildPayload","handleSave","corPayload","savedCOR","linkError","handleSubmit","validation","validateCOR","corIdToUse","SectionHeader","label","count","subtotal","formatCurrency","area","lc","WAGE_TYPES","wt","val","Trash2","Plus","COMMON_UNITS","u","basisPointsToPercent","percentToBasisPoints","Save","Send"],"mappings":"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"}