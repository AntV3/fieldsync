import{r as Zp,a as Ip,b as Ex}from"./react-DXGY7bZi.js";import{c as Dx}from"./supabase-VuevzHjS.js";import{u as hn,w as Mx,r as Tx}from"./xlsx-BTp1RmNK.js";import{E as Fi,a as fn}from"./pdf-C0G31WKZ.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))i(m);new MutationObserver(m=>{for(const u of m)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function o(m){const u={};return m.integrity&&(u.integrity=m.integrity),m.referrerPolicy&&(u.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?u.credentials="include":m.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(m){if(m.ep)return;m.ep=!0;const u=o(m);fetch(m.href,u)}})();var Jo={exports:{}},fl={};var xp;function Ax(){if(xp)return fl;xp=1;var r=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function o(i,m,u){var f=null;if(u!==void 0&&(f=""+u),m.key!==void 0&&(f=""+m.key),"key"in m){u={};for(var g in m)g!=="key"&&(u[g]=m[g])}else u=m;return m=u.ref,{$$typeof:r,type:i,key:f,ref:m!==void 0?m:null,props:u}}return fl.Fragment=l,fl.jsx=o,fl.jsxs=o,fl}var jp;function zx(){return jp||(jp=1,Jo.exports=Ax()),Jo.exports}var e=zx(),p=Zp();const Ox=Ip(p);var Wo={exports:{}},gl={},Ko={exports:{}},ed={};var vp;function Rx(){return vp||(vp=1,(function(r){function l(N,se){var E=N.length;N.push(se);e:for(;0<E;){var xe=E-1>>>1,k=N[xe];if(0<m(k,se))N[xe]=se,N[E]=k,E=xe;else break e}}function o(N){return N.length===0?null:N[0]}function i(N){if(N.length===0)return null;var se=N[0],E=N.pop();if(E!==se){N[0]=E;e:for(var xe=0,k=N.length,U=k>>>1;xe<U;){var ie=2*(xe+1)-1,T=N[ie],je=ie+1,I=N[je];if(0>m(T,E))je<k&&0>m(I,T)?(N[xe]=I,N[je]=E,xe=je):(N[xe]=T,N[ie]=E,xe=ie);else if(je<k&&0>m(I,E))N[xe]=I,N[je]=E,xe=je;else break e}}return se}function m(N,se){var E=N.sortIndex-se.sortIndex;return E!==0?E:N.id-se.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;r.unstable_now=function(){return u.now()}}else{var f=Date,g=f.now();r.unstable_now=function(){return f.now()-g}}var j=[],v=[],x=1,q=null,L=3,M=!1,P=!1,V=!1,J=!1,ae=typeof setTimeout=="function"?setTimeout:null,F=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function S(N){for(var se=o(v);se!==null;){if(se.callback===null)i(v);else if(se.startTime<=N)i(v),se.sortIndex=se.expirationTime,l(j,se);else break;se=o(v)}}function K(N){if(V=!1,S(N),!P)if(o(j)!==null)P=!0,pe||(pe=!0,b());else{var se=o(v);se!==null&&de(K,se.startTime-N)}}var pe=!1,$=-1,G=5,B=-1;function Z(){return J?!0:!(r.unstable_now()-B<G)}function C(){if(J=!1,pe){var N=r.unstable_now();B=N;var se=!0;try{e:{P=!1,V&&(V=!1,F($),$=-1),M=!0;var E=L;try{t:{for(S(N),q=o(j);q!==null&&!(q.expirationTime>N&&Z());){var xe=q.callback;if(typeof xe=="function"){q.callback=null,L=q.priorityLevel;var k=xe(q.expirationTime<=N);if(N=r.unstable_now(),typeof k=="function"){q.callback=k,S(N),se=!0;break t}q===o(j)&&i(j),S(N)}else i(j);q=o(j)}if(q!==null)se=!0;else{var U=o(v);U!==null&&de(K,U.startTime-N),se=!1}}break e}finally{q=null,L=E,M=!1}se=void 0}}finally{se?b():pe=!1}}}var b;if(typeof R=="function")b=function(){R(C)};else if(typeof MessageChannel<"u"){var A=new MessageChannel,z=A.port2;A.port1.onmessage=C,b=function(){z.postMessage(null)}}else b=function(){ae(C,0)};function de(N,se){$=ae(function(){N(r.unstable_now())},se)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(N){N.callback=null},r.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<N?Math.floor(1e3/N):5},r.unstable_getCurrentPriorityLevel=function(){return L},r.unstable_next=function(N){switch(L){case 1:case 2:case 3:var se=3;break;default:se=L}var E=L;L=se;try{return N()}finally{L=E}},r.unstable_requestPaint=function(){J=!0},r.unstable_runWithPriority=function(N,se){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var E=L;L=N;try{return se()}finally{L=E}},r.unstable_scheduleCallback=function(N,se,E){var xe=r.unstable_now();switch(typeof E=="object"&&E!==null?(E=E.delay,E=typeof E=="number"&&0<E?xe+E:xe):E=xe,N){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=E+k,N={id:x++,callback:se,priorityLevel:N,startTime:E,expirationTime:k,sortIndex:-1},E>xe?(N.sortIndex=E,l(v,N),o(j)===null&&N===o(v)&&(V?(F($),$=-1):V=!0,de(K,E-xe))):(N.sortIndex=k,l(j,N),P||M||(P=!0,pe||(pe=!0,b()))),N},r.unstable_shouldYield=Z,r.unstable_wrapCallback=function(N){var se=L;return function(){var E=L;L=se;try{return N.apply(this,arguments)}finally{L=E}}}})(ed)),ed}var yp;function qx(){return yp||(yp=1,Ko.exports=Rx()),Ko.exports}var bp;function Lx(){if(bp)return gl;bp=1;var r=qx(),l=Zp(),o=Ex();function i(t){var a="https://react.dev/errors/"+t;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)a+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function m(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function u(t){var a=t,s=t;if(t.alternate)for(;a.return;)a=a.return;else{t=a;do a=t,(a.flags&4098)!==0&&(s=a.return),t=a.return;while(t)}return a.tag===3?s:null}function f(t){if(t.tag===13){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function g(t){if(t.tag===31){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function j(t){if(u(t)!==t)throw Error(i(188))}function v(t){var a=t.alternate;if(!a){if(a=u(t),a===null)throw Error(i(188));return a!==t?null:t}for(var s=t,n=a;;){var c=s.return;if(c===null)break;var d=c.alternate;if(d===null){if(n=c.return,n!==null){s=n;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===s)return j(c),t;if(d===n)return j(c),a;d=d.sibling}throw Error(i(188))}if(s.return!==n.return)s=c,n=d;else{for(var h=!1,y=c.child;y;){if(y===s){h=!0,s=c,n=d;break}if(y===n){h=!0,n=c,s=d;break}y=y.sibling}if(!h){for(y=d.child;y;){if(y===s){h=!0,s=d,n=c;break}if(y===n){h=!0,n=d,s=c;break}y=y.sibling}if(!h)throw Error(i(189))}}if(s.alternate!==n)throw Error(i(190))}if(s.tag!==3)throw Error(i(188));return s.stateNode.current===s?t:a}function x(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t;for(t=t.child;t!==null;){if(a=x(t),a!==null)return a;t=t.sibling}return null}var q=Object.assign,L=Symbol.for("react.element"),M=Symbol.for("react.transitional.element"),P=Symbol.for("react.portal"),V=Symbol.for("react.fragment"),J=Symbol.for("react.strict_mode"),ae=Symbol.for("react.profiler"),F=Symbol.for("react.consumer"),R=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),K=Symbol.for("react.suspense"),pe=Symbol.for("react.suspense_list"),$=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),Z=Symbol.for("react.memo_cache_sentinel"),C=Symbol.iterator;function b(t){return t===null||typeof t!="object"?null:(t=C&&t[C]||t["@@iterator"],typeof t=="function"?t:null)}var A=Symbol.for("react.client.reference");function z(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===A?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case V:return"Fragment";case ae:return"Profiler";case J:return"StrictMode";case K:return"Suspense";case pe:return"SuspenseList";case B:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case P:return"Portal";case R:return t.displayName||"Context";case F:return(t._context.displayName||"Context")+".Consumer";case S:var a=t.render;return t=t.displayName,t||(t=a.displayName||a.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case $:return a=t.displayName||null,a!==null?a:z(t.type)||"Memo";case G:a=t._payload,t=t._init;try{return z(t(a))}catch{}}return null}var de=Array.isArray,N=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,E={pending:!1,data:null,method:null,action:null},xe=[],k=-1;function U(t){return{current:t}}function ie(t){0>k||(t.current=xe[k],xe[k]=null,k--)}function T(t,a){k++,xe[k]=t.current,t.current=a}var je=U(null),I=U(null),ke=U(null),ue=U(null);function Te(t,a){switch(T(ke,a),T(I,t),T(je,null),a.nodeType){case 9:case 11:t=(t=a.documentElement)&&(t=t.namespaceURI)?Bh(t):0;break;default:if(t=a.tagName,a=a.namespaceURI)a=Bh(a),t=Fh(a,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}ie(je),T(je,t)}function Be(){ie(je),ie(I),ie(ke)}function ze(t){t.memoizedState!==null&&T(ue,t);var a=je.current,s=Fh(a,t.type);a!==s&&(T(I,t),T(je,s))}function Oe(t){I.current===t&&(ie(je),ie(I)),ue.current===t&&(ie(ue),ul._currentValue=E)}var gt,tt;function ee(t){if(gt===void 0)try{throw Error()}catch(s){var a=s.stack.trim().match(/\n( *(at )?)/);gt=a&&a[1]||"",tt=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+gt+t+tt}var Me=!1;function Fe(t,a){if(!t||Me)return"";Me=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(a){var _e=function(){throw Error()};if(Object.defineProperty(_e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_e,[])}catch(fe){var ce=fe}Reflect.construct(t,[],_e)}else{try{_e.call()}catch(fe){ce=fe}t.call(_e.prototype)}}else{try{throw Error()}catch(fe){ce=fe}(_e=t())&&typeof _e.catch=="function"&&_e.catch(function(){})}}catch(fe){if(fe&&ce&&typeof fe.stack=="string")return[fe.stack,ce.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=n.DetermineComponentFrameRoot(),h=d[0],y=d[1];if(h&&y){var H=h.split(`
`),le=y.split(`
`);for(c=n=0;n<H.length&&!H[n].includes("DetermineComponentFrameRoot");)n++;for(;c<le.length&&!le[c].includes("DetermineComponentFrameRoot");)c++;if(n===H.length||c===le.length)for(n=H.length-1,c=le.length-1;1<=n&&0<=c&&H[n]!==le[c];)c--;for(;1<=n&&0<=c;n--,c--)if(H[n]!==le[c]){if(n!==1||c!==1)do if(n--,c--,0>c||H[n]!==le[c]){var ve=`
`+H[n].replace(" at new "," at ");return t.displayName&&ve.includes("<anonymous>")&&(ve=ve.replace("<anonymous>",t.displayName)),ve}while(1<=n&&0<=c);break}}}finally{Me=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?ee(s):""}function pt(t,a){switch(t.tag){case 26:case 27:case 5:return ee(t.type);case 16:return ee("Lazy");case 13:return t.child!==a&&a!==null?ee("Suspense Fallback"):ee("Suspense");case 19:return ee("SuspenseList");case 0:case 15:return Fe(t.type,!1);case 11:return Fe(t.type.render,!1);case 1:return Fe(t.type,!0);case 31:return ee("Activity");default:return""}}function ma(t){try{var a="",s=null;do a+=pt(t,s),s=t,t=t.return;while(t);return a}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var we=Object.prototype.hasOwnProperty,qe=r.unstable_scheduleCallback,$e=r.unstable_cancelCallback,Xe=r.unstable_shouldYield,Ye=r.unstable_requestPaint,Ze=r.unstable_now,De=r.unstable_getCurrentPriorityLevel,vt=r.unstable_ImmediatePriority,wt=r.unstable_UserBlockingPriority,Zt=r.unstable_NormalPriority,ta=r.unstable_LowPriority,Nt=r.unstable_IdlePriority,Pt=r.log,X=r.unstable_setDisableYieldValue,O=null,be=null;function Ee(t){if(typeof Pt=="function"&&X(t),be&&typeof be.setStrictMode=="function")try{be.setStrictMode(O,t)}catch{}}var ne=Math.clz32?Math.clz32:We,Ae=Math.log,ot=Math.LN2;function We(t){return t>>>=0,t===0?32:31-(Ae(t)/ot|0)|0}var Qt=256,Lt=262144,Dt=4194304;function Mt(t){var a=t&42;if(a!==0)return a;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function $t(t,a,s){var n=t.pendingLanes;if(n===0)return 0;var c=0,d=t.suspendedLanes,h=t.pingedLanes;t=t.warmLanes;var y=n&134217727;return y!==0?(n=y&~d,n!==0?c=Mt(n):(h&=y,h!==0?c=Mt(h):s||(s=y&~t,s!==0&&(c=Mt(s))))):(y=n&~d,y!==0?c=Mt(y):h!==0?c=Mt(h):s||(s=n&~t,s!==0&&(c=Mt(s)))),c===0?0:a!==0&&a!==c&&(a&d)===0&&(d=c&-c,s=a&-a,d>=s||d===32&&(s&4194048)!==0)?a:c}function It(t,a){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&a)===0}function la(t,a){switch(t){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ne(){var t=Dt;return Dt<<=1,(Dt&62914560)===0&&(Dt=4194304),t}function kt(t){for(var a=[],s=0;31>s;s++)a.push(t);return a}function ft(t,a){t.pendingLanes|=a,a!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function ja(t,a,s,n,c,d){var h=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var y=t.entanglements,H=t.expirationTimes,le=t.hiddenUpdates;for(s=h&~s;0<s;){var ve=31-ne(s),_e=1<<ve;y[ve]=0,H[ve]=-1;var ce=le[ve];if(ce!==null)for(le[ve]=null,ve=0;ve<ce.length;ve++){var fe=ce[ve];fe!==null&&(fe.lane&=-536870913)}s&=~_e}n!==0&&w(t,n,0),d!==0&&c===0&&t.tag!==0&&(t.suspendedLanes|=d&~(h&~a))}function w(t,a,s){t.pendingLanes|=a,t.suspendedLanes&=~a;var n=31-ne(a);t.entangledLanes|=a,t.entanglements[n]=t.entanglements[n]|1073741824|s&261930}function me(t,a){var s=t.entangledLanes|=a;for(t=t.entanglements;s;){var n=31-ne(s),c=1<<n;c&a|t[n]&a&&(t[n]|=a),s&=~c}}function he(t,a){var s=a&-a;return s=(s&42)!==0?1:Se(s),(s&(t.suspendedLanes|a))!==0?0:s}function Se(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function lt(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function ht(){var t=se.p;return t!==0?t:(t=window.event,t===void 0?32:dp(t.type))}function it(t,a){var s=se.p;try{return se.p=t,a()}finally{se.p=s}}var Et=Math.random().toString(36).slice(2),at="__reactFiber$"+Et,rt="__reactProps$"+Et,ha="__reactContainer$"+Et,va="__reactEvents$"+Et,wa="__reactListeners$"+Et,Ve="__reactHandles$"+Et,Ke="__reactResources$"+Et,ia="__reactMarker$"+Et;function Jt(t){delete t[at],delete t[rt],delete t[va],delete t[wa],delete t[Ve]}function ya(t){var a=t[at];if(a)return a;for(var s=t.parentNode;s;){if(a=s[ha]||s[at]){if(s=a.alternate,a.child!==null||s!==null&&s.child!==null)for(t=Xh(t);t!==null;){if(s=t[at])return s;t=Xh(t)}return a}t=s,s=t.parentNode}return null}function Ue(t){if(t=t[at]||t[ha]){var a=t.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return t}return null}function Je(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t.stateNode;throw Error(i(33))}function yt(t){var a=t[Ke];return a||(a=t[Ke]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function st(t){t[ia]=!0}var pa=new Set,ba={};function fa(t,a){_(t,a),_(t+"Capture",a)}function _(t,a){for(ba[t]=a,t=0;t<a.length;t++)pa.add(a[t])}var oe=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ce={},ge={};function nt(t){return we.call(ge,t)?!0:we.call(Ce,t)?!1:oe.test(t)?ge[t]=!0:(Ce[t]=!0,!1)}function ct(t,a,s){if(nt(a))if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(a);return;case"boolean":var n=a.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){t.removeAttribute(a);return}}t.setAttribute(a,""+s)}}function He(t,a,s){if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(a);return}t.setAttribute(a,""+s)}}function ut(t,a,s,n){if(n===null)t.removeAttribute(s);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(a,s,""+n)}}function Ot(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function xs(t){var a=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function js(t,a,s){var n=Object.getOwnPropertyDescriptor(t.constructor.prototype,a);if(!t.hasOwnProperty(a)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var c=n.get,d=n.set;return Object.defineProperty(t,a,{configurable:!0,get:function(){return c.call(this)},set:function(h){s=""+h,d.call(this,h)}}),Object.defineProperty(t,a,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(h){s=""+h},stopTracking:function(){t._valueTracker=null,delete t[a]}}}}function vs(t){if(!t._valueTracker){var a=xs(t)?"checked":"value";t._valueTracker=js(t,a,""+t[a])}}function ls(t){if(!t)return!1;var a=t._valueTracker;if(!a)return!0;var s=a.getValue(),n="";return t&&(n=xs(t)?t.checked?"true":"false":t.value),t=n,t!==s?(a.setValue(t),!0):!1}function Nl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var _f=/[\n"\\]/g;function Qa(t){return t.replace(_f,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Gi(t,a,s,n,c,d,h,y){t.name="",h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"?t.type=h:t.removeAttribute("type"),a!=null?h==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+Ot(a)):t.value!==""+Ot(a)&&(t.value=""+Ot(a)):h!=="submit"&&h!=="reset"||t.removeAttribute("value"),a!=null?Yi(t,h,Ot(a)):s!=null?Yi(t,h,Ot(s)):n!=null&&t.removeAttribute("value"),c==null&&d!=null&&(t.defaultChecked=!!d),c!=null&&(t.checked=c&&typeof c!="function"&&typeof c!="symbol"),y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?t.name=""+Ot(y):t.removeAttribute("name")}function Od(t,a,s,n,c,d,h,y){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(t.type=d),a!=null||s!=null){if(!(d!=="submit"&&d!=="reset"||a!=null)){vs(t);return}s=s!=null?""+Ot(s):"",a=a!=null?""+Ot(a):s,y||a===t.value||(t.value=a),t.defaultValue=a}n=n??c,n=typeof n!="function"&&typeof n!="symbol"&&!!n,t.checked=y?t.checked:!!n,t.defaultChecked=!!n,h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(t.name=h),vs(t)}function Yi(t,a,s){a==="number"&&Nl(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function $n(t,a,s,n){if(t=t.options,a){a={};for(var c=0;c<s.length;c++)a["$"+s[c]]=!0;for(s=0;s<t.length;s++)c=a.hasOwnProperty("$"+t[s].value),t[s].selected!==c&&(t[s].selected=c),c&&n&&(t[s].defaultSelected=!0)}else{for(s=""+Ot(s),a=null,c=0;c<t.length;c++){if(t[c].value===s){t[c].selected=!0,n&&(t[c].defaultSelected=!0);return}a!==null||t[c].disabled||(a=t[c])}a!==null&&(a.selected=!0)}}function Rd(t,a,s){if(a!=null&&(a=""+Ot(a),a!==t.value&&(t.value=a),s==null)){t.defaultValue!==a&&(t.defaultValue=a);return}t.defaultValue=s!=null?""+Ot(s):""}function qd(t,a,s,n){if(a==null){if(n!=null){if(s!=null)throw Error(i(92));if(de(n)){if(1<n.length)throw Error(i(93));n=n[0]}s=n}s==null&&(s=""),a=s}s=Ot(a),t.defaultValue=s,n=t.textContent,n===s&&n!==""&&n!==null&&(t.value=n),vs(t)}function Vn(t,a){if(a){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=a;return}}t.textContent=a}var Nf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ld(t,a,s){var n=a.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?n?t.setProperty(a,""):a==="float"?t.cssFloat="":t[a]="":n?t.setProperty(a,s):typeof s!="number"||s===0||Nf.has(a)?a==="float"?t.cssFloat=s:t[a]=(""+s).trim():t[a]=s+"px"}function Ud(t,a,s){if(a!=null&&typeof a!="object")throw Error(i(62));if(t=t.style,s!=null){for(var n in s)!s.hasOwnProperty(n)||a!=null&&a.hasOwnProperty(n)||(n.indexOf("--")===0?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="");for(var c in a)n=a[c],a.hasOwnProperty(c)&&s[c]!==n&&Ld(t,c,n)}else for(var d in a)a.hasOwnProperty(d)&&Ld(t,d,a[d])}function Pi(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sf=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Cf=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Sl(t){return Cf.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function ys(){}var Qi=null;function Xi(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Gn=null,Yn=null;function Hd(t){var a=Ue(t);if(a&&(t=a.stateNode)){var s=t[rt]||null;e:switch(t=a.stateNode,a.type){case"input":if(Gi(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),a=s.name,s.type==="radio"&&a!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+Qa(""+a)+'"][type="radio"]'),a=0;a<s.length;a++){var n=s[a];if(n!==t&&n.form===t.form){var c=n[rt]||null;if(!c)throw Error(i(90));Gi(n,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(a=0;a<s.length;a++)n=s[a],n.form===t.form&&ls(n)}break e;case"textarea":Rd(t,s.value,s.defaultValue);break e;case"select":a=s.value,a!=null&&$n(t,!!s.multiple,a,!1)}}}var Zi=!1;function Bd(t,a,s){if(Zi)return t(a,s);Zi=!0;try{var n=t(a);return n}finally{if(Zi=!1,(Gn!==null||Yn!==null)&&(ui(),Gn&&(a=Gn,t=Yn,Yn=Gn=null,Hd(a),t)))for(a=0;a<t.length;a++)Hd(t[a])}}function Er(t,a){var s=t.stateNode;if(s===null)return null;var n=s[rt]||null;if(n===null)return null;s=n[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(i(231,a,typeof s));return s}var bs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ii=!1;if(bs)try{var Dr={};Object.defineProperty(Dr,"passive",{get:function(){Ii=!0}}),window.addEventListener("test",Dr,Dr),window.removeEventListener("test",Dr,Dr)}catch{Ii=!1}var $s=null,Ji=null,Cl=null;function Fd(){if(Cl)return Cl;var t,a=Ji,s=a.length,n,c="value"in $s?$s.value:$s.textContent,d=c.length;for(t=0;t<s&&a[t]===c[t];t++);var h=s-t;for(n=1;n<=h&&a[s-n]===c[d-n];n++);return Cl=c.slice(t,1<n?1-n:void 0)}function wl(t){var a=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&a===13&&(t=13)):t=a,t===10&&(t=13),32<=t||t===13?t:0}function kl(){return!0}function $d(){return!1}function Aa(t){function a(s,n,c,d,h){this._reactName=s,this._targetInst=c,this.type=n,this.nativeEvent=d,this.target=h,this.currentTarget=null;for(var y in t)t.hasOwnProperty(y)&&(s=t[y],this[y]=s?s(d):d[y]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?kl:$d,this.isPropagationStopped=$d,this}return q(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=kl)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=kl)},persist:function(){},isPersistent:kl}),a}var jn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},El=Aa(jn),Mr=q({},jn,{view:0,detail:0}),wf=Aa(Mr),Wi,Ki,Tr,Dl=q({},Mr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:tc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Tr&&(Tr&&t.type==="mousemove"?(Wi=t.screenX-Tr.screenX,Ki=t.screenY-Tr.screenY):Ki=Wi=0,Tr=t),Wi)},movementY:function(t){return"movementY"in t?t.movementY:Ki}}),Vd=Aa(Dl),kf=q({},Dl,{dataTransfer:0}),Ef=Aa(kf),Df=q({},Mr,{relatedTarget:0}),ec=Aa(Df),Mf=q({},jn,{animationName:0,elapsedTime:0,pseudoElement:0}),Tf=Aa(Mf),Af=q({},jn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),zf=Aa(Af),Of=q({},jn,{data:0}),Gd=Aa(Of),Rf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Lf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Uf(t){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(t):(t=Lf[t])?!!a[t]:!1}function tc(){return Uf}var Hf=q({},Mr,{key:function(t){if(t.key){var a=Rf[t.key]||t.key;if(a!=="Unidentified")return a}return t.type==="keypress"?(t=wl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?qf[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:tc,charCode:function(t){return t.type==="keypress"?wl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?wl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Bf=Aa(Hf),Ff=q({},Dl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Yd=Aa(Ff),$f=q({},Mr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:tc}),Vf=Aa($f),Gf=q({},jn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yf=Aa(Gf),Pf=q({},Dl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Qf=Aa(Pf),Xf=q({},jn,{newState:0,oldState:0}),Zf=Aa(Xf),If=[9,13,27,32],ac=bs&&"CompositionEvent"in window,Ar=null;bs&&"documentMode"in document&&(Ar=document.documentMode);var Jf=bs&&"TextEvent"in window&&!Ar,Pd=bs&&(!ac||Ar&&8<Ar&&11>=Ar),Qd=" ",Xd=!1;function Zd(t,a){switch(t){case"keyup":return If.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Id(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Pn=!1;function Wf(t,a){switch(t){case"compositionend":return Id(a);case"keypress":return a.which!==32?null:(Xd=!0,Qd);case"textInput":return t=a.data,t===Qd&&Xd?null:t;default:return null}}function Kf(t,a){if(Pn)return t==="compositionend"||!ac&&Zd(t,a)?(t=Fd(),Cl=Ji=$s=null,Pn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Pd&&a.locale!=="ko"?null:a.data;default:return null}}var eg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jd(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a==="input"?!!eg[t.type]:a==="textarea"}function Wd(t,a,s,n){Gn?Yn?Yn.push(n):Yn=[n]:Gn=n,a=ji(a,"onChange"),0<a.length&&(s=new El("onChange","change",null,s,n),t.push({event:s,listeners:a}))}var zr=null,Or=null;function tg(t){Oh(t,0)}function Ml(t){var a=Je(t);if(ls(a))return t}function Kd(t,a){if(t==="change")return a}var eu=!1;if(bs){var sc;if(bs){var nc="oninput"in document;if(!nc){var tu=document.createElement("div");tu.setAttribute("oninput","return;"),nc=typeof tu.oninput=="function"}sc=nc}else sc=!1;eu=sc&&(!document.documentMode||9<document.documentMode)}function au(){zr&&(zr.detachEvent("onpropertychange",su),Or=zr=null)}function su(t){if(t.propertyName==="value"&&Ml(Or)){var a=[];Wd(a,Or,t,Xi(t)),Bd(tg,a)}}function ag(t,a,s){t==="focusin"?(au(),zr=a,Or=s,zr.attachEvent("onpropertychange",su)):t==="focusout"&&au()}function sg(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ml(Or)}function ng(t,a){if(t==="click")return Ml(a)}function rg(t,a){if(t==="input"||t==="change")return Ml(a)}function lg(t,a){return t===a&&(t!==0||1/t===1/a)||t!==t&&a!==a}var Ua=typeof Object.is=="function"?Object.is:lg;function Rr(t,a){if(Ua(t,a))return!0;if(typeof t!="object"||t===null||typeof a!="object"||a===null)return!1;var s=Object.keys(t),n=Object.keys(a);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var c=s[n];if(!we.call(a,c)||!Ua(t[c],a[c]))return!1}return!0}function nu(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ru(t,a){var s=nu(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=a&&n>=a)return{node:s,offset:a-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=nu(s)}}function lu(t,a){return t&&a?t===a?!0:t&&t.nodeType===3?!1:a&&a.nodeType===3?lu(t,a.parentNode):"contains"in t?t.contains(a):t.compareDocumentPosition?!!(t.compareDocumentPosition(a)&16):!1:!1}function iu(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var a=Nl(t.document);a instanceof t.HTMLIFrameElement;){try{var s=typeof a.contentWindow.location.href=="string"}catch{s=!1}if(s)t=a.contentWindow;else break;a=Nl(t.document)}return a}function rc(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a&&(a==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||a==="textarea"||t.contentEditable==="true")}var ig=bs&&"documentMode"in document&&11>=document.documentMode,Qn=null,lc=null,qr=null,ic=!1;function cu(t,a,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;ic||Qn==null||Qn!==Nl(n)||(n=Qn,"selectionStart"in n&&rc(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),qr&&Rr(qr,n)||(qr=n,n=ji(lc,"onSelect"),0<n.length&&(a=new El("onSelect","select",null,a,s),t.push({event:a,listeners:n}),a.target=Qn)))}function vn(t,a){var s={};return s[t.toLowerCase()]=a.toLowerCase(),s["Webkit"+t]="webkit"+a,s["Moz"+t]="moz"+a,s}var Xn={animationend:vn("Animation","AnimationEnd"),animationiteration:vn("Animation","AnimationIteration"),animationstart:vn("Animation","AnimationStart"),transitionrun:vn("Transition","TransitionRun"),transitionstart:vn("Transition","TransitionStart"),transitioncancel:vn("Transition","TransitionCancel"),transitionend:vn("Transition","TransitionEnd")},cc={},ou={};bs&&(ou=document.createElement("div").style,"AnimationEvent"in window||(delete Xn.animationend.animation,delete Xn.animationiteration.animation,delete Xn.animationstart.animation),"TransitionEvent"in window||delete Xn.transitionend.transition);function yn(t){if(cc[t])return cc[t];if(!Xn[t])return t;var a=Xn[t],s;for(s in a)if(a.hasOwnProperty(s)&&s in ou)return cc[t]=a[s];return t}var du=yn("animationend"),uu=yn("animationiteration"),mu=yn("animationstart"),cg=yn("transitionrun"),og=yn("transitionstart"),dg=yn("transitioncancel"),hu=yn("transitionend"),pu=new Map,oc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");oc.push("scrollEnd");function is(t,a){pu.set(t,a),fa(a,[t])}var Tl=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},Xa=[],Zn=0,dc=0;function Al(){for(var t=Zn,a=dc=Zn=0;a<t;){var s=Xa[a];Xa[a++]=null;var n=Xa[a];Xa[a++]=null;var c=Xa[a];Xa[a++]=null;var d=Xa[a];if(Xa[a++]=null,n!==null&&c!==null){var h=n.pending;h===null?c.next=c:(c.next=h.next,h.next=c),n.pending=c}d!==0&&fu(s,c,d)}}function zl(t,a,s,n){Xa[Zn++]=t,Xa[Zn++]=a,Xa[Zn++]=s,Xa[Zn++]=n,dc|=n,t.lanes|=n,t=t.alternate,t!==null&&(t.lanes|=n)}function uc(t,a,s,n){return zl(t,a,s,n),Ol(t)}function bn(t,a){return zl(t,null,null,a),Ol(t)}function fu(t,a,s){t.lanes|=s;var n=t.alternate;n!==null&&(n.lanes|=s);for(var c=!1,d=t.return;d!==null;)d.childLanes|=s,n=d.alternate,n!==null&&(n.childLanes|=s),d.tag===22&&(t=d.stateNode,t===null||t._visibility&1||(c=!0)),t=d,d=d.return;return t.tag===3?(d=t.stateNode,c&&a!==null&&(c=31-ne(s),t=d.hiddenUpdates,n=t[c],n===null?t[c]=[a]:n.push(a),a.lane=s|536870912),d):null}function Ol(t){if(50<nl)throw nl=0,bo=null,Error(i(185));for(var a=t.return;a!==null;)t=a,a=t.return;return t.tag===3?t.stateNode:null}var In={};function ug(t,a,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ha(t,a,s,n){return new ug(t,a,s,n)}function mc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function _s(t,a){var s=t.alternate;return s===null?(s=Ha(t.tag,a,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=a,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,a=t.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function gu(t,a){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=a,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,a=s.dependencies,t.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),t}function Rl(t,a,s,n,c,d){var h=0;if(n=t,typeof t=="function")mc(t)&&(h=1);else if(typeof t=="string")h=gx(t,s,je.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case B:return t=Ha(31,s,a,c),t.elementType=B,t.lanes=d,t;case V:return _n(s.children,c,d,a);case J:h=8,c|=24;break;case ae:return t=Ha(12,s,a,c|2),t.elementType=ae,t.lanes=d,t;case K:return t=Ha(13,s,a,c),t.elementType=K,t.lanes=d,t;case pe:return t=Ha(19,s,a,c),t.elementType=pe,t.lanes=d,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case R:h=10;break e;case F:h=9;break e;case S:h=11;break e;case $:h=14;break e;case G:h=16,n=null;break e}h=29,s=Error(i(130,t===null?"null":typeof t,"")),n=null}return a=Ha(h,s,a,c),a.elementType=t,a.type=n,a.lanes=d,a}function _n(t,a,s,n){return t=Ha(7,t,n,a),t.lanes=s,t}function hc(t,a,s){return t=Ha(6,t,null,a),t.lanes=s,t}function xu(t){var a=Ha(18,null,null,0);return a.stateNode=t,a}function pc(t,a,s){return a=Ha(4,t.children!==null?t.children:[],t.key,a),a.lanes=s,a.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},a}var ju=new WeakMap;function Za(t,a){if(typeof t=="object"&&t!==null){var s=ju.get(t);return s!==void 0?s:(a={value:t,source:a,stack:ma(a)},ju.set(t,a),a)}return{value:t,source:a,stack:ma(a)}}var Jn=[],Wn=0,ql=null,Lr=0,Ia=[],Ja=0,Vs=null,us=1,ms="";function Ns(t,a){Jn[Wn++]=Lr,Jn[Wn++]=ql,ql=t,Lr=a}function vu(t,a,s){Ia[Ja++]=us,Ia[Ja++]=ms,Ia[Ja++]=Vs,Vs=t;var n=us;t=ms;var c=32-ne(n)-1;n&=~(1<<c),s+=1;var d=32-ne(a)+c;if(30<d){var h=c-c%5;d=(n&(1<<h)-1).toString(32),n>>=h,c-=h,us=1<<32-ne(a)+c|s<<c|n,ms=d+t}else us=1<<d|s<<c|n,ms=t}function fc(t){t.return!==null&&(Ns(t,1),vu(t,1,0))}function gc(t){for(;t===ql;)ql=Jn[--Wn],Jn[Wn]=null,Lr=Jn[--Wn],Jn[Wn]=null;for(;t===Vs;)Vs=Ia[--Ja],Ia[Ja]=null,ms=Ia[--Ja],Ia[Ja]=null,us=Ia[--Ja],Ia[Ja]=null}function yu(t,a){Ia[Ja++]=us,Ia[Ja++]=ms,Ia[Ja++]=Vs,us=a.id,ms=a.overflow,Vs=t}var _a=null,Gt=null,St=!1,Gs=null,Wa=!1,xc=Error(i(519));function Ys(t){var a=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ur(Za(a,t)),xc}function bu(t){var a=t.stateNode,s=t.type,n=t.memoizedProps;switch(a[at]=t,a[rt]=n,s){case"dialog":jt("cancel",a),jt("close",a);break;case"iframe":case"object":case"embed":jt("load",a);break;case"video":case"audio":for(s=0;s<ll.length;s++)jt(ll[s],a);break;case"source":jt("error",a);break;case"img":case"image":case"link":jt("error",a),jt("load",a);break;case"details":jt("toggle",a);break;case"input":jt("invalid",a),Od(a,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":jt("invalid",a);break;case"textarea":jt("invalid",a),qd(a,n.value,n.defaultValue,n.children)}s=n.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||a.textContent===""+s||n.suppressHydrationWarning===!0||Uh(a.textContent,s)?(n.popover!=null&&(jt("beforetoggle",a),jt("toggle",a)),n.onScroll!=null&&jt("scroll",a),n.onScrollEnd!=null&&jt("scrollend",a),n.onClick!=null&&(a.onclick=ys),a=!0):a=!1,a||Ys(t,!0)}function _u(t){for(_a=t.return;_a;)switch(_a.tag){case 5:case 31:case 13:Wa=!1;return;case 27:case 3:Wa=!0;return;default:_a=_a.return}}function Kn(t){if(t!==_a)return!1;if(!St)return _u(t),St=!0,!1;var a=t.tag,s;if((s=a!==3&&a!==27)&&((s=a===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||qo(t.type,t.memoizedProps)),s=!s),s&&Gt&&Ys(t),_u(t),a===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(317));Gt=Qh(t)}else if(a===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(317));Gt=Qh(t)}else a===27?(a=Gt,rn(t.type)?(t=Fo,Fo=null,Gt=t):Gt=a):Gt=_a?es(t.stateNode.nextSibling):null;return!0}function Nn(){Gt=_a=null,St=!1}function jc(){var t=Gs;return t!==null&&(qa===null?qa=t:qa.push.apply(qa,t),Gs=null),t}function Ur(t){Gs===null?Gs=[t]:Gs.push(t)}var vc=U(null),Sn=null,Ss=null;function Ps(t,a,s){T(vc,a._currentValue),a._currentValue=s}function Cs(t){t._currentValue=vc.current,ie(vc)}function yc(t,a,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&a)!==a?(t.childLanes|=a,n!==null&&(n.childLanes|=a)):n!==null&&(n.childLanes&a)!==a&&(n.childLanes|=a),t===s)break;t=t.return}}function bc(t,a,s,n){var c=t.child;for(c!==null&&(c.return=t);c!==null;){var d=c.dependencies;if(d!==null){var h=c.child;d=d.firstContext;e:for(;d!==null;){var y=d;d=c;for(var H=0;H<a.length;H++)if(y.context===a[H]){d.lanes|=s,y=d.alternate,y!==null&&(y.lanes|=s),yc(d.return,s,t),n||(h=null);break e}d=y.next}}else if(c.tag===18){if(h=c.return,h===null)throw Error(i(341));h.lanes|=s,d=h.alternate,d!==null&&(d.lanes|=s),yc(h,s,t),h=null}else h=c.child;if(h!==null)h.return=c;else for(h=c;h!==null;){if(h===t){h=null;break}if(c=h.sibling,c!==null){c.return=h.return,h=c;break}h=h.return}c=h}}function er(t,a,s,n){t=null;for(var c=a,d=!1;c!==null;){if(!d){if((c.flags&524288)!==0)d=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var h=c.alternate;if(h===null)throw Error(i(387));if(h=h.memoizedProps,h!==null){var y=c.type;Ua(c.pendingProps.value,h.value)||(t!==null?t.push(y):t=[y])}}else if(c===ue.current){if(h=c.alternate,h===null)throw Error(i(387));h.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(t!==null?t.push(ul):t=[ul])}c=c.return}t!==null&&bc(a,t,s,n),a.flags|=262144}function Ll(t){for(t=t.firstContext;t!==null;){if(!Ua(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Cn(t){Sn=t,Ss=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Na(t){return Nu(Sn,t)}function Ul(t,a){return Sn===null&&Cn(t),Nu(t,a)}function Nu(t,a){var s=a._currentValue;if(a={context:a,memoizedValue:s,next:null},Ss===null){if(t===null)throw Error(i(308));Ss=a,t.dependencies={lanes:0,firstContext:a},t.flags|=524288}else Ss=Ss.next=a;return s}var mg=typeof AbortController<"u"?AbortController:function(){var t=[],a=this.signal={aborted:!1,addEventListener:function(s,n){t.push(n)}};this.abort=function(){a.aborted=!0,t.forEach(function(s){return s()})}},hg=r.unstable_scheduleCallback,pg=r.unstable_NormalPriority,ca={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function _c(){return{controller:new mg,data:new Map,refCount:0}}function Hr(t){t.refCount--,t.refCount===0&&hg(pg,function(){t.controller.abort()})}var Br=null,Nc=0,tr=0,ar=null;function fg(t,a){if(Br===null){var s=Br=[];Nc=0,tr=ko(),ar={status:"pending",value:void 0,then:function(n){s.push(n)}}}return Nc++,a.then(Su,Su),a}function Su(){if(--Nc===0&&Br!==null){ar!==null&&(ar.status="fulfilled");var t=Br;Br=null,tr=0,ar=null;for(var a=0;a<t.length;a++)(0,t[a])()}}function gg(t,a){var s=[],n={status:"pending",value:null,reason:null,then:function(c){s.push(c)}};return t.then(function(){n.status="fulfilled",n.value=a;for(var c=0;c<s.length;c++)(0,s[c])(a)},function(c){for(n.status="rejected",n.reason=c,c=0;c<s.length;c++)(0,s[c])(void 0)}),n}var Cu=N.S;N.S=function(t,a){ch=Ze(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&fg(t,a),Cu!==null&&Cu(t,a)};var wn=U(null);function Sc(){var t=wn.current;return t!==null?t:Ft.pooledCache}function Hl(t,a){a===null?T(wn,wn.current):T(wn,a.pool)}function wu(){var t=Sc();return t===null?null:{parent:ca._currentValue,pool:t}}var sr=Error(i(460)),Cc=Error(i(474)),Bl=Error(i(542)),Fl={then:function(){}};function ku(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Eu(t,a,s){switch(s=t[s],s===void 0?t.push(a):s!==a&&(a.then(ys,ys),a=s),a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,Mu(t),t;default:if(typeof a.status=="string")a.then(ys,ys);else{if(t=Ft,t!==null&&100<t.shellSuspendCounter)throw Error(i(482));t=a,t.status="pending",t.then(function(n){if(a.status==="pending"){var c=a;c.status="fulfilled",c.value=n}},function(n){if(a.status==="pending"){var c=a;c.status="rejected",c.reason=n}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,Mu(t),t}throw En=a,sr}}function kn(t){try{var a=t._init;return a(t._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(En=s,sr):s}}var En=null;function Du(){if(En===null)throw Error(i(459));var t=En;return En=null,t}function Mu(t){if(t===sr||t===Bl)throw Error(i(483))}var nr=null,Fr=0;function $l(t){var a=Fr;return Fr+=1,nr===null&&(nr=[]),Eu(nr,t,a)}function $r(t,a){a=a.props.ref,t.ref=a!==void 0?a:null}function Vl(t,a){throw a.$$typeof===L?Error(i(525)):(t=Object.prototype.toString.call(a),Error(i(31,t==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":t)))}function Tu(t){function a(W,Q){if(t){var re=W.deletions;re===null?(W.deletions=[Q],W.flags|=16):re.push(Q)}}function s(W,Q){if(!t)return null;for(;Q!==null;)a(W,Q),Q=Q.sibling;return null}function n(W){for(var Q=new Map;W!==null;)W.key!==null?Q.set(W.key,W):Q.set(W.index,W),W=W.sibling;return Q}function c(W,Q){return W=_s(W,Q),W.index=0,W.sibling=null,W}function d(W,Q,re){return W.index=re,t?(re=W.alternate,re!==null?(re=re.index,re<Q?(W.flags|=67108866,Q):re):(W.flags|=67108866,Q)):(W.flags|=1048576,Q)}function h(W){return t&&W.alternate===null&&(W.flags|=67108866),W}function y(W,Q,re,ye){return Q===null||Q.tag!==6?(Q=hc(re,W.mode,ye),Q.return=W,Q):(Q=c(Q,re),Q.return=W,Q)}function H(W,Q,re,ye){var Ie=re.type;return Ie===V?ve(W,Q,re.props.children,ye,re.key):Q!==null&&(Q.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===G&&kn(Ie)===Q.type)?(Q=c(Q,re.props),$r(Q,re),Q.return=W,Q):(Q=Rl(re.type,re.key,re.props,null,W.mode,ye),$r(Q,re),Q.return=W,Q)}function le(W,Q,re,ye){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==re.containerInfo||Q.stateNode.implementation!==re.implementation?(Q=pc(re,W.mode,ye),Q.return=W,Q):(Q=c(Q,re.children||[]),Q.return=W,Q)}function ve(W,Q,re,ye,Ie){return Q===null||Q.tag!==7?(Q=_n(re,W.mode,ye,Ie),Q.return=W,Q):(Q=c(Q,re),Q.return=W,Q)}function _e(W,Q,re){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Q=hc(""+Q,W.mode,re),Q.return=W,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case M:return re=Rl(Q.type,Q.key,Q.props,null,W.mode,re),$r(re,Q),re.return=W,re;case P:return Q=pc(Q,W.mode,re),Q.return=W,Q;case G:return Q=kn(Q),_e(W,Q,re)}if(de(Q)||b(Q))return Q=_n(Q,W.mode,re,null),Q.return=W,Q;if(typeof Q.then=="function")return _e(W,$l(Q),re);if(Q.$$typeof===R)return _e(W,Ul(W,Q),re);Vl(W,Q)}return null}function ce(W,Q,re,ye){var Ie=Q!==null?Q.key:null;if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return Ie!==null?null:y(W,Q,""+re,ye);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case M:return re.key===Ie?H(W,Q,re,ye):null;case P:return re.key===Ie?le(W,Q,re,ye):null;case G:return re=kn(re),ce(W,Q,re,ye)}if(de(re)||b(re))return Ie!==null?null:ve(W,Q,re,ye,null);if(typeof re.then=="function")return ce(W,Q,$l(re),ye);if(re.$$typeof===R)return ce(W,Q,Ul(W,re),ye);Vl(W,re)}return null}function fe(W,Q,re,ye,Ie){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return W=W.get(re)||null,y(Q,W,""+ye,Ie);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case M:return W=W.get(ye.key===null?re:ye.key)||null,H(Q,W,ye,Ie);case P:return W=W.get(ye.key===null?re:ye.key)||null,le(Q,W,ye,Ie);case G:return ye=kn(ye),fe(W,Q,re,ye,Ie)}if(de(ye)||b(ye))return W=W.get(re)||null,ve(Q,W,ye,Ie,null);if(typeof ye.then=="function")return fe(W,Q,re,$l(ye),Ie);if(ye.$$typeof===R)return fe(W,Q,re,Ul(Q,ye),Ie);Vl(Q,ye)}return null}function Ge(W,Q,re,ye){for(var Ie=null,Tt=null,Pe=Q,mt=Q=0,_t=null;Pe!==null&&mt<re.length;mt++){Pe.index>mt?(_t=Pe,Pe=null):_t=Pe.sibling;var At=ce(W,Pe,re[mt],ye);if(At===null){Pe===null&&(Pe=_t);break}t&&Pe&&At.alternate===null&&a(W,Pe),Q=d(At,Q,mt),Tt===null?Ie=At:Tt.sibling=At,Tt=At,Pe=_t}if(mt===re.length)return s(W,Pe),St&&Ns(W,mt),Ie;if(Pe===null){for(;mt<re.length;mt++)Pe=_e(W,re[mt],ye),Pe!==null&&(Q=d(Pe,Q,mt),Tt===null?Ie=Pe:Tt.sibling=Pe,Tt=Pe);return St&&Ns(W,mt),Ie}for(Pe=n(Pe);mt<re.length;mt++)_t=fe(Pe,W,mt,re[mt],ye),_t!==null&&(t&&_t.alternate!==null&&Pe.delete(_t.key===null?mt:_t.key),Q=d(_t,Q,mt),Tt===null?Ie=_t:Tt.sibling=_t,Tt=_t);return t&&Pe.forEach(function(un){return a(W,un)}),St&&Ns(W,mt),Ie}function et(W,Q,re,ye){if(re==null)throw Error(i(151));for(var Ie=null,Tt=null,Pe=Q,mt=Q=0,_t=null,At=re.next();Pe!==null&&!At.done;mt++,At=re.next()){Pe.index>mt?(_t=Pe,Pe=null):_t=Pe.sibling;var un=ce(W,Pe,At.value,ye);if(un===null){Pe===null&&(Pe=_t);break}t&&Pe&&un.alternate===null&&a(W,Pe),Q=d(un,Q,mt),Tt===null?Ie=un:Tt.sibling=un,Tt=un,Pe=_t}if(At.done)return s(W,Pe),St&&Ns(W,mt),Ie;if(Pe===null){for(;!At.done;mt++,At=re.next())At=_e(W,At.value,ye),At!==null&&(Q=d(At,Q,mt),Tt===null?Ie=At:Tt.sibling=At,Tt=At);return St&&Ns(W,mt),Ie}for(Pe=n(Pe);!At.done;mt++,At=re.next())At=fe(Pe,W,mt,At.value,ye),At!==null&&(t&&At.alternate!==null&&Pe.delete(At.key===null?mt:At.key),Q=d(At,Q,mt),Tt===null?Ie=At:Tt.sibling=At,Tt=At);return t&&Pe.forEach(function(kx){return a(W,kx)}),St&&Ns(W,mt),Ie}function Bt(W,Q,re,ye){if(typeof re=="object"&&re!==null&&re.type===V&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case M:e:{for(var Ie=re.key;Q!==null;){if(Q.key===Ie){if(Ie=re.type,Ie===V){if(Q.tag===7){s(W,Q.sibling),ye=c(Q,re.props.children),ye.return=W,W=ye;break e}}else if(Q.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===G&&kn(Ie)===Q.type){s(W,Q.sibling),ye=c(Q,re.props),$r(ye,re),ye.return=W,W=ye;break e}s(W,Q);break}else a(W,Q);Q=Q.sibling}re.type===V?(ye=_n(re.props.children,W.mode,ye,re.key),ye.return=W,W=ye):(ye=Rl(re.type,re.key,re.props,null,W.mode,ye),$r(ye,re),ye.return=W,W=ye)}return h(W);case P:e:{for(Ie=re.key;Q!==null;){if(Q.key===Ie)if(Q.tag===4&&Q.stateNode.containerInfo===re.containerInfo&&Q.stateNode.implementation===re.implementation){s(W,Q.sibling),ye=c(Q,re.children||[]),ye.return=W,W=ye;break e}else{s(W,Q);break}else a(W,Q);Q=Q.sibling}ye=pc(re,W.mode,ye),ye.return=W,W=ye}return h(W);case G:return re=kn(re),Bt(W,Q,re,ye)}if(de(re))return Ge(W,Q,re,ye);if(b(re)){if(Ie=b(re),typeof Ie!="function")throw Error(i(150));return re=Ie.call(re),et(W,Q,re,ye)}if(typeof re.then=="function")return Bt(W,Q,$l(re),ye);if(re.$$typeof===R)return Bt(W,Q,Ul(W,re),ye);Vl(W,re)}return typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint"?(re=""+re,Q!==null&&Q.tag===6?(s(W,Q.sibling),ye=c(Q,re),ye.return=W,W=ye):(s(W,Q),ye=hc(re,W.mode,ye),ye.return=W,W=ye),h(W)):s(W,Q)}return function(W,Q,re,ye){try{Fr=0;var Ie=Bt(W,Q,re,ye);return nr=null,Ie}catch(Pe){if(Pe===sr||Pe===Bl)throw Pe;var Tt=Ha(29,Pe,null,W.mode);return Tt.lanes=ye,Tt.return=W,Tt}finally{}}}var Dn=Tu(!0),Au=Tu(!1),Qs=!1;function wc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function kc(t,a){t=t.updateQueue,a.updateQueue===t&&(a.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Xs(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Zs(t,a,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(zt&2)!==0){var c=n.pending;return c===null?a.next=a:(a.next=c.next,c.next=a),n.pending=a,a=Ol(t),fu(t,null,s),a}return zl(t,n,a,s),Ol(t)}function Vr(t,a,s){if(a=a.updateQueue,a!==null&&(a=a.shared,(s&4194048)!==0)){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,me(t,s)}}function Ec(t,a){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var c=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var h={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};d===null?c=d=h:d=d.next=h,s=s.next}while(s!==null);d===null?c=d=a:d=d.next=a}else c=d=a;s={baseState:n.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:n.shared,callbacks:n.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=a:t.next=a,s.lastBaseUpdate=a}var Dc=!1;function Gr(){if(Dc){var t=ar;if(t!==null)throw t}}function Yr(t,a,s,n){Dc=!1;var c=t.updateQueue;Qs=!1;var d=c.firstBaseUpdate,h=c.lastBaseUpdate,y=c.shared.pending;if(y!==null){c.shared.pending=null;var H=y,le=H.next;H.next=null,h===null?d=le:h.next=le,h=H;var ve=t.alternate;ve!==null&&(ve=ve.updateQueue,y=ve.lastBaseUpdate,y!==h&&(y===null?ve.firstBaseUpdate=le:y.next=le,ve.lastBaseUpdate=H))}if(d!==null){var _e=c.baseState;h=0,ve=le=H=null,y=d;do{var ce=y.lane&-536870913,fe=ce!==y.lane;if(fe?(bt&ce)===ce:(n&ce)===ce){ce!==0&&ce===tr&&(Dc=!0),ve!==null&&(ve=ve.next={lane:0,tag:y.tag,payload:y.payload,callback:null,next:null});e:{var Ge=t,et=y;ce=a;var Bt=s;switch(et.tag){case 1:if(Ge=et.payload,typeof Ge=="function"){_e=Ge.call(Bt,_e,ce);break e}_e=Ge;break e;case 3:Ge.flags=Ge.flags&-65537|128;case 0:if(Ge=et.payload,ce=typeof Ge=="function"?Ge.call(Bt,_e,ce):Ge,ce==null)break e;_e=q({},_e,ce);break e;case 2:Qs=!0}}ce=y.callback,ce!==null&&(t.flags|=64,fe&&(t.flags|=8192),fe=c.callbacks,fe===null?c.callbacks=[ce]:fe.push(ce))}else fe={lane:ce,tag:y.tag,payload:y.payload,callback:y.callback,next:null},ve===null?(le=ve=fe,H=_e):ve=ve.next=fe,h|=ce;if(y=y.next,y===null){if(y=c.shared.pending,y===null)break;fe=y,y=fe.next,fe.next=null,c.lastBaseUpdate=fe,c.shared.pending=null}}while(!0);ve===null&&(H=_e),c.baseState=H,c.firstBaseUpdate=le,c.lastBaseUpdate=ve,d===null&&(c.shared.lanes=0),en|=h,t.lanes=h,t.memoizedState=_e}}function zu(t,a){if(typeof t!="function")throw Error(i(191,t));t.call(a)}function Ou(t,a){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)zu(s[t],a)}var rr=U(null),Gl=U(0);function Ru(t,a){t=Os,T(Gl,t),T(rr,a),Os=t|a.baseLanes}function Mc(){T(Gl,Os),T(rr,rr.current)}function Tc(){Os=Gl.current,ie(rr),ie(Gl)}var Ba=U(null),Ka=null;function Is(t){var a=t.alternate;T(aa,aa.current&1),T(Ba,t),Ka===null&&(a===null||rr.current!==null||a.memoizedState!==null)&&(Ka=t)}function Ac(t){T(aa,aa.current),T(Ba,t),Ka===null&&(Ka=t)}function qu(t){t.tag===22?(T(aa,aa.current),T(Ba,t),Ka===null&&(Ka=t)):Js()}function Js(){T(aa,aa.current),T(Ba,Ba.current)}function Fa(t){ie(Ba),Ka===t&&(Ka=null),ie(aa)}var aa=U(0);function Yl(t){for(var a=t;a!==null;){if(a.tag===13){var s=a.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||Ho(s)||Bo(s)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ws=0,dt=null,Ut=null,oa=null,Pl=!1,lr=!1,Mn=!1,Ql=0,Pr=0,ir=null,xg=0;function Wt(){throw Error(i(321))}function zc(t,a){if(a===null)return!1;for(var s=0;s<a.length&&s<t.length;s++)if(!Ua(t[s],a[s]))return!1;return!0}function Oc(t,a,s,n,c,d){return ws=d,dt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,N.H=t===null||t.memoizedState===null?vm:Zc,Mn=!1,d=s(n,c),Mn=!1,lr&&(d=Uu(a,s,n,c)),Lu(t),d}function Lu(t){N.H=Zr;var a=Ut!==null&&Ut.next!==null;if(ws=0,oa=Ut=dt=null,Pl=!1,Pr=0,ir=null,a)throw Error(i(300));t===null||da||(t=t.dependencies,t!==null&&Ll(t)&&(da=!0))}function Uu(t,a,s,n){dt=t;var c=0;do{if(lr&&(ir=null),Pr=0,lr=!1,25<=c)throw Error(i(301));if(c+=1,oa=Ut=null,t.updateQueue!=null){var d=t.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}N.H=ym,d=a(s,n)}while(lr);return d}function jg(){var t=N.H,a=t.useState()[0];return a=typeof a.then=="function"?Qr(a):a,t=t.useState()[0],(Ut!==null?Ut.memoizedState:null)!==t&&(dt.flags|=1024),a}function Rc(){var t=Ql!==0;return Ql=0,t}function qc(t,a,s){a.updateQueue=t.updateQueue,a.flags&=-2053,t.lanes&=~s}function Lc(t){if(Pl){for(t=t.memoizedState;t!==null;){var a=t.queue;a!==null&&(a.pending=null),t=t.next}Pl=!1}ws=0,oa=Ut=dt=null,lr=!1,Pr=Ql=0,ir=null}function Da(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oa===null?dt.memoizedState=oa=t:oa=oa.next=t,oa}function sa(){if(Ut===null){var t=dt.alternate;t=t!==null?t.memoizedState:null}else t=Ut.next;var a=oa===null?dt.memoizedState:oa.next;if(a!==null)oa=a,Ut=t;else{if(t===null)throw dt.alternate===null?Error(i(467)):Error(i(310));Ut=t,t={memoizedState:Ut.memoizedState,baseState:Ut.baseState,baseQueue:Ut.baseQueue,queue:Ut.queue,next:null},oa===null?dt.memoizedState=oa=t:oa=oa.next=t}return oa}function Xl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qr(t){var a=Pr;return Pr+=1,ir===null&&(ir=[]),t=Eu(ir,t,a),a=dt,(oa===null?a.memoizedState:oa.next)===null&&(a=a.alternate,N.H=a===null||a.memoizedState===null?vm:Zc),t}function Zl(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Qr(t);if(t.$$typeof===R)return Na(t)}throw Error(i(438,String(t)))}function Uc(t){var a=null,s=dt.updateQueue;if(s!==null&&(a=s.memoCache),a==null){var n=dt.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(a={data:n.data.map(function(c){return c.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),s===null&&(s=Xl(),dt.updateQueue=s),s.memoCache=a,s=a.data[a.index],s===void 0)for(s=a.data[a.index]=Array(t),n=0;n<t;n++)s[n]=Z;return a.index++,s}function ks(t,a){return typeof a=="function"?a(t):a}function Il(t){var a=sa();return Hc(a,Ut,t)}function Hc(t,a,s){var n=t.queue;if(n===null)throw Error(i(311));n.lastRenderedReducer=s;var c=t.baseQueue,d=n.pending;if(d!==null){if(c!==null){var h=c.next;c.next=d.next,d.next=h}a.baseQueue=c=d,n.pending=null}if(d=t.baseState,c===null)t.memoizedState=d;else{a=c.next;var y=h=null,H=null,le=a,ve=!1;do{var _e=le.lane&-536870913;if(_e!==le.lane?(bt&_e)===_e:(ws&_e)===_e){var ce=le.revertLane;if(ce===0)H!==null&&(H=H.next={lane:0,revertLane:0,gesture:null,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null}),_e===tr&&(ve=!0);else if((ws&ce)===ce){le=le.next,ce===tr&&(ve=!0);continue}else _e={lane:0,revertLane:le.revertLane,gesture:null,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null},H===null?(y=H=_e,h=d):H=H.next=_e,dt.lanes|=ce,en|=ce;_e=le.action,Mn&&s(d,_e),d=le.hasEagerState?le.eagerState:s(d,_e)}else ce={lane:_e,revertLane:le.revertLane,gesture:le.gesture,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null},H===null?(y=H=ce,h=d):H=H.next=ce,dt.lanes|=_e,en|=_e;le=le.next}while(le!==null&&le!==a);if(H===null?h=d:H.next=y,!Ua(d,t.memoizedState)&&(da=!0,ve&&(s=ar,s!==null)))throw s;t.memoizedState=d,t.baseState=h,t.baseQueue=H,n.lastRenderedState=d}return c===null&&(n.lanes=0),[t.memoizedState,n.dispatch]}function Bc(t){var a=sa(),s=a.queue;if(s===null)throw Error(i(311));s.lastRenderedReducer=t;var n=s.dispatch,c=s.pending,d=a.memoizedState;if(c!==null){s.pending=null;var h=c=c.next;do d=t(d,h.action),h=h.next;while(h!==c);Ua(d,a.memoizedState)||(da=!0),a.memoizedState=d,a.baseQueue===null&&(a.baseState=d),s.lastRenderedState=d}return[d,n]}function Hu(t,a,s){var n=dt,c=sa(),d=St;if(d){if(s===void 0)throw Error(i(407));s=s()}else s=a();var h=!Ua((Ut||c).memoizedState,s);if(h&&(c.memoizedState=s,da=!0),c=c.queue,Vc($u.bind(null,n,c,t),[t]),c.getSnapshot!==a||h||oa!==null&&oa.memoizedState.tag&1){if(n.flags|=2048,cr(9,{destroy:void 0},Fu.bind(null,n,c,s,a),null),Ft===null)throw Error(i(349));d||(ws&127)!==0||Bu(n,a,s)}return s}function Bu(t,a,s){t.flags|=16384,t={getSnapshot:a,value:s},a=dt.updateQueue,a===null?(a=Xl(),dt.updateQueue=a,a.stores=[t]):(s=a.stores,s===null?a.stores=[t]:s.push(t))}function Fu(t,a,s,n){a.value=s,a.getSnapshot=n,Vu(a)&&Gu(t)}function $u(t,a,s){return s(function(){Vu(a)&&Gu(t)})}function Vu(t){var a=t.getSnapshot;t=t.value;try{var s=a();return!Ua(t,s)}catch{return!0}}function Gu(t){var a=bn(t,2);a!==null&&La(a,t,2)}function Fc(t){var a=Da();if(typeof t=="function"){var s=t;if(t=s(),Mn){Ee(!0);try{s()}finally{Ee(!1)}}}return a.memoizedState=a.baseState=t,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:t},a}function Yu(t,a,s,n){return t.baseState=s,Hc(t,Ut,typeof n=="function"?n:ks)}function vg(t,a,s,n,c){if(Kl(t))throw Error(i(485));if(t=a.action,t!==null){var d={payload:c,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(h){d.listeners.push(h)}};N.T!==null?s(!0):d.isTransition=!1,n(d),s=a.pending,s===null?(d.next=a.pending=d,Pu(a,d)):(d.next=s.next,a.pending=s.next=d)}}function Pu(t,a){var s=a.action,n=a.payload,c=t.state;if(a.isTransition){var d=N.T,h={};N.T=h;try{var y=s(c,n),H=N.S;H!==null&&H(h,y),Qu(t,a,y)}catch(le){$c(t,a,le)}finally{d!==null&&h.types!==null&&(d.types=h.types),N.T=d}}else try{d=s(c,n),Qu(t,a,d)}catch(le){$c(t,a,le)}}function Qu(t,a,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(n){Xu(t,a,n)},function(n){return $c(t,a,n)}):Xu(t,a,s)}function Xu(t,a,s){a.status="fulfilled",a.value=s,Zu(a),t.state=s,a=t.pending,a!==null&&(s=a.next,s===a?t.pending=null:(s=s.next,a.next=s,Pu(t,s)))}function $c(t,a,s){var n=t.pending;if(t.pending=null,n!==null){n=n.next;do a.status="rejected",a.reason=s,Zu(a),a=a.next;while(a!==n)}t.action=null}function Zu(t){t=t.listeners;for(var a=0;a<t.length;a++)(0,t[a])()}function Iu(t,a){return a}function Ju(t,a){if(St){var s=Ft.formState;if(s!==null){e:{var n=dt;if(St){if(Gt){t:{for(var c=Gt,d=Wa;c.nodeType!==8;){if(!d){c=null;break t}if(c=es(c.nextSibling),c===null){c=null;break t}}d=c.data,c=d==="F!"||d==="F"?c:null}if(c){Gt=es(c.nextSibling),n=c.data==="F!";break e}}Ys(n)}n=!1}n&&(a=s[0])}}return s=Da(),s.memoizedState=s.baseState=a,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Iu,lastRenderedState:a},s.queue=n,s=gm.bind(null,dt,n),n.dispatch=s,n=Fc(!1),d=Xc.bind(null,dt,!1,n.queue),n=Da(),c={state:a,dispatch:null,action:t,pending:null},n.queue=c,s=vg.bind(null,dt,c,d,s),c.dispatch=s,n.memoizedState=t,[a,s,!1]}function Wu(t){var a=sa();return Ku(a,Ut,t)}function Ku(t,a,s){if(a=Hc(t,a,Iu)[0],t=Il(ks)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var n=Qr(a)}catch(h){throw h===sr?Bl:h}else n=a;a=sa();var c=a.queue,d=c.dispatch;return s!==a.memoizedState&&(dt.flags|=2048,cr(9,{destroy:void 0},yg.bind(null,c,s),null)),[n,d,t]}function yg(t,a){t.action=a}function em(t){var a=sa(),s=Ut;if(s!==null)return Ku(a,s,t);sa(),a=a.memoizedState,s=sa();var n=s.queue.dispatch;return s.memoizedState=t,[a,n,!1]}function cr(t,a,s,n){return t={tag:t,create:s,deps:n,inst:a,next:null},a=dt.updateQueue,a===null&&(a=Xl(),dt.updateQueue=a),s=a.lastEffect,s===null?a.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,a.lastEffect=t),t}function tm(){return sa().memoizedState}function Jl(t,a,s,n){var c=Da();dt.flags|=t,c.memoizedState=cr(1|a,{destroy:void 0},s,n===void 0?null:n)}function Wl(t,a,s,n){var c=sa();n=n===void 0?null:n;var d=c.memoizedState.inst;Ut!==null&&n!==null&&zc(n,Ut.memoizedState.deps)?c.memoizedState=cr(a,d,s,n):(dt.flags|=t,c.memoizedState=cr(1|a,d,s,n))}function am(t,a){Jl(8390656,8,t,a)}function Vc(t,a){Wl(2048,8,t,a)}function bg(t){dt.flags|=4;var a=dt.updateQueue;if(a===null)a=Xl(),dt.updateQueue=a,a.events=[t];else{var s=a.events;s===null?a.events=[t]:s.push(t)}}function sm(t){var a=sa().memoizedState;return bg({ref:a,nextImpl:t}),function(){if((zt&2)!==0)throw Error(i(440));return a.impl.apply(void 0,arguments)}}function nm(t,a){return Wl(4,2,t,a)}function rm(t,a){return Wl(4,4,t,a)}function lm(t,a){if(typeof a=="function"){t=t();var s=a(t);return function(){typeof s=="function"?s():a(null)}}if(a!=null)return t=t(),a.current=t,function(){a.current=null}}function im(t,a,s){s=s!=null?s.concat([t]):null,Wl(4,4,lm.bind(null,a,t),s)}function Gc(){}function cm(t,a){var s=sa();a=a===void 0?null:a;var n=s.memoizedState;return a!==null&&zc(a,n[1])?n[0]:(s.memoizedState=[t,a],t)}function om(t,a){var s=sa();a=a===void 0?null:a;var n=s.memoizedState;if(a!==null&&zc(a,n[1]))return n[0];if(n=t(),Mn){Ee(!0);try{t()}finally{Ee(!1)}}return s.memoizedState=[n,a],n}function Yc(t,a,s){return s===void 0||(ws&1073741824)!==0&&(bt&261930)===0?t.memoizedState=a:(t.memoizedState=s,t=dh(),dt.lanes|=t,en|=t,s)}function dm(t,a,s,n){return Ua(s,a)?s:rr.current!==null?(t=Yc(t,s,n),Ua(t,a)||(da=!0),t):(ws&42)===0||(ws&1073741824)!==0&&(bt&261930)===0?(da=!0,t.memoizedState=s):(t=dh(),dt.lanes|=t,en|=t,a)}function um(t,a,s,n,c){var d=se.p;se.p=d!==0&&8>d?d:8;var h=N.T,y={};N.T=y,Xc(t,!1,a,s);try{var H=c(),le=N.S;if(le!==null&&le(y,H),H!==null&&typeof H=="object"&&typeof H.then=="function"){var ve=gg(H,n);Xr(t,a,ve,Ga(t))}else Xr(t,a,n,Ga(t))}catch(_e){Xr(t,a,{then:function(){},status:"rejected",reason:_e},Ga())}finally{se.p=d,h!==null&&y.types!==null&&(h.types=y.types),N.T=h}}function _g(){}function Pc(t,a,s,n){if(t.tag!==5)throw Error(i(476));var c=mm(t).queue;um(t,c,a,E,s===null?_g:function(){return hm(t),s(n)})}function mm(t){var a=t.memoizedState;if(a!==null)return a;a={memoizedState:E,baseState:E,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:E},next:null};var s={};return a.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:s},next:null},t.memoizedState=a,t=t.alternate,t!==null&&(t.memoizedState=a),a}function hm(t){var a=mm(t);a.next===null&&(a=t.alternate.memoizedState),Xr(t,a.next.queue,{},Ga())}function Qc(){return Na(ul)}function pm(){return sa().memoizedState}function fm(){return sa().memoizedState}function Ng(t){for(var a=t.return;a!==null;){switch(a.tag){case 24:case 3:var s=Ga();t=Xs(s);var n=Zs(a,t,s);n!==null&&(La(n,a,s),Vr(n,a,s)),a={cache:_c()},t.payload=a;return}a=a.return}}function Sg(t,a,s){var n=Ga();s={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},Kl(t)?xm(a,s):(s=uc(t,a,s,n),s!==null&&(La(s,t,n),jm(s,a,n)))}function gm(t,a,s){var n=Ga();Xr(t,a,s,n)}function Xr(t,a,s,n){var c={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(Kl(t))xm(a,c);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=a.lastRenderedReducer,d!==null))try{var h=a.lastRenderedState,y=d(h,s);if(c.hasEagerState=!0,c.eagerState=y,Ua(y,h))return zl(t,a,c,0),Ft===null&&Al(),!1}catch{}finally{}if(s=uc(t,a,c,n),s!==null)return La(s,t,n),jm(s,a,n),!0}return!1}function Xc(t,a,s,n){if(n={lane:2,revertLane:ko(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Kl(t)){if(a)throw Error(i(479))}else a=uc(t,s,n,2),a!==null&&La(a,t,2)}function Kl(t){var a=t.alternate;return t===dt||a!==null&&a===dt}function xm(t,a){lr=Pl=!0;var s=t.pending;s===null?a.next=a:(a.next=s.next,s.next=a),t.pending=a}function jm(t,a,s){if((s&4194048)!==0){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,me(t,s)}}var Zr={readContext:Na,use:Zl,useCallback:Wt,useContext:Wt,useEffect:Wt,useImperativeHandle:Wt,useLayoutEffect:Wt,useInsertionEffect:Wt,useMemo:Wt,useReducer:Wt,useRef:Wt,useState:Wt,useDebugValue:Wt,useDeferredValue:Wt,useTransition:Wt,useSyncExternalStore:Wt,useId:Wt,useHostTransitionStatus:Wt,useFormState:Wt,useActionState:Wt,useOptimistic:Wt,useMemoCache:Wt,useCacheRefresh:Wt};Zr.useEffectEvent=Wt;var vm={readContext:Na,use:Zl,useCallback:function(t,a){return Da().memoizedState=[t,a===void 0?null:a],t},useContext:Na,useEffect:am,useImperativeHandle:function(t,a,s){s=s!=null?s.concat([t]):null,Jl(4194308,4,lm.bind(null,a,t),s)},useLayoutEffect:function(t,a){return Jl(4194308,4,t,a)},useInsertionEffect:function(t,a){Jl(4,2,t,a)},useMemo:function(t,a){var s=Da();a=a===void 0?null:a;var n=t();if(Mn){Ee(!0);try{t()}finally{Ee(!1)}}return s.memoizedState=[n,a],n},useReducer:function(t,a,s){var n=Da();if(s!==void 0){var c=s(a);if(Mn){Ee(!0);try{s(a)}finally{Ee(!1)}}}else c=a;return n.memoizedState=n.baseState=c,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:c},n.queue=t,t=t.dispatch=Sg.bind(null,dt,t),[n.memoizedState,t]},useRef:function(t){var a=Da();return t={current:t},a.memoizedState=t},useState:function(t){t=Fc(t);var a=t.queue,s=gm.bind(null,dt,a);return a.dispatch=s,[t.memoizedState,s]},useDebugValue:Gc,useDeferredValue:function(t,a){var s=Da();return Yc(s,t,a)},useTransition:function(){var t=Fc(!1);return t=um.bind(null,dt,t.queue,!0,!1),Da().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,a,s){var n=dt,c=Da();if(St){if(s===void 0)throw Error(i(407));s=s()}else{if(s=a(),Ft===null)throw Error(i(349));(bt&127)!==0||Bu(n,a,s)}c.memoizedState=s;var d={value:s,getSnapshot:a};return c.queue=d,am($u.bind(null,n,d,t),[t]),n.flags|=2048,cr(9,{destroy:void 0},Fu.bind(null,n,d,s,a),null),s},useId:function(){var t=Da(),a=Ft.identifierPrefix;if(St){var s=ms,n=us;s=(n&~(1<<32-ne(n)-1)).toString(32)+s,a="_"+a+"R_"+s,s=Ql++,0<s&&(a+="H"+s.toString(32)),a+="_"}else s=xg++,a="_"+a+"r_"+s.toString(32)+"_";return t.memoizedState=a},useHostTransitionStatus:Qc,useFormState:Ju,useActionState:Ju,useOptimistic:function(t){var a=Da();a.memoizedState=a.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=s,a=Xc.bind(null,dt,!0,s),s.dispatch=a,[t,a]},useMemoCache:Uc,useCacheRefresh:function(){return Da().memoizedState=Ng.bind(null,dt)},useEffectEvent:function(t){var a=Da(),s={impl:t};return a.memoizedState=s,function(){if((zt&2)!==0)throw Error(i(440));return s.impl.apply(void 0,arguments)}}},Zc={readContext:Na,use:Zl,useCallback:cm,useContext:Na,useEffect:Vc,useImperativeHandle:im,useInsertionEffect:nm,useLayoutEffect:rm,useMemo:om,useReducer:Il,useRef:tm,useState:function(){return Il(ks)},useDebugValue:Gc,useDeferredValue:function(t,a){var s=sa();return dm(s,Ut.memoizedState,t,a)},useTransition:function(){var t=Il(ks)[0],a=sa().memoizedState;return[typeof t=="boolean"?t:Qr(t),a]},useSyncExternalStore:Hu,useId:pm,useHostTransitionStatus:Qc,useFormState:Wu,useActionState:Wu,useOptimistic:function(t,a){var s=sa();return Yu(s,Ut,t,a)},useMemoCache:Uc,useCacheRefresh:fm};Zc.useEffectEvent=sm;var ym={readContext:Na,use:Zl,useCallback:cm,useContext:Na,useEffect:Vc,useImperativeHandle:im,useInsertionEffect:nm,useLayoutEffect:rm,useMemo:om,useReducer:Bc,useRef:tm,useState:function(){return Bc(ks)},useDebugValue:Gc,useDeferredValue:function(t,a){var s=sa();return Ut===null?Yc(s,t,a):dm(s,Ut.memoizedState,t,a)},useTransition:function(){var t=Bc(ks)[0],a=sa().memoizedState;return[typeof t=="boolean"?t:Qr(t),a]},useSyncExternalStore:Hu,useId:pm,useHostTransitionStatus:Qc,useFormState:em,useActionState:em,useOptimistic:function(t,a){var s=sa();return Ut!==null?Yu(s,Ut,t,a):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:Uc,useCacheRefresh:fm};ym.useEffectEvent=sm;function Ic(t,a,s,n){a=t.memoizedState,s=s(n,a),s=s==null?a:q({},a,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var Jc={enqueueSetState:function(t,a,s){t=t._reactInternals;var n=Ga(),c=Xs(n);c.payload=a,s!=null&&(c.callback=s),a=Zs(t,c,n),a!==null&&(La(a,t,n),Vr(a,t,n))},enqueueReplaceState:function(t,a,s){t=t._reactInternals;var n=Ga(),c=Xs(n);c.tag=1,c.payload=a,s!=null&&(c.callback=s),a=Zs(t,c,n),a!==null&&(La(a,t,n),Vr(a,t,n))},enqueueForceUpdate:function(t,a){t=t._reactInternals;var s=Ga(),n=Xs(s);n.tag=2,a!=null&&(n.callback=a),a=Zs(t,n,s),a!==null&&(La(a,t,s),Vr(a,t,s))}};function bm(t,a,s,n,c,d,h){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,d,h):a.prototype&&a.prototype.isPureReactComponent?!Rr(s,n)||!Rr(c,d):!0}function _m(t,a,s,n){t=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(s,n),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(s,n),a.state!==t&&Jc.enqueueReplaceState(a,a.state,null)}function Tn(t,a){var s=a;if("ref"in a){s={};for(var n in a)n!=="ref"&&(s[n]=a[n])}if(t=t.defaultProps){s===a&&(s=q({},s));for(var c in t)s[c]===void 0&&(s[c]=t[c])}return s}function Nm(t){Tl(t)}function Sm(t){console.error(t)}function Cm(t){Tl(t)}function ei(t,a){try{var s=t.onUncaughtError;s(a.value,{componentStack:a.stack})}catch(n){setTimeout(function(){throw n})}}function wm(t,a,s){try{var n=t.onCaughtError;n(s.value,{componentStack:s.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function Wc(t,a,s){return s=Xs(s),s.tag=3,s.payload={element:null},s.callback=function(){ei(t,a)},s}function km(t){return t=Xs(t),t.tag=3,t}function Em(t,a,s,n){var c=s.type.getDerivedStateFromError;if(typeof c=="function"){var d=n.value;t.payload=function(){return c(d)},t.callback=function(){wm(a,s,n)}}var h=s.stateNode;h!==null&&typeof h.componentDidCatch=="function"&&(t.callback=function(){wm(a,s,n),typeof c!="function"&&(tn===null?tn=new Set([this]):tn.add(this));var y=n.stack;this.componentDidCatch(n.value,{componentStack:y!==null?y:""})})}function Cg(t,a,s,n,c){if(s.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(a=s.alternate,a!==null&&er(a,s,c,!0),s=Ba.current,s!==null){switch(s.tag){case 31:case 13:return Ka===null?mi():s.alternate===null&&Kt===0&&(Kt=3),s.flags&=-257,s.flags|=65536,s.lanes=c,n===Fl?s.flags|=16384:(a=s.updateQueue,a===null?s.updateQueue=new Set([n]):a.add(n),So(t,n,c)),!1;case 22:return s.flags|=65536,n===Fl?s.flags|=16384:(a=s.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([n])},s.updateQueue=a):(s=a.retryQueue,s===null?a.retryQueue=new Set([n]):s.add(n)),So(t,n,c)),!1}throw Error(i(435,s.tag))}return So(t,n,c),mi(),!1}if(St)return a=Ba.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=c,n!==xc&&(t=Error(i(422),{cause:n}),Ur(Za(t,s)))):(n!==xc&&(a=Error(i(423),{cause:n}),Ur(Za(a,s))),t=t.current.alternate,t.flags|=65536,c&=-c,t.lanes|=c,n=Za(n,s),c=Wc(t.stateNode,n,c),Ec(t,c),Kt!==4&&(Kt=2)),!1;var d=Error(i(520),{cause:n});if(d=Za(d,s),sl===null?sl=[d]:sl.push(d),Kt!==4&&(Kt=2),a===null)return!0;n=Za(n,s),s=a;do{switch(s.tag){case 3:return s.flags|=65536,t=c&-c,s.lanes|=t,t=Wc(s.stateNode,n,t),Ec(s,t),!1;case 1:if(a=s.type,d=s.stateNode,(s.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(tn===null||!tn.has(d))))return s.flags|=65536,c&=-c,s.lanes|=c,c=km(c),Em(c,t,s,n),Ec(s,c),!1}s=s.return}while(s!==null);return!1}var Kc=Error(i(461)),da=!1;function Sa(t,a,s,n){a.child=t===null?Au(a,null,s,n):Dn(a,t.child,s,n)}function Dm(t,a,s,n,c){s=s.render;var d=a.ref;if("ref"in n){var h={};for(var y in n)y!=="ref"&&(h[y]=n[y])}else h=n;return Cn(a),n=Oc(t,a,s,h,d,c),y=Rc(),t!==null&&!da?(qc(t,a,c),Es(t,a,c)):(St&&y&&fc(a),a.flags|=1,Sa(t,a,n,c),a.child)}function Mm(t,a,s,n,c){if(t===null){var d=s.type;return typeof d=="function"&&!mc(d)&&d.defaultProps===void 0&&s.compare===null?(a.tag=15,a.type=d,Tm(t,a,d,n,c)):(t=Rl(s.type,null,n,a,a.mode,c),t.ref=a.ref,t.return=a,a.child=t)}if(d=t.child,!io(t,c)){var h=d.memoizedProps;if(s=s.compare,s=s!==null?s:Rr,s(h,n)&&t.ref===a.ref)return Es(t,a,c)}return a.flags|=1,t=_s(d,n),t.ref=a.ref,t.return=a,a.child=t}function Tm(t,a,s,n,c){if(t!==null){var d=t.memoizedProps;if(Rr(d,n)&&t.ref===a.ref)if(da=!1,a.pendingProps=n=d,io(t,c))(t.flags&131072)!==0&&(da=!0);else return a.lanes=t.lanes,Es(t,a,c)}return eo(t,a,s,n,c)}function Am(t,a,s,n){var c=n.children,d=t!==null?t.memoizedState:null;if(t===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((a.flags&128)!==0){if(d=d!==null?d.baseLanes|s:s,t!==null){for(n=a.child=t.child,c=0;n!==null;)c=c|n.lanes|n.childLanes,n=n.sibling;n=c&~d}else n=0,a.child=null;return zm(t,a,d,s,n)}if((s&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},t!==null&&Hl(a,d!==null?d.cachePool:null),d!==null?Ru(a,d):Mc(),qu(a);else return n=a.lanes=536870912,zm(t,a,d!==null?d.baseLanes|s:s,s,n)}else d!==null?(Hl(a,d.cachePool),Ru(a,d),Js(),a.memoizedState=null):(t!==null&&Hl(a,null),Mc(),Js());return Sa(t,a,c,s),a.child}function Ir(t,a){return t!==null&&t.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function zm(t,a,s,n,c){var d=Sc();return d=d===null?null:{parent:ca._currentValue,pool:d},a.memoizedState={baseLanes:s,cachePool:d},t!==null&&Hl(a,null),Mc(),qu(a),t!==null&&er(t,a,n,!0),a.childLanes=c,null}function ti(t,a){return a=si({mode:a.mode,children:a.children},t.mode),a.ref=t.ref,t.child=a,a.return=t,a}function Om(t,a,s){return Dn(a,t.child,null,s),t=ti(a,a.pendingProps),t.flags|=2,Fa(a),a.memoizedState=null,t}function wg(t,a,s){var n=a.pendingProps,c=(a.flags&128)!==0;if(a.flags&=-129,t===null){if(St){if(n.mode==="hidden")return t=ti(a,n),a.lanes=536870912,Ir(null,t);if(Ac(a),(t=Gt)?(t=Ph(t,Wa),t=t!==null&&t.data==="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:Vs!==null?{id:us,overflow:ms}:null,retryLane:536870912,hydrationErrors:null},s=xu(t),s.return=a,a.child=s,_a=a,Gt=null)):t=null,t===null)throw Ys(a);return a.lanes=536870912,null}return ti(a,n)}var d=t.memoizedState;if(d!==null){var h=d.dehydrated;if(Ac(a),c)if(a.flags&256)a.flags&=-257,a=Om(t,a,s);else if(a.memoizedState!==null)a.child=t.child,a.flags|=128,a=null;else throw Error(i(558));else if(da||er(t,a,s,!1),c=(s&t.childLanes)!==0,da||c){if(n=Ft,n!==null&&(h=he(n,s),h!==0&&h!==d.retryLane))throw d.retryLane=h,bn(t,h),La(n,t,h),Kc;mi(),a=Om(t,a,s)}else t=d.treeContext,Gt=es(h.nextSibling),_a=a,St=!0,Gs=null,Wa=!1,t!==null&&yu(a,t),a=ti(a,n),a.flags|=4096;return a}return t=_s(t.child,{mode:n.mode,children:n.children}),t.ref=a.ref,a.child=t,t.return=a,t}function ai(t,a){var s=a.ref;if(s===null)t!==null&&t.ref!==null&&(a.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(i(284));(t===null||t.ref!==s)&&(a.flags|=4194816)}}function eo(t,a,s,n,c){return Cn(a),s=Oc(t,a,s,n,void 0,c),n=Rc(),t!==null&&!da?(qc(t,a,c),Es(t,a,c)):(St&&n&&fc(a),a.flags|=1,Sa(t,a,s,c),a.child)}function Rm(t,a,s,n,c,d){return Cn(a),a.updateQueue=null,s=Uu(a,n,s,c),Lu(t),n=Rc(),t!==null&&!da?(qc(t,a,d),Es(t,a,d)):(St&&n&&fc(a),a.flags|=1,Sa(t,a,s,d),a.child)}function qm(t,a,s,n,c){if(Cn(a),a.stateNode===null){var d=In,h=s.contextType;typeof h=="object"&&h!==null&&(d=Na(h)),d=new s(n,d),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Jc,a.stateNode=d,d._reactInternals=a,d=a.stateNode,d.props=n,d.state=a.memoizedState,d.refs={},wc(a),h=s.contextType,d.context=typeof h=="object"&&h!==null?Na(h):In,d.state=a.memoizedState,h=s.getDerivedStateFromProps,typeof h=="function"&&(Ic(a,s,h,n),d.state=a.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(h=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),h!==d.state&&Jc.enqueueReplaceState(d,d.state,null),Yr(a,n,d,c),Gr(),d.state=a.memoizedState),typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!0}else if(t===null){d=a.stateNode;var y=a.memoizedProps,H=Tn(s,y);d.props=H;var le=d.context,ve=s.contextType;h=In,typeof ve=="object"&&ve!==null&&(h=Na(ve));var _e=s.getDerivedStateFromProps;ve=typeof _e=="function"||typeof d.getSnapshotBeforeUpdate=="function",y=a.pendingProps!==y,ve||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(y||le!==h)&&_m(a,d,n,h),Qs=!1;var ce=a.memoizedState;d.state=ce,Yr(a,n,d,c),Gr(),le=a.memoizedState,y||ce!==le||Qs?(typeof _e=="function"&&(Ic(a,s,_e,n),le=a.memoizedState),(H=Qs||bm(a,s,H,n,ce,le,h))?(ve||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(a.flags|=4194308)):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=n,a.memoizedState=le),d.props=n,d.state=le,d.context=h,n=H):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!1)}else{d=a.stateNode,kc(t,a),h=a.memoizedProps,ve=Tn(s,h),d.props=ve,_e=a.pendingProps,ce=d.context,le=s.contextType,H=In,typeof le=="object"&&le!==null&&(H=Na(le)),y=s.getDerivedStateFromProps,(le=typeof y=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==_e||ce!==H)&&_m(a,d,n,H),Qs=!1,ce=a.memoizedState,d.state=ce,Yr(a,n,d,c),Gr();var fe=a.memoizedState;h!==_e||ce!==fe||Qs||t!==null&&t.dependencies!==null&&Ll(t.dependencies)?(typeof y=="function"&&(Ic(a,s,y,n),fe=a.memoizedState),(ve=Qs||bm(a,s,ve,n,ce,fe,H)||t!==null&&t.dependencies!==null&&Ll(t.dependencies))?(le||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,fe,H),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,fe,H)),typeof d.componentDidUpdate=="function"&&(a.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&ce===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&ce===t.memoizedState||(a.flags|=1024),a.memoizedProps=n,a.memoizedState=fe),d.props=n,d.state=fe,d.context=H,n=ve):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&ce===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&ce===t.memoizedState||(a.flags|=1024),n=!1)}return d=n,ai(t,a),n=(a.flags&128)!==0,d||n?(d=a.stateNode,s=n&&typeof s.getDerivedStateFromError!="function"?null:d.render(),a.flags|=1,t!==null&&n?(a.child=Dn(a,t.child,null,c),a.child=Dn(a,null,s,c)):Sa(t,a,s,c),a.memoizedState=d.state,t=a.child):t=Es(t,a,c),t}function Lm(t,a,s,n){return Nn(),a.flags|=256,Sa(t,a,s,n),a.child}var to={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ao(t){return{baseLanes:t,cachePool:wu()}}function so(t,a,s){return t=t!==null?t.childLanes&~s:0,a&&(t|=Va),t}function Um(t,a,s){var n=a.pendingProps,c=!1,d=(a.flags&128)!==0,h;if((h=d)||(h=t!==null&&t.memoizedState===null?!1:(aa.current&2)!==0),h&&(c=!0,a.flags&=-129),h=(a.flags&32)!==0,a.flags&=-33,t===null){if(St){if(c?Is(a):Js(),(t=Gt)?(t=Ph(t,Wa),t=t!==null&&t.data!=="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:Vs!==null?{id:us,overflow:ms}:null,retryLane:536870912,hydrationErrors:null},s=xu(t),s.return=a,a.child=s,_a=a,Gt=null)):t=null,t===null)throw Ys(a);return Bo(t)?a.lanes=32:a.lanes=536870912,null}var y=n.children;return n=n.fallback,c?(Js(),c=a.mode,y=si({mode:"hidden",children:y},c),n=_n(n,c,s,null),y.return=a,n.return=a,y.sibling=n,a.child=y,n=a.child,n.memoizedState=ao(s),n.childLanes=so(t,h,s),a.memoizedState=to,Ir(null,n)):(Is(a),no(a,y))}var H=t.memoizedState;if(H!==null&&(y=H.dehydrated,y!==null)){if(d)a.flags&256?(Is(a),a.flags&=-257,a=ro(t,a,s)):a.memoizedState!==null?(Js(),a.child=t.child,a.flags|=128,a=null):(Js(),y=n.fallback,c=a.mode,n=si({mode:"visible",children:n.children},c),y=_n(y,c,s,null),y.flags|=2,n.return=a,y.return=a,n.sibling=y,a.child=n,Dn(a,t.child,null,s),n=a.child,n.memoizedState=ao(s),n.childLanes=so(t,h,s),a.memoizedState=to,a=Ir(null,n));else if(Is(a),Bo(y)){if(h=y.nextSibling&&y.nextSibling.dataset,h)var le=h.dgst;h=le,n=Error(i(419)),n.stack="",n.digest=h,Ur({value:n,source:null,stack:null}),a=ro(t,a,s)}else if(da||er(t,a,s,!1),h=(s&t.childLanes)!==0,da||h){if(h=Ft,h!==null&&(n=he(h,s),n!==0&&n!==H.retryLane))throw H.retryLane=n,bn(t,n),La(h,t,n),Kc;Ho(y)||mi(),a=ro(t,a,s)}else Ho(y)?(a.flags|=192,a.child=t.child,a=null):(t=H.treeContext,Gt=es(y.nextSibling),_a=a,St=!0,Gs=null,Wa=!1,t!==null&&yu(a,t),a=no(a,n.children),a.flags|=4096);return a}return c?(Js(),y=n.fallback,c=a.mode,H=t.child,le=H.sibling,n=_s(H,{mode:"hidden",children:n.children}),n.subtreeFlags=H.subtreeFlags&65011712,le!==null?y=_s(le,y):(y=_n(y,c,s,null),y.flags|=2),y.return=a,n.return=a,n.sibling=y,a.child=n,Ir(null,n),n=a.child,y=t.child.memoizedState,y===null?y=ao(s):(c=y.cachePool,c!==null?(H=ca._currentValue,c=c.parent!==H?{parent:H,pool:H}:c):c=wu(),y={baseLanes:y.baseLanes|s,cachePool:c}),n.memoizedState=y,n.childLanes=so(t,h,s),a.memoizedState=to,Ir(t.child,n)):(Is(a),s=t.child,t=s.sibling,s=_s(s,{mode:"visible",children:n.children}),s.return=a,s.sibling=null,t!==null&&(h=a.deletions,h===null?(a.deletions=[t],a.flags|=16):h.push(t)),a.child=s,a.memoizedState=null,s)}function no(t,a){return a=si({mode:"visible",children:a},t.mode),a.return=t,t.child=a}function si(t,a){return t=Ha(22,t,null,a),t.lanes=0,t}function ro(t,a,s){return Dn(a,t.child,null,s),t=no(a,a.pendingProps.children),t.flags|=2,a.memoizedState=null,t}function Hm(t,a,s){t.lanes|=a;var n=t.alternate;n!==null&&(n.lanes|=a),yc(t.return,a,s)}function lo(t,a,s,n,c,d){var h=t.memoizedState;h===null?t.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:c,treeForkCount:d}:(h.isBackwards=a,h.rendering=null,h.renderingStartTime=0,h.last=n,h.tail=s,h.tailMode=c,h.treeForkCount=d)}function Bm(t,a,s){var n=a.pendingProps,c=n.revealOrder,d=n.tail;n=n.children;var h=aa.current,y=(h&2)!==0;if(y?(h=h&1|2,a.flags|=128):h&=1,T(aa,h),Sa(t,a,n,s),n=St?Lr:0,!y&&t!==null&&(t.flags&128)!==0)e:for(t=a.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Hm(t,s,a);else if(t.tag===19)Hm(t,s,a);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===a)break e;for(;t.sibling===null;){if(t.return===null||t.return===a)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(c){case"forwards":for(s=a.child,c=null;s!==null;)t=s.alternate,t!==null&&Yl(t)===null&&(c=s),s=s.sibling;s=c,s===null?(c=a.child,a.child=null):(c=s.sibling,s.sibling=null),lo(a,!1,c,s,d,n);break;case"backwards":case"unstable_legacy-backwards":for(s=null,c=a.child,a.child=null;c!==null;){if(t=c.alternate,t!==null&&Yl(t)===null){a.child=c;break}t=c.sibling,c.sibling=s,s=c,c=t}lo(a,!0,s,null,d,n);break;case"together":lo(a,!1,null,null,void 0,n);break;default:a.memoizedState=null}return a.child}function Es(t,a,s){if(t!==null&&(a.dependencies=t.dependencies),en|=a.lanes,(s&a.childLanes)===0)if(t!==null){if(er(t,a,s,!1),(s&a.childLanes)===0)return null}else return null;if(t!==null&&a.child!==t.child)throw Error(i(153));if(a.child!==null){for(t=a.child,s=_s(t,t.pendingProps),a.child=s,s.return=a;t.sibling!==null;)t=t.sibling,s=s.sibling=_s(t,t.pendingProps),s.return=a;s.sibling=null}return a.child}function io(t,a){return(t.lanes&a)!==0?!0:(t=t.dependencies,!!(t!==null&&Ll(t)))}function kg(t,a,s){switch(a.tag){case 3:Te(a,a.stateNode.containerInfo),Ps(a,ca,t.memoizedState.cache),Nn();break;case 27:case 5:ze(a);break;case 4:Te(a,a.stateNode.containerInfo);break;case 10:Ps(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,Ac(a),null;break;case 13:var n=a.memoizedState;if(n!==null)return n.dehydrated!==null?(Is(a),a.flags|=128,null):(s&a.child.childLanes)!==0?Um(t,a,s):(Is(a),t=Es(t,a,s),t!==null?t.sibling:null);Is(a);break;case 19:var c=(t.flags&128)!==0;if(n=(s&a.childLanes)!==0,n||(er(t,a,s,!1),n=(s&a.childLanes)!==0),c){if(n)return Bm(t,a,s);a.flags|=128}if(c=a.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),T(aa,aa.current),n)break;return null;case 22:return a.lanes=0,Am(t,a,s,a.pendingProps);case 24:Ps(a,ca,t.memoizedState.cache)}return Es(t,a,s)}function Fm(t,a,s){if(t!==null)if(t.memoizedProps!==a.pendingProps)da=!0;else{if(!io(t,s)&&(a.flags&128)===0)return da=!1,kg(t,a,s);da=(t.flags&131072)!==0}else da=!1,St&&(a.flags&1048576)!==0&&vu(a,Lr,a.index);switch(a.lanes=0,a.tag){case 16:e:{var n=a.pendingProps;if(t=kn(a.elementType),a.type=t,typeof t=="function")mc(t)?(n=Tn(t,n),a.tag=1,a=qm(null,a,t,n,s)):(a.tag=0,a=eo(null,a,t,n,s));else{if(t!=null){var c=t.$$typeof;if(c===S){a.tag=11,a=Dm(null,a,t,n,s);break e}else if(c===$){a.tag=14,a=Mm(null,a,t,n,s);break e}}throw a=z(t)||t,Error(i(306,a,""))}}return a;case 0:return eo(t,a,a.type,a.pendingProps,s);case 1:return n=a.type,c=Tn(n,a.pendingProps),qm(t,a,n,c,s);case 3:e:{if(Te(a,a.stateNode.containerInfo),t===null)throw Error(i(387));n=a.pendingProps;var d=a.memoizedState;c=d.element,kc(t,a),Yr(a,n,null,s);var h=a.memoizedState;if(n=h.cache,Ps(a,ca,n),n!==d.cache&&bc(a,[ca],s,!0),Gr(),n=h.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:h.cache},a.updateQueue.baseState=d,a.memoizedState=d,a.flags&256){a=Lm(t,a,n,s);break e}else if(n!==c){c=Za(Error(i(424)),a),Ur(c),a=Lm(t,a,n,s);break e}else{switch(t=a.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Gt=es(t.firstChild),_a=a,St=!0,Gs=null,Wa=!0,s=Au(a,null,n,s),a.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(Nn(),n===c){a=Es(t,a,s);break e}Sa(t,a,n,s)}a=a.child}return a;case 26:return ai(t,a),t===null?(s=Wh(a.type,null,a.pendingProps,null))?a.memoizedState=s:St||(s=a.type,t=a.pendingProps,n=vi(ke.current).createElement(s),n[at]=a,n[rt]=t,Ca(n,s,t),st(n),a.stateNode=n):a.memoizedState=Wh(a.type,t.memoizedProps,a.pendingProps,t.memoizedState),null;case 27:return ze(a),t===null&&St&&(n=a.stateNode=Zh(a.type,a.pendingProps,ke.current),_a=a,Wa=!0,c=Gt,rn(a.type)?(Fo=c,Gt=es(n.firstChild)):Gt=c),Sa(t,a,a.pendingProps.children,s),ai(t,a),t===null&&(a.flags|=4194304),a.child;case 5:return t===null&&St&&((c=n=Gt)&&(n=sx(n,a.type,a.pendingProps,Wa),n!==null?(a.stateNode=n,_a=a,Gt=es(n.firstChild),Wa=!1,c=!0):c=!1),c||Ys(a)),ze(a),c=a.type,d=a.pendingProps,h=t!==null?t.memoizedProps:null,n=d.children,qo(c,d)?n=null:h!==null&&qo(c,h)&&(a.flags|=32),a.memoizedState!==null&&(c=Oc(t,a,jg,null,null,s),ul._currentValue=c),ai(t,a),Sa(t,a,n,s),a.child;case 6:return t===null&&St&&((t=s=Gt)&&(s=nx(s,a.pendingProps,Wa),s!==null?(a.stateNode=s,_a=a,Gt=null,t=!0):t=!1),t||Ys(a)),null;case 13:return Um(t,a,s);case 4:return Te(a,a.stateNode.containerInfo),n=a.pendingProps,t===null?a.child=Dn(a,null,n,s):Sa(t,a,n,s),a.child;case 11:return Dm(t,a,a.type,a.pendingProps,s);case 7:return Sa(t,a,a.pendingProps,s),a.child;case 8:return Sa(t,a,a.pendingProps.children,s),a.child;case 12:return Sa(t,a,a.pendingProps.children,s),a.child;case 10:return n=a.pendingProps,Ps(a,a.type,n.value),Sa(t,a,n.children,s),a.child;case 9:return c=a.type._context,n=a.pendingProps.children,Cn(a),c=Na(c),n=n(c),a.flags|=1,Sa(t,a,n,s),a.child;case 14:return Mm(t,a,a.type,a.pendingProps,s);case 15:return Tm(t,a,a.type,a.pendingProps,s);case 19:return Bm(t,a,s);case 31:return wg(t,a,s);case 22:return Am(t,a,s,a.pendingProps);case 24:return Cn(a),n=Na(ca),t===null?(c=Sc(),c===null&&(c=Ft,d=_c(),c.pooledCache=d,d.refCount++,d!==null&&(c.pooledCacheLanes|=s),c=d),a.memoizedState={parent:n,cache:c},wc(a),Ps(a,ca,c)):((t.lanes&s)!==0&&(kc(t,a),Yr(a,null,null,s),Gr()),c=t.memoizedState,d=a.memoizedState,c.parent!==n?(c={parent:n,cache:n},a.memoizedState=c,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=c),Ps(a,ca,n)):(n=d.cache,Ps(a,ca,n),n!==c.cache&&bc(a,[ca],s,!0))),Sa(t,a,a.pendingProps.children,s),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function Ds(t){t.flags|=4}function co(t,a,s,n,c){if((a=(t.mode&32)!==0)&&(a=!1),a){if(t.flags|=16777216,(c&335544128)===c)if(t.stateNode.complete)t.flags|=8192;else if(ph())t.flags|=8192;else throw En=Fl,Cc}else t.flags&=-16777217}function $m(t,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!sp(a))if(ph())t.flags|=8192;else throw En=Fl,Cc}function ni(t,a){a!==null&&(t.flags|=4),t.flags&16384&&(a=t.tag!==22?Ne():536870912,t.lanes|=a,mr|=a)}function Jr(t,a){if(!St)switch(t.tailMode){case"hidden":a=t.tail;for(var s=null;a!==null;)a.alternate!==null&&(s=a),a=a.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?a||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Yt(t){var a=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(a)for(var c=t.child;c!==null;)s|=c.lanes|c.childLanes,n|=c.subtreeFlags&65011712,n|=c.flags&65011712,c.return=t,c=c.sibling;else for(c=t.child;c!==null;)s|=c.lanes|c.childLanes,n|=c.subtreeFlags,n|=c.flags,c.return=t,c=c.sibling;return t.subtreeFlags|=n,t.childLanes=s,a}function Eg(t,a,s){var n=a.pendingProps;switch(gc(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yt(a),null;case 1:return Yt(a),null;case 3:return s=a.stateNode,n=null,t!==null&&(n=t.memoizedState.cache),a.memoizedState.cache!==n&&(a.flags|=2048),Cs(ca),Be(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(Kn(a)?Ds(a):t===null||t.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,jc())),Yt(a),null;case 26:var c=a.type,d=a.memoizedState;return t===null?(Ds(a),d!==null?(Yt(a),$m(a,d)):(Yt(a),co(a,c,null,n,s))):d?d!==t.memoizedState?(Ds(a),Yt(a),$m(a,d)):(Yt(a),a.flags&=-16777217):(t=t.memoizedProps,t!==n&&Ds(a),Yt(a),co(a,c,t,n,s)),null;case 27:if(Oe(a),s=ke.current,c=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&Ds(a);else{if(!n){if(a.stateNode===null)throw Error(i(166));return Yt(a),null}t=je.current,Kn(a)?bu(a):(t=Zh(c,n,s),a.stateNode=t,Ds(a))}return Yt(a),null;case 5:if(Oe(a),c=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&Ds(a);else{if(!n){if(a.stateNode===null)throw Error(i(166));return Yt(a),null}if(d=je.current,Kn(a))bu(a);else{var h=vi(ke.current);switch(d){case 1:d=h.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:d=h.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":d=h.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":d=h.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":d=h.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof n.is=="string"?h.createElement("select",{is:n.is}):h.createElement("select"),n.multiple?d.multiple=!0:n.size&&(d.size=n.size);break;default:d=typeof n.is=="string"?h.createElement(c,{is:n.is}):h.createElement(c)}}d[at]=a,d[rt]=n;e:for(h=a.child;h!==null;){if(h.tag===5||h.tag===6)d.appendChild(h.stateNode);else if(h.tag!==4&&h.tag!==27&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break e;for(;h.sibling===null;){if(h.return===null||h.return===a)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}a.stateNode=d;e:switch(Ca(d,c,n),c){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&Ds(a)}}return Yt(a),co(a,a.type,t===null?null:t.memoizedProps,a.pendingProps,s),null;case 6:if(t&&a.stateNode!=null)t.memoizedProps!==n&&Ds(a);else{if(typeof n!="string"&&a.stateNode===null)throw Error(i(166));if(t=ke.current,Kn(a)){if(t=a.stateNode,s=a.memoizedProps,n=null,c=_a,c!==null)switch(c.tag){case 27:case 5:n=c.memoizedProps}t[at]=a,t=!!(t.nodeValue===s||n!==null&&n.suppressHydrationWarning===!0||Uh(t.nodeValue,s)),t||Ys(a,!0)}else t=vi(t).createTextNode(n),t[at]=a,a.stateNode=t}return Yt(a),null;case 31:if(s=a.memoizedState,t===null||t.memoizedState!==null){if(n=Kn(a),s!==null){if(t===null){if(!n)throw Error(i(318));if(t=a.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(557));t[at]=a}else Nn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Yt(a),t=!1}else s=jc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),t=!0;if(!t)return a.flags&256?(Fa(a),a):(Fa(a),null);if((a.flags&128)!==0)throw Error(i(558))}return Yt(a),null;case 13:if(n=a.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(c=Kn(a),n!==null&&n.dehydrated!==null){if(t===null){if(!c)throw Error(i(318));if(c=a.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(i(317));c[at]=a}else Nn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Yt(a),c=!1}else c=jc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=c),c=!0;if(!c)return a.flags&256?(Fa(a),a):(Fa(a),null)}return Fa(a),(a.flags&128)!==0?(a.lanes=s,a):(s=n!==null,t=t!==null&&t.memoizedState!==null,s&&(n=a.child,c=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(c=n.alternate.memoizedState.cachePool.pool),d=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(d=n.memoizedState.cachePool.pool),d!==c&&(n.flags|=2048)),s!==t&&s&&(a.child.flags|=8192),ni(a,a.updateQueue),Yt(a),null);case 4:return Be(),t===null&&To(a.stateNode.containerInfo),Yt(a),null;case 10:return Cs(a.type),Yt(a),null;case 19:if(ie(aa),n=a.memoizedState,n===null)return Yt(a),null;if(c=(a.flags&128)!==0,d=n.rendering,d===null)if(c)Jr(n,!1);else{if(Kt!==0||t!==null&&(t.flags&128)!==0)for(t=a.child;t!==null;){if(d=Yl(t),d!==null){for(a.flags|=128,Jr(n,!1),t=d.updateQueue,a.updateQueue=t,ni(a,t),a.subtreeFlags=0,t=s,s=a.child;s!==null;)gu(s,t),s=s.sibling;return T(aa,aa.current&1|2),St&&Ns(a,n.treeForkCount),a.child}t=t.sibling}n.tail!==null&&Ze()>oi&&(a.flags|=128,c=!0,Jr(n,!1),a.lanes=4194304)}else{if(!c)if(t=Yl(d),t!==null){if(a.flags|=128,c=!0,t=t.updateQueue,a.updateQueue=t,ni(a,t),Jr(n,!0),n.tail===null&&n.tailMode==="hidden"&&!d.alternate&&!St)return Yt(a),null}else 2*Ze()-n.renderingStartTime>oi&&s!==536870912&&(a.flags|=128,c=!0,Jr(n,!1),a.lanes=4194304);n.isBackwards?(d.sibling=a.child,a.child=d):(t=n.last,t!==null?t.sibling=d:a.child=d,n.last=d)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=Ze(),t.sibling=null,s=aa.current,T(aa,c?s&1|2:s&1),St&&Ns(a,n.treeForkCount),t):(Yt(a),null);case 22:case 23:return Fa(a),Tc(),n=a.memoizedState!==null,t!==null?t.memoizedState!==null!==n&&(a.flags|=8192):n&&(a.flags|=8192),n?(s&536870912)!==0&&(a.flags&128)===0&&(Yt(a),a.subtreeFlags&6&&(a.flags|=8192)):Yt(a),s=a.updateQueue,s!==null&&ni(a,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),n=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(n=a.memoizedState.cachePool.pool),n!==s&&(a.flags|=2048),t!==null&&ie(wn),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),a.memoizedState.cache!==s&&(a.flags|=2048),Cs(ca),Yt(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function Dg(t,a){switch(gc(a),a.tag){case 1:return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 3:return Cs(ca),Be(),t=a.flags,(t&65536)!==0&&(t&128)===0?(a.flags=t&-65537|128,a):null;case 26:case 27:case 5:return Oe(a),null;case 31:if(a.memoizedState!==null){if(Fa(a),a.alternate===null)throw Error(i(340));Nn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 13:if(Fa(a),t=a.memoizedState,t!==null&&t.dehydrated!==null){if(a.alternate===null)throw Error(i(340));Nn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 19:return ie(aa),null;case 4:return Be(),null;case 10:return Cs(a.type),null;case 22:case 23:return Fa(a),Tc(),t!==null&&ie(wn),t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 24:return Cs(ca),null;case 25:return null;default:return null}}function Vm(t,a){switch(gc(a),a.tag){case 3:Cs(ca),Be();break;case 26:case 27:case 5:Oe(a);break;case 4:Be();break;case 31:a.memoizedState!==null&&Fa(a);break;case 13:Fa(a);break;case 19:ie(aa);break;case 10:Cs(a.type);break;case 22:case 23:Fa(a),Tc(),t!==null&&ie(wn);break;case 24:Cs(ca)}}function Wr(t,a){try{var s=a.updateQueue,n=s!==null?s.lastEffect:null;if(n!==null){var c=n.next;s=c;do{if((s.tag&t)===t){n=void 0;var d=s.create,h=s.inst;n=d(),h.destroy=n}s=s.next}while(s!==c)}}catch(y){qt(a,a.return,y)}}function Ws(t,a,s){try{var n=a.updateQueue,c=n!==null?n.lastEffect:null;if(c!==null){var d=c.next;n=d;do{if((n.tag&t)===t){var h=n.inst,y=h.destroy;if(y!==void 0){h.destroy=void 0,c=a;var H=s,le=y;try{le()}catch(ve){qt(c,H,ve)}}}n=n.next}while(n!==d)}}catch(ve){qt(a,a.return,ve)}}function Gm(t){var a=t.updateQueue;if(a!==null){var s=t.stateNode;try{Ou(a,s)}catch(n){qt(t,t.return,n)}}}function Ym(t,a,s){s.props=Tn(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(n){qt(t,a,n)}}function Kr(t,a){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var n=t.stateNode;break;case 30:n=t.stateNode;break;default:n=t.stateNode}typeof s=="function"?t.refCleanup=s(n):s.current=n}}catch(c){qt(t,a,c)}}function hs(t,a){var s=t.ref,n=t.refCleanup;if(s!==null)if(typeof n=="function")try{n()}catch(c){qt(t,a,c)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(c){qt(t,a,c)}else s.current=null}function Pm(t){var a=t.type,s=t.memoizedProps,n=t.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break e;case"img":s.src?n.src=s.src:s.srcSet&&(n.srcset=s.srcSet)}}catch(c){qt(t,t.return,c)}}function oo(t,a,s){try{var n=t.stateNode;Jg(n,t.type,s,a),n[rt]=a}catch(c){qt(t,t.return,c)}}function Qm(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&rn(t.type)||t.tag===4}function uo(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Qm(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&rn(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function mo(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,a):(a=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,a.appendChild(t),s=s._reactRootContainer,s!=null||a.onclick!==null||(a.onclick=ys));else if(n!==4&&(n===27&&rn(t.type)&&(s=t.stateNode,a=null),t=t.child,t!==null))for(mo(t,a,s),t=t.sibling;t!==null;)mo(t,a,s),t=t.sibling}function ri(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?s.insertBefore(t,a):s.appendChild(t);else if(n!==4&&(n===27&&rn(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(ri(t,a,s),t=t.sibling;t!==null;)ri(t,a,s),t=t.sibling}function Xm(t){var a=t.stateNode,s=t.memoizedProps;try{for(var n=t.type,c=a.attributes;c.length;)a.removeAttributeNode(c[0]);Ca(a,n,s),a[at]=t,a[rt]=s}catch(d){qt(t,t.return,d)}}var Ms=!1,ua=!1,ho=!1,Zm=typeof WeakSet=="function"?WeakSet:Set,xa=null;function Mg(t,a){if(t=t.containerInfo,Oo=wi,t=iu(t),rc(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var c=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var h=0,y=-1,H=-1,le=0,ve=0,_e=t,ce=null;t:for(;;){for(var fe;_e!==s||c!==0&&_e.nodeType!==3||(y=h+c),_e!==d||n!==0&&_e.nodeType!==3||(H=h+n),_e.nodeType===3&&(h+=_e.nodeValue.length),(fe=_e.firstChild)!==null;)ce=_e,_e=fe;for(;;){if(_e===t)break t;if(ce===s&&++le===c&&(y=h),ce===d&&++ve===n&&(H=h),(fe=_e.nextSibling)!==null)break;_e=ce,ce=_e.parentNode}_e=fe}s=y===-1||H===-1?null:{start:y,end:H}}else s=null}s=s||{start:0,end:0}}else s=null;for(Ro={focusedElem:t,selectionRange:s},wi=!1,xa=a;xa!==null;)if(a=xa,t=a.child,(a.subtreeFlags&1028)!==0&&t!==null)t.return=a,xa=t;else for(;xa!==null;){switch(a=xa,d=a.alternate,t=a.flags,a.tag){case 0:if((t&4)!==0&&(t=a.updateQueue,t=t!==null?t.events:null,t!==null))for(s=0;s<t.length;s++)c=t[s],c.ref.impl=c.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&d!==null){t=void 0,s=a,c=d.memoizedProps,d=d.memoizedState,n=s.stateNode;try{var Ge=Tn(s.type,c);t=n.getSnapshotBeforeUpdate(Ge,d),n.__reactInternalSnapshotBeforeUpdate=t}catch(et){qt(s,s.return,et)}}break;case 3:if((t&1024)!==0){if(t=a.stateNode.containerInfo,s=t.nodeType,s===9)Uo(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Uo(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(i(163))}if(t=a.sibling,t!==null){t.return=a.return,xa=t;break}xa=a.return}}function Im(t,a,s){var n=s.flags;switch(s.tag){case 0:case 11:case 15:As(t,s),n&4&&Wr(5,s);break;case 1:if(As(t,s),n&4)if(t=s.stateNode,a===null)try{t.componentDidMount()}catch(h){qt(s,s.return,h)}else{var c=Tn(s.type,a.memoizedProps);a=a.memoizedState;try{t.componentDidUpdate(c,a,t.__reactInternalSnapshotBeforeUpdate)}catch(h){qt(s,s.return,h)}}n&64&&Gm(s),n&512&&Kr(s,s.return);break;case 3:if(As(t,s),n&64&&(t=s.updateQueue,t!==null)){if(a=null,s.child!==null)switch(s.child.tag){case 27:case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}try{Ou(t,a)}catch(h){qt(s,s.return,h)}}break;case 27:a===null&&n&4&&Xm(s);case 26:case 5:As(t,s),a===null&&n&4&&Pm(s),n&512&&Kr(s,s.return);break;case 12:As(t,s);break;case 31:As(t,s),n&4&&Km(t,s);break;case 13:As(t,s),n&4&&eh(t,s),n&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=Hg.bind(null,s),rx(t,s))));break;case 22:if(n=s.memoizedState!==null||Ms,!n){a=a!==null&&a.memoizedState!==null||ua,c=Ms;var d=ua;Ms=n,(ua=a)&&!d?zs(t,s,(s.subtreeFlags&8772)!==0):As(t,s),Ms=c,ua=d}break;case 30:break;default:As(t,s)}}function Jm(t){var a=t.alternate;a!==null&&(t.alternate=null,Jm(a)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(a=t.stateNode,a!==null&&Jt(a)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Xt=null,za=!1;function Ts(t,a,s){for(s=s.child;s!==null;)Wm(t,a,s),s=s.sibling}function Wm(t,a,s){if(be&&typeof be.onCommitFiberUnmount=="function")try{be.onCommitFiberUnmount(O,s)}catch{}switch(s.tag){case 26:ua||hs(s,a),Ts(t,a,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:ua||hs(s,a);var n=Xt,c=za;rn(s.type)&&(Xt=s.stateNode,za=!1),Ts(t,a,s),cl(s.stateNode),Xt=n,za=c;break;case 5:ua||hs(s,a);case 6:if(n=Xt,c=za,Xt=null,Ts(t,a,s),Xt=n,za=c,Xt!==null)if(za)try{(Xt.nodeType===9?Xt.body:Xt.nodeName==="HTML"?Xt.ownerDocument.body:Xt).removeChild(s.stateNode)}catch(d){qt(s,a,d)}else try{Xt.removeChild(s.stateNode)}catch(d){qt(s,a,d)}break;case 18:Xt!==null&&(za?(t=Xt,Gh(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),yr(t)):Gh(Xt,s.stateNode));break;case 4:n=Xt,c=za,Xt=s.stateNode.containerInfo,za=!0,Ts(t,a,s),Xt=n,za=c;break;case 0:case 11:case 14:case 15:Ws(2,s,a),ua||Ws(4,s,a),Ts(t,a,s);break;case 1:ua||(hs(s,a),n=s.stateNode,typeof n.componentWillUnmount=="function"&&Ym(s,a,n)),Ts(t,a,s);break;case 21:Ts(t,a,s);break;case 22:ua=(n=ua)||s.memoizedState!==null,Ts(t,a,s),ua=n;break;default:Ts(t,a,s)}}function Km(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{yr(t)}catch(s){qt(a,a.return,s)}}}function eh(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{yr(t)}catch(s){qt(a,a.return,s)}}function Tg(t){switch(t.tag){case 31:case 13:case 19:var a=t.stateNode;return a===null&&(a=t.stateNode=new Zm),a;case 22:return t=t.stateNode,a=t._retryCache,a===null&&(a=t._retryCache=new Zm),a;default:throw Error(i(435,t.tag))}}function li(t,a){var s=Tg(t);a.forEach(function(n){if(!s.has(n)){s.add(n);var c=Bg.bind(null,t,n);n.then(c,c)}})}function Oa(t,a){var s=a.deletions;if(s!==null)for(var n=0;n<s.length;n++){var c=s[n],d=t,h=a,y=h;e:for(;y!==null;){switch(y.tag){case 27:if(rn(y.type)){Xt=y.stateNode,za=!1;break e}break;case 5:Xt=y.stateNode,za=!1;break e;case 3:case 4:Xt=y.stateNode.containerInfo,za=!0;break e}y=y.return}if(Xt===null)throw Error(i(160));Wm(d,h,c),Xt=null,za=!1,d=c.alternate,d!==null&&(d.return=null),c.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)th(a,t),a=a.sibling}var cs=null;function th(t,a){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Oa(a,t),Ra(t),n&4&&(Ws(3,t,t.return),Wr(3,t),Ws(5,t,t.return));break;case 1:Oa(a,t),Ra(t),n&512&&(ua||s===null||hs(s,s.return)),n&64&&Ms&&(t=t.updateQueue,t!==null&&(n=t.callbacks,n!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?n:s.concat(n))));break;case 26:var c=cs;if(Oa(a,t),Ra(t),n&512&&(ua||s===null||hs(s,s.return)),n&4){var d=s!==null?s.memoizedState:null;if(n=t.memoizedState,s===null)if(n===null)if(t.stateNode===null){e:{n=t.type,s=t.memoizedProps,c=c.ownerDocument||c;t:switch(n){case"title":d=c.getElementsByTagName("title")[0],(!d||d[ia]||d[at]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=c.createElement(n),c.head.insertBefore(d,c.querySelector("head > title"))),Ca(d,n,s),d[at]=t,st(d),n=d;break e;case"link":var h=tp("link","href",c).get(n+(s.href||""));if(h){for(var y=0;y<h.length;y++)if(d=h[y],d.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&d.getAttribute("rel")===(s.rel==null?null:s.rel)&&d.getAttribute("title")===(s.title==null?null:s.title)&&d.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){h.splice(y,1);break t}}d=c.createElement(n),Ca(d,n,s),c.head.appendChild(d);break;case"meta":if(h=tp("meta","content",c).get(n+(s.content||""))){for(y=0;y<h.length;y++)if(d=h[y],d.getAttribute("content")===(s.content==null?null:""+s.content)&&d.getAttribute("name")===(s.name==null?null:s.name)&&d.getAttribute("property")===(s.property==null?null:s.property)&&d.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&d.getAttribute("charset")===(s.charSet==null?null:s.charSet)){h.splice(y,1);break t}}d=c.createElement(n),Ca(d,n,s),c.head.appendChild(d);break;default:throw Error(i(468,n))}d[at]=t,st(d),n=d}t.stateNode=n}else ap(c,t.type,t.stateNode);else t.stateNode=ep(c,n,t.memoizedProps);else d!==n?(d===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):d.count--,n===null?ap(c,t.type,t.stateNode):ep(c,n,t.memoizedProps)):n===null&&t.stateNode!==null&&oo(t,t.memoizedProps,s.memoizedProps)}break;case 27:Oa(a,t),Ra(t),n&512&&(ua||s===null||hs(s,s.return)),s!==null&&n&4&&oo(t,t.memoizedProps,s.memoizedProps);break;case 5:if(Oa(a,t),Ra(t),n&512&&(ua||s===null||hs(s,s.return)),t.flags&32){c=t.stateNode;try{Vn(c,"")}catch(Ge){qt(t,t.return,Ge)}}n&4&&t.stateNode!=null&&(c=t.memoizedProps,oo(t,c,s!==null?s.memoizedProps:c)),n&1024&&(ho=!0);break;case 6:if(Oa(a,t),Ra(t),n&4){if(t.stateNode===null)throw Error(i(162));n=t.memoizedProps,s=t.stateNode;try{s.nodeValue=n}catch(Ge){qt(t,t.return,Ge)}}break;case 3:if(_i=null,c=cs,cs=yi(a.containerInfo),Oa(a,t),cs=c,Ra(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{yr(a.containerInfo)}catch(Ge){qt(t,t.return,Ge)}ho&&(ho=!1,ah(t));break;case 4:n=cs,cs=yi(t.stateNode.containerInfo),Oa(a,t),Ra(t),cs=n;break;case 12:Oa(a,t),Ra(t);break;case 31:Oa(a,t),Ra(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,li(t,n)));break;case 13:Oa(a,t),Ra(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(ci=Ze()),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,li(t,n)));break;case 22:c=t.memoizedState!==null;var H=s!==null&&s.memoizedState!==null,le=Ms,ve=ua;if(Ms=le||c,ua=ve||H,Oa(a,t),ua=ve,Ms=le,Ra(t),n&8192)e:for(a=t.stateNode,a._visibility=c?a._visibility&-2:a._visibility|1,c&&(s===null||H||Ms||ua||An(t)),s=null,a=t;;){if(a.tag===5||a.tag===26){if(s===null){H=s=a;try{if(d=H.stateNode,c)h=d.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none";else{y=H.stateNode;var _e=H.memoizedProps.style,ce=_e!=null&&_e.hasOwnProperty("display")?_e.display:null;y.style.display=ce==null||typeof ce=="boolean"?"":(""+ce).trim()}}catch(Ge){qt(H,H.return,Ge)}}}else if(a.tag===6){if(s===null){H=a;try{H.stateNode.nodeValue=c?"":H.memoizedProps}catch(Ge){qt(H,H.return,Ge)}}}else if(a.tag===18){if(s===null){H=a;try{var fe=H.stateNode;c?Yh(fe,!0):Yh(H.stateNode,!1)}catch(Ge){qt(H,H.return,Ge)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===t)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break e;for(;a.sibling===null;){if(a.return===null||a.return===t)break e;s===a&&(s=null),a=a.return}s===a&&(s=null),a.sibling.return=a.return,a=a.sibling}n&4&&(n=t.updateQueue,n!==null&&(s=n.retryQueue,s!==null&&(n.retryQueue=null,li(t,s))));break;case 19:Oa(a,t),Ra(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,li(t,n)));break;case 30:break;case 21:break;default:Oa(a,t),Ra(t)}}function Ra(t){var a=t.flags;if(a&2){try{for(var s,n=t.return;n!==null;){if(Qm(n)){s=n;break}n=n.return}if(s==null)throw Error(i(160));switch(s.tag){case 27:var c=s.stateNode,d=uo(t);ri(t,d,c);break;case 5:var h=s.stateNode;s.flags&32&&(Vn(h,""),s.flags&=-33);var y=uo(t);ri(t,y,h);break;case 3:case 4:var H=s.stateNode.containerInfo,le=uo(t);mo(t,le,H);break;default:throw Error(i(161))}}catch(ve){qt(t,t.return,ve)}t.flags&=-3}a&4096&&(t.flags&=-4097)}function ah(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var a=t;ah(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),t=t.sibling}}function As(t,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Im(t,a.alternate,a),a=a.sibling}function An(t){for(t=t.child;t!==null;){var a=t;switch(a.tag){case 0:case 11:case 14:case 15:Ws(4,a,a.return),An(a);break;case 1:hs(a,a.return);var s=a.stateNode;typeof s.componentWillUnmount=="function"&&Ym(a,a.return,s),An(a);break;case 27:cl(a.stateNode);case 26:case 5:hs(a,a.return),An(a);break;case 22:a.memoizedState===null&&An(a);break;case 30:An(a);break;default:An(a)}t=t.sibling}}function zs(t,a,s){for(s=s&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var n=a.alternate,c=t,d=a,h=d.flags;switch(d.tag){case 0:case 11:case 15:zs(c,d,s),Wr(4,d);break;case 1:if(zs(c,d,s),n=d,c=n.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(le){qt(n,n.return,le)}if(n=d,c=n.updateQueue,c!==null){var y=n.stateNode;try{var H=c.shared.hiddenCallbacks;if(H!==null)for(c.shared.hiddenCallbacks=null,c=0;c<H.length;c++)zu(H[c],y)}catch(le){qt(n,n.return,le)}}s&&h&64&&Gm(d),Kr(d,d.return);break;case 27:Xm(d);case 26:case 5:zs(c,d,s),s&&n===null&&h&4&&Pm(d),Kr(d,d.return);break;case 12:zs(c,d,s);break;case 31:zs(c,d,s),s&&h&4&&Km(c,d);break;case 13:zs(c,d,s),s&&h&4&&eh(c,d);break;case 22:d.memoizedState===null&&zs(c,d,s),Kr(d,d.return);break;case 30:break;default:zs(c,d,s)}a=a.sibling}}function po(t,a){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(t=a.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&Hr(s))}function fo(t,a){t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&Hr(t))}function os(t,a,s,n){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)sh(t,a,s,n),a=a.sibling}function sh(t,a,s,n){var c=a.flags;switch(a.tag){case 0:case 11:case 15:os(t,a,s,n),c&2048&&Wr(9,a);break;case 1:os(t,a,s,n);break;case 3:os(t,a,s,n),c&2048&&(t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&Hr(t)));break;case 12:if(c&2048){os(t,a,s,n),t=a.stateNode;try{var d=a.memoizedProps,h=d.id,y=d.onPostCommit;typeof y=="function"&&y(h,a.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(H){qt(a,a.return,H)}}else os(t,a,s,n);break;case 31:os(t,a,s,n);break;case 13:os(t,a,s,n);break;case 23:break;case 22:d=a.stateNode,h=a.alternate,a.memoizedState!==null?d._visibility&2?os(t,a,s,n):el(t,a):d._visibility&2?os(t,a,s,n):(d._visibility|=2,or(t,a,s,n,(a.subtreeFlags&10256)!==0||!1)),c&2048&&po(h,a);break;case 24:os(t,a,s,n),c&2048&&fo(a.alternate,a);break;default:os(t,a,s,n)}}function or(t,a,s,n,c){for(c=c&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var d=t,h=a,y=s,H=n,le=h.flags;switch(h.tag){case 0:case 11:case 15:or(d,h,y,H,c),Wr(8,h);break;case 23:break;case 22:var ve=h.stateNode;h.memoizedState!==null?ve._visibility&2?or(d,h,y,H,c):el(d,h):(ve._visibility|=2,or(d,h,y,H,c)),c&&le&2048&&po(h.alternate,h);break;case 24:or(d,h,y,H,c),c&&le&2048&&fo(h.alternate,h);break;default:or(d,h,y,H,c)}a=a.sibling}}function el(t,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var s=t,n=a,c=n.flags;switch(n.tag){case 22:el(s,n),c&2048&&po(n.alternate,n);break;case 24:el(s,n),c&2048&&fo(n.alternate,n);break;default:el(s,n)}a=a.sibling}}var tl=8192;function dr(t,a,s){if(t.subtreeFlags&tl)for(t=t.child;t!==null;)nh(t,a,s),t=t.sibling}function nh(t,a,s){switch(t.tag){case 26:dr(t,a,s),t.flags&tl&&t.memoizedState!==null&&xx(s,cs,t.memoizedState,t.memoizedProps);break;case 5:dr(t,a,s);break;case 3:case 4:var n=cs;cs=yi(t.stateNode.containerInfo),dr(t,a,s),cs=n;break;case 22:t.memoizedState===null&&(n=t.alternate,n!==null&&n.memoizedState!==null?(n=tl,tl=16777216,dr(t,a,s),tl=n):dr(t,a,s));break;default:dr(t,a,s)}}function rh(t){var a=t.alternate;if(a!==null&&(t=a.child,t!==null)){a.child=null;do a=t.sibling,t.sibling=null,t=a;while(t!==null)}}function al(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];xa=n,ih(n,t)}rh(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)lh(t),t=t.sibling}function lh(t){switch(t.tag){case 0:case 11:case 15:al(t),t.flags&2048&&Ws(9,t,t.return);break;case 3:al(t);break;case 12:al(t);break;case 22:var a=t.stateNode;t.memoizedState!==null&&a._visibility&2&&(t.return===null||t.return.tag!==13)?(a._visibility&=-3,ii(t)):al(t);break;default:al(t)}}function ii(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];xa=n,ih(n,t)}rh(t)}for(t=t.child;t!==null;){switch(a=t,a.tag){case 0:case 11:case 15:Ws(8,a,a.return),ii(a);break;case 22:s=a.stateNode,s._visibility&2&&(s._visibility&=-3,ii(a));break;default:ii(a)}t=t.sibling}}function ih(t,a){for(;xa!==null;){var s=xa;switch(s.tag){case 0:case 11:case 15:Ws(8,s,a);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var n=s.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:Hr(s.memoizedState.cache)}if(n=s.child,n!==null)n.return=s,xa=n;else e:for(s=t;xa!==null;){n=xa;var c=n.sibling,d=n.return;if(Jm(n),n===s){xa=null;break e}if(c!==null){c.return=d,xa=c;break e}xa=d}}}var Ag={getCacheForType:function(t){var a=Na(ca),s=a.data.get(t);return s===void 0&&(s=t(),a.data.set(t,s)),s},cacheSignal:function(){return Na(ca).controller.signal}},zg=typeof WeakMap=="function"?WeakMap:Map,zt=0,Ft=null,xt=null,bt=0,Rt=0,$a=null,Ks=!1,ur=!1,go=!1,Os=0,Kt=0,en=0,zn=0,xo=0,Va=0,mr=0,sl=null,qa=null,jo=!1,ci=0,ch=0,oi=1/0,di=null,tn=null,ga=0,an=null,hr=null,Rs=0,vo=0,yo=null,oh=null,nl=0,bo=null;function Ga(){return(zt&2)!==0&&bt!==0?bt&-bt:N.T!==null?ko():ht()}function dh(){if(Va===0)if((bt&536870912)===0||St){var t=Lt;Lt<<=1,(Lt&3932160)===0&&(Lt=262144),Va=t}else Va=536870912;return t=Ba.current,t!==null&&(t.flags|=32),Va}function La(t,a,s){(t===Ft&&(Rt===2||Rt===9)||t.cancelPendingCommit!==null)&&(pr(t,0),sn(t,bt,Va,!1)),ft(t,s),((zt&2)===0||t!==Ft)&&(t===Ft&&((zt&2)===0&&(zn|=s),Kt===4&&sn(t,bt,Va,!1)),ps(t))}function uh(t,a,s){if((zt&6)!==0)throw Error(i(327));var n=!s&&(a&127)===0&&(a&t.expiredLanes)===0||It(t,a),c=n?qg(t,a):No(t,a,!0),d=n;do{if(c===0){ur&&!n&&sn(t,a,0,!1);break}else{if(s=t.current.alternate,d&&!Og(s)){c=No(t,a,!1),d=!1;continue}if(c===2){if(d=a,t.errorRecoveryDisabledLanes&d)var h=0;else h=t.pendingLanes&-536870913,h=h!==0?h:h&536870912?536870912:0;if(h!==0){a=h;e:{var y=t;c=sl;var H=y.current.memoizedState.isDehydrated;if(H&&(pr(y,h).flags|=256),h=No(y,h,!1),h!==2){if(go&&!H){y.errorRecoveryDisabledLanes|=d,zn|=d,c=4;break e}d=qa,qa=c,d!==null&&(qa===null?qa=d:qa.push.apply(qa,d))}c=h}if(d=!1,c!==2)continue}}if(c===1){pr(t,0),sn(t,a,0,!0);break}e:{switch(n=t,d=c,d){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:sn(n,a,Va,!Ks);break e;case 2:qa=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(c=ci+300-Ze(),10<c)){if(sn(n,a,Va,!Ks),$t(n,0,!0)!==0)break e;Rs=a,n.timeoutHandle=$h(mh.bind(null,n,s,qa,di,jo,a,Va,zn,mr,Ks,d,"Throttled",-0,0),c);break e}mh(n,s,qa,di,jo,a,Va,zn,mr,Ks,d,null,-0,0)}}break}while(!0);ps(t)}function mh(t,a,s,n,c,d,h,y,H,le,ve,_e,ce,fe){if(t.timeoutHandle=-1,_e=a.subtreeFlags,_e&8192||(_e&16785408)===16785408){_e={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ys},nh(a,d,_e);var Ge=(d&62914560)===d?ci-Ze():(d&4194048)===d?ch-Ze():0;if(Ge=jx(_e,Ge),Ge!==null){Rs=d,t.cancelPendingCommit=Ge(yh.bind(null,t,a,d,s,n,c,h,y,H,ve,_e,null,ce,fe)),sn(t,d,h,!le);return}}yh(t,a,d,s,n,c,h,y,H)}function Og(t){for(var a=t;;){var s=a.tag;if((s===0||s===11||s===15)&&a.flags&16384&&(s=a.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var n=0;n<s.length;n++){var c=s[n],d=c.getSnapshot;c=c.value;try{if(!Ua(d(),c))return!1}catch{return!1}}if(s=a.child,a.subtreeFlags&16384&&s!==null)s.return=a,a=s;else{if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function sn(t,a,s,n){a&=~xo,a&=~zn,t.suspendedLanes|=a,t.pingedLanes&=~a,n&&(t.warmLanes|=a),n=t.expirationTimes;for(var c=a;0<c;){var d=31-ne(c),h=1<<d;n[d]=-1,c&=~h}s!==0&&w(t,s,a)}function ui(){return(zt&6)===0?(rl(0),!1):!0}function _o(){if(xt!==null){if(Rt===0)var t=xt.return;else t=xt,Ss=Sn=null,Lc(t),nr=null,Fr=0,t=xt;for(;t!==null;)Vm(t.alternate,t),t=t.return;xt=null}}function pr(t,a){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,ex(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),Rs=0,_o(),Ft=t,xt=s=_s(t.current,null),bt=a,Rt=0,$a=null,Ks=!1,ur=It(t,a),go=!1,mr=Va=xo=zn=en=Kt=0,qa=sl=null,jo=!1,(a&8)!==0&&(a|=a&32);var n=t.entangledLanes;if(n!==0)for(t=t.entanglements,n&=a;0<n;){var c=31-ne(n),d=1<<c;a|=t[c],n&=~d}return Os=a,Al(),s}function hh(t,a){dt=null,N.H=Zr,a===sr||a===Bl?(a=Du(),Rt=3):a===Cc?(a=Du(),Rt=4):Rt=a===Kc?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,$a=a,xt===null&&(Kt=1,ei(t,Za(a,t.current)))}function ph(){var t=Ba.current;return t===null?!0:(bt&4194048)===bt?Ka===null:(bt&62914560)===bt||(bt&536870912)!==0?t===Ka:!1}function fh(){var t=N.H;return N.H=Zr,t===null?Zr:t}function gh(){var t=N.A;return N.A=Ag,t}function mi(){Kt=4,Ks||(bt&4194048)!==bt&&Ba.current!==null||(ur=!0),(en&134217727)===0&&(zn&134217727)===0||Ft===null||sn(Ft,bt,Va,!1)}function No(t,a,s){var n=zt;zt|=2;var c=fh(),d=gh();(Ft!==t||bt!==a)&&(di=null,pr(t,a)),a=!1;var h=Kt;e:do try{if(Rt!==0&&xt!==null){var y=xt,H=$a;switch(Rt){case 8:_o(),h=6;break e;case 3:case 2:case 9:case 6:Ba.current===null&&(a=!0);var le=Rt;if(Rt=0,$a=null,fr(t,y,H,le),s&&ur){h=0;break e}break;default:le=Rt,Rt=0,$a=null,fr(t,y,H,le)}}Rg(),h=Kt;break}catch(ve){hh(t,ve)}while(!0);return a&&t.shellSuspendCounter++,Ss=Sn=null,zt=n,N.H=c,N.A=d,xt===null&&(Ft=null,bt=0,Al()),h}function Rg(){for(;xt!==null;)xh(xt)}function qg(t,a){var s=zt;zt|=2;var n=fh(),c=gh();Ft!==t||bt!==a?(di=null,oi=Ze()+500,pr(t,a)):ur=It(t,a);e:do try{if(Rt!==0&&xt!==null){a=xt;var d=$a;t:switch(Rt){case 1:Rt=0,$a=null,fr(t,a,d,1);break;case 2:case 9:if(ku(d)){Rt=0,$a=null,jh(a);break}a=function(){Rt!==2&&Rt!==9||Ft!==t||(Rt=7),ps(t)},d.then(a,a);break e;case 3:Rt=7;break e;case 4:Rt=5;break e;case 7:ku(d)?(Rt=0,$a=null,jh(a)):(Rt=0,$a=null,fr(t,a,d,7));break;case 5:var h=null;switch(xt.tag){case 26:h=xt.memoizedState;case 5:case 27:var y=xt;if(h?sp(h):y.stateNode.complete){Rt=0,$a=null;var H=y.sibling;if(H!==null)xt=H;else{var le=y.return;le!==null?(xt=le,hi(le)):xt=null}break t}}Rt=0,$a=null,fr(t,a,d,5);break;case 6:Rt=0,$a=null,fr(t,a,d,6);break;case 8:_o(),Kt=6;break e;default:throw Error(i(462))}}Lg();break}catch(ve){hh(t,ve)}while(!0);return Ss=Sn=null,N.H=n,N.A=c,zt=s,xt!==null?0:(Ft=null,bt=0,Al(),Kt)}function Lg(){for(;xt!==null&&!Xe();)xh(xt)}function xh(t){var a=Fm(t.alternate,t,Os);t.memoizedProps=t.pendingProps,a===null?hi(t):xt=a}function jh(t){var a=t,s=a.alternate;switch(a.tag){case 15:case 0:a=Rm(s,a,a.pendingProps,a.type,void 0,bt);break;case 11:a=Rm(s,a,a.pendingProps,a.type.render,a.ref,bt);break;case 5:Lc(a);default:Vm(s,a),a=xt=gu(a,Os),a=Fm(s,a,Os)}t.memoizedProps=t.pendingProps,a===null?hi(t):xt=a}function fr(t,a,s,n){Ss=Sn=null,Lc(a),nr=null,Fr=0;var c=a.return;try{if(Cg(t,c,a,s,bt)){Kt=1,ei(t,Za(s,t.current)),xt=null;return}}catch(d){if(c!==null)throw xt=c,d;Kt=1,ei(t,Za(s,t.current)),xt=null;return}a.flags&32768?(St||n===1?t=!0:ur||(bt&536870912)!==0?t=!1:(Ks=t=!0,(n===2||n===9||n===3||n===6)&&(n=Ba.current,n!==null&&n.tag===13&&(n.flags|=16384))),vh(a,t)):hi(a)}function hi(t){var a=t;do{if((a.flags&32768)!==0){vh(a,Ks);return}t=a.return;var s=Eg(a.alternate,a,Os);if(s!==null){xt=s;return}if(a=a.sibling,a!==null){xt=a;return}xt=a=t}while(a!==null);Kt===0&&(Kt=5)}function vh(t,a){do{var s=Dg(t.alternate,t);if(s!==null){s.flags&=32767,xt=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!a&&(t=t.sibling,t!==null)){xt=t;return}xt=t=s}while(t!==null);Kt=6,xt=null}function yh(t,a,s,n,c,d,h,y,H){t.cancelPendingCommit=null;do pi();while(ga!==0);if((zt&6)!==0)throw Error(i(327));if(a!==null){if(a===t.current)throw Error(i(177));if(d=a.lanes|a.childLanes,d|=dc,ja(t,s,d,h,y,H),t===Ft&&(xt=Ft=null,bt=0),hr=a,an=t,Rs=s,vo=d,yo=c,oh=n,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,Fg(Zt,function(){return Ch(),null})):(t.callbackNode=null,t.callbackPriority=0),n=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||n){n=N.T,N.T=null,c=se.p,se.p=2,h=zt,zt|=4;try{Mg(t,a,s)}finally{zt=h,se.p=c,N.T=n}}ga=1,bh(),_h(),Nh()}}function bh(){if(ga===1){ga=0;var t=an,a=hr,s=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||s){s=N.T,N.T=null;var n=se.p;se.p=2;var c=zt;zt|=4;try{th(a,t);var d=Ro,h=iu(t.containerInfo),y=d.focusedElem,H=d.selectionRange;if(h!==y&&y&&y.ownerDocument&&lu(y.ownerDocument.documentElement,y)){if(H!==null&&rc(y)){var le=H.start,ve=H.end;if(ve===void 0&&(ve=le),"selectionStart"in y)y.selectionStart=le,y.selectionEnd=Math.min(ve,y.value.length);else{var _e=y.ownerDocument||document,ce=_e&&_e.defaultView||window;if(ce.getSelection){var fe=ce.getSelection(),Ge=y.textContent.length,et=Math.min(H.start,Ge),Bt=H.end===void 0?et:Math.min(H.end,Ge);!fe.extend&&et>Bt&&(h=Bt,Bt=et,et=h);var W=ru(y,et),Q=ru(y,Bt);if(W&&Q&&(fe.rangeCount!==1||fe.anchorNode!==W.node||fe.anchorOffset!==W.offset||fe.focusNode!==Q.node||fe.focusOffset!==Q.offset)){var re=_e.createRange();re.setStart(W.node,W.offset),fe.removeAllRanges(),et>Bt?(fe.addRange(re),fe.extend(Q.node,Q.offset)):(re.setEnd(Q.node,Q.offset),fe.addRange(re))}}}}for(_e=[],fe=y;fe=fe.parentNode;)fe.nodeType===1&&_e.push({element:fe,left:fe.scrollLeft,top:fe.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<_e.length;y++){var ye=_e[y];ye.element.scrollLeft=ye.left,ye.element.scrollTop=ye.top}}wi=!!Oo,Ro=Oo=null}finally{zt=c,se.p=n,N.T=s}}t.current=a,ga=2}}function _h(){if(ga===2){ga=0;var t=an,a=hr,s=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||s){s=N.T,N.T=null;var n=se.p;se.p=2;var c=zt;zt|=4;try{Im(t,a.alternate,a)}finally{zt=c,se.p=n,N.T=s}}ga=3}}function Nh(){if(ga===4||ga===3){ga=0,Ye();var t=an,a=hr,s=Rs,n=oh;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?ga=5:(ga=0,hr=an=null,Sh(t,t.pendingLanes));var c=t.pendingLanes;if(c===0&&(tn=null),lt(s),a=a.stateNode,be&&typeof be.onCommitFiberRoot=="function")try{be.onCommitFiberRoot(O,a,void 0,(a.current.flags&128)===128)}catch{}if(n!==null){a=N.T,c=se.p,se.p=2,N.T=null;try{for(var d=t.onRecoverableError,h=0;h<n.length;h++){var y=n[h];d(y.value,{componentStack:y.stack})}}finally{N.T=a,se.p=c}}(Rs&3)!==0&&pi(),ps(t),c=t.pendingLanes,(s&261930)!==0&&(c&42)!==0?t===bo?nl++:(nl=0,bo=t):nl=0,rl(0)}}function Sh(t,a){(t.pooledCacheLanes&=a)===0&&(a=t.pooledCache,a!=null&&(t.pooledCache=null,Hr(a)))}function pi(){return bh(),_h(),Nh(),Ch()}function Ch(){if(ga!==5)return!1;var t=an,a=vo;vo=0;var s=lt(Rs),n=N.T,c=se.p;try{se.p=32>s?32:s,N.T=null,s=yo,yo=null;var d=an,h=Rs;if(ga=0,hr=an=null,Rs=0,(zt&6)!==0)throw Error(i(331));var y=zt;if(zt|=4,lh(d.current),sh(d,d.current,h,s),zt=y,rl(0,!1),be&&typeof be.onPostCommitFiberRoot=="function")try{be.onPostCommitFiberRoot(O,d)}catch{}return!0}finally{se.p=c,N.T=n,Sh(t,a)}}function wh(t,a,s){a=Za(s,a),a=Wc(t.stateNode,a,2),t=Zs(t,a,2),t!==null&&(ft(t,2),ps(t))}function qt(t,a,s){if(t.tag===3)wh(t,t,s);else for(;a!==null;){if(a.tag===3){wh(a,t,s);break}else if(a.tag===1){var n=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(tn===null||!tn.has(n))){t=Za(s,t),s=km(2),n=Zs(a,s,2),n!==null&&(Em(s,n,a,t),ft(n,2),ps(n));break}}a=a.return}}function So(t,a,s){var n=t.pingCache;if(n===null){n=t.pingCache=new zg;var c=new Set;n.set(a,c)}else c=n.get(a),c===void 0&&(c=new Set,n.set(a,c));c.has(s)||(go=!0,c.add(s),t=Ug.bind(null,t,a,s),a.then(t,t))}function Ug(t,a,s){var n=t.pingCache;n!==null&&n.delete(a),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,Ft===t&&(bt&s)===s&&(Kt===4||Kt===3&&(bt&62914560)===bt&&300>Ze()-ci?(zt&2)===0&&pr(t,0):xo|=s,mr===bt&&(mr=0)),ps(t)}function kh(t,a){a===0&&(a=Ne()),t=bn(t,a),t!==null&&(ft(t,a),ps(t))}function Hg(t){var a=t.memoizedState,s=0;a!==null&&(s=a.retryLane),kh(t,s)}function Bg(t,a){var s=0;switch(t.tag){case 31:case 13:var n=t.stateNode,c=t.memoizedState;c!==null&&(s=c.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(i(314))}n!==null&&n.delete(a),kh(t,s)}function Fg(t,a){return qe(t,a)}var fi=null,gr=null,Co=!1,gi=!1,wo=!1,nn=0;function ps(t){t!==gr&&t.next===null&&(gr===null?fi=gr=t:gr=gr.next=t),gi=!0,Co||(Co=!0,Vg())}function rl(t,a){if(!wo&&gi){wo=!0;do for(var s=!1,n=fi;n!==null;){if(t!==0){var c=n.pendingLanes;if(c===0)var d=0;else{var h=n.suspendedLanes,y=n.pingedLanes;d=(1<<31-ne(42|t)+1)-1,d&=c&~(h&~y),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(s=!0,Th(n,d))}else d=bt,d=$t(n,n===Ft?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(d&3)===0||It(n,d)||(s=!0,Th(n,d));n=n.next}while(s);wo=!1}}function $g(){Eh()}function Eh(){gi=Co=!1;var t=0;nn!==0&&Kg()&&(t=nn);for(var a=Ze(),s=null,n=fi;n!==null;){var c=n.next,d=Dh(n,a);d===0?(n.next=null,s===null?fi=c:s.next=c,c===null&&(gr=s)):(s=n,(t!==0||(d&3)!==0)&&(gi=!0)),n=c}ga!==0&&ga!==5||rl(t),nn!==0&&(nn=0)}function Dh(t,a){for(var s=t.suspendedLanes,n=t.pingedLanes,c=t.expirationTimes,d=t.pendingLanes&-62914561;0<d;){var h=31-ne(d),y=1<<h,H=c[h];H===-1?((y&s)===0||(y&n)!==0)&&(c[h]=la(y,a)):H<=a&&(t.expiredLanes|=y),d&=~y}if(a=Ft,s=bt,s=$t(t,t===a?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n=t.callbackNode,s===0||t===a&&(Rt===2||Rt===9)||t.cancelPendingCommit!==null)return n!==null&&n!==null&&$e(n),t.callbackNode=null,t.callbackPriority=0;if((s&3)===0||It(t,s)){if(a=s&-s,a===t.callbackPriority)return a;switch(n!==null&&$e(n),lt(s)){case 2:case 8:s=wt;break;case 32:s=Zt;break;case 268435456:s=Nt;break;default:s=Zt}return n=Mh.bind(null,t),s=qe(s,n),t.callbackPriority=a,t.callbackNode=s,a}return n!==null&&n!==null&&$e(n),t.callbackPriority=2,t.callbackNode=null,2}function Mh(t,a){if(ga!==0&&ga!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(pi()&&t.callbackNode!==s)return null;var n=bt;return n=$t(t,t===Ft?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n===0?null:(uh(t,n,a),Dh(t,Ze()),t.callbackNode!=null&&t.callbackNode===s?Mh.bind(null,t):null)}function Th(t,a){if(pi())return null;uh(t,a,!0)}function Vg(){tx(function(){(zt&6)!==0?qe(vt,$g):Eh()})}function ko(){if(nn===0){var t=tr;t===0&&(t=Qt,Qt<<=1,(Qt&261888)===0&&(Qt=256)),nn=t}return nn}function Ah(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Sl(""+t)}function zh(t,a){var s=a.ownerDocument.createElement("input");return s.name=a.name,s.value=a.value,t.id&&s.setAttribute("form",t.id),a.parentNode.insertBefore(s,a),t=new FormData(t),s.parentNode.removeChild(s),t}function Gg(t,a,s,n,c){if(a==="submit"&&s&&s.stateNode===c){var d=Ah((c[rt]||null).action),h=n.submitter;h&&(a=(a=h[rt]||null)?Ah(a.formAction):h.getAttribute("formAction"),a!==null&&(d=a,h=null));var y=new El("action","action",null,n,c);t.push({event:y,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(nn!==0){var H=h?zh(c,h):new FormData(c);Pc(s,{pending:!0,data:H,method:c.method,action:d},null,H)}}else typeof d=="function"&&(y.preventDefault(),H=h?zh(c,h):new FormData(c),Pc(s,{pending:!0,data:H,method:c.method,action:d},d,H))},currentTarget:c}]})}}for(var Eo=0;Eo<oc.length;Eo++){var Do=oc[Eo],Yg=Do.toLowerCase(),Pg=Do[0].toUpperCase()+Do.slice(1);is(Yg,"on"+Pg)}is(du,"onAnimationEnd"),is(uu,"onAnimationIteration"),is(mu,"onAnimationStart"),is("dblclick","onDoubleClick"),is("focusin","onFocus"),is("focusout","onBlur"),is(cg,"onTransitionRun"),is(og,"onTransitionStart"),is(dg,"onTransitionCancel"),is(hu,"onTransitionEnd"),_("onMouseEnter",["mouseout","mouseover"]),_("onMouseLeave",["mouseout","mouseover"]),_("onPointerEnter",["pointerout","pointerover"]),_("onPointerLeave",["pointerout","pointerover"]),fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fa("onBeforeInput",["compositionend","keypress","textInput","paste"]),fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ll="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ll));function Oh(t,a){a=(a&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],c=n.event;n=n.listeners;e:{var d=void 0;if(a)for(var h=n.length-1;0<=h;h--){var y=n[h],H=y.instance,le=y.currentTarget;if(y=y.listener,H!==d&&c.isPropagationStopped())break e;d=y,c.currentTarget=le;try{d(c)}catch(ve){Tl(ve)}c.currentTarget=null,d=H}else for(h=0;h<n.length;h++){if(y=n[h],H=y.instance,le=y.currentTarget,y=y.listener,H!==d&&c.isPropagationStopped())break e;d=y,c.currentTarget=le;try{d(c)}catch(ve){Tl(ve)}c.currentTarget=null,d=H}}}}function jt(t,a){var s=a[va];s===void 0&&(s=a[va]=new Set);var n=t+"__bubble";s.has(n)||(Rh(a,t,2,!1),s.add(n))}function Mo(t,a,s){var n=0;a&&(n|=4),Rh(s,t,n,a)}var xi="_reactListening"+Math.random().toString(36).slice(2);function To(t){if(!t[xi]){t[xi]=!0,pa.forEach(function(s){s!=="selectionchange"&&(Qg.has(s)||Mo(s,!1,t),Mo(s,!0,t))});var a=t.nodeType===9?t:t.ownerDocument;a===null||a[xi]||(a[xi]=!0,Mo("selectionchange",!1,a))}}function Rh(t,a,s,n){switch(dp(a)){case 2:var c=bx;break;case 8:c=_x;break;default:c=Po}s=c.bind(null,a,s,t),c=void 0,!Ii||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(c=!0),n?c!==void 0?t.addEventListener(a,s,{capture:!0,passive:c}):t.addEventListener(a,s,!0):c!==void 0?t.addEventListener(a,s,{passive:c}):t.addEventListener(a,s,!1)}function Ao(t,a,s,n,c){var d=n;if((a&1)===0&&(a&2)===0&&n!==null)e:for(;;){if(n===null)return;var h=n.tag;if(h===3||h===4){var y=n.stateNode.containerInfo;if(y===c)break;if(h===4)for(h=n.return;h!==null;){var H=h.tag;if((H===3||H===4)&&h.stateNode.containerInfo===c)return;h=h.return}for(;y!==null;){if(h=ya(y),h===null)return;if(H=h.tag,H===5||H===6||H===26||H===27){n=d=h;continue e}y=y.parentNode}}n=n.return}Bd(function(){var le=d,ve=Xi(s),_e=[];e:{var ce=pu.get(t);if(ce!==void 0){var fe=El,Ge=t;switch(t){case"keypress":if(wl(s)===0)break e;case"keydown":case"keyup":fe=Bf;break;case"focusin":Ge="focus",fe=ec;break;case"focusout":Ge="blur",fe=ec;break;case"beforeblur":case"afterblur":fe=ec;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":fe=Vd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":fe=Ef;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":fe=Vf;break;case du:case uu:case mu:fe=Tf;break;case hu:fe=Yf;break;case"scroll":case"scrollend":fe=wf;break;case"wheel":fe=Qf;break;case"copy":case"cut":case"paste":fe=zf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":fe=Yd;break;case"toggle":case"beforetoggle":fe=Zf}var et=(a&4)!==0,Bt=!et&&(t==="scroll"||t==="scrollend"),W=et?ce!==null?ce+"Capture":null:ce;et=[];for(var Q=le,re;Q!==null;){var ye=Q;if(re=ye.stateNode,ye=ye.tag,ye!==5&&ye!==26&&ye!==27||re===null||W===null||(ye=Er(Q,W),ye!=null&&et.push(il(Q,ye,re))),Bt)break;Q=Q.return}0<et.length&&(ce=new fe(ce,Ge,null,s,ve),_e.push({event:ce,listeners:et}))}}if((a&7)===0){e:{if(ce=t==="mouseover"||t==="pointerover",fe=t==="mouseout"||t==="pointerout",ce&&s!==Qi&&(Ge=s.relatedTarget||s.fromElement)&&(ya(Ge)||Ge[ha]))break e;if((fe||ce)&&(ce=ve.window===ve?ve:(ce=ve.ownerDocument)?ce.defaultView||ce.parentWindow:window,fe?(Ge=s.relatedTarget||s.toElement,fe=le,Ge=Ge?ya(Ge):null,Ge!==null&&(Bt=u(Ge),et=Ge.tag,Ge!==Bt||et!==5&&et!==27&&et!==6)&&(Ge=null)):(fe=null,Ge=le),fe!==Ge)){if(et=Vd,ye="onMouseLeave",W="onMouseEnter",Q="mouse",(t==="pointerout"||t==="pointerover")&&(et=Yd,ye="onPointerLeave",W="onPointerEnter",Q="pointer"),Bt=fe==null?ce:Je(fe),re=Ge==null?ce:Je(Ge),ce=new et(ye,Q+"leave",fe,s,ve),ce.target=Bt,ce.relatedTarget=re,ye=null,ya(ve)===le&&(et=new et(W,Q+"enter",Ge,s,ve),et.target=re,et.relatedTarget=Bt,ye=et),Bt=ye,fe&&Ge)t:{for(et=Xg,W=fe,Q=Ge,re=0,ye=W;ye;ye=et(ye))re++;ye=0;for(var Ie=Q;Ie;Ie=et(Ie))ye++;for(;0<re-ye;)W=et(W),re--;for(;0<ye-re;)Q=et(Q),ye--;for(;re--;){if(W===Q||Q!==null&&W===Q.alternate){et=W;break t}W=et(W),Q=et(Q)}et=null}else et=null;fe!==null&&qh(_e,ce,fe,et,!1),Ge!==null&&Bt!==null&&qh(_e,Bt,Ge,et,!0)}}e:{if(ce=le?Je(le):window,fe=ce.nodeName&&ce.nodeName.toLowerCase(),fe==="select"||fe==="input"&&ce.type==="file")var Tt=Kd;else if(Jd(ce))if(eu)Tt=rg;else{Tt=sg;var Pe=ag}else fe=ce.nodeName,!fe||fe.toLowerCase()!=="input"||ce.type!=="checkbox"&&ce.type!=="radio"?le&&Pi(le.elementType)&&(Tt=Kd):Tt=ng;if(Tt&&(Tt=Tt(t,le))){Wd(_e,Tt,s,ve);break e}Pe&&Pe(t,ce,le),t==="focusout"&&le&&ce.type==="number"&&le.memoizedProps.value!=null&&Yi(ce,"number",ce.value)}switch(Pe=le?Je(le):window,t){case"focusin":(Jd(Pe)||Pe.contentEditable==="true")&&(Qn=Pe,lc=le,qr=null);break;case"focusout":qr=lc=Qn=null;break;case"mousedown":ic=!0;break;case"contextmenu":case"mouseup":case"dragend":ic=!1,cu(_e,s,ve);break;case"selectionchange":if(ig)break;case"keydown":case"keyup":cu(_e,s,ve)}var mt;if(ac)e:{switch(t){case"compositionstart":var _t="onCompositionStart";break e;case"compositionend":_t="onCompositionEnd";break e;case"compositionupdate":_t="onCompositionUpdate";break e}_t=void 0}else Pn?Zd(t,s)&&(_t="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(_t="onCompositionStart");_t&&(Pd&&s.locale!=="ko"&&(Pn||_t!=="onCompositionStart"?_t==="onCompositionEnd"&&Pn&&(mt=Fd()):($s=ve,Ji="value"in $s?$s.value:$s.textContent,Pn=!0)),Pe=ji(le,_t),0<Pe.length&&(_t=new Gd(_t,t,null,s,ve),_e.push({event:_t,listeners:Pe}),mt?_t.data=mt:(mt=Id(s),mt!==null&&(_t.data=mt)))),(mt=Jf?Wf(t,s):Kf(t,s))&&(_t=ji(le,"onBeforeInput"),0<_t.length&&(Pe=new Gd("onBeforeInput","beforeinput",null,s,ve),_e.push({event:Pe,listeners:_t}),Pe.data=mt)),Gg(_e,t,le,s,ve)}Oh(_e,a)})}function il(t,a,s){return{instance:t,listener:a,currentTarget:s}}function ji(t,a){for(var s=a+"Capture",n=[];t!==null;){var c=t,d=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||d===null||(c=Er(t,s),c!=null&&n.unshift(il(t,c,d)),c=Er(t,a),c!=null&&n.push(il(t,c,d))),t.tag===3)return n;t=t.return}return[]}function Xg(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function qh(t,a,s,n,c){for(var d=a._reactName,h=[];s!==null&&s!==n;){var y=s,H=y.alternate,le=y.stateNode;if(y=y.tag,H!==null&&H===n)break;y!==5&&y!==26&&y!==27||le===null||(H=le,c?(le=Er(s,d),le!=null&&h.unshift(il(s,le,H))):c||(le=Er(s,d),le!=null&&h.push(il(s,le,H)))),s=s.return}h.length!==0&&t.push({event:a,listeners:h})}var Zg=/\r\n?/g,Ig=/\u0000|\uFFFD/g;function Lh(t){return(typeof t=="string"?t:""+t).replace(Zg,`
`).replace(Ig,"")}function Uh(t,a){return a=Lh(a),Lh(t)===a}function Ht(t,a,s,n,c,d){switch(s){case"children":typeof n=="string"?a==="body"||a==="textarea"&&n===""||Vn(t,n):(typeof n=="number"||typeof n=="bigint")&&a!=="body"&&Vn(t,""+n);break;case"className":He(t,"class",n);break;case"tabIndex":He(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":He(t,s,n);break;case"style":Ud(t,n,d);break;case"data":if(a!=="object"){He(t,"data",n);break}case"src":case"href":if(n===""&&(a!=="a"||s!=="href")){t.removeAttribute(s);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=Sl(""+n),t.setAttribute(s,n);break;case"action":case"formAction":if(typeof n=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(s==="formAction"?(a!=="input"&&Ht(t,a,"name",c.name,c,null),Ht(t,a,"formEncType",c.formEncType,c,null),Ht(t,a,"formMethod",c.formMethod,c,null),Ht(t,a,"formTarget",c.formTarget,c,null)):(Ht(t,a,"encType",c.encType,c,null),Ht(t,a,"method",c.method,c,null),Ht(t,a,"target",c.target,c,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=Sl(""+n),t.setAttribute(s,n);break;case"onClick":n!=null&&(t.onclick=ys);break;case"onScroll":n!=null&&jt("scroll",t);break;case"onScrollEnd":n!=null&&jt("scrollend",t);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(s=n.__html,s!=null){if(c.children!=null)throw Error(i(60));t.innerHTML=s}}break;case"multiple":t.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":t.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){t.removeAttribute("xlink:href");break}s=Sl(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""+n):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":n===!0?t.setAttribute(s,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,n):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?t.setAttribute(s,n):t.removeAttribute(s);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?t.removeAttribute(s):t.setAttribute(s,n);break;case"popover":jt("beforetoggle",t),jt("toggle",t),ct(t,"popover",n);break;case"xlinkActuate":ut(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":ut(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":ut(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":ut(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":ut(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":ut(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":ut(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":ut(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":ut(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":ct(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=Sf.get(s)||s,ct(t,s,n))}}function zo(t,a,s,n,c,d){switch(s){case"style":Ud(t,n,d);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(s=n.__html,s!=null){if(c.children!=null)throw Error(i(60));t.innerHTML=s}}break;case"children":typeof n=="string"?Vn(t,n):(typeof n=="number"||typeof n=="bigint")&&Vn(t,""+n);break;case"onScroll":n!=null&&jt("scroll",t);break;case"onScrollEnd":n!=null&&jt("scrollend",t);break;case"onClick":n!=null&&(t.onclick=ys);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ba.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(c=s.endsWith("Capture"),a=s.slice(2,c?s.length-7:void 0),d=t[rt]||null,d=d!=null?d[s]:null,typeof d=="function"&&t.removeEventListener(a,d,c),typeof n=="function")){typeof d!="function"&&d!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(a,n,c);break e}s in t?t[s]=n:n===!0?t.setAttribute(s,""):ct(t,s,n)}}}function Ca(t,a,s){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":jt("error",t),jt("load",t);var n=!1,c=!1,d;for(d in s)if(s.hasOwnProperty(d)){var h=s[d];if(h!=null)switch(d){case"src":n=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Ht(t,a,d,h,s,null)}}c&&Ht(t,a,"srcSet",s.srcSet,s,null),n&&Ht(t,a,"src",s.src,s,null);return;case"input":jt("invalid",t);var y=d=h=c=null,H=null,le=null;for(n in s)if(s.hasOwnProperty(n)){var ve=s[n];if(ve!=null)switch(n){case"name":c=ve;break;case"type":h=ve;break;case"checked":H=ve;break;case"defaultChecked":le=ve;break;case"value":d=ve;break;case"defaultValue":y=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(i(137,a));break;default:Ht(t,a,n,ve,s,null)}}Od(t,d,y,H,le,h,c,!1);return;case"select":jt("invalid",t),n=h=d=null;for(c in s)if(s.hasOwnProperty(c)&&(y=s[c],y!=null))switch(c){case"value":d=y;break;case"defaultValue":h=y;break;case"multiple":n=y;default:Ht(t,a,c,y,s,null)}a=d,s=h,t.multiple=!!n,a!=null?$n(t,!!n,a,!1):s!=null&&$n(t,!!n,s,!0);return;case"textarea":jt("invalid",t),d=c=n=null;for(h in s)if(s.hasOwnProperty(h)&&(y=s[h],y!=null))switch(h){case"value":n=y;break;case"defaultValue":c=y;break;case"children":d=y;break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(i(91));break;default:Ht(t,a,h,y,s,null)}qd(t,n,c,d);return;case"option":for(H in s)if(s.hasOwnProperty(H)&&(n=s[H],n!=null))switch(H){case"selected":t.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:Ht(t,a,H,n,s,null)}return;case"dialog":jt("beforetoggle",t),jt("toggle",t),jt("cancel",t),jt("close",t);break;case"iframe":case"object":jt("load",t);break;case"video":case"audio":for(n=0;n<ll.length;n++)jt(ll[n],t);break;case"image":jt("error",t),jt("load",t);break;case"details":jt("toggle",t);break;case"embed":case"source":case"link":jt("error",t),jt("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(le in s)if(s.hasOwnProperty(le)&&(n=s[le],n!=null))switch(le){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Ht(t,a,le,n,s,null)}return;default:if(Pi(a)){for(ve in s)s.hasOwnProperty(ve)&&(n=s[ve],n!==void 0&&zo(t,a,ve,n,s,void 0));return}}for(y in s)s.hasOwnProperty(y)&&(n=s[y],n!=null&&Ht(t,a,y,n,s,null))}function Jg(t,a,s,n){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,d=null,h=null,y=null,H=null,le=null,ve=null;for(fe in s){var _e=s[fe];if(s.hasOwnProperty(fe)&&_e!=null)switch(fe){case"checked":break;case"value":break;case"defaultValue":H=_e;default:n.hasOwnProperty(fe)||Ht(t,a,fe,null,n,_e)}}for(var ce in n){var fe=n[ce];if(_e=s[ce],n.hasOwnProperty(ce)&&(fe!=null||_e!=null))switch(ce){case"type":d=fe;break;case"name":c=fe;break;case"checked":le=fe;break;case"defaultChecked":ve=fe;break;case"value":h=fe;break;case"defaultValue":y=fe;break;case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(i(137,a));break;default:fe!==_e&&Ht(t,a,ce,fe,n,_e)}}Gi(t,h,y,H,le,ve,d,c);return;case"select":fe=h=y=ce=null;for(d in s)if(H=s[d],s.hasOwnProperty(d)&&H!=null)switch(d){case"value":break;case"multiple":fe=H;default:n.hasOwnProperty(d)||Ht(t,a,d,null,n,H)}for(c in n)if(d=n[c],H=s[c],n.hasOwnProperty(c)&&(d!=null||H!=null))switch(c){case"value":ce=d;break;case"defaultValue":y=d;break;case"multiple":h=d;default:d!==H&&Ht(t,a,c,d,n,H)}a=y,s=h,n=fe,ce!=null?$n(t,!!s,ce,!1):!!n!=!!s&&(a!=null?$n(t,!!s,a,!0):$n(t,!!s,s?[]:"",!1));return;case"textarea":fe=ce=null;for(y in s)if(c=s[y],s.hasOwnProperty(y)&&c!=null&&!n.hasOwnProperty(y))switch(y){case"value":break;case"children":break;default:Ht(t,a,y,null,n,c)}for(h in n)if(c=n[h],d=s[h],n.hasOwnProperty(h)&&(c!=null||d!=null))switch(h){case"value":ce=c;break;case"defaultValue":fe=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(i(91));break;default:c!==d&&Ht(t,a,h,c,n,d)}Rd(t,ce,fe);return;case"option":for(var Ge in s)if(ce=s[Ge],s.hasOwnProperty(Ge)&&ce!=null&&!n.hasOwnProperty(Ge))switch(Ge){case"selected":t.selected=!1;break;default:Ht(t,a,Ge,null,n,ce)}for(H in n)if(ce=n[H],fe=s[H],n.hasOwnProperty(H)&&ce!==fe&&(ce!=null||fe!=null))switch(H){case"selected":t.selected=ce&&typeof ce!="function"&&typeof ce!="symbol";break;default:Ht(t,a,H,ce,n,fe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var et in s)ce=s[et],s.hasOwnProperty(et)&&ce!=null&&!n.hasOwnProperty(et)&&Ht(t,a,et,null,n,ce);for(le in n)if(ce=n[le],fe=s[le],n.hasOwnProperty(le)&&ce!==fe&&(ce!=null||fe!=null))switch(le){case"children":case"dangerouslySetInnerHTML":if(ce!=null)throw Error(i(137,a));break;default:Ht(t,a,le,ce,n,fe)}return;default:if(Pi(a)){for(var Bt in s)ce=s[Bt],s.hasOwnProperty(Bt)&&ce!==void 0&&!n.hasOwnProperty(Bt)&&zo(t,a,Bt,void 0,n,ce);for(ve in n)ce=n[ve],fe=s[ve],!n.hasOwnProperty(ve)||ce===fe||ce===void 0&&fe===void 0||zo(t,a,ve,ce,n,fe);return}}for(var W in s)ce=s[W],s.hasOwnProperty(W)&&ce!=null&&!n.hasOwnProperty(W)&&Ht(t,a,W,null,n,ce);for(_e in n)ce=n[_e],fe=s[_e],!n.hasOwnProperty(_e)||ce===fe||ce==null&&fe==null||Ht(t,a,_e,ce,n,fe)}function Hh(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Wg(){if(typeof performance.getEntriesByType=="function"){for(var t=0,a=0,s=performance.getEntriesByType("resource"),n=0;n<s.length;n++){var c=s[n],d=c.transferSize,h=c.initiatorType,y=c.duration;if(d&&y&&Hh(h)){for(h=0,y=c.responseEnd,n+=1;n<s.length;n++){var H=s[n],le=H.startTime;if(le>y)break;var ve=H.transferSize,_e=H.initiatorType;ve&&Hh(_e)&&(H=H.responseEnd,h+=ve*(H<y?1:(y-le)/(H-le)))}if(--n,a+=8*(d+h)/(c.duration/1e3),t++,10<t)break}}if(0<t)return a/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var Oo=null,Ro=null;function vi(t){return t.nodeType===9?t:t.ownerDocument}function Bh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Fh(t,a){if(t===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&a==="foreignObject"?0:t}function qo(t,a){return t==="textarea"||t==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Lo=null;function Kg(){var t=window.event;return t&&t.type==="popstate"?t===Lo?!1:(Lo=t,!0):(Lo=null,!1)}var $h=typeof setTimeout=="function"?setTimeout:void 0,ex=typeof clearTimeout=="function"?clearTimeout:void 0,Vh=typeof Promise=="function"?Promise:void 0,tx=typeof queueMicrotask=="function"?queueMicrotask:typeof Vh<"u"?function(t){return Vh.resolve(null).then(t).catch(ax)}:$h;function ax(t){setTimeout(function(){throw t})}function rn(t){return t==="head"}function Gh(t,a){var s=a,n=0;do{var c=s.nextSibling;if(t.removeChild(s),c&&c.nodeType===8)if(s=c.data,s==="/$"||s==="/&"){if(n===0){t.removeChild(c),yr(a);return}n--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")n++;else if(s==="html")cl(t.ownerDocument.documentElement);else if(s==="head"){s=t.ownerDocument.head,cl(s);for(var d=s.firstChild;d;){var h=d.nextSibling,y=d.nodeName;d[ia]||y==="SCRIPT"||y==="STYLE"||y==="LINK"&&d.rel.toLowerCase()==="stylesheet"||s.removeChild(d),d=h}}else s==="body"&&cl(t.ownerDocument.body);s=c}while(s);yr(a)}function Yh(t,a){var s=t;t=0;do{var n=s.nextSibling;if(s.nodeType===1?a?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(a?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),n&&n.nodeType===8)if(s=n.data,s==="/$"){if(t===0)break;t--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||t++;s=n}while(s)}function Uo(t){var a=t.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var s=a;switch(a=a.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":Uo(s),Jt(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function sx(t,a,s,n){for(;t.nodeType===1;){var c=s;if(t.nodeName.toLowerCase()!==a.toLowerCase()){if(!n&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(n){if(!t[ia])switch(a){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(d=t.getAttribute("rel"),d==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(d!==c.rel||t.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||t.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||t.getAttribute("title")!==(c.title==null?null:c.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(d=t.getAttribute("src"),(d!==(c.src==null?null:c.src)||t.getAttribute("type")!==(c.type==null?null:c.type)||t.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&d&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(a==="input"&&t.type==="hidden"){var d=c.name==null?null:""+c.name;if(c.type==="hidden"&&t.getAttribute("name")===d)return t}else return t;if(t=es(t.nextSibling),t===null)break}return null}function nx(t,a,s){if(a==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=es(t.nextSibling),t===null))return null;return t}function Ph(t,a){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!a||(t=es(t.nextSibling),t===null))return null;return t}function Ho(t){return t.data==="$?"||t.data==="$~"}function Bo(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function rx(t,a){var s=t.ownerDocument;if(t.data==="$~")t._reactRetry=a;else if(t.data!=="$?"||s.readyState!=="loading")a();else{var n=function(){a(),s.removeEventListener("DOMContentLoaded",n)};s.addEventListener("DOMContentLoaded",n),t._reactRetry=n}}function es(t){for(;t!=null;t=t.nextSibling){var a=t.nodeType;if(a===1||a===3)break;if(a===8){if(a=t.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return t}var Fo=null;function Qh(t){t=t.nextSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"||s==="/&"){if(a===0)return es(t.nextSibling);a--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||a++}t=t.nextSibling}return null}function Xh(t){t=t.previousSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(a===0)return t;a--}else s!=="/$"&&s!=="/&"||a++}t=t.previousSibling}return null}function Zh(t,a,s){switch(a=vi(s),t){case"html":if(t=a.documentElement,!t)throw Error(i(452));return t;case"head":if(t=a.head,!t)throw Error(i(453));return t;case"body":if(t=a.body,!t)throw Error(i(454));return t;default:throw Error(i(451))}}function cl(t){for(var a=t.attributes;a.length;)t.removeAttributeNode(a[0]);Jt(t)}var ts=new Map,Ih=new Set;function yi(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var qs=se.d;se.d={f:lx,r:ix,D:cx,C:ox,L:dx,m:ux,X:hx,S:mx,M:px};function lx(){var t=qs.f(),a=ui();return t||a}function ix(t){var a=Ue(t);a!==null&&a.tag===5&&a.type==="form"?hm(a):qs.r(t)}var xr=typeof document>"u"?null:document;function Jh(t,a,s){var n=xr;if(n&&typeof a=="string"&&a){var c=Qa(a);c='link[rel="'+t+'"][href="'+c+'"]',typeof s=="string"&&(c+='[crossorigin="'+s+'"]'),Ih.has(c)||(Ih.add(c),t={rel:t,crossOrigin:s,href:a},n.querySelector(c)===null&&(a=n.createElement("link"),Ca(a,"link",t),st(a),n.head.appendChild(a)))}}function cx(t){qs.D(t),Jh("dns-prefetch",t,null)}function ox(t,a){qs.C(t,a),Jh("preconnect",t,a)}function dx(t,a,s){qs.L(t,a,s);var n=xr;if(n&&t&&a){var c='link[rel="preload"][as="'+Qa(a)+'"]';a==="image"&&s&&s.imageSrcSet?(c+='[imagesrcset="'+Qa(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(c+='[imagesizes="'+Qa(s.imageSizes)+'"]')):c+='[href="'+Qa(t)+'"]';var d=c;switch(a){case"style":d=jr(t);break;case"script":d=vr(t)}ts.has(d)||(t=q({rel:"preload",href:a==="image"&&s&&s.imageSrcSet?void 0:t,as:a},s),ts.set(d,t),n.querySelector(c)!==null||a==="style"&&n.querySelector(ol(d))||a==="script"&&n.querySelector(dl(d))||(a=n.createElement("link"),Ca(a,"link",t),st(a),n.head.appendChild(a)))}}function ux(t,a){qs.m(t,a);var s=xr;if(s&&t){var n=a&&typeof a.as=="string"?a.as:"script",c='link[rel="modulepreload"][as="'+Qa(n)+'"][href="'+Qa(t)+'"]',d=c;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=vr(t)}if(!ts.has(d)&&(t=q({rel:"modulepreload",href:t},a),ts.set(d,t),s.querySelector(c)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(dl(d)))return}n=s.createElement("link"),Ca(n,"link",t),st(n),s.head.appendChild(n)}}}function mx(t,a,s){qs.S(t,a,s);var n=xr;if(n&&t){var c=yt(n).hoistableStyles,d=jr(t);a=a||"default";var h=c.get(d);if(!h){var y={loading:0,preload:null};if(h=n.querySelector(ol(d)))y.loading=5;else{t=q({rel:"stylesheet",href:t,"data-precedence":a},s),(s=ts.get(d))&&$o(t,s);var H=h=n.createElement("link");st(H),Ca(H,"link",t),H._p=new Promise(function(le,ve){H.onload=le,H.onerror=ve}),H.addEventListener("load",function(){y.loading|=1}),H.addEventListener("error",function(){y.loading|=2}),y.loading|=4,bi(h,a,n)}h={type:"stylesheet",instance:h,count:1,state:y},c.set(d,h)}}}function hx(t,a){qs.X(t,a);var s=xr;if(s&&t){var n=yt(s).hoistableScripts,c=vr(t),d=n.get(c);d||(d=s.querySelector(dl(c)),d||(t=q({src:t,async:!0},a),(a=ts.get(c))&&Vo(t,a),d=s.createElement("script"),st(d),Ca(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(c,d))}}function px(t,a){qs.M(t,a);var s=xr;if(s&&t){var n=yt(s).hoistableScripts,c=vr(t),d=n.get(c);d||(d=s.querySelector(dl(c)),d||(t=q({src:t,async:!0,type:"module"},a),(a=ts.get(c))&&Vo(t,a),d=s.createElement("script"),st(d),Ca(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(c,d))}}function Wh(t,a,s,n){var c=(c=ke.current)?yi(c):null;if(!c)throw Error(i(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(a=jr(s.href),s=yt(c).hoistableStyles,n=s.get(a),n||(n={type:"style",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=jr(s.href);var d=yt(c).hoistableStyles,h=d.get(t);if(h||(c=c.ownerDocument||c,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(t,h),(d=c.querySelector(ol(t)))&&!d._p&&(h.instance=d,h.state.loading=5),ts.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},ts.set(t,s),d||fx(c,t,s,h.state))),a&&n===null)throw Error(i(528,""));return h}if(a&&n!==null)throw Error(i(529,""));return null;case"script":return a=s.async,s=s.src,typeof s=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=vr(s),s=yt(c).hoistableScripts,n=s.get(a),n||(n={type:"script",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,t))}}function jr(t){return'href="'+Qa(t)+'"'}function ol(t){return'link[rel="stylesheet"]['+t+"]"}function Kh(t){return q({},t,{"data-precedence":t.precedence,precedence:null})}function fx(t,a,s,n){t.querySelector('link[rel="preload"][as="style"]['+a+"]")?n.loading=1:(a=t.createElement("link"),n.preload=a,a.addEventListener("load",function(){return n.loading|=1}),a.addEventListener("error",function(){return n.loading|=2}),Ca(a,"link",s),st(a),t.head.appendChild(a))}function vr(t){return'[src="'+Qa(t)+'"]'}function dl(t){return"script[async]"+t}function ep(t,a,s){if(a.count++,a.instance===null)switch(a.type){case"style":var n=t.querySelector('style[data-href~="'+Qa(s.href)+'"]');if(n)return a.instance=n,st(n),n;var c=q({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return n=(t.ownerDocument||t).createElement("style"),st(n),Ca(n,"style",c),bi(n,s.precedence,t),a.instance=n;case"stylesheet":c=jr(s.href);var d=t.querySelector(ol(c));if(d)return a.state.loading|=4,a.instance=d,st(d),d;n=Kh(s),(c=ts.get(c))&&$o(n,c),d=(t.ownerDocument||t).createElement("link"),st(d);var h=d;return h._p=new Promise(function(y,H){h.onload=y,h.onerror=H}),Ca(d,"link",n),a.state.loading|=4,bi(d,s.precedence,t),a.instance=d;case"script":return d=vr(s.src),(c=t.querySelector(dl(d)))?(a.instance=c,st(c),c):(n=s,(c=ts.get(d))&&(n=q({},s),Vo(n,c)),t=t.ownerDocument||t,c=t.createElement("script"),st(c),Ca(c,"link",n),t.head.appendChild(c),a.instance=c);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(n=a.instance,a.state.loading|=4,bi(n,s.precedence,t));return a.instance}function bi(t,a,s){for(var n=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=n.length?n[n.length-1]:null,d=c,h=0;h<n.length;h++){var y=n[h];if(y.dataset.precedence===a)d=y;else if(d!==c)break}d?d.parentNode.insertBefore(t,d.nextSibling):(a=s.nodeType===9?s.head:s,a.insertBefore(t,a.firstChild))}function $o(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.title==null&&(t.title=a.title)}function Vo(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.integrity==null&&(t.integrity=a.integrity)}var _i=null;function tp(t,a,s){if(_i===null){var n=new Map,c=_i=new Map;c.set(s,n)}else c=_i,n=c.get(s),n||(n=new Map,c.set(s,n));if(n.has(t))return n;for(n.set(t,null),s=s.getElementsByTagName(t),c=0;c<s.length;c++){var d=s[c];if(!(d[ia]||d[at]||t==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var h=d.getAttribute(a)||"";h=t+h;var y=n.get(h);y?y.push(d):n.set(h,[d])}}return n}function ap(t,a,s){t=t.ownerDocument||t,t.head.insertBefore(s,a==="title"?t.querySelector("head > title"):null)}function gx(t,a,s){if(s===1||a.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return t=a.disabled,typeof a.precedence=="string"&&t==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function sp(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function xx(t,a,s,n){if(s.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var c=jr(n.href),d=a.querySelector(ol(c));if(d){a=d._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(t.count++,t=Ni.bind(t),a.then(t,t)),s.state.loading|=4,s.instance=d,st(d);return}d=a.ownerDocument||a,n=Kh(n),(c=ts.get(c))&&$o(n,c),d=d.createElement("link"),st(d);var h=d;h._p=new Promise(function(y,H){h.onload=y,h.onerror=H}),Ca(d,"link",n),s.instance=d}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(s,a),(a=s.state.preload)&&(s.state.loading&3)===0&&(t.count++,s=Ni.bind(t),a.addEventListener("load",s),a.addEventListener("error",s))}}var Go=0;function jx(t,a){return t.stylesheets&&t.count===0&&Ci(t,t.stylesheets),0<t.count||0<t.imgCount?function(s){var n=setTimeout(function(){if(t.stylesheets&&Ci(t,t.stylesheets),t.unsuspend){var d=t.unsuspend;t.unsuspend=null,d()}},6e4+a);0<t.imgBytes&&Go===0&&(Go=62500*Wg());var c=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&Ci(t,t.stylesheets),t.unsuspend)){var d=t.unsuspend;t.unsuspend=null,d()}},(t.imgBytes>Go?50:800)+a);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(n),clearTimeout(c)}}:null}function Ni(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ci(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Si=null;function Ci(t,a){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Si=new Map,a.forEach(vx,t),Si=null,Ni.call(t))}function vx(t,a){if(!(a.state.loading&4)){var s=Si.get(t);if(s)var n=s.get(null);else{s=new Map,Si.set(t,s);for(var c=t.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<c.length;d++){var h=c[d];(h.nodeName==="LINK"||h.getAttribute("media")!=="not all")&&(s.set(h.dataset.precedence,h),n=h)}n&&s.set(null,n)}c=a.instance,h=c.getAttribute("data-precedence"),d=s.get(h)||n,d===n&&s.set(null,c),s.set(h,c),this.count++,n=Ni.bind(this),c.addEventListener("load",n),c.addEventListener("error",n),d?d.parentNode.insertBefore(c,d.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(c,t.firstChild)),a.state.loading|=4}}var ul={$$typeof:R,Provider:null,Consumer:null,_currentValue:E,_currentValue2:E,_threadCount:0};function yx(t,a,s,n,c,d,h,y,H){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=kt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kt(0),this.hiddenUpdates=kt(null),this.identifierPrefix=n,this.onUncaughtError=c,this.onCaughtError=d,this.onRecoverableError=h,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=H,this.incompleteTransitions=new Map}function np(t,a,s,n,c,d,h,y,H,le,ve,_e){return t=new yx(t,a,s,h,H,le,ve,_e,y),a=1,d===!0&&(a|=24),d=Ha(3,null,null,a),t.current=d,d.stateNode=t,a=_c(),a.refCount++,t.pooledCache=a,a.refCount++,d.memoizedState={element:n,isDehydrated:s,cache:a},wc(d),t}function rp(t){return t?(t=In,t):In}function lp(t,a,s,n,c,d){c=rp(c),n.context===null?n.context=c:n.pendingContext=c,n=Xs(a),n.payload={element:s},d=d===void 0?null:d,d!==null&&(n.callback=d),s=Zs(t,n,a),s!==null&&(La(s,t,a),Vr(s,t,a))}function ip(t,a){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<a?s:a}}function Yo(t,a){ip(t,a),(t=t.alternate)&&ip(t,a)}function cp(t){if(t.tag===13||t.tag===31){var a=bn(t,67108864);a!==null&&La(a,t,67108864),Yo(t,67108864)}}function op(t){if(t.tag===13||t.tag===31){var a=Ga();a=Se(a);var s=bn(t,a);s!==null&&La(s,t,a),Yo(t,a)}}var wi=!0;function bx(t,a,s,n){var c=N.T;N.T=null;var d=se.p;try{se.p=2,Po(t,a,s,n)}finally{se.p=d,N.T=c}}function _x(t,a,s,n){var c=N.T;N.T=null;var d=se.p;try{se.p=8,Po(t,a,s,n)}finally{se.p=d,N.T=c}}function Po(t,a,s,n){if(wi){var c=Qo(n);if(c===null)Ao(t,a,n,ki,s),up(t,n);else if(Sx(c,t,a,s,n))n.stopPropagation();else if(up(t,n),a&4&&-1<Nx.indexOf(t)){for(;c!==null;){var d=Ue(c);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var h=Mt(d.pendingLanes);if(h!==0){var y=d;for(y.pendingLanes|=2,y.entangledLanes|=2;h;){var H=1<<31-ne(h);y.entanglements[1]|=H,h&=~H}ps(d),(zt&6)===0&&(oi=Ze()+500,rl(0))}}break;case 31:case 13:y=bn(d,2),y!==null&&La(y,d,2),ui(),Yo(d,2)}if(d=Qo(n),d===null&&Ao(t,a,n,ki,s),d===c)break;c=d}c!==null&&n.stopPropagation()}else Ao(t,a,n,null,s)}}function Qo(t){return t=Xi(t),Xo(t)}var ki=null;function Xo(t){if(ki=null,t=ya(t),t!==null){var a=u(t);if(a===null)t=null;else{var s=a.tag;if(s===13){if(t=f(a),t!==null)return t;t=null}else if(s===31){if(t=g(a),t!==null)return t;t=null}else if(s===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;t=null}else a!==t&&(t=null)}}return ki=t,null}function dp(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(De()){case vt:return 2;case wt:return 8;case Zt:case ta:return 32;case Nt:return 268435456;default:return 32}default:return 32}}var Zo=!1,ln=null,cn=null,on=null,ml=new Map,hl=new Map,dn=[],Nx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function up(t,a){switch(t){case"focusin":case"focusout":ln=null;break;case"dragenter":case"dragleave":cn=null;break;case"mouseover":case"mouseout":on=null;break;case"pointerover":case"pointerout":ml.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":hl.delete(a.pointerId)}}function pl(t,a,s,n,c,d){return t===null||t.nativeEvent!==d?(t={blockedOn:a,domEventName:s,eventSystemFlags:n,nativeEvent:d,targetContainers:[c]},a!==null&&(a=Ue(a),a!==null&&cp(a)),t):(t.eventSystemFlags|=n,a=t.targetContainers,c!==null&&a.indexOf(c)===-1&&a.push(c),t)}function Sx(t,a,s,n,c){switch(a){case"focusin":return ln=pl(ln,t,a,s,n,c),!0;case"dragenter":return cn=pl(cn,t,a,s,n,c),!0;case"mouseover":return on=pl(on,t,a,s,n,c),!0;case"pointerover":var d=c.pointerId;return ml.set(d,pl(ml.get(d)||null,t,a,s,n,c)),!0;case"gotpointercapture":return d=c.pointerId,hl.set(d,pl(hl.get(d)||null,t,a,s,n,c)),!0}return!1}function mp(t){var a=ya(t.target);if(a!==null){var s=u(a);if(s!==null){if(a=s.tag,a===13){if(a=f(s),a!==null){t.blockedOn=a,it(t.priority,function(){op(s)});return}}else if(a===31){if(a=g(s),a!==null){t.blockedOn=a,it(t.priority,function(){op(s)});return}}else if(a===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ei(t){if(t.blockedOn!==null)return!1;for(var a=t.targetContainers;0<a.length;){var s=Qo(t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);Qi=n,s.target.dispatchEvent(n),Qi=null}else return a=Ue(s),a!==null&&cp(a),t.blockedOn=s,!1;a.shift()}return!0}function hp(t,a,s){Ei(t)&&s.delete(a)}function Cx(){Zo=!1,ln!==null&&Ei(ln)&&(ln=null),cn!==null&&Ei(cn)&&(cn=null),on!==null&&Ei(on)&&(on=null),ml.forEach(hp),hl.forEach(hp)}function Di(t,a){t.blockedOn===a&&(t.blockedOn=null,Zo||(Zo=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Cx)))}var Mi=null;function pp(t){Mi!==t&&(Mi=t,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Mi===t&&(Mi=null);for(var a=0;a<t.length;a+=3){var s=t[a],n=t[a+1],c=t[a+2];if(typeof n!="function"){if(Xo(n||s)===null)continue;break}var d=Ue(s);d!==null&&(t.splice(a,3),a-=3,Pc(d,{pending:!0,data:c,method:s.method,action:n},n,c))}}))}function yr(t){function a(H){return Di(H,t)}ln!==null&&Di(ln,t),cn!==null&&Di(cn,t),on!==null&&Di(on,t),ml.forEach(a),hl.forEach(a);for(var s=0;s<dn.length;s++){var n=dn[s];n.blockedOn===t&&(n.blockedOn=null)}for(;0<dn.length&&(s=dn[0],s.blockedOn===null);)mp(s),s.blockedOn===null&&dn.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(n=0;n<s.length;n+=3){var c=s[n],d=s[n+1],h=c[rt]||null;if(typeof d=="function")h||pp(s);else if(h){var y=null;if(d&&d.hasAttribute("formAction")){if(c=d,h=d[rt]||null)y=h.formAction;else if(Xo(c)!==null)continue}else y=h.action;typeof y=="function"?s[n+1]=y:(s.splice(n,3),n-=3),pp(s)}}}function fp(){function t(d){d.canIntercept&&d.info==="react-transition"&&d.intercept({handler:function(){return new Promise(function(h){return c=h})},focusReset:"manual",scroll:"manual"})}function a(){c!==null&&(c(),c=null),n||setTimeout(s,20)}function s(){if(!n&&!navigation.transition){var d=navigation.currentEntry;d&&d.url!=null&&navigation.navigate(d.url,{state:d.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,c=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(s,100),function(){n=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),c!==null&&(c(),c=null)}}}function Io(t){this._internalRoot=t}Ti.prototype.render=Io.prototype.render=function(t){var a=this._internalRoot;if(a===null)throw Error(i(409));var s=a.current,n=Ga();lp(s,n,t,a,null,null)},Ti.prototype.unmount=Io.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var a=t.containerInfo;lp(t.current,2,null,t,null,null),ui(),a[ha]=null}};function Ti(t){this._internalRoot=t}Ti.prototype.unstable_scheduleHydration=function(t){if(t){var a=ht();t={blockedOn:null,target:t,priority:a};for(var s=0;s<dn.length&&a!==0&&a<dn[s].priority;s++);dn.splice(s,0,t),s===0&&mp(t)}};var gp=l.version;if(gp!=="19.2.0")throw Error(i(527,gp,"19.2.0"));se.findDOMNode=function(t){var a=t._reactInternals;if(a===void 0)throw typeof t.render=="function"?Error(i(188)):(t=Object.keys(t).join(","),Error(i(268,t)));return t=v(a),t=t!==null?x(t):null,t=t===null?null:t.stateNode,t};var wx={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ai=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ai.isDisabled&&Ai.supportsFiber)try{O=Ai.inject(wx),be=Ai}catch{}}return gl.createRoot=function(t,a){if(!m(t))throw Error(i(299));var s=!1,n="",c=Nm,d=Sm,h=Cm;return a!=null&&(a.unstable_strictMode===!0&&(s=!0),a.identifierPrefix!==void 0&&(n=a.identifierPrefix),a.onUncaughtError!==void 0&&(c=a.onUncaughtError),a.onCaughtError!==void 0&&(d=a.onCaughtError),a.onRecoverableError!==void 0&&(h=a.onRecoverableError)),a=np(t,1,!1,null,null,s,n,null,c,d,h,fp),t[ha]=a.current,To(t),new Io(a)},gl.hydrateRoot=function(t,a,s){if(!m(t))throw Error(i(299));var n=!1,c="",d=Nm,h=Sm,y=Cm,H=null;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(c=s.identifierPrefix),s.onUncaughtError!==void 0&&(d=s.onUncaughtError),s.onCaughtError!==void 0&&(h=s.onCaughtError),s.onRecoverableError!==void 0&&(y=s.onRecoverableError),s.formState!==void 0&&(H=s.formState)),a=np(t,1,!0,a,s??null,n,c,H,d,h,y,fp),a.context=rp(null),s=a.current,n=Ga(),n=Se(n),c=Xs(n),c.callback=null,Zs(s,c,n),s=n,a.current.lanes=s,ft(a,s),ps(a),t[ha]=a.current,To(t),new Ti(a)},gl.version="19.2.0",gl}var _p;function Ux(){if(_p)return Wo.exports;_p=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(l){console.error(l)}}return r(),Wo.exports=Lx(),Wo.exports}var Hx=Ux();const Bx=Ip(Hx),Fx="fieldsync-offline",$x=1,na={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let Hn=null;const Fs=()=>new Promise((r,l)=>{if(Hn){r(Hn);return}const o=indexedDB.open(Fx,$x);o.onerror=()=>{console.error("Failed to open offline database"),l(o.error)},o.onsuccess=()=>{Hn=o.result,console.log("Offline database initialized"),r(Hn)},o.onupgradeneeded=i=>{const m=i.target.result;if(m.objectStoreNames.contains(na.PROJECTS)||m.createObjectStore(na.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),m.objectStoreNames.contains(na.AREAS)||m.createObjectStore(na.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),m.objectStoreNames.contains(na.CREW_CHECKINS)||m.createObjectStore(na.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!m.objectStoreNames.contains(na.PENDING_ACTIONS)){const u=m.createObjectStore(na.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});u.createIndex("type","type",{unique:!1}),u.createIndex("created_at","created_at",{unique:!1})}m.objectStoreNames.contains(na.CACHED_DATA)||m.createObjectStore(na.CACHED_DATA,{keyPath:"key"})}}),Bn=(r,l="readonly")=>{if(!Hn)throw new Error("Database not initialized");return Hn.transaction(r,l).objectStore(r)},Vx=async(r,l)=>(await Fs(),new Promise((o,i)=>{const u=Bn(r,"readwrite").put(l);u.onsuccess=()=>o(u.result),u.onerror=()=>i(u.error)})),Jp=async(r,l)=>(await Fs(),new Promise((o,i)=>{const m=Hn.transaction(r,"readwrite"),u=m.objectStore(r);l.forEach(f=>u.put(f)),m.oncomplete=()=>o(),m.onerror=()=>i(m.error)})),Gx=async(r,l)=>(await Fs(),new Promise((o,i)=>{const u=Bn(r).get(l);u.onsuccess=()=>o(u.result),u.onerror=()=>i(u.error)})),Wp=async r=>(await Fs(),new Promise((l,o)=>{const m=Bn(r).getAll();m.onsuccess=()=>l(m.result||[]),m.onerror=()=>o(m.error)})),Kp=async(r,l,o)=>(await Fs(),new Promise((i,m)=>{const g=Bn(r).index(l).getAll(o);g.onsuccess=()=>i(g.result||[]),g.onerror=()=>m(g.error)})),Yx=async(r,l)=>(await Fs(),new Promise((o,i)=>{const u=Bn(r,"readwrite").delete(l);u.onsuccess=()=>o(),u.onerror=()=>i(u.error)})),gn={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},Np=async(r,l,o={})=>{await Fs();const i={type:r,payload:l,metadata:o,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((m,u)=>{const g=Bn(na.PENDING_ACTIONS,"readwrite").add(i);g.onsuccess=()=>{console.log(`Queued offline action: ${r}`),m(g.result)},g.onerror=()=>u(g.error)})},ef=async()=>Wp(na.PENDING_ACTIONS),td=async()=>(await ef()).length,Px=async r=>Yx(na.PENDING_ACTIONS,r),Qx=async(r,l)=>(await Fs(),new Promise((o,i)=>{const m=Bn(na.PENDING_ACTIONS,"readwrite"),u=m.get(r);u.onsuccess=()=>{const f=u.result;if(f){const g={...f,...l},j=m.put(g);j.onsuccess=()=>o(g),j.onerror=()=>i(j.error)}else i(new Error("Action not found"))},u.onerror=()=>i(u.error)})),Xx=async r=>Jp(na.PROJECTS,r),Sp=async r=>r?Kp(na.PROJECTS,"company_id",r):Wp(na.PROJECTS),Zx=async r=>Jp(na.AREAS,r),Cp=async r=>Kp(na.AREAS,"project_id",r),ad=async(r,l)=>{const o=await Gx(na.AREAS,r);return o&&(o.status=l,o.updated_at=new Date().toISOString(),await Vx(na.AREAS,o)),o};let wd=navigator.onLine;const vd=new Set,tf=r=>(vd.add(r),()=>vd.delete(r)),xl=()=>wd,wp=r=>{wd=r,vd.forEach(l=>l(r))};typeof window<"u"&&(window.addEventListener("online",()=>{console.log("Connection restored"),wp(!0)}),window.addEventListener("offline",()=>{console.log("Connection lost"),wp(!1)}));let sd=!1;const Ix=async r=>{if(sd||!wd)return{synced:0,failed:0};sd=!0;const l={synced:0,failed:0};try{const o=await ef();console.log(`Syncing ${o.length} pending actions...`);for(const i of o)try{await Jx(i,r),await Px(i.id),l.synced++,console.log(`Synced action: ${i.type}`)}catch(m){console.error(`Failed to sync action ${i.type}:`,m),l.failed++,await Qx(i.id,{attempts:(i.attempts||0)+1,last_error:m.message,last_attempt:new Date().toISOString()})}}finally{sd=!1}return l},Jx=async(r,l)=>{const{type:o,payload:i}=r;switch(o){case gn.UPDATE_AREA_STATUS:return l.updateAreaStatus(i.areaId,i.status);case gn.CREATE_TM_TICKET:const m=await l.createTMTicket(i.ticket);return i.workers?.length>0&&await l.addTMWorkers(m.id,i.workers),i.items?.length>0&&await l.addTMItems(m.id,i.items),m;case gn.SAVE_CREW_CHECKIN:return l.saveCrewCheckin(i.projectId,i.workers,i.checkInDate);case gn.SUBMIT_DAILY_REPORT:return await l.saveDailyReport(i.projectId,i.reportData),l.submitDailyReport(i.projectId,i.submittedBy);case gn.SEND_MESSAGE:return l.sendMessage(i.projectId,i.senderType,i.senderName,i.content);case gn.CREATE_MATERIAL_REQUEST:return l.createMaterialRequest(i.projectId,i.items,i.requestedBy,i.neededBy,i.priority,i.notes);default:throw new Error(`Unknown action type: ${o}`)}},Wx={slowQueryThreshold:200},ea={query(r,l){const o={type:"query",operation:r,duration_ms:l.duration,rows_returned:l.rows,company_id:l.company_id||null,project_id:l.project_id||null,user_id:l.user_id||null,timestamp:new Date().toISOString()};l.duration>=Wx.slowQueryThreshold&&nd("query",o)},error(r,l){const o={type:"error",category:r,severity:l.severity||"error",error_code:l.code||null,message:l.message,company_id:l.company_id||null,user_id:l.user_id||null,project_id:l.project_id||null,operation:l.operation||null,context:l.extra||{},timestamp:new Date().toISOString()};nd("error",o)},storage(r,l){const o={type:"storage",operation:r,company_id:l.company_id||null,project_id:l.project_id||null,file_size_bytes:l.size||0,duration_ms:l.duration||0,success:l.success!==!1,error_message:l.error||null,timestamp:new Date().toISOString()};(!o.success||o.duration_ms>5e3)&&nd("storage",o)},activity(r,l){}};async function nd(r,l){try{r==="error"?await D.rpc("log_error",{p_severity:l.severity,p_category:l.category,p_message:l.message,p_company_id:l.company_id,p_user_id:l.user_id,p_project_id:l.project_id,p_operation:l.operation,p_error_code:l.error_code,p_context:l.context||{}}):r==="query"&&await D.rpc("log_query_metric",{p_operation:l.operation,p_duration_ms:l.duration_ms,p_rows_returned:l.rows_returned,p_company_id:l.company_id,p_project_id:l.project_id,p_user_id:l.user_id,p_context:{}})}catch{}}ea.wrapQuery=function(r,l){return async function(...o){const i=performance.now();try{const m=await l.apply(this,o),f={duration:Math.round(performance.now()-i),rows:Array.isArray(m)?m.length:void 0};return ea.query(r,f),m}catch(m){const u=Math.round(performance.now()-i);throw ea.error("database",{message:m.message,operation:r,severity:"error",extra:{duration:u}}),m}}};ea.time=async function(r,l){const o=performance.now();try{const i=await l(),m=Math.round(performance.now()-o);return ea.query(r,{duration:m}),i}catch(i){throw ea.error("general",{message:i.message,operation:r}),i}};const Kx="https://cegifnrcwdilromcyouq.supabase.co",af="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlZ2lmbnJjd2RpbHJvbWN5b3VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTQ5OTAsImV4cCI6MjA4MDIzMDk5MH0.qAiBG5XaB0C1E0U2tQbQkrhpm1iUhM6A2MXngEHhX4A",Y=!!af;Fs().catch(r=>console.error("Failed to init offline DB:",r));const D=Y?Dx(Kx,af):null,sf="fieldsync_data",yd="fieldsync_user",Qe=()=>{const r=localStorage.getItem(sf);return r?JSON.parse(r):{projects:[],areas:[],users:[],assignments:[]}},Ct=r=>{localStorage.setItem(sf,JSON.stringify(r))},zi=()=>{const r=localStorage.getItem(yd);return r?JSON.parse(r):null},Oi=r=>{r?localStorage.setItem(yd,JSON.stringify(r)):localStorage.removeItem(yd)},kp={async signUp(r,l,o,i){if(Y){const{data:m,error:u}=await D.auth.signUp({email:r,password:l,options:{data:{name:o,role:i}}});if(u)throw u;return m}else{const m=Qe(),u={id:crypto.randomUUID(),email:r,name:o,role:i,created_at:new Date().toISOString()};return m.users.push(u),Ct(m),Oi(u),{user:u}}},async signIn(r,l){if(Y){const{data:o,error:i}=await D.auth.signInWithPassword({email:r,password:l});if(i)throw i;return o}else{const i=Qe().users.find(m=>m.email===r);if(!i)throw new Error("User not found");return Oi(i),{user:i}}},async signOut(){if(Y){const{error:r}=await D.auth.signOut();if(r)throw r}else Oi(null)},async getUser(){if(Y){const{data:{user:r}}=await D.auth.getUser();return r}else return zi()},async getProfile(){if(Y){const{data:{user:r}}=await D.auth.getUser();if(!r)return null;const{data:l,error:o}=await D.from("users").select("*").eq("id",r.id).single();return o?{id:r.id,email:r.email,name:r.user_metadata?.name||"",role:r.user_metadata?.role||"foreman"}:l}else return zi()},async updateRole(r,l){if(Y){const{data:o,error:i}=await D.from("users").update({role:l}).eq("id",r).select().single();if(i)throw i;return o}else{const o=Qe(),i=o.users.find(m=>m.id===r);return i&&(i.role=l,Ct(o),zi()?.id===r&&Oi(i)),i}},onAuthStateChange(r){if(Y)return D.auth.onAuthStateChange(r);{const l=zi();return r(l?"SIGNED_IN":"SIGNED_OUT",{user:l}),{data:{subscription:{unsubscribe:()=>{}}}}}}},te={async getProjects(r=null,l=!1){if(Y){if(!xl()){console.log("Offline: returning cached projects");const i=await Sp(r);return l?i:i.filter(m=>m.status!=="archived")}const o=performance.now();try{let i=D.from("projects").select("*").order("created_at",{ascending:!1});r&&(i=i.eq("company_id",r)),l||(i=i.eq("status","active"));const{data:m,error:u}=await i,f=Math.round(performance.now()-o);if(ea.query("getProjects",{duration:f,rows:m?.length,company_id:r}),u){ea.error("database",{message:u.message,operation:"getProjects",company_id:r}),console.log("Error fetching projects, trying cache:",u.message);const g=await Sp(r);if(g.length>0)return g;throw u}return m?.length>0&&Xx(m).catch(g=>console.error("Failed to cache projects:",g)),m}catch(i){throw ea.error("database",{message:i.message,operation:"getProjects",company_id:r}),i}}else{const o=Qe().projects;return l?o:o.filter(i=>i.status!=="archived")}},async getArchivedProjects(r){if(Y){const{data:l,error:o}=await D.from("projects").select("*").eq("company_id",r).eq("status","archived").order("archived_at",{ascending:!1});if(o)throw o;return l}else return Qe().projects.filter(l=>l.status==="archived")},async getProjectCount(r){if(Y){const{count:l,error:o}=await D.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",r).in("status",["active","archived"]);if(o)throw o;return l||0}else return Qe().projects.filter(o=>o.company_id===r&&o.status!=="deleted").length},async archiveProject(r){if(Y){const{data:l,error:o}=await D.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",r).select().single();if(o)throw o;return l}else{const l=Qe(),o=l.projects.find(i=>i.id===r);return o&&(o.status="archived",o.archived_at=new Date().toISOString(),Ct(l)),o}},async getProjectStorageStats(r){if(!Y)return{photoCount:0,estimatedMB:0};const{data:l,error:o}=await D.from("t_and_m_tickets").select("photos").eq("project_id",r);if(o)throw o;let i=0;const m=[];l?.forEach(f=>{f.photos&&Array.isArray(f.photos)&&(i+=f.photos.length,m.push(...f.photos))});const u=i*1.5;return{photoCount:i,estimatedMB:u,photoUrls:m}},async archiveProjectDeep(r,l){if(!Y)return null;const{photoUrls:o}=await this.getProjectStorageStats(r);if(o.length>0){const u=o.map(f=>{try{const j=new URL(f).pathname.match(/\/tm-photos\/(.+)$/);return j?j[1]:null}catch{return null}}).filter(Boolean);if(u.length>0)for(let f=0;f<u.length;f+=100){const g=u.slice(f,f+100);await D.storage.from("tm-photos").remove(g)}}await D.from("t_and_m_tickets").update({photos:[]}).eq("project_id",r);const{data:i,error:m}=await D.from("projects").update({status:"archived",archived_at:new Date().toISOString(),photos:[],storage_cleaned:!0}).eq("id",r).select().single();if(m)throw m;return{...i,photosDeleted:o.length}},async restoreProject(r){if(Y){const{data:l,error:o}=await D.from("projects").update({status:"active",archived_at:null}).eq("id",r).select().single();if(o)throw o;return l}else{const l=Qe(),o=l.projects.find(i=>i.id===r);return o&&(o.status="active",o.archived_at=null,Ct(l)),o}},async getProject(r){if(Y){const{data:l,error:o}=await D.from("projects").select("*").eq("id",r).single();if(o)throw o;return l}else return Qe().projects.find(l=>l.id===r)},async createProject(r){if(Y){console.log("Creating project with data:",r);const{data:l,error:o}=await D.from("projects").insert({...r,status:"active"}).select().single();if(o)throw console.error("Supabase createProject error:",o.message,o.details,o.hint),o;return l}else{const l=Qe(),o={...r,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return l.projects.push(o),Ct(l),o}},async getProjectByPin(r){if(Y){const{data:l,error:o}=await D.from("projects").select("*").eq("pin",r).eq("status","active").single();return o?null:l}else return Qe().projects.find(o=>o.pin===r&&o.status==="active")||null},async getProjectByPinAndCompany(r,l){if(Y){const{data:o,error:i}=await D.from("projects").select("*").eq("pin",r).eq("company_id",l).eq("status","active").single();return i?null:o}else return Qe().projects.find(i=>i.pin===r&&i.company_id===l&&i.status==="active")||null},async isPinAvailable(r,l=null){if(Y){let o=D.from("projects").select("id").eq("pin",r);l&&(o=o.neq("id",l));const{data:i,error:m}=await o;if(m)throw m;return i.length===0}else return!Qe().projects.some(i=>i.pin===r&&i.id!==l)},async updateProjectPin(r,l){if(Y){const{data:o,error:i}=await D.from("projects").update({pin:l}).eq("id",r).select().single();if(i)throw i;return o}else{const o=Qe(),i=o.projects.find(m=>m.id===r);return i&&(i.pin=l,Ct(o)),i}},async updateProject(r,l){if(Y){const{data:o,error:i}=await D.from("projects").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating project:",i),i;return o}else{const o=Qe(),i=o.projects.find(m=>m.id===r);return i&&(Object.assign(i,l),Ct(o)),i}},async deleteProject(r){if(Y){const{error:l}=await D.from("projects").delete().eq("id",r);if(l)throw l}else{const l=Qe();l.projects=l.projects.filter(o=>o.id!==r),l.areas=l.areas.filter(o=>o.project_id!==r),Ct(l)}},async getAreas(r){if(Y){if(!xl())return console.log("Offline: returning cached areas"),Cp(r);const{data:l,error:o}=await D.from("areas").select("*").eq("project_id",r).order("sort_order",{ascending:!0});if(o){console.log("Error fetching areas, trying cache:",o.message);const i=await Cp(r);if(i.length>0)return i;throw o}return l?.length>0&&Zx(l).catch(i=>console.error("Failed to cache areas:",i)),l}else return Qe().areas.filter(l=>l.project_id===r)},async createArea(r){if(Y){const{data:l,error:o}=await D.from("areas").insert(r).select().single();if(o)throw o;return l}else{const l=Qe(),o={...r,id:crypto.randomUUID(),created_at:new Date().toISOString()};return l.areas.push(o),Ct(l),o}},async updateAreaStatus(r,l){if(Y){if(!xl()){console.log("Offline: queuing area status update");const m=await ad(r,l);return await Np(gn.UPDATE_AREA_STATUS,{areaId:r,status:l}),m}const{data:o,error:i}=await D.from("areas").update({status:l}).eq("id",r).select().single();if(i){if(i.message?.includes("fetch")||i.message?.includes("network")){console.log("Network error: queuing area status update");const m=await ad(r,l);return await Np(gn.UPDATE_AREA_STATUS,{areaId:r,status:l}),m}throw i}return o&&ad(r,l).catch(m=>console.error("Failed to update cached area:",m)),o}else{const o=Qe(),i=o.areas.find(m=>m.id===r);return i&&(i.status=l,i.updated_at=new Date().toISOString()),Ct(o),i}},async updateArea(r,l){if(Y){const{data:o,error:i}=await D.from("areas").update(l).eq("id",r).select().single();if(i)throw i;return o}else{const o=Qe(),i=o.areas.find(m=>m.id===r);return i&&(Object.assign(i,l),i.updated_at=new Date().toISOString()),Ct(o),i}},async deleteArea(r){if(Y){const{error:l}=await D.from("areas").delete().eq("id",r);if(l)throw l}else{const l=Qe();l.areas=l.areas.filter(o=>o.id!==r),Ct(l)}},subscribeToAreas(r,l){return Y?D.channel(`areas:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMessages(r,l){return Y?D.channel(`messages:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMaterialRequests(r,l){return Y?D.channel(`material_requests:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToDailyReports(r,l){return Y?D.channel(`daily_reports:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCrewCheckins(r,l){return Y?D.channel(`crew_checkins:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToInjuryReports(r,l){return Y?D.channel(`injury_reports:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},l).subscribe():null},subscribeToTMTickets(r,l){return Y?D.channel(`tm_tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCompanyActivity(r,l,o){if(!Y||!l||l.length===0)return null;const i=D.channel(`company_activity:${r}`);return l.forEach(m=>{i.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${m}`},u=>o.onMessage?.(u)),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"material_requests",filter:`project_id=eq.${m}`},u=>o.onMaterialRequest?.(u)),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${m}`},u=>o.onTMTicket?.(u))}),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},m=>o.onInjuryReport?.(m)),i.subscribe()},unsubscribe(r){r&&Y&&D.removeChannel(r)},async getAssignedProjects(r){if(Y){const{data:l,error:o}=await D.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",r);if(o)throw o;return l.map(i=>i.projects)}else{const l=Qe();return(l.assignments?.filter(i=>i.user_id===r)||[]).map(i=>l.projects.find(m=>m.id===i.project_id)).filter(Boolean)}},async assignUserToProject(r,l,o){if(Y){const{data:i,error:m}=await D.from("project_assignments").insert({project_id:r,user_id:l,assigned_by:o}).select().single();if(m)throw m;return i}else{const i=Qe();i.assignments||(i.assignments=[]);const m={id:crypto.randomUUID(),project_id:r,user_id:l,assigned_by:o,assigned_at:new Date().toISOString()};return i.assignments.push(m),Ct(i),m}},async removeUserFromProject(r,l){if(Y){const{error:o}=await D.from("project_assignments").delete().eq("project_id",r).eq("user_id",l);if(o)throw o}else{const o=Qe();o.assignments=o.assignments?.filter(i=>!(i.project_id===r&&i.user_id===l))||[],Ct(o)}},async getProjectAssignments(r){if(Y){const{data:l,error:o}=await D.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",r);if(o)throw o;return l.map(i=>i.users)}else{const l=Qe();return(l.assignments?.filter(i=>i.project_id===r)||[]).map(i=>l.users.find(m=>m.id===i.user_id)).filter(Boolean)}},async getAllUsers(){if(Y){const{data:r,error:l}=await D.from("users").select("*").order("name");if(l)throw l;return r}else return Qe().users||[]},async getForemen(){if(Y){const{data:r,error:l}=await D.from("users").select("*").eq("role","foreman").order("name");if(l)throw l;return r}else return(Qe().users||[]).filter(r=>r.role==="foreman")},async logActivity(r,l,o,i,m,u){if(Y){const{error:f}=await D.from("activity_log").insert({user_id:r,project_id:l,area_id:o,action:i,old_value:m,new_value:u});f&&console.error("Error logging activity:",f)}},async getProjectActivity(r,l=50){if(Y){const{data:o,error:i}=await D.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",r).order("created_at",{ascending:!1}).limit(l);if(i)throw i;return o}return[]},async getMaterialsEquipment(r){if(Y){const{data:l,error:o}=await D.from("materials_equipment").select("*").eq("company_id",r).eq("active",!0).order("category").order("name");if(o)throw o;return l}return[]},async getMaterialsEquipmentByCategory(r,l){if(Y){const{data:o,error:i}=await D.from("materials_equipment").select("*").eq("company_id",r).eq("category",l).eq("active",!0).order("name");if(i)throw i;return o}return[]},async getAllMaterialsEquipment(r){if(Y){const{data:l,error:o}=await D.from("materials_equipment").select("*").eq("company_id",r).order("category").order("name");if(o)throw o;return l}return[]},async createMaterialEquipment(r){if(Y){const{data:l,error:o}=await D.from("materials_equipment").insert(r).select().single();if(o)throw o;return l}return null},async updateMaterialEquipment(r,l){if(Y){const{data:o,error:i}=await D.from("materials_equipment").update(l).eq("id",r).select().single();if(i)throw i;return o}return null},async deleteMaterialEquipment(r){if(Y){const{error:l}=await D.from("materials_equipment").update({active:!1}).eq("id",r);if(l)throw l}},async getTMTickets(r){if(Y){const l=performance.now();try{const{data:o,error:i}=await D.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          `).eq("project_id",r).order("created_at",{ascending:!1}),m=Math.round(performance.now()-l);if(ea.query("getTMTickets",{duration:m,rows:o?.length,project_id:r}),i)throw i;return o}catch(o){throw ea.error("database",{message:o.message,operation:"getTMTickets",project_id:r}),o}}return[]},async getChangeOrderTotals(r){if(Y){const{data:l,error:o}=await D.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",r).not("ce_pco_number","is",null).neq("ce_pco_number","");if(o)throw o;const i={};let m=0,u=0;return l?.forEach(f=>{const g=f.ce_pco_number;if(i[g]||(i[g]={approved:0,pending:0,count:0}),i[g].count++,f.status==="approved"||f.status==="billed"){const j=parseFloat(f.change_order_value)||0;i[g].approved+=j,m+=j}else f.status==="pending"&&u++}),{changeOrders:i,totalApprovedValue:m,pendingCount:u}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(r,l){if(Y){const{data:o,error:i}=await D.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).eq("status",l).order("created_at",{ascending:!1});if(i)throw i;return o}return[]},async getCORTickets(r){if(Y){const{data:l,error:o}=await D.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",r).order("work_date",{ascending:!0});if(o)throw o;return l||[]}return[]},async createTMTicket(r){if(Y){const{data:l,error:o}=await D.from("t_and_m_tickets").insert({project_id:r.project_id,work_date:r.work_date,ce_pco_number:r.ce_pco_number||null,assigned_cor_id:r.assigned_cor_id||null,notes:r.notes,photos:r.photos||[],status:"pending",created_by_name:r.created_by_name||"Field User"}).select().single();if(o)throw o;return l}return null},async addTMWorkers(r,l){if(Y){const o=l.map(m=>({ticket_id:r,name:m.name,hours:m.hours,overtime_hours:m.overtime_hours||0,time_started:m.time_started||null,time_ended:m.time_ended||null,role:m.role||"Laborer"})),{error:i}=await D.from("t_and_m_workers").insert(o);if(i)throw i}},async addTMItems(r,l){if(Y){const o=l.map(m=>({ticket_id:r,material_equipment_id:m.material_equipment_id||null,custom_name:m.custom_name||null,custom_category:m.custom_category||null,quantity:m.quantity})),{error:i}=await D.from("t_and_m_items").insert(o);if(i)throw i}},async getPreviousTicketCrew(r,l){if(!Y)return null;const{data:o,error:i}=await D.from("t_and_m_tickets").select(`
        id,
        work_date,
        t_and_m_workers (*)
      `).eq("project_id",r).lt("work_date",l).order("work_date",{ascending:!1}).limit(1).single();if(i||!o)return null;const m=o.t_and_m_workers||[],u=m.filter(j=>["Foreman","General Foreman","Superintendent"].includes(j.role)).map(j=>({name:j.name,hours:j.hours?.toString()||"",overtimeHours:j.overtime_hours?.toString()||"",timeStarted:j.time_started||"",timeEnded:j.time_ended||"",role:j.role})),f=m.filter(j=>j.role==="Operator").map(j=>({name:j.name,hours:j.hours?.toString()||"",overtimeHours:j.overtime_hours?.toString()||"",timeStarted:j.time_started||"",timeEnded:j.time_ended||""})),g=m.filter(j=>j.role==="Laborer").map(j=>({name:j.name,hours:j.hours?.toString()||"",overtimeHours:j.overtime_hours?.toString()||"",timeStarted:j.time_started||"",timeEnded:j.time_ended||""}));return{workDate:o.work_date,supervision:u.length>0?u:null,operators:f.length>0?f:null,laborers:g.length>0?g:null,totalWorkers:m.length}},async updateTMTicketStatus(r,l){if(Y){const{data:o,error:i}=await D.from("t_and_m_tickets").update({status:l}).eq("id",r).select().single();if(i)throw i;return o}return null},async approveTMTicket(r,l,o,i=null){if(Y){const m={status:"approved",approved_by_user_id:l,approved_by_name:o,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};i!==null&&(m.change_order_value=parseFloat(i)||0);const{data:u,error:f}=await D.from("t_and_m_tickets").update(m).eq("id",r).select().single();if(f)throw f;return u}return null},async rejectTMTicket(r,l,o,i=""){if(Y){const{data:m,error:u}=await D.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:l,rejected_by_name:o,rejected_at:new Date().toISOString(),rejection_reason:i,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",r).select().single();if(u)throw u;return m}return null},canApproveTickets(r){return["owner","admin","manager"].includes(r)},async updateTMTicketPhotos(r,l){if(Y){const{data:o,error:i}=await D.from("t_and_m_tickets").update({photos:l}).eq("id",r).select().single();if(i)throw i;return o}return null},async saveTMClientSignature(r,l){if(Y){const{data:o,error:i}=await D.from("t_and_m_tickets").update({client_signature_data:l.signature,client_signature_name:l.signerName,client_signature_title:l.signerTitle,client_signature_company:l.signerCompany,client_signature_date:l.signedAt,client_signature_ip:null,status:"client_signed"}).eq("id",r).select().single();if(i)throw i;return o}return null},async deleteTMTicket(r){if(Y){const{error:l}=await D.from("t_and_m_tickets").delete().eq("id",r);if(l)throw l}},async isTicketEditable(r){if(!r?.assigned_cor_id)return{editable:!0};if(Y)try{const{data:l,error:o}=await D.from("change_orders").select("id, status, cor_number").eq("id",r.assigned_cor_id).single();if(o||!l)return{editable:!0};const m=["draft","pending_approval"].includes(l.status);return{editable:m,lockedBy:m?null:l,reason:m?null:`This ticket is linked to ${l.cor_number} which has been ${l.status==="approved"?"approved":l.status}`}}catch(l){return console.error("Error checking ticket editability:",l),{editable:!0}}return{editable:!0}},async getCompanyByCode(r){if(Y){const{data:l,error:o}=await D.from("companies").select("*").eq("code",r).single();return o?null:l}return null},async getCompany(r){if(Y){const{data:l,error:o}=await D.from("companies").select("*").eq("id",r).single();if(o)throw o;return l}return null},async getUserCompanies(r){if(Y){const{data:l,error:o}=await D.from("user_companies").select(`
          id,
          access_level,
          company_id,
          status,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",r).eq("status","active").order("created_at",{ascending:!0});return o?(console.error("Error fetching user companies:",o),[]):l.map(i=>({id:i.companies.id,name:i.companies.name,code:i.companies.code,access_level:i.access_level}))}return[]},async getUserPendingMemberships(r){if(Y){const{count:l,error:o}=await D.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r).eq("status","pending");return o?(console.error("Error fetching pending memberships:",o),0):l||0}return 0},async getCompanyMemberships(r){if(Y){const{data:l,error:o}=await D.from("user_companies").select(`
          id,
          access_level,
          company_role,
          status,
          created_at,
          approved_at,
          approved_by,
          removed_at,
          removed_by,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).order("created_at",{ascending:!1});return o?(console.error("Error fetching company memberships:",o),[]):l||[]}return[]},async approveMembership(r,l){if(Y){const{error:o}=await D.from("user_companies").update({status:"active",approved_at:new Date().toISOString(),approved_by:l}).eq("id",r);if(o)throw o}},async approveMembershipWithRole(r,l,o="member"){if(Y){const{error:i}=await D.rpc("approve_membership_with_role",{membership_id:r,approved_by_user:l,new_access_level:o});if(i)throw i}},async rejectMembership(r){if(Y){const{error:l}=await D.from("user_companies").delete().eq("id",r);if(l)throw l}},async removeMember(r,l){if(Y){const{error:o}=await D.from("user_companies").update({status:"removed",removed_at:new Date().toISOString(),removed_by:l}).eq("id",r);if(o)throw o}},async getProjectTeam(r){if(Y){const{data:l,error:o}=await D.from("project_users").select(`
          id,
          project_role,
          assigned_at,
          notes,
          users!project_users_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("project_id",r).order("assigned_at",{ascending:!0});return o?(console.error("Error fetching project team:",o),[]):l||[]}return[]},async getCompanyMembers(r){if(Y){const{data:l,error:o}=await D.from("user_companies").select(`
          id,
          access_level,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).eq("status","active").order("created_at",{ascending:!0});return o?(console.error("Error fetching company members:",o),[]):l||[]}return[]},async addProjectMember(r,l,o,i){if(Y){const{data:m,error:u}=await D.from("project_users").insert({project_id:r,user_id:l,project_role:o,assigned_by:i}).select().single();if(u)throw u;return m}return null},async updateProjectMemberRole(r,l,o){if(Y){const{error:i}=await D.from("project_users").update({project_role:o}).eq("project_id",r).eq("user_id",l);if(i)throw i}},async removeProjectMember(r,l){if(Y){const{error:o}=await D.from("project_users").delete().eq("project_id",r).eq("user_id",l);if(o)throw o}},async updateMemberAccessLevel(r,l){if(Y){const{error:o}=await D.from("user_companies").update({access_level:l}).eq("id",r);if(o)throw o}},async updateMemberCompanyRole(r,l){if(Y){const{error:o}=await D.from("user_companies").update({company_role:l}).eq("id",r);if(o)throw o}},async repairLegacyUser(r,l,o="member"){if(!Y||!r||!l)return!1;try{const{data:i,error:m}=await D.rpc("repair_legacy_user",{p_user_id:r,p_company_id:l,p_role:o});return m?(console.error("RPC repair_legacy_user failed:",m),!1):(console.log("Legacy user repaired via RPC:",i),i===!0)}catch(i){return console.error("Error repairing legacy user:",i),!1}},async isLegacyUser(r){if(!Y)return!1;try{const{data:l}=await D.from("users").select("company_id, role").eq("id",r).single();if(!l?.company_id)return!1;const{count:o}=await D.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r);return o===0}catch(l){return console.error("Error checking legacy user:",l),!1}},DISPOSAL_LOAD_TYPES:[{value:"concrete",label:"Concrete"},{value:"trash",label:"Trash"},{value:"metals",label:"Metals"},{value:"hazardous_waste",label:"Hazardous Waste"}],async getDisposalLoads(r,l){if(!Y)return[];const o=performance.now();try{const{data:i,error:m}=await D.from("disposal_loads").select("*").eq("project_id",r).eq("work_date",l).order("created_at",{ascending:!1}),u=Math.round(performance.now()-o);if(ea.query("getDisposalLoads",{duration:u,rows:i?.length,project_id:r}),m)throw m;return i||[]}catch(i){throw ea.error("database",{message:i.message,operation:"getDisposalLoads",project_id:r}),i}},async addDisposalLoad(r,l,o,i,m,u=null){if(!Y)return null;const{data:f,error:g}=await D.from("disposal_loads").insert({project_id:r,user_id:l,work_date:o,load_type:i,load_count:m,notes:u}).select().single();if(g)throw ea.error("database",{message:g.message,operation:"addDisposalLoad",project_id:r}),g;return f},async updateDisposalLoad(r,l,o,i=null){if(!Y)return null;const{data:m,error:u}=await D.from("disposal_loads").update({load_type:l,load_count:o,notes:i}).eq("id",r).select().single();if(u)throw ea.error("database",{message:u.message,operation:"updateDisposalLoad"}),u;return m},async deleteDisposalLoad(r){if(!Y)return!1;const{error:l}=await D.from("disposal_loads").delete().eq("id",r);if(l)throw ea.error("database",{message:l.message,operation:"deleteDisposalLoad"}),l;return!0},async getDisposalSummary(r,l=null,o=null){if(!Y)return[];const i=performance.now();try{const{data:m,error:u}=await D.rpc("get_disposal_summary",{p_project_id:r,p_start_date:l,p_end_date:o}),f=Math.round(performance.now()-i);if(ea.query("getDisposalSummary",{duration:f,rows:m?.length,project_id:r}),u)throw u;return m||[]}catch(m){return ea.error("database",{message:m.message,operation:"getDisposalSummary",project_id:r}),this.getDisposalSummaryFallback(r,l,o)}},async getDisposalSummaryFallback(r,l,o){let i=D.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r);l&&(i=i.gte("work_date",l)),o&&(i=i.lte("work_date",o));const{data:m,error:u}=await i;if(u)throw u;const f={};return m?.forEach(g=>{f[g.load_type]||(f[g.load_type]={load_type:g.load_type,total_loads:0,days:new Set}),f[g.load_type].total_loads+=g.load_count,f[g.load_type].days.add(g.work_date)}),Object.values(f).map(g=>({load_type:g.load_type,total_loads:g.total_loads,days_with_activity:g.days.size}))},async getWeeklyDisposalSummary(r,l=4){if(!Y)return[];const o=new Date,i=new Date;i.setDate(i.getDate()-l*7);const{data:m,error:u}=await D.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r).gte("work_date",i.toISOString().split("T")[0]).lte("work_date",o.toISOString().split("T")[0]).order("work_date",{ascending:!0});if(u)throw u;const f={};return m?.forEach(g=>{const j=new Date(g.work_date),v=new Date(j);v.setDate(j.getDate()-j.getDay());const x=v.toISOString().split("T")[0];f[x]||(f[x]={week:x,concrete:0,trash:0,metals:0,hazardous_waste:0}),f[x][g.load_type]+=g.load_count}),Object.values(f).sort((g,j)=>g.week.localeCompare(j.week))},async uploadPhoto(r,l,o,i){if(!Y)return null;const m=performance.now(),u=i.size||0,f=Date.now(),g=Math.random().toString(36).substring(7),j=i.name?.split(".").pop()||"jpg",v=`${f}-${g}.${j}`,x=`${r}/${l}/${o}/${v}`;try{const{data:q,error:L}=await D.storage.from("tm-photos").upload(x,i,{cacheControl:"3600",upsert:!1}),M=Math.round(performance.now()-m);if(ea.storage("upload",{company_id:r,project_id:l,size:u,duration:M,success:!L}),L)throw L;const{data:P}=D.storage.from("tm-photos").getPublicUrl(x);return P.publicUrl}catch(q){throw ea.error("storage",{message:q.message,operation:"uploadPhoto",company_id:r,project_id:l}),q}},async uploadPhotoBase64(r,l,o,i,m="photo.jpg"){if(!Y)return null;const f=await(await fetch(i)).blob(),g=Date.now(),j=Math.random().toString(36).substring(7),v=m.split(".").pop()||"jpg",x=`${g}-${j}.${v}`,q=`${r}/${l}/${o}/${x}`,{data:L,error:M}=await D.storage.from("tm-photos").upload(q,f,{cacheControl:"3600",upsert:!1,contentType:f.type});if(M)throw M;const{data:P}=D.storage.from("tm-photos").getPublicUrl(q);return P.publicUrl},async deletePhoto(r){if(!Y)return;const o=new URL(r).pathname.match(/\/tm-photos\/(.+)$/);if(!o)return;const i=o[1],{error:m}=await D.storage.from("tm-photos").remove([i]);if(m)throw m},async getCrewCheckin(r,l=null){if(!Y)return null;const o=l||new Date().toISOString().split("T")[0],{data:i,error:m}=await D.from("crew_checkins").select("*").eq("project_id",r).eq("check_in_date",o).single();return m&&m.code!=="PGRST116"&&console.error("Error fetching crew checkin:",m),i},async saveCrewCheckin(r,l,o=null,i=null){if(!Y)return null;const m=i||new Date().toISOString().split("T")[0],{data:u,error:f}=await D.from("crew_checkins").upsert({project_id:r,check_in_date:m,workers:l,created_by:o,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(f)throw console.error("Error saving crew checkin:",f),f;return u},async addCrewMember(r,l,o=null){if(!Y)return null;const i=await this.getCrewCheckin(r),m=i?.workers||[];return m.find(u=>u.name.toLowerCase()===l.name.toLowerCase())?i:(m.push(l),await this.saveCrewCheckin(r,m,o))},async removeCrewMember(r,l){if(!Y)return null;const o=await this.getCrewCheckin(r);if(!o)return null;const i=o.workers.filter(m=>m.name.toLowerCase()!==l.toLowerCase());return await this.saveCrewCheckin(r,i,o.created_by)},async getCrewCheckinHistory(r,l=30){if(!Y)return[];const{data:o,error:i}=await D.from("crew_checkins").select("*").eq("project_id",r).order("check_in_date",{ascending:!1}).limit(l);return i?(console.error("Error fetching crew history:",i),[]):o||[]},async getLaborRates(r,l=null,o=null){if(!Y)return[];let i=D.from("labor_rates").select("*").eq("company_id",r);l&&(i=i.eq("work_type",l)),o&&(i=i.eq("job_type",o));const{data:m,error:u}=await i;return u?(console.error("Error fetching labor rates:",u),[]):m||[]},async calculateManDayCosts(r,l,o,i){if(!Y)return{totalCost:0,totalManDays:0,breakdown:[]};const m=await this.getCrewCheckinHistory(r,365),u=await this.getLaborRates(l,o,i),f={};u.forEach(q=>{f[q.role.toLowerCase()]=parseFloat(q.regular_rate)||0});let g=0,j=0;const v={},x=[];return m.forEach(q=>{const L=q.workers||[];let M=0;const P={};L.forEach(V=>{const J=(V.role||"laborer").toLowerCase(),ae=f[J]||0;P[J]||(P[J]={count:0,cost:0}),P[J].count++,P[J].cost+=ae,M+=ae,v[J]||(v[J]={count:0,cost:0,rate:ae}),v[J].count++,v[J].cost+=ae}),g+=M,j+=L.length,x.push({date:q.check_in_date,workers:L.length,cost:M,breakdown:P})}),{totalCost:g,totalManDays:j,byRole:v,byDate:x,daysWorked:m.length}},async getDailyReport(r,l=null){if(!Y)return null;const o=l||new Date().toISOString().split("T")[0],{data:i,error:m}=await D.from("daily_reports").select("*").eq("project_id",r).eq("report_date",o).single();return m&&m.code!=="PGRST116"&&console.error("Error fetching daily report:",m),i},async compileDailyReport(r,l=null){if(!Y)return null;const o=l||new Date().toISOString().split("T")[0],i=await this.getCrewCheckin(r,o),{data:m}=await D.from("areas").select("*").eq("project_id",r),u=m?.filter(j=>j.status==="done"&&j.completed_at?.startsWith(o))||[],{data:f}=await D.from("t_and_m_tickets").select("*").eq("project_id",r).eq("work_date",o),g=f?.reduce((j,v)=>j+(v.photos?.length||0),0)||0;return{crew_count:i?.workers?.length||0,crew_list:i?.workers||[],tasks_completed:u.length,tasks_total:m?.length||0,completed_tasks:u.map(j=>({name:j.name,group:j.group_name})),tm_tickets_count:f?.length||0,photos_count:g}},async saveDailyReport(r,l,o=null){if(!Y)return null;const i=o||new Date().toISOString().split("T")[0],{data:m,error:u}=await D.from("daily_reports").upsert({project_id:r,report_date:i,...l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(u)throw console.error("Error saving daily report:",u),u;return m},async submitDailyReport(r,l,o=null){if(!Y)return null;const i=o||new Date().toISOString().split("T")[0],m=await this.compileDailyReport(r,i),{data:u,error:f}=await D.from("daily_reports").upsert({project_id:r,report_date:i,...m,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(f)throw console.error("Error submitting daily report:",f),f;return u},async getDailyReports(r,l=30){if(!Y)return[];const{data:o,error:i}=await D.from("daily_reports").select("*").eq("project_id",r).order("report_date",{ascending:!1}).limit(l);return i?(console.error("Error fetching daily reports:",i),[]):o||[]},async sendMessage(r,l,o,i,m=null,u=null,f="general",g=null){if(!Y)return null;const{data:j,error:v}=await D.from("messages").insert({project_id:r,sender_type:o,sender_name:i,sender_user_id:m,message:l,photo_url:u,message_type:f,parent_message_id:g}).select().single();if(v)throw console.error("Error sending message:",v),v;return j},async getMessages(r,l=50){if(!Y)return[];const{data:o,error:i}=await D.from("messages").select("*").eq("project_id",r).order("created_at",{ascending:!1}).limit(l);return i?(console.error("Error fetching messages:",i),[]):o||[]},async getUnreadCount(r,l){if(!Y)return 0;const o=l==="field"?"office":"field",{count:i,error:m}=await D.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("sender_type",o).eq("is_read",!1);return m?(console.error("Error getting unread count:",m),0):i||0},async markMessagesRead(r,l){if(!Y)return;const o=l==="field"?"office":"field",{error:i}=await D.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",r).eq("sender_type",o).eq("is_read",!1);i&&console.error("Error marking messages read:",i)},async createMaterialRequest(r,l,o,i=null,m="normal",u=null){if(!Y)return null;const{data:f,error:g}=await D.from("material_requests").insert({project_id:r,items:l,requested_by:o,needed_by:i,priority:m,notes:u}).select().single();if(g)throw console.error("Error creating material request:",g),g;return f},async getMaterialRequests(r,l=null){if(!Y)return[];let o=D.from("material_requests").select("*").eq("project_id",r).order("created_at",{ascending:!1});l&&(o=o.eq("status",l));const{data:i,error:m}=await o;return m?(console.error("Error fetching material requests:",m),[]):i||[]},async getPendingRequestsCount(r){if(!Y)return 0;const{count:l,error:o}=await D.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("status","pending");return o?0:l||0},async updateMaterialRequest(r,l,o,i=null,m=null){if(!Y)return null;const u={status:l,responded_by:o,responded_at:new Date().toISOString(),response_notes:i,updated_at:new Date().toISOString()};m&&(u.expected_delivery=m),l==="delivered"&&(u.delivered_at=new Date().toISOString());const{data:f,error:g}=await D.from("material_requests").update(u).eq("id",r).select().single();if(g)throw console.error("Error updating material request:",g),g;return f},generateShareToken(){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let l="";for(let o=0;o<12;o++)l+=r.charAt(Math.floor(Math.random()*r.length));return l},async createProjectShare(r,l,o,i=null){if(!Y){const j=Qe();j.projectShares||(j.projectShares=[]);const v={id:crypto.randomUUID(),project_id:r,share_token:this.generateShareToken(),created_by:l,expires_at:i,is_active:!0,permissions:o,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return j.projectShares.push(v),Ct(j),v}const{data:m,error:u}=await D.rpc("generate_share_token");if(u)throw console.error("Error generating share token:",u),u;const{data:f,error:g}=await D.from("project_shares").insert({project_id:r,share_token:m,created_by:l,expires_at:i,permissions:o}).select().single();if(g)throw console.error("Error creating project share:",g),g;return f},async getShareByToken(r){if(!Y){const i=Qe();if(!i.projectShares)return null;const m=i.projectShares.find(u=>u.share_token===r&&u.is_active&&(!u.expires_at||new Date(u.expires_at)>new Date));return m&&(m.view_count++,m.last_viewed_at=new Date().toISOString(),Ct(i)),m}const{data:l,error:o}=await D.from("project_shares").select("*, projects(*)").eq("share_token",r).eq("is_active",!0).single();return o?(console.error("Error fetching share by token:",o),null):l.expires_at&&new Date(l.expires_at)<new Date?null:(await D.rpc("increment_share_view_count",{token:r}),l)},async getProjectShares(r){if(!Y){const i=Qe();return i.projectShares?i.projectShares.filter(m=>m.project_id===r):[]}const{data:l,error:o}=await D.from("project_shares").select("*, users(name, email)").eq("project_id",r).order("created_at",{ascending:!1});return o?(console.error("Error fetching project shares:",o),[]):l||[]},async updateProjectShare(r,l){if(!Y){const m=Qe();if(!m.projectShares)return null;const u=m.projectShares.findIndex(f=>f.id===r);return u===-1?null:(m.projectShares[u]={...m.projectShares[u],...l,updated_at:new Date().toISOString()},Ct(m),m.projectShares[u])}const{data:o,error:i}=await D.from("project_shares").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating project share:",i),i;return o},async revokeProjectShare(r){return this.updateProjectShare(r,{is_active:!1})},async deleteProjectShare(r){if(!Y){const o=Qe();if(!o.projectShares)return;o.projectShares=o.projectShares.filter(i=>i.id!==r),Ct(o);return}const{error:l}=await D.from("project_shares").delete().eq("id",r);if(l)throw console.error("Error deleting project share:",l),l},async getPublicProjectData(r){const l=await this.getShareByToken(r);if(!l)return null;const o=l.project_id||l.projects?.id;if(!Y){const u=Qe(),f=u.projects.find(q=>q.id===o);if(!f)return null;const g=u.areas.filter(q=>q.project_id===o),j=g.reduce((q,L)=>q+parseFloat(L.weight||0),0),v=g.filter(q=>q.status==="done").reduce((q,L)=>q+parseFloat(L.weight||0),0),x=j>0?Math.round(v/j*100):0;return{share:l,project:f,progress:x,areas:l.permissions.progress?g:[],photos:[],dailyReports:[],tmTickets:[]}}const i=l.projects||await this.getProject(o);if(!i)return null;const m={share:l,project:i,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(l.permissions.progress){m.areas=await this.getAreas(o);const u=m.areas.reduce((g,j)=>g+parseFloat(j.weight||0),0),f=m.areas.filter(g=>g.status==="done").reduce((g,j)=>g+parseFloat(j.weight||0),0);m.progress=u>0?Math.round(f/u*100):0}if(l.permissions.photos){const{data:u}=await D.from("t_and_m_tickets").select("photos, work_date").eq("project_id",o).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);m.photos=u?.flatMap(f=>(f.photos||[]).map(g=>({url:g,date:f.work_date})))||[]}if(l.permissions.daily_reports){const{data:u}=await D.from("daily_reports").select("*").eq("project_id",o).order("report_date",{ascending:!1}).limit(10);m.dailyReports=u||[]}return l.permissions.tm_tickets&&(m.tmTickets=await this.getTMTickets(o)),m},async createInjuryReport(r){if(!Y){const i=Qe();i.injuryReports||(i.injuryReports=[]);const m={id:crypto.randomUUID(),...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return i.injuryReports.push(m),Ct(i),m}const{data:l,error:o}=await D.from("injury_reports").insert(r).select().single();if(o)throw console.error("Error creating injury report:",o),o;return l},async getInjuryReports(r){if(!Y){const i=Qe();return i.injuryReports?i.injuryReports.filter(m=>m.project_id===r).sort((m,u)=>new Date(u.incident_date)-new Date(m.incident_date)):[]}const{data:l,error:o}=await D.from("injury_reports").select("*").eq("project_id",r).order("incident_date",{ascending:!1});return o?(console.error("Error fetching injury reports:",o),[]):l||[]},async getCompanyInjuryReports(r,l=null){if(!Y){const u=Qe();if(!u.injuryReports)return[];let f=u.injuryReports.filter(g=>g.company_id===r);return l&&(f=f.filter(g=>g.status===l)),f.sort((g,j)=>new Date(j.incident_date)-new Date(g.incident_date))}let o=D.from("injury_reports").select("*, projects(name)").eq("company_id",r).order("incident_date",{ascending:!1});l&&(o=o.eq("status",l));const{data:i,error:m}=await o;return m?(console.error("Error fetching company injury reports:",m),[]):i||[]},async getInjuryReport(r){if(!Y){const i=Qe();return i.injuryReports?i.injuryReports.find(m=>m.id===r):null}const{data:l,error:o}=await D.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",r).single();return o?(console.error("Error fetching injury report:",o),null):l},async updateInjuryReport(r,l){if(!Y){const m=Qe();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(f=>f.id===r);return u===-1?null:(m.injuryReports[u]={...m.injuryReports[u],...l,updated_at:new Date().toISOString()},Ct(m),m.injuryReports[u])}const{data:o,error:i}=await D.from("injury_reports").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating injury report:",i),i;return o},async closeInjuryReport(r,l){return this.updateInjuryReport(r,{status:"closed",closed_at:new Date().toISOString(),closed_by:l})},async deleteInjuryReport(r){if(!Y){const o=Qe();if(!o.injuryReports)return;o.injuryReports=o.injuryReports.filter(i=>i.id!==r),Ct(o);return}const{error:l}=await D.from("injury_reports").delete().eq("id",r);if(l)throw console.error("Error deleting injury report:",l),l},async getInjuryStatistics(r,l=null,o=null){if(!Y){const u=Qe();if(!u.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let f=u.injuryReports.filter(g=>g.company_id===r);return l&&(f=f.filter(g=>new Date(g.incident_date)>=new Date(l))),o&&(f=f.filter(g=>new Date(g.incident_date)<=new Date(o))),{total_incidents:f.length,minor_injuries:f.filter(g=>g.injury_type==="minor").length,serious_injuries:f.filter(g=>g.injury_type==="serious").length,critical_injuries:f.filter(g=>g.injury_type==="critical").length,near_misses:f.filter(g=>g.injury_type==="near_miss").length,osha_recordable:f.filter(g=>g.osha_recordable).length,total_days_away:f.reduce((g,j)=>g+(j.days_away_from_work||0),0),total_restricted_days:f.reduce((g,j)=>g+(j.restricted_work_days||0),0)}}const{data:i,error:m}=await D.rpc("get_injury_statistics",{comp_id:r,start_date:l,end_date:o});return m?(console.error("Error fetching injury statistics:",m),null):i[0]||null},async addWitness(r,l){if(!Y){const m=Qe();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(j=>j.id===r);if(u===-1)return null;const f=m.injuryReports[u],g=f.witnesses||[];return g.push(l),m.injuryReports[u]={...f,witnesses:g,updated_at:new Date().toISOString()},Ct(m),m.injuryReports[u]}const o=await this.getInjuryReport(r);if(!o)return null;const i=o.witnesses||[];return i.push(l),this.updateInjuryReport(r,{witnesses:i})},async removeWitness(r,l){if(!Y){const m=Qe();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(j=>j.id===r);if(u===-1)return null;const f=m.injuryReports[u],g=f.witnesses||[];return g.splice(l,1),m.injuryReports[u]={...f,witnesses:g,updated_at:new Date().toISOString()},Ct(m),m.injuryReports[u]}const o=await this.getInjuryReport(r);if(!o)return null;const i=o.witnesses||[];return i.splice(l,1),this.updateInjuryReport(r,{witnesses:i})},async getCompanyUsers(r){if(Y){const{data:l,error:o}=await D.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",r);return o?(console.error("Error fetching company users:",o),[]):l?.map(i=>({id:i.user_id,name:i.users?.name||i.users?.email,email:i.users?.email,role:i.role}))||[]}return[]},async getProjectNotificationPreferences(r){if(Y){const{data:o,error:i}=await D.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",r);return i?(console.error("Error fetching notification preferences:",i),[]):o||[]}const l=Qe();return l.notificationPreferences?l.notificationPreferences.filter(o=>o.project_id===r):[]},async getUserNotificationPreferences(r){if(Y){const{data:o,error:i}=await D.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",r);return i?(console.error("Error fetching user notification preferences:",i),[]):o||[]}const l=Qe();return l.notificationPreferences?l.notificationPreferences.filter(o=>o.user_id===r):[]},async setNotificationPreference(r,l,o){if(Y){const{data:f,error:g}=await D.from("notification_preferences").upsert({project_id:r,user_id:l,notification_types:o,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(g)throw console.error("Error setting notification preference:",g),g;return f}const i=Qe();i.notificationPreferences||(i.notificationPreferences=[]);const m=i.notificationPreferences.findIndex(f=>f.project_id===r&&f.user_id===l),u={id:m>=0?i.notificationPreferences[m].id:crypto.randomUUID(),project_id:r,user_id:l,notification_types:o,created_at:m>=0?i.notificationPreferences[m].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return m>=0?i.notificationPreferences[m]=u:i.notificationPreferences.push(u),Ct(i),u},async removeNotificationPreference(r,l){if(Y){const{error:i}=await D.from("notification_preferences").delete().eq("project_id",r).eq("user_id",l);if(i)throw console.error("Error removing notification preference:",i),i;return!0}const o=Qe();return o.notificationPreferences&&(o.notificationPreferences=o.notificationPreferences.filter(i=>!(i.project_id===r&&i.user_id===l)),Ct(o)),!0},async setProjectNotificationPreferences(r,l){const o=[];for(const i of l)if(i.notificationTypes&&i.notificationTypes.length>0){const m=await this.setNotificationPreference(r,i.userId,i.notificationTypes);o.push(m)}else await this.removeNotificationPreference(r,i.userId);return o},async getNotificationPresets(r){if(Y){const{data:o,error:i}=await D.from("notification_presets").select("*").eq("company_id",r).order("name");return i?(console.error("Error fetching notification presets:",i),[]):o||[]}const l=Qe();return l.notificationPresets?l.notificationPresets.filter(o=>o.company_id===r):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:r},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:r},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:r},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:r}]},async createNotificationPreset(r,l,o){if(Y){const{data:u,error:f}=await D.from("notification_presets").insert({company_id:r,name:l,notification_types:o}).select().single();if(f)throw console.error("Error creating notification preset:",f),f;return u}const i=Qe();i.notificationPresets||(i.notificationPresets=[]);const m={id:crypto.randomUUID(),company_id:r,name:l,notification_types:o,created_at:new Date().toISOString()};return i.notificationPresets.push(m),Ct(i),m},async updateNotificationPreset(r,l,o){if(Y){const{data:u,error:f}=await D.from("notification_presets").update({name:l,notification_types:o,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(f)throw console.error("Error updating notification preset:",f),f;return u}const i=Qe();if(!i.notificationPresets)return null;const m=i.notificationPresets.findIndex(u=>u.id===r);return m===-1?null:(i.notificationPresets[m]={...i.notificationPresets[m],name:l,notification_types:o,updated_at:new Date().toISOString()},Ct(i),i.notificationPresets[m])},async deleteNotificationPreset(r){if(Y){const{error:o}=await D.from("notification_presets").delete().eq("id",r);if(o)throw console.error("Error deleting notification preset:",o),o;return!0}const l=Qe();return l.notificationPresets&&(l.notificationPresets=l.notificationPresets.filter(o=>o.id!==r),Ct(l)),!0},async getDumpSites(r){if(Y){const{data:o,error:i}=await D.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",r).eq("active",!0).order("name");return i?(console.error("Error fetching dump sites:",i),[]):o||[]}return(Qe().dumpSites||[]).filter(o=>o.company_id===r&&o.active)},async createDumpSite(r,l,o="",i=""){if(Y){const{data:f,error:g}=await D.from("dump_sites").insert({company_id:r,name:l,address:o,notes:i,active:!0}).select().single();if(g)throw console.error("Error creating dump site:",g),g;return f}const m=Qe();m.dumpSites||(m.dumpSites=[]);const u={id:crypto.randomUUID(),company_id:r,name:l,address:o,notes:i,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return m.dumpSites.push(u),Ct(m),u},async updateDumpSite(r,l){if(Y){const{data:m,error:u}=await D.from("dump_sites").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(u)throw console.error("Error updating dump site:",u),u;return m}const o=Qe();if(!o.dumpSites)return null;const i=o.dumpSites.findIndex(m=>m.id===r);return i===-1?null:(o.dumpSites[i]={...o.dumpSites[i],...l},Ct(o),o.dumpSites[i])},async deleteDumpSite(r){return this.updateDumpSite(r,{active:!1})},async setDumpSiteRate(r,l,o,i="load"){if(Y){const{data:g}=await D.from("dump_site_rates").select("id").eq("dump_site_id",r).eq("waste_type",l).maybeSingle();if(g){const{data:j,error:v}=await D.from("dump_site_rates").update({estimated_cost_per_load:o,unit:i}).eq("id",g.id).select().single();if(v)throw console.error("Error updating dump site rate:",v),v;return j}else{const{data:j,error:v}=await D.from("dump_site_rates").insert({dump_site_id:r,waste_type:l,estimated_cost_per_load:o,unit:i}).select().single();if(v)throw console.error("Error inserting dump site rate:",v),v;return j}}const m=Qe();m.dumpSiteRates||(m.dumpSiteRates=[]);const u=m.dumpSiteRates.findIndex(g=>g.dump_site_id===r&&g.waste_type===l),f={id:u>=0?m.dumpSiteRates[u].id:crypto.randomUUID(),dump_site_id:r,waste_type:l,estimated_cost_per_load:o,unit:i,created_at:new Date().toISOString()};return u>=0?m.dumpSiteRates[u]=f:m.dumpSiteRates.push(f),Ct(m),f},async getDumpSiteRates(r){if(Y){const{data:o,error:i}=await D.from("dump_site_rates").select("*").eq("dump_site_id",r);return i?(console.error("Error fetching dump site rates:",i),[]):o||[]}return(Qe().dumpSiteRates||[]).filter(o=>o.dump_site_id===r)},async getHaulOffs(r){if(Y){const{data:o,error:i}=await D.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",r).order("work_date",{ascending:!1});return i?(console.error("Error fetching haul-offs:",i),[]):o||[]}return(Qe().haulOffs||[]).filter(o=>o.project_id===r).sort((o,i)=>new Date(i.work_date)-new Date(o.work_date))},async createHaulOff(r,l){const o={project_id:r,dump_site_id:l.dumpSiteId,waste_type:l.wasteType,loads:l.loads,hauling_company:l.haulingCompany||"",work_date:l.workDate,notes:l.notes||"",estimated_cost:l.estimatedCost||0,created_by:l.createdBy||""};if(Y){const{data:u,error:f}=await D.from("haul_offs").insert(o).select().single();if(f)throw console.error("Error creating haul-off:",f),f;return u}const i=Qe();i.haulOffs||(i.haulOffs=[]);const m={...o,id:crypto.randomUUID(),created_at:new Date().toISOString()};return i.haulOffs.push(m),Ct(i),m},async calculateHaulOffCosts(r){const l=await this.getHaulOffs(r);let o=0,i=0;const m={},u=[],f={};l.forEach(j=>{const v=parseFloat(j.estimated_cost)||0,x=parseInt(j.loads)||0;o+=v,i+=x,m[j.waste_type]||(m[j.waste_type]={loads:0,cost:0}),m[j.waste_type].loads+=x,m[j.waste_type].cost+=v,f[j.work_date]||(f[j.work_date]={date:j.work_date,loads:0,cost:0}),f[j.work_date].loads+=x,f[j.work_date].cost+=v}),Object.values(f).sort((j,v)=>new Date(v.date)-new Date(j.date)).forEach(j=>u.push(j));const g=u.length;return{totalCost:o,totalLoads:i,byWasteType:m,byDate:u,daysWithHaulOff:g,avgDailyHaulOffCost:g>0?o/g:0}},subscribeToHaulOffs(r,l){return Y?D.channel(`haul_offs:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${r}`},l).subscribe():null},async createCOR(r,l=0){if(Y){let o=r.cor_number;l>0&&(o=await this.getNextCORNumber(r.project_id));const{data:i,error:m}=await D.from("change_orders").insert({company_id:r.company_id,project_id:r.project_id,area_id:r.area_id||null,cor_number:o,title:r.title,description:r.description||"",scope_of_work:r.scope_of_work,period_start:r.period_start,period_end:r.period_end,status:"draft",labor_markup_percent:r.labor_markup_percent??1500,materials_markup_percent:r.materials_markup_percent??1500,equipment_markup_percent:r.equipment_markup_percent??1500,subcontractors_markup_percent:r.subcontractors_markup_percent??500,liability_insurance_percent:r.liability_insurance_percent??144,bond_percent:r.bond_percent??100,license_fee_percent:r.license_fee_percent??10,created_by:r.created_by||null}).select().single();if((m?.code==="23505"||m?.code==="PGRST116"||m?.status===409||m?.message?.includes("duplicate")||m?.message?.includes("unique_cor_number"))&&l<3)return console.warn(`COR number conflict, retrying with fresh number (attempt ${l+1})`),this.createCOR(r,l+1);if(m)throw m;return i}return null},async updateCOR(r,l){if(Y){const{data:o,error:i}=await D.from("change_orders").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return o}return null},async deleteCOR(r){if(Y){const{error:l}=await D.from("change_orders").delete().eq("id",r);if(l)throw l}},async bulkUpdateCORGroup(r,l){if(Y){const{error:o}=await D.from("change_orders").update({group_name:l,updated_at:new Date().toISOString()}).in("id",r);if(o)throw o.message?.includes("group_name")||o.code==="PGRST204"?new Error("COR grouping requires a database migration. Please run database/migration_cor_enhancements.sql in Supabase SQL Editor."):o}},async getCORs(r,l={}){if(Y){let o=D.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",r);l.status&&(o=o.eq("status",l.status)),l.area_id&&(o=o.eq("area_id",l.area_id)),l.date_start&&(o=o.gte("period_start",l.date_start)),l.date_end&&(o=o.lte("period_end",l.date_end)),o=o.order("created_at",{ascending:!1});const{data:i,error:m}=await o;if(m)throw m;return i}return[]},async getCORById(r){if(Y){const{data:l,error:o}=await D.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              *,
              t_and_m_workers (*),
              t_and_m_items (
                *,
                materials_equipment (name, unit, cost_per_unit, category)
              )
            )
          )
        `).eq("id",r).single();if(o)throw o;return l}return null},async getCORsByArea(r,l){if(Y){const{data:o,error:i}=await D.from("change_orders").select("*").eq("project_id",r).eq("area_id",l).order("created_at",{ascending:!1});if(i)throw i;return o}return[]},async getAssignableCORs(r){if(Y){const{data:l,error:o}=await D.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",r).in("status",["draft","pending_approval","approved"]).order("cor_number",{ascending:!0});if(o)throw o;return l||[]}return[]},async getNextCORNumber(r){if(Y){const{data:l,error:o}=await D.from("change_orders").select("cor_number").eq("project_id",r);if(o)throw o;if(l&&l.length>0){let i=0;for(const m of l){const u=m.cor_number?.match(/COR #(\d+)/);if(u){const f=parseInt(u[1]);f>i&&(i=f)}}return`COR #${i+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(r,l){if(Y){const o=Math.round(l.regular_hours*l.regular_rate),i=Math.round(l.overtime_hours*l.overtime_rate),m=o+i,{data:u,error:f}=await D.from("change_order_labor").insert({change_order_id:r,labor_class:l.labor_class,wage_type:l.wage_type||"standard",regular_hours:l.regular_hours||0,overtime_hours:l.overtime_hours||0,regular_rate:l.regular_rate||0,overtime_rate:l.overtime_rate||0,regular_total:o,overtime_total:i,total:m,sort_order:l.sort_order||0,source_ticket_id:l.source_ticket_id||null}).select().single();if(f)throw f;return u}return null},async updateCORLaborItem(r,l){if(Y){let o={...l};if(l.regular_hours!==void 0||l.regular_rate!==void 0||l.overtime_hours!==void 0||l.overtime_rate!==void 0){const{data:u}=await D.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",r).single(),f=l.regular_hours??u?.regular_hours??0,g=l.overtime_hours??u?.overtime_hours??0,j=l.regular_rate??u?.regular_rate??0,v=l.overtime_rate??u?.overtime_rate??0;o.regular_total=Math.round(f*j),o.overtime_total=Math.round(g*v),o.total=o.regular_total+o.overtime_total}const{data:i,error:m}=await D.from("change_order_labor").update(o).eq("id",r).select().single();if(m)throw m;return i}return null},async deleteCORLaborItem(r){if(Y){const{error:l}=await D.from("change_order_labor").delete().eq("id",r);if(l)throw l}},async addCORMaterialItem(r,l){if(Y){const o=Math.round(l.quantity*l.unit_cost),{data:i,error:m}=await D.from("change_order_materials").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"each",unit_cost:l.unit_cost||0,total:o,source_type:l.source_type||"custom",source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(m)throw m;return i}return null},async updateCORMaterialItem(r,l){if(Y){let o={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:u}=await D.from("change_order_materials").select("quantity, unit_cost").eq("id",r).single(),f=l.quantity??u?.quantity??1,g=l.unit_cost??u?.unit_cost??0;o.total=Math.round(f*g)}const{data:i,error:m}=await D.from("change_order_materials").update(o).eq("id",r).select().single();if(m)throw m;return i}return null},async deleteCORMaterialItem(r){if(Y){const{error:l}=await D.from("change_order_materials").delete().eq("id",r);if(l)throw l}},async addCOREquipmentItem(r,l){if(Y){const o=Math.round(l.quantity*l.unit_cost),{data:i,error:m}=await D.from("change_order_equipment").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"day",unit_cost:l.unit_cost||0,total:o,source_type:l.source_type||"custom",source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(m)throw m;return i}return null},async updateCOREquipmentItem(r,l){if(Y){let o={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:u}=await D.from("change_order_equipment").select("quantity, unit_cost").eq("id",r).single(),f=l.quantity??u?.quantity??1,g=l.unit_cost??u?.unit_cost??0;o.total=Math.round(f*g)}const{data:i,error:m}=await D.from("change_order_equipment").update(o).eq("id",r).select().single();if(m)throw m;return i}return null},async deleteCOREquipmentItem(r){if(Y){const{error:l}=await D.from("change_order_equipment").delete().eq("id",r);if(l)throw l}},async addCORSubcontractorItem(r,l){if(Y){const o=Math.round(l.quantity*l.unit_cost),{data:i,error:m}=await D.from("change_order_subcontractors").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"lump sum",unit_cost:l.unit_cost||0,total:o,source_type:l.source_type||"custom",source_reference:l.source_reference||null,sort_order:l.sort_order||0}).select().single();if(m)throw m;return i}return null},async updateCORSubcontractorItem(r,l){if(Y){let o={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:u}=await D.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",r).single(),f=l.quantity??u?.quantity??1,g=l.unit_cost??u?.unit_cost??0;o.total=Math.round(f*g)}const{data:i,error:m}=await D.from("change_order_subcontractors").update(o).eq("id",r).select().single();if(m)throw m;return i}return null},async deleteCORSubcontractorItem(r){if(Y){const{error:l}=await D.from("change_order_subcontractors").delete().eq("id",r);if(l)throw l}},async addBulkLaborItems(r,l){if(Y&&l.length>0){const o=l.map((u,f)=>{const g=Math.round(u.regular_hours*u.regular_rate),j=Math.round(u.overtime_hours*u.overtime_rate);return{change_order_id:r,labor_class:u.labor_class,wage_type:u.wage_type||"standard",regular_hours:u.regular_hours||0,overtime_hours:u.overtime_hours||0,regular_rate:u.regular_rate||0,overtime_rate:u.overtime_rate||0,regular_total:g,overtime_total:j,total:g+j,sort_order:u.sort_order??f,source_ticket_id:u.source_ticket_id||null}}),{data:i,error:m}=await D.from("change_order_labor").insert(o).select();if(m)throw m;return i}return[]},async addBulkMaterialItems(r,l){if(Y&&l.length>0){const o=l.map((u,f)=>({change_order_id:r,description:u.description,quantity:u.quantity||1,unit:u.unit||"each",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,source_ticket_id:u.source_ticket_id||null,sort_order:u.sort_order??f})),{data:i,error:m}=await D.from("change_order_materials").insert(o).select();if(m)throw m;return i}return[]},async addBulkEquipmentItems(r,l){if(Y&&l.length>0){const o=l.map((u,f)=>({change_order_id:r,description:u.description,quantity:u.quantity||1,unit:u.unit||"day",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,source_ticket_id:u.source_ticket_id||null,sort_order:u.sort_order??f})),{data:i,error:m}=await D.from("change_order_equipment").insert(o).select();if(m)throw m;return i}return[]},async addBulkSubcontractorItems(r,l){if(Y&&l.length>0){const o=l.map((u,f)=>({change_order_id:r,company_name:u.company_name||"",description:u.description||"",quantity:u.quantity||1,unit:u.unit||"lump sum",unit_cost:u.unit_cost||u.total||u.amount||0,total:u.total||u.amount||0,source_type:u.source_type||"invoice",source_reference:u.source_reference||null,sort_order:u.sort_order??f})),{data:i,error:m}=await D.from("change_order_subcontractors").insert(o).select();if(m)throw m;return i}return[]},async clearCORLineItems(r){Y&&(await D.from("change_order_labor").delete().eq("change_order_id",r),await D.from("change_order_materials").delete().eq("change_order_id",r),await D.from("change_order_equipment").delete().eq("change_order_id",r),await D.from("change_order_subcontractors").delete().eq("change_order_id",r))},async saveCORLineItems(r,{laborItems:l,materialItems:o,equipmentItems:i,subcontractorItems:m}){if(Y){await this.clearCORLineItems(r);const u=await Promise.all([l?.length>0?this.addBulkLaborItems(r,l):[],o?.length>0?this.addBulkMaterialItems(r,o):[],i?.length>0?this.addBulkEquipmentItems(r,i):[],m?.length>0?this.addBulkSubcontractorItems(r,m):[]]);return{labor:u[0],materials:u[1],equipment:u[2],subcontractors:u[3]}}return null},async assignTicketToCOR(r,l){if(Y){const{error:o}=await D.rpc("assign_ticket_to_cor",{p_ticket_id:r,p_cor_id:l});if(o)throw ea.error("database",{message:o.message,operation:"assignTicketToCOR",extra:{ticketId:r,corId:l}}),o;return{ticket_id:r,change_order_id:l}}return null},async unassignTicketFromCOR(r,l){if(Y){const{error:o}=await D.rpc("unassign_ticket_from_cor",{p_ticket_id:r,p_cor_id:l});if(o)throw ea.error("database",{message:o.message,operation:"unassignTicketFromCOR",extra:{ticketId:r,corId:l}}),o}},async checkTicketCORIntegrity(){if(Y){const{data:r,error:l}=await D.rpc("check_ticket_cor_integrity");if(l)throw l;return r||[]}return[]},async fixTicketCORIntegrity(){if(Y){const{data:r,error:l}=await D.rpc("fix_ticket_cor_integrity");if(l)throw l;return r}return 0},async getTicketsForCOR(r){if(Y){const{data:l,error:o}=await D.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",r);if(o)throw o;return l}return[]},async getUnassignedTickets(r){if(Y){const{data:l,error:o}=await D.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(o)throw o;return l}return[]},async importTicketDataToCOR(r,l,o,i,m){if(Y){const{data:u,error:f}=await D.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",r).single();if(f)throw f;const{data:g,error:j}=await D.from("labor_rates").select("*").eq("company_id",o).eq("work_type",i||"demolition").eq("job_type",m||"standard");if(j)throw j;const v={};g?.forEach(V=>{v[V.role.toLowerCase()]=V});const x={};u.t_and_m_workers?.forEach(V=>{const J=(V.role||"laborer").toLowerCase();x[J]||(x[J]={regular_hours:0,overtime_hours:0}),x[J].regular_hours+=parseFloat(V.hours)||0,x[J].overtime_hours+=parseFloat(V.overtime_hours)||0});const q=Object.entries(x).map(([V,J])=>{const ae=v[V]||{regular_rate:0,overtime_rate:0},F=Math.round((parseFloat(ae.regular_rate)||0)*100),R=Math.round((parseFloat(ae.overtime_rate)||0)*100);return{labor_class:V.charAt(0).toUpperCase()+V.slice(1),wage_type:m||"standard",regular_hours:J.regular_hours,overtime_hours:J.overtime_hours,regular_rate:F,overtime_rate:R,source_ticket_id:r}});q.length>0&&await this.addBulkLaborItems(l,q);const L=[],M=[];u.t_and_m_items?.forEach(V=>{const J=V.custom_name||V.materials_equipment?.name||"Unknown Item",ae=V.custom_category||V.materials_equipment?.category||"Other",F=V.materials_equipment?.unit||"each",R=Math.round((parseFloat(V.materials_equipment?.cost_per_unit)||0)*100),S={description:J,quantity:V.quantity||1,unit:F,unit_cost:R,source_type:"backup_sheet",source_ticket_id:r};ae==="Equipment"?M.push(S):L.push(S)}),L.length>0&&await this.addBulkMaterialItems(l,L),M.length>0&&await this.addBulkEquipmentItems(l,M);const{error:P}=await D.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString()}).eq("change_order_id",l).eq("ticket_id",r);if(P)throw P;return{laborItems:q,materialItems:L,equipmentItems:M}}return null},async reimportTicketDataToCOR(r,l,o,i,m){return Y?(await D.from("change_order_labor").delete().eq("change_order_id",l).eq("source_ticket_id",r),await D.from("change_order_materials").delete().eq("change_order_id",l).eq("source_ticket_id",r),await D.from("change_order_equipment").delete().eq("change_order_id",l).eq("source_ticket_id",r),this.importTicketDataToCOR(r,l,o,i,m)):null},async recalculateCOR(r){if(Y){const{error:l}=await D.rpc("recalculate_cor_totals",{cor_id:r});if(l)throw l;return this.getCORById(r)}return null},async updateCORMarkupPercentages(r,l){if(Y){const o={};l.labor!==void 0&&(o.labor_markup_percent=l.labor),l.materials!==void 0&&(o.materials_markup_percent=l.materials),l.equipment!==void 0&&(o.equipment_markup_percent=l.equipment),l.subcontractors!==void 0&&(o.subcontractors_markup_percent=l.subcontractors);const{data:i,error:m}=await D.from("change_orders").update(o).eq("id",r).select().single();if(m)throw m;return i}return null},async updateCORFeePercentages(r,l){if(Y){const o={};l.liabilityInsurance!==void 0&&(o.liability_insurance_percent=l.liabilityInsurance),l.bond!==void 0&&(o.bond_percent=l.bond),l.licenseFee!==void 0&&(o.license_fee_percent=l.licenseFee);const{data:i,error:m}=await D.from("change_orders").update(o).eq("id",r).select().single();if(m)throw m;return i}return null},async submitCORForApproval(r){if(Y){const{data:l,error:o}=await D.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",r).select().single();if(o)throw o;return l}return null},async approveCOR(r,l){if(Y){const{data:o,error:i}=await D.from("change_orders").update({status:"approved",approved_by:l,approved_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return o}return null},async rejectCOR(r,l=null){if(Y){const{data:o,error:i}=await D.from("change_orders").update({status:"rejected",rejection_reason:l}).eq("id",r).select().single();if(i)throw i;return o}return null},async markCORAsBilled(r){if(Y){const{data:l,error:o}=await D.from("change_orders").update({status:"billed"}).eq("id",r).select().single();if(o)throw o;return l}return null},async closeCOR(r){if(Y){const{data:l,error:o}=await D.from("change_orders").update({status:"closed"}).eq("id",r).select().single();if(o)throw o;return l}return null},async saveCORSignature(r,l,o){if(Y){const{data:i,error:m}=await D.from("change_orders").update({gc_signature_data:l,gc_signature_name:o,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",r).select().single();if(m)throw m;return i}return null},async getCORStats(r){if(Y){const{data:l,error:o}=await D.from("change_orders").select("status, cor_total").eq("project_id",r);if(o)throw o;const i={total_cors:l.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return l.forEach(m=>{switch(m.status){case"draft":i.draft_count++;break;case"pending_approval":i.pending_count++,i.total_pending_value+=m.cor_total||0;break;case"approved":i.approved_count++,i.total_approved_value+=m.cor_total||0;break;case"rejected":i.rejected_count++;break;case"billed":case"closed":i.billed_count++,i.total_billed_value+=m.cor_total||0;break}}),i}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(r,l){return Y?D.channel(`change_orders:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCorTickets(r,l){return Y?D.channel(`cor-tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${r}`},l).subscribe():null},async createSignatureRequest(r,l,o,i,m=null,u=null){if(Y){const{data:f,error:g}=await D.rpc("generate_signature_token");if(g)throw g;const{data:j,error:v}=await D.from("signature_requests").insert({document_type:r,document_id:l,company_id:o,project_id:i,signature_token:f,expires_at:u,created_by:m}).select().single();if(v)throw v;return j}return null},async getSignatureRequestByToken(r){if(Y){await D.rpc("increment_signature_view_count",{token:r});const{data:l,error:o}=await D.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",r).single();if(o)throw o;return l}return null},async getSignatureRequestsForDocument(r,l){if(Y){const{data:o,error:i}=await D.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",r).eq("document_id",l).order("created_at",{ascending:!1});if(i)throw i;return o||[]}return[]},async addSignature(r,l,o){if(Y){const{data:i,error:m}=await D.from("signatures").insert({signature_request_id:r,signature_slot:l,signature_image:o.signature,signer_name:o.signerName,signer_title:o.signerTitle||null,signer_company:o.signerCompany||null,signed_at:o.signedAt||new Date().toISOString(),ip_address:o.ipAddress||null,user_agent:o.userAgent||null}).select().single();if(m)throw m;return i}return null},async syncSignatureToDocument(r,l){if(!Y)return null;const{document_type:o,document_id:i}=l,m=r.signature_slot,u={};m===1?(u.gc_signature_data=r.signature_image,u.gc_signature_name=r.signer_name,u.gc_signature_title=r.signer_title,u.gc_signature_company=r.signer_company,u.gc_signature_date=r.signed_at,u.gc_signature_ip=r.ip_address):m===2&&(u.client_signature_data=r.signature_image,u.client_signature_name=r.signer_name,u.client_signature_title=r.signer_title,u.client_signature_company=r.signer_company,u.client_signature_date=r.signed_at,u.client_signature_ip=r.ip_address);const f=o==="cor"?"change_orders":"t_and_m_tickets",{data:g,error:j}=await D.from(f).update(u).eq("id",i).select().single();if(j)throw j;return g},async revokeSignatureRequest(r){if(Y){const{data:l,error:o}=await D.from("signature_requests").update({status:"revoked"}).eq("id",r).select().single();if(o)throw o;return l}return null},async getDocumentForSigning(r,l){if(!Y)return null;if(r==="cor"){const{data:o,error:i}=await D.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",l).single();if(i)throw i;return o}else if(r==="tm_ticket"){const{data:o,error:i}=await D.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (*)
        `).eq("id",l).single();if(i)throw i;return o}return null},async getProjectCosts(r){if(Y){const{data:o,error:i}=await D.from("project_costs").select("*").eq("project_id",r).order("cost_date",{ascending:!1});return i?(console.error("Error fetching project costs:",i),[]):o||[]}return(Qe().projectCosts||[]).filter(o=>o.project_id===r).sort((o,i)=>new Date(i.cost_date)-new Date(o.cost_date))},async addProjectCost(r,l,o){const i={project_id:r,company_id:l,category:o.category,description:o.description,amount:parseFloat(o.amount),cost_date:o.cost_date||new Date().toISOString().split("T")[0],notes:o.notes||null,created_by:o.created_by||null};if(Y){const{data:f,error:g}=await D.from("project_costs").insert(i).select().single();if(g)throw console.error("Error adding project cost:",g),g;return f}const m=Qe();m.projectCosts||(m.projectCosts=[]);const u={...i,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return m.projectCosts.push(u),Ct(m),u},async updateProjectCost(r,l){const o={category:l.category,description:l.description,amount:parseFloat(l.amount),cost_date:l.cost_date,notes:l.notes||null,updated_at:new Date().toISOString()};if(Y){const{data:u,error:f}=await D.from("project_costs").update(o).eq("id",r).select().single();if(f)throw console.error("Error updating project cost:",f),f;return u}const i=Qe();if(!i.projectCosts)return null;const m=i.projectCosts.findIndex(u=>u.id===r);return m===-1?null:(i.projectCosts[m]={...i.projectCosts[m],...o},Ct(i),i.projectCosts[m])},async deleteProjectCost(r){if(Y){const{error:o}=await D.from("project_costs").delete().eq("id",r);if(o)throw console.error("Error deleting project cost:",o),o;return!0}const l=Qe();return l.projectCosts&&(l.projectCosts=l.projectCosts.filter(o=>o.id!==r),Ct(l)),!0},async getProjectCostsSummary(r){const l=await this.getProjectCosts(r),o={};let i=0;return l.forEach(m=>{const u=parseFloat(m.amount)||0;i+=u,o[m.category]||(o[m.category]={category:m.category,total:0,count:0,items:[]}),o[m.category].total+=u,o[m.category].count++,o[m.category].items.push(m)}),Object.values(o).forEach(m=>{m.percentage=i>0?m.total/i*100:0}),{totalCost:i,byCategory:o,itemCount:l.length}}};tf(async r=>{if(r&&Y){console.log("Back online - syncing pending actions...");try{const l=await Ix(te);l.synced>0&&console.log(`Synced ${l.synced} pending actions`),l.failed>0&&console.warn(`Failed to sync ${l.failed} actions`)}catch(l){console.error("Error syncing pending actions:",l)}}});const nf=p.createContext(),Ya={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function On({children:r,companyId:l}){const[o,i]=p.useState(Ya),[m,u]=p.useState(!0);p.useEffect(()=>{l?f(l):g()},[l]),p.useEffect(()=>{x(o)},[o]);const f=async M=>{try{if(u(!0),!Y){i(Ya),u(!1);return}const{data:P,error:V}=await D.from("company_branding").select("*").eq("company_id",M).single();V?(V.code==="PGRST116"?await j(M):console.error("Error loading branding:",V),i(Ya)):i({...Ya,...P})}catch(P){console.error("Error in loadBranding:",P),i(Ya)}finally{u(!1)}},g=async()=>{try{u(!0);const M=window.location.hostname;if(M==="localhost"||M==="127.0.0.1"){i(Ya),u(!1);return}if(!Y){i(Ya),u(!1);return}const{data:P,error:V}=await D.rpc("get_branding_by_domain",{domain_name:M});V||!P||P.length===0?i(Ya):i({...Ya,...P[0]})}catch(M){console.error("Error loading branding by domain:",M),i(Ya)}finally{u(!1)}},j=async M=>{try{const{data:P,error:V}=await D.from("company_branding").insert({company_id:M,...Ya}).select().single();V&&console.error("Error creating default branding:",V)}catch(P){console.error("Error in createDefaultBranding:",P)}},v=async M=>{try{if(!Y)return i(S=>({...S,...M})),{success:!0};if(!l)return{success:!1,error:"No company ID"};const P={},V=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const S of V)M[S]!==void 0&&(P[S]=M[S]);const{data:J,error:ae}=await D.from("company_branding").select("id").eq("company_id",l).single();if(ae&&ae.code==="PGRST116"){const{data:S,error:K}=await D.from("company_branding").insert({company_id:l,...P}).select().single();return K?(console.error("Error creating branding:",K),{success:!1,error:K.message}):(i({...Ya,...S}),{success:!0,data:S})}const{data:F,error:R}=await D.from("company_branding").update(P).eq("company_id",l).select().single();return R?(console.error("Error updating branding:",R),{success:!1,error:R.message}):(i({...Ya,...F}),{success:!0,data:F})}catch(P){return console.error("Error in updateBranding:",P),{success:!1,error:P.message}}},x=M=>{const P=document.documentElement;if(P.style.setProperty("--primary-color",M.primary_color),P.style.setProperty("--secondary-color",M.secondary_color),M.favicon_url){let V=document.querySelector("link[rel*='icon']");V||(V=document.createElement("link"),V.rel="icon",document.head.appendChild(V)),V.href=M.favicon_url}document.title=M.custom_app_name||"FieldSync"},L={branding:o,loading:m,updateBranding:v,uploadBrandingImage:async(M,P)=>{try{if(!Y)return{success:!0,url:URL.createObjectURL(M)};const V=M.name.split(".").pop(),ae=`branding/${`${l}/${P}-${Date.now()}.${V}`}`,{data:F,error:R}=await D.storage.from("public").upload(ae,M,{cacheControl:"3600",upsert:!0});if(R)return console.error("Error uploading image:",R),{success:!1,error:R.message};const{data:{publicUrl:S}}=D.storage.from("public").getPublicUrl(ae);return{success:!0,url:S}}catch(V){return console.error("Error in uploadBrandingImage:",V),{success:!1,error:V.message}}},refreshBranding:()=>l?f(l):g()};return e.jsx(nf.Provider,{value:L,children:r})}function wr(){const r=p.useContext(nf);if(!r)throw new Error("useBranding must be used within a BrandingProvider");return r}const rf=p.createContext();function Rn({children:r}){const[l,o]=p.useState(()=>{const m=localStorage.getItem("fieldsync-theme");return m==="light"||m==="dark"?m:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"});p.useEffect(()=>{document.documentElement.setAttribute("data-theme",l),localStorage.setItem("fieldsync-theme",l)},[l]),p.useEffect(()=>{const m=window.matchMedia("(prefers-color-scheme: light)"),u=f=>{localStorage.getItem("fieldsync-theme")||o(f.matches?"light":"dark")};return m.addEventListener("change",u),()=>m.removeEventListener("change",u)},[]);const i=()=>{o(m=>m==="dark"?"light":"dark")};return e.jsx(rf.Provider,{value:{theme:l,setTheme:o,toggleTheme:i},children:r})}function ej(){const r=p.useContext(rf);if(!r)throw new Error("useTheme must be used within a ThemeProvider");return r}const tj=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),aj=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(l,o,i)=>i?i.toUpperCase():o.toLowerCase()),Ep=r=>{const l=aj(r);return l.charAt(0).toUpperCase()+l.slice(1)},lf=(...r)=>r.filter((l,o,i)=>!!l&&l.trim()!==""&&i.indexOf(l)===o).join(" ").trim(),sj=r=>{for(const l in r)if(l.startsWith("aria-")||l==="role"||l==="title")return!0};var nj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const rj=p.forwardRef(({color:r="currentColor",size:l=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:m="",children:u,iconNode:f,...g},j)=>p.createElement("svg",{ref:j,...nj,width:l,height:l,stroke:r,strokeWidth:i?Number(o)*24/Number(l):o,className:lf("lucide",m),...!u&&!sj(g)&&{"aria-hidden":"true"},...g},[...f.map(([v,x])=>p.createElement(v,x)),...Array.isArray(u)?u:[u]]));const Le=(r,l)=>{const o=p.forwardRef(({className:i,...m},u)=>p.createElement(rj,{ref:u,iconNode:l,className:lf(`lucide-${tj(Ep(r))}`,`lucide-${r}`,i),...m}));return o.displayName=Ep(r),o};const lj=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],ij=Le("bell",lj);const cj=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],vl=Le("briefcase",cj);const oj=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Hi=Le("building-2",oj);const dj=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],uj=Le("building",dj);const mj=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],kr=Le("calendar",mj);const hj=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Nr=Le("camera",hj);const pj=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Pa=Le("check",pj);const fj=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ka=Le("chevron-down",fj);const gj=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Hs=Le("chevron-right",gj);const xj=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],cf=Le("chevron-up",xj);const jj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Cr=Le("circle-alert",jj);const vj=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],fs=Le("circle-check-big",vj);const yj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],rd=Le("circle-check",yj);const bj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Dp=Le("circle-x",bj);const _j=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],as=Le("clipboard-list",_j);const Nj=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],xn=Le("clock",Nj);const Sj=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],bd=Le("copy",Sj);const Cj=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Sr=Le("dollar-sign",Cj);const wj=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],of=Le("download",wj);const kj=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],df=Le("ellipsis",kj);const Ej=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Mp=Le("external-link",Ej);const Dj=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Mj=Le("eye",Dj);const Tj=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ma=Le("file-text",Tj);const Aj=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],zj=Le("flame",Aj);const Oj=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Rj=Le("folder-plus",Oj);const qj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Lj=Le("globe",qj);const Uj=[["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["rect",{x:"2",y:"15",width:"20",height:"4",rx:"1",key:"g3x8cw"}]],Ea=Le("hard-hat",Uj);const Hj=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Bj=Le("image",Hj);const Fj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],_d=Le("info",Fj);const $j=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Tp=Le("layout-grid",$j);const Vj=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Gj=Le("link-2",Vj);const Yj=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],kd=Le("link",Yj);const Pj=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Qj=Le("loader-circle",Pj);const Xj=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Ap=Le("lock",Xj);const Zj=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Ij=Le("map-pin",Zj);const Jj=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],uf=Le("message-square",Jj);const Wj=[["path",{d:"M5 12h14",key:"1ays0h"}]],Nd=Le("minus",Wj);const Kj=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],ev=Le("moon",Kj);const tv=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Fn=Le("package",tv);const av=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],jl=Le("pen-line",av);const sv=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],ld=Le("pen-tool",sv);const nv=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ed=Le("pen",nv);const rv=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Dd=Le("pencil",rv);const lv=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],iv=Le("percent",lv);const cv=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],ov=Le("phone",cv);const dv=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],gs=Le("plus",dv);const uv=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],mv=Le("refresh-cw",uv);const hv=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Md=Le("rotate-ccw",hv);const pv=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],fv=Le("save",pv);const gv=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Bi=Le("search",gv);const xv=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Td=Le("send",xv);const jv=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],$i=Le("shield",jv);const vv=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Sd=Le("square-check-big",vv);const yv=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],bv=Le("square",yv);const _v=[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]],Nv=Le("stamp",_v);const Sv=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Cv=Le("sun",Sv);const wv=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Us=Le("trash-2",wv);const kv=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],mf=Le("trending-down",kv);const Ev=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],hf=Le("trending-up",Ev);const Dv=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],yl=Le("triangle-alert",Dv);const Mv=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],rs=Le("truck",Mv);const Tv=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Av=Le("upload",Tv);const zv=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],pf=Le("user-check",zv);const Ov=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],ff=Le("user-minus",Ov);const Rv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],qv=Le("user-plus",Rv);const Lv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Uv=Le("user-x",Lv);const Hv=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Ad=Le("user",Hv);const Bv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Bs=Le("users",Bv);const Fv=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],bl=Le("wrench",Fv);const $v=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ta=Le("x",$v);const Vv=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Cd=Le("zap",Vv);function ds({className:r="",showPoweredBy:l=!1}){const{branding:o}=wr();return e.jsxs("div",{className:`app-logo ${r}`,children:[o.logo_url?e.jsx("img",{src:o.logo_url,alt:o.custom_app_name||"Logo",className:"custom-logo"}):e.jsxs("div",{className:"logo",children:[o.custom_app_name||"Field",e.jsx("span",{children:"Sync"})]}),l&&!o.hide_fieldsync_branding&&e.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function Gv({onForemanAccess:r,onOfficeLogin:l,onShowToast:o}){const[i,m]=p.useState(null),[u,f]=p.useState(""),[g,j]=p.useState(null),[v,x]=p.useState(""),[q,L]=p.useState(!1),[M,P]=p.useState(""),[V,J]=p.useState(""),[ae,F]=p.useState(1),[R,S]=p.useState(null),[K,pe]=p.useState(""),[$,G]=p.useState(""),[B,Z]=p.useState(""),[C,b]=p.useState(""),A=T=>{const je=T.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);f(je)},z=async()=>{if(u.length<2){o("Enter company code","error");return}L(!0);try{const T=await te.getCompanyByCode(u);T?j(T):(o("Invalid company code","error"),f(""))}catch{o("Error checking code","error")}finally{L(!1)}},de=async T=>{if(T.length===4){L(!0);try{const je=await te.getProjectByPinAndCompany(T,g.id);je?r(je):(o("Invalid PIN","error"),x(""))}catch{o("Error checking PIN","error")}finally{L(!1)}}},N=T=>{if(v.length<4){const je=v+T;x(je),je.length===4&&setTimeout(()=>de(je),200)}},se=()=>{x(T=>T.slice(0,-1))},E=()=>{j(null),x("")},xe=()=>{if(!M.trim()||!V.trim()){o("Enter email and password","error");return}l(M,V)},k=async()=>{if(u.length<2){o("Enter company code","error");return}L(!0);try{const T=await te.getCompanyByCode(u);T?(S(T),F(2)):(o("Invalid company code","error"),f(""))}catch{o("Error checking code","error")}finally{L(!1)}},U=async()=>{if(!K.trim()){o("Enter office code","error");return}L(!0);try{const{data:T,error:je}=await D.rpc("verify_office_code",{company_id:R.id,code:K.trim()});if(je)throw je;T===!0?F(3):(o("Invalid office code","error"),pe(""))}catch{o("Error verifying code","error")}finally{L(!1)}},ie=async()=>{if(!$.trim()){o("Enter your name","error");return}if(!B.trim()||!B.includes("@")){o("Enter valid email","error");return}if(C.length<6){o("Password must be 6+ characters","error");return}L(!0);try{const T=B.toLowerCase().trim(),{data:je,error:I}=await D.auth.signUp({email:T,password:C});let ke;if(I?.message?.includes("already registered")||je?.user&&je.user.identities?.length===0){const{data:Te,error:Be}=await D.auth.signInWithPassword({email:T,password:C});if(Be){o("Account exists with different password. Use your existing password.","error"),L(!1);return}ke=Te.user.id;const{data:ze}=await D.from("user_companies").select("id, status").eq("user_id",ke).eq("company_id",R.id).maybeSingle();if(ze){ze.status==="active"?(o("You already belong to this company. Logging you in...","success"),setTimeout(()=>window.location.reload(),1e3)):ze.status==="pending"?(o("Your request is still pending approval.","error"),await D.auth.signOut()):(o("Your membership was removed. Contact the company admin.","error"),await D.auth.signOut());return}const{error:Oe}=await D.from("user_companies").insert({user_id:ke,company_id:R.id,role:"member",status:"pending"});if(Oe)throw console.error("Error adding to user_companies:",Oe),await D.auth.signOut(),new Error("Failed to submit join request");await D.auth.signOut(),o("Request to join submitted! Awaiting admin approval.","success")}else{if(I)throw I;{if(ke=je.user?.id,!ke)throw new Error("Failed to create user");const{error:Te}=await D.from("users").insert({id:ke,email:T,password_hash:"managed_by_supabase_auth",name:$.trim(),company_id:R.id,role:"member",is_active:!0});if(Te)throw Te;const{error:Be}=await D.from("user_companies").insert({user_id:ke,company_id:R.id,role:"member",status:"pending"});if(Be)throw console.error("Error adding to user_companies:",Be),new Error("Failed to submit join request");await D.auth.signOut(),o("Account created! Awaiting admin approval.","success")}}}catch(T){console.error("Join error:",T),o(T.message||"Error creating account","error")}finally{L(!1)}};if(i===null)return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx(ds,{className:"entry-logo",showPoweredBy:!1}),e.jsxs("div",{className:"entry-buttons",children:[e.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>m("foreman"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(Ea,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Foreman"}),e.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),e.jsxs("button",{className:"entry-mode-btn office",onClick:()=>m("office"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(vl,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Office"}),e.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(i==="foreman")return g?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:E,children:""}),e.jsx(ds,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:g.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),e.jsx("div",{className:"pin-display",children:[0,1,2,3].map(T=>e.jsx("div",{className:`pin-dot ${v.length>T?"filled":""}`,children:v.length>T?"":""},T))}),e.jsxs("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map(T=>e.jsx("button",{className:"num-btn",onClick:()=>N(T.toString()),disabled:q,children:T},T)),e.jsx("button",{className:"num-btn empty",disabled:!0}),e.jsx("button",{className:"num-btn",onClick:()=>N("0"),disabled:q,children:"0"}),e.jsx("button",{className:"num-btn backspace",onClick:se,disabled:q||v.length===0,children:""})]}),q&&e.jsx("div",{className:"entry-loading",children:e.jsx("div",{className:"spinner"})})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m(null),children:""}),e.jsx(ds,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:u,onChange:T=>A(T.target.value),placeholder:"Company Code",disabled:q,autoFocus:!0,onKeyDown:T=>{T.key==="Enter"&&z()}}),e.jsx("button",{className:"entry-submit-btn",onClick:z,disabled:q||u.length<2,children:q?"...":""})]})]})});if(i==="office")return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m(null),children:""}),e.jsx(ds,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"email",value:M,onChange:T=>P(T.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:T=>{T.key==="Enter"&&xe()}}),e.jsx("input",{type:"password",value:V,onChange:T=>J(T.target.value),placeholder:"Password",onKeyDown:T=>{T.key==="Enter"&&xe()}}),e.jsx("button",{className:"entry-login-btn",onClick:xe,children:"Sign In"})]}),e.jsxs("div",{className:"entry-signup-hint",children:[e.jsx("p",{children:"New employee?"}),e.jsx("button",{className:"entry-join-link",onClick:()=>m("join"),children:"Join your company"})]})]})});if(i==="join")return ae===1?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m("office"),children:""}),e.jsx(ds,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),e.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:u,onChange:T=>A(T.target.value),placeholder:"Company Code",disabled:q,autoFocus:!0,onKeyDown:T=>{T.key==="Enter"&&k()}}),e.jsx("button",{className:"entry-submit-btn",onClick:k,disabled:q||u.length<2,children:q?"...":""})]})]})}):ae===2?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{F(1),S(null),pe("")},children:""}),e.jsx(ds,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:R?.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),e.jsx("p",{className:"entry-hint",children:"This code is only for office staff"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"password",value:K,onChange:T=>pe(T.target.value),placeholder:"Office Code",disabled:q,autoFocus:!0,onKeyDown:T=>{T.key==="Enter"&&U()}}),e.jsx("button",{className:"entry-submit-btn",onClick:U,disabled:q||!K.trim(),children:q?"...":""})]})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{F(2),pe("")},children:""}),e.jsx(ds,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:R?.name}),e.jsx("p",{className:"entry-subtitle",children:"Create your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"text",value:$,onChange:T=>G(T.target.value),placeholder:"Your Name",autoFocus:!0}),e.jsx("input",{type:"email",value:B,onChange:T=>Z(T.target.value),placeholder:"Email"}),e.jsx("input",{type:"password",value:C,onChange:T=>b(T.target.value),placeholder:"Password (6+ characters)",onKeyDown:T=>{T.key==="Enter"&&ie()}}),e.jsx("button",{className:"entry-login-btn",onClick:ie,disabled:q,children:q?"Creating...":"Join Company"})]}),e.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})})}function Vt(r){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}function Yv(r){if(!r||r.length===0)return 0;let l=0;return r.forEach(o=>{o.status==="done"&&(l+=o.weight)}),Math.round(l)}function zp(r){if(!r||r.length===0)return{progress:0,earnedValue:0,totalValue:0,isValueBased:!1};if(r.some(i=>i.scheduled_value>0)){const i=r.reduce((f,g)=>f+(g.scheduled_value||0),0),m=r.filter(f=>f.status==="done").reduce((f,g)=>f+(g.scheduled_value||0),0);return{progress:i>0?Math.round(m/i*100):0,earnedValue:m,totalValue:i,isValueBased:!0}}const o=r.filter(i=>i.status==="done").reduce((i,m)=>i+(m.weight||0),0);return{progress:Math.round(o),earnedValue:0,totalValue:0,isValueBased:!1}}function gf(r){if(!r||r.length===0)return"not_started";const l=r.some(m=>m.status==="working"),o=r.some(m=>m.status==="done");return r.every(m=>m.status==="done")?"done":l||o?"working":"not_started"}function Pv(r){const l=gf(r);return l==="done"?"Complete":l==="working"?"In Progress":"Not Started"}function Qv(r,l=0){const o=new Date;o.setHours(0,0,0,0);const i={scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1};if(r.start_date&&r.end_date){const m=new Date(r.start_date),u=new Date(r.end_date);m.setHours(0,0,0,0),u.setHours(0,0,0,0);const f=Math.max(1,Math.ceil((u-m)/(1e3*60*60*24))),g=Math.max(0,Math.ceil((o-m)/(1e3*60*60*24))),j=Math.min(100,g/f*100),x=(r.progress||0)-j;i.scheduleVariance=Math.round(x),i.hasScheduleData=!0,x>5?(i.scheduleStatus="ahead",i.scheduleLabel=`Ahead of Schedule (+${i.scheduleVariance}%)`):x<-5?(i.scheduleStatus="behind",i.scheduleLabel=`Behind Schedule (${i.scheduleVariance}%)`):(i.scheduleStatus="on_track",i.scheduleLabel="On Track")}if(r.planned_man_days&&r.planned_man_days>0){const u=(r.progress||0)/100*r.planned_man_days;if(u>0&&l>0){const f=(l-u)/u*100;i.laborVariance=Math.round(f),i.hasLaborData=!0,f>10?(i.laborStatus="over",i.laborLabel=`Over Planned (+${i.laborVariance}% man-days)`):f<-10?(i.laborStatus="under",i.laborLabel=`Under Planned (${i.laborVariance}% man-days)`):(i.laborStatus="on_track",i.laborLabel="Labor On Track")}else l>0&&(i.hasLaborData=!0,i.laborLabel=`${l} man-days used`)}return i}function Xv(r,l=30){if(r.status==="archived"||r.progress<100)return!1;const o=r.areas||[];if(o.length===0||!o.every(f=>f.status==="done"))return!1;const m=o.reduce((f,g)=>{const j=new Date(g.updated_at);return j>f?j:f},new Date(0));return m.getTime()===0?!1:Math.floor((Date.now()-m.getTime())/(1e3*60*60*24))>=l}async function Zv(r,l=1920,o=.8){return!r.type.startsWith("image/")||r.size<500*1024?r:new Promise(i=>{const m=document.createElement("canvas"),u=m.getContext("2d"),f=new Image;f.onload=()=>{let{width:g,height:j}=f;g>l&&(j=Math.round(j*l/g),g=l);const v=1920;j>v&&(g=Math.round(g*v/j),j=v),m.width=g,m.height=j,u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.drawImage(f,0,0,g,j),m.toBlob(x=>{if(x){const q=r.name.replace(/\.[^/.]+$/,""),L=new File([x],`${q}.jpg`,{type:"image/jpeg",lastModified:Date.now()}),M=((1-x.size/r.size)*100).toFixed(1);console.log(`Image compressed: ${r.name} - ${(r.size/1024).toFixed(0)}KB  ${(x.size/1024).toFixed(0)}KB (${M}% smaller)`),i(L)}else console.warn("Image compression failed, using original"),i(r)},"image/jpeg",o),URL.revokeObjectURL(f.src)},f.onerror=()=>{console.warn("Failed to load image for compression, using original"),URL.revokeObjectURL(f.src),i(r)},f.src=URL.createObjectURL(r)})}const Op=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";function zd({documentType:r,documentId:l,companyId:o,projectId:i,documentTitle:m="",onClose:u,onShowToast:f}){const[g,j]=p.useState(!0),[v,x]=p.useState(!1),[q,L]=p.useState([]),[M,P]=p.useState(null),[V,J]=p.useState(!1),[ae,F]=p.useState("never");p.useEffect(()=>{R()},[r,l]);const R=async()=>{try{j(!0);const B=await te.getSignatureRequestsForDocument(r,l);L(B||[])}catch(B){console.error("Error loading signature requests:",B)}finally{j(!1)}},S=async()=>{try{x(!0);let B=null;if(ae!=="never"){const C=parseInt(ae);B=new Date,B.setDate(B.getDate()+C),B=B.toISOString()}const Z=await te.createSignatureRequest(r,l,o,i,null,B);if(Z){const C=`${window.location.origin}/sign/${Z.signature_token}`;P(C),await R(),f?.("Signature link created","success")}}catch(B){console.error("Error generating signature link:",B),f?.("Failed to create signature link","error")}finally{x(!1)}},K=async B=>{try{await navigator.clipboard.writeText(B),J(!0),f?.("Link copied to clipboard","success"),setTimeout(()=>J(!1),2e3)}catch(Z){console.error("Error copying to clipboard:",Z)}},pe=async B=>{if(confirm("Are you sure you want to revoke this signature link? It will no longer be usable."))try{await te.revokeSignatureRequest(B),await R(),f?.("Signature link revoked","success")}catch(Z){console.error("Error revoking signature request:",Z),f?.("Failed to revoke link","error")}},$=B=>{switch(B){case"pending":return{label:"Awaiting Signatures",color:"#f59e0b",bg:"#fef3c7"};case"partially_signed":return{label:"1 of 2 Signed",color:"#3b82f6",bg:"#dbeafe"};case"completed":return{label:"Fully Signed",color:"#10b981",bg:"#d1fae5"};case"revoked":return{label:"Revoked",color:"#ef4444",bg:"#fee2e2"};case"expired":return{label:"Expired",color:"#6b7280",bg:"#f3f4f6"};default:return{label:B,color:"#6b7280",bg:"#f3f4f6"}}},G=r==="cor"?"Change Order":"T&M Ticket";return e.jsx("div",{className:"modal-overlay",onClick:u,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content signature-link-modal",onClick:B=>B.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Get Signature Link"}),m&&e.jsx("span",{className:"modal-subtitle",children:m})]}),e.jsx("button",{className:"close-btn",onClick:u,"aria-label":"Close",children:e.jsx(Ta,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(kd,{size:16}),"Create New Signature Link"]}),e.jsxs("p",{className:"section-description",children:["Generate a secure link that allows GC/Client to sign this ",G," without logging in."]}),e.jsxs("div",{className:"link-options",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("select",{value:ae,onChange:B=>F(B.target.value),disabled:v,children:[e.jsx("option",{value:"never",children:"Never expires"}),e.jsx("option",{value:"7",children:"7 days"}),e.jsx("option",{value:"30",children:"30 days"}),e.jsx("option",{value:"90",children:"90 days"})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:S,disabled:v,children:v?"Generating...":"Generate Link"})]}),M&&e.jsxs("div",{className:"new-link-box",children:[e.jsxs("div",{className:"link-display",children:[e.jsx("input",{type:"text",value:M,readOnly:!0,className:"link-input"}),e.jsxs("button",{className:"btn btn-secondary copy-btn",onClick:()=>K(M),children:[V?e.jsx(Pa,{size:16}):e.jsx(bd,{size:16}),V?"Copied!":"Copy"]})]}),e.jsxs("a",{href:M,target:"_blank",rel:"noopener noreferrer",className:"preview-link",children:[e.jsx(Mp,{size:14}),"Preview link"]})]})]}),e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(xn,{size:16}),"Existing Signature Links"]}),g?e.jsx("div",{className:"loading-inline",children:"Loading..."}):q.length===0?e.jsxs("p",{className:"empty-state",children:["No signature links have been created for this ",G,"."]}):e.jsx("div",{className:"existing-links-list",children:q.map(B=>{const Z=$(B.status),C=`${window.location.origin}/sign/${B.signature_token}`,b=B.signatures?.length||0;return e.jsxs("div",{className:"existing-link-card",children:[e.jsxs("div",{className:"link-card-header",children:[e.jsx("span",{className:"status-badge",style:{color:Z.color,backgroundColor:Z.bg},children:Z.label}),e.jsxs("span",{className:"link-created",children:["Created ",Op(B.created_at)]})]}),e.jsxs("div",{className:"link-card-body",children:[e.jsxs("div",{className:"link-info",children:[e.jsxs("span",{className:"link-token",children:["...",B.signature_token.slice(-8)]}),B.expires_at&&e.jsxs("span",{className:"link-expires",children:["Expires ",Op(B.expires_at)]}),e.jsxs("span",{className:"link-views",children:[B.view_count," view",B.view_count!==1?"s":""]})]}),b>0&&e.jsx("div",{className:"signatures-summary",children:B.signatures.map(A=>e.jsxs("div",{className:"sig-item",children:[e.jsx(Pa,{size:12}),e.jsxs("span",{children:["Slot ",A.signature_slot,": ",A.signer_name,A.signer_company&&` (${A.signer_company})`]})]},A.id))})]}),e.jsxs("div",{className:"link-card-actions",children:[B.status!=="revoked"&&B.status!=="expired"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>K(C),children:[e.jsx(bd,{size:14})," Copy"]}),e.jsxs("a",{href:C,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-small",children:[e.jsx(Mp,{size:14})," Open"]})]}),B.status!=="completed"&&B.status!=="revoked"&&e.jsxs("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>pe(B.id),children:[e.jsx(Us,{size:14})," Revoke"]})]})]},B.id)})})]}),e.jsxs("div",{className:"signature-info-box",children:[e.jsx(Cr,{size:16}),e.jsxs("div",{children:[e.jsx("strong",{children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Share the link with your GC or Client"}),e.jsx("li",{children:"They can view the document and sign without logging in"}),e.jsx("li",{children:"Supports 2 signatures (GC + Client)"}),e.jsx("li",{children:"Signatures are recorded with name, title, company, date, and IP"})]})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:u,children:"Close"})})]})})}function Iv({ticketId:r,ticketSummary:l,lang:o="en",onSave:i,onClose:m,onShowToast:u}){const f=p.useRef(null),[g,j]=p.useState(""),[v,x]=p.useState(""),[q,L]=p.useState(""),[M,P]=p.useState(!1),[V,J]=p.useState(!1),[ae,F]=p.useState(!1),R={en:{title:"Client Signature",subtitle:"Sign to verify the work performed",signerName:"Your Name",signerNamePlaceholder:"Full name",signerTitle:"Title",signerTitlePlaceholder:"e.g. Project Manager",signerCompany:"Company",signerCompanyPlaceholder:"Company name",signBelow:"Sign below",signHere:"Sign here",clear:"Clear",cancel:"Cancel",saveSignature:"Submit Signature",saving:"Saving...",workDate:"Work Date",workers:"Workers",hours:"Total Hours",certification:"By signing, I acknowledge that the work described in this T&M ticket was performed as documented.",nameRequired:"Please enter your name",signatureRequired:"Please sign above",signatureSaved:"Signature saved successfully",signatureError:"Error saving signature"},es:{title:"Firma del Cliente",subtitle:"Firme para verificar el trabajo realizado",signerName:"Su Nombre",signerNamePlaceholder:"Nombre completo",signerTitle:"Titulo",signerTitlePlaceholder:"ej. Gerente de Proyecto",signerCompany:"Empresa",signerCompanyPlaceholder:"Nombre de la empresa",signBelow:"Firme abajo",signHere:"Firme aqui",clear:"Borrar",cancel:"Cancelar",saveSignature:"Enviar Firma",saving:"Guardando...",workDate:"Fecha",workers:"Trabajadores",hours:"Horas Total",certification:"Al firmar, reconozco que el trabajo descrito en este ticket T&M fue realizado como se documenta.",nameRequired:"Por favor ingrese su nombre",signatureRequired:"Por favor firme arriba",signatureSaved:"Firma guardada exitosamente",signatureError:"Error al guardar la firma"}},S=R[o]||R.en,K=()=>{const A=f.current;return A?A.getContext("2d"):null},pe=A=>{const z=f.current;if(!z)return{x:0,y:0};const de=z.getBoundingClientRect(),N=z.width/de.width,se=z.height/de.height,E=A.touches?A.touches[0].clientX:A.clientX,xe=A.touches?A.touches[0].clientY:A.clientY;return{x:(E-de.left)*N,y:(xe-de.top)*se}},$=A=>{A.preventDefault();const z=K();if(!z)return;const{x:de,y:N}=pe(A);z.beginPath(),z.moveTo(de,N),J(!0),P(!0)},G=A=>{if(!V)return;A.preventDefault();const z=K();if(!z)return;const{x:de,y:N}=pe(A);z.lineTo(de,N),z.stroke()},B=()=>{J(!1)},Z=()=>{const A=f.current,z=K();!A||!z||(z.clearRect(0,0,A.width,A.height),P(!1))},C=A=>{if(!A)return;f.current=A;const z=A.getContext("2d");z.strokeStyle="#1e293b",z.lineWidth=2,z.lineCap="round",z.lineJoin="round"},b=async()=>{if(!g.trim()){u?.(S.nameRequired,"error");return}if(!M){u?.(S.signatureRequired,"error");return}const A=f.current;if(A){F(!0);try{const z=A.toDataURL("image/png");await te.saveTMClientSignature(r,{signature:z,signerName:g.trim(),signerTitle:v.trim()||null,signerCompany:q.trim()||null,signedAt:new Date().toISOString()}),u?.(S.signatureSaved,"success"),i?.({signerName:g.trim(),signerTitle:v.trim(),signerCompany:q.trim()})}catch(z){console.error("Error saving signature:",z),u?.(S.signatureError,"error")}finally{F(!1)}}};return e.jsx("div",{className:"tm-modal-overlay",onClick:m,children:e.jsxs("div",{className:"tm-client-signature-modal",onClick:A=>A.stopPropagation(),children:[e.jsxs("div",{className:"tm-sig-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:S.title}),e.jsx("p",{className:"tm-sig-subtitle",children:S.subtitle})]}),e.jsx("button",{className:"tm-sig-close",onClick:m,children:e.jsx(Ta,{size:20})})]}),e.jsxs("div",{className:"tm-sig-body",children:[l&&e.jsxs("div",{className:"tm-sig-summary",children:[e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:S.workDate}),e.jsx("span",{className:"tm-sig-summary-value",children:new Date(l.workDate).toLocaleDateString()})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:S.workers}),e.jsx("span",{className:"tm-sig-summary-value",children:l.workerCount})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:S.hours}),e.jsx("span",{className:"tm-sig-summary-value",children:l.totalHours})]})]}),e.jsxs("div",{className:"tm-sig-fields",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(Ad,{size:14}),S.signerName," *"]}),e.jsx("input",{type:"text",value:g,onChange:A=>j(A.target.value),placeholder:S.signerNamePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field-row",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(vl,{size:14}),S.signerTitle]}),e.jsx("input",{type:"text",value:v,onChange:A=>x(A.target.value),placeholder:S.signerTitlePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(uj,{size:14}),S.signerCompany]}),e.jsx("input",{type:"text",value:q,onChange:A=>L(A.target.value),placeholder:S.signerCompanyPlaceholder})]})]})]}),e.jsxs("div",{className:"tm-sig-area",children:[e.jsxs("div",{className:"tm-sig-label",children:[e.jsx(Ed,{size:14}),e.jsx("span",{children:S.signBelow})]}),e.jsxs("div",{className:"tm-sig-canvas-container",children:[e.jsx("canvas",{ref:C,width:500,height:180,className:"tm-sig-canvas",onMouseDown:$,onMouseMove:G,onMouseUp:B,onMouseLeave:B,onTouchStart:$,onTouchMove:G,onTouchEnd:B}),!M&&e.jsx("div",{className:"tm-sig-placeholder",children:S.signHere})]}),e.jsxs("button",{className:"tm-sig-clear",onClick:Z,disabled:!M,children:[e.jsx(Md,{size:14})," ",S.clear]})]}),e.jsx("p",{className:"tm-sig-certification",children:S.certification})]}),e.jsxs("div",{className:"tm-sig-footer",children:[e.jsx("button",{className:"tm-sig-btn secondary",onClick:m,disabled:ae,children:S.cancel}),e.jsx("button",{className:"tm-sig-btn primary",onClick:b,disabled:!M||!g.trim()||ae,children:ae?S.saving:e.jsxs(e.Fragment,{children:[e.jsx(Pa,{size:16})," ",S.saveSignature]})})]})]})})}const id=["Containment","PPE","Disposal","Equipment"],Jv={en:{workInfo:"Work Info",crewHours:"Crew & Hours",materialsEquipment:"Materials",review:"Review",quickActions:"Quick Actions",sameAsYesterday:"Same as Yesterday",setCrewHours:"Set Crew Hours",loading:"Loading...",supervision:"Supervision",operators:"Operators",laborers:"Laborers",addSupervision:"+ Add Supervision",addOperator:"+ Add Operator",addLaborer:"+ Add Laborer",foreman:"Foreman",superintendent:"Superintendent",firstLastName:"First & Last Name",start:"Start",end:"End",regHrs:"Reg Hrs",otHrs:"OT Hrs",selectCategory:"Select a category:",addCustomItem:"+ Add Custom Item",customItem:"Custom Item",itemName:"Item Name",category:"Category",quantity:"Quantity",addItem:"Add Item",cancel:"Cancel",noItemsCategory:"No items in this category yet",workDate:"Work Date",ceNumber:"CE/PCO #",optional:"optional",linkedCOR:"Link to Change Order",selectCOR:"Select COR (optional)",noCORs:"No pending CORs",laborSummary:"Labor Summary",worker:"worker",workers_plural:"workers",totalHours:"Total Hours",regular:"Regular",overtime:"Overtime",materials:"Materials",item:"item",items_plural:"items",noMaterials:"No materials added",notes:"Notes",addNotes:"Add notes about the work performed...",photos:"Photos",addPhotos:"Add Photos",maxPhotos:"max",noPhotos:"No photos added",certification:"Certification",certifyStatement:"I certify that this T&M ticket accurately reflects the work performed.",foremanSignature:"Foreman's Name (Signature)",yourName:"Your name",describeWork:"Describe the work performed",descriptionRequired:"Description is required",whatWorkPerformed:"What work was performed today?",searchMaterials:"Search materials & equipment...",noSearchResults:"No items found",orBrowse:"Or browse by category:",back:"Back",next:"Next",nextCrew:"Next: Crew",nextMaterials:"Next: Materials",reviewItems:"Review",skipNoMaterials:"Skip (no materials)",submitTM:"Submit T&M",submitting:"Submitting...",applySameHours:"Apply Same Hours",batchDescription:"Set start/end time and hours for all workers with names entered.",timeStarted:"Time Started",timeEnded:"Time Ended",regularHours:"Regular Hours",overtimeHours:"Overtime Hours",willApplyTo:"Will apply to",applyToAll:"Apply to All",preset8hr:"8hr Day",preset10hr:"10hr Day",preset4hr:"4hr Day",loadedWorkers:"Loaded {count} workers from {date}",noPreviousCrew:"No previous crew found for this project",appliedHours:"Applied hours to {count} worker(s)",assignedToCOR:"Assigned to COR"},es:{workInfo:"Info del Trabajo",crewHours:"Cuadrilla y Horas",materialsEquipment:"Materiales",review:"Revisar",quickActions:"Acciones Rapidas",sameAsYesterday:"Igual que Ayer",setCrewHours:"Poner Horas",loading:"Cargando...",supervision:"Supervision",operators:"Operadores",laborers:"Trabajadores",addSupervision:"+ Agregar Supervision",addOperator:"+ Agregar Operador",addLaborer:"+ Agregar Trabajador",foreman:"Capataz",superintendent:"Superintendente",firstLastName:"Nombre y Apellido",start:"Inicio",end:"Fin",regHrs:"Hrs Reg",otHrs:"Hrs Extra",selectCategory:"Seleccione una categoria:",addCustomItem:"+ Agregar Articulo",customItem:"Articulo Personalizado",itemName:"Nombre del Articulo",category:"Categoria",quantity:"Cantidad",addItem:"Agregar",cancel:"Cancelar",noItemsCategory:"No hay articulos en esta categoria",workDate:"Fecha de Trabajo",ceNumber:"CE/PCO #",optional:"opcional",linkedCOR:"Vincular a Orden de Cambio",selectCOR:"Seleccionar COR (opcional)",noCORs:"No hay CORs pendientes",laborSummary:"Resumen de Mano de Obra",worker:"trabajador",workers_plural:"trabajadores",totalHours:"Horas Totales",regular:"Regular",overtime:"Extra",materials:"Materiales",item:"articulo",items_plural:"articulos",noMaterials:"No se agregaron materiales",notes:"Notas",addNotes:"Agregar notas sobre el trabajo realizado...",photos:"Fotos",addPhotos:"Agregar Fotos",maxPhotos:"max",noPhotos:"No se agregaron fotos",certification:"Certificacion",certifyStatement:"Certifico que este ticket T&M refleja con precision el trabajo realizado.",foremanSignature:"Nombre del Capataz (Firma)",yourName:"Su nombre",describeWork:"Describir el trabajo realizado",descriptionRequired:"Descripcion es requerida",whatWorkPerformed:"Que trabajo se realizo hoy?",searchMaterials:"Buscar materiales y equipo...",noSearchResults:"No se encontraron articulos",orBrowse:"O navegar por categoria:",back:"Atras",next:"Siguiente",nextCrew:"Siguiente: Cuadrilla",nextMaterials:"Siguiente: Materiales",reviewItems:"Revisar",skipNoMaterials:"Saltar (sin materiales)",submitTM:"Enviar T&M",submitting:"Enviando...",applySameHours:"Aplicar Mismas Horas",batchDescription:"Establezca hora de inicio/fin y horas para todos los trabajadores.",timeStarted:"Hora de Inicio",timeEnded:"Hora de Fin",regularHours:"Horas Regulares",overtimeHours:"Horas Extra",willApplyTo:"Se aplicara a",applyToAll:"Aplicar a Todos",preset8hr:"Dia 8hr",preset10hr:"Dia 10hr",preset4hr:"Dia 4hr",loadedWorkers:"Se cargaron {count} trabajadores del {date}",noPreviousCrew:"No se encontro equipo anterior para este proyecto",appliedHours:"Horas aplicadas a {count} trabajador(es)",assignedToCOR:"Asignado a COR"}};function Wv({project:r,companyId:l,maxPhotos:o=10,onSubmit:i,onCancel:m,onShowToast:u}){const[f,g]=p.useState(1),[j,v]=p.useState(new Date().toISOString().split("T")[0]),[x,q]=p.useState(null),[L,M]=p.useState(!1),[P,V]=p.useState(!1),[J,ae]=p.useState(!1),[F,R]=p.useState(""),[S,K]=p.useState(""),[pe,$]=p.useState(""),[G,B]=p.useState([]),[Z,C]=p.useState(!1),[b,A]=p.useState(!1),[z,de]=p.useState({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),[N,se]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}]),[E,xe]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[k,U]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[ie,T]=p.useState([]),[je,I]=p.useState(""),[ke,ue]=p.useState([]),[Te,Be]=p.useState(!1),[ze,Oe]=p.useState(""),[gt,tt]=p.useState([]),[ee,Me]=p.useState(!1),[Fe,pt]=p.useState(null),[ma,we]=p.useState([]),[qe,$e]=p.useState(!1),[Xe,Ye]=p.useState(""),[Ze,De]=p.useState([]),[vt,wt]=p.useState([]),[Zt,ta]=p.useState(!1),[Nt,Pt]=p.useState({name:"",category:"",quantity:""}),[X,O]=p.useState(!1),[be,Ee]=p.useState("en"),ne=_=>Jv[be][_]||_,Ae=(_,oe)=>{if(!_||!oe)return null;const[Ce,ge]=_.split(":").map(Number),[nt,ct]=oe.split(":").map(Number);let He=nt*60+ct-(Ce*60+ge);He<0&&(He+=1440);const ut=He/60,Ot=Math.min(ut,8),xs=Math.max(0,ut-8);return{hours:Ot.toFixed(1),overtimeHours:xs>0?xs.toFixed(1):""}},ot=_=>{const oe=_.name.trim()!=="",Ce=parseFloat(_.hours)>0||parseFloat(_.overtimeHours)>0;return oe?Ce?"complete":"incomplete":"empty"},We=_=>{let oe,Ce,ge,nt;switch(_){case"full":oe="07:00",Ce="15:30",ge="8",nt="";break;case"10hr":oe="06:00",Ce="16:30",ge="8",nt="2";break;case"half":oe="07:00",Ce="11:00",ge="4",nt="";break;default:return}de({timeStarted:oe,timeEnded:Ce,hours:ge,overtimeHours:nt})};p.useEffect(()=>{Mt(),Qt()},[r.id]);const Qt=async()=>{C(!0);try{const _=await te.getAssignableCORs(r.id);B(_||[])}catch(_){console.error("Error loading assignable CORs:",_)}finally{C(!1)}},Lt=()=>{const{timeStarted:_,timeEnded:oe,hours:Ce,overtimeHours:ge}=z;se(N.map(ct=>ct.name.trim()?{...ct,timeStarted:_,timeEnded:oe,hours:Ce,overtimeHours:ge}:ct)),xe(E.map(ct=>ct.name.trim()?{...ct,timeStarted:_,timeEnded:oe,hours:Ce,overtimeHours:ge}:ct)),U(k.map(ct=>ct.name.trim()?{...ct,timeStarted:_,timeEnded:oe,hours:Ce,overtimeHours:ge}:ct));const nt=[...N.filter(ct=>ct.name.trim()),...E.filter(ct=>ct.name.trim()),...k.filter(ct=>ct.name.trim())].length;A(!1),de({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),u(`Applied hours to ${nt} worker${nt!==1?"s":""}`,"success")},Dt=_=>{let oe,Ce,ge,nt;switch(_){case"8hr":oe="07:00",Ce="15:30",ge="8",nt="";break;case"10hr":oe="06:00",Ce="16:30",ge="8",nt="2";break;case"4hr":oe="07:00",Ce="11:00",ge="4",nt="";break;default:return}se(He=>He.map(ut=>ut.name.trim()?{...ut,timeStarted:oe,timeEnded:Ce,hours:ge,overtimeHours:nt}:ut)),xe(He=>He.map(ut=>ut.name.trim()?{...ut,timeStarted:oe,timeEnded:Ce,hours:ge,overtimeHours:nt}:ut)),U(He=>He.map(ut=>ut.name.trim()?{...ut,timeStarted:oe,timeEnded:Ce,hours:ge,overtimeHours:nt}:ut));const ct=[...N.filter(He=>He.name.trim()),...E.filter(He=>He.name.trim()),...k.filter(He=>He.name.trim())].length;ct>0?u(ne("appliedHours").replace("{count}",ct),"success"):u(be==="en"?"Add workers first":"Agregue trabajadores primero","info")},Mt=async()=>{try{const _=await te.getCrewCheckin(r.id);_?.workers&&tt(_.workers)}catch(_){console.error("Error loading crew:",_)}};p.useEffect(()=>{Fe&&l&&$t(Fe)},[Fe,l]);const $t=async _=>{$e(!0);try{const oe=await te.getMaterialsEquipmentByCategory(l,_);we(oe)}catch(oe){console.error("Error loading items:",oe),u("Error loading items","error")}finally{$e(!1)}},It=async()=>{if(!(vt.length>0))try{const _=[];for(const oe of id){const Ce=await te.getMaterialsEquipmentByCategory(l,oe);_.push(...Ce.map(ge=>({...ge,category:oe})))}wt(_)}catch(_){console.error("Error loading all materials:",_)}},la=_=>{if(Ye(_),!_.trim()){De([]);return}const oe=_.toLowerCase(),Ce=vt.filter(ge=>ge.name.toLowerCase().includes(oe)||ge.category.toLowerCase().includes(oe));De(Ce.slice(0,10))},Ne=async()=>{O(!0);try{const _=await te.getPreviousTicketCrew(r.id,j);if(!_||_.totalWorkers===0){u("No previous crew found for this project","info");return}_.supervision&&se(_.supervision),_.operators&&xe(_.operators),_.laborers&&U(_.laborers);const oe=new Date(_.workDate).toLocaleDateString();u(`Loaded ${_.totalWorkers} workers from ${oe}`,"success")}catch(_){console.error("Error loading previous crew:",_),u("Error loading previous crew","error")}finally{O(!1)}},kt=()=>{se([...N,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},ft=(_,oe,Ce)=>{se(N.map((ge,nt)=>{if(nt!==_)return ge;const ct={...ge,[oe]:Ce};if(oe==="timeStarted"||oe==="timeEnded"){const He=oe==="timeStarted"?Ce:ge.timeStarted,ut=oe==="timeEnded"?Ce:ge.timeEnded,Ot=Ae(He,ut);Ot&&(ct.hours=Ot.hours,ct.overtimeHours=Ot.overtimeHours)}return ct}))},ja=_=>{N.length>1?se(N.filter((oe,Ce)=>Ce!==_)):se([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},w=()=>{U([...k,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},me=(_,oe,Ce)=>{U(k.map((ge,nt)=>{if(nt!==_)return ge;const ct={...ge,[oe]:Ce};if(oe==="timeStarted"||oe==="timeEnded"){const He=oe==="timeStarted"?Ce:ge.timeStarted,ut=oe==="timeEnded"?Ce:ge.timeEnded,Ot=Ae(He,ut);Ot&&(ct.hours=Ot.hours,ct.overtimeHours=Ot.overtimeHours)}return ct}))},he=_=>{k.length>1?U(k.filter((oe,Ce)=>Ce!==_)):U([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Se=()=>{xe([...E,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},lt=(_,oe,Ce)=>{xe(E.map((ge,nt)=>{if(nt!==_)return ge;const ct={...ge,[oe]:Ce};if(oe==="timeStarted"||oe==="timeEnded"){const He=oe==="timeStarted"?Ce:ge.timeStarted,ut=oe==="timeEnded"?Ce:ge.timeEnded,Ot=Ae(He,ut);Ot&&(ct.hours=Ot.hours,ct.overtimeHours=Ot.overtimeHours)}return ct}))},ht=_=>{E.length>1?xe(E.filter((oe,Ce)=>Ce!==_)):xe([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},it=_=>{const oe=ie.findIndex(Ce=>Ce.material_equipment_id===_.id);oe>=0?T(ie.map((Ce,ge)=>ge===oe?{...Ce,quantity:Ce.quantity+1}:Ce)):T([...ie,{material_equipment_id:_.id,name:_.name,unit:_.unit,category:_.category,quantity:1,isCustom:!1}]),u(`Added ${_.name}`,"success")},Et=()=>{if(!Nt.name||!Nt.category||!Nt.quantity){u("Fill in all fields","error");return}T([...ie,{material_equipment_id:null,custom_name:Nt.name,custom_category:Nt.category,name:Nt.name,category:Nt.category,quantity:parseFloat(Nt.quantity),unit:"each",isCustom:!0}]),Pt({name:"",category:"",quantity:""}),ta(!1),pt(null),u("Custom item added","success")},at=(_,oe)=>{const Ce=parseFloat(oe)||0;Ce<=0?rt(_):T(ie.map((ge,nt)=>nt===_?{...ge,quantity:Ce}:ge))},rt=_=>{T(ie.filter((oe,Ce)=>Ce!==_))},ha=_=>{const oe=Array.from(_.target.files);if(oe.length===0)return;const Ce=o===-1?1/0:o-ke.length;if(Ce<=0){u(`Photo limit reached (${o} max)`,"error"),_.target.value="";return}const ge=oe.slice(0,Ce);ge.length<oe.length&&u(`Only ${ge.length} photo(s) added (${o} max)`,"error"),ge.forEach(nt=>{if(!nt.type.startsWith("image/")){u("Please select an image file","error");return}const ct=URL.createObjectURL(nt);ue(He=>[...He,{id:Date.now()+Math.random(),file:nt,previewUrl:ct,name:nt.name}])}),_.target.value=""},va=_=>{const oe=ke.find(Ce=>Ce.id===_);oe?.previewUrl&&URL.revokeObjectURL(oe.previewUrl),ue(ke.filter(Ce=>Ce.id!==_))},wa=()=>{if(f===1)return je.trim().length>0;if(f===2){const _=N.some(ge=>ge.name.trim()&&(parseFloat(ge.hours)>0||parseFloat(ge.overtimeHours)>0)),oe=E.some(ge=>ge.name.trim()&&(parseFloat(ge.hours)>0||parseFloat(ge.overtimeHours)>0)),Ce=k.some(ge=>ge.name.trim()&&(parseFloat(ge.hours)>0||parseFloat(ge.overtimeHours)>0));return _||oe||Ce}return!0},Ve=()=>{f<4&&g(f+1)},Ke=()=>{Fe?(pt(null),ta(!1)):Zt?ta(!1):f>1?g(f-1):m()},ia=async()=>{if(!S.trim()){u("Enter your name to submit","error");return}const _=N.filter(ge=>ge.name.trim()&&(parseFloat(ge.hours)>0||parseFloat(ge.overtimeHours)>0)),oe=E.filter(ge=>ge.name.trim()&&(parseFloat(ge.hours)>0||parseFloat(ge.overtimeHours)>0)),Ce=k.filter(ge=>ge.name.trim()&&(parseFloat(ge.hours)>0||parseFloat(ge.overtimeHours)>0));if(_.length===0&&oe.length===0&&Ce.length===0){u("Add at least one worker","error");return}Be(!0),Oe("Creating ticket...");try{const ge=await te.createTMTicket({project_id:r.id,work_date:j,ce_pco_number:F.trim()||null,assigned_cor_id:pe||null,notes:je.trim()||null,photos:[],created_by_name:S.trim()});let nt=[];if(ke.length>0){Oe(`Compressing ${ke.length} photo${ke.length>1?"s":""}...`);const He=await Promise.all(ke.map(async(js,vs)=>{try{const ls=await Zv(js.file);return{...js,file:ls}}catch(ls){return console.warn(`Failed to compress photo ${vs+1}, using original:`,ls),js}}));Oe(`Uploading ${ke.length} photo${ke.length>1?"s":""}...`);let ut=0;const Ot=He.map(async(js,vs)=>{try{const ls=await te.uploadPhoto(l,r.id,ge.id,js.file);return ut++,Oe(`Uploading ${ut}/${ke.length} photos...`),console.log(`Photo ${vs+1} uploaded successfully:`,ls),ls}catch(ls){return console.error(`Photo ${vs+1} upload failed:`,ls),u(`Photo ${vs+1} failed to upload`,"error"),null}});nt=(await Promise.all(Ot)).filter(js=>js!==null),nt.length<ke.length&&nt.length>0&&u(`${nt.length}/${ke.length} photos uploaded`,"warning")}nt.length>0&&(Oe("Saving photos..."),await te.updateTMTicketPhotos(ge.id,nt));const ct=[..._.map(He=>({name:He.name.trim(),hours:parseFloat(He.hours)||0,overtime_hours:parseFloat(He.overtimeHours)||0,time_started:He.timeStarted||null,time_ended:He.timeEnded||null,role:He.role})),...oe.map(He=>({name:He.name.trim(),hours:parseFloat(He.hours)||0,overtime_hours:parseFloat(He.overtimeHours)||0,time_started:He.timeStarted||null,time_ended:He.timeEnded||null,role:"Operator"})),...Ce.map(He=>({name:He.name.trim(),hours:parseFloat(He.hours)||0,overtime_hours:parseFloat(He.overtimeHours)||0,time_started:He.timeStarted||null,time_ended:He.timeEnded||null,role:"Laborer"}))];if(Oe("Saving workers..."),await te.addTMWorkers(ge.id,ct),ie.length>0&&(Oe("Saving materials..."),await te.addTMItems(ge.id,ie.map(He=>({material_equipment_id:He.material_equipment_id,custom_name:He.custom_name||null,custom_category:He.custom_category||null,quantity:He.quantity})))),pe){Oe("Importing to COR...");try{await te.importTicketDataToCOR(ge.id,pe,l,r.work_type||"demolition",r.job_type||"standard")}catch(He){console.error("Error importing to COR:",He),u("T&M saved, but COR import failed","warning")}}ke.forEach(He=>{He.previewUrl&&URL.revokeObjectURL(He.previewUrl)}),q(ge),u("T&M submitted!","success"),g(5)}catch(ge){console.error("Error submitting T&M:",ge),u("Error submitting T&M","error")}finally{Be(!1),Oe("")}},Jt=N.filter(_=>_.name.trim()&&(parseFloat(_.hours)>0||parseFloat(_.overtimeHours)>0)),ya=E.filter(_=>_.name.trim()&&(parseFloat(_.hours)>0||parseFloat(_.overtimeHours)>0)),Ue=k.filter(_=>_.name.trim()&&(parseFloat(_.hours)>0||parseFloat(_.overtimeHours)>0)),Je=Jt.length+ya.length+Ue.length,yt=[...Jt,...ya,...Ue].reduce((_,oe)=>_+parseFloat(oe.hours||0),0),st=[...Jt,...ya,...Ue].reduce((_,oe)=>_+parseFloat(oe.overtimeHours||0),0);ie.reduce((_,oe)=>_+oe.quantity,0);const pa=[...N.filter(_=>_.name.trim()),...E.filter(_=>_.name.trim()),...k.filter(_=>_.name.trim())],ba=Je,fa=pa.length-ba;return f===3&&(Fe||Zt)?e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[e.jsx("button",{className:"tm-back-btn",onClick:Ke,children:""}),e.jsx("h2",{children:Zt?"Add Custom Item":Fe}),e.jsxs("div",{className:"tm-item-count",children:[ie.length," items"]})]}),Zt?e.jsxs("div",{className:"tm-custom-form",children:[e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Item Name"}),e.jsx("input",{type:"text",placeholder:"What did you use?",value:Nt.name,onChange:_=>Pt({...Nt,name:_.target.value}),autoFocus:!0})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Category"}),e.jsx("div",{className:"tm-category-select",children:id.map(_=>e.jsx("button",{className:`tm-cat-chip ${Nt.category===_?"active":""}`,onClick:()=>Pt({...Nt,category:_}),children:_},_))})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",placeholder:"How many?",value:Nt.quantity,onChange:_=>Pt({...Nt,quantity:_.target.value})})]}),e.jsx("button",{className:"tm-big-btn primary",onClick:Et,children:"Add Custom Item"})]}):e.jsx("div",{className:"tm-item-grid",children:qe?e.jsx("div",{className:"tm-loading",children:"Loading..."}):e.jsxs(e.Fragment,{children:[ma.map(_=>{const oe=ie.find(Ce=>Ce.material_equipment_id===_.id);return e.jsxs("button",{className:`tm-item-card ${oe?"added":""}`,onClick:()=>it(_),children:[e.jsx("span",{className:"tm-item-name",children:_.name}),e.jsx("span",{className:"tm-item-unit",children:_.unit}),oe&&e.jsx("span",{className:"tm-item-badge",children:oe.quantity})]},_.id)}),e.jsxs("button",{className:"tm-item-card custom",onClick:()=>ta(!0),children:[e.jsx("span",{className:"tm-item-name",children:"+ Add Other"}),e.jsx("span",{className:"tm-item-unit",children:"Not on list"})]})]})}),!Zt&&ie.length>0&&e.jsx("div",{className:"tm-wizard-footer",children:e.jsxs("button",{className:"tm-big-btn primary",onClick:()=>pt(null),children:["Done Adding (",ie.length," items)"]})})]}):e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[f<5?e.jsx("button",{className:"tm-back-btn",onClick:Ke,children:""}):e.jsx("div",{className:"tm-success-check",children:e.jsx(rd,{size:24})}),e.jsxs("h2",{children:[f===1&&ne("workInfo"),f===2&&ne("crewHours"),f===3&&ne("materialsEquipment"),f===4&&ne("review"),f===5&&(be==="en"?"Submitted":"Enviado")]}),e.jsxs("div",{className:"tm-header-right",children:[f<5&&e.jsxs("button",{className:"tm-lang-toggle",onClick:()=>Ee(be==="en"?"es":"en"),title:be==="en"?"Cambiar a Espaol":"Switch to English",children:[e.jsx(Lj,{size:16}),be==="en"?"ES":"EN"]}),f<5&&e.jsxs("div",{className:"tm-step-dots",children:[e.jsx("span",{className:`tm-dot ${f>=1?"active":""}`}),e.jsx("span",{className:`tm-dot ${f>=2?"active":""}`}),e.jsx("span",{className:`tm-dot ${f>=3?"active":""}`}),e.jsx("span",{className:`tm-dot ${f>=4?"active":""}`})]})]})]}),f===1&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-project-info",children:[r.job_number&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Job #"}),e.jsx("span",{className:"tm-project-value",children:r.job_number})]}),e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Project"}),e.jsx("span",{className:"tm-project-value",children:r.name})]}),r.address&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Address"}),e.jsx("span",{className:"tm-project-value",children:r.address})]}),r.general_contractor&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"GC"}),e.jsx("span",{className:"tm-project-value",children:r.general_contractor})]})]}),e.jsxs("div",{className:"tm-field-row",children:[e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:j,onChange:_=>v(_.target.value),className:"tm-date"})]}),e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"CE / PCO #"}),e.jsx("input",{type:"text",placeholder:"Change Event / PCO",value:F,onChange:_=>R(_.target.value),className:"tm-input"})]})]}),e.jsxs("div",{className:"tm-field tm-description-field",children:[e.jsxs("label",{children:[e.jsx(Ma,{size:16,className:"inline-icon"}),ne("describeWork")," ",e.jsx("span",{className:"tm-required",children:"*"})]}),e.jsx("textarea",{placeholder:ne("whatWorkPerformed"),value:je,onChange:_=>I(_.target.value),rows:4,className:`tm-description ${je.trim()?"":"tm-field-required"}`})]}),e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:[e.jsx(Nr,{size:16,className:"inline-icon"})," ",ne("photos"),o!==-1&&e.jsxs("span",{className:"tm-photo-count",children:["(",ke.length,"/",o,")"]})]}),ke.length>0&&e.jsx("div",{className:"tm-photo-grid",children:ke.map(_=>e.jsxs("div",{className:"tm-photo-item",children:[e.jsx("img",{src:_.previewUrl,alt:_.name}),e.jsx("button",{className:"tm-photo-remove",onClick:()=>va(_.id),children:""})]},_.id))}),(o===-1||ke.length<o)&&e.jsxs("label",{className:"tm-photo-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:ha,style:{display:"none"}}),e.jsx(Nr,{size:16,className:"inline-icon"})," ",ke.length>0?be==="en"?"Add More Photos":"Ms Fotos":ne("addPhotos")]})]}),e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:["Link to Change Order Request (",ne("optional"),")"]}),e.jsxs("div",{className:"tm-cor-row",children:[e.jsxs("select",{value:pe,onChange:_=>$(_.target.value),className:"tm-input tm-select",children:[e.jsx("option",{value:"",children:"-- No COR --"}),G.map(_=>e.jsxs("option",{value:_.id,children:[_.cor_number,": ",_.title||"Untitled"," (",_.status,")"]},_.id))]}),e.jsx("button",{type:"button",className:"tm-refresh-btn",onClick:Qt,disabled:Z,title:"Refresh COR list",children:e.jsx(mv,{size:16,className:Z?"spinning":""})})]})]})]}),f===2&&e.jsxs("div",{className:"tm-step-content",children:[gt.length>0&&e.jsxs("div",{className:"tm-crew-picker",children:[e.jsxs("button",{className:"tm-crew-picker-btn",onClick:()=>Me(!ee),children:[e.jsx(Ea,{size:16})," ",ee?"Hide":"Select from"," Today's Crew (",gt.length,")"]}),ee&&e.jsx("div",{className:"tm-crew-list",children:gt.map((_,oe)=>{const Ce=N.some(ge=>ge.name.toLowerCase()===_.name.toLowerCase())||E.some(ge=>ge.name.toLowerCase()===_.name.toLowerCase())||k.some(ge=>ge.name.toLowerCase()===_.name.toLowerCase());return e.jsxs("button",{className:`tm-crew-item ${Ce?"added":""}`,onClick:()=>{if(!Ce){if(_.role==="Foreman"||_.role==="Supervisor"){const ge=N.findIndex(nt=>!nt.name.trim());ge>=0?ft(ge,"name",_.name):se([...N,{name:_.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:_.role==="Supervisor"?"Superintendent":"Foreman"}])}else if(_.role==="Operator"){const ge=E.findIndex(nt=>!nt.name.trim());ge>=0?lt(ge,"name",_.name):xe([...E,{name:_.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}else{const ge=k.findIndex(nt=>!nt.name.trim());ge>=0?me(ge,"name",_.name):U([...k,{name:_.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}u(`Added ${_.name}`,"success")}},disabled:Ce,children:[e.jsx("span",{className:"tm-crew-item-name",children:_.name}),e.jsx("span",{className:`tm-crew-item-role ${(_.role||"laborer").toLowerCase()}`,children:_.role||"Laborer"}),Ce&&e.jsx("span",{className:"tm-crew-item-check",children:""})]},oe)})})]}),e.jsxs("div",{className:"tm-quick-actions-panel",children:[e.jsxs("div",{className:"tm-batch-hours-header",children:[e.jsx(Cd,{size:18}),e.jsx("span",{children:ne("quickActions")})]}),e.jsxs("div",{className:"tm-quick-actions-buttons",children:[e.jsxs("button",{type:"button",className:"tm-quick-action-btn primary",onClick:Ne,disabled:X,children:[e.jsx(bd,{size:16}),ne(X?"loading":"sameAsYesterday")]}),e.jsxs("button",{type:"button",className:"tm-quick-action-btn",onClick:()=>A(!0),children:[e.jsx(xn,{size:16}),ne("setCrewHours")]})]})]}),e.jsxs("div",{className:"tm-inline-presets",children:[e.jsx("span",{className:"tm-inline-presets-label",children:be==="en"?"Apply to all:":"Aplicar a todos:"}),e.jsxs("div",{className:"tm-inline-presets-buttons",children:[e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>Dt("8hr"),children:ne("preset8hr")}),e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>Dt("10hr"),children:ne("preset10hr")}),e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>Dt("4hr"),children:ne("preset4hr")})]})]}),e.jsxs("div",{className:`tm-running-total ${Je>0?"has-data":""}`,children:[e.jsxs("div",{className:"tm-running-total-workers",children:[e.jsx(Ea,{size:18}),e.jsx("span",{className:"tm-running-total-count",children:pa.length}),e.jsx("span",{className:"tm-running-total-label",children:pa.length===1?ne("worker"):ne("workers_plural")}),fa>0&&e.jsxs("span",{className:"tm-running-total-warning",children:["(",fa," ",be==="en"?"need hours":"sin horas",")"]})]}),e.jsxs("div",{className:"tm-running-total-hours",children:[e.jsx(xn,{size:18}),e.jsx("span",{className:"tm-running-total-count",children:yt+st}),e.jsx("span",{className:"tm-running-total-label",children:be==="en"?"total hrs":"hrs total"}),st>0&&e.jsxs("span",{className:"tm-running-total-ot",children:["(",st," OT)"]})]})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:ne("supervision")}),e.jsx("div",{className:"tm-workers-list",children:N.map((_,oe)=>{const Ce=ot(_);return e.jsxs("div",{className:`tm-worker-card-expanded ${Ce!=="empty"?`worker-${Ce}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[Ce==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Pa,{size:14})}),e.jsx("div",{className:"tm-role-select",children:e.jsxs("select",{value:_.role,onChange:ge=>ft(oe,"role",ge.target.value),children:[e.jsx("option",{value:"Foreman",children:ne("foreman")}),e.jsx("option",{value:"Superintendent",children:ne("superintendent")})]})}),e.jsx("input",{type:"text",placeholder:ne("firstLastName"),value:_.name,onChange:ge=>ft(oe,"name",ge.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>ja(oe),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("start")}),e.jsx("input",{type:"time",value:_.timeStarted,onChange:ge=>ft(oe,"timeStarted",ge.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("end")}),e.jsx("input",{type:"time",value:_.timeEnded,onChange:ge=>ft(oe,"timeEnded",ge.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:_.hours,onChange:ge=>ft(oe,"hours",ge.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:_.overtimeHours,onChange:ge=>ft(oe,"overtimeHours",ge.target.value)})]})]})]},oe)})}),e.jsx("button",{className:"tm-add-btn",onClick:kt,children:ne("addSupervision")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:ne("operators")}),e.jsx("div",{className:"tm-workers-list",children:E.map((_,oe)=>{const Ce=ot(_);return e.jsxs("div",{className:`tm-worker-card-expanded ${Ce!=="empty"?`worker-${Ce}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[Ce==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Pa,{size:14})}),e.jsx("input",{type:"text",placeholder:ne("firstLastName"),value:_.name,onChange:ge=>lt(oe,"name",ge.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>ht(oe),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("start")}),e.jsx("input",{type:"time",value:_.timeStarted,onChange:ge=>lt(oe,"timeStarted",ge.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("end")}),e.jsx("input",{type:"time",value:_.timeEnded,onChange:ge=>lt(oe,"timeEnded",ge.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:_.hours,onChange:ge=>lt(oe,"hours",ge.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:_.overtimeHours,onChange:ge=>lt(oe,"overtimeHours",ge.target.value)})]})]})]},oe)})}),e.jsx("button",{className:"tm-add-btn",onClick:Se,children:ne("addOperator")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:ne("laborers")}),e.jsx("div",{className:"tm-workers-list",children:k.map((_,oe)=>{const Ce=ot(_);return e.jsxs("div",{className:`tm-worker-card-expanded ${Ce!=="empty"?`worker-${Ce}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[Ce==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Pa,{size:14})}),e.jsx("input",{type:"text",placeholder:ne("firstLastName"),value:_.name,onChange:ge=>me(oe,"name",ge.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>he(oe),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("start")}),e.jsx("input",{type:"time",value:_.timeStarted,onChange:ge=>me(oe,"timeStarted",ge.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("end")}),e.jsx("input",{type:"time",value:_.timeEnded,onChange:ge=>me(oe,"timeEnded",ge.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:_.hours,onChange:ge=>me(oe,"hours",ge.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ne("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:_.overtimeHours,onChange:ge=>me(oe,"overtimeHours",ge.target.value)})]})]})]},oe)})}),e.jsx("button",{className:"tm-add-btn",onClick:w,children:ne("addLaborer")})]})]}),f===3&&!Fe&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-field tm-search-field",children:[e.jsxs("div",{className:"tm-search-input-wrapper",children:[e.jsx(Bi,{size:18,className:"tm-search-icon"}),e.jsx("input",{type:"text",placeholder:ne("searchMaterials"),value:Xe,onChange:_=>la(_.target.value),onFocus:()=>It(),className:"tm-search-input"}),Xe&&e.jsx("button",{className:"tm-search-clear",onClick:()=>{Ye(""),De([])},children:""})]}),Xe&&Ze.length>0&&e.jsx("div",{className:"tm-search-results",children:Ze.map((_,oe)=>{const Ce=ie.find(ge=>ge.id===_.id);return e.jsxs("button",{className:`tm-search-result-item ${Ce?"added":""}`,onClick:()=>{Ce?at(ie.indexOf(Ce),Ce.quantity+1):T([...ie,{..._,quantity:1,isCustom:!1}]),Ye(""),De([])},children:[e.jsx("span",{className:"tm-search-result-name",children:_.name}),e.jsx("span",{className:"tm-search-result-category",children:_.category}),Ce&&e.jsxs("span",{className:"tm-search-result-qty",children:["",Ce.quantity]})]},oe)})}),Xe&&Ze.length===0&&e.jsx("div",{className:"tm-search-no-results",children:ne("noSearchResults")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:ne("orBrowse")}),e.jsx("div",{className:"tm-category-grid",children:id.map(_=>{const oe=ie.filter(Ce=>Ce.category===_);return e.jsxs("button",{className:"tm-category-card",onClick:()=>pt(_),children:[e.jsx("span",{className:"tm-cat-name",children:_}),oe.length>0&&e.jsx("span",{className:"tm-cat-count",children:oe.length})]},_)})})]}),ie.length>0&&e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:["Added Items (",ie.length,")"]}),e.jsx("div",{className:"tm-added-list",children:ie.map((_,oe)=>e.jsxs("div",{className:"tm-added-item",children:[e.jsxs("div",{className:"tm-added-info",children:[_.isCustom&&e.jsx("span",{className:"tm-custom-badge",children:"Custom"}),e.jsx("span",{className:"tm-added-name",children:_.name})]}),e.jsxs("div",{className:"tm-added-qty",children:[e.jsx("button",{onClick:()=>at(oe,_.quantity-1),children:""}),e.jsx("span",{children:_.quantity}),e.jsx("button",{onClick:()=>at(oe,_.quantity+1),children:"+"})]})]},oe))})]})]}),f===4&&e.jsxs("div",{className:"tm-step-content",children:[e.jsx("div",{className:"tm-review-section",children:e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Date"}),e.jsx("span",{children:new Date(j).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]})}),je&&e.jsxs("div",{className:"tm-review-section",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(Ma,{size:16,className:"inline-icon"})," ",ne("notes")]})}),e.jsx("div",{className:"tm-review-notes",children:je})]}),ke.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(Nr,{size:16,className:"inline-icon"})," ",ne("photos")]}),e.jsx("span",{children:ke.length})]}),e.jsx("div",{className:"tm-review-photos",children:ke.map(_=>e.jsx("img",{src:_.previewUrl,alt:_.name},_.id))})]}),pe&&e.jsxs("div",{className:"tm-review-section",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[" ",ne("linkedCOR")]})}),e.jsxs("div",{className:"tm-review-cor",children:[G.find(_=>_.id===pe)?.cor_number,": ",G.find(_=>_.id===pe)?.title||"Untitled"]})]}),Jt.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(pf,{size:16,className:"inline-icon"})," Supervision"]}),e.jsxs("span",{children:[Jt.reduce((_,oe)=>_+parseFloat(oe.hours||0)+parseFloat(oe.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:Jt.map((_,oe)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsxs("div",{className:"tm-review-worker-name",children:[e.jsx("span",{className:"tm-role-badge",children:_.role})," ",_.name]}),e.jsxs("div",{className:"tm-review-worker-details",children:[_.timeStarted&&_.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[_.timeStarted," - ",_.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[_.hours||0," reg",parseFloat(_.overtimeHours)>0?` + ${_.overtimeHours} OT`:""]})]})]},oe))})]}),ya.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Operators"}),e.jsxs("span",{children:[ya.reduce((_,oe)=>_+parseFloat(oe.hours||0)+parseFloat(oe.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:ya.map((_,oe)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:_.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[_.timeStarted&&_.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[_.timeStarted," - ",_.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[_.hours||0," reg",parseFloat(_.overtimeHours)>0?` + ${_.overtimeHours} OT`:""]})]})]},oe))})]}),Ue.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(Ea,{size:16,className:"inline-icon"})," Laborers"]}),e.jsxs("span",{children:[Ue.reduce((_,oe)=>_+parseFloat(oe.hours||0)+parseFloat(oe.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:Ue.map((_,oe)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:_.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[_.timeStarted&&_.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[_.timeStarted," - ",_.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[_.hours||0," reg",parseFloat(_.overtimeHours)>0?` + ${_.overtimeHours} OT`:""]})]})]},oe))})]}),ie.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(bl,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsxs("span",{children:[ie.length," items"]})]}),e.jsx("div",{className:"tm-review-list",children:ie.map((_,oe)=>e.jsxs("div",{className:"tm-review-row",children:[e.jsxs("span",{children:[_.isCustom&&e.jsxs(e.Fragment,{children:[e.jsx(Cd,{size:14,className:"inline-icon"})," "]}),_.name]}),e.jsxs("span",{children:[_.quantity," ",_.unit]})]},oe))})]}),e.jsxs("div",{className:"tm-review-section tm-certification",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(jl,{size:16,className:"inline-icon"})," Submitted By"]})}),e.jsx("input",{type:"text",className:"tm-certification-input",placeholder:"Enter your name",value:S,onChange:_=>K(_.target.value)}),e.jsx("p",{className:"tm-certification-note",children:"By submitting, you certify this T&M is accurate."})]})]}),f===5&&x&&e.jsxs("div",{className:"tm-step-content tm-success-step",children:[e.jsxs("div",{className:"tm-success-header",children:[e.jsx("div",{className:"tm-success-icon",children:e.jsx(rd,{size:48})}),e.jsx("h2",{children:be==="en"?"T&M Ticket Submitted!":"Ticket T&M Enviado!"}),e.jsx("p",{className:"tm-success-subtitle",children:be==="en"?"Your ticket has been saved and is ready for client signature.":"Su ticket ha sido guardado y est listo para la firma del cliente."})]}),e.jsxs("div",{className:"tm-success-summary",children:[e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:Je}),e.jsx("span",{className:"tm-success-stat-label",children:be==="en"?"Workers":"Trabajadores"})]}),e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:yt+st}),e.jsx("span",{className:"tm-success-stat-label",children:be==="en"?"Total Hours":"Horas Total"})]}),e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:new Date(j).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx("span",{className:"tm-success-stat-label",children:be==="en"?"Work Date":"Fecha"})]})]}),e.jsxs("div",{className:"tm-signature-options",children:[e.jsx("h3",{children:be==="en"?"Get Client Signature":"Obtener Firma del Cliente"}),e.jsx("p",{className:"tm-signature-description",children:be==="en"?"Have the client sign this T&M ticket to verify the work performed.":"Haga que el cliente firme este ticket T&M para verificar el trabajo realizado."}),J?e.jsxs("div",{className:"tm-signed-confirmation",children:[e.jsx(rd,{size:32,className:"tm-signed-icon"}),e.jsx("span",{children:be==="en"?"Client signature collected!":"Firma del cliente recopilada!"})]}):e.jsxs("div",{className:"tm-signature-buttons",children:[e.jsxs("button",{className:"tm-signature-option-btn primary",onClick:()=>V(!0),children:[e.jsx("div",{className:"tm-signature-option-icon",children:e.jsx(jl,{size:24})}),e.jsxs("div",{className:"tm-signature-option-text",children:[e.jsx("span",{className:"tm-signature-option-title",children:be==="en"?"Sign Now (On-Site)":"Firmar Ahora"}),e.jsx("span",{className:"tm-signature-option-desc",children:be==="en"?"Client signs on this device":"Cliente firma en este dispositivo"})]})]}),e.jsxs("button",{className:"tm-signature-option-btn",onClick:()=>M(!0),children:[e.jsx("div",{className:"tm-signature-option-icon",children:e.jsx(Td,{size:24})}),e.jsxs("div",{className:"tm-signature-option-text",children:[e.jsx("span",{className:"tm-signature-option-title",children:be==="en"?"Send Signature Link":"Enviar Enlace"}),e.jsx("span",{className:"tm-signature-option-desc",children:be==="en"?"Client signs later via link":"Cliente firma despus va enlace"})]})]})]})]})]}),L&&x&&e.jsx(zd,{documentType:"tm_ticket",documentId:x.id,companyId:l,projectId:r.id,documentTitle:`T&M - ${new Date(j).toLocaleDateString()}`,onClose:()=>M(!1),onShowToast:u}),P&&x&&e.jsx(Iv,{ticketId:x.id,ticketSummary:{workDate:j,workerCount:Je,totalHours:yt+st},lang:be,onSave:()=>{V(!1),ae(!0)},onClose:()=>V(!1),onShowToast:u}),f<5&&e.jsxs("div",{className:"tm-wizard-footer",children:[f===1&&e.jsx("button",{className:"tm-big-btn primary",onClick:Ve,disabled:!wa(),children:ne("nextCrew")}),f===2&&e.jsx(e.Fragment,{children:e.jsxs("button",{className:"tm-big-btn primary",onClick:Ve,disabled:!wa(),children:[ne("nextMaterials")," (",Je," ",ne(Je===1?"worker":"workers_plural"),", ",yt+st," hrs)"]})}),f===3&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"tm-big-btn primary",onClick:Ve,children:[ne("reviewItems")," (",ie.length," ",ie.length===1?ne("item"):ne("items_plural"),")"]}),e.jsx("button",{className:"tm-skip-btn",onClick:Ve,children:ne("skipNoMaterials")})]}),f===4&&e.jsx("button",{className:`tm-big-btn submit ${Te?"submitting":""} ${S.trim()?"ready":"needs-name"}`,onClick:ia,disabled:Te||!S.trim(),children:Te?e.jsxs(e.Fragment,{children:[e.jsx(Qj,{size:20,className:"tm-spinner"}),e.jsx("span",{className:"tm-submit-text",children:ze||ne("submitting")})]}):S.trim()?e.jsxs(e.Fragment,{children:[e.jsx(Pa,{size:20}),e.jsx("span",{children:ne("submitTM")})]}):e.jsxs(e.Fragment,{children:[e.jsx(jl,{size:18}),e.jsx("span",{children:be==="en"?"Enter name to submit":"Ingrese nombre"})]})})]}),f===5&&e.jsxs("div",{className:"tm-wizard-footer",children:[e.jsxs("button",{className:"tm-big-btn primary",onClick:i,children:[e.jsx(Pa,{size:20}),e.jsx("span",{children:be==="en"?"Done":"Listo"})]}),e.jsx("button",{className:"tm-skip-btn",onClick:i,children:be==="en"?"Skip signature for now":"Saltar firma por ahora"})]}),b&&e.jsx("div",{className:"tm-modal-overlay",onClick:()=>A(!1),children:e.jsxs("div",{className:"tm-batch-modal",onClick:_=>_.stopPropagation(),children:[e.jsxs("h3",{children:[e.jsx(xn,{size:18})," ",ne("applySameHours")]}),e.jsx("p",{className:"tm-batch-description",children:ne("batchDescription")}),e.jsxs("div",{className:"tm-time-presets",children:[e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>We("full"),children:ne("preset8hr")}),e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>We("10hr"),children:ne("preset10hr")}),e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>We("half"),children:ne("preset4hr")})]}),e.jsxs("div",{className:"tm-batch-form",children:[e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:ne("timeStarted")}),e.jsx("input",{type:"time",value:z.timeStarted,onChange:_=>{const oe=_.target.value,Ce=Ae(oe,z.timeEnded);de({...z,timeStarted:oe,...Ce||{}})}})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:ne("timeEnded")}),e.jsx("input",{type:"time",value:z.timeEnded,onChange:_=>{const oe=_.target.value,Ce=Ae(z.timeStarted,oe);de({...z,timeEnded:oe,...Ce||{}})}})]})]}),e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:ne("regularHours")}),e.jsx("input",{type:"number",placeholder:"8",value:z.hours,onChange:_=>de({...z,hours:_.target.value})})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:ne("overtimeHours")}),e.jsx("input",{type:"number",placeholder:"0",value:z.overtimeHours,onChange:_=>de({...z,overtimeHours:_.target.value})})]})]})]}),e.jsxs("div",{className:"tm-batch-preview",children:[e.jsxs("strong",{children:[ne("willApplyTo"),":"]}),e.jsxs("span",{children:[[...N.filter(_=>_.name.trim()),...E.filter(_=>_.name.trim()),...k.filter(_=>_.name.trim())].length," ",ne("workers_plural")]})]}),e.jsxs("div",{className:"tm-batch-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>A(!1),children:ne("cancel")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:Lt,disabled:!z.hours&&!z.overtimeHours,children:ne("applyToAll")})]})]})})]})}function Kv({project:r,onShowToast:l}){const[o,i]=p.useState([]),[m,u]=p.useState(!0),[f,g]=p.useState(!1),[j,v]=p.useState(!1),[x,q]=p.useState({name:"",role:"Laborer"});p.useEffect(()=>{L()},[r.id]);const L=async()=>{try{const J=await te.getCrewCheckin(r.id);J?.workers&&i(J.workers)}catch(J){console.error("Error loading crew:",J)}finally{u(!1)}},M=async()=>{if(!x.name.trim()){l("Enter worker name","error");return}if(o.find(J=>J.name.toLowerCase()===x.name.trim().toLowerCase())){l("Worker already added","error");return}g(!0);try{const J=[...o,{name:x.name.trim(),role:x.role}];await te.saveCrewCheckin(r.id,J),i(J),q({name:"",role:"Laborer"}),v(!1),l("Crew member added","success")}catch(J){console.error("Error adding worker:",J),l("Error adding crew member","error")}finally{g(!1)}},P=async J=>{g(!0);try{const ae=o.filter(F=>F.name.toLowerCase()!==J.toLowerCase());await te.saveCrewCheckin(r.id,ae),i(ae),l("Crew member removed","success")}catch(ae){console.error("Error removing worker:",ae),l("Error removing crew member","error")}finally{g(!1)}},V=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"});return m?e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(Ea,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:V})]}),e.jsx("div",{className:"crew-loading",children:"Loading..."})]}):e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(Ea,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:V})]}),o.length===0?e.jsxs("div",{className:"crew-empty",children:[e.jsx("p",{children:"No crew checked in yet"}),e.jsx("p",{className:"crew-empty-hint",children:"Add your crew for the day"})]}):e.jsx("div",{className:"crew-list",children:o.map(J=>e.jsxs("div",{className:"crew-member",children:[e.jsxs("div",{className:"crew-member-info",children:[e.jsx("span",{className:"crew-member-name",children:J.name}),e.jsx("span",{className:`crew-member-role ${J.role.toLowerCase()}`,children:J.role})]}),e.jsx("button",{className:"crew-remove-btn",onClick:()=>P(J.name),disabled:f,children:""})]},J.name))}),j?e.jsxs("div",{className:"crew-add-form",children:[e.jsx("input",{type:"text",value:x.name,onChange:J=>q({...x,name:J.target.value}),placeholder:"Name",autoFocus:!0}),e.jsxs("select",{value:x.role,onChange:J=>q({...x,role:J.target.value}),children:[e.jsx("option",{value:"Foreman",children:"Foreman"}),e.jsx("option",{value:"Laborer",children:"Laborer"}),e.jsx("option",{value:"Supervisor",children:"Supervisor"}),e.jsx("option",{value:"Operator",children:"Operator"})]}),e.jsxs("div",{className:"crew-add-buttons",children:[e.jsx("button",{className:"crew-add-confirm",onClick:M,disabled:f,children:f?"...":"Add"}),e.jsx("button",{className:"crew-add-cancel",onClick:()=>{v(!1),q({name:"",role:"Laborer"})},children:"Cancel"})]})]}):e.jsx("button",{className:"crew-add-btn",onClick:()=>v(!0),children:"+ Add Crew Member"}),e.jsxs("div",{className:"crew-count",children:[o.length," ",o.length===1?"person":"people"," on site"]})]})}function ey({project:r,onShowToast:l,onClose:o}){const[i,m]=p.useState(!0),[u,f]=p.useState(!1),[g,j]=p.useState(null),[v,x]=p.useState(""),[q,L]=p.useState("");p.useEffect(()=>{M()},[r.id]);const M=async()=>{try{const ae=await te.getDailyReport(r.id);if(ae)j(ae),x(ae.field_notes||""),L(ae.issues||"");else{const F=await te.compileDailyReport(r.id);j({...F,status:"draft"})}}catch(ae){console.error("Error loading report:",ae),l("Error loading report","error")}finally{m(!1)}},P=async()=>{if(!Y){l("Demo Mode: Report saved locally only - won't reach office","info"),o();return}f(!0);try{await te.saveDailyReport(r.id,{field_notes:v,issues:q}),await te.submitDailyReport(r.id,"Field")?(l("Daily report submitted!","success"),o()):l("Report not sent - check connection","error")}catch(ae){console.error("Error submitting report:",ae),l("Error submitting report","error")}finally{f(!1)}},V=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});if(i)return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),e.jsx("h2",{children:"Daily Report"})]}),e.jsx("div",{className:"daily-report-loading",children:"Compiling report..."})]});const J=g?.status==="submitted";return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),e.jsxs("div",{children:[e.jsx("h2",{children:"Daily Report"}),e.jsx("p",{className:"daily-report-date",children:V})]})]}),J&&e.jsxs("div",{className:"daily-report-submitted-banner",children:[" Submitted ",new Date(g.submitted_at).toLocaleTimeString()]}),e.jsxs("div",{className:"daily-report-content",children:[e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.crew_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.tasks_completed||0}),e.jsx("div",{className:"daily-report-card-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.tm_tickets_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.photos_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Photos"})]})]}),g.crew_list?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Ea,{size:18,className:"inline-icon"})," Crew"]}),e.jsx("div",{className:"daily-report-crew",children:g.crew_list.map((ae,F)=>e.jsxs("div",{className:"daily-report-crew-item",children:[e.jsx("span",{children:ae.name}),e.jsx("span",{className:"daily-report-crew-role",children:ae.role})]},F))})]}),g.completed_tasks?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(fs,{size:18,className:"inline-icon"})," Completed Today"]}),e.jsx("ul",{className:"daily-report-tasks",children:g.completed_tasks.map((ae,F)=>e.jsxs("li",{children:[ae.name,ae.group&&e.jsx("span",{className:"daily-report-task-group",children:ae.group})]},F))})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Ma,{size:18,className:"inline-icon"})," Notes"]}),e.jsx("textarea",{value:v,onChange:ae=>x(ae.target.value),placeholder:"Any notes about today's work...",rows:3,disabled:J})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(yl,{size:18,className:"inline-icon"})," Issues / Concerns"]}),e.jsx("textarea",{value:q,onChange:ae=>L(ae.target.value),placeholder:"Any problems, delays, or concerns...",rows:3,disabled:J})]})]}),!J&&e.jsxs("div",{className:"daily-report-footer",children:[e.jsx("button",{className:"btn btn-primary daily-report-submit",onClick:P,disabled:u,children:u?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(Av,{size:16,className:"inline-icon"})," Submit Report"]})}),e.jsx("p",{className:"daily-report-hint",children:"This will be sent to the office"})]})]})}const ty=p.createContext({}),xf=()=>p.useContext(ty);function Ls({message:r,type:l="",onClose:o}){return p.useEffect(()=>{const i=setTimeout(o,3e3);return()=>clearTimeout(i)},[o]),e.jsx("div",{className:"toast-container",children:e.jsx("div",{className:`toast ${l}`,children:r})})}function jf({project:r,companyId:l,onClose:o,onReportCreated:i}){const{user:m}=xf(),[u,f]=p.useState(!1),[g,j]=p.useState(null),[v,x]=p.useState(1),[q,L]=p.useState(new Date().toISOString().split("T")[0]),[M,P]=p.useState(new Date().toTimeString().split(" ")[0].substring(0,5)),[V,J]=p.useState(""),[ae,F]=p.useState(""),[R,S]=p.useState("minor"),[K,pe]=p.useState(""),[$,G]=p.useState(""),[B,Z]=p.useState(""),[C,b]=p.useState(""),[A,z]=p.useState(""),[de,N]=p.useState(""),[se,E]=p.useState(""),[xe,k]=p.useState(m?.name||""),[U,ie]=p.useState(""),[T,je]=p.useState(""),[I,ke]=p.useState(m?.email||""),[ue,Te]=p.useState([]),[Be,ze]=p.useState(""),[Oe,gt]=p.useState(""),[tt,ee]=p.useState(""),[Me,Fe]=p.useState(""),[pt,ma]=p.useState(!1),[we,qe]=p.useState(""),[$e,Xe]=p.useState(""),[Ye,Ze]=p.useState(!1),[De,vt]=p.useState(""),[wt,Zt]=p.useState(""),[ta,Nt]=p.useState(""),[Pt,X]=p.useState(""),[O,be]=p.useState(!1),[Ee,ne]=p.useState(!1),[Ae,ot]=p.useState(0),[We,Qt]=p.useState(0),Lt=()=>{if(!Be.trim()){j({type:"error",message:"Please enter witness name"});return}const Ne={name:Be,phone:Oe,email:tt,testimony:Me};Te([...ue,Ne]),ze(""),gt(""),ee(""),Fe(""),j({type:"success",message:"Witness added"})},Dt=Ne=>{Te(ue.filter((kt,ft)=>ft!==Ne))},Mt=Ne=>{switch(Ne){case 1:if(!V.trim()||!ae.trim())return j({type:"error",message:"Please fill in all incident details"}),!1;break;case 2:if(!$.trim()||!de.trim())return j({type:"error",message:"Please fill in employee name and job title"}),!1;break;case 3:if(!xe.trim()||!U.trim())return j({type:"error",message:"Please fill in supervisor name and title"}),!1;break}return!0},$t=()=>{Mt(v)&&x(v+1)},It=()=>{x(v-1)},la=async()=>{if(Mt(v)){if(!Y){j({type:"info",message:"Demo Mode: Report saved locally only - won't reach office"}),setTimeout(()=>{o()},1500);return}f(!0);try{const Ne={project_id:r.id,company_id:l,incident_date:q,incident_time:M,incident_location:V,incident_description:ae,injury_type:R,body_part_affected:K||null,employee_name:$,employee_phone:B||null,employee_email:C||null,employee_address:A||null,employee_job_title:de,employee_hire_date:se||null,medical_treatment_required:pt,medical_facility_name:we||null,medical_facility_address:$e||null,hospitalized:Ye,reported_by_name:xe,reported_by_title:U,reported_by_phone:T||null,reported_by_email:I||null,witnesses:ue,immediate_actions_taken:De||null,corrective_actions_planned:wt||null,safety_equipment_used:ta||null,safety_equipment_failed:Pt||null,osha_recordable:O,workers_comp_claim:Ee,days_away_from_work:parseInt(Ae)||0,restricted_work_days:parseInt(We)||0,status:"reported",created_by:m?.id},kt=await te.createInjuryReport(Ne);j({type:"success",message:"Injury report submitted successfully"}),i&&i(kt),setTimeout(()=>{o()},1500)}catch(Ne){console.error("Error submitting injury report:",Ne),j({type:"error",message:"Failed to submit injury report"})}finally{f(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:o,children:e.jsxs("div",{className:"modal-content injury-report-modal",onClick:Ne=>Ne.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Workplace Injury/Incident Report"}),e.jsx("button",{className:"close-btn",onClick:o,children:""})]}),e.jsxs("div",{className:"progress-steps",children:[e.jsx("div",{className:`step ${v>=1?"active":""}`,children:"1. Incident"}),e.jsx("div",{className:`step ${v>=2?"active":""}`,children:"2. Employee"}),e.jsx("div",{className:`step ${v>=3?"active":""}`,children:"3. Supervisor"}),e.jsx("div",{className:`step ${v>=4?"active":""}`,children:"4. Witnesses"}),e.jsx("div",{className:`step ${v>=5?"active":""}`,children:"5. Medical & Safety"})]}),e.jsxs("div",{className:"modal-body",children:[v===1&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Incident Details"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date of Incident *"}),e.jsx("input",{type:"date",value:q,onChange:Ne=>L(Ne.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Time of Incident *"}),e.jsx("input",{type:"time",value:M,onChange:Ne=>P(Ne.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Location on Site *"}),e.jsx("input",{type:"text",value:V,onChange:Ne=>J(Ne.target.value),placeholder:"e.g., Floor 2, near elevator shaft"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Incident Description *"}),e.jsx("textarea",{value:ae,onChange:Ne=>F(Ne.target.value),rows:4,placeholder:"Describe what happened in detail..."})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Injury Type *"}),e.jsxs("select",{value:R,onChange:Ne=>S(Ne.target.value),children:[e.jsx("option",{value:"minor",children:"Minor Injury"}),e.jsx("option",{value:"serious",children:"Serious Injury"}),e.jsx("option",{value:"critical",children:"Critical Injury"}),e.jsx("option",{value:"near_miss",children:"Near Miss (No Injury)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("input",{type:"text",value:K,onChange:Ne=>pe(Ne.target.value),placeholder:"e.g., Left hand, lower back"})]})]})]}),v===2&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Injured Employee Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:$,onChange:Ne=>G(Ne.target.value),placeholder:"First and last name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:B,onChange:Ne=>Z(Ne.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:C,onChange:Ne=>b(Ne.target.value),placeholder:"email@example.com"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Home Address"}),e.jsx("input",{type:"text",value:A,onChange:Ne=>z(Ne.target.value),placeholder:"Street address, city, state, zip"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Title *"}),e.jsx("input",{type:"text",value:de,onChange:Ne=>N(Ne.target.value),placeholder:"e.g., Carpenter, Electrician"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Hire Date"}),e.jsx("input",{type:"date",value:se,onChange:Ne=>E(Ne.target.value)})]})]})]}),v===3&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Foreman/Supervisor Making Report"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Name *"}),e.jsx("input",{type:"text",value:xe,onChange:Ne=>k(Ne.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Title *"}),e.jsx("input",{type:"text",value:U,onChange:Ne=>ie(Ne.target.value),placeholder:"e.g., Site Foreman, Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Phone Number"}),e.jsx("input",{type:"tel",value:T,onChange:Ne=>je(Ne.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Email Address"}),e.jsx("input",{type:"email",value:I,onChange:Ne=>ke(Ne.target.value),placeholder:"email@example.com"})]})]}),v===4&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Witness Testimonies (Optional)"}),ue.length>0&&e.jsx("div",{className:"witnesses-list",children:ue.map((Ne,kt)=>e.jsxs("div",{className:"witness-item",children:[e.jsxs("div",{className:"witness-info",children:[e.jsx("strong",{children:Ne.name}),Ne.phone&&e.jsxs("span",{children:["  ",Ne.phone]}),Ne.testimony&&e.jsxs("p",{className:"witness-testimony",children:['"',Ne.testimony,'"']})]}),e.jsx("button",{className:"btn-danger btn-small",onClick:()=>Dt(kt),children:"Remove"})]},kt))}),e.jsxs("div",{className:"add-witness-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Name"}),e.jsx("input",{type:"text",value:Be,onChange:Ne=>ze(Ne.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:Oe,onChange:Ne=>gt(Ne.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:tt,onChange:Ne=>ee(Ne.target.value),placeholder:"email@example.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Testimony"}),e.jsx("textarea",{value:Me,onChange:Ne=>Fe(Ne.target.value),rows:3,placeholder:"What did the witness see or hear?"})]}),e.jsx("button",{className:"btn-secondary",onClick:Lt,children:"+ Add Witness"})]})]}),v===5&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Medical Treatment & Safety"}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:pt,onChange:Ne=>ma(Ne.target.checked)}),"Medical treatment required"]})}),pt&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Name"}),e.jsx("input",{type:"text",value:we,onChange:Ne=>qe(Ne.target.value),placeholder:"Hospital or clinic name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Address"}),e.jsx("input",{type:"text",value:$e,onChange:Ne=>Xe(Ne.target.value),placeholder:"Street address"})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Ye,onChange:Ne=>Ze(Ne.target.checked)}),"Employee was hospitalized"]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("textarea",{value:De,onChange:Ne=>vt(Ne.target.value),rows:2,placeholder:"What was done immediately after the incident?"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("textarea",{value:wt,onChange:Ne=>Zt(Ne.target.value),rows:2,placeholder:"What will be done to prevent this in the future?"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("input",{type:"text",value:ta,onChange:Ne=>Nt(Ne.target.value),placeholder:"e.g., Hard hat, gloves, harness"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("input",{type:"text",value:Pt,onChange:Ne=>X(Ne.target.value),placeholder:"Equipment that failed, if any"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("input",{type:"number",min:"0",value:Ae,onChange:Ne=>ot(Ne.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("input",{type:"number",min:"0",value:We,onChange:Ne=>Qt(Ne.target.value)})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:O,onChange:Ne=>be(Ne.target.checked)}),"OSHA Recordable Incident"]})}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Ee,onChange:Ne=>ne(Ne.target.checked)}),"Workers' Compensation Claim Filed"]})})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"form-actions",children:[v>1&&e.jsx("button",{className:"btn-secondary",onClick:It,children:" Back"}),e.jsx("button",{className:"btn-secondary",onClick:o,children:"Cancel"}),v<5?e.jsx("button",{className:"btn-primary",onClick:$t,children:"Next "}):e.jsx("button",{className:"btn-primary",onClick:la,disabled:u,children:u?"Submitting...":"Submit Report"})]})})]})}),g&&e.jsx(Ls,{message:g.message,type:g.type,onClose:()=>j(null)}),e.jsx("style",{children:`
        .injury-report-modal {
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid var(--border-color);
          background-color: var(--bg-elevated);
          overflow-x: auto;
        }

        .progress-steps .step {
          font-size: 0.875rem;
          color: var(--text-muted);
          font-weight: 500;
          white-space: nowrap;
          padding: 0.5rem;
        }

        .progress-steps .step.active {
          color: var(--accent-primary);
          font-weight: 600;
        }

        .form-step h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          color: var(--text-primary);
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 1rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-group textarea {
          resize: vertical;
        }

        .checkbox-group label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: normal;
          cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
          width: auto;
          margin: 0;
        }

        .witnesses-list {
          margin-bottom: 1.5rem;
        }

        .witness-item {
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .witness-info {
          flex: 1;
          color: var(--text-primary);
        }

        .witness-testimony {
          margin-top: 0.5rem;
          color: var(--text-secondary);
          font-style: italic;
          font-size: 0.875rem;
        }

        .add-witness-form {
          border: 2px dashed var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          background-color: var(--bg-elevated);
        }

        .modal-footer {
          border-top: 1px solid var(--border-color);
          padding: 1rem 1.5rem;
        }

        .form-actions {
          display: flex;
          justify-content: space-between;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
        }

        @media (max-width: 768px) {
          .injury-report-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }

          .form-row {
            grid-template-columns: 1fr;
          }

          .progress-steps .step {
            font-size: 0.75rem;
            padding: 0.25rem;
          }
        }
      `})]})}function vf({compact:r=!1}){const{theme:l,toggleTheme:o}=ej();return e.jsx("button",{className:`theme-toggle ${r?"theme-toggle-compact":""}`,onClick:o,title:`Switch to ${l==="dark"?"light":"dark"} mode`,"aria-label":`Switch to ${l==="dark"?"light":"dark"} mode`,children:l==="dark"?e.jsxs(e.Fragment,{children:[e.jsx(Cv,{size:r?18:16}),!r&&e.jsx("span",{children:"Light"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ev,{size:r?18:16}),!r&&e.jsx("span",{children:"Dark"})]})})}const cd=[{value:"concrete",label:"Concrete",icon:""},{value:"trash",label:"Trash",icon:""},{value:"metals",label:"Metals",icon:""},{value:"hazardous_waste",label:"Hazardous",icon:""}];function ay({project:r,user:l=null,date:o,onShowToast:i}){const[m,u]=p.useState([]),[f,g]=p.useState(!0),[j,v]=p.useState(!1),[x,q]=p.useState(!1),[L,M]=p.useState({type:"concrete",count:1}),P=new Date(o).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});p.useEffect(()=>{V()},[r.id,o]);const V=async()=>{try{g(!0);const $=await te.getDisposalLoads(r.id,o);u($||[])}catch($){console.error("Error loading disposal loads:",$)}finally{g(!1)}},J=async()=>{if(!(L.count<1)){v(!0);try{await te.addDisposalLoad(r.id,l?.id||null,o,L.type,L.count),await V(),M({type:"concrete",count:1}),q(!1),i?.("Disposal load added","success")}catch($){console.error("Error adding disposal load:",$),i?.("Error adding load","error")}finally{v(!1)}}},ae=async $=>{v(!0);try{await te.deleteDisposalLoad($),await V(),i?.("Load removed","success")}catch(G){console.error("Error deleting disposal load:",G),i?.("Error removing load","error")}finally{v(!1)}},F=async $=>{v(!0);try{await te.addDisposalLoad(r.id,l?.id||null,o,$,1),await V(),i?.("Load added","success")}catch(G){console.error("Error adding disposal load:",G),i?.("Error adding load","error")}finally{v(!1)}},R=async $=>{v(!0);try{await te.updateDisposalLoad($.id,$.load_type,$.load_count+1),await V()}catch(G){console.error("Error updating load:",G),i?.("Error updating load","error")}finally{v(!1)}},S=async $=>{if($.load_count<=1){await ae($.id);return}v(!0);try{await te.updateDisposalLoad($.id,$.load_type,$.load_count-1),await V()}catch(G){console.error("Error updating load:",G),i?.("Error updating load","error")}finally{v(!1)}},K=m.reduce(($,G)=>($[G.load_type]||($[G.load_type]={items:[],total:0}),$[G.load_type].items.push(G),$[G.load_type].total+=G.load_count,$),{}),pe=m.reduce(($,G)=>$+G.load_count,0);return f?e.jsxs("div",{className:"disposal-load-input",children:[e.jsxs("div",{className:"disposal-header",children:[e.jsx(rs,{size:20}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("div",{className:"disposal-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-load-input",children:[e.jsxs("div",{className:"disposal-header",children:[e.jsxs("div",{className:"disposal-title",children:[e.jsx(rs,{size:20}),e.jsx("span",{children:"Disposal Loads"}),pe>0&&e.jsx("span",{className:"disposal-badge",children:pe})]}),e.jsx("span",{className:"disposal-date",children:P})]}),e.jsx("div",{className:"disposal-quick-add",children:cd.map($=>e.jsxs("button",{className:"quick-add-btn",onClick:()=>F($.value),disabled:j,children:[e.jsx("span",{className:"quick-add-icon",children:$.icon}),e.jsxs("span",{className:"quick-add-label",children:["+ ",$.label]})]},$.value))}),Object.keys(K).length>0?e.jsx("div",{className:"disposal-loads-list",children:cd.map($=>{const G=K[$.value];return G?e.jsxs("div",{className:"disposal-load-row",children:[e.jsxs("div",{className:"load-info",children:[e.jsx("span",{className:"load-icon",children:$.icon}),e.jsx("span",{className:"load-label",children:$.label})]}),e.jsxs("div",{className:"load-controls",children:[e.jsx("button",{className:"load-btn decrement",onClick:()=>S(G.items[0]),disabled:j,children:e.jsx(Nd,{size:16})}),e.jsx("span",{className:"load-count",children:G.total}),e.jsx("button",{className:"load-btn increment",onClick:()=>R(G.items[0]),disabled:j,children:e.jsx(gs,{size:16})})]})]},$.value):null})}):e.jsxs("div",{className:"disposal-empty",children:[e.jsxs("p",{children:["No disposal loads recorded for ",P]}),e.jsx("p",{className:"disposal-hint",children:"Tap a button above to add loads"})]}),x&&e.jsxs("div",{className:"disposal-add-form",children:[e.jsxs("div",{className:"add-form-row",children:[e.jsx("select",{value:L.type,onChange:$=>M({...L,type:$.target.value}),className:"load-type-select",children:cd.map($=>e.jsxs("option",{value:$.value,children:[$.icon," ",$.label]},$.value))}),e.jsxs("div",{className:"count-input-group",children:[e.jsx("button",{className:"count-btn",onClick:()=>M({...L,count:Math.max(1,L.count-1)}),children:e.jsx(Nd,{size:16})}),e.jsx("input",{type:"number",min:"1",value:L.count,onChange:$=>M({...L,count:parseInt($.target.value)||1}),className:"count-input"}),e.jsx("button",{className:"count-btn",onClick:()=>M({...L,count:L.count+1}),children:e.jsx(gs,{size:16})})]})]}),e.jsxs("div",{className:"add-form-actions",children:[e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>q(!1),children:[e.jsx(Ta,{size:16})," Cancel"]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:J,disabled:j,children:[e.jsx(Pa,{size:16})," Add"]})]})]}),!x&&e.jsxs("button",{className:"disposal-add-custom",onClick:()=>q(!0),children:[e.jsx(gs,{size:16}),"Add multiple loads"]}),pe>0&&e.jsxs("div",{className:"disposal-summary",children:[e.jsx("strong",{children:pe})," total load",pe!==1?"s":""," today"]})]})}function sy({project:r,companyId:l,onShowToast:o,onExit:i}){const[m,u]=p.useState([]),[f,g]=p.useState(!0),[j,v]=p.useState(null),[x,q]=p.useState({}),[L,M]=p.useState(!1),[P,V]=p.useState(!1),[J,ae]=p.useState(!1),[F,R]=p.useState(!1),[S,K]=p.useState(!1),[pe,$]=p.useState(!1),[G,B]=p.useState("actions");p.useEffect(()=>{Z()},[r.id]);const Z=async()=>{try{const k=await te.getAreas(r.id);u(k);const U=[...new Set(k.map(T=>T.group_name||"General"))],ie={};U.forEach(T=>ie[T]=!1),q(ie)}catch(k){console.error("Error loading areas:",k),o("Error loading areas","error")}finally{g(!1)}},C=async(k,U)=>{const ie=m.find(je=>je.id===k);if(!ie)return;const T=ie.status===U?"not_started":U;v(k);try{await te.updateAreaStatus(k,T),u(je=>je.map(I=>I.id===k?{...I,status:T}:I)),o("Updated","success")}catch(je){console.error("Error updating status:",je),o("Error updating","error")}finally{v(null)}},b=k=>{q(U=>({...U,[k]:!U[k]}))};if(f)return e.jsx("div",{className:"foreman-container",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading..."]})});if(L)return e.jsx("div",{className:"foreman-container",children:e.jsx(Wv,{project:r,companyId:l,onSubmit:()=>M(!1),onCancel:()=>M(!1),onShowToast:o})});if(F)return e.jsx(ey,{project:r,onShowToast:o,onClose:()=>R(!1)});if(S)return e.jsx("div",{className:"foreman-container",children:e.jsx(jf,{project:r,companyId:l,onClose:()=>K(!1),onReportCreated:()=>{K(!1),o("Injury report submitted","success")}})});if(P)return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-view-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:()=>V(!1),children:""}),e.jsx("h2",{children:"Crew Check-in"})]}),e.jsx(Kv,{project:r,onShowToast:o})]});if(J)return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-view-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:()=>ae(!1),children:""}),e.jsx("h2",{children:"Disposal Loads"})]}),e.jsx(ay,{project:r,date:new Date().toISOString().split("T")[0],onShowToast:o})]});const A=Yv(m),z=m.reduce((k,U)=>{const ie=U.group_name||"General";return k[ie]||(k[ie]=[]),k[ie].push(U),k},{}),de=Object.keys(z).length>1||Object.keys(z).length===1&&!z.General,N=k=>`${k.filter(ie=>ie.status==="done").length}/${k.length}`,se=m.filter(k=>k.status==="done").length,E=m.filter(k=>k.status==="working").length,xe=m.length-se;return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),e.jsxs("div",{className:"foreman-header-info",children:[e.jsx("div",{className:"foreman-project-name",children:r.name}),e.jsxs("div",{className:"foreman-progress",children:[A,"% Complete"]})]}),e.jsxs("div",{className:"foreman-header-actions",children:[e.jsx(vf,{compact:!0}),e.jsx("button",{className:"foreman-info-btn",onClick:()=>$(!pe),children:e.jsx(_d,{size:20})})]})]}),pe&&e.jsxs("div",{className:"foreman-project-info",children:[r.job_number&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Job #"}),e.jsx("span",{className:"foreman-info-value",children:r.job_number})]}),r.address&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Address"}),e.jsx("span",{className:"foreman-info-value",children:r.address})]}),r.general_contractor&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"GC / Client"}),e.jsx("span",{className:"foreman-info-value",children:r.general_contractor})]}),r.client_contact&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Contact"}),e.jsx("span",{className:"foreman-info-value",children:r.client_contact})]}),r.client_phone&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Phone"}),e.jsx("a",{href:`tel:${r.client_phone}`,className:"foreman-info-value foreman-info-link",children:r.client_phone})]})]}),e.jsxs("div",{className:"foreman-stats",children:[e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value working",children:E}),e.jsx("div",{className:"foreman-stat-label",children:"Working"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value done",children:se}),e.jsx("div",{className:"foreman-stat-label",children:"Done"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value remaining",children:xe}),e.jsx("div",{className:"foreman-stat-label",children:"Remaining"})]})]}),e.jsxs("div",{className:"foreman-tabs",children:[e.jsxs("button",{className:`foreman-tab ${G==="actions"?"active":""}`,onClick:()=>B("actions"),children:[e.jsx(Cd,{size:18}),"Actions"]}),e.jsxs("button",{className:`foreman-tab ${G==="progress"?"active":""}`,onClick:()=>B("progress"),children:[e.jsx(Sd,{size:18}),"Progress"]})]}),G==="actions"&&e.jsxs("div",{className:"field-actions",children:[e.jsxs("button",{className:"field-action-btn",onClick:()=>M(!0),children:[e.jsx(Ma,{size:22}),"T&M Ticket"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>V(!0),children:[e.jsx(Ea,{size:22}),"Crew Check-in"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>ae(!0),children:[e.jsx(rs,{size:22}),"Disposal Loads"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>R(!0),children:[e.jsx(as,{size:22}),"Daily Report"]}),e.jsxs("button",{className:"field-action-btn danger",onClick:()=>K(!0),children:[e.jsx(yl,{size:22}),"Report Injury"]})]}),G==="progress"&&e.jsxs("div",{className:"foreman-areas",children:[de?Object.entries(z).map(([k,U])=>e.jsxs("div",{className:"foreman-group",children:[e.jsxs("div",{className:"foreman-group-header",onClick:()=>b(k),children:[e.jsxs("div",{className:"foreman-group-title",children:[e.jsx("span",{className:"foreman-group-arrow",children:x[k]?"":""}),e.jsx("span",{className:"foreman-group-name",children:k})]}),e.jsx("span",{className:"foreman-group-progress",children:N(U)})]}),x[k]&&e.jsx("div",{className:"foreman-group-tasks",children:U.map(ie=>e.jsxs("div",{className:`foreman-area-card ${ie.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:ie.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${ie.status==="working"?"active":""}`,onClick:()=>C(ie.id,"working"),disabled:j===ie.id,children:j===ie.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${ie.status==="done"?"active":""}`,onClick:()=>C(ie.id,"done"),disabled:j===ie.id,children:j===ie.id?"...":"Done"})]})]},ie.id))})]},k)):m.map(k=>e.jsxs("div",{className:`foreman-area-card ${k.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:k.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${k.status==="working"?"active":""}`,onClick:()=>C(k.id,"working"),disabled:j===k.id,children:j===k.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${k.status==="done"?"active":""}`,onClick:()=>C(k.id,"done"),disabled:j===k.id,children:j===k.id?"...":"Done"})]})]},k.id)),m.length===0&&e.jsxs("div",{className:"foreman-empty",children:[e.jsx(as,{size:48,className:"foreman-empty-icon"}),e.jsx("div",{className:"foreman-empty-text",children:"No areas yet"}),e.jsx("div",{className:"foreman-empty-subtext",children:"Office needs to add areas to this project"})]})]})]})}const Rp=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},ny=r=>new Promise(l=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const i=document.createElement("canvas");i.width=o.width,i.height=o.height,i.getContext("2d").drawImage(o,0,0),l(i.toDataURL("image/png"))},o.onerror=()=>l(null),o.src=r});function ry({project:r,company:l,onShowToast:o,compact:i=!1}){const{branding:m}=wr(),[u,f]=p.useState([]),[g,j]=p.useState(!0),[v,x]=p.useState("all"),[q,L]=p.useState(null),[M,P]=p.useState(new Set),[V,J]=p.useState("recent"),[ae,F]=p.useState(new Set),[R,S]=p.useState({start:"",end:""}),[K,pe]=p.useState(!1),[$,G]=p.useState(null),[B,Z]=p.useState(""),[C,b]=p.useState(!1),[A,z]=p.useState(null),[de,N]=p.useState(!1),[se,E]=p.useState(null),[xe,k]=p.useState([]),[U,ie]=p.useState(""),[T,je]=p.useState(!1),[I,ke]=p.useState({});p.useEffect(()=>{ue();const X=te.subscribeToTMTickets?.(r.id,()=>{ue()});return()=>{X&&te.unsubscribe?.(X)}},[r.id]);const ue=async()=>{try{const X=await te.getTMTickets(r.id);f(X);const O=X.filter(be=>be.assigned_cor_id);if(O.length>0){const be={};await Promise.all(O.map(async Ee=>{const ne=await te.isTicketEditable(Ee);ne.editable||(be[Ee.id]=ne)})),ke(be)}}catch(X){console.error("Error loading tickets:",X),o("Error loading T&M tickets","error")}finally{j(!1)}},Te=async(X,O)=>{if(I[X]){o(I[X].reason||"This ticket is locked (COR approved)","error");return}try{await te.updateTMTicketStatus(X,O),f(u.map(be=>be.id===X?{...be,status:O}:be)),o(`Ticket ${O}`,"success")}catch(be){console.error("Error updating status:",be),o("Error updating status","error")}},Be=X=>{if(I[X.id]){o(I[X.id].reason||"This ticket is locked (COR approved)","error");return}Te(X.id,"approved")},ze=async()=>{if($)try{const X=parseFloat(B)||0;await te.approveTMTicket($.id,null,null,X),f(u.map(O=>O.id===$.id?{...O,status:"approved",change_order_value:X}:O)),o(`Ticket approved with $${X.toLocaleString()} change order`,"success"),pe(!1),G(null),Z("")}catch(X){console.error("Error approving ticket:",X),o("Error approving ticket","error")}},Oe=async X=>{if(I[X]){o(I[X].reason||"This ticket is locked (COR approved)","error");return}if(confirm("Delete this T&M ticket?"))try{await te.deleteTMTicket(X),f(u.filter(O=>O.id!==X)),o("Ticket deleted","success")}catch(O){console.error("Error deleting ticket:",O),o("Error deleting ticket","error")}},gt=async X=>{E(X),ie(X.assigned_cor_id||""),N(!0),je(!0);try{const O=await te.getAssignableCORs(r.id);k(O||[])}catch(O){console.error("Error loading CORs:",O),o("Error loading change orders","error")}finally{je(!1)}},tt=async()=>{if(se)try{if(U){await te.assignTicketToCOR(se.id,U);const X=xe.find(O=>O.id===U);o(`Ticket linked to ${X?.cor_number||"COR"}`,"success")}else se.assigned_cor_id&&(await te.unassignTicketFromCOR(se.id,se.assigned_cor_id),o("Ticket unlinked from COR","success"));ue(),N(!1),E(null),ie("")}catch(X){console.error("Error updating COR association:",X),o("Error updating COR link","error")}},ee=X=>{let O=0;return X.t_and_m_items&&X.t_and_m_items.forEach(be=>{be.materials_equipment?.cost_per_unit&&(O+=be.quantity*be.materials_equipment.cost_per_unit)}),O},Me=X=>X.t_and_m_workers?X.t_and_m_workers.reduce((O,be)=>{const Ee=parseFloat(be.hours)||0,ne=parseFloat(be.overtime_hours)||0;return O+Ee+ne},0):0,Fe=X=>new Date(X).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),pt=(X,O)=>{O.stopPropagation(),P(be=>{const Ee=new Set(be);return Ee.has(X)?Ee.delete(X):Ee.add(X),Ee})},ma=()=>{const X=v==="all"?u:u.filter(be=>be.status===v),O=X.every(be=>M.has(be.id));P(O?new Set:new Set(X.map(be=>be.id)))},we=()=>{P(new Set)},qe=()=>{const X=v==="all"?u:u.filter(O=>O.status===v);return M.size>0?X.filter(O=>M.has(O.id)):X},$e=()=>{const X=qe();if(X.length===0){o("No tickets to export","error");return}const O=[],be=[],Ee=[];X.forEach(We=>{const Qt=Fe(We.work_date),Lt=We.status;We.t_and_m_workers&&We.t_and_m_workers.forEach(Dt=>{const Mt=parseFloat(Dt.hours)||0,$t=parseFloat(Dt.overtime_hours)||0;O.push({Date:Qt,Status:Lt,"Worker Name":Dt.name,Role:Dt.role||"Laborer","Regular Hours":Mt,"OT Hours":$t,"Total Hours":Mt+$t})}),We.t_and_m_items&&We.t_and_m_items.forEach(Dt=>{const Mt=Dt.custom_name||Dt.materials_equipment?.name||"Unknown",$t=Dt.custom_category||Dt.materials_equipment?.category||"Unknown",It=Dt.materials_equipment?.unit||"each",la=Dt.materials_equipment?.cost_per_unit||0,Ne=Dt.quantity*la;be.push({Date:Qt,Status:Lt,Category:$t,Item:Mt,Quantity:Dt.quantity,Unit:It,"Cost/Unit":la,Total:Ne})}),Ee.push({Date:Qt,Status:Lt,Workers:We.t_and_m_workers?.length||0,"Total Hours":Me(We),Items:We.t_and_m_items?.length||0,"Materials Cost":ee(We),Notes:We.notes||""})});const ne=hn.book_new(),Ae=hn.json_to_sheet(Ee);if(hn.book_append_sheet(ne,Ae,"Summary"),O.length>0){const We=hn.json_to_sheet(O);hn.book_append_sheet(ne,We,"Workers")}if(be.length>0){const We=hn.json_to_sheet(be);hn.book_append_sheet(ne,We,"Materials & Equipment")}const ot=`${r.name}_TM_${new Date().toISOString().split("T")[0]}.xlsx`;Mx(ne,ot),o("Export downloaded!","success")},Xe=async()=>{const X=qe();if(X.length===0){o("No tickets to export","error");return}o("Generating PDF...","info");const O=new Fi,be=O.internal.pageSize.getWidth(),Ee=O.internal.pageSize.getHeight(),ne=20;let Ae=ne;const ot=Rp(m?.primary_color||"#3B82F6"),We=Rp(m?.secondary_color||"#1E40AF");O.setFillColor(...ot),O.rect(0,0,be,45,"F"),O.setFillColor(...We),O.rect(0,42,be,3,"F");let Qt=ne;if(m?.logo_url)try{const Ue=await ny(m.logo_url);Ue&&(O.addImage(Ue,"PNG",ne,7,30,30),Qt=ne+30+10)}catch(Ue){console.error("Error adding logo:",Ue)}O.setTextColor(255,255,255),O.setFontSize(22),O.setFont("helvetica","bold"),O.text(l?.name||"Company Name",Qt,20),O.setFontSize(10),O.setFont("helvetica","normal"),O.text("TIME & MATERIALS REPORT",Qt,30),O.setFontSize(9),O.text(`Report Date: ${new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,be-ne,18,{align:"right"}),r.job_number&&O.text(`Job #: ${r.job_number}`,be-ne,26,{align:"right"}),O.text(`Status: ${v.charAt(0).toUpperCase()+v.slice(1)}`,be-ne,34,{align:"right"}),Ae=55,O.setFillColor(248,250,252),O.rect(ne,Ae-5,be-ne*2,30,"F"),O.setDrawColor(...ot),O.setLineWidth(.5),O.rect(ne,Ae-5,be-ne*2,30,"S"),O.setTextColor(...ot),O.setFontSize(14),O.setFont("helvetica","bold"),O.text(`Project: ${r.name}`,ne+5,Ae+7),O.setFontSize(10),O.setFont("helvetica","normal"),O.setTextColor(51,65,85);const Lt=X.map(Ue=>new Date(Ue.work_date)).sort((Ue,Je)=>Ue-Je),Dt=Lt[0]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Mt=Lt[Lt.length-1]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});O.text(`Date Range: ${Dt} - ${Mt}`,ne+5,Ae+17),O.text(`Total Tickets: ${X.length}`,be-ne-5,Ae+7,{align:"right"}),Ae+=40;const $t=X.reduce((Ue,Je)=>Ue+Me(Je),0),It=X.reduce((Ue,Je)=>Ue+ee(Je),0),la=new Set(X.flatMap(Ue=>Ue.t_and_m_workers?.map(Je=>Je.name)||[])).size;O.setTextColor(...ot),O.setFontSize(12),O.setFont("helvetica","bold"),O.text("SUMMARY",ne,Ae),Ae+=8;const Ne=(be-ne*2-20)/3,kt=[{label:"Total Labor Hours",value:$t.toFixed(1)},{label:"Unique Workers",value:la.toString()},{label:"Materials Cost",value:`$${It.toFixed(2)}`}],ft=ot.map(Ue=>Math.min(255,Ue+180));kt.forEach((Ue,Je)=>{const yt=ne+Je*(Ne+10);O.setFillColor(...ft),O.rect(yt,Ae,Ne,25,"F"),O.setDrawColor(...ot),O.setLineWidth(.5),O.rect(yt,Ae,Ne,25,"S"),O.setTextColor(...ot),O.setFontSize(16),O.setFont("helvetica","bold"),O.text(Ue.value,yt+Ne/2,Ae+12,{align:"center"}),O.setTextColor(100,116,139),O.setFontSize(8),O.setFont("helvetica","normal"),O.text(Ue.label,yt+Ne/2,Ae+20,{align:"center"})}),Ae+=35;const ja=[],w=[],me=[];let he=0,Se=0,lt=0,ht=0,it=0,Et=0;X.forEach(Ue=>{Ue.t_and_m_workers&&Ue.t_and_m_workers.forEach(Je=>{const yt=parseFloat(Je.hours)||0,st=parseFloat(Je.overtime_hours)||0,pa=Je.role||"Laborer",ba=[Fe(Ue.work_date),Je.name,yt.toString(),st>0?st.toString():"-",(yt+st).toString()];pa==="Foreman"||pa==="Superintendent"?(ja.push(ba),he+=yt,Se+=st):pa==="Operator"?(w.push(ba),lt+=yt,ht+=st):(me.push(ba),it+=yt,Et+=st)})});const at=(Ue,Je,yt,st)=>{Je.length!==0&&(Ae>Ee-80&&(O.addPage(),Ae=ne),O.setTextColor(...ot),O.setFontSize(11),O.setFont("helvetica","bold"),O.text(Ue,ne,Ae),Ae+=5,fn(O,{startY:Ae,head:[["Date","Name","Reg Hrs","OT Hrs","Total"]],body:Je,margin:{left:ne,right:ne},headStyles:{fillColor:ot,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:30},2:{halign:"center",cellWidth:22},3:{halign:"center",cellWidth:22},4:{halign:"center",cellWidth:22}},foot:[["","SUBTOTAL:",yt.toString(),st>0?st.toString():"-",(yt+st).toString()]],footStyles:{fillColor:We,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),Ae=O.lastAutoTable.finalY+10)};if(ja.length>0||w.length>0||me.length>0){O.setTextColor(...ot),O.setFontSize(12),O.setFont("helvetica","bold"),O.text("LABOR",ne,Ae),Ae+=8,at("SUPERVISION",ja,he,Se),at("OPERATORS",w,lt,ht),at("LABORERS",me,it,Et);const Ue=he+lt+it,Je=Se+ht+Et;O.setFillColor(...ot),O.rect(ne,Ae,be-ne*2,12,"F"),O.setTextColor(255,255,255),O.setFontSize(10),O.setFont("helvetica","bold"),O.text("LABOR TOTAL:",ne+5,Ae+8),O.text(`${Ue} Reg + ${Je} OT = ${Ue+Je} Hours`,be-ne-5,Ae+8,{align:"right"}),Ae+=20}Ae>Ee-100&&(O.addPage(),Ae=ne);const rt={},ha={},va=["Containment","PPE","Disposal","Equipment","Other"];X.forEach(Ue=>{Ue.t_and_m_items&&Ue.t_and_m_items.forEach(Je=>{const yt=Je.custom_name||Je.materials_equipment?.name||"Unknown",st=Je.custom_category||Je.materials_equipment?.category||"Other",pa=Je.materials_equipment?.unit||"each",ba=Je.materials_equipment?.cost_per_unit||0,fa=Je.quantity*ba;rt[st]||(rt[st]=[],ha[st]=0),rt[st].push([Fe(Ue.work_date),yt,Je.quantity.toString(),pa,`$${ba.toFixed(2)}`,`$${fa.toFixed(2)}`]),ha[st]+=fa})});const wa=(Ue,Je,yt)=>{!Je||Je.length===0||(Ae>Ee-80&&(O.addPage(),Ae=ne),O.setTextColor(...ot),O.setFontSize(11),O.setFont("helvetica","bold"),O.text(Ue.toUpperCase(),ne,Ae),Ae+=5,fn(O,{startY:Ae,head:[["Date","Item","Qty","Unit","Rate","Total"]],body:Je,margin:{left:ne,right:ne},headStyles:{fillColor:ot,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{2:{halign:"center",cellWidth:20},3:{halign:"center",cellWidth:25},4:{halign:"right",cellWidth:25},5:{halign:"right",cellWidth:30}},foot:[["","","","","Subtotal:",`$${yt.toFixed(2)}`]],footStyles:{fillColor:We,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),Ae=O.lastAutoTable.finalY+10)};Object.keys(rt).length>0&&(O.setTextColor(...ot),O.setFontSize(12),O.setFont("helvetica","bold"),O.text("MATERIALS & EQUIPMENT",ne,Ae),Ae+=8,va.forEach(Ue=>{rt[Ue]&&wa(Ue,rt[Ue],ha[Ue])}),Object.keys(rt).forEach(Ue=>{va.includes(Ue)||wa(Ue,rt[Ue],ha[Ue])}),O.setFillColor(...ot),O.rect(ne,Ae,be-ne*2,12,"F"),O.setTextColor(255,255,255),O.setFontSize(10),O.setFont("helvetica","bold"),O.text("MATERIALS TOTAL:",ne+5,Ae+8),O.text(`$${It.toFixed(2)}`,be-ne-5,Ae+8,{align:"right"}),Ae+=20),Ae>Ee-80&&(O.addPage(),Ae=ne),Ae+=10,O.setDrawColor(...ot),O.setLineWidth(1),O.line(ne,Ae,be-ne,Ae),Ae+=15,O.setTextColor(...ot),O.setFontSize(12),O.setFont("helvetica","bold"),O.text("AUTHORIZATION",ne,Ae),Ae+=10,O.setFontSize(10),O.setFont("helvetica","normal"),O.setTextColor(71,85,105),O.text("I hereby authorize the above time and materials charges as accurate and approved for billing.",ne,Ae),Ae+=20;const Ke=ticketsToExport[0]||{},ia=(Ue,Je,yt,st,pa,ba,fa)=>{O.setFont("helvetica","bold"),O.setFontSize(8),O.setTextColor(...ot),O.text(Je,ne,Ue),O.setFont("helvetica","normal"),O.setFontSize(9),O.setTextColor(100,116,139);const _=Ue+18;if(O.setDrawColor(...We),O.setLineWidth(.5),O.line(ne,_,ne+70,_),O.text("Signature",ne,_+8),O.line(ne+85,_,ne+145,_),O.text("Title / Company",ne+85,_+8),O.line(be-ne-40,_,be-ne,_),O.text("Date",be-ne-40,_+8),yt)try{if(O.addImage(yt,"PNG",ne,_-16,60,16),st&&(O.setFontSize(8),O.text(st,ne,_+15)),pa||ba){const oe=[pa,ba].filter(Boolean).join(" - ");O.text(oe,ne+85,_-5)}if(fa){const oe=new Date(fa).toLocaleDateString();O.text(oe,be-ne-40,_-5)}}catch(oe){console.error("Error adding signature to PDF:",oe)}return _+25};Ae=ia(Ae,"GC AUTHORIZATION",Ke.gc_signature_data,Ke.gc_signature_name,Ke.gc_signature_title,Ke.gc_signature_company,Ke.gc_signature_date),Ae+=8,Ae=ia(Ae,"CLIENT AUTHORIZATION",Ke.client_signature_data,Ke.client_signature_name,Ke.client_signature_title,Ke.client_signature_company,Ke.client_signature_date);const Jt=O.internal.getNumberOfPages();for(let Ue=1;Ue<=Jt;Ue++){O.setPage(Ue);const Je=Ee-15;O.setFontSize(8),O.setTextColor(148,163,184),O.text(`${l?.name||"Company"} - T&M Report - ${r.name}`,ne,Je),O.text(`Page ${Ue} of ${Jt}`,be-ne,Je,{align:"right"})}const ya=`${r.name}_TM_Report_${new Date().toISOString().split("T")[0]}.pdf`;O.save(ya),o("PDF exported!","success")},Ye=p.useMemo(()=>{let X=v==="all"?[...u]:u.filter(O=>O.status===v);if(R.start){const O=new Date(R.start);O.setHours(0,0,0,0),X=X.filter(be=>new Date(be.work_date)>=O)}if(R.end){const O=new Date(R.end);O.setHours(23,59,59,999),X=X.filter(be=>new Date(be.work_date)<=O)}if(V==="recent"){const O=new Date;O.setDate(O.getDate()-7),O.setHours(0,0,0,0),X=X.filter(be=>new Date(be.work_date)>=O)}return X},[u,v,V,R]),Ze=p.useMemo(()=>{if(V!=="all")return null;const X={};return Ye.forEach(O=>{const be=new Date(O.work_date),Ee=`${be.getFullYear()}-${String(be.getMonth()+1).padStart(2,"0")}`,ne=be.toLocaleDateString("en-US",{month:"long",year:"numeric"});X[Ee]||(X[Ee]={label:ne,tickets:[],hours:0,cost:0}),X[Ee].tickets.push(O),X[Ee].hours+=Me(O),X[Ee].cost+=ee(O)}),Object.entries(X).sort((O,be)=>be[0].localeCompare(O[0]))},[Ye,V]);p.useEffect(()=>{if(Ze&&Ze.length>0){const X=Ze[0][0];F(new Set([X]))}},[Ze]);const De=X=>{const O=new Set(ae);O.has(X)?O.delete(X):O.add(X),F(O)},vt=Ye.reduce((X,O)=>X+Me(O),0),wt=Ye.reduce((X,O)=>X+ee(O),0),Zt=v==="all"?u.length:u.filter(X=>X.status===v).length;if(g)return e.jsx("div",{className:"loading",children:"Loading T&M tickets..."});const ta=Ye.length>0&&Ye.every(X=>M.has(X.id)),Nt=M.size>0,Pt=X=>{const O=!!I[X.id],be=I[X.id];return e.jsxs("div",{className:`tm-ticket-card ${X.status} ${M.has(X.id)?"selected":""} ${O?"locked":""}`,children:[e.jsxs("div",{className:"tm-ticket-header",onClick:()=>L(q===X.id?null:X.id),children:[e.jsx("input",{type:"checkbox",checked:M.has(X.id),onChange:Ee=>pt(X.id,Ee),onClick:Ee=>Ee.stopPropagation(),className:"tm-checkbox"}),e.jsxs("div",{className:"tm-ticket-info",children:[e.jsx("span",{className:"tm-ticket-date",children:Fe(X.work_date)}),X.ce_pco_number&&e.jsx("span",{className:"tm-ce-badge",children:X.ce_pco_number}),X.assigned_cor_id&&be?.lockedBy&&e.jsxs("span",{className:`tm-cor-badge ${O?"locked":""}`,title:be.reason,children:[O&&e.jsx(Ap,{size:10}),be.lockedBy.cor_number]}),X.photos?.length>0&&e.jsxs("span",{className:"tm-photo-badge",title:`${X.photos.length} photo${X.photos.length>1?"s":""}`,children:[e.jsx(Nr,{size:12})," ",X.photos.length]}),e.jsx("span",{className:`tm-ticket-status ${X.status}`,children:X.status})]}),e.jsxs("div",{className:"tm-ticket-summary",children:[e.jsxs("span",{className:"tm-ticket-hours",children:[Me(X)," hrs"]}),e.jsxs("span",{className:"tm-ticket-total",children:["$",ee(X).toFixed(2)]}),e.jsx("span",{className:"tm-expand-arrow",children:q===X.id?"":""})]})]}),q===X.id&&e.jsxs("div",{className:"tm-ticket-details",children:[X.t_and_m_workers?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Ea,{size:16,className:"inline-icon"})," Workers"]}),e.jsx("div",{className:"tm-detail-list",children:X.t_and_m_workers.map(Ee=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsxs("span",{children:[Ee.role&&Ee.role!=="Laborer"&&e.jsx("span",{className:"tm-role-badge",children:Ee.role}),Ee.name]}),e.jsxs("span",{children:[Ee.hours," hrs",parseFloat(Ee.overtime_hours)>0&&e.jsxs("span",{className:"tm-ot-badge",children:[" +",Ee.overtime_hours," OT"]})]})]},Ee.id))})]}),X.t_and_m_items?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(bl,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsx("div",{className:"tm-detail-list",children:X.t_and_m_items.map(Ee=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsx("span",{children:Ee.custom_name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"tm-custom-badge",children:"Custom"})," ",Ee.custom_name]}):Ee.materials_equipment?.name}),e.jsxs("span",{className:"tm-detail-qty",children:[Ee.quantity," ",Ee.materials_equipment?.unit||"each",Ee.materials_equipment?.cost_per_unit>0&&e.jsxs("span",{className:"tm-item-cost",children:["$",(Ee.quantity*Ee.materials_equipment.cost_per_unit).toFixed(2)]})]})]},Ee.id))})]}),X.notes&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Ma,{size:16,className:"inline-icon"})," Description"]}),e.jsx("p",{className:"tm-notes-text",children:X.notes})]}),X.photos&&X.photos.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Nr,{size:16,className:"inline-icon"})," Photos (",X.photos.length,")"]}),e.jsx("div",{className:"tm-photos-grid",children:X.photos.map((Ee,ne)=>e.jsx("a",{href:Ee,target:"_blank",rel:"noopener noreferrer",className:"tm-photo-thumb",children:e.jsx("img",{src:Ee,alt:`Photo ${ne+1}`,onError:Ae=>{Ae.target.onerror=null,Ae.target.classList.add("photo-error"),Ae.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg==",console.error("Failed to load photo:",Ee)}})},ne))})]}),X.ce_pco_number&&X.change_order_value>0&&e.jsxs("div",{className:"tm-change-order-value",children:[e.jsx("span",{className:"tm-co-label",children:"Change Order Value:"}),e.jsxs("span",{className:"tm-co-amount",children:["$",X.change_order_value.toLocaleString()]})]}),O&&e.jsxs("div",{className:"tm-lock-notice",children:[e.jsx(Ap,{size:14}),e.jsx("span",{children:be?.reason||"This ticket is locked (COR approved)"})]}),e.jsxs("div",{className:"tm-ticket-actions",children:[X.status==="pending"&&!O&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:Ee=>{Ee.stopPropagation(),Be(X)},children:"Approve"}),e.jsx("button",{className:"btn btn-warning btn-small",onClick:Ee=>{Ee.stopPropagation(),Te(X.id,"rejected")},children:"Reject"})]}),X.status==="approved"&&!O&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary btn-small",onClick:Ee=>{Ee.stopPropagation(),Te(X.id,"billed")},children:"Mark Billed"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:Ee=>{Ee.stopPropagation(),z(X),b(!0)},children:[e.jsx(kd,{size:14})," Signature Link"]})]}),X.status==="rejected"&&!O&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Ee=>{Ee.stopPropagation(),Te(X.id,"pending")},children:"Restore"}),!O&&e.jsxs("button",{className:`btn btn-small ${X.assigned_cor_id?"btn-ghost":"btn-secondary"}`,onClick:Ee=>{Ee.stopPropagation(),gt(X)},title:X.assigned_cor_id?"Change COR link":"Link to Change Order",children:[e.jsx(Gj,{size:14})," ",X.assigned_cor_id?"COR":"Link COR"]}),!O&&e.jsx("button",{className:"btn btn-danger btn-small",onClick:Ee=>{Ee.stopPropagation(),Oe(X.id)},children:"Delete"})]})]})]},X.id)};return e.jsxs("div",{className:`tm-list ${i?"tm-list-compact":""}`,children:[!i&&e.jsxs("div",{className:"tm-list-header",children:[e.jsxs("div",{className:"tm-list-title",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("div",{className:"tm-export-buttons",children:[Nt&&e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:we,children:["Clear (",M.size,")"]}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:$e,children:["Excel ",Nt?`(${M.size})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:Xe,children:["PDF ",Nt?`(${M.size})`:""]})]})]}),e.jsx("div",{className:"tm-filter-tabs",children:["all","pending","approved","billed","rejected"].map(X=>e.jsxs("button",{className:`tm-filter-tab ${v===X?"active":""}`,onClick:()=>{x(X),we()},children:[X.charAt(0).toUpperCase()+X.slice(1),e.jsx("span",{className:"tm-filter-count",children:X==="all"?u.length:u.filter(O=>O.status===X).length})]},X))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${V==="recent"?"active":""}`,onClick:()=>{J("recent"),S({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${V==="all"?"active":""}`,onClick:()=>J("all"),children:["All (",Zt,")"]})]}),V==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(kr,{size:16}),e.jsx("input",{type:"date",value:R.start,onChange:X=>S(O=>({...O,start:X.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:R.end,onChange:X=>S(O=>({...O,end:X.target.value})),placeholder:"End date"}),(R.start||R.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>S({start:"",end:""}),children:"Clear"})]})]})]}),!i&&Ye.length>0&&e.jsxs("div",{className:"tm-summary-bar",children:[e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Tickets"}),e.jsx("span",{className:"tm-summary-value",children:Ye.length})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Total Hours"}),e.jsx("span",{className:"tm-summary-value",children:vt.toFixed(1)})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Materials Cost"}),e.jsxs("span",{className:"tm-summary-value",children:["$",wt.toFixed(2)]})]})]}),Ye.length===0?e.jsxs("div",{className:"tm-empty-state",children:[e.jsxs("p",{children:["No ",v==="all"?"":v," T&M tickets",V==="recent"?" in the last 7 days":""]}),V==="recent"&&Zt>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>J("all"),children:"View All Tickets"})]}):e.jsxs("div",{className:"tm-tickets",children:[e.jsx("div",{className:"tm-select-all-row",children:e.jsxs("label",{className:"tm-checkbox-label",onClick:ma,children:[e.jsx("input",{type:"checkbox",checked:ta,onChange:ma,className:"tm-checkbox"}),e.jsxs("span",{children:["Select All (",Ye.length,")"]})]})}),V==="all"&&Ze?Ze.map(([X,O])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>De(X),children:[e.jsxs("div",{className:"month-header-left",children:[ae.has(X)?e.jsx(ka,{size:18}):e.jsx(Hs,{size:18}),e.jsx("span",{className:"month-label",children:O.label}),e.jsxs("span",{className:"month-count",children:[O.tickets.length," tickets"]})]}),e.jsxs("div",{className:"month-header-right",children:[e.jsxs("span",{className:"month-stat",children:[O.hours.toFixed(1)," hrs"]}),e.jsxs("span",{className:"month-stat",children:["$",O.cost.toFixed(2)]})]})]}),ae.has(X)&&e.jsx("div",{className:"month-tickets",children:O.tickets.map(be=>Pt(be))})]},X)):Ye.map(X=>Pt(X))]}),K&&$&&e.jsx("div",{className:"modal-overlay",onClick:()=>pe(!1),children:e.jsxs("div",{className:"modal change-order-modal",onClick:X=>X.stopPropagation(),children:[e.jsx("h3",{children:"Approve Change Order Work"}),e.jsxs("p",{className:"modal-subtitle",children:["This T&M ticket is associated with ",e.jsx("strong",{children:$.ce_pco_number})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Change Order Value ($)"}),e.jsx("input",{type:"number",value:B,onChange:X=>Z(X.target.value),placeholder:"Enter the change order amount",autoFocus:!0}),e.jsx("p",{className:"form-help",children:"This amount will be added to the project's total contract value."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>pe(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:ze,children:["Approve with $",parseFloat(B||0).toLocaleString()]})]})]})}),C&&A&&e.jsx(zd,{documentType:"tm_ticket",documentId:A.id,companyId:l?.id,projectId:r?.id,documentTitle:`T&M Ticket - ${new Date(A.work_date).toLocaleDateString()}${A.ce_pco_number?` (${A.ce_pco_number})`:""}`,onClose:()=>{b(!1),z(null)},onShowToast:o}),de&&se&&e.jsx("div",{className:"modal-overlay",onClick:()=>N(!1),children:e.jsxs("div",{className:"modal cor-assign-modal",onClick:X=>X.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Link Ticket to Change Order"}),e.jsx("button",{className:"close-btn",onClick:()=>N(!1),children:e.jsx(Ta,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{className:"modal-subtitle",children:["Ticket: ",e.jsx("strong",{children:new Date(se.work_date).toLocaleDateString()}),se.ce_pco_number&&` (${se.ce_pco_number})`]}),T?e.jsx("div",{className:"loading",children:"Loading change orders..."}):xe.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No change orders found for this project."}),e.jsx("p",{className:"text-muted",children:"Create a COR first, then link tickets to it."})]}):e.jsxs("div",{className:"cor-select-wrapper",children:[e.jsx("label",{children:"Select Change Order:"}),e.jsxs("select",{value:U,onChange:X=>ie(X.target.value),className:"cor-select",children:[e.jsx("option",{value:"",children:"-- No COR (unlink) --"}),xe.map(X=>e.jsxs("option",{value:X.id,children:[X.cor_number," - ",X.title||"Untitled"," (",X.status,")"]},X.id))]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>N(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:tt,disabled:T||xe.length===0,children:se.assigned_cor_id&&!U?"Unlink from COR":"Link to COR"})]})]})})]})}function ly({project:r,onClose:l,onShareCreated:o}){const{user:i}=xf(),[m,u]=p.useState(!1),[f,g]=p.useState(null),[j,v]=p.useState([]),[x,q]=p.useState(!1),[L,M]=p.useState({progress:!0,photos:!0,daily_reports:!0,tm_tickets:!1,crew_info:!1}),[P,V]=p.useState("never"),[J,ae]=p.useState("");p.useEffect(()=>{F()},[r.id]);const F=async()=>{try{const b=await te.getProjectShares(r.id);v(b)}catch(b){console.error("Error loading shares:",b)}},R=b=>{M(A=>({...A,[b]:!A[b]}))},S=()=>{if(P==="never")return null;const b=new Date;if(P==="30days")b.setDate(b.getDate()+30);else if(P==="90days")b.setDate(b.getDate()+90);else if(P==="custom"&&J)return new Date(J).toISOString();return b.toISOString()},K=async()=>{u(!0);try{const b=S(),A=await te.createProjectShare(r.id,i.id,L,b);g({type:"success",message:"Share link created!"}),q(!1),F(),o&&o(A)}catch(b){console.error("Error creating share:",b),g({type:"error",message:"Failed to create share link"})}finally{u(!1)}},pe=b=>{const A=`${window.location.origin}/view/${b}`;navigator.clipboard.writeText(A),g({type:"success",message:"Link copied to clipboard!"})},$=async b=>{if(confirm("Are you sure you want to revoke this share link?"))try{await te.revokeProjectShare(b),g({type:"success",message:"Share link revoked"}),F()}catch(A){console.error("Error revoking share:",A),g({type:"error",message:"Failed to revoke share link"})}},G=async b=>{if(confirm("Are you sure you want to permanently delete this share link?"))try{await te.deleteProjectShare(b),g({type:"success",message:"Share link deleted"}),F()}catch(A){console.error("Error deleting share:",A),g({type:"error",message:"Failed to delete share link"})}},B=b=>b?new Date(b).toLocaleDateString():"Never",Z=b=>b?new Date(b)<new Date:!1,C=b=>{const A=[];return b.progress&&A.push("Progress"),b.photos&&A.push("Photos"),b.daily_reports&&A.push("Reports"),b.tm_tickets&&A.push("T&M"),b.crew_info&&A.push("Crew"),A.join(", ")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:l,children:e.jsxs("div",{className:"modal-content share-modal",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Share Project: ",r.name]}),e.jsx("button",{className:"close-btn",onClick:l,children:""})]}),e.jsxs("div",{className:"modal-body",children:[j.length>0&&e.jsxs("div",{className:"existing-shares",children:[e.jsx("h3",{children:"Active Share Links"}),e.jsx("div",{className:"shares-list",children:j.map(b=>e.jsxs("div",{className:`share-item ${!b.is_active||Z(b.expires_at)?"inactive":""}`,children:[e.jsxs("div",{className:"share-info",children:[e.jsxs("div",{className:"share-token",children:[e.jsxs("code",{children:[window.location.origin,"/view/",b.share_token]}),e.jsx("button",{className:"btn-small",onClick:()=>pe(b.share_token),disabled:!b.is_active||Z(b.expires_at),children:"Copy"})]}),e.jsxs("div",{className:"share-meta",children:[e.jsx("span",{className:"permissions",children:C(b.permissions)}),e.jsxs("span",{className:"expiry",children:["Expires: ",B(b.expires_at)]}),e.jsxs("span",{className:"views",children:["Views: ",b.view_count||0,b.last_viewed_at&&` (Last: ${B(b.last_viewed_at)})`]})]}),!b.is_active&&e.jsx("div",{className:"status-badge revoked",children:"Revoked"}),Z(b.expires_at)&&b.is_active&&e.jsx("div",{className:"status-badge expired",children:"Expired"})]}),e.jsxs("div",{className:"share-actions",children:[b.is_active&&!Z(b.expires_at)&&e.jsx("button",{className:"btn-secondary",onClick:()=>$(b.id),children:"Revoke"}),e.jsx("button",{className:"btn-danger",onClick:()=>G(b.id),children:"Delete"})]})]},b.id))})]}),!x&&e.jsx("button",{className:"btn-primary",onClick:()=>q(!0),children:"+ Create New Share Link"}),x&&e.jsxs("div",{className:"new-share-form",children:[e.jsx("h3",{children:"Create New Share Link"}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Permissions"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:L.progress,onChange:()=>R("progress")}),"Progress/completion status"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:L.photos,onChange:()=>R("photos")}),"Photos feed"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:L.daily_reports,onChange:()=>R("daily_reports")}),"Daily reports"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:L.tm_tickets,onChange:()=>R("tm_tickets")}),"T&M tickets"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:L.crew_info,onChange:()=>R("crew_info")}),"Crew information"]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"never",checked:P==="never",onChange:b=>V(b.target.value)}),"Never expires"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"30days",checked:P==="30days",onChange:b=>V(b.target.value)}),"30 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"90days",checked:P==="90days",onChange:b=>V(b.target.value)}),"90 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"custom",checked:P==="custom",onChange:b=>V(b.target.value)}),"Custom date"]})]}),P==="custom"&&e.jsx("input",{type:"date",value:J,onChange:b=>ae(b.target.value),min:new Date().toISOString().split("T")[0],className:"date-input"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>q(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:K,disabled:m,children:m?"Generating...":"Generate Share Link"})]})]})]})]})}),f&&e.jsx(Ls,{message:f.message,type:f.type,onClose:()=>g(null)}),e.jsx("style",{children:`
        .share-modal {
          max-width: 700px;
          max-height: 80vh;
          overflow-y: auto;
        }

        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1.5rem;
          border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .close-btn {
          background: none;
          border: none;
          font-size: 2rem;
          cursor: pointer;
          color: var(--text-secondary);
          padding: 0;
          width: 2rem;
          height: 2rem;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .close-btn:hover {
          color: var(--text-primary);
        }

        .modal-body {
          padding: 1.5rem;
        }

        .existing-shares {
          margin-bottom: 2rem;
        }

        .existing-shares h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .shares-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .share-item {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          gap: 1rem;
          background: var(--bg-card);
        }

        .share-item.inactive {
          opacity: 0.6;
          background-color: var(--bg-elevated);
        }

        .share-info {
          flex: 1;
        }

        .share-token {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-bottom: 0.5rem;
        }

        .share-token code {
          background-color: var(--bg-elevated);
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.875rem;
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          color: var(--text-primary);
        }

        .share-meta {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .status-badge {
          display: inline-block;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 500;
          margin-top: 0.5rem;
        }

        .status-badge.revoked {
          background-color: #fee2e2;
          color: #991b1b;
        }

        .status-badge.expired {
          background-color: #fef3c7;
          color: #92400e;
        }

        .share-actions {
          display: flex;
          gap: 0.5rem;
          flex-shrink: 0;
        }

        .new-share-form {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          background-color: var(--bg-elevated);
        }

        .new-share-form h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .form-section {
          margin-bottom: 1.5rem;
        }

        .form-section label {
          display: block;
          font-weight: 500;
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .checkbox-group,
        .radio-group {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .checkbox-group label,
        .radio-group label {
          font-weight: normal;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .checkbox-group input[type="checkbox"],
        .radio-group input[type="radio"] {
          margin: 0;
        }

        .date-input {
          margin-top: 0.5rem;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          width: 100%;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-actions {
          display: flex;
          justify-content: flex-end;
          gap: 0.5rem;
          margin-top: 1.5rem;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
          border: 1px solid var(--border-color);
          background-color: var(--bg-card);
          color: var(--text-primary);
          border-radius: 4px;
          cursor: pointer;
        }

        .btn-small:hover:not(:disabled) {
          background-color: var(--bg-elevated);
        }

        .btn-small:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }
      `})]})}const od=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},iy=r=>new Promise(l=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const i=document.createElement("canvas");i.width=o.width,i.height=o.height,i.getContext("2d").drawImage(o,0,0),l(i.toDataURL("image/png"))},o.onerror=()=>l(null),o.src=r});function cy({project:r,companyId:l,company:o,onShowToast:i}){const{branding:m}=wr(),[u,f]=p.useState([]),[g,j]=p.useState(null),[v,x]=p.useState(!1),[q,L]=p.useState(!0),[M,P]=p.useState(null),[V,J]=p.useState("recent"),[ae,F]=p.useState(new Set),[R,S]=p.useState({start:"",end:""});p.useEffect(()=>{K();const E=l||r?.company_id,xe=E?te.subscribeToInjuryReports?.(E,()=>{K()}):null;return()=>{xe&&te.unsubscribe?.(xe)}},[r?.id,l]);const K=async()=>{L(!0);try{const E=r?await te.getInjuryReports(r.id):await te.getCompanyInjuryReports(l);f(E)}catch(E){console.error("Error loading injury reports:",E),P({type:"error",message:"Failed to load injury reports"})}finally{L(!1)}},pe=()=>{K(),x(!1),P({type:"success",message:"Injury report created successfully"})},$=E=>{j(E)},G=()=>{j(null)},B=E=>E?new Date(E).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",Z=E=>E?new Date(`2000-01-01T${E}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",C=E=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[E]||E,b=E=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[E]||"#9ca3af",A=E=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[E]||"#9ca3af",z=p.useMemo(()=>{let E=[...u];if(R.start){const xe=new Date(R.start);xe.setHours(0,0,0,0),E=E.filter(k=>new Date(k.incident_date)>=xe)}if(R.end){const xe=new Date(R.end);xe.setHours(23,59,59,999),E=E.filter(k=>new Date(k.incident_date)<=xe)}if(V==="recent"){const xe=new Date;xe.setDate(xe.getDate()-7),xe.setHours(0,0,0,0),E=E.filter(k=>new Date(k.incident_date)>=xe)}return E},[u,V,R]),de=p.useMemo(()=>{if(V!=="all")return null;const E={};return z.forEach(xe=>{const k=new Date(xe.incident_date),U=`${k.getFullYear()}-${String(k.getMonth()+1).padStart(2,"0")}`,ie=k.toLocaleDateString("en-US",{month:"long",year:"numeric"});E[U]||(E[U]={label:ie,reports:[]}),E[U].reports.push(xe)}),Object.entries(E).sort((xe,k)=>k[0].localeCompare(xe[0]))},[z,V]);p.useEffect(()=>{if(de&&de.length>0){const E=de[0][0];F(new Set([E]))}},[de]);const N=E=>{const xe=new Set(ae);xe.has(E)?xe.delete(E):xe.add(E),F(xe)},se=async()=>{if(u.length===0){P({type:"error",message:"No reports to export"});return}P({type:"info",message:"Generating PDF..."});const E=new Fi,xe=E.internal.pageSize.getWidth(),k=20;let U=k;const ie=od(m?.primary_color||"#3B82F6"),T=od(m?.secondary_color||"#1E40AF");E.setFillColor(...ie),E.rect(0,0,xe,45,"F"),E.setFillColor(...T),E.rect(0,42,xe,3,"F");let je=k;if(m?.logo_url)try{const ue=await iy(m.logo_url);ue&&(E.addImage(ue,"PNG",k,7,30,30),je=k+40)}catch(ue){console.error("Error adding logo:",ue)}E.setTextColor(255,255,255),E.setFontSize(22),E.setFont("helvetica","bold"),E.text(o?.name||"Company",je,20),E.setFontSize(10),E.setFont("helvetica","normal"),E.text("INJURY & INCIDENT REPORTS",je,30),E.setFontSize(9),E.text(`Generated: ${new Date().toLocaleDateString()}`,xe-k,20,{align:"right"}),E.text(`Total Reports: ${u.length}`,xe-k,28,{align:"right"}),U=55,r&&(E.setFillColor(248,250,252),E.rect(k,U-5,xe-k*2,15,"F"),E.setTextColor(...ie),E.setFontSize(12),E.setFont("helvetica","bold"),E.text(`Project: ${r.name}`,k+5,U+5),U+=20),u.forEach(ue=>{U>200&&(E.addPage(),U=k);const Te=od(A(ue.injury_type));E.setFillColor(...Te),E.rect(k,U,xe-k*2,12,"F"),E.setTextColor(255,255,255),E.setFontSize(11),E.setFont("helvetica","bold"),E.text(`${ue.employee_name} - ${C(ue.injury_type)}`,k+5,U+8),E.text(B(ue.incident_date),xe-k-5,U+8,{align:"right"}),U+=17,E.setTextColor(50,50,50),E.setFontSize(9),E.setFont("helvetica","normal"),E.text(`Location: ${ue.incident_location}`,k+5,U),ue.incident_time&&E.text(`Time: ${Z(ue.incident_time)}`,k+100,U),U+=6,E.setFont("helvetica","bold"),E.text("Description:",k+5,U),E.setFont("helvetica","normal"),U+=5;const Be=E.splitTextToSize(ue.incident_description,xe-k*2-10);E.text(Be,k+5,U),U+=Be.length*4+3;const ze=[];ue.body_part_affected&&ze.push(`Body Part: ${ue.body_part_affected}`),ue.osha_recordable&&ze.push("OSHA Recordable"),ue.workers_comp_claim&&ze.push("Workers' Comp Filed"),ue.medical_treatment_required&&ze.push("Medical Treatment Required"),ze.length>0&&(E.setFontSize(8),E.setTextColor(100,100,100),E.text(ze.join("  |  "),k+5,U),U+=5),E.setFontSize(8),E.text(`Reported by: ${ue.reported_by_name} (${ue.reported_by_title})`,k+5,U),U+=12});const I=E.internal.getNumberOfPages();for(let ue=1;ue<=I;ue++)E.setPage(ue),E.setFontSize(8),E.setTextColor(150,150,150),E.text(`Page ${ue} of ${I}`,xe/2,E.internal.pageSize.getHeight()-10,{align:"center"}),E.text("CONFIDENTIAL - Injury Report",k,E.internal.pageSize.getHeight()-10);const ke=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;E.save(ke),P({type:"success",message:"PDF exported!"})};return q?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[u.length>0&&e.jsx("button",{className:"btn-secondary",onClick:se,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>x(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${V==="recent"?"active":""}`,onClick:()=>{J("recent"),S({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${V==="all"?"active":""}`,onClick:()=>J("all"),children:["All (",u.length,")"]})]}),V==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(kr,{size:16}),e.jsx("input",{type:"date",value:R.start,onChange:E=>S(xe=>({...xe,start:E.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:R.end,onChange:E=>S(xe=>({...xe,end:E.target.value})),placeholder:"End date"}),(R.start||R.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>S({start:"",end:""}),children:"Clear"})]})]}),z.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:""}),e.jsxs("h4",{children:["No Injury Reports",V==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),V==="recent"&&u.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>J("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:V==="all"&&de?de.map(([E,xe])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>N(E),children:e.jsxs("div",{className:"month-header-left",children:[ae.has(E)?e.jsx(ka,{size:18}):e.jsx(Hs,{size:18}),e.jsx("span",{className:"month-label",children:xe.label}),e.jsxs("span",{className:"month-count",children:[xe.reports.length," reports"]})]})}),ae.has(E)&&e.jsx("div",{className:"month-reports",children:xe.reports.map(k=>e.jsxs("div",{className:"report-card",onClick:()=>$(k),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[B(k.incident_date)," at ",Z(k.incident_time)]}),e.jsx("div",{className:"employee-name",children:k.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:A(k.injury_type)},children:C(k.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:b(k.status)},children:k.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",k.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",k.reported_by_name," (",k.reported_by_title,")"]}),k.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",k.body_part_affected]}),k.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[k.incident_description.substring(0,150),k.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},k.id))})]},E)):z.map(E=>e.jsxs("div",{className:"report-card",onClick:()=>$(E),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[B(E.incident_date)," at ",Z(E.incident_time)]}),e.jsx("div",{className:"employee-name",children:E.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:A(E.injury_type)},children:C(E.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:b(E.status)},children:E.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",E.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",E.reported_by_name," (",E.reported_by_title,")"]}),E.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",E.body_part_affected]}),E.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[E.incident_description.substring(0,150),E.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},E.id))}),g&&e.jsx("div",{className:"modal-overlay",onClick:G,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:E=>E.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:G,children:""})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[B(g.incident_date)," at ",Z(g.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:g.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:A(g.injury_type)},children:C(g.injury_type)})})]}),g.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:g.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:g.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:g.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:g.employee_job_title})]}),g.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:g.employee_phone})]}),g.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:g.employee_email})]}),g.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:g.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:g.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:g.reported_by_title})]}),g.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:g.reported_by_phone})]}),g.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:g.reported_by_email})]})]})]}),g.witnesses&&g.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),g.witnesses.map((E,xe)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:E.name}),E.phone&&e.jsxs("span",{children:["  ",E.phone]}),E.email&&e.jsxs("span",{children:["  ",E.email]})]}),E.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',E.testimony,'"']})})]},xe))]}),g.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[g.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:g.medical_facility_name})]}),g.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:g.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:g.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),g.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:g.immediate_actions_taken})]}),g.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:g.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[g.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:g.safety_equipment_used})]}),g.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:g.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:g.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:g.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:g.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:g.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",B(g.created_at)]})]})]})}),v&&e.jsx(jf,{project:r,companyId:l,onClose:()=>x(!1),onReportCreated:pe}),M&&e.jsx(Ls,{message:M.message,type:M.type,onClose:()=>P(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const dd=[{id:"message",label:"Messages",Icon:uf,description:"Chat messages from field"},{id:"material_request",label:"Material Requests",Icon:Fn,description:"Equipment and material requests"},{id:"injury_report",label:"Safety Reports",Icon:Cr,description:"Injury and safety incident reports"},{id:"tm_ticket",label:"T&M Tickets",Icon:as,description:"Time and materials tickets"}];function oy({project:r,company:l,onShowToast:o,onClose:i}){const[m,u]=p.useState([]),[f,g]=p.useState({}),[j,v]=p.useState([]),[x,q]=p.useState(!0),[L,M]=p.useState(!1);p.useEffect(()=>{P()},[r?.id,l?.id]);const P=async()=>{if(!(!r?.id||!l?.id))try{q(!0);const R=await te.getCompanyUsers(l.id);u(R);const S=await te.getProjectNotificationPreferences(r.id),K={};S.forEach($=>{K[$.user_id]={types:$.notification_types||[],presetId:null}}),g(K);const pe=await te.getNotificationPresets(l.id);v(pe)}catch(R){console.error("Error loading notification settings:",R),o?.("Error loading notification settings","error")}finally{q(!1)}},V=(R,S)=>{g(K=>{const pe=K[R]||{types:[]},$=pe.types.includes(S)?pe.types.filter(G=>G!==S):[...pe.types,S];return{...K,[R]:{types:$,presetId:null}}})},J=(R,S)=>{const K=j.find(pe=>pe.id===S);K&&g(pe=>({...pe,[R]:{types:[...K.notification_types],presetId:S}}))},ae=(R,S)=>{g(K=>({...K,[R]:{types:S?dd.map(pe=>pe.id):[],presetId:null}}))},F=async()=>{try{M(!0);const R=Object.entries(f).map(([S,K])=>({userId:S,notificationTypes:K.types}));await te.setProjectNotificationPreferences(r.id,R),o?.("Notification settings saved","success"),i?.()}catch(R){console.error("Error saving notification settings:",R),o?.("Error saving notification settings","error")}finally{M(!1)}};return x?e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsx("button",{className:"close-btn",onClick:i,children:""})]}),e.jsx("div",{className:"loading-message",children:"Loading..."})]}):e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsxs("h3",{children:["Notification Settings for ",r?.name]}),e.jsx("button",{className:"close-btn",onClick:i,children:""})]}),e.jsx("p",{className:"settings-description",children:"Choose who receives notifications when field workers send messages, request materials, submit safety reports, or create T&M tickets for this project."}),m.length===0?e.jsxs("div",{className:"no-users-message",children:[e.jsx("p",{children:"No users found in this company."}),e.jsx("small",{children:"Users need to be added to the company to receive notifications."})]}):e.jsx("div",{className:"notification-users-list",children:m.map(R=>{const S=f[R.id]||{types:[],presetId:null},K=S.types.length===dd.length,pe=S.types.length>0&&!K;return e.jsxs("div",{className:"notification-user-row",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:R.name?.charAt(0).toUpperCase()||R.email?.charAt(0).toUpperCase()}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:R.name||R.email}),R.role&&e.jsx("span",{className:"user-role",children:R.role})]})]}),e.jsxs("div",{className:"notification-controls",children:[e.jsxs("select",{className:"preset-select",value:S.presetId||"",onChange:$=>$.target.value&&J(R.id,$.target.value),children:[e.jsx("option",{value:"",children:"Apply preset..."}),j.map($=>e.jsx("option",{value:$.id,children:$.name},$.id))]}),e.jsx("button",{className:`toggle-all-btn ${K?"all-on":pe?"some-on":""}`,onClick:()=>ae(R.id,!K),title:K?"Disable all":"Enable all",children:K?"All On":pe?"Some":"None"})]}),e.jsx("div",{className:"notification-types",children:dd.map($=>e.jsxs("label",{className:`notification-type-toggle ${S.types.includes($.id)?"active":""}`,title:$.description,children:[e.jsx("input",{type:"checkbox",checked:S.types.includes($.id),onChange:()=>V(R.id,$.id)}),e.jsx("span",{className:"type-icon",children:e.jsx($.Icon,{size:16})}),e.jsx("span",{className:"type-label",children:$.label})]},$.id))})]},R.id)})}),e.jsxs("div",{className:"notification-settings-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:i,children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:F,disabled:L,children:L?"Saving...":"Save Settings"})]})]})}const qp=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},dy=r=>new Promise(l=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const i=document.createElement("canvas");i.width=o.width,i.height=o.height,i.getContext("2d").drawImage(o,0,0),l(i.toDataURL("image/png"))},o.onerror=()=>l(null),o.src=r});function uy({project:r,company:l,onShowToast:o}){const{branding:i}=wr(),[m,u]=p.useState([]),[f,g]=p.useState(!0),[j,v]=p.useState(null),[x,q]=p.useState(new Set),[L,M]=p.useState(!1),[P,V]=p.useState("recent"),[J,ae]=p.useState(new Set),[F,R]=p.useState({start:"",end:""});p.useEffect(()=>{S();const k=te.subscribeToDailyReports?.(r.id,()=>{S()});return()=>{k&&te.unsubscribe?.(k)}},[r.id]);const S=async()=>{try{const k=await te.getDailyReports(r.id,365);u(k||[])}catch(k){console.error("Error loading daily reports:",k),o?.("Error loading daily reports","error")}finally{g(!1)}},K=p.useMemo(()=>{let k=[...m];if(F.start){const U=new Date(F.start);U.setHours(0,0,0,0),k=k.filter(ie=>new Date(ie.report_date||ie.created_at)>=U)}if(F.end){const U=new Date(F.end);U.setHours(23,59,59,999),k=k.filter(ie=>new Date(ie.report_date||ie.created_at)<=U)}if(P==="recent"){const U=new Date;U.setDate(U.getDate()-7),U.setHours(0,0,0,0),k=k.filter(ie=>new Date(ie.report_date||ie.created_at)>=U)}return k},[m,P,F]),pe=p.useMemo(()=>{if(P!=="all")return null;const k={};return K.forEach(U=>{const ie=new Date(U.report_date||U.created_at),T=`${ie.getFullYear()}-${String(ie.getMonth()+1).padStart(2,"0")}`,je=ie.toLocaleDateString("en-US",{month:"long",year:"numeric"});k[T]||(k[T]={label:je,reports:[]}),k[T].reports.push(U)}),Object.entries(k).sort((U,ie)=>ie[0].localeCompare(U[0]))},[K,P]);p.useEffect(()=>{if(pe&&pe.length>0){const k=pe[0][0];ae(new Set([k]))}},[pe]);const $=()=>{M(!L),L&&q(new Set)},G=k=>{const U=new Set(x);U.has(k)?U.delete(k):U.add(k),q(U)},B=()=>{x.size===K.length?q(new Set):q(new Set(K.map(k=>k.id)))},Z=k=>{const U=new Set(J);U.has(k)?U.delete(k):U.add(k),ae(U)},C=()=>x.size>0?K.filter(k=>x.has(k.id)):K,b=k=>new Date(k).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),A=k=>new Date(k).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),z=k=>{switch(k){case"submitted":return"";case"reviewed":return"";case"draft":return"";default:return""}},de=k=>{switch(k){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return k}},N=async()=>{const k=C();if(k.length===0){o?.("No reports to export","error");return}o?.("Generating PDF...","info");const U=new Fi,ie=U.internal.pageSize.getWidth(),T=20;let je=T;const I=qp(i?.primary_color||"#3B82F6"),ke=qp(i?.secondary_color||"#1E40AF");U.setFillColor(...I),U.rect(0,0,ie,45,"F"),U.setFillColor(...ke),U.rect(0,42,ie,3,"F");let ue=T;if(i?.logo_url)try{const ze=await dy(i.logo_url);ze&&(U.addImage(ze,"PNG",T,7,30,30),ue=T+40)}catch(ze){console.error("Error adding logo:",ze)}U.setTextColor(255,255,255),U.setFontSize(22),U.setFont("helvetica","bold"),U.text(l?.name||"Company Name",ue,20),U.setFontSize(10),U.setFont("helvetica","normal"),U.text("DAILY REPORTS SUMMARY",ue,30),U.setFontSize(9),U.text(`Generated: ${new Date().toLocaleDateString()}`,ie-T,20,{align:"right"}),r.job_number&&U.text(`Job #: ${r.job_number}`,ie-T,28,{align:"right"}),je=55,U.setFillColor(248,250,252),U.rect(T,je-5,ie-T*2,20,"F"),U.setTextColor(...I),U.setFontSize(14),U.setFont("helvetica","bold"),U.text(`Project: ${r.name}`,T+5,je+7),U.setFontSize(10),U.setTextColor(100,100,100),U.text(`${k.length} Report${k.length!==1?"s":""}`,ie-T-5,je+7,{align:"right"}),je+=25,k.forEach((ze,Oe)=>{je>250&&(U.addPage(),je=T),U.setFillColor(...I),U.setTextColor(255,255,255),U.rect(T,je,ie-T*2,10,"F"),U.setFontSize(11),U.setFont("helvetica","bold"),U.text(b(ze.report_date||ze.created_at),T+5,je+7),U.text(de(ze.status),ie-T-5,je+7,{align:"right"}),je+=15,U.setTextColor(50,50,50),U.setFontSize(10),U.setFont("helvetica","normal");const gt=`Crew: ${ze.crew_count||0}  |  Tasks: ${ze.tasks_completed||0}  |  T&M: ${ze.tm_tickets_count||0}  |  Photos: ${ze.photos_count||0}`;if(U.text(gt,T+5,je),je+=8,ze.crew_list?.length>0){U.setFont("helvetica","bold"),U.text("Crew:",T+5,je),U.setFont("helvetica","normal");const tt=ze.crew_list.map(Me=>`${Me.name} (${Me.role})`).join(", "),ee=U.splitTextToSize(tt,ie-T*2-30);U.text(ee,T+25,je),je+=ee.length*5+3}if(ze.field_notes){U.setFont("helvetica","bold"),U.text("Notes:",T+5,je),U.setFont("helvetica","normal");const tt=U.splitTextToSize(ze.field_notes,ie-T*2-30);U.text(tt,T+25,je),je+=tt.length*5+3}if(ze.issues){U.setTextColor(180,50,50),U.setFont("helvetica","bold"),U.text("Issues:",T+5,je),U.setFont("helvetica","normal");const tt=U.splitTextToSize(ze.issues,ie-T*2-30);U.text(tt,T+25,je),U.setTextColor(50,50,50),je+=tt.length*5+3}je+=10});const Te=U.internal.getNumberOfPages();for(let ze=1;ze<=Te;ze++)U.setPage(ze),U.setFontSize(8),U.setTextColor(150,150,150),U.text(`Page ${ze} of ${Te}`,ie/2,U.internal.pageSize.getHeight()-10,{align:"center"});const Be=`${r.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;U.save(Be),o?.("PDF exported!","success")},se=k=>e.jsxs("div",{className:`daily-report-card ${k.status} ${x.has(k.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>v(j===k.id?null:k.id),children:[L&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:x.has(k.id),onChange:U=>{U.stopPropagation(),G(k.id)},onClick:U=>U.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:b(k.report_date||k.created_at)}),e.jsxs("span",{className:`report-status ${k.status}`,children:[z(k.status)," ",de(k.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[k.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[k.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:j===k.id?"":""})]})]}),j===k.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:k.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:k.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:k.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:k.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),k.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:k.crew_list.map((U,ie)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:U.name}),e.jsx("span",{className:"crew-role",children:U.role})]},ie))})]}),k.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:k.completed_tasks.map((U,ie)=>e.jsxs("li",{children:[U.name,U.group&&e.jsx("span",{className:"task-group",children:U.group})]},ie))})]}),k.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:k.field_notes})]}),k.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:k.issues})]}),k.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",k.submitted_by||"Field"," at ",A(k.submitted_at)]})})]})]},k.id);if(f)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});const E=m.length,xe=K.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${L?"btn-primary":"btn-secondary"}`,onClick:$,children:L?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:N,children:["PDF",x.size>0?` (${x.size})`:""]})]})})]}),m.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${P==="recent"?"active":""}`,onClick:()=>V("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${P==="all"?"active":""}`,onClick:()=>V("all"),children:["All (",E,")"]})]}),P==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(kr,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:F.start,onChange:k=>R(U=>({...U,start:k.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:F.end,onChange:k=>R(U=>({...U,end:k.target.value})),className:"date-input"}),(F.start||F.end)&&e.jsx("button",{className:"date-clear",onClick:()=>R({start:"",end:""}),children:"Clear"})]})]}),L&&K.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:x.size===K.length&&K.length>0,onChange:B}),"Select All (",K.length,")"]}),x.size>0&&e.jsxs("span",{className:"selected-count",children:[x.size," selected"]})]}),m.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(as,{size:32})}),e.jsx("p",{children:"No daily reports yet"}),e.jsx("small",{children:"Reports from the field will appear here"})]}):K.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(as,{size:32})}),e.jsx("p",{children:"No reports in this time period"}),e.jsx("small",{children:P==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"})]}):P==="recent"?e.jsxs("div",{className:"daily-reports",children:[K.map(k=>se(k)),E>xe&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>V("all"),children:["View All ",E," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:pe?.map(([k,{label:U,reports:ie}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>Z(k),children:[J.has(k)?e.jsx(ka,{size:18,className:"month-chevron"}):e.jsx(Hs,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:U}),e.jsxs("span",{className:"month-count",children:[ie.length," report",ie.length!==1?"s":""]})]}),J.has(k)&&e.jsx("div",{className:"month-reports",children:ie.map(T=>se(T))})]},k))})]})}function my({project:r,company:l,onShowToast:o}){const[i,m]=p.useState(null),[u,f]=p.useState(!0),[g,j]=p.useState(!1);p.useEffect(()=>{if(r?.id&&l?.id){v();const P=te.subscribeToCrewCheckins?.(r.id,()=>{v()});return()=>{P&&te.unsubscribe?.(P)}}},[r?.id,l?.id]);const v=async()=>{try{const P=await te.calculateManDayCosts(r.id,l.id,r.work_type||"demolition",r.job_type||"standard");m(P)}catch(P){console.error("Error loading man day costs:",P)}finally{f(!1)}},x=P=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(P),q=P=>new Date(P).toLocaleDateString("en-US",{month:"short",day:"numeric"}),L=P=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[P]||P.charAt(0).toUpperCase()+P.slice(1);if(u)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!i||i.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Ea,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const M=Object.entries(i.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>j(!g),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:x(i.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:g?" Collapse":" Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:x(i.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.daysWorked>0?x(i.totalCost/i.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),g&&e.jsxs("div",{className:"man-day-details",children:[M.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:M.map(([P,V])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:L(P)}),e.jsxs("span",{className:"role-rate",children:[x(V.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[V.count," days"]}),e.jsx("span",{className:"role-cost",children:x(V.cost)})]})]},P))})]}),i.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:i.byDate.slice(0,7).map((P,V)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:q(P.date)}),e.jsxs("span",{className:"date-workers",children:[P.workers," crew"]}),e.jsx("span",{className:"date-cost",children:x(P.cost)})]},V))}),i.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",i.byDate.length-7," more days"]})]})]})]})}const ns=r=>((r||0)/100).toFixed(2),Re=r=>{const l=(r||0)/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(l)},Ri=r=>Math.round((parseFloat(r)||0)*100),pn=r=>((r||0)/100).toFixed(2),ra=r=>`${pn(r)}%`,qn=r=>Math.round((parseFloat(r)||0)*100),hy=(r,l,o,i)=>{const m=parseFloat(r)||0,u=parseFloat(l)||0,f=parseInt(o)||0,g=parseInt(i)||0,j=Math.round(m*f),v=Math.round(u*g),x=j+v;return{regularTotal:j,overtimeTotal:v,total:x}},Lp=(r,l)=>{const o=parseFloat(r)||0,i=parseInt(l)||0;return Math.round(o*i)},qi=(r,l)=>{const o=parseInt(r)||0,i=parseInt(l)||0;return Math.round(o*i/1e4)},ud=(r,l)=>{const o=parseInt(r)||0,i=parseInt(l)||0;return Math.round(o*i/1e4)},_l=r=>{const l=(r.change_order_labor||[]).reduce((V,J)=>V+(parseInt(J.total)||0),0),o=(r.change_order_materials||[]).reduce((V,J)=>V+(parseInt(J.total)||0),0),i=(r.change_order_equipment||[]).reduce((V,J)=>V+(parseInt(J.total)||0),0),m=(r.change_order_subcontractors||[]).reduce((V,J)=>V+(parseInt(J.total)||0),0),u=qi(l,r.labor_markup_percent??1500),f=qi(o,r.materials_markup_percent??1500),g=qi(i,r.equipment_markup_percent??1500),j=qi(m,r.subcontractors_markup_percent??500),v=l+o+i+m+u+f+g+j,x=ud(v,r.liability_insurance_percent??144),q=ud(v,r.bond_percent??100),L=ud(v,r.license_fee_percent??10),M=x+q+L,P=v+M;return{labor_subtotal:l,materials_subtotal:o,equipment_subtotal:i,subcontractors_subtotal:m,labor_markup_amount:u,materials_markup_amount:f,equipment_markup_amount:g,subcontractors_markup_amount:j,liability_insurance_amount:x,bond_amount:q,license_fee_amount:L,additional_fees_total:M,cor_subtotal:v,cor_total:P}},Up=r=>{const l=[];if(r.title?.trim()||l.push("Title is required"),r.scope_of_work?.trim()||l.push("Scope of work is required"),r.period_start||l.push("Start date is required"),r.period_end||l.push("End date is required"),r.period_start&&r.period_end){const j=new Date(r.period_start);new Date(r.period_end)<j&&l.push("End date must be after start date")}const o=(r.change_order_labor||[]).length>0,i=(r.change_order_materials||[]).length>0,m=(r.change_order_equipment||[]).length>0,u=(r.change_order_subcontractors||[]).length>0;!o&&!i&&!m&&!u&&l.push("At least one line item (labor, materials, equipment, or subcontractor) is required"),_l(r).cor_total<=0&&l.push("COR total must be greater than zero");const g=5e3;return r.labor_markup_percent>g&&l.push("Labor markup percentage seems too high (>50%)"),r.materials_markup_percent>g&&l.push("Materials markup percentage seems too high (>50%)"),r.equipment_markup_percent>g&&l.push("Equipment markup percentage seems too high (>50%)"),r.subcontractors_markup_percent>g&&l.push("Subcontractors markup percentage seems too high (>50%)"),{valid:l.length===0,errors:l}},yf=r=>{const l={draft:{label:"Draft",color:"#6b7280",bgColor:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bgColor:"#fef3c7"},approved:{label:"Approved",color:"#059669",bgColor:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bgColor:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bgColor:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bgColor:"#e5e7eb"}};return l[r]||l.draft},ss=r=>r?new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",Vi=(r,l)=>{const o=ss(r),i=ss(l);return o&&i?`${o} - ${i}`:o||i||""},Ln={labor_markup:1500,materials_markup:1500,equipment_markup:1500,subcontractors_markup:500,liability_insurance:144,bond:100,license_fee:10},Hp=["Foreman","Superintendent","Operator","Laborer"],py=[{value:"standard",label:"Standard"},{value:"pla",label:"PLA (Project Labor Agreement)"},{value:"prevailing",label:"Prevailing Wage"}],Bp=["each","day","week","month","hour","sqft","lf","gallon","pound","ton","cy","lump sum"];function fy({project:r,company:l,areas:o,refreshKey:i,onShowToast:m,onCreateCOR:u,onViewCOR:f,onEditCOR:g}){const[j,v]=p.useState([]),[x,q]=p.useState(!0),[L,M]=p.useState("all"),[P,V]=p.useState("all"),[J,ae]=p.useState("all"),[F,R]=p.useState(null),[S,K]=p.useState(new Set),[pe,$]=p.useState(!1),[G,B]=p.useState(!1),[Z,C]=p.useState(""),[b,A]=p.useState("recent"),[z,de]=p.useState(new Set),[N,se]=p.useState({start:"",end:""}),[E,xe]=p.useState(null);p.useEffect(()=>{k(),U();const ee=te.subscribeToCORs?.(r.id,()=>{k(),U()});return()=>{ee&&te.unsubscribe?.(ee)}},[r.id,i]);const k=async()=>{try{const ee=await te.getCORs(r.id);v(ee||[])}catch(ee){console.error("Error loading CORs:",ee),m?.("Error loading change order requests","error")}finally{q(!1)}},U=async()=>{try{const ee=await te.getCORStats?.(r.id);xe(ee)}catch(ee){console.error("Error loading COR stats:",ee)}},ie=async(ee,Me)=>{if(Me?.stopPropagation(),!!confirm("Are you sure you want to delete this COR? This action cannot be undone."))try{await te.deleteCOR(ee),v(j.filter(Fe=>Fe.id!==ee)),m?.("COR deleted","success"),U()}catch(Fe){console.error("Error deleting COR:",Fe),m?.("Error deleting COR","error")}},T=async(ee,Me)=>{Me?.stopPropagation();try{await te.submitCORForApproval(ee),await k(),m?.("COR submitted for approval","success"),U()}catch(Fe){console.error("Error submitting COR:",Fe?.message||Fe),m?.(Fe?.message||"Error submitting COR","error")}},je=(ee,Me)=>{Me?.stopPropagation(),K(Fe=>{const pt=new Set(Fe);return pt.has(ee)?pt.delete(ee):pt.add(ee),pt})},I=()=>{$(!1),K(new Set)},ke=async()=>{if(!Z.trim()){m?.("Please enter a group name","error");return}try{await te.bulkUpdateCORGroup([...S],Z.trim()),m?.(`${S.size} CORs grouped as "${Z.trim()}"`,"success"),B(!1),C(""),K(new Set),$(!1),k()}catch(ee){console.error("Error grouping CORs:",ee),m?.("Error grouping CORs","error")}},ue=p.useMemo(()=>{const ee=j.map(Me=>Me.group_name).filter(Boolean);return[...new Set(ee)].sort()},[j]),Te=p.useMemo(()=>{let ee=[...j];if(L!=="all"&&(ee=ee.filter(Me=>Me.status===L)),P!=="all"&&(ee=ee.filter(Me=>Me.area_id===P)),J!=="all"&&(ee=ee.filter(Me=>Me.group_name===J)),N.start){const Me=new Date(N.start);Me.setHours(0,0,0,0),ee=ee.filter(Fe=>new Date(Fe.created_at)>=Me)}if(N.end){const Me=new Date(N.end);Me.setHours(23,59,59,999),ee=ee.filter(Fe=>new Date(Fe.created_at)<=Me)}if(b==="recent"){const Me=new Date;Me.setDate(Me.getDate()-7),Me.setHours(0,0,0,0),ee=ee.filter(Fe=>new Date(Fe.created_at)>=Me)}return ee.sort((Me,Fe)=>new Date(Fe.created_at)-new Date(Me.created_at)),ee},[j,L,P,J,b,N]),Be=p.useMemo(()=>{if(b!=="all")return null;const ee={};return Te.forEach(Me=>{const Fe=new Date(Me.created_at),pt=`${Fe.getFullYear()}-${String(Fe.getMonth()+1).padStart(2,"0")}`,ma=Fe.toLocaleDateString("en-US",{month:"long",year:"numeric"});ee[pt]||(ee[pt]={label:ma,cors:[],totalAmount:0}),ee[pt].cors.push(Me),ee[pt].totalAmount+=Me.cor_total||0}),Object.entries(ee).sort((Me,Fe)=>Fe[0].localeCompare(Me[0]))},[Te,b]);p.useEffect(()=>{if(Be&&Be.length>0){const ee=Be[0][0];de(new Set([ee]))}},[Be]);const ze=ee=>{const Me=new Set(z);Me.has(ee)?Me.delete(ee):Me.add(ee),de(Me)},Oe=p.useMemo(()=>({all:j.length,draft:j.filter(ee=>ee.status==="draft").length,pending_approval:j.filter(ee=>ee.status==="pending_approval").length,approved:j.filter(ee=>ee.status==="approved").length,rejected:j.filter(ee=>ee.status==="rejected").length,billed:j.filter(ee=>ee.status==="billed").length,closed:j.filter(ee=>ee.status==="closed").length}),[j]);L==="all"?j.length:j.filter(ee=>ee.status===L).length;const gt=ee=>o?.find(Fe=>Fe.id===ee)?.name||"No Area",tt=ee=>{const Me=yf(ee.status);ee.id;const Fe=S.has(ee.id),pt=["draft","pending_approval","approved"].includes(ee.status),ma=["draft","pending_approval","rejected"].includes(ee.status),we=ee.status==="draft";return e.jsxs("div",{className:`cor-card ${ee.status} ${Fe?"selected":""}`,onClick:()=>pe?je(ee.id):f?.(ee),onKeyDown:qe=>{(qe.key==="Enter"||qe.key===" ")&&(qe.preventDefault(),pe?je(ee.id):f?.(ee))},tabIndex:0,role:"button","aria-label":`${pe?Fe?"Deselect":"Select":"View"} COR ${ee.cor_number}: ${ee.title||"Untitled"}, ${Me.label}, ${Re(ee.cor_total||0)}`,children:[e.jsxs("div",{className:"cor-card-header",children:[e.jsxs("div",{className:"cor-card-left",children:[pe&&e.jsx("button",{className:"cor-select-checkbox",onClick:qe=>je(ee.id,qe),"aria-label":Fe?"Deselect":"Select",children:Fe?e.jsx(Sd,{size:18}):e.jsx(bv,{size:18})}),e.jsx("span",{className:"cor-number",children:ee.cor_number}),e.jsx("span",{className:"cor-status-badge",style:{backgroundColor:Me.bgColor,color:Me.color},children:Me.label})]}),e.jsx("div",{className:"cor-card-right",children:e.jsx("span",{className:"cor-total",children:Re(ee.cor_total||0)})})]}),e.jsxs("div",{className:"cor-card-body",children:[e.jsx("h4",{className:"cor-title",children:ee.title||"Untitled COR"}),e.jsxs("div",{className:"cor-meta",children:[ee.group_name&&e.jsx("span",{className:"cor-group-badge",children:ee.group_name}),ee.area_id&&e.jsx("span",{className:"cor-area",children:gt(ee.area_id)}),e.jsx("span",{className:"cor-period",children:Vi(ee.period_start,ee.period_end)})]})]}),e.jsxs("div",{className:"cor-card-footer",children:[e.jsx("span",{className:"cor-created",children:ss(ee.created_at)}),e.jsxs("div",{className:"cor-actions",onClick:qe=>qe.stopPropagation(),children:[we&&e.jsx("button",{className:"cor-action-btn submit",onClick:qe=>T(ee.id,qe),title:"Submit for Approval","aria-label":`Submit COR ${ee.cor_number} for approval`,children:e.jsx(Td,{size:14,"aria-hidden":"true"})}),pt&&e.jsx("button",{className:"cor-action-btn edit",onClick:qe=>{qe.stopPropagation(),g?.(ee)},title:"Edit","aria-label":`Edit COR ${ee.cor_number}`,children:e.jsx(jl,{size:14,"aria-hidden":"true"})}),e.jsx("button",{className:"cor-action-btn view",onClick:qe=>{qe.stopPropagation(),f?.(ee)},title:"View Details","aria-label":`View COR ${ee.cor_number} details`,children:e.jsx(Mj,{size:14,"aria-hidden":"true"})}),ma&&e.jsx("button",{className:"cor-action-btn delete",onClick:qe=>ie(ee.id,qe),title:"Delete","aria-label":`Delete COR ${ee.cor_number}`,children:e.jsx(Us,{size:14,"aria-hidden":"true"})})]})]})]},ee.id)};return x?e.jsx("div",{className:"loading",children:"Loading change order requests..."}):e.jsxs("div",{className:"cor-list",children:[e.jsxs("div",{className:"cor-list-header",children:[e.jsxs("div",{className:"cor-list-info",children:[e.jsx("h3",{children:"Change Orders"}),e.jsxs("div",{className:"cor-stats-inline",children:[e.jsxs("span",{className:"cor-stat-item",children:[Oe.all," total"]}),Oe.pending_approval>0&&e.jsxs("span",{className:"cor-stat-item pending",children:[Oe.pending_approval," pending"]}),E?.totalApproved>0&&e.jsx("span",{className:"cor-stat-item approved",children:Re(E.totalApproved)})]})]}),e.jsxs("div",{className:"cor-header-actions",children:[e.jsx("button",{className:`btn btn-secondary btn-small ${pe?"active":""}`,onClick:()=>pe?I():$(!0),children:pe?e.jsxs(e.Fragment,{children:[e.jsx(Ta,{size:14})," Cancel"]}):e.jsxs(e.Fragment,{children:[e.jsx(Sd,{size:14})," Select"]})}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:u,children:[e.jsx(gs,{size:14})," New COR"]})]})]}),pe&&S.size>0&&e.jsxs("div",{className:"cor-selection-bar",children:[e.jsxs("span",{className:"selection-count",children:[S.size," selected"]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:()=>B(!0),children:[e.jsx(Rj,{size:14})," Group Selected"]})]}),e.jsxs("div",{className:"cor-controls",children:[e.jsx("div",{className:"cor-filter-pills",role:"tablist",children:[{id:"all",label:"All"},{id:"draft",label:"Draft"},{id:"pending_approval",label:"Pending"},{id:"approved",label:"Approved"}].map(ee=>e.jsxs("button",{role:"tab","aria-selected":L===ee.id,className:`cor-pill ${L===ee.id?"active":""}`,onClick:()=>M(ee.id),children:[ee.label,Oe[ee.id]>0&&e.jsx("span",{className:"cor-pill-count",children:Oe[ee.id]})]},ee.id))}),ue.length>0&&e.jsxs("select",{className:"cor-group-filter",value:J,onChange:ee=>ae(ee.target.value),children:[e.jsx("option",{value:"all",children:"All Groups"}),ue.map(ee=>e.jsx("option",{value:ee,children:ee},ee))]}),e.jsxs("div",{className:"cor-view-toggle",children:[e.jsx("button",{className:`cor-toggle-btn ${b==="recent"?"active":""}`,onClick:()=>{A("recent"),se({start:"",end:""})},children:"Recent"}),e.jsx("button",{className:`cor-toggle-btn ${b==="all"?"active":""}`,onClick:()=>A("all"),children:"All"})]})]}),b==="all"&&e.jsxs("div",{className:"cor-date-filter",children:[e.jsx(kr,{size:14}),e.jsx("input",{type:"date",value:N.start,onChange:ee=>se(Me=>({...Me,start:ee.target.value}))}),e.jsx("span",{className:"cor-date-sep",children:"to"}),e.jsx("input",{type:"date",value:N.end,onChange:ee=>se(Me=>({...Me,end:ee.target.value}))}),(N.start||N.end)&&e.jsx("button",{className:"cor-clear-btn",onClick:()=>se({start:"",end:""}),children:"Clear"})]}),Te.length===0?e.jsxs("div",{className:"cor-empty",children:[e.jsx(Ma,{size:24,className:"cor-empty-icon"}),e.jsxs("p",{children:["No change orders ",L!=="all"?`(${L.replace("_"," ")})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:u,children:[e.jsx(gs,{size:14})," Create COR"]})]}):e.jsx("div",{className:"cor-cards",children:b==="all"&&Be?Be.map(([ee,Me])=>e.jsxs("div",{className:"cor-month-group",children:[e.jsxs("button",{className:"cor-month-header",onClick:()=>ze(ee),children:[e.jsxs("div",{className:"cor-month-left",children:[z.has(ee)?e.jsx(ka,{size:16}):e.jsx(Hs,{size:16}),e.jsx("span",{children:Me.label}),e.jsx("span",{className:"cor-month-count",children:Me.cors.length})]}),e.jsx("span",{className:"cor-month-total",children:Re(Me.totalAmount)})]}),z.has(ee)&&e.jsx("div",{className:"cor-month-items",children:Me.cors.map(Fe=>tt(Fe))})]},ee)):Te.map(ee=>tt(ee))}),G&&e.jsx("div",{className:"modal-overlay",onClick:()=>B(!1),children:e.jsxs("div",{className:"modal-content cor-group-modal",onClick:ee=>ee.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Group ",S.size," CORs"]}),e.jsx("button",{className:"close-btn",onClick:()=>B(!1),children:e.jsx(Ta,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Group Name"}),e.jsx("input",{type:"text",value:Z,onChange:ee=>C(ee.target.value),placeholder:"e.g., Phase 1, Building A, Week 1",autoFocus:!0,onKeyDown:ee=>{ee.key==="Enter"&&ke(),ee.key==="Escape"&&B(!1)}})]}),ue.length>0&&e.jsxs("div",{className:"existing-groups",children:[e.jsx("label",{children:"Or select existing group:"}),e.jsx("div",{className:"group-chips",children:ue.map(ee=>e.jsx("button",{className:"group-chip",onClick:()=>C(ee),children:ee},ee))})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>B(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:ke,children:"Group CORs"})]})]})})]})}function gy({projectId:r,corId:l,onImport:o,onClose:i,onShowToast:m}){const[u,f]=p.useState([]),[g,j]=p.useState(!0),[v,x]=p.useState(new Set),[q,L]=p.useState(null),[M,P]=p.useState(""),[V,J]=p.useState("unassigned");p.useEffect(()=>{ae()},[r]);const ae=async()=>{try{const G=await te.getTMTickets(r);f(G||[])}catch(G){console.error("Error loading tickets:",G),m?.("Error loading tickets","error")}finally{j(!1)}},F=p.useMemo(()=>{let G=[...u];if(V==="unassigned"?G=G.filter(B=>!B.assigned_cor_id):V==="approved"&&(G=G.filter(B=>B.status==="approved")),M){const B=M.toLowerCase();G=G.filter(Z=>Z.work_description?.toLowerCase().includes(B)||Z.ce_pco_number?.toLowerCase().includes(B)||Z.ticket_date?.includes(B))}return G.sort((B,Z)=>new Date(Z.ticket_date)-new Date(B.ticket_date)),G},[u,V,M]),R=G=>{const B=new Set(v);B.has(G)?B.delete(G):B.add(G),x(B)},S=()=>{v.size===F.length?x(new Set):x(new Set(F.map(G=>G.id)))},K=G=>new Date(G).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),pe=G=>{const B=G.workers?.length||0,Z=G.items?.length||0,C=G.materials_equipment?.filter(A=>A.type==="equipment")?.length||0;let b=0;return G.workers?.forEach(A=>{b+=(parseFloat(A.regular_hours)||0)+(parseFloat(A.overtime_hours)||0)}),{workerCount:B,itemCount:Z,equipmentCount:C,laborHours:b}},$=()=>{if(v.size===0){m?.("Please select at least one ticket","error");return}const G=u.filter(b=>v.has(b.id)),B=[],Z=[],C=[];G.forEach(b=>{b.workers?.forEach(A=>{B.push({id:`import-${b.id}-${A.id||Date.now()}`,labor_class:A.role||"Laborer",wage_type:"standard",regular_hours:parseFloat(A.regular_hours)||0,overtime_hours:parseFloat(A.overtime_hours)||0,regular_rate:0,overtime_rate:0,total:0,source_ticket_id:b.id,source_ticket_date:b.ticket_date})}),b.items?.forEach(A=>{Z.push({id:`import-${b.id}-${A.id||Date.now()}`,description:A.description||A.name,source_type:"backup_sheet",source_reference:`Ticket ${K(b.ticket_date)}`,quantity:parseFloat(A.quantity)||1,unit:A.unit||"each",unit_cost:Ri(A.unit_cost||0),total:Ri((A.quantity||1)*(A.unit_cost||0)),source_ticket_id:b.id})}),b.materials_equipment?.filter(A=>A.type==="equipment").forEach(A=>{C.push({id:`import-${b.id}-${A.id||Date.now()}`,description:A.description||A.name,source_type:"backup_sheet",source_reference:`Ticket ${K(b.ticket_date)}`,quantity:parseFloat(A.quantity)||1,unit:A.unit||"day",unit_cost:Ri(A.unit_cost||A.cost||0),total:Ri((A.quantity||1)*(A.unit_cost||A.cost||0)),source_ticket_id:b.id})})}),o?.({ticketIds:Array.from(v),laborItems:B,materialsItems:Z,equipmentItems:C}),i?.()};return g?e.jsx("div",{className:"modal-overlay",onClick:i,role:"dialog","aria-modal":"true","aria-label":"Loading tickets",children:e.jsx("div",{className:"modal-content ticket-selector-modal",onClick:G=>G.stopPropagation(),children:e.jsx("div",{className:"loading",role:"status","aria-live":"polite",children:"Loading tickets..."})})}):e.jsx("div",{className:"modal-overlay",onClick:i,role:"dialog","aria-modal":"true","aria-labelledby":"ticket-selector-title",children:e.jsxs("div",{className:"modal-content ticket-selector-modal",onClick:G=>G.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"ticket-selector-title",children:"Import from T&M Tickets"}),e.jsx("button",{className:"close-btn",onClick:i,"aria-label":"Close ticket selector",children:e.jsx(Ta,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"ticket-selector-controls",children:[e.jsxs("div",{className:"ticket-search",children:[e.jsx(Bi,{size:16,"aria-hidden":"true"}),e.jsx("input",{type:"text",placeholder:"Search tickets...",value:M,onChange:G=>P(G.target.value),"aria-label":"Search tickets"})]}),e.jsxs("div",{className:"ticket-filters",role:"group","aria-label":"Filter tickets by status",children:[e.jsx("button",{className:`filter-btn ${V==="unassigned"?"active":""}`,onClick:()=>J("unassigned"),"aria-pressed":V==="unassigned",children:"Unassigned"}),e.jsx("button",{className:`filter-btn ${V==="approved"?"active":""}`,onClick:()=>J("approved"),"aria-pressed":V==="approved",children:"Approved"}),e.jsx("button",{className:`filter-btn ${V==="all"?"active":""}`,onClick:()=>J("all"),"aria-pressed":V==="all",children:"All"})]})]}),e.jsxs("div",{className:"ticket-selector-header",children:[e.jsxs("label",{className:"select-all",children:[e.jsx("input",{type:"checkbox",checked:v.size===F.length&&F.length>0,onChange:S,"aria-label":`Select all ${F.length} tickets`}),e.jsxs("span",{children:["Select All (",F.length,")"]})]}),e.jsxs("span",{className:"selected-count",children:[v.size," selected"]})]}),e.jsx("div",{className:"modal-body ticket-selector-body",children:F.length===0?e.jsxs("div",{className:"ticket-empty",children:[e.jsx(Ma,{size:32}),e.jsx("p",{children:"No tickets found"}),V==="unassigned"&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>J("all"),children:"Show all tickets"})]}):e.jsx("div",{className:"ticket-list",children:F.map(G=>{const B=pe(G),Z=v.has(G.id),C=q===G.id;return e.jsxs("div",{className:`ticket-item ${Z?"selected":""} ${G.assigned_cor_id?"assigned":""}`,children:[e.jsxs("div",{className:"ticket-item-main",children:[e.jsx("label",{className:"ticket-checkbox",children:e.jsx("input",{type:"checkbox",checked:Z,onChange:()=>R(G.id),disabled:G.assigned_cor_id&&G.assigned_cor_id!==l})}),e.jsxs("div",{className:"ticket-item-info",onClick:()=>L(C?null:G.id),children:[e.jsxs("div",{className:"ticket-item-header",children:[e.jsx("span",{className:"ticket-date",children:K(G.ticket_date)}),e.jsx("span",{className:`ticket-status ${G.status}`,children:G.status}),G.ce_pco_number&&e.jsxs("span",{className:"ticket-pco",children:["CE/PCO: ",G.ce_pco_number]})]}),e.jsx("div",{className:"ticket-item-desc",children:G.work_description||"No description"}),e.jsxs("div",{className:"ticket-item-summary",children:[B.workerCount>0&&e.jsxs("span",{children:[e.jsx(Bs,{size:12})," ",B.workerCount," workers"]}),B.itemCount>0&&e.jsxs("span",{children:[e.jsx(Fn,{size:12})," ",B.itemCount," items"]}),B.equipmentCount>0&&e.jsxs("span",{children:[e.jsx(rs,{size:12})," ",B.equipmentCount," equipment"]}),B.laborHours>0&&e.jsxs("span",{children:[B.laborHours," hrs"]})]})]}),e.jsx("button",{className:"ticket-expand-btn",onClick:()=>L(C?null:G.id),children:C?e.jsx(ka,{size:16}):e.jsx(Hs,{size:16})})]}),C&&e.jsxs("div",{className:"ticket-item-details",children:[G.workers?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Workers"}),e.jsx("ul",{children:G.workers.map((b,A)=>e.jsxs("li",{children:[b.name||b.role," - ",b.regular_hours||0," reg hrs",b.overtime_hours>0&&`, ${b.overtime_hours} OT hrs`]},A))})]}),G.items?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Materials"}),e.jsx("ul",{children:G.items.map((b,A)=>e.jsxs("li",{children:[b.description||b.name," - ",b.quantity," ",b.unit]},A))})]}),G.materials_equipment?.filter(b=>b.type==="equipment").length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Equipment"}),e.jsx("ul",{children:G.materials_equipment.filter(b=>b.type==="equipment").map((b,A)=>e.jsx("li",{children:b.description||b.name},A))})]})]})]},G.id)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:i,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:$,disabled:v.size===0,children:[e.jsx(Pa,{size:16})," Import ",v.size," Ticket",v.size!==1?"s":""]})]})]})})}function xy({project:r,company:l,areas:o,existingCOR:i,onClose:m,onSaved:u,onShowToast:f}){const[g,j]=p.useState(!1),[v,x]=p.useState([]),[q,L]=p.useState(!1),[M,P]=p.useState({labor:i?.change_order_labor?.length>0,materials:i?.change_order_materials?.length>0,equipment:i?.change_order_equipment?.length>0,subcontractors:i?.change_order_subcontractors?.length>0,markups:!1}),[V,J]=p.useState([]),[ae,F]=p.useState(""),[R,S]=p.useState("all"),[K,pe]=p.useState(""),[$,G]=p.useState(i?.title||""),[B,Z]=p.useState(i?.scope_of_work||""),[C,b]=p.useState(i?.cor_number||""),[A,z]=p.useState(i?.group_name||""),[de,N]=p.useState(i?.area_id||""),[se,E]=p.useState(i?.period_start||""),[xe,k]=p.useState(i?.period_end||""),[U,ie]=p.useState(i?.change_order_labor||[]),[T,je]=p.useState(i?.change_order_materials||[]),[I,ke]=p.useState(i?.change_order_equipment||[]),[ue,Te]=p.useState(i?.change_order_subcontractors||[]),[Be,ze]=p.useState(i?.labor_markup_percent??Ln.labor_markup),[Oe,gt]=p.useState(i?.materials_markup_percent??Ln.materials_markup),[tt,ee]=p.useState(i?.equipment_markup_percent??Ln.equipment_markup),[Me,Fe]=p.useState(i?.subcontractors_markup_percent??Ln.subcontractors_markup),[pt,ma]=p.useState(i?.liability_insurance_percent??Ln.liability_insurance),[we,qe]=p.useState(i?.bond_percent??Ln.bond),[$e,Xe]=p.useState(i?.license_fee_percent??Ln.license_fee);p.useEffect(()=>{Zt(),Ye(),i||Nt()},[]);const Ye=async()=>{try{const w=await te.getAllMaterialsEquipment(l?.id);J(w||[])}catch(w){console.error("Error loading company materials:",w)}},Ze=p.useMemo(()=>V.filter(w=>!["Containment","PPE","Disposal"].includes(w.category)||w.active===!1||R!=="all"&&w.category!==R?!1:ae?w.name.toLowerCase().includes(ae.toLowerCase()):!0),[V,ae,R]),De=p.useMemo(()=>V.filter(w=>w.category!=="Equipment"||w.active===!1?!1:K?w.name.toLowerCase().includes(K.toLowerCase()):!0),[V,K]),vt=w=>{je([...T,{description:w.name,source_type:"field_ticket",source_reference:"",quantity:1,unit:w.unit||"each",unit_cost:w.cost_per_unit||0,total:w.cost_per_unit||0}])},wt=w=>{ke([...I,{description:w.name,source_type:"rental",source_reference:"",quantity:1,unit:w.unit||"day",unit_cost:w.cost_per_unit||0,total:w.cost_per_unit||0}])},Zt=async()=>{try{const w=await te.getLaborRates?.(l?.id,r?.work_type,r?.job_type);x(w||[])}catch(w){console.error("Error loading labor rates:",w)}},ta=w=>{const me=w?.toLowerCase()||"";return v.find(he=>he.role?.toLowerCase()===me)||null},Nt=async()=>{try{const w=await te.getNextCORNumber?.(r.id);b(w||`COR-${Date.now()}`)}catch(w){console.error("Error generating COR number:",w),b(`COR-${Date.now()}`)}},Pt=w=>{P(me=>({...me,[w]:!me[w]}))},X=p.useMemo(()=>({title:$,scope_of_work:B,area_id:de||null,cor_number:C,group_name:A||null,period_start:se||null,period_end:xe||null,change_order_labor:U,change_order_materials:T,change_order_equipment:I,change_order_subcontractors:ue,labor_markup_percent:Be,materials_markup_percent:Oe,equipment_markup_percent:tt,subcontractors_markup_percent:Me,liability_insurance_percent:pt,bond_percent:we,license_fee_percent:$e}),[$,B,de,C,A,se,xe,U,T,I,ue,Be,Oe,tt,Me,pt,we,$e]),O=p.useMemo(()=>_l(X),[X]),be=()=>{const w=Hp[0],me=ta(w);ie([...U,{id:`temp-${Date.now()}`,labor_class:w,wage_type:"standard",regular_hours:0,overtime_hours:0,regular_rate:me?Math.round((parseFloat(me.regular_rate)||0)*100):0,overtime_rate:me?Math.round((parseFloat(me.overtime_rate)||0)*100):0,total:0}]),M.labor||Pt("labor")},Ee=(w,me,he)=>{const Se=[...U];if(Se[w]={...Se[w],[me]:he},me==="labor_class"){const ht=ta(he);ht&&(Se[w].regular_rate=Math.round((parseFloat(ht.regular_rate)||0)*100),Se[w].overtime_rate=Math.round((parseFloat(ht.overtime_rate)||0)*100))}const{total:lt}=hy(Se[w].regular_hours,Se[w].overtime_hours,Se[w].regular_rate,Se[w].overtime_rate);Se[w].total=lt,ie(Se)},ne=w=>{ie(U.filter((me,he)=>he!==w))},Ae=()=>{je([...T,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"each",unit_cost:0,total:0}]),M.materials||Pt("materials")},ot=(w,me,he)=>{const Se=[...T];Se[w]={...Se[w],[me]:he},Se[w].total=Lp(Se[w].quantity,Se[w].unit_cost),je(Se)},We=w=>{je(T.filter((me,he)=>he!==w))},Qt=()=>{ke([...I,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"day",unit_cost:0,total:0}]),M.equipment||Pt("equipment")},Lt=(w,me,he)=>{const Se=[...I];Se[w]={...Se[w],[me]:he},Se[w].total=Lp(Se[w].quantity,Se[w].unit_cost),ke(Se)},Dt=w=>{ke(I.filter((me,he)=>he!==w))},Mt=()=>{Te([...ue,{id:`temp-${Date.now()}`,company_name:"",description:"",source_type:"invoice",source_reference:"",amount:0,total:0}]),M.subcontractors||Pt("subcontractors")},$t=(w,me,he)=>{const Se=[...ue];Se[w]={...Se[w],[me]:he},me==="amount"&&(Se[w].total=parseInt(he)||0),Te(Se)},It=w=>{Te(ue.filter((me,he)=>he!==w))},la=w=>{w.laborItems?.length>0&&(ie([...U,...w.laborItems]),P(me=>({...me,labor:!0}))),w.materialsItems?.length>0&&(je([...T,...w.materialsItems]),P(me=>({...me,materials:!0}))),w.equipmentItems?.length>0&&(ke([...I,...w.equipmentItems]),P(me=>({...me,equipment:!0}))),f?.(`Imported data from ${w.ticketIds.length} ticket(s)`,"success")},Ne=$.trim().length>0,kt=async()=>{if(!Ne){f?.("Title is required","error");return}j(!0);try{const w={company_id:l.id,project_id:r.id,...X,...O,status:"draft"};let me;i?.id?me=await te.updateCOR(i.id,w):me=await te.createCOR(w),me?.id&&await te.saveCORLineItems(me.id,{laborItems:U,materialItems:T,equipmentItems:I,subcontractorItems:ue}),f?.("COR saved as draft","success"),u?.(me),m?.()}catch(w){console.error("Error saving COR:",w),f?.("Error saving COR","error")}finally{j(!1)}},ft=async()=>{const w=Up(X);if(!w.valid){f?.(w.errors[0],"error");return}j(!0);try{const me={company_id:l.id,project_id:r.id,...X,...O,status:"pending_approval"};let he;i?.id?(he=await te.updateCOR(i.id,{...me,status:"draft"}),await te.saveCORLineItems(i.id,{laborItems:U,materialItems:T,equipmentItems:I,subcontractorItems:ue}),await te.submitCORForApproval(i.id)):(he=await te.createCOR({...me,status:"draft"}),he?.id&&(await te.saveCORLineItems(he.id,{laborItems:U,materialItems:T,equipmentItems:I,subcontractorItems:ue}),await te.submitCORForApproval(he.id))),f?.("COR submitted for approval","success"),u?.(he),m?.()}catch(me){console.error("Error submitting COR:",me),f?.("Error submitting COR","error")}finally{j(!1)}},ja=({section:w,label:me,count:he,subtotal:Se})=>e.jsxs("div",{className:`cor-section-header ${M[w]?"expanded":""}`,onClick:()=>Pt(w),children:[e.jsxs("div",{className:"cor-section-title",children:[M[w]?e.jsx(ka,{size:18}):e.jsx(Hs,{size:18}),e.jsx("span",{children:me}),he>0&&e.jsx("span",{className:"cor-section-count",children:he})]}),Se>0&&e.jsx("span",{className:"cor-section-subtotal",children:Re(Se)})]});return e.jsxs("div",{className:"modal-overlay",onClick:m,children:[e.jsxs("div",{className:"modal-content cor-form-modal cor-form-simplified",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:i?"Edit Change Order Request":"New Change Order Request"}),e.jsx("button",{className:"close-btn",onClick:m,children:e.jsx(Ta,{size:20})})]}),e.jsxs("div",{className:"modal-body cor-form-body",children:[e.jsxs("div",{className:"cor-form-required",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group cor-number-field",children:[e.jsx("label",{children:"COR #"}),e.jsx("input",{type:"text",value:C,onChange:w=>b(w.target.value),className:"input-small"})]}),e.jsxs("div",{className:"form-group flex-grow",children:[e.jsx("label",{children:"Title *"}),e.jsx("input",{type:"text",value:$,onChange:w=>G(w.target.value),placeholder:"e.g., Additional Demolition Work - Building A"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:B,onChange:w=>Z(w.target.value),rows:2,placeholder:"Describe the scope of work (optional)"})]}),e.jsxs("div",{className:"form-row form-row-compact",children:[o&&o.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Area"}),e.jsxs("select",{value:de,onChange:w=>N(w.target.value),children:[e.jsx("option",{value:"",children:"None"}),o.map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Group"}),e.jsx("input",{type:"text",value:A,onChange:w=>z(w.target.value),placeholder:"e.g., Phase 1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"date",value:se,onChange:w=>E(w.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"date",value:xe,onChange:w=>k(w.target.value),min:se})]})]})]}),e.jsx("div",{className:"cor-import-bar",children:e.jsxs("button",{className:"btn btn-ghost",onClick:()=>L(!0),children:[e.jsx(Ma,{size:16})," Import from T&M Tickets"]})}),e.jsxs("div",{className:"cor-sections",children:[e.jsxs("div",{className:"cor-section",children:[e.jsx(ja,{section:"labor",label:"Labor",count:U.length,subtotal:O.labor_subtotal}),M.labor&&e.jsxs("div",{className:"cor-section-content",children:[U.map((w,me)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("select",{value:w.labor_class,onChange:he=>Ee(me,"labor_class",he.target.value),children:Hp.map(he=>e.jsx("option",{value:he,children:he},he))}),e.jsx("select",{value:w.wage_type,onChange:he=>Ee(me,"wage_type",he.target.value),children:py.map(he=>e.jsx("option",{value:he.value,children:he.label},he.value))}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Reg hrs",value:w.regular_hours||"",onChange:he=>Ee(me,"regular_hours",he.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/hr",value:w.regular_rate?w.regular_rate/100:"",onChange:he=>{const Se=he.target.value.replace(/[^0-9.]/g,"");Ee(me,"regular_rate",Math.round(parseFloat(Se||0)*100))},className:"input-small"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"OT hrs",value:w.overtime_hours||"",onChange:he=>Ee(me,"overtime_hours",he.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/hr",value:w.overtime_rate?w.overtime_rate/100:"",onChange:he=>{const Se=he.target.value.replace(/[^0-9.]/g,"");Ee(me,"overtime_rate",Math.round(parseFloat(Se||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Re(w.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>ne(me),children:e.jsx(Us,{size:14})})]})},w.id||me)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:be,children:[e.jsx(gs,{size:14})," Add Labor"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(ja,{section:"materials",label:"Materials",count:T.length,subtotal:O.materials_subtotal}),M.materials&&e.jsxs("div",{className:"cor-section-content",children:[V.filter(w=>["Containment","PPE","Disposal"].includes(w.category)&&w.active!==!1).length>0&&e.jsxs("div",{className:"quick-select-compact",children:[e.jsxs("div",{className:"quick-select-search",children:[e.jsx(Bi,{size:14}),e.jsx("input",{type:"text",placeholder:"Search materials...",value:ae,onChange:w=>F(w.target.value)})]}),e.jsx("div",{className:"quick-select-items",children:Ze.slice(0,8).map(w=>e.jsx("button",{className:"quick-item",onClick:()=>vt(w),children:w.name},w.id))})]}),T.map((w,me)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Description",value:w.description,onChange:he=>ot(me,"description",he.target.value),className:"input-wide"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Qty",value:w.quantity||"",onChange:he=>ot(me,"quantity",he.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("select",{value:w.unit,onChange:he=>ot(me,"unit",he.target.value),children:Bp.map(he=>e.jsx("option",{value:he,children:he},he))}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/unit",value:w.unit_cost?w.unit_cost/100:"",onChange:he=>{const Se=he.target.value.replace(/[^0-9.]/g,"");ot(me,"unit_cost",Math.round(parseFloat(Se||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Re(w.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>We(me),children:e.jsx(Us,{size:14})})]})},w.id||me)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:Ae,children:[e.jsx(gs,{size:14})," Add Material"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(ja,{section:"equipment",label:"Equipment",count:I.length,subtotal:O.equipment_subtotal}),M.equipment&&e.jsxs("div",{className:"cor-section-content",children:[V.filter(w=>w.category==="Equipment"&&w.active!==!1).length>0&&e.jsxs("div",{className:"quick-select-compact",children:[e.jsxs("div",{className:"quick-select-search",children:[e.jsx(Bi,{size:14}),e.jsx("input",{type:"text",placeholder:"Search equipment...",value:K,onChange:w=>pe(w.target.value)})]}),e.jsx("div",{className:"quick-select-items",children:De.slice(0,8).map(w=>e.jsx("button",{className:"quick-item",onClick:()=>wt(w),children:w.name},w.id))})]}),I.map((w,me)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Description",value:w.description,onChange:he=>Lt(me,"description",he.target.value),className:"input-wide"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Qty",value:w.quantity||"",onChange:he=>Lt(me,"quantity",he.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("select",{value:w.unit,onChange:he=>Lt(me,"unit",he.target.value),children:Bp.map(he=>e.jsx("option",{value:he,children:he},he))}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/unit",value:w.unit_cost?w.unit_cost/100:"",onChange:he=>{const Se=he.target.value.replace(/[^0-9.]/g,"");Lt(me,"unit_cost",Math.round(parseFloat(Se||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Re(w.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>Dt(me),children:e.jsx(Us,{size:14})})]})},w.id||me)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:Qt,children:[e.jsx(gs,{size:14})," Add Equipment"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(ja,{section:"subcontractors",label:"Subcontractors",count:ue.length,subtotal:O.subcontractors_subtotal}),M.subcontractors&&e.jsxs("div",{className:"cor-section-content",children:[ue.map((w,me)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Company",value:w.company_name,onChange:he=>$t(me,"company_name",he.target.value)}),e.jsx("input",{type:"text",placeholder:"Description",value:w.description,onChange:he=>$t(me,"description",he.target.value),className:"input-wide"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Amount",value:w.amount?w.amount/100:"",onChange:he=>{const Se=he.target.value.replace(/[^0-9.]/g,"");$t(me,"amount",Math.round(parseFloat(Se||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Re(w.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>It(me),children:e.jsx(Us,{size:14})})]})},w.id||me)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:Mt,children:[e.jsx(gs,{size:14})," Add Subcontractor"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(ja,{section:"markups",label:"Markups & Fees",count:0,subtotal:O.total_markup_amount+O.total_fees}),M.markups&&e.jsxs("div",{className:"cor-section-content markups-content",children:[e.jsxs("div",{className:"markups-grid-compact",children:[e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Labor Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(Be),onChange:w=>ze(qn(w.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Re(O.labor_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Materials Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(Oe),onChange:w=>gt(qn(w.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Re(O.materials_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Equipment Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(tt),onChange:w=>ee(qn(w.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Re(O.equipment_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Subcontractors Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(Me),onChange:w=>Fe(qn(w.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Re(O.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"fees-grid-compact",children:[e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Liability Insurance"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(pt),onChange:w=>ma(qn(w.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Re(O.liability_insurance_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Bond"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(we),onChange:w=>qe(qn(w.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Re(O.bond_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"City License Fee"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn($e),onChange:w=>Xe(qn(w.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Re(O.license_fee_amount)]})]})]})]})]})]}),e.jsxs("div",{className:"cor-summary-bar",children:[e.jsxs("div",{className:"cor-summary-item",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:Re(O.cor_subtotal)})]}),e.jsxs("div",{className:"cor-summary-item total",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:Re(O.cor_total)})]})]})]}),e.jsxs("div",{className:"modal-footer cor-form-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:m,disabled:g,children:"Cancel"}),e.jsxs("div",{className:"footer-actions",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:kt,disabled:g||!Ne,children:[e.jsx(fv,{size:16})," Save Draft"]}),e.jsxs("button",{className:"btn btn-primary",onClick:ft,disabled:g||!Up(X).valid,children:[e.jsx(Td,{size:16})," Submit"]})]})]})]}),q&&e.jsx(gy,{projectId:r.id,corId:i?.id,onImport:la,onClose:()=>L(!1),onShowToast:f})]})}const jy=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},Fp=r=>new Promise(l=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const i=document.createElement("canvas");i.width=o.width,i.height=o.height,i.getContext("2d").drawImage(o,0,0),l(i.toDataURL("image/png"))},o.onerror=()=>l(null),o.src=r});async function bf(r,l,o,i={},m=null){const u=new Fi,f=u.internal.pageSize.getWidth(),g=u.internal.pageSize.getHeight(),j=20;let v=j;const x=_l(r),q=i.primaryColor?jy(i.primaryColor):[30,58,138],L=[241,245,249];let M=null;if(i.logoUrl)try{M=await Fp(i.logoUrl)}catch($){console.error("Error loading logo:",$)}if(M)try{u.addImage(M,"PNG",j,v,40,15),v+=20}catch{u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...q),u.text(o?.name||"Company Name",j,v+10),v+=20}else u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...q),u.text(o?.name||"Company Name",j,v+10),v+=20;u.setFontSize(20),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("CHANGE ORDER REQUEST",j,v),v+=10,u.setFontSize(12),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(r.cor_number||"COR-XXXX",j,v);const P=r.status?.replace("_"," ").toUpperCase()||"DRAFT";u.setTextColor(...q),u.text(P,f-j-u.getTextWidth(P),v),v+=12,u.setDrawColor(...q),u.setLineWidth(.5),u.line(j,v,f-j,v),v+=10,u.setFontSize(10),u.setTextColor(0,0,0);const V=j,J=f/2;u.setFont("helvetica","bold"),u.text("Project:",V,v),u.setFont("helvetica","normal"),u.text(l?.name||"Project Name",V+25,v),u.setFont("helvetica","bold"),u.text("Job #:",J,v),u.setFont("helvetica","normal"),u.text(l?.job_number||"N/A",J+25,v),v+=6,u.setFont("helvetica","bold"),u.text("Period:",V,v),u.setFont("helvetica","normal"),u.text(Vi(r.period_start,r.period_end),V+25,v),u.setFont("helvetica","bold"),u.text("Date:",J,v),u.setFont("helvetica","normal"),u.text(ss(r.created_at),J+25,v),v+=10,u.setFont("helvetica","bold"),u.setFontSize(12),u.text(r.title||"Untitled Change Order",j,v),v+=8,u.setFont("helvetica","normal"),u.setFontSize(10),u.setTextColor(80,80,80);const ae=u.splitTextToSize(r.scope_of_work||"No scope of work provided.",f-j*2);u.text(ae,j,v),v+=ae.length*5+10,r.change_order_labor?.length>0&&(u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("LABOR",j,v),v+=6,fn(u,{startY:v,head:[["Class","Type","Reg Hrs","Reg Rate","OT Hrs","OT Rate","Total"]],body:r.change_order_labor.map($=>[$.labor_class,$.wage_type,$.regular_hours.toString(),`$${ns($.regular_rate)}/hr`,$.overtime_hours?.toString()||"-",$.overtime_hours?`$${ns($.overtime_rate)}/hr`:"-",Re($.total)]),foot:[[{content:`Subtotal: ${Re(x.labor_subtotal)}`,colSpan:5,styles:{halign:"right",fontStyle:"bold"}},{content:`+${ra(r.labor_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Re(x.labor_subtotal+x.labor_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:j,right:j},headStyles:{fillColor:q,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:L,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),r.change_order_materials?.length>0&&(v>g-80&&(u.addPage(),v=j),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("MATERIALS",j,v),v+=6,fn(u,{startY:v,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:r.change_order_materials.map($=>[$.description,$.source_reference||$.source_type,$.quantity.toString(),$.unit,`$${ns($.unit_cost)}`,Re($.total)]),foot:[[{content:`Subtotal: ${Re(x.materials_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${ra(r.materials_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Re(x.materials_subtotal+x.materials_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:j,right:j},headStyles:{fillColor:q,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:L,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),r.change_order_equipment?.length>0&&(v>g-80&&(u.addPage(),v=j),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("EQUIPMENT",j,v),v+=6,fn(u,{startY:v,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:r.change_order_equipment.map($=>[$.description,$.source_reference||$.source_type,$.quantity.toString(),$.unit,`$${ns($.unit_cost)}`,Re($.total)]),foot:[[{content:`Subtotal: ${Re(x.equipment_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${ra(r.equipment_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Re(x.equipment_subtotal+x.equipment_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:j,right:j},headStyles:{fillColor:q,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:L,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),r.change_order_subcontractors?.length>0&&(v>g-80&&(u.addPage(),v=j),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("SUBCONTRACTORS",j,v),v+=6,fn(u,{startY:v,head:[["Company","Description","Source","Amount"]],body:r.change_order_subcontractors.map($=>[$.company_name,$.description,$.source_reference||$.source_type,Re($.total)]),foot:[[{content:`Subtotal: ${Re(x.subcontractors_subtotal)}`,colSpan:2,styles:{halign:"right",fontStyle:"bold"}},{content:`+${ra(r.subcontractors_markup_percent||500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Re(x.subcontractors_subtotal+x.subcontractors_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:j,right:j},headStyles:{fillColor:q,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:L,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),v>g-100&&(u.addPage(),v=j),u.setFillColor(...L),u.roundedRect(j,v,f-j*2,70,3,3,"F"),v+=10,u.setFontSize(10),u.setFont("helvetica","normal"),u.setTextColor(0,0,0);const F=j+10,R=f-j-60;u.text("COR Subtotal:",F,v),u.setFont("helvetica","bold"),u.text(Re(x.cor_subtotal),R,v,{align:"right"}),v+=8,u.setFont("helvetica","normal"),u.setFontSize(9),u.text(`Liability Insurance (${ra(r.liability_insurance_percent||144)}):`,F,v),u.text(Re(x.liability_insurance_amount),R,v,{align:"right"}),v+=6,u.text(`Bond (${ra(r.bond_percent||100)}):`,F,v),u.text(Re(x.bond_amount),R,v,{align:"right"}),v+=6,u.text(`City License Fee (${ra(r.license_fee_percent||10)}):`,F,v),u.text(Re(x.license_fee_amount),R,v,{align:"right"}),v+=10,u.setFillColor(...q),u.roundedRect(F-5,v-3,f-j*2-10,16,2,2,"F"),u.setTextColor(255,255,255),u.setFontSize(12),u.setFont("helvetica","bold"),u.text("COR TOTAL:",F,v+8),u.text(Re(x.cor_total),R,v+8,{align:"right"}),v+=25,v>g-120&&(u.addPage(),v=j),v+=10,u.setTextColor(0,0,0),u.setFontSize(10),u.setFont("helvetica","bold"),u.text("AUTHORIZATION",j,v),v+=15,u.setFont("helvetica","normal"),u.setFontSize(9),u.setDrawColor(0,0,0);const S=($,G,B,Z,C,b,A)=>{u.setFont("helvetica","bold"),u.setFontSize(8),u.text(G,j,$),u.setFont("helvetica","normal"),u.setFontSize(9);const z=$+20;if(u.line(j,z,j+70,z),u.text("Signature",j,z+8),u.line(j+85,z,j+145,z),u.text("Title / Company",j+85,z+8),u.line(f-j-40,z,f-j,z),u.text("Date",f-j-40,z+8),B)try{if(u.addImage(B,"PNG",j,z-18,60,18),Z&&(u.setFontSize(8),u.text(Z,j,z+15)),C||b){const de=[C,b].filter(Boolean).join(" - ");u.text(de,j+85,z-5)}A&&u.text(ss(A),f-j-40,z-5)}catch(de){console.error("Error adding signature:",de)}else u.setFont("helvetica","italic"),u.setFontSize(9),u.setTextColor(150,150,150),u.text("Awaiting Signature",j+5,z-5),u.setTextColor(0,0,0),u.setFont("helvetica","normal");return z+25};if(v=S(v,"GC AUTHORIZATION",r.gc_signature_data||r.gc_signature,r.gc_signature_name||r.gc_signer_name,r.gc_signature_title,r.gc_signature_company,r.gc_signature_date||r.signed_at),v+=10,v=S(v,"CLIENT AUTHORIZATION",r.client_signature_data,r.client_signature_name,r.client_signature_title,r.client_signature_company,r.client_signature_date),m&&m.length>0){u.addPage(),v=j,u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...q),u.text("T&M BACKUP DOCUMENTATION",j,v),v+=8,u.setFontSize(10),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(`${m.length} T&M ticket${m.length>1?"s":""} associated with this COR`,j,v),v+=12,u.setDrawColor(...q),u.setLineWidth(.5),u.line(j,v,f-j,v),v+=10;for(const $ of m){v>g-100&&(u.addPage(),v=j),u.setFillColor(245,247,250),u.roundedRect(j,v,f-j*2,18,2,2,"F"),u.setFontSize(11),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text(`T&M Ticket  ${ss($.work_date)}`,j+5,v+7),$.ce_pco_number&&(u.setFontSize(9),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(`CE/PCO: ${$.ce_pco_number}`,j+5,v+14));const B={pending:[217,119,6],approved:[5,150,105],billed:[37,99,235]}[$.status]||[100,100,100];if(u.setFontSize(8),u.setTextColor(...B),u.text($.status?.toUpperCase()||"PENDING",f-j-30,v+10),v+=24,$.notes){u.setFontSize(9),u.setFont("helvetica","italic"),u.setTextColor(80,80,80);const Z=u.splitTextToSize($.notes,f-j*2-10);u.text(Z,j+5,v),v+=Z.length*4+6}if($.t_and_m_workers?.length>0&&(u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("Labor:",j+5,v),v+=4,fn(u,{startY:v,head:[["Worker","Class","Hours","Rate","OT Hrs","OT Rate"]],body:$.t_and_m_workers.map(Z=>[Z.name,Z.labor_class||"-",Z.hours?.toString()||"0",Z.rate?`$${Z.rate}/hr`:"-",Z.overtime_hours?.toString()||"-",Z.overtime_rate?`$${Z.overtime_rate}/hr`:"-"]),margin:{left:j+5,right:j},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),v=u.lastAutoTable.finalY+8),$.t_and_m_items?.length>0&&(v>g-60&&(u.addPage(),v=j),u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("Materials/Equipment:",j+5,v),v+=4,fn(u,{startY:v,head:[["Item","Qty","Unit","Unit Cost","Total"]],body:$.t_and_m_items.map(Z=>[Z.materials_equipment?.name||Z.description||"Item",Z.quantity?.toString()||"1",Z.materials_equipment?.unit||"ea",Z.materials_equipment?.cost_per_unit?`$${Z.materials_equipment.cost_per_unit}`:"-",Z.materials_equipment?.cost_per_unit&&Z.quantity?`$${(Z.quantity*Z.materials_equipment.cost_per_unit).toFixed(2)}`:"-"]),margin:{left:j+5,right:j},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),v=u.lastAutoTable.finalY+8),$.photos?.length>0){v>g-80&&(u.addPage(),v=j),u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text(`Photos (${$.photos.length}):`,j+5,v),v+=6;let Z=j+5;const C=45,b=35,A=3;for(let z=0;z<$.photos.length;z++){z>0&&z%A===0&&(Z=j+5,v+=b+5),v+b>g-20&&(u.addPage(),v=j,Z=j+5);try{const de=await Fp($.photos[z]);de?u.addImage(de,"JPEG",Z,v,C,b):(u.setFillColor(240,240,240),u.rect(Z,v,C,b,"F"),u.setFontSize(7),u.setTextColor(150,150,150),u.text("Photo unavailable",Z+5,v+b/2))}catch{u.setFillColor(240,240,240),u.rect(Z,v,C,b,"F"),u.setFontSize(7),u.setTextColor(150,150,150),u.text("Photo unavailable",Z+5,v+b/2)}Z+=C+5}v+=b+10}v+=5,u.setDrawColor(200,200,200),u.setLineWidth(.2),u.line(j,v,f-j,v),v+=10}}const K=u.internal.getNumberOfPages();for(let $=1;$<=K;$++){u.setPage($);const G=g-10;u.setFontSize(8),u.setTextColor(150,150,150),u.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,j,G),u.text(`Page ${$} of ${K}`,f-j,G,{align:"right"})}const pe=`${r.cor_number||"COR"}_${l?.job_number||"export"}${m?.length?"_with_backup":""}.pdf`;u.save(pe)}function vy({onSave:r,onClose:l,signerName:o=""}){const i=p.useRef(null),[m,u]=p.useState(o),[f,g]=p.useState(!1),[j,v]=p.useState(!1),x=()=>{const F=i.current;return F?F.getContext("2d"):null},q=F=>{const R=i.current;if(!R)return{x:0,y:0};const S=R.getBoundingClientRect(),K=R.width/S.width,pe=R.height/S.height,$=F.touches?F.touches[0].clientX:F.clientX,G=F.touches?F.touches[0].clientY:F.clientY;return{x:($-S.left)*K,y:(G-S.top)*pe}},L=F=>{F.preventDefault();const R=x();if(!R)return;const{x:S,y:K}=q(F);R.beginPath(),R.moveTo(S,K),v(!0),g(!0)},M=F=>{if(!j)return;F.preventDefault();const R=x();if(!R)return;const{x:S,y:K}=q(F);R.lineTo(S,K),R.stroke()},P=()=>{v(!1)},V=()=>{const F=i.current,R=x();!F||!R||(R.clearRect(0,0,F.width,F.height),g(!1))},J=F=>{if(!F)return;i.current=F;const R=F.getContext("2d");R.strokeStyle="#1e293b",R.lineWidth=2,R.lineCap="round",R.lineJoin="round"},ae=()=>{if(!f||!m.trim())return;const F=i.current;if(!F)return;const R=F.toDataURL("image/png");r({signature:R,signerName:m.trim(),signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"signature-title",children:"GC Signature"}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close signature modal",children:e.jsx(Ta,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Signer Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:m,onChange:F=>u(F.target.value),placeholder:"Enter full name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(Ed,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Sign below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:J,width:500,height:200,className:"signature-canvas",onMouseDown:L,onMouseMove:M,onMouseUp:P,onMouseLeave:P,onTouchStart:L,onTouchMove:M,onTouchEnd:P,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!f&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:V,disabled:!f,"aria-label":"Clear signature",children:[e.jsx(Md,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("p",{className:"signature-legal",role:"note",children:"By signing above, I acknowledge that I have reviewed and approve this Change Order Request."})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:ae,disabled:!f||!m.trim(),"aria-label":"Save signature",children:[e.jsx(Pa,{size:16,"aria-hidden":"true"})," Save Signature"]})]})]})})}function yy({cor:r,project:l,company:o,areas:i,onClose:m,onEdit:u,onShowToast:f,onStatusChange:g}){const[j,v]=p.useState(!0),[x,q]=p.useState(r),[L,M]=p.useState(!1),[P,V]=p.useState(!1),[J,ae]=p.useState(new Set),[F,R]=p.useState(null),[S,K]=p.useState(!1),[pe,$]=p.useState(""),G=p.useCallback(async()=>{try{const I=await te.getCORById(r.id);I&&q(I)}catch(I){console.error("Error fetching COR details:",I),f?.("Error loading COR details","error")}finally{v(!1)}},[r.id,f]);p.useEffect(()=>{G()},[G]),p.useEffect(()=>{const I=te.subscribeToCorTickets?.(r.id,()=>{G()});return()=>{I&&te.unsubscribe?.(I)}},[r.id,G]);const B=p.useMemo(()=>_l(x),[x]),Z=yf(x.status),C=x.status==="pending_approval",b=["draft","pending_approval","approved"].includes(x.status),A=I=>i?.find(ue=>ue.id===I)?.name||null,z=async()=>{if(confirm("Approve this change order request?")){v(!0);try{await te.approveCOR(x.id),q({...x,status:"approved",approved_at:new Date().toISOString()}),f?.("COR approved","success"),g?.()}catch(I){console.error("Error approving COR:",I),f?.("Error approving COR","error")}finally{v(!1)}}},de=async()=>{const I=prompt("Enter rejection reason (optional):");if(I!==null){v(!0);try{await te.rejectCOR(x.id,I),q({...x,status:"rejected",rejection_reason:I}),f?.("COR rejected","success"),g?.()}catch(ke){console.error("Error rejecting COR:",ke),f?.("Error rejecting COR","error")}finally{v(!1)}}},N=async()=>{if(confirm("Mark this COR as billed?")){v(!0);try{await te.markCORAsBilled(x.id),q({...x,status:"billed"}),f?.("COR marked as billed","success"),g?.()}catch(I){console.error("Error marking COR as billed:",I),f?.("Error updating status","error")}finally{v(!1)}}},se=async I=>{v(!0);try{await te.saveCORSignature?.(x.id,{gc_signature:I.signature,gc_signer_name:I.signerName,signed_at:I.signedAt}),q({...x,gc_signature:I.signature,gc_signer_name:I.signerName,signed_at:I.signedAt}),M(!1),f?.("Signature saved","success"),g?.()}catch(ke){console.error("Error saving signature:",ke),f?.("Error saving signature","error")}finally{v(!1)}},E=x.status==="approved"&&!x.gc_signature,xe=async()=>{if(!pe.trim()){K(!1);return}v(!0);try{await te.updateCOR(x.id,{cor_number:pe.trim()}),q({...x,cor_number:pe.trim()}),K(!1),f?.("COR number updated","success")}catch(I){console.error("Error updating COR number:",I),f?.("Error updating COR number","error")}finally{v(!1)}},k=()=>{$(x.cor_number||""),K(!0)},U=I=>{ae(ke=>{const ue=new Set(ke);return ue.has(I)?ue.delete(I):ue.add(I),ue})},ie=p.useMemo(()=>x.change_order_ticket_associations?.map(I=>I.t_and_m_tickets).filter(Boolean)||[],[x.change_order_ticket_associations]),T=I=>{const ke=I.t_and_m_workers||[],ue=ke.reduce((Be,ze)=>Be+(parseFloat(ze.hours)||0),0),Te=ke.reduce((Be,ze)=>Be+(parseFloat(ze.overtime_hours)||0),0);return{regular:ue,overtime:Te,total:ue+Te}},je=async()=>{try{f?.("Generating PDF with backup...","info"),await bf(x,l,o,{},ie),f?.("PDF downloaded","success")}catch(I){console.error("Error exporting PDF:",I),f?.("Error generating PDF","error")}};return j?e.jsx("div",{className:"modal-overlay",onClick:m,children:e.jsx("div",{className:"modal-content cor-detail-modal",onClick:I=>I.stopPropagation(),children:e.jsx("div",{className:"cor-detail-loading",children:"Loading COR details..."})})}):e.jsxs("div",{className:"modal-overlay",onClick:m,role:"dialog","aria-modal":"true","aria-labelledby":"cor-detail-title",children:[e.jsxs("div",{className:"modal-content cor-detail-modal",onClick:I=>I.stopPropagation(),children:[e.jsxs("div",{className:"modal-header cor-detail-header",children:[e.jsxs("div",{className:"cor-detail-title-row",children:[e.jsxs("div",{children:[e.jsx("div",{className:"cor-detail-number",children:S?e.jsxs("div",{className:"cor-number-edit",children:[e.jsx("input",{type:"text",value:pe,onChange:I=>$(I.target.value),onKeyDown:I=>{I.key==="Enter"&&xe(),I.key==="Escape"&&K(!1)},autoFocus:!0,className:"cor-number-input"}),e.jsx("button",{className:"btn-icon-sm",onClick:xe,title:"Save",children:e.jsx(Pa,{size:14})}),e.jsx("button",{className:"btn-icon-sm",onClick:()=>K(!1),title:"Cancel",children:e.jsx(Ta,{size:14})})]}):e.jsxs("div",{className:"cor-number-display",children:[e.jsx("span",{children:x.cor_number}),b&&e.jsx("button",{className:"btn-icon-sm",onClick:k,title:"Edit COR number",children:e.jsx(Dd,{size:12})})]})}),e.jsx("h2",{id:"cor-detail-title",children:x.title||"Untitled COR"})]}),e.jsx("button",{className:"close-btn",onClick:m,"aria-label":"Close COR details",children:e.jsx(Ta,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"cor-detail-meta",children:[e.jsx("span",{className:"cor-detail-status",style:{backgroundColor:Z.bgColor,color:Z.color},children:Z.label}),x.group_name&&e.jsx("span",{className:"cor-detail-group",children:x.group_name}),A(x.area_id)&&e.jsx("span",{className:"cor-detail-area",children:A(x.area_id)}),e.jsxs("span",{className:"cor-detail-period",children:[e.jsx(xn,{size:14})," ",Vi(x.period_start,x.period_end)]})]})]}),e.jsxs("div",{className:"modal-body cor-detail-body",children:[e.jsxs("div",{className:"cor-detail-section",children:[e.jsxs("h3",{children:[e.jsx(Ma,{size:18})," Scope of Work"]}),e.jsx("p",{className:"cor-scope-text",children:x.scope_of_work||"No scope of work provided."})]}),e.jsxs("div",{className:"cor-detail-section pricing-breakdown",children:[e.jsxs("h3",{children:[e.jsx(Sr,{size:18})," Pricing Breakdown"]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Bs,{size:16}),e.jsx("span",{children:"Labor"})]}),e.jsx("span",{className:"category-subtotal",children:Re(B.labor_subtotal)})]}),x.change_order_labor?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"Reg Rate"}),e.jsx("th",{children:"OT Hrs"}),e.jsx("th",{children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:x.change_order_labor.map((I,ke)=>e.jsxs("tr",{children:[e.jsx("td",{children:I.labor_class}),e.jsx("td",{children:I.wage_type}),e.jsx("td",{children:I.regular_hours}),e.jsxs("td",{children:["$",ns(I.regular_rate),"/hr"]}),e.jsx("td",{children:I.overtime_hours||"-"}),e.jsx("td",{children:I.overtime_hours?`$${ns(I.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:Re(I.total)})]},ke))})]})}):e.jsx("div",{className:"category-empty",children:"No labor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",ra(x.labor_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Re(B.labor_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Fn,{size:16}),e.jsx("span",{children:"Materials"})]}),e.jsx("span",{className:"category-subtotal",children:Re(B.materials_subtotal)})]}),x.change_order_materials?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:x.change_order_materials.map((I,ke)=>e.jsxs("tr",{children:[e.jsx("td",{children:I.description}),e.jsx("td",{children:I.source_reference||I.source_type}),e.jsx("td",{children:I.quantity}),e.jsx("td",{children:I.unit}),e.jsxs("td",{children:["$",ns(I.unit_cost)]}),e.jsx("td",{className:"text-right",children:Re(I.total)})]},ke))})]})}):e.jsx("div",{className:"category-empty",children:"No material items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",ra(x.materials_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Re(B.materials_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(rs,{size:16}),e.jsx("span",{children:"Equipment"})]}),e.jsx("span",{className:"category-subtotal",children:Re(B.equipment_subtotal)})]}),x.change_order_equipment?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:x.change_order_equipment.map((I,ke)=>e.jsxs("tr",{children:[e.jsx("td",{children:I.description}),e.jsx("td",{children:I.source_reference||I.source_type}),e.jsx("td",{children:I.quantity}),e.jsx("td",{children:I.unit}),e.jsxs("td",{children:["$",ns(I.unit_cost)]}),e.jsx("td",{className:"text-right",children:Re(I.total)})]},ke))})]})}):e.jsx("div",{className:"category-empty",children:"No equipment items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",ra(x.equipment_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Re(B.equipment_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(vl,{size:16}),e.jsx("span",{children:"Subcontractors"})]}),e.jsx("span",{className:"category-subtotal",children:Re(B.subcontractors_subtotal)})]}),x.change_order_subcontractors?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:x.change_order_subcontractors.map((I,ke)=>e.jsxs("tr",{children:[e.jsx("td",{children:I.company_name}),e.jsx("td",{children:I.description}),e.jsx("td",{children:I.source_reference||I.source_type}),e.jsx("td",{className:"text-right",children:Re(I.total)})]},ke))})]})}):e.jsx("div",{className:"category-empty",children:"No subcontractor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",ra(x.subcontractors_markup_percent||500),")"]}),e.jsxs("span",{children:["+",Re(B.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"cor-subtotal-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Re(B.cor_subtotal)})]}),e.jsxs("div",{className:"pricing-category fees-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(iv,{size:16}),e.jsx("span",{children:"Additional Fees"})]}),e.jsx("span",{className:"category-subtotal",children:Re(B.additional_fees_total)})]}),e.jsxs("div",{className:"fees-list",children:[e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx($i,{size:14}),e.jsxs("span",{children:["Liability Insurance (",ra(x.liability_insurance_percent||144),")"]})]}),e.jsx("span",{className:"fee-amount",children:Re(B.liability_insurance_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Ma,{size:14}),e.jsxs("span",{children:["Bond (",ra(x.bond_percent||100),")"]})]}),e.jsx("span",{className:"fee-amount",children:Re(B.bond_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Hi,{size:14}),e.jsxs("span",{children:["City License Fee (",ra(x.license_fee_percent||10),")"]})]}),e.jsx("span",{className:"fee-amount",children:Re(B.license_fee_amount)})]})]})]}),e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:Re(B.cor_total)})]})]}),ie.length>0&&e.jsxs("div",{className:"cor-detail-section backup-section",children:[e.jsxs("h3",{children:[e.jsx(Ma,{size:18})," Backup Documentation"]}),e.jsxs("p",{className:"backup-summary",children:[ie.length," T&M ticket",ie.length!==1?"s":""," associated with this COR"]}),e.jsx("div",{className:"backup-tickets-list",children:ie.map(I=>{const ke=J.has(I.id),ue=T(I),Te=I.t_and_m_workers?.length||0,Be=I.t_and_m_items?.length||0,ze=I.photos?.length||0;return e.jsxs("div",{className:"backup-ticket-card",children:[e.jsxs("div",{className:"backup-ticket-header",onClick:()=>U(I.id),children:[e.jsx("div",{className:"backup-ticket-toggle",children:ke?e.jsx(ka,{size:18}):e.jsx(Hs,{size:18})}),e.jsxs("div",{className:"backup-ticket-info",children:[e.jsxs("div",{className:"backup-ticket-date",children:[e.jsx(kr,{size:14}),e.jsx("span",{children:ss(I.work_date)})]}),I.ce_pco_number&&e.jsxs("span",{className:"backup-ticket-pco",children:["CE/PCO: ",I.ce_pco_number]})]}),e.jsxs("div",{className:"backup-ticket-stats",children:[e.jsxs("span",{className:"backup-stat",children:[e.jsx(Bs,{size:14})," ",Te]}),e.jsxs("span",{className:"backup-stat",children:[ue.total.toFixed(1)," hrs"]}),ze>0&&e.jsxs("span",{className:"backup-stat",children:[e.jsx(Bj,{size:14})," ",ze]}),I.client_signature_data&&e.jsxs("span",{className:"backup-stat verified",title:`Verified by ${I.client_signature_name}`,children:[e.jsx(ld,{size:14})," Verified"]})]}),e.jsx("span",{className:`backup-ticket-status status-${I.status}`,children:I.status})]}),ke&&e.jsxs("div",{className:"backup-ticket-details",children:[I.notes&&e.jsxs("div",{className:"backup-ticket-notes",children:[e.jsx("strong",{children:"Notes:"})," ",I.notes]}),I.t_and_m_workers?.length>0&&e.jsxs("div",{className:"backup-workers",children:[e.jsxs("h4",{children:["Labor (",Te," workers)"]}),e.jsxs("table",{className:"backup-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"OT Hrs"})]})}),e.jsx("tbody",{children:I.t_and_m_workers.map((Oe,gt)=>e.jsxs("tr",{children:[e.jsx("td",{children:Oe.name}),e.jsx("td",{children:Oe.role||"-"}),e.jsx("td",{className:"backup-time-range",children:Oe.time_started&&Oe.time_ended?`${Oe.time_started} - ${Oe.time_ended}`:"-"}),e.jsx("td",{children:Oe.hours||0}),e.jsx("td",{children:Oe.overtime_hours||"-"})]},gt))})]})]}),I.t_and_m_items?.length>0&&e.jsxs("div",{className:"backup-items",children:[e.jsxs("h4",{children:["Materials & Equipment (",Be," items)"]}),e.jsxs("table",{className:"backup-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Qty"})]})}),e.jsx("tbody",{children:I.t_and_m_items.map((Oe,gt)=>e.jsxs("tr",{children:[e.jsx("td",{children:Oe.materials_equipment?.name||Oe.custom_name||"Item"}),e.jsx("td",{children:Oe.materials_equipment?.category||Oe.custom_category||"-"}),e.jsx("td",{children:Oe.quantity})]},gt))})]})]}),I.photos?.length>0&&e.jsxs("div",{className:"backup-photos",children:[e.jsxs("h4",{children:["Photos (",ze,")"]}),e.jsx("div",{className:"backup-photos-grid",children:I.photos.map((Oe,gt)=>e.jsx("div",{className:"backup-photo-thumb",onClick:()=>R(Oe),children:e.jsx("img",{src:Oe,alt:`Photo ${gt+1}`})},gt))})]}),I.client_signature_data&&e.jsxs("div",{className:"backup-verification",children:[e.jsxs("h4",{children:[e.jsx(ld,{size:14})," Client Verification"]}),e.jsxs("div",{className:"backup-signature-display",children:[e.jsx("img",{src:I.client_signature_data,alt:"Client Signature",className:"backup-signature-image"}),e.jsxs("div",{className:"backup-signature-info",children:[e.jsx("span",{className:"backup-signer-name",children:I.client_signature_name}),I.client_signature_title&&e.jsx("span",{className:"backup-signer-title",children:I.client_signature_title}),I.client_signature_company&&e.jsx("span",{className:"backup-signer-company",children:I.client_signature_company}),e.jsxs("span",{className:"backup-signed-date",children:["Verified: ",ss(I.client_signature_date)]})]})]})]})]})]},I.id)})})]}),(x.gc_signature_data||x.gc_signature||x.client_signature_data)&&e.jsxs("div",{className:"cor-detail-section signature-section",children:[e.jsxs("h3",{children:[e.jsx(Nv,{size:18})," Signatures"]}),e.jsxs("div",{className:"dual-signatures",children:[(x.gc_signature_data||x.gc_signature)&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"GC Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:x.gc_signature_data||x.gc_signature,alt:"GC Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:x.gc_signature_name||x.gc_signer_name}),(x.gc_signature_title||x.gc_signature_company)&&e.jsxs("span",{className:"signer-org",children:[x.gc_signature_title,x.gc_signature_title&&x.gc_signature_company&&" - ",x.gc_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",ss(x.gc_signature_date||x.signed_at)]})]})]})]}),x.client_signature_data&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"Client Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:x.client_signature_data,alt:"Client Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:x.client_signature_name}),(x.client_signature_title||x.client_signature_company)&&e.jsxs("span",{className:"signer-org",children:[x.client_signature_title,x.client_signature_title&&x.client_signature_company&&" - ",x.client_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",ss(x.client_signature_date)]})]})]})]})]})]}),x.status==="rejected"&&x.rejection_reason&&e.jsxs("div",{className:"cor-detail-section rejection-section",children:[e.jsxs("h3",{children:[e.jsx(Dp,{size:18})," Rejection Reason"]}),e.jsx("p",{className:"rejection-text",children:x.rejection_reason})]})]}),e.jsxs("div",{className:"modal-footer cor-detail-footer",children:[e.jsxs("div",{className:"footer-info",children:[e.jsxs("span",{children:["Created: ",ss(x.created_at)]}),x.approved_at&&e.jsxs("span",{children:["Approved: ",ss(x.approved_at)]})]}),e.jsxs("div",{className:"footer-actions",role:"group","aria-label":"COR actions",children:[b&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>u?.(x),disabled:j,"aria-label":"Edit this COR",children:[e.jsx(jl,{size:16,"aria-hidden":"true"})," Edit"]}),C&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-danger",onClick:de,disabled:j,"aria-label":"Reject this COR",children:[e.jsx(Dp,{size:16,"aria-hidden":"true"})," Reject"]}),e.jsxs("button",{className:"btn btn-success",onClick:z,disabled:j,"aria-label":"Approve this COR",children:[e.jsx(fs,{size:16,"aria-hidden":"true"})," Approve"]})]}),E&&e.jsxs("button",{className:"btn btn-success",onClick:()=>M(!0),disabled:j,"aria-label":"Get GC signature for this COR",children:[e.jsx(ld,{size:16,"aria-hidden":"true"})," Get GC Signature"]}),(x.status==="approved"||x.status==="pending_approval")&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>V(!0),disabled:j,"aria-label":"Get shareable signature link",children:[e.jsx(kd,{size:16,"aria-hidden":"true"})," Get Signature Link"]}),x.status==="approved"&&e.jsxs("button",{className:"btn btn-primary",onClick:N,disabled:j,"aria-label":"Mark this COR as billed",children:[e.jsx(Sr,{size:16,"aria-hidden":"true"})," Mark Billed"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:je,"aria-label":"Export COR to PDF",children:[e.jsx(of,{size:16,"aria-hidden":"true"})," Export PDF"]})]})]})]}),L&&e.jsx(vy,{onSave:se,onClose:()=>M(!1),signerName:""}),P&&e.jsx(zd,{documentType:"cor",documentId:x.id,companyId:o?.id,projectId:l?.id,documentTitle:`COR ${x.cor_number}: ${x.title||"Untitled"}`,onClose:()=>V(!1),onShowToast:f}),F&&e.jsxs("div",{className:"photo-lightbox",onClick:()=>R(null),children:[e.jsx("button",{className:"lightbox-close",onClick:()=>R(null),children:e.jsx(Ta,{size:24})}),e.jsx("img",{src:F,alt:"Full size photo",onClick:I=>I.stopPropagation()})]})]})}const mn=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),by=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric"});function _y({dailyBurn:r,totalBurn:l,daysWorked:o,laborCost:i,haulOffCost:m,progress:u,contractValue:f,laborByDate:g=[],haulOffByDate:j=[]}){const[v,x]=p.useState(!1),q=f*(u/100)*.6,L=l<=q?"on-budget":l<=q*1.2?"warning":"over-budget",M={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[L],P=L==="on-budget"?mf:L==="warning"?Nd:hf,J=u>0?l/(u/100):0,ae=[],F={};g.forEach(S=>{F[S.date]||(F[S.date]={date:S.date,labor:0,haulOff:0,total:0}),F[S.date].labor=S.cost||0,F[S.date].total+=S.cost||0}),j.forEach(S=>{F[S.date]||(F[S.date]={date:S.date,labor:0,haulOff:0,total:0}),F[S.date].haulOff=S.cost||0,F[S.date].total+=S.cost||0}),Object.values(F).sort((S,K)=>new Date(K.date)-new Date(S.date)).slice(0,10).forEach(S=>ae.push(S));const R=Math.max(...ae.map(S=>S.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(zj,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${L}`,children:[e.jsx(P,{size:14}),e.jsx("span",{children:M})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:mn(r)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),o>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",o," work day",o!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:mn(l)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:mn(i)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Disposal"}),e.jsx("span",{className:"burn-summary-value",children:mn(m)})]})]}),u>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${J>f*.7?"warning":""}`,children:mn(J)})]}),ae.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>x(!v),children:[v?e.jsx(cf,{size:16}):e.jsx(ka,{size:16}),e.jsxs("span",{children:[v?"Hide":"View"," Daily Breakdown"]})]}),v&&ae.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Disposal"}),e.jsx("span",{children:"Total"})]}),ae.map(S=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:by(S.date)}),e.jsx("span",{className:"burn-labor",children:S.labor>0?mn(S.labor):"-"}),e.jsx("span",{className:"burn-hauloff",children:S.haulOff>0?mn(S.haulOff):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${S.total/R*100}%`}}),e.jsx("span",{className:"burn-amount",children:mn(S.total)})]})]},S.date))]})]})}const md=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),Li={labor:{label:"Labor",Icon:Ea,color:"#3b82f6"},disposal:{label:"Disposal",Icon:rs,color:"#10b981"},equipment:{label:"Equipment",Icon:bl,color:"#f59e0b"},materials:{label:"Materials",Icon:Fn,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:Bs,color:"#ec4899"},other:{label:"Other",Icon:df,color:"#6b7280"}};function Ny({laborCost:r=0,haulOffCost:l=0,customCosts:o=[],onAddCost:i,onDeleteCost:m}){const[u,f]=p.useState(!1),[g,j]=p.useState(null),v=[];r>0&&v.push({category:"labor",label:"Labor",amount:r,source:"auto",description:"From crew check-ins"}),l>0&&v.push({category:"disposal",label:"Disposal",amount:l,source:"auto",description:"From haul-off logs"});const x={};o.forEach(M=>{x[M.category]||(x[M.category]={category:M.category,items:[],total:0}),x[M.category].items.push(M),x[M.category].total+=parseFloat(M.amount)||0}),Object.values(x).forEach(M=>{const P=Li[M.category]||Li.other;v.push({category:M.category,label:P.label,amount:M.total,source:"manual",items:M.items})});const q=v.reduce((M,P)=>M+P.amount,0);v.forEach(M=>{M.percentage=q>0?M.amount/q*100:0}),v.sort((M,P)=>P.amount-M.amount);const L=M=>{j(g===M?null:M)};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:md(q)})]}),v.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):e.jsx("div",{className:"cost-breakdown",children:v.map(M=>{const P=Li[M.category]||Li.other,V=P.Icon,J=M.items&&M.items.length>0,ae=g===M.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${J?"expandable":""}`,onClick:()=>J&&L(M.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(M.percentage,2)}%`,backgroundColor:P.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(V,{size:14,style:{color:P.color}}),e.jsx("span",{children:M.label}),M.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),J&&(ae?e.jsx(cf,{size:14}):e.jsx(ka,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:md(M.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(M.percentage),"%"]})]})]})]}),ae&&J&&e.jsx("div",{className:"cost-category-items",children:M.items.map(F=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:F.description}),e.jsx("span",{className:"cost-item-date",children:new Date(F.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:md(F.amount)}),m&&e.jsx("button",{className:"cost-item-delete",onClick:R=>{R.stopPropagation(),confirm("Delete this cost entry?")&&m(F.id)},children:e.jsx(Us,{size:14})})]})]},F.id))})]},M.category)})}),i&&e.jsxs("button",{className:"cost-add-btn",onClick:i,children:[e.jsx(gs,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const Un=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0);function Sy({revenue:r,totalCosts:l,contractValue:o,progress:i}){const m=r-l,u=r>0?m/r*100:0,f=o,g=i>0?l/(i/100):l,j=f-g,v=f>0?j/f*100:0,x=u>=20,q=u>=0&&u<20,L=u<0,M=x?"healthy":q?"warning":"loss",P=x?"On Track":q?"Watch Margin":"Over Cost",V=x?fs:q?Cr:mf;return e.jsxs("div",{className:`profitability-card ${M}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${M}`,children:[e.jsx(V,{size:14}),e.jsx("span",{children:P})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${u<0?"negative":""}`,children:[Math.round(u),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${u<0?"negative":u<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(u),100)}%`}})})]}),i>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${v<0?"negative":""}`,children:[Math.round(v),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${v<0?"negative":v<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(v),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:Un(r)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",Un(l)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${m<0?"negative":"positive"}`,children:[m>=0?"":"-",Un(Math.abs(m))]})]})]}),i>10&&e.jsxs("div",{className:"profitability-insight",children:[x&&e.jsxs("p",{children:["At ",Math.round(i),"% complete, you're at ",Un(m)," profit.",j>0&&` Projected final profit: ${Un(j)}`]}),q&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",j<0&&` Trending toward ${Un(j)} loss.`]}),L&&e.jsxs("p",{children:["Currently over cost by ",Un(Math.abs(m)),". Immediate review recommended."]})]})]})}const Cy={concrete:{label:"Concrete",icon:"",color:"#6b7280"},trash:{label:"Trash",icon:"",color:"#10b981"},metals:{label:"Metals",icon:"",color:"#3b82f6"},hazardous_waste:{label:"Hazardous Waste",icon:"",color:"#f59e0b"}};function wy({project:r,period:l="week"}){const[o,i]=p.useState([]),[m,u]=p.useState([]),[f,g]=p.useState(!0),j=()=>{const L=new Date,M=new Date;switch(l){case"week":M.setDate(M.getDate()-7);break;case"month":M.setMonth(M.getMonth()-1);break;case"all":M.setFullYear(2020);break;default:M.setDate(M.getDate()-7)}return{startDate:M.toISOString().split("T")[0],endDate:L.toISOString().split("T")[0]}};p.useEffect(()=>{v()},[r.id,l]);const v=async()=>{try{g(!0);const{startDate:L,endDate:M}=j(),[P,V]=await Promise.all([te.getDisposalSummary(r.id,L,M),te.getWeeklyDisposalSummary(r.id,4)]);i(P||[]),u(V||[])}catch(L){console.error("Error loading disposal summary:",L)}finally{g(!1)}},x=o.reduce((L,M)=>L+(M.total_loads||0),0),q={week:"This Week",month:"This Month",all:"All Time"}[l]||"This Week";return f?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(rs,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):x===0?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(rs,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("p",{className:"text-muted",children:q})]})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(rs,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsx("span",{className:"period-badge",children:q})]}),e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"total-number",children:x}),e.jsx("span",{className:"total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:o.map(L=>{const M=Cy[L.load_type]||{label:L.load_type,icon:"",color:"#6b7280"},P=Math.round(L.total_loads/x*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"type-info",children:[e.jsx("span",{className:"type-icon",children:M.icon}),e.jsx("span",{className:"type-label",children:M.label})]}),e.jsxs("div",{className:"type-stats",children:[e.jsx("div",{className:"type-bar-container",children:e.jsx("div",{className:"type-bar",style:{width:`${P}%`,backgroundColor:M.color}})}),e.jsx("span",{className:"type-count",children:L.total_loads})]})]},L.load_type)})}),m.length>1&&e.jsxs("div",{className:"disposal-trend",children:[e.jsxs("div",{className:"trend-header",children:[e.jsx(hf,{size:16}),e.jsx("span",{children:"Weekly Trend"})]}),e.jsx("div",{className:"trend-chart",children:m.map((L,M)=>{const P=L.concrete+L.trash+L.metals+L.hazardous_waste,V=Math.max(...m.map(ae=>ae.concrete+ae.trash+ae.metals+ae.hazardous_waste)),J=V>0?P/V*100:0;return e.jsxs("div",{className:"trend-bar-wrapper",children:[e.jsx("div",{className:"trend-bar",style:{height:`${J}%`},title:`Week of ${L.week}: ${P} loads`}),e.jsxs("span",{className:"trend-label",children:["W",M+1]})]},L.week)})})]}),o.length>0&&o[0].days_with_activity&&e.jsxs("div",{className:"disposal-activity-days",children:[e.jsx(kr,{size:14}),e.jsxs("span",{children:[o.reduce((L,M)=>Math.max(L,M.days_with_activity||0),0)," days with disposal activity"]})]})]})}const ky=[{value:"labor",label:"Labor",Icon:Ea,description:"Additional labor costs"},{value:"materials",label:"Materials",Icon:Fn,description:"Materials and supplies"},{value:"equipment",label:"Equipment",Icon:bl,description:"Equipment rental or purchase"},{value:"subcontractor",label:"Subcontractor",Icon:Bs,description:"Subcontractor work"},{value:"disposal",label:"Disposal",Icon:rs,description:"Additional disposal costs"},{value:"other",label:"Other",Icon:df,description:"Miscellaneous costs"}];function Ey({onClose:r,onSave:l,saving:o=!1}){const[i,m]=p.useState({category:"materials",description:"",amount:"",cost_date:new Date().toISOString().split("T")[0],notes:""}),[u,f]=p.useState({}),g=(x,q)=>{m(L=>({...L,[x]:q})),u[x]&&f(L=>({...L,[x]:null}))},j=()=>{const x={};i.description.trim()||(x.description="Description is required");const q=parseFloat(i.amount);return(isNaN(q)||q<=0)&&(x.amount="Enter a valid amount"),i.cost_date||(x.cost_date="Date is required"),f(x),Object.keys(x).length===0},v=x=>{x.preventDefault(),j()&&l(i)};return e.jsx("div",{className:"modal-overlay",onClick:r,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content add-cost-modal",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(Sr,{size:20}),"Add Cost"]}),e.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close",children:e.jsx(Ta,{size:20})})]}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category *"}),e.jsx("div",{className:"category-grid",children:ky.map(x=>{const q=x.Icon,L=i.category===x.value;return e.jsxs("button",{type:"button",className:`category-option ${L?"selected":""}`,onClick:()=>g("category",x.value),children:[e.jsx(q,{size:18}),e.jsx("span",{className:"category-label",children:x.label})]},x.value)})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-description",children:"Description *"}),e.jsx("input",{id:"cost-description",type:"text",value:i.description,onChange:x=>g("description",x.target.value),placeholder:"e.g., Excavator rental - Week 1",className:u.description?"error":""}),u.description&&e.jsx("span",{className:"form-error",children:u.description})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-amount",children:"Amount *"}),e.jsxs("div",{className:"input-with-prefix",children:[e.jsx("span",{className:"input-prefix",children:"$"}),e.jsx("input",{id:"cost-amount",type:"text",inputMode:"decimal",value:i.amount,onChange:x=>{const q=x.target.value.replace(/[^0-9.]/g,"");g("amount",q)},placeholder:"0.00",className:u.amount?"error":""})]}),u.amount&&e.jsx("span",{className:"form-error",children:u.amount})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-date",children:"Date *"}),e.jsx("input",{id:"cost-date",type:"date",value:i.cost_date,onChange:x=>g("cost_date",x.target.value),className:u.cost_date?"error":""}),u.cost_date&&e.jsx("span",{className:"form-error",children:u.cost_date})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-notes",children:"Notes (optional)"}),e.jsx("textarea",{id:"cost-notes",value:i.notes,onChange:x=>g("notes",x.target.value),placeholder:"Additional details...",rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:r,disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?"Saving...":"Add Cost"})]})]})]})})}const $p=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function Dy({project:r,company:l,user:o,isAdmin:i,onShowToast:m}){const[u,f]=p.useState([]),[g,j]=p.useState([]),[v,x]=p.useState(!0),[q,L]=p.useState(!1),[M,P]=p.useState(""),[V,J]=p.useState("Team Member"),[ae,F]=p.useState(null);p.useEffect(()=>{r?.id&&R()},[r?.id]),p.useEffect(()=>{q&&l?.id&&S()},[q,l?.id]);const R=async()=>{try{x(!0);const G=await te.getProjectTeam(r.id);f(G)}catch(G){console.error("Error loading project team:",G)}finally{x(!1)}},S=async()=>{try{const G=await te.getCompanyMembers(l.id),B=u.map(C=>C.users?.id),Z=G.filter(C=>!B.includes(C.users?.id));j(Z)}catch(G){console.error("Error loading company members:",G)}},K=async()=>{if(!M){m("Select a team member","error");return}try{F("add"),await te.addProjectMember(r.id,M,V,o.id),m("Team member added","success"),L(!1),P(""),J("Team Member"),R()}catch(G){console.error("Error adding team member:",G),m("Error adding team member","error")}finally{F(null)}},pe=async(G,B)=>{try{F(G.id),await te.updateProjectMemberRole(r.id,G.users?.id,B),m("Role updated","success"),R()}catch(Z){console.error("Error updating role:",Z),m("Error updating role","error")}finally{F(null)}},$=async G=>{try{F(G.id),await te.removeProjectMember(r.id,G.users?.id),m("Team member removed","success"),R()}catch(B){console.error("Error removing team member:",B),m("Error removing team member","error")}finally{F(null)}};return v?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(Bs,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(Bs,{size:18})," Project Team"]}),i&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>L(!0),children:[e.jsx(qv,{size:14})," Add"]})]}),u.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",i&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:u.map(G=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:G.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:G.users?.email})]}),e.jsx("div",{className:"team-member-role",children:i?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:G.project_role,onChange:B=>pe(G,B.target.value),disabled:ae===G.id,className:"role-select",children:$p.map(B=>e.jsx("option",{value:B,children:B},B))}),e.jsx(ka,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:G.project_role})}),i&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>$(G),disabled:ae===G.id,title:"Remove from project",children:e.jsx(ff,{size:14})})]},G.id))}),q&&e.jsx("div",{className:"modal-overlay",onClick:()=>L(!1),children:e.jsxs("div",{className:"modal-content small",onClick:G=>G.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>L(!1),children:e.jsx(Ta,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:M,onChange:G=>P(G.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),g.map(G=>e.jsx("option",{value:G.users?.id,children:G.users?.name||G.users?.email},G.users?.id))]}),g.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:V,onChange:G=>J(G.target.value),className:"form-select",children:$p.map(G=>e.jsx("option",{value:G,children:G},G))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>L(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:K,disabled:!M||ae==="add",children:ae==="add"?"Adding...":"Add to Project"})]})]})})]})}function My({company:r,user:l,isAdmin:o,onShowToast:i,navigateToProjectId:m,onProjectNavigated:u}){const[f,g]=p.useState([]),[j,v]=p.useState([]),[x,q]=p.useState(null),[L,M]=p.useState([]),[P,V]=p.useState(!0),[J,ae]=p.useState(!1),[F,R]=p.useState(null),[S,K]=p.useState(!1),[pe,$]=p.useState(!1),[G,B]=p.useState(!1),[Z,C]=p.useState("overview"),[b,A]=p.useState([]),[z,de]=p.useState(!1),[N,se]=p.useState(null),[E,xe]=p.useState(!1),[k,U]=p.useState(null),[ie,T]=p.useState(0),[je,I]=p.useState(!1),[ke,ue]=p.useState(!1),Te=p.useRef(null),Be=p.useRef(!1),ze=p.useRef(!1),Oe=p.useCallback((w={})=>{const{refreshAreas:me=!1,refreshCOR:he=!1,projectId:Se=null}=w;me&&Se&&(Be.current=Se),he&&(ze.current=!0),Te.current&&clearTimeout(Te.current),Te.current=setTimeout(async()=>{Be.current&&(await ee(Be.current),Be.current=!1),ze.current&&(T(lt=>lt+1),ze.current=!1),await tt()},150)},[]);p.useEffect(()=>()=>{Te.current&&clearTimeout(Te.current)},[]),p.useEffect(()=>{if(r?.id){tt(),gt();const w=f.map(he=>he.id),me=w.length>0?te.subscribeToCompanyActivity?.(r.id,w,{onMessage:()=>Oe(),onMaterialRequest:()=>Oe(),onTMTicket:()=>Oe(),onInjuryReport:()=>Oe()}):null;return()=>{me&&te.unsubscribe?.(me)}}},[r?.id,f.length,Oe]);const gt=async()=>{try{const w=await te.getDumpSites(r.id);A(w||[])}catch(w){console.error("Error loading dump sites:",w)}};p.useEffect(()=>{if(m&&f.length>0){const w=f.find(me=>me.id===m);w&&(q(w),u?.())}},[m,f]),p.useEffect(()=>{if(x){ee(x.id);const w=[],me=x.id,he=te.subscribeToAreas?.(me,()=>{Oe({refreshAreas:!0,projectId:me})});he&&w.push(he);const Se=te.subscribeToDailyReports?.(me,()=>{Oe()});Se&&w.push(Se);const lt=te.subscribeToCrewCheckins?.(me,()=>{Oe()});lt&&w.push(lt);const ht=te.subscribeToHaulOffs?.(me,()=>{Oe()});ht&&w.push(ht);const it=te.subscribeToCORs?.(me,()=>{Oe({refreshCOR:!0})});return it&&w.push(it),()=>{w.forEach(Et=>te.unsubscribe?.(Et))}}},[x,Oe]);const tt=async()=>{try{const w=await te.getProjects(r?.id);g(w);const me=await Promise.all(w.map(async he=>{try{const[Se,lt,ht,it,Et,at,rt,ha,va]=await Promise.all([te.getAreas(he.id).catch(()=>[]),te.getTMTickets(he.id).catch(()=>[]),te.getChangeOrderTotals(he.id).catch(()=>null),te.getDailyReports(he.id,100).catch(()=>[]),te.getInjuryReports(he.id).catch(()=>[]),te.calculateManDayCosts(he.id,r?.id,he.work_type||"demolition",he.job_type||"standard").catch(()=>null),te.calculateHaulOffCosts(he.id).catch(()=>null),te.getProjectCosts(he.id).catch(()=>[]),te.getCORStats(he.id).catch(()=>null)]),wa=zp(Se),Ve=wa.progress,Ke=ht?.totalApprovedValue||0,ia=he.contract_value+Ke,Jt=wa.isValueBased?wa.earnedValue:Ve/100*ia,ya=lt.filter(ut=>ut.status==="pending").length,Ue=new Date;Ue.setDate(Ue.getDate()-7);const Je=it.filter(ut=>new Date(ut.report_date)>=Ue).length,yt=ha.reduce((ut,Ot)=>{const xs=parseFloat(Ot.amount);return ut+(isNaN(xs)?0:xs)},0),st=at?.totalCost||0,pa=rt?.totalCost||0,ba=st+pa+yt,fa=Jt-ba,_=Jt>0?fa/Jt*100:0,oe=at?.byDate?.length||0,Ce=rt?.daysWithHaulOff||0,ge=Math.max(oe,Ce),nt=st+pa,ct=ge>0?nt/ge:0,He=Qv({...he,progress:Ve},at?.totalManDays||0);return{...he,areas:Se,progress:Ve,billable:Jt,changeOrderValue:Ke,revisedContractValue:ia,changeOrderPending:ht?.pendingCount||0,totalTickets:lt.length,pendingTickets:ya,approvedTickets:lt.filter(ut=>ut.status==="approved").length,dailyReportsCount:it.length,recentDailyReports:Je,injuryReportsCount:Et.length,lastDailyReport:it[0]?.report_date||null,isValueBased:wa.isValueBased,earnedValue:wa.earnedValue,totalSOVValue:wa.totalValue,laborCost:st,laborDaysWorked:oe,laborManDays:at?.totalManDays||0,laborByDate:at?.byDate||[],dailyBurn:ct,haulOffCost:pa,haulOffLoads:rt?.totalLoads||0,haulOffDays:Ce,haulOffByType:rt?.byWasteType||{},haulOffByDate:rt?.byDate||[],customCosts:ha,customCostTotal:yt,totalBurn:nt,totalBurnDays:ge,allCostsTotal:ba,currentProfit:fa,profitMargin:_,corPendingValue:va?.total_pending_value||0,corPendingCount:va?.pending_count||0,corApprovedValue:va?.total_approved_value||0,corBilledValue:va?.total_billed_value||0,corTotalCount:va?.total_cors||0,scheduleStatus:He.scheduleStatus,scheduleVariance:He.scheduleVariance,scheduleLabel:He.scheduleLabel,laborStatus:He.laborStatus,laborVariance:He.laborVariance,laborLabel:He.laborLabel,hasScheduleData:He.hasScheduleData,hasLaborData:He.hasLaborData,actualManDays:at?.totalManDays||0,hasError:!1}}catch(Se){return console.error(`Error loading data for project ${he.id}:`,Se),{...he,areas:[],progress:0,billable:0,changeOrderValue:0,revisedContractValue:he.contract_value,changeOrderPending:0,totalTickets:0,pendingTickets:0,approvedTickets:0,dailyReportsCount:0,recentDailyReports:0,injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corTotalCount:0,hasError:!0}}}));v(me)}catch(w){console.error("Error loading projects:",w),i("Error loading projects","error")}finally{V(!1)}},ee=async w=>{try{const me=await te.getAreas(w);M(me)}catch(me){console.error("Error loading areas:",me)}},Me=w=>{q(w)},Fe=()=>{q(null),M([]),ae(!1),R(null),C("overview"),tt()},pt=()=>{R({name:x.name,job_number:x.job_number||"",address:x.address||"",general_contractor:x.general_contractor||"",client_contact:x.client_contact||"",client_phone:x.client_phone||"",contract_value:x.contract_value,work_type:x.work_type||"demolition",job_type:x.job_type||"standard",pin:x.pin||"",default_dump_site_id:x.default_dump_site_id||"",areas:L.map(w=>({id:w.id,name:w.name,weight:w.weight,isNew:!1}))}),ae(!0)},ma=()=>{ae(!1),R(null)},we=(w,me)=>{R(he=>({...he,[w]:me}))},qe=(w,me,he)=>{R(Se=>({...Se,areas:Se.areas.map((lt,ht)=>ht===w?{...lt,[me]:he}:lt)}))},$e=()=>{R(w=>({...w,areas:[...w.areas,{id:null,name:"",weight:"",isNew:!0}]}))},Xe=w=>{F.areas.length>1&&R(me=>({...me,areas:me.areas.filter((he,Se)=>Se!==w)}))},Ye=async()=>{if(!F.name.trim()){i("Please enter a project name","error");return}const w=parseFloat(F.contract_value);if(!w||w<=0){i("Please enter a valid contract value","error");return}if(F.pin&&F.pin.length!==4){i("PIN must be 4 digits","error");return}if(F.pin&&F.pin!==x.pin&&!await te.isPinAvailable(F.pin,x.id)){i("This PIN is already in use","error");return}const me=F.areas.filter(Se=>Se.name.trim()&&parseFloat(Se.weight)>0);if(me.length===0){i("Please add at least one area","error");return}if(me.reduce((Se,lt)=>Se+parseFloat(lt.weight),0)!==100){i("Area weights must total 100%","error");return}K(!0);try{await te.updateProject(x.id,{name:F.name.trim(),job_number:F.job_number?.trim()||null,address:F.address?.trim()||null,general_contractor:F.general_contractor?.trim()||null,client_contact:F.client_contact?.trim()||null,client_phone:F.client_phone?.trim()||null,contract_value:w,work_type:F.work_type||"demolition",job_type:F.job_type||"standard",pin:F.pin||null,default_dump_site_id:F.default_dump_site_id||null});const Se=L.map(it=>it.id),lt=F.areas.filter(it=>it.id).map(it=>it.id);for(const it of Se)lt.includes(it)||await te.deleteArea(it);for(let it=0;it<me.length;it++){const Et=me[it];Et.id?await te.updateArea(Et.id,{name:Et.name.trim(),weight:parseFloat(Et.weight),sort_order:it}):await te.createArea({project_id:x.id,name:Et.name.trim(),weight:parseFloat(Et.weight),status:"not_started",sort_order:it})}const ht=await te.getProject(x.id);q(ht),await ee(x.id),ae(!1),R(null),i("Project updated!","success")}catch(Se){console.error("Error saving project:",Se?.message||Se),i(Se?.message||"Error saving changes","error")}finally{K(!1)}},Ze=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await te.deleteProject(x.id),i("Project deleted","success"),Fe()}catch(w){console.error("Error deleting project:",w),i("Error deleting project","error")}},De=p.useMemo(()=>x?j.find(w=>w.id===x.id):null,[x,j]),vt=p.useMemo(()=>{if(!x)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const w=zp(L),me=w.progress,he=De?.changeOrderValue||0,Se=x.contract_value+he,lt=w.isValueBased?w.earnedValue:me/100*Se;return{progress:me,billable:lt,changeOrderValue:he,revisedContractValue:Se,isValueBased:w.isValueBased,earnedValue:w.earnedValue,totalSOVValue:w.totalValue}},[x,L,De]),wt=p.useMemo(()=>{const w=j.reduce((at,rt)=>at+(rt.contract_value||0),0),me=j.reduce((at,rt)=>at+(rt.changeOrderValue||0),0),he=w+me,Se=j.reduce((at,rt)=>at+(rt.billable||0),0),lt=he-Se,ht=he>0?Math.round(Se/he*100):0,it=j.reduce((at,rt)=>at+(rt.corPendingValue||0),0),Et=j.reduce((at,rt)=>at+(rt.corPendingCount||0),0);return{totalOriginalContract:w,totalChangeOrders:me,totalPortfolioValue:he,totalEarned:Se,totalRemaining:lt,weightedCompletion:ht,totalPendingCORValue:it,totalPendingCORCount:Et}},[j]),Zt=p.useMemo(()=>{let w=0,me=0,he=0,Se=0,lt=0;for(const ht of j){const it=ht.revisedContractValue||ht.contract_value;ht.progress>=100&&w++,ht.progress<100&&ht.billable<=it*(ht.progress/100)*1.1&&me++,ht.billable>it*.9&&ht.progress<90&&he++,ht.billable>it&&Se++,(ht.changeOrderValue||0)>0&&lt++}return{projectsComplete:w,projectsOnTrack:me,projectsAtRisk:he,projectsOverBudget:Se,projectsWithChangeOrders:lt}},[j]),ta=p.useMemo(()=>{let w=0,me=0,he=0,Se=0,lt=0,ht=0;for(const it of j)it.hasScheduleData&&(it.scheduleStatus==="ahead"?w++:it.scheduleStatus==="behind"?he++:me++),it.hasLaborData&&(it.laborStatus==="over"?Se++:it.laborStatus==="under"?lt++:ht++);return{scheduleAhead:w,scheduleOnTrack:me,scheduleBehind:he,laborOver:Se,laborUnder:lt,laborOnTrack:ht,hasAnyScheduleData:w+me+he>0,hasAnyLaborData:Se+lt+ht>0}},[j]);p.useEffect(()=>{const w=async()=>{for(const me of j)if(Xv(me,30)){console.log(`Auto-archiving completed project: ${me.name}`);try{await te.archiveProject(me.id),i(`Project "${me.name}" has been auto-archived after 30 days of completion`,"info")}catch(he){console.error("Failed to auto-archive project:",he)}}};j.length>0&&w()},[]);const{totalOriginalContract:Nt,totalChangeOrders:Pt,totalPortfolioValue:X,totalEarned:O,totalRemaining:be,weightedCompletion:Ee,totalPendingCORValue:ne,totalPendingCORCount:Ae}=wt,{projectsComplete:ot,projectsOnTrack:We,projectsAtRisk:Qt,projectsOverBudget:Lt,projectsWithChangeOrders:Dt}=Zt,{scheduleAhead:Mt,scheduleOnTrack:$t,scheduleBehind:It,laborOver:la,laborUnder:Ne,laborOnTrack:kt,hasAnyScheduleData:ft,hasAnyLaborData:ja}=ta;if(P)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(x){const{progress:w,billable:me,changeOrderValue:he,revisedContractValue:Se,isValueBased:lt,earnedValue:ht,totalSOVValue:it}=vt;if(J&&F){const Ve=F.areas.reduce((Ke,ia)=>Ke+(parseFloat(ia.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:ma,style:{marginBottom:"1.5rem"},children:" Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:F.name,onChange:Ke=>we("name",Ke.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:F.job_number,onChange:Ke=>we("job_number",Ke.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:F.address,onChange:Ke=>we("address",Ke.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:F.general_contractor,onChange:Ke=>we("general_contractor",Ke.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:F.client_contact,onChange:Ke=>we("client_contact",Ke.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:F.client_phone,onChange:Ke=>we("client_phone",Ke.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:F.contract_value,onChange:Ke=>we("contract_value",Ke.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:F.pin,onChange:Ke=>we("pin",Ke.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:F.work_type,onChange:Ke=>we("work_type",Ke.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:F.job_type,onChange:Ke=>we("job_type",Ke.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:F.default_dump_site_id,onChange:Ke=>we("default_dump_site_id",Ke.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),b.map(Ke=>e.jsx("option",{value:Ke.id,children:Ke.name},Ke.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),F.areas.map((Ke,ia)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:Ke.name,onChange:Jt=>qe(ia,"name",Jt.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:Ke.weight,onChange:Jt=>qe(ia,"weight",Jt.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>Xe(ia),children:""})]},ia)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Ve===100?"valid":"invalid"}`,children:[Ve,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:$e,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:Ye,disabled:S,style:{flex:1},children:S?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:Ze,children:"Delete Project"})]})}const Et=L.filter(Ve=>Ve.status==="done").length,at=L.filter(Ve=>Ve.status==="working").length,rt=L.filter(Ve=>Ve.status==="not_started").length,ha=Se>0?Math.round(me/Se*100):0,va=he>0,wa=[{id:"overview",label:"Overview",Icon:Tp},{id:"financials",label:"Financials",Icon:Sr},{id:"reports",label:"Reports",Icon:as},{id:"info",label:"Info",Icon:_d}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:Fe,children:[e.jsx("span",{children:""}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>$(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>B(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:pt,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:x.name}),(x.job_number||x.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[x.job_number&&`Job #${x.job_number}`,x.job_number&&x.work_type&&"  ",x.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[w,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:Vt(me)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:Vt(Se-me)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:wa.map(Ve=>e.jsxs("button",{className:`pv-tab ${Z===Ve.id?"active":""}`,onClick:()=>C(Ve.id),children:[e.jsx(Ve.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:Ve.label})]},Ve.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[Z==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab",children:[e.jsx("div",{className:"overview-hero",children:e.jsxs("div",{className:"overview-hero-grid",children:[e.jsxs("div",{className:"overview-metric primary",children:[e.jsxs("div",{className:"overview-metric-value",children:[w,"%"]}),e.jsx("div",{className:"overview-metric-label",children:"Complete"}),e.jsx("div",{className:"overview-metric-bar",children:e.jsx("div",{className:"overview-metric-fill",style:{width:`${w}%`}})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsxs("div",{className:"overview-metric-value",children:[Et,"/",L.length]}),e.jsx("div",{className:"overview-metric-label",children:"Areas Done"}),e.jsx("div",{className:"overview-metric-detail",children:at>0&&e.jsxs("span",{className:"working",children:[at," active"]})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value",children:Vt(Se)}),e.jsx("div",{className:"overview-metric-label",children:"Contract"}),va&&e.jsxs("div",{className:"overview-metric-detail green",children:["+",Vt(he)," COs"]})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value green",children:Vt(me)}),e.jsx("div",{className:"overview-metric-label",children:"Earned"}),e.jsx("div",{className:"overview-metric-detail",children:lt?e.jsxs("span",{children:["of ",Vt(it)," SOV"]}):e.jsxs("span",{children:[ha,"% billed"]})})]})]})}),(De?.pendingTickets>0||De?.changeOrderPending>0)&&e.jsxs("div",{className:"overview-attention-card",children:[e.jsxs("div",{className:"attention-header",children:[e.jsx("h3",{children:"Needs Attention"}),e.jsxs("span",{className:"attention-count",children:[(De?.pendingTickets||0)+(De?.changeOrderPending||0)," items"]})]}),e.jsxs("div",{className:"attention-items",children:[De?.pendingTickets>0&&e.jsxs("div",{className:"attention-item",onClick:()=>C("financials"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(as,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[De.pendingTickets," T&M ticket",De.pendingTickets!==1?"s":""," awaiting approval"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]}),De?.changeOrderPending>0&&e.jsxs("div",{className:"attention-item",onClick:()=>C("financials"),children:[e.jsx("div",{className:"attention-item-icon info",children:e.jsx(Ma,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[De.changeOrderPending," change order",De.changeOrderPending!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]})]})]}),e.jsxs("div",{className:"overview-section-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[Et>0&&e.jsxs("span",{className:"section-badge done",children:[Et," Complete"]}),at>0&&e.jsxs("span",{className:"section-badge working",children:[at," Active"]}),rt>0&&e.jsxs("span",{className:"section-badge pending",children:[rt," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list",children:L.map(Ve=>e.jsxs("div",{className:`work-area-item ${Ve.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[Ve.status==="done"&&e.jsx("span",{className:"status-icon done",children:""}),Ve.status==="working"&&e.jsx("span",{className:"status-icon working",children:""}),Ve.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:""})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:Ve.name}),e.jsx("span",{className:"work-area-weight",children:Ve.scheduled_value?Vt(Ve.scheduled_value):`${Ve.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${Ve.status}`,style:{width:Ve.status==="done"?"100%":Ve.status==="working"?"50%":"0%"}})})]},Ve.id))})]}),e.jsxs("div",{className:"overview-stats-row",children:[e.jsxs("div",{className:"quick-stat-card",onClick:()=>C("reports"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(as,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:De?.dailyReportsCount||0}),e.jsx("span",{className:"quick-stat-label",children:"Daily Reports"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>C("financials"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(Sr,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:De?.totalTickets||0}),e.jsx("span",{className:"quick-stat-label",children:"T&M Tickets"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]})]})]}),Z==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsx("div",{className:"financials-hero",children:e.jsxs("div",{className:"financials-hero-grid",children:[e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Contract"}),e.jsx("div",{className:"fin-metric-value",children:Vt(Se)}),va&&e.jsxs("div",{className:"fin-metric-detail green",children:["+",Vt(he)," COs"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Earned"}),e.jsx("div",{className:"fin-metric-value",children:Vt(me)}),e.jsx("div",{className:"fin-metric-bar",children:e.jsx("div",{className:"fin-metric-fill",style:{width:`${ha}%`}})})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Costs"}),e.jsx("div",{className:"fin-metric-value",children:Vt(De?.allCostsTotal||0)}),me>0&&e.jsxs("div",{className:`fin-metric-detail ${(De?.allCostsTotal||0)/me>.6?"warning":""}`,children:[Math.round((De?.allCostsTotal||0)/me*100),"% of revenue"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Profit"}),e.jsx("div",{className:`fin-metric-value ${(De?.currentProfit||0)<0?"negative":"positive"}`,children:Vt(De?.currentProfit||0)}),e.jsxs("div",{className:`fin-metric-detail ${(De?.profitMargin||0)<20?"warning":""}`,children:[Math.round(De?.profitMargin||0),"% margin"]})]})]})}),e.jsxs("div",{className:"financials-analysis-row",children:[e.jsx(_y,{dailyBurn:De?.dailyBurn||0,totalBurn:De?.totalBurn||0,daysWorked:De?.totalBurnDays||0,laborCost:De?.laborCost||0,haulOffCost:De?.haulOffCost||0,progress:w,contractValue:Se,laborByDate:De?.laborByDate||[],haulOffByDate:De?.haulOffByDate||[]}),e.jsx(Sy,{revenue:me,totalCosts:De?.allCostsTotal||0,contractValue:Se,progress:w}),e.jsx(wy,{project:x,period:"week"})]}),e.jsx(Ny,{laborCost:De?.laborCost||0,haulOffCost:De?.haulOffCost||0,customCosts:De?.customCosts||[],onAddCost:()=>I(!0),onDeleteCost:async Ve=>{try{await te.deleteProjectCost(Ve),tt(),i("Cost deleted","success")}catch{i("Error deleting cost","error")}}}),e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(fy,{project:x,company:r,areas:L,refreshKey:ie,onShowToast:i,onCreateCOR:()=>{se(null),de(!0)},onViewCOR:Ve=>{U(Ve),xe(!0)},onEditCOR:Ve=>{se(Ve),de(!0)}})}),e.jsxs("div",{className:"financials-section tm-section",children:[e.jsxs("div",{className:"tm-section-header",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("span",{className:"tm-badge",children:[De?.totalTickets||0," total",De?.pendingTickets>0&&`  ${De.pendingTickets} pending`]})]}),e.jsx(ry,{project:x,company:r,onShowToast:i,compact:!0})]}),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(Ea,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:Vt(De?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(my,{project:x,company:r,onShowToast:i})})]})]}),Z==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(as,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:De?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:De?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((De?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:`reports-metric ${(De?.injuryReportsCount||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"reports-metric-value",children:De?.injuryReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Injuries"}),e.jsx("div",{className:"reports-metric-status",children:(De?.injuryReportsCount||0)===0?"No incidents":"Review required"})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value small",children:De?.lastDailyReport?new Date(De.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"None"}),e.jsx("div",{className:"reports-metric-label",children:"Last Filed"}),De?.lastDailyReport&&e.jsxs("div",{className:"reports-metric-detail",children:[Math.floor((new Date-new Date(De.lastDailyReport))/(1e3*60*60*24))," days ago"]})]})]})}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(as,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[De?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(uy,{project:x,company:r,onShowToast:i})})]}),e.jsxs("div",{className:`reports-section-card ${(De?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(De?.injuryReportsCount||0)>0?"warning":"success"}`,children:(De?.injuryReportsCount||0)>0?"":""}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(De?.injuryReportsCount||0)>0?"warning":"success"}`,children:(De?.injuryReportsCount||0)>0?`${De.injuryReportsCount} incident${De.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(cy,{project:x,companyId:r?.id||x?.company_id,company:r,onShowToast:i})})]})]}),Z==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:x.name}),x.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",x.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:pt,children:e.jsx("span",{children:"Edit Project"})})]}),x.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(Ij,{size:14}),e.jsx("span",{children:x.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Ea,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:x.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Ma,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:x.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Sr,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:Vt(Se)}),e.jsx("span",{className:"info-quick-label",children:he>0?`Incl. +${Vt(he)} COs`:"Contract Value"})]})]}),x.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:x.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Hi,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[x.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:x.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),x.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:x.client_contact})]}),x.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(ov,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${x.client_phone}`,className:"info-detail-value link",children:x.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Tp,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[Et>0&&e.jsxs("span",{className:"info-badge done",children:[Et," Done"]}),at>0&&e.jsxs("span",{className:"info-badge working",children:[at," Active"]}),rt>0&&e.jsxs("span",{className:"info-badge pending",children:[rt," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:L.map(Ve=>e.jsxs("div",{className:`info-area-item ${Ve.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[Ve.status==="done"&&e.jsx("span",{className:"status-dot done",children:""}),Ve.status==="working"&&e.jsx("span",{className:"status-dot working",children:""}),Ve.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:""})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:Ve.name}),e.jsx("span",{className:`info-area-status-label ${Ve.status}`,children:Ve.status==="done"?"Complete":Ve.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[Ve.weight,"%"]})]},Ve.id))})]}),e.jsx(Dy,{project:x,company:r,user:l,isAdmin:o,onShowToast:i}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(_d,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:Vt(x.contract_value)})]}),he>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",Vt(he)]})]}),x.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:b.find(Ve=>Ve.id===x.default_dump_site_id)?.name||"Unknown"})]})]})]})]})]}),pe&&e.jsx(ly,{project:x,onClose:()=>$(!1),onShareCreated:Ve=>{i("Share link created successfully!","success")}}),G&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(oy,{project:x,company:r,onShowToast:i,onClose:()=>B(!1)})}),z&&e.jsx(xy,{project:x,company:r,areas:L,existingCOR:N,onClose:()=>{de(!1),se(null)},onSaved:()=>{de(!1),se(null),T(Ve=>Ve+1)},onShowToast:i}),E&&k&&e.jsx(yy,{cor:k,project:x,company:r,areas:L,onClose:()=>{xe(!1),U(null)},onEdit:Ve=>{xe(!1),U(null),se(Ve),de(!0)},onShowToast:i,onStatusChange:()=>{}}),je&&e.jsx(Ey,{onClose:()=>I(!1),saving:ke,onSave:async Ve=>{try{ue(!0),await te.addProjectCost(x.id,r.id,Ve),I(!1),tt(),i("Cost added successfully","success")}catch(Ke){console.error("Error adding cost:",Ke),i("Error adding cost","error")}finally{ue(!1)}}})]})}return f.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(as,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("div",{className:"bo-project-count",children:[f.length," Active Project",f.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(Ee,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Vt(O)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Vt(X)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:Vt(be)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Pt>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:Vt(Nt)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",Dt," project",Dt!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",Vt(Pt)]})]})]}),Ae>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:Vt(ne)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",Ae," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[ot>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:ot}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),We>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:We}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Qt>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:Qt}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),Lt>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:Lt}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),ft&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[Mt>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:Mt}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),$t>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:$t}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),It>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:It}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),ja&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),Ne>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[Ne," under"]}),kt>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[kt," on track"]}),la>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[la," over"]})]})]})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[f.length," active"]})]}),e.jsx("div",{className:"project-list",children:j.map(w=>e.jsx(Ty,{project:w,onClick:()=>Me(w)},w.id))})]})}function Ty({project:r,onClick:l}){const o=gf(r.areas||[]),i=Pv(r.areas||[]),m=r.contract_value-r.billable,u=r.billable>r.contract_value*.9&&r.progress<90;return e.jsxs("div",{className:`project-card enhanced ${u?"at-risk":""}`,onClick:l,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:r.name}),e.jsx("div",{className:"project-card-value",children:Vt(r.contract_value)})]}),e.jsx("span",{className:`status-badge ${o}`,children:i})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[r.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:Vt(r.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${m<0?"negative":""}`,children:Vt(Math.abs(m))}),e.jsx("span",{className:"stat-label",children:m>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${r.progress}%`}})}),(r.pendingTickets>0||r.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[r.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[r.pendingTickets," Pending T&M"]}),r.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[r.approvedTickets," Approved T&M"]})]}),r.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${r.scheduleStatus}`,children:r.scheduleLabel}),r.hasLaborData&&r.laborLabel&&e.jsx("span",{className:`labor-indicator ${r.laborStatus}`,children:r.laborLabel})]})]})}const hd=r=>{if(r==null||r==="")return"";const l=parseFloat(r);return isNaN(l)?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)},Vp=r=>{if(!r)return null;const l=String(r).replace(/[$,\s]/g,""),o=parseFloat(l);return isNaN(o)?null:o};function Ay({company:r,user:l,onProjectCreated:o,onShowToast:i}){const[m,u]=p.useState(""),[f,g]=p.useState(""),[j,v]=p.useState(""),[x,q]=p.useState(""),[L,M]=p.useState(""),[P,V]=p.useState(""),[J,ae]=p.useState("demolition"),[F,R]=p.useState("standard"),[S,K]=p.useState([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),[pe,$]=p.useState(!1),[G,B]=p.useState(!1),[Z,C]=p.useState(!1),[b,A]=p.useState([]),[z,de]=p.useState(!1),[N,se]=p.useState(""),[E,xe]=p.useState(""),[k,U]=p.useState(""),ie=p.useRef(null),T=S.reduce((we,qe)=>we+(parseFloat(qe.weight)||0),0),je=we=>{const qe=we.replace(/\D/g,"").slice(0,4);V(qe)},I=()=>{const we=Math.floor(1e3+Math.random()*9e3).toString();V(we)},ke=(we,qe,$e)=>{K(Xe=>Xe.map((Ye,Ze)=>Ze===we?{...Ye,[qe]:$e}:Ye))},ue=()=>{K(we=>[...we,{name:"",weight:"",group:"",scheduledValue:null}])},Te=we=>{S.length>1&&K(qe=>qe.filter(($e,Xe)=>Xe!==we))},Be=(we="value")=>{const qe=S.filter(De=>De.name.trim());if(qe.length===0){i("Add tasks first","error");return}let $e=[...S];const Xe=S.map((De,vt)=>De.name.trim()?vt:-1).filter(De=>De>=0);if(we==="value"){const De=qe.reduce((vt,wt)=>vt+(parseFloat(wt.scheduledValue)||0),0);if(De===0)i("No scheduled values - using equal distribution","info"),we="equal";else{let vt=0;Xe.forEach((wt,Zt)=>{const ta=parseFloat(S[wt].scheduledValue)||0;let Nt;Zt===Xe.length-1?Nt=100-vt:(Nt=Math.round(ta/De*1e4)/100,vt+=Nt),$e[wt]={...$e[wt],weight:Nt.toFixed(2)}}),K($e),de(!1),i("Weights calculated by value","success");return}}const Ye=Math.round(100/Xe.length*100)/100;let Ze=0;Xe.forEach((De,vt)=>{let wt;vt===Xe.length-1?wt=100-Ze:(wt=Ye,Ze+=wt),$e[De]={...$e[De],weight:wt.toFixed(2)}}),K($e),de(!1),i("Weights distributed equally","success")},ze=()=>{u(""),g(""),v(""),q(""),M(""),V(""),ae("demolition"),R("standard"),se(""),xe(""),U(""),K([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),C(!1),A([])},Oe=()=>{ie.current?.click()},gt=we=>new Promise((qe,$e)=>{const Xe=new FileReader;Xe.onload=Ye=>{try{const Ze=new Uint8Array(Ye.target.result),De=Tx(Ze,{type:"array"}),vt=De.SheetNames[0],wt=De.Sheets[vt],Zt=hn.sheet_to_json(wt,{header:1}),ta=[];let Nt="General";const Pt=/^\$?\d{1,3}(,\d{3})*(\.\d{2})?$/,X=/^(\d+\.?\d*|[A-Z]\.?\d*)$/i,O=/^(SF|LF|EA|LS|Days?|MD|Load|CY|SY|GAL|TON)$/i,be=/^\d{1,3}(,\d{3})*$|^\d+$/,Ee=/^(Item|#|No\.?|Description|Scheduled|Value|Amount|Quantity|Unit|Total|Application|Balance|Completed|Stored|Retainage)/i;for(const ot of Zt){if(!ot||ot.length===0)continue;const We=ot.map(kt=>kt==null?"":String(kt).trim()).filter(kt=>kt.length>0);if(We.length===0)continue;const Qt=We.join(" ");if(Ee.test(We[0])||We.length>1&&Ee.test(We[1])||/^(Total|Subtotal|Grand Total|Base Bid|Contract Sum)/i.test(Qt))continue;const Lt=We.some(kt=>Pt.test(kt.replace(/[$,]/g,"")+(kt.includes(".")?"":".00")));if((!Lt&&We.length<=3&&/^(L\d|Level|Floor|\d+(?:st|nd|rd|th)|Plaza|Street|Basement|Roof|Penthouse|Site|Exterior|Interior|Misc|MEP|ABATEMENT|DEMOLITION|UNIVERSAL|SOFT|TRASH|DEMO|Phase|Division|Section|Area|Building|Wing)/i.test(We[0])||We.length===2&&X.test(We[0])&&!Lt&&!/^\d+\.\d+$/.test(We[0]))&&!Lt){Nt=(We.find(ft=>!X.test(ft)&&ft.length>1)||We.join(" ")).replace(/\s*\(\d{1,3}(?:,\d{3})*\s*SF\)\s*$/i,"").replace(/\s*[-:]\s*$/,"").trim();continue}let Mt="",$t=!1,It="",la=null;const Ne=[];for(let kt=0;kt<We.length;kt++){const ft=We[kt];if(kt===0&&X.test(ft)){It=ft;continue}if(!/^ID-\d+$/i.test(ft)&&!/^KN\s*\d+$/i.test(ft)){if(Pt.test(ft.replace(/[$,]/g,"")+(ft.includes(".")?"":".00"))||/^\$/.test(ft)){const ja=ft.replace(/[$,]/g,""),w=parseFloat(ja);!isNaN(w)&&w>100&&(la===null||w>la)&&(la=w),$t=!0;continue}if(be.test(ft.replace(/,/g,""))){$t=!0;continue}O.test(ft)||/^\d+\.?\d*%$/.test(ft)||ft.length>1&&!X.test(ft)&&Ne.push(ft)}}Mt=Ne.join(" ").trim(),Mt=Mt.replace(/\s+/g," ").replace(/^[-]\s*/,"").trim(),!(Mt.length<3)&&(/^(Plan|Page|Total|Base Bid|Payment|Condition|Exclusion|Subtotal)/i.test(Mt)||$t&&Mt.length>=3&&ta.push({name:Mt,group:Nt,itemNumber:It,scheduledValue:la,selected:!0}))}const ne=new Set,Ae=ta.filter(ot=>{const We=`${ot.group}:${ot.name}`;return ne.has(We)?!1:(ne.add(We),!0)});qe(Ae)}catch(Ze){$e(Ze)}},Xe.onerror=()=>$e(new Error("Failed to read file")),Xe.readAsArrayBuffer(we)}),tt=async we=>{const qe=we.target.files?.[0];if(!qe)return;const $e=qe.name.split(".").pop().toLowerCase();if(!["xlsx","xls","csv"].includes($e)){i("Please upload an Excel file (.xlsx, .xls, or .csv)","error");return}B(!0);try{const Xe=await gt(qe);if(Xe.length===0){i("No tasks found. Check Excel format.","error"),B(!1);return}A(Xe),C(!0),i(`Found ${Xe.length} tasks`,"success")}catch(Xe){console.error("Excel import error:",Xe),i("Error reading Excel file","error")}finally{B(!1),ie.current&&(ie.current.value="")}},ee=we=>{A(qe=>qe.map(($e,Xe)=>Xe===we?{...$e,selected:!$e.selected}:$e))},Me=()=>{const we=b.filter(Ye=>Ye.selected);if(we.length===0){i("Please select at least one task","error");return}const qe=we.reduce((Ye,Ze)=>Ye+(Ze.scheduledValue||0),0),$e=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});let Xe;if(qe>0){let Ye=0;Xe=we.map((Ze,De)=>{const vt=Ze.scheduledValue||0;let wt;return De===we.length-1?wt=100-Ye:(wt=Math.round(vt/qe*1e4)/100,Ye+=wt),{name:Ze.name,weight:wt.toFixed(2),group:Ze.group,scheduledValue:Ze.scheduledValue||null}}),i(`Tasks imported with value-based weights! Total SOV: ${$e.format(qe)}`,"success")}else{const Ye=Math.round(100/we.length*100)/100;Xe=we.map((Ze,De)=>({name:Ze.name,weight:De===we.length-1?(100-Ye*(we.length-1)).toFixed(2):Ye.toFixed(2),group:Ze.group,scheduledValue:Ze.scheduledValue||null})),i("Tasks imported with equal weights","success")}K(Xe),C(!1)},Fe=async()=>{if(!r?.id){i("No company selected. Please log in again.","error");return}if(!m.trim()){i("Please enter a project name","error");return}const we=parseFloat(L);if(!we||we<=0){i("Please enter a valid contract value","error");return}if(P.length!==4){i("Please enter a 4-digit PIN","error");return}if(!await te.isPinAvailable(P)){i("This PIN is already in use. Try another.","error");return}const $e=S.filter(Xe=>Xe.name.trim()&&parseFloat(Xe.weight)>0);if($e.length===0){i("Please add at least one area","error");return}if(Math.abs(T-100)>.1){i("Area weights must total 100%","error");return}if(!N||!E){i("Start date and end date are required","error");return}if(new Date(E)<new Date(N)){i("End date must be on or after start date","error");return}$(!0);try{const Xe=await te.createProject({name:m.trim(),job_number:f.trim()||null,address:j.trim()||null,general_contractor:x.trim()||null,contract_value:we,pin:P,work_type:J,job_type:F,company_id:r?.id,created_by:l?.id,start_date:N,end_date:E,planned_man_days:k?parseInt(k):null});for(let Ye=0;Ye<$e.length;Ye++)await te.createArea({project_id:Xe.id,name:$e[Ye].name.trim(),weight:parseFloat($e[Ye].weight),scheduled_value:$e[Ye].scheduledValue||null,group_name:$e[Ye].group||null,status:"not_started",sort_order:Ye});i("Project created!","success"),ze(),o()}catch(Xe){console.error("Error creating project:",Xe),i("Error creating project","error")}finally{$(!1)}};if(Z){const we=[...new Set(b.map(Ye=>Ye.group))],qe=b.filter(Ye=>Ye.selected).length,$e=b.reduce((Ye,Ze)=>Ye+(Ze.scheduledValue||0),0),Xe=b.filter(Ye=>Ye.selected).reduce((Ye,Ze)=>Ye+(Ze.scheduledValue||0),0);return e.jsxs("div",{children:[e.jsx("h1",{children:"Review Imported Tasks"}),e.jsx("p",{className:"subtitle",children:"Select the tasks to include in your project"}),e.jsxs("div",{className:"import-summary",children:[e.jsxs("span",{children:[qe," of ",b.length," tasks selected"]}),$e>0&&e.jsxs("span",{className:"import-sov-total",children:[" Total SOV: ",new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(Xe)]})]}),we.map(Ye=>{const Ze=b.filter(vt=>vt.group===Ye),De=Ze.filter(vt=>vt.selected).length;return e.jsxs("div",{className:"card import-group",children:[e.jsxs("div",{className:"import-group-header",children:[e.jsx("h3",{children:Ye}),e.jsxs("span",{className:"import-group-count",children:[De,"/",Ze.length]})]}),e.jsx("div",{className:"import-task-list",children:Ze.map(vt=>{const wt=b.indexOf(vt);return e.jsxs("label",{className:"import-task-item",children:[e.jsx("input",{type:"checkbox",checked:vt.selected,onChange:()=>ee(wt)}),e.jsx("span",{className:"import-task-name",children:vt.name}),vt.scheduledValue>0&&e.jsx("span",{className:"import-task-value",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(vt.scheduledValue)})]},wt)})})]},Ye)}),e.jsxs("div",{className:"import-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>C(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:Me,children:["Use Selected Tasks (",qe,")"]})]})]})}const pt=S.reduce((we,qe,$e)=>{const Xe=qe.group||"General";return we[Xe]||(we[Xe]=[]),we[Xe].push({...qe,originalIndex:$e}),we},{}),ma=Object.keys(pt).length>1||Object.keys(pt).length===1&&!pt.General;return e.jsxs("div",{children:[e.jsx("h1",{children:"New Project"}),e.jsx("p",{className:"subtitle",children:"Set up a new project to track"}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Name"}),e.jsx("input",{type:"text",placeholder:"e.g., Sunrise Apartments",value:m,onChange:we=>u(we.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",placeholder:"e.g., 4032",value:f,onChange:we=>g(we.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($)"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"e.g., 365000",value:L,onChange:we=>{const qe=we.target.value.replace(/[^0-9.]/g,"");M(qe)},className:"currency-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",placeholder:"e.g., 123 Main St, Los Angeles, CA 90001",value:j,onChange:we=>v(we.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",placeholder:"e.g., ABC Construction Inc.",value:x,onChange:we=>q(we.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Start Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:N,onChange:we=>se(we.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["End Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:E,onChange:we=>xe(we.target.value),min:N||void 0,required:!0}),N&&E&&new Date(E)<new Date(N)&&e.jsx("span",{className:"error-text",children:"End date must be after start date"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Planned Man-Days ",e.jsx("span",{className:"optional",children:"(optional)"})]}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Total estimated man-days to complete the project"}),e.jsx("input",{type:"number",inputMode:"numeric",placeholder:"e.g., 120",value:k,onChange:we=>U(we.target.value.replace(/\D/g,"")),min:"1"})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${J==="demolition"?"active":""}`,onClick:()=>ae("demolition"),children:"Demolition"}),e.jsx("button",{type:"button",className:`toggle-btn ${J==="abatement"?"active":""}`,onClick:()=>ae("abatement"),children:"Abatement"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${F==="standard"?"active":""}`,onClick:()=>R("standard"),children:"Standard"}),e.jsx("button",{type:"button",className:`toggle-btn ${F==="pla"?"active":""}`,onClick:()=>R("pla"),children:"PLA"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN (4 digits)"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Foremen will enter this PIN to access this project"}),e.jsxs("div",{className:"pin-input-row",children:[e.jsx("input",{type:"text",placeholder:"e.g., 2847",value:P,onChange:we=>je(we.target.value),maxLength:4,className:"pin-input"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:I,children:"Generate"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"areas-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Areas / Tasks"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginTop:"0.25rem"},children:"Define the areas for this project. Weights must total 100%."})]}),e.jsxs("div",{className:"import-btn-container",children:[e.jsx("input",{ref:ie,type:"file",accept:".xlsx,.xls,.csv",onChange:tt,style:{display:"none"}}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Oe,disabled:G,children:G?"Reading...":" Import Excel"})]})]}),ma?Object.entries(pt).map(([we,qe])=>e.jsxs("div",{className:"area-group",children:[e.jsx("div",{className:"area-group-header",children:we}),qe.map($e=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Task name",value:$e.name,onChange:Xe=>ke($e.originalIndex,"name",Xe.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:$e.scheduledValue?hd($e.scheduledValue):"",onChange:Xe=>ke($e.originalIndex,"scheduledValue",Vp(Xe.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:$e.weight,onChange:Xe=>ke($e.originalIndex,"weight",Xe.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>Te($e.originalIndex),children:""})]},$e.originalIndex))]},we)):S.map((we,qe)=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Area name (e.g., Level 1)",value:we.name,onChange:$e=>ke(qe,"name",$e.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:we.scheduledValue?hd(we.scheduledValue):"",onChange:$e=>ke(qe,"scheduledValue",Vp($e.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:we.weight,onChange:$e=>ke(qe,"weight",$e.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>Te(qe),children:""})]},qe)),e.jsxs("div",{className:"weight-total-row",children:[e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Math.abs(T-100)<.1?"valid":"invalid"}`,children:[T.toFixed(1),"%"]}),S.some(we=>we.scheduledValue>0)&&e.jsxs("span",{className:"sov-total",children:[" SOV: ",hd(S.reduce((we,qe)=>we+(parseFloat(qe.scheduledValue)||0),0))]})]}),e.jsxs("div",{className:"auto-weight-dropdown",children:[e.jsx("button",{type:"button",className:"btn btn-secondary btn-small",onClick:()=>de(!z),children:"Auto-Calculate "}),z&&e.jsxs("div",{className:"weight-dropdown-menu",children:[e.jsxs("button",{onClick:()=>Be("value"),children:["By Value ",e.jsx("span",{className:"dropdown-hint",children:"(Recommended)"})]}),e.jsx("button",{onClick:()=>Be("equal"),children:"Equal Distribution"})]})]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:ue,children:"+ Add Area"})]}),e.jsx("button",{className:"btn btn-primary btn-full",onClick:Fe,disabled:pe,children:pe?"Creating...":"Create Project"})]})}function zy({company:r,onShowToast:l}){const{branding:o,updateBranding:i,uploadBrandingImage:m,loading:u}=wr(),[f,g]=p.useState(!1),[j,v]=p.useState(!1),[x,q]=p.useState(o),[L,M]=p.useState(""),[P,V]=p.useState(!1),J=p.useRef(null),ae=p.useRef(null),F=p.useRef(null);p.useEffect(()=>{r?.id&&R()},[r?.id]);const R=async()=>{try{const{data:z,error:de}=await D.from("companies").select("office_code").eq("id",r.id).single();!de&&z?.office_code&&M(z.office_code)}catch(z){console.error("Error loading office code:",z)}},S=async()=>{if(confirm("Regenerate office code? Current code will stop working immediately.")){V(!0);try{const z=Math.random().toString(36).substring(2,8).toUpperCase(),{error:de}=await D.from("companies").update({office_code:z}).eq("id",r.id);if(de)throw de;M(z),l?.("Office code regenerated","success")}catch(z){console.error("Error regenerating code:",z),l?.("Error regenerating code","error")}finally{V(!1)}}},K=()=>{navigator.clipboard.writeText(L),l?.("Office code copied to clipboard","success")},pe=r?.subscription_tier||"free",$=["pro","business","enterprise"].includes(pe),G=["business","enterprise"].includes(pe),B=pe==="enterprise",Z=(z,de)=>{q(N=>({...N,[z]:de}))},C=async(z,de)=>{if(z){if(z.size>5*1024*1024){l?.("Image must be smaller than 5MB","error");return}if(!z.type.startsWith("image/")){l?.("Please upload an image file","error");return}try{const N=await m(z,de);N.success?(Z(`${de}_url`,N.url),l?.(`${de.charAt(0).toUpperCase()+de.slice(1)} uploaded successfully`,"success")):l?.(N.error||"Failed to upload image","error")}catch(N){console.error("Upload error:",N),l?.("Failed to upload image","error")}}},b=async()=>{try{g(!0);const z=/^#[0-9A-F]{6}$/i;if(!z.test(x.primary_color)){l?.("Primary color must be a valid hex color (e.g., #3B82F6)","error");return}if(!z.test(x.secondary_color)){l?.("Secondary color must be a valid hex color (e.g., #1E40AF)","error");return}const de=await i(x);de.success?l?.("Branding settings saved successfully!","success"):l?.(de.error||"Failed to save branding settings","error")}catch(z){console.error("Save error:",z),l?.("Failed to save branding settings","error")}finally{g(!1)}},A=()=>{j?(document.documentElement.style.setProperty("--primary-color",o.primary_color),document.documentElement.style.setProperty("--secondary-color",o.secondary_color),document.title=o.custom_app_name||"FieldSync"):(document.documentElement.style.setProperty("--primary-color",x.primary_color),document.documentElement.style.setProperty("--secondary-color",x.secondary_color),document.title=x.custom_app_name||"FieldSync"),v(!j)};return u?e.jsxs("div",{className:"settings-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading branding settings..."})]}):e.jsxs("div",{className:"branding-settings",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("h2",{children:" Branding Settings"}),pe==="free"&&e.jsx("div",{className:"tier-badge tier-free",children:"Free Plan - Upgrade for branding options"}),pe==="pro"&&e.jsx("div",{className:"tier-badge tier-pro",children:"Pro Plan"}),pe==="business"&&e.jsx("div",{className:"tier-badge tier-business",children:"Business Plan"}),pe==="enterprise"&&e.jsx("div",{className:"tier-badge tier-enterprise",children:"Enterprise Plan"})]}),e.jsxs("div",{className:"settings-section security-section",children:[e.jsx("h3",{children:"Security"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Office Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Share this code with office staff only. Required to create new office accounts."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:L||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:K,disabled:!L,children:"Copy"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:S,disabled:P,children:P?"...":"Regenerate"})]}),e.jsx("p",{className:"help-text",style:{marginTop:"0.5rem",color:"var(--accent-amber)"},children:"Field workers should NOT have this code - they use project PINs only."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Company Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Public code for employees to find your company."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:r?.code||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:()=>{navigator.clipboard.writeText(r?.code||""),l?.("Company code copied","success")},disabled:!r?.code,children:"Copy"})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Visual Identity"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Logo"}),$?e.jsxs(e.Fragment,{children:[x.logo_url&&e.jsx("div",{className:"logo-preview",children:e.jsx("img",{src:x.logo_url,alt:"Logo preview"})}),e.jsx("input",{ref:J,type:"file",accept:"image/*",style:{display:"none"},onChange:z=>C(z.target.files[0],"logo")}),e.jsx("button",{className:"btn-secondary",onClick:()=>J.current?.click(),children:x.logo_url?"Change Logo":"Upload Logo"}),e.jsx("p",{className:"help-text",children:"Recommended: 200x60px, PNG with transparent background"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your logo"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"app-name",children:"App Name"}),$?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"app-name",type:"text",className:"input",value:x.custom_app_name||"",onChange:z=>Z("custom_app_name",z.target.value),placeholder:"FieldSync",maxLength:50}),e.jsx("p",{className:"help-text",children:"This name appears in the browser tab and throughout the app"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your app name"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"primary-color",children:"Primary Color"}),$?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"primary-color",type:"color",value:x.primary_color||"#3B82F6",onChange:z=>Z("primary_color",z.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:x.primary_color||"#3B82F6",onChange:z=>Z("primary_color",z.target.value),placeholder:"#3B82F6",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"secondary-color",children:"Secondary Color"}),$?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"secondary-color",type:"color",value:x.secondary_color||"#1E40AF",onChange:z=>Z("secondary_color",z.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:x.secondary_color||"#1E40AF",onChange:z=>Z("secondary_color",z.target.value),placeholder:"#1E40AF",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Favicon"}),$?e.jsxs(e.Fragment,{children:[x.favicon_url&&e.jsx("div",{className:"favicon-preview",children:e.jsx("img",{src:x.favicon_url,alt:"Favicon preview"})}),e.jsx("input",{ref:ae,type:"file",accept:"image/*",style:{display:"none"},onChange:z=>C(z.target.files[0],"favicon")}),e.jsx("button",{className:"btn-secondary",onClick:()=>ae.current?.click(),children:x.favicon_url?"Change Favicon":"Upload Favicon"}),e.jsx("p",{className:"help-text",children:"Recommended: 32x32px or 64x64px, PNG or ICO format"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your favicon"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Login Background"}),G?e.jsxs(e.Fragment,{children:[x.login_background_url&&e.jsx("div",{className:"background-preview",children:e.jsx("img",{src:x.login_background_url,alt:"Background preview"})}),e.jsx("input",{ref:F,type:"file",accept:"image/*",style:{display:"none"},onChange:z=>C(z.target.files[0],"login_background")}),e.jsx("button",{className:"btn-secondary",onClick:()=>F.current?.click(),children:x.login_background_url?"Change Background":"Upload Background"}),e.jsx("p",{className:"help-text",children:"Recommended: 1920x1080px, JPG or PNG"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Business or Enterprise to customize login background"})})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"White-Label Options"}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:x.hide_fieldsync_branding||!1,onChange:z=>Z("hide_fieldsync_branding",z.target.checked),disabled:!G}),e.jsx("span",{children:'Hide "Powered by FieldSync"'})]}),!G&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Email Branding"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-name",children:"From Name"}),e.jsx("input",{id:"email-from-name",type:"text",className:"input",value:x.email_from_name||"",onChange:z=>Z("email_from_name",z.target.value),placeholder:"Your Company Name",disabled:!G}),!G&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-address",children:"From Email"}),e.jsx("input",{id:"email-from-address",type:"email",className:"input",value:x.email_from_address||"",onChange:z=>Z("email_from_address",z.target.value),placeholder:"noreply@yourcompany.com",disabled:!G}),!G&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Custom Domain"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"custom-domain",children:"Domain"}),B?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"custom-domain",type:"text",className:"input",value:x.custom_domain||"",onChange:z=>Z("custom_domain",z.target.value),placeholder:"app.yourcompany.com"}),x.custom_domain&&e.jsx("div",{className:`domain-status ${x.domain_verified?"verified":"pending"}`,children:x.domain_verified?e.jsx(e.Fragment,{children:" Connected"}):e.jsx(e.Fragment,{children:" DNS setup required"})}),e.jsx("p",{className:"help-text",children:"Contact support to configure DNS and SSL certificate for your custom domain"})]}):e.jsxs("div",{className:"upgrade-notice",children:[e.jsx("p",{children:" Enterprise plan required for custom domain support"}),e.jsx("p",{className:"help-text",children:"Custom domains allow you to host the app at your own URL (e.g., app.yourcompany.com)"})]})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:A,children:j?"Exit Preview":"Preview Changes"}),e.jsx("button",{className:"btn-primary",onClick:b,disabled:f||!$,children:f?"Saving...":"Save Changes"})]}),j&&e.jsx("div",{className:"preview-banner",children:"Preview Mode Active - Your changes are not yet saved"})]})}const pd=["foreman","operator","laborer"],fd=["demolition","abatement"],gd=["standard","pla"];function Oy({company:r,onShowToast:l}){const[o,i]=p.useState({}),[m,u]=p.useState(!1),[f,g]=p.useState(!1),[j,v]=p.useState("demolition"),[x,q]=p.useState(!0);p.useEffect(()=>{r?.id&&M()},[r?.id]);const L=()=>{const R={};return fd.forEach(S=>{R[S]={},gd.forEach(K=>{R[S][K]={},pd.forEach(pe=>{R[S][K][pe]={regular:"",overtime:""}})})}),R},M=async()=>{if(!Y){i(L()),q(!1);return}const R=L();try{const{data:S,error:K}=await D.from("labor_rates").select("*").eq("company_id",r.id);if(K){i(R),q(!1);return}S&&S.length>0&&S.forEach(pe=>{R[pe.work_type]&&R[pe.work_type][pe.job_type]&&R[pe.work_type][pe.job_type][pe.role]&&(R[pe.work_type][pe.job_type][pe.role]={regular:pe.regular_rate||"",overtime:pe.overtime_rate||""})}),i(R)}catch(S){console.error("Error loading labor rates:",S),i(R)}finally{q(!1)}},P=async()=>{if(!Y){l("Labor rates require database connection","error");return}g(!0);try{await D.from("labor_rates").delete().eq("company_id",r.id);const R=[];fd.forEach(K=>{gd.forEach(pe=>{pd.forEach($=>{const G=o[K]?.[pe]?.[$]||{regular:0,overtime:0};R.push({company_id:r.id,role:$,work_type:K,job_type:pe,regular_rate:parseFloat(G.regular)||0,overtime_rate:parseFloat(G.overtime)||0})})})});const{error:S}=await D.from("labor_rates").insert(R);if(S)throw S;l("Labor rates saved","success"),u(!1)}catch(R){console.error("Error saving labor rates:",R),l("Error saving rates: "+(R.message||"Unknown error"),"error")}finally{g(!1)}},V=(R,S,K,pe,$)=>{i(G=>({...G,[R]:{...G[R],[S]:{...G[R]?.[S],[K]:{...G[R]?.[S]?.[K],[pe]:$}}}}))},J=R=>R.charAt(0).toUpperCase()+R.slice(1),ae=R=>R.charAt(0).toUpperCase()+R.slice(1),F=R=>R==="pla"?"PLA (Prevailing Wage)":"Standard (Private)";return x?e.jsx("div",{className:"loading",children:"Loading labor rates..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"pricing-section-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Labor Rates"}),e.jsx("p",{className:"section-desc",children:"Configure hourly rates by role, work type, and job classification"})]}),m?e.jsxs("div",{className:"rate-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>{u(!1),M()},children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:P,disabled:f,children:f?"Saving...":"Save All Rates"})]}):e.jsx("button",{className:"btn btn-primary",onClick:()=>u(!0),children:"Edit Rates"})]}),e.jsx("div",{className:"work-type-tabs",children:fd.map(R=>e.jsx("button",{className:`work-type-tab ${j===R?"active":""}`,onClick:()=>v(R),children:ae(R)},R))}),e.jsx("div",{className:"labor-rates-container",children:gd.map(R=>e.jsxs("div",{className:"job-type-section",children:[e.jsx("h3",{className:"job-type-header",children:F(R)}),e.jsxs("div",{className:"rates-table",children:[e.jsxs("div",{className:"rates-table-header",children:[e.jsx("div",{className:"rate-cell role-cell",children:"Role"}),e.jsx("div",{className:"rate-cell",children:"Regular"}),e.jsx("div",{className:"rate-cell",children:"Overtime"})]}),pd.map(S=>{const K=o[j]?.[R]?.[S]||{regular:"",overtime:""};return e.jsxs("div",{className:"rates-table-row",children:[e.jsx("div",{className:"rate-cell role-cell",children:J(S)}),e.jsx("div",{className:"rate-cell",children:m?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",value:K.regular,onChange:pe=>V(j,R,S,"regular",pe.target.value.replace(/[^0-9.]/g,"")),placeholder:"0"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value",children:["$",parseFloat(K.regular)||0,"/hr"]})}),e.jsx("div",{className:"rate-cell",children:m?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",value:K.overtime,onChange:pe=>V(j,R,S,"overtime",pe.target.value.replace(/[^0-9.]/g,"")),placeholder:"0"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value ot",children:["$",parseFloat(K.overtime)||0,"/hr"]})})]},S)})]})]},R))})]})}const Ui=["Containment","PPE","Disposal","Equipment"];function Ry({company:r,onShowToast:l}){const[o,i]=p.useState([]),[m,u]=p.useState(!0),[f,g]=p.useState("all"),[j,v]=p.useState(null),[x,q]=p.useState(!1),[L,M]=p.useState({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),[P,V]=p.useState([]),[J,ae]=p.useState(!1);p.useEffect(()=>{r?.id&&F()},[r?.id]);const F=async()=>{u(!0);try{const C=await te.getAllMaterialsEquipment(r.id);i(C||[]),R(C||[])}catch(C){console.error("Error loading items:",C),l("Error loading materials","error")}finally{u(!1)}},R=C=>{const b={},A=[];C.filter(de=>de.active!==!1).forEach(de=>{const N=de.name.toLowerCase().trim();b[N]||(b[N]=[]),b[N].push(de)}),Object.entries(b).forEach(([de,N])=>{N.length>1&&A.push({name:de,items:N})}),V(A)},S=async C=>{try{const b=C.items.filter(de=>de.cost_per_unit>0),A=b.length>0?b[0]:C.items[0],z=C.items.filter(de=>de.id!==A.id);for(const de of z)await te.deleteMaterialEquipment(de.id);l(`Merged ${C.items.length} items into one`,"success"),F()}catch(b){console.error("Error merging duplicates:",b),l("Error merging duplicates","error")}},K=async()=>{if(confirm(`Merge all ${P.length} duplicate groups?`))try{for(const C of P){const b=C.items.filter(de=>de.cost_per_unit>0),A=b.length>0?b[0]:C.items[0],z=C.items.filter(de=>de.id!==A.id);for(const de of z)await te.deleteMaterialEquipment(de.id)}l("All duplicates merged!","success"),F(),ae(!1)}catch(C){console.error("Error merging all duplicates:",C),l("Error merging duplicates","error")}},pe=async()=>{if(!L.name.trim()){l("Enter item name","error");return}try{await te.createMaterialEquipment({company_id:r.id,name:L.name.trim(),category:L.category,unit:L.unit||"each",cost_per_unit:parseFloat(L.cost_per_unit)||0,active:!0}),l("Item added","success"),M({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),q(!1),F()}catch(C){console.error("Error adding item:",C),l("Error adding item","error")}},$=async C=>{try{await te.updateMaterialEquipment(C.id,{name:C.name,category:C.category,unit:C.unit,cost_per_unit:parseFloat(C.cost_per_unit)||0}),l("Item updated","success"),v(null),F()}catch(b){console.error("Error updating item:",b),l("Error updating item","error")}},G=async C=>{if(confirm("Delete this item?"))try{await te.deleteMaterialEquipment(C),l("Item deleted","success"),F()}catch(b){console.error("Error deleting item:",b),l("Error deleting item","error")}},B=f==="all"?o.filter(C=>C.active!==!1):o.filter(C=>C.category===f&&C.active!==!1),Z=B.reduce((C,b)=>{const A=b.category||"Other";return C[A]||(C[A]=[]),C[A].push(b),C},{});return m?e.jsx("div",{className:"loading",children:"Loading materials..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"materials-header",children:[e.jsxs("div",{className:"materials-title",children:[e.jsx("h2",{children:"Materials & Equipment"}),e.jsxs("span",{className:"materials-count",children:[o.filter(C=>C.active!==!1).length," items"]})]}),e.jsxs("div",{className:"materials-actions",children:[P.length>0&&e.jsxs("button",{className:`btn btn-warning ${J?"active":""}`,onClick:()=>ae(!J),children:[P.length," Duplicates"]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>q(!0),children:"+ Add Item"})]})]}),J&&P.length>0&&e.jsxs("div",{className:"duplicates-panel",children:[e.jsxs("div",{className:"duplicates-header",children:[e.jsx("h3",{children:"Duplicate Items Found"}),e.jsxs("button",{className:"btn btn-success btn-small",onClick:K,children:["Merge All (",P.length,")"]})]}),e.jsx("div",{className:"duplicates-list",children:P.map((C,b)=>e.jsxs("div",{className:"duplicate-group",children:[e.jsxs("div",{className:"duplicate-name",children:['"',C.name,'" x ',C.items.length]}),e.jsx("div",{className:"duplicate-items",children:C.items.map(A=>e.jsxs("span",{className:"duplicate-item",children:[A.category," - $",A.cost_per_unit||0]},A.id))}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>S(C),children:"Merge"})]},b))})]}),x&&e.jsxs("div",{className:"add-item-form",children:[e.jsx("h3",{children:"Add New Item"}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Item Name",value:L.name,onChange:C=>M({...L,name:C.target.value}),autoFocus:!0}),e.jsx("select",{value:L.category,onChange:C=>M({...L,category:C.target.value}),children:Ui.map(C=>e.jsx("option",{value:C,children:C},C))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Unit (e.g., each, day, hour)",value:L.unit,onChange:C=>M({...L,unit:C.target.value})}),e.jsxs("div",{className:"dollar-input-wrapper",children:[e.jsx("span",{className:"dollar-prefix",children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",className:"dollar-input",placeholder:"Cost per unit",value:L.cost_per_unit,onChange:C=>{const b=C.target.value.replace(/[^0-9.]/g,"");M({...L,cost_per_unit:b})}})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>q(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:pe,children:"Add Item"})]})]}),e.jsxs("div",{className:"materials-filter",children:[e.jsx("button",{className:`filter-tab ${f==="all"?"active":""}`,onClick:()=>g("all"),children:"All"}),Ui.map(C=>e.jsxs("button",{className:`filter-tab ${f===C?"active":""}`,onClick:()=>g(C),children:[C,e.jsx("span",{className:"filter-count",children:o.filter(b=>b.category===C&&b.active!==!1).length})]},C))]}),e.jsxs("div",{className:"materials-list",children:[f==="all"?Object.entries(Z).map(([C,b])=>e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:C}),e.jsx("div",{className:"category-items",children:b.map(A=>e.jsx(Gp,{item:A,editingItem:j,setEditingItem:v,handleUpdateItem:$,handleDeleteItem:G,categories:Ui},A.id))})]},C)):e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:f}),e.jsx("div",{className:"category-items",children:B.map(C=>e.jsx(Gp,{item:C,editingItem:j,setEditingItem:v,handleUpdateItem:$,handleDeleteItem:G,categories:Ui},C.id))})]}),B.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No items in this category"})})]})]})}function Gp({item:r,editingItem:l,setEditingItem:o,handleUpdateItem:i,handleDeleteItem:m,categories:u}){return l?.id===r.id?e.jsx("div",{className:"material-item",children:e.jsxs("div",{className:"item-edit-form",children:[e.jsx("input",{type:"text",value:l.name,onChange:f=>o({...l,name:f.target.value})}),e.jsx("select",{value:l.category,onChange:f=>o({...l,category:f.target.value}),children:u.map(f=>e.jsx("option",{value:f,children:f},f))}),e.jsx("input",{type:"text",value:l.unit,onChange:f=>o({...l,unit:f.target.value}),placeholder:"Unit"}),e.jsxs("div",{className:"dollar-input-wrapper compact",children:[e.jsx("span",{className:"dollar-prefix",children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",className:"dollar-input",value:l.cost_per_unit,onChange:f=>{const g=f.target.value.replace(/[^0-9.]/g,"");o({...l,cost_per_unit:g})},placeholder:"Cost"})]}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>i(l),children:"Save"}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>o(null),children:"Cancel"})]})]})}):e.jsxs("div",{className:"material-item",children:[e.jsxs("div",{className:"item-info",children:[e.jsx("span",{className:"item-name",children:r.name}),e.jsx("span",{className:"item-unit",children:r.unit||"each"})]}),e.jsxs("div",{className:"item-cost",children:["$",(r.cost_per_unit||0).toFixed(2)]}),e.jsxs("div",{className:"item-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>o({...r}),title:"Edit",children:e.jsx(Dd,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:()=>m(r.id),title:"Delete",children:e.jsx(Us,{size:16})})]})]})}const qy=[{id:"trash",label:"Trash",description:"General debris"},{id:"metal",label:"Metal",description:"Scrap metal (recyclable)"},{id:"copper",label:"Copper",description:"Copper scrap (recyclable)"},{id:"concrete",label:"Concrete",description:"Concrete/masonry"},{id:"hazardous",label:"Hazardous",description:"Hazardous materials"}];function Ly({company:r,onShowToast:l}){const[o,i]=p.useState([]),[m,u]=p.useState(!0),[f,g]=p.useState(!1),[j,v]=p.useState(null),[x,q]=p.useState({name:"",address:"",notes:""}),[L,M]=p.useState(!1),[P,V]=p.useState({}),J=p.useRef({});p.useEffect(()=>{r?.id&&ae()},[r?.id]),p.useEffect(()=>()=>{Object.values(J.current).forEach(B=>clearTimeout(B))},[]);const ae=async()=>{u(!0);try{const B=await te.getDumpSites(r.id);i(B||[])}catch(B){console.error("Error loading dump sites:",B),l("Error loading dump sites","error")}finally{u(!1)}},F=async()=>{if(!x.name.trim()){l("Please enter a site name","error");return}M(!0);try{await te.createDumpSite(r.id,x.name,x.address,x.notes),l("Dump site added","success"),q({name:"",address:"",notes:""}),g(!1),ae()}catch(B){console.error("Error adding dump site:",B),l("Error adding dump site","error")}finally{M(!1)}},R=async()=>{if(!j?.name.trim()){l("Please enter a site name","error");return}M(!0);try{await te.updateDumpSite(j.id,{name:j.name,address:j.address,notes:j.notes}),l("Dump site updated","success"),v(null),ae()}catch(B){console.error("Error updating dump site:",B),l("Error updating dump site","error")}finally{M(!1)}},S=async B=>{if(confirm("Are you sure you want to delete this dump site?"))try{await te.deleteDumpSite(B),l("Dump site deleted","success"),ae()}catch(Z){console.error("Error deleting dump site:",Z),l("Error deleting dump site","error")}},K=p.useCallback(async(B,Z,C)=>{try{await te.setDumpSiteRate(B,Z,C),i(b=>b.map(A=>{if(A.id===B){const z=[...A.dump_site_rates||[]],de=z.findIndex(N=>N.waste_type===Z);return de>=0?z[de]={...z[de],estimated_cost_per_load:C}:z.push({waste_type:Z,estimated_cost_per_load:C}),{...A,dump_site_rates:z}}return A})),V(b=>{const A={...b};return delete A[`${B}-${Z}`],A})}catch(b){console.error("Error saving rate:",b?.message||b),l("Error saving rate","error")}},[l]),pe=(B,Z,C)=>{const b=`${B}-${Z}`;V(A=>({...A,[b]:C})),J.current[b]&&clearTimeout(J.current[b]),J.current[b]=setTimeout(()=>{const A=parseFloat(C)||0;K(B,Z,A)},500)},$=(B,Z)=>{const C=`${B.id}-${Z}`;return P[C]!==void 0?P[C]:B.dump_site_rates?.find(A=>A.waste_type===Z)?.estimated_cost_per_load??""},G=B=>{if(B===""||B===null||B===void 0)return"";const Z=parseFloat(B);return Z<0?`-$${Math.abs(Z).toFixed(0)}`:`$${Z.toFixed(0)}`};return m?e.jsx("div",{className:"loading",children:"Loading dump sites..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"dump-site-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Disposal & Haul-Off"}),e.jsx("p",{className:"section-desc",children:"Configure dump sites and estimated costs per load for each waste type. Use negative values for recyclables (metal, copper) to indicate revenue."})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>g(!0),children:"+ Add Dump Site"})]}),f&&e.jsxs("div",{className:"dump-site-form card",children:[e.jsx("h4",{children:"Add Dump Site"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:x.name,onChange:B=>q({...x,name:B.target.value}),placeholder:"e.g., Metro Landfill"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:x.address,onChange:B=>q({...x,address:B.target.value}),placeholder:"123 Main St, City"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:x.notes,onChange:B=>q({...x,notes:B.target.value}),placeholder:"Operating hours, contact, etc."})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>g(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:F,disabled:L,children:L?"Adding...":"Add Site"})]})]}),o.length===0?e.jsxs("div",{className:"dump-site-empty",children:[e.jsx("p",{children:"No dump sites configured yet."}),e.jsx("p",{children:"Add a dump site to start tracking haul-off costs."})]}):e.jsx("div",{className:"dump-sites-list",children:o.map(B=>e.jsxs("div",{className:"dump-site-card card",children:[j?.id===B.id?e.jsxs("div",{className:"dump-site-edit",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:j.name,onChange:Z=>v({...j,name:Z.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:j.address||"",onChange:Z=>v({...j,address:Z.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:j.notes||"",onChange:Z=>v({...j,notes:Z.target.value})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>v(null),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:R,disabled:L,children:L?"Saving...":"Save"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dump-site-info",children:[e.jsx("div",{className:"dump-site-name",children:B.name}),B.address&&e.jsx("div",{className:"dump-site-address",children:B.address}),B.notes&&e.jsx("div",{className:"dump-site-notes",children:B.notes})]}),e.jsxs("div",{className:"dump-site-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>v({...B}),title:"Edit",children:e.jsx(Dd,{size:16})}),e.jsx("button",{className:"btn-icon",onClick:()=>S(B.id),title:"Delete",children:e.jsx(Us,{size:16})})]})]}),e.jsxs("div",{className:"dump-site-rates",children:[e.jsx("div",{className:"rates-header",children:"Estimated Cost per Load"}),e.jsx("div",{className:"rates-grid",children:qy.map(Z=>e.jsxs("div",{className:"rate-item",children:[e.jsxs("label",{children:[e.jsx("span",{className:"rate-label",children:Z.label}),e.jsx("span",{className:"rate-desc",children:Z.description})]}),e.jsxs("div",{className:"rate-input-wrapper",children:[e.jsx("span",{className:"rate-prefix",children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",className:"rate-input",value:$(B,Z.id),onChange:C=>{const b=C.target.value.replace(/[^0-9.-]/g,"");pe(B.id,Z.id,b)},placeholder:"0"})]}),$(B,Z.id)!==""&&e.jsxs("span",{className:`rate-preview ${parseFloat($(B,Z.id))<0?"revenue":"cost"}`,children:[G($(B,Z.id)),"/load"]})]},Z.id))}),e.jsx("div",{className:"rates-note",children:"Tip: Use negative values for recyclables that generate revenue (e.g., -50 for metal)"})]})]},B.id))})]})}const Uy=[{id:"labor",label:"Labor Rates",Icon:Ea},{id:"materials",label:"Materials & Equipment",Icon:bl},{id:"disposal",label:"Disposal & Haul-Off",Icon:rs}];function Hy({company:r,onShowToast:l}){const[o,i]=p.useState("labor");return e.jsxs("div",{className:"pricing-manager",children:[e.jsxs("div",{className:"pricing-header",children:[e.jsx("h1",{children:"Pricing Configuration"}),e.jsx("p",{className:"pricing-subtitle",children:"Set up labor rates, materials pricing, and disposal costs"})]}),e.jsx("div",{className:"pricing-tabs",children:Uy.map(m=>e.jsxs("button",{className:`pricing-tab ${o===m.id?"active":""}`,onClick:()=>i(m.id),children:[e.jsx(m.Icon,{size:18,className:"pricing-tab-icon"}),e.jsx("span",{className:"pricing-tab-label",children:m.label})]},m.id))}),e.jsxs("div",{className:"pricing-content",children:[o==="labor"&&e.jsx(Oy,{company:r,onShowToast:l}),o==="materials"&&e.jsx(Ry,{company:r,onShowToast:l}),o==="disposal"&&e.jsx(Ly,{company:r,onShowToast:l})]})]})}function By({shareToken:r}){const[l,o]=p.useState(!0),[i,m]=p.useState(null),[u,f]=p.useState(null),[g,j]=p.useState(0),{branding:v}=wr();p.useEffect(()=>{x()},[r]);const x=async()=>{o(!0),m(null);try{const S=await te.getPublicProjectData(r);if(!S){m("This share link is invalid or has expired.");return}f(S)}catch(S){console.error("Error loading public data:",S),m("Failed to load project data.")}finally{o(!1)}},q=S=>S?new Date(S).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",L=S=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(S);if(l)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading project..."})]}),e.jsx("style",{children:xd})]});if(i)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx(yl,{size:48})}),e.jsx("h2",{children:i}),e.jsx("p",{children:"Please contact the project owner for a valid link."})]}),e.jsx("style",{children:xd})]});const{share:M,project:P,progress:V,areas:J,photos:ae,dailyReports:F,tmTickets:R}=u;return e.jsxs("div",{className:"public-view",children:[e.jsx("header",{className:"public-header",children:e.jsxs("div",{className:"container",children:[e.jsx(ds,{size:"large"}),e.jsx("div",{className:"header-meta",children:e.jsxs("span",{className:"last-updated",children:["Last updated: ",q(P.updated_at||P.created_at)]})})]})}),e.jsx("main",{className:"public-main",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"project-header",children:[e.jsx("h1",{children:P.name}),P.address&&e.jsx("p",{className:"project-address",children:P.address})]}),M.permissions.progress&&e.jsxs("div",{className:"public-card progress-card",children:[e.jsx("h2",{children:"Project Progress"}),e.jsxs("div",{className:"progress-visual",children:[e.jsxs("div",{className:"progress-circle",children:[e.jsxs("svg",{viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"var(--primary-color, #3b82f6)",strokeWidth:"8",strokeDasharray:`${V*2.827} 282.7`,strokeLinecap:"round",transform:"rotate(-90 50 50)"})]}),e.jsxs("div",{className:"progress-percentage",children:[V,"%"]})]}),e.jsxs("div",{className:"progress-details",children:[e.jsx("div",{className:"progress-label",children:"Complete"}),J&&J.length>0&&e.jsxs("div",{className:"areas-summary",children:[J.filter(S=>S.status==="done").length," of ",J.length," areas completed"]})]})]}),J&&J.length>0&&e.jsxs("div",{className:"areas-list",children:[e.jsx("h3",{children:"Work Areas"}),J.map(S=>e.jsxs("div",{className:"area-item",children:[e.jsxs("div",{className:"area-info",children:[e.jsx("span",{className:"area-name",children:S.name}),e.jsxs("span",{className:"area-weight",children:[S.weight,"%"]})]}),e.jsx("div",{className:`area-status status-${S.status}`,children:S.status==="done"?" Complete":S.status==="working"?" In Progress":" Not Started"})]},S.id))]})]}),M.permissions.photos&&ae&&ae.length>0&&e.jsxs("div",{className:"public-card photos-card",children:[e.jsx("h2",{children:"Recent Photos"}),e.jsxs("div",{className:"photos-carousel",children:[e.jsxs("div",{className:"carousel-main",children:[ae[g]&&e.jsx("img",{src:ae[g].url,alt:`Project photo from ${q(ae[g].date)}`,className:"carousel-image"}),e.jsx("div",{className:"carousel-date",children:q(ae[g]?.date)})]}),e.jsx("div",{className:"carousel-thumbnails",children:ae.slice(0,10).map((S,K)=>e.jsx("div",{className:`thumbnail ${K===g?"active":""}`,onClick:()=>j(K),children:e.jsx("img",{src:S.url,alt:`Thumbnail ${K+1}`})},K))}),ae.length>1&&e.jsxs("div",{className:"carousel-controls",children:[e.jsx("button",{onClick:()=>j(S=>S>0?S-1:ae.length-1),className:"carousel-btn",children:""}),e.jsxs("span",{className:"carousel-counter",children:[g+1," / ",ae.length]}),e.jsx("button",{onClick:()=>j(S=>S<ae.length-1?S+1:0),className:"carousel-btn",children:""})]})]})]}),M.permissions.daily_reports&&F&&F.length>0&&e.jsxs("div",{className:"public-card reports-card",children:[e.jsx("h2",{children:"Daily Reports"}),e.jsx("div",{className:"reports-list",children:F.map((S,K)=>e.jsxs("div",{className:"report-item",children:[e.jsx("div",{className:"report-date",children:q(S.report_date)}),e.jsxs("div",{className:"report-content",children:[S.crew_count&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Crew:"})," ",S.crew_count," workers"]}),S.tasks_completed&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Tasks Completed:"})," ",S.tasks_completed]}),S.weather&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Weather:"})," ",S.weather]}),S.notes&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Notes:"})," ",S.notes]})]})]},K))})]}),M.permissions.tm_tickets&&R&&R.length>0&&e.jsxs("div",{className:"public-card tm-card",children:[e.jsx("h2",{children:"Time & Materials Tickets"}),e.jsx("div",{className:"tm-list",children:R.map((S,K)=>e.jsxs("div",{className:"tm-item",children:[e.jsxs("div",{className:"tm-header",children:[e.jsx("span",{className:"tm-date",children:q(S.work_date)}),e.jsx("span",{className:`tm-status status-${S.status}`,children:S.status})]}),S.description&&e.jsx("div",{className:"tm-description",children:S.description}),S.total_amount&&e.jsxs("div",{className:"tm-amount",children:["Total: ",L(S.total_amount)]})]},K))})]})]})}),e.jsx("footer",{className:"public-footer",children:e.jsx("div",{className:"container",children:!v?.hide_fieldsync_branding&&e.jsx("p",{children:"Powered by FieldSync"})})}),e.jsx("style",{children:xd})]})}const xd=`
  .public-view {
    min-height: 100vh;
    background-color: #f9fafb;
    display: flex;
    flex-direction: column;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 1rem;
    width: 100%;
  }

  /* Header */
  .public-header {
    background-color: white;
    border-bottom: 1px solid #e5e7eb;
    padding: 1.5rem 0;
  }

  .public-header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header-meta {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Main Content */
  .public-main {
    flex: 1;
    padding: 2rem 0;
  }

  .project-header {
    margin-bottom: 2rem;
  }

  .project-header h1 {
    font-size: 2rem;
    margin: 0 0 0.5rem 0;
    color: #111827;
  }

  .project-address {
    font-size: 1rem;
    color: #6b7280;
    margin: 0;
  }

  /* Cards */
  .public-card {
    background-color: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .public-card h2 {
    font-size: 1.5rem;
    margin: 0 0 1.5rem 0;
    color: #111827;
  }

  .public-card h3 {
    font-size: 1.125rem;
    margin: 1.5rem 0 1rem 0;
    color: #374151;
  }

  /* Progress Card */
  .progress-visual {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .progress-circle {
    position: relative;
    width: 150px;
    height: 150px;
    flex-shrink: 0;
  }

  .progress-circle svg {
    width: 100%;
    height: 100%;
  }

  .progress-percentage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary-color, #3b82f6);
  }

  .progress-details {
    flex: 1;
  }

  .progress-label {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.5rem;
  }

  .areas-summary {
    font-size: 1rem;
    color: #6b7280;
  }

  /* Areas List */
  .areas-list {
    border-top: 1px solid #e5e7eb;
    padding-top: 1rem;
  }

  .area-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f3f4f6;
  }

  .area-item:last-child {
    border-bottom: none;
  }

  .area-info {
    flex: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-right: 1rem;
  }

  .area-name {
    font-weight: 500;
    color: #374151;
  }

  .area-weight {
    color: #6b7280;
    font-size: 0.875rem;
  }

  .area-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
  }

  .area-status.status-done {
    background-color: #d1fae5;
    color: #065f46;
  }

  .area-status.status-working {
    background-color: #fef3c7;
    color: #92400e;
  }

  .area-status.status-not_started {
    background-color: #f3f4f6;
    color: #6b7280;
  }

  /* Photos Carousel */
  .photos-carousel {
    position: relative;
  }

  .carousel-main {
    position: relative;
    width: 100%;
    height: 400px;
    background-color: #111827;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .carousel-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .carousel-date {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
    color: white;
    padding: 1rem;
    text-align: center;
  }

  .carousel-thumbnails {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
  }

  .thumbnail {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s;
  }

  .thumbnail:hover {
    border-color: #d1d5db;
  }

  .thumbnail.active {
    border-color: var(--primary-color, #3b82f6);
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .carousel-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
  }

  .carousel-btn {
    background-color: white;
    border: 1px solid #d1d5db;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.25rem;
    transition: background-color 0.2s;
  }

  .carousel-btn:hover {
    background-color: #f3f4f6;
  }

  .carousel-counter {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Daily Reports */
  .reports-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .report-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .report-date {
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.75rem;
    font-size: 1.125rem;
  }

  .report-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .report-field {
    color: #374151;
    line-height: 1.5;
  }

  .report-field strong {
    color: #111827;
  }

  /* T&M Tickets */
  .tm-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .tm-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .tm-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .tm-date {
    font-weight: 600;
    color: #111827;
  }

  .tm-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: capitalize;
  }

  .tm-status.status-approved {
    background-color: #d1fae5;
    color: #065f46;
  }

  .tm-status.status-pending {
    background-color: #fef3c7;
    color: #92400e;
  }

  .tm-status.status-rejected {
    background-color: #fee2e2;
    color: #991b1b;
  }

  .tm-description {
    color: #374151;
    margin-bottom: 0.5rem;
  }

  .tm-amount {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--primary-color, #3b82f6);
  }

  /* Footer */
  .public-footer {
    background-color: white;
    border-top: 1px solid #e5e7eb;
    padding: 2rem 0;
    margin-top: auto;
  }

  .public-footer p {
    text-align: center;
    color: #6b7280;
    margin: 0;
    font-size: 0.875rem;
  }

  /* Loading & Error States */
  .loading-container,
  .error-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 2rem;
  }

  .spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #e5e7eb;
    border-top-color: var(--primary-color, #3b82f6);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .loading-container p {
    margin-top: 1rem;
    color: #6b7280;
  }

  .error-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .error-container h2 {
    color: #111827;
    margin: 0 0 0.5rem 0;
  }

  .error-container p {
    color: #6b7280;
    margin: 0;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .project-header h1 {
      font-size: 1.5rem;
    }

    .public-card {
      padding: 1.5rem;
    }

    .progress-visual {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .progress-circle {
      width: 120px;
      height: 120px;
    }

    .progress-percentage {
      font-size: 1.5rem;
    }

    .carousel-main {
      height: 300px;
    }

    .area-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .area-info {
      width: 100%;
      margin-right: 0;
    }
  }
`;function Yp({onSave:r,onClose:l,slot:o=1,documentType:i="cor",documentTitle:m="",signerName:u="",signerTitle:f="",signerCompany:g=""}){const j=p.useRef(null),[v,x]=p.useState(u),[q,L]=p.useState(f),[M,P]=p.useState(g),[V,J]=p.useState(!1),[ae,F]=p.useState(!1),[R,S]=p.useState(!1),K=o===1?"GC Authorization":"Client Authorization",pe=i==="cor"?"Change Order Request":"T&M Work Order",$=()=>{const N=j.current;return N?N.getContext("2d"):null},G=N=>{const se=j.current;if(!se)return{x:0,y:0};const E=se.getBoundingClientRect(),xe=se.width/E.width,k=se.height/E.height,U=N.touches?N.touches[0].clientX:N.clientX,ie=N.touches?N.touches[0].clientY:N.clientY;return{x:(U-E.left)*xe,y:(ie-E.top)*k}},B=N=>{N.preventDefault();const se=$();if(!se)return;const{x:E,y:xe}=G(N);se.beginPath(),se.moveTo(E,xe),F(!0),J(!0)},Z=N=>{if(!ae)return;N.preventDefault();const se=$();if(!se)return;const{x:E,y:xe}=G(N);se.lineTo(E,xe),se.stroke()},C=()=>{F(!1)},b=()=>{const N=j.current,se=$();!N||!se||(se.clearRect(0,0,N.width,N.height),J(!1))},A=N=>{if(!N)return;j.current=N;const se=N.getContext("2d");se.strokeStyle="#1e293b",se.lineWidth=2,se.lineCap="round",se.lineJoin="round"},z=V&&v.trim()&&R,de=()=>{if(!z)return;const N=j.current;if(!N)return;const se=N.toDataURL("image/png");r({signature:se,signerName:v.trim(),signerTitle:q.trim()||null,signerCompany:M.trim()||null,signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal enhanced",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"signature-header-info",children:[e.jsx("h2",{id:"signature-title",children:K}),m&&e.jsx("span",{className:"signature-doc-ref",children:m})]}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close signature modal",children:e.jsx(Ta,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"signature-slot-badge",children:[e.jsx($i,{size:14}),e.jsxs("span",{children:["Signature ",o," of 2"]})]}),e.jsxs("div",{className:"signature-fields",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Print Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:v,onChange:N=>x(N.target.value),placeholder:"Enter your full legal name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-fields-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-title",children:"Title"}),e.jsx("input",{id:"signer-title",type:"text",value:q,onChange:N=>L(N.target.value),placeholder:"e.g., Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-company",children:"Company"}),e.jsx("input",{id:"signer-company",type:"text",value:M,onChange:N=>P(N.target.value),placeholder:"e.g., ABC Construction"})]})]})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(Ed,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Draw your signature below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:A,width:500,height:180,className:"signature-canvas",onMouseDown:B,onMouseMove:Z,onMouseUp:C,onMouseLeave:C,onTouchStart:B,onTouchMove:Z,onTouchEnd:C,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!V&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:b,disabled:!V,"aria-label":"Clear signature",children:[e.jsx(Md,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("div",{className:"signature-acknowledgment",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:N=>S(N.target.checked)}),e.jsxs("span",{children:["I acknowledge that this electronic signature is legally binding and that I have reviewed and approve this ",pe,". I understand that my signature, name, and IP address will be recorded for verification purposes."]})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:de,disabled:!z,"aria-label":"Submit signature",children:[e.jsx(Pa,{size:16,"aria-hidden":"true"})," Submit Signature"]})]})]})})}const _r=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",Fy=({status:r})=>{const l={draft:{label:"Draft",color:"#6b7280",bg:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bg:"#fef3c7"},approved:{label:"Approved",color:"#059669",bg:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bg:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bg:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bg:"#e5e7eb"}},o=l[r]||l.draft;return e.jsx("span",{className:"cor-status-badge",style:{color:o.color,backgroundColor:o.bg},children:o.label})};function $y({signatureToken:r}){const[l,o]=p.useState(!0),[i,m]=p.useState(null),[u,f]=p.useState(null),[g,j]=p.useState(null),[v,x]=p.useState(!1),[q,L]=p.useState(null),[M,P]=p.useState(!1),[V,J]=p.useState(null),[ae,F]=p.useState(!1),[R,S]=p.useState([]),[K,pe]=p.useState(!1),[$,G]=p.useState(new Set);p.useEffect(()=>{B()},[r]);const B=async()=>{try{o(!0),m(null);const T=await te.getSignatureRequestByToken(r);if(!T){m("This signature link is invalid or has expired.");return}if(T.status==="completed"){m("This document has already been fully signed.");return}if(T.status==="revoked"){m("This signature link has been revoked.");return}if(T.status==="expired"){m("This signature link has expired.");return}f(T);const je=await te.getDocumentForSigning(T.document_type,T.document_id);if(!je){m("The document associated with this link could not be found.");return}if(j(je),T.document_type==="cor"&&je?.id)try{const I=await te.getCORTickets(je.id);S(I||[])}catch(I){console.warn("Failed to load backup tickets:",I)}}catch(T){console.error("Error loading signature data:",T),m("Unable to load signature request. Please try again.")}finally{o(!1)}},Z=p.useMemo(()=>!g||u?.document_type!=="cor"?null:_l(g),[g,u]),C=()=>{if(!u)return{slot1:null,slot2:null,availableSlots:[]};const T=u.signatures||[],je=T.find(ue=>ue.signature_slot===1),I=T.find(ue=>ue.signature_slot===2),ke=[];return je||ke.push(1),I||ke.push(2),{slot1:je,slot2:I,availableSlots:ke}},b=async()=>{try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return null}},A=async T=>{if(!(!u||!q))try{P(!0);const je=await b(),I=await te.addSignature(u.id,q,{...T,ipAddress:je,userAgent:navigator.userAgent});await te.syncSignatureToDocument(I,u),await B(),x(!1),L(null),J(`Signature ${q} has been recorded successfully.`),setTimeout(()=>J(null),5e3)}catch(je){console.error("Error submitting signature:",je),m("Failed to submit signature. Please try again.")}finally{P(!1)}},z=T=>{L(T),x(!0)},de=async()=>{if(!(!g||!u))try{F(!0);let T=null;if(k)try{T=await te.getCORTickets(g.id)}catch(I){console.warn("Failed to fetch T&M tickets for backup:",I)}const je={logoUrl:U?.logo_url,primaryColor:U?.branding_color};await bf(g,ie,U,je,T),J("PDF downloaded successfully!"),setTimeout(()=>J(null),3e3)}catch(T){console.error("Download failed:",T),m("Failed to generate PDF. Please try again.")}finally{F(!1)}};if(l)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading document..."})]})});if(i)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-error",children:[e.jsx(Cr,{size:48}),e.jsx("h2",{children:"Unable to Load Document"}),e.jsx("p",{children:i})]})});const{slot1:N,slot2:se,availableSlots:E}=C(),xe=E.length===0,k=u?.document_type==="cor",U=g?.projects?.companies,ie=g?.projects;if(!k){const T=g.t_and_m_workers?.length||0,je=g.t_and_m_workers?.reduce((I,ke)=>I+(ke.hours||0),0)||0;return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[U?.logo_url?e.jsx("img",{src:U.logo_url,alt:U.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Hi,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:U?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"T&M Ticket Signature"})]})]}),V&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(fs,{size:18}),V]}),e.jsxs("main",{className:"signature-page-content",children:[e.jsxs("div",{className:"signature-document-card",children:[e.jsxs("div",{className:"document-card-header",children:[e.jsx(Ma,{size:20}),e.jsxs("div",{className:"document-card-title",children:[e.jsx("h2",{children:"T&M Ticket"}),e.jsx("span",{className:"document-subtitle",children:g.ce_pco_number?`CE/PCO: ${g.ce_pco_number}`:"Time & Materials"})]})]}),e.jsxs("div",{className:"document-card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Project"}),e.jsx("span",{className:"detail-value",children:ie?.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Work Date"}),e.jsx("span",{className:"detail-value",children:_r(g.work_date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Workers"}),e.jsxs("span",{className:"detail-value",children:[T," (",je," hrs)"]})]}),g.notes&&e.jsxs("div",{className:"detail-row full-width",children:[e.jsx("span",{className:"detail-label",children:"Description"}),e.jsx("span",{className:"detail-value",children:g.notes})]})]})]}),e.jsxs("div",{className:"signature-status-section",children:[e.jsx("h3",{children:"Signatures Required"}),Pp(1,N,"GC Authorization",z,M),Pp(2,se,"Client Authorization",z,M),xe&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(fs,{size:24}),e.jsx("p",{children:"This document has been fully signed by all parties."})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),v&&q&&e.jsx(Yp,{slot:q,documentType:"tm_ticket",documentTitle:"T&M Ticket",onSave:A,onClose:()=>{x(!1),L(null)}})]})}return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[U?.logo_url?e.jsx("img",{src:U.logo_url,alt:U.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Hi,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:U?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"Change Order Request"})]})]}),V&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(fs,{size:18}),V]}),e.jsxs("main",{className:"signature-page-content cor-full-document",children:[e.jsxs("div",{className:"cor-header-card",children:[e.jsxs("div",{className:"cor-header-top",children:[e.jsxs("div",{className:"cor-title-section",children:[e.jsx("h2",{className:"cor-number",children:g.cor_number}),e.jsx(Fy,{status:g.status})]}),e.jsxs("div",{className:"cor-date",children:["Created ",_r(g.created_at)]})]}),e.jsx("h3",{className:"cor-title",children:g.title||"Untitled Change Order"}),e.jsxs("div",{className:"cor-info-grid",children:[e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Project"}),e.jsx("span",{className:"cor-info-value",children:ie?.name})]}),ie?.job_number&&e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Job #"}),e.jsx("span",{className:"cor-info-value",children:ie.job_number})]}),e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Period"}),e.jsx("span",{className:"cor-info-value",children:Vi(g.period_start,g.period_end)})]})]}),g.scope_of_work&&e.jsxs("div",{className:"cor-scope",children:[e.jsx("h4",{children:"Scope of Work"}),e.jsx("p",{children:g.scope_of_work})]})]}),g.change_order_labor?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Bs,{size:18}),e.jsx("h4",{children:"Labor"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{className:"text-right",children:"Reg Hrs"}),e.jsx("th",{className:"text-right",children:"Reg Rate"}),e.jsx("th",{className:"text-right",children:"OT Hrs"}),e.jsx("th",{className:"text-right",children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_labor.map((T,je)=>e.jsxs("tr",{children:[e.jsx("td",{children:T.labor_class}),e.jsx("td",{children:T.wage_type}),e.jsx("td",{className:"text-right",children:T.regular_hours}),e.jsxs("td",{className:"text-right",children:["$",ns(T.regular_rate),"/hr"]}),e.jsx("td",{className:"text-right",children:T.overtime_hours||"-"}),e.jsx("td",{className:"text-right",children:T.overtime_hours?`$${ns(T.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:Re(T.total)})]},je))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Re(Z.labor_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"5",className:"text-right",children:["+ ",ra(g.labor_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Re(Z.labor_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"5",className:"text-right",children:e.jsx("strong",{children:"Labor Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Re(Z.labor_subtotal+Z.labor_markup_amount)})})]})]})]})})]}),g.change_order_materials?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Fn,{size:18}),e.jsx("h4",{children:"Materials"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_materials.map((T,je)=>e.jsxs("tr",{children:[e.jsx("td",{children:T.description}),e.jsx("td",{children:T.source_reference||T.source_type}),e.jsx("td",{className:"text-right",children:T.quantity}),e.jsx("td",{children:T.unit}),e.jsxs("td",{className:"text-right",children:["$",ns(T.unit_cost)]}),e.jsx("td",{className:"text-right",children:Re(T.total)})]},je))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Re(Z.materials_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",ra(g.materials_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Re(Z.materials_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Materials Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Re(Z.materials_subtotal+Z.materials_markup_amount)})})]})]})]})})]}),g.change_order_equipment?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(rs,{size:18}),e.jsx("h4",{children:"Equipment"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_equipment.map((T,je)=>e.jsxs("tr",{children:[e.jsx("td",{children:T.description}),e.jsx("td",{children:T.source_reference||T.source_type}),e.jsx("td",{className:"text-right",children:T.quantity}),e.jsx("td",{children:T.unit}),e.jsxs("td",{className:"text-right",children:["$",ns(T.unit_cost)]}),e.jsx("td",{className:"text-right",children:Re(T.total)})]},je))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Re(Z.equipment_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",ra(g.equipment_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Re(Z.equipment_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Equipment Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Re(Z.equipment_subtotal+Z.equipment_markup_amount)})})]})]})]})})]}),g.change_order_subcontractors?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(vl,{size:18}),e.jsx("h4",{children:"Subcontractors"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:g.change_order_subcontractors.map((T,je)=>e.jsxs("tr",{children:[e.jsx("td",{children:T.company_name}),e.jsx("td",{children:T.description}),e.jsx("td",{children:T.source_reference||T.source_type}),e.jsx("td",{className:"text-right",children:Re(T.total)})]},je))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Re(Z.subcontractors_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"2",className:"text-right",children:["+ ",ra(g.subcontractors_markup_percent||500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Re(Z.subcontractors_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"2",className:"text-right",children:e.jsx("strong",{children:"Subcontractors Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Re(Z.subcontractors_subtotal+Z.subcontractors_markup_amount)})})]})]})]})})]}),R.length>0&&e.jsxs("div",{className:"cor-section cor-backup-section",children:[e.jsxs("div",{className:"cor-section-header cor-backup-header",onClick:()=>pe(!K),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"backup-header-left",children:[e.jsx(Ma,{size:18}),e.jsx("h4",{children:"Supporting T&M Documentation"}),e.jsxs("span",{className:"backup-count",children:[R.length," ticket",R.length!==1?"s":""]})]}),e.jsx("div",{className:"backup-header-toggle",children:K?e.jsx(ka,{size:20}):e.jsx(Hs,{size:20})})]}),K&&e.jsx("div",{className:"backup-tickets-list",children:R.map((T,je)=>{const I=$.has(T.id),ke=T.t_and_m_workers?.reduce((ue,Te)=>ue+(parseFloat(Te.hours)||0)+(parseFloat(Te.overtime_hours)||0),0)||0;return e.jsxs("div",{className:"backup-ticket",children:[e.jsxs("div",{className:"backup-ticket-header",onClick:()=>{const ue=new Set($);I?ue.delete(T.id):ue.add(T.id),G(ue)},children:[e.jsxs("div",{className:"backup-ticket-info",children:[e.jsx("span",{className:"backup-ticket-date",children:_r(T.work_date)}),T.ce_pco_number&&e.jsx("span",{className:"backup-ticket-ce",children:T.ce_pco_number}),e.jsxs("span",{className:"backup-ticket-summary",children:[T.t_and_m_workers?.length||0," workers  ",ke," hrs",T.photos?.length>0&&`  ${T.photos.length} photos`]})]}),e.jsx("div",{className:"backup-ticket-toggle",children:I?e.jsx(ka,{size:16}):e.jsx(Hs,{size:16})})]}),I&&e.jsxs("div",{className:"backup-ticket-details",children:[T.t_and_m_workers?.length>0&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsxs("div",{className:"backup-detail-label",children:[e.jsx(Ea,{size:14})," Workers"]}),e.jsx("div",{className:"backup-workers-list",children:T.t_and_m_workers.map((ue,Te)=>e.jsxs("div",{className:"backup-worker",children:[e.jsxs("span",{className:"worker-name",children:[ue.role&&ue.role!=="Laborer"&&e.jsx("span",{className:"worker-role",children:ue.role}),ue.name]}),e.jsxs("span",{className:"worker-time-hours",children:[ue.time_started&&ue.time_ended&&e.jsxs("span",{className:"worker-time",children:[ue.time_started," - ",ue.time_ended]}),e.jsxs("span",{className:"worker-hours",children:[ue.hours||0," hrs",parseFloat(ue.overtime_hours)>0&&e.jsxs("span",{className:"worker-ot",children:[" + ",ue.overtime_hours," OT"]})]})]})]},Te))})]}),T.notes&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsx("div",{className:"backup-detail-label",children:"Description"}),e.jsx("p",{className:"backup-notes",children:T.notes})]}),T.photos?.length>0&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsxs("div",{className:"backup-detail-label",children:[e.jsx(Nr,{size:14})," Photos (",T.photos.length,")"]}),e.jsx("div",{className:"backup-photos-grid",children:T.photos.map((ue,Te)=>e.jsx("a",{href:ue,target:"_blank",rel:"noopener noreferrer",className:"backup-photo",children:e.jsx("img",{src:ue,alt:`Photo ${Te+1}`,onError:Be=>{Be.target.onerror=null,Be.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiI+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=="}})},Te))})]})]})]},T.id)})}),e.jsxs("div",{className:"backup-note",children:[e.jsx(Cr,{size:14}),e.jsx("span",{children:"This documentation supports the work described in this Change Order Request."})]})]}),e.jsxs("div",{className:"cor-totals-card",children:[e.jsx("h4",{children:"COR Summary"}),e.jsxs("div",{className:"cor-totals-grid",children:[e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Re(Z.cor_subtotal)})]}),e.jsxs("div",{className:"cor-fees-section",children:[e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Liability Insurance (",ra(g.liability_insurance_percent||144),")"]}),e.jsx("span",{children:Re(Z.liability_insurance_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Bond (",ra(g.bond_percent||100),")"]}),e.jsx("span",{children:Re(Z.bond_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["City License Fee (",ra(g.license_fee_percent||10),")"]}),e.jsx("span",{children:Re(Z.license_fee_amount)})]})]}),e.jsxs("div",{className:"cor-grand-total",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:Re(Z.cor_total)})]})]})]}),e.jsxs("div",{className:"cor-signature-section",children:[e.jsx("h4",{children:"Authorization"}),e.jsx("p",{className:"signature-instruction",children:"By signing below, you authorize the above change order request and agree to the terms and costs outlined."}),e.jsxs("div",{className:"signature-slots-grid",children:[e.jsxs("div",{className:`signature-slot-card ${N?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[N?e.jsx(fs,{size:20,className:"status-icon signed"}):e.jsx(xn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Signature 1  GC Authorization"})]}),N?e.jsxs("div",{className:"slot-signed-info",children:[N.signature_data&&e.jsx("img",{src:N.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:N.signer_name}),(N.signer_title||N.signer_company)&&e.jsxs("span",{className:"signer-org",children:[N.signer_title,N.signer_title&&N.signer_company&&"  ",N.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",_r(N.signed_at)]})]}):e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>z(1),disabled:M,children:"Sign as GC"})]}),e.jsxs("div",{className:`signature-slot-card ${se?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[se?e.jsx(fs,{size:20,className:"status-icon signed"}):e.jsx(xn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Signature 2  Client Authorization"})]}),se?e.jsxs("div",{className:"slot-signed-info",children:[se.signature_data&&e.jsx("img",{src:se.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:se.signer_name}),(se.signer_title||se.signer_company)&&e.jsxs("span",{className:"signer-org",children:[se.signer_title,se.signer_title&&se.signer_company&&"  ",se.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",_r(se.signed_at)]})]}):e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>z(2),disabled:M,children:"Sign as Client"})]})]}),xe&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(fs,{size:24}),e.jsx("p",{children:"This change order request has been fully signed by all parties."})]}),e.jsxs("div",{className:"cor-download-section",children:[e.jsx("h4",{children:"Download Your Copy"}),e.jsx("p",{className:"download-description",children:xe?"Download a PDF copy of this fully signed COR including all T&M backup documentation.":"Download a PDF copy of this COR for your records. Signature status will be included."}),e.jsx("button",{className:"btn btn-primary download-btn",onClick:de,disabled:ae,children:ae?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"download-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(of,{size:18}),"Download COR + Backup"]})})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),v&&q&&e.jsx(Yp,{slot:q,documentType:u.document_type,documentTitle:`${g.cor_number} - ${g.title}`,onSave:A,onClose:()=>{x(!1),L(null)}})]})}function Pp(r,l,o,i,m){return e.jsxs("div",{className:`signature-slot-card ${l?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[l?e.jsx(fs,{size:20,className:"status-icon signed"}):e.jsx(xn,{size:20,className:"status-icon pending"}),e.jsxs("span",{className:"slot-label",children:["Signature ",r,"  ",o]})]}),l?e.jsxs("div",{className:"slot-signed-info",children:[e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:l.signer_name}),(l.signer_title||l.signer_company)&&e.jsxs("span",{className:"signer-org",children:[l.signer_title,l.signer_title&&l.signer_company&&"  ",l.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",_r(l.signed_at)]})]}):e.jsxs("button",{className:"btn btn-primary sign-btn",onClick:()=>i(r),disabled:m,children:["Sign as ",r===1?"GC":"Client"]})]})}const jd=[{value:"member",label:"Member",icon:Ad,description:"Standard access to projects"},{value:"administrator",label:"Administrator",icon:$i,description:"Full control, can manage team"}],Qp=[{value:"Project Manager",label:"Project Manager"},{value:"Superintendent",label:"Superintendent"},{value:"Job Costing",label:"Job Costing"},{value:"Accounting",label:"Accounting"}];function Vy({company:r,user:l,onShowToast:o}){const[i,m]=p.useState("pending"),[u,f]=p.useState([]),[g,j]=p.useState(!0),[v,x]=p.useState(null),[q,L]=p.useState({}),[M,P]=p.useState({});p.useEffect(()=>{r?.id&&V()},[r?.id]);const V=async()=>{try{j(!0);const C=await te.getCompanyMemberships(r.id);f(C)}catch(C){console.error("Error loading members:",C),o("Error loading team members","error")}finally{j(!1)}},J=async C=>{const b=M[C.id];if(!b){o("Please select a role for this member","error");return}try{x(C.id);const A=q[C.id]||"member";await te.approveMembershipWithRole(C.id,l.id,A),await te.updateMemberCompanyRole(C.id,b),o(`${C.users?.name||C.users?.email} approved as ${b}`,"success"),L(z=>{const de={...z};return delete de[C.id],de}),P(z=>{const de={...z};return delete de[C.id],de}),V()}catch(A){console.error("Error approving membership:",A),o("Error approving request","error")}finally{x(null)}},ae=(C,b)=>{L(A=>({...A,[C]:b}))},F=(C,b)=>{P(A=>({...A,[C]:b}))},R=async(C,b)=>{try{x(C.id),await te.updateMemberCompanyRole(C.id,b),o(`${C.users?.name||"User"} role updated to ${b}`,"success"),V()}catch(A){console.error("Error updating company role:",A),o("Error updating role","error")}finally{x(null)}},S=async(C,b)=>{if(C.users?.id===l.id&&b!=="administrator"){o("You cannot demote yourself","error");return}try{x(C.id),await te.updateMemberAccessLevel(C.id,b);const A=jd.find(z=>z.value===b)?.label||b;o(`${C.users?.name||"User"} is now ${A}`,"success"),V()}catch(A){console.error("Error updating access level:",A),o("Error updating access level","error")}finally{x(null)}},K=async C=>{try{x(C.id),await te.rejectMembership(C.id),o("Request rejected","success"),V()}catch(b){console.error("Error rejecting membership:",b),o("Error rejecting request","error")}finally{x(null)}},pe=async C=>{if(C.users?.id===l.id){o("You cannot remove yourself","error");return}try{x(C.id),await te.removeMember(C.id,l.id),o(`${C.users?.name||C.users?.email} removed`,"success"),V()}catch(b){console.error("Error removing member:",b),o("Error removing member","error")}finally{x(null)}},$=u.filter(C=>i==="all"?!0:C.status===i),G=u.filter(C=>C.status==="pending").length,B=u.filter(C=>C.status==="active").length,Z=u.filter(C=>C.status==="removed").length;return g?e.jsx("div",{className:"membership-manager",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading team members..."]})}):e.jsxs("div",{className:"membership-manager",children:[e.jsxs("div",{className:"membership-header",children:[e.jsxs("h2",{children:[e.jsx(Bs,{size:24})," Team Members"]}),e.jsxs("p",{className:"membership-subtitle",children:["Manage who has access to ",r?.name]})]}),G>0&&e.jsxs("div",{className:"pending-alert",children:[e.jsx(yl,{size:20}),e.jsxs("span",{children:[G," pending request",G>1?"s":""," awaiting approval"]})]}),e.jsxs("div",{className:"tm-filter-tabs",children:[e.jsxs("button",{className:`tm-filter-tab ${i==="pending"?"active":""}`,onClick:()=>m("pending"),children:["Pending",e.jsx("span",{className:"tm-filter-count",children:G})]}),e.jsxs("button",{className:`tm-filter-tab ${i==="active"?"active":""}`,onClick:()=>m("active"),children:["Active",e.jsx("span",{className:"tm-filter-count",children:B})]}),e.jsxs("button",{className:`tm-filter-tab ${i==="removed"?"active":""}`,onClick:()=>m("removed"),children:["Removed",e.jsx("span",{className:"tm-filter-count",children:Z})]})]}),e.jsx("div",{className:"member-list",children:$.length===0?e.jsxs("div",{className:"member-empty",children:[i==="pending"&&"No pending requests",i==="active"&&"No active members",i==="removed"&&"No removed members"]}):$.map(C=>e.jsxs("div",{className:`member-card ${C.status}`,children:[e.jsxs("div",{className:"member-info",children:[e.jsxs("div",{className:"member-name",children:[C.users?.name||"Unknown",C.users?.id===l.id&&e.jsx("span",{className:"member-you",children:"(You)"})]}),e.jsx("div",{className:"member-email",children:C.users?.email}),e.jsxs("div",{className:"member-meta",children:[C.status==="pending"&&e.jsxs(e.Fragment,{children:["Requested ",new Date(C.created_at).toLocaleDateString()]}),C.status==="active"&&C.approved_at&&e.jsxs(e.Fragment,{children:["Approved ",new Date(C.approved_at).toLocaleDateString()]}),C.status==="active"&&!C.approved_at&&e.jsxs(e.Fragment,{children:["Member since ",new Date(C.created_at).toLocaleDateString()]}),C.status==="removed"&&C.removed_at&&e.jsxs(e.Fragment,{children:["Removed ",new Date(C.removed_at).toLocaleDateString()]})]}),C.status==="active"&&e.jsxs("div",{className:"member-badges",children:[C.access_level==="administrator"?e.jsxs("span",{className:"access-badge admin",children:[e.jsx($i,{size:12})," Administrator"]}):e.jsxs("span",{className:"access-badge member",children:[e.jsx(Ad,{size:12})," Member"]}),C.company_role&&e.jsxs("span",{className:"access-badge role",children:[e.jsx(vl,{size:12})," ",C.company_role]})]})]}),e.jsxs("div",{className:"member-actions",children:[C.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"role-selector",children:[e.jsxs("select",{value:M[C.id]||"",onChange:b=>F(C.id,b.target.value),disabled:v===C.id,className:"role-select",children:[e.jsx("option",{value:"",children:"Select Role..."}),Qp.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))]}),e.jsx(ka,{size:14,className:"role-select-icon"})]}),e.jsxs("div",{className:"role-selector",children:[e.jsx("select",{value:q[C.id]||"member",onChange:b=>ae(C.id,b.target.value),disabled:v===C.id,className:"role-select",children:jd.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))}),e.jsx(ka,{size:14,className:"role-select-icon"})]}),e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>J(C),disabled:v===C.id,children:v===C.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(pf,{size:16})," Approve"]})}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>K(C),disabled:v===C.id,children:v===C.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(Uv,{size:16})," Reject"]})})]}),C.status==="active"&&C.users?.id!==l.id&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"role-selector",children:[e.jsxs("select",{value:C.company_role||"",onChange:b=>R(C,b.target.value),disabled:v===C.id,className:"role-select",children:[e.jsx("option",{value:"",children:"No Role"}),Qp.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))]}),e.jsx(ka,{size:14,className:"role-select-icon"})]}),e.jsxs("div",{className:"role-selector",children:[e.jsx("select",{value:C.access_level||"member",onChange:b=>S(C,b.target.value),disabled:v===C.id,className:"role-select",children:jd.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))}),e.jsx(ka,{size:14,className:"role-select-icon"})]}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>pe(C),disabled:v===C.id,children:v===C.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(ff,{size:16})," Remove"]})})]})]})]},C.id))})]})}function Gy({company:r,projects:l,userId:o,onNotificationClick:i,onShowToast:m}){const[u,f]=p.useState([]),[g,j]=p.useState(0),[v,x]=p.useState(!1),[q,L]=p.useState(!1),[M,P]=p.useState({}),V=p.useRef(null);p.useRef(null);const J=p.useRef(null);p.useEffect(()=>{o&&ae()},[o]);const ae=async()=>{try{const b=await te.getUserNotificationPreferences(o),A={};b.forEach(z=>{A[z.project_id]=z.notification_types||[]}),P(A)}catch(b){console.error("Error loading user preferences:",b)}},F=(b,A)=>M[b]?M[b].length===0?!1:M[b].includes(A):!0;p.useEffect(()=>{if(!r?.id||!l||l.length===0)return;R();const b=S();return()=>{b&&te.unsubscribe(b)}},[r?.id,l,M]),p.useEffect(()=>()=>{J.current&&(J.current.close().catch(()=>{}),J.current=null)},[]),p.useEffect(()=>{function b(A){V.current&&!V.current.contains(A.target)&&x(!1)}return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[]);const R=async()=>{if(!l||l.length===0)return;const b=[];for(const A of l)try{F(A.id,"message")&&(await te.getMessages(A.id,20)).filter(N=>N.sender_type==="field"&&!N.is_read).forEach(N=>{b.push({id:`msg-${N.id}`,type:"message",title:"New Message",message:N.message?.slice(0,50)+(N.message?.length>50?"...":""),projectId:A.id,projectName:A.name,senderName:N.sender_name,createdAt:N.created_at,isRead:N.is_read,data:N})}),F(A.id,"material_request")&&(await te.getMaterialRequests(A.id,"pending")).forEach(de=>{b.push({id:`req-${de.id}`,type:"material_request",title:"Material Request",message:`${de.items?.length||0} items requested`,projectId:A.id,projectName:A.name,senderName:de.requested_by,priority:de.priority,createdAt:de.created_at,isRead:!1,data:de})})}catch(z){console.error("Error loading notifications for project:",A.id,z)}try{(await te.getCompanyInjuryReports(r.id,"open")).slice(0,5).forEach(z=>{if(F(z.project_id,"injury_report")){const de=l.find(N=>N.id===z.project_id);b.push({id:`injury-${z.id}`,type:"injury_report",title:"Safety Report",message:`${z.injury_type} - ${z.injured_person_name}`,projectId:z.project_id,projectName:de?.name||"Unknown Project",senderName:z.reported_by_name,createdAt:z.created_at,isRead:z.status!=="open",data:z})}})}catch(A){console.error("Error loading injury reports:",A)}b.sort((A,z)=>new Date(z.createdAt)-new Date(A.createdAt)),f(b.slice(0,50)),j(b.filter(A=>!A.isRead).length)},S=()=>{if(!r?.id||!l||l.length===0)return null;const b=l.map(z=>z.id),A=te.subscribeToCompanyActivity(r.id,b,{onMessage:z=>{if(z.new?.sender_type==="field"){if(!F(z.new.project_id,"message"))return;K({id:`msg-${z.new.id}`,type:"message",title:"New Message",message:z.new.message?.slice(0,50)+(z.new.message?.length>50?"...":""),projectId:z.new.project_id,projectName:l.find(de=>de.id===z.new.project_id)?.name||"Project",senderName:z.new.sender_name,createdAt:z.new.created_at,isRead:!1,data:z.new})}},onMaterialRequest:z=>{F(z.new.project_id,"material_request")&&K({id:`req-${z.new.id}`,type:"material_request",title:"Material Request",message:`${z.new.items?.length||0} items requested`,projectId:z.new.project_id,projectName:l.find(de=>de.id===z.new.project_id)?.name||"Project",senderName:z.new.requested_by,priority:z.new.priority,createdAt:z.new.created_at,isRead:!1,data:z.new})},onTMTicket:z=>{if(z.eventType==="INSERT"){if(!F(z.new.project_id,"tm_ticket"))return;K({id:`tm-${z.new.id}`,type:"tm_ticket",title:"New T&M Ticket",message:`Submitted by ${z.new.created_by_name||"Field"}`,projectId:z.new.project_id,projectName:l.find(de=>de.id===z.new.project_id)?.name||"Project",senderName:z.new.created_by_name,createdAt:z.new.created_at,isRead:!1,data:z.new})}},onInjuryReport:z=>{F(z.new.project_id,"injury_report")&&K({id:`injury-${z.new.id}`,type:"injury_report",title:"Safety Report",message:`${z.new.injury_type} - ${z.new.injured_person_name}`,projectId:z.new.project_id,projectName:l.find(de=>de.id===z.new.project_id)?.name||"Project",senderName:z.new.reported_by_name,createdAt:z.new.created_at,isRead:!1,data:z.new})}});return A&&L(!0),A},K=b=>{f(z=>[b,...z.slice(0,49)]),j(z=>z+1),pe();const A=$(b.type);m?.(`${A} ${b.title}: ${b.message}`,"info")},pe=()=>{try{(!J.current||J.current.state==="closed")&&(J.current=new(window.AudioContext||window.webkitAudioContext));const b=J.current;b.state==="suspended"&&b.resume();const A=b.createOscillator(),z=b.createGain();A.connect(z),z.connect(b.destination),A.frequency.value=800,A.type="sine",z.gain.value=.3,A.start(),A.stop(b.currentTime+.15),setTimeout(()=>{if(!J.current||J.current.state==="closed")return;const de=J.current.createOscillator(),N=J.current.createGain();de.connect(N),N.connect(J.current.destination),de.frequency.value=1e3,de.type="sine",N.gain.value=.3,de.start(),de.stop(J.current.currentTime+.15)},150)}catch{}},$=b=>{switch(b){case"message":return e.jsx(uf,{size:16});case"material_request":return e.jsx(Fn,{size:16});case"injury_report":return e.jsx(Cr,{size:16});case"tm_ticket":return e.jsx(as,{size:16});default:return e.jsx(ij,{size:16})}},G=b=>{switch(b){case"message":return"blue";case"material_request":return"orange";case"injury_report":return"red";case"tm_ticket":return"green";default:return"gray"}},B=b=>{f(A=>A.map(z=>z.id===b.id?{...z,isRead:!0}:z)),j(A=>Math.max(0,A-1)),x(!1),i?.(b)},Z=async()=>{for(const b of l)try{await te.markMessagesRead(b.id,"office")}catch{}f(b=>b.map(A=>({...A,isRead:!0}))),j(0)},C=b=>{const A=new Date(b),de=new Date-A,N=Math.floor(de/6e4),se=Math.floor(de/36e5),E=Math.floor(de/864e5);return N<1?"Just now":N<60?`${N}m ago`:se<24?`${se}h ago`:E<7?`${E}d ago`:A.toLocaleDateString()};return e.jsxs("div",{className:"notification-center",ref:V,children:[e.jsxs("button",{className:`notification-bell ${g>0?"has-notifications":""}`,onClick:()=>x(!v),title:`${g} unread notifications`,children:[e.jsx("span",{className:"bell-icon",children:""}),g>0&&e.jsx("span",{className:"notification-badge",children:g>99?"99+":g}),q&&e.jsx("span",{className:"connection-dot"})]}),v&&e.jsxs("div",{className:"notification-dropdown",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h4",{children:"Notifications"}),g>0&&e.jsx("button",{className:"mark-all-read",onClick:Z,children:"Mark all read"})]}),e.jsx("div",{className:"notification-list",children:u.length===0?e.jsxs("div",{className:"notification-empty",children:[e.jsx("span",{className:"empty-icon",children:""}),e.jsx("p",{children:"No notifications yet"}),e.jsx("small",{children:"You'll see updates from the field here"})]}):u.map(b=>e.jsxs("div",{className:`notification-item ${b.isRead?"read":"unread"} ${G(b.type)}`,onClick:()=>B(b),children:[e.jsx("div",{className:"notification-icon",children:$(b.type)}),e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"notification-title",children:[b.title,b.priority==="urgent"&&e.jsx("span",{className:"priority-badge urgent",children:"URGENT"})]}),e.jsx("div",{className:"notification-message",children:b.message}),e.jsxs("div",{className:"notification-meta",children:[e.jsx("span",{className:"notification-project",children:b.projectName}),e.jsx("span",{className:"notification-time",children:C(b.createdAt)})]})]}),!b.isRead&&e.jsx("div",{className:"unread-dot"})]},b.id))}),u.length>0&&e.jsx("div",{className:"notification-footer",children:e.jsx("button",{className:"view-all-btn",onClick:()=>{x(!1),i?.({type:"view_all"})},children:"View All Activity"})})]})]})}class br extends p.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0}}componentDidCatch(l,o){this.setState({error:l,errorInfo:o}),console.error("ErrorBoundary caught an error:",l,o)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("div",{className:"error-icon",children:e.jsx(yl,{size:48})}),e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),e.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function Xp(){const[r,l]=p.useState(xl()),[o,i]=p.useState(0),[m,u]=p.useState(!1),[f,g]=p.useState(!1);return p.useEffect(()=>{const j=tf(async x=>{l(x),x&&f&&(u(!0),setTimeout(()=>u(!1),3e3)),x||g(!0);const q=await td();i(q)});td().then(i);const v=setInterval(async()=>{if(!xl()){const x=await td();i(x)}},5e3);return()=>{j(),clearInterval(v)}},[f]),r&&o===0&&!m?null:e.jsxs("div",{className:`offline-indicator ${r?"online":"offline"} ${m?"synced":""}`,children:[e.jsx("div",{className:"offline-indicator-content",children:r?m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"online-icon",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):o>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"syncing-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),e.jsxs("span",{className:"offline-text",children:["Syncing ",o,"..."]})]}):null:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"offline-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),e.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),e.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),e.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),e.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),e.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),e.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),e.jsxs("span",{className:"offline-text",children:["Offline",o>0&&e.jsxs("span",{className:"pending-badge",children:[o," pending"]})]})]})}),e.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function Yy(){const[r,l]=p.useState("entry"),[o,i]=p.useState(null),[m,u]=p.useState(null),[f,g]=p.useState([]),[j,v]=p.useState([]),[x,q]=p.useState(null),[L,M]=p.useState(null),[P,V]=p.useState(null),[J,ae]=p.useState(!0),[F,R]=p.useState("dashboard"),[S,K]=p.useState(null),[pe,$]=p.useState(!1),[G,B]=p.useState(null),[Z,C]=p.useState(0);p.useEffect(()=>{const ue=window.location.pathname,Te=ue.match(/^\/view\/([a-zA-Z0-9_-]+)$/),Be=ue.match(/^\/sign\/([a-zA-Z0-9_-]+)$/);Te?(M(Te[1]),l("public"),ae(!1)):Be?(V(Be[1]),l("signature"),ae(!1)):b()},[]);const b=async()=>{try{const{data:{user:ue}}=await D.auth.getUser();if(!ue){ae(!1);return}const{data:Te,error:Be}=await D.from("users").select("*").eq("id",ue.id).single();if(Te){i(Te);let ze=await te.getUserCompanies(ue.id);if(ze.length===0&&Te.company_id&&(console.log("Legacy user detected, attempting repair..."),await te.repairLegacyUser(ue.id,Te.company_id,Te.role||"member")&&(ze=await te.getUserCompanies(ue.id),console.log("Legacy user repaired, companies:",ze.length))),g(ze),ze.length===0){if(await te.getUserPendingMemberships(ue.id)>0){l("pending");return}E("No company access. Join a company to continue.","error"),await kp.signOut();return}const Oe=localStorage.getItem("selectedCompanyId");let gt=null;if(Oe&&ze.find(tt=>tt.id===Oe)?gt=ze.find(tt=>tt.id===Oe):ze.length>0&&(gt=ze[0]),gt){const{data:tt}=await D.from("companies").select("*").eq("id",gt.id).single();u(tt),l("office")}}}catch(ue){console.error("Auth check error:",ue)}finally{ae(!1)}},A=ue=>{q(ue),l("foreman")},z=async(ue,Te)=>{try{const{data:Be,error:ze}=await D.auth.signInWithPassword({email:ue,password:Te});if(ze){E(ze.message||"Invalid credentials","error");return}const{data:Oe,error:gt}=await D.from("users").select("*").eq("id",Be.user.id).single();if(gt){console.error("User fetch error:",gt),E("Error loading profile","error");return}if(Oe){i(Oe);let tt=await te.getUserCompanies(Be.user.id);tt.length===0&&Oe.company_id&&(console.log("Legacy user detected on login, attempting repair..."),await te.repairLegacyUser(Be.user.id,Oe.company_id,Oe.role||"member")&&(tt=await te.getUserCompanies(Be.user.id),console.log("Legacy user repaired on login, companies:",tt.length))),g(tt);const ee=localStorage.getItem("selectedCompanyId");let Me=null;if(ee&&tt.find(Fe=>Fe.id===ee)?Me=tt.find(Fe=>Fe.id===ee):tt.length>0&&(Me=tt[0]),Me){const{data:Fe}=await D.from("companies").select("*").eq("id",Me.id).single();u(Fe),l("office")}else await te.getUserPendingMemberships(Be.user.id)>0?l("pending"):E("No company access. Please contact admin.","error")}else E("Profile not found. Please contact admin.","error")}catch(Be){console.error("Login error:",Be),E("Login failed","error")}},de=async ue=>{try{const{data:Te}=await D.from("companies").select("*").eq("id",ue).single();Te&&(u(Te),localStorage.setItem("selectedCompanyId",ue),$(!1),R("dashboard"),E(`Switched to ${Te.name}`,"success"))}catch(Te){console.error("Switch company error:",Te),E("Error switching company","error")}},N=async()=>{try{await kp.signOut(),i(null),u(null),g([]),l("entry"),R("dashboard"),localStorage.removeItem("selectedCompanyId")}catch(ue){console.error("Logout error:",ue),E("Error signing out","error")}},se=()=>{q(null),l("entry")},E=(ue,Te="")=>{K({message:ue,type:Te})},xe=()=>{R("dashboard"),m?.id&&k()},k=async()=>{if(m?.id)try{const ue=await te.getProjects(m.id);v(ue)}catch(ue){console.error("Error loading projects:",ue)}};p.useEffect(()=>{m?.id&&r==="office"&&(k(),U())},[m?.id,r]);const U=async()=>{if(m?.id)try{const Te=(await te.getCompanyMemberships(m.id)).filter(Be=>Be.status==="pending").length;C(Te)}catch(ue){console.error("Error loading pending count:",ue)}},ie=ue=>{if(ue.type==="view_all"){R("dashboard"),B(null);return}R("dashboard"),ue.projectId&&B(ue.projectId)},T=()=>{B(null)};if(J)return e.jsx(Rn,{children:e.jsx(On,{companyId:m?.id,children:e.jsxs("div",{className:"loading-screen",children:[e.jsx(ds,{className:"loading-logo"}),e.jsx("div",{className:"spinner"})]})})});if(r==="entry")return e.jsx(Rn,{children:e.jsxs(On,{children:[e.jsx(br,{children:e.jsx(Gv,{onForemanAccess:A,onOfficeLogin:z,onShowToast:E})}),S&&e.jsx(Ls,{message:S.message,type:S.type,onClose:()=>K(null)})]})});if(r==="public"&&L)return e.jsx(Rn,{children:e.jsxs(On,{children:[e.jsx(br,{children:e.jsx(By,{shareToken:L})}),S&&e.jsx(Ls,{message:S.message,type:S.type,onClose:()=>K(null)})]})});if(r==="signature"&&P)return e.jsx(Rn,{children:e.jsxs(On,{children:[e.jsx(br,{children:e.jsx($y,{signatureToken:P})}),S&&e.jsx(Ls,{message:S.message,type:S.type,onClose:()=>K(null)})]})});if(r==="pending")return e.jsx(Rn,{children:e.jsxs(On,{children:[e.jsx(br,{children:e.jsxs("div",{className:"pending-approval-screen",children:[e.jsx(ds,{className:"pending-logo"}),e.jsx("h2",{children:"Awaiting Approval"}),e.jsx("p",{children:"Your membership request has been submitted."}),e.jsx("p",{children:"A company admin will review your request."}),e.jsxs("div",{className:"pending-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:N,children:"Sign Out"}),e.jsx("button",{className:"btn btn-primary",onClick:b,children:"Check Status"})]})]})}),S&&e.jsx(Ls,{message:S.message,type:S.type,onClose:()=>K(null)})]})});if(r==="foreman"&&x)return e.jsx(Rn,{children:e.jsxs(On,{companyId:x.company_id,children:[e.jsx(br,{children:e.jsx(sy,{project:x,companyId:x.company_id,onShowToast:E,onExit:se})}),e.jsx(Xp,{}),S&&e.jsx(Ls,{message:S.message,type:S.type,onClose:()=>K(null)})]})});const ke=f.find(ue=>ue.id===m?.id)?.access_level==="administrator"||m?.owner_user_id===o?.id;return e.jsx(Rn,{children:e.jsx(On,{companyId:m?.id,children:e.jsxs("div",{children:[!Y&&e.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),e.jsx("nav",{className:"nav",children:e.jsxs("div",{className:"nav-content",children:[e.jsx(ds,{}),e.jsxs("div",{className:"nav-tabs",children:[e.jsx("button",{className:`nav-tab ${F==="dashboard"?"active":""}`,onClick:()=>R("dashboard"),children:"Dashboard"}),e.jsx("button",{className:`nav-tab ${F==="setup"?"active":""}`,onClick:()=>R("setup"),children:"+ New Project"}),e.jsx("button",{className:`nav-tab ${F==="pricing"?"active":""}`,onClick:()=>R("pricing"),children:"Pricing"}),ke&&e.jsx("button",{className:`nav-tab ${F==="branding"?"active":""}`,onClick:()=>R("branding"),children:"Branding"}),ke&&e.jsxs("button",{className:`nav-tab ${F==="team"?"active":""}`,onClick:()=>R("team"),children:["Team",Z>0&&e.jsx("span",{className:"nav-tab-badge",children:Z})]})]}),e.jsxs("div",{className:"nav-user",children:[e.jsx(vf,{compact:!0}),e.jsx(Gy,{company:m,projects:j,userId:o?.id,onNotificationClick:ie,onShowToast:E}),f.length>1&&e.jsxs("div",{className:"company-switcher",children:[e.jsxs("button",{className:"company-switcher-btn",onClick:()=>$(!pe),children:[m?.name||"Select Company",e.jsx("span",{className:"switcher-arrow",children:""})]}),pe&&e.jsx("div",{className:"company-dropdown",children:f.map(ue=>e.jsxs("button",{className:`company-option ${ue.id===m?.id?"active":""}`,onClick:()=>de(ue.id),children:[ue.name,ue.id===m?.id&&e.jsx("span",{className:"check",children:""})]},ue.id))})]}),f.length<=1&&m&&e.jsx("span",{className:"nav-company-name",children:m.name}),e.jsx("span",{className:"nav-user-name",children:o?.name||o?.email}),e.jsx("button",{className:"nav-logout",onClick:N,children:"Sign Out"})]})]})}),e.jsx(br,{children:e.jsxs("div",{className:"container",children:[F==="dashboard"&&e.jsx(My,{company:m,user:o,isAdmin:ke,onShowToast:E,navigateToProjectId:G,onProjectNavigated:T}),F==="setup"&&e.jsx(Ay,{company:m,user:o,onProjectCreated:xe,onShowToast:E}),F==="pricing"&&e.jsx(Hy,{company:m,onShowToast:E}),F==="branding"&&e.jsx(zy,{company:m,onShowToast:E}),F==="team"&&ke&&e.jsx(Vy,{company:m,user:o,onShowToast:E})]},m?.id)}),e.jsx(Xp,{}),S&&e.jsx(Ls,{message:S.message,type:S.type,onClose:()=>K(null)})]})})})}Bx.createRoot(document.getElementById("root")).render(e.jsx(Ox.StrictMode,{children:e.jsx(Yy,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(r=>{console.log("SW registered:",r.scope),setInterval(()=>{r.update()},6e4)}).catch(r=>{console.log("SW registration failed:",r)})});
