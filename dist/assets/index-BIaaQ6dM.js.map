{"version":3,"mappings":";ghDAiBO,SAASA,GAAeC,EAAaC,EAAcC,EAAgB,GAAI,CAC5E,GAAI,CAACF,GAAe,CAACC,EACnB,MAAO,CAAE,YAAa,GAAO,UAAW,EAAE,EAK5C,MAAME,EAAkB,IAAI,KAAKH,EAAY,oBAAsBA,EAAY,YAAc,CAAC,EACxFI,EAAkB,IAAI,KAAKH,EAAa,YAAc,CAAC,EACvDI,EAAgB,IAAI,KAAKL,EAAY,WAAa,CAAC,EAGzD,GAAII,GAAmBC,EACrB,MAAO,CAAE,YAAa,GAAO,UAAW,EAAE,EAI5C,MAAMC,EAAY,GACZC,EAAgBL,EAAc,OAAS,EACzCA,EACA,OAAO,KAAKF,CAAW,EAAE,OAAOQ,GAAK,CAACA,EAAE,WAAW,GAAG,GAAKA,IAAM,MAAQA,IAAM,YAAY,EAE/F,UAAWC,KAASF,EAAe,CACjC,MAAMG,EAAWV,EAAYS,CAAK,EAC5BE,EAAYV,EAAaQ,CAAK,EAEpC,GAAIC,IAAa,QAAaC,IAAc,QAAa,CAACC,GAAUF,EAAUC,CAAS,EAAG,CAExF,MAAME,EAAYb,EAAY,gBAAgBS,CAAK,EAC7CK,EAAeD,IAAc,OAAY,CAACD,GAAUF,EAAUG,CAAS,EAAI,GAC3EE,EAAgBF,IAAc,OAAY,CAACD,GAAUD,EAAWE,CAAS,EAAI,GAE/EC,GAAgBC,GAClBT,EAAU,KAAK,CACb,MAAAG,EACA,WAAYC,EACZ,YAAaC,EACb,YAAaE,CACvB,CAAS,CAEL,CACF,CAEA,MAAO,CACL,YAAaP,EAAU,OAAS,EAChC,UAAAA,EACA,gBAAAH,EACA,gBAAAC,CACJ,CACA,CAKA,SAASQ,GAAUI,EAAGC,EAAG,CACvB,GAAID,IAAMC,EAAG,MAAO,GACpB,GAAID,GAAK,MAAQC,GAAK,KAAM,OAAOD,IAAMC,EACzC,GAAI,OAAOD,GAAM,OAAOC,EAAG,MAAO,GAClC,GAAI,OAAOD,GAAM,SAAU,OAAOA,IAAMC,EACxC,GAAI,MAAM,QAAQD,CAAC,IAAM,MAAM,QAAQC,CAAC,EAAG,MAAO,GAElD,MAAMC,EAAQ,OAAO,KAAKF,CAAC,EACrBG,EAAQ,OAAO,KAAKF,CAAC,EAC3B,OAAIC,EAAM,SAAWC,EAAM,OAAe,GAEnCD,EAAM,MAAME,GAAOR,GAAUI,EAAEI,CAAG,EAAGH,EAAEG,CAAG,CAAC,CAAC,CACrD,CAKO,MAAMC,GAAwB,CACnC,WAAY,aACZ,YAAa,cACb,MAAO,OACT,EAyFO,SAASC,GAAgBC,EAAQC,EAAc,GAAI,CACxD,MAAMC,EAAU,CACd,GAAGF,EACH,UAAW,IAAI,KAAI,EAAG,YAAW,CACrC,EAEE,GAAIC,EAAY,OAAS,EAAG,CAC1BC,EAAQ,cAAgB,GACxB,UAAWhB,KAASe,EACdD,EAAOd,CAAK,IAAM,SACpBgB,EAAQ,cAAchB,CAAK,EAAI,KAAK,MAAM,KAAK,UAAUc,EAAOd,CAAK,CAAC,CAAC,EAG7E,CAEA,OAAOgB,CACT,CASO,SAASC,GAAqBC,EAAgBC,EAAa,SAAU,CAC1E,GAAI,CAACD,EAAe,YAClB,OAAO,KAGT,GAAIA,EAAe,gBACjB,MAAO,CACL,MAAO,GAAGE,GAAWD,CAAU,CAAC,eAChC,YAAa,QAAQA,CAAU,uDAC/B,SAAU,UACV,cAAe,CACrB,EAGE,MAAME,EAAaH,EAAe,UAAU,IAAII,GAAKA,EAAE,KAAK,EAAE,KAAK,IAAI,EACvE,MAAO,CACL,MAAO,GAAGF,GAAWD,CAAU,CAAC,gBAChC,YAAa,sDAAsDE,CAAU,GAC7E,SAAUH,EAAe,UAAU,OAAS,EAAI,UAAY,OAC5D,cAAeA,EAAe,UAAU,OACxC,OAAQA,EAAe,SAC3B,CACA,CAEA,SAASE,GAAWG,EAAK,CACvB,OAAOA,EAAI,OAAO,CAAC,EAAE,cAAgBA,EAAI,MAAM,CAAC,CAClD,CCjOA,MAAMC,GAAU,oBACVC,GAAa,EAGbC,GAAS,CACb,SAAU,WACV,MAAO,QACP,cAAe,gBACf,WAAY,aACZ,cAAe,gBACf,SAAU,WACV,gBAAiB,kBACjB,YAAa,aACf,EAEA,IAAIC,GAAK,KAGF,MAAMC,GAAgB,IACpB,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,GAAIH,GAAI,CACNE,EAAQF,EAAE,EACV,MACF,CAEA,MAAMI,EAAU,UAAU,KAAKP,GAASC,EAAU,EAElDM,EAAQ,QAAU,IAAM,CACtB,QAAQ,MAAM,iCAAiC,EAC/CD,EAAOC,EAAQ,KAAK,CACtB,EAEAA,EAAQ,UAAY,IAAM,CACxBJ,GAAKI,EAAQ,OACbF,EAAQF,EAAE,CACZ,EAEAI,EAAQ,gBAAmBC,GAAU,CACnC,MAAMC,EAAWD,EAAM,OAAO,OAuC9B,GApCKC,EAAS,iBAAiB,SAASP,GAAO,QAAQ,GAChCO,EAAS,kBAAkBP,GAAO,SAAU,CAAE,QAAS,IAAI,CAAE,EACrE,YAAY,aAAc,aAAc,CAAE,OAAQ,EAAK,CAAE,EAInEO,EAAS,iBAAiB,SAASP,GAAO,KAAK,GAChCO,EAAS,kBAAkBP,GAAO,MAAO,CAAE,QAAS,IAAI,CAAE,EAClE,YAAY,aAAc,aAAc,CAAE,OAAQ,EAAK,CAAE,EAIhEO,EAAS,iBAAiB,SAASP,GAAO,aAAa,GACrCO,EAAS,kBAAkBP,GAAO,cAAe,CAAE,QAAS,IAAI,CAAE,EAC1E,YAAY,aAAc,aAAc,CAAE,OAAQ,EAAK,CAAE,EAInEO,EAAS,iBAAiB,SAASP,GAAO,UAAU,GACnCO,EAAS,kBAAkBP,GAAO,WAAY,CAAE,QAAS,IAAI,CAAE,EACvE,YAAY,aAAc,aAAc,CAAE,OAAQ,EAAK,CAAE,EAIlEO,EAAS,iBAAiB,SAASP,GAAO,aAAa,GACtCO,EAAS,kBAAkBP,GAAO,cAAe,CAAE,QAAS,IAAI,CAAE,EAC1E,YAAY,aAAc,aAAc,CAAE,OAAQ,EAAK,CAAE,EAIlEO,EAAS,iBAAiB,SAASP,GAAO,QAAQ,GAChCO,EAAS,kBAAkBP,GAAO,SAAU,CAAE,QAAS,IAAI,CAAE,EACrE,YAAY,aAAc,aAAc,CAAE,OAAQ,EAAK,CAAE,EAIpE,CAACO,EAAS,iBAAiB,SAASP,GAAO,eAAe,EAAG,CAC/D,MAAMQ,EAAeD,EAAS,kBAAkBP,GAAO,gBAAiB,CACtE,QAAS,KACT,cAAe,EACzB,CAAS,EACDQ,EAAa,YAAY,OAAQ,OAAQ,CAAE,OAAQ,EAAK,CAAE,EAC1DA,EAAa,YAAY,aAAc,aAAc,CAAE,OAAQ,EAAK,CAAE,CACxE,CAGKD,EAAS,iBAAiB,SAASP,GAAO,WAAW,GACxDO,EAAS,kBAAkBP,GAAO,YAAa,CAAE,QAAS,KAAK,CAAE,CAErE,CACF,CAAC,EAIGS,GAAW,CAACC,EAAWC,EAAO,aAAe,CACjD,GAAI,CAACV,GAAI,MAAM,IAAI,MAAM,0BAA0B,EAEnD,OADWA,GAAG,YAAYS,EAAWC,CAAI,EAC/B,YAAYD,CAAS,CACjC,EAGaE,GAAc,MAAOF,EAAWG,KAC3C,MAAMX,GAAa,EACZ,IAAI,QAAQ,CAACC,EAASC,IAAW,CAEtC,MAAMC,EADQI,GAASC,EAAW,WAAW,EACvB,IAAIG,CAAI,EAC9BR,EAAQ,UAAY,IAAMF,EAAQE,EAAQ,MAAM,EAChDA,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,CAC9C,CAAC,GAIUS,GAAiB,MAAOJ,EAAWK,KAC9C,MAAMb,GAAa,EACZ,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,MAAMY,EAAKf,GAAG,YAAYS,EAAW,WAAW,EAC1CO,EAAQD,EAAG,YAAYN,CAAS,EAEtCK,EAAM,QAAQG,GAAQD,EAAM,IAAIC,CAAI,CAAC,EAErCF,EAAG,WAAa,IAAMb,EAAO,EAC7Ba,EAAG,QAAU,IAAMZ,EAAOY,EAAG,KAAK,CACpC,CAAC,GAIUG,GAAe,MAAOT,EAAWzB,KAC5C,MAAMiB,GAAa,EACZ,IAAI,QAAQ,CAACC,EAASC,IAAW,CAEtC,MAAMC,EADQI,GAASC,CAAS,EACV,IAAIzB,CAAG,EAC7BoB,EAAQ,UAAY,IAAMF,EAAQE,EAAQ,MAAM,EAChDA,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,CAC9C,CAAC,GAIUe,GAAkB,MAAOV,IACpC,MAAMR,GAAa,EACZ,IAAI,QAAQ,CAACC,EAASC,IAAW,CAEtC,MAAMC,EADQI,GAASC,CAAS,EACV,OAAM,EAC5BL,EAAQ,UAAY,IAAMF,EAAQE,EAAQ,QAAU,EAAE,EACtDA,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,CAC9C,CAAC,GAIUgB,GAAa,MAAOX,EAAWY,EAAWC,KACrD,MAAMrB,GAAa,EACZ,IAAI,QAAQ,CAACC,EAASC,IAAW,CAGtC,MAAMC,EAFQI,GAASC,CAAS,EACZ,MAAMY,CAAS,EACb,OAAOC,CAAK,EAClClB,EAAQ,UAAY,IAAMF,EAAQE,EAAQ,QAAU,EAAE,EACtDA,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,CAC9C,CAAC,GAIUmB,GAAkB,MAAOd,EAAWzB,KAC/C,MAAMiB,GAAa,EACZ,IAAI,QAAQ,CAACC,EAASC,IAAW,CAEtC,MAAMC,EADQI,GAASC,EAAW,WAAW,EACvB,OAAOzB,CAAG,EAChCoB,EAAQ,UAAY,IAAMF,EAAO,EACjCE,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,CAC9C,CAAC,GAkBUoB,GAAe,CAC1B,mBAAoB,qBACpB,iBAAkB,mBAClB,kBAAmB,oBACnB,oBAAqB,sBACrB,aAAc,eACd,wBAAyB,yBAC3B,EAGaC,GAAmB,MAAOC,EAAMC,EAASC,EAAW,KAAO,CACtE,MAAM3B,GAAa,EACnB,MAAM4B,EAAS,CACb,KAAAH,EACA,QAAAC,EACA,SAAAC,EACA,WAAY,IAAI,KAAI,EAAG,YAAW,EAClC,SAAU,EACV,WAAY,IAChB,EAEE,OAAO,IAAI,QAAQ,CAAC1B,EAASC,IAAW,CAEtC,MAAMC,EADQI,GAAST,GAAO,gBAAiB,WAAW,EACpC,IAAI8B,CAAM,EAChCzB,EAAQ,UAAY,IAAM,CACxBF,EAAQE,EAAQ,MAAM,CACxB,EACAA,EAAQ,QAAU,IAAMD,EAAOC,EAAQ,KAAK,CAC9C,CAAC,CACH,EAGa0B,GAAoB,SACxBX,GAAgBpB,GAAO,eAAe,EAIlCgC,GAAwB,UACnB,MAAMD,GAAiB,GACxB,OAIJE,GAAsB,MAAOC,GACjCV,GAAgBxB,GAAO,gBAAiBkC,CAAE,EAItCC,GAAsB,MAAOD,EAAIE,KAC5C,MAAMlC,GAAa,EACZ,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,MAAMa,EAAQR,GAAST,GAAO,gBAAiB,WAAW,EACpDqC,EAAapB,EAAM,IAAIiB,CAAE,EAE/BG,EAAW,UAAY,IAAM,CAC3B,MAAMP,EAASO,EAAW,OAC1B,GAAIP,EAAQ,CACV,MAAMQ,EAAU,CAAE,GAAGR,EAAQ,GAAGM,CAAO,EACjCG,EAAatB,EAAM,IAAIqB,CAAO,EACpCC,EAAW,UAAY,IAAMpC,EAAQmC,CAAO,EAC5CC,EAAW,QAAU,IAAMnC,EAAOmC,EAAW,KAAK,CACpD,MACEnC,EAAO,IAAI,MAAM,kBAAkB,CAAC,CAExC,EACAiC,EAAW,QAAU,IAAMjC,EAAOiC,EAAW,KAAK,CACpD,CAAC,GAQUG,GAAgB,MAAOC,GAC3B3B,GAAed,GAAO,SAAUyC,CAAQ,EAIpCC,GAAoB,MAAOC,GAClCA,EACKtB,GAAWrB,GAAO,SAAU,aAAc2C,CAAS,EAErDvB,GAAgBpB,GAAO,QAAQ,EAI3B4C,GAAa,MAAOC,GAAU,CACzC,MAAMvD,EAAUuD,EAAM,IAAIhE,GAAKM,GAAgBN,EAAG,CAAC,SAAU,SAAU,MAAM,CAAC,CAAC,EAC/E,OAAOiC,GAAed,GAAO,MAAOV,CAAO,CAC7C,EAGawD,GAAiB,MAAOC,GAC5B1B,GAAWrB,GAAO,MAAO,aAAc+C,CAAS,EAI5CC,GAAyB,MAAOC,EAAQC,IAAW,CAC9D,MAAMC,EAAO,MAAMhC,GAAanB,GAAO,MAAOiD,CAAM,EACpD,OAAIE,IACFA,EAAK,OAASD,EACdC,EAAK,WAAa,IAAI,KAAI,EAAG,YAAW,EACxCA,EAAK,mBAAqB,IAAI,KAAI,EAAG,YAAW,EAChD,MAAMvC,GAAYZ,GAAO,MAAOmD,CAAI,GAE/BA,CACT,EAGaC,GAAmB,MAAOC,GAC9BzC,GAAYZ,GAAO,cAAeqD,CAAO,EAgBrCC,GAAgB,MAAOC,GAC3B3C,GAAYZ,GAAO,WAAYuD,CAAM,EASjCC,GAAiB,IAAM,CAClC,MAAMC,EAAQ,IAAI,WAAW,CAAC,EAC9B,OAAO,gBAAgBA,CAAK,EAC5B,MAAMC,EAAa,MAAM,KAAKD,EAAO3E,GAAKA,EAAE,SAAS,EAAE,CAAC,EAAE,KAAK,EAAE,EACjE,MAAO,QAAQ,KAAK,IAAG,CAAE,IAAI4E,CAAU,EACzC,EAOaC,GAAmB,MAAOC,GAC9BhD,GAAYZ,GAAO,cAAe4D,CAAM,EAIpCC,GAAuB,MAAOd,EAAWe,KACpC,MAAMzC,GAAWrB,GAAO,cAAe,aAAc+C,CAAS,GAC/D,KAAKgB,GAAKA,EAAE,cAAgBD,CAAI,GAAK,KAQzCE,GAAe,MAAOC,GAC1BrD,GAAYZ,GAAO,SAAUiE,CAAO,EAa7C,IAAIC,GAAW,OAAO,UAAc,IAAc,UAAU,OAAS,GACrE,MAAMC,GAAY,IAAI,IAGTC,GAAsBC,IACjCF,GAAU,IAAIE,CAAQ,EACf,IAAMF,GAAU,OAAOE,CAAQ,GAI3BC,GAAsB,IAAMJ,GAGnCK,GAA0BC,GAAW,CACzCN,GAAWM,EACXL,GAAU,QAAQE,GAAYA,EAASG,CAAM,CAAC,CAChD,EAGI,OAAO,OAAW,MACpB,OAAO,iBAAiB,SAAU,IAAM,CACtCD,GAAuB,EAAI,CAC7B,CAAC,EAED,OAAO,iBAAiB,UAAW,IAAM,CACvCA,GAAuB,EAAK,CAC9B,CAAC,GAOH,IAAIE,GAAY,GAGT,MAAMC,GAAqB,MAAOzE,EAAI0E,EAAU,KAAO,CAC5D,GAAIF,IAAa,CAACP,GAAU,MAAO,CAAE,OAAQ,EAAG,OAAQ,EAAG,UAAW,EAAE,EAExE,KAAM,CAAE,WAAAU,CAAU,EAAKD,EACvBF,GAAY,GACZ,MAAMI,EAAU,CAAE,OAAQ,EAAG,OAAQ,EAAG,UAAW,EAAE,EAErD,GAAI,CACF,MAAMC,EAAU,MAAM/C,GAAiB,EAEvC,UAAWD,KAAUgD,EACnB,GAAI,CAEF,GAAIhD,EAAO,SAAS,IAAMA,EAAO,OAASL,GAAa,mBAAoB,CACzE,MAAM3D,EAAe,MAAMiH,GAAkB9E,EAAI6B,EAAO,KAAMA,EAAO,OAAO,EAC5E,GAAIhE,EAAc,CAChB,MAAMkH,EAAe,MAAM7D,GAAanB,GAAO,MAAO8B,EAAO,QAAQ,QAAUA,EAAO,QAAQ,EAAE,EAChG,GAAIkD,EAAc,CAChB,MAAMC,EAAWrH,GAAeoH,EAAclH,EAAc,CAAC,QAAQ,CAAC,EACtE,GAAImH,EAAS,YAAa,CACxB,MAAMC,EAAU3F,GAAqB0F,EAAU,MAAM,EAIrD,GAHAJ,EAAQ,UAAU,KAAK,CAAE,OAAA/C,EAAQ,SAAAmD,EAAU,QAAAC,CAAO,CAAE,EAGhDN,GACiB,MAAMA,EAAW,CAAE,OAAA9C,EAAQ,SAAAmD,EAAU,QAAAC,CAAO,CAAE,IAC9ChG,GAAsB,YAAa,CAEpD,MAAM+C,GAAoBH,EAAO,EAAE,EACnC,QACF,CAIJ,CACF,CACF,CACF,CAEA,MAAMqD,GAAcrD,EAAQ7B,CAAE,EAC9B,MAAMgC,GAAoBH,EAAO,EAAE,EACnC+C,EAAQ,QACV,OAASO,EAAO,CACdP,EAAQ,SAGR,MAAM1C,GAAoBL,EAAO,GAAI,CACnC,UAAWA,EAAO,UAAY,GAAK,EACnC,WAAYsD,EAAM,QAClB,aAAc,IAAI,KAAI,EAAG,YAAW,CAC9C,CAAS,CACH,CAEJ,QAAC,CACCX,GAAY,EACd,CAEA,OAAOI,CACT,EAGME,GAAoB,MAAO9E,EAAIoF,EAAYzD,IAAY,CAC3D,GAAI,CACF,OAAQyD,EAAU,CAChB,KAAK5D,GAAa,mBAChB,OAAOxB,EAAG,QAAU,MAAMA,EAAG,QAAQ2B,EAAQ,MAAM,EAAI,KACzD,QACE,OAAO,IACf,CACE,MAAQ,CACN,OAAO,IACT,CACF,EAGMuD,GAAgB,MAAOrD,EAAQ7B,IAAO,CAC1C,KAAM,CAAE,KAAA0B,EAAM,QAAAC,GAAYE,EAE1B,OAAQH,EAAI,CACV,KAAKF,GAAa,mBAChB,OAAOxB,EAAG,iBAAiB2B,EAAQ,OAAQA,EAAQ,MAAM,EAE3D,KAAKH,GAAa,iBAAkB,CAElC,MAAM8B,EAAS,MAAMtD,EAAG,eAAe2B,EAAQ,MAAM,EACrD,OAAIA,EAAQ,SAAS,OAAS,GAC5B,MAAM3B,EAAG,aAAasD,EAAO,GAAI3B,EAAQ,OAAO,EAE9CA,EAAQ,OAAO,OAAS,GAC1B,MAAM3B,EAAG,WAAWsD,EAAO,GAAI3B,EAAQ,KAAK,EAGvC2B,CACT,CAEA,KAAK9B,GAAa,kBAChB,OAAOxB,EAAG,gBACR2B,EAAQ,UACRA,EAAQ,QACRA,EAAQ,WAChB,EAEI,KAAKH,GAAa,oBAChB,aAAMxB,EAAG,gBAAgB2B,EAAQ,UAAWA,EAAQ,UAAU,EACvD3B,EAAG,kBAAkB2B,EAAQ,UAAWA,EAAQ,WAAW,EAEpE,KAAKH,GAAa,aAChB,OAAOxB,EAAG,YACR2B,EAAQ,UACRA,EAAQ,WACRA,EAAQ,WACRA,EAAQ,OAChB,EAEI,KAAKH,GAAa,wBAChB,OAAOxB,EAAG,sBACR2B,EAAQ,UACRA,EAAQ,MACRA,EAAQ,YACRA,EAAQ,SACRA,EAAQ,SACRA,EAAQ,KAChB,EAEI,QACE,MAAM,IAAI,MAAM,wBAAwBD,CAAI,EAAE,CACpD,CACA,EC3gBM2D,GAAmD,GACnDC,GAA4D,GAGrDC,EAAuB,EAAQF,GAG/BG,EAAWD,EACpBE,GAAaJ,GAAaC,EAAe,EACzC,KCDEI,GAAS,CAEb,mBAAoB,IAMpB,eAAgBH,CAIlB,EAQaI,GAAU,CAYrB,MAAMC,EAAWC,EAAS,CACxB,MAAMxF,EAAQ,CACZ,KAAM,QACN,UAAAuF,EACA,YAAaC,EAAQ,SACrB,cAAeA,EAAQ,KACvB,WAAYA,EAAQ,YAAc,KAClC,WAAYA,EAAQ,YAAc,KAClC,QAASA,EAAQ,SAAW,KAC5B,UAAW,IAAI,OAAO,aAAY,EAWhCH,GAAO,gBAAkBG,EAAQ,UAAYH,GAAO,oBACtDI,GAAc,QAASzF,CAAK,CAEhC,EAeA,MAAM0F,EAAUF,EAAS,CACvB,MAAMxF,EAAQ,CACZ,KAAM,QACN,SAAA0F,EACA,SAAUF,EAAQ,UAAY,QAC9B,WAAYA,EAAQ,MAAQ,KAC5B,QAASA,EAAQ,QACjB,WAAYA,EAAQ,YAAc,KAClC,QAASA,EAAQ,SAAW,KAC5B,WAAYA,EAAQ,YAAc,KAClC,UAAWA,EAAQ,WAAa,KAChC,QAASA,EAAQ,OAAS,GAC1B,UAAW,IAAI,OAAO,aAAY,EAgBhCH,GAAO,gBACTI,GAAc,QAASzF,CAAK,CAEhC,EAQA,QAAQuF,EAAWC,EAAS,CAC1B,MAAMxF,EAAQ,CACZ,KAAM,UACN,UAAAuF,EACA,WAAYC,EAAQ,YAAc,KAClC,WAAYA,EAAQ,YAAc,KAClC,gBAAiBA,EAAQ,MAAQ,EACjC,YAAaA,EAAQ,UAAY,EACjC,QAASA,EAAQ,UAAY,GAC7B,cAAeA,EAAQ,OAAS,KAChC,UAAW,IAAI,OAAO,aAAY,EAUhCH,GAAO,iBAAmB,CAACrF,EAAM,SAAWA,EAAM,YAAc,MAClEyF,GAAc,UAAWzF,CAAK,CAElC,EAQA,SAASwB,EAAQgE,EAAS,CAK1B,CACF,EAKA,eAAeC,GAAcpE,EAAMrB,EAAO,CAExC,GAAKmF,EAEL,GAAI,CACE9D,IAAS,QACX,MAAM8D,EAAS,IAAI,YAAa,CAC9B,WAAYnF,EAAM,SAClB,WAAYA,EAAM,SAClB,UAAWA,EAAM,QACjB,aAAcA,EAAM,WACpB,UAAWA,EAAM,QACjB,aAAcA,EAAM,WACpB,YAAaA,EAAM,UACnB,aAAcA,EAAM,WACpB,UAAWA,EAAM,SAAW,EAAC,CAC9B,EACQqB,IAAS,SAClB,MAAM8D,EAAS,IAAI,mBAAoB,CACrC,YAAanF,EAAM,UACnB,cAAeA,EAAM,YACrB,gBAAiBA,EAAM,cACvB,aAAcA,EAAM,WACpB,aAAcA,EAAM,WACpB,UAAWA,EAAM,QACjB,UAAW,EAAC,CACb,CAGL,MAAc,CAKd,CACF,CAUAsF,GAAQ,UAAY,SAASK,EAAeC,EAAI,CAC9C,OAAO,kBAAkBC,EAAM,CAC7B,MAAMC,EAAQ,YAAY,MAC1B,GAAI,CACF,MAAMC,EAAS,MAAMH,EAAG,MAAM,KAAMC,CAAI,EAIlCL,EAAU,CACd,SAJe,KAAK,MAAM,YAAY,MAAQM,CAAK,EAKnD,KAAM,MAAM,QAAQC,CAAM,EAAIA,EAAO,OAAS,QAGhD,OAAAT,GAAQ,MAAMK,EAAeH,CAAO,EAC7BO,CACT,OAASjB,EAAO,CACd,MAAMkB,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EACrD,MAAAR,GAAQ,MAAM,WAAY,CACxB,QAASR,EAAM,QACf,UAAWa,EACX,SAAU,QACV,MAAO,CAAE,SAAAK,CAAA,CAAS,CACnB,EACKlB,CACR,CACF,CACF,EAUAQ,GAAQ,KAAO,eAAeK,EAAeC,EAAI,CAC/C,MAAME,EAAQ,YAAY,MAC1B,GAAI,CACF,MAAMC,EAAS,MAAMH,EAAA,EACfI,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EACrD,OAAAR,GAAQ,MAAMK,EAAe,CAAE,SAAAK,CAAA,CAAU,EAClCD,CACT,OAASjB,EAAO,CACd,MAAAQ,GAAQ,MAAM,UAAW,CACvB,QAASR,EAAM,QACf,UAAWa,CAAA,CACZ,EACKb,CACR,CACF,EC/PA,MAAMmB,GAAoB,0BAG1B,IAAIC,GAAmB,KAMhB,MAAMC,GAAkB,IAAM,CACnC,GAAID,GAAkB,OAAOA,GAE7B,GAAI,CACF,MAAME,EAAS,eAAe,QAAQH,EAAiB,EACvD,GAAIG,EACF,OAAAF,GAAmB,KAAK,MAAME,CAAM,EAC7BF,EAEX,MAAY,CAEZ,CACA,OAAO,IACT,EAMaG,GAAmBC,GAAY,CAC1CJ,GAAmBI,EACfA,EACF,eAAe,QAAQL,GAAmB,KAAK,UAAUK,CAAO,CAAC,EAEjE,eAAe,WAAWL,EAAiB,CAE/C,EAMaM,GAAoB,SAAY,CAC3C,MAAMD,EAAUH,GAAe,EAC/B,GAAIG,GAAS,OAASpB,EAEpB,GAAI,CACF,MAAMC,EAAS,IAAI,2BAA4B,CAAE,gBAAiBmB,EAAQ,KAAK,CAAE,CACnF,MAAY,CAEZ,CAEFD,GAAgB,IAAI,CACtB,EAGA,IAAIG,GAAc,KAOX,MAAMC,GAAiB,IAAM,CAClC,MAAMH,EAAUH,GAAe,EAC/B,MAAI,CAACG,GAAS,OAAS,CAACpB,EAA6BC,IAGjD,CAACqB,IAAeA,GAAY,gBAAkBF,EAAQ,SACxDE,GAAcpB,GAAaJ,GAAaC,GAAiB,CACvD,OAAQ,CACN,QAAS,CACP,kBAAmBqB,EAAQ,KACrC,CACA,CACA,CAAK,EACDE,GAAY,cAAgBF,EAAQ,OAG/BE,GACT,EAOaE,GAAoB,IACfP,GAAe,GACf,MAAQM,KAAmBtB,EAQhCwB,EAAY,IAClBzB,EACWiB,GAAe,GACf,MAAQM,KAAmBtB,EAFT,KASvByB,GAAc,IAAM,CAC/B,MAAMN,EAAUH,GAAe,EAC/B,MAAO,GAAQG,GAAS,OAASA,GAAS,UAC5C,ECpHMO,GAAc,iBACdC,GAAW,iBAEXC,GAAqB,CAAE,SAAU,GAAI,MAAO,GAAI,MAAO,GAAI,YAAa,EAAE,EAEnEC,EAAe,IAAM,CAChC,GAAI,CACF,MAAMzG,EAAO,aAAa,QAAQsG,EAAW,EAC7C,OAAOtG,EAAO,KAAK,MAAMA,CAAI,EAAIwG,EACnC,MAAQ,CACN,oBAAa,WAAWF,EAAW,EAC5BE,EACT,CACF,EAEaE,GAAgB1G,GAAS,CACpC,aAAa,QAAQsG,GAAa,KAAK,UAAUtG,CAAI,CAAC,CACxD,EAEa2G,GAAe,IAAM,CAChC,GAAI,CACF,MAAMC,EAAO,aAAa,QAAQL,EAAQ,EAC1C,OAAOK,EAAO,KAAK,MAAMA,CAAI,EAAI,IACnC,MAAQ,CACN,oBAAa,WAAWL,EAAQ,EACzB,IACT,CACF,EAEaM,GAAgBD,GAAS,CAChCA,EACF,aAAa,QAAQL,GAAU,KAAK,UAAUK,CAAI,CAAC,EAEnD,aAAa,WAAWL,EAAQ,CAEpC,EC3BaO,GAAS,CAEpB,MAAM,UAAUC,EAASC,EAAa,EAAG,CACvC,GAAIrC,EAAsB,CAExB,IAAIsC,EAAYF,EAAQ,WACpBC,EAAa,IACfC,EAAY,MAAM,KAAK,iBAAiBF,EAAQ,UAAU,GAG5D,KAAM,CAAE,KAAA/G,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,WAAYmC,EAAQ,WACpB,WAAYA,EAAQ,WACpB,QAASA,EAAQ,SAAW,KAC5B,WAAYE,EACZ,MAAOF,EAAQ,MACf,YAAaA,EAAQ,aAAe,GACpC,cAAeA,EAAQ,cACvB,aAAcA,EAAQ,aACtB,WAAYA,EAAQ,WACpB,OAAQ,QAER,qBAAsBA,EAAQ,sBAAwB,KACtD,yBAA0BA,EAAQ,0BAA4B,KAC9D,yBAA0BA,EAAQ,0BAA4B,KAC9D,8BAA+BA,EAAQ,+BAAiC,IAExE,4BAA6BA,EAAQ,6BAA+B,IACpE,aAAcA,EAAQ,cAAgB,IACtC,oBAAqBA,EAAQ,qBAAuB,GACpD,WAAYA,EAAQ,YAAc,IAC5C,CAAS,EACA,OAAM,EACN,OAAM,EAST,IALmBxC,GAAO,OAAS,SAChBA,GAAO,OAAS,YAChBA,GAAO,SAAW,KAClBA,GAAO,SAAS,SAAS,WAAW,GACpCA,GAAO,SAAS,SAAS,mBAAmB,IAC7CyC,EAAa,EAC7B,eAAQ,KAAK,4DAA4DA,EAAa,CAAC,GAAG,EACnF,KAAK,UAAUD,EAASC,EAAa,CAAC,EAG/C,GAAIzC,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,UAAUkH,EAAO3F,EAAS,CAC9B,GAAIoD,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,GAAGrD,EACH,WAAY,IAAI,KAAI,EAAG,YAAW,CAC5C,CAAS,EACA,GAAG,KAAM2F,CAAK,EACd,OAAM,EACN,OAAM,EACT,GAAI3C,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,UAAUkH,EAAO,CACrB,GAAIvC,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EACrB,KAAK,eAAe,EACpB,OAAM,EACN,GAAG,KAAMsC,CAAK,EACjB,GAAI3C,EAAO,MAAMA,CACnB,CACF,EAIA,MAAM,mBAAmB4C,EAAQC,EAAW,CAC1C,GAAIzC,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EACrB,KAAK,eAAe,EACpB,OAAO,CAAE,WAAYwC,EAAW,WAAY,IAAI,KAAI,EAAG,aAAa,CAAE,EACtE,GAAG,KAAMD,CAAM,EAClB,GAAI5C,EAEF,MAAIA,EAAM,SAAS,SAAS,YAAY,GAAKA,EAAM,OAAS,WACpD,IAAI,MAAM,wHAAwH,EAEpIA,CAEV,CACF,EAGA,MAAM,QAAQrC,EAAWmF,EAAU,GAAI,CACrC,GAAI1C,EAAsB,CACxB,IAAI2C,EAAQ1C,EACT,KAAK,eAAe,EACpB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAQP,EACA,GAAG,aAAc1C,CAAS,EAGzBmF,EAAQ,SACVC,EAAQA,EAAM,GAAG,SAAUD,EAAQ,MAAM,GAEvCA,EAAQ,UACVC,EAAQA,EAAM,GAAG,UAAWD,EAAQ,OAAO,GAEzCA,EAAQ,aACVC,EAAQA,EAAM,IAAI,eAAgBD,EAAQ,UAAU,GAElDA,EAAQ,WACVC,EAAQA,EAAM,IAAI,aAAcD,EAAQ,QAAQ,GAGlDC,EAAQA,EAAM,MAAM,aAAc,CAAE,UAAW,EAAK,CAAE,EAEtD,KAAM,CAAE,KAAAtH,EAAM,MAAAuE,CAAK,EAAK,MAAM+C,EAC9B,GAAI/C,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAGA,MAAM,WAAWkH,EAAO,CACtB,GAAIvC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAkBP,EACA,GAAG,KAAMsC,CAAK,EACd,OAAM,EACT,GAAI3C,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,cAAckC,EAAWE,EAAQ,CACrC,GAAIuC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,GAAG,EACV,GAAG,aAAc1C,CAAS,EAC1B,GAAG,UAAWE,CAAM,EACpB,MAAM,aAAc,CAAE,UAAW,EAAK,CAAE,EAC3C,GAAImC,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAKA,MAAM,kBAAkBkC,EAAW,CACjC,GAAIyC,EAAsB,CACxB,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EAAQ,MAAO,GACpB,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,eAAe,EACpB,OAAO,0CAA0C,EACjD,GAAG,aAAcrF,CAAS,EAC1B,GAAG,SAAU,CAAC,QAAS,mBAAoB,UAAU,CAAC,EACtD,MAAM,aAAc,CAAE,UAAW,EAAI,CAAE,EAC1C,GAAIqC,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,CACA,MAAO,EACT,EAGA,MAAM,iBAAiBkC,EAAW,CAChC,GAAIyC,EAAsB,CAExB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,YAAY,EACnB,GAAG,aAAc1C,CAAS,EAE7B,GAAIqC,EAAO,MAAMA,EAEjB,GAAIvE,GAAQA,EAAK,OAAS,EAAG,CAE3B,IAAIwH,EAAY,EAChB,UAAWC,KAAOzH,EAAM,CACtB,MAAM0H,EAAQD,EAAI,YAAY,MAAM,YAAY,EAChD,GAAIC,EAAO,CACT,MAAMC,EAAM,SAASD,EAAM,CAAC,CAAC,EACzBC,EAAMH,IAAWA,EAAYG,EACnC,CACF,CACA,MAAO,QAAQH,EAAY,CAAC,EAC9B,CACA,MAAO,QACT,CACA,MAAO,QACT,EAMA,MAAM,gBAAgBN,EAAOU,EAAW,CACtC,GAAIjD,EAAsB,CAExB,MAAMkD,EAAe,KAAK,MAAMD,EAAU,cAAgBA,EAAU,YAAY,EAC1EE,EAAgB,KAAK,MAAMF,EAAU,eAAiBA,EAAU,aAAa,EAC7EG,EAAQF,EAAeC,EAEvB,CAAE,KAAA9H,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,oBAAoB,EACzB,OAAO,CACN,gBAAiBsC,EACjB,YAAaU,EAAU,YACvB,UAAWA,EAAU,WAAa,WAClC,cAAeA,EAAU,eAAiB,EAC1C,eAAgBA,EAAU,gBAAkB,EAC5C,aAAcA,EAAU,cAAgB,EACxC,cAAeA,EAAU,eAAiB,EAC1C,cAAeC,EACf,eAAgBC,EAChB,MAAOC,EACP,WAAYH,EAAU,YAAc,EACpC,iBAAkBA,EAAU,kBAAoB,IAC1D,CAAS,EACA,OAAM,EACN,OAAM,EACT,GAAIrD,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,mBAAmBgI,EAAQzG,EAAS,CACxC,GAAIoD,EAAsB,CAExB,IAAIsD,EAAa,CAAE,GAAG1G,CAAO,EAC7B,GAAIA,EAAQ,gBAAkB,QAAaA,EAAQ,eAAiB,QAChEA,EAAQ,iBAAmB,QAAaA,EAAQ,gBAAkB,OAAW,CAE/E,KAAM,CAAE,KAAM2G,CAAO,EAAK,MAAMtD,EAC7B,KAAK,oBAAoB,EACzB,OAAO,4DAA4D,EACnE,GAAG,KAAMoD,CAAM,EACf,OAAM,EAEHG,EAAW5G,EAAQ,eAAiB2G,GAAS,eAAiB,EAC9DE,EAAU7G,EAAQ,gBAAkB2G,GAAS,gBAAkB,EAC/DG,EAAU9G,EAAQ,cAAgB2G,GAAS,cAAgB,EAC3DI,EAAS/G,EAAQ,eAAiB2G,GAAS,eAAiB,EAElED,EAAW,cAAgB,KAAK,MAAME,EAAWE,CAAO,EACxDJ,EAAW,eAAiB,KAAK,MAAMG,EAAUE,CAAM,EACvDL,EAAW,MAAQA,EAAW,cAAgBA,EAAW,cAC3D,CAEA,KAAM,CAAE,KAAAjI,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,oBAAoB,EACzB,OAAOqD,CAAU,EACjB,GAAG,KAAMD,CAAM,EACf,OAAM,EACN,OAAM,EACT,GAAIzD,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,mBAAmBgI,EAAQ,CAC/B,GAAIrD,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EACrB,KAAK,oBAAoB,EACzB,OAAM,EACN,GAAG,KAAMoD,CAAM,EAClB,GAAIzD,EAAO,MAAMA,CACnB,CACF,EAMA,MAAM,mBAAmB2C,EAAOqB,EAAc,CAC5C,GAAI5D,EAAsB,CAExB,MAAM6D,EADqB,CAAC,eAAgB,UAAW,eAAgB,SAAU,eAAgB,QAAQ,EACnE,SAASD,EAAa,WAAW,EAAIA,EAAa,YAAc,SAChGE,EAAW,KAAK,MAAM,OAAOF,EAAa,SAAS,GAAK,CAAC,EACzDG,EAAW,OAAOH,EAAa,QAAQ,GAAK,EAC5CR,EAAQ,KAAK,MAAMW,EAAWD,CAAQ,EAEtC,CAAE,KAAAzI,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,wBAAwB,EAC7B,OAAO,CACN,gBAAiBsC,EACjB,YAAaqB,EAAa,aAAe,GACzC,SAAUG,EACV,KAAMH,EAAa,MAAQ,OAC3B,UAAWE,EACX,MAAOV,EACP,YAAaS,EACb,iBAAkBD,EAAa,kBAAoB,KACnD,iBAAkBA,EAAa,kBAAoB,KACnD,WAAYA,EAAa,YAAc,CACjD,CAAS,EACA,OAAM,EACN,OAAM,EACT,GAAIhE,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,sBAAsBgI,EAAQzG,EAAS,CAC3C,GAAIoD,EAAsB,CACxB,IAAIsD,EAAa,CAAE,GAAG1G,CAAO,EAC7B,GAAIA,EAAQ,WAAa,QAAaA,EAAQ,YAAc,OAAW,CACrE,KAAM,CAAE,KAAM2G,CAAO,EAAK,MAAMtD,EAC7B,KAAK,wBAAwB,EAC7B,OAAO,qBAAqB,EAC5B,GAAG,KAAMoD,CAAM,EACf,OAAM,EAEHW,EAAMpH,EAAQ,UAAY2G,GAAS,UAAY,EAC/CU,EAAOrH,EAAQ,WAAa2G,GAAS,WAAa,EACxDD,EAAW,MAAQ,KAAK,MAAMU,EAAMC,CAAI,CAC1C,CAEA,KAAM,CAAE,KAAA5I,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,wBAAwB,EAC7B,OAAOqD,CAAU,EACjB,GAAG,KAAMD,CAAM,EACf,OAAM,EACN,OAAM,EACT,GAAIzD,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,sBAAsBgI,EAAQ,CAClC,GAAIrD,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EACrB,KAAK,wBAAwB,EAC7B,OAAM,EACN,GAAG,KAAMoD,CAAM,EAClB,GAAIzD,EAAO,MAAMA,CACnB,CACF,EAMA,MAAM,oBAAoB2C,EAAO2B,EAAe,CAC9C,GAAIlE,EAAsB,CAExB,MAAM6D,EADqB,CAAC,eAAgB,UAAW,SAAU,eAAgB,QAAQ,EACnD,SAASK,EAAc,WAAW,EAAIA,EAAc,YAAc,SAClGJ,EAAW,KAAK,MAAM,OAAOI,EAAc,SAAS,GAAK,CAAC,EAC1DH,EAAW,OAAOG,EAAc,QAAQ,GAAK,EAC7Cd,EAAQ,KAAK,MAAMW,EAAWD,CAAQ,EAEtC,CAAE,KAAAzI,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,wBAAwB,EAC7B,OAAO,CACN,gBAAiBsC,EACjB,YAAa2B,EAAc,aAAe,GAC1C,SAAUH,EACV,KAAMG,EAAc,MAAQ,MAC5B,UAAWJ,EACX,MAAOV,EACP,YAAaS,EACb,iBAAkBK,EAAc,kBAAoB,KACpD,iBAAkBA,EAAc,kBAAoB,KACpD,WAAYA,EAAc,YAAc,CAClD,CAAS,EACA,OAAM,EACN,OAAM,EACT,GAAItE,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,uBAAuBgI,EAAQzG,EAAS,CAC5C,GAAIoD,EAAsB,CACxB,IAAIsD,EAAa,CAAE,GAAG1G,CAAO,EAC7B,GAAIA,EAAQ,WAAa,QAAaA,EAAQ,YAAc,OAAW,CACrE,KAAM,CAAE,KAAM2G,CAAO,EAAK,MAAMtD,EAC7B,KAAK,wBAAwB,EAC7B,OAAO,qBAAqB,EAC5B,GAAG,KAAMoD,CAAM,EACf,OAAM,EAEHW,EAAMpH,EAAQ,UAAY2G,GAAS,UAAY,EAC/CU,EAAOrH,EAAQ,WAAa2G,GAAS,WAAa,EACxDD,EAAW,MAAQ,KAAK,MAAMU,EAAMC,CAAI,CAC1C,CAEA,KAAM,CAAE,KAAA5I,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,wBAAwB,EAC7B,OAAOqD,CAAU,EACjB,GAAG,KAAMD,CAAM,EACf,OAAM,EACN,OAAM,EACT,GAAIzD,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,uBAAuBgI,EAAQ,CACnC,GAAIrD,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EACrB,KAAK,wBAAwB,EAC7B,OAAM,EACN,GAAG,KAAMoD,CAAM,EAClB,GAAIzD,EAAO,MAAMA,CACnB,CACF,EAMA,MAAM,wBAAwB2C,EAAO4B,EAAS,CAC5C,GAAInE,EAAsB,CACxB,MAAMoD,EAAQ,KAAK,MAAMe,EAAQ,SAAWA,EAAQ,SAAS,EAEvD,CAAE,KAAA9I,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,6BAA6B,EAClC,OAAO,CACN,gBAAiBsC,EACjB,YAAa4B,EAAQ,YACrB,SAAUA,EAAQ,UAAY,EAC9B,KAAMA,EAAQ,MAAQ,WACtB,UAAWA,EAAQ,WAAa,EAChC,MAAOf,EACP,YAAae,EAAQ,aAAe,SACpC,iBAAkBA,EAAQ,kBAAoB,KAC9C,WAAYA,EAAQ,YAAc,CAC5C,CAAS,EACA,OAAM,EACN,OAAM,EACT,GAAIvE,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,2BAA2BgI,EAAQzG,EAAS,CAChD,GAAIoD,EAAsB,CACxB,IAAIsD,EAAa,CAAE,GAAG1G,CAAO,EAC7B,GAAIA,EAAQ,WAAa,QAAaA,EAAQ,YAAc,OAAW,CACrE,KAAM,CAAE,KAAM2G,CAAO,EAAK,MAAMtD,EAC7B,KAAK,6BAA6B,EAClC,OAAO,qBAAqB,EAC5B,GAAG,KAAMoD,CAAM,EACf,OAAM,EAEHW,EAAMpH,EAAQ,UAAY2G,GAAS,UAAY,EAC/CU,EAAOrH,EAAQ,WAAa2G,GAAS,WAAa,EACxDD,EAAW,MAAQ,KAAK,MAAMU,EAAMC,CAAI,CAC1C,CAEA,KAAM,CAAE,KAAA5I,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,6BAA6B,EAClC,OAAOqD,CAAU,EACjB,GAAG,KAAMD,CAAM,EACf,OAAM,EACN,OAAM,EACT,GAAIzD,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,2BAA2BgI,EAAQ,CACvC,GAAIrD,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EACrB,KAAK,6BAA6B,EAClC,OAAM,EACN,GAAG,KAAMoD,CAAM,EAClB,GAAIzD,EAAO,MAAMA,CACnB,CACF,EAMA,MAAM,kBAAkB2C,EAAO6B,EAAY,CACzC,GAAIpE,GAAwBoE,EAAW,OAAS,EAAG,CACjD,MAAMxB,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,MAAMrH,EAAQ6I,EAAW,IAAI,CAAC1I,EAAM2I,IAAU,CAC5C,MAAMnB,EAAe,KAAK,MAAMxH,EAAK,cAAgBA,EAAK,YAAY,EAChEyH,EAAgB,KAAK,MAAMzH,EAAK,eAAiBA,EAAK,aAAa,EACzE,MAAO,CACL,gBAAiB6G,EACjB,YAAa7G,EAAK,YAClB,UAAWA,EAAK,WAAa,WAC7B,cAAeA,EAAK,eAAiB,EACrC,eAAgBA,EAAK,gBAAkB,EACvC,aAAcA,EAAK,cAAgB,EACnC,cAAeA,EAAK,eAAiB,EACrC,cAAewH,EACf,eAAgBC,EAChB,MAAOD,EAAeC,EACtB,WAAYzH,EAAK,YAAc2I,EAC/B,iBAAkB3I,EAAK,kBAAoB,IACrD,CACM,CAAC,EAEK,CAAE,KAAAL,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,oBAAoB,EACzB,OAAOrH,CAAK,EACZ,OAAM,EACT,GAAIqE,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAEA,MAAM,qBAAqBkH,EAAO+B,EAAe,CAC/C,GAAItE,GAAwBsE,EAAc,OAAS,EAAG,CACpD,MAAM1B,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAIjD,MAAM2B,EAAqB,CAAC,eAAgB,UAAW,eAAgB,SAAU,eAAgB,QAAQ,EAEnGhJ,EAAQ+I,EAAc,IAAI,CAAC5I,EAAM2I,IAAU,CAC/C,MAAMR,EAAaU,EAAmB,SAAS7I,EAAK,WAAW,EAAIA,EAAK,YAAc,SAChFoI,EAAW,KAAK,MAAM,OAAOpI,EAAK,SAAS,GAAK,CAAC,EACjDqI,EAAW,OAAOrI,EAAK,QAAQ,GAAK,EAE1C,MAAO,CACL,gBAAiB6G,EACjB,YAAa7G,EAAK,aAAe,GACjC,SAAUqI,EACV,KAAMrI,EAAK,MAAQ,OACnB,UAAWoI,EACX,MAAO,KAAK,MAAMC,EAAWD,CAAQ,EACrC,YAAaD,EACb,iBAAkBnI,EAAK,kBAAoB,KAC3C,iBAAkBA,EAAK,kBAAoB,KAC3C,WAAYA,EAAK,YAAc2I,CACzC,CACM,CAAC,EAEK,CAAE,KAAAhJ,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,wBAAwB,EAC7B,OAAOrH,CAAK,EACZ,OAAM,EACT,GAAIqE,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAEA,MAAM,sBAAsBkH,EAAOiC,EAAgB,CACjD,GAAIxE,GAAwBwE,EAAe,OAAS,EAAG,CACrD,MAAM5B,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAIjD,MAAM2B,EAAqB,CAAC,eAAgB,UAAW,SAAU,eAAgB,QAAQ,EAEnFhJ,EAAQiJ,EAAe,IAAI,CAAC9I,EAAM2I,IAAU,CAChD,MAAMR,EAAaU,EAAmB,SAAS7I,EAAK,WAAW,EAAIA,EAAK,YAAc,SAChFoI,EAAW,KAAK,MAAM,OAAOpI,EAAK,SAAS,GAAK,CAAC,EACjDqI,EAAW,OAAOrI,EAAK,QAAQ,GAAK,EAE1C,MAAO,CACL,gBAAiB6G,EACjB,YAAa7G,EAAK,aAAe,GACjC,SAAUqI,EACV,KAAMrI,EAAK,MAAQ,MACnB,UAAWoI,EACX,MAAO,KAAK,MAAMC,EAAWD,CAAQ,EACrC,YAAaD,EACb,iBAAkBnI,EAAK,kBAAoB,KAC3C,iBAAkBA,EAAK,kBAAoB,KAC3C,WAAYA,EAAK,YAAc2I,CACzC,CACM,CAAC,EAEK,CAAE,KAAAhJ,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,wBAAwB,EAC7B,OAAOrH,CAAK,EACZ,OAAM,EACT,GAAIqE,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAEA,MAAM,0BAA0BkH,EAAOkC,EAAU,CAC/C,GAAIzE,GAAwByE,EAAS,OAAS,EAAG,CAC/C,MAAM7B,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAIjD,MAAMrH,EAAQkJ,EAAS,IAAI,CAAC/I,EAAM2I,KAAW,CAC3C,gBAAiB9B,EACjB,aAAc7G,EAAK,cAAgB,GACnC,YAAaA,EAAK,aAAe,GACjC,SAAUA,EAAK,UAAY,EAC3B,KAAMA,EAAK,MAAQ,WACnB,UAAWA,EAAK,WAAaA,EAAK,OAASA,EAAK,QAAU,EAC1D,MAAOA,EAAK,OAASA,EAAK,QAAU,EACpC,YAAaA,EAAK,aAAe,UACjC,iBAAkBA,EAAK,kBAAoB,KAC3C,WAAYA,EAAK,YAAc2I,CACvC,EAAQ,EAEI,CAAE,KAAAhJ,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,6BAA6B,EAClC,OAAOrH,CAAK,EACZ,OAAM,EACT,GAAIqE,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAGA,MAAM,kBAAkBkH,EAAO,CAC7B,GAAI,CAACvC,EAAsB,OAE3B,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,GAAI,CAEF,MAAMvD,EAAU,MAAM,QAAQ,IAAI,CAChCuD,EAAO,KAAK,oBAAoB,EAAE,OAAM,EAAG,GAAG,kBAAmBL,CAAK,EACtEK,EAAO,KAAK,wBAAwB,EAAE,OAAM,EAAG,GAAG,kBAAmBL,CAAK,EAC1EK,EAAO,KAAK,wBAAwB,EAAE,OAAM,EAAG,GAAG,kBAAmBL,CAAK,EAC1EK,EAAO,KAAK,6BAA6B,EAAE,OAAM,EAAG,GAAG,kBAAmBL,CAAK,CACvF,CAAO,EAGD,UAAW1B,KAAUxB,EACnB,GAAIwB,EAAO,MACT,MAAMA,EAAO,KAGnB,OAASjB,EAAO,CACd,cAAQ,MAAM,iCAAkCA,CAAK,EAC/CA,CACR,CACF,EAGA,MAAM,iBAAiB2C,EAAO,CAAE,WAAA6B,EAAY,cAAAE,EAAe,eAAAE,EAAgB,mBAAAE,GAAsB,CAC/F,GAAI1E,EAAsB,CAExB,MAAM,KAAK,kBAAkBuC,CAAK,EAGlC,MAAMlD,EAAU,MAAM,QAAQ,IAAI,CAChC+E,GAAY,OAAS,EAAI,KAAK,kBAAkB7B,EAAO6B,CAAU,EAAI,GACrEE,GAAe,OAAS,EAAI,KAAK,qBAAqB/B,EAAO+B,CAAa,EAAI,GAC9EE,GAAgB,OAAS,EAAI,KAAK,sBAAsBjC,EAAOiC,CAAc,EAAI,GACjFE,GAAoB,OAAS,EAAI,KAAK,0BAA0BnC,EAAOmC,CAAkB,EAAI,EACrG,CAAO,EAED,MAAO,CACL,MAAOrF,EAAQ,CAAC,EAChB,UAAWA,EAAQ,CAAC,EACpB,UAAWA,EAAQ,CAAC,EACpB,eAAgBA,EAAQ,CAAC,CACjC,CACI,CACA,OAAO,IACT,EAMA,MAAM,kBAAkBsF,EAAUpC,EAAO,CACvC,GAAIvC,EAAsB,CAExB,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EAAS,IAAI,uBAAwB,CAC3D,YAAa0E,EACb,SAAUpC,CAClB,CAAO,EACD,GAAI3C,EACF,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,oBAAqB,MAAO,CAAE,SAAA+E,EAAU,MAAApC,CAAK,CAAE,CAAE,EAC1G3C,EAER,MAAO,CAAE,UAAW+E,EAAU,gBAAiBpC,CAAK,CACtD,CACA,OAAO,IACT,EAEA,MAAM,sBAAsBoC,EAAUpC,EAAO,CAC3C,GAAIvC,EAAsB,CAExB,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EAAS,IAAI,2BAA4B,CAC/D,YAAa0E,EACb,SAAUpC,CAClB,CAAO,EACD,GAAI3C,EACF,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,wBAAyB,MAAO,CAAE,SAAA+E,EAAU,MAAApC,CAAK,CAAE,CAAE,EAC9G3C,CAEV,CACF,EAGA,MAAM,yBAA0B,CAC9B,GAAII,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAAS,IAAI,4BAA4B,EACvE,GAAIL,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,CACA,MAAO,EACT,EAGA,MAAM,uBAAwB,CAC5B,GAAI2E,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAAS,IAAI,0BAA0B,EACrE,GAAIL,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAEA,MAAM,iBAAiBkH,EAAO,CAC5B,GAAIvC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,kCAAkC,EACvC,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAUP,EACA,GAAG,kBAAmBsC,CAAK,EAC9B,GAAI3C,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAEA,MAAM,qBAAqBkC,EAAW,CACpC,GAAIyC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAOP,EACA,GAAG,aAAc1C,CAAS,EAC1B,GAAG,kBAAmB,IAAI,EAC1B,MAAM,YAAa,CAAE,UAAW,EAAK,CAAE,EAC1C,GAAIqC,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAEA,MAAM,sBAAsBsJ,EAAUpC,EAAOpF,EAAWyH,EAAUC,EAAS,CACzE,GAAI7E,EAAsB,CACxB,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAIjD,KAAM,CAAE,KAAM7E,EAAQ,MAAO+G,CAAW,EAAK,MAAMlC,EAChD,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAOP,EACA,GAAG,KAAM+B,CAAQ,EACjB,OAAM,EACT,GAAIG,EAAa,MAAMA,EAGvB,KAAM,CAAE,KAAMC,EAAO,MAAOC,CAAU,EAAK,MAAMpC,EAC9C,KAAK,aAAa,EAClB,OAAO,GAAG,EACV,GAAG,aAAczF,CAAS,EAC1B,GAAG,YAAayH,GAAY,YAAY,EACxC,GAAG,WAAYC,GAAW,UAAU,EACvC,GAAIG,EAAY,MAAMA,EAGtB,MAAMC,EAAa,GACnBF,GAAO,QAAQG,GAAQ,CACrBD,EAAWC,EAAK,KAAK,YAAW,CAAE,EAAIA,CACxC,CAAC,EAGD,MAAMC,EAAc,GACpBpH,EAAO,iBAAiB,QAAQqH,GAAU,CACxC,MAAMC,GAAQD,EAAO,MAAQ,WAAW,YAAW,EAC9CD,EAAYE,CAAI,IACnBF,EAAYE,CAAI,EAAI,CAAE,cAAe,EAAG,eAAgB,CAAC,GAE3DF,EAAYE,CAAI,EAAE,eAAiB,WAAWD,EAAO,KAAK,GAAK,EAC/DD,EAAYE,CAAI,EAAE,gBAAkB,WAAWD,EAAO,cAAc,GAAK,CAC3E,CAAC,EAGD,MAAMhB,EAAa,OAAO,QAAQe,CAAW,EAAE,IAAI,CAAC,CAACE,EAAMC,CAAK,IAAM,CACpE,MAAMJ,EAAOD,EAAWI,CAAI,GAAK,CAAE,aAAc,EAAG,cAAe,CAAC,EAE9D3B,EAAU,KAAK,OAAO,WAAWwB,EAAK,YAAY,GAAK,GAAK,GAAG,EAC/DvB,EAAS,KAAK,OAAO,WAAWuB,EAAK,aAAa,GAAK,GAAK,GAAG,EACrE,MAAO,CACL,YAAaG,EAAK,OAAO,CAAC,EAAE,cAAgBA,EAAK,MAAM,CAAC,EACxD,UAAWR,GAAW,WACtB,cAAeS,EAAM,cACrB,eAAgBA,EAAM,eACtB,aAAc5B,EACd,cAAeC,EACf,iBAAkBgB,CAC5B,CACM,CAAC,EAEGP,EAAW,OAAS,GACtB,MAAM,KAAK,kBAAkB7B,EAAO6B,CAAU,EAIhD,MAAME,EAAgB,GAChBE,EAAiB,GAEvBzG,EAAO,eAAe,QAAQrC,GAAQ,CACpC,MAAM6J,EAAO7J,EAAK,aAAeA,EAAK,qBAAqB,MAAQ,eAC7D8E,EAAW9E,EAAK,iBAAmBA,EAAK,qBAAqB,UAAY,QACzE8J,EAAO9J,EAAK,qBAAqB,MAAQ,OAEzCoI,EAAW,KAAK,OAAO,WAAWpI,EAAK,qBAAqB,aAAa,GAAK,GAAK,GAAG,EAEtF+J,EAAW,CACf,YAAaF,EACb,SAAU7J,EAAK,UAAY,EAC3B,KAAM8J,EACN,UAAW1B,EACX,YAAa,eACb,iBAAkBa,CAC5B,EAEYnE,IAAa,YACfgE,EAAe,KAAKiB,CAAQ,EAE5BnB,EAAc,KAAKmB,CAAQ,CAE/B,CAAC,EAEGnB,EAAc,OAAS,GACzB,MAAM,KAAK,qBAAqB/B,EAAO+B,CAAa,EAElDE,EAAe,OAAS,GAC1B,MAAM,KAAK,sBAAsBjC,EAAOiC,CAAc,EAIxD,KAAM,CAAE,MAAOkB,CAAW,EAAK,MAAM9C,EAClC,KAAK,kCAAkC,EACvC,OAAO,CACN,cAAe,GACf,YAAa,IAAI,KAAI,EAAG,YAAW,EACnC,cAAe,YACf,iBAAkB,KAClB,aAAc,IACxB,CAAS,EACA,GAAG,kBAAmBL,CAAK,EAC3B,GAAG,YAAaoC,CAAQ,EAC3B,GAAIe,EAAa,MAAMA,EAEvB,OAAAtF,GAAQ,SAAS,qBAAsB,CAAE,UAAWuE,EAAU,OAAQpC,EAAO,YAAa6B,EAAW,OAAQ,eAAgBE,EAAc,OAAQ,gBAAiBE,EAAe,MAAM,CAAE,EACpL,CAAE,WAAAJ,EAAY,cAAAE,EAAe,eAAAE,CAAc,CACpD,CACA,OAAO,IACT,EAEA,MAAM,wBAAwBG,EAAUpC,EAAOpF,EAAWyH,EAAUC,EAAS,CAC3E,GAAI7E,EAAsB,CACxB,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAIjD,aAAMA,EACH,KAAK,oBAAoB,EACzB,OAAM,EACN,GAAG,kBAAmBL,CAAK,EAC3B,GAAG,mBAAoBoC,CAAQ,EAElC,MAAM/B,EACH,KAAK,wBAAwB,EAC7B,OAAM,EACN,GAAG,kBAAmBL,CAAK,EAC3B,GAAG,mBAAoBoC,CAAQ,EAElC,MAAM/B,EACH,KAAK,wBAAwB,EAC7B,OAAM,EACN,GAAG,kBAAmBL,CAAK,EAC3B,GAAG,mBAAoBoC,CAAQ,EAG3B,KAAK,sBAAsBA,EAAUpC,EAAOpF,EAAWyH,EAAUC,CAAO,CACjF,CACA,OAAO,IACT,EAGA,MAAM,iBAAiBF,EAAUpC,EAAOoD,EAAe,gBAAiB,CACtE,GAAI3F,EAAsB,CACxB,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,KAAM,CAAE,MAAAhD,CAAK,EAAK,MAAMgD,EACrB,KAAK,kCAAkC,EACvC,OAAO,CACN,cAAe,SACf,iBAAkB,IAAI,KAAI,EAAG,YAAW,EACxC,aAAc+C,CACxB,CAAS,EACA,GAAG,kBAAmBpD,CAAK,EAC3B,GAAG,YAAaoC,CAAQ,EAC3B,GAAI/E,EACF,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,mBAAoB,MAAO,CAAE,SAAA+E,EAAU,MAAApC,CAAK,CAAE,CAAE,EACzG3C,EAERQ,GAAQ,MAAM,oBAAqB,CAAE,UAAWuE,EAAU,OAAQpC,EAAO,MAAOoD,CAAY,CAAE,CAChG,CACF,EAGA,MAAM,wBAAwBpI,EAAW,CACvC,GAAIyC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAWP,EACA,GAAG,aAAc1C,CAAS,EAC1B,GAAG,iDAAkD,QAAQ,EAChE,GAAIqC,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,CACA,MAAO,EACT,EAGA,MAAM,sBAAsBsJ,EAAUpC,EAAO,CAC3C,GAAIvC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,kCAAkC,EACvC,OAAO,8DAA8D,EACrE,GAAG,YAAa0E,CAAQ,EACxB,GAAG,kBAAmBpC,CAAK,EAC3B,OAAM,EACT,GAAI3C,GAASA,EAAM,OAAS,WAAY,MAAMA,EAC9C,OAAOvE,CACT,CACA,OAAO,IACT,EAMA,MAAM,eAAekH,EAAO,CAC1B,GAAIvC,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EAAS,IAAI,yBAA0B,CAAE,OAAQsC,CAAK,CAAE,EAChF,GAAI3C,EAAO,MAAMA,EAGjB,OAAO,KAAK,WAAW2C,CAAK,CAC9B,CACA,OAAO,IACT,EAEA,MAAM,2BAA2BA,EAAOqD,EAAa,CACnD,GAAI5F,EAAsB,CACxB,MAAMpD,EAAU,GACZgJ,EAAY,QAAU,SAAWhJ,EAAQ,qBAAuBgJ,EAAY,OAC5EA,EAAY,YAAc,SAAWhJ,EAAQ,yBAA2BgJ,EAAY,WACpFA,EAAY,YAAc,SAAWhJ,EAAQ,yBAA2BgJ,EAAY,WACpFA,EAAY,iBAAmB,SAAWhJ,EAAQ,8BAAgCgJ,EAAY,gBAElG,KAAM,CAAE,KAAAvK,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAOrD,CAAO,EACd,GAAG,KAAM2F,CAAK,EACd,OAAM,EACN,OAAM,EACT,GAAI3C,EAAO,MAAMA,EAGjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,wBAAwBkH,EAAOqD,EAAa,CAChD,GAAI5F,EAAsB,CACxB,MAAMpD,EAAU,GACZgJ,EAAY,qBAAuB,SAAWhJ,EAAQ,4BAA8BgJ,EAAY,oBAChGA,EAAY,OAAS,SAAWhJ,EAAQ,aAAegJ,EAAY,MACnEA,EAAY,aAAe,SAAWhJ,EAAQ,oBAAsBgJ,EAAY,YAEpF,KAAM,CAAE,KAAAvK,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAOrD,CAAO,EACd,GAAG,KAAM2F,CAAK,EACd,OAAM,EACN,OAAM,EACT,GAAI3C,EAAO,MAAMA,EAGjB,OAAOvE,CACT,CACA,OAAO,IACT,EAMA,MAAM,qBAAqBkH,EAAO,CAChC,GAAIvC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,OAAQ,mBACR,aAAc,IAAI,KAAI,EAAG,YAAW,CAC9C,CAAS,EACA,GAAG,KAAMsC,CAAK,EACd,OAAM,EACN,OAAM,EACT,GAAI3C,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,WAAWkH,EAAOsD,EAAQ,CAC9B,GAAI7F,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,OAAQ,WACR,YAAa4F,EACb,YAAa,IAAI,KAAI,EAAG,YAAW,CAC7C,CAAS,EACA,GAAG,KAAMtD,CAAK,EACd,OAAM,EACN,OAAM,EACT,GAAI3C,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,UAAUkH,EAAOuD,EAAS,KAAM,CACpC,GAAI9F,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,OAAQ,WACR,iBAAkB6F,CAC5B,CAAS,EACA,GAAG,KAAMvD,CAAK,EACd,OAAM,EACN,OAAM,EACT,GAAI3C,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,gBAAgBkH,EAAO,CAC3B,GAAIvC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,CAAE,OAAQ,QAAQ,CAAE,EAC3B,GAAG,KAAMsC,CAAK,EACd,OAAM,EACN,OAAM,EACT,GAAI3C,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,SAASkH,EAAO,CACpB,GAAIvC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,CAAE,OAAQ,QAAQ,CAAE,EAC3B,GAAG,KAAMsC,CAAK,EACd,OAAM,EACN,OAAM,EACT,GAAI3C,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,iBAAiBkH,EAAOwD,EAAeC,EAAY,CACvD,GAAIhG,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,kBAAmB8F,EACnB,kBAAmBC,EACnB,kBAAmB,IAAI,KAAI,EAAG,YAAW,EACzC,OAAQ,UAClB,CAAS,EACA,GAAG,KAAMzD,CAAK,EACd,OAAM,EACN,OAAM,EACT,GAAI3C,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAMA,MAAM,YAAYkC,EAAW,CAC3B,GAAIyC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,mBAAmB,EAC1B,GAAG,aAAc1C,CAAS,EAE7B,GAAIqC,EAAO,MAAMA,EAEjB,MAAMqG,EAAQ,CACZ,WAAY5K,EAAK,OACjB,YAAa,EACb,cAAe,EACf,eAAgB,EAChB,eAAgB,EAChB,aAAc,EACd,qBAAsB,EACtB,oBAAqB,EACrB,mBAAoB,CAC5B,EAEM,OAAAA,EAAK,QAAQyH,GAAO,CAClB,OAAQA,EAAI,OAAM,CAChB,IAAK,QACHmD,EAAM,cACN,MACF,IAAK,mBACHA,EAAM,gBACNA,EAAM,qBAAuBnD,EAAI,WAAa,EAC9C,MACF,IAAK,WACHmD,EAAM,iBACNA,EAAM,sBAAwBnD,EAAI,WAAa,EAC/C,MACF,IAAK,WACHmD,EAAM,iBACN,MACF,IAAK,SACL,IAAK,SACHA,EAAM,eACNA,EAAM,oBAAsBnD,EAAI,WAAa,EAC7C,KACZ,CACM,CAAC,EAEMmD,CACT,CACA,MAAO,CACL,WAAY,EACZ,YAAa,EACb,cAAe,EACf,eAAgB,EAChB,eAAgB,EAChB,aAAc,EACd,qBAAsB,EACtB,oBAAqB,EACrB,mBAAoB,CAC1B,CACE,EAGA,gBAAgB1I,EAAWsB,EAAU,CACnC,OAAImB,EACKC,EACJ,QAAQ,iBAAiB1C,CAAS,EAAE,EACpC,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,gBAAiB,OAAQ,iBAAiBA,CAAS,EAAE,EAC5FsB,CACV,EACS,UAAS,EAEP,IACT,EAIA,sBAAsB0D,EAAO1D,EAAU,CACrC,OAAImB,EACKC,EACJ,QAAQ,eAAesC,CAAK,EAAE,EAC9B,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,mCAAoC,OAAQ,sBAAsBA,CAAK,EAAE,EAChH1D,CACV,EACS,UAAS,EAEP,IACT,EAOA,MAAM,UAAUtB,EAAW,CACzB,GAAIyC,EAAsB,CAExB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAkBP,EACA,GAAG,aAAc1C,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,EAAI,CAAE,EAE1C,GAAIqC,EACF,cAAQ,MAAM,0BAA2BA,CAAK,EACxCA,EAIR,OAAQvE,GAAQ,IAAI,IAAI6K,IAAQ,CAC9B,GAAIA,EAAI,GACR,UAAWA,EAAI,WACf,iBAAkBA,EAAI,oBACtB,SAAUA,EAAI,UACd,SAAUA,EAAI,SACd,UAAWA,EAAI,WACf,UAAWA,EAAI,WACf,YAAa,CACX,GAAIA,EAAI,cAAc,GACtB,UAAWA,EAAI,cAAc,WAC7B,MAAOA,EAAI,cAAc,MACzB,SAAUA,EAAI,cAAc,UAC5B,OAAQA,EAAI,cAAc,OAC1B,UAAWA,EAAI,cAAc,WAC7B,WAAYA,EAAI,cAAc,YAC9B,WAAYA,EAAI,cAAc,WACxC,CACA,EAAQ,CACJ,CACA,MAAO,EACT,EAGA,MAAM,kBAAkBC,EAASvJ,EAAS,CACxC,GAAIoD,EAAsB,CACxB,MAAMsD,EAAa,CACjB,WAAY,IAAI,KAAI,EAAG,YAAW,CAC1C,EAGU1G,EAAQ,mBAAqB,SAC/B0G,EAAW,oBAAsB1G,EAAQ,kBAAoB,MAE3DA,EAAQ,WAAa,SACvB0G,EAAW,UAAY1G,EAAQ,UAAY,MAEzCA,EAAQ,WAAa,SACvB0G,EAAW,SAAW1G,EAAQ,UAAY,MAG5C,KAAM,CAAE,KAAAvB,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,iBAAiB,EACtB,OAAOqD,CAAU,EACjB,GAAG,KAAM6C,CAAO,EAChB,OAAM,EACN,OAAM,EAET,GAAIvG,EACF,cAAQ,MAAM,gCAAiCA,CAAK,EAC9CA,EAGR,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,wBAAwB+K,EAAe1I,EAAQ,CACnD,GAAIsC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,OAAQvC,EACR,WAAY,IAAI,KAAI,EAAG,YAAW,CAC5C,CAAS,EACA,GAAG,KAAM0I,CAAa,EACtB,OAAM,EACN,OAAM,EAET,GAAIxG,EACF,cAAQ,MAAM,sCAAuCA,CAAK,EACpDA,EAGR,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,kBAAkBkC,EAAWsB,EAAU,CACrC,OAAImB,EACKC,EACJ,QAAQ,WAAW1C,CAAS,EAAE,EAC9B,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,kBAAmB,OAAQ,iBAAiBA,CAAS,EAAE,EAC9FsB,CACV,EACS,UAAS,EAEP,IACT,EAIA,qBAAqBtB,EAAWsB,EAAU,CACxC,OAAImB,EACKC,EACJ,QAAQ,aAAa1C,CAAS,EAAE,EAChC,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,YAAa,OAAQ,iBAAiBA,CAAS,EAAE,EACxFsB,CACV,EACS,UAAS,EAEP,IACT,EAGA,2BAA2BtB,EAAWsB,EAAU,CAC9C,OAAImB,EACKC,EACJ,QAAQ,oBAAoB1C,CAAS,EAAE,EACvC,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,mBAAoB,OAAQ,iBAAiBA,CAAS,EAAE,EAC/FsB,CACV,EACS,UAAS,EAEP,IACT,EAGA,8BAA8B1B,EAAW0B,EAAU,CACjD,OAAImB,EACKC,EACJ,QAAQ,uBAAuB9C,CAAS,EAAE,EAC1C,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,sBAAuB,OAAQ,iBAAiBA,CAAS,EAAE,EAClG0B,CACV,EACS,UAAS,EAEP,IACT,EAGA,sBAAsB1B,EAAW0B,EAAU,CACzC,OAAImB,EACKC,EACJ,QAAQ,eAAe9C,CAAS,EAAE,EAClC,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,cAAe,OAAQ,iBAAiBA,CAAS,EAAE,EAC1F0B,CACV,EACS,UAAS,EAEP,IACT,EAGA,mBAAmBtB,EAAWsB,EAAU,CACtC,OAAImB,EACKC,EACJ,QAAQ,WAAW1C,CAAS,EAAE,EAC9B,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,WAAY,OAAQ,SAASA,CAAS,EAAE,EAC/EsB,CACV,EACS,UAAS,EAEP,IACT,EAOA,MAAM,uBAAuBwH,EAAcC,EAAYnJ,EAAWI,EAAWgJ,EAAY,KAAMC,EAAY,KAAM,CAC/G,GAAIxG,EAAsB,CACxB,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAIjD,KAAM,CAAE,KAAM6D,EAAa,MAAOC,CAAU,EAAK,MAAM9D,EAAO,IAAI,0BAA0B,EAC5F,GAAI8D,EAAY,MAAMA,EAEtB,KAAM,CAAE,KAAArL,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,oBAAoB,EACzB,OAAO,CACN,cAAeyD,EACf,YAAaC,EACb,WAAYnJ,EACZ,WAAYI,EACZ,gBAAiBkJ,EACjB,WAAYD,EACZ,WAAYD,CACtB,CAAS,EACA,OAAM,EACN,OAAM,EACT,GAAI3G,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,2BAA2BsL,EAAO,CACtC,GAAI3G,EAAsB,CACxB,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAIjD,MAAMA,EAAO,IAAI,iCAAkC,CAAE,MAAA+D,CAAK,CAAE,EAE5D,KAAM,CAAE,KAAAtL,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,oBAAoB,EACzB,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,kBAAmB+D,CAAK,EAC3B,OAAM,EACT,GAAI/G,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,gCAAgCgL,EAAcC,EAAY,CAC9D,GAAItG,EAAsB,CACxB,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,oBAAoB,EACzB,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,gBAAiByD,CAAY,EAChC,GAAG,cAAeC,CAAU,EAC5B,MAAM,aAAc,CAAE,UAAW,EAAK,CAAE,EAC3C,GAAI1G,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,CACA,MAAO,EACT,EAGA,MAAM,aAAauL,EAAWC,EAAMd,EAAe,CACjD,GAAI/F,EAAsB,CACxB,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,YAAY,EACjB,OAAO,CACN,qBAAsBgE,EACtB,eAAgBC,EAChB,gBAAiBd,EAAc,UAC/B,YAAaA,EAAc,WAC3B,aAAcA,EAAc,aAAe,KAC3C,eAAgBA,EAAc,eAAiB,KAC/C,UAAWA,EAAc,UAAY,IAAI,KAAI,EAAG,YAAW,EAC3D,WAAYA,EAAc,WAAa,KACvC,WAAYA,EAAc,WAAa,IACjD,CAAS,EACA,OAAM,EACN,OAAM,EACT,GAAInG,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,wBAAwByL,EAAWC,EAAkB,CACzD,GAAI,CAAC/G,EAAsB,OAAO,KAElC,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,KAAM,CAAE,cAAAoE,EAAe,YAAAC,GAAgBF,EACjCF,EAAOC,EAAU,eAGjBlK,EAAU,GACZiK,IAAS,GAEXjK,EAAQ,kBAAoBkK,EAAU,gBACtClK,EAAQ,kBAAoBkK,EAAU,YACtClK,EAAQ,mBAAqBkK,EAAU,aACvClK,EAAQ,qBAAuBkK,EAAU,eACzClK,EAAQ,kBAAoBkK,EAAU,UACtClK,EAAQ,gBAAkBkK,EAAU,YAC3BD,IAAS,IAElBjK,EAAQ,sBAAwBkK,EAAU,gBAC1ClK,EAAQ,sBAAwBkK,EAAU,YAC1ClK,EAAQ,uBAAyBkK,EAAU,aAC3ClK,EAAQ,yBAA2BkK,EAAU,eAC7ClK,EAAQ,sBAAwBkK,EAAU,UAC1ClK,EAAQ,oBAAsBkK,EAAU,YAG1C,MAAMI,EAAYF,IAAkB,MAAQ,gBAAkB,kBACxD,CAAE,KAAA3L,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAKsE,CAAS,EACd,OAAOtK,CAAO,EACd,GAAG,KAAMqK,CAAW,EACpB,OAAM,EACN,OAAM,EACT,GAAIrH,EAAO,MAAMA,EACjB,OAAOvE,CACT,EAGA,MAAM,uBAAuBuL,EAAW,CACtC,GAAI5G,EAAsB,CACxB,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,oBAAoB,EACzB,OAAO,CAAE,OAAQ,SAAS,CAAE,EAC5B,GAAG,KAAMgE,CAAS,EAClB,OAAM,EACN,OAAM,EACT,GAAIhH,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,sBAAsBgL,EAAcC,EAAY,CACpD,GAAI,CAACtG,EAAsB,OAAO,KAElC,MAAM4C,EAASnB,EAAS,EACxB,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,GAAIyD,IAAiB,MAAO,CAC1B,KAAM,CAAE,KAAAhL,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,eAAe,EACpB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAgBP,EACA,GAAG,KAAM0D,CAAU,EACnB,OAAM,EACT,GAAI1G,EAAO,MAAMA,EACjB,OAAOvE,CACT,SAAWgL,IAAiB,YAAa,CACvC,KAAM,CAAE,KAAAhL,EAAM,MAAAuE,CAAK,EAAK,MAAMgD,EAC3B,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAuBP,EACA,GAAG,KAAM0D,CAAU,EACnB,OAAM,EACT,GAAI1G,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAOA,MAAM,gBAAgBkC,EAAW,CAC/B,GAAIyC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,GAAG,EACV,GAAG,aAAc1C,CAAS,EAC1B,MAAM,YAAa,CAAE,UAAW,EAAK,CAAE,EAC1C,OAAIqC,GACF,QAAQ,MAAM,gCAAiCA,CAAK,EAC7C,IAEFvE,GAAQ,EACjB,CAGA,OADkByG,EAAY,EACZ,cAAgB,IAC/B,OAAO1H,GAAKA,EAAE,aAAemD,CAAS,EACtC,KAAK,CAAClE,EAAGC,IAAM,IAAI,KAAKA,EAAE,SAAS,EAAI,IAAI,KAAKD,EAAE,SAAS,CAAC,CACjE,EAGA,MAAM,eAAekE,EAAWJ,EAAWgK,EAAU,CACnD,MAAMlD,EAAO,CACX,WAAY1G,EACZ,WAAYJ,EACZ,SAAUgK,EAAS,SACnB,YAAaA,EAAS,YACtB,OAAQ,WAAWA,EAAS,MAAM,EAClC,UAAWA,EAAS,WAAa,IAAI,KAAI,EAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,EACtE,MAAOA,EAAS,OAAS,KACzB,WAAYA,EAAS,YAAc,IACzC,EAEI,GAAInH,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAOgE,CAAI,EACX,OAAM,EACN,OAAM,EACT,GAAIrE,EACF,cAAQ,MAAM,6BAA8BA,CAAK,EAC3CA,EAER,OAAOvE,CACT,CAEA,MAAM+L,EAAYtF,EAAY,EACzBsF,EAAU,eAAcA,EAAU,aAAe,IACtD,MAAMC,EAAU,CACd,GAAGpD,EACH,GAAI,OAAO,WAAU,EACrB,WAAY,IAAI,KAAI,EAAG,YAAW,EAClC,WAAY,IAAI,KAAI,EAAG,YAAW,CACxC,EACI,OAAAmD,EAAU,aAAa,KAAKC,CAAO,EACnCtF,GAAaqF,CAAS,EACfC,CACT,EAGA,MAAM,kBAAkBC,EAAQH,EAAU,CACxC,MAAMvK,EAAU,CACd,SAAUuK,EAAS,SACnB,YAAaA,EAAS,YACtB,OAAQ,WAAWA,EAAS,MAAM,EAClC,UAAWA,EAAS,UACpB,MAAOA,EAAS,OAAS,KACzB,WAAY,IAAI,KAAI,EAAG,YAAW,CACxC,EAEI,GAAInH,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAOrD,CAAO,EACd,GAAG,KAAM0K,CAAM,EACf,OAAM,EACN,OAAM,EACT,GAAI1H,EACF,cAAQ,MAAM,+BAAgCA,CAAK,EAC7CA,EAER,OAAOvE,CACT,CAEA,MAAM+L,EAAYtF,EAAY,EAC9B,GAAI,CAACsF,EAAU,aAAc,OAAO,KACpC,MAAM/C,EAAQ+C,EAAU,aAAa,UAAUhN,GAAKA,EAAE,KAAOkN,CAAM,EACnE,OAAIjD,IAAU,GAAW,MACzB+C,EAAU,aAAa/C,CAAK,EAAI,CAAE,GAAG+C,EAAU,aAAa/C,CAAK,EAAG,GAAGzH,CAAO,EAC9EmF,GAAaqF,CAAS,EACfA,EAAU,aAAa/C,CAAK,EACrC,EAGA,MAAM,kBAAkBiD,EAAQ,CAC9B,GAAItH,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EACrB,KAAK,eAAe,EACpB,OAAM,EACN,GAAG,KAAMqH,CAAM,EAClB,GAAI1H,EACF,cAAQ,MAAM,+BAAgCA,CAAK,EAC7CA,EAER,MAAO,EACT,CAEA,MAAMwH,EAAYtF,EAAY,EAC9B,OAAKsF,EAAU,eACfA,EAAU,aAAeA,EAAU,aAAa,OAAOhN,GAAKA,EAAE,KAAOkN,CAAM,EAC3EvF,GAAaqF,CAAS,GACf,EACT,EAGA,MAAM,uBAAuB7J,EAAW,CACtC,MAAMgK,EAAQ,MAAM,KAAK,gBAAgBhK,CAAS,EAE5CiK,EAAa,GACnB,IAAIC,EAAY,EAEhB,OAAAF,EAAM,QAAQtD,GAAQ,CACpB,MAAMyD,EAAS,WAAWzD,EAAK,MAAM,GAAK,EAC1CwD,GAAaC,EAERF,EAAWvD,EAAK,QAAQ,IAC3BuD,EAAWvD,EAAK,QAAQ,EAAI,CAC1B,SAAUA,EAAK,SACf,MAAO,EACP,MAAO,EACP,MAAO,EACjB,GAEMuD,EAAWvD,EAAK,QAAQ,EAAE,OAASyD,EACnCF,EAAWvD,EAAK,QAAQ,EAAE,QAC1BuD,EAAWvD,EAAK,QAAQ,EAAE,MAAM,KAAKA,CAAI,CAC3C,CAAC,EAGD,OAAO,OAAOuD,CAAU,EAAE,QAAQG,GAAO,CACvCA,EAAI,WAAaF,EAAY,EAAKE,EAAI,MAAQF,EAAa,IAAM,CACnE,CAAC,EAEM,CACL,UAAAA,EACA,WAAAD,EACA,UAAWD,EAAM,MACvB,CACE,EAOA,MAAM,qBAAqBpK,EAAW,CACpC,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAAS,IAAI,0BAA2B,CACpE,aAAc9C,CACtB,CAAO,EACD,OAAIyC,GACF,QAAQ,MAAM,qCAAsCA,CAAK,EAElD,KAAK,4BAA4BzC,CAAS,GAE5C9B,CACT,CACA,OAAO,KAAK,4BAA4B8B,CAAS,CACnD,EAEA,MAAM,4BAA4BA,EAAW,CAE3C,MAAMyK,GADW,MAAM,KAAK,mBAAmBzK,CAAS,GAChC,OAAO,CAAC0K,EAAKC,IAAQ,CAC3C,MAAM/E,EAAQ+E,EAAI,gBAAgB,MAAM,aAAa,EACrD,GAAI/E,EAAO,CACT,MAAMC,EAAM,SAASD,EAAM,CAAC,EAAG,EAAE,EACjC,OAAOC,EAAM6E,EAAM7E,EAAM6E,CAC3B,CACA,OAAOA,CACT,EAAG,CAAC,EACJ,MAAO,OAAO,OAAOD,EAAS,CAAC,EAAE,SAAS,EAAG,GAAG,CAAC,EACnD,EAGA,MAAM,iBAAiBrK,EAAW,CAChC,GAAIyC,EAAsB,CAExB,KAAM,CAAE,KAAM+H,EAAM,MAAOC,CAAS,EAAK,MAAM/H,EAC5C,KAAK,eAAe,EACpB,OAAO,uDAAuD,EAC9D,GAAG,aAAc1C,CAAS,EAC1B,GAAG,SAAU,UAAU,EACvB,MAAM,aAAc,CAAE,UAAW,EAAI,CAAE,EAEtCyK,GACF,QAAQ,MAAM,gCAAiCA,CAAS,EAI1D,KAAM,CAAE,KAAMC,EAAS,MAAOC,CAAY,EAAK,MAAMjI,EAClD,KAAK,iBAAiB,EACtB,OAAO,iFAAiF,EACxF,GAAG,aAAc1C,CAAS,EAC1B,GAAG,SAAU,UAAU,EACvB,IAAI,wBAAyB,KAAM,IAAI,EACvC,MAAM,YAAa,CAAE,UAAW,EAAI,CAAE,EAEzC,OAAI2K,GACF,QAAQ,MAAM,uCAAwCA,CAAY,EAG7D,CACL,KAAMH,GAAQ,GACd,QAASE,GAAW,EAC5B,CACI,CAEA,MAAO,CAAE,KAAM,GAAI,QAAS,EAAE,CAChC,EAGA,MAAM,mBAAmB1K,EAAW,CAClC,GAAIyC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,aAAc1C,CAAS,EAC1B,MAAM,eAAgB,CAAE,UAAW,EAAK,CAAE,EAE7C,GAAIqC,EACF,cAAQ,MAAM,mCAAoCA,CAAK,EACjDA,EAER,OAAOvE,GAAQ,EACjB,CAGA,OADkByG,EAAY,EACZ,UAAY,IAAI,OAAOqG,GAAKA,EAAE,aAAe5K,CAAS,CAC1E,EAGA,MAAM,mBAAmBJ,EAAW,CAClC,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO,GAAG,EACV,GAAG,aAAc9C,CAAS,EAC1B,MAAM,eAAgB,CAAE,UAAW,EAAK,CAAE,EAE7C,GAAIyC,EACF,cAAQ,MAAM,mCAAoCA,CAAK,EACjDA,EAER,OAAOvE,GAAQ,EACjB,CAGA,OADkByG,EAAY,EACZ,UAAY,IAAI,OAAOqG,GAAKA,EAAE,aAAehL,CAAS,CAC1E,EAGA,MAAM,cAAciL,EAAS7M,EAAO,CAClC,GAAIyE,EAAsB,CAExB,KAAM,CAAE,KAAMqI,EAAa,MAAOC,CAAY,EAAK,MAAMrI,EACtD,KAAK,UAAU,EACf,OAAO,CACN,WAAYmI,EAAQ,WACpB,WAAYA,EAAQ,WACpB,eAAgBA,EAAQ,eACxB,aAAcA,EAAQ,aACtB,SAAUA,EAAQ,SAClB,OAAQA,EAAQ,QAAU,QAC1B,kBAAmBA,EAAQ,mBAAqB,EAChD,aAAcA,EAAQ,aACtB,gBAAiBA,EAAQ,gBACzB,gBAAiBA,EAAQ,gBACzB,MAAOA,EAAQ,MACf,MAAOA,EAAQ,OAAS,SACxB,WAAYA,EAAQ,UAC9B,CAAS,EACA,OAAM,EACN,OAAM,EAET,GAAIE,EACF,cAAQ,MAAM,0BAA2BA,CAAY,EAC/CA,EAIR,GAAI/M,GAASA,EAAM,OAAS,EAAG,CAC7B,MAAMgN,EAAgBhN,EAAM,IAAI,CAACG,EAAM2I,KAAW,CAChD,WAAYgE,EAAY,GACxB,UAAW3M,EAAK,UAChB,aAAcA,EAAK,aACnB,iBAAkBA,EAAK,iBACvB,YAAaA,EAAK,YAClB,OAAQA,EAAK,OACb,WAAY2I,CACtB,EAAU,EAEI,CAAE,MAAOmE,CAAU,EAAK,MAAMvI,EACjC,KAAK,eAAe,EACpB,OAAOsI,CAAa,EAEvB,GAAIC,EACF,cAAQ,MAAM,gCAAiCA,CAAU,EAEzD,MAAMvI,EAAS,KAAK,UAAU,EAAE,OAAM,EAAG,GAAG,KAAMoI,EAAY,EAAE,EAC1DG,CAEV,CAGA,OAAO,KAAK,WAAWH,EAAY,EAAE,CACvC,CAEA,MAAMjB,EAAYtF,EAAY,EACzBsF,EAAU,WAAUA,EAAU,SAAW,IAC9C,MAAMqB,EAAa,CACjB,GAAGL,EACH,GAAIpK,GAAc,EAClB,WAAY,IAAI,KAAI,EAAG,YAAW,EAClC,cAAezC,GAAS,EAC9B,EACI,OAAA6L,EAAU,SAAS,KAAKqB,CAAU,EAClC1G,GAAaqF,CAAS,EACfqB,CACT,EAGA,MAAM,WAAWC,EAAW,CAC1B,GAAI1I,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,KAAMyI,CAAS,EAClB,OAAM,EAET,GAAI9I,EACF,cAAQ,MAAM,0BAA2BA,CAAK,EACxCA,EAER,OAAOvE,CACT,CAGA,OADkByG,EAAY,EACZ,UAAY,IAAI,KAAKqG,GAAKA,EAAE,KAAOO,CAAS,CAChE,EAGA,MAAM,cAAcA,EAAW9L,EAAS,CACtC,GAAIoD,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAOrD,CAAO,EACd,GAAG,KAAM8L,CAAS,EAClB,OAAM,EACN,OAAM,EAET,GAAI9I,EACF,cAAQ,MAAM,0BAA2BA,CAAK,EACxCA,EAER,OAAOvE,CACT,CAEA,MAAM+L,EAAYtF,EAAY,EACxBuC,GAAS+C,EAAU,UAAY,IAAI,UAAUe,GAAKA,EAAE,KAAOO,CAAS,EAC1E,OAAIrE,GAAS,GACX+C,EAAU,SAAS/C,CAAK,EAAI,CAAE,GAAG+C,EAAU,SAAS/C,CAAK,EAAG,GAAGzH,CAAO,EACtEmF,GAAaqF,CAAS,EACfA,EAAU,SAAS/C,CAAK,GAE1B,IACT,EAGA,MAAM,gBAAgBqE,EAAW,CAC/B,OAAO,KAAK,cAAcA,EAAW,CACnC,OAAQ,OACR,QAAS,IAAI,KAAI,EAAG,YAAW,CACrC,CAAK,CACH,EAGA,MAAM,qBAAqBA,EAAWC,EAAe,CACnD,MAAMP,EAAU,MAAM,KAAK,WAAWM,CAAS,EAC/C,GAAI,CAACN,EAAS,MAAM,IAAI,MAAM,mBAAmB,EAEjD,MAAMQ,GAAiBR,EAAQ,aAAe,GAAKO,EAC7CE,EAAeD,GAAiBR,EAAQ,MAE9C,OAAO,KAAK,cAAcM,EAAW,CACnC,YAAaE,EACb,OAAQC,EAAe,OAAS,UAChC,QAASA,EAAe,IAAI,KAAI,EAAG,YAAW,EAAK,IACzD,CAAK,CACH,EAGA,MAAM,cAAcH,EAAW,CAC7B,GAAI1I,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EACrB,KAAK,UAAU,EACf,OAAM,EACN,GAAG,KAAMyI,CAAS,EAClB,GAAG,SAAU,OAAO,EAEvB,GAAI9I,EACF,cAAQ,MAAM,0BAA2BA,CAAK,EACxCA,EAER,MAAO,EACT,CAEA,MAAMwH,EAAYtF,EAAY,EAC9B,OAAAsF,EAAU,UAAYA,EAAU,UAAY,IAAI,OAAOe,GAAKA,EAAE,KAAOO,CAAS,EAC9E3G,GAAaqF,CAAS,EACf,EACT,EAGA,MAAM,gBAAgB5E,EAAS,GAAIsG,EAAQ,GAAI,CAC7C,GAAI9I,EAAsB,CAExB,GAAIwC,EAAO,OAAS,EAAG,CACrB,KAAM,CAAE,MAAOwF,CAAS,EAAK,MAAM/H,EAChC,KAAK,eAAe,EACpB,OAAO,CAAE,OAAQ,QAAQ,CAAE,EAC3B,GAAG,KAAMuC,CAAM,EAEdwF,GACF,QAAQ,MAAM,gCAAiCA,CAAS,CAE5D,CAGA,GAAIc,EAAM,OAAS,EAAG,CACpB,KAAM,CAAE,MAAOC,CAAO,EAAK,MAAM9I,EAC9B,KAAK,iBAAiB,EACtB,OAAO,CAAE,OAAQ,QAAQ,CAAE,EAC3B,GAAG,KAAM6I,CAAK,EAEbC,GACF,QAAQ,MAAM,uCAAwCA,CAAO,CAEjE,CACF,CACF,CACF,ECnqEaC,GAAe,CAQ1B,MAAM,oBAAoB7L,EAAW8L,EAAa,GAAM,CACtD,GAAI,CAACjJ,EACH,eAAQ,KAAK,yBAAyB,EAC/B,GAGT,IAAI2C,EAAQ1C,EACT,KAAK,WAAW,EAChB,OAAO,GAAG,EACV,GAAG,aAAc9C,CAAS,EAC1B,MAAM,MAAM,EAEX8L,IACFtG,EAAQA,EAAM,GAAG,YAAa,EAAI,GAGpC,KAAM,CAAE,KAAAtH,EAAM,MAAAuE,CAAK,EAAK,MAAM+C,EAE9B,OAAI/C,GACF,QAAQ,MAAM,oCAAqCA,CAAK,EACjD,IAGFvE,GAAQ,EACjB,EAKA,MAAM,gBAAgB6N,EAAW,CAC/B,GAAI,CAAClJ,EACH,eAAQ,KAAK,yBAAyB,EAC/B,KAGT,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,WAAW,EAChB,OAAOiJ,CAAS,EAChB,OAAM,EACN,OAAM,EAET,GAAItJ,EACF,cAAQ,MAAM,4BAA6BA,CAAK,EAC1CA,EAGR,OAAOvE,CACT,EAKA,MAAM,gBAAgB8N,EAAavM,EAAS,CAC1C,GAAI,CAACoD,EACH,eAAQ,KAAK,yBAAyB,EAC/B,KAGT,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,WAAW,EAChB,OAAOrD,CAAO,EACd,GAAG,KAAMuM,CAAW,EACpB,OAAM,EACN,OAAM,EAET,GAAIvJ,EACF,cAAQ,MAAM,4BAA6BA,CAAK,EAC1CA,EAGR,OAAOvE,CACT,EAKA,MAAM,oBAAoB8N,EAAa,CACrC,OAAO,KAAK,gBAAgBA,EAAa,CAAE,UAAW,EAAK,CAAE,CAC/D,EASA,MAAM,oBAAoB5L,EAAW,CACnC,GAAI,CAACyC,EACH,eAAQ,KAAK,yBAAyB,EAC/B,GAGT,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,mBAAmB,EACxB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAQP,EACA,GAAG,aAAc1C,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,EAAK,CAAE,EAE3C,OAAIqC,GACF,QAAQ,MAAM,oCAAqCA,CAAK,EACjD,IAGFvE,GAAQ,EACjB,EAKA,MAAM,0BAA0BkC,EAAW,CACzC,GAAI,CAACyC,EACH,eAAQ,KAAK,yBAAyB,EAC/B,GAGT,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,mBAAmB,EACxB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAQP,EACA,GAAG,aAAc1C,CAAS,EAC1B,GAAG,WAAY,IAAI,EACnB,MAAM,aAAc,CAAE,UAAW,EAAK,CAAE,EAE3C,OAAIqC,GACF,QAAQ,MAAM,2CAA4CA,CAAK,EACxD,IAGFvE,GAAQ,EACjB,EAKA,MAAM,sBAAsB+N,EAAkB,CAC5C,GAAI,CAACpJ,EACH,eAAQ,KAAK,yBAAyB,EAC/B,KAGT,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,mBAAmB,EACxB,OAAOmJ,CAAgB,EACvB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAQP,EACA,OAAM,EAET,GAAIxJ,EACF,cAAQ,MAAM,qCAAsCA,CAAK,EACnDA,EAGR,OAAOvE,CACT,EAKA,MAAM,uBAAuBgO,EAAoBzM,EAAS,CACxD,GAAI,CAACoD,EACH,eAAQ,KAAK,yBAAyB,EAC/B,KAGT,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,mBAAmB,EACxB,OAAOrD,CAAO,EACd,GAAG,KAAMyM,CAAkB,EAC3B,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAQP,EACA,OAAM,EAET,GAAIzJ,EACF,cAAQ,MAAM,oCAAqCA,CAAK,EAClDA,EAGR,OAAOvE,CACT,EAKA,MAAM,sBAAsBgO,EAAoBC,EAAU,KAAM,CAC9D,OAAO,KAAK,uBAAuBD,EAAoB,CACrD,SAAUC,GAAW,IAAI,KAAI,EAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,CAChE,CAAK,CACH,EAKA,MAAM,2BAA2BD,EAAoB,CACnD,GAAI,CAACrJ,EACH,eAAQ,KAAK,yBAAyB,EAC/B,GAGT,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EACrB,KAAK,mBAAmB,EACxB,OAAM,EACN,GAAG,KAAMoJ,CAAkB,EAE9B,GAAIzJ,EACF,cAAQ,MAAM,oCAAqCA,CAAK,EAClDA,EAGR,MAAO,EACT,EAKA,8BAA8BwJ,EAAkB,CAC9C,MAAMG,EAAQ,IAAI,KAClB,OAAAA,EAAM,SAAS,EAAG,EAAG,EAAG,CAAC,EAElBH,EAAiB,OAAO,CAAChG,EAAOoG,IAAO,CAC5C,MAAMC,EAAY,IAAI,KAAKD,EAAG,UAAU,EACxCC,EAAU,SAAS,EAAG,EAAG,EAAG,CAAC,EAE7B,IAAIH,EACAE,EAAG,UACLF,EAAU,IAAI,KAAKE,EAAG,QAAQ,EAC9BF,EAAQ,SAAS,EAAG,EAAG,EAAG,CAAC,GAE3BA,EAAUC,EAIZ,MAAMG,EAAO,KAAK,IAAI,EAAG,KAAK,OAAOJ,EAAUG,IAAc,IAAO,GAAK,GAAK,GAAG,EAAI,CAAC,EAEtF,OAAOrG,EAASoG,EAAG,WAAaE,CAClC,EAAG,CAAC,CACN,EAKA,oBAAoBD,EAAWH,EAAU,KAAM,CAC7C,MAAM1I,EAAQ,IAAI,KAAK6I,CAAS,EAChC7I,EAAM,SAAS,EAAG,EAAG,EAAG,CAAC,EAEzB,IAAI+I,EACJ,OAAIL,EACFK,EAAM,IAAI,KAAKL,CAAO,EAEtBK,EAAM,IAAI,KAEZA,EAAI,SAAS,EAAG,EAAG,EAAG,CAAC,EAEhB,KAAK,IAAI,EAAG,KAAK,OAAOA,EAAM/I,IAAU,IAAO,GAAK,GAAK,GAAG,EAAI,CAAC,CAC1E,CACF,ECpSagJ,GAAiB,CAI5B,MAAM,kBAAkBrM,EAAW,CACjC,GAAI,CAACyC,EACH,eAAQ,KAAK,yBAAyB,EAC/B,EAGT,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,aAAa,EACpB,GAAG,aAAc1C,CAAS,EAC1B,MAAM,cAAe,CAAE,UAAW,EAAK,CAAE,EACzC,MAAM,CAAC,EACP,OAAM,EAET,OAAIqC,GAASA,EAAM,OAAS,YAC1B,QAAQ,MAAM,kCAAmCA,CAAK,GAGhDvE,GAAM,aAAe,GAAK,CACpC,EAKA,MAAM,yBAAyBkC,EAAW,CACxC,GAAI,CAACyC,EACH,eAAQ,KAAK,yBAAyB,EAC/B,CAAE,YAAa,EAAG,eAAgB,CAAC,EAG5C,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,iCAAiC,EACxC,GAAG,aAAc1C,CAAS,EAC1B,GAAG,SAAU,CAAC,YAAa,WAAY,MAAM,CAAC,EAEjD,GAAIqC,EACF,eAAQ,MAAM,yCAA0CA,CAAK,EACtD,CAAE,YAAa,EAAG,eAAgB,CAAC,EAG5C,MAAMiK,GAAexO,GAAQ,IAAI,OAAO,CAACyO,EAAKC,IAAOD,GAAOC,EAAG,iBAAmB,GAAI,CAAC,EACjFC,EAAiB3O,GAAM,OAAS,EAAI,KAAK,IAAI,GAAGA,EAAK,IAAI0O,GAAMA,EAAG,gBAAkB,CAAC,CAAC,EAAI,EAEhG,MAAO,CAAE,YAAAF,EAAa,eAAAG,CAAc,CACtC,EAKA,MAAM,uBAAuBzM,EAAW,CACtC,GAAI,CAACyC,EACH,eAAQ,KAAK,yBAAyB,EAC/B,GAGT,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,GAAG,EACV,GAAG,aAAc1C,CAAS,EAC1B,MAAM,cAAe,CAAE,UAAW,EAAK,CAAE,EAE5C,OAAIqC,GACF,QAAQ,MAAM,gCAAiCA,CAAK,EAC7C,IAGFvE,GAAQ,EACjB,EAKA,MAAM,eAAe4O,EAAe,CAClC,GAAI,CAACjK,EACH,eAAQ,KAAK,yBAAyB,EAC/B,KAGT,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,OAKP,EACA,GAAG,KAAMgK,CAAa,EACtB,OAAM,EAET,OAAIrK,GACF,QAAQ,MAAM,+BAAgCA,CAAK,EAC5C,MAGFvE,CACT,EAKA,MAAM,kBAAkB6O,EAAa3O,EAAO,CAC1C,GAAI,CAACyE,EACH,eAAQ,KAAK,yBAAyB,EAC/B,KAIT,KAAM,CAAE,KAAM+J,EAAI,MAAOI,CAAO,EAAK,MAAMlK,EACxC,KAAK,eAAe,EACpB,OAAOiK,CAAW,EAClB,OAAM,EACN,OAAM,EAET,GAAIC,EACF,cAAQ,MAAM,+BAAgCA,CAAO,EAC/CA,EAIR,GAAI5O,GAASA,EAAM,OAAS,EAAG,CAC7B,MAAM6O,EAAkB7O,EAAM,IAAI,CAACG,EAAM2I,KAAW,CAClD,GAAG3I,EACH,gBAAiBqO,EAAG,GACpB,WAAY1F,CACpB,EAAQ,EAEI,CAAE,MAAOmE,CAAU,EAAK,MAAMvI,EACjC,KAAK,oBAAoB,EACzB,OAAOmK,CAAe,EAErB5B,GACF,QAAQ,MAAM,qCAAsCA,CAAU,CAGlE,CAGA,OAAO,KAAK,eAAeuB,EAAG,EAAE,CAClC,EAKA,MAAM,kBAAkBE,EAAerN,EAAS,CAC9C,GAAI,CAACoD,EACH,eAAQ,KAAK,yBAAyB,EAC/B,KAGT,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAOrD,CAAO,EACd,GAAG,KAAMqN,CAAa,EACtB,OAAM,EACN,OAAM,EAET,GAAIrK,EACF,cAAQ,MAAM,+BAAgCA,CAAK,EAC7CA,EAGR,OAAOvE,CACT,EAKA,MAAM,wBAAwB4O,EAAevM,EAAQ,CACnD,MAAMd,EAAU,CAAE,OAAAc,CAAM,EAGxB,OAAIA,IAAW,YACbd,EAAQ,aAAe,IAAI,KAAI,EAAG,YAAW,EACpCc,IAAW,WACpBd,EAAQ,YAAc,IAAI,KAAI,EAAG,YAAW,EACnCc,IAAW,SACpBd,EAAQ,QAAU,IAAI,KAAI,EAAG,YAAW,GAGnC,KAAK,kBAAkBqN,EAAerN,CAAO,CACtD,EAKA,MAAM,uBAAuBqN,EAAe1O,EAAO,CACjD,GAAI,CAACyE,EACH,eAAQ,KAAK,yBAAyB,EAC/B,GAIT,KAAM,CAAE,MAAOqK,CAAW,EAAK,MAAMpK,EAClC,KAAK,oBAAoB,EACzB,OAAM,EACN,GAAG,kBAAmBgK,CAAa,EAEtC,GAAII,EACF,cAAQ,MAAM,yCAA0CA,CAAW,EAC7DA,EAIR,GAAI9O,GAASA,EAAM,OAAS,EAAG,CAC7B,MAAM6O,EAAkB7O,EAAM,IAAI,CAACG,EAAM2I,KAAW,CAClD,GAAG3I,EACH,gBAAiBuO,EACjB,WAAY5F,CACpB,EAAQ,EAEI,CAAE,MAAOiG,CAAW,EAAK,MAAMrK,EAClC,KAAK,oBAAoB,EACzB,OAAOmK,CAAe,EAEzB,GAAIE,EACF,cAAQ,MAAM,sCAAuCA,CAAW,EAC1DA,CAEV,CAEA,MAAO,EACT,EAKA,MAAM,kBAAkBL,EAAe,CACrC,GAAI,CAACjK,EACH,eAAQ,KAAK,yBAAyB,EAC/B,GAGT,KAAM,CAAE,MAAAJ,CAAK,EAAK,MAAMK,EACrB,KAAK,eAAe,EACpB,OAAM,EACN,GAAG,KAAMgK,CAAa,EAEzB,GAAIrK,EACF,cAAQ,MAAM,+BAAgCA,CAAK,EAC7CA,EAGR,MAAO,EACT,EAMA,MAAM,oBAAoBrC,EAAW,CACnC,GAAI,CAACyC,EACH,eAAQ,KAAK,yBAAyB,EAC/B,GAGT,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAK,EAAK,MAAMK,EAC3B,KAAK,OAAO,EACZ,OAAO,0CAA0C,EACjD,GAAG,aAAc1C,CAAS,EAC1B,MAAM,YAAY,EAErB,OAAIqC,GACF,QAAQ,MAAM,qCAAsCA,CAAK,EAClD,KAIDvE,GAAQ,IAAI,IAAI,CAACsC,EAAM0G,KAAW,CACxC,QAAS1G,EAAK,GACd,YAAa,OAAO0G,EAAQ,CAAC,EAC7B,YAAa1G,EAAK,KAClB,gBAAiB,KAAK,OAAOA,EAAK,gBAAkB,IAAMA,EAAK,gBAAkB,GAAK,GAAG,CAC/F,EAAM,CACJ,EAKA,MAAM,qBAAqBJ,EAAW,CACpC,GAAI,CAACyC,EACH,eAAQ,KAAK,yBAAyB,EAC/B,GAIT,KAAM,CAAE,KAAMuK,EAAY,MAAOC,CAAS,EAAK,MAAMvK,EAClD,KAAK,eAAe,EACpB,OAAO,IAAI,EACX,GAAG,aAAc1C,CAAS,EAC1B,GAAG,SAAU,CAAC,YAAa,WAAY,MAAM,CAAC,EAC9C,MAAM,cAAe,CAAE,UAAW,EAAK,CAAE,EACzC,MAAM,CAAC,EACP,OAAM,EAET,GAAIiN,GAAaA,EAAU,OAAS,WAClC,eAAQ,MAAM,8BAA+BA,CAAS,EAC/C,GAGT,GAAI,CAACD,EACH,MAAO,GAIT,KAAM,CAAE,KAAMhP,EAAO,MAAOiN,CAAU,EAAK,MAAMvI,EAC9C,KAAK,oBAAoB,EACzB,OAAO,sCAAsC,EAC7C,GAAG,kBAAmBsK,EAAW,EAAE,EAEtC,OAAI/B,GACF,QAAQ,MAAM,sCAAuCA,CAAU,EACxD,KAIDjN,GAAS,IAAI,OAAO,CAACkP,EAAK/O,KAC5BA,EAAK,UACP+O,EAAI/O,EAAK,OAAO,EAAI,CAClB,iBAAkBA,EAAK,eAAiB,EACxC,gBAAiBA,EAAK,cAAgB,CAChD,GAEa+O,GACN,EAAE,CACP,EAKA,2BAA2B/C,EAAQgD,EAAgB,CACjD,MAAI,CAACA,GAAkBA,IAAmB,EAAU,EAC7C,KAAK,MAAOhD,EAASgD,EAAkB,GAAK,CACrD,EAKA,2BAA2BC,EAASD,EAAgB,CAClD,OAAO,KAAK,MAAOC,EAAU,IAASD,CAAc,CACtD,CACF,EC7SI,OAAO,OAAW,KACpBhQ,GAAA,EAAgB,MAAMkQ,GAAO,QAAQ,MAAM,6BAA8BA,CAAG,CAAC,EAQ/E,MAAMC,GAAc,IAAM,CACxB,MAAMpR,EAAM,sBACZ,IAAIqR,EAAW,aAAa,QAAQrR,CAAG,EACvC,OAAKqR,IACHA,EAAW,OAAO,aAClB,aAAa,QAAQrR,EAAKqR,CAAQ,GAE7BA,CACT,EA6CaC,GAAO,CAElB,MAAM,OAAOC,EAAOC,EAAUC,EAAU7F,EAAM,CAC5C,GAAIrF,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAAS,KAAK,OAAO,CACjD,MAAA+K,EACA,SAAAC,EACA,QAAS,CACP,KAAM,CACJ,KAAMC,EACN,KAAA7F,CAAA,CACF,CACF,CACD,EACD,GAAIzF,EAAO,MAAMA,EACjB,OAAOvE,CACT,KAAO,CAEL,MAAM+L,EAAYtF,EAAA,EACZG,EAAO,CACX,GAAI,OAAO,aACX,MAAA+I,EACA,KAAME,EACN,KAAA7F,EACA,WAAY,IAAI,OAAO,aAAY,EAErC,OAAA+B,EAAU,MAAM,KAAKnF,CAAI,EACzBF,GAAaqF,CAAS,EACtBlF,GAAaD,CAAI,EACV,CAAE,KAAAA,CAAA,CACX,CACF,EAGA,MAAM,OAAO+I,EAAOC,EAAU,CAC5B,GAAIjL,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAAS,KAAK,mBAAmB,CAC7D,MAAA+K,EACA,SAAAC,CAAA,CACD,EACD,GAAIrL,EAAO,MAAMA,EACjB,OAAOvE,CACT,KAAO,CAML,MAAM4G,EADYH,EAAA,EACK,MAAM,KAAKqJ,GAAKA,EAAE,QAAUH,CAAK,EACxD,GAAI,CAAC/I,EAAM,MAAM,IAAI,MAAM,gBAAgB,EAC3C,OAAAC,GAAaD,CAAI,EACV,CAAE,KAAAA,CAAA,CACX,CACF,EAGA,MAAM,SAAU,CACd,GAAIjC,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EAAS,KAAK,UACtC,GAAIL,EAAO,MAAMA,CACnB,MACEsC,GAAa,IAAI,CAErB,EAGA,MAAM,SAAU,CACd,GAAIlC,EAAsB,CACxB,KAAM,CAAE,KAAM,CAAE,KAAAiC,CAAA,GAAW,MAAMhC,EAAS,KAAK,UAC/C,OAAOgC,CACT,KACE,QAAOD,GAAA,CAEX,EAGA,MAAM,YAAa,CACjB,GAAIhC,EAAsB,CACxB,KAAM,CAAE,KAAM,CAAE,KAAAiC,CAAA,GAAW,MAAMhC,EAAS,KAAK,UAC/C,GAAI,CAACgC,EAAM,OAAO,KAElB,KAAM,CAAE,KAAA5G,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,OAAO,EACZ,OAAO,GAAG,EACV,GAAG,KAAMgC,EAAK,EAAE,EAChB,SAEH,OAAIrC,EAEK,CACL,GAAIqC,EAAK,GACT,MAAOA,EAAK,MACZ,KAAMA,EAAK,eAAe,MAAQ,GAClC,KAAMA,EAAK,eAAe,MAAQ,WAG/B5G,CACT,KACE,QAAO2G,GAAA,CAEX,EAGA,MAAM,WAAW6D,EAAQuF,EAAS,CAChC,GAAIpL,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,OAAO,EACZ,OAAO,CAAE,KAAMmL,CAAA,CAAS,EACxB,GAAG,KAAMvF,CAAM,EACf,SACA,SACH,GAAIjG,EAAO,MAAMA,EACjB,OAAOvE,CACT,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EACZG,EAAOmF,EAAU,MAAM,KAAK+D,GAAKA,EAAE,KAAOtF,CAAM,EACtD,OAAI5D,IACFA,EAAK,KAAOmJ,EACZrJ,GAAaqF,CAAS,EAClBpF,GAAA,GAAgB,KAAO6D,GACzB3D,GAAaD,CAAI,GAGdA,CACT,CACF,EAGA,kBAAkBpD,EAAU,CAC1B,GAAImB,EACF,OAAOC,EAAS,KAAK,kBAAkBpB,CAAQ,EAC1C,CAEL,MAAMoD,EAAOD,GAAA,EACb,OAAAnD,EAASoD,EAAO,YAAc,aAAc,CAAE,KAAAA,EAAM,EAC7C,CAAE,KAAM,CAAE,aAAc,CAAE,YAAa,IAAM,CAAC,GAAI,CAC3D,CACF,CACF,EAGaxH,EAAK,CAEhB,MAAM,YAAY0C,EAAY,KAAMkO,EAAkB,GAAO,CAC3D,GAAIrL,EAAsB,CAExB,GAAI,CAAClB,KAAuB,CAC1B,MAAMwM,EAAS,MAAMpO,GAAkBC,CAAS,EAChD,OAAIkO,EAAwBC,EACrBA,EAAO,OAAOC,GAAKA,EAAE,SAAW,UAAU,CACnD,CAEA,MAAM3K,EAAQ,YAAY,MAC1B,GAAI,CACF,IAAI+B,EAAQ1C,EACT,KAAK,UAAU,EACf,OAAO,GAAG,EACV,MAAM,aAAc,CAAE,UAAW,GAAO,EAEvC9C,IACFwF,EAAQA,EAAM,GAAG,aAAcxF,CAAS,GAGrCkO,IACH1I,EAAQA,EAAM,GAAG,SAAU,QAAQ,GAGrC,KAAM,CAAE,KAAAtH,EAAM,MAAAuE,CAAA,EAAU,MAAM+C,EACxB7B,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EAGrD,GAFAR,GAAQ,MAAM,cAAe,CAAE,SAAAU,EAAU,KAAMzF,GAAM,OAAQ,WAAY8B,EAAW,EAEhFyC,EAAO,CACTQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,cAAe,WAAYzC,CAAA,CAAW,EAErG,MAAMmO,EAAS,MAAMpO,GAAkBC,CAAS,EAChD,GAAImO,EAAO,OAAS,EAAG,OAAOA,EAC9B,MAAM1L,CACR,CAGA,OAAIvE,GAAM,OAAS,GACjB2B,GAAc3B,CAAI,EAAE,MAAMuP,GAAO,QAAQ,MAAM,4BAA6BA,CAAG,CAAC,EAG3EvP,CACT,OAASuE,EAAO,CACd,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,cAAe,WAAYzC,CAAA,CAAW,EAC/FyC,CACR,CACF,KAAO,CACL,MAAM3C,EAAW6E,IAAe,SAChC,OAAIuJ,EAAwBpO,EACrBA,EAAS,OAAOsO,GAAKA,EAAE,SAAW,UAAU,CACrD,CACF,EAGA,MAAM,qBAAqBpO,EAAW,CAAE,KAAAqO,EAAO,EAAG,MAAAC,EAAQ,GAAI,OAAA/N,EAAS,UAAa,GAAI,CACtF,GAAIsC,EAAsB,CACxB,MAAMY,EAAQ,YAAY,MAC1B,GAAI,CACF,IAAI+B,EAAQ1C,EACT,KAAK,UAAU,EACf,OAAO,IAAK,CAAE,MAAO,QAAS,EAC9B,GAAG,aAAc9C,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,GAAO,EACxC,MAAMqO,EAAOC,GAAQD,EAAO,GAAKC,EAAQ,CAAC,EAEzC/N,IAAW,QACbiF,EAAQA,EAAM,GAAG,SAAUjF,CAAM,GAGnC,KAAM,CAAE,KAAArC,EAAM,MAAAuE,EAAO,MAAA8L,CAAA,EAAU,MAAM/I,EAC/B7B,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EAGrD,GAFAR,GAAQ,MAAM,uBAAwB,CAAE,SAAAU,EAAU,KAAMzF,GAAM,OAAQ,KAAAmQ,EAAM,WAAYrO,CAAA,CAAW,EAE/FyC,EAAO,MAAMA,EAEjB,MAAO,CACL,SAAUvE,GAAQ,GAClB,WAAYqQ,GAAS,EACrB,SAAUF,EAAO,GAAKC,GAASC,GAAS,GACxC,KAAAF,EACA,MAAAC,CAAA,CAEJ,OAAS7L,EAAO,CACd,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,uBAAwB,WAAYzC,CAAA,CAAW,EACxGyC,CACR,CACF,CAEA,MAAM3C,EAAW6E,IAAe,SAAS,UACvCyJ,EAAE,aAAepO,IAAcO,IAAW,OAAS6N,EAAE,SAAW7N,EAAA,EAE5DkD,EAAQ4K,EAAOC,EACrB,MAAO,CACL,SAAUxO,EAAS,MAAM2D,EAAOA,EAAQ6K,CAAK,EAC7C,WAAYxO,EAAS,OACrB,QAAS2D,EAAQ6K,EAAQxO,EAAS,OAClC,KAAAuO,EACA,MAAAC,CAAA,CAEJ,EAIA,MAAM,uBAAuBtO,EAAW,CACtC,GAAI6C,EAAsB,CACxB,MAAMY,EAAQ,YAAY,MAC1B,GAAI,CAEF,KAAM,CAAE,KAAAvF,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAMP,EACA,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,QAAQ,EACrB,GAAG,yBAA0B,SAAS,EACtC,MAAM,aAAc,CAAE,UAAW,GAAO,EAErC2D,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EAGrD,GAFAR,GAAQ,MAAM,yBAA0B,CAAE,SAAAU,EAAU,KAAMzF,GAAM,OAAQ,WAAY8B,EAAW,EAE3FyC,EAAO,MAAMA,EAGjB,OAAQvE,GAAQ,IAAI,IAAIsQ,IAAY,CAClC,GAAGA,EACH,UAAWA,EAAQ,QAAQ,CAAC,GAAG,OAAS,EACxC,YAAaA,EAAQ,UAAU,CAAC,GAAG,OAAS,EAC5C,mBAAoBA,EAAQ,kBAAkB,CAAC,GAAG,OAAS,EAC3D,YAAaA,EAAQ,gBAAgB,CAAC,GAAG,OAAS,EAElD,MAAO,OACP,QAAS,OACT,gBAAiB,OACjB,cAAe,QACf,CACJ,OAAS/L,EAAO,CACd,OAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,yBAA0B,WAAYzC,CAAA,CAAW,EAEzG,KAAK,YAAYA,CAAS,CACnC,CACF,CACA,OAAO2E,EAAA,EAAe,SAAS,OAAOyJ,GAAKA,EAAE,aAAepO,GAAaoO,EAAE,SAAW,QAAQ,CAChG,EAIA,MAAM,2BAA2BpO,EAAW,CAC1C,GAAI6C,EAAsB,CACxB,MAAMY,EAAQ,YAAY,MAC1B,GAAI,CACF,KAAM,CAAE,KAAAvF,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,IAAI,gCAAiC,CAAE,aAAc9C,EAAW,EAE7D2D,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EAGrD,GAFAR,GAAQ,MAAM,6BAA8B,CAAE,SAAAU,EAAU,KAAMzF,GAAM,OAAQ,WAAY8B,EAAW,EAE/FyC,EAAO,CAET,GAAIA,EAAM,SAAS,SAAS,UAAU,GAAKA,EAAM,OAAS,QACxD,OAAO,KAAK,uBAAuBzC,CAAS,EAE9C,MAAMyC,CACR,CAGA,OAAQvE,GAAQ,IAAI,IAAIkQ,IAAM,CAC5B,GAAIA,EAAE,WACN,KAAMA,EAAE,aACR,OAAQA,EAAE,eACV,WAAYA,EAAE,eACd,QAASA,EAAE,gBACX,IAAKA,EAAE,YACP,WAAYA,EAAE,WACd,WAAYA,EAAE,WACd,SAAUA,EAAE,SAEZ,eAAgB,OAAOA,EAAE,cAAc,GAAK,EAC5C,UAAWA,EAAE,WAAa,aAC1B,SAAUA,EAAE,UAAY,WACxB,mBAAoBA,EAAE,oBAAsB,GAE5C,UAAW,OAAOA,EAAE,WAAW,GAAK,EACpC,eAAgB,OAAOA,EAAE,eAAe,GAAK,EAC7C,gBAAiB,OAAOA,EAAE,iBAAiB,GAAK,EAChD,aAAc,OAAOA,EAAE,aAAa,GAAK,EACzC,YAAa,OAAOA,EAAE,aAAa,GAAK,EACxC,mBAAoB,OAAOA,EAAE,eAAe,GAAK,EACjD,qBAAsB,OAAOA,EAAE,iBAAiB,GAAK,EACrD,oBAAqB,OAAOA,EAAE,gBAAgB,GAAK,EACnD,gBAAiB,OAAOA,EAAE,iBAAiB,GAAK,EAChD,gBAAiB,OAAOA,EAAE,iBAAiB,GAAK,EAChD,iBAAkB,OAAOA,EAAE,kBAAkB,GAAK,EAClD,eAAgBA,EAAE,iBAClB,qBAAsB,OAAOA,EAAE,uBAAuB,GAAK,EAC3D,SAAU,OAAOA,EAAE,SAAS,GAAK,EACjC,gBAAiB,OAAOA,EAAE,iBAAiB,GAAK,EAChD,mBAAoB,OAAOA,EAAE,oBAAoB,GAAK,GACtD,CACJ,OAAS3L,EAAO,CACd,OAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,6BAA8B,WAAYzC,CAAA,CAAW,EAE7G,KAAK,uBAAuBA,CAAS,CAC9C,CACF,CAEA,OAAO2E,EAAA,EAAe,SAAS,OAAOyJ,GAAKA,EAAE,aAAepO,GAAaoO,EAAE,SAAW,QAAQ,CAChG,EAEA,MAAM,oBAAoBpO,EAAW,CACnC,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO,GAAG,EACV,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,UAAU,EACvB,MAAM,cAAe,CAAE,UAAW,GAAO,EAC5C,GAAIyC,EAAO,MAAMA,EACjB,OAAOvE,CACT,KACE,QAAOyG,IAAe,SAAS,OAAOyJ,GAAKA,EAAE,SAAW,UAAU,CAEtE,EAEA,MAAM,gBAAgBpO,EAAW,CAC/B,GAAI6C,EAAsB,CACxB,KAAM,CAAE,MAAA0L,EAAO,MAAA9L,CAAA,EAAU,MAAMK,EAC5B,KAAK,UAAU,EACf,OAAO,IAAK,CAAE,MAAO,QAAS,KAAM,GAAM,EAC1C,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,CAAC,SAAU,UAAU,CAAC,EACtC,GAAIyC,EAAO,MAAMA,EACjB,OAAO8L,GAAS,CAClB,KAEE,QADiB5J,IAAe,SAChB,OAAOyJ,GAAKA,EAAE,aAAepO,GAAaoO,EAAE,SAAW,SAAS,EAAE,MAEtF,EAGA,MAAM,gBAAgBpO,EAAWwF,EAAO8I,EAAQ,GAAI,CAClD,GAAI,CAACzL,GAAwB,CAAC2C,GAAO,OACnC,MAAO,CAAE,SAAU,GAAI,QAAS,GAAI,KAAM,GAAI,QAAS,EAAC,EAG1D,MAAMiJ,EAAcjJ,EAAM,OAAO,cAC3BtD,EAAU,CAAE,SAAU,GAAI,QAAS,GAAI,KAAM,GAAI,QAAS,EAAC,EAEjE,GAAI,CAEF,KAAM,CAAE,KAAMpC,CAAA,EAAa,MAAMgD,EAC9B,KAAK,UAAU,EACf,OAAO,uCAAuC,EAC9C,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,QAAQ,EACrB,GAAG,eAAeyO,CAAW,uBAAuBA,CAAW,oBAAoBA,CAAW,GAAG,EACjG,MAAMH,CAAK,EAEdpM,EAAQ,SAAWpC,GAAY,GAG/B,KAAM,CAAE,KAAMgL,GAAY,MAAMhI,EAC7B,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,sBAAuB9C,CAAS,EACnC,MAAM,cAAe,IAAIyO,CAAW,GAAG,EACvC,MAAM,YAAa,CAAE,UAAW,GAAO,EACvC,MAAMH,CAAK,EAEdpM,EAAQ,SAAW4I,GAAW,IAAI,IAAI4D,IAAM,CAC1C,GAAGA,EACH,YAAaA,EAAE,UAAU,MAAQ,mBACjC,EAGF,KAAM,CAAE,KAAM9D,GAAS,MAAM9H,EAC1B,KAAK,eAAe,EACpB,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,sBAAuB9C,CAAS,EACnC,GAAG,gBAAgByO,CAAW,uBAAuBA,CAAW,GAAG,EACnE,MAAM,aAAc,CAAE,UAAW,GAAO,EACxC,MAAMH,CAAK,EAEdpM,EAAQ,MAAQ0I,GAAQ,IAAI,IAAI3N,IAAM,CACpC,GAAGA,EACH,YAAaA,EAAE,UAAU,MAAQ,mBACjC,EAGF,KAAM,CAAE,KAAM0R,GAAa,MAAM7L,EAC9B,KAAK,eAAe,EACpB,OAAO;AAAA;AAAA;AAAA;AAAA,SAIP,EACA,GAAG,sBAAuB9C,CAAS,EACnC,MAAM,gBAAiB,CAAE,UAAW,GAAO,EAC3C,MAAM,EAAE,EAGL4O,MAAgB,IACrB,OAACD,GAAY,IAAI,QAAQjO,GAAW,EAClCA,EAAQ,SAAW,IAAI,QAAQuH,GAAU,CACxC,GAAIA,EAAO,KAAK,cAAc,SAASwG,CAAW,EAAG,CACnD,MAAMnS,EAAM2L,EAAO,KAAK,cACnB2G,EAAU,IAAItS,CAAG,GACpBsS,EAAU,IAAItS,EAAK,CACjB,KAAM2L,EAAO,KACb,KAAMA,EAAO,KACb,YAAavH,EAAQ,UAAU,KAC/B,YAAaA,EAAQ,SACtB,CAEL,CACF,CAAC,CACH,CAAC,EAEDwB,EAAQ,QAAU,MAAM,KAAK0M,EAAU,QAAQ,EAAE,MAAM,EAAGN,CAAK,EAExDpM,CACT,OAASO,EAAO,CACd,eAAQ,MAAM,0BAA2BA,CAAK,EACvCP,CACT,CACF,EAEA,MAAM,eAAe3C,EAAI,CACvB,GAAIsD,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO,CACN,OAAQ,WACR,YAAa,IAAI,OAAO,aAAY,CACrC,EACA,GAAG,KAAMvD,CAAE,EACX,SACA,SACH,GAAIkD,EAAO,MAAMA,EACjB,OAAOvE,CACT,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EACZ6J,EAAUvE,EAAU,SAAS,KAAKmE,GAAKA,EAAE,KAAO7O,CAAE,EACxD,OAAIiP,IACFA,EAAQ,OAAS,WACjBA,EAAQ,YAAc,IAAI,OAAO,cACjC5J,GAAaqF,CAAS,GAEjBuE,CACT,CACF,EAGA,MAAM,uBAAuBpO,EAAW,CACtC,GAAI,CAACyC,EAAsB,MAAO,CAAE,WAAY,EAAG,YAAa,GAGhE,KAAM,CAAE,KAAMiI,EAAS,MAAArI,CAAA,EAAU,MAAMK,EACpC,KAAK,iBAAiB,EACtB,OAAO,QAAQ,EACf,GAAG,aAAc1C,CAAS,EAE7B,GAAIqC,EAAO,MAAMA,EAGjB,IAAIoM,EAAa,EACjB,MAAMC,EAAY,GAClBhE,GAAS,QAAQlK,GAAU,CACrBA,EAAO,QAAU,MAAM,QAAQA,EAAO,MAAM,IAC9CiO,GAAcjO,EAAO,OAAO,OAC5BkO,EAAU,KAAK,GAAGlO,EAAO,MAAM,EAEnC,CAAC,EAGD,MAAMmO,EAAcF,EAAa,IAEjC,MAAO,CAAE,WAAAA,EAAY,YAAAE,EAAa,UAAAD,CAAA,CACpC,EAIA,MAAM,mBAAmB1O,EAAWJ,EAAW,CAC7C,GAAI,CAAC6C,EAAsB,OAAO,KAGlC,KAAM,CAAE,UAAAiM,CAAA,EAAc,MAAM,KAAK,uBAAuB1O,CAAS,EAGjE,GAAI0O,EAAU,OAAS,EAAG,CACxB,MAAME,EAAYF,EACf,IAAIG,GAAa,CAChB,GAAI,CAACA,EAAW,OAAO,KACvB,GAAIA,EAAU,WAAW,MAAM,EAC7B,GAAI,CAEF,MAAMrJ,EADS,IAAI,IAAIqJ,CAAS,EACX,SAAS,MAAM,oBAAoB,EACxD,OAAOrJ,EAAQA,EAAM,CAAC,EAAI,IAC5B,MAAQ,CAAE,OAAO,IAAK,CAExB,OAAOqJ,CACT,CAAC,EACA,OAAO,OAAO,EAEjB,GAAID,EAAU,OAAS,EAErB,QAAS,EAAI,EAAG,EAAIA,EAAU,OAAQ,GAAK,IAAK,CAC9C,MAAME,EAAQF,EAAU,MAAM,EAAG,EAAI,GAAG,EACxC,MAAMlM,EAAS,QAAQ,KAAK,WAAW,EAAE,OAAOoM,CAAK,CACvD,CAEJ,CAGA,MAAMpM,EACH,KAAK,iBAAiB,EACtB,OAAO,CAAE,OAAQ,GAAI,EACrB,GAAG,aAAc1C,CAAS,EAG7B,KAAM,CAAE,KAAAlC,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO,CACN,OAAQ,WACR,YAAa,IAAI,OAAO,cACxB,OAAQ,GACR,gBAAiB,GAClB,EACA,GAAG,KAAM1C,CAAS,EAClB,SACA,SAEH,GAAIqC,EAAO,MAAMA,EACjB,MAAO,CAAE,GAAGvE,EAAM,cAAe4Q,EAAU,OAC7C,EAEA,MAAM,eAAevP,EAAI,CACvB,GAAIsD,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO,CACN,OAAQ,SACR,YAAa,KACd,EACA,GAAG,KAAMvD,CAAE,EACX,SACA,SACH,GAAIkD,EAAO,MAAMA,EACjB,OAAOvE,CACT,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EACZ6J,EAAUvE,EAAU,SAAS,KAAKmE,GAAKA,EAAE,KAAO7O,CAAE,EACxD,OAAIiP,IACFA,EAAQ,OAAS,SACjBA,EAAQ,YAAc,KACtB5J,GAAaqF,CAAS,GAEjBuE,CACT,CACF,EAEA,MAAM,WAAWjP,EAAI,CACnB,GAAIsD,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO,GAAG,EACV,GAAG,KAAMvD,CAAE,EACX,SACH,GAAIkD,EAAO,MAAMA,EACjB,OAAOvE,CACT,KACE,QAAOyG,IAAe,SAAS,KAAKyJ,GAAKA,EAAE,KAAO7O,CAAE,CAExD,EAEA,MAAM,cAAciP,EAAS,CAC3B,GAAI3L,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO,CACN,GAAG0L,EACH,OAAQ,SACT,EACA,SACA,SACH,GAAI/L,EACF,cAAQ,MAAM,gCAAiCA,EAAM,QAASA,EAAM,QAASA,EAAM,IAAI,EACjFA,EAER,OAAOvE,CACT,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EACZwK,EAAa,CACjB,GAAGX,EACH,GAAI,OAAO,aACX,OAAQ,SACR,WAAY,IAAI,OAAO,aAAY,EAErC,OAAAvE,EAAU,SAAS,KAAKkF,CAAU,EAClCvK,GAAaqF,CAAS,EACfkF,CACT,CACF,EAIA,MAAM,gBAAgBC,EAAK,CACzB,GAAIvM,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO,GAAG,EACV,GAAG,MAAOsM,CAAG,EACb,GAAG,SAAU,QAAQ,EACrB,SACH,OAAI3M,EAAc,KACXvE,CACT,KAEE,QADkByG,EAAA,EACD,SAAS,KAAKyJ,GAAKA,EAAE,MAAQgB,GAAOhB,EAAE,SAAW,QAAQ,GAAK,IAEnF,EAGA,MAAM,0BAA0BgB,EAAKpP,EAAW,CAC9C,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO,GAAG,EACV,GAAG,MAAOsM,CAAG,EACb,GAAG,aAAcpP,CAAS,EAC1B,GAAG,SAAU,QAAQ,EACrB,SACH,OAAIyC,EAAc,KACXvE,CACT,KAEE,QADkByG,EAAA,EACD,SAAS,KAAKyJ,GAC7BA,EAAE,MAAQgB,GACVhB,EAAE,aAAepO,GACjBoO,EAAE,SAAW,WACV,IAET,EAIA,MAAM,sBAAsBgB,EAAKC,EAAa,CAC5C,GAAIxM,EAAsB,CAExB,MAAMyM,EAAe,gBAAgBD,CAAW,GAC1CE,EAAa,eAAeF,CAAW,GACvCG,EAAe,EACfC,EAAa,IAAS,IAGtBC,EAAe,aAAa,QAAQH,CAAU,EACpD,GAAIG,GAAgB,KAAK,MAAQ,SAASA,CAAY,EAAG,CACvD,MAAMC,EAAc,SAASD,CAAY,EAAI,KAAK,MAC5CE,EAAgB,KAAK,KAAKD,EAAc,GAAK,EACnD,MAAO,CACL,QAAS,GACT,YAAa,GACb,QAAS,KACT,MAAO,0CAA0CC,CAAa,UAAUA,EAAgB,EAAI,IAAM,EAAE,IAExG,CAGA,IAAIC,EAAW,SAAS,aAAa,QAAQP,CAAY,GAAK,GAAG,EAKjE,GAJAO,IACA,aAAa,QAAQP,EAAcO,EAAS,UAAU,EAGlDA,EAAWL,EACb,oBAAa,QAAQD,GAAa,KAAK,MAAQE,GAAY,UAAU,EAC9D,CACL,QAAS,GACT,YAAa,GACb,QAAS,KACT,MAAO,4DAIX,MAAM9B,EAAWD,GAAA,EAGX,CAAE,KAAAxP,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,IAAI,kCAAmC,CACtC,MAAOsM,EACP,eAAgBC,EAChB,YAAa1B,EACb,aAAc,KACf,EAEH,GAAIlL,EACF,eAAQ,MAAM,sBAAsB,EAC7B,CAAE,QAAS,GAAO,YAAa,GAAO,QAAS,KAAM,MAAOA,EAAM,SAG3E,GAAI,CAACvE,GAAQA,EAAK,SAAW,EAC3B,MAAO,CAAE,QAAS,GAAO,YAAa,GAAO,QAAS,MAGxD,MAAMwF,EAASxF,EAAK,CAAC,EAGrB,GAAIwF,EAAO,aAAe,eACxB,MAAO,CAAE,QAAS,GAAO,YAAa,GAAM,QAAS,MAGvD,GAAIA,EAAO,aAAe,mBAAqBA,EAAO,aAAe,cACnE,MAAO,CAAE,QAAS,GAAO,YAAa,GAAO,QAAS,MAIxD,GAAI,CAACA,EAAO,SAAW,CAACA,EAAO,WAC7B,MAAO,CAAE,QAAS,GAAO,YAAa,GAAO,QAAS,MAIxD,aAAa,WAAW,gBAAgB2L,CAAW,EAAE,EACrD,aAAa,WAAW,eAAeA,CAAW,EAAE,EAGpDrL,GAAgB,CACd,MAAON,EAAO,cACd,UAAWA,EAAO,WAClB,UAAWA,EAAO,WAClB,YAAaA,EAAO,aACpB,YAAaA,EAAO,aACpB,UAAW,IAAI,OAAO,aAAY,CACnC,EAGD,MAAM+B,EAASrB,GAAA,EACT,CAAE,KAAM0L,EAAa,MAAOC,GAAiB,MAAMtK,EACtD,KAAK,UAAU,EACf,OAAO,GAAG,EACV,GAAG,KAAM/B,EAAO,UAAU,EAC1B,SAEH,MAAO,CACL,QAAS,GACT,YAAa,GACb,aAAcA,EAAO,cACrB,QAASoM,GAAe,CACtB,GAAIpM,EAAO,WACX,KAAMA,EAAO,aACb,WAAYA,EAAO,WACnB,OAAQ,SACV,CAEJ,KAAO,CAEL,MAAMuG,EAAYtF,EAAA,EAEZqL,GADY/F,EAAU,WAAa,IACf,KAAKhN,GAAKA,EAAE,OAASoS,CAAW,EAE1D,GAAI,CAACW,EACH,MAAO,CAAE,QAAS,GAAO,YAAa,GAAO,QAAS,MAGxD,MAAMxB,EAAUvE,EAAU,SAAS,KACjCmE,GAAKA,EAAE,MAAQgB,GAAOhB,EAAE,aAAe4B,EAAQ,IAAM5B,EAAE,SAAW,UAGpE,GAAII,EAAS,CAEX,MAAMyB,EAAY,QAAQ,KAAK,KAAK,IAAI,KAAK,SAAS,SAAS,EAAE,EAAE,MAAM,CAAC,CAAC,GAC3EjM,GAAgB,CACd,MAAOiM,EACP,UAAWzB,EAAQ,GACnB,UAAWwB,EAAQ,GACnB,YAAaxB,EAAQ,KACrB,YAAawB,EAAQ,KACrB,UAAW,IAAI,OAAO,aAAY,CACnC,CACH,CAEA,MAAO,CACL,QAAS,CAAC,CAACxB,EACX,YAAa,GACb,QAASA,GAAW,KAExB,CACF,EAGA,MAAM,eAAeY,EAAKc,EAAmB,KAAM,CACjD,GAAIrN,EAAsB,CACxB,IAAI2C,EAAQ1C,EACT,KAAK,UAAU,EACf,OAAO,IAAI,EACX,GAAG,MAAOsM,CAAG,EAEZc,IACF1K,EAAQA,EAAM,IAAI,KAAM0K,CAAgB,GAG1C,KAAM,CAAE,KAAAhS,EAAM,MAAAuE,CAAA,EAAU,MAAM+C,EAC9B,GAAI/C,EAAO,MAAMA,EACjB,OAAOvE,EAAK,SAAW,CACzB,KAEE,OAAO,CADWyG,EAAA,EACA,SAAS,KAAKyJ,GAAKA,EAAE,MAAQgB,GAAOhB,EAAE,KAAO8B,CAAgB,CAEnF,EAGA,MAAM,iBAAiB9P,EAAWgP,EAAK,CACrC,GAAIvM,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO,CAAE,IAAAsM,CAAA,CAAK,EACd,GAAG,KAAMhP,CAAS,EAClB,SACA,SACH,GAAIqC,EAAO,MAAMA,EACjB,OAAOvE,CACT,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EACZ6J,EAAUvE,EAAU,SAAS,KAAKmE,GAAKA,EAAE,KAAOhO,CAAS,EAC/D,OAAIoO,IACFA,EAAQ,IAAMY,EACdxK,GAAaqF,CAAS,GAEjBuE,CACT,CACF,EAGA,MAAM,cAAcjP,EAAIE,EAASO,EAAY,KAAM,CACjD,GAAI6C,EAAsB,CAExB,GAAI,CAAC7C,EACH,cAAQ,MAAM,6EAA6E,EACrF,IAAI,MAAM,kDAAkD,EAGpE,KAAM,CAAE,KAAA9B,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAOrD,CAAO,EACd,GAAG,KAAMF,CAAE,EACX,GAAG,aAAcS,CAAS,EAC1B,SACA,SAEH,GAAIyC,EACF,cAAQ,MAAM,wBAAwB,EAChCA,EAER,OAAOvE,CACT,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EACZ6J,EAAUvE,EAAU,SAAS,KAAKmE,GAAKA,EAAE,KAAO7O,CAAE,EACxD,OAAIiP,IACF,OAAO,OAAOA,EAAS/O,CAAO,EAC9BmF,GAAaqF,CAAS,GAEjBuE,CACT,CACF,EAGA,MAAM,cAAcjP,EAAIS,EAAY,KAAM,CACxC,GAAI6C,EAAsB,CACxB,IAAI2C,EAAQ1C,EACT,KAAK,UAAU,EACf,SACA,GAAG,KAAMvD,CAAE,EAGVS,IACFwF,EAAQA,EAAM,GAAG,aAAcxF,CAAS,GAG1C,KAAM,CAAE,MAAAyC,CAAA,EAAU,MAAM+C,EACxB,GAAI/C,EAAO,MAAMA,CACnB,KAAO,CACL,MAAMwH,EAAYtF,EAAA,EAClBsF,EAAU,SAAWA,EAAU,SAAS,OAAOmE,GAAKA,EAAE,KAAO7O,CAAE,EAC/D0K,EAAU,MAAQA,EAAU,MAAM,OAAO,GAAK,EAAE,aAAe1K,CAAE,EACjEqF,GAAaqF,CAAS,CACxB,CACF,EAGA,MAAM,SAAS7J,EAAW,CACxB,GAAIyC,EAAsB,CAExB,GAAI,CAAClB,KACH,OAAOxB,GAAeC,CAAS,EAGjC,MAAMqF,EAASnB,EAAA,EACT,CAAE,KAAApG,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,OAAO,EACZ,OAAO,GAAG,EACV,GAAG,aAAcrF,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,GAAM,EAE1C,GAAIqC,EAAO,CAET,MAAM0L,EAAS,MAAMhO,GAAeC,CAAS,EAC7C,GAAI+N,EAAO,OAAS,EAAG,OAAOA,EAC9B,MAAM1L,CACR,CAGA,OAAIvE,GAAM,OAAS,GACjB+B,GAAW/B,CAAI,EAAE,MAAMuP,GAAO,QAAQ,MAAM,yBAA0BA,CAAG,CAAC,EAGrEvP,CACT,KACE,QAAOyG,IAAe,MAAM,OAAOzI,GAAKA,EAAE,aAAekE,CAAS,CAEtE,EAEA,MAAM,WAAWI,EAAM,CACrB,GAAIqC,EAAsB,CACxB,MAAM4C,EAASnB,EAAA,EACT,CAAE,KAAApG,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,OAAO,EACZ,OAAOjF,CAAI,EACX,SACA,SACH,GAAIiC,EAAO,MAAMA,EACjB,OAAOvE,CACT,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EACZwL,EAAU,CACd,GAAG3P,EACH,GAAI,OAAO,aACX,WAAY,IAAI,OAAO,aAAY,EAErC,OAAAyJ,EAAU,MAAM,KAAKkG,CAAO,EAC5BvL,GAAaqF,CAAS,EACfkG,CACT,CACF,EAGA,MAAM,iBAAiB5Q,EAAIgB,EAAQH,EAAY,KAAM,CACnD,GAAIyC,EAAsB,CAExB,GAAI,CAAClB,KAAuB,CAC1B,MAAMnB,EAAO,MAAMH,GAAuBd,EAAIgB,CAAM,EACpD,aAAMxB,GAAiBD,GAAa,mBAAoB,CAAE,OAAQS,EAAI,OAAAgB,EAAQ,EACvEC,CACT,CAGA,IAAIgF,EADWlB,EAAA,EAEZ,KAAK,OAAO,EACZ,OAAO,CAAE,OAAA/D,EAAQ,EACjB,GAAG,KAAMhB,CAAE,EAGVa,IACFoF,EAAQA,EAAM,GAAG,aAAcpF,CAAS,GAG1C,KAAM,CAAE,KAAAlC,EAAM,MAAAuE,CAAA,EAAU,MAAM+C,EAAM,SAAS,SAE7C,GAAI/C,EAAO,CAET,GAAIA,EAAM,SAAS,SAAS,OAAO,GAAKA,EAAM,SAAS,SAAS,SAAS,EAAG,CAC1E,MAAMjC,EAAO,MAAMH,GAAuBd,EAAIgB,CAAM,EACpD,aAAMxB,GAAiBD,GAAa,mBAAoB,CAAE,OAAQS,EAAI,OAAAgB,EAAQ,EACvEC,CACT,CACA,MAAMiC,CACR,CAGA,OAAIvE,GACFmC,GAAuBd,EAAIgB,CAAM,EAAE,SAAa,QAAQ,MAAM,uCAAwCkN,CAAG,CAAC,EAGrGvP,CACT,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EACZnE,EAAOyJ,EAAU,MAAM,KAAK/N,GAAKA,EAAE,KAAOqD,CAAE,EAClD,OAAIiB,IACFA,EAAK,OAASD,EACdC,EAAK,WAAa,IAAI,OAAO,eAE/BoE,GAAaqF,CAAS,EACfzJ,CACT,CACF,EAGA,MAAM,WAAWjB,EAAIE,EAASW,EAAY,KAAM,CAC9C,GAAIyC,EAAsB,CACxB,IAAI2C,EAAQ1C,EACT,KAAK,OAAO,EACZ,OAAOrD,CAAO,EACd,GAAG,KAAMF,CAAE,EAGVa,IACFoF,EAAQA,EAAM,GAAG,aAAcpF,CAAS,GAG1C,KAAM,CAAE,KAAAlC,EAAM,MAAAuE,CAAA,EAAU,MAAM+C,EAAM,SAAS,SAC7C,GAAI/C,EAAO,MAAMA,EACjB,OAAOvE,CACT,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EACZnE,EAAOyJ,EAAU,MAAM,KAAK/N,GAAKA,EAAE,KAAOqD,CAAE,EAClD,OAAIiB,IACF,OAAO,OAAOA,EAAMf,CAAO,EAC3Be,EAAK,WAAa,IAAI,OAAO,eAE/BoE,GAAaqF,CAAS,EACfzJ,CACT,CACF,EAGA,MAAM,WAAWjB,EAAIa,EAAY,KAAM,CACrC,GAAIyC,EAAsB,CACxB,IAAI2C,EAAQ1C,EACT,KAAK,OAAO,EACZ,SACA,GAAG,KAAMvD,CAAE,EAGVa,IACFoF,EAAQA,EAAM,GAAG,aAAcpF,CAAS,GAG1C,KAAM,CAAE,MAAAqC,CAAA,EAAU,MAAM+C,EACxB,GAAI/C,EAAO,MAAMA,CACnB,KAAO,CACL,MAAMwH,EAAYtF,EAAA,EAClBsF,EAAU,MAAQA,EAAU,MAAM,OAAO,GAAK,EAAE,KAAO1K,CAAE,EACzDqF,GAAaqF,CAAS,CACxB,CACF,EAGA,iBAAiB7J,EAAWsB,EAAU,CACpC,OAAImB,EACKC,EACJ,QAAQ,SAAS1C,CAAS,EAAE,EAC5B,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,QAAS,OAAQ,iBAAiBA,CAAS,IAClFsB,CAAA,EAED,YAEE,IACT,EAGA,oBAAoBtB,EAAWsB,EAAU,CACvC,OAAImB,EACKC,EACJ,QAAQ,YAAY1C,CAAS,EAAE,EAC/B,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,WAAY,OAAQ,iBAAiBA,CAAS,IACrFsB,CAAA,EAED,YAEE,IACT,EAGA,4BAA4BtB,EAAWsB,EAAU,CAC/C,OAAImB,EACKC,EACJ,QAAQ,qBAAqB1C,CAAS,EAAE,EACxC,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,oBAAqB,OAAQ,iBAAiBA,CAAS,IAC9FsB,CAAA,EAED,YAEE,IACT,EAGA,wBAAwBtB,EAAWsB,EAAU,CAC3C,OAAImB,EACKC,EACJ,QAAQ,iBAAiB1C,CAAS,EAAE,EACpC,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,gBAAiB,OAAQ,iBAAiBA,CAAS,IAC1FsB,CAAA,EAED,YAEE,IACT,EAGA,wBAAwBtB,EAAWsB,EAAU,CAC3C,OAAImB,EACKC,EACJ,QAAQ,iBAAiB1C,CAAS,EAAE,EACpC,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,gBAAiB,OAAQ,iBAAiBA,CAAS,IAC1FsB,CAAA,EAED,YAEE,IACT,EAGA,yBAAyB1B,EAAW0B,EAAU,CAC5C,OAAImB,EACKC,EACJ,QAAQ,kBAAkB9C,CAAS,EAAE,EACrC,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,iBAAkB,OAAQ,iBAAiBA,CAAS,IAC3F0B,CAAA,EAED,YAEE,IACT,EAGA,qBAAqBtB,EAAWsB,EAAU,CACxC,OAAImB,EACKC,EACJ,QAAQ,cAAc1C,CAAS,EAAE,EACjC,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,kBAAmB,OAAQ,iBAAiBA,CAAS,IAC5FsB,CAAA,EAED,YAEE,IACT,EAGA,2BAA2B1B,EAAWoQ,EAAYC,EAAW,CAC3D,GAAI,CAACxN,GAAwB,CAACuN,GAAcA,EAAW,SAAW,EAAG,OAAO,KAE5E,MAAME,EAAUxN,EAAS,QAAQ,oBAAoB9C,CAAS,EAAE,EAIhE,OAAAoQ,EAAW,QAAQhQ,GAAa,CAE9BkQ,EAAQ,GAAG,mBACT,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,WAAY,OAAQ,iBAAiBlQ,CAAS,IACpFnB,GAAYoR,EAAU,YAAYpR,CAAO,GAI5CqR,EAAQ,GAAG,mBACT,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,oBAAqB,OAAQ,iBAAiBlQ,CAAS,IAC7FnB,GAAYoR,EAAU,oBAAoBpR,CAAO,GAIpDqR,EAAQ,GAAG,mBACT,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,kBAAmB,OAAQ,iBAAiBlQ,CAAS,IAC3FnB,GAAYoR,EAAU,aAAapR,CAAO,GAI7CqR,EAAQ,GAAG,mBACT,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,gBAAiB,OAAQ,iBAAiBlQ,CAAS,IACzFnB,GAAYoR,EAAU,gBAAgBpR,CAAO,GAIhDqR,EAAQ,GAAG,mBACT,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,QAAS,OAAQ,iBAAiBlQ,CAAS,IACjFnB,GAAYoR,EAAU,eAAepR,CAAO,GAI/CqR,EAAQ,GAAG,mBACT,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,gBAAiB,OAAQ,iBAAiBlQ,CAAS,IACzFnB,GAAYoR,EAAU,cAAcpR,CAAO,GAI9CqR,EAAQ,GAAG,mBACT,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,WAAY,OAAQ,SAASlQ,CAAS,IAC5EnB,GAAYoR,EAAU,kBAAkBpR,CAAO,EAEpD,CAAC,EAGDqR,EAAQ,GAAG,mBACT,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,iBAAkB,OAAQ,iBAAiBtQ,CAAS,IAC1Ff,GAAYoR,EAAU,iBAAiBpR,CAAO,GAIjDqR,EAAQ,GAAG,mBACT,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,sBAAuB,OAAQ,iBAAiBtQ,CAAS,IAC/Ff,GAAYoR,EAAU,6BAA6BpR,CAAO,GAI7DqR,EAAQ,GAAG,mBACT,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,cAAe,OAAQ,iBAAiBtQ,CAAS,IACvFf,GAAYoR,EAAU,oBAAoBpR,CAAO,GAG7CqR,EAAQ,WACjB,EAEA,YAAYC,EAAc,CACpBA,GAAgB1N,GAClBC,EAAS,cAAcyN,CAAY,CAEvC,EAMA,MAAM,oBAAoB7H,EAAQ,CAChC,GAAI7F,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,qBAAqB,EAC1B,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,UAAW4F,CAAM,EACvB,GAAIjG,EAAO,MAAMA,EACjB,OAAOvE,EAAK,IAAI,GAAK,EAAE,QAAQ,CACjC,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EAElB,OADoBsF,EAAU,aAAa,UAAY,EAAE,UAAYvB,CAAM,GAAK,IAC7D,IAAI,GAAKuB,EAAU,SAAS,KAAKmE,GAAKA,EAAE,KAAO,EAAE,UAAU,CAAC,EAAE,OAAO,OAAO,CACjG,CACF,EAEA,MAAM,oBAAoBhO,EAAWsI,EAAQ8H,EAAY,CACvD,GAAI3N,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,qBAAqB,EAC1B,OAAO,CAAE,WAAY1C,EAAW,QAASsI,EAAQ,YAAa8H,EAAY,EAC1E,SACA,SACH,GAAI/N,EAAO,MAAMA,EACjB,OAAOvE,CACT,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EACbsF,EAAU,cAAaA,EAAU,YAAc,IACpD,MAAMwG,EAAa,CACjB,GAAI,OAAO,aACX,WAAYrQ,EACZ,QAASsI,EACT,YAAa8H,EACb,YAAa,IAAI,OAAO,aAAY,EAEtC,OAAAvG,EAAU,YAAY,KAAKwG,CAAU,EACrC7L,GAAaqF,CAAS,EACfwG,CACT,CACF,EAEA,MAAM,sBAAsBrQ,EAAWsI,EAAQ,CAC7C,GAAI7F,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EACrB,KAAK,qBAAqB,EAC1B,SACA,GAAG,aAAc1C,CAAS,EAC1B,GAAG,UAAWsI,CAAM,EACvB,GAAIjG,EAAO,MAAMA,CACnB,KAAO,CACL,MAAMwH,EAAYtF,EAAA,EAClBsF,EAAU,YAAcA,EAAU,aAAa,UACxC,EAAE,EAAE,aAAe7J,GAAa,EAAE,UAAYsI,EAAA,GAChD,GACL9D,GAAaqF,CAAS,CACxB,CACF,EAEA,MAAM,sBAAsB7J,EAAW,CACrC,GAAIyC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,qBAAqB,EAC1B,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,aAAc1C,CAAS,EAC7B,GAAIqC,EAAO,MAAMA,EACjB,OAAOvE,EAAK,IAAI,GAAK,EAAE,KAAK,CAC9B,KAAO,CACL,MAAM+L,EAAYtF,EAAA,EAElB,OADoBsF,EAAU,aAAa,UAAY,EAAE,aAAe7J,CAAS,GAAK,IACnE,IAAI,GAAK6J,EAAU,MAAM,KAAK+D,GAAKA,EAAE,KAAO,EAAE,OAAO,CAAC,EAAE,OAAO,OAAO,CAC3F,CACF,EAGA,MAAM,aAAc,CAClB,GAAInL,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,OAAO,EACZ,OAAO,GAAG,EACV,MAAM,MAAM,EACf,GAAIL,EAAO,MAAMA,EACjB,OAAOvE,CACT,KACE,QAAOyG,EAAA,EAAe,OAAS,EAEnC,EAGA,MAAM,YAAa,CACjB,GAAI9B,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,OAAO,EACZ,OAAO,GAAG,EACV,GAAG,OAAQ,SAAS,EACpB,MAAM,MAAM,EACf,GAAIL,EAAO,MAAMA,EACjB,OAAOvE,CACT,KACE,QAAQyG,IAAe,OAAS,IAAI,OAAOqJ,GAAKA,EAAE,OAAS,SAAS,CAExE,EAMA,MAAM,YAAYtF,EAAQtI,EAAWE,EAAQnB,EAAQuR,EAAUC,EAAU,CACvE,GAAI9N,EAAsB,CACxB,KAAM,CAAE,MAAAJ,GAAU,MAAMK,EACrB,KAAK,cAAc,EACnB,OAAO,CACN,QAAS4F,EACT,WAAYtI,EACZ,QAASE,EACT,OAAAnB,EACA,UAAWuR,EACX,UAAWC,CAAA,CACZ,EACClO,GAAO,QAAQ,MAAM,0BAA2BA,CAAK,CAC3D,CAEF,EAEA,MAAM,mBAAmBrC,EAAWkO,EAAQ,GAAI,CAC9C,GAAIzL,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,cAAc,EACnB,OAAO;AAAA;AAAA;AAAA;AAAA,SAIP,EACA,GAAG,aAAc1C,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,GAAO,EACxC,MAAMkO,CAAK,EACd,GAAI7L,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAMA,MAAM,sBAAsB8B,EAAW,CACrC,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,qBAAqB,EAC1B,OAAO,GAAG,EACV,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,EAAI,EACjB,MAAM,UAAU,EAChB,MAAM,MAAM,EACf,GAAIyC,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAEA,MAAM,gCAAgC8B,EAAWqD,EAAU,CACzD,GAAIR,EAAsB,CACxB,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EAAQ,MAAO,GACpB,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,qBAAqB,EAC1B,OAAO,GAAG,EACV,GAAG,aAAczF,CAAS,EAC1B,GAAG,WAAYqD,CAAQ,EACvB,GAAG,SAAU,EAAI,EACjB,MAAM,MAAM,EACf,GAAIZ,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAEA,MAAM,yBAAyB8B,EAAW,CACxC,GAAI6C,EAAsB,CACxB,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EAAQ,MAAO,GACpB,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,qBAAqB,EAC1B,OAAO,GAAG,EACV,GAAG,aAAczF,CAAS,EAC1B,MAAM,UAAU,EAChB,MAAM,MAAM,EACf,GAAIyC,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAEA,MAAM,wBAAwBK,EAAM,CAClC,GAAIsE,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,qBAAqB,EAC1B,OAAOvE,CAAI,EACX,SACA,SACH,GAAIkE,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,wBAAwBqB,EAAIE,EAAS,CACzC,GAAIoD,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,qBAAqB,EAC1B,OAAOrD,CAAO,EACd,GAAG,KAAMF,CAAE,EACX,SACA,SACH,GAAIkD,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,wBAAwBqB,EAAI,CAChC,GAAIsD,EAAsB,CAExB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EACrB,KAAK,qBAAqB,EAC1B,OAAO,CAAE,OAAQ,GAAO,EACxB,GAAG,KAAMvD,CAAE,EACd,GAAIkD,EAAO,MAAMA,CACnB,CACF,EAOA,MAAM,mBAAmBzC,EAAW,CAClC,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,kBAAkB,EACvB,OAAO,GAAG,EACV,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,EAAI,EACjB,MAAM,YAAY,EAClB,MAAM,MAAM,EACf,GAAIyC,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,CACA,MAAO,EACT,EAGA,MAAM,oBAAoB8B,EAAWoI,EAAMwI,EAAY,EAAG,CACxD,GAAI/N,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,kBAAkB,EACvB,OAAO,CACN,WAAY9C,EACZ,KAAAoI,EACA,WAAYwI,CAAA,CACb,EACA,SACA,SACH,GAAInO,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,oBAAoBqB,EAAIE,EAAS,CACrC,GAAIoD,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,kBAAkB,EACvB,OAAOrD,CAAO,EACd,GAAG,KAAMF,CAAE,EACX,SACA,SACH,GAAIkD,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,oBAAoBqB,EAAI,CAC5B,GAAIsD,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EACrB,KAAK,kBAAkB,EACvB,OAAO,CAAE,OAAQ,GAAO,EACxB,GAAG,KAAMvD,CAAE,EACd,GAAIkD,EAAO,MAAMA,CACnB,CACF,EAGA,MAAM,gBAAgBzC,EAAW,CAC/B,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,EAAI,EACjB,MAAM,YAAY,EAClB,MAAM,MAAM,EACf,GAAIyC,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,CACA,MAAO,EACT,EAGA,MAAM,8BAA8B8B,EAAW,CAC7C,GAAI6C,EAAsB,CACxB,KAAM,CAACgO,EAAkBC,CAAa,EAAI,MAAM,QAAQ,IAAI,CAC1DhO,EACG,KAAK,kBAAkB,EACvB,OAAO,GAAG,EACV,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,EAAI,EACjB,MAAM,YAAY,EAClB,MAAM,MAAM,EACf8C,EACG,KAAK,eAAe,EACpB,OAAO,GAAG,EACV,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,EAAI,EACjB,MAAM,YAAY,EAClB,MAAM,MAAM,EAChB,EAED,GAAI6Q,EAAiB,MAAO,MAAMA,EAAiB,MACnD,GAAIC,EAAc,MAAO,MAAMA,EAAc,MAE7C,MAAO,CACL,WAAYD,EAAiB,MAAQ,GACrC,QAASC,EAAc,MAAQ,EAAC,CAEpC,CACA,MAAO,CAAE,WAAY,GAAI,QAAS,EAAC,CACrC,EAIA,MAAM,wBAAwB9Q,EAAW,CACvC,GAAI6C,EAAsB,CACxB,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EAAQ,MAAO,CAAE,WAAY,GAAI,QAAS,EAAC,EAGhD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,IAAI,8BAA+B,CAAE,aAAczF,EAAW,EAEjE,GAAIyC,EAAO,CACT,QAAQ,MAAM,qCAAsCA,CAAK,EAEzD,KAAM,CAACoO,EAAkBC,CAAa,EAAI,MAAM,QAAQ,IAAI,CAC1DrL,EACG,KAAK,kBAAkB,EACvB,OAAO,UAAU,EACjB,GAAG,aAAczF,CAAS,EAC1B,GAAG,SAAU,EAAI,EACjB,MAAM,MAAM,EACfyF,EACG,KAAK,eAAe,EACpB,OAAO,uBAAuB,EAC9B,GAAG,aAAczF,CAAS,EAC1B,GAAG,SAAU,EAAI,EACjB,MAAM,MAAM,EAChB,EAED,MAAO,CACL,WAAY6Q,EAAiB,MAAQ,GACrC,QAASC,EAAc,MAAQ,EAAC,CAEpC,CAGA,MAAMC,MAAoB,IACpBC,EAAU,GAEhB,UAAWjI,KAAQ7K,GAAQ,GACrB6K,EAAI,aAAeA,EAAI,eAAiB,CAACgI,EAAc,IAAIhI,EAAI,WAAW,GAC5EgI,EAAc,IAAIhI,EAAI,YAAa,CAAE,GAAIA,EAAI,YAAa,KAAMA,EAAI,cAAe,EAErFiI,EAAQ,KAAK,CACX,GAAIjI,EAAI,GACR,KAAMA,EAAI,KACV,YAAaA,EAAI,YAClB,EAGH,MAAO,CACL,WAAY,MAAM,KAAKgI,EAAc,QAAQ,EAC7C,QAAAC,CAAA,CAEJ,CACA,MAAO,CAAE,WAAY,GAAI,QAAS,EAAC,CACrC,EAGA,MAAM,iBAAiBhR,EAAWiR,EAAY7I,EAAMwI,EAAY,EAAG,CACjE,GAAI/N,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,WAAY9C,EACZ,YAAaiR,EACb,KAAA7I,EACA,WAAYwI,CAAA,CACb,EACA,SACA,SACH,GAAInO,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,iBAAiBqB,EAAIE,EAAS,CAClC,GAAIoD,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAOrD,CAAO,EACd,GAAG,KAAMF,CAAE,EACX,SACA,SACH,GAAIkD,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,iBAAiBqB,EAAI,CACzB,GAAIsD,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EACrB,KAAK,eAAe,EACpB,OAAO,CAAE,OAAQ,GAAO,EACxB,GAAG,KAAMvD,CAAE,EACd,GAAIkD,EAAO,MAAMA,CACnB,CACF,EAGA,MAAM,mBAAmByO,EAAc,CACrC,GAAIrO,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,mBAAmB,EACxB,OAAO,GAAG,EACV,GAAG,iBAAkBoO,CAAY,EACpC,GAAIzO,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,CACA,MAAO,EACT,EAGA,MAAM,sBAAsB8B,EAAW,CACrC,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO;AAAA;AAAA;AAAA;AAAA,SAIP,EACA,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,EAAI,EACpB,GAAIyC,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,CACA,MAAO,EACT,EAGA,MAAM,oBAAoBgT,EAActJ,EAAO,CAC7C,GAAI/E,EAAsB,CAExB,MAAMsO,EAAmBvJ,EAAM,IAAIxG,IAAM,CACvC,GAAGA,EACH,eAAgB8P,CAAA,EAChB,EAGI,CAAE,MAAAzO,GAAU,MAAMK,EACrB,KAAK,mBAAmB,EACxB,OAAOqO,EAAkB,CACxB,WAAY,oCACb,EACH,GAAI1O,EAAO,MAAMA,CACnB,CACF,EAGA,MAAM,kBAAkByO,EAAczJ,EAAUC,EAAS,CACvD,GAAI7E,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,mBAAmB,EACxB,OAAO,6BAA6B,EACpC,GAAG,iBAAkBoO,CAAY,EACjC,GAAG,YAAazJ,CAAQ,EACxB,GAAG,WAAYC,CAAO,EACtB,SACH,GAAIjF,GAASA,EAAM,OAAS,WAAY,MAAMA,EAC9C,OAAOvE,GAAQ,IACjB,CACA,OAAO,IACT,EAMA,MAAM,aAAakC,EAAW,CAC5B,GAAIyC,EAAsB,CACxB,MAAMY,EAAQ,YAAY,MACpBgC,EAASnB,EAAA,EAIT8M,EAHc7M,GAAA,EAIhB,6CACA,4DAEJ,GAAI,CACF,KAAM,CAAE,KAAArG,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,gBAKF2L,CAAe;AAAA;AAAA,WAEpB,EACA,GAAG,aAAchR,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,GAAO,EAErCuD,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EAGrD,GAFAR,GAAQ,MAAM,eAAgB,CAAE,SAAAU,EAAU,KAAMzF,GAAM,OAAQ,WAAYkC,EAAW,EAEjFqC,EAAO,MAAMA,EACjB,OAAOvE,CACT,OAASuE,EAAO,CACd,MAAAQ,GAAQ,MAAM,WAAY,CACxB,QAASR,EAAM,QACf,UAAW,eACX,WAAYrC,CAAA,CACb,EACKqC,CACR,CACF,CACA,MAAO,EACT,EAGA,MAAM,sBAAsBrC,EAAW,CAAE,KAAAiO,EAAO,EAAG,MAAAC,EAAQ,GAAI,OAAA/N,EAAS,MAAS,GAAI,CACnF,GAAIsC,EAAsB,CACxB,MAAMY,EAAQ,YAAY,MACpBgC,EAASnB,EAAA,EAIT8M,EAHc7M,GAAA,EAIhB,6CACA,4DAEJ,GAAI,CACF,IAAIiB,EAAQC,EACT,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA,gBAKF2L,CAAe;AAAA;AAAA,YAElB,CAAE,MAAO,QAAS,EACpB,GAAG,aAAchR,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,GAAO,EACxC,MAAMiO,EAAOC,GAAQD,EAAO,GAAKC,EAAQ,CAAC,EAEzC/N,IACFiF,EAAQA,EAAM,GAAG,SAAUjF,CAAM,GAGnC,KAAM,CAAE,KAAArC,EAAM,MAAAuE,EAAO,MAAA8L,CAAA,EAAU,MAAM/I,EAE/B7B,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EAGrD,GAFAR,GAAQ,MAAM,wBAAyB,CAAE,SAAAU,EAAU,KAAMzF,GAAM,OAAQ,KAAAmQ,EAAM,WAAYjO,CAAA,CAAW,EAEhGqC,EAAO,MAAMA,EAEjB,MAAO,CACL,QAASvE,GAAQ,GACjB,WAAYqQ,GAAS,EACrB,SAAUF,EAAO,GAAKC,GAASC,GAAS,GACxC,KAAAF,EACA,MAAAC,CAAA,CAEJ,OAAS7L,EAAO,CACd,MAAAQ,GAAQ,MAAM,WAAY,CACxB,QAASR,EAAM,QACf,UAAW,wBACX,WAAYrC,CAAA,CACb,EACKqC,CACR,CACF,CACA,MAAO,CAAE,QAAS,GAAI,WAAY,EAAG,QAAS,GAAO,KAAM,EAAG,MAAO,GACvE,EAGA,MAAM,qBAAqBrC,EAAW,CACpC,GAAIyC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,iBAAiB,EACtB,OAAO,2CAA2C,EAClD,GAAG,aAAc1C,CAAS,EAC1B,IAAI,gBAAiB,KAAM,IAAI,EAC/B,IAAI,gBAAiB,EAAE,EAE1B,GAAIqC,EAAO,MAAMA,EAGjB,MAAM4O,EAAe,GACrB,IAAIC,EAAgB,EAChBC,EAAe,EAEnB,OAAArT,GAAM,QAAQ0C,GAAU,CACtB,MAAM4Q,EAAW5Q,EAAO,cAMxB,GALKyQ,EAAaG,CAAQ,IACxBH,EAAaG,CAAQ,EAAI,CAAE,SAAU,EAAG,QAAS,EAAG,MAAO,IAE7DH,EAAaG,CAAQ,EAAE,QAEnB5Q,EAAO,SAAW,YAAcA,EAAO,SAAW,SAAU,CAC9D,MAAMhC,EAAQ,WAAWgC,EAAO,kBAAkB,GAAK,EACvDyQ,EAAaG,CAAQ,EAAE,UAAY5S,EACnC0S,GAAiB1S,CACnB,MAAWgC,EAAO,SAAW,WAC3B2Q,GAEJ,CAAC,EAEM,CACL,aAAAF,EACA,mBAAoBC,EACpB,aAAcC,CAAA,CAElB,CACA,MAAO,CAAE,aAAc,GAAI,mBAAoB,EAAG,aAAc,EAClE,EAEA,MAAM,qBAAqBnR,EAAWG,EAAQ,CAC5C,GAAIsC,EAAsB,CACxB,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EAAQ,MAAO,GAEpB,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAOP,EACA,GAAG,aAAcrF,CAAS,EAC1B,GAAG,SAAUG,CAAM,EACnB,MAAM,aAAc,CAAE,UAAW,GAAO,EAC3C,GAAIkC,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,MAAO,EACT,EAGA,MAAM,cAAckH,EAAO,CACzB,GAAIvC,EAAsB,CACxB,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EAAQ,MAAO,GAEpB,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAOP,EACA,GAAG,kBAAmBL,CAAK,EAC3B,MAAM,YAAa,CAAE,UAAW,GAAM,EACzC,GAAI3C,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,CACA,MAAO,EACT,EAEA,MAAM,eAAe0C,EAAQ,CAC3B,GAAIiC,EAAsB,CAExB,GAAI,CAAClB,KAAuB,CAC1B,MAAM8P,EAAa,CACjB,GAAI5Q,GAAA,EACJ,WAAYD,EAAO,WACnB,UAAWA,EAAO,UAClB,cAAeA,EAAO,eAAiB,KACvC,gBAAiBA,EAAO,iBAAmB,KAC3C,MAAOA,EAAO,MACd,OAAQA,EAAO,QAAU,GACzB,OAAQ,eACR,gBAAiBA,EAAO,iBAAmB,aAC3C,WAAY,IAAI,OAAO,cACvB,SAAU,IAEZ,aAAMD,GAAc8Q,CAAU,EAC9B,MAAM1S,GAAiBD,GAAa,iBAAkB,CACpD,OAAQ2S,EACR,QAAS7Q,EAAO,UAAY,GAC5B,MAAOA,EAAO,QAAU,EAAC,CAC1B,EACM6Q,CACT,CAEA,MAAMhM,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAEjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,iBAAiB,EACtB,OAAO,CACN,WAAY7E,EAAO,WACnB,UAAWA,EAAO,UAClB,cAAeA,EAAO,eAAiB,KACvC,gBAAiBA,EAAO,iBAAmB,KAC3C,MAAOA,EAAO,MACd,OAAQA,EAAO,QAAU,GACzB,OAAQ,UACR,gBAAiBA,EAAO,iBAAmB,aAC5C,EACA,SACA,SAEH,GAAI6B,EAAO,CAET,GAAIA,EAAM,SAAS,SAAS,OAAO,GAAKA,EAAM,SAAS,SAAS,SAAS,EAAG,CAC1E,MAAMgP,EAAa,CACjB,GAAI5Q,GAAA,EACJ,GAAGD,EACH,OAAQ,eACR,SAAU,IAEZ,aAAMD,GAAc8Q,CAAU,EAC9B,MAAM1S,GAAiBD,GAAa,iBAAkB,CACpD,OAAQ2S,EACR,QAAS7Q,EAAO,UAAY,GAC5B,MAAOA,EAAO,QAAU,EAAC,CAC1B,EACM6Q,CACT,CACA,MAAMhP,CACR,CACA,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,aAAasJ,EAAUkK,EAAS,CACpC,GAAI7O,EAAsB,CACxB,MAAM8O,EAAcD,EAAQ,IAAIE,IAAM,CACpC,UAAWpK,EACX,KAAMoK,EAAE,KACR,MAAOA,EAAE,MACT,eAAgBA,EAAE,gBAAkB,EACpC,aAAcA,EAAE,cAAgB,KAChC,WAAYA,EAAE,YAAc,KAC5B,KAAMA,EAAE,MAAQ,WAChB,EACInM,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAEjD,KAAM,CAAE,MAAAhD,GAAU,MAAMgD,EACrB,KAAK,iBAAiB,EACtB,OAAOkM,CAAW,EACrB,GAAIlP,EAAO,MAAMA,CACnB,CACF,EAEA,MAAM,WAAW+E,EAAUpJ,EAAO,CAChC,GAAIyE,EAAsB,CACxB,MAAMgP,EAAYzT,EAAM,IAAIG,IAAS,CACnC,UAAWiJ,EACX,sBAAuBjJ,EAAK,uBAAyB,KACrD,YAAaA,EAAK,aAAe,KACjC,gBAAiBA,EAAK,iBAAmB,KACzC,SAAUA,EAAK,UACf,EACIkH,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAEjD,KAAM,CAAE,MAAAhD,GAAU,MAAMgD,EACrB,KAAK,eAAe,EACpB,OAAOoM,CAAS,EACnB,GAAIpP,EAAO,MAAMA,CACnB,CACF,EAGA,MAAM,sBAAsBrC,EAAW0R,EAAY,CACjD,GAAI,CAACjP,EAAsB,OAAO,KAElC,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EAAQ,OAAO,KAGpB,KAAM,CAAE,KAAM7E,EAAQ,MAAA6B,CAAA,EAAU,MAAMgD,EACnC,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA,OAIP,EACA,GAAG,aAAcrF,CAAS,EAC1B,GAAG,YAAa0R,CAAU,EAC1B,MAAM,YAAa,CAAE,UAAW,GAAO,EACvC,MAAM,CAAC,EACP,cAEH,GAAIrP,GAAS,CAAC7B,EAAQ,OAAO,KAG7B,MAAM8Q,EAAU9Q,EAAO,iBAAmB,GAGpCmR,EAAmBL,EAAQ,KAAKE,GAAKA,EAAE,cAAc,EAGrDI,EAAiB,GACnBD,GACFL,EAAQ,QAAQE,GAAK,CACfA,EAAE,iBACCI,EAAeJ,EAAE,cAAc,IAClCI,EAAeJ,EAAE,cAAc,EAAI,IAErCI,EAAeJ,EAAE,cAAc,EAAE,KAAK,CACpC,KAAMA,EAAE,KACR,MAAOA,EAAE,OAAO,YAAc,GAC9B,cAAeA,EAAE,gBAAgB,YAAc,GAC/C,YAAaA,EAAE,cAAgB,GAC/B,UAAWA,EAAE,YAAc,GAC5B,EAEL,CAAC,EAIH,MAAMK,EAAcP,EACjB,OAAOE,GAAK,CAAC,UAAW,kBAAmB,gBAAgB,EAAE,SAASA,EAAE,IAAI,CAAC,EAC7E,IAAIA,IAAM,CACT,KAAMA,EAAE,KACR,MAAOA,EAAE,OAAO,YAAc,GAC9B,cAAeA,EAAE,gBAAgB,YAAc,GAC/C,YAAaA,EAAE,cAAgB,GAC/B,UAAWA,EAAE,YAAc,GAC3B,KAAMA,EAAE,MACR,EAEEM,EAAYR,EACf,OAAOE,GAAKA,EAAE,OAAS,UAAU,EACjC,IAAIA,IAAM,CACT,KAAMA,EAAE,KACR,MAAOA,EAAE,OAAO,YAAc,GAC9B,cAAeA,EAAE,gBAAgB,YAAc,GAC/C,YAAaA,EAAE,cAAgB,GAC/B,UAAWA,EAAE,YAAc,IAC3B,EAEEO,EAAWT,EACd,OAAOE,GAAKA,EAAE,OAAS,SAAS,EAChC,IAAIA,IAAM,CACT,KAAMA,EAAE,KACR,MAAOA,EAAE,OAAO,YAAc,GAC9B,cAAeA,EAAE,gBAAgB,YAAc,GAC/C,YAAaA,EAAE,cAAgB,GAC/B,UAAWA,EAAE,YAAc,IAC3B,EAEJ,MAAO,CACL,SAAUhR,EAAO,UACjB,YAAaqR,EAAY,OAAS,EAAIA,EAAc,KACpD,UAAWC,EAAU,OAAS,EAAIA,EAAY,KAC9C,SAAUC,EAAS,OAAS,EAAIA,EAAW,KAC3C,eAAgB,OAAO,KAAKH,CAAc,EAAE,OAAS,EAAIA,EAAiB,KAC1E,aAAcN,EAAQ,OAE1B,EAEA,MAAM,qBAAqBlK,EAAUjH,EAAQ,CAC3C,GAAIsC,EAAsB,CACxB,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAEjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,iBAAiB,EACtB,OAAO,CAAE,OAAAlF,CAAA,CAAQ,EACjB,GAAG,KAAMiH,CAAQ,EACjB,SACA,SACH,GAAI/E,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,gBAAgBsJ,EAAUkB,EAAQ0J,EAAUC,EAAmB,KAAM,CACzE,GAAIxP,EAAsB,CACxB,MAAMsD,EAAa,CACjB,OAAQ,WACR,oBAAqBuC,EACrB,iBAAkB0J,EAClB,YAAa,IAAI,OAAO,cAExB,oBAAqB,KACrB,iBAAkB,KAClB,YAAa,KACb,iBAAkB,MAIhBC,IAAqB,OACvBlM,EAAW,mBAAqB,WAAWkM,CAAgB,GAAK,GAGlE,MAAM5M,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAEjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,iBAAiB,EACtB,OAAOU,CAAU,EACjB,GAAG,KAAMqB,CAAQ,EACjB,SACA,SACH,GAAI/E,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,eAAesJ,EAAUkB,EAAQ0J,EAAUzJ,EAAS,GAAI,CAC5D,GAAI9F,EAAsB,CACxB,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAEjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,iBAAiB,EACtB,OAAO,CACN,OAAQ,WACR,oBAAqBiD,EACrB,iBAAkB0J,EAClB,YAAa,IAAI,OAAO,cACxB,iBAAkBzJ,EAElB,oBAAqB,KACrB,iBAAkB,KAClB,YAAa,KACd,EACA,GAAG,KAAMnB,CAAQ,EACjB,SACA,SACH,GAAI/E,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,kBAAkBgK,EAAM,CAEtB,MADsB,CAAC,QAAS,QAAS,SAAS,EAC7B,SAASA,CAAI,CACpC,EAEA,MAAM,qBAAqBV,EAAU8K,EAAQ,CAC3C,GAAIzP,EAAsB,CACxB,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAEjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,iBAAiB,EACtB,OAAO,CAAE,OAAA6M,CAAA,CAAQ,EACjB,GAAG,KAAM9K,CAAQ,EACjB,SACA,SACH,GAAI/E,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,sBAAsBsJ,EAAUoB,EAAe,CACnD,GAAI/F,EAAsB,CACxB,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAEjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,iBAAiB,EACtB,OAAO,CACN,sBAAuBmD,EAAc,UACrC,sBAAuBA,EAAc,WACrC,uBAAwBA,EAAc,YACtC,yBAA0BA,EAAc,cACxC,sBAAuBA,EAAc,SACrC,oBAAqB,KACrB,OAAQ,gBACT,EACA,GAAG,KAAMpB,CAAQ,EACjB,SACA,SACH,GAAI/E,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,eAAesJ,EAAU,CAC7B,GAAI3E,EAAsB,CACxB,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,KAAM,CAAE,MAAAhD,CAAA,EAAU,MAAMgD,EACrB,KAAK,iBAAiB,EACtB,SACA,GAAG,KAAM+B,CAAQ,EACpB,GAAI/E,EAAO,MAAMA,CACnB,CACF,EAIA,MAAM,iBAAiB7B,EAAQ,CAE7B,GAAI,CAACA,GAAQ,gBACX,MAAO,CAAE,SAAU,IAGrB,GAAIiC,EACF,GAAI,CACF,KAAM,CAAE,KAAM8C,EAAK,MAAAlD,GAAU,MAAMK,EAChC,KAAK,eAAe,EACpB,OAAO,wBAAwB,EAC/B,GAAG,KAAMlC,EAAO,eAAe,EAC/B,SAEH,GAAI6B,GAAS,CAACkD,EAEZ,MAAO,CAAE,SAAU,IAKrB,MAAM4M,EADmB,CAAC,QAAS,kBAAkB,EACjB,SAAS5M,EAAI,MAAM,EAEvD,MAAO,CACL,SAAU4M,EACV,SAAUA,EAAa,KAAO5M,EAC9B,OAAQ4M,EAAa,KAAO,4BAA4B5M,EAAI,UAAU,mBAAmBA,EAAI,SAAW,WAAa,WAAaA,EAAI,MAAM,GAEhJ,OAAS8H,EAAK,CACZ,eAAQ,MAAM,qCAAsCA,CAAG,EAEhD,CAAE,SAAU,GACrB,CAGF,MAAO,CAAE,SAAU,GACrB,EAMA,MAAM,iBAAiB+E,EAAM,CAC3B,GAAI3P,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,WAAW,EAChB,OAAO,GAAG,EACV,GAAG,OAAQ0P,CAAI,EACf,SACH,OAAI/P,EAAc,KACXvE,CACT,CACA,OAAO,IACT,EAEA,MAAM,WAAWqB,EAAI,CACnB,GAAIsD,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,WAAW,EAChB,OAAO,GAAG,EACV,GAAG,KAAMvD,CAAE,EACX,SACH,GAAIkD,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,iBAAiBwK,EAAQ,CAC7B,GAAI7F,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAUP,EACA,GAAG,UAAW4F,CAAM,EACpB,GAAG,SAAU,QAAQ,EACrB,MAAM,aAAc,CAAE,UAAW,GAAM,EAE1C,OAAIjG,GACF,QAAQ,MAAM,iCAAkCA,CAAK,EAC9C,IAIFvE,EAAK,IAAIuU,IAAO,CACrB,GAAIA,EAAG,UAAU,GACjB,KAAMA,EAAG,UAAU,KACnB,KAAMA,EAAG,UAAU,KACnB,aAAcA,EAAG,cACjB,CACJ,CACA,MAAO,EACT,EAGA,MAAM,0BAA0B/J,EAAQ,CACtC,GAAI7F,EAAsB,CACxB,KAAM,CAAE,MAAA0L,EAAO,MAAA9L,CAAA,EAAU,MAAMK,EAC5B,KAAK,gBAAgB,EACrB,OAAO,IAAK,CAAE,MAAO,QAAS,KAAM,GAAM,EAC1C,GAAG,UAAW4F,CAAM,EACpB,GAAG,SAAU,SAAS,EAEzB,OAAIjG,GACF,QAAQ,MAAM,sCAAuCA,CAAK,EACnD,GAEF8L,GAAS,CAClB,CACA,MAAO,EACT,EAGA,MAAM,sBAAsBvO,EAAW,CACrC,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAeP,EACA,GAAG,aAAc9C,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,GAAO,EAE3C,OAAIyC,GACF,QAAQ,MAAM,sCAAuCA,CAAK,EACnD,IAEFvE,GAAQ,EACjB,CACA,MAAO,EACT,EAGA,MAAM,kBAAkBwU,EAAcC,EAAY,CAChD,GAAI9P,EAAsB,CACxB,KAAM,CAAE,MAAAJ,GAAU,MAAMK,EACrB,KAAK,gBAAgB,EACrB,OAAO,CACN,OAAQ,SACR,YAAa,IAAI,OAAO,cACxB,YAAa6P,CAAA,CACd,EACA,GAAG,KAAMD,CAAY,EAExB,GAAIjQ,EAAO,MAAMA,CACnB,CACF,EAGA,MAAM,0BAA0BiQ,EAAcC,EAAYC,EAAc,SAAU,CAChF,GAAI/P,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EAAS,IAAI,+BAAgC,CACnE,cAAe4P,EACf,iBAAkBC,EAClB,iBAAkBC,CAAA,CACnB,EAED,GAAInQ,EAAO,MAAMA,CACnB,CACF,EAGA,MAAM,iBAAiBiQ,EAAc,CACnC,GAAI7P,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EACrB,KAAK,gBAAgB,EACrB,SACA,GAAG,KAAM4P,CAAY,EAExB,GAAIjQ,EAAO,MAAMA,CACnB,CACF,EAGA,MAAM,aAAaiQ,EAAcG,EAAW,CAC1C,GAAIhQ,EAAsB,CACxB,KAAM,CAAE,MAAAJ,GAAU,MAAMK,EACrB,KAAK,gBAAgB,EACrB,OAAO,CACN,OAAQ,UACR,WAAY,IAAI,OAAO,cACvB,WAAY+P,CAAA,CACb,EACA,GAAG,KAAMH,CAAY,EAExB,GAAIjQ,EAAO,MAAMA,CACnB,CACF,EAOA,MAAM,eAAerC,EAAW,CAC9B,GAAIyC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAUP,EACA,GAAG,aAAc1C,CAAS,EAC1B,MAAM,cAAe,CAAE,UAAW,GAAM,EAE3C,OAAIqC,GACF,QAAQ,MAAM,+BAAgCA,CAAK,EAC5C,IAEFvE,GAAQ,EACjB,CACA,MAAO,EACT,EAGA,MAAM,kBAAkB8B,EAAW,CACjC,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAQP,EACA,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,QAAQ,EACrB,MAAM,aAAc,CAAE,UAAW,GAAM,EAE1C,OAAIyC,GACF,QAAQ,MAAM,kCAAmCA,CAAK,EAC/C,IAEFvE,GAAQ,EACjB,CACA,MAAO,EACT,EAGA,MAAM,iBAAiBkC,EAAWsI,EAAQoK,EAAatC,EAAY,CACjE,GAAI3N,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,WAAY1C,EACZ,QAASsI,EACT,aAAcoK,EACd,YAAatC,CAAA,CACd,EACA,SACA,SAEH,GAAI/N,EAAO,MAAMA,EACjB,OAAOvE,CACT,CACA,OAAO,IACT,EAGA,MAAM,wBAAwBkC,EAAWsI,EAAQuF,EAAS,CACxD,GAAIpL,EAAsB,CACxB,KAAM,CAAE,MAAAJ,GAAU,MAAMK,EACrB,KAAK,eAAe,EACpB,OAAO,CAAE,aAAcmL,CAAA,CAAS,EAChC,GAAG,aAAc7N,CAAS,EAC1B,GAAG,UAAWsI,CAAM,EAEvB,GAAIjG,EAAO,MAAMA,CACnB,CACF,EAGA,MAAM,oBAAoBrC,EAAWsI,EAAQ,CAC3C,GAAI7F,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EACrB,KAAK,eAAe,EACpB,SACA,GAAG,aAAc1C,CAAS,EAC1B,GAAG,UAAWsI,CAAM,EAEvB,GAAIjG,EAAO,MAAMA,CACnB,CACF,EAGA,MAAM,wBAAwBiQ,EAAcK,EAAgB,CAC1D,GAAIlQ,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EACrB,KAAK,gBAAgB,EACrB,OAAO,CAAE,aAAciQ,CAAA,CAAgB,EACvC,GAAG,KAAML,CAAY,EAExB,GAAIjQ,EAAO,MAAMA,CACnB,CACF,EAGA,MAAM,wBAAwBiQ,EAAcM,EAAgB,CAC1D,GAAInQ,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EACrB,KAAK,gBAAgB,EACrB,OAAO,CAAE,aAAckQ,CAAA,CAAgB,EACvC,GAAG,KAAMN,CAAY,EAExB,GAAIjQ,EAAO,MAAMA,CACnB,CACF,EAKA,MAAM,iBAAiBiG,EAAQ1I,EAAWkI,EAAO,SAAU,CACzD,GAAI,CAACrF,GAAwB,CAAC6F,GAAU,CAAC1I,EAAW,MAAO,GAE3D,GAAI,CAEF,KAAM,CAAE,KAAA9B,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAAS,IAAI,qBAAsB,CAC/D,UAAW4F,EACX,aAAc1I,EACd,OAAQkI,CAAA,CACT,EAED,OAAIzF,GACF,QAAQ,MAAM,iCAAkCA,CAAK,EAC9C,IAGFvE,IAAS,EAClB,OAASuE,EAAO,CACd,eAAQ,MAAM,+BAAgCA,CAAK,EAC5C,EACT,CACF,EAGA,MAAM,aAAaiG,EAAQ,CACzB,GAAI,CAAC7F,EAAsB,MAAO,GAElC,GAAI,CAEF,KAAM,CAAE,KAAMiC,CAAA,EAAS,MAAMhC,EAC1B,KAAK,OAAO,EACZ,OAAO,kBAAkB,EACzB,GAAG,KAAM4F,CAAM,EACf,SAEH,GAAI,CAAC5D,GAAM,WAAY,MAAO,GAG9B,KAAM,CAAE,MAAAyJ,CAAA,EAAU,MAAMzL,EACrB,KAAK,gBAAgB,EACrB,OAAO,IAAK,CAAE,MAAO,QAAS,KAAM,GAAM,EAC1C,GAAG,UAAW4F,CAAM,EAGvB,OAAO6F,IAAU,CACnB,OAAS9L,EAAO,CACd,eAAQ,MAAM,8BAA+BA,CAAK,EAC3C,EACT,CACF,EAOA,oBAAqB,CACnB,CAAE,MAAO,WAAY,MAAO,YAC5B,CAAE,MAAO,QAAS,MAAO,SACzB,CAAE,MAAO,SAAU,MAAO,UAC1B,CAAE,MAAO,kBAAmB,MAAO,kBAAkB,EAIvD,MAAM,iBAAiBrC,EAAWe,EAAM,CACtC,GAAI,CAAC0B,EAAsB,MAAO,GAElC,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EAAQ,MAAO,GAEpB,MAAMhC,EAAQ,YAAY,MAC1B,GAAI,CACF,KAAM,CAAE,KAAAvF,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,gBAAgB,EACrB,OAAO,GAAG,EACV,GAAG,aAAcrF,CAAS,EAC1B,GAAG,YAAae,CAAI,EACpB,MAAM,aAAc,CAAE,UAAW,GAAO,EAErCwC,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EAGrD,GAFAR,GAAQ,MAAM,mBAAoB,CAAE,SAAAU,EAAU,KAAMzF,GAAM,OAAQ,WAAYkC,EAAW,EAErFqC,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,OAASuE,EAAO,CACd,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,mBAAoB,WAAYrC,CAAA,CAAW,EACpGqC,CACR,CACF,EAGA,MAAM,wBAAwBrC,EAAWmM,EAAO,GAAI,CAClD,GAAI,CAAC1J,EAAsB,MAAO,GAElC,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EAAQ,MAAO,GAEpB,MAAMhC,EAAQ,YAAY,MAC1B,GAAI,CAEF,MAAM0I,MAAc,KACdG,MAAgB,KACtBA,EAAU,QAAQA,EAAU,UAAYC,CAAI,EAE5C,KAAM,CAAE,KAAArO,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,gBAAgB,EACrB,OAAO,GAAG,EACV,GAAG,aAAcrF,CAAS,EAC1B,IAAI,YAAakM,EAAU,cAAc,MAAM,GAAG,EAAE,CAAC,CAAC,EACtD,IAAI,YAAaH,EAAQ,cAAc,MAAM,GAAG,EAAE,CAAC,CAAC,EACpD,MAAM,YAAa,CAAE,UAAW,GAAO,EAEpCxI,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EAGrD,GAFAR,GAAQ,MAAM,0BAA2B,CAAE,SAAAU,EAAU,KAAMzF,GAAM,OAAQ,WAAYkC,EAAW,EAE5FqC,EAAO,MAAMA,EAEjB,OAAQvE,GAAQ,IAAI,IAAI+U,IAAM,CAAE,GAAGA,EAAG,UAAWA,EAAE,WAAY,CACjE,OAASxQ,EAAO,CACd,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,0BAA2B,WAAYrC,CAAA,CAAW,EAC3GqC,CACR,CACF,EAGA,MAAM,gBAAgBrC,EAAWsI,EAAQwK,EAAUC,EAAUC,EAAWC,EAAQ,KAAM,CACpF,GAAI,CAACxQ,EAAsB,OAAO,KAElC,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,gBAAgB,EACrB,OAAO,CACN,WAAYrF,EACZ,QAASsI,EACT,UAAWwK,EACX,UAAWC,EACX,WAAYC,EACZ,MAAAC,CAAA,CACD,EACA,SACA,SAEH,GAAI5Q,EACF,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,kBAAmB,WAAYrC,CAAA,CAAW,EACnGqC,EAER,OAAOvE,CACT,EAGA,MAAM,mBAAmBqB,EAAI4T,EAAUC,EAAWC,EAAQ,KAAM,CAC9D,GAAI,CAACxQ,EAAsB,OAAO,KAElC,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,gBAAgB,EACrB,OAAO,CACN,UAAW0N,EACX,WAAYC,EACZ,MAAAC,CAAA,CACD,EACA,GAAG,KAAM9T,CAAE,EACX,SACA,SAEH,GAAIkD,EACF,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,qBAAsB,EAC/EA,EAER,OAAOvE,CACT,EAGA,MAAM,mBAAmBqB,EAAI,CAC3B,GAAI,CAACsD,EAAsB,MAAO,GAElC,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,KAAM,CAAE,MAAAhD,CAAA,EAAU,MAAMgD,EACrB,KAAK,gBAAgB,EACrB,SACA,GAAG,KAAMlG,CAAE,EAEd,GAAIkD,EACF,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,qBAAsB,EAC/EA,EAER,MAAO,EACT,EAGA,MAAM,mBAAmBrC,EAAWkM,EAAY,KAAMH,EAAU,KAAM,CACpE,GAAI,CAACtJ,EAAsB,MAAO,GAElC,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EAAQ,MAAO,GAEpB,MAAMhC,EAAQ,YAAY,MAC1B,GAAI,CAEF,KAAM,CAAE,KAAAvF,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAAO,IAAI,uBAAwB,CAC/D,aAAcrF,EACd,aAAckM,EACd,WAAYH,CAAA,CACb,EAEKxI,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EAGrD,GAFAR,GAAQ,MAAM,qBAAsB,CAAE,SAAAU,EAAU,KAAMzF,GAAM,OAAQ,WAAYkC,EAAW,EAEvFqC,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,OAASuE,EAAO,CACd,OAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,qBAAsB,WAAYrC,CAAA,CAAW,EAErG,KAAK,2BAA2BA,EAAWkM,EAAWH,CAAO,CACtE,CACF,EAGA,MAAM,2BAA2B/L,EAAWkM,EAAWH,EAAS,CAE9D,IAAI3G,GADWlB,KAAexB,GAE3B,KAAK,gBAAgB,EACrB,OAAO,kCAAkC,EACzC,GAAG,aAAc1C,CAAS,EAEzBkM,IACF9G,EAAQA,EAAM,IAAI,YAAa8G,CAAS,GAEtCH,IACF3G,EAAQA,EAAM,IAAI,YAAa2G,CAAO,GAGxC,KAAM,CAAE,KAAAjO,EAAM,MAAAuE,CAAA,EAAU,MAAM+C,EAC9B,GAAI/C,EAAO,MAAMA,EAGjB,MAAMF,EAAU,GAChB,OAAArE,GAAM,QAAQ6K,GAAO,CACdxG,EAAQwG,EAAI,SAAS,IACxBxG,EAAQwG,EAAI,SAAS,EAAI,CAAE,UAAWA,EAAI,UAAW,YAAa,EAAG,KAAM,IAAI,GAAI,GAErFxG,EAAQwG,EAAI,SAAS,EAAE,aAAeA,EAAI,WAC1CxG,EAAQwG,EAAI,SAAS,EAAE,KAAK,IAAIA,EAAI,SAAS,CAC/C,CAAC,EAEM,OAAO,OAAOxG,CAAO,EAAE,IAAI+Q,IAAM,CACtC,UAAWA,EAAE,UACb,YAAaA,EAAE,YACf,mBAAoBA,EAAE,KAAK,MAC3B,CACJ,EAGA,MAAM,yBAAyBlT,EAAWmT,EAAQ,EAAG,CACnD,GAAI,CAAC1Q,EAAsB,MAAO,GAElC,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EAAQ,MAAO,GAEpB,MAAM0G,MAAc,KACdG,MAAgB,KACtBA,EAAU,QAAQA,EAAU,UAAaiH,EAAQ,CAAE,EAEnD,KAAM,CAAE,KAAArV,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,gBAAgB,EACrB,OAAO,kCAAkC,EACzC,GAAG,aAAcrF,CAAS,EAC1B,IAAI,YAAakM,EAAU,cAAc,MAAM,GAAG,EAAE,CAAC,CAAC,EACtD,IAAI,YAAaH,EAAQ,cAAc,MAAM,GAAG,EAAE,CAAC,CAAC,EACpD,MAAM,YAAa,CAAE,UAAW,GAAM,EAEzC,GAAI1J,EAAO,MAAMA,EAGjB,MAAM+Q,EAAa,GACnB,OAAAtV,GAAM,QAAQ6K,GAAO,CACnB,MAAM5H,EAAO,IAAI,KAAK4H,EAAI,SAAS,EAC7B0K,EAAY,IAAI,KAAKtS,CAAI,EAC/BsS,EAAU,QAAQtS,EAAK,UAAYA,EAAK,QAAQ,EAChD,MAAMuS,EAAUD,EAAU,cAAc,MAAM,GAAG,EAAE,CAAC,EAE/CD,EAAWE,CAAO,IACrBF,EAAWE,CAAO,EAAI,CAAE,KAAMA,EAAS,SAAU,EAAG,MAAO,EAAG,OAAQ,EAAG,gBAAiB,IAE5FF,EAAWE,CAAO,EAAE3K,EAAI,SAAS,GAAKA,EAAI,UAC5C,CAAC,EAEM,OAAO,OAAOyK,CAAU,EAAE,KAAK,CAACtX,EAAGC,IAAMD,EAAE,KAAK,cAAcC,EAAE,IAAI,CAAC,CAC9E,EAMA,MAAM,YAAY6D,EAAWI,EAAWoH,EAAUmM,EAAM,CACtD,GAAI,CAAC9Q,EAAsB,OAAO,KAElC,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,MAAMhC,EAAQ,YAAY,MACpBmQ,EAAWD,EAAK,MAAQ,EAGxBE,EAAY,KAAK,MACjB/S,EAAQ,IAAI,WAAW,CAAC,EAC9B,OAAO,gBAAgBA,CAAK,EAC5B,MAAMgT,EAAW,MAAM,KAAKhT,EAAO3E,GAAKA,EAAE,SAAS,EAAE,CAAC,EAAE,KAAK,EAAE,EACzD4X,EAAYJ,EAAK,MAAM,MAAM,GAAG,EAAE,OAAS,MAC3CK,EAAW,GAAGH,CAAS,IAAIC,CAAQ,IAAIC,CAAS,GAGhDE,EAAW,GAAGjU,CAAS,IAAII,CAAS,IAAIoH,CAAQ,IAAIwM,CAAQ,GAElE,GAAI,CACF,KAAM,CAAE,KAAA9V,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAAO,QAClC,KAAK,WAAW,EAChB,OAAOwO,EAAUN,EAAM,CACtB,aAAc,OACd,OAAQ,GACT,EAEGhQ,EAAW,KAAK,MAAM,YAAY,MAAQF,CAAK,EASrD,GARAR,GAAQ,QAAQ,SAAU,CACxB,WAAYjD,EACZ,WAAYI,EACZ,KAAMwT,EACN,SAAAjQ,EACA,QAAS,CAAClB,CAAA,CACX,EAEGA,EAAO,MAAMA,EAIjB,OAAOwR,CACT,OAASxR,EAAO,CACd,MAAAQ,GAAQ,MAAM,UAAW,CACvB,QAASR,EAAM,QACf,UAAW,cACX,WAAYzC,EACZ,WAAYI,CAAA,CACb,EACKqC,CACR,CACF,EAEA,MAAM,kBAAkBzC,EAAWI,EAAWoH,EAAU0M,EAAYF,EAAW,YAAa,CAC1F,GAAI,CAACnR,EAAsB,OAAO,KAElC,MAAM4C,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAKjD,MAAM0O,EAAO,MADU,MAAM,MAAMD,CAAU,GACX,OAG5BL,EAAY,KAAK,MACjB/S,EAAQ,IAAI,WAAW,CAAC,EAC9B,OAAO,gBAAgBA,CAAK,EAC5B,MAAMgT,EAAW,MAAM,KAAKhT,EAAO3E,GAAKA,EAAE,SAAS,EAAE,CAAC,EAAE,KAAK,EAAE,EACzD4X,EAAYC,EAAS,MAAM,GAAG,EAAE,OAAS,MACzCI,EAAc,GAAGP,CAAS,IAAIC,CAAQ,IAAIC,CAAS,GAGnDE,EAAW,GAAGjU,CAAS,IAAII,CAAS,IAAIoH,CAAQ,IAAI4M,CAAW,GAE/D,CAAE,KAAAlW,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAAO,QAClC,KAAK,WAAW,EAChB,OAAOwO,EAAUE,EAAM,CACtB,aAAc,OACd,OAAQ,GACR,YAAaA,EAAK,KACnB,EAEH,GAAI1R,EAAO,MAAMA,EAGjB,OAAOwR,CACT,EAKA,MAAM,gBAAgBhF,EAAW,CAC/B,GAAI,CAACA,GAAa,CAACpM,EAAsB,OAAOoM,EAChD,IAAIgF,EACJ,GAAIhF,EAAU,WAAW,MAAM,EAC7B,GAAI,CAEF,MAAMrJ,EADS,IAAI,IAAIqJ,CAAS,EACX,SAAS,MAAM,iCAAiC,EACrE,GAAI,CAACrJ,EAAO,OAAOqJ,EACnBgF,EAAW,mBAAmBrO,EAAM,CAAC,CAAC,CACxC,MAAQ,CAAE,OAAOqJ,CAAU,MAE3BgF,EAAWhF,EAEb,GAAI,CACF,MAAMxJ,EAASpB,GAAA,EACT,CAAE,KAAAnG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAAO,QAAQ,KAAK,WAAW,EAAE,gBAAgBwO,EAAU,IAAI,EAC7F,OAAIxR,GAAS,CAACvE,GAAM,UAAkB+Q,EAC/B/Q,EAAK,SACd,MAAQ,CAAE,OAAO+Q,CAAU,CAC7B,EAGA,MAAM,iBAAiBoF,EAAa,CAClC,GAAI,CAACxR,GAAwB,CAACwR,GAAa,OAAQ,OAAOA,GAAe,GACzE,MAAMC,EAAQ,GACRC,EAAU,GAChB,QAASvJ,EAAI,EAAGA,EAAIqJ,EAAY,OAAQrJ,IAAK,CAC3C,MAAMwJ,EAAIH,EAAYrJ,CAAC,EACvB,GAAI,CAACwJ,EAAG,SACR,IAAIC,EACJ,GAAID,EAAE,WAAW,MAAM,EACrB,GAAI,CAEF,MAAM5O,EADS,IAAI,IAAI4O,CAAC,EACH,SAAS,MAAM,iCAAiC,EACjE5O,IAAO6O,EAAK,mBAAmB7O,EAAM,CAAC,CAAC,EAC7C,MAAQ,CAAa,MAErB6O,EAAKD,EAEHC,IAAMH,EAAM,KAAKG,CAAE,EAAGF,EAAQ,KAAKvJ,CAAC,EAC1C,CACA,GAAI,CAACsJ,EAAM,OAAQ,OAAOD,EAC1B,GAAI,CACF,MAAM5O,EAASpB,GAAA,EACT,CAAE,KAAAnG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAAO,QAAQ,KAAK,WAAW,EAAE,iBAAiB6O,EAAO,IAAI,EAC3F,GAAI7R,GAAS,CAACvE,EAAM,OAAOmW,EAC3B,MAAM3Q,EAAS,CAAC,GAAG2Q,CAAW,EAC9B,OAAAnW,EAAK,QAAQ,CAACK,EAAMmW,IAAM,CACpBnW,EAAK,YAAWmF,EAAO6Q,EAAQG,CAAC,CAAC,EAAInW,EAAK,UAChD,CAAC,EACMmF,CACT,MAAQ,CAAE,OAAO2Q,CAAY,CAC/B,EAEA,MAAM,YAAYM,EAAgB,CAChC,GAAI,CAAC9R,GAAwB,CAAC8R,EAAgB,OAE9C,IAAIV,EACJ,GAAIU,EAAe,WAAW,MAAM,EAElC,GAAI,CAEF,MAAMC,EADM,IAAI,IAAID,CAAc,EACZ,SAAS,MAAM,oBAAoB,EACzD,GAAI,CAACC,EAAW,OAChBX,EAAWW,EAAU,CAAC,CACxB,MAAQ,CAAE,MAAO,MAGjBX,EAAWU,EAGb,KAAM,CAAE,MAAAlS,CAAA,EAAU,MAAMK,EAAS,QAC9B,KAAK,WAAW,EAChB,OAAO,CAACmR,CAAQ,CAAC,EAEpB,GAAIxR,EAAO,MAAMA,CACnB,EAQA,MAAM,sBAAsBkS,EAAgB,CAC1C,GAAI,CAAC9R,GAAwB,CAAC8R,QAAuB,CAAE,WAAY,GAAO,MAAO,iBAEjF,IAAIV,EACJ,GAAIU,EAAe,WAAW,MAAM,EAClC,GAAI,CAEF,MAAM/O,EADS,IAAI,IAAI+O,CAAc,EAChB,SAAS,MAAM,iCAAiC,EACrE,GAAI,CAAC/O,EAAO,MAAO,CAAE,WAAY,GAAO,MAAO,uBAC/CqO,EAAW,mBAAmBrO,EAAM,CAAC,CAAC,CACxC,MAAQ,CACN,MAAO,CAAE,WAAY,GAAO,MAAO,cACrC,MAEAqO,EAAWU,EAGb,GAAI,CACF,KAAM,CAAE,KAAAzW,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAAS,QACpC,KAAK,WAAW,EAChB,gBAAgBmR,EAAU,EAAE,EAC/B,OAAIxR,EAAc,CAAE,WAAY,GAAO,MAAOA,EAAM,SAC7C,CAAE,WAAY,CAAC,CAACvE,GAAM,UAAW,OAAQ,IAClD,OAASuE,EAAO,CACd,MAAO,CAAE,WAAY,GAAO,MAAOA,EAAM,SAAW,sBACtD,CACF,EAGA,MAAM,mBAAmB+E,EAAU,CACjC,GAAI,CAAC3E,EAAsB,MAAO,CAAE,SAAU,GAAO,OAAQ,EAAC,EAE9D,GAAI,CAEF,KAAM,CAAE,KAAMjC,EAAQ,MAAO+G,CAAA,EAAgB,MAAM7E,EAChD,KAAK,iBAAiB,EACtB,OAAO,QAAQ,EACf,GAAG,KAAM0E,CAAQ,EACjB,SAEH,GAAIG,EAAa,MAAMA,EACvB,GAAI,CAAC/G,GAAQ,QAAUA,EAAO,OAAO,SAAW,EAE9C,aAAMkC,EACH,KAAK,iBAAiB,EACtB,OAAO,CACN,mBAAoB,IAAI,OAAO,cAC/B,2BAA4B,QAC5B,mBAAoB,EACrB,EACA,GAAG,KAAM0E,CAAQ,EAEb,CAAE,SAAU,GAAM,OAAQ,QAAS,OAAQ,EAAC,EAIrD,MAAMqN,EAAS,GACf,UAAWC,KAAYlU,EAAO,OAAQ,CACpC,MAAM8C,EAAS,MAAM,KAAK,sBAAsBoR,CAAQ,EACnDpR,EAAO,YACVmR,EAAO,KAAK,CAAE,IAAKC,EAAU,MAAOpR,EAAO,MAAO,CAEtD,CAGA,MAAMnD,EAASsU,EAAO,SAAW,EAAI,WAAa,SAClD,aAAM/R,EACH,KAAK,iBAAiB,EACtB,OAAO,CACN,mBAAoB,IAAI,OAAO,cAC/B,2BAA4BvC,EAC5B,mBAAoBsU,EAAO,OAC5B,EACA,GAAG,KAAMrN,CAAQ,EAEb,CACL,SAAUqN,EAAO,SAAW,EAC5B,OAAAtU,EACA,YAAaK,EAAO,OAAO,OAC3B,OAAAiU,CAAA,CAEJ,OAASpS,EAAO,CACd,eAAQ,MAAM,iCAAkCA,CAAK,EAC9C,CAAE,SAAU,GAAO,MAAOA,EAAM,QAAS,OAAQ,EAAC,CAC3D,CACF,EAGA,MAAM,iBAAiB+E,EAAUuN,EAAQf,EAAUJ,EAAU,CAC3D,GAAI,CAAC/Q,EAAsB,OAAO,KAElC,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,oBAAoB,EACzB,OAAO,CACN,UAAW0E,EACX,QAASuN,EACT,UAAWf,EACX,gBAAiBJ,EACjB,OAAQ,UACT,EACA,SACA,SAEH,OAAInR,GACF,QAAQ,MAAM,+BAAgCA,CAAK,EAC5C,MAEFvE,CACT,EAGA,MAAM,oBAAoB8W,EAASC,EAAaC,EAAa,CAC3D,GAAI,CAACrS,EAAsB,MAAO,GAElC,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAAS,IAAI,uBAAwB,CACjE,WAAYkS,EACZ,eAAgBC,EAChB,eAAgBC,CAAA,CACjB,EAED,OAAIzS,GACF,QAAQ,MAAM,iCAAkCA,CAAK,EAC9C,IAEFvE,IAAS,EAClB,EAGA,MAAM,uBAAuB8W,EAASxM,EAAc,CAClD,GAAI,CAAC3F,EAAsB,MAAO,GAElC,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAAS,IAAI,2BAA4B,CACrE,WAAYkS,EACZ,QAASxM,CAAA,CACV,EAED,OAAI/F,GACF,QAAQ,MAAM,qCAAsCA,CAAK,EAClD,IAEFvE,IAAS,EAClB,EAGA,MAAM,uBAAuBsJ,EAAU,CACrC,GAAI,CAAC3E,EAAsB,MAAO,GAElC,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAAS,IAAI,4BAA6B,CACtE,YAAa0E,CAAA,CACd,EAED,OAAI/E,GACF,QAAQ,MAAM,uCAAwCA,CAAK,EACpD,IAEFvE,GAAQ,EACjB,EAGA,MAAM,kBAAkBsJ,EAAUtE,EAAWiS,EAAU,GAAI,CACzD,GAAKtS,EAEL,GAAI,CACF,MAAMC,EACH,KAAK,iBAAiB,EACtB,OAAO,CACN,UAAW0E,EACX,OAAQ2N,EAAQ,OAAS,KACzB,UAAAjS,EACA,UAAWiS,EAAQ,UAAY,KAC/B,aAAcA,EAAQ,aAAe,KACrC,QAASA,EAAQ,SAAWA,EAAQ,SAAW,KAC/C,cAAeA,EAAQ,OAAS,KAChC,aAAcA,EAAQ,aAAe,SACtC,CACL,OAAS1S,EAAO,CAEd,QAAQ,MAAM,iCAAkCA,CAAK,CACvD,CACF,EAOA,MAAM,mBAAmB2C,EAAOgQ,EAAUpT,EAAU,GAAI,CACtD,GAAI,CAACa,EAAsB,OAAO,KAElC,KAAM,CACJ,WAAAwS,EAAa,MACb,aAAAC,EAAe,KACf,YAAAC,EAAc,KACd,WAAAC,EAAa,MACXxT,EAEJ,GAAI,CACF,KAAM,CAAE,KAAA9D,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,sBAAsB,EAC3B,OAAO,CACN,OAAQsC,EACR,YAAaiQ,EACb,cAAeC,EACf,SAAUF,EAAS,SACnB,aAAcA,EAAS,aACvB,gBAAiBA,EAAS,gBAC1B,gBAAiBA,EAAS,gBAC1B,SAAUA,EAAS,SACnB,aAAcG,EACd,YAAaC,CAAA,CACd,EACA,SACA,SAEH,GAAI/S,EAAO,MAAMA,EACjB,OAAOvE,CACT,OAASuE,EAAO,CACd,eAAQ,MAAM,gCAAiCA,CAAK,EAC7C,IACT,CACF,EAGA,MAAM,mBAAmB2C,EAAO,CAC9B,GAAI,CAACvC,EAAsB,MAAO,GAElC,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,sBAAsB,EAC3B,OAAO,kFAAkF,EACzF,GAAG,SAAUsC,CAAK,EAClB,MAAM,cAAe,CAAE,UAAW,GAAO,EAE5C,OAAI3C,GACF,QAAQ,MAAM,mCAAoCA,CAAK,EAChD,IAEFvE,GAAQ,EACjB,EAGA,MAAM,kBAAkBuX,EAAY,CAClC,GAAI,CAAC5S,EAAsB,OAAO,KAElC,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,sBAAsB,EAC3B,OAAO,GAAG,EACV,GAAG,KAAM2S,CAAU,EACnB,SAEH,OAAIhT,GACF,QAAQ,MAAM,kCAAmCA,CAAK,EAC/C,MAEFvE,CACT,EAOA,MAAM,iBAAiBkH,EAAOsQ,EAAgB1T,EAAU,GAAI,CAC1D,GAAI,CAACa,EAAsB,OAAO,KAElC,GAAI,CACF,MAAMiC,EAAO,MAAMhC,EAAS,KAAK,UAC3B,CAAE,KAAA5E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAAS,IAAI,qBAAsB,CAC/D,SAAUsC,EACV,kBAAmBsQ,EACnB,UAAW1T,EACX,eAAgB8C,GAAM,MAAM,MAAM,IAAM,KACzC,EAED,GAAIrC,EAAO,MAAMA,EACjB,OAAOvE,IAAO,CAAC,GAAK,IACtB,OAASuE,EAAO,CACd,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,mBAAoB,MAAO,CAAE,MAAA2C,CAAA,CAAM,CAAG,EAC/F3C,CACR,CACF,EAGA,MAAM,aAAakT,EAAO,CACxB,GAAI,CAAC9S,EAAsB,OAAO,KAElC,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,iBAAiB,EACtB,OAAO,GAAG,EACV,GAAG,KAAM6S,CAAK,EACd,SAEH,OAAIlT,GACF,QAAQ,MAAM,6BAA8BA,CAAK,EAC1C,MAEFvE,CACT,EAGA,MAAM,cAAckH,EAAOkJ,EAAQ,GAAI,CACrC,GAAI,CAACzL,EAAsB,MAAO,GAElC,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,iBAAiB,EACtB,OAAO,GAAG,EACV,GAAG,SAAUsC,CAAK,EAClB,MAAM,aAAc,CAAE,UAAW,GAAO,EACxC,MAAMkJ,CAAK,EAEd,OAAI7L,GACF,QAAQ,MAAM,8BAA+BA,CAAK,EAC3C,IAEFvE,GAAQ,EACjB,EAGA,MAAM,sBAAsByX,EAAOpV,EAAQ4U,EAAU,GAAI,CACvD,GAAI,CAACtS,EAAsB,OAAO,KAElC,GAAI,CACF,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAAS,IAAI,2BAA4B,CACrE,SAAU6S,EACV,SAAUpV,EACV,cAAe4U,EAAQ,YAAc,KACrC,UAAWA,EAAQ,QAAU,KAC7B,QAASA,EAAQ,OAAS,KAC1B,gBAAiBA,EAAQ,cAAgB,KACzC,UAAWA,EAAQ,SAAW,KAC/B,EAED,GAAI1S,EAAO,MAAMA,EACjB,OAAOvE,CACT,OAASuE,EAAO,CACd,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,wBAAyB,MAAO,CAAE,MAAAkT,EAAO,OAAApV,CAAA,EAAU,EAC5GkC,CACR,CACF,EAGA,MAAM,sBAAsB2C,EAAO,CACjC,GAAI,CAACvC,EAAsB,OAAO,KAGlC,KAAM,CAAE,KAAM8C,CAAA,EAAQ,MAAM7C,EACzB,KAAK,eAAe,EACpB,OAAO,gCAAgC,EACvC,GAAG,KAAMsC,CAAK,EACd,SAGH,GAAI,CAACO,GAAOA,EAAI,UAAYA,EAAI,sBAC9B,OAAO,KAIT,KAAM,CAAE,KAAMyP,CAAA,EAAa,MAAMtS,EAC9B,KAAK,sBAAsB,EAC3B,OAAO,GAAG,EACV,GAAG,SAAUsC,CAAK,EAClB,GAAG,aAAc,EAAI,EACrB,SAEH,OAAOgQ,GAAY,IACrB,EAGA,MAAM,gBAAgBA,EAAUO,EAAO,CACrC,GAAI,CAAC9S,EAAsB,OAAO,KAElC,GAAI,CAEF,MAAMC,EACH,KAAK,sBAAsB,EAC3B,OAAO,CAAE,WAAY,GAAO,EAC5B,GAAG,SAAUsS,EAAS,KAAK,EAE9B,MAAMtQ,EAAO,MAAMhC,EAAS,KAAK,UAG3B,CAAE,KAAA5E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,sBAAsB,EAC3B,OAAO,CACN,GAAIsS,EAAS,WACb,OAAQA,EAAS,MACjB,OAAQO,EACR,YAAaP,EAAS,WACtB,SAAUA,EAAS,QACnB,aAAcA,EAAS,YACvB,gBAAiBA,EAAS,cAC1B,gBAAiBA,EAAS,OAC1B,SAAUA,EAAS,SACnB,WAAY,GACZ,YAAatQ,GAAM,MAAM,MAAM,IAAM,KACtC,EACA,SACA,SAEH,GAAIrC,EAAO,MAAMA,EAGjB,aAAMK,EACH,KAAK,eAAe,EACpB,OAAO,CAAE,sBAAuBsS,EAAS,WAAY,EACrD,GAAG,KAAMA,EAAS,KAAK,EAEnBlX,CACT,OAASuE,EAAO,CACd,MAAAQ,GAAQ,MAAM,WAAY,CAAE,QAASR,EAAM,QAAS,UAAW,kBAAmB,MAAO,CAAE,MAAO2S,EAAS,OAAS,EAC9G3S,CACR,CACF,EAGA,MAAM,yBAAyB2C,EAAO,CACpC,GAAKvC,EAEL,GAAI,CACF,MAAMC,EAAS,IAAI,8BAA+B,CAAE,SAAUsC,EAAO,CACvE,OAAS3C,EAAO,CACd,QAAQ,MAAM,uCAAwCA,CAAK,CAC7D,CACF,EAOA,MAAM,eAAerC,EAAWe,EAAO,KAAM,CAC3C,GAAI,CAAC0B,EAAsB,OAAO,KAElC,MAAM+S,EAAYzU,GAAQ,IAAI,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,EACzDsE,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,eAAe,EACpB,OAAO,GAAG,EACV,GAAG,aAAcrF,CAAS,EAC1B,GAAG,gBAAiBwV,CAAS,EAC7B,cAEH,OAAInT,GACF,QAAQ,MAAM,+BAAgCA,CAAK,EAE9CvE,CACT,EAGA,MAAM,gBAAgBkC,EAAWsR,EAAStI,EAAY,KAAMjI,EAAO,KAAM,CACvE,GAAI,CAAC0B,EAAsB,OAAO,KAElC,MAAM+S,EAAYzU,GAAQ,IAAI,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,EAG/D,GAAI,CAACQ,KAAuB,CAC1B,MAAMjB,EAAU,CACd,GAAIG,GAAA,EACJ,WAAYT,EACZ,cAAewV,EACf,QAAAlE,EACA,WAAYtI,EACZ,WAAY,IAAI,OAAO,cACvB,SAAU,IAEZ,aAAM3I,GAAiBC,CAAO,EAC9B,MAAM3B,GAAiBD,GAAa,kBAAmB,CACrD,UAAAsB,EACA,QAAAsR,EACA,YAAakE,CAAA,CACd,EACMlV,CACT,CAEA,MAAM+E,EAASnB,EAAA,EACf,GAAI,CAACmB,EAAQ,CAEX,MAAM/E,EAAU,CACd,GAAIG,GAAA,EACJ,WAAYT,EACZ,cAAewV,EACf,QAAAlE,EACA,WAAYtI,EACZ,WAAY,IAAI,OAAO,cACvB,SAAU,IAEZ,aAAM3I,GAAiBC,CAAO,EAC9B,MAAM3B,GAAiBD,GAAa,kBAAmB,CACrD,UAAAsB,EACA,QAAAsR,EACA,YAAakE,CAAA,CACd,EACMlV,CACT,CAEA,KAAM,CAAE,KAAAxC,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,WAAYrF,EACZ,cAAewV,EACf,QAAAlE,EACA,WAAYtI,EACZ,WAAY,IAAI,OAAO,aAAY,EAClC,CACD,WAAY,2BACb,EACA,SACA,SAEH,GAAI3G,EAAO,CAET,GAAIA,EAAM,SAAS,SAAS,OAAO,GAAKA,EAAM,SAAS,SAAS,SAAS,EAAG,CAC1E,MAAM/B,EAAU,CACd,GAAIG,GAAA,EACJ,WAAYT,EACZ,cAAewV,EACf,QAAAlE,EACA,SAAU,IAEZ,aAAMjR,GAAiBC,CAAO,EAC9B,MAAM3B,GAAiBD,GAAa,kBAAmB,CACrD,UAAAsB,EACA,QAAAsR,EACA,YAAakE,CAAA,CACd,EACMlV,CACT,CACA,cAAQ,MAAM,6BAA8B+B,CAAK,EAC3CA,CACR,CAGA,OAAIvE,GACFuC,GAAiBvC,CAAI,EAAE,MAAMuP,GAAO,QAAQ,MAAM,2BAA4BA,CAAG,CAAC,EAE7EvP,CACT,EAGA,MAAM,cAAckC,EAAW6H,EAAQmB,EAAY,KAAM,CACvD,GAAI,CAACvG,EAAsB,OAAO,KAElC,MAAMgT,EAAW,MAAM,KAAK,eAAezV,CAAS,EAC9CsR,EAAUmE,GAAU,SAAW,GAGrC,OAAKnE,EAAQ,KAAKE,GAAKA,EAAE,KAAK,gBAAkB3J,EAAO,KAAK,aAAa,EAIlE4N,GAHLnE,EAAQ,KAAKzJ,CAAM,EACZ,MAAM,KAAK,gBAAgB7H,EAAWsR,EAAStI,CAAS,EAGnE,EAGA,MAAM,iBAAiBhJ,EAAW0V,EAAY,CAC5C,GAAI,CAACjT,EAAsB,OAAO,KAElC,MAAMgT,EAAW,MAAM,KAAK,eAAezV,CAAS,EACpD,GAAI,CAACyV,EAAU,OAAO,KAEtB,MAAMnE,EAAUmE,EAAS,QAAQ,UAC1BjE,EAAE,KAAK,gBAAkBkE,EAAW,aAAY,EAEvD,OAAO,MAAM,KAAK,gBAAgB1V,EAAWsR,EAASmE,EAAS,UAAU,CAC3E,EAGA,MAAM,sBAAsBzV,EAAWkO,EAAQ,GAAI,CACjD,GAAI,CAACzL,EAAsB,MAAO,GAElC,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,GAAG,EACV,GAAG,aAAc1C,CAAS,EAC1B,MAAM,gBAAiB,CAAE,UAAW,GAAO,EAC3C,MAAMkO,CAAK,EAEd,OAAI7L,GACF,QAAQ,MAAM,+BAAgCA,CAAK,EAC5C,IAEFvE,GAAQ,EACjB,EAGA,MAAM,iBAAiBkC,EAAWkO,EAAQ,GAAI,CAC5C,GAAI,CAACzL,EAAsB,MAAO,GAElC,MAAMkT,EAAU,MAAM,KAAK,sBAAsB3V,EAAWkO,CAAK,EAG3DM,MAAgB,IACtB,OAAAmH,EAAQ,QAAQrV,GAAW,EACxBA,EAAQ,SAAW,IAAI,QAAQuH,GAAU,CACxC,MAAM3L,EAAM2L,EAAO,KAAK,cACnB2G,EAAU,IAAItS,CAAG,GACpBsS,EAAU,IAAItS,EAAK,CACjB,KAAM2L,EAAO,KACb,KAAMA,EAAO,KACb,eAAgBA,EAAO,gBAAkB,KACzC,SAAUvH,EAAQ,cACnB,CAEL,CAAC,CACH,CAAC,EAGM,MAAM,KAAKkO,EAAU,QAAQ,EAAE,KAAK,CAAC1S,EAAGC,IAC7CD,EAAE,KAAK,cAAcC,EAAE,IAAI,EAE/B,EAGA,MAAM,cAAc6D,EAAWyH,EAAW,KAAMC,EAAU,KAAM,CAC9D,GAAI,CAAC7E,EAAsB,MAAO,GAElC,IAAI2C,EAAQ1C,EACT,KAAK,aAAa,EAClB,OAAO,GAAG,EACV,GAAG,aAAc9C,CAAS,EAEzByH,IAAUjC,EAAQA,EAAM,GAAG,YAAaiC,CAAQ,GAChDC,IAASlC,EAAQA,EAAM,GAAG,WAAYkC,CAAO,GAEjD,KAAM,CAAE,KAAAxJ,EAAM,MAAAuE,CAAA,EAAU,MAAM+C,EAE9B,OAAI/C,GACF,QAAQ,MAAM,8BAA+BA,CAAK,EAC3C,IAEFvE,GAAQ,EACjB,EAGA,MAAM,qBAAqBkC,EAAWJ,EAAWyH,EAAUC,EAAS,CAClE,GAAI,CAAC7E,EAAsB,MAAO,CAAE,UAAW,EAAG,aAAc,EAAG,UAAW,EAAC,EAG/E,MAAMmT,EAAc,MAAM,KAAK,sBAAsB5V,EAAW,GAAG,EAG7D6V,EAAa,MAAM,KAAK,cAAcjW,EAAWyH,EAAUC,CAAO,EAGlEwO,EAAc,GACpBD,EAAW,QAAQlO,GAAQ,CACzBmO,EAAYnO,EAAK,KAAK,aAAa,EAAI,WAAWA,EAAK,YAAY,GAAK,CAC1E,CAAC,EAGD,IAAIuC,EAAY,EACZ6L,EAAe,EACnB,MAAMC,EAAS,GACTC,EAAS,GAEf,OAAAL,EAAY,QAAQtV,GAAW,CAC7B,MAAMgR,EAAUhR,EAAQ,SAAW,GACnC,IAAI4V,EAAU,EACd,MAAMC,EAAe,GAErB7E,EAAQ,QAAQzJ,GAAU,CACxB,MAAMC,GAAQD,EAAO,MAAQ,WAAW,cAClCF,EAAOmO,EAAYhO,CAAI,GAAK,EAE7BqO,EAAarO,CAAI,IACpBqO,EAAarO,CAAI,EAAI,CAAE,MAAO,EAAG,KAAM,IAEzCqO,EAAarO,CAAI,EAAE,QACnBqO,EAAarO,CAAI,EAAE,MAAQH,EAC3BuO,GAAWvO,EAGNqO,EAAOlO,CAAI,IACdkO,EAAOlO,CAAI,EAAI,CAAE,MAAO,EAAG,KAAM,EAAG,KAAAH,CAAA,GAEtCqO,EAAOlO,CAAI,EAAE,QACbkO,EAAOlO,CAAI,EAAE,MAAQH,CACvB,CAAC,EAEDuC,GAAagM,EACbH,GAAgBzE,EAAQ,OAExB2E,EAAO,KAAK,CACV,KAAM3V,EAAQ,cACd,QAASgR,EAAQ,OACjB,KAAM4E,EACN,UAAWC,CAAA,CACZ,CACH,CAAC,EAEM,CACL,UAAAjM,EACA,aAAA6L,EACA,OAAAC,EACA,OAAAC,EACA,WAAYL,EAAY,OAE5B,EAOA,MAAM,eAAe5V,EAAWe,EAAO,KAAM,CAC3C,GAAI,CAAC0B,EAAsB,OAAO,KAElC,MAAM2T,EAAarV,GAAQ,IAAI,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,EAC1DsE,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,eAAe,EACpB,OAAO,GAAG,EACV,GAAG,aAAcrF,CAAS,EAC1B,GAAG,cAAeoW,CAAU,EAC5B,cAEH,OAAI/T,GACF,QAAQ,MAAM,+BAAgCA,CAAK,EAE9CvE,CACT,EAGA,MAAM,mBAAmBkC,EAAWe,EAAO,KAAM,CAC/C,GAAI,CAAC0B,EAAsB,OAAO,KAElC,MAAM2T,EAAarV,GAAQ,IAAI,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,EAC1DsE,EAASnB,EAAA,EAGT,CAACmS,EAAMC,EAAaC,CAAa,EAAI,MAAM,QAAQ,IAAI,CAC3D,KAAK,eAAevW,EAAWoW,CAAU,EACzC/Q,EAAO,KAAK,OAAO,EAAE,OAAO,GAAG,EAAE,GAAG,aAAcrF,CAAS,EAC3DqF,EAAO,KAAK,iBAAiB,EAAE,OAAO,GAAG,EAAE,GAAG,aAAcrF,CAAS,EAAE,GAAG,YAAaoW,CAAU,EAClG,EAEKtW,EAAQwW,GAAa,MAAQ,GAC7B5L,EAAU6L,GAAe,MAAQ,GAEjCC,EAAiB1W,EAAM,UAC3BhE,EAAE,SAAW,QACbA,EAAE,cAAc,WAAWsa,CAAU,GAGjCK,EAAc/L,EAAQ,OAAO,CAAC6B,EAAK+B,IAAM/B,GAAO+B,EAAE,QAAQ,QAAU,GAAI,CAAC,EAE/E,MAAO,CACL,WAAY+H,GAAM,SAAS,QAAU,EACrC,UAAWA,GAAM,SAAW,GAC5B,gBAAiBG,EAAe,OAChC,YAAa1W,EAAM,OACnB,gBAAiB0W,EAAe,IAAI1a,IAAM,CAAE,KAAMA,EAAE,KAAM,MAAOA,EAAE,YAAa,EAChF,iBAAkB4O,EAAQ,OAC1B,aAAc+L,CAAA,CAElB,EAGA,MAAM,gBAAgBzW,EAAW0W,EAAY3V,EAAO,KAAM,CACxD,GAAI,CAAC0B,EAAsB,OAAO,KAElC,MAAM2T,EAAarV,GAAQ,IAAI,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,EAGhE,GAAI,CAACQ,KAAuB,CAC1B,MAAMV,EAAS,CACb,GAAIJ,GAAA,EACJ,WAAYT,EACZ,YAAaoW,EACb,GAAGM,EACH,WAAY,IAAI,OAAO,cACvB,SAAU,IAEZ,aAAM9V,GAAiBC,CAAM,EAEtBA,CACT,CAEA,MAAMwE,EAASnB,EAAA,EACT,CAAE,KAAApG,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,WAAYrF,EACZ,YAAaoW,EACb,GAAGM,EACH,WAAY,IAAI,OAAO,aAAY,EAClC,CACD,WAAY,yBACb,EACA,SACA,SAEH,GAAIrU,EAAO,CAET,GAAIA,EAAM,SAAS,SAAS,OAAO,GAAKA,EAAM,SAAS,SAAS,SAAS,EAAG,CAC1E,MAAMxB,EAAS,CACb,GAAIJ,GAAA,EACJ,WAAYT,EACZ,YAAaoW,EACb,GAAGM,EACH,SAAU,IAEZ,aAAM9V,GAAiBC,CAAM,EACtBA,CACT,CACA,cAAQ,MAAM,6BAA8BwB,CAAK,EAC3CA,CACR,CAGA,OAAIvE,GACF8C,GAAiB9C,CAAI,EAAE,MAAMuP,GAAO,QAAQ,MAAM,0BAA2BA,CAAG,CAAC,EAE5EvP,CACT,EAGA,MAAM,kBAAkBkC,EAAW2W,EAAa5V,EAAO,KAAM,CAC3D,GAAI,CAAC0B,EAAsB,OAAO,KAElC,MAAM2T,EAAarV,GAAQ,IAAI,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,EAGhE,GAAI,CAACQ,KAAuB,CAE1B,MAAMqV,EAAe,MAAM9V,GAAqBd,EAAWoW,CAAU,EAC/DvV,EAAS,CACb,GAAIJ,GAAA,EACJ,WAAYT,EACZ,YAAaoW,EACb,GAAIQ,GAAgB,GACpB,OAAQ,eACR,aAAcD,EACd,aAAc,IAAI,OAAO,cACzB,SAAU,IAEZ,aAAM/V,GAAiBC,CAAM,EAC7B,MAAMlC,GAAiBD,GAAa,oBAAqB,CACvD,UAAAsB,EACA,WAAY4W,GAAgB,GAC5B,YAAAD,CAAA,CACD,EACM9V,CACT,CAGA,MAAMgW,EAAW,MAAM,KAAK,mBAAmB7W,EAAWoW,CAAU,EAE9D/Q,EAASnB,EAAA,EACf,GAAI,CAACmB,EACH,MAAM,IAAI,MAAM,+BAA+B,EAGjD,KAAM,CAAE,KAAAvH,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,WAAYrF,EACZ,YAAaoW,EACb,GAAGS,EACH,OAAQ,YACR,aAAc,IAAI,OAAO,cACzB,aAAcF,EACd,WAAY,IAAI,OAAO,aAAY,EAClC,CACD,WAAY,yBACb,EACA,SACA,SAEH,GAAItU,EAAO,CAET,GAAIA,EAAM,SAAS,SAAS,OAAO,GAAKA,EAAM,SAAS,SAAS,SAAS,EAAG,CAC1E,MAAMxB,EAAS,CACb,GAAIJ,GAAA,EACJ,WAAYT,EACZ,YAAaoW,EACb,GAAGS,EACH,OAAQ,eACR,aAAcF,EACd,SAAU,IAEZ,aAAM/V,GAAiBC,CAAM,EAC7B,MAAMlC,GAAiBD,GAAa,oBAAqB,CACvD,UAAAsB,EACA,WAAY6W,EACZ,YAAAF,CAAA,CACD,EACM9V,CACT,CACA,cAAQ,MAAM,iCAAkCwB,CAAK,EAC/CA,CACR,CAGA,OAAIvE,GACF8C,GAAiB9C,CAAI,EAAE,MAAMuP,GAAO,QAAQ,MAAM,0BAA2BA,CAAG,CAAC,EAE5EvP,CACT,EAGA,MAAM,gBAAgBkC,EAAWkO,EAAQ,GAAI,CAC3C,GAAI,CAACzL,EAAsB,MAAO,GAElC,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,eAAe,EACpB,OAAO,GAAG,EACV,GAAG,aAAc1C,CAAS,EAC1B,MAAM,cAAe,CAAE,UAAW,GAAO,EACzC,MAAMkO,CAAK,EAEd,OAAI7L,GACF,QAAQ,MAAM,gCAAiCA,CAAK,EAC7C,IAEFvE,GAAQ,EACjB,EAOA,MAAM,YAAYkC,EAAWkB,EAAS4V,EAAYC,EAAYC,EAAe,KAAMtC,EAAW,KAAMuC,EAAc,UAAWC,EAAW,KAAM,CAC5I,GAAI,CAACzU,EAAsB,OAAO,KAGlC,GAAI,CAAClB,KAAuB,CAC1B,MAAM4V,EAAM,CACV,GAAI1W,GAAA,EACJ,WAAYT,EACZ,YAAa8W,EACb,YAAaC,EACb,eAAgBC,EAChB,QAAA9V,EACA,UAAWwT,EACX,aAAcuC,EACd,kBAAmBC,EACnB,WAAY,IAAI,OAAO,cACvB,SAAU,IAEZ,aAAMjW,GAAakW,CAAG,EACtB,MAAMxY,GAAiBD,GAAa,aAAc,CAChD,UAAAsB,EACA,WAAA8W,EACA,WAAAC,EACA,QAAS7V,CAAA,CACV,EACMiW,CACT,CAEA,KAAM,CAAE,KAAArZ,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,UAAU,EACf,OAAO,CACN,WAAY1C,EACZ,YAAa8W,EACb,YAAaC,EACb,eAAgBC,EAChB,QAAA9V,EACA,UAAWwT,EACX,aAAcuC,EACd,kBAAmBC,CAAA,CACpB,EACA,SACA,SAEH,GAAI7U,EAAO,CAET,GAAIA,EAAM,SAAS,SAAS,OAAO,GAAKA,EAAM,SAAS,SAAS,SAAS,EAAG,CAC1E,MAAM8U,EAAM,CACV,GAAI1W,GAAA,EACJ,WAAYT,EACZ,YAAa8W,EACb,YAAaC,EACb,QAAA7V,EACA,WAAY,IAAI,OAAO,cACvB,SAAU,IAEZ,aAAMD,GAAakW,CAAG,EACtB,MAAMxY,GAAiBD,GAAa,aAAc,CAChD,UAAAsB,EACA,WAAA8W,EACA,WAAAC,EACA,QAAS7V,CAAA,CACV,EACMiW,CACT,CACA,cAAQ,MAAM,yBAA0B9U,CAAK,EACvCA,CACR,CACA,OAAOvE,CACT,EAGA,MAAM,YAAYkC,EAAWkO,EAAQ,GAAI,CACvC,GAAI,CAACzL,EAAsB,MAAO,GAElC,MAAM4C,EAASnB,EAAA,EACT,CAAE,KAAApG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,UAAU,EACf,OAAO,GAAG,EACV,GAAG,aAAcrF,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,GAAO,EACxC,MAAMkO,CAAK,EAEd,OAAI7L,EACK,GAEFvE,GAAQ,EACjB,EAGA,MAAM,eAAekC,EAAWoX,EAAY,CAC1C,GAAI,CAAC3U,EAAsB,MAAO,GAElC,MAAM4C,EAASnB,EAAA,EAET4S,EAAaM,IAAe,QAAU,SAAW,QAEjD,CAAE,MAAAjJ,EAAO,MAAA9L,CAAA,EAAU,MAAMgD,EAC5B,KAAK,UAAU,EACf,OAAO,IAAK,CAAE,MAAO,QAAS,KAAM,GAAM,EAC1C,GAAG,aAAcrF,CAAS,EAC1B,GAAG,cAAe8W,CAAU,EAC5B,GAAG,UAAW,EAAK,EAEtB,OAAIzU,EACK,EAEF8L,GAAS,CAClB,EAGA,MAAM,iBAAiBnO,EAAWoX,EAAY,CAC5C,GAAI,CAAC3U,EAAsB,OAE3B,MAAM4C,EAASnB,EAAA,EACT4S,EAAaM,IAAe,QAAU,SAAW,QAEvD,MAAM/R,EACH,KAAK,UAAU,EACf,OAAO,CAAE,QAAS,GAAM,QAAS,IAAI,OAAO,cAAe,EAC3D,GAAG,aAAcrF,CAAS,EAC1B,GAAG,cAAe8W,CAAU,EAC5B,GAAG,UAAW,EAAK,CACxB,EAOA,MAAM,sBAAsB9W,EAAWhC,EAAOqZ,EAAaC,EAAW,KAAMC,EAAW,SAAUtE,EAAQ,KAAM,CAC7G,GAAI,CAACxQ,EAAsB,OAAO,KAGlC,GAAI,CAAClB,KAAuB,CAC1B,MAAMjE,EAAU,CACd,GAAImD,GAAA,EACJ,WAAYT,EACZ,MAAAhC,EACA,aAAcqZ,EACd,UAAWC,EACX,SAAAC,EACA,MAAAtE,EACA,OAAQ,eACR,WAAY,IAAI,OAAO,cACvB,SAAU,IAEZ,aAAMtU,GAAiBD,GAAa,wBAAyB,CAC3D,UAAAsB,EACA,MAAAhC,EACA,YAAAqZ,EACA,SAAAC,EACA,SAAAC,EACA,MAAAtE,CAAA,CACD,EACM3V,CACT,CAEA,KAAM,CAAE,KAAAQ,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,mBAAmB,EACxB,OAAO,CACN,WAAY1C,EACZ,MAAAhC,EACA,aAAcqZ,EACd,UAAWC,EACX,SAAAC,EACA,MAAAtE,CAAA,CACD,EACA,SACA,SAEH,GAAI5Q,EAAO,CAET,GAAIA,EAAM,SAAS,SAAS,OAAO,GAAKA,EAAM,SAAS,SAAS,SAAS,EAAG,CAC1E,MAAM/E,EAAU,CACd,GAAImD,GAAA,EACJ,WAAYT,EACZ,MAAAhC,EACA,aAAcqZ,EACd,OAAQ,eACR,SAAU,IAEZ,aAAM1Y,GAAiBD,GAAa,wBAAyB,CAC3D,UAAAsB,EACA,MAAAhC,EACA,YAAAqZ,EACA,SAAAC,EACA,SAAAC,EACA,MAAAtE,CAAA,CACD,EACM3V,CACT,CACA,cAAQ,MAAM,mCAAoC+E,CAAK,EACjDA,CACR,CACA,OAAOvE,CACT,EAGA,MAAM,oBAAoBkC,EAAWG,EAAS,KAAM,CAClD,GAAI,CAACsC,EAAsB,MAAO,GAElC,IAAI2C,EAAQ1C,EACT,KAAK,mBAAmB,EACxB,OAAO,GAAG,EACV,GAAG,aAAc1C,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,GAAO,EAEvCG,IACFiF,EAAQA,EAAM,GAAG,SAAUjF,CAAM,GAGnC,KAAM,CAAE,KAAArC,EAAM,MAAAuE,CAAA,EAAU,MAAM+C,EAE9B,OAAI/C,GACF,QAAQ,MAAM,oCAAqCA,CAAK,EACjD,IAEFvE,GAAQ,EACjB,EAGA,MAAM,wBAAwBkC,EAAW,CACvC,GAAI,CAACyC,EAAsB,MAAO,GAElC,KAAM,CAAE,MAAA0L,EAAO,MAAA9L,CAAA,EAAU,MAAMK,EAC5B,KAAK,mBAAmB,EACxB,OAAO,IAAK,CAAE,MAAO,QAAS,KAAM,GAAM,EAC1C,GAAG,aAAc1C,CAAS,EAC1B,GAAG,SAAU,SAAS,EAEzB,OAAIqC,EAAc,EACX8L,GAAS,CAClB,EAGA,MAAM,sBAAsB9E,EAAWlJ,EAAQqX,EAAaC,EAAgB,KAAMC,EAAmB,KAAM,CACzG,GAAI,CAACjV,EAAsB,OAAO,KAElC,MAAMsD,EAAa,CACjB,OAAA5F,EACA,aAAcqX,EACd,aAAc,IAAI,OAAO,cACzB,eAAgBC,EAChB,WAAY,IAAI,OAAO,aAAY,EAGjCC,IACF3R,EAAW,kBAAoB2R,GAG7BvX,IAAW,cACb4F,EAAW,aAAe,IAAI,OAAO,eAGvC,KAAM,CAAE,KAAAjI,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,mBAAmB,EACxB,OAAOqD,CAAU,EACjB,GAAG,KAAMsD,CAAS,EAClB,SACA,SAEH,GAAIhH,EACF,cAAQ,MAAM,mCAAoCA,CAAK,EACjDA,EAER,OAAOvE,CACT,EAOA,oBAAqB,CACnB,MAAM6Z,EAAQ,iEACRjX,EAAQ,IAAI,WAAW,EAAE,EAC/B,cAAO,gBAAgBA,CAAK,EACrB,MAAM,KAAKA,EAAO3E,GAAK4b,EAAM5b,EAAI4b,EAAM,MAAM,CAAC,EAAE,KAAK,EAAE,CAChE,EAGA,MAAM,mBAAmB3X,EAAWgJ,EAAW4O,EAAa3O,EAAY,KAAM,CAC5E,GAAI,CAACxG,EAAsB,CAEzB,MAAMoH,EAAYtF,EAAA,EACbsF,EAAU,gBAAeA,EAAU,cAAgB,IAExD,MAAMgO,EAAQ,CACZ,GAAI,OAAO,aACX,WAAY7X,EACZ,YAAa,KAAK,qBAClB,WAAYgJ,EACZ,WAAYC,EACZ,UAAW,GACX,YAAA2O,EACA,WAAY,EACZ,eAAgB,KAChB,WAAY,IAAI,OAAO,cACvB,WAAY,IAAI,OAAO,aAAY,EAGrC,OAAA/N,EAAU,cAAc,KAAKgO,CAAK,EAClCrT,GAAaqF,CAAS,EACfgO,CACT,CAGA,KAAM,CAAE,KAAMC,EAAW,MAAO3O,GAAe,MAAMzG,EAAS,IAAI,sBAAsB,EACxF,GAAIyG,EACF,cAAQ,MAAM,gCAAiCA,CAAU,EACnDA,EAGR,KAAM,CAAE,KAAArL,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAO,CACN,WAAY1C,EACZ,YAAa8X,EACb,WAAY9O,EACZ,WAAYC,EACZ,YAAA2O,CAAA,CACD,EACA,SACA,SAEH,GAAIvV,EACF,cAAQ,MAAM,gCAAiCA,CAAK,EAC9CA,EAER,OAAOvE,CACT,EAGA,MAAM,gBAAgBsL,EAAO,CAC3B,GAAI,CAAC3G,EAAsB,CAEzB,MAAMoH,EAAYtF,EAAA,EAClB,GAAI,CAACsF,EAAU,cAAe,OAAO,KAErC,MAAMgO,EAAQhO,EAAU,cAAc,KAAKqJ,GACzCA,EAAE,cAAgB9J,GAClB8J,EAAE,YACD,CAACA,EAAE,YAAc,IAAI,KAAKA,EAAE,UAAU,MAAQ,KAAK,EAGtD,OAAI2E,IAEFA,EAAM,aACNA,EAAM,eAAiB,IAAI,OAAO,cAClCrT,GAAaqF,CAAS,GAGjBgO,CACT,CAEA,KAAM,CAAE,KAAA/Z,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAO,gBAAgB,EACvB,GAAG,cAAe0G,CAAK,EACvB,GAAG,YAAa,EAAI,EACpB,SAEH,OAAI/G,GACF,QAAQ,MAAM,iCAAkCA,CAAK,EAC9C,MAILvE,EAAK,YAAc,IAAI,KAAKA,EAAK,UAAU,EAAI,IAAI,KAC9C,MAIT,MAAM4E,EAAS,IAAI,6BAA8B,CAAE,MAAA0G,EAAO,EAEnDtL,EACT,EAGA,MAAM,iBAAiBkC,EAAW,CAChC,GAAI,CAACyC,EAAsB,CAEzB,MAAMoH,EAAYtF,EAAA,EAClB,OAAKsF,EAAU,cAERA,EAAU,cAAc,OAAOqJ,GAAKA,EAAE,aAAelT,CAAS,EAFhC,EAGvC,CAEA,KAAM,CAAE,KAAAlC,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAO,uBAAuB,EAC9B,GAAG,aAAc1C,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,GAAO,EAE3C,OAAIqC,GACF,QAAQ,MAAM,iCAAkCA,CAAK,EAC9C,IAEFvE,GAAQ,EACjB,EAGA,MAAM,mBAAmBia,EAAS1Y,EAAS,CACzC,GAAI,CAACoD,EAAsB,CAEzB,MAAMoH,EAAYtF,EAAA,EAClB,GAAI,CAACsF,EAAU,cAAe,OAAO,KAErC,MAAMmO,EAAanO,EAAU,cAAc,UAAUqJ,GAAKA,EAAE,KAAO6E,CAAO,EAC1E,OAAIC,IAAe,GAAW,MAE9BnO,EAAU,cAAcmO,CAAU,EAAI,CACpC,GAAGnO,EAAU,cAAcmO,CAAU,EACrC,GAAG3Y,EACH,WAAY,IAAI,OAAO,aAAY,EAErCmF,GAAaqF,CAAS,EACfA,EAAU,cAAcmO,CAAU,EAC3C,CAEA,KAAM,CAAE,KAAAla,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAOrD,CAAO,EACd,GAAG,KAAM0Y,CAAO,EAChB,SACA,SAEH,GAAI1V,EACF,cAAQ,MAAM,gCAAiCA,CAAK,EAC9CA,EAER,OAAOvE,CACT,EAGA,MAAM,mBAAmBia,EAAS,CAChC,OAAO,KAAK,mBAAmBA,EAAS,CAAE,UAAW,GAAO,CAC9D,EAGA,MAAM,mBAAmBA,EAAS,CAChC,GAAI,CAACtV,EAAsB,CAEzB,MAAMoH,EAAYtF,EAAA,EAClB,GAAI,CAACsF,EAAU,cAAe,OAE9BA,EAAU,cAAgBA,EAAU,cAAc,OAAOqJ,GAAKA,EAAE,KAAO6E,CAAO,EAC9EvT,GAAaqF,CAAS,EACtB,MACF,CAEA,KAAM,CAAE,MAAAxH,CAAA,EAAU,MAAMK,EACrB,KAAK,gBAAgB,EACrB,SACA,GAAG,KAAMqV,CAAO,EAEnB,GAAI1V,EACF,cAAQ,MAAM,gCAAiCA,CAAK,EAC9CA,CAEV,EAGA,MAAM,qBAAqB4V,EAAY,CACrC,MAAMJ,EAAQ,MAAM,KAAK,gBAAgBI,CAAU,EACnD,GAAI,CAACJ,EAAO,OAAO,KAEnB,MAAM7X,EAAY6X,EAAM,YAAcA,EAAM,UAAU,GAEtD,GAAI,CAACpV,EAAsB,CAEzB,MAAMoH,EAAYtF,EAAA,EACZ6J,EAAUvE,EAAU,SAAS,KAAK,GAAK,EAAE,KAAO7J,CAAS,EAC/D,GAAI,CAACoO,EAAS,OAAO,KAErB,MAAMtO,EAAQ+J,EAAU,MAAM,OAAO/N,GAAKA,EAAE,aAAekE,CAAS,EAG9DkY,EAAcpY,EAAM,OAAO,CAACyM,EAAKnM,IAASmM,EAAM,WAAWnM,EAAK,QAAU,CAAC,EAAG,CAAC,EAC/E+X,EAAkBrY,EACrB,UAAYhE,EAAE,SAAW,MAAM,EAC/B,OAAO,CAACyQ,EAAKnM,IAASmM,EAAM,WAAWnM,EAAK,QAAU,CAAC,EAAG,CAAC,EACxDgY,EAAWF,EAAc,EAAI,KAAK,MAAOC,EAAkBD,EAAe,GAAG,EAAI,EAEvF,MAAO,CACL,MAAAL,EACA,QAAAzJ,EACA,SAAAgK,EACA,MAAOP,EAAM,YAAY,SAAW/X,EAAQ,GAC5C,OAAQ,GACR,aAAc,GACd,UAAW,EAAC,CAEhB,CAGA,MAAMsO,EAAUyJ,EAAM,UAAY,MAAM,KAAK,WAAW7X,CAAS,EACjE,GAAI,CAACoO,EAAS,OAAO,KAGrB,MAAM9K,EAAS,CACb,MAAAuU,EACA,QAAAzJ,EACA,MAAO,GACP,OAAQ,GACR,aAAc,GACd,UAAW,EAAC,EAId,GAAIyJ,EAAM,YAAY,SAAU,CAC9BvU,EAAO,MAAQ,MAAM,KAAK,SAAStD,CAAS,EAG5C,MAAMkY,EAAc5U,EAAO,MAAM,OAAO,CAACiJ,EAAKnM,IAASmM,EAAM,WAAWnM,EAAK,QAAU,CAAC,EAAG,CAAC,EACtF+X,EAAkB7U,EAAO,MAC5B,OAAOxH,GAAKA,EAAE,SAAW,MAAM,EAC/B,OAAO,CAACyQ,EAAKnM,IAASmM,EAAM,WAAWnM,EAAK,QAAU,CAAC,EAAG,CAAC,EAC9DkD,EAAO,SAAW4U,EAAc,EAAI,KAAK,MAAOC,EAAkBD,EAAe,GAAG,EAAI,CAC1F,CAGA,GAAIL,EAAM,YAAY,OAAQ,CAC5B,KAAM,CAAE,KAAMnN,CAAA,EAAY,MAAMhI,EAC7B,KAAK,iBAAiB,EACtB,OAAO,mBAAmB,EAC1B,GAAG,aAAc1C,CAAS,EAC1B,IAAI,SAAU,KAAM,IAAI,EACxB,MAAM,YAAa,CAAE,UAAW,GAAO,EACvC,MAAM,EAAE,EAEXsD,EAAO,OAASoH,GAAS,YACtB4D,EAAE,QAAU,IAAI,IAAI+J,IAAU,CAC7B,IAAKA,EACL,KAAM/J,EAAE,WACR,IACC,EACP,CAGA,GAAIuJ,EAAM,YAAY,cAAe,CACnC,KAAM,CAAE,KAAMS,CAAA,EAAY,MAAM5V,EAC7B,KAAK,eAAe,EACpB,OAAO,GAAG,EACV,GAAG,aAAc1C,CAAS,EAC1B,MAAM,cAAe,CAAE,UAAW,GAAO,EACzC,MAAM,EAAE,EAEXsD,EAAO,aAAegV,GAAW,EACnC,CAGA,OAAIT,EAAM,YAAY,aACpBvU,EAAO,UAAY,MAAM,KAAK,aAAatD,CAAS,GAG/CsD,CACT,EAOA,MAAM,mBAAmBoT,EAAY,CACnC,GAAI,CAACjU,EAAsB,CAEzB,MAAMoH,EAAYtF,EAAA,EACbsF,EAAU,gBAAeA,EAAU,cAAgB,IAExD,MAAMhJ,EAAS,CACb,GAAI,OAAO,aACX,GAAG6V,EACH,WAAY,IAAI,OAAO,cACvB,WAAY,IAAI,OAAO,aAAY,EAGrC,OAAA7M,EAAU,cAAc,KAAKhJ,CAAM,EACnC2D,GAAaqF,CAAS,EACfhJ,CACT,CAEA,KAAM,CAAE,KAAA/C,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAOgU,CAAU,EACjB,SACA,SAEH,GAAIrU,EACF,cAAQ,MAAM,gCAAiCA,CAAK,EAC9CA,EAER,OAAOvE,CACT,EAGA,MAAM,iBAAiBkC,EAAW,CAChC,GAAI,CAACyC,EAAsB,CACzB,MAAMoH,EAAYtF,EAAA,EAClB,OAAKsF,EAAU,cACRA,EAAU,cACd,OAAO7I,GAAKA,EAAE,aAAehB,CAAS,EACtC,KAAK,CAAClE,EAAGC,IAAM,IAAI,KAAKA,EAAE,aAAa,EAAI,IAAI,KAAKD,EAAE,aAAa,CAAC,EAHlC,EAIvC,CAEA,KAAM,CAAE,KAAAgC,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAO,GAAG,EACV,GAAG,aAAc1C,CAAS,EAC1B,MAAM,gBAAiB,CAAE,UAAW,GAAO,EAE9C,OAAIqC,GACF,QAAQ,MAAM,iCAAkCA,CAAK,EAC9C,IAEFvE,GAAQ,EACjB,EAGA,MAAM,wBAAwB8B,EAAWO,EAAS,KAAM,CACtD,GAAI,CAACsC,EAAsB,CACzB,MAAMoH,EAAYtF,EAAA,EAClB,GAAI,CAACsF,EAAU,cAAe,MAAO,GACrC,IAAIyO,EAAUzO,EAAU,cAAc,OAAO7I,GAAKA,EAAE,aAAepB,CAAS,EAC5E,OAAIO,IACFmY,EAAUA,EAAQ,OAAOtX,GAAKA,EAAE,SAAWb,CAAM,GAE5CmY,EAAQ,KAAK,CAACxc,EAAGC,IAAM,IAAI,KAAKA,EAAE,aAAa,EAAI,IAAI,KAAKD,EAAE,aAAa,CAAC,CACrF,CAEA,IAAIsJ,EAAQ1C,EACT,KAAK,gBAAgB,EACrB,OAAO,mBAAmB,EAC1B,GAAG,aAAc9C,CAAS,EAC1B,MAAM,gBAAiB,CAAE,UAAW,GAAO,EAE1CO,IACFiF,EAAQA,EAAM,GAAG,SAAUjF,CAAM,GAGnC,KAAM,CAAE,KAAArC,EAAM,MAAAuE,CAAA,EAAU,MAAM+C,EAE9B,OAAI/C,GACF,QAAQ,MAAM,yCAA0CA,CAAK,EACtD,IAEFvE,GAAQ,EACjB,EAGA,MAAM,gBAAgBya,EAAU,CAC9B,GAAI,CAAC9V,EAAsB,CACzB,MAAMoH,EAAYtF,EAAA,EAClB,OAAKsF,EAAU,cACRA,EAAU,cAAc,KAAK7I,GAAKA,EAAE,KAAOuX,CAAQ,EADrB,IAEvC,CAEA,KAAM,CAAE,KAAAza,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAO,4CAA4C,EACnD,GAAG,KAAM6V,CAAQ,EACjB,SAEH,OAAIlW,GACF,QAAQ,MAAM,gCAAiCA,CAAK,EAC7C,MAEFvE,CACT,EAGA,MAAM,mBAAmBya,EAAUlZ,EAAS,CAC1C,GAAI,CAACoD,EAAsB,CACzB,MAAMoH,EAAYtF,EAAA,EAClB,GAAI,CAACsF,EAAU,cAAe,OAAO,KAErC,MAAM2O,EAAc3O,EAAU,cAAc,UAAU7I,GAAKA,EAAE,KAAOuX,CAAQ,EAC5E,OAAIC,IAAgB,GAAW,MAE/B3O,EAAU,cAAc2O,CAAW,EAAI,CACrC,GAAG3O,EAAU,cAAc2O,CAAW,EACtC,GAAGnZ,EACH,WAAY,IAAI,OAAO,aAAY,EAErCmF,GAAaqF,CAAS,EACfA,EAAU,cAAc2O,CAAW,EAC5C,CAEA,KAAM,CAAE,KAAA1a,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAOrD,CAAO,EACd,GAAG,KAAMkZ,CAAQ,EACjB,SACA,SAEH,GAAIlW,EACF,cAAQ,MAAM,gCAAiCA,CAAK,EAC9CA,EAER,OAAOvE,CACT,EAGA,MAAM,kBAAkBya,EAAUjQ,EAAQ,CACxC,OAAO,KAAK,mBAAmBiQ,EAAU,CACvC,OAAQ,SACR,UAAW,IAAI,OAAO,cACtB,UAAWjQ,CAAA,CACZ,CACH,EAGA,MAAM,mBAAmBiQ,EAAU,CACjC,GAAI,CAAC9V,EAAsB,CACzB,MAAMoH,EAAYtF,EAAA,EAClB,GAAI,CAACsF,EAAU,cAAe,OAE9BA,EAAU,cAAgBA,EAAU,cAAc,OAAO7I,GAAKA,EAAE,KAAOuX,CAAQ,EAC/E/T,GAAaqF,CAAS,EACtB,MACF,CAEA,KAAM,CAAE,MAAAxH,CAAA,EAAU,MAAMK,EACrB,KAAK,gBAAgB,EACrB,SACA,GAAG,KAAM6V,CAAQ,EAEpB,GAAIlW,EACF,cAAQ,MAAM,gCAAiCA,CAAK,EAC9CA,CAEV,EAGA,MAAM,oBAAoBzC,EAAWsM,EAAY,KAAMH,EAAU,KAAM,CACrE,GAAI,CAACtJ,EAAsB,CAEzB,MAAMoH,EAAYtF,EAAA,EAClB,GAAI,CAACsF,EAAU,cACb,MAAO,CACL,gBAAiB,EACjB,eAAgB,EAChB,iBAAkB,EAClB,kBAAmB,EACnB,YAAa,EACb,gBAAiB,EACjB,gBAAiB,EACjB,sBAAuB,GAI3B,IAAIyO,EAAUzO,EAAU,cAAc,OAAO7I,GAAKA,EAAE,aAAepB,CAAS,EAE5E,OAAIsM,IACFoM,EAAUA,EAAQ,OAAOtX,GAAK,IAAI,KAAKA,EAAE,aAAa,GAAK,IAAI,KAAKkL,CAAS,CAAC,GAE5EH,IACFuM,EAAUA,EAAQ,OAAOtX,GAAK,IAAI,KAAKA,EAAE,aAAa,GAAK,IAAI,KAAK+K,CAAO,CAAC,GAGvE,CACL,gBAAiBuM,EAAQ,OACzB,eAAgBA,EAAQ,UAAYtX,EAAE,cAAgB,OAAO,EAAE,OAC/D,iBAAkBsX,EAAQ,UAAYtX,EAAE,cAAgB,SAAS,EAAE,OACnE,kBAAmBsX,EAAQ,UAAYtX,EAAE,cAAgB,UAAU,EAAE,OACrE,YAAasX,EAAQ,UAAYtX,EAAE,cAAgB,WAAW,EAAE,OAChE,gBAAiBsX,EAAQ,OAAOtX,GAAKA,EAAE,eAAe,EAAE,OACxD,gBAAiBsX,EAAQ,OAAO,CAAC/L,EAAKvL,IAAMuL,GAAOvL,EAAE,qBAAuB,GAAI,CAAC,EACjF,sBAAuBsX,EAAQ,OAAO,CAAC/L,EAAKvL,IAAMuL,GAAOvL,EAAE,sBAAwB,GAAI,CAAC,EAE5F,CAEA,KAAM,CAAE,KAAAlD,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAAS,IAAI,wBAAyB,CAClE,QAAS9C,EACT,WAAYsM,EACZ,SAAUH,CAAA,CACX,EAED,OAAI1J,GACF,QAAQ,MAAM,oCAAqCA,CAAK,EACjD,MAEFvE,EAAK,CAAC,GAAK,IACpB,EAGA,MAAM,WAAWya,EAAUE,EAAS,CAClC,GAAI,CAAChW,EAAsB,CACzB,MAAMoH,EAAYtF,EAAA,EAClB,GAAI,CAACsF,EAAU,cAAe,OAAO,KAErC,MAAM2O,EAAc3O,EAAU,cAAc,UAAU7I,GAAKA,EAAE,KAAOuX,CAAQ,EAC5E,GAAIC,IAAgB,GAAI,OAAO,KAE/B,MAAM3X,EAASgJ,EAAU,cAAc2O,CAAW,EAC5CE,EAAY7X,EAAO,WAAa,GACtC6X,SAAU,KAAKD,CAAO,EAEtB5O,EAAU,cAAc2O,CAAW,EAAI,CACrC,GAAG3X,EACH,UAAA6X,EACA,WAAY,IAAI,OAAO,aAAY,EAErClU,GAAaqF,CAAS,EACfA,EAAU,cAAc2O,CAAW,CAC5C,CAEA,MAAM3X,EAAS,MAAM,KAAK,gBAAgB0X,CAAQ,EAClD,GAAI,CAAC1X,EAAQ,OAAO,KAEpB,MAAM6X,EAAY7X,EAAO,WAAa,GACtC,OAAA6X,EAAU,KAAKD,CAAO,EAEf,KAAK,mBAAmBF,EAAU,CAAE,UAAAG,EAAW,CACxD,EAGA,MAAM,cAAcH,EAAUI,EAAc,CAC1C,GAAI,CAAClW,EAAsB,CACzB,MAAMoH,EAAYtF,EAAA,EAClB,GAAI,CAACsF,EAAU,cAAe,OAAO,KAErC,MAAM2O,EAAc3O,EAAU,cAAc,UAAU7I,GAAKA,EAAE,KAAOuX,CAAQ,EAC5E,GAAIC,IAAgB,GAAI,OAAO,KAE/B,MAAM3X,EAASgJ,EAAU,cAAc2O,CAAW,EAC5CE,EAAY7X,EAAO,WAAa,GACtC6X,SAAU,OAAOC,EAAc,CAAC,EAEhC9O,EAAU,cAAc2O,CAAW,EAAI,CACrC,GAAG3X,EACH,UAAA6X,EACA,WAAY,IAAI,OAAO,aAAY,EAErClU,GAAaqF,CAAS,EACfA,EAAU,cAAc2O,CAAW,CAC5C,CAEA,MAAM3X,EAAS,MAAM,KAAK,gBAAgB0X,CAAQ,EAClD,GAAI,CAAC1X,EAAQ,OAAO,KAEpB,MAAM6X,EAAY7X,EAAO,WAAa,GACtC,OAAA6X,EAAU,OAAOC,EAAc,CAAC,EAEzB,KAAK,mBAAmBJ,EAAU,CAAE,UAAAG,EAAW,CACxD,EAOA,MAAM,gBAAgB9Y,EAAW,CAC/B,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,gBAAgB,EACrB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAQP,EACA,GAAG,aAAc9C,CAAS,EAE7B,OAAIyC,GACF,QAAQ,MAAM,gCAAiCA,CAAK,EAC7C,IAEFvE,GAAM,IAAIuU,IAAO,CACtB,GAAIA,EAAG,QACP,KAAMA,EAAG,OAAO,MAAQA,EAAG,OAAO,MAClC,MAAOA,EAAG,OAAO,MACjB,KAAMA,EAAG,MACT,GAAK,EACT,CACA,MAAO,EACT,EAGA,MAAM,kCAAkCrS,EAAW,CACjD,GAAIyC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,0BAA0B,EAC/B,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAOP,EACA,GAAG,aAAc1C,CAAS,EAE7B,OAAIqC,GACF,QAAQ,MAAM,2CAA4CA,CAAK,EACxD,IAEFvE,GAAQ,EACjB,CAEA,MAAM+L,EAAYtF,EAAA,EAClB,OAAKsF,EAAU,wBACRA,EAAU,wBAAwB,OAAO+O,GAAMA,EAAG,aAAe5Y,CAAS,EADlC,EAEjD,EAGA,MAAM,+BAA+BsI,EAAQ,CAC3C,GAAI7F,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,0BAA0B,EAC/B,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAMP,EACA,GAAG,UAAW4F,CAAM,EAEvB,OAAIjG,GACF,QAAQ,MAAM,gDAAiDA,CAAK,EAC7D,IAEFvE,GAAQ,EACjB,CACA,MAAM+L,EAAYtF,EAAA,EAClB,OAAKsF,EAAU,wBACRA,EAAU,wBAAwB,OAAO+O,GAAMA,EAAG,UAAYtQ,CAAM,EAD5B,EAEjD,EAGA,MAAM,0BAA0BtI,EAAWsI,EAAQuQ,EAAmB,CACpE,GAAIpW,EAAsB,CAExB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,0BAA0B,EAC/B,OAAO,CACN,WAAY1C,EACZ,QAASsI,EACT,mBAAoBuQ,EACpB,WAAY,IAAI,OAAO,aAAY,EAClC,CACD,WAAY,qBACb,EACA,SACA,SAEH,GAAIxW,EACF,cAAQ,MAAM,yCAA0CA,CAAK,EACvDA,EAER,OAAOvE,CACT,CAEA,MAAM+L,EAAYtF,EAAA,EACbsF,EAAU,0BACbA,EAAU,wBAA0B,IAGtC,MAAMiP,EAAgBjP,EAAU,wBAAwB,UACtD+O,GAAMA,EAAG,aAAe5Y,GAAa4Y,EAAG,UAAYtQ,CAAA,EAGhDyQ,EAAO,CACX,GAAID,GAAiB,EAAIjP,EAAU,wBAAwBiP,CAAa,EAAE,GAAK,OAAO,aACtF,WAAY9Y,EACZ,QAASsI,EACT,mBAAoBuQ,EACpB,WAAYC,GAAiB,EAAIjP,EAAU,wBAAwBiP,CAAa,EAAE,WAAa,IAAI,OAAO,cAC1G,WAAY,IAAI,OAAO,aAAY,EAGrC,OAAIA,GAAiB,EACnBjP,EAAU,wBAAwBiP,CAAa,EAAIC,EAEnDlP,EAAU,wBAAwB,KAAKkP,CAAI,EAG7CvU,GAAaqF,CAAS,EACfkP,CACT,EAGA,MAAM,6BAA6B/Y,EAAWsI,EAAQ,CACpD,GAAI7F,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EACrB,KAAK,0BAA0B,EAC/B,SACA,GAAG,aAAc1C,CAAS,EAC1B,GAAG,UAAWsI,CAAM,EAEvB,GAAIjG,EACF,cAAQ,MAAM,0CAA2CA,CAAK,EACxDA,EAER,MAAO,EACT,CAEA,MAAMwH,EAAYtF,EAAA,EAClB,OAAKsF,EAAU,0BACfA,EAAU,wBAA0BA,EAAU,wBAAwB,UAC9D,EAAE+O,EAAG,aAAe5Y,GAAa4Y,EAAG,UAAYtQ,EAAA,EAExD9D,GAAaqF,CAAS,GACf,EACT,EAGA,MAAM,kCAAkC7J,EAAWgZ,EAAiB,CAElE,MAAMlX,EAAU,GAChB,UAAWiX,KAAQC,EACjB,GAAID,EAAK,mBAAqBA,EAAK,kBAAkB,OAAS,EAAG,CAC/D,MAAMzV,EAAS,MAAM,KAAK,0BAA0BtD,EAAW+Y,EAAK,OAAQA,EAAK,iBAAiB,EAClGjX,EAAQ,KAAKwB,CAAM,CACrB,MACE,MAAM,KAAK,6BAA6BtD,EAAW+Y,EAAK,MAAM,EAGlE,OAAOjX,CACT,EAOA,MAAM,uBAAuBlC,EAAW,CACtC,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,sBAAsB,EAC3B,OAAO,GAAG,EACV,GAAG,aAAc9C,CAAS,EAC1B,MAAM,MAAM,EAEf,OAAIyC,GACF,QAAQ,MAAM,uCAAwCA,CAAK,EACpD,IAEFvE,GAAQ,EACjB,CAEA,MAAM+L,EAAYtF,EAAA,EAClB,OAAKsF,EAAU,oBASRA,EAAU,oBAAoB,OAAO+O,GAAMA,EAAG,aAAehZ,CAAS,EAPpE,CACL,CAAE,GAAI,WAAY,KAAM,kBAAmB,mBAAoB,CAAC,UAAW,mBAAoB,gBAAiB,WAAW,EAAG,WAAYA,CAAA,EAC1I,CAAE,GAAI,WAAY,KAAM,iBAAkB,mBAAoB,CAAC,eAAe,EAAG,WAAYA,CAAA,EAC7F,CAAE,GAAI,WAAY,KAAM,aAAc,mBAAoB,CAAC,kBAAkB,EAAG,WAAYA,CAAA,EAC5F,CAAE,GAAI,WAAY,KAAM,aAAc,mBAAoB,CAAC,WAAW,EAAG,WAAYA,CAAA,CAAU,CAIrG,EAGA,MAAM,yBAAyBA,EAAWoI,EAAM6Q,EAAmB,CACjE,GAAIpW,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,sBAAsB,EAC3B,OAAO,CACN,WAAY9C,EACZ,KAAAoI,EACA,mBAAoB6Q,CAAA,CACrB,EACA,SACA,SAEH,GAAIxW,EACF,cAAQ,MAAM,sCAAuCA,CAAK,EACpDA,EAER,OAAOvE,CACT,CAEA,MAAM+L,EAAYtF,EAAA,EACbsF,EAAU,sBACbA,EAAU,oBAAsB,IAElC,MAAMoP,EAAS,CACb,GAAI,OAAO,aACX,WAAYrZ,EACZ,KAAAoI,EACA,mBAAoB6Q,EACpB,WAAY,IAAI,OAAO,aAAY,EAErC,OAAAhP,EAAU,oBAAoB,KAAKoP,CAAM,EACzCzU,GAAaqF,CAAS,EACfoP,CACT,EAGA,MAAM,yBAAyBC,EAAUlR,EAAM6Q,EAAmB,CAChE,GAAIpW,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,sBAAsB,EAC3B,OAAO,CACN,KAAAsF,EACA,mBAAoB6Q,EACpB,WAAY,IAAI,OAAO,aAAY,CACpC,EACA,GAAG,KAAMK,CAAQ,EACjB,SACA,SAEH,GAAI7W,EACF,cAAQ,MAAM,sCAAuCA,CAAK,EACpDA,EAER,OAAOvE,CACT,CAEA,MAAM+L,EAAYtF,EAAA,EAClB,GAAI,CAACsF,EAAU,oBAAqB,OAAO,KAC3C,MAAM/C,EAAQ+C,EAAU,oBAAoB,UAAUmE,GAAKA,EAAE,KAAOkL,CAAQ,EAC5E,OAAIpS,IAAU,GAAW,MACzB+C,EAAU,oBAAoB/C,CAAK,EAAI,CACrC,GAAG+C,EAAU,oBAAoB/C,CAAK,EACtC,KAAAkB,EACA,mBAAoB6Q,EACpB,WAAY,IAAI,OAAO,aAAY,EAErCrU,GAAaqF,CAAS,EACfA,EAAU,oBAAoB/C,CAAK,EAC5C,EAGA,MAAM,yBAAyBoS,EAAU,CACvC,GAAIzW,EAAsB,CACxB,KAAM,CAAE,MAAAJ,CAAA,EAAU,MAAMK,EACrB,KAAK,sBAAsB,EAC3B,SACA,GAAG,KAAMwW,CAAQ,EAEpB,GAAI7W,EACF,cAAQ,MAAM,sCAAuCA,CAAK,EACpDA,EAER,MAAO,EACT,CAEA,MAAMwH,EAAYtF,EAAA,EAClB,OAAKsF,EAAU,sBACfA,EAAU,oBAAsBA,EAAU,oBAAoB,OAAOmE,GAAKA,EAAE,KAAOkL,CAAQ,EAC3F1U,GAAaqF,CAAS,GACf,EACT,EAOA,MAAM,aAAajK,EAAW,CAC5B,GAAI6C,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,YAAY,EACjB,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,aAAc9C,CAAS,EAC1B,GAAG,SAAU,EAAI,EACjB,MAAM,MAAM,EAEf,OAAIyC,GACF,QAAQ,MAAM,6BAA8BA,CAAK,EAC1C,IAEFvE,GAAQ,EACjB,CAGA,OADkByG,EAAA,EACA,WAAa,IAAI,UAAa4U,EAAG,aAAevZ,GAAauZ,EAAG,MAAM,CAC1F,EAGA,MAAM,eAAevZ,EAAWoI,EAAMoR,EAAU,GAAInG,EAAQ,GAAI,CAC9D,GAAIxQ,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,YAAY,EACjB,OAAO,CACN,WAAY9C,EACZ,KAAAoI,EACA,QAAAoR,EACA,MAAAnG,EACA,OAAQ,GACT,EACA,SACA,SAEH,GAAI5Q,EACF,cAAQ,MAAM,4BAA6BA,CAAK,EAC1CA,EAER,OAAOvE,CACT,CAEA,MAAM+L,EAAYtF,EAAA,EACbsF,EAAU,YAAWA,EAAU,UAAY,IAChD,MAAMwP,EAAW,CACf,GAAI,OAAO,aACX,WAAYzZ,EACZ,KAAAoI,EACA,QAAAoR,EACA,MAAAnG,EACA,OAAQ,GACR,WAAY,IAAI,OAAO,cACvB,gBAAiB,EAAC,EAEpB,OAAApJ,EAAU,UAAU,KAAKwP,CAAQ,EACjC7U,GAAaqF,CAAS,EACfwP,CACT,EAGA,MAAM,eAAeC,EAAYja,EAAS,CACxC,GAAIoD,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,YAAY,EACjB,OAAO,CACN,GAAGrD,EACH,WAAY,IAAI,OAAO,aAAY,CACpC,EACA,GAAG,KAAMia,CAAU,EACnB,SACA,SAEH,GAAIjX,EACF,cAAQ,MAAM,4BAA6BA,CAAK,EAC1CA,EAER,OAAOvE,CACT,CAEA,MAAM+L,EAAYtF,EAAA,EAClB,GAAI,CAACsF,EAAU,UAAW,OAAO,KACjC,MAAM/C,EAAQ+C,EAAU,UAAU,UAAUsP,GAAMA,EAAG,KAAOG,CAAU,EACtE,OAAIxS,IAAU,GAAW,MACzB+C,EAAU,UAAU/C,CAAK,EAAI,CAAE,GAAG+C,EAAU,UAAU/C,CAAK,EAAG,GAAGzH,CAAA,EACjEmF,GAAaqF,CAAS,EACfA,EAAU,UAAU/C,CAAK,EAClC,EAGA,MAAM,eAAewS,EAAY,CAC/B,OAAO,KAAK,eAAeA,EAAY,CAAE,OAAQ,GAAO,CAC1D,EAGA,MAAM,gBAAgBA,EAAYC,EAAWC,EAAsBvR,EAAO,OAAQ,CAChF,GAAIxF,EAAsB,CAExB,KAAM,CAAE,KAAMgT,CAAA,EAAa,MAAM/S,EAC9B,KAAK,iBAAiB,EACtB,OAAO,IAAI,EACX,GAAG,eAAgB4W,CAAU,EAC7B,GAAG,aAAcC,CAAS,EAC1B,cAEH,GAAI9D,EAAU,CAEZ,KAAM,CAAE,KAAA3X,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,iBAAiB,EACtB,OAAO,CACN,wBAAyB8W,EACzB,KAAAvR,CAAA,CACD,EACA,GAAG,KAAMwN,EAAS,EAAE,EACpB,SACA,SAEH,GAAIpT,EACF,cAAQ,MAAM,iCAAkCA,CAAK,EAC/CA,EAER,OAAOvE,CACT,KAAO,CAEL,KAAM,CAAE,KAAAA,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,iBAAiB,EACtB,OAAO,CACN,aAAc4W,EACd,WAAYC,EACZ,wBAAyBC,EACzB,KAAAvR,CAAA,CACD,EACA,SACA,SAEH,GAAI5F,EACF,cAAQ,MAAM,kCAAmCA,CAAK,EAChDA,EAER,OAAOvE,CACT,CACF,CAEA,MAAM+L,EAAYtF,EAAA,EACbsF,EAAU,gBAAeA,EAAU,cAAgB,IACxD,MAAMiP,EAAgBjP,EAAU,cAAc,UAC5C7I,GAAKA,EAAE,eAAiBsY,GAActY,EAAE,aAAeuY,CAAA,EAEnD5R,EAAO,CACX,GAAImR,GAAiB,EAAIjP,EAAU,cAAciP,CAAa,EAAE,GAAK,OAAO,aAC5E,aAAcQ,EACd,WAAYC,EACZ,wBAAyBC,EACzB,KAAAvR,EACA,WAAY,IAAI,OAAO,aAAY,EAErC,OAAI6Q,GAAiB,EACnBjP,EAAU,cAAciP,CAAa,EAAInR,EAEzCkC,EAAU,cAAc,KAAKlC,CAAI,EAEnCnD,GAAaqF,CAAS,EACflC,CACT,EAGA,MAAM,iBAAiB2R,EAAY,CACjC,GAAI7W,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,iBAAiB,EACtB,OAAO,GAAG,EACV,GAAG,eAAgB4W,CAAU,EAEhC,OAAIjX,GACF,QAAQ,MAAM,kCAAmCA,CAAK,EAC/C,IAEFvE,GAAQ,EACjB,CAGA,OADkByG,EAAA,EACA,eAAiB,IAAI,OAAOvD,GAAKA,EAAE,eAAiBsY,CAAU,CAClF,EAGA,MAAM,YAAYtZ,EAAW,CAC3B,GAAIyC,EAAsB,CACxB,KAAM,CAAE,KAAA3E,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,WAAW,EAChB,OAAO;AAAA;AAAA;AAAA,SAGP,EACA,GAAG,aAAc1C,CAAS,EAC1B,MAAM,YAAa,CAAE,UAAW,GAAO,EAE1C,OAAIqC,GACF,QAAQ,MAAM,4BAA6BA,CAAK,EACzC,IAEFvE,GAAQ,EACjB,CAGA,OADkByG,EAAA,EACA,UAAY,IAC3B,OAAOkV,GAAKA,EAAE,aAAezZ,CAAS,EACtC,KAAK,CAAClE,EAAGC,IAAM,IAAI,KAAKA,EAAE,SAAS,EAAI,IAAI,KAAKD,EAAE,SAAS,CAAC,CACjE,EAGA,MAAM,cAAckE,EAAWlC,EAAM,CACnC,MAAM4b,EAAU,CACd,WAAY1Z,EACZ,aAAclC,EAAK,WACnB,WAAYA,EAAK,UACjB,MAAOA,EAAK,MACZ,gBAAiBA,EAAK,gBAAkB,GACxC,UAAWA,EAAK,SAChB,MAAOA,EAAK,OAAS,GACrB,eAAgBA,EAAK,eAAiB,EACtC,WAAYA,EAAK,WAAa,IAGhC,GAAI2E,EAAsB,CACxB,KAAM,CAAE,KAAMa,EAAQ,MAAAjB,CAAA,EAAU,MAAMK,EACnC,KAAK,WAAW,EAChB,OAAOgX,CAAO,EACd,SACA,SAEH,GAAIrX,EACF,cAAQ,MAAM,2BAA4BA,CAAK,EACzCA,EAER,OAAOiB,CACT,CAEA,MAAMuG,EAAYtF,EAAA,EACbsF,EAAU,WAAUA,EAAU,SAAW,IAC9C,MAAM8P,EAAa,CACjB,GAAGD,EACH,GAAI,OAAO,aACX,WAAY,IAAI,OAAO,aAAY,EAErC,OAAA7P,EAAU,SAAS,KAAK8P,CAAU,EAClCnV,GAAaqF,CAAS,EACf8P,CACT,EAGA,MAAM,sBAAsB3Z,EAAW,CACrC,MAAM4Z,EAAW,MAAM,KAAK,YAAY5Z,CAAS,EAEjD,IAAIkK,EAAY,EACZ2P,EAAa,EACjB,MAAMC,EAAc,GACd7D,EAAS,GAGT8D,EAAU,GAEhBH,EAAS,QAAQH,GAAK,CACpB,MAAM/S,EAAO,WAAW+S,EAAE,cAAc,GAAK,EACvCO,EAAQ,SAASP,EAAE,KAAK,GAAK,EAEnCvP,GAAaxD,EACbmT,GAAcG,EAGTF,EAAYL,EAAE,UAAU,IAC3BK,EAAYL,EAAE,UAAU,EAAI,CAAE,MAAO,EAAG,KAAM,IAEhDK,EAAYL,EAAE,UAAU,EAAE,OAASO,EACnCF,EAAYL,EAAE,UAAU,EAAE,MAAQ/S,EAG7BqT,EAAQN,EAAE,SAAS,IACtBM,EAAQN,EAAE,SAAS,EAAI,CAAE,KAAMA,EAAE,UAAW,MAAO,EAAG,KAAM,IAE9DM,EAAQN,EAAE,SAAS,EAAE,OAASO,EAC9BD,EAAQN,EAAE,SAAS,EAAE,MAAQ/S,CAC/B,CAAC,EAGD,OAAO,OAAOqT,CAAO,EAClB,KAAK,CAACje,EAAGC,IAAM,IAAI,KAAKA,EAAE,IAAI,EAAI,IAAI,KAAKD,EAAE,IAAI,CAAC,EAClD,QAAQ+W,GAAKoD,EAAO,KAAKpD,CAAC,CAAC,EAE9B,MAAMoH,EAAkBhE,EAAO,OAE/B,MAAO,CACL,UAAA/L,EACA,WAAA2P,EACA,YAAAC,EACA,OAAA7D,EACA,gBAAAgE,EACA,oBAAqBA,EAAkB,EAAI/P,EAAY+P,EAAkB,EAE7E,EAGA,oBAAoBja,EAAWsB,EAAU,CACvC,OAAImB,EACKC,EACJ,QAAQ,aAAa1C,CAAS,EAAE,EAChC,GAAG,mBACF,CAAE,MAAO,IAAK,OAAQ,SAAU,MAAO,YAAa,OAAQ,iBAAiBA,CAAS,IACtFsB,CAAA,EAED,YAEE,IACT,EAGA,GAAGsD,GAUH,MAAM,aAAahF,EAAWI,EAAWka,EAAY,CACnD,MAAM7U,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,kBAAkB,EACvB,OAAO,CACN,WAAYzF,EACZ,WAAYI,EACZ,KAAMka,EAAW,KACjB,YAAaA,EAAW,aAAe,KACvC,KAAMA,EAAW,MAAQ,SACzB,MAAOA,EAAW,OAAS,OAC3B,WAAYA,EAAW,YAAc,EACrC,YAAa,MAAM7U,EAAO,KAAK,WAAW,KAAK,MAAM,GACtD,EACA,SACA,SAEH,GAAIhD,EAAO,MAAMA,EACjB,OAAOvE,CACT,EAKA,MAAM,kBAAkBkC,EAAW,CACjC,MAAMqF,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,kBAAkB,EACvB,OAAO,GAAG,EACV,GAAG,aAAcrF,CAAS,EAC1B,MAAM,aAAc,CAAE,UAAW,GAAM,EACvC,MAAM,OAAQ,CAAE,UAAW,GAAM,EAEpC,GAAIqC,EAAO,MAAMA,EAGjB,MAAM8X,EAAYrc,EAAK,IAAIsc,GAAKA,EAAE,EAAE,EACpC,GAAID,EAAU,OAAS,EAAG,CACxB,KAAM,CAAE,KAAME,EAAQ,MAAOC,GAAe,MAAMjV,EAC/C,KAAK,WAAW,EAChB,OAAO,WAAW,EAClB,GAAG,YAAa8U,CAAS,EACzB,GAAG,cAAe,IAAI,EACtB,GAAG,aAAc,EAAI,EAExB,GAAI,CAACG,GAAcD,EAAQ,CACzB,MAAME,EAAW,GACjBF,EAAO,QAAQG,GAAO,CACpBD,EAASC,EAAI,SAAS,GAAKD,EAASC,EAAI,SAAS,GAAK,GAAK,CAC7D,CAAC,EACD1c,EAAK,QAAQ2c,GAAU,CACrBA,EAAO,eAAiBF,EAASE,EAAO,EAAE,GAAK,CACjD,CAAC,CACH,CACF,CAEA,OAAO3c,CACT,EAKA,MAAM,aAAa4c,EAAUrb,EAAS,CACpC,MAAMgG,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,kBAAkB,EACvB,OAAO,CACN,GAAGhG,EACH,WAAY,IAAI,OAAO,aAAY,CACpC,EACA,GAAG,KAAMqb,CAAQ,EACjB,SACA,SAEH,GAAIrY,EAAO,MAAMA,EACjB,OAAOvE,CACT,EAKA,MAAM,aAAa4c,EAAU,CAC3B,MAAMrV,EAASnB,EAAA,EAGf,MAAMmB,EACH,KAAK,WAAW,EAChB,OAAO,CAAE,UAAW,KAAM,EAC1B,GAAG,YAAaqV,CAAQ,EAG3B,KAAM,CAAE,MAAArY,CAAA,EAAU,MAAMgD,EACrB,KAAK,kBAAkB,EACvB,SACA,GAAG,KAAMqV,CAAQ,EAEpB,GAAIrY,EAAO,MAAMA,EACjB,MAAO,EACT,EAKA,MAAM,eAAerC,EAAW2a,EAAa,CAC3C,MAAMtV,EAASnB,EAAA,EAGT7E,EAAUsb,EAAY,IAAI,CAAC,CAAE,GAAAxb,EAAI,WAAAyb,CAAA,IACrCvV,EACG,KAAK,kBAAkB,EACvB,OAAO,CAAE,WAAAuV,EAAY,eAAgB,OAAO,aAAY,CAAG,EAC3D,GAAG,KAAMzb,CAAE,EACX,GAAG,aAAca,CAAS,GAG/B,aAAM,QAAQ,IAAIX,CAAO,EAClB,EACT,EAKA,MAAM,mBAAmBqb,EAAU9Y,EAAU,GAAI,CAC/C,MAAMyD,EAASnB,EAAA,EACT,CAAE,KAAA+J,EAAO,EAAG,MAAAC,EAAQ,IAAOtM,EAEjC,IAAIwD,EAAQC,EACT,KAAK,WAAW,EAChB,OAAO,IAAK,CAAE,MAAO,QAAS,EAC9B,GAAG,YAAaqV,CAAQ,EACxB,GAAG,cAAe,IAAI,EACtB,GAAG,aAAc,EAAI,EACrB,MAAM,cAAe,CAAE,UAAW,GAAO,EACzC,MAAMzM,EAAOC,GAAQD,EAAO,GAAKC,EAAQ,CAAC,EAE7C,KAAM,CAAE,KAAApQ,EAAM,MAAAuE,EAAO,MAAA8L,CAAA,EAAU,MAAM/I,EAErC,GAAI/C,EAAO,MAAMA,EAEjB,MAAO,CACL,UAAWvE,GAAQ,GACnB,WAAYqQ,GAAS,EACrB,SAAUA,GAAS,IAAMF,EAAO,GAAKC,CAAA,CAEzC,EAKA,MAAM,qBAAqBnF,EAAY2R,EAAU,CAC/C,MAAMrV,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,WAAW,EAChB,OAAO,CAAE,UAAWqV,CAAA,CAAU,EAC9B,GAAG,KAAM3R,CAAU,EACnB,SACA,SAEH,GAAI1G,EAAO,MAAMA,EACjB,OAAOvE,CACT,EAKA,MAAM,oBAAoBkC,EAAW4B,EAAU,GAAI,CACjD,MAAMyD,EAASnB,EAAA,EACT,CAAE,KAAA+J,EAAO,EAAG,MAAAC,EAAQ,IAAOtM,EAE3B,CAAE,KAAA9D,EAAM,MAAAuE,EAAO,MAAA8L,CAAA,EAAU,MAAM9I,EAClC,KAAK,WAAW,EAChB,OAAO,IAAK,CAAE,MAAO,QAAS,EAC9B,GAAG,aAAcrF,CAAS,EAC1B,GAAG,YAAa,IAAI,EACpB,GAAG,cAAe,IAAI,EACtB,GAAG,aAAc,EAAI,EACrB,MAAM,cAAe,CAAE,UAAW,GAAO,EACzC,MAAMiO,EAAOC,GAAQD,EAAO,GAAKC,EAAQ,CAAC,EAE7C,GAAI7L,EAAO,MAAMA,EAEjB,MAAO,CACL,UAAWvE,GAAQ,GACnB,WAAYqQ,GAAS,EACrB,SAAUA,GAAS,IAAMF,EAAO,GAAKC,CAAA,CAEzC,EAOA,MAAM,eAAetO,EAAWI,EAAWuT,EAAMzU,EAAW,GAAI,CAC9D,MAAMuG,EAASnB,EAAA,EACT2W,EAAY,KAAK,MAGjBC,EAAgB,IAAM,KAAO,KAC7B,CAAE,KAAMC,CAAA,EAAc,MAAM1V,EAC/B,KAAK,WAAW,EAChB,OAAO,iBAAiB,EACxB,GAAG,aAAcrF,CAAS,EAC1B,GAAG,cAAe,IAAI,EAEnBgb,EAAeD,GAAW,OAAO,CAACxO,EAAKiO,IAAQjO,GAAOiO,EAAI,iBAAmB,GAAI,CAAC,GAAK,EAC7F,GAAIQ,EAAezH,EAAK,KAAOuH,EAAe,CAC5C,MAAMG,EAAS,KAAK,MAAMD,EAAe,KAAO,IAAI,EAC9CE,EAAU,KAAK,MAAMJ,EAAgB,KAAO,IAAI,EACtD,MAAM,IAAI,MAAM,kCAAkCG,CAAM,IAAIC,CAAO,mCAAmC,CACxG,CAGA,MAAMzH,EAAY,KAAK,MACjB0H,EAAc,IAAI,WAAW,CAAC,EACpC,OAAO,gBAAgBA,CAAW,EAClC,MAAMzH,EAAW,MAAM,KAAKyH,EAAapf,GAAKA,EAAE,SAAS,EAAE,CAAC,EAAE,KAAK,EAAE,EAC/Dqf,EAAM7H,EAAK,KAAK,MAAM,GAAG,EAAE,OAAO,eAAiB,MACnDK,EAAW,GAAGH,CAAS,IAAIC,CAAQ,IAAI0H,CAAG,GAC1CtG,EAAc,GAAGlV,CAAS,IAAII,CAAS,cAAc4T,CAAQ,GAEnE,GAAI,CAEF,KAAM,CAAE,KAAMyH,EAAa,MAAOC,GAAiB,MAAMjW,EAAO,QAC7D,KAAK,mBAAmB,EACxB,OAAOyP,EAAavB,EAAM,CACzB,aAAc,OACd,OAAQ,GACT,EAEH,GAAI+H,EAAc,MAAMA,EAGxB,KAAM,CAAE,KAAMC,CAAA,EAAYlW,EAAO,QAC9B,KAAK,mBAAmB,EACxB,aAAayP,CAAW,EAErBD,EAAc0G,EAAQ,UAGtBC,EAAiB1c,EAAS,WAAa,YAAc,UAAY,WAGjE,CAAE,KAAM2c,EAAU,MAAOC,CAAA,EAAa,MAAMrW,EAC/C,KAAK,WAAW,EAChB,OAAO,CACN,WAAYzF,EACZ,WAAYI,EACZ,KAAMlB,EAAS,MAAQyU,EAAK,KAAK,QAAQ,YAAa,EAAE,EACxD,YAAazU,EAAS,aAAe,KACrC,UAAWyU,EAAK,KAChB,gBAAiBA,EAAK,KACtB,UAAWA,EAAK,KAChB,aAAcuB,EACd,UAAWhW,EAAS,UAAY,KAChC,SAAUA,EAAS,UAAY,UAC/B,KAAMA,EAAS,MAAQ,GACvB,WAAYA,EAAS,YAAc,MACnC,gBAAiB0c,EACjB,cAAe1c,EAAS,cAAgB,KACxC,YAAaA,EAAS,YAAc,KACpC,aAAc,MAAMuG,EAAO,KAAK,WAAW,MAAM,MAAM,GACxD,EACA,SACA,SAEH,GAAIqW,EAAU,MAAMA,EAEpB,MAAMnY,EAAW,KAAK,MAAQsX,EAC9B,OAAAhY,GAAQ,QAAQ,kBAAmB,CACjC,WAAYjD,EACZ,WAAYI,EACZ,UAAWuT,EAAK,KAChB,UAAWA,EAAK,KAChB,SAAAhQ,EACA,QAAS,GACV,EAEM,CAAE,GAAGkY,EAAU,IAAK5G,CAAA,CAC7B,OAASxS,EAAO,CACd,MAAAQ,GAAQ,MAAM,UAAW,CACvB,QAASR,EAAM,QACf,UAAW,iBACX,WAAYzC,EACZ,WAAYI,CAAA,CACb,EACKqC,CACR,CACF,EAKA,MAAM,oBAAoBrC,EAAW,CAAE,SAAAiD,EAAW,KAAM,KAAAgL,EAAO,EAAG,MAAAC,EAAQ,GAAI,gBAAAJ,EAAkB,IAAU,GAAI,CAG5G,IAAI1I,EAFWlB,EAAA,EAGZ,KAAK,WAAW,EAChB,OAAO,IAAK,CAAE,MAAO,QAAS,EAC9B,GAAG,aAAclE,CAAS,EAC1B,GAAG,aAAc,EAAI,EACrB,MAAM,cAAe,CAAE,UAAW,GAAO,EACzC,MAAMiO,EAAOC,GAAQD,EAAO,GAAKC,EAAQ,CAAC,EAExCJ,IACH1I,EAAQA,EAAM,GAAG,cAAe,IAAI,GAGlCnC,GAAYA,IAAa,QAC3BmC,EAAQA,EAAM,GAAG,WAAYnC,CAAQ,GAGvC,KAAM,CAAE,KAAAnF,EAAM,MAAAuE,EAAO,MAAA8L,CAAA,EAAU,MAAM/I,EAErC,GAAI/C,EAAO,MAAMA,EAEjB,MAAO,CACL,UAAWvE,GAAQ,GACnB,WAAYqQ,GAAS,EACrB,SAAUF,EAAO,GAAKC,GAASC,GAAS,GACxC,KAAAF,EACA,MAAAC,CAAA,CAEJ,EAKA,MAAM,YAAYnF,EAAY,CAC5B,MAAM1D,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,WAAW,EAChB,OAAO,GAAG,EACV,GAAG,KAAM0D,CAAU,EACnB,SAEH,GAAI1G,EAAO,MAAMA,EACjB,OAAOvE,CACT,EAKA,MAAM,oBAAoBiL,EAAY,CACpC,MAAM1D,EAASnB,EAAA,EAGT,CAAE,KAAMsW,EAAK,MAAOkB,CAAA,EAAa,MAAMrW,EAC1C,KAAK,WAAW,EAChB,OAAO,wBAAwB,EAC/B,GAAG,KAAM0D,CAAU,EACnB,SAEH,GAAI2S,EAAU,MAAMA,EAGpB,MAAMxE,EAAWsD,EAAI,oBAAsBzR,EAErC,CAAE,KAAAjL,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,WAAW,EAChB,OAAO,GAAG,EACV,GAAG,SAAS6R,CAAQ,0BAA0BA,CAAQ,EAAE,EACxD,MAAM,UAAW,CAAE,UAAW,GAAO,EAExC,GAAI7U,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,EAKA,MAAM,sBAAsB6d,EAAkB/b,EAAWI,EAAWuT,EAAMzU,EAAW,GAAI,CACvF,MAAMuG,EAASnB,EAAA,EAGT,CAAE,KAAM0X,EAAW,MAAOC,CAAA,EAAgB,MAAMxW,EACnD,KAAK,WAAW,EAChB,OAAO,GAAG,EACV,GAAG,KAAMsW,CAAgB,EACzB,SAEH,GAAIE,EAAa,MAAMA,EAGvB,KAAM,CAAE,KAAMC,CAAA,EAAa,MAAMzW,EAC9B,KAAK,WAAW,EAChB,OAAO,SAAS,EAChB,GAAG,SAASsW,CAAgB,0BAA0BA,CAAgB,EAAE,EACxE,MAAM,UAAW,CAAE,UAAW,GAAO,EACrC,MAAM,CAAC,EAEJI,GAAcD,IAAW,CAAC,GAAG,SAAW,GAAK,EAGnD,MAAMzW,EACH,KAAK,WAAW,EAChB,OAAO,CAAE,WAAY,GAAO,EAC5B,GAAG,SAASsW,CAAgB,0BAA0BA,CAAgB,EAAE,EAG3E,MAAMrY,EAAS,MAAM,KAAK,eAAe1D,EAAWI,EAAWuT,EAAM,CACnE,KAAMzU,EAAS,MAAQ8c,EAAU,KACjC,YAAa9c,EAAS,aAAe8c,EAAU,YAC/C,SAAUA,EAAU,SACpB,WAAYA,EAAU,WACtB,KAAMA,EAAU,KAChB,aAAcA,EAAU,cACxB,WAAYA,EAAU,YACvB,EAGK,CAAE,KAAMI,EAAY,MAAO7T,CAAA,EAAgB,MAAM9C,EACpD,KAAK,WAAW,EAChB,OAAO,CACN,QAAS0W,EACT,WAAY,GACZ,mBAAoBJ,CAAA,CACrB,EACA,GAAG,KAAMrY,EAAO,EAAE,EAClB,SACA,SAEH,GAAI6E,EAAa,MAAMA,EAGvB,aAAM9C,EAAO,KAAK,oBAAoB,EAAE,OAAO,CAC7C,YAAa/B,EAAO,GACpB,WAAYtD,EACZ,WAAYJ,EACZ,UAAW,kBACX,QAAS,CAAE,QAASmc,EAAY,UAAWJ,CAAA,EAC3C,aAAc,OACd,SAAU,MAAMtW,EAAO,KAAK,WAAW,MAAM,MAAM,GACpD,EAEM,CAAE,GAAG/B,EAAQ,GAAG0Y,CAAA,CACzB,EAKA,MAAM,eAAejT,EAAY1J,EAAS,CACxC,MAAMgG,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,WAAW,EAChB,OAAO,CACN,KAAMhG,EAAQ,KACd,YAAaA,EAAQ,YACrB,SAAUA,EAAQ,SAClB,WAAYA,EAAQ,WACpB,KAAMA,EAAQ,KACf,EACA,GAAG,KAAM0J,CAAU,EACnB,SACA,SAEH,GAAI1G,EAAO,MAAMA,EACjB,OAAOvE,CACT,EAKA,MAAM,gBAAgBiL,EAAY,CAChC,MAAM1D,EAASnB,EAAA,EACToE,GAAU,MAAMjD,EAAO,KAAK,WAAW,MAAM,MAAM,GAEnD,CAAE,KAAAvH,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,WAAW,EAChB,OAAO,CACN,YAAa,IAAI,OAAO,cACxB,YAAaiD,CAAA,CACd,EACA,GAAG,KAAMS,CAAU,EACnB,SACA,SAEH,GAAI1G,EAAO,MAAMA,EAGjB,aAAMgD,EAAO,KAAK,oBAAoB,EAAE,OAAO,CAC7C,YAAa0D,EACb,WAAYjL,EAAK,WACjB,WAAYA,EAAK,WACjB,UAAW,UACX,aAAc,OACd,QAASwK,CAAA,CACV,EAEMxK,CACT,EAKA,MAAM,gBAAgBiL,EAAY,CAChC,MAAM1D,EAASnB,EAAA,EACToE,GAAU,MAAMjD,EAAO,KAAK,WAAW,MAAM,MAAM,GAEnD,CAAE,KAAAvH,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,WAAW,EAChB,OAAO,CACN,YAAa,KACb,YAAa,KACd,EACA,GAAG,KAAM0D,CAAU,EACnB,SACA,SAEH,GAAI1G,EAAO,MAAMA,EAGjB,aAAMgD,EAAO,KAAK,oBAAoB,EAAE,OAAO,CAC7C,YAAa0D,EACb,WAAYjL,EAAK,WACjB,WAAYA,EAAK,WACjB,UAAW,WACX,aAAc,OACd,QAASwK,CAAA,CACV,EAEMxK,CACT,EAKA,MAAM,0BAA0BiL,EAAY,CAC1C,MAAM1D,EAASnB,EAAA,EAGT,CAAE,KAAMsW,EAAK,MAAOkB,CAAA,EAAa,MAAMrW,EAC1C,KAAK,WAAW,EAChB,OAAO,sCAAsC,EAC7C,GAAG,KAAM0D,CAAU,EACnB,SAEH,GAAI2S,EAAU,MAAMA,EAGhBlB,EAAI,cACN,MAAMnV,EAAO,QACV,KAAK,mBAAmB,EACxB,OAAO,CAACmV,EAAI,YAAY,CAAC,EAI9B,KAAM,CAAE,MAAAnY,CAAA,EAAU,MAAMgD,EACrB,KAAK,WAAW,EAChB,SACA,GAAG,KAAM0D,CAAU,EAEtB,GAAI1G,EAAO,MAAMA,EACjB,MAAO,EACT,EAKA,MAAM,uBAAuB0G,EAAYkT,EAAcC,EAAY,CACjE,MAAM7W,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,WAAW,EAChB,OAAO,CACN,cAAe4W,EACf,YAAaC,CAAA,CACd,EACA,GAAG,KAAMnT,CAAU,EACnB,SACA,SAEH,GAAI1G,EAAO,MAAMA,EAGjB,aAAMgD,EAAO,KAAK,oBAAoB,EAAE,OAAO,CAC7C,YAAa0D,EACb,WAAYjL,EAAK,WACjB,WAAYA,EAAK,WACjB,UAAW,SACX,QAAS,CAAE,cAAeme,EAAc,YAAaC,CAAA,EACrD,aAAc,OACd,SAAU,MAAM7W,EAAO,KAAK,WAAW,MAAM,MAAM,GACpD,EAEMvH,CACT,EAKA,MAAM,2BAA2BiL,EAAY,CAC3C,MAAM1D,EAASnB,EAAA,EAET,CAAE,KAAMsW,CAAA,EAAQ,MAAMnV,EACzB,KAAK,WAAW,EAChB,OAAO,oDAAoD,EAC3D,GAAG,KAAM0D,CAAU,EACnB,SAEG,CAAE,KAAAjL,EAAM,MAAAuE,GAAU,MAAMgD,EAC3B,KAAK,WAAW,EAChB,OAAO,CACN,cAAe,KACf,YAAa,KACd,EACA,GAAG,KAAM0D,CAAU,EACnB,SACA,SAEH,GAAI1G,EAAO,MAAMA,EAGjB,aAAMgD,EAAO,KAAK,oBAAoB,EAAE,OAAO,CAC7C,YAAa0D,EACb,WAAYyR,EAAI,WAChB,WAAYA,EAAI,WAChB,UAAW,WACX,QAAS,CAAE,cAAeA,EAAI,cAAe,YAAaA,EAAI,aAC9D,aAAc,OACd,SAAU,MAAMnV,EAAO,KAAK,WAAW,MAAM,MAAM,GACpD,EAEMvH,CACT,EAKA,MAAM,qBAAqBme,EAAcC,EAAY,CACnD,MAAM7W,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,WAAW,EAChB,OAAO,GAAG,EACV,GAAG,gBAAiB4W,CAAY,EAChC,GAAG,cAAeC,CAAU,EAC5B,GAAG,cAAe,IAAI,EACtB,MAAM,cAAe,CAAE,UAAW,GAAO,EAE5C,GAAI7Z,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,EAKA,MAAM,gBAAgBiL,EAAY,CAChC,MAAM1D,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAAO,IAAI,mBAAoB,CAC3D,cAAe0D,CAAA,CAChB,EAED,GAAI1G,EAAO,MAAMA,EACjB,OAAOvE,CACT,EAKA,MAAM,eAAeiL,EAAYR,EAAQ,CACvC,MAAMlD,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAAO,IAAI,kBAAmB,CAC1D,cAAe0D,EACf,SAAUR,CAAA,CACX,EAED,GAAIlG,EAAO,MAAMA,EACjB,OAAOvE,CACT,EAKA,MAAM,oBAAoB8B,EAAW,CACnC,MAAMyF,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,WAAW,EAChB,OAAO,2BAA2B,EAClC,GAAG,aAAczF,CAAS,EAC1B,GAAG,kBAAmB,SAAS,EAC/B,GAAG,cAAe,IAAI,EACtB,MAAM,cAAe,CAAE,UAAW,GAAO,EAE5C,GAAIyC,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,EAKA,MAAM,gBAAgBkC,EAAWoF,EAAO,CACtC,MAAMC,EAASnB,EAAA,EAET,CAAE,KAAApG,EAAM,MAAAuE,CAAA,EAAU,MAAMgD,EAC3B,KAAK,WAAW,EAChB,OAAO,GAAG,EACV,GAAG,aAAcrF,CAAS,EAC1B,GAAG,aAAc,EAAI,EACrB,GAAG,cAAe,IAAI,EACtB,GAAG,eAAeoF,CAAK,wBAAwBA,CAAK,GAAG,EACvD,MAAM,cAAe,CAAE,UAAW,GAAO,EACzC,MAAM,EAAE,EAEX,GAAI/C,EAAO,MAAMA,EACjB,OAAOvE,GAAQ,EACjB,EAKA,MAAM,kBAAkBiL,EAAYjG,EAAY,aAAc,CAC5D,MAAMuC,EAASnB,EAAA,EAET,CAAE,KAAMsW,CAAA,EAAQ,MAAMnV,EACzB,KAAK,WAAW,EAChB,OAAO,wBAAwB,EAC/B,GAAG,KAAM0D,CAAU,EACnB,SAEEyR,GAEL,MAAMnV,EAAO,KAAK,oBAAoB,EAAE,OAAO,CAC7C,YAAa0D,EACb,WAAYyR,EAAI,WAChB,WAAYA,EAAI,WAChB,UAAA1X,EACA,aAAc,OACd,SAAU,MAAMuC,EAAO,KAAK,WAAW,MAAM,MAAM,GACpD,CACH,CACF,EAeAhE,GAAmB,MAAOI,GAAW,CACnC,GAAIA,GAAUgB,EACZ,GAAI,CACF,MAAMd,GAAmBzE,CAAE,CAC7B,OAASmQ,EAAK,CACZ,QAAQ,MAAM,iCAAkCA,CAAG,CACrD,CAEJ,CAAC,4UChzMK8O,GAAkBC,gBAAA,EAGlBC,GAAmB,CACvB,SAAU,KACV,YAAa,KACb,qBAAsB,KACtB,cAAe,UACf,gBAAiB,UACjB,gBAAiB,YACjB,wBAAyB,GACzB,gBAAiB,YACjB,mBAAoB,KACpB,cAAe,KACf,gBAAiB,EACnB,EAEO,SAASC,GAAiB,CAAE,SAAAC,EAAU,UAAA3c,GAAa,CACxD,KAAM,CAAC4c,EAAUC,CAAW,EAAIC,WAASL,EAAgB,EACnD,CAACM,EAASC,CAAU,EAAIF,WAAS,EAAI,EAE3CG,YAAU,IAAM,CACVjd,EACFkd,EAAald,CAAS,EAGtBmd,EAAA,CAEJ,EAAG,CAACnd,CAAS,CAAC,EAGdid,YAAU,IAAM,CACdG,EAAmBR,CAAQ,CAC7B,EAAG,CAACA,CAAQ,CAAC,EAEb,MAAMM,EAAe,MAAOld,GAAc,CACxC,GAAI,CAGF,GAFAgd,EAAW,EAAI,EAEX,CAACna,EAAsB,CAEzBga,EAAYJ,EAAgB,EAC5BO,EAAW,EAAK,EAChB,MACF,CAEA,KAAM,CAAE,KAAA9e,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,kBAAkB,EACvB,OAAO,GAAG,EACV,GAAG,aAAc9C,CAAS,EAC1B,SAECyC,GAEEA,EAAM,OAAS,WACjB,MAAM4a,EAAsBrd,CAAS,EAErC,QAAQ,MAAM,0BAA2ByC,CAAK,EAEhDoa,EAAYJ,EAAgB,GAE5BI,EAAY,CAAE,GAAGJ,GAAkB,GAAGve,EAAM,CAEhD,OAASuE,EAAO,CACd,QAAQ,MAAM,yBAA0BA,CAAK,EAC7Coa,EAAYJ,EAAgB,CAC9B,SACEO,EAAW,EAAK,CAClB,CACF,EAEMG,EAAuB,SAAY,CACvC,GAAI,CACFH,EAAW,EAAI,EACf,MAAMM,EAAgB,OAAO,SAAS,SAGtC,GAAIA,IAAkB,aAAeA,IAAkB,YAAa,CAClET,EAAYJ,EAAgB,EAC5BO,EAAW,EAAK,EAChB,MACF,CAEA,GAAI,CAACna,EAAsB,CACzBga,EAAYJ,EAAgB,EAC5BO,EAAW,EAAK,EAChB,MACF,CAEA,KAAM,CAAE,KAAA9e,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,IAAI,yBAA0B,CAAE,YAAawa,EAAe,EAE3D7a,GAAS,CAACvE,GAAQA,EAAK,SAAW,EACpC2e,EAAYJ,EAAgB,EAE5BI,EAAY,CAAE,GAAGJ,GAAkB,GAAGve,EAAK,CAAC,EAAG,CAEnD,OAASuE,EAAO,CACd,QAAQ,MAAM,oCAAqCA,CAAK,EACxDoa,EAAYJ,EAAgB,CAC9B,SACEO,EAAW,EAAK,CAClB,CACF,EAEMK,EAAwB,MAAOrd,GAAc,CACjD,GAAI,CACF,KAAM,CAAE,KAAA9B,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,kBAAkB,EACvB,OAAO,CACN,WAAY9C,EACZ,GAAGyc,EAAA,CACJ,EACA,SACA,SAECha,GACF,QAAQ,MAAM,mCAAoCA,CAAK,CAE3D,OAASA,EAAO,CACd,QAAQ,MAAM,kCAAmCA,CAAK,CACxD,CACF,EAEM8a,EAAiBC,cAAY,MAAO/d,GAAY,CACpD,GAAI,CACF,GAAI,CAACoD,EAEH,OAAAga,MAAqB,CAAE,GAAGY,EAAM,GAAGhe,GAAU,EACtC,CAAE,QAAS,IAGpB,GAAI,CAACO,EACH,MAAO,CAAE,QAAS,GAAO,MAAO,iBAIlC,MAAM0d,EAAiB,GACjBC,EAAgB,CACpB,WAAY,cAAe,uBAC3B,gBAAiB,kBAAmB,kBACpC,0BAA2B,kBAAmB,qBAC9C,gBAAiB,mBAGnB,UAAWhiB,KAASgiB,EACdle,EAAQ9D,CAAK,IAAM,SACrB+hB,EAAe/hB,CAAK,EAAI8D,EAAQ9D,CAAK,GAKzC,KAAM,CAAE,KAAMka,EAAU,MAAO+H,CAAA,EAAe,MAAM9a,EACjD,KAAK,kBAAkB,EACvB,OAAO,IAAI,EACX,GAAG,aAAc9C,CAAS,EAC1B,SAEH,GAAI4d,GAAcA,EAAW,OAAS,WAAY,CAEhD,KAAM,CAAE,KAAA1f,EAAM,MAAAuE,GAAU,MAAMK,EAC3B,KAAK,kBAAkB,EACvB,OAAO,CACN,WAAY9C,EACZ,GAAG0d,CAAA,CACJ,EACA,SACA,SAEH,OAAIjb,GACF,QAAQ,MAAM,2BAA4BA,CAAK,EACxC,CAAE,QAAS,GAAO,MAAOA,EAAM,WAGxCoa,EAAY,CAAE,GAAGJ,GAAkB,GAAGve,EAAM,EACrC,CAAE,QAAS,GAAM,KAAAA,GAC1B,CAGA,KAAM,CAAE,KAAAA,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAC3B,KAAK,kBAAkB,EACvB,OAAO4a,CAAc,EACrB,GAAG,aAAc1d,CAAS,EAC1B,SACA,SAEH,OAAIyC,GACF,QAAQ,MAAM,2BAA4BA,CAAK,EACxC,CAAE,QAAS,GAAO,MAAOA,EAAM,WAGxCoa,EAAY,CAAE,GAAGJ,GAAkB,GAAGve,EAAM,EACrC,CAAE,QAAS,GAAM,KAAAA,CAAA,EAC1B,OAASuE,EAAO,CACd,eAAQ,MAAM,2BAA4BA,CAAK,EACxC,CAAE,QAAS,GAAO,MAAOA,EAAM,QACxC,CACF,EAAG,CAACzC,CAAS,CAAC,EAERod,EAAsBR,GAAa,CACvC,MAAMiB,EAAO,SAAS,gBAOtB,GAJAA,EAAK,MAAM,YAAY,kBAAmBjB,EAAS,aAAa,EAChEiB,EAAK,MAAM,YAAY,oBAAqBjB,EAAS,eAAe,EAGhEA,EAAS,YAAa,CACxB,IAAIkB,EAAU,SAAS,cAAc,mBAAmB,EACnDA,IACHA,EAAU,SAAS,cAAc,MAAM,EACvCA,EAAQ,IAAM,OACd,SAAS,KAAK,YAAYA,CAAO,GAEnCA,EAAQ,KAAOlB,EAAS,WAC1B,CAGA,SAAS,MAAQA,EAAS,iBAAmB,WAC/C,EAEMmB,EAAsBP,cAAY,MAAO7J,EAAM3U,IAAS,CAC5D,GAAI,CACF,GAAI,CAAC6D,EAGH,MAAO,CAAE,QAAS,GAAM,IADZ,IAAI,gBAAgB8Q,CAAI,CACZ,EAG1B,MAAMqK,EAAUrK,EAAK,KAAK,MAAM,GAAG,EAAE,MAE/BM,EAAW,YADA,GAAGjU,CAAS,IAAIhB,CAAI,IAAI,KAAK,KAAK,IAAIgf,CAAO,EACzB,GAE/B,CAAE,KAAA9f,EAAM,MAAAuE,CAAA,EAAU,MAAMK,EAAS,QACpC,KAAK,QAAQ,EACb,OAAOmR,EAAUN,EAAM,CACtB,aAAc,OACd,OAAQ,GACT,EAEH,GAAIlR,EACF,eAAQ,MAAM,yBAA0BA,CAAK,EACtC,CAAE,QAAS,GAAO,MAAOA,EAAM,SAGxC,KAAM,CAAE,KAAM,CAAE,UAAAwb,CAAA,GAAgBnb,EAAS,QACtC,KAAK,QAAQ,EACb,aAAamR,CAAQ,EAExB,MAAO,CAAE,QAAS,GAAM,IAAKgK,CAAA,CAC/B,OAASxb,EAAO,CACd,eAAQ,MAAM,gCAAiCA,CAAK,EAC7C,CAAE,QAAS,GAAO,MAAOA,EAAM,QACxC,CACF,EAAG,CAACzC,CAAS,CAAC,EAERke,EAAkBV,cAAY,IAAM,CACpCxd,EACFkd,EAAald,CAAS,EAEtBmd,EAAA,CAEJ,EAAG,CAACnd,CAAS,CAAC,EAERpB,EAAQuf,UAAQ,KAAO,CAC3B,SAAAvB,EACA,QAAAG,EACA,eAAAQ,EACA,oBAAAQ,EACA,gBAAAG,CAAA,GACE,CAACtB,EAAUG,EAASQ,EAAgBQ,EAAqBG,CAAe,CAAC,EAE7E,OACEE,MAAC7B,GAAgB,SAAhB,CAAyB,MAAA3d,EACvB,SAAA+d,CAAA,CACH,CAEJ,CAEO,SAAS0B,IAAc,CAC5B,MAAMlb,EAAUmb,aAAW/B,EAAe,EAC1C,GAAI,CAACpZ,EACH,MAAM,IAAI,MAAM,oDAAoD,EAEtE,OAAOA,CACT,CC9RA,MAAMob,GAAe/B,gBAAA,EAEd,SAASgC,GAAc,CAAE,SAAA7B,GAAY,CAC1C,KAAM,CAAC8B,EAAOC,CAAQ,EAAI5B,WAAS,IAAM,CAEvC,MAAM6B,EAAQ,aAAa,QAAQ,iBAAiB,EACpD,OAAIA,IAAU,SAAWA,IAAU,OAC1BA,EAGL,OAAO,YAAc,OAAO,WAAW,+BAA+B,EAAE,QACnE,QAEF,MACT,CAAC,EAGD1B,YAAU,IAAM,CACd,SAAS,gBAAgB,aAAa,aAAcwB,CAAK,EACzD,aAAa,QAAQ,kBAAmBA,CAAK,CAC/C,EAAG,CAACA,CAAK,CAAC,EAGVxB,YAAU,IAAM,CACd,MAAM2B,EAAa,OAAO,WAAW,+BAA+B,EAC9DC,EAAgBC,GAAM,CAEZ,aAAa,QAAQ,iBAAiB,GAElDJ,EAASI,EAAE,QAAU,QAAU,MAAM,CAEzC,EAEA,OAAAF,EAAW,iBAAiB,SAAUC,CAAY,EAC3C,IAAMD,EAAW,oBAAoB,SAAUC,CAAY,CACpE,EAAG,EAAE,EAEL,MAAME,EAAcvB,cAAY,IAAM,CACpCkB,EAASjB,GAAQA,IAAS,OAAS,QAAU,MAAM,CACrD,EAAG,EAAE,EAEC7e,EAAQuf,UAAQ,KAAO,CAC3B,MAAAM,EACA,SAAAC,EACA,YAAAK,CAAA,GACE,CAACN,EAAOM,CAAW,CAAC,EAExB,OACEX,MAACG,GAAa,SAAb,CAAsB,MAAA3f,EACpB,SAAA+d,CAAA,CACH,CAEJ,CAEO,SAASqC,IAAW,CACzB,MAAM7b,EAAUmb,aAAWC,EAAY,EACvC,GAAI,CAACpb,EACH,MAAM,IAAI,MAAM,8CAA8C,EAEhE,OAAOA,CACT,CClDA,MAAM8b,GAAezC,gBAAc,IAAI,EAEhC,SAAS0C,GAAc,CAAE,SAAAvC,GAAY,CAC1C,KAAM,CAACwC,EAAOC,CAAQ,EAAItC,WAAS,IAAI,EACjC,CAACuC,EAAOC,CAAQ,EAAIxC,WAAS,EAAE,EAE/ByC,EAAY/B,cAAY,IAAM,CAClC4B,EAAS,IAAI,CACf,EAAG,EAAE,EAECI,EAAYhC,cAAY,CAAClc,EAAStC,EAAO,OAAQ2E,EAAW,MAAS,CAEzE,GAAIwb,EAAO,CACTG,EAAS7B,GAAQ,CAAC,GAAGA,EAAM,CAAE,QAAAnc,EAAS,KAAAtC,EAAM,SAAA2E,CAAA,CAAU,CAAC,EACvD,MACF,CAEAyb,EAAS,CAAE,QAAA9d,EAAS,KAAAtC,EAAM,SAAA2E,CAAA,CAAU,EAGhCA,EAAW,GACb,WAAW,IAAM,CACfyb,EAAS,IAAI,CACf,EAAGzb,CAAQ,CAEf,EAAG,CAACwb,CAAK,CAAC,EAGJM,EAAejC,cAAY,IAAM,CACrC,GAAI6B,EAAM,OAAS,EAAG,CACpB,KAAM,CAACK,EAAM,GAAGC,CAAI,EAAIN,EACxBC,EAASK,CAAI,EACb,WAAW,IAAM,CACfH,EAAUE,EAAK,QAASA,EAAK,KAAMA,EAAK,QAAQ,CAClD,EAAG,GAAG,CACR,CACF,EAAG,CAACL,EAAOG,CAAS,CAAC,EAGfI,EAAcpC,cAAY,IAAM,CACpC+B,EAAA,EACAE,EAAA,CACF,EAAG,CAACF,EAAWE,CAAY,CAAC,EAGtBI,EAAUrC,cAAY,CAAClc,EAASqC,IAAa,CACjD6b,EAAUle,EAAS,UAAWqC,CAAQ,CACxC,EAAG,CAAC6b,CAAS,CAAC,EAER/c,EAAQ+a,cAAY,CAAClc,EAASqC,IAAa,CAC/C6b,EAAUle,EAAS,QAASqC,CAAQ,CACtC,EAAG,CAAC6b,CAAS,CAAC,EAERM,EAAUtC,cAAY,CAAClc,EAASqC,IAAa,CACjD6b,EAAUle,EAAS,UAAWqC,CAAQ,CACxC,EAAG,CAAC6b,CAAS,CAAC,EAERO,EAAOvC,cAAY,CAAClc,EAASqC,IAAa,CAC9C6b,EAAUle,EAAS,OAAQqC,CAAQ,CACrC,EAAG,CAAC6b,CAAS,CAAC,EAER5gB,EAAQuf,UAAQ,KAAO,CAC3B,MAAAgB,EACA,UAAAK,EACA,UAAWI,EACX,QAAAC,EACA,MAAApd,EACA,QAAAqd,EACA,KAAAC,CAAA,GACE,CAACZ,EAAOK,EAAWI,EAAaC,EAASpd,EAAOqd,EAASC,CAAI,CAAC,EAElE,OACEC,OAACf,GAAa,SAAb,CAAsB,MAAArgB,EACpB,UAAA+d,EACAwC,GACCf,MAAC,OAAI,UAAU,kBACb,eAAC,OAAI,UAAW,SAASe,EAAM,IAAI,GAAI,QAASS,EAC7C,SAAAT,EAAM,QACT,EACF,GAEJ,CAEJ,CC7FA,SAAwBc,GAAK,CAAE,UAAAC,EAAY,GAAI,cAAAC,EAAgB,IAAS,CACtE,KAAM,CAAE,SAAAvD,CAAA,EAAayB,GAAA,EAErB,OACE2B,OAAC,OAAI,UAAW,YAAYE,CAAS,GAClC,UAAAtD,EAAS,SACRwB,MAAC,OACC,IAAKxB,EAAS,SACd,IAAKA,EAAS,iBAAmB,OACjC,UAAU,gBAGZoD,OAAC,OAAI,UAAU,OACZ,UAAApD,EAAS,iBAAmB,QAC7BwB,MAAC,QAAK,gBAAI,GACZ,EAGD+B,GAAiB,CAACvD,EAAS,+BACzB,OAAI,UAAU,aAAa,gCAE5B,GAEJ,CAEJ,CCrBA,SAASwD,GAAoBC,EAAK,CAChC,GAAI,CAACA,EAAK,MAAO,CAAE,MAAO,EAAG,MAAO,GAAI,MAAO,IAC/C,IAAIC,EAAQ,EAOZ,OANID,EAAI,QAAU,GAAGC,IACjBD,EAAI,QAAU,GAAGC,IACjB,QAAQ,KAAKD,CAAG,GAAK,QAAQ,KAAKA,CAAG,GAAGC,IACxC,KAAK,KAAKD,CAAG,GAAGC,IAChB,eAAe,KAAKD,CAAG,GAAGC,IAE1BA,GAAS,EAAU,CAAE,MAAO,EAAG,MAAO,OAAQ,MAAO,qBACrDA,GAAS,EAAU,CAAE,MAAO,EAAG,MAAO,OAAQ,MAAO,wBACrDA,GAAS,EAAU,CAAE,MAAO,EAAG,MAAO,OAAQ,MAAO,uBACrDA,GAAS,EAAU,CAAE,MAAO,EAAG,MAAO,SAAU,MAAO,uBACpD,CAAE,MAAO,EAAG,MAAO,cAAe,MAAO,sBAClD,CAGA,SAASC,GAAaC,EAAS,EAAG,CAChC,MAAMzI,EAAQ,mCACRjX,EAAQ,IAAI,YAAY0f,CAAM,EACpC,cAAO,gBAAgB1f,CAAK,EACrB,MAAM,KAAKA,EAAO0T,GAAKuD,EAAMvD,EAAIuD,EAAM,MAAM,CAAC,EAAE,KAAK,EAAE,CAChE,CAGA,SAAS0I,GAAa5S,EAAO,CAC3B,MAAO,6BAA6B,KAAKA,CAAK,CAChD,CAGA,SAAS6S,GAAc,CAAE,MAAAC,EAAO,YAAAC,GAAe,CAC7C,OACExC,MAAC,OAAI,UAAU,4BACZ,WAAM,IAAI,CAACyC,EAAO7V,IAAM,CACvB,MAAM8V,EAAU9V,EAAI,EACd+V,EAAWD,IAAYF,EACvBI,EAAcF,EAAUF,EAC9B,OACEZ,OAAC,OAAY,UAAU,0BACpB,UAAAhV,EAAI,SACF,OAAI,UAAW,wBAAwBgW,EAAc,YAAc,EAAE,GAAI,QAE3E,OAAI,UAAW,0BAA0BD,EAAW,SAAW,EAAE,IAAIC,EAAc,YAAc,EAAE,GACjG,SAAAA,EAAc5C,MAAC6C,IAAM,KAAM,GAAI,EAAKH,EACvC,EACA1C,MAAC,QAAK,UAAW,yBAAyB2C,EAAW,SAAW,EAAE,IAAIC,EAAc,YAAc,EAAE,GACjG,SAAAH,CAAA,CACH,IATQ7V,CAUV,CAEJ,CAAC,EACH,CAEJ,CAGA,SAASkW,GAAc,CAAE,MAAAtiB,EAAO,SAAAuiB,EAAU,YAAAC,EAAa,UAAAC,EAAW,UAAAC,EAAW,aAAAC,GAAgB,CAC3F,KAAM,CAACC,EAASC,CAAU,EAAI3E,WAAS,EAAK,EACtC4E,EAAWtB,GAAoBxhB,CAAK,EAE1C,OACEohB,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,OAAI,UAAU,yBACb,UAAA5B,MAAC,SACC,KAAMoD,EAAU,OAAS,WACzB,MAAA5iB,EACA,SAAAuiB,EACA,YAAaC,GAAe,WAC5B,UAAAC,EACA,UAAAC,CAAA,GAEFlD,MAAC,UACC,KAAK,SACL,UAAU,kBACV,QAAS,IAAMqD,EAAW,CAACD,CAAO,EAClC,SAAU,GACV,aAAYA,EAAU,gBAAkB,gBAEvC,SAAAA,QAAWG,GAAA,CAAO,KAAM,GAAI,EAAKvD,MAACwD,GAAA,CAAI,KAAM,GAAI,GACnD,EACF,EACCL,GAAgB3iB,GACfohB,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,OAAI,UAAU,wBACb,SAAAA,MAAC,OACC,UAAU,yBACV,MAAO,CACL,MAAO,GAAIsD,EAAS,MAAQ,EAAK,GAAG,IACpC,WAAYA,EAAS,MACvB,GAEJ,EACAtD,MAAC,QAAK,UAAU,0BAA0B,MAAO,CAAE,MAAOsD,EAAS,OAChE,SAAAA,EAAS,MACZ,GACF,GAEJ,CAEJ,CAEA,SAAwBG,GAAS,CAAE,gBAAAC,EAAiB,cAAAC,EAAe,YAAAC,GAAe,CAChF,KAAM,CAAChkB,EAAMikB,CAAO,EAAInF,WAAS,IAAI,EAG/B,CAACzN,EAAa6S,CAAc,EAAIpF,WAAS,EAAE,EAC3C,CAAC9M,EAASmS,CAAU,EAAIrF,WAAS,IAAI,EACrC,CAAC1N,EAAKgT,CAAM,EAAItF,WAAS,EAAE,EAC3B,CAACC,EAASC,CAAU,EAAIF,WAAS,EAAK,EACtC,CAACuF,EAAUC,CAAW,EAAIxF,WAAS,EAAE,EACrC,CAACyF,EAAcC,CAAe,EAAI1F,WAAS,IAAI,EAC/C,CAAC2F,EAAaC,CAAc,EAAI5F,WAAS,IAAM,CACnD,GAAI,CAAE,OAAO,aAAa,QAAQ,wBAAwB,GAAK,EAAG,MAAQ,CAAE,MAAO,EAAG,CACxF,CAAC,EAGK6F,EAAqBC,SAAO,IAAI,EAChCC,EAAsBD,SAAO,IAAI,EAGvC3F,YAAU,IACD,IAAM,CACP0F,EAAmB,SAAS,aAAaA,EAAmB,OAAO,EACnEE,EAAoB,SAAS,aAAaA,EAAoB,OAAO,CAC3E,EACC,EAAE,EAGL,KAAM,CAAChV,EAAOiV,CAAQ,EAAIhG,WAAS,EAAE,EAC/B,CAAChP,EAAUiV,EAAW,EAAIjG,WAAS,EAAE,EAGrC,CAACkG,GAAUC,EAAW,EAAInG,WAAS,CAAC,EACpC,CAACoG,EAAaC,CAAc,EAAIrG,WAAS,IAAI,EAC7C,CAACsG,EAAYC,EAAa,EAAIvG,WAAS,EAAE,EACzC,CAACwG,EAAUC,CAAW,EAAIzG,WAAS,EAAE,EACrC,CAAC0G,EAAWC,CAAY,EAAI3G,WAAS,EAAE,EACvC,CAAC4G,EAAcC,CAAe,EAAI7G,WAAS,EAAE,EAC7C,CAAC8G,GAAaC,CAAc,EAAI/G,WAAS,EAAK,EAG9C,CAACgH,EAAcC,CAAe,EAAIjH,WAAS,CAAC,EAC5C,CAACkH,GAAqBC,EAAsB,EAAInH,WAAS,EAAE,EAC3D,CAACoH,EAAcC,CAAe,EAAIrH,WAAS,EAAE,EAC7C,CAACsH,GAAeC,EAAgB,EAAIvH,WAAS,EAAE,EAC/C,CAACwH,GAAkBC,EAAmB,EAAIzH,WAAS,EAAE,EACrD,CAAC0H,GAAgBC,EAAiB,EAAI3H,WAAS,IAAI,EAGnD4H,GAA2B9lB,GAAU,CACzC,MAAM+lB,GAAU/lB,EAAM,cAAc,QAAQ,aAAc,EAAE,EAAE,MAAM,EAAG,EAAE,EACzEsjB,EAAeyC,EAAO,CACxB,EAGMC,EAAoB,SAAY,CACpC,GAAIvV,EAAY,OAAS,EAAG,CAC1B2S,EAAY,qBAAsB,OAAO,EACzC,MACF,CAEAhF,EAAW,EAAI,EACf,GAAI,CACF,MAAM6H,EAAe,MAAMvnB,EAAG,iBAAiB+R,CAAW,EACtDwV,EACF1C,EAAW0C,CAAY,GAEvB7C,EAAY,uBAAwB,OAAO,EAC3CE,EAAe,EAAE,EAErB,MAAc,CACZF,EAAY,sBAAuB,OAAO,CAC5C,SACEhF,EAAW,EAAK,CAClB,CACF,EAGM8H,GAAY,MAAOC,GAAgB,CACvC,GAAIA,EAAY,SAAW,EAE3B,CAAA/H,EAAW,EAAI,EACfsF,EAAY,EAAE,EAEd,GAAI,CAEF,MAAM5e,GAAS,MAAMpG,EAAG,sBAAsBynB,EAAa/U,EAAQ,IAAI,EAEvE,GAAItM,GAAO,YAAa,CACtB4e,EAAY,OAAO,EACnBN,EAAY,6CAA8C,OAAO,EAC7DW,EAAmB,SAAS,aAAaA,EAAmB,OAAO,EACvEA,EAAmB,QAAU,WAAW,IAAM,CAC5CP,EAAO,EAAE,EACTE,EAAY,EAAE,CAChB,EAAG,GAAG,EACN,MACF,CAEA,GAAI5e,GAAO,SAAWA,GAAO,QAAS,CACpC8e,EAAgB9e,GAAO,OAAO,EAC9B,MACF,CAIA,GAAIA,GAAO,MAAO,CAChB,MAAMshB,GAAkB,MAAM1nB,EAAG,0BAA0BynB,EAAa/U,EAAQ,EAAE,EAClF,GAAIgV,GAAiB,CACnBxC,EAAgBwC,EAAe,EAC/B,MACF,CACF,CAEAhD,EAAY,cAAe,OAAO,EAClCI,EAAO,EAAE,CACX,MAAc,CAEZ,GAAI,CACF,MAAM4C,GAAkB,MAAM1nB,EAAG,0BAA0BynB,EAAa/U,EAAQ,EAAE,EAClF,GAAIgV,GAAiB,CACnBxC,EAAgBwC,EAAe,EAC/B,MACF,CACF,MAAsB,CAEtB,CACAhD,EAAY,qBAAsB,OAAO,EACzCI,EAAO,EAAE,CACX,SACEpF,EAAW,EAAK,CAClB,EACF,EAGMiI,GAA0B,IAAM,CACpC,GAAI,CAACxC,EAAY,OAAQ,CACvBT,EAAY,8BAA+B,OAAO,EAClD,MACF,CACA,GAAI,CAAE,aAAa,QAAQ,yBAA0BS,EAAY,MAAM,CAAE,MAAQ,CAAe,CAChGX,EAAgBS,EAAcE,EAAY,MAAM,CAClD,EAGMyC,GAAmBrf,GAAQ,CAC/B,GAAIuJ,EAAI,OAAS,GAAK,CAAC2N,EAAS,CAC9B,MAAMoI,GAAS/V,EAAMvJ,EACrBuc,EAAO+C,EAAM,EACb7C,EAAY,EAAE,EACV6C,GAAO,SAAW,IAEhBtC,EAAoB,SAAS,aAAaA,EAAoB,OAAO,EACzEA,EAAoB,QAAU,WAAW,IAAMiC,GAAUK,EAAM,EAAG,GAAG,EAEzE,CACF,EAEMC,GAAkB,IAAM,CACvBrI,IACHqF,EAAO3E,GAAQA,EAAK,MAAM,EAAG,EAAE,CAAC,EAChC6E,EAAY,EAAE,EAElB,EAGM+C,GAAsB,IAAM,CAChClD,EAAW,IAAI,EACfC,EAAO,EAAE,EACTE,EAAY,EAAE,CAChB,EAGMgD,GAAqB,IAAM,CAC/B,GAAI,CAACzX,EAAM,QAAU,CAACC,EAAS,OAAQ,CACrCkU,EAAY,2BAA4B,OAAO,EAC/C,MACF,CACAD,EAAclU,EAAOC,CAAQ,CAC/B,EAGMyX,GAAiB,SAAY,CACjC,GAAIlW,EAAY,OAAS,EAAG,CAC1B2S,EAAY,qBAAsB,OAAO,EACzC,MACF,CAEAhF,EAAW,EAAI,EACf,GAAI,CACF,MAAM6H,EAAe,MAAMvnB,EAAG,iBAAiB+R,CAAW,EACtDwV,GACF1B,EAAe0B,CAAY,EAC3B5B,GAAY,CAAC,IAEbjB,EAAY,uBAAwB,OAAO,EAC3CE,EAAe,EAAE,EAErB,MAAc,CACZF,EAAY,sBAAuB,OAAO,CAC5C,SACEhF,EAAW,EAAK,CAClB,CACF,EAGMwI,GAAmB,SAAY,CACnC,GAAI,CAACpC,EAAW,OAAQ,CACtBpB,EAAY,oBAAqB,OAAO,EACxC,MACF,CAEAhF,EAAW,EAAI,EACf,GAAI,CAEF,KAAM,CAAE,KAAA9e,EAAM,MAAAuE,EAAA,EAAU,MAAMK,EAAS,IAAI,qBAAsB,CAC/D,WAAYogB,EAAY,GACxB,KAAME,EAAW,MAAK,CACvB,EAED,GAAI3gB,GAAO,MAAMA,GAEbvE,IAAS,GACX+kB,GAAY,CAAC,GAEbjB,EAAY,sBAAuB,OAAO,EAC1CqB,GAAc,EAAE,EAEpB,MAAc,CACZrB,EAAY,uBAAwB,OAAO,CAC7C,SACEhF,EAAW,EAAK,CAClB,CACF,EAGMyI,GAAmB,SAAY,CACnC,GAAI,CAAA1I,EACJ,IAAI,CAACuG,EAAS,OAAQ,CACpBtB,EAAY,kBAAmB,OAAO,EACtC,MACF,CACA,GAAI,CAACwB,EAAU,QAAU,CAAC/C,GAAa+C,CAAS,EAAG,CACjDxB,EAAY,8BAA+B,OAAO,EAClD,MACF,CACA,GAAI0B,EAAa,OAAS,EAAG,CAC3B1B,EAAY,iCAAkC,OAAO,EACrD,MACF,CAEAhF,EAAW,EAAI,EACf,GAAI,CACF,MAAM0I,EAAkBlC,EAAU,cAAc,OAG1C,CAAE,KAAMmC,GAAU,MAAOC,IAAc,MAAM9iB,EAAS,KAAK,OAAO,CACtE,MAAO4iB,EACP,SAAUhC,CAAA,CACX,EAED,IAAIhb,GAMJ,GAH0Bkd,IAAW,SAAS,SAAS,oBAAoB,GACxED,IAAU,MAAQA,GAAS,KAAK,YAAY,SAAW,EAEnC,CAErB,KAAM,CAAE,KAAME,GAAY,MAAOC,IAAgB,MAAMhjB,EAAS,KAAK,mBAAmB,CACtF,MAAO4iB,EACP,SAAUhC,CAAA,CACX,EAED,GAAIoC,GAAa,CAEf9D,EAAY,sEAAuE,OAAO,EAC1FhF,EAAW,EAAK,EAChB,MACF,CAEAtU,GAASmd,GAAW,KAAK,GAGzB,KAAM,CAAE,KAAME,IAAuB,MAAMjjB,EACxC,KAAK,gBAAgB,EACrB,OAAO,YAAY,EACnB,GAAG,UAAW4F,EAAM,EACpB,GAAG,aAAcwa,EAAY,EAAE,EAC/B,cAEH,GAAI6C,GAAoB,CAClBA,GAAmB,SAAW,UAChC/D,EAAY,wDAAyD,SAAS,EAC9E,WAAW,IAAM,OAAO,SAAS,SAAU,GAAI,GACtC+D,GAAmB,SAAW,WACvC/D,EAAY,0CAA2C,OAAO,EAC9D,MAAMlf,EAAS,KAAK,YAEpBkf,EAAY,0DAA2D,OAAO,EAC9E,MAAMlf,EAAS,KAAK,WAEtB,MACF,CAGA,KAAM,CAAE,MAAOkjB,IAAY,MAAMljB,EAC9B,KAAK,gBAAgB,EACrB,OAAO,CACN,QAAS4F,GACT,WAAYwa,EAAY,GACxB,KAAM,SACN,OAAQ,UACT,EAEH,GAAI8C,GACF,cAAQ,MAAM,kCAAmCA,EAAO,EACxD,MAAMljB,EAAS,KAAK,UACd,IAAI,MAAM,+BAA+B,EAIjD,MAAMA,EAAS,KAAK,UACpB+gB,EAAe,EAAI,CAErB,SAAW+B,GAET,MAAMA,GAED,CAGL,GADAld,GAASid,GAAS,MAAM,GACpB,CAACjd,GAAQ,MAAM,IAAI,MAAM,uBAAuB,EAGpD,KAAM,CAAE,MAAOud,IAAc,MAAMnjB,EAChC,KAAK,OAAO,EACZ,OAAO,CACN,GAAI4F,GACJ,MAAOgd,EACP,cAAe,2BACf,KAAMpC,EAAS,OACf,WAAYJ,EAAY,GACxB,KAAM,SACN,UAAW,GACZ,EAEH,GAAI+C,GAAW,MAAMA,GAGrB,KAAM,CAAE,MAAOD,IAAY,MAAMljB,EAC9B,KAAK,gBAAgB,EACrB,OAAO,CACN,QAAS4F,GACT,WAAYwa,EAAY,GACxB,KAAM,SACN,OAAQ,UACT,EAEH,GAAI8C,GACF,cAAQ,MAAM,kCAAmCA,EAAO,EAClD,IAAI,MAAM,+BAA+B,EAIjD,MAAMljB,EAAS,KAAK,UACpB+gB,EAAe,EAAI,CACrB,EAEF,OAASpW,EAAK,CACZ,QAAQ,MAAM,cAAeA,CAAG,EAChCuU,EAAYvU,EAAI,SAAW,yBAA0B,OAAO,CAC9D,SACEuP,EAAW,EAAK,CAClB,EACF,EAGMkJ,GAAwB,SAAY,CACxC,GAAI,CAAAnJ,EACJ,IAAI,CAACmH,EAAa,OAAQ,CACxBlC,EAAY,kBAAmB,OAAO,EACtC,MACF,CACA,GAAI,CAACoC,GAAc,QAAU,CAAC3D,GAAa2D,EAAa,EAAG,CACzDpC,EAAY,8BAA+B,OAAO,EAClD,MACF,CACA,GAAIsC,GAAiB,OAAS,EAAG,CAC/BtC,EAAY,iCAAkC,OAAO,EACrD,MACF,CAEAhF,EAAW,EAAI,EACf,GAAI,CACF,MAAM0I,EAAkBtB,GAAc,cAAc,OAC9C+B,GAAuB5F,GAAa,CAAC,EACrC6F,GAAsB7F,GAAa,CAAC,EAGpC,CAAE,KAAMoF,GAAU,MAAOC,IAAc,MAAM9iB,EAAS,KAAK,OAAO,CACtE,MAAO4iB,EACP,SAAUpB,EAAA,CACX,EAED,GAAIsB,GAAW,CACb,GAAIA,GAAU,SAAS,SAAS,oBAAoB,EAClD5D,EAAY,8DAA+D,OAAO,MAElF,OAAM4D,GAER,MACF,CAEA,MAAMld,GAASid,GAAS,MAAM,GAC9B,GAAI,CAACjd,GAAQ,MAAM,IAAI,MAAM,0BAA0B,EAGvD,KAAM,CAAE,KAAM2d,GAAa,MAAOC,EAAA,EAAiB,MAAMxjB,EACtD,KAAK,WAAW,EAChB,OAAO,CACN,KAAMkhB,GAAoB,OAC1B,KAAMmC,GACN,YAAaC,GACb,kBAAmB,OACnB,cAAe1d,EAAA,CAChB,EACA,SACA,SAEH,GAAI4d,GACF,cAAQ,MAAM,0BAA2BA,EAAY,EAC/C,IAAI,MAAM,6CAA6C,EAI/D,KAAM,CAAE,MAAOL,IAAc,MAAMnjB,EAChC,KAAK,OAAO,EACZ,OAAO,CACN,GAAI4F,GACJ,MAAOgd,EACP,cAAe,2BACf,KAAMxB,EAAa,OACnB,WAAYmC,GAAY,GACxB,KAAM,QACN,UAAW,GACZ,EAEH,GAAIJ,GACF,cAAQ,MAAM,qBAAsBA,EAAS,EACvC,IAAI,MAAM,+BAA+B,EAIjD,KAAM,CAAE,MAAOD,IAAY,MAAMljB,EAC9B,KAAK,gBAAgB,EACrB,OAAO,CACN,QAAS4F,GACT,WAAY2d,GAAY,GACxB,KAAM,QACN,aAAc,gBACd,OAAQ,SACT,EAEH,GAAIL,GACF,cAAQ,MAAM,2BAA4BA,EAAO,EAC3C,IAAI,MAAM,mCAAmC,EAIrDvB,GAAkB,CAChB,KAAM4B,GAAY,KAClB,KAAMF,GACN,WAAYC,EAAA,CACb,EACDrC,EAAgB,CAAC,CAEnB,OAAStW,EAAK,CACZ,QAAQ,MAAM,sBAAuBA,CAAG,EACxCuU,EAAYvU,EAAI,SAAW,yBAA0B,OAAO,CAC9D,SACEuP,EAAW,EAAK,CAClB,EACF,EAGMuJ,GAAiB,IAAM,CAC3BtD,GAAY,CAAC,EACbE,EAAe,IAAI,EACnBE,GAAc,EAAE,EAChBE,EAAY,EAAE,EACdE,EAAa,EAAE,EACfE,EAAgB,EAAE,EAClBE,EAAe,EAAK,EACpB3B,EAAe,EAAE,CACnB,EAGMsE,GAAqB,IAAM,CAC/BzC,EAAgB,CAAC,EACjBE,GAAuB,EAAE,EACzBE,EAAgB,EAAE,EAClBE,GAAiB,EAAE,EACnBE,GAAoB,EAAE,EACtBE,GAAkB,IAAI,CACxB,EAGA,GAAIzmB,IAAS,KACX,aACG,OAAI,UAAU,kBACb,SAAAgiB,OAAC,OAAI,UAAU,gCACb,UAAA5B,MAAC6B,GAAA,CAAK,UAAU,aAAa,cAAe,GAAO,EAEnDD,OAAC,OAAI,UAAU,iCACb,UAAAA,OAAC,UACC,UAAU,yBACV,QAAS,IAAMiC,EAAQ,SAAS,EAEhC,UAAA7D,MAAC,QAAK,UAAU,kBAAkB,eAACqI,GAAA,CAAQ,KAAM,GAAI,EAAE,EACvDrI,MAAC,QAAK,UAAU,mBAAmB,mBAAO,EAC1CA,MAAC,QAAK,UAAU,kBAAkB,6BAAiB,KAGrD4B,OAAC,UACC,UAAU,wBACV,QAAS,IAAMiC,EAAQ,QAAQ,EAE/B,UAAA7D,MAAC,QAAK,UAAU,kBAAkB,eAACsI,GAAA,CAAU,KAAM,GAAI,EAAE,EACzDtI,MAAC,QAAK,UAAU,mBAAmB,kBAAM,EACzCA,MAAC,QAAK,UAAU,kBAAkB,gCAAoB,IACxD,EACF,GACF,EACF,EAKJ,GAAIpgB,IAAS,UAEX,OAAIukB,QAEC,OAAI,UAAU,kBACb,SAAAvC,OAAC,OAAI,UAAU,6BACb,UAAA5B,MAAC6B,GAAA,CAAK,UAAU,aAAa,cAAe,GAAO,EACnD7B,MAAC,OAAI,UAAU,sBAAuB,WAAa,KAAK,EACxDA,MAAC,KAAE,UAAU,iBAAiB,8BAAkB,EAEhD4B,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SACC,KAAK,OACL,MAAOqE,EACP,SAAW3D,GAAM4D,EAAe5D,EAAE,OAAO,KAAK,EAC9C,YAAY,YACZ,UAAS,GACT,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASmG,GAAA,CACzB,EACA,MAAO,CAAE,SAAU,SAAU,UAAW,SAAS,GAEnD7G,MAAC,UACC,UAAU,kBACV,QAAS6G,GACT,SAAU,CAACxC,EAAY,OACxB,uBAED,EACF,EAEArE,MAAC,KAAE,UAAU,aAAa,MAAO,CAAE,UAAW,WAAa,4DAE3D,EAEA4B,OAAC,UACC,UAAU,kBACV,MAAO,CAAE,UAAW,SAAU,QAAS,OAAQ,UAAW,UAC1D,QAAS,IAAM,CACbwC,EAAgB,IAAI,EACpBJ,EAAO,EAAE,EACTE,EAAY,EAAE,CAChB,EAEA,UAAAlE,MAACuI,GAAA,CAAU,KAAM,GAAI,EACrBvI,MAAC,QAAK,gBAAI,IACZ,EACF,EACF,EAKCpO,QAsCF,OAAI,UAAU,kBACb,SAAAgQ,OAAC,OAAI,UAAU,6BACb,UAAA5B,MAAC,UAAO,UAAU,aAAa,QAASiH,GACtC,SAAAjH,MAACuI,GAAA,CAAU,KAAM,GAAI,EACvB,EAEAvI,MAAC6B,GAAA,CAAK,UAAU,aAAa,cAAe,GAAO,EACnD7B,MAAC,OAAI,UAAU,sBAAuB,WAAQ,KAAK,EACnDA,MAAC,KAAE,UAAU,iBAAiB,6BAAiB,QAG9C,OAAI,UAAW,eAAeiE,IAAa,QAAU,QAAU,EAAE,GAC/D,UAAC,EAAG,EAAG,EAAG,CAAC,EAAE,IAAIrX,GAChBoT,MAAC,OAEC,UAAW,WAAWhP,EAAI,OAASpE,EAAI,SAAW,EAAE,IAAIqX,CAAQ,GAE/D,SAAAjT,EAAI,OAASpE,EAAI,IAAM,IAHnBA,CAAA,CAKR,EACH,SAGC,OAAI,UAAU,aAAa,KAAK,QAAQ,aAAW,mBACjD,WAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAAE,IAAInF,GAC/BuY,MAAC,UAEC,UAAU,UACV,QAAS,IAAM8G,GAAgBrf,EAAI,UAAU,EAC7C,SAAUkX,EACV,aAAY,OAAOlX,CAAG,EAErB,SAAAA,CAAA,EANIA,CAAA,CAQR,QACA,UAAO,UAAU,gBAAgB,SAAQ,GAAC,cAAY,OAAO,EAC9DuY,MAAC,UACC,UAAU,UACV,QAAS,IAAM8G,GAAgB,GAAG,EAClC,SAAUnI,EACV,aAAW,IACZ,eAGDqB,MAAC,UACC,UAAU,oBACV,QAASgH,GACT,SAAUrI,GAAW3N,EAAI,SAAW,EACpC,aAAW,oBAEX,SAAAgP,MAACuI,GAAA,CAAU,KAAM,GAAI,GACvB,EACF,EAEC5J,SACE,OAAI,UAAU,gBACb,SAAAqB,MAAC,OAAI,UAAU,UAAU,EAC3B,GAEJ,EACF,QAhGG,OAAI,UAAU,kBACb,SAAA4B,OAAC,OAAI,UAAU,6BACb,UAAA5B,MAAC,UAAO,UAAU,aAAa,QAAS,IAAM6D,EAAQ,IAAI,EACxD,SAAA7D,MAACuI,GAAA,CAAU,KAAM,GAAI,EACvB,EAEAvI,MAAC6B,GAAA,CAAK,UAAU,aAAa,cAAe,GAAO,EACnD7B,MAAC,KAAE,UAAU,iBAAiB,8BAAkB,EAEhD4B,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,SACC,KAAK,OACL,MAAO/O,EACP,SAAWyP,GAAM4F,GAAwB5F,EAAE,OAAO,KAAK,EACvD,YAAY,eACZ,SAAU/B,EACV,UAAS,GACT,UAAY+B,GAAM,CACZA,EAAE,MAAQ,SAAS8F,EAAA,CACzB,IAEFxG,MAAC,UACC,UAAU,mBACV,QAASwG,EACT,SAAU7H,GAAW1N,EAAY,OAAS,EAEzC,SAAA0N,QAAW,OAAI,UAAU,gBAAgB,EAAKqB,MAACwI,GAAA,CAAa,KAAM,GAAI,GACzE,EACF,GACF,EACF,EAuEN,GAAI5oB,IAAS,SACX,aACG,OAAI,UAAU,kBACb,SAAAgiB,OAAC,OAAI,UAAU,6BACb,UAAA5B,MAAC,UAAO,UAAU,aAAa,QAAS,IAAM6D,EAAQ,IAAI,EACxD,SAAA7D,MAACuI,GAAA,CAAU,KAAM,GAAI,EACvB,EAEAvI,MAAC6B,GAAA,CAAK,UAAU,aAAa,cAAe,GAAO,EACnD7B,MAAC,KAAE,UAAU,iBAAiB,mCAAuB,EAErD4B,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SACC,KAAK,QACL,MAAOvQ,EACP,SAAWiR,GAAMgE,EAAShE,EAAE,OAAO,KAAK,EACxC,YAAY,QACZ,UAAS,GACT,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASwG,GAAA,CACzB,IAEFlH,MAAC,SACC,KAAK,WACL,MAAOtQ,EACP,SAAWgR,GAAMiE,GAAYjE,EAAE,OAAO,KAAK,EAC3C,YAAY,WACZ,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASwG,GAAA,CACzB,IAEFlH,MAAC,UACC,UAAU,kBACV,QAASkH,GACV,oBAED,EACF,QAEC,OAAI,UAAU,oBACb,SAAAtF,OAAC,OAAI,UAAU,uBACb,UAAAA,OAAC,UAAO,UAAU,kBAAkB,QAAS,IAAM,CAAEuG,GAAA,EAAkBtE,EAAQ,MAAM,CAAE,EACrF,UAAA7D,MAACyI,GAAA,CAAS,KAAM,GAAI,EACpBzI,MAAC,QAAK,6BAAiB,GACzB,EACA4B,OAAC,UAAO,UAAU,kBAAkB,QAAS,IAAM,CAAEwG,GAAA,EAAsBvE,EAAQ,UAAU,CAAE,EAC7F,UAAA7D,MAAC0I,GAAA,CAAU,KAAM,GAAI,EACrB1I,MAAC,QAAK,kCAAsB,GAC9B,GACF,EACF,GACF,EACF,EAKJ,GAAIpgB,IAAS,OAEX,OAAI4lB,SAEC,OAAI,UAAU,kBACb,SAAA5D,OAAC,OAAI,UAAU,8BACb,UAAA5B,MAAC,OAAI,UAAU,qBACb,eAAC6C,GAAA,CAAM,KAAM,GAAI,EACnB,EACA7C,MAAC,MAAG,UAAU,sBAAsB,6BAAiB,EACrD4B,OAAC,KAAE,UAAU,wBAAwB,kCACd5B,MAAC,UAAQ,SAAA8E,GAAa,KAAK,EAAS,6EAE3D,EACA9E,MAAC,KAAE,UAAU,uBAAuB,oDAEpC,EACAA,MAAC,UACC,UAAU,kBACV,QAAS,IAAM,CACbmI,GAAA,EACAtE,EAAQ,QAAQ,CAClB,EACA,MAAO,CAAE,UAAW,UACrB,4BAED,EACF,EACF,EAKAe,KAAa,QAEZ,OAAI,UAAU,kBACb,SAAAhD,OAAC,OAAI,UAAU,6BACb,UAAA5B,MAAC,UAAO,UAAU,aAAa,QAAS,IAAM,CAAEmI,GAAA,EAAkBtE,EAAQ,QAAQ,CAAE,EAClF,SAAA7D,MAACuI,GAAA,CAAU,KAAM,GAAI,EACvB,EAEAvI,MAAC6B,GAAA,CAAK,UAAU,aAAa,cAAe,GAAO,EACnD7B,MAACsC,IAAc,MAAO,CAAC,UAAW,SAAU,SAAS,EAAG,YAAa,EAAG,EACxEtC,MAAC,KAAE,UAAU,iBAAiB,mCAAuB,EACrDA,MAAC,KAAE,UAAU,aAAa,kDAAsC,EAEhE4B,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,SACC,KAAK,OACL,MAAO/O,EACP,SAAWyP,GAAM4F,GAAwB5F,EAAE,OAAO,KAAK,EACvD,YAAY,eACZ,SAAU/B,EACV,UAAS,GACT,UAAY+B,GAAM,CACZA,EAAE,MAAQ,SAASyG,GAAA,CACzB,IAEFnH,MAAC,UACC,UAAU,mBACV,QAASmH,GACT,SAAUxI,GAAW1N,EAAY,OAAS,EAEzC,SAAA0N,QAAW,OAAI,UAAU,gBAAgB,EAAKqB,MAACwI,GAAA,CAAa,KAAM,GAAI,GACzE,EACF,GACF,EACF,EAKA5D,KAAa,QAEZ,OAAI,UAAU,kBACb,SAAAhD,OAAC,OAAI,UAAU,6BACb,UAAA5B,MAAC,UAAO,UAAU,aAAa,QAAS,IAAM,CAAE6E,GAAY,CAAC,EAAGE,EAAe,IAAI,EAAGE,GAAc,EAAE,CAAG,EACvG,SAAAjF,MAACuI,GAAA,CAAU,KAAM,GAAI,EACvB,EAEAvI,MAAC6B,GAAA,CAAK,UAAU,aAAa,cAAe,GAAO,EACnD7B,MAACsC,IAAc,MAAO,CAAC,UAAW,SAAU,SAAS,EAAG,YAAa,EAAG,EACxEtC,MAAC,OAAI,UAAU,sBAAuB,YAAa,KAAK,EACxDA,MAAC,KAAE,UAAU,iBAAiB,6BAAiB,EAC/CA,MAAC,KAAE,UAAU,aAAa,4CAAgC,EAE1D4B,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,SACC,KAAK,WACL,MAAOgF,EACP,SAAWtE,GAAMuE,GAAcvE,EAAE,OAAO,KAAK,EAC7C,YAAY,cACZ,SAAU/B,EACV,UAAS,GACT,UAAY+B,GAAM,CACZA,EAAE,MAAQ,SAAS0G,GAAA,CACzB,IAEFpH,MAAC,UACC,UAAU,mBACV,QAASoH,GACT,SAAUzI,GAAW,CAACqG,EAAW,OAEhC,SAAArG,QAAW,OAAI,UAAU,gBAAgB,EAAKqB,MAACwI,GAAA,CAAa,KAAM,GAAI,GACzE,EACF,GACF,EACF,QAMD,OAAI,UAAU,kBACb,SAAA5G,OAAC,OAAI,UAAU,6BACb,UAAA5B,MAAC,UAAO,UAAU,aAAa,QAAS,IAAM,CAAE6E,GAAY,CAAC,EAAGI,GAAc,EAAE,CAAG,EACjF,SAAAjF,MAACuI,GAAA,CAAU,KAAM,GAAI,EACvB,EAEAvI,MAAC6B,GAAA,CAAK,UAAU,aAAa,cAAe,GAAO,EACnD7B,MAACsC,IAAc,MAAO,CAAC,UAAW,SAAU,SAAS,EAAG,YAAa,EAAG,EACxEtC,MAAC,OAAI,UAAU,sBAAuB,YAAa,KAAK,EACxDA,MAAC,KAAE,UAAU,iBAAiB,+BAAmB,EAEjD4B,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SACC,KAAK,OACL,MAAOkF,EACP,SAAWxE,GAAMyE,EAAYzE,EAAE,OAAO,KAAK,EAC3C,YAAY,YACZ,UAAS,KAEXV,MAAC,SACC,KAAK,QACL,MAAOoF,EACP,SAAW1E,GAAM2E,EAAa3E,EAAE,OAAO,KAAK,EAC5C,YAAY,QACZ,UAAW0E,GAAa,CAAC/C,GAAa+C,CAAS,EAAI,cAAgB,KAErEpF,MAAC8C,GAAA,CACC,MAAOwC,EACP,SAAW5E,GAAM6E,EAAgB7E,EAAE,OAAO,KAAK,EAC/C,YAAY,2BACZ,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS2G,GAAA,CACzB,EACA,aAAc,KAEhBrH,MAAC,UACC,UAAU,kBACV,QAASqH,GACT,SAAU1I,GAAW,CAACuG,EAAS,QAAU,CAAC7C,GAAa+C,CAAS,GAAKE,EAAa,OAAS,EAE1F,SAAA3G,EACCiD,OAAC,QAAK,UAAU,cACd,UAAA5B,MAAC,OAAI,UAAU,gBAAgB,EAAE,uBAEnC,EACE,gBACN,EACF,EAEAA,MAAC,KAAE,UAAU,kBAAkB,0EAE/B,GACF,EACF,EAKJ,GAAIpgB,IAAS,WAAY,CAEvB,GAAI8lB,IAAiB,GAAKU,GACxB,aACG,OAAI,UAAU,kBACb,SAAAxE,OAAC,OAAI,UAAU,8CACb,UAAA5B,MAAC,OAAI,UAAU,qBACb,eAAC6C,GAAA,CAAM,KAAM,GAAI,EACnB,EACA7C,MAAC,MAAG,UAAU,sBAAsB,2BAAe,EACnD4B,OAAC,KAAE,UAAU,wBACX,UAAA5B,MAAC,UAAQ,YAAe,KAAK,EAAS,8DAExC,EAEA4B,OAAC,OAAI,UAAU,mBACb,UAAAA,OAAC,OAAI,UAAU,kBACb,UAAA5B,MAAC,QAAK,UAAU,mBAAmB,wBAAY,EAC/CA,MAAC,QAAK,UAAU,mBAAoB,YAAe,KAAK,EACxDA,MAAC,QAAK,UAAU,kBAAkB,oCAAwB,GAC5D,EACA4B,OAAC,OAAI,UAAU,kBACb,UAAA5B,MAAC,QAAK,UAAU,mBAAmB,uBAAW,EAC9CA,MAAC,QAAK,UAAU,mBAAoB,YAAe,WAAW,EAC9DA,MAAC,QAAK,UAAU,kBAAkB,6BAAiB,GACrD,GACF,EAEAA,MAAC,KAAE,UAAU,sBAAsB,wFAEnC,EAEAA,MAAC,UACC,UAAU,kBACV,QAAS,IAAM,CAEb,OAAO,SAAS,QAClB,EACA,MAAO,CAAE,UAAW,UACrB,4BAED,EACF,EACF,EAKJ,GAAI0F,IAAiB,EACnB,aACG,OAAI,UAAU,kBACb,SAAA9D,OAAC,OAAI,UAAU,6BACb,UAAA5B,MAAC,UAAO,UAAU,aAAa,QAAS,IAAM,CAAEoI,GAAA,EAAsBvE,EAAQ,QAAQ,CAAE,EACtF,SAAA7D,MAACuI,GAAA,CAAU,KAAM,GAAI,EACvB,EAEAvI,MAAC6B,GAAA,CAAK,UAAU,aAAa,cAAe,GAAO,EACnD7B,MAACsC,IAAc,MAAO,CAAC,UAAW,cAAc,EAAG,YAAa,EAAG,EACnEtC,MAAC,KAAE,UAAU,iBAAiB,iCAAqB,EACnDA,MAAC,KAAE,UAAU,aAAa,4CAAgC,EAE1D4B,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SACC,KAAK,OACL,MAAO4F,GACP,SAAWlF,GAAMmF,GAAuBnF,EAAE,OAAO,KAAK,EACtD,YAAY,eACZ,UAAS,GACT,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAWkF,GAAoB,QAC3CD,EAAgB,CAAC,CAErB,IAEF3F,MAAC,UACC,UAAU,kBACV,QAAS,IAAM2F,EAAgB,CAAC,EAChC,SAAU,CAACC,GAAoB,OAChC,qBAED,EACF,GACF,EACF,EAKJ,GAAIF,IAAiB,EACnB,aACG,OAAI,UAAU,kBACb,SAAA9D,OAAC,OAAI,UAAU,6BACb,UAAA5B,MAAC,UAAO,UAAU,aAAa,QAAS,IAAM2F,EAAgB,CAAC,EAC7D,SAAA3F,MAACuI,GAAA,CAAU,KAAM,GAAI,EACvB,EAEAvI,MAAC6B,GAAA,CAAK,UAAU,aAAa,cAAe,GAAO,EACnD7B,MAACsC,IAAc,MAAO,CAAC,UAAW,cAAc,EAAG,YAAa,EAAG,EACnEtC,MAAC,OAAI,UAAU,sBAAuB,SAAA4F,GAAoB,EAC1D5F,MAAC,KAAE,UAAU,iBAAiB,qCAAyB,EAEvD4B,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SACC,KAAK,OACL,MAAO8F,EACP,SAAWpF,GAAMqF,EAAgBrF,EAAE,OAAO,KAAK,EAC/C,YAAY,YACZ,UAAS,KAEXV,MAAC,SACC,KAAK,QACL,MAAOgG,GACP,SAAWtF,GAAMuF,GAAiBvF,EAAE,OAAO,KAAK,EAChD,YAAY,QACZ,UAAWsF,IAAiB,CAAC3D,GAAa2D,EAAa,EAAI,cAAgB,KAE7EhG,MAAC8C,GAAA,CACC,MAAOoD,GACP,SAAWxF,GAAMyF,GAAoBzF,EAAE,OAAO,KAAK,EACnD,YAAY,2BACZ,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASoH,GAAA,CACzB,EACA,aAAc,KAEhB9H,MAAC,UACC,UAAU,kBACV,QAAS8H,GACT,SAAUnJ,GAAW,CAACmH,EAAa,QAAU,CAACzD,GAAa2D,EAAa,GAAKE,GAAiB,OAAS,EAEtG,SAAAvH,EACCiD,OAAC,QAAK,UAAU,cACd,UAAA5B,MAAC,OAAI,UAAU,gBAAgB,EAAE,yBAEnC,EACE,kBACN,EACF,EAEAA,MAAC,KAAE,UAAU,kBAAkB,4FAE/B,GACF,EACF,CAGN,CACF,CCtpCA,SAAwB2I,GAAM,CAAE,QAAAzlB,EAAS,KAAAtC,EAAO,GAAI,QAAAgoB,GAAW,CAC7D/J,mBAAU,IAAM,CACd,MAAMgK,EAAQ,WAAWD,EAAS,GAAI,EACtC,MAAO,IAAM,aAAaC,CAAK,CACjC,EAAG,CAACD,CAAO,CAAC,EAGV5I,MAAC,OAAI,UAAU,kBACb,SAAAA,MAAC,OAAI,UAAW,SAASpf,CAAI,GAC1B,SAAAsC,CAAA,CACH,EACF,CAEJ,CCZA,SAAwB4lB,GAAY,CAAE,QAAAC,EAAU,IAAS,CACvD,KAAM,CAAE,MAAA1I,EAAO,YAAAM,CAAA,EAAgBC,GAAA,EAE/B,OACEZ,MAAC,UACC,UAAW,gBAAgB+I,EAAU,uBAAyB,EAAE,GAChE,QAASpI,EACT,MAAO,aAAaN,IAAU,OAAS,QAAU,MAAM,QACvD,aAAY,aAAaA,IAAU,OAAS,QAAU,MAAM,QAE3D,SAAAA,IAAU,OACTuB,OAAAoH,WAAA,CACE,UAAAhJ,MAACiJ,GAAA,CAAI,KAAMF,EAAU,GAAK,GAAI,EAC7B,CAACA,GAAW/I,MAAC,QAAK,iBAAK,GAC1B,EAEA4B,OAAAoH,WAAA,CACE,UAAAhJ,MAACkJ,GAAA,CAAK,KAAMH,EAAU,GAAK,GAAI,EAC9B,CAACA,GAAW/I,MAAC,QAAK,gBAAI,GACzB,GAIR,CCvBA,MAAqBmJ,WAAsBC,WAAU,CACnD,YAAYC,EAAO,CACjB,MAAMA,CAAK,EACX,KAAK,MAAQ,CAAE,SAAU,GAAO,MAAO,KAAM,UAAW,KAC1D,CAEA,OAAO,yBAAyBhlB,EAAO,CACrC,MAAO,CAAE,SAAU,GACrB,CAEA,kBAAkBA,EAAOilB,EAAW,CAClC,KAAK,SAAS,CAAE,MAAAjlB,EAAO,UAAAilB,CAAA,CAAW,EAElC,QAAQ,MAAM,iCAAkCjlB,EAAOilB,CAAS,GAG3CjlB,GAAO,SAAS,SAAS,6CAA6C,GACtEA,GAAO,SAAS,SAAS,eAAe,GACxCA,GAAO,SAAS,SAAS,mBAAmB,KAG/D,QAAQ,KAAK,8EAA8E,EAEvF,WAAY,OACd,OAAO,OAAO,KAAMklB,GAAU,CAC5B,QAAQ,IAAIA,EAAM,IAAKvf,GAAS,OAAO,OAAOA,CAAI,CAAC,CAAC,EAAE,KAAK,IAAM,CAC/D,OAAO,SAAS,QAClB,CAAC,CACH,CAAC,EAAE,MAAMqF,GAAO,CACd,QAAQ,KAAK,wDAAyDA,EAAI,OAAO,EACjF,OAAO,SAAS,QAClB,CAAC,EAED,OAAO,SAAS,SAGtB,CAEA,YAAc,IAAM,CAClB,KAAK,SAAS,CAAE,SAAU,GAAO,MAAO,KAAM,UAAW,KAAM,CACjE,EAEA,aAAe,IAAM,CACnB,OAAO,SAAS,QAClB,EAEA,QAAS,CACP,OAAI,KAAK,MAAM,eAEV,OAAI,UAAU,iBACb,SAAAuS,OAAC,OAAI,UAAU,yBACb,UAAA5B,MAAC,OAAI,UAAU,aAAa,eAACwJ,GAAA,CAAc,KAAM,GAAI,EAAE,EACvDxJ,MAAC,MAAG,gCAAoB,EACxBA,MAAC,KAAE,6EAAiE,EAEpE4B,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,UAAO,UAAU,kBAAkB,QAAS,KAAK,YAAa,qBAE/D,QACC,UAAO,UAAU,oBAAoB,QAAS,KAAK,aAAc,uBAElE,GACF,EAGC,GAKC,CAEJ,EACF,EAIG,KAAK,MAAM,QACpB,CACF,CC/EA,SAAwByJ,IAAmB,CACzC,KAAM,CAACtmB,EAAUumB,CAAW,EAAIhL,WAASnb,IAAqB,EACxD,CAAComB,EAAcC,CAAe,EAAIlL,WAAS,CAAC,EAC5C,CAACmL,EAAYC,CAAa,EAAIpL,WAAS,EAAK,EAG5CqL,EAAgBvF,SAAO,EAAK,EAC5BwF,EAAmBxF,SAAO,IAAI,EA2CpC,OAzCA3F,YAAU,IAAM,CAEd,MAAMoL,EAAc5mB,GAAmB,MAAOI,GAAW,CACvDimB,EAAYjmB,CAAM,EAEdA,GAAUsmB,EAAc,UAE1BD,EAAc,EAAI,EACdE,EAAiB,SAAS,aAAaA,EAAiB,OAAO,EACnEA,EAAiB,QAAU,WAAW,IAAMF,EAAc,EAAK,EAAG,GAAI,EACtEC,EAAc,QAAU,IAGrBtmB,IACHsmB,EAAc,QAAU,IAI1B,MAAM5Z,EAAQ,MAAMlP,GAAA,EACpB2oB,EAAgBzZ,CAAK,CACvB,CAAC,EAGDlP,GAAA,EAAwB,KAAK2oB,CAAe,EAG5C,MAAMM,EAAW,YAAY,SAAY,CACvC,GAAI,CAAC3mB,KAAuB,CAC1B,MAAM4M,EAAQ,MAAMlP,GAAA,EACpB2oB,EAAgBzZ,CAAK,CACvB,CACF,EAAG,GAAI,EAEP,MAAO,IAAM,CACX8Z,EAAA,EACA,cAAcC,CAAQ,EAClBF,EAAiB,SAAS,aAAaA,EAAiB,OAAO,CACrE,CACF,EAAG,EAAE,EAGD7mB,GAAYwmB,IAAiB,GAAK,CAACE,EAC9B,KAIPjI,OAAC,OAAI,UAAW,qBAAqBze,EAAW,SAAW,SAAS,IAAI0mB,EAAa,SAAW,EAAE,GAChG,UAAA7J,MAAC,OAAI,UAAU,4BACZ,SAAC7c,EAoBE0mB,EACFjI,OAAAoH,WAAA,CACE,UAAAhJ,MAAC,QAAK,UAAU,cACd,SAAAA,MAAC,OAAI,MAAM,KAAK,OAAO,KAAK,QAAQ,YAAY,KAAK,OAAO,OAAO,eAAe,YAAY,IAC5F,eAAC,YAAS,OAAO,iBAAiB,EACpC,EACF,EACAA,MAAC,QAAK,UAAU,eAAe,2BAAe,GAChD,EACE2J,EAAe,EACjB/H,OAAAoH,WAAA,CACE,UAAAhJ,MAAC,QAAK,UAAU,eACd,SAAA4B,OAAC,OAAI,MAAM,KAAK,OAAO,KAAK,QAAQ,YAAY,KAAK,OAAO,OAAO,eAAe,YAAY,IAC5F,UAAA5B,MAAC,YAAS,OAAO,mBAAmB,EACpCA,MAAC,YAAS,OAAO,iBAAiB,EAClCA,MAAC,QAAK,EAAE,uEAAuE,GACjF,EACF,EACA4B,OAAC,QAAK,UAAU,eAAe,qBAAS+H,EAAa,OAAG,GAC1D,EACE,KAvCF/H,OAAAoH,WAAA,CACE,UAAAhJ,MAAC,QAAK,UAAU,eACd,SAAA4B,OAAC,OAAI,MAAM,KAAK,OAAO,KAAK,QAAQ,YAAY,KAAK,OAAO,OAAO,eAAe,YAAY,IAC5F,UAAA5B,MAAC,QAAK,GAAG,IAAI,GAAG,IAAI,GAAG,KAAK,GAAG,KAAK,EACpCA,MAAC,QAAK,EAAE,0CAA0C,EAClDA,MAAC,QAAK,EAAE,uCAAuC,EAC/CA,MAAC,QAAK,EAAE,kCAAkC,EAC1CA,MAAC,QAAK,EAAE,qCAAqC,EAC7CA,MAAC,QAAK,EAAE,+BAA+B,EACvCA,MAAC,QAAK,GAAG,KAAK,GAAG,KAAK,GAAG,QAAQ,GAAG,KAAK,GAC3C,EACF,EACA4B,OAAC,QAAK,UAAU,eAAe,oBAE5B+H,EAAe,GACd/H,OAAC,QAAK,UAAU,gBAAiB,UAAA+H,EAAa,YAAQ,GAE1D,GACF,EAsBJ,QAEC,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAoFN,GACJ,CAEJ,CC3LA,SAAwBQ,IAAgB,CACtC,KAAM,CAACC,EAAgBC,CAAiB,EAAI3L,WAAS,IAAI,EACnD,CAAC4L,EAAYC,CAAa,EAAI7L,WAAS,EAAK,EAElDG,YAAU,IAAM,CAEd,GAAI,OAAO,WAAW,4BAA4B,EAAE,QAAS,OAG7D,MAAM2L,EAAY,aAAa,QAAQ,uBAAuB,EAC9D,GAAIA,EAAW,CACb,MAAMC,EAAc,SAASD,EAAW,EAAE,EAC1C,GAAI,KAAK,MAAQC,EAAc,MAAc,GAAK,IAAM,MAC1D,CAEA,MAAMC,EAAWhK,GAAM,CACrBA,EAAE,iBACF2J,EAAkB3J,CAAC,EACnB6J,EAAc,EAAI,CACpB,EAEA,cAAO,iBAAiB,sBAAuBG,CAAO,EAC/C,IAAM,OAAO,oBAAoB,sBAAuBA,CAAO,CACxE,EAAG,EAAE,EAEL,MAAMC,EAAgB,SAAY,CAChC,GAAI,CAACP,EAAgB,OACrBA,EAAe,SACf,KAAM,CAAE,QAAAQ,CAAA,EAAY,MAAMR,EAAe,WACrCQ,IAAY,YACdL,EAAc,EAAK,EAErBF,EAAkB,IAAI,CACxB,EAEMQ,EAAgB,IAAM,CAC1BN,EAAc,EAAK,EACnB,aAAa,QAAQ,wBAAyB,KAAK,MAAM,UAAU,CACrE,EAEA,OAAKD,EAGH1I,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,OAAI,UAAU,yBACb,UAAA5B,MAAC8K,GAAA,CAAS,KAAM,GAAI,EACpBlJ,OAAC,OAAI,UAAU,sBACb,UAAA5B,MAAC,UAAO,6BAAiB,EACzBA,MAAC,QAAK,+CAAmC,GAC3C,GACF,EACA4B,OAAC,OAAI,UAAU,yBACb,UAAA5B,MAAC,UAAO,UAAU,4BAA4B,QAAS2K,EAAe,mBAAO,EAC7E3K,MAAC,UAAO,UAAU,yBAAyB,QAAS6K,EAAe,aAAW,UAC5E,SAAA7K,MAAC+K,GAAA,CAAE,KAAM,GAAI,EACf,GACF,GACF,EAjBsB,IAmB1B,CC1DA,SAAwBC,GAAa,CAAE,SAAAC,EAAU,WAAAC,EAAY,SAAAC,GAAY,CACvE,KAAM,CAAC/W,EAAMgX,CAAO,EAAI1M,WAAS,EAAE,EAC7B,CAAC2M,EAAWC,CAAY,EAAI5M,WAAS,EAAK,EAC1C,CAACra,EAAOknB,CAAQ,EAAI7M,WAAS,IAAI,EAEjC8M,EAAe,SAAY,CAC/B,GAAIpX,EAAK,SAAW,EACpB,CAAAkX,EAAa,EAAI,EACjBC,EAAS,IAAI,EACb,GAAI,CACF,KAAM,CAAE,KAAME,EAAW,MAAOC,CAAA,EAAmB,MAAMhnB,EAAS,KAAK,IAAI,UAAU,CAAE,SAAAumB,EAAU,EACjG,GAAIS,EAAgB,MAAMA,EAE1B,KAAM,CAAE,MAAOC,CAAA,EAAgB,MAAMjnB,EAAS,KAAK,IAAI,OAAO,CAC5D,SAAAumB,EACA,YAAaQ,EAAU,GACvB,KAAArX,CAAA,CACD,EACD,GAAIuX,EAAa,MAAMA,EAEvBT,EAAA,CACF,MAAQ,CACNK,EAAS,iCAAiC,EAC1CH,EAAQ,EAAE,CACZ,SACEE,EAAa,EAAK,CACpB,EACF,EAEMM,EAAiBlL,GAAM,CACvBA,EAAE,MAAQ,SAAWtM,EAAK,SAAW,GAAGoX,EAAA,CAC9C,EAEA,OACE5J,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,OAAI,UAAU,qBACb,eAAC6L,GAAA,CAAO,KAAM,GAAI,EACpB,EACA7L,MAAC,MAAG,qCAAyB,EAC7BA,MAAC,KAAE,8DAAkD,EACrDA,MAAC,OAAI,UAAU,iBACb,SAAAA,MAAC,SACC,KAAK,OACL,MAAO5L,EACP,SAAWsM,GAAM0K,EAAQ1K,EAAE,OAAO,MAAM,QAAQ,MAAO,EAAE,EAAE,MAAM,EAAG,CAAC,CAAC,EACtE,UAAWkL,EACX,YAAY,SACZ,UAAW,EACX,UAAS,GACT,UAAU,UACV,QAAQ,SACR,UAAU,kBACV,aAAW,0BAEf,EACCvnB,GAAS2b,MAAC,KAAE,UAAU,YAAa,SAAA3b,EAAM,EAC1Cud,OAAC,OAAI,UAAU,wBACb,UAAA5B,MAAC,UAAO,UAAU,oBAAoB,QAASmL,EAAU,kBAAM,EAC/DnL,MAAC,UACC,UAAU,kBACV,QAASwL,EACT,SAAUpX,EAAK,SAAW,GAAKiX,EAE9B,WAAYzJ,OAAAoH,WAAA,CAAE,UAAAhJ,MAAC8L,GAAA,CAAQ,KAAM,GAAI,UAAU,UAAU,EAAE,iBAAa,EAAM,UAC7E,EACF,GACF,CAEJ,CCxEO,SAASC,GAAe5f,EAAQ,CACrC,OAAO,IAAI,KAAK,aAAa,QAAS,CACpC,MAAO,WACP,SAAU,MACV,sBAAuB,EACvB,sBAAuB,CAC3B,CAAG,EAAE,OAAOA,CAAM,CAClB,CAEO,SAAS6f,GAAkBlqB,EAAO,CACvC,GAAI,CAACA,GAASA,EAAM,SAAW,EAAG,MAAO,GAEzC,IAAIsY,EAAW,EACf,OAAAtY,EAAM,QAAQM,GAAQ,CAChBA,EAAK,SAAW,SAClBgY,GAAahY,EAAK,QAAU,EAEhC,CAAC,EACM,KAAK,MAAMgY,CAAQ,CAC5B,CAQO,SAAS6R,GAAuBnqB,EAAO,CAC5C,GAAI,CAACA,GAASA,EAAM,SAAW,EAC7B,MAAO,CAAE,SAAU,EAAG,YAAa,EAAG,WAAY,EAAG,aAAc,EAAK,EAM1E,GAF2BA,EAAM,KAAK,GAAK,EAAE,gBAAkB,CAAC,EAExC,CAEtB,MAAMoqB,EAAapqB,EAAM,OAAO,CAACyM,EAAKzQ,IAAMyQ,GAAOzQ,EAAE,iBAAmB,GAAI,CAAC,EACvEquB,EAAcrqB,EACjB,OAAOhE,GAAKA,EAAE,SAAW,MAAM,EAC/B,OAAO,CAACyQ,EAAKzQ,IAAMyQ,GAAOzQ,EAAE,iBAAmB,GAAI,CAAC,EAGvD,MAAO,CAAE,SAFQouB,EAAa,EAAI,KAAK,MAAOC,EAAcD,EAAc,GAAG,EAAI,EAE9D,YAAAC,EAAa,WAAAD,EAAY,aAAc,EAAI,CAChE,CAGA,MAAM9R,EAAWtY,EACd,OAAO,GAAK,EAAE,SAAW,MAAM,EAC/B,OAAO,CAACyM,EAAKzQ,IAAMyQ,GAAOzQ,EAAE,QAAU,GAAI,CAAC,EAE9C,MAAO,CAAE,SAAU,KAAK,MAAMsc,CAAQ,EAAG,YAAa,EAAG,WAAY,EAAG,aAAc,EAAK,CAC7F,CAEO,SAASgS,GAAiBtqB,EAAO,CACtC,GAAI,CAACA,GAASA,EAAM,SAAW,EAAG,MAAO,cAEzC,MAAMuqB,EAAavqB,EAAM,KAAKhE,GAAKA,EAAE,SAAW,SAAS,EACnDwuB,EAAUxqB,EAAM,KAAKhE,GAAKA,EAAE,SAAW,MAAM,EAGnD,OAFgBgE,EAAM,MAAMhE,GAAKA,EAAE,SAAW,MAAM,EAEhC,OAChBuuB,GAAcC,EAAgB,UAC3B,aACT,CAEO,SAASC,GAAsBzqB,EAAO,CAC3C,MAAMK,EAASiqB,GAAiBtqB,CAAK,EACrC,OAAIK,IAAW,OAAe,WAC1BA,IAAW,UAAkB,cAC1B,aACT,CAeO,SAASqqB,GAA0Bpc,EAASqc,EAAgB,EAAG,CACpE,MAAMze,EAAQ,IAAI,KAClBA,EAAM,SAAS,EAAG,EAAG,EAAG,CAAC,EAEzB,MAAM1I,EAAS,CACb,eAAgB,WAChB,iBAAkB,EAClB,cAAe,WACf,YAAa,WACb,cAAe,EACf,WAAY,KACZ,gBAAiB,GACjB,aAAc,EAClB,EAGE,GAAI8K,EAAQ,YAAcA,EAAQ,SAAU,CAC1C,MAAMlC,EAAY,IAAI,KAAKkC,EAAQ,UAAU,EACvCrC,EAAU,IAAI,KAAKqC,EAAQ,QAAQ,EACzClC,EAAU,SAAS,EAAG,EAAG,EAAG,CAAC,EAC7BH,EAAQ,SAAS,EAAG,EAAG,EAAG,CAAC,EAE3B,MAAM2e,EAAgB,KAAK,IAAI,EAAG,KAAK,MAAM3e,EAAUG,IAAc,IAAO,GAAK,GAAK,GAAG,CAAC,EACpFye,EAAc,KAAK,IAAI,EAAG,KAAK,MAAM3e,EAAQE,IAAc,IAAO,GAAK,GAAK,GAAG,CAAC,EAGhF0e,EAAmB,KAAK,IAAI,IAAMD,EAAcD,EAAiB,GAAG,EAIpEG,GAHiBzc,EAAQ,UAAY,GAGLwc,EACtCtnB,EAAO,iBAAmB,KAAK,MAAMunB,CAAY,EACjDvnB,EAAO,gBAAkB,GAGrBunB,EAAe,GACjBvnB,EAAO,eAAiB,QACxBA,EAAO,cAAgB,uBAAuBA,EAAO,gBAAgB,MAC5DunB,EAAe,IACxBvnB,EAAO,eAAiB,SACxBA,EAAO,cAAgB,oBAAoBA,EAAO,gBAAgB,OAElEA,EAAO,eAAiB,WACxBA,EAAO,cAAgB,WAE3B,CAGA,GAAI8K,EAAQ,kBAAoBA,EAAQ,iBAAmB,EAAG,CAE5D,MAAM0c,GADW1c,EAAQ,UAAY,GACD,IAAOA,EAAQ,iBAEnD,GAAI0c,EAAkB,GAAKL,EAAgB,EAAG,CAG5C,MAAMM,GAAcN,EAAgBK,GAAmBA,EAAmB,IAC1ExnB,EAAO,cAAgB,KAAK,MAAMynB,CAAS,EAC3CznB,EAAO,aAAe,GAGlBynB,EAAY,IACdznB,EAAO,YAAc,OACrBA,EAAO,WAAa,kBAAkBA,EAAO,aAAa,eACjDynB,EAAY,KACrBznB,EAAO,YAAc,QACrBA,EAAO,WAAa,kBAAkBA,EAAO,aAAa,gBAE1DA,EAAO,YAAc,WACrBA,EAAO,WAAa,iBAExB,MAAWmnB,EAAgB,IAEzBnnB,EAAO,aAAe,GACtBA,EAAO,WAAa,GAAGmnB,CAAa,iBAExC,CAEA,OAAOnnB,CACT,CAQO,SAAS0nB,GAAkB5c,EAAS6c,EAAc,GAAI,CAK3D,GAHI7c,EAAQ,SAAW,YAGnBA,EAAQ,SAAW,IAAK,MAAO,GAGnC,MAAMtO,EAAQsO,EAAQ,OAAS,GAI/B,GAHItO,EAAM,SAAW,GAGjB,CADYA,EAAM,MAAMhE,GAAKA,EAAE,SAAW,MAAM,EACtC,MAAO,GAGrB,MAAMovB,EAAaprB,EAAM,OAAO,CAACqrB,EAAQ/qB,IAAS,CAChD,MAAMgrB,EAAW,IAAI,KAAKhrB,EAAK,UAAU,EACzC,OAAOgrB,EAAWD,EAASC,EAAWD,CACxC,EAAG,IAAI,KAAK,CAAC,CAAC,EAGd,OAAID,EAAW,YAAc,EAAU,GAEX,KAAK,OAAO,KAAK,IAAG,EAAKA,EAAW,QAAO,IAAO,IAAO,GAAK,GAAK,GAAG,GACpED,CAChC,CC5LY,MAACI,GAAYC,GAAQ,CAC/B,MAAMhoB,EAAS,4CAA4C,KAAKgoB,CAAG,EACnE,OAAOhoB,EACH,CACE,SAASA,EAAO,CAAC,EAAG,EAAE,EACtB,SAASA,EAAO,CAAC,EAAG,EAAE,EACtB,SAASA,EAAO,CAAC,EAAG,EAAE,CAC9B,EACM,CAAC,GAAI,IAAK,GAAG,CACnB,EAUaioB,GAAoB,CAACC,EAAKC,EAAU,IAAMC,EAAU,MACxD,IAAI,QAAStuB,GAAY,CAC9B,GAAI,CAACouB,EAAK,CACRpuB,EAAQ,IAAI,EACZ,MACF,CAEA,MAAMuuB,EAAM,IAAI,MAChBA,EAAI,YAAc,YAGlB,MAAMC,EAAY,WAAW,IAAM,CACjCD,EAAI,IAAM,GACVvuB,EAAQ,IAAI,CACd,EAAGquB,CAAO,EAEVE,EAAI,OAAS,IAAM,CACjB,aAAaC,CAAS,EACtB,GAAI,CACF,MAAMC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAQF,EAAI,MACnBE,EAAO,OAASF,EAAI,OACRE,EAAO,WAAW,IAAI,EAC9B,UAAUF,EAAK,EAAG,CAAC,EAEvB,MAAMG,EAAUD,EAAO,UAAU,aAAcH,CAAO,EACtDtuB,EAAQ0uB,CAAO,CACjB,MAAY,CAEV1uB,EAAQ,IAAI,CACd,CACF,EAEAuuB,EAAI,QAAU,IAAM,CAClB,aAAaC,CAAS,EACtBxuB,EAAQ,IAAI,CACd,EAEAuuB,EAAI,IAAMH,CACZ,CAAC,EAUUO,GAAqB,MAAOC,EAAMP,EAAU,IAAMC,EAAU,MACnE,CAACM,GAAQA,EAAK,SAAW,EACpB,GAIO,MAAM,QAAQ,IAC5BA,EAAK,IAAIR,GAAOD,GAAkBC,EAAKC,EAASC,CAAO,CAAC,CAC5D,EAYO,eAAeO,GAAc1Y,EAAM2Y,EAAW,KAAMR,EAAU,GAAK,CAOxE,MALI,CAACnY,EAAK,KAAK,WAAW,QAAQ,GAK9BA,EAAK,KAAO,IAAM,KACbA,EAGF,IAAI,QAASnW,GAAY,CAC9B,MAAMyuB,EAAS,SAAS,cAAc,QAAQ,EACxCM,EAAMN,EAAO,WAAW,IAAI,EAC5BF,EAAM,IAAI,MAEhBA,EAAI,OAAS,IAAM,CACjB,GAAI,CAAE,MAAAS,EAAO,OAAAC,GAAWV,EAGpBS,EAAQF,IACVG,EAAS,KAAK,MAAOA,EAASH,EAAYE,CAAK,EAC/CA,EAAQF,GAIV,MAAMI,EAAY,KACdD,EAASC,IACXF,EAAQ,KAAK,MAAOA,EAAQE,EAAaD,CAAM,EAC/CA,EAASC,GAGXT,EAAO,MAAQO,EACfP,EAAO,OAASQ,EAGhBF,EAAI,sBAAwB,GAC5BA,EAAI,sBAAwB,OAC5BA,EAAI,UAAUR,EAAK,EAAG,EAAGS,EAAOC,CAAM,EAGtCR,EAAO,OACJ9X,GAAS,CACR,GAAIA,EAAM,CAER,MAAMwY,EAAWhZ,EAAK,KAAK,QAAQ,YAAa,EAAE,EAC5CiZ,EAAiB,IAAI,KAAK,CAACzY,CAAI,EAAG,GAAGwY,CAAQ,OAAQ,CACzD,KAAM,aACN,aAAc,KAAK,IAAG,CACpC,CAAa,EAEDnvB,EAAQovB,CAAc,CACxB,MAEE,QAAQ,KAAK,0CAA0C,EACvDpvB,EAAQmW,CAAI,CAEhB,EACA,aACAmY,CACR,EAGM,IAAI,gBAAgBC,EAAI,GAAG,CAC7B,EAEAA,EAAI,QAAU,IAAM,CAClB,QAAQ,KAAK,sDAAsD,EACnE,IAAI,gBAAgBA,EAAI,GAAG,EAC3BvuB,EAAQmW,CAAI,CACd,EAGAoY,EAAI,IAAM,IAAI,gBAAgBpY,CAAI,CACpC,CAAC,CACH,CC5KO,MAAMkZ,GAAa,CAAC,cAAe,MAAO,WAAY,WAAW,EAE3DC,GAAe,CAC1B,GAAI,CAEF,SAAU,eACV,UAAW,eACX,mBAAoB,YACpB,SAAU,WACV,OAAQ,SAGR,aAAc,gBACd,gBAAiB,oBACjB,aAAc,iBACd,QAAS,aAGT,YAAa,cACb,UAAW,YACX,SAAU,WACV,eAAgB,oBAChB,YAAa,iBACb,WAAY,gBAGZ,QAAS,UACT,eAAgB,iBAChB,cAAe,oBACf,MAAO,QACP,IAAK,MACL,OAAQ,UACR,MAAO,SAGP,eAAgB,qBAChB,cAAe,oBACf,WAAY,cACZ,SAAU,YACV,SAAU,WACV,SAAU,WACV,QAAS,WACT,OAAQ,SACR,gBAAiB,gCAGjB,SAAU,YACV,SAAU,WACV,SAAU,WACV,UAAW,uBACX,UAAW,wBACX,OAAQ,kBACR,aAAc,gBACd,OAAQ,SACR,eAAgB,UAChB,WAAY,cACZ,QAAS,UACT,SAAU,WACV,UAAW,YACX,KAAM,OACN,aAAc,QACd,YAAa,qBACb,MAAO,QACP,SAAU,wCACV,OAAQ,SACR,UAAW,aACX,UAAW,MACX,SAAU,kBACV,cAAe,gBACf,iBAAkB,yEAClB,iBAAkB,6BAClB,SAAU,YAGV,aAAc,8BACd,oBAAqB,0BACrB,kBAAmB,iCAGnB,gBAAiB,kCACjB,gBAAiB,iBACjB,SAAU,yBAGV,KAAM,OACN,KAAM,OACN,SAAU,aACV,cAAe,kBACf,YAAa,SACb,gBAAiB,sBACjB,SAAU,aACV,WAAY,gBAGZ,eAAgB,mBAChB,iBAAkB,mEAClB,YAAa,eACb,UAAW,aACX,aAAc,gBACd,cAAe,iBACf,YAAa,gBACb,WAAY,eAGZ,UAAW,UACX,WAAY,WACZ,UAAW,UAGX,cAAe,qCACf,eAAgB,0CAChB,aAAc,qCAGd,cAAe,iBACnB,EACE,GAAI,CAEF,SAAU,mBACV,UAAW,oBACX,mBAAoB,aACpB,SAAU,YACV,OAAQ,UAGR,aAAc,mBACd,gBAAiB,iBACjB,aAAc,cACd,QAAS,cAGT,YAAa,cACb,UAAW,aACX,SAAU,eACV,eAAgB,wBAChB,YAAa,qBACb,WAAY,uBAGZ,QAAS,UACT,eAAgB,kBAChB,cAAe,oBACf,MAAO,SACP,IAAK,MACL,OAAQ,UACR,MAAO,YAGP,eAAgB,4BAChB,cAAe,qBACf,WAAY,yBACZ,SAAU,sBACV,SAAU,YACV,SAAU,WACV,QAAS,UACT,OAAQ,WACR,gBAAiB,qCAGjB,SAAU,mBACV,SAAU,WACV,SAAU,WACV,UAAW,6BACX,UAAW,6BACX,OAAQ,yBACR,aAAc,0BACd,OAAQ,aACR,eAAgB,eAChB,WAAY,gBACZ,QAAS,UACT,SAAU,QACV,UAAW,aACX,KAAM,WACN,aAAc,YACd,YAAa,6BACb,MAAO,QACP,SAAU,8CACV,OAAQ,QACR,UAAW,gBACX,UAAW,MACX,SAAU,wBACV,cAAe,gBACf,iBAAkB,4EAClB,iBAAkB,6BAClB,SAAU,YAGV,aAAc,iCACd,oBAAqB,2BACrB,kBAAmB,8BAGnB,gBAAiB,gCACjB,gBAAiB,8BACjB,SAAU,2BAGV,KAAM,QACN,KAAM,YACN,SAAU,uBACV,cAAe,wBACf,YAAa,UACb,gBAAiB,0BACjB,SAAU,aACV,WAAY,cAGZ,eAAgB,uBAChB,iBAAkB,qEAClB,YAAa,iBACb,UAAW,cACX,aAAc,kBACd,cAAe,cACf,YAAa,gBACb,WAAY,kBAGZ,UAAW,UACX,WAAY,WACZ,UAAW,UAGX,cAAe,8CACf,eAAgB,oDAChB,aAAc,2CAGd,cAAe,gBACnB,CACA,ECxNA,SAAwBC,GAAgB,CACtC,QAAAve,EACA,SAAA0E,EAAU,YAAA8Z,EACV,YAAAC,EAAa,eAAAC,EACb,MAAA7Z,EAAO,SAAA8Z,EACP,EAAAze,EAAG,KAAA0e,CACL,EAAG,CACD,OACEpN,OAAC,OAAI,UAAU,kBAEb,UAAAA,OAAC,OAAI,UAAU,kBACZ,UAAAxR,EAAQ,YACPwR,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,QAAK,UAAU,mBAAmB,iBAAK,EACxCA,MAAC,QAAK,UAAU,mBAAoB,WAAQ,WAAW,GACzD,EAEF4B,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,QAAK,UAAU,mBAAmB,mBAAO,EAC1CA,MAAC,QAAK,UAAU,mBAAoB,WAAQ,KAAK,GACnD,EACC5P,EAAQ,SACPwR,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,QAAK,UAAU,mBAAmB,mBAAO,EAC1CA,MAAC,QAAK,UAAU,mBAAoB,WAAQ,QAAQ,GACtD,EAED5P,EAAQ,oBACPwR,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,QAAK,UAAU,mBAAmB,cAAE,EACrCA,MAAC,QAAK,UAAU,mBAAoB,WAAQ,mBAAmB,GACjE,GAEJ,EAEA4B,OAAC,OAAI,UAAU,eACb,UAAAA,OAAC,OAAI,UAAU,yBACb,UAAA5B,MAAC,SAAM,gBAAI,EACXA,MAAC,SACC,KAAK,OACL,MAAOlL,EACP,SAAW4L,GAAMkO,EAAYlO,EAAE,OAAO,KAAK,EAC3C,UAAU,WACZ,EACF,EACAkB,OAAC,OAAI,UAAU,yBACb,UAAA5B,MAAC,SAAM,sBAAU,EACjBA,MAAC,SACC,KAAK,OACL,YAAY,qBACZ,MAAO6O,EACP,SAAWnO,GAAMoO,EAAepO,EAAE,OAAO,KAAK,EAC9C,UAAU,YACZ,EACF,GACF,EAGAkB,OAAC,OAAI,UAAU,gCACb,UAAAA,OAAC,SACC,UAAA5B,MAACiP,GAAA,CAAS,KAAM,GAAI,UAAU,cAAc,EAC3C3e,EAAE,cAAc,EAAE,IAAC0P,MAAC,QAAK,UAAU,cAAc,aAAC,GACrD,EACAA,MAAC,YACC,YAAa1P,EAAE,mBAAmB,EAClC,MAAO2E,EACP,SAAWyL,GAAMqO,EAASrO,EAAE,OAAO,KAAK,EACxC,KAAM,EACN,UAAW,kBAAmBzL,EAAM,OAA+B,GAAtB,mBAAwB,IACvE,EACF,GACF,CAEJ,CCnFO,MAAMia,GAAkBrlB,GAAW,CACxC,GAAI,CAACA,EAAQ,MAAO,QACpB,MAAMslB,EAAUtlB,EAAO,MAAQA,EAAO,KAAK,SAAW,GAChDulB,EAAW,WAAWvlB,EAAO,KAAK,EAAI,GAAK,WAAWA,EAAO,aAAa,EAAI,EACpF,OAAKslB,EACDC,EAAiB,WACd,aAFc,OAGvB,EAGaC,GAA8B,CAACxS,EAAWyS,IAAY,CACjE,GAAI,CAACzS,GAAa,CAACyS,EAAS,OAAO,KAEnC,KAAM,CAACC,EAAWC,CAAQ,EAAI3S,EAAU,MAAM,GAAG,EAAE,IAAI,MAAM,EACvD,CAAC4S,EAASC,CAAM,EAAIJ,EAAQ,MAAM,GAAG,EAAE,IAAI,MAAM,EAEvD,IAAIK,EAAgBF,EAAU,GAAKC,GAAWH,EAAY,GAAKC,GAC3DG,EAAe,IAAGA,GAAgB,MAEtC,MAAMC,EAAaD,EAAe,GAC5BE,EAAe,KAAK,IAAID,EAAY,CAAC,EACrCE,EAAgB,KAAK,IAAI,EAAGF,EAAa,CAAC,EAEhD,MAAO,CACL,MAAOC,EAAa,QAAQ,CAAC,EAC7B,cAAeC,EAAgB,EAAIA,EAAc,QAAQ,CAAC,EAAI,GAElE,EAcA,SAAwBC,GAAU,CAAE,OAAAlmB,EAAQ,MAAAf,EAAO,SAAAknB,EAAU,SAAAC,EAAU,EAAA3f,EAAG,WAAA4f,GAAc,CACtF,MAAMC,EAAcjB,GAAerlB,CAAM,EAEzC,OACE+X,OAAC,OAAI,UAAW,2BAA2BuO,IAAgB,QAAU,UAAUA,CAAW,GAAK,EAAE,GAC/F,UAAAvO,OAAC,OAAI,UAAU,oBACZ,UAAAuO,IAAgB,kBACd,QAAK,UAAU,kBAAkB,SAAAnQ,MAAC6C,GAAA,CAAM,KAAM,GAAI,EAAE,EAEtDqN,EACDlQ,MAAC,SACC,KAAK,OACL,YAAa1P,EAAE,eAAe,EAC9B,MAAOzG,EAAO,KACd,SAAW6W,GAAMsP,EAASlnB,EAAO,OAAQ4X,EAAE,OAAO,KAAK,EACvD,UAAU,oBAEZV,MAAC,UAAO,UAAU,YAAY,QAAS,IAAMiQ,EAASnnB,CAAK,EAAG,aAAC,GACjE,EACA8Y,OAAC,OAAI,UAAU,uBACb,UAAAA,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,OAAO,EAAE,EACnB0P,MAAC,SACC,KAAK,OACL,MAAOnW,EAAO,YACd,SAAW6W,GAAMsP,EAASlnB,EAAO,cAAe4X,EAAE,OAAO,KAAK,GAChE,EACF,EACAkB,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,KAAK,EAAE,EACjB0P,MAAC,SACC,KAAK,OACL,MAAOnW,EAAO,UACd,SAAW6W,GAAMsP,EAASlnB,EAAO,YAAa4X,EAAE,OAAO,KAAK,GAC9D,EACF,EACAkB,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,QAAQ,EAAE,EACpB0P,MAAC,SACC,KAAK,SACL,YAAY,IACZ,MAAOnW,EAAO,MACd,SAAW6W,GAAMsP,EAASlnB,EAAO,QAAS4X,EAAE,OAAO,KAAK,GAC1D,EACF,EACAkB,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,OAAO,EAAE,EACnB0P,MAAC,SACC,KAAK,SACL,YAAY,IACZ,MAAOnW,EAAO,cACd,SAAW6W,GAAMsP,EAASlnB,EAAO,gBAAiB4X,EAAE,OAAO,KAAK,GAClE,EACF,GACF,GACF,CAEJ,CCvFA,SAAwB0P,GAAgB,CAAE,WAAAC,EAAY,cAAAC,EAAe,iBAAAC,EAAkB,QAAAC,EAAS,QAAA5H,EAAS,EAAAtY,GAAK,CAC5G,MAAMmgB,EAAmBxV,GAAW,CAClC,IAAIyV,EAAaC,EAAW5mB,EAAO+lB,EAEnC,OAAQ7U,EAAA,CACN,IAAK,OACHyV,EAAc,QACdC,EAAY,QACZ5mB,EAAQ,IACR+lB,EAAgB,GAChB,MACF,IAAK,OACHY,EAAc,QACdC,EAAY,QACZ5mB,EAAQ,IACR+lB,EAAgB,IAChB,MACF,IAAK,OACHY,EAAc,QACdC,EAAY,QACZ5mB,EAAQ,IACR+lB,EAAgB,GAChB,MACF,QACE,OAGJQ,EAAc,CAAE,YAAAI,EAAa,UAAAC,EAAW,MAAA5mB,EAAO,cAAA+lB,EAAe,CAChE,EAEA,OACE9P,MAAC,OAAI,UAAU,mBAAmB,QAAS4I,EACzC,SAAAhH,OAAC,OAAI,UAAU,iBAAiB,QAAUlB,GAAMA,EAAE,kBAChD,UAAAkB,OAAC,MAAG,UAAA5B,MAAC4Q,GAAA,CAAM,KAAM,GAAI,EAAE,IAAEtgB,EAAE,gBAAgB,GAAE,QAC5C,KAAE,UAAU,uBACV,SAAAA,EAAE,kBAAkB,EACvB,EAGAsR,OAAC,OAAI,UAAU,kBACb,UAAA5B,MAAC,UAAO,KAAK,SAAS,UAAU,gBAAgB,QAAS,IAAMyQ,EAAgB,MAAM,EAClF,SAAAngB,EAAE,WAAW,EAChB,EACA0P,MAAC,UAAO,KAAK,SAAS,UAAU,gBAAgB,QAAS,IAAMyQ,EAAgB,MAAM,EAClF,SAAAngB,EAAE,YAAY,EACjB,EACA0P,MAAC,UAAO,KAAK,SAAS,UAAU,gBAAgB,QAAS,IAAMyQ,EAAgB,MAAM,EAClF,SAAAngB,EAAE,WAAW,EAChB,GACF,EAEAsR,OAAC,OAAI,UAAU,gBACb,UAAAA,OAAC,OAAI,UAAU,eACb,UAAAA,OAAC,OAAI,UAAU,iBACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,aAAa,EAAE,EACzB0P,MAAC,SACC,KAAK,OACL,MAAOqQ,EAAW,YAClB,SAAW3P,GAAM,CACf,MAAMmQ,EAAWnQ,EAAE,OAAO,MACpBoQ,EAAazB,GAA4BwB,EAAUR,EAAW,SAAS,EAC7EC,EAAc,CACZ,GAAGD,EACH,YAAaQ,EACb,GAAIC,GAAc,EAAC,CACpB,CACH,GACF,EACF,EACAlP,OAAC,OAAI,UAAU,iBACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,WAAW,EAAE,EACvB0P,MAAC,SACC,KAAK,OACL,MAAOqQ,EAAW,UAClB,SAAW3P,GAAM,CACf,MAAMqQ,EAASrQ,EAAE,OAAO,MAClBoQ,EAAazB,GAA4BgB,EAAW,YAAaU,CAAM,EAC7ET,EAAc,CACZ,GAAGD,EACH,UAAWU,EACX,GAAID,GAAc,EAAC,CACpB,CACH,GACF,EACF,GACF,EACAlP,OAAC,OAAI,UAAU,eACb,UAAAA,OAAC,OAAI,UAAU,iBACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,cAAc,EAAE,EAC1B0P,MAAC,SACC,KAAK,SACL,YAAY,IACZ,MAAOqQ,EAAW,MAClB,SAAW3P,GAAM4P,EAAc,CAAE,GAAGD,EAAY,MAAO3P,EAAE,OAAO,MAAO,GACzE,EACF,EACAkB,OAAC,OAAI,UAAU,iBACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,eAAe,EAAE,EAC3B0P,MAAC,SACC,KAAK,SACL,YAAY,IACZ,MAAOqQ,EAAW,cAClB,SAAW3P,GAAM4P,EAAc,CAAE,GAAGD,EAAY,cAAe3P,EAAE,OAAO,MAAO,GACjF,EACF,GACF,GACF,EAEAkB,OAAC,OAAI,UAAU,mBACb,UAAAA,OAAC,UAAQ,UAAAtR,EAAE,aAAa,EAAE,KAAC,SAC1B,QACE,UAAAigB,EAAiB,IAAEjgB,EAAE,gBAAgB,GACxC,GACF,EAEAsR,OAAC,OAAI,UAAU,mBACb,UAAA5B,MAAC,UACC,KAAK,SACL,UAAU,oBACV,QAAS4I,EAER,WAAE,QAAQ,IAEb5I,MAAC,UACC,KAAK,SACL,UAAU,kBACV,QAASwQ,EACT,SAAU,CAACH,EAAW,OAAS,CAACA,EAAW,cAE1C,WAAE,YAAY,GACjB,EACF,GACF,EACF,CAEJ,CCrHA,SAAwBW,GAAc,CACpC,YAAAnd,EAAa,UAAAC,EAAW,SAAAC,EACxB,eAAAH,EACA,oBAAAqd,EAAqB,uBAAAC,EACrB,gBAAAC,EAAiB,aAAAC,EACjB,sBAAAC,EAAuB,oBAAAC,EACvB,WAAAC,EACA,oBAAAC,EAAqB,uBAAAC,EACrB,WAAApB,EAAY,cAAAC,EACZ,oBAAAoB,EACA,aAAAC,EAAc,oBAAAC,EACd,cAAAC,EAAe,aAAAC,EACf,mBAAAC,EAAoB,kBAAAC,EAAmB,oBAAAC,EACvC,gBAAAC,EACA,qBAAAC,GAAsB,uBAAAC,GACtB,eAAAC,GAAgB,kBAAAC,EAAmB,kBAAAC,EACnC,YAAAC,EAAa,eAAAC,GAAgB,eAAAC,EAC7B,WAAAC,EAAY,cAAAC,EAAe,cAAAC,EAC3B,iBAAAC,EAAkB,oBAAAC,EAAqB,oBAAAC,GACvC,wBAAAC,EACA,EAAA3iB,EAAG,KAAA0e,EACH,YAAApL,EACF,EAAG,CACD,MAAM2M,GAAmBoB,EAAa,OAEtC,OACE/P,OAAC,OAAI,UAAU,kBAEb,UAAAA,OAAC,OAAI,UAAU,sBACb,UAAAA,OAAC,OAAI,UAAU,kBACb,UAAA5B,MAAC,QAAK,UAAU,mBAAoB,SAAA2R,EAAa,OAAO,EACxD3R,MAAC,QAAK,UAAU,mBAAoB,SAAA2R,EAAa,SAAW,EAAIrhB,EAAE,QAAQ,EAAIA,EAAE,gBAAgB,EAAE,GACpG,EACAsR,OAAC,OAAI,UAAU,oBACb,UAAAA,OAAC,QAAK,UAAU,mBAAoB,UAAAiQ,EAAgBC,EAAa,KAAC,QACjE,QAAK,UAAU,mBAAoB,SAAgB,OAAU,CAAQ,GACxE,EACCF,EAAsB,GACrBhQ,OAAC,OAAI,UAAU,qBACb,UAAA5B,MAACkT,GAAA,CAAY,KAAM,GAAI,SACtB,QAAM,UAAAtB,EAAoB,IAAE5C,IAAS,KAAO,aAAe,aAAY,GAC1E,GAEJ,EAGApN,OAAC,OAAI,UAAU,uBACb,UAAAA,OAAC,UACC,UAAU,kBACV,QAASmQ,EACT,SAAUL,EAEV,UAAA1R,MAACmT,GAAA,CAAK,KAAM,GAAI,EAChBnT,MAAC,QAAM,SAAA0R,EAAuB1C,IAAS,KAAO,aAAe,cAAiB1e,EAAE,iBAAiB,EAAE,KAEpGqhB,EAAa,OAAS,GACrB/P,OAAC,OAAI,UAAU,yBACb,UAAA5B,MAAC,UAAO,UAAU,iBAAiB,QAAS,IAAMiS,EAAoB,KAAK,EAAG,cAAE,EAChFjS,MAAC,UAAO,UAAU,iBAAiB,QAAS,IAAMiS,EAAoB,MAAM,EAAG,eAAG,EAClFjS,MAAC,UAAO,UAAU,iBAAiB,QAAS,IAAMiS,EAAoB,KAAK,EAAG,cAAE,QAC/E,UAAO,UAAU,sBAAsB,QAAS,IAAMR,EAAuB,EAAI,EAAG,MAAOzC,IAAS,KAAO,eAAiB,uBAC3H,eAAC4B,GAAA,CAAM,KAAM,GAAI,EACnB,GACF,GAEJ,EAGCW,EAAW,OAAS,GACnB3P,OAAC,OAAI,UAAU,yBACb,UAAAA,OAAC,OAAI,UAAU,oBACb,UAAAA,OAAC,MAAG,UAAA5B,MAACqI,GAAA,CAAQ,KAAM,GAAI,EAAE,IAAE2G,IAAS,KAAO,qBAAuB,gCAA+B,QAChG,QAAK,UAAU,kBAAmB,SAAAA,IAAS,KAAO,aAAe,oBAAoB,GACxF,EACAhP,MAAC,OAAI,UAAU,eACV,WAAW,IAAI,CAACnW,EAAQf,IAAU,CAEjC,MAAMsqB,GACJvf,EAAY,KAAKqB,IAAKA,GAAE,KAAK,gBAAkBrL,EAAO,KAAK,aAAa,GACxEiK,EAAU,KAAKuf,IAAKA,GAAE,KAAK,gBAAkBxpB,EAAO,KAAK,aAAa,GACtEkK,EAAS,KAAKuf,IAAKA,GAAE,KAAK,gBAAkBzpB,EAAO,KAAK,aAAa,EACjE0pB,GAAY,OAAO,OAAO3f,CAAc,EAAE,KAAKN,IACnDA,GAAQ,KAAKE,IAAKA,GAAE,KAAK,gBAAkB3J,EAAO,KAAK,aAAa,GAEhE2pB,GAAUJ,IAAYG,GAE5B,OACE3R,OAAC,UAEC,UAAW,gBAAgB4R,GAAU,QAAU,EAAE,GACjD,QAAS,IAAM,CACRA,IACHtB,EAAgBroB,CAAM,CAE1B,EACA,SAAU2pB,GAEV,UAAAxT,MAAC,QAAK,UAAU,oBAAqB,SAAAnW,EAAO,KAAK,EACjDmW,MAAC,QAAK,UAAW,sBAAsBnW,EAAO,MAAQ,WAAW,aAAa,GAC3E,SAAAA,EAAO,MAAQ,UAClB,EACC2pB,IAAWxT,MAAC,QAAK,UAAU,qBAAsB,aAAS,IAbtDlX,CAAA,CAgBX,CAAC,EACL,GACF,EAKDuoB,GAAyB,CAACC,GACzB1P,OAAAoH,WAAA,CAEG,UAAAmI,EAAgB,IAAIlsB,GAAY,CAE/B,MAAMwuB,EAAwBrC,EAAa,OACzCsC,IAAMA,GAAG,cAAgBzuB,EAAS,IAAMgsB,EAAoB,IAAIyC,GAAG,EAAE,GAEvE,OAAID,EAAsB,SAAW,EAAU,KAE7C7R,OAAC,OAAsB,UAAU,4BAC/B,UAAA5B,MAAC,OAAI,UAAU,qBAAsB,SAAA/a,EAAS,KAAK,EAClDwuB,EAAsB,IAAIE,IACzB/R,OAAC,OAAwB,UAAU,WACjC,UAAAA,OAAC,OAAI,UAAU,kBACb,UAAA5B,MAAC,SAAO,YAAW,KAAK,EACxBA,MAAC,UACC,KAAK,SACL,UAAU,sBACV,QAAS,IAAMoS,GAAuBuB,GAAW,EAAE,EACnD,MAAO3E,IAAS,KAAO,0BAA4B,sBAElD,cACH,EACF,EACAhP,MAAC,OAAI,UAAU,kBACX,UAAApM,EAAe+f,GAAW,EAAE,GAAK,IAAI,IAAI,CAAC9pB,GAAQ+pB,KAClD5T,MAAC+P,GAAA,CAEC,OAAAlmB,GACA,MAAO+pB,GACP,SAAU,CAAChnB,GAAGrP,GAAOiD,KAAUuyB,EAAoBY,GAAW,GAAI/mB,GAAGrP,GAAOiD,EAAK,EACjF,SAAWoM,IAAMomB,GAAoBW,GAAW,GAAI/mB,EAAC,EACrD,EAAA0D,CAAA,EALKsjB,EAAA,CAOR,EACH,EACAhS,OAAC,UAAO,UAAU,aAAa,QAAS,IAAMkR,EAAiBa,GAAW,EAAE,EAAG,eAC1E3E,IAAS,KAAO,MAAQ,UAAU,IAAE2E,GAAW,MACpD,IA1BQA,GAAW,EA2BrB,CACD,IA/BO1uB,EAAS,EAgCnB,CAEJ,CAAC,EAGAmsB,EAAa,OAAOsC,GAAM,CAACA,EAAG,aAAezC,EAAoB,IAAIyC,EAAG,EAAE,CAAC,EAAE,OAC5E9R,OAAC,OAAwB,UAAU,WACjC,UAAAA,OAAC,OAAI,UAAU,kBACb,UAAA5B,MAAC,SAAO,WAAW,KAAK,EACxBA,MAAC,UACC,KAAK,SACL,UAAU,sBACV,QAAS,IAAMoS,GAAuBuB,EAAW,EAAE,EACnD,MAAO3E,IAAS,KAAO,0BAA4B,sBAElD,cACH,EACF,EACAhP,MAAC,OAAI,UAAU,kBACX,UAAApM,EAAe+f,EAAW,EAAE,GAAK,IAAI,IAAI,CAAC9pB,EAAQ+pB,KAClD5T,MAAC+P,GAAA,CAEC,OAAAlmB,EACA,MAAO+pB,GACP,SAAU,CAAChnB,GAAGrP,GAAOiD,KAAUuyB,EAAoBY,EAAW,GAAI/mB,GAAGrP,GAAOiD,EAAK,EACjF,SAAWoM,IAAMomB,GAAoBW,EAAW,GAAI/mB,EAAC,EACrD,EAAA0D,CAAA,EALKsjB,EAAA,CAOR,EACH,EACAhS,OAAC,UAAO,UAAU,aAAa,QAAS,IAAMkR,EAAiBa,EAAW,EAAE,EAAG,eAC1E3E,IAAS,KAAO,MAAQ,UAAU,IAAE2E,EAAW,MACpD,IA1BQA,EAAW,EA2BrB,CACD,EAGAV,IAA0B,OAAS,GAClCjT,MAAC,OAAI,UAAU,6BACb,SAAA4B,OAAC,UACC,UAAU,4BACV,MAAM,GACN,SAAWlB,GAAM,CACXA,EAAE,OAAO,OACXyR,GAAqBzR,EAAE,OAAO,KAAK,CAEvC,EAEA,UAAAkB,OAAC,UAAO,MAAM,GAAG,eACZoN,IAAS,KAAO,qBAAuB,+BAC5C,EACCmC,EAAgB,IAAIlsB,GAAY,CAC/B,MAAM4uB,EAAqBZ,IAA0B,WAAaS,GAAG,cAAgBzuB,EAAS,EAAE,EAChG,OAAI4uB,EAAmB,SAAW,EAAU,KAE1C7T,MAAC,YAA2B,MAAO/a,EAAS,KACzC,SAAA4uB,EAAmB,QAClB7T,MAAC,UAAmB,MAAO0T,GAAG,GAAK,YAAG,MAAzBA,GAAG,EAA2B,CAC5C,GAHYzuB,EAAS,EAIxB,CAEJ,CAAC,EAEAguB,IAA0B,OAAOS,GAAM,CAACA,EAAG,WAAW,EAAE,OAAS,SAC/D,YAAS,MAAO1E,IAAS,KAAO,QAAU,QACxC,SAAAiE,EAAA,EAA0B,UAAa,CAACS,EAAG,WAAW,EAAE,IAAIA,GAC3D1T,MAAC,UAAmB,MAAO0T,EAAG,GAAK,SAAAA,EAAG,MAAzBA,EAAG,EAA2B,CAC5C,EACH,KAGN,EAIDzC,EAAoB,OAAS,GAC5BjR,MAAC,OAAI,UAAU,sBACb,SAAAA,MAAC,KACE,SAAAgP,IAAS,KACN,+EACA,qFAEN,EACF,GAEJ,EAIDsC,GACC1P,OAAC,OAAI,UAAU,2BACb,UAAA5B,MAAC8L,GAAA,CAAQ,KAAM,GAAI,UAAU,aAAa,EAC1C9L,MAAC,QAAM,SAAAgP,IAAS,KAAO,2BAA6B,gCAAgC,GACtF,EAID,CAACqC,GAAyB,CAACC,GAC1B1P,OAAAoH,WAAA,CAEE,UAAApH,OAAC,OAAI,UAAU,WACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,aAAa,EAAE,EACzB0P,MAAC,OAAI,UAAU,kBACZ,WAAY,IAAI,CAAC8T,EAAKhrB,IACrBkX,MAAC+P,GAAA,CAEC,OAAQ+D,EACR,MAAAhrB,EACA,SAAUwpB,EACV,SAAUC,EACV,EAAAjiB,EACA,WACE0P,MAAC,OAAI,UAAU,iBACb,SAAA4B,OAAC,UACC,MAAOkS,EAAI,KACX,SAAWpT,IAAM4R,EAAkBxpB,EAAO,OAAQ4X,GAAE,OAAO,KAAK,EAEhE,UAAAV,MAAC,UAAO,MAAM,UAAW,SAAA1P,EAAE,SAAS,EAAE,QACrC,UAAO,MAAM,iBAAkB,SAAAA,EAAE,gBAAgB,EAAE,IACtD,CACF,GAfGxH,CAAA,CAkBR,EACH,EACAkX,MAAC,UAAO,UAAU,aAAa,QAASqS,GACrC,SAAA/hB,EAAE,gBAAgB,EACrB,GACF,EAGAsR,OAAC,OAAI,UAAU,WACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,WAAW,EAAE,EACvB0P,MAAC,OAAI,UAAU,kBACZ,WAAU,IAAI,CAAC+T,EAAUjrB,IACxBkX,MAAC+P,GAAA,CAEC,OAAQgE,EACR,MAAAjrB,EACA,SAAU2pB,GACV,SAAUC,EACV,EAAApiB,CAAA,EALKxH,CAAA,CAOR,EACH,EACAkX,MAAC,UAAO,UAAU,aAAa,QAASwS,EACrC,SAAAliB,EAAE,aAAa,EAClB,GACF,EAGAsR,OAAC,OAAI,UAAU,WACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,UAAU,EAAE,EACtB0P,MAAC,OAAI,UAAU,kBACZ,WAAS,IAAI,CAACgU,EAASlrB,IACtBkX,MAAC+P,GAAA,CAEC,OAAQiE,EACR,MAAAlrB,EACA,SAAU8pB,EACV,SAAUC,EACV,EAAAviB,CAAA,EALKxH,CAAA,CAOR,EACH,EACAkX,MAAC,UAAO,UAAU,aAAa,QAAS2S,EACrC,SAAAriB,EAAE,YAAY,EACjB,GACF,GACF,EAIDkhB,GACCxR,MAACoQ,GAAA,CACC,WAAAC,EACA,cAAAC,EACA,iBAAAC,GACA,QAASyB,EACT,QAAS,IAAMP,EAAuB,EAAK,EAC3C,EAAAnhB,CAAA,EACF,EAEJ,CAEJ,CCpWA,SAAwB2jB,GAAc,CAAE,UAAAryB,EAAW,MAAA5B,EAAO,SAAAk0B,EAAU,EAAA5jB,EAAG,KAAA0e,EAAM,YAAApL,GAAe,CAC1F,KAAM,CAACuQ,EAAkBC,CAAmB,EAAI1V,WAAS,IAAI,EACvD,CAAC2V,EAAeC,CAAgB,EAAI5V,WAAS,EAAE,EAC/C,CAAC6V,EAAcC,CAAe,EAAI9V,WAAS,EAAK,EAChD,CAAC+V,EAAgBC,CAAiB,EAAIhW,WAAS,EAAE,EACjD,CAACiW,EAAeC,CAAgB,EAAIlW,WAAS,EAAE,EAC/C,CAACmW,EAAcC,CAAe,EAAIpW,WAAS,EAAE,EAC7C,CAACqW,EAAgBC,CAAiB,EAAItW,WAAS,EAAK,EACpD,CAACuW,EAAYC,CAAa,EAAIxW,WAAS,CAAE,KAAM,GAAI,SAAU,GAAI,SAAU,GAAI,EAC/EyW,EAAqB3Q,SAAO,IAAI,EAChC4Q,EAAkB5Q,SAAO,IAAI,EAGnC3F,YAAU,IAAM,CACVsV,GAAoBvyB,GACtByzB,GAAkBlB,CAAgB,CAEtC,EAAG,CAACA,EAAkBvyB,CAAS,CAAC,EAGhCid,YAAU,KACJ,CAACsV,GAAoBgB,EAAmB,UAC1CC,EAAgB,QAAU,WAAW,IAAM,CACzCD,EAAmB,SAAS,OAC9B,EAAG,GAAG,GAED,IAAM,CACPC,EAAgB,SAAS,aAAaA,EAAgB,OAAO,CACnE,GACC,CAACjB,CAAgB,CAAC,EAErB,MAAMkB,GAAoB,MAAOpwB,GAAa,CAC5CuvB,EAAgB,EAAI,EACpB,GAAI,CACF,MAAM10B,EAAO,MAAMZ,EAAG,gCAAgC0C,EAAWqD,CAAQ,EACzEqvB,EAAiBx0B,CAAI,CACvB,OAASuE,EAAO,CACd,QAAQ,MAAM,uBAAwBA,CAAK,EAC3Cuf,EAAY,sBAAuB,OAAO,CAC5C,SACE4Q,EAAgB,EAAK,CACvB,CACF,EAEMc,GAAmB,SAAY,CACnC,GAAI,EAAAT,EAAa,OAAS,GAC1B,GAAI,CACF,MAAMU,EAAW,GACjB,UAAWtwB,KAAYwpB,GAAY,CACjC,MAAM3uB,EAAO,MAAMZ,EAAG,gCAAgC0C,EAAWqD,CAAQ,EACzEswB,EAAS,KAAK,GAAGz1B,EAAK,IAAIK,IAAS,CAAE,GAAGA,EAAM,SAAA8E,CAAA,EAAW,CAAC,CAC5D,CACA6vB,EAAgBS,CAAQ,CAC1B,OAASlxB,EAAO,CACd,QAAQ,MAAM,+BAAgCA,CAAK,CACrD,CACF,EAEMmxB,GAAwBpuB,GAAU,CAEtC,GADAstB,EAAkBttB,CAAK,EACnB,CAACA,EAAM,OAAQ,CACjBwtB,EAAiB,EAAE,EACnB,MACF,CACA,MAAMa,EAAaruB,EAAM,cACnBtD,EAAU+wB,EAAa,OAAO10B,GAClCA,EAAK,KAAK,cAAc,SAASs1B,CAAU,GAC3Ct1B,EAAK,SAAS,cAAc,SAASs1B,CAAU,GAEjDb,EAAiB9wB,EAAQ,MAAM,EAAG,EAAE,CAAC,CACvC,EAEM4xB,EAAcv1B,GAAS,CAC3B,MAAM2a,EAAgB9a,EAAM,aAAe4M,EAAE,wBAA0BzM,EAAK,EAAE,EAC1E2a,GAAiB,EACnBoZ,EAASl0B,EAAM,IAAI,CAAC21B,EAAI/oB,IACtBA,IAAMkO,EAAgB,CAAE,GAAG6a,EAAI,SAAUA,EAAG,SAAW,GAAMA,CAAA,CAC9D,EAEDzB,EAAS,CAAC,GAAGl0B,EAAO,CAClB,sBAAuBG,EAAK,GAC5B,KAAMA,EAAK,KACX,KAAMA,EAAK,KACX,SAAUA,EAAK,SACf,SAAU,EACV,SAAU,GACX,CAAC,EAEJyjB,EAAY,SAASzjB,EAAK,IAAI,GAAI,SAAS,CAC7C,EAEMy1B,EAAuB,IAAM,CACjC,GAAI,CAACX,EAAW,MAAQ,CAACA,EAAW,UAAY,CAACA,EAAW,SAAU,CACpErR,EAAY,qBAAsB,OAAO,EACzC,MACF,CACAsQ,EAAS,CAAC,GAAGl0B,EAAO,CAClB,sBAAuB,KACvB,YAAai1B,EAAW,KACxB,gBAAiBA,EAAW,SAC5B,KAAMA,EAAW,KACjB,SAAUA,EAAW,SACrB,SAAU,WAAWA,EAAW,QAAQ,EACxC,KAAM,OACN,SAAU,GACX,CAAC,EACFC,EAAc,CAAE,KAAM,GAAI,SAAU,GAAI,SAAU,GAAI,EACtDF,EAAkB,EAAK,EACvBZ,EAAoB,IAAI,EACxBxQ,EAAY,oBAAqB,SAAS,CAC5C,EAEMiS,EAAqB,CAAC/sB,EAAON,IAAa,CAC9C,MAAMC,EAAM,WAAWD,CAAQ,GAAK,EAChCC,GAAO,EACTyrB,EAASl0B,EAAM,OAAO,CAAC81B,EAAGlpB,IAAMA,IAAM9D,CAAK,CAAC,EAE5CorB,EAASl0B,EAAM,IAAI,CAACG,EAAMyM,IACxBA,IAAM9D,EAAQ,CAAE,GAAG3I,EAAM,SAAUsI,GAAQtI,CAAA,CAC5C,CAEL,EAEM41B,GAAS,IAAM,CACfhB,EACFC,EAAkB,EAAK,EACdb,IACTC,EAAoB,IAAI,EACxBY,EAAkB,EAAK,EAE3B,EAGA,OAAIb,GAAoBY,EAEpBnT,OAAC,OAAI,UAAU,kBACb,UAAAA,OAAC,OAAI,UAAU,mBAAmB,MAAO,CAAE,OAAQ,yBAA0B,QAAS,gBACpF,UAAA5B,MAAC,UAAO,UAAU,cAAc,QAAS+V,GAAS,aAAS,EAC3D/V,MAAC,MAAI,SAAA+U,EAAiB,kBAAoBZ,EAAiB,EAC3DvS,OAAC,OAAI,UAAU,gBAAiB,UAAA5hB,EAAM,OAAO,UAAM,GACrD,EAEC+0B,EACCnT,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,OAAI,UAAU,WACb,UAAA5B,MAAC,SAAM,qBAAS,EAChBA,MAAC,SACC,KAAK,OACL,YAAY,oBACZ,MAAOiV,EAAW,KAClB,SAAWvU,GAAMwU,EAAc,CAAE,GAAGD,EAAY,KAAMvU,EAAE,OAAO,MAAO,EACtE,UAAS,IACX,EACF,EACAkB,OAAC,OAAI,UAAU,WACb,UAAA5B,MAAC,SAAM,oBAAQ,QACd,OAAI,UAAU,qBACZ,SAAAyO,GAAW,IAAIriB,GACd4T,MAAC,UAEC,UAAW,eAAeiV,EAAW,WAAa7oB,EAAM,SAAW,EAAE,GACrE,QAAS,IAAM8oB,EAAc,CAAE,GAAGD,EAAY,SAAU7oB,EAAK,EAE5D,SAAAA,CAAA,EAJIA,CAAA,CAMR,EACH,GACF,EACAwV,OAAC,OAAI,UAAU,WACb,UAAA5B,MAAC,SAAM,oBAAQ,EACfA,MAAC,SACC,KAAK,SACL,YAAY,YACZ,MAAOiV,EAAW,SAClB,SAAWvU,GAAMwU,EAAc,CAAE,GAAGD,EAAY,SAAUvU,EAAE,OAAO,MAAO,GAC5E,EACF,QACC,UAAO,UAAU,qBAAqB,QAASkV,EAAsB,2BAEtE,GACF,EAEA5V,MAAC,OAAI,UAAU,eACZ,SAAAuU,EACCvU,MAAC,OAAI,UAAU,aAAa,sBAAU,EAEtC4B,OAAAoH,WAAA,CACG,UAAAqL,EAAc,IAAIl0B,GAAQ,CACzB,MAAM61B,EAAQh2B,EAAM,QAAU4M,EAAE,wBAA0BzM,EAAK,EAAE,EACjE,OACEyhB,OAAC,UAEC,UAAW,gBAAgBoU,EAAQ,QAAU,EAAE,GAC/C,QAAS,IAAMN,EAAWv1B,CAAI,EAE9B,UAAA6f,MAAC,QAAK,UAAU,eAAgB,SAAA7f,EAAK,KAAK,EAC1C6f,MAAC,QAAK,UAAU,eAAgB,WAAK,KAAK,EACzCgW,GAAShW,MAAC,QAAK,UAAU,gBAAiB,WAAM,SAAS,IANrD7f,EAAK,GAShB,CAAC,EACDyhB,OAAC,UACC,UAAU,sBACV,QAAS,IAAMoT,EAAkB,EAAI,EAErC,UAAAhV,MAAC,QAAK,UAAU,eAAe,uBAAW,EAC1CA,MAAC,QAAK,UAAU,eAAe,uBAAW,IAC5C,EACF,EAEJ,EAGD,CAAC+U,GAAkB/0B,EAAM,OAAS,SAChC,OAAI,UAAU,mBACb,SAAA4hB,OAAC,UAAO,UAAU,qBAAqB,QAAS,IAAMwS,EAAoB,IAAI,EAAG,0BACjEp0B,EAAM,OAAO,WAC7B,EACF,GAEJ,EAMF4hB,OAAC,OAAI,UAAU,kBAEb,UAAAA,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAA5B,MAACiW,GAAA,CAAO,KAAM,GAAI,UAAU,iBAAiB,EAC7CjW,MAAC,SACC,IAAKmV,EACL,KAAK,OACL,YAAa7kB,EAAE,iBAAiB,EAChC,MAAOmkB,EACP,SAAW/T,GAAM8U,GAAqB9U,EAAE,OAAO,KAAK,EACpD,QAAS,IAAM4U,GAAA,EACf,UAAU,oBAEXb,GACCzU,MAAC,UAAO,UAAU,kBAAkB,QAAS,IAAM,CAAE0U,EAAkB,EAAE,EAAGE,EAAiB,EAAE,CAAG,EAAI,aAAS,GAEnH,EAGCH,GAAkBE,EAAc,OAAS,GACxC3U,MAAC,OAAI,UAAU,oBACZ,SAAA2U,EAAc,IAAI,CAACx0B,EAAMyzB,IAAQ,CAChC,MAAMsC,EAAel2B,EAAM,QAAU4M,EAAE,KAAOzM,EAAK,EAAE,EACrD,OACEyhB,OAAC,UAEC,UAAW,yBAAyBsU,EAAe,QAAU,EAAE,GAC/D,QAAS,IAAM,CACTA,EACFL,EAAmB71B,EAAM,QAAQk2B,CAAY,EAAGA,EAAa,SAAW,CAAC,EAEzEhC,EAAS,CAAC,GAAGl0B,EAAO,CAAE,GAAGG,EAAM,SAAU,EAAG,SAAU,GAAO,CAAC,EAEhEu0B,EAAkB,EAAE,EACpBE,EAAiB,EAAE,CACrB,EAEA,UAAA5U,MAAC,QAAK,UAAU,wBAAyB,SAAA7f,EAAK,KAAK,EACnD6f,MAAC,QAAK,UAAU,4BAA6B,WAAK,SAAS,EAC1DkW,GAAgBtU,OAAC,QAAK,UAAU,uBAAwB,cAAUsU,EAAa,UAAS,IAdpFtC,CAAA,CAiBX,CAAC,EACH,EAEDa,GAAkBE,EAAc,SAAW,GAC1C3U,MAAC,OAAI,UAAU,uBAAwB,SAAA1P,EAAE,iBAAiB,EAAE,GAEhE,EAEAsR,OAAC,OAAI,UAAU,WACb,UAAA5B,MAAC,SAAO,SAAA1P,EAAE,UAAU,EAAE,QACrB,OAAI,UAAU,mBACZ,SAAAme,GAAW,IAAIriB,GAAO,CACrB,MAAM+pB,EAAWn2B,EAAM,OAAO4M,GAAKA,EAAE,WAAaR,CAAG,EACrD,OACEwV,OAAC,UAEC,UAAU,mBACV,QAAS,IAAMwS,EAAoBhoB,CAAG,EAEtC,UAAA4T,MAAC,QAAK,UAAU,cAAe,SAAA5T,EAAI,EAClC+pB,EAAS,OAAS,GACjBnW,MAAC,QAAK,UAAU,eAAgB,WAAS,OAAO,IAN7C5T,CAAA,CAUX,CAAC,EACH,GACF,EAECpM,EAAM,OAAS,GACd4hB,OAAC,OAAI,UAAU,WACb,UAAAA,OAAC,SAAM,0BAAc5hB,EAAM,OAAO,KAAC,EACnCggB,MAAC,OAAI,UAAU,gBACZ,SAAAhgB,EAAM,IAAI,CAACG,EAAM2I,IAChB8Y,OAAC,OAAgB,UAAU,gBACzB,UAAAA,OAAC,OAAI,UAAU,gBACZ,UAAAzhB,EAAK,UAAY6f,MAAC,QAAK,UAAU,kBAAkB,kBAAM,EAC1DA,MAAC,QAAK,UAAU,gBAAiB,WAAK,KAAK,GAC7C,EACA4B,OAAC,OAAI,UAAU,eACb,UAAA5B,MAAC,UAAO,QAAS,IAAM6V,EAAmB/sB,EAAO3I,EAAK,SAAW,CAAC,EAAI,aAAS,EAC/E6f,MAAC,QAAM,SAAA7f,EAAK,SAAS,EACrB6f,MAAC,UAAO,QAAS,IAAM6V,EAAmB/sB,EAAO3I,EAAK,SAAW,CAAC,EAAG,aAAC,GACxE,IATQ2I,CAUV,CACD,EACH,GACF,GAEJ,CAEJ,CCjUA,SAAwBstB,GAAa,CACnC,OAAAliB,EAAQ,WAAAmiB,EAAY,cAAAC,EACpB,UAAAC,EACA,cAAAC,EAAe,iBAAAC,EACf,eAAAC,EACA,KAAA1H,CACF,EAAG,CACD,OACEpN,OAAAoH,WAAA,CAEE,UAAApH,OAAC,OAAI,UAAW,4BAA4B1N,EAAO,OAAS,EAAI,cAAgB,cAAc,GAC5F,UAAA0N,OAAC,OAAI,UAAU,wBACb,UAAA5B,MAAC,OAAI,UAAU,sBACb,eAAC2W,GAAA,CAAO,KAAM,GAAI,EACpB,EACA/U,OAAC,OAAI,UAAU,uBACb,UAAA5B,MAAC,MAAI,SAAAgP,IAAS,KAAO,iBAAmB,wBAA6B,QACpE,QAAK,UAAU,wBACb,SAAA9a,EAAO,OAAS,EACb,GAAGA,EAAO,MAAM,IAAI8a,IAAS,KAAO,iBAAmB,qBAAqB,GAC3EA,IAAS,KAAO,0BAA4B,+BAEnD,GACF,GACF,EACC9a,EAAO,OAAS,GACf8L,MAAC,OAAI,UAAU,uBACZ,SAAA9L,EAAO,IAAImG,GACVuH,OAAC,OAAmB,UAAU,yBAC5B,UAAA5B,MAAC,OAAI,IAAK3F,EAAM,WAAY,IAAKA,EAAM,KAAM,EAC7C2F,MAAC,UAAO,UAAU,oBAAoB,QAAS,IAAMsW,EAAcjc,EAAM,EAAE,EAAI,aAAS,IAFhFA,EAAM,EAGhB,CACD,EACH,EAEFuH,OAAC,SAAM,UAAW,sBAAsB1N,EAAO,SAAW,EAAI,UAAY,EAAE,GAC1E,UAAA8L,MAAC,SACC,KAAK,OACL,OAAO,UACP,SAAQ,GACR,SAAUqW,EACV,MAAO,CAAE,QAAS,OAAO,GAE3BrW,MAAC2W,GAAA,CAAO,KAAM,GAAI,EAClB3W,MAAC,QAAM,SAAA9L,EAAO,OAAS,EAAK8a,IAAS,KAAO,kBAAoB,oBAA6BA,IAAS,KAAO,aAAe,gBAAiB,GAC/I,GACF,SAGC,OAAI,UAAW,4BAA4BwH,EAAgB,cAAgB,EAAE,GAC5E,UAAA5U,OAAC,OAAI,UAAU,wBACb,UAAA5B,MAAC,OAAI,UAAU,0BACb,eAAC4W,GAAA,CAAK,KAAM,GAAI,EAClB,EACAhV,OAAC,OAAI,UAAU,uBACb,UAAA5B,MAAC,MAAI,SAAAgP,IAAS,KAAO,uBAAyB,6BAA6B,EAC3EhP,MAAC,QAAK,UAAU,wBACb,SAAAwW,EACG,GAAGxH,IAAS,KAAO,YAAc,aAAa,KAAK0H,EAAe,KAAK73B,GAAKA,EAAE,KAAO23B,CAAa,GAAG,YAAc,EAAE,GACpHxH,IAAS,KAAO,oCAAsC,wCAE7D,GACF,GACF,EACApN,OAAC,UACC,MAAO4U,EACP,SAAW9V,GAAM+V,EAAiB/V,EAAE,OAAO,KAAK,EAChD,UAAU,0BAEV,UAAAV,MAAC,UAAO,MAAM,GAAI,SAAAgP,IAAS,KAAO,gCAAkC,mCAAmC,EACtG0H,EAAe,IAAInvB,UACjB,UAAoB,MAAOA,EAAI,GAC7B,UAAAA,EAAI,WAAW,KAAGA,EAAI,OAAS,WAAW,KAAGA,EAAI,OAAO,MAD9CA,EAAI,EAEjB,CACD,KAEFmvB,EAAe,SAAW,GACzB1W,MAAC,KAAE,UAAU,cAAe,SAAAgP,IAAS,KAAO,4CAA8C,yCAAyC,GAEvI,GACF,CAEJ,CC3FA,MAAM6H,GAAyBC,OAAK,IAAAC,GAAA,IAAM,OAAO,sCAA2B,iCAAC,EACvEC,GAAoBF,OAAK,IAAAC,GAAA,IAAM,OAAO,iCAAsB,iCAAC,EA0BnE,SAAwBE,GAAW,CACjC,KAAAC,EAAM,QAAAC,EACN,QAAA/mB,EAAS,UAAAxO,EACT,SAAAkT,EAAU,YAAA+Z,EAAa,MAAA5Z,EACvB,OAAAf,EAAQ,WAAAmiB,EAAY,cAAAC,EAAe,UAAAC,EACnC,cAAAC,EAAe,iBAAAC,EAAkB,eAAAC,EACjC,MAAA12B,EACA,sBAAAqxB,EACA,wBAAA+F,EAAyB,iBAAAC,EAAkB,eAAAC,EAAgB,cAAAC,EAC3D,aAAAC,EAAc,cAAA3F,EAAe,aAAAC,EAC7B,gBAAA2F,EAAiB,mBAAAC,GACjB,gBAAAC,GACA,WAAAC,GAAY,eAAAC,EACZ,aAAAC,EAAc,gBAAAC,EACd,uBAAAC,GAAwB,0BAAAC,EACxB,oBAAAC,EAAqB,uBAAAC,EACrB,mBAAAC,EACA,EAAA9nB,EAAG,KAAA0e,EACH,YAAApL,EACF,EAAG,CAED,OAAIsT,IAAS,GAAKS,GAEd/V,OAAC,OAAI,UAAU,kCACb,UAAAA,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,OAAI,UAAU,kBACb,eAACqY,GAAA,CAAa,KAAM,GAAI,EAC1B,EACArY,MAAC,MAAI,SAAAgP,IAAS,KAAO,wBAA0B,uBAA4B,QAC1E,KAAE,UAAU,sBACV,SAAAA,IAAS,KACN,gEACA,qEACN,GACF,EAEApN,OAAC,OAAI,UAAU,qBACb,UAAAA,OAAC,OAAI,UAAU,kBACb,UAAA5B,MAAC,QAAK,UAAU,wBAAyB,SAAAwX,EAAa,QACrD,QAAK,UAAU,wBAAyB,SAAAxI,IAAS,KAAO,UAAY,eAAe,GACtF,EACApN,OAAC,OAAI,UAAU,kBACb,UAAA5B,MAAC,QAAK,UAAU,wBAAyB,SAAA6R,EAAgBC,EAAa,QACrE,QAAK,UAAU,wBAAyB,SAAA9C,IAAS,KAAO,cAAgB,cAAc,GACzF,EACApN,OAAC,OAAI,UAAU,kBACb,UAAA5B,MAAC,QAAK,UAAU,wBAAyB,aAAI,KAAKlL,CAAQ,EAAE,mBAAmB,QAAS,CAAE,MAAO,QAAS,IAAK,UAAW,EAAE,QAC3H,QAAK,UAAU,wBAAyB,SAAAka,IAAS,KAAO,YAAc,QAAQ,GACjF,GACF,EAGC9a,EAAO,KAAKlE,GAAKA,EAAE,SAAW,QAAQ,GACrC4R,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAA5B,MAACkT,GAAA,CAAY,KAAM,GAAI,EACvBlT,MAAC,QACE,SAAAgP,IAAS,KACN,GAAG9a,EAAO,OAAOlE,GAAKA,EAAE,SAAW,QAAQ,EAAE,MAAM,6BACnD,GAAGkE,EAAO,OAAOlE,GAAKA,EAAE,SAAW,QAAQ,EAAE,MAAM,0BACzD,GACF,QACC,OAAI,UAAU,wBACZ,SAAAkE,EAAO,OAAOlE,GAAKA,EAAE,SAAW,QAAQ,EAAE,IAAIqK,GAC7CuH,OAAC,OAAmB,UAAU,uBAC5B,UAAA5B,MAAC,OAAI,IAAK3F,EAAM,WAAY,IAAKA,EAAM,KAAM,EAC7C2F,MAAC,OAAI,UAAU,0BACb,SAAAA,MAAC,UACC,UAAU,qBACV,QAAS,IAAMoY,EAAmB/d,EAAM,GAAIsd,GAAgB,EAAE,EAC9D,SAAUtd,EAAM,SAAW,aAAeA,EAAM,SAAW,cAE1D,SAAAA,EAAM,SAAW,aAAeA,EAAM,SAAW,cAChD2F,MAAC8L,GAAA,CAAQ,KAAM,GAAI,UAAU,aAAa,EAE1ClK,OAAAoH,WAAA,CACE,UAAAhJ,MAACsY,GAAA,CAAU,KAAM,GAAI,EACrBtY,MAAC,QAAM,SAAAgP,IAAS,KAAO,QAAU,aAAa,GAChD,IAGN,EACC3U,EAAM,OACLuH,OAAC,OAAI,UAAU,wBAAwB,MAAOvH,EAAM,MACjD,UAAAA,EAAM,MAAM,UAAU,EAAG,EAAE,EAAGA,EAAM,MAAM,OAAS,GAAK,MAAQ,IACnE,IArBMA,EAAM,EAuBhB,CACD,EACH,EACAuH,OAAC,UACC,UAAU,mBACV,QAAS,SAAY,CACnB,MAAM2W,EAAerkB,EAAO,OAAOlE,GAAKA,EAAE,SAAW,QAAQ,EAC7D,UAAWqK,KAASke,EAClB,MAAMH,EAAmB/d,EAAM,GAAIsd,GAAgB,EAAE,CAEzD,EAEA,UAAA3X,MAACsY,GAAA,CAAU,KAAM,GAAI,EACpBtJ,IAAS,KAAO,0BAA4B,+BAC/C,EACF,EAID9a,EAAO,OAAS,GAAKA,EAAO,MAAMlE,GAAKA,EAAE,SAAW,WAAW,GAC9D4R,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC6C,GAAA,CAAM,KAAM,GAAI,EACjB7C,MAAC,QACE,SAAAgP,IAAS,KACN,OAAO9a,EAAO,MAAM,kCACpB,GAAGA,EAAO,MAAM,gCACtB,GACF,EAGF0N,OAAC,OAAI,UAAU,uBACb,UAAA5B,MAAC,MAAI,SAAAgP,IAAS,KAAO,uBAAyB,4BAA4B,QACzE,KAAE,UAAU,2BACV,SAAAA,IAAS,KACN,qEACA,iFACN,EAEC8I,EACClW,OAAC,OAAI,UAAU,yBACb,UAAA5B,MAACqY,GAAA,CAAa,KAAM,GAAI,UAAU,iBAAiB,EACnDrY,MAAC,QAAM,SAAAgP,IAAS,KAAO,8BAAgC,iCAAsC,GAC/F,EAEApN,OAAC,OAAI,UAAU,uBACb,UAAAA,OAAC,UACC,UAAU,kCACV,QAAS,IAAMuW,EAAuB,EAAI,EAE1C,UAAAnY,MAAC,OAAI,UAAU,2BACb,eAACwY,GAAA,CAAQ,KAAM,GAAI,EACrB,EACA5W,OAAC,OAAI,UAAU,2BACb,UAAA5B,MAAC,QAAK,UAAU,4BACb,SAAAgP,IAAS,KAAO,qBAAuB,eAC1C,QACC,QAAK,UAAU,2BACb,SAAAA,IAAS,KAAO,8BAAgC,oCACnD,GACF,KAGFpN,OAAC,UACC,UAAU,0BACV,QAAS,IAAMqW,EAA0B,EAAI,EAE7C,UAAAjY,MAAC,OAAI,UAAU,2BACb,eAACwY,GAAA,CAAQ,KAAM,GAAI,EACrB,EACA5W,OAAC,OAAI,UAAU,2BACb,UAAA5B,MAAC,QAAK,UAAU,4BACb,SAAAgP,IAAS,KAAO,sBAAwB,gBAC3C,QACC,QAAK,UAAU,2BACb,SAAAA,IAAS,KAAO,8BAAgC,mCACnD,GACF,IACF,EACF,GAEJ,EAGCgJ,UACES,WAAA,CAAS,eAAW,OAAI,UAAU,UAAU,sBAAU,EACrD,SAAAzY,MAAC6W,GAAA,CACC,aAAa,YACb,WAAYc,GAAgB,GAC5B,UAAA/1B,EACA,UAAWwO,EAAQ,GACnB,QAAAA,EACA,cAAe,SAAS,IAAI,KAAK0E,CAAQ,EAAE,oBAAoB,GAC/D,QAAS,IAAMmjB,EAA0B,EAAK,EAC9C,YAAArU,EAAA,GAEJ,EAIDsU,SACEO,WAAA,CAAS,eAAW,OAAI,UAAU,UAAU,sBAAU,EACrD,SAAAzY,MAACgX,GAAA,CACC,SAAUW,GAAgB,GAC1B,cAAe,CACb,SAAA7iB,EACA,YAAa0iB,EACb,WAAY3F,EAAgBC,CAAA,EAE9B,KAAA9C,EACA,OAAQ,IAAM,CACZmJ,EAAuB,EAAK,EAC5BJ,EAAgB,EAAI,CACtB,EACA,QAAS,IAAMI,EAAuB,EAAK,EAC3C,YAAAvU,EAAA,EACF,CACF,GAEJ,EAMFhC,OAAC,OAAI,UAAU,kBAEb,UAAA5B,MAACoW,GAAA,CACC,OAAAliB,EACA,WAAAmiB,EACA,cAAAC,EACA,UAAAC,EACA,cAAAC,EACA,iBAAAC,EACA,eAAAC,EACA,KAAA1H,CAAA,GAGFhP,MAAC,OAAI,UAAU,oBACb,SAAAA,MAAC,QAAM,SAAAgP,IAAS,KAAO,iBAAmB,qBAAqB,EACjE,EAGApN,OAAC,OAAI,UAAU,oBACb,UAAAA,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,MAAI,eAAe,IAAEtR,EAAE,UAAU,GAAE,EACpC0P,MAAC,UAAO,UAAU,eAAe,QAAS,IAAMmX,EAAQ,CAAC,EAAI,SAAAnI,IAAS,KAAO,OAAS,SAAS,GACjG,EACApN,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,QAAM,aAAI,KAAKlL,CAAQ,EAAE,mBAAmB,QAAS,CAAE,QAAS,QAAS,MAAO,QAAS,IAAK,UAAW,EAAE,EAC3G+Z,UAAgB,QAAK,qBAASA,CAAA,EAAY,GAC7C,GACF,EAGC5Z,GACC2M,OAAC,OAAI,UAAU,oBACb,UAAAA,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,MAAG,UAAA5B,MAACiP,GAAA,CAAS,KAAM,GAAI,UAAU,cAAc,EAAE,IAAE3e,EAAE,OAAO,GAAE,EAC/D0P,MAAC,UAAO,UAAU,eAAe,QAAS,IAAMmX,EAAQ,CAAC,EAAI,SAAAnI,IAAS,KAAO,OAAS,SAAS,GACjG,EACAhP,MAAC,OAAI,UAAU,kBAAmB,SAAA/K,CAAA,CAAM,GAC1C,EAIDoc,GAAyB+F,EAAwB,OAAS,GACzDxV,OAAC,OAAI,UAAU,oBACb,UAAAA,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,MAAG,UAAA5B,MAACqI,GAAA,CAAQ,KAAM,GAAI,UAAU,cAAc,EAAE,IAAE2G,IAAS,KAAO,UAAY,eAAe,KAAG6C,EAAgBC,EAAa,SAAK,EACnI9R,MAAC,UAAO,UAAU,eAAe,QAAS,IAAMmX,EAAQ,CAAC,EAAI,SAAAnI,IAAS,KAAO,OAAS,SAAS,GACjG,EACAhP,MAAC,OAAI,UAAU,iBACZ,SAAAoX,EAAwB,IAAI,CAAC5jB,EAAG5G,IAC/BgV,OAAC,OAAY,UAAU,yBACrB,UAAAA,OAAC,OAAI,UAAU,wBACb,UAAA5B,MAAC,QAAK,UAAU,gBAAiB,SAAAxM,EAAE,KAAK,EAAO,IAAEA,EAAE,MACrD,EACAoO,OAAC,OAAI,UAAU,2BACZ,UAAApO,EAAE,cAAgBA,EAAE,YACnBoO,OAAC,QAAK,UAAU,iBAAkB,UAAApO,EAAE,aAAa,MAAIA,EAAE,YAAW,EAEpEoO,OAAC,QAAK,UAAU,kBAAmB,UAAApO,EAAE,OAAS,EAAE,OAAKA,EAAE,eAAiB,EAAI,MAAMA,EAAE,cAAc,MAAQ,IAAG,GAC/G,IATQ5G,CAUV,CACD,EACH,GACF,EAID,CAACykB,GAAyBgG,EAAiB,OAAS,GACnDzV,OAAC,OAAI,UAAU,oBACb,UAAAA,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,MAAG,UAAA5B,MAAC0Y,GAAA,CAAU,KAAM,GAAI,UAAU,cAAc,EAAE,iBAAerB,EAAiB,OAAO,CAAC9oB,EAAK2G,IAAM3G,EAAM,WAAW2G,EAAE,OAAS,CAAC,EAAI,WAAWA,EAAE,eAAiB,CAAC,EAAG,CAAC,EAAE,SAAK,EACjL8K,MAAC,UAAO,UAAU,eAAe,QAAS,IAAMmX,EAAQ,CAAC,EAAI,SAAAnI,IAAS,KAAO,OAAS,SAAS,GACjG,EACAhP,MAAC,OAAI,UAAU,iBACZ,SAAAqX,EAAiB,IAAI,CAACniB,EAAGtI,IACxBgV,OAAC,OAAY,UAAU,yBACrB,UAAAA,OAAC,OAAI,UAAU,wBACb,UAAA5B,MAAC,QAAK,UAAU,gBAAiB,SAAA9K,EAAE,KAAK,EAAO,IAAEA,EAAE,MACrD,EACA0M,OAAC,OAAI,UAAU,2BACZ,UAAA1M,EAAE,aAAeA,EAAE,WAClB0M,OAAC,QAAK,UAAU,iBAAkB,UAAA1M,EAAE,YAAY,MAAIA,EAAE,WAAU,EAElE0M,OAAC,QAAK,UAAU,kBAAmB,UAAA1M,EAAE,OAAS,EAAE,OAAK,WAAWA,EAAE,aAAa,EAAI,EAAI,MAAMA,EAAE,aAAa,MAAQ,IAAG,GACzH,IATQtI,CAUV,CACD,EACH,GACF,EAGD,CAACykB,GAAyBiG,EAAe,OAAS,GACjD1V,OAAC,OAAI,UAAU,oBACb,UAAAA,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,MAAI,eAAe,eAAa0V,EAAe,OAAO,CAAC/oB,EAAK8kB,IAAM9kB,EAAM,WAAW8kB,EAAE,OAAS,CAAC,EAAI,WAAWA,EAAE,eAAiB,CAAC,EAAG,CAAC,EAAE,SAAK,EAC9IrT,MAAC,UAAO,UAAU,eAAe,QAAS,IAAMmX,EAAQ,CAAC,EAAI,SAAAnI,IAAS,KAAO,OAAS,SAAS,GACjG,EACAhP,MAAC,OAAI,UAAU,iBACZ,SAAAsX,EAAe,IAAI,CAACjE,EAAGzmB,IACtBgV,OAAC,OAAY,UAAU,yBACrB,UAAA5B,MAAC,OAAI,UAAU,wBAAyB,SAAAqT,EAAE,KAAK,EAC/CzR,OAAC,OAAI,UAAU,2BACZ,UAAAyR,EAAE,aAAeA,EAAE,WAClBzR,OAAC,QAAK,UAAU,iBAAkB,UAAAyR,EAAE,YAAY,MAAIA,EAAE,WAAU,EAElEzR,OAAC,QAAK,UAAU,kBAAmB,UAAAyR,EAAE,OAAS,EAAE,OAAK,WAAWA,EAAE,aAAa,EAAI,EAAI,MAAMA,EAAE,aAAa,MAAQ,IAAG,GACzH,IAPQzmB,CAQV,CACD,EACH,GACF,EAGD,CAACykB,GAAyBkG,EAAc,OAAS,GAChD3V,OAAC,OAAI,UAAU,oBACb,UAAAA,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,MAAG,UAAA5B,MAACqI,GAAA,CAAQ,KAAM,GAAI,UAAU,cAAc,EAAE,cAAYkP,EAAc,OAAO,CAAChpB,EAAK+kB,IAAM/kB,EAAM,WAAW+kB,EAAE,OAAS,CAAC,EAAI,WAAWA,EAAE,eAAiB,CAAC,EAAG,CAAC,EAAE,SAAK,EACzKtT,MAAC,UAAO,UAAU,eAAe,QAAS,IAAMmX,EAAQ,CAAC,EAAI,SAAAnI,IAAS,KAAO,OAAS,SAAS,GACjG,EACAhP,MAAC,OAAI,UAAU,iBACZ,SAAAuX,EAAc,IAAI,CAACjE,EAAG1mB,IACrBgV,OAAC,OAAY,UAAU,yBACrB,UAAA5B,MAAC,OAAI,UAAU,wBAAyB,SAAAsT,EAAE,KAAK,EAC/C1R,OAAC,OAAI,UAAU,2BACZ,UAAA0R,EAAE,aAAeA,EAAE,WAClB1R,OAAC,QAAK,UAAU,iBAAkB,UAAA0R,EAAE,YAAY,MAAIA,EAAE,WAAU,EAElE1R,OAAC,QAAK,UAAU,kBAAmB,UAAA0R,EAAE,OAAS,EAAE,OAAK,WAAWA,EAAE,aAAa,EAAI,EAAI,MAAMA,EAAE,aAAa,MAAQ,IAAG,GACzH,IAPQ1mB,CAQV,CACD,EACH,GACF,EAGD5M,EAAM,OAAS,GACd4hB,OAAC,OAAI,UAAU,oBACb,UAAAA,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,MAAG,UAAA5B,MAAC2Y,GAAA,CAAO,KAAM,GAAI,UAAU,cAAc,EAAE,2BAAyB34B,EAAM,OAAO,WAAO,EAC7FggB,MAAC,UAAO,UAAU,eAAe,QAAS,IAAMmX,EAAQ,CAAC,EAAI,SAAAnI,IAAS,KAAO,OAAS,SAAS,GACjG,EACAhP,MAAC,OAAI,UAAU,iBACZ,SAAAhgB,EAAM,IAAI,CAACG,EAAMyM,IAChBgV,OAAC,OAAY,UAAU,gBACrB,UAAAA,OAAC,QAAM,UAAAzhB,EAAK,UAAYyhB,OAAAoH,WAAA,CAAE,UAAAhJ,MAAC4Y,GAAA,CAAI,KAAM,GAAI,UAAU,cAAc,EAAE,KAAC,EAAKz4B,EAAK,MAAK,SAClF,QAAM,UAAAA,EAAK,SAAS,IAAEA,EAAK,MAAK,IAFzByM,CAGV,CACD,EACH,GACF,EAIFgV,OAAC,OAAI,UAAU,qCACb,UAAA5B,MAAC,OAAI,UAAU,mBACb,SAAA4B,OAAC,QAAK,UAAA5B,MAACwY,GAAA,CAAQ,KAAM,GAAI,UAAU,cAAc,EAAE,iBAAa,EAClE,EACAxY,MAAC,SACC,KAAK,OACL,UAAU,yBACV,YAAY,kBACZ,MAAOyX,EACP,SAAW/W,GAAMgX,GAAmBhX,EAAE,OAAO,KAAK,IAEpDV,MAAC,KAAE,UAAU,wBAAwB,4DAErC,GACF,GACF,CAEJ,CChZA,MAAM6Y,GAAmB,IAAM,CAC7B,MAAMn2B,EAAQ,IAAI,WAAW,CAAC,EAC9B,cAAO,gBAAgBA,CAAK,EACrB,MAAM,KAAKA,EAAO3E,GAAKA,EAAE,SAAS,EAAE,CAAC,EAAE,KAAK,EAAE,CACvD,EAGMsxB,GAA8B,CAACxS,EAAWyS,IAAY,CAC1D,GAAI,CAACzS,GAAa,CAACyS,EAAS,OAAO,KAEnC,KAAM,CAACC,EAAWC,CAAQ,EAAI3S,EAAU,MAAM,GAAG,EAAE,IAAI,MAAM,EACvD,CAAC4S,EAASC,CAAM,EAAIJ,EAAQ,MAAM,GAAG,EAAE,IAAI,MAAM,EAEvD,IAAIK,EAAgBF,EAAU,GAAKC,GAAWH,EAAY,GAAKC,GAC3DG,EAAe,IAAGA,GAAgB,MAEtC,MAAMC,EAAaD,EAAe,GAC5BE,EAAe,KAAK,IAAID,EAAY,CAAC,EACrCE,EAAgB,KAAK,IAAI,EAAGF,EAAa,CAAC,EAEhD,MAAO,CACL,MAAOC,EAAa,QAAQ,CAAC,EAC7B,cAAeC,EAAgB,EAAIA,EAAc,QAAQ,CAAC,EAAI,GAElE,EAEA,SAAwBgJ,GAAO,CAAE,QAAA1oB,EAAS,UAAAxO,EAAW,UAAA20B,EAAY,GAAI,SAAAwC,EAAU,SAAA5N,EAAU,YAAAvH,GAAe,CACtG,KAAM,CAACsT,EAAMC,CAAO,EAAIzY,WAAS,CAAC,EAC5B,CAAC5J,EAAU8Z,CAAW,EAAIlQ,WAAS,IAAI,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,CAAC,EAGzE,CAACiZ,EAAiBqB,CAAkB,EAAIta,WAAS,IAAI,EACrD,CAACsZ,EAAwBC,CAAyB,EAAIvZ,WAAS,EAAK,EACpE,CAACwZ,EAAqBC,CAAsB,EAAIzZ,WAAS,EAAK,EAC9D,CAACoZ,EAAcC,CAAe,EAAIrZ,WAAS,EAAK,EAChD,CAACmQ,EAAaC,CAAc,EAAIpQ,WAAS,EAAE,EAC3C,CAAC+Y,EAAiBC,CAAkB,EAAIhZ,WAAS,EAAE,EAGnD,CAAC8X,EAAeC,CAAgB,EAAI/X,WAAS,EAAE,EAC/C,CAACgY,GAAgBuC,EAAiB,EAAIva,WAAS,EAAE,EACjD,CAACwa,GAAaC,CAAc,EAAIza,WAAS,EAAK,EAG9C,CAAC8S,EAAqBC,CAAsB,EAAI/S,WAAS,EAAK,EAC9D,CAAC2R,GAAYC,CAAa,EAAI5R,WAAS,CAAE,YAAa,GAAI,UAAW,GAAI,MAAO,GAAI,cAAe,GAAI,EACvG,CAAC7K,EAAaulB,CAAc,EAAI1a,WAAS,CAAC,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,KAAM,UAAW,CAAC,EACtI,CAAC5K,EAAWulB,CAAY,EAAI3a,WAAS,CAAC,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,CAAC,EACjH,CAAC3K,EAAUulB,EAAW,EAAI5a,WAAS,CAAC,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,CAAC,EAC/G,CAAC1e,EAAOk0B,CAAQ,EAAIxV,WAAS,EAAE,EAC/B,CAACzJ,EAAO8Z,EAAQ,EAAIrQ,WAAS,EAAE,EAC/B,CAACxK,GAAQqlB,CAAS,EAAI7a,WAAS,EAAE,EACjC,CAACkZ,EAAY4B,EAAa,EAAI9a,WAAS,EAAK,EAC5C,CAACmZ,GAAgB4B,EAAiB,EAAI/a,WAAS,EAAE,EAGjD,CAAC6S,GAAYmI,EAAa,EAAIhb,WAAS,EAAE,EAGzC,CAACgT,GAAqBiI,EAAsB,EAAIjb,WAAS,EAAK,EAG9D,CAACsQ,EAAM4K,EAAO,EAAIlb,WAAS,IAAI,EAC/BpO,GAAKpS,GAAQwwB,GAAaM,CAAI,EAAE9wB,CAAG,GAAKA,EAGxC,CAACizB,GAAiB0I,EAAkB,EAAInb,WAAS,EAAE,EACnD,CAAC0S,GAAc0I,EAAe,EAAIpb,WAAS,EAAE,EAC7C,CAAC9K,GAAgBmmB,EAAiB,EAAIrb,WAAS,EAAE,EACjD,CAAC4S,GAAqB0I,EAAsB,EAAItb,WAAS,EAAI,EAC7D,CAACuS,GAAqBC,EAAsB,EAAIxS,WAAS,IAAI,GAAK,EAElE2S,EAAwBD,GAAa,OAAS,EAGpDvS,YAAU,IAAM,CACdob,GAAA,EACAC,GAAA,EAEA,MAAMC,EAASj7B,EAAG,kBAAkBkR,EAAQ,GAAI,IAAM,CACpD8pB,GAAA,CACF,CAAC,EAED,MAAO,IAAM,CACXC,GAAQ,eACV,CACF,EAAG,CAAC/pB,EAAQ,EAAE,CAAC,EAGfyO,YAAU,IAAM,EACW,SAAY,CACnC,GAAI,CAACjd,EAAW,CACdo4B,GAAuB,EAAK,EAC5B,MACF,CAEA,GAAI,CACF,MAAMl6B,EAAO,MAAMZ,EAAG,wBAAwB0C,CAAS,EACvDi4B,GAAmB/5B,EAAK,YAAc,EAAE,EACxCg6B,GAAgBh6B,EAAK,SAAW,EAAE,CACpC,OAASuP,EAAK,CACZ,QAAQ,MAAM,+BAAgCA,CAAG,CACnD,SACE2qB,GAAuB,EAAK,CAC9B,CACF,GAEA,CACF,EAAG,CAACp4B,CAAS,CAAC,EAGdid,YAAU,IAAM,CACd,GAAIyS,IAAuBF,GAAa,SAAW,EAAG,OAEtD,MAAMgJ,MAAwB,IAC9B7I,GAAW,QAAQ1nB,GAAU,CACvBA,EAAO,gBACTuwB,EAAkB,IAAIvwB,EAAO,cAAc,CAE/C,CAAC,EAED,MAAMwwB,EAAiB,GACjBC,MAAgB,IAEtBF,EAAkB,QAAQG,GAAW,CAC/BnJ,GAAa,KAAKsC,GAAMA,EAAG,KAAO6G,CAAO,IAC3CF,EAAeE,CAAO,EAAI,CAAC,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,EACrGD,EAAU,IAAIC,CAAO,EAEzB,CAAC,EAEDR,GAAkB1a,GACZ,OAAO,KAAKA,CAAI,EAAE,SAAW,EACxBgb,EAEFhb,CACR,EAED6R,GAAuB7R,GACjBA,EAAK,OAAS,EACTib,EAEFjb,CACR,CACH,EAAG,CAAC+R,GAAcG,GAAYD,EAAmB,CAAC,EAGlD,MAAM4I,GAAqB,SAAY,CACrCf,EAAe,EAAI,EACnB,GAAI,CACF,MAAM3sB,EAAO,MAAMtN,EAAG,kBAAkBkR,EAAQ,EAAE,EAClD6oB,GAAkBzsB,GAAQ,EAAE,CAC9B,OAAS6C,EAAK,CACZ,QAAQ,MAAM,iCAAkCA,CAAG,CACrD,SACE8pB,EAAe,EAAK,CACtB,CACF,EAGMqB,GAAkB,IAAM,CAC5B,KAAM,CAAE,YAAA9J,EAAa,UAAAC,EAAW,MAAA5mB,EAAO,cAAA+lB,GAAkBO,GACzD,IAAIoK,EAAe,EAEnB,GAAIpJ,EAAuB,CACzB,MAAMqJ,EAAiB,GACvB,OAAO,QAAQ9mB,EAAc,EAAE,QAAQ,CAAC,CAAC2mB,GAASjnB,EAAO,IAAM,CAC7DonB,EAAeH,EAAO,EAAIjnB,GAAQ,IAAIE,IAChCA,IAAKA,GAAE,MAAQA,GAAE,KAAK,QACxBinB,IACO,CAAE,GAAGjnB,GAAG,YAAAkd,EAAa,UAAAC,EAAW,MAAA5mB,EAAO,cAAA+lB,CAAA,GAEzCtc,EACR,CACH,CAAC,EACDumB,GAAkBW,CAAc,CAClC,MACEtB,EAAevlB,EAAY,IAAIqB,GACzBA,GAAKA,EAAE,MAAQA,EAAE,KAAK,QACxBulB,IACO,CAAE,GAAGvlB,EAAG,YAAAwb,EAAa,UAAAC,EAAW,MAAA5mB,EAAO,cAAA+lB,CAAA,GAEzC5a,CACR,CAAC,EACFmkB,EAAavlB,EAAU,IAAIuf,GACrBA,GAAKA,EAAE,MAAQA,EAAE,KAAK,QACxBoH,IACO,CAAE,GAAGpH,EAAG,YAAA3C,EAAa,UAAAC,EAAW,MAAA5mB,EAAO,cAAA+lB,CAAA,GAEzCuD,CACR,CAAC,EACFiG,GAAYvlB,EAAS,IAAIuf,GACnBA,GAAKA,EAAE,MAAQA,EAAE,KAAK,QACxBmH,IACO,CAAE,GAAGnH,EAAG,YAAA5C,EAAa,UAAAC,EAAW,MAAA5mB,EAAO,cAAA+lB,CAAA,GAEzCwD,CACR,CAAC,EAGJ7B,EAAuB,EAAK,EAC5BnB,EAAc,CAAE,YAAa,GAAI,UAAW,GAAI,MAAO,GAAI,cAAe,GAAI,EAE1EmK,EAAe,EACjB7W,EAAYtT,GAAE,cAAc,EAAE,QAAQ,UAAWmqB,CAAY,EAAG,SAAS,EAEzE7W,EAAYoL,IAAS,KAAO,oBAAsB,+BAAgC,MAAM,CAE5F,EAGM2L,GAAqB1f,GAAW,CACpC,IAAIyV,EAAaC,EAAW5mB,EAAO+lB,EAEnC,OAAQ7U,EAAA,CACN,IAAK,MACHyV,EAAc,QACdC,EAAY,QACZ5mB,EAAQ,IACR+lB,EAAgB,GAChB,MACF,IAAK,OACHY,EAAc,QACdC,EAAY,QACZ5mB,EAAQ,IACR+lB,EAAgB,IAChB,MACF,IAAK,MACHY,EAAc,QACdC,EAAY,QACZ5mB,EAAQ,IACR+lB,EAAgB,GAChB,MACF,QACE,OAGJ,IAAI3f,EAAQ,EAEZ,GAAIkhB,EAAuB,CACzB,MAAMqJ,GAAiB,GACvB,OAAO,QAAQ9mB,EAAc,EAAE,QAAQ,CAAC,CAAC2mB,GAASjnB,EAAO,IAAM,CAC7DonB,GAAeH,EAAO,EAAIjnB,GAAQ,IAAIE,IAChCA,IAAKA,GAAE,MAAQA,GAAE,KAAK,QACxBrD,IACO,CAAE,GAAGqD,GAAG,YAAAkd,EAAa,UAAAC,EAAW,MAAA5mB,EAAO,cAAA+lB,CAAA,GAEzCtc,EACR,CACH,CAAC,EACDumB,GAAkBW,EAAc,CAClC,MACEtB,EAAe/Z,IAAQA,GAAK,IAAInK,IAC1BA,IAAKA,GAAE,MAAQA,GAAE,KAAK,QACxB/E,IACO,CAAE,GAAG+E,GAAG,YAAAwb,EAAa,UAAAC,EAAW,MAAA5mB,EAAO,cAAA+lB,CAAA,GAEzC5a,EACR,CAAC,EACFmkB,EAAaha,IAAQA,GAAK,IAAIgU,IACxBA,IAAKA,GAAE,MAAQA,GAAE,KAAK,QACxBljB,IACO,CAAE,GAAGkjB,GAAG,YAAA3C,EAAa,UAAAC,EAAW,MAAA5mB,EAAO,cAAA+lB,CAAA,GAEzCuD,EACR,CAAC,EACFiG,GAAYja,IAAQA,GAAK,IAAIiU,IACvBA,IAAKA,GAAE,MAAQA,GAAE,KAAK,QACxBnjB,IACO,CAAE,GAAGmjB,GAAG,YAAA5C,EAAa,UAAAC,EAAW,MAAA5mB,EAAO,cAAA+lB,CAAA,GAEzCwD,EACR,CAAC,EAGAnjB,EAAQ,EACVyT,EAAYtT,GAAE,cAAc,EAAE,QAAQ,UAAWH,CAAK,EAAG,SAAS,EAElEyT,EAAYoL,IAAS,KAAO,oBAAsB,+BAAgC,MAAM,CAE5F,EAEMiL,GAAiB,SAAY,CACjC,GAAI,CACF,MAAM33B,EAAU,MAAMpD,EAAG,eAAekR,EAAQ,EAAE,EAC9C9N,GAAS,SACXo3B,GAAcp3B,EAAQ,OAAO,CAEjC,OAAS+M,EAAK,CACZ,QAAQ,MAAM,sBAAuBA,CAAG,CAC1C,CACF,EAGMurB,GAAmB,SAAY,CACnCjB,GAAuB,EAAI,EAC3B,GAAI,CACF,MAAMkB,EAAe,MAAM37B,EAAG,sBAAsBkR,EAAQ,GAAI0E,CAAQ,EAExE,GAAI,CAAC+lB,GAAgBA,EAAa,eAAiB,EAAG,CACpDjX,EAAYtT,GAAE,gBAAgB,EAAG,MAAM,EACvC,MACF,CAEI+gB,GAAyBwJ,EAAa,eACxCd,GAAkBc,EAAa,cAAc,GAEzCA,EAAa,aACfzB,EAAeyB,EAAa,WAAW,EAErCA,EAAa,WACfxB,EAAawB,EAAa,SAAS,EAEjCA,EAAa,UACfvB,GAAYuB,EAAa,QAAQ,GAIrC,MAAMC,EAAU,IAAI,KAAKD,EAAa,QAAQ,EAAE,qBAChDjX,EAAYtT,GAAE,eAAe,EAAE,QAAQ,UAAWuqB,EAAa,YAAY,EAAE,QAAQ,SAAUC,CAAO,EAAG,SAAS,CACpH,OAASz2B,EAAO,CACd,QAAQ,MAAM,+BAAgCA,CAAK,EACnDuf,EAAYoL,IAAS,KAAO,8BAAgC,iCAAkC,OAAO,CACvG,SACE2K,GAAuB,EAAK,CAC9B,CACF,EAGMoB,GAAmB,IAAM,CAC7B3B,EAAe,CAAC,GAAGvlB,EAAa,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,KAAM,UAAW,CAAC,CAC9H,EAEMye,GAAoB,CAACxpB,EAAOvL,EAAOiD,IAAU,CACjD44B,EAAevlB,EAAY,IAAI,CAACqB,EAAGtI,IAAM,CACvC,GAAIA,IAAM9D,EAAO,OAAOoM,EACxB,MAAM3T,EAAU,CAAE,GAAG2T,EAAG,CAAC3X,CAAK,EAAGiD,CAAA,EACjC,GAAIjD,IAAU,eAAiBA,IAAU,YAAa,CACpD,MAAMsf,GAAYtf,IAAU,cAAgBiD,EAAQ0U,EAAE,YAChDoa,GAAU/xB,IAAU,YAAciD,EAAQ0U,EAAE,UAC5C4b,GAAazB,GAA4BxS,GAAWyS,EAAO,EAC7DwB,KACFvvB,EAAQ,MAAQuvB,GAAW,MAC3BvvB,EAAQ,cAAgBuvB,GAAW,cAEvC,CACA,OAAOvvB,CACT,CAAC,CAAC,CACJ,EAEMgxB,GAAqBzpB,GAAU,CAC/B+K,EAAY,OAAS,EACvBulB,EAAevlB,EAAY,OAAO,CAACiiB,EAAGlpB,IAAMA,IAAM9D,CAAK,CAAC,EAExDswB,EAAe,CAAC,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,KAAM,UAAW,CAAC,CAEhH,EAGM4B,GAAe,IAAM,CACzB1B,GAAY,CAAC,GAAGvlB,EAAU,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,CAAC,CACvG,EAEM6e,GAAgB,CAAC9pB,EAAOvL,EAAOiD,IAAU,CAC7C84B,GAAYvlB,EAAS,IAAI,CAACuf,EAAG1mB,IAAM,CACjC,GAAIA,IAAM9D,EAAO,OAAOwqB,EACxB,MAAM/xB,EAAU,CAAE,GAAG+xB,EAAG,CAAC/1B,CAAK,EAAGiD,CAAA,EACjC,GAAIjD,IAAU,eAAiBA,IAAU,YAAa,CACpD,MAAMsf,GAAYtf,IAAU,cAAgBiD,EAAQ8yB,EAAE,YAChDhE,GAAU/xB,IAAU,YAAciD,EAAQ8yB,EAAE,UAC5CxC,GAAazB,GAA4BxS,GAAWyS,EAAO,EAC7DwB,KACFvvB,EAAQ,MAAQuvB,GAAW,MAC3BvvB,EAAQ,cAAgBuvB,GAAW,cAEvC,CACA,OAAOvvB,CACT,CAAC,CAAC,CACJ,EAEMsxB,GAAiB/pB,GAAU,CAC3BiL,EAAS,OAAS,EACpBulB,GAAYvlB,EAAS,OAAO,CAAC+hB,EAAGlpB,IAAMA,IAAM9D,CAAK,CAAC,EAElDwwB,GAAY,CAAC,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,CAAC,CAE5F,EAGM2B,GAAgB,IAAM,CAC1B5B,EAAa,CAAC,GAAGvlB,EAAW,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,CAAC,CACzG,EAEM2e,GAAiB,CAAC3pB,EAAOvL,EAAOiD,IAAU,CAC9C64B,EAAavlB,EAAU,IAAI,CAACuf,EAAGzmB,IAAM,CACnC,GAAIA,IAAM9D,EAAO,OAAOuqB,EACxB,MAAM9xB,EAAU,CAAE,GAAG8xB,EAAG,CAAC91B,CAAK,EAAGiD,CAAA,EACjC,GAAIjD,IAAU,eAAiBA,IAAU,YAAa,CACpD,MAAMsf,GAAYtf,IAAU,cAAgBiD,EAAQ6yB,EAAE,YAChD/D,GAAU/xB,IAAU,YAAciD,EAAQ6yB,EAAE,UAC5CvC,GAAazB,GAA4BxS,GAAWyS,EAAO,EAC7DwB,KACFvvB,EAAQ,MAAQuvB,GAAW,MAC3BvvB,EAAQ,cAAgBuvB,GAAW,cAEvC,CACA,OAAOvvB,CACT,CAAC,CAAC,CACJ,EAEMmxB,GAAkB5pB,GAAU,CAC5BgL,EAAU,OAAS,EACrBulB,EAAavlB,EAAU,OAAO,CAACgiB,EAAGlpB,IAAMA,IAAM9D,CAAK,CAAC,EAEpDuwB,EAAa,CAAC,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,CAAC,CAE7F,EAGMvG,GAAoByH,GAAY,CACpCR,GAAkB1a,IAAS,CACzB,GAAGA,EACH,CAACkb,CAAO,EAAG,CAAC,GAAIlb,EAAKkb,CAAO,GAAK,GAAK,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,GAChH,CACJ,EAEMxH,GAAsB,CAACwH,EAASzxB,EAAOvL,EAAOiD,IAAU,CAC5Du5B,GAAkB1a,IAAS,CACzB,GAAGA,EACH,CAACkb,CAAO,GAAIlb,EAAKkb,CAAO,GAAK,IAAI,IAAI,CAAC/mB,EAAG5G,KAAM,CAC7C,GAAIA,KAAM9D,EAAO,OAAO0K,EACxB,MAAMjS,GAAU,CAAE,GAAGiS,EAAG,CAACjW,CAAK,EAAGiD,CAAA,EACjC,GAAIjD,IAAU,eAAiBA,IAAU,YAAa,CACpD,MAAMsf,GAAYtf,IAAU,cAAgBiD,EAAQgT,EAAE,YAChD8b,GAAU/xB,IAAU,YAAciD,EAAQgT,EAAE,UAC5Csd,GAAazB,GAA4BxS,GAAWyS,EAAO,EAC7DwB,KACFvvB,GAAQ,MAAQuvB,GAAW,MAC3BvvB,GAAQ,cAAgBuvB,GAAW,cAEvC,CACA,OAAOvvB,EACT,CAAC,GACD,CACJ,EAEMyxB,GAAsB,CAACuH,EAASzxB,IAAU,CAC9CixB,GAAkB1a,GAAQ,CACxB,MAAM/L,EAAU+L,EAAKkb,CAAO,GAAK,GACjC,OAAIjnB,EAAQ,OAAS,EACZ,CAAE,GAAG+L,EAAM,CAACkb,CAAO,EAAGjnB,EAAQ,OAAO,CAACwiB,EAAGlpB,IAAMA,IAAM9D,CAAK,GAE1D,CAAE,GAAGuW,EAAM,CAACkb,CAAO,EAAG,CAAC,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,EAE5G,CAAC,CACH,EAGMW,EAAsBX,GAAY,CACjCA,IACLrJ,GAAuB7R,OAAY,IAAI,CAAC,GAAGA,EAAMkb,CAAO,CAAC,CAAC,EAC1DR,GAAkB1a,GACZ,CAACA,EAAKkb,CAAO,GAAKlb,EAAKkb,CAAO,EAAE,SAAW,EACtC,CAAE,GAAGlb,EAAM,CAACkb,CAAO,EAAG,CAAC,CAAE,KAAM,GAAI,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,GAEnGlb,CACR,EACH,EAGM8b,GAAwBZ,GAAY,CACxCrJ,GAAuB7R,GAAQ,CAC7B,MAAM+b,EAAS,IAAI,IAAI/b,CAAI,EAC3B,OAAA+b,EAAO,OAAOb,CAAO,EACda,CACT,CAAC,EACDrB,GAAkB1a,GAAQ,CACxB,MAAMgc,EAAa,CAAE,GAAGhc,CAAA,EACxB,cAAOgc,EAAWd,CAAO,EAClBc,CACT,CAAC,CACH,EAGMpI,GAA0B,IACvB7B,GAAa,OAAOsC,GAAM,CAACzC,GAAoB,IAAIyC,EAAG,EAAE,CAAC,EAI5D4H,GAAyB,IAAM,CACnC,GAAI,CAAC1nB,IAAkB,OAAOA,IAAmB,eAAiB,GAClE,MAAM2nB,EAAa,GACnB,cAAO,QAAQ3nB,EAAc,EAAE,QAAQ,CAAC,CAAC2mB,EAASjnB,CAAO,IAAM,CAC7D,GAAI,CAAC,MAAM,QAAQA,CAAO,EAAG,OAC7B,MAAMqgB,EAAavC,GAAa,KAAKsC,GAAMA,EAAG,KAAO6G,CAAO,EAC5DjnB,EAAQ,QAAQE,GAAK,CACfA,GAAKA,EAAE,MAAQA,EAAE,KAAK,SAAW,WAAWA,EAAE,KAAK,EAAI,GAAK,WAAWA,EAAE,aAAa,EAAI,IAC5F+nB,EAAW,KAAK,CACd,KAAM/nB,EAAE,KAAK,OACb,MAAO,WAAWA,EAAE,KAAK,GAAK,EAC9B,eAAgB,WAAWA,EAAE,aAAa,GAAK,EAC/C,aAAcA,EAAE,aAAe,KAC/B,WAAYA,EAAE,WAAa,KAC3B,KAAMmgB,GAAY,MAAQ,SAC1B,eAAgB4G,CAAA,CACjB,CAEL,CAAC,CACH,CAAC,EACMgB,CACT,EAGMC,GAAuB3xB,GAAW,CAItC,GAHwBA,EAAO,gBAAkBwnB,GAC/CD,GAAa,KAAKsC,GAAMA,EAAG,KAAO7pB,EAAO,cAAc,EAEpC,CACdonB,GAAoB,IAAIpnB,EAAO,cAAc,GAChDqnB,GAAuB7R,OAAY,IAAI,CAAC,GAAGA,EAAMxV,EAAO,cAAc,CAAC,CAAC,EAG1E,MAAM4xB,EAAe7nB,GAAe/J,EAAO,cAAc,GAAK,GACxD6xB,EAAaD,EAAa,UAAUjoB,GAAK,CAACA,GAAK,CAACA,EAAE,MAAQ,CAACA,EAAE,KAAK,MAAM,EAC9E,GAAIkoB,GAAc,EAAG,CACnB,MAAMn6B,EAAU,CAAC,GAAGk6B,CAAY,EAChCl6B,EAAQm6B,CAAU,EAAI,CAAE,GAAGn6B,EAAQm6B,CAAU,EAAG,KAAM7xB,EAAO,MAC7DkwB,GAAkB1a,IAAS,CAAE,GAAGA,EAAM,CAACxV,EAAO,cAAc,EAAGtI,CAAA,EAAU,CAC3E,MACEw4B,GAAkB1a,IAAS,CACzB,GAAGA,EACH,CAACxV,EAAO,cAAc,EAAG,CAAC,GAAIwV,EAAKxV,EAAO,cAAc,GAAK,GAAK,CAChE,KAAMA,EAAO,KAAM,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAC9E,GACD,CAEN,KAAO,CACL,MAAMC,GAAQD,EAAO,MAAQ,IAAI,cAEjC,GAAIC,EAAK,SAAS,SAAS,GAAKA,EAAK,SAAS,YAAY,GAAKA,EAAK,SAAS,gBAAgB,EAAG,CAC9F,MAAM6xB,EAAgB9nB,EAAY,UAAUqB,GAAK,CAACA,GAAK,CAACA,EAAE,MAAQ,CAACA,EAAE,KAAK,MAAM,EAC5EymB,GAAiB,GACnBrJ,GAAkBqJ,EAAe,OAAQ9xB,EAAO,IAAI,EACpDyoB,GAAkBqJ,EAAe,OAAQ7xB,EAAK,SAAS,gBAAgB,EAAI,iBAAmB,SAAS,GAEvGsvB,EAAe,CAAC,GAAGvlB,EAAa,CAC9B,KAAMhK,EAAO,KAAM,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAC7E,KAAMC,EAAK,SAAS,gBAAgB,EAAI,iBAAmB,UAC5D,CAAC,CAEN,SAAWA,EAAK,SAAS,UAAU,EAAG,CACpC,MAAM8xB,EAAe9nB,EAAU,UAAUuf,GAAK,CAACA,GAAK,CAACA,EAAE,MAAQ,CAACA,EAAE,KAAK,MAAM,EACzEuI,GAAgB,EAClBnJ,GAAemJ,EAAc,OAAQ/xB,EAAO,IAAI,EAEhDwvB,EAAa,CAAC,GAAGvlB,EAAW,CAAE,KAAMjK,EAAO,KAAM,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,CAAC,CAEpH,KAAO,CACL,MAAMgyB,EAAgB9nB,EAAS,UAAUuf,GAAK,CAACA,GAAK,CAACA,EAAE,MAAQ,CAACA,EAAE,KAAK,MAAM,EACzEuI,GAAiB,EACnBjJ,GAAciJ,EAAe,OAAQhyB,EAAO,IAAI,EAEhDyvB,GAAY,CAAC,GAAGvlB,EAAU,CAAE,KAAMlK,EAAO,KAAM,MAAO,GAAI,cAAe,GAAI,YAAa,GAAI,UAAW,GAAI,CAAC,CAElH,CACF,CACA+Z,EAAY,SAAS/Z,EAAO,IAAI,GAAI,SAAS,CAC/C,EAGMiyB,GAAkBpb,GAAM,CAC5B,MAAMqb,EAAQ,MAAM,KAAKrb,EAAE,OAAO,KAAK,EACvC,GAAIqb,EAAM,SAAW,EAAG,OAExB,MAAMC,EAAiBzF,IAAc,GAAK,IAAWA,EAAYriB,GAAO,OACxE,GAAI8nB,GAAkB,EAAG,CACvBpY,EAAY,wBAAwB2S,CAAS,QAAS,OAAO,EAC7D7V,EAAE,OAAO,MAAQ,GACjB,MACF,CAEA,MAAMub,EAAaF,EAAM,MAAM,EAAGC,CAAc,EAC5CC,EAAW,OAASF,EAAM,QAC5BnY,EAAY,QAAQqY,EAAW,MAAM,oBAAoB1F,CAAS,QAAS,OAAO,EAGpF,MAAM2F,EAAgB,GAAK,KAAO,KAElCD,EAAW,QAAQ1mB,GAAQ,CACzB,GAAI,CAACA,EAAK,KAAK,WAAW,QAAQ,EAAG,CACnCqO,EAAY,8BAA+B,OAAO,EAClD,MACF,CACA,GAAIrO,EAAK,KAAO2mB,EAAe,CAC7BtY,EAAY,oBAAoBrO,EAAK,IAAI,cAAe,OAAO,EAC/D,MACF,CAEA,MAAM4mB,GAAa,IAAI,gBAAgB5mB,CAAI,EACrCoB,GAAS,SAAS,KAAK,KAAK,IAAIkiB,IAAkB,GACxDU,EAAUla,IAAQ,CAAC,GAAGA,GAAM,CAC1B,GAAI,GAAG,KAAK,KAAK,IAAIwZ,IAAkB,GACvC,OAAAliB,GACA,KAAApB,EACA,WAAA4mB,GACA,KAAM5mB,EAAK,KACX,OAAQ,UACR,SAAU,EACV,MAAO,KACP,YAAa,KACd,CAAC,CACJ,CAAC,EAEDmL,EAAE,OAAO,MAAQ,EACnB,EAEM0b,GAAoB,CAACC,EAASh7B,IAAY,CAC9Ck4B,KAAkBla,EAAK,IAAIrP,GACzBA,EAAE,KAAOqsB,EAAU,CAAE,GAAGrsB,EAAG,GAAG3O,GAAY2O,CAAA,CAC3C,CACH,EAEMssB,GAAmB,MAAOD,EAASjzB,IAAa,CACpD,MAAMiR,EAAQnG,GAAO,KAAKlE,GAAKA,EAAE,KAAOqsB,CAAO,EAC/C,GAAI,GAAChiB,GAASA,EAAM,SAAW,UAE/B,CAAA+hB,GAAkBC,EAAS,CAAE,OAAQ,cAAe,MAAO,KAAM,EAEjE,GAAI,CACF,IAAIE,EAAeliB,EAAM,KACzB,GAAI,CACFkiB,EAAe,MAAMtO,GAAc5T,EAAM,IAAI,CAC/C,OAAShL,EAAK,CACZ,QAAQ,KAAK,sCAAuCA,CAAG,CACzD,CAEA+sB,GAAkBC,EAAS,CAAE,OAAQ,YAAa,EAElD,MAAM7O,EAAM,MAAMtuB,EAAG,YAAY0C,EAAWwO,EAAQ,GAAIhH,EAAUmzB,CAAY,EAE9EH,GAAkBC,EAAS,CACzB,OAAQ,YACR,YAAa7O,EACb,SAAUnT,EAAM,SAAW,EAC5B,EAED,MAAMnb,EAAG,qBAAqBkK,EAAU,CAAC,GAAG8K,GAAO,OAAOlE,GAAKA,EAAE,WAAW,EAAE,IAAIA,GAAKA,EAAE,WAAW,EAAGwd,CAAG,CAAC,EAE3G5J,EAAY,8BAA+B,SAAS,CACtD,OAASvU,EAAK,CACZ,QAAQ,MAAM,gBAAiBA,CAAG,EAClC+sB,GAAkBC,EAAS,CACzB,OAAQ,SACR,MAAOhtB,EAAI,SAAW,gBACtB,SAAUgL,EAAM,SAAW,EAC5B,EACDuJ,EAAY,qBAAsB,OAAO,CAC3C,EACF,EAEM4Y,GAAeH,GAAY,CAC/B,MAAMhiB,EAAQnG,GAAO,KAAKlE,GAAKA,EAAE,KAAOqsB,CAAO,EAC3ChiB,GAAO,YACT,IAAI,gBAAgBA,EAAM,UAAU,EAEtCkf,EAAUrlB,GAAO,OAAOlE,GAAKA,EAAE,KAAOqsB,CAAO,CAAC,CAChD,EAGMhF,GAAmBxjB,EAAY,OAAOqB,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,SAAW,WAAWA,EAAE,KAAK,EAAI,GAAK,WAAWA,EAAE,aAAa,EAAI,EAAE,EACvIoiB,GAAiBxjB,EAAU,OAAOuf,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,SAAW,WAAWA,EAAE,KAAK,EAAI,GAAK,WAAWA,EAAE,aAAa,EAAI,EAAE,EACnIkE,GAAgBxjB,EAAS,OAAOuf,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,SAAW,WAAWA,EAAE,KAAK,EAAI,GAAK,WAAWA,EAAE,aAAa,EAAI,EAAE,EACjI8D,GAA0BkE,GAAA,EAE1B9D,GAAenG,EACjB+F,GAAwB,OACxBC,GAAiB,OAASC,GAAe,OAASC,GAAc,OAC9D1F,GAAgBR,EAClB+F,GAAwB,OAAO,CAAC7oB,EAAKiF,IAAMjF,GAAOiF,EAAE,OAAS,GAAI,CAAC,EAClE,CAAC,GAAG6jB,GAAkB,GAAGC,GAAgB,GAAGC,EAAa,EAAE,OAAO,CAAChpB,EAAKiF,IAAMjF,EAAM,WAAWiF,EAAE,OAAS,CAAC,EAAG,CAAC,EAC7Gse,GAAeT,EACjB+F,GAAwB,OAAO,CAAC7oB,EAAKiF,IAAMjF,GAAOiF,EAAE,gBAAkB,GAAI,CAAC,EAC3E,CAAC,GAAG6jB,GAAkB,GAAGC,GAAgB,GAAGC,EAAa,EAAE,OAAO,CAAChpB,EAAKiF,IAAMjF,EAAM,WAAWiF,EAAE,eAAiB,CAAC,EAAG,CAAC,EAErHme,GAAeN,EACjB,OAAO,OAAOzd,IAAkB,EAAE,EAAE,OAAO,OAAOJ,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,MAAM,EACnF,CACE,GAAGK,EAAY,OAAOqB,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,MAAM,EACvD,GAAGpB,EAAU,OAAOuf,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,MAAM,EACrD,GAAGtf,EAAS,OAAOuf,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,MAAM,GAEpD1B,GAAsBD,GAAa,OAAS6F,GAG5CiF,GAAY,IAAM,CACtB,GAAIvF,IAAS,EAAG,OAAOjiB,EAAM,OAAO,OAAS,EAC7C,GAAIiiB,IAAS,EAAG,CACd,GAAI7F,EAAuB,OAAOiK,GAAA,EAAyB,OAAS,EACpE,MAAMoB,EAAiB7oB,EAAY,KAAKqB,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,SAAW,WAAWA,EAAE,KAAK,EAAI,GAAK,WAAWA,EAAE,aAAa,EAAI,EAAE,EACnIynB,EAAe7oB,EAAU,KAAKuf,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,SAAW,WAAWA,EAAE,KAAK,EAAI,GAAK,WAAWA,EAAE,aAAa,EAAI,EAAE,EAC/HuJ,EAAc7oB,EAAS,KAAKuf,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,SAAW,WAAWA,EAAE,KAAK,EAAI,GAAK,WAAWA,EAAE,aAAa,EAAI,EAAE,EACnI,OAAOoJ,GAAkBC,GAAgBC,CAC3C,CACA,MAAO,EACT,EAiBMC,IAdwB,IAAM,CAClC,MAAMC,EAAW,GACjB,OAAI5F,IAAS,GAAK,CAACjiB,EAAM,QACvB6nB,EAAS,KAAK9N,IAAS,KAAO,0BAA4B,yBAAyB,EAEjFkI,IAAS,GAAKtF,GAAsB,GACtCkL,EAAS,KAAK9N,IAAS,KAAO,GAAG4C,EAAmB,mCAAqC,GAAGA,EAAmB,2BAA2B,EAExIsF,IAAS,GAAK,CAACO,EAAgB,QACjCqF,EAAS,KAAK9N,IAAS,KAAO,0BAA4B,kBAAkB,EAEvE8N,CACT,GAE2B,EAErBC,GAAS,IAAM,CACf7F,EAAO,GAAGC,EAAQD,EAAO,CAAC,CAChC,EAEMnB,GAAS,IAAM,CACfmB,EAAO,EACTC,EAAQD,EAAO,CAAC,EAEhB/L,EAAA,CAEJ,EAGM6R,GAAe,SAAY,CAC/B,GAAI,CAACvF,EAAgB,OAAQ,CAC3B7T,EAAY,4BAA6B,OAAO,EAChD,MACF,CAEA,IAAIqZ,EAAsB,GAE1B,GAAI5L,GAEF,GADA4L,EAAsB3B,GAAA,EAClB2B,EAAoB,SAAW,EAAG,CACpCrZ,EAAY,0BAA2B,OAAO,EAC9C,MACF,MACK,CACL,MAAMsZ,EAAKrpB,EAAY,OAAOqB,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,SAAW,WAAWA,EAAE,KAAK,EAAI,GAAK,WAAWA,EAAE,aAAa,EAAI,EAAE,EACzHioB,EAAKrpB,EAAU,OAAOuf,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,SAAW,WAAWA,EAAE,KAAK,EAAI,GAAK,WAAWA,EAAE,aAAa,EAAI,EAAE,EACvH+J,EAAKrpB,EAAS,OAAOuf,GAAKA,GAAKA,EAAE,MAAQA,EAAE,KAAK,SAAW,WAAWA,EAAE,KAAK,EAAI,GAAK,WAAWA,EAAE,aAAa,EAAI,EAAE,EAE5H,GAAI4J,EAAG,SAAW,GAAKC,EAAG,SAAW,GAAKC,EAAG,SAAW,EAAG,CACzDxZ,EAAY,0BAA2B,OAAO,EAC9C,MACF,CAEAqZ,EAAsB,CACpB,GAAGC,EAAG,IAAIhoB,IAAM,CAAE,KAAMA,EAAE,KAAK,OAAQ,MAAO,WAAWA,EAAE,KAAK,GAAK,EAAG,eAAgB,WAAWA,EAAE,aAAa,GAAK,EAAG,aAAcA,EAAE,aAAe,KAAM,WAAYA,EAAE,WAAa,KAAM,KAAMA,EAAE,MAAO,EAC/M,GAAGioB,EAAG,IAAI9J,IAAM,CAAE,KAAMA,EAAE,KAAK,OAAQ,MAAO,WAAWA,EAAE,KAAK,GAAK,EAAG,eAAgB,WAAWA,EAAE,aAAa,GAAK,EAAG,aAAcA,EAAE,aAAe,KAAM,WAAYA,EAAE,WAAa,KAAM,KAAM,YAAa,EACnN,GAAG+J,EAAG,IAAI9J,IAAM,CAAE,KAAMA,EAAE,KAAK,OAAQ,MAAO,WAAWA,EAAE,KAAK,GAAK,EAAG,eAAgB,WAAWA,EAAE,aAAa,GAAK,EAAG,aAAcA,EAAE,aAAe,KAAM,WAAYA,EAAE,WAAa,KAAM,KAAM,WAAY,EAEtN,CAEAkG,GAAc,EAAI,EAClBC,GAAkB,oBAAoB,EACtC,GAAI,CACF,MAAMj3B,EAAS,MAAMtD,EAAG,eAAe,CACrC,WAAYkR,EAAQ,GACpB,UAAW0E,EACX,cAAe+Z,EAAY,QAAU,KACrC,gBAAiB2H,GAAiB,KAClC,MAAOvhB,EAAM,QAAU,KACvB,OAAQ,GACR,gBAAiBwiB,EAAgB,MAAK,CACvC,EAED,GAAI,CAACj1B,GAAU,CAACA,EAAO,GACrB,MAAM,IAAI,MAAM,iDAAiD,EAInE,IAAIkO,EAAY,GAChB,MAAM2sB,EAAgBnpB,GAAO,OAAOlE,GAAKA,EAAE,SAAW,SAAS,EAC/D,GAAIqtB,EAAc,OAAS,EAAG,CAC5B5D,GAAkB,eAAe4D,EAAc,MAAM,SAASA,EAAc,OAAS,EAAI,IAAM,EAAE,KAAK,EACtGA,EAAc,YAAajB,GAAkBpsB,GAAE,GAAI,CAAE,OAAQ,cAAe,CAAC,EAE7E,MAAMstB,EAAmB,MAAM,QAAQ,IACrCD,EAAc,IAAI,MAAOhjB,IAAU,CACjC,GAAI,CACF,MAAMkjB,GAAa,MAAMtP,GAAc5T,GAAM,IAAI,EACjD,MAAO,CAAE,GAAGA,GAAO,KAAMkjB,EAAA,CAC3B,OAASluB,GAAK,CACZ,eAAQ,KAAK,4BAA4BgL,GAAM,IAAI,oBAAqBhL,EAAG,EACpEgL,EACT,CACF,CAAC,GAGHof,GAAkB,aAAa4D,EAAc,MAAM,SAASA,EAAc,OAAS,EAAI,IAAM,EAAE,KAAK,EACpGA,EAAc,YAAajB,GAAkBpsB,GAAE,GAAI,CAAE,OAAQ,YAAa,CAAC,EAE3E,IAAIwtB,EAAgB,EAChBC,GAAc,EAClB,MAAMC,GAAiBJ,EAAiB,IAAI,MAAOjjB,IAAU,CAC3D,GAAI,CACF,MAAMmT,GAAM,MAAMtuB,EAAG,YAAY0C,EAAWwO,EAAQ,GAAI5N,EAAO,GAAI6X,GAAM,IAAI,EAC7E,OAAAmjB,IACA/D,GAAkB,aAAa+D,CAAa,IAAIH,EAAc,MAAM,YAAY,EAChFjB,GAAkB/hB,GAAM,GAAI,CAAE,OAAQ,YAAa,YAAamT,GAAK,UAAWnT,GAAM,UAAY,GAAK,EAAG,EACnG,CAAE,GAAIA,GAAM,GAAI,IAAAmT,EAAA,CACzB,OAASne,GAAK,CACZ,eAAQ,MAAM,SAASgL,GAAM,IAAI,kBAAmBhL,EAAG,EACvDouB,KACArB,GAAkB/hB,GAAM,GAAI,CAAE,OAAQ,SAAU,MAAOhL,GAAI,SAAW,gBAAiB,UAAWgL,GAAM,UAAY,GAAK,EAAG,EACrH,CAAE,GAAIA,GAAM,GAAI,IAAK,KAAM,MAAOhL,GAAI,QAC/C,CACF,CAAC,EAGDqB,GADgB,MAAM,QAAQ,IAAIgtB,EAAc,GAC5B,OAAO16B,IAAKA,GAAE,MAAQ,IAAI,EAAE,IAAIA,IAAKA,GAAE,GAAG,EAE1Dy6B,GAAc,GAAK/sB,EAAU,OAAS,EACxCkT,EAAY,GAAGlT,EAAU,MAAM,IAAI2sB,EAAc,MAAM,qBAAqBI,EAAW,6BAA8B,SAAS,EACrHA,GAAc,GAAK/sB,EAAU,SAAW,GACjDkT,EAAY,OAAO6Z,EAAW,yDAA0D,OAAO,CAEnG,CAoBA,GAlBI/sB,EAAU,OAAS,IACrB+oB,GAAkB,kBAAkB,EACpC,MAAMv6B,EAAG,qBAAqBsD,EAAO,GAAIkO,CAAS,GAGpD+oB,GAAkB,mBAAmB,EACrC,MAAMv6B,EAAG,aAAasD,EAAO,GAAIy6B,CAAmB,EAEhDj9B,EAAM,OAAS,IACjBy5B,GAAkB,qBAAqB,EACvC,MAAMv6B,EAAG,WAAWsD,EAAO,GAAIxC,EAAM,IAAIG,IAAS,CAChD,sBAAuBA,EAAK,sBAC5B,YAAaA,EAAK,aAAe,KACjC,gBAAiBA,EAAK,iBAAmB,KACzC,SAAUA,EAAK,UACf,CAAC,GAGDq2B,EAAe,CACjBiD,GAAkB,qBAAqB,EACvC,GAAI,CACF,MAAMv6B,EAAG,sBAAsBsD,EAAO,GAAIg0B,EAAe50B,EAAWwO,EAAQ,WAAa,aAAcA,EAAQ,UAAY,UAAU,CACvI,OAASutB,EAAa,CACpB,QAAQ,MAAM,0BAA2BA,CAAW,EACpD,GAAI,CACF,MAAMz+B,EAAG,iBAAiBsD,EAAO,GAAIg0B,EAAemH,GAAa,SAAW,eAAe,CAC7F,OAASC,EAAW,CAClB,QAAQ,MAAM,+BAAgCA,CAAS,CACzD,CACAha,EAAY,4DAA6D,SAAS,CACpF,CACF,CAEA1P,GAAO,QAAQlE,GAAK,CACdA,EAAE,YAAY,IAAI,gBAAgBA,EAAE,UAAU,CACpD,CAAC,EAEDgpB,EAAmBx2B,CAAM,EACzBohB,EAAY,iBAAkB,SAAS,EACvCuT,EAAQ,CAAC,CACX,OAAS9yB,EAAO,CACd,QAAQ,MAAM,wBAAyBA,CAAK,EAC5Cuf,EAAY,uBAAwB,OAAO,CAC7C,SACE4V,GAAc,EAAK,EACnBC,GAAkB,EAAE,CACtB,CACF,EAEA,OACE7X,OAAC,OAAI,UAAU,YAEb,UAAAA,OAAC,OAAI,UAAU,mBACZ,UAAAsV,EAAO,EACNlX,MAAC,UAAO,UAAU,cAAc,QAAS+V,GAAS,aAAS,EAE3D/V,MAAC,OAAI,UAAU,mBAAmB,eAACqY,GAAA,CAAa,KAAM,GAAI,EAAE,SAE7D,MACE,UAAAnB,IAAS,GAAK5mB,GAAE,UAAU,EAC1B4mB,IAAS,GAAK5mB,GAAE,WAAW,EAC3B4mB,IAAS,GAAK5mB,GAAE,oBAAoB,EACpC4mB,IAAS,GAAK5mB,GAAE,QAAQ,EACxB4mB,IAAS,IAAMlI,IAAS,KAAO,YAAc,YAChD,EACApN,OAAC,OAAI,UAAU,kBACZ,UAAAsV,EAAO,GACNtV,OAAC,UACC,UAAU,iBACV,QAAS,IAAMgY,GAAQ5K,IAAS,KAAO,KAAO,IAAI,EAClD,MAAOA,IAAS,KAAO,oBAAsB,oBAE7C,UAAAhP,MAAC6d,GAAA,CAAM,KAAM,GAAI,EAChB7O,IAAS,KAAO,KAAO,QAG3BkI,EAAO,GACNtV,OAAC,OAAI,UAAU,eACb,UAAA5B,MAAC,QAAK,UAAW,UAAUkX,GAAQ,EAAI,SAAW,EAAE,GAAI,EACxDlX,MAAC,QAAK,UAAW,UAAUkX,GAAQ,EAAI,SAAW,EAAE,GAAI,EACxDlX,MAAC,QAAK,UAAW,UAAUkX,GAAQ,EAAI,SAAW,EAAE,GAAI,EACxDlX,MAAC,QAAK,UAAW,UAAUkX,GAAQ,EAAI,SAAW,EAAE,GAAI,GAC1D,GAEJ,GACF,EAGCA,IAAS,GACRlX,MAAC2O,GAAA,CACC,QAAAve,EACA,SAAA0E,EACA,YAAA8Z,EACA,YAAAC,EACA,eAAAC,EACA,MAAA7Z,EACA,SAAA8Z,GACA,EAAAze,GACA,KAAA0e,CAAA,GAKHkI,IAAS,GACRlX,MAACgR,GAAA,CACC,YAAAnd,EACA,UAAAC,EACA,SAAAC,EACA,eAAAH,GACA,oBAAAqd,GACA,uBAAAC,GACA,gBAAAC,GACA,aAAAC,GACA,sBAAAC,EACA,oBAAAC,GACA,WAAAC,GACA,oBAAAC,EACA,uBAAAC,EACA,WAAApB,GACA,cAAAC,EACA,oBAAAoB,GACA,aAAAC,GACA,oBAAAC,GACA,cAAAC,GACA,aAAAC,GACA,mBAAoB8I,GACpB,kBAAmBJ,GACnB,oBAAqBG,GACrB,gBAAiBa,GACjB,qBAAsBN,EACtB,uBAAwBC,GACxB,eAAgBJ,GAChB,kBAAAzI,GACA,kBAAAC,GACA,YAAa0I,GACb,eAAAxI,GACA,eAAAC,GACA,WAAYsI,GACZ,cAAApI,GACA,cAAAC,GACA,iBAAAC,GACA,oBAAAC,GACA,oBAAAC,GACA,wBAAAC,GACA,EAAA3iB,GACA,KAAA0e,EACA,YAAApL,CAAA,GAKHsT,IAAS,GACRlX,MAACiU,GAAA,CACC,UAAAryB,EACA,MAAA5B,EACA,SAAAk0B,EACA,EAAA5jB,GACA,KAAA0e,EACA,YAAApL,CAAA,IAKFsT,IAAS,GAAKA,IAAS,IACvBlX,MAACiX,GAAA,CACC,KAAAC,EACA,QAAAC,EACA,QAAA/mB,EACA,UAAAxO,EACA,SAAAkT,EACA,YAAA+Z,EACA,MAAA5Z,EACA,OAAAf,GACA,WAAY4nB,GACZ,cAAeU,GACf,UAAAjG,EACA,cAAAC,EACA,iBAAAC,EACA,eAAAC,GACA,MAAA12B,EACA,sBAAAqxB,EACA,wBAAA+F,GACA,iBAAAC,GACA,eAAAC,GACA,cAAAC,GACA,aAAAC,GACA,cAAA3F,GACA,aAAAC,GACA,gBAAA2F,EACA,mBAAAC,EACA,gBAAAC,EACA,WAAAC,EACA,eAAAC,GACA,aAAAC,EACA,gBAAAC,EACA,uBAAAC,EACA,0BAAAC,EACA,oBAAAC,EACA,uBAAAC,EACA,mBAAoBmE,GACpB,EAAAhsB,GACA,KAAA0e,EACA,YAAApL,CAAA,GAKHsT,EAAO,GACNtV,OAAC,OAAI,UAAU,mBACZ,UAAAib,GAAmB,OAAS,GAC3Bjb,OAAC,OAAI,UAAU,wBACb,UAAA5B,MAACkT,GAAA,CAAY,KAAM,GAAI,EACvBlT,MAAC,QAAM,SAAA6c,GAAmB,CAAC,EAAE,GAC/B,EAGD3F,IAAS,GACRlX,MAAC,UAAO,UAAU,qBAAqB,QAAS+c,GAAQ,SAAU,CAACN,GAAA,EAChE,SAAAnsB,GAAE,UAAU,EACf,EAGD4mB,IAAS,GACRtV,OAAC,UAAO,UAAU,qBAAqB,QAASmb,GAAQ,SAAU,CAACN,GAAA,EAChE,UAAAnsB,GAAE,eAAe,EAAE,KAAGknB,GAAa,IAAuBlnB,GAArBknB,KAAiB,EAAM,SAAc,gBAAN,EAAwB,KAAG3F,GAAgBC,GAAa,SAC/H,EAGDoF,IAAS,GACRtV,OAAAoH,WAAA,CACE,UAAApH,OAAC,UAAO,UAAU,qBAAqB,QAASmb,GAC7C,UAAA/N,IAAS,KAAO,kBAAoB,mBAAmB,KAAGhvB,EAAM,OAAO,IAAEA,EAAM,SAAW,EAAIsQ,GAAE,MAAM,EAAIA,GAAE,cAAc,EAAE,KAC/H,EACA0P,MAAC,UAAO,UAAU,cAAc,QAAS+c,GACtC,SAAAzsB,GAAE,iBAAiB,EACtB,GACF,EAGD4mB,IAAS,GACRlX,MAAC,UACC,UAAW,qBAAqB4X,EAAa,aAAe,EAAE,IAAKH,EAAgB,OAAwB,QAAf,YAAsB,GAClH,QAASuF,GACT,SAAUpF,GAAc,CAACH,EAAgB,OAExC,WACC7V,OAAAoH,WAAA,CACE,UAAAhJ,MAAC8L,GAAA,CAAQ,KAAM,GAAI,UAAU,aAAa,QACzC,QAAK,UAAU,iBAAkB,SAAA+L,IAAkBvnB,GAAE,YAAY,EAAE,GACtE,EACGmnB,EAAgB,OAMnB7V,OAAAoH,WAAA,CACE,UAAAhJ,MAAC6C,GAAA,CAAM,KAAM,GAAI,EACjB7C,MAAC,QAAM,SAAA1P,GAAE,UAAU,EAAE,GACvB,EARAsR,OAAAoH,WAAA,CACE,UAAAhJ,MAACwY,GAAA,CAAQ,KAAM,GAAI,EACnBxY,MAAC,QAAM,SAAAgP,IAAS,KAAO,uBAAyB,iBAAiB,GACnE,CAKA,EAEJ,EAEJ,EAIDkI,IAAS,GACRtV,OAAC,OAAI,UAAU,mBACb,UAAAA,OAAC,UAAO,UAAU,qBAAqB,QAASmX,EAC9C,UAAA/Y,MAAC6C,GAAA,CAAM,KAAM,GAAI,EACjB7C,MAAC,QAAM,SAAAgP,IAAS,KAAO,OAAS,QAAQ,GAC1C,EACAhP,MAAC,UAAO,UAAU,cAAc,QAAS+Y,EACtC,SAAA/J,IAAS,KAAO,yBAA2B,yBAC9C,GACF,GAEJ,CAEJ,CChmCA,SAAwB8O,GAAY,CAAE,QAAA1tB,EAAS,UAAAxO,EAAW,YAAAgiB,GAAe,CACvE,KAAM,CAACtQ,EAASyqB,CAAU,EAAIrf,WAAS,EAAE,EACnC,CAACC,EAASC,CAAU,EAAIF,WAAS,EAAI,EACrC,CAACsf,EAAQC,CAAS,EAAIvf,WAAS,EAAK,EACpC,CAACwf,EAAaC,CAAc,EAAIzf,WAAS,EAAK,EAC9C,CAAC0f,EAAWC,CAAY,EAAI3f,WAAS,CAAE,KAAM,GAAI,KAAM,GAAI,eAAgB,KAAM,EAGjF,CAAC4f,EAAeC,CAAgB,EAAI7f,WAAS,EAAE,EAC/C,CAAC8f,EAAeC,CAAgB,EAAI/f,WAAS,EAAI,EAGjD,CAACyS,EAAiB0I,CAAkB,EAAInb,WAAS,EAAE,EACnD,CAAC0S,EAAc0I,CAAe,EAAIpb,WAAS,EAAE,EAC7C,CAACggB,EAAgBC,CAAiB,EAAIjgB,WAAS,EAAI,EAGnDkgB,EAAe,CAAC,UAAW,UAAW,aAAc,UAAU,EAE9D3E,GAAiB7a,cAAY,SAAY,CAC7C,GAAI,CACF,MAAM9c,EAAU,MAAMpD,EAAG,eAAekR,EAAQ,EAAE,EAC9C9N,GAAS,SACXy7B,EAAWz7B,EAAQ,OAAO,CAE9B,OAAS+M,EAAK,CACZ,QAAQ,MAAM,sBAAuBA,CAAG,EACxCuU,IAAc,6BAA+B,OAAO,CACtD,SACEhF,EAAW,EAAK,CAClB,CACF,EAAG,CAACxO,GAAS,GAAIwT,CAAW,CAAC,EAEvBib,GAAoBzf,cAAY,SAAY,CAChD,GAAI,CACF,MAAM0f,EAAS,MAAM5/B,EAAG,iBAAiBkR,EAAQ,GAAI,EAAE,EACvDmuB,EAAiBO,CAAM,CACzB,OAASzvB,EAAK,CACZ,QAAQ,MAAM,gCAAiCA,CAAG,CAEpD,SACEovB,EAAiB,EAAK,CACxB,CACF,EAAG,CAACruB,GAAS,EAAE,CAAC,EAEV2uB,GAAmB3f,cAAY,SAAY,CAC/C,GAAI,CAEF,MAAMtf,EAAO,MAAMZ,EAAG,wBAAwB0C,CAAS,EACvDi4B,EAAmB/5B,EAAK,YAAc,EAAE,EACxCg6B,EAAgBh6B,EAAK,SAAW,EAAE,EAG9BA,EAAK,SAAWA,EAAK,QAAQ,OAAS,GACxCu+B,EAAahf,IAAS,CACpB,GAAGA,EACH,KAAMvf,EAAK,QAAQ,CAAC,EAAE,KACtB,eAAgBA,EAAK,QAAQ,CAAC,EAAE,IAChC,CAEN,OAASuP,EAAK,CACZ,QAAQ,MAAM,+BAAgCA,CAAG,EAEjDuU,IAAc,yDAA0D,MAAM,CAChF,SACE+a,EAAkB,EAAK,CACzB,CACF,EAAG,CAAC/8B,EAAWgiB,CAAW,CAAC,EAE3B/E,YAAU,IAAM,CACVzO,GAAS,KACX6pB,GAAA,EACA4E,GAAA,EACIj9B,EACFm9B,GAAA,EAEAJ,EAAkB,EAAK,EAG7B,EAAG,CAACvuB,GAAS,GAAIxO,EAAWq4B,GAAgB4E,GAAmBE,EAAgB,CAAC,EAEhF,MAAMC,EAAoBx+B,GAAU,CAElC,MAAMmzB,EAAavC,EAAa,KAAKsC,IAAMA,GAAG,KAAOlzB,CAAK,EAExD69B,EADE1K,EACW,CACX,GAAGyK,EACH,KAAMzK,EAAW,KACjB,eAAgBA,EAAW,IAIhB,CACX,GAAGyK,EACH,KAAM59B,EACN,eAAgB,KANjB,CASL,EAEMy+B,EAAkB,SAAY,CAClC,GAAI,CAACb,EAAU,KAAK,OAAQ,CAC1Bxa,EAAY,oBAAqB,OAAO,EACxC,MACF,CAEA,GAAI,CAACwa,EAAU,KAAM,CACnBxa,EAAY,gBAAiB,OAAO,EACpC,MACF,CAGA,GAAItQ,EAAQ,KAAKE,GAAKA,EAAE,KAAK,gBAAkB4qB,EAAU,KAAK,OAAO,aAAa,EAAG,CACnFxa,EAAY,uBAAwB,OAAO,EAC3C,MACF,CAEAqa,EAAU,EAAI,EACd,GAAI,CACF,MAAMiB,EAAiB,CAAC,GAAG5rB,EAAS,CAClC,KAAM8qB,EAAU,KAAK,OACrB,KAAMA,EAAU,KAChB,eAAgBA,EAAU,eAC3B,EAED,MAAMl/B,EAAG,gBAAgBkR,EAAQ,GAAI8uB,CAAc,EACnDnB,EAAWmB,CAAc,EAGzBb,EAAa,CAAE,GAAGD,EAAW,KAAM,GAAI,EACvCD,EAAe,EAAK,EACpBva,EAAY,oBAAqB,SAAS,CAC5C,OAASvU,EAAK,CACZ,QAAQ,MAAM,uBAAwBA,CAAG,EACzCuU,EAAY,2BAA4B,OAAO,CACjD,SACEqa,EAAU,EAAK,CACjB,CACF,EAEMkB,EAAqB,MAAOznB,GAAe,CAC/CumB,EAAU,EAAI,EACd,GAAI,CACF,MAAMiB,EAAiB5rB,EAAQ,WACxBE,GAAE,KAAK,gBAAkBkE,EAAW,aAAY,EAEvD,MAAMxY,EAAG,gBAAgBkR,EAAQ,GAAI8uB,CAAc,EACnDnB,EAAWmB,CAAc,EACzBtb,EAAY,sBAAuB,SAAS,CAC9C,OAASvU,EAAK,CACZ,QAAQ,MAAM,yBAA0BA,CAAG,EAC3CuU,EAAY,6BAA8B,OAAO,CACnD,SACEqa,EAAU,EAAK,CACjB,CACF,EAGMmB,GAAiB,MAAOC,GAAiB,CAE7C,GAAI/rB,EAAQ,KAAKE,GAAKA,EAAE,KAAK,gBAAkB6rB,EAAa,KAAK,aAAa,EAAG,CAC/Ezb,EAAY,qBAAsB,MAAM,EACxC,MACF,CAEAqa,EAAU,EAAI,EACd,GAAI,CACF,MAAMiB,EAAiB,CAAC,GAAG5rB,EAAS,CAClC,KAAM+rB,EAAa,KACnB,KAAMA,EAAa,KACnB,eAAgBA,EAAa,eAC9B,EACD,MAAMngC,EAAG,gBAAgBkR,EAAQ,GAAI8uB,CAAc,EACnDnB,EAAWmB,CAAc,EACzBtb,EAAY,GAAGyb,EAAa,IAAI,cAAe,SAAS,CAC1D,OAAShwB,EAAK,CACZ,QAAQ,MAAM,uBAAwBA,CAAG,EACzCuU,EAAY,2BAA4B,OAAO,CACjD,SACEqa,EAAU,EAAK,CACjB,CACF,EAGMqB,EAAyBhB,EAAc,OAC3CiB,GAAM,CAACjsB,EAAQ,KAAKE,GAAKA,EAAE,KAAK,gBAAkB+rB,EAAG,KAAK,aAAa,GAGnEvxB,EAAQ,IAAI,OAAO,mBAAmB,QAAS,CACnD,QAAS,OACT,MAAO,QACP,IAAK,UACN,EAGKwxB,EAAuB,IAAM,CACjC,MAAMC,EAAU,GAChBtO,EAAgB,QAAQ/kB,IAAO,CAC7BqzB,EAAQrzB,GAAI,EAAE,EAAI,CAChB,KAAMA,GAAI,KACV,QAASglB,EAAa,UAAasC,EAAG,cAAgBtnB,GAAI,EAAE,EAEhE,CAAC,EAED,MAAMszB,EAAgBtO,EAAa,OAAOsC,IAAM,CAACA,GAAG,WAAW,EAC/D,OAAIgM,EAAc,OAAS,IACzBD,EAAQ,cAAmB,CACzB,KAAM,QACN,QAASC,CAAA,GAGND,CACT,EAEM9rB,EAAmByd,EAAa,OAAS,EAE/C,OAAIzS,GAAW+f,EAEX9c,OAAC,OAAI,UAAU,eACb,UAAAA,OAAC,OAAI,UAAU,cACb,UAAAA,OAAC,MAAG,UAAA5B,MAACqI,GAAA,CAAQ,KAAM,GAAI,UAAU,cAAc,EAAE,iBAAa,EAC9DrI,MAAC,QAAK,UAAU,YAAa,SAAAhS,CAAA,CAAM,GACrC,EACAgS,MAAC,OAAI,UAAU,eAAe,sBAAU,GAC1C,EAKF4B,OAAC,OAAI,UAAU,eACb,UAAAA,OAAC,OAAI,UAAU,cACb,UAAAA,OAAC,MAAG,UAAA5B,MAACqI,GAAA,CAAQ,KAAM,GAAI,UAAU,cAAc,EAAE,iBAAa,EAC9DrI,MAAC,QAAK,UAAU,YAAa,SAAAhS,CAAA,CAAM,GACrC,EAECsF,EAAQ,SAAW,EAClBsO,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,KAAE,kCAAsB,EACzBA,MAAC,KAAE,UAAU,kBAAkB,qCAAyB,GAC1D,EAEAA,MAAC,OAAI,UAAU,YACZ,SAAA1M,EAAQ,IAAKzJ,GACZ+X,OAAC,OAAsB,UAAU,cAC/B,UAAAA,OAAC,OAAI,UAAU,mBACb,UAAA5B,MAAC,QAAK,UAAU,mBAAoB,SAAAnW,EAAO,KAAK,EAChDmW,MAAC,QAAK,UAAW,qBAAqBnW,EAAO,MAAQ,WAAW,cAAc,QAAQ,OAAQ,GAAG,CAAC,GAC/F,WAAO,KACV,GACF,EACAmW,MAAC,UACC,UAAU,kBACV,QAAS,IAAMmf,EAAmBt1B,EAAO,IAAI,EAC7C,SAAUm0B,EACX,cAED,GAbQn0B,EAAO,IAcjB,CACD,EACH,EAID,CAAC20B,GAAiBc,EAAuB,OAAS,GACjD1d,OAAC,OAAI,UAAU,iBACb,UAAA5B,MAAC,OAAI,UAAU,wBACb,SAAAA,MAAC,QAAK,sBAAU,EAClB,QACC,OAAI,UAAU,sBACZ,SAAAsf,EAAuB,IAAIC,GAC1B3d,OAAC,UAEC,UAAU,qBACV,QAAS,IAAMwd,GAAeG,CAAE,EAChC,SAAUvB,EAEV,UAAAhe,MAAC,QAAK,UAAU,sBAAuB,SAAAuf,EAAG,KAAK,EAC/Cvf,MAAC,QAAK,UAAU,sBAAuB,WAAG,KAAK,IAN1Cuf,EAAG,KAQX,EACH,GACF,EAIDrB,EACCtc,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,SACC,KAAK,OACL,MAAOoe,EAAU,KACjB,SAAW1d,GAAM2d,EAAa,CAAE,GAAGD,EAAW,KAAM1d,EAAE,OAAO,MAAO,EACpE,YAAY,OACZ,UAAS,KAEXV,MAAC,UACC,MAAOoe,EAAU,gBAAkBA,EAAU,KAC7C,SAAW1d,GAAMse,EAAiBte,EAAE,OAAO,KAAK,EAE/C,SAAA/M,EAEC,OAAO,QAAQ6rB,EAAA,CAAsB,EAAE,IAAI,CAAC,CAACG,EAAO16B,CAAQ,IAC1D+a,MAAC,YAAqB,MAAO/a,EAAS,KACnC,SAAAA,EAAS,QAAQ,IAAIyuB,IACpB1T,MAAC,UAAmB,MAAO0T,GAAG,GAC3B,SAAAA,GAAG,MADOA,GAAG,EAEhB,CACD,GALYiM,CAMf,CACD,EAGDf,EAAa,IAAI90B,GACfkW,MAAC,UAAkB,MAAOlW,EAAO,SAAAA,CAAA,EAApBA,CAAyB,CACvC,IAGL8X,OAAC,OAAI,UAAU,mBACb,UAAA5B,MAAC,UACC,UAAU,mBACV,QAASif,EACT,SAAUjB,EAET,WAAS,MAAQ,QAEpBhe,MAAC,UACC,UAAU,kBACV,QAAS,IAAM,CACbme,EAAe,EAAK,EACpBE,EAAa,CAAE,KAAM,GAAI,KAAMjN,EAAa,CAAC,GAAG,MAAQ,UAAW,eAAgBA,EAAa,CAAC,GAAG,IAAM,KAAM,CAClH,EACD,mBAED,EACF,GACF,EAEAxP,OAAC,UACC,UAAU,eACV,QAAS,IAAMuc,EAAe,EAAI,EAElC,UAAAne,MAACyI,GAAA,CAAS,KAAM,GAAI,EACpBzI,MAAC,QAAK,0BAAc,KAIxB4B,OAAC,OAAI,UAAU,aACZ,UAAAtO,EAAQ,OAAO,IAAEA,EAAQ,SAAW,EAAI,SAAW,SAAS,YAC/D,GACF,CAEJ,CC9VA,SAAwBssB,GAAY,CAAE,QAAAxvB,EAAS,YAAAwT,EAAa,QAAAgF,GAAW,CACrE,KAAM,CAACjK,EAASC,CAAU,EAAIF,WAAS,EAAI,EACrC,CAACkZ,EAAY4B,CAAa,EAAI9a,WAAS,EAAK,EAC5C,CAAC7b,EAAQg9B,CAAS,EAAInhB,WAAS,IAAI,EACnC,CAACohB,EAAYC,CAAa,EAAIrhB,WAAS,EAAE,EACzC,CAACjI,EAAQupB,CAAS,EAAIthB,WAAS,EAAE,EAEvCG,YAAU,IAAM,CACVzO,GAAS,IACX6vB,EAAA,CAEJ,EAAG,CAAC7vB,GAAS,EAAE,CAAC,EAEhB,MAAM6vB,EAAa,SAAY,CAC7B,GAAI,CAEF,MAAMxoB,EAAW,MAAMvY,EAAG,eAAekR,EAAQ,EAAE,EAEnD,GAAIqH,EACFooB,EAAUpoB,CAAQ,EAClBsoB,EAActoB,EAAS,aAAe,EAAE,EACxCuoB,EAAUvoB,EAAS,QAAU,EAAE,MAC1B,CAEL,MAAMoB,EAAW,MAAM3Z,EAAG,mBAAmBkR,EAAQ,EAAE,EACvDyvB,EAAU,CACR,GAAGhnB,EACH,OAAQ,QACT,CACH,CACF,OAASxJ,EAAK,CACZ,QAAQ,MAAM,wBAAyBA,CAAG,EAC1CuU,EAAY,uBAAwB,OAAO,CAC7C,SACEhF,EAAW,EAAK,CAClB,CACF,EAEMoe,EAAe,SAAY,CAE/B,GAAI,CAACv4B,EAAsB,CACzBmf,EAAY,4DAA8D,MAAM,EAChFgF,EAAA,EACA,MACF,CAEA4Q,EAAc,EAAI,EAClB,GAAI,CAEF,MAAMt6B,EAAG,gBAAgBkR,EAAQ,GAAI,CACnC,YAAa0vB,EACb,OAAArpB,CAAA,CACD,EAGc,MAAMvX,EAAG,kBAAkBkR,EAAQ,GAAI,OAAO,GAG3DwT,EAAY,0BAA2B,SAAS,EAChDgF,EAAA,GAEAhF,EAAY,qCAAsC,OAAO,CAE7D,OAASvU,EAAK,CACZ,QAAQ,MAAM,2BAA4BA,CAAG,EAC7CuU,EAAY,0BAA2B,OAAO,CAChD,SACE4V,EAAc,EAAK,CACrB,CACF,EAEMxrB,EAAQ,IAAI,OAAO,mBAAmB,QAAS,CACnD,QAAS,OACT,MAAO,OACP,IAAK,UACL,KAAM,UACP,EAED,GAAI2Q,EACF,OACEiD,OAAC,OAAI,UAAU,eACb,UAAAA,OAAC,OAAI,UAAU,sBACb,UAAA5B,MAAC,UAAO,UAAU,kBAAkB,QAAS4I,EAAS,aAAC,EACvD5I,MAAC,MAAG,wBAAY,GAClB,EACAA,MAAC,OAAI,UAAU,uBAAuB,+BAAmB,GAC3D,EAKJ,GAAI,CAACnd,EACH,OACE+e,OAAC,OAAI,UAAU,eACb,UAAAA,OAAC,OAAI,UAAU,sBACb,UAAA5B,MAAC,UAAO,UAAU,kBAAkB,QAAS4I,EAAS,aAAC,EACvD5I,MAAC,MAAG,wBAAY,GAClB,EACA4B,OAAC,OAAI,UAAU,qBACb,UAAA5B,MAAC,KAAE,uCAA2B,QAC7B,UAAO,UAAU,oBAAoB,QAASigB,EAAY,iBAAK,GAClE,GACF,EAIJ,MAAMC,EAAcr9B,EAAO,SAAW,YAEtC,OACE+e,OAAC,OAAI,UAAU,eACb,UAAAA,OAAC,OAAI,UAAU,sBACb,UAAA5B,MAAC,UAAO,UAAU,kBAAkB,QAAS4I,EAAS,aAAC,SACtD,OACC,UAAA5I,MAAC,MAAG,wBAAY,EAChBA,MAAC,KAAE,UAAU,oBAAqB,SAAAhS,CAAA,CAAM,GAC1C,GACF,EAECkyB,GACCte,OAAC,OAAI,UAAU,gCAAgC,yBAChC,IAAI,KAAK/e,EAAO,YAAY,EAAE,oBAAmB,EAChE,EAGF+e,OAAC,OAAI,UAAU,uBAEb,UAAAA,OAAC,OAAI,UAAU,uBACb,UAAAA,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,OAAI,UAAU,0BAA2B,SAAAnd,EAAO,YAAc,EAAE,EACjEmd,MAAC,OAAI,UAAU,0BAA0B,wBAAY,GACvD,EACA4B,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,OAAI,UAAU,0BAA2B,SAAAnd,EAAO,iBAAmB,EAAE,EACtEmd,MAAC,OAAI,UAAU,0BAA0B,sBAAU,GACrD,EACA4B,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,OAAI,UAAU,0BAA2B,SAAAnd,EAAO,kBAAoB,EAAE,EACvEmd,MAAC,OAAI,UAAU,0BAA0B,uBAAW,GACtD,EACA4B,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,OAAI,UAAU,0BAA2B,SAAAnd,EAAO,cAAgB,EAAE,EACnEmd,MAAC,OAAI,UAAU,0BAA0B,kBAAM,GACjD,GACF,EAGCnd,EAAO,WAAW,OAAS,GAC1B+e,OAAC,OAAI,UAAU,uBACb,UAAAA,OAAC,MAAG,UAAA5B,MAACqI,GAAA,CAAQ,KAAM,GAAI,UAAU,cAAc,EAAE,SAAK,EACtDrI,MAAC,OAAI,UAAU,oBACZ,SAAAnd,EAAO,UAAU,IAAI,CAACgH,EAAQ+C,IAC7BgV,OAAC,OAAY,UAAU,yBACrB,UAAA5B,MAAC,QAAM,WAAO,KAAK,EACnBA,MAAC,QAAK,UAAU,yBAA0B,WAAO,KAAK,IAF9CpT,CAGV,CACD,EACH,GACF,EAID/J,EAAO,iBAAiB,OAAS,GAChC+e,OAAC,OAAI,UAAU,uBACb,UAAAA,OAAC,MAAG,UAAA5B,MAACmgB,GAAA,CAAY,KAAM,GAAI,UAAU,cAAc,EAAE,oBAAgB,EACrEngB,MAAC,MAAG,UAAU,qBACX,SAAAnd,EAAO,gBAAgB,IAAI,CAACu9B,EAAMxzB,IACjCgV,OAAC,MACE,UAAAwe,EAAK,KACLA,EAAK,OAASpgB,MAAC,QAAK,UAAU,0BAA2B,WAAK,MAAM,IAF9DpT,CAGT,CACD,EACH,GACF,EAIFgV,OAAC,OAAI,UAAU,uBACb,UAAAA,OAAC,MAAG,UAAA5B,MAACiP,GAAA,CAAS,KAAM,GAAI,UAAU,cAAc,EAAE,UAAM,EACxDjP,MAAC,YACC,MAAO8f,EACP,SAAWpf,GAAMqf,EAAcrf,EAAE,OAAO,KAAK,EAC7C,YAAY,kCACZ,KAAM,EACN,SAAUwf,CAAA,EACZ,EACF,EAGAte,OAAC,OAAI,UAAU,uBACb,UAAAA,OAAC,MAAG,UAAA5B,MAACwJ,GAAA,CAAc,KAAM,GAAI,UAAU,cAAc,EAAE,sBAAkB,EACzExJ,MAAC,YACC,MAAOvJ,EACP,SAAWiK,GAAMsf,EAAUtf,EAAE,OAAO,KAAK,EACzC,YAAY,uCACZ,KAAM,EACN,SAAUwf,CAAA,EACZ,EACF,GACF,EAGC,CAACA,GACAte,OAAC,OAAI,UAAU,sBACb,UAAA5B,MAAC,UACC,UAAU,sCACV,QAASgd,EACT,SAAUpF,EAET,SAAAA,EAAa,gBAAkBhW,OAAAoH,WAAA,CAAE,UAAAhJ,MAACqgB,GAAA,CAAO,KAAM,GAAI,UAAU,cAAc,EAAE,kBAAc,IAE9FrgB,MAAC,KAAE,UAAU,oBAAoB,2CAA+B,GAClE,GAEJ,CAEJ,CCvNA,SAAwBsgB,GAAiB,CAAE,QAAAlwB,EAAS,UAAAxO,EAAW,KAAA8E,EAAM,QAAAkiB,EAAS,gBAAA2X,GAAmB,CAC/F,KAAM,CAAC5hB,EAASC,CAAU,EAAIF,WAAS,EAAK,EACtC,CAACqC,EAAOC,CAAQ,EAAItC,WAAS,IAAI,EACjC,CAACwY,EAAMC,CAAO,EAAIzY,WAAS,CAAC,EAG5B,CAAC8hB,EAAcC,CAAe,EAAI/hB,WAAS,IAAI,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,CAAC,EACjF,CAACgiB,EAAcC,CAAe,EAAIjiB,WAAS,IAAI,OAAO,eAAe,MAAM,GAAG,EAAE,CAAC,EAAE,UAAU,EAAG,CAAC,CAAC,EAClG,CAACkiB,EAAkBC,CAAmB,EAAIniB,WAAS,EAAE,EACrD,CAACoiB,EAAqBC,CAAsB,EAAIriB,WAAS,EAAE,EAC3D,CAACsiB,EAAYC,CAAa,EAAIviB,WAAS,OAAO,EAC9C,CAACwiB,EAAkBC,CAAmB,EAAIziB,WAAS,EAAE,EAGrD,CAAC0iB,EAAcC,EAAe,EAAI3iB,WAAS,EAAE,EAC7C,CAAC4iB,GAAeC,EAAgB,EAAI7iB,WAAS,EAAE,EAC/C,CAAC8iB,EAAeC,CAAgB,EAAI/iB,WAAS,EAAE,EAC/C,CAACgjB,EAAiBC,EAAkB,EAAIjjB,WAAS,EAAE,EACnD,CAACkjB,EAAkBC,CAAmB,EAAInjB,WAAS,EAAE,EACrD,CAACojB,EAAkBC,CAAmB,EAAIrjB,WAAS,EAAE,EAGrD,CAACsjB,EAAgBC,CAAiB,EAAIvjB,WAAShY,GAAM,MAAQ,EAAE,EAC/D,CAACw7B,GAAiBC,CAAkB,EAAIzjB,WAAS,EAAE,EACnD,CAAC0jB,EAAiBC,CAAkB,EAAI3jB,WAAS,EAAE,EACnD,CAAC4jB,GAAiBC,EAAkB,EAAI7jB,WAAShY,GAAM,OAAS,EAAE,EAGlE,CAACgU,EAAW8nB,CAAY,EAAI9jB,WAAS,EAAE,EACvC,CAAC+jB,GAAaC,EAAc,EAAIhkB,WAAS,EAAE,EAC3C,CAACikB,GAAcC,EAAe,EAAIlkB,WAAS,EAAE,EAC7C,CAACmkB,GAAcC,EAAe,EAAIpkB,WAAS,EAAE,EAC7C,CAACqkB,GAAkBC,CAAmB,EAAItkB,WAAS,EAAE,EAGrD,CAACukB,GAA0BC,EAA2B,EAAIxkB,WAAS,EAAK,EACxE,CAACykB,GAAqBC,EAAsB,EAAI1kB,WAAS,EAAE,EAC3D,CAAC2kB,GAAwBC,EAAyB,EAAI5kB,WAAS,EAAE,EACjE,CAAC6kB,GAAcC,EAAe,EAAI9kB,WAAS,EAAK,EAGhD,CAAC+kB,GAAuBC,EAAwB,EAAIhlB,WAAS,EAAE,EAC/D,CAACilB,GAA0BC,EAA2B,EAAIllB,WAAS,EAAE,EACrE,CAACmlB,EAAqBC,EAAsB,EAAIplB,WAAS,EAAE,EAC3D,CAACqlB,GAAuBC,EAAwB,EAAItlB,WAAS,EAAE,EAG/D,CAACulB,GAAgBC,EAAiB,EAAIxlB,WAAS,EAAK,EACpD,CAACylB,GAAkBC,EAAmB,EAAI1lB,WAAS,EAAK,EACxD,CAAC2lB,GAAkBC,EAAmB,EAAI5lB,WAAS,CAAC,EACpD,CAAC6lB,GAAoBC,EAAqB,EAAI9lB,WAAS,CAAC,EAExD+lB,GAAmB,IAAM,CAC7B,GAAI,CAAChC,GAAY,OAAQ,CACvBzhB,EAAS,CAAE,KAAM,QAAS,QAAS,4BAA6B,EAChE,MACF,CAEA,MAAMvG,EAAU,CACd,KAAMgoB,GACN,MAAOE,GACP,MAAOE,GACP,UAAWE,EAAA,EAGbP,EAAa,CAAC,GAAG9nB,EAAWD,CAAO,CAAC,EACpCioB,GAAe,EAAE,EACjBE,GAAgB,EAAE,EAClBE,GAAgB,EAAE,EAClBE,EAAoB,EAAE,EACtBhiB,EAAS,CAAE,KAAM,UAAW,QAAS,gBAAiB,CACxD,EAEM0jB,GAAuB57B,GAAU,CACrC05B,EAAa9nB,EAAU,OAAO,CAACob,GAAGlpB,KAAMA,KAAM9D,CAAK,CAAC,CACtD,EAEM67B,GAAgBC,GAAe,CACnC,OAAQA,EAAA,CACN,IAAK,GACH,GAAI,CAAChE,EAAiB,QAAU,CAACE,EAAoB,OACnD,OAAA9f,EAAS,CAAE,KAAM,QAAS,QAAS,sCAAuC,EACnE,GAET,MACF,IAAK,GACH,GAAI,CAACogB,EAAa,QAAU,CAACQ,EAAiB,OAC5C,OAAA5gB,EAAS,CAAE,KAAM,QAAS,QAAS,6CAA8C,EAC1E,GAET,MACF,IAAK,GACH,GAAI,CAACghB,EAAe,QAAU,CAACE,GAAgB,OAC7C,OAAAlhB,EAAS,CAAE,KAAM,QAAS,QAAS,2CAA4C,EACxE,GAET,MAEJ,MAAO,EACT,EAEM6jB,GAAa,IAAM,CACnBF,GAAazN,CAAI,GACnBC,EAAQD,EAAO,CAAC,CAEpB,EAEM4N,GAAa,IAAM,CACvB3N,EAAQD,EAAO,CAAC,CAClB,EAEM8F,GAAe,SAAY,CAC/B,GAAK2H,GAAazN,CAAI,EAGtB,IAAI,CAACzyB,EAAsB,CACzBuc,EAAS,CAAE,KAAM,OAAQ,QAAS,4DAA8D,EAChG,WAAW,IAAM,CACf4H,EAAA,CACF,EAAG,IAAI,EACP,MACF,CAEAhK,EAAW,EAAI,EACf,GAAI,CACF,MAAMlG,EAAa,CACjB,WAAYtI,EAAQ,GACpB,WAAYxO,EAGZ,cAAe4+B,EACf,cAAeE,EACf,kBAAmBE,EACnB,qBAAsBE,EACtB,YAAaE,EACb,mBAAoBE,GAAoB,KAGxC,cAAeE,EACf,eAAgBE,IAAiB,KACjC,eAAgBE,GAAiB,KACjC,iBAAkBE,GAAmB,KACrC,mBAAoBE,EACpB,mBAAoBE,GAAoB,KAGxC,2BAA4BmB,GAC5B,sBAAuBE,IAAuB,KAC9C,yBAA0BE,IAA0B,KACpD,aAAAE,GAGA,iBAAkBvB,EAClB,kBAAmBE,GACnB,kBAAmBE,GAAmB,KACtC,kBAAmBE,IAAmB,KAGtC,UAAA5nB,EAGA,wBAAyB+oB,IAAyB,KAClD,2BAA4BE,IAA4B,KACxD,sBAAuBE,GAAuB,KAC9C,wBAAyBE,IAAyB,KAGlD,gBAAiBE,GACjB,mBAAoBE,GACpB,oBAAqB,SAASE,EAAgB,GAAK,EACnD,qBAAsB,SAASE,EAAkB,GAAK,EAGtD,OAAQ,WACR,WAAY79B,GAAM,IAGd7D,GAAS,MAAM3D,EAAG,mBAAmBwZ,CAAU,EAErDsI,EAAS,CAAE,KAAM,UAAW,QAAS,uCAAwC,EAEzEuf,GACFA,EAAgB19B,EAAM,EAGxB,WAAW,IAAM,CACf+lB,EAAA,CACF,EAAG,IAAI,CACT,OAASvkB,EAAO,CACd,QAAQ,MAAM,kCAAmCA,CAAK,EACtD2c,EAAS,CAAE,KAAM,QAAS,QAAS,iCAAkC,CACvE,SACEpC,EAAW,EAAK,CAClB,EACF,EAEA,OACEgD,OAAAoH,WAAA,CACE,UAAAhJ,MAAC,OAAI,UAAU,gBAAgB,QAAS4I,EACtC,SAAAhH,OAAC,OAAI,UAAU,oCAAoC,QAASlB,GAAKA,EAAE,kBACjE,UAAAkB,OAAC,OAAI,UAAU,eACb,UAAA5B,MAAC,MAAG,4CAAgC,QACnC,UAAO,UAAU,YAAY,QAAS4I,EAAS,aAAO,GACzD,EAGAhH,OAAC,OAAI,UAAU,iBACb,UAAA5B,MAAC,OAAI,UAAW,QAAQkX,GAAQ,EAAI,SAAW,EAAE,GAAI,uBAAW,EAChElX,MAAC,OAAI,UAAW,QAAQkX,GAAQ,EAAI,SAAW,EAAE,GAAI,uBAAW,EAChElX,MAAC,OAAI,UAAW,QAAQkX,GAAQ,EAAI,SAAW,EAAE,GAAI,yBAAa,EAClElX,MAAC,OAAI,UAAW,QAAQkX,GAAQ,EAAI,SAAW,EAAE,GAAI,wBAAY,EACjElX,MAAC,OAAI,UAAW,QAAQkX,GAAQ,EAAI,SAAW,EAAE,GAAI,+BAAmB,GAC1E,EAEAtV,OAAC,OAAI,UAAU,aAEZ,UAAAsV,IAAS,GACRtV,OAAC,OAAI,UAAU,YACb,UAAA5B,MAAC,MAAG,4BAAgB,EAEpB4B,OAAC,OAAI,UAAU,WACb,UAAAA,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,8BAAkB,EACzBA,MAAC,SACC,KAAK,OACL,MAAOwgB,EACP,SAAW9f,GAAM+f,EAAgB/f,EAAE,OAAO,KAAK,EAC/C,QAAS,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,GAC5C,EACF,EACAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,8BAAkB,EACzBA,MAAC,SACC,KAAK,OACL,MAAO0gB,EACP,SAAWhgB,GAAMigB,EAAgBjgB,EAAE,OAAO,KAAK,GACjD,EACF,GACF,EAEAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,8BAAkB,EACzBA,MAAC,SACC,KAAK,OACL,MAAO4gB,EACP,SAAWlgB,GAAMmgB,EAAoBngB,EAAE,OAAO,KAAK,EACnD,YAAY,sCACd,EACF,EAEAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,kCAAsB,EAC7BA,MAAC,YACC,MAAO8gB,EACP,SAAWpgB,GAAMqgB,EAAuBrgB,EAAE,OAAO,KAAK,EACtD,KAAM,EACN,YAAY,uCACd,EACF,EAEAkB,OAAC,OAAI,UAAU,WACb,UAAAA,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,yBAAa,EACpB4B,OAAC,UAAO,MAAOof,EAAY,SAAWtgB,GAAMugB,EAAcvgB,EAAE,OAAO,KAAK,EACtE,UAAAV,MAAC,UAAO,MAAM,QAAQ,wBAAY,EAClCA,MAAC,UAAO,MAAM,UAAU,0BAAc,EACtCA,MAAC,UAAO,MAAM,WAAW,2BAAe,EACxCA,MAAC,UAAO,MAAM,YAAY,iCAAqB,GACjD,GACF,EACA4B,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,8BAAkB,EACzBA,MAAC,SACC,KAAK,OACL,MAAOkhB,EACP,SAAWxgB,GAAMygB,EAAoBzgB,EAAE,OAAO,KAAK,EACnD,YAAY,+BACd,EACF,GACF,GACF,EAIDwW,IAAS,GACRtV,OAAC,OAAI,UAAU,YACb,UAAA5B,MAAC,MAAG,wCAA4B,EAEhC4B,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,uBAAW,EAClBA,MAAC,SACC,KAAK,OACL,MAAOohB,EACP,SAAW1gB,GAAM2gB,GAAgB3gB,EAAE,OAAO,KAAK,EAC/C,YAAY,uBACd,EACF,EAEAkB,OAAC,OAAI,UAAU,WACb,UAAAA,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,wBAAY,EACnBA,MAAC,SACC,KAAK,MACL,MAAOshB,GACP,SAAW5gB,GAAM6gB,GAAiB7gB,EAAE,OAAO,KAAK,EAChD,YAAY,kBACd,EACF,EACAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,yBAAa,EACpBA,MAAC,SACC,KAAK,QACL,MAAOwhB,EACP,SAAW9gB,GAAM+gB,EAAiB/gB,EAAE,OAAO,KAAK,EAChD,YAAY,qBACd,EACF,GACF,EAEAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,wBAAY,EACnBA,MAAC,SACC,KAAK,OACL,MAAO0hB,EACP,SAAWhhB,GAAMihB,GAAmBjhB,EAAE,OAAO,KAAK,EAClD,YAAY,oCACd,EACF,EAEAkB,OAAC,OAAI,UAAU,WACb,UAAAA,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,uBAAW,EAClBA,MAAC,SACC,KAAK,OACL,MAAO4hB,EACP,SAAWlhB,GAAMmhB,EAAoBnhB,EAAE,OAAO,KAAK,EACnD,YAAY,gCACd,EACF,EACAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,qBAAS,EAChBA,MAAC,SACC,KAAK,OACL,MAAO8hB,EACP,SAAWphB,GAAMqhB,EAAoBrhB,EAAE,OAAO,KAAK,GACrD,EACF,GACF,GACF,EAIDwW,IAAS,GACRtV,OAAC,OAAI,UAAU,YACb,UAAA5B,MAAC,MAAG,4CAAgC,EAEpC4B,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,uBAAW,EAClBA,MAAC,SACC,KAAK,OACL,MAAOgiB,EACP,SAAWthB,GAAMuhB,EAAkBvhB,EAAE,OAAO,KAAK,EACjD,YAAY,aACd,EACF,EAEAkB,OAAC,OAAI,UAAU,WACb,UAAAA,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,wBAAY,EACnBA,MAAC,SACC,KAAK,OACL,MAAOkiB,GACP,SAAWxhB,GAAMyhB,EAAmBzhB,EAAE,OAAO,KAAK,EAClD,YAAY,uCACd,EACF,EACAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,6BAAiB,EACxBA,MAAC,SACC,KAAK,MACL,MAAOoiB,EACP,SAAW1hB,GAAM2hB,EAAmB3hB,EAAE,OAAO,KAAK,EAClD,YAAY,kBACd,EACF,GACF,EAEAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,8BAAkB,EACzBA,MAAC,SACC,KAAK,QACL,MAAOsiB,GACP,SAAW5hB,GAAM6hB,GAAmB7hB,EAAE,OAAO,KAAK,EAClD,YAAY,qBACd,EACF,GACF,EAIDwW,IAAS,GACRtV,OAAC,OAAI,UAAU,YACb,UAAA5B,MAAC,MAAG,0CAA8B,EAEjCtF,EAAU,OAAS,GAClBsF,MAAC,OAAI,UAAU,iBACZ,SAAAtF,EAAU,IAAI,CAACD,EAAS3R,KACvB8Y,OAAC,OAAgB,UAAU,eACzB,UAAAA,OAAC,OAAI,UAAU,eACb,UAAA5B,MAAC,UAAQ,WAAQ,KAAK,EACrBvF,EAAQ,OAASmH,OAAC,QAAK,gBAAInH,EAAQ,OAAM,EACzCA,EAAQ,WACPmH,OAAC,KAAE,UAAU,oBAAoB,cAAEnH,EAAQ,UAAU,KAAC,GAE1D,EACAuF,MAAC,UACC,UAAU,uBACV,QAAS,IAAM0kB,GAAoB57B,EAAK,EACzC,mBAED,GAbQA,EAcV,CACD,EACH,EAGF8Y,OAAC,OAAI,UAAU,mBACb,UAAAA,OAAC,OAAI,UAAU,WACb,UAAAA,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,wBAAY,EACnBA,MAAC,SACC,KAAK,OACL,MAAOyiB,GACP,SAAW/hB,GAAMgiB,GAAehiB,EAAE,OAAO,KAAK,EAC9C,YAAY,aACd,EACF,EACAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,wBAAY,EACnBA,MAAC,SACC,KAAK,MACL,MAAO2iB,GACP,SAAWjiB,GAAMkiB,GAAgBliB,EAAE,OAAO,KAAK,EAC/C,YAAY,kBACd,EACF,GACF,EAEAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,yBAAa,EACpBA,MAAC,SACC,KAAK,QACL,MAAO6iB,GACP,SAAWniB,GAAMoiB,GAAgBpiB,EAAE,OAAO,KAAK,EAC/C,YAAY,qBACd,EACF,EAEAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,6BAAiB,EACxBA,MAAC,YACC,MAAO+iB,GACP,SAAWriB,GAAMsiB,EAAoBtiB,EAAE,OAAO,KAAK,EACnD,KAAM,EACN,YAAY,qCACd,EACF,QAEC,UAAO,UAAU,gBAAgB,QAAS+jB,GAAkB,yBAE7D,GACF,GACF,EAIDvN,IAAS,GACRtV,OAAC,OAAI,UAAU,YACb,UAAA5B,MAAC,MAAG,sCAA0B,EAE9BA,MAAC,OAAI,UAAU,4BACb,gBAAC,SACC,UAAAA,MAAC,SACC,KAAK,WACL,QAASijB,GACT,SAAWviB,GAAMwiB,GAA4BxiB,EAAE,OAAO,OAAO,IAC7D,8BAEJ,EACF,EAECuiB,IACCrhB,OAAAoH,WAAA,CACE,UAAApH,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,iCAAqB,EAC5BA,MAAC,SACC,KAAK,OACL,MAAOmjB,GACP,SAAWziB,GAAM0iB,GAAuB1iB,EAAE,OAAO,KAAK,EACtD,YAAY,2BACd,EACF,EAEAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,oCAAwB,EAC/BA,MAAC,SACC,KAAK,OACL,MAAOqjB,GACP,SAAW3iB,GAAM4iB,GAA0B5iB,EAAE,OAAO,KAAK,EACzD,YAAY,kBACd,EACF,EAEAV,MAAC,OAAI,UAAU,4BACb,gBAAC,SACC,UAAAA,MAAC,SACC,KAAK,WACL,QAASujB,GACT,SAAW7iB,GAAM8iB,GAAgB9iB,EAAE,OAAO,OAAO,IACjD,6BAEJ,EACF,GACF,EAGFkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,mCAAuB,EAC9BA,MAAC,YACC,MAAOyjB,GACP,SAAW/iB,GAAMgjB,GAAyBhjB,EAAE,OAAO,KAAK,EACxD,KAAM,EACN,YAAY,iDACd,EACF,EAEAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,sCAA0B,EACjCA,MAAC,YACC,MAAO2jB,GACP,SAAWjjB,GAAMkjB,GAA4BljB,EAAE,OAAO,KAAK,EAC3D,KAAM,EACN,YAAY,oDACd,EACF,EAEAkB,OAAC,OAAI,UAAU,WACb,UAAAA,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,iCAAqB,EAC5BA,MAAC,SACC,KAAK,OACL,MAAO6jB,EACP,SAAWnjB,GAAMojB,GAAuBpjB,EAAE,OAAO,KAAK,EACtD,YAAY,mCACd,EACF,EACAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,mCAAuB,EAC9BA,MAAC,SACC,KAAK,OACL,MAAO+jB,GACP,SAAWrjB,GAAMsjB,GAAyBtjB,EAAE,OAAO,KAAK,EACxD,YAAY,iCACd,EACF,GACF,EAEAkB,OAAC,OAAI,UAAU,WACb,UAAAA,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,+BAAmB,EAC1BA,MAAC,SACC,KAAK,SACL,IAAI,IACJ,MAAOqkB,GACP,SAAW3jB,GAAM4jB,GAAoB5jB,EAAE,OAAO,KAAK,GACrD,EACF,EACAkB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,SAAM,gCAAoB,EAC3BA,MAAC,SACC,KAAK,SACL,IAAI,IACJ,MAAOukB,GACP,SAAW7jB,GAAM8jB,GAAsB9jB,EAAE,OAAO,KAAK,GACvD,EACF,GACF,EAEAV,MAAC,OAAI,UAAU,4BACb,gBAAC,SACC,UAAAA,MAAC,SACC,KAAK,WACL,QAASikB,GACT,SAAWvjB,GAAMwjB,GAAkBxjB,EAAE,OAAO,OAAO,IACnD,4BAEJ,EACF,EAEAV,MAAC,OAAI,UAAU,4BACb,gBAAC,SACC,UAAAA,MAAC,SACC,KAAK,WACL,QAASmkB,GACT,SAAWzjB,GAAM0jB,GAAoB1jB,EAAE,OAAO,OAAO,IACrD,qCAEJ,EACF,GACF,GAEJ,QAGC,OAAI,UAAU,eACb,SAAAkB,OAAC,OAAI,UAAU,eACZ,UAAAsV,EAAO,GACNlX,MAAC,UAAO,UAAU,gBAAgB,QAAS8kB,GAAY,kBAEvD,QAED,UAAO,UAAU,gBAAgB,QAASlc,EAAS,kBAEpD,EACCsO,EAAO,EACNlX,MAAC,UAAO,UAAU,cAAc,QAAS6kB,GAAY,kBAErD,EAEA7kB,MAAC,UACC,UAAU,cACV,QAASgd,GACT,SAAUre,EAET,WAAU,gBAAkB,iBAC/B,EAEJ,EACF,GACF,EACF,EAECoC,GAASf,MAAC2I,GAAA,CAAM,QAAS5H,EAAM,QAAS,KAAMA,EAAM,KAAM,QAAS,IAAMC,EAAS,IAAI,EAAG,QAEzF,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QA+LN,GACJ,CAEJ,CCt0BA,MAAM+jB,GAAa,CACjB,CAAE,MAAO,WAAY,MAAO,WAAY,KAAM,MAC9C,CAAE,MAAO,QAAS,MAAO,QAAS,KAAM,OACxC,CAAE,MAAO,SAAU,MAAO,SAAU,KAAM,MAC1C,CAAE,MAAO,kBAAmB,MAAO,YAAa,KAAM,KACxD,EAEMC,GAAmBpkC,GAASmkC,GAAW,KAAKz0B,GAAKA,EAAE,QAAU1P,CAAI,GAAK,CAAE,MAAOA,EAAM,KAAM,MAEjG,SAAwBqkC,GAAkB,CAAE,QAAA70B,EAAS,KAAA1J,EAAO,KAAM,KAAA3D,EAAM,YAAA6gB,GAAe,CACrF,KAAM,CAAC5H,EAAOkpB,CAAQ,EAAIxmB,WAAS,EAAE,EAC/B,CAAC/G,EAASwtB,CAAU,EAAIzmB,WAAS,EAAE,EACnC,CAACC,EAASC,CAAU,EAAIF,WAAS,EAAI,EACrC,CAACsf,EAAQC,CAAS,EAAIvf,WAAS,EAAK,EACpC,CAACwf,EAAaC,CAAc,EAAIzf,WAAS,EAAK,EAC9C,CAAC0mB,EAAaC,CAAc,EAAI3mB,WAAS,EAAK,EAC9C,CAAC4mB,EAASC,CAAU,EAAI7mB,WAAS,CAAE,KAAM,WAAY,MAAO,EAAG,EAG/D8mB,EAAc,IAAI,KAAKziC,CAAI,EAAE,mBAAmB,QAAS,CAC7D,QAAS,QACT,MAAO,QACP,IAAK,UACN,EAED8b,YAAU,IAAM,CACd4mB,EAAA,EACAC,EAAA,CACF,EAAG,CAACt1B,EAAQ,GAAIrN,CAAI,CAAC,EAErB,MAAM0iC,EAAmB,SAAY,CACnC,GAAI,CACF7mB,EAAW,EAAI,EACf,MAAM9e,EAAO,MAAMZ,EAAG,iBAAiBkR,EAAQ,GAAIrN,CAAI,EACvDmiC,EAASplC,GAAQ,EAAE,CACrB,OAASuP,EAAK,CACZ,QAAQ,MAAM,gCAAiCA,CAAG,CACpD,SACEuP,EAAW,EAAK,CAClB,CACF,EAEM8mB,EAAc,SAAY,CAC9B,GAAI,CAGF,MAAMjG,GAFO,MAAMvgC,EAAG,wBAAwBkR,EAAQ,GAAI,EAAE,GAEnC,IACtB,OAAOu1B,GAAQA,EAAK,YAAc5iC,CAAI,EACtC,OAAO,CAACmM,EAAKy2B,KACPz2B,EAAIy2B,EAAK,SAAS,IACrBz2B,EAAIy2B,EAAK,SAAS,EAAI,IAExBz2B,EAAIy2B,EAAK,SAAS,EAAE,KAAKA,CAAI,EACtBz2B,GACN,EAAE,EAGD02B,GAAe,OAAO,QAAQnG,CAAO,EACxC,IAAI,CAAC,CAAC3E,EAAS9e,CAAK,KAAO,CAC1B,KAAM8e,EACN,MAAA9e,EACA,WAAYA,EAAM,OAAO,CAACzN,EAAK+kB,IAAM/kB,EAAM+kB,EAAE,WAAY,CAAC,GAC1D,EACD,KAAK,CAACx1B,EAAGC,IAAM,IAAI,KAAKA,EAAE,IAAI,EAAI,IAAI,KAAKD,EAAE,IAAI,CAAC,EAErDqnC,EAAWS,EAAY,CACzB,OAASv2B,EAAK,CACZ,QAAQ,MAAM,kCAAmCA,CAAG,CACtD,CACF,EAEMw2B,EAAgB,SAAY,CAChC,GAAI,EAAAP,EAAQ,MAAQ,GAEpB,CAAArH,EAAU,EAAI,EACd,GAAI,CACF,MAAM/+B,EAAG,gBACPkR,EAAQ,GACR1J,GAAM,IAAM,KACZ3D,EACAuiC,EAAQ,KACRA,EAAQ,OAEV,MAAMG,EAAA,EACNF,EAAW,CAAE,KAAM,WAAY,MAAO,EAAG,EACzCpH,EAAe,EAAK,EACpBva,IAAc,sBAAuB,SAAS,CAChD,OAASvU,EAAK,CACZ,QAAQ,MAAM,8BAA+BA,CAAG,EAChDuU,IAAc,oBAAqB,OAAO,CAC5C,SACEqa,EAAU,EAAK,CACjB,EACF,EAEM6H,EAAmB,MAAO3kC,GAAO,CACrC88B,EAAU,EAAI,EACd,GAAI,CACF,MAAM/+B,EAAG,mBAAmBiC,CAAE,EAC9B,MAAMskC,EAAA,EACN7hB,IAAc,eAAgB,SAAS,CACzC,OAASvU,EAAK,CACZ,QAAQ,MAAM,gCAAiCA,CAAG,EAClDuU,IAAc,sBAAuB,OAAO,CAC9C,SACEqa,EAAU,EAAK,CACjB,CACF,EAEMmB,EAAiB,MAAOrqB,GAAa,CACzCkpB,EAAU,EAAI,EACd,GAAI,CACF,MAAM/+B,EAAG,gBAAgBkR,EAAQ,GAAI1J,GAAM,IAAM,KAAM3D,EAAMgS,EAAU,CAAC,EACxE,MAAM0wB,EAAA,EACN7hB,IAAc,aAAc,SAAS,CACvC,OAASvU,EAAK,CACZ,QAAQ,MAAM,8BAA+BA,CAAG,EAChDuU,IAAc,oBAAqB,OAAO,CAC5C,SACEqa,EAAU,EAAK,CACjB,CACF,EAEM8H,GAAsB,MAAOJ,GAAS,CAC1C1H,EAAU,EAAI,EACd,GAAI,CACF,MAAM/+B,EAAG,mBAAmBymC,EAAK,GAAIA,EAAK,UAAWA,EAAK,WAAa,CAAC,EACxE,MAAMF,EAAA,CACR,OAASp2B,EAAK,CACZ,QAAQ,MAAM,uBAAwBA,CAAG,EACzCuU,IAAc,sBAAuB,OAAO,CAC9C,SACEqa,EAAU,EAAK,CACjB,CACF,EAEM+H,GAAsB,MAAOL,GAAS,CAC1C,GAAIA,EAAK,YAAc,EAAG,CACxB,MAAMG,EAAiBH,EAAK,EAAE,EAC9B,MACF,CAEA1H,EAAU,EAAI,EACd,GAAI,CACF,MAAM/+B,EAAG,mBAAmBymC,EAAK,GAAIA,EAAK,UAAWA,EAAK,WAAa,CAAC,EACxE,MAAMF,EAAA,CACR,OAASp2B,EAAK,CACZ,QAAQ,MAAM,uBAAwBA,CAAG,EACzCuU,IAAc,sBAAuB,OAAO,CAC9C,SACEqa,EAAU,EAAK,CACjB,CACF,EAGMgI,GAAcjqB,EAAM,OAAO,CAAC9M,EAAKy2B,KAChCz2B,EAAIy2B,EAAK,SAAS,IACrBz2B,EAAIy2B,EAAK,SAAS,EAAI,CAAE,MAAO,GAAI,MAAO,IAE5Cz2B,EAAIy2B,EAAK,SAAS,EAAE,MAAM,KAAKA,CAAI,EACnCz2B,EAAIy2B,EAAK,SAAS,EAAE,OAASA,EAAK,WAC3Bz2B,GACN,EAAE,EAEC2M,EAAaG,EAAM,OAAO,CAACzN,EAAK+kB,IAAM/kB,EAAM+kB,EAAE,WAAY,CAAC,EAEjE,OAAI3U,EAEAiD,OAAC,OAAI,UAAU,sBACb,UAAAA,OAAC,OAAI,UAAU,kBACb,UAAA5B,MAACkmB,GAAA,CAAM,KAAM,GAAI,EACjBlmB,MAAC,QAAK,0BAAc,GACtB,EACAA,MAAC,OAAI,UAAU,mBAAmB,sBAAU,GAC9C,EAKF4B,OAAC,OAAI,UAAU,sBACb,UAAAA,OAAC,OAAI,UAAU,kBACb,UAAAA,OAAC,OAAI,UAAU,iBACb,UAAA5B,MAACkmB,GAAA,CAAM,KAAM,GAAI,EACjBlmB,MAAC,QAAK,0BAAc,EACnBnE,EAAa,GACZmE,MAAC,QAAK,UAAU,iBAAkB,SAAAnE,CAAA,CAAW,GAEjD,EACAmE,MAAC,QAAK,UAAU,gBAAiB,SAAAwlB,CAAA,CAAY,GAC/C,QAGC,OAAI,UAAU,qBACZ,SAAAT,GAAW,IAAInkC,GACdghB,OAAC,UAEC,UAAU,gBACV,QAAS,IAAMwd,EAAex+B,EAAK,KAAK,EACxC,SAAUo9B,EAEV,UAAAhe,MAAC,QAAK,UAAU,iBAAkB,SAAApf,EAAK,KAAK,EAC5CghB,OAAC,QAAK,UAAU,kBAAkB,eAAGhhB,EAAK,OAAM,IAN3CA,EAAK,MAQb,EACH,EAGC,OAAO,KAAKqlC,EAAW,EAAE,OAAS,EACjCjmB,MAAC,OAAI,UAAU,sBACZ,SAAA+kB,GAAW,IAAInkC,GAAQ,CACtB,MAAMulC,EAAWF,GAAYrlC,EAAK,KAAK,EACvC,OAAKulC,EAGHvkB,OAAC,OAAqB,UAAU,oBAC9B,UAAAA,OAAC,OAAI,UAAU,YACb,UAAA5B,MAAC,QAAK,UAAU,YAAa,SAAApf,EAAK,KAAK,EACvCof,MAAC,QAAK,UAAU,aAAc,WAAK,MAAM,GAC3C,EACA4B,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,UACC,UAAU,qBACV,QAAS,IAAMgmB,GAAoBG,EAAS,MAAM,CAAC,CAAC,EACpD,SAAUnI,EAEV,SAAAhe,MAAComB,GAAA,CAAM,KAAM,GAAI,IAEnBpmB,MAAC,QAAK,UAAU,aAAc,WAAS,MAAM,EAC7CA,MAAC,UACC,UAAU,qBACV,QAAS,IAAM+lB,GAAoBI,EAAS,MAAM,CAAC,CAAC,EACpD,SAAUnI,EAEV,SAAAhe,MAACqmB,GAAA,CAAK,KAAM,GAAI,GAClB,EACF,IArBQzlC,EAAK,KAsBf,EAzBoB,IA2BxB,CAAC,EACH,EAEAghB,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,KAAE,4CAAgC4jB,CAAA,EAAY,EAC/CxlB,MAAC,KAAE,UAAU,gBAAgB,2CAA+B,GAC9D,EAIDke,GACCtc,OAAC,OAAI,UAAU,oBACb,UAAAA,OAAC,OAAI,UAAU,eACb,UAAA5B,MAAC,UACC,MAAOslB,EAAQ,KACf,SAAW5kB,GAAM6kB,EAAW,CAAE,GAAGD,EAAS,KAAM5kB,EAAE,OAAO,MAAO,EAChE,UAAU,mBAET,YAAW,IAAI9f,UACb,UAAwB,MAAOA,EAAK,MAClC,UAAAA,EAAK,KAAK,IAAEA,EAAK,QADPA,EAAK,KAElB,CACD,IAEHghB,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,UACC,UAAU,YACV,QAAS,IAAMulB,EAAW,CAAE,GAAGD,EAAS,MAAO,KAAK,IAAI,EAAGA,EAAQ,MAAQ,CAAC,EAAG,EAE/E,SAAAtlB,MAAComB,GAAA,CAAM,KAAM,GAAI,IAEnBpmB,MAAC,SACC,KAAK,SACL,IAAI,IACJ,MAAOslB,EAAQ,MACf,SAAW5kB,GAAM6kB,EAAW,CAAE,GAAGD,EAAS,MAAO,SAAS5kB,EAAE,OAAO,KAAK,GAAK,EAAG,EAChF,UAAU,gBAEZV,MAAC,UACC,UAAU,YACV,QAAS,IAAMulB,EAAW,CAAE,GAAGD,EAAS,MAAOA,EAAQ,MAAQ,EAAG,EAElE,SAAAtlB,MAACqmB,GAAA,CAAK,KAAM,GAAI,GAClB,EACF,GACF,EACAzkB,OAAC,OAAI,UAAU,mBACb,UAAAA,OAAC,UACC,UAAU,8BACV,QAAS,IAAMuc,EAAe,EAAK,EAEnC,UAAAne,MAAC+K,GAAA,CAAE,KAAM,GAAI,EAAE,aAEjBnJ,OAAC,UACC,UAAU,4BACV,QAASikB,EACT,SAAU7H,EAEV,UAAAhe,MAAC6C,GAAA,CAAM,KAAM,GAAI,EAAE,SACrB,EACF,GACF,EAID,CAACqb,GACAtc,OAAC,UACC,UAAU,sBACV,QAAS,IAAMuc,EAAe,EAAI,EAElC,UAAAne,MAACqmB,GAAA,CAAK,KAAM,GAAI,EAAE,wBAMrBxqB,EAAa,GACZ+F,OAAC,OAAI,UAAU,mBACb,UAAA5B,MAAC,UAAQ,SAAAnE,CAAA,CAAW,EAAS,cAAYA,IAAe,EAAI,IAAM,GAAG,UACvE,EAIDlE,EAAQ,OAAS,GAChBiK,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,UACC,UAAU,0BACV,QAAS,IAAMyjB,EAAe,CAACD,CAAW,EAE1C,UAAAplB,MAACsmB,GAAA,CAAQ,KAAM,GAAI,SAClB,QAAK,2BAAe3uB,EAAQ,OAAO,UAAM,EACzCytB,QAAemB,GAAA,CAAU,KAAM,GAAI,EAAKvmB,MAACwmB,GAAA,CAAY,KAAM,GAAI,KAGjEpB,GACCplB,MAAC,OAAI,UAAU,wBACZ,SAAArI,EAAQ,IAAI8uB,GAAO,CAClB,MAAMC,EAAgB,IAAI,KAAKD,EAAI,IAAI,EAAE,mBAAmB,QAAS,CACnE,QAAS,QACT,MAAO,QACP,IAAK,UACN,EAGKR,GAAcQ,EAAI,MAAM,OAAO,CAACv3B,EAAKy2B,KACpCz2B,EAAIy2B,EAAK,SAAS,IACrBz2B,EAAIy2B,EAAK,SAAS,EAAI,GAExBz2B,EAAIy2B,EAAK,SAAS,GAAKA,EAAK,WACrBz2B,GACN,EAAE,EAEL,OACE0S,OAAC,OAAmB,UAAU,uBAC5B,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAA5B,MAAC,QAAK,UAAU,wBAAyB,SAAA0mB,EAAc,EACvD9kB,OAAC,QAAK,UAAU,yBAA0B,UAAA6kB,EAAI,WAAW,QAAMA,EAAI,aAAe,EAAI,IAAM,IAAG,GACjG,EACAzmB,MAAC,OAAI,UAAU,yBACZ,gBAAO,QAAQimB,EAAW,EAAE,IAAI,CAAC,CAACrlC,EAAMuP,CAAK,IAAM,CAClD,MAAMw2B,EAAW3B,GAAgBpkC,CAAI,EACrC,OACEghB,OAAC,QAAgB,UAAU,wBACxB,UAAA+kB,EAAS,KAAK,IAAEx2B,EAAM,IAAEw2B,EAAS,QADzB/lC,CAEX,CAEJ,CAAC,EACH,IAdQ6lC,EAAI,IAed,CAEJ,CAAC,EACH,GAEJ,GAEJ,CAEJ,CCtXA,MAAMG,GAAe,CACnB,OAAQC,GACR,MAAOC,GACP,MAAO7X,GACP,QAASpD,GACT,UAAWkb,GACX,WAAYC,GACZ,KAAMC,GACN,OAAQtQ,GACR,QAASuQ,GACT,OAAQ1d,EACV,EAGM2d,GAAgB,CACpB,KAAM,UACN,MAAO,UACP,OAAQ,UACR,IAAK,UACL,OAAQ,UACR,KAAM,UACN,KAAM,UACN,OAAQ,SACV,EAGMC,GAAeC,GACfA,GAAU,WAAW,QAAQ,EAAUC,GACvCD,GAAU,SAAS,aAAa,GAAKA,GAAU,SAAS,OAAO,EAAUE,GACzEF,GAAU,SAAS,KAAK,EAAUpY,GAC/BuY,GAIHC,GAAkBC,GAAU,CAChC,GAAI,CAACA,EAAO,MAAO,MACnB,MAAMC,EAAQ,CAAC,IAAK,KAAM,KAAM,IAAI,EACpC,IAAIC,EAAOF,EACPG,EAAY,EAChB,KAAOD,GAAQ,MAAQC,EAAYF,EAAM,OAAS,GAChDC,GAAQ,KACRC,IAEF,MAAO,GAAGD,EAAK,QAAQA,EAAO,GAAK,EAAI,CAAC,CAAC,IAAID,EAAME,CAAS,CAAC,EAC/D,EAEA,SAAwBC,GAAW,CAAE,UAAA9lC,EAAW,YAAA4hB,GAAe,CAC7D,KAAM,CAACmkB,EAASC,CAAU,EAAItpB,WAAS,EAAE,EACnC,CAACC,EAASC,CAAU,EAAIF,WAAS,EAAI,EACrC,CAACupB,EAAgBC,CAAiB,EAAIxpB,WAAS,IAAI,EACnD,CAACypB,EAAWC,CAAY,EAAI1pB,WAAS,EAAE,EACvC,CAAC2pB,EAAaC,CAAc,EAAI5pB,WAAS,EAAK,EAG9C6pB,EAAoB/jB,SAAO,IAAI,EAE/BgkB,EAAcppB,cAAY,SAAY,CAC1CR,EAAW,EAAI,EACf,GAAI,CACF,MAAM6pB,EAAa,MAAMvpC,EAAG,kBAAkB8C,CAAS,EACvDgmC,EAAWS,CAAU,CACvB,OAASpkC,EAAO,CACd,QAAQ,MAAM,yBAA0BA,CAAK,EAC7Cuf,IAAc,yBAA0B,OAAO,CACjD,SACEhF,EAAW,EAAK,CAClB,CACF,EAAG,CAAC5c,EAAW4hB,CAAW,CAAC,EAErB8kB,EAAgBtpB,cAAY,MAAO1C,GAAa,CACpD,GAAKA,EACL,CAAA4rB,EAAe,EAAI,EACnB,GAAI,CACF,MAAMhjC,EAAS,MAAMpG,EAAG,mBAAmBwd,CAAQ,EACnD0rB,EAAa9iC,EAAO,SAAS,CAC/B,OAASjB,EAAO,CACd,QAAQ,MAAM,2BAA4BA,CAAK,EAC/Cuf,IAAc,2BAA4B,OAAO,CACnD,SACE0kB,EAAe,EAAK,CACtB,EACF,EAAG,CAAC1kB,CAAW,CAAC,EAEhB/E,YAAU,IAAM,CACd2pB,EAAA,EAGA,MAAMG,EAAYzpC,EAAG,6BAA6B8C,EAAW,IAAM,CACjEwmC,EAAA,CACF,CAAC,EACKI,EAAS1pC,EAAG,uBAAuB8C,EAAW,IAAM,CAExDwmC,EAAA,EAEID,EAAkB,SACpBG,EAAcH,EAAkB,QAAQ,EAAE,CAE9C,CAAC,EAED,MAAO,IAAM,CACXI,GAAW,gBACXC,GAAQ,eACV,CACF,EAAG,CAAC5mC,EAAWwmC,EAAaE,CAAa,CAAC,EAE1C,MAAMG,EAAa,MAAOpsB,GAAW,CACnCyrB,EAAkBzrB,CAAM,EACxB8rB,EAAkB,QAAU9rB,EAC5B,MAAMisB,EAAcjsB,EAAO,EAAE,CAC/B,EAEMqsB,EAAiB,MAAOtsB,GAAQ,CACpC,GAAI,CACF,MAAMtd,EAAG,kBAAkBsd,EAAI,GAAI,YAAY,EAC/C,MAAMgR,EAAMhR,EAAI,KAAO,wDAAmFA,EAAI,YAAY,GAC1H,OAAO,KAAKgR,EAAK,QAAQ,CAC3B,OAASnpB,EAAO,CACd,QAAQ,MAAM,kBAAmBA,CAAK,CACxC,CACF,EAEM0xB,EAAS,IAAM,CACnBmS,EAAkB,IAAI,EACtBK,EAAkB,QAAU,KAC5BH,EAAa,EAAE,CACjB,EAGA,GAAIzpB,EACF,aACG,OAAI,UAAU,aACb,SAAAiD,OAAC,OAAI,UAAU,qBACb,gBAACkK,GAAA,CAAQ,KAAM,GAAI,UAAU,UAAU,EACvC9L,MAAC,QAAK,sBAAU,GAClB,EACF,EAKJ,GAAIioB,EAAgB,CAClB,MAAMc,EAAanC,GAAaqB,EAAe,IAAI,GAAKpB,GAClDmC,EAAc7B,GAAcc,EAAe,KAAK,GAAKd,GAAc,KAEzE,OACEvlB,OAAC,OAAI,UAAU,aAEb,UAAAA,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,UAAO,UAAU,kBAAkB,QAAS+V,EAC3C,SAAA/V,MAACuI,GAAA,CAAU,KAAM,GAAI,EACvB,EACA3G,OAAC,OAAI,UAAU,mBACb,UAAA5B,MAAC,OAAI,UAAU,wBAAwB,MAAO,CAAE,gBAAiB,GAAGgpB,CAAW,MAC7E,SAAAhpB,MAAC+oB,EAAA,CAAW,KAAM,GAAI,MAAO,CAAE,MAAOC,EAAY,CAAG,EACvD,EACApnB,OAAC,OAAI,UAAU,wBACb,gBAAC,MAAI,WAAe,KAAK,SACxB,QAAM,UAAAumB,EAAU,OAAO,UAAM,GAChC,GACF,GACF,EAGAnoB,MAAC,OAAI,UAAU,kBACZ,WACC4B,OAAC,OAAI,UAAU,qBACb,gBAACkK,GAAA,CAAQ,KAAM,GAAI,UAAU,UAAU,EACvC9L,MAAC,QAAK,sBAAU,GAClB,EACEmoB,EAAU,SAAW,EACvBvmB,OAAC,OAAI,UAAU,mBACb,UAAA5B,MAAC6mB,GAAA,CAAO,KAAM,GAAI,MAAO,CAAE,MAAOmC,EAAa,QAAS,GAAI,CAAG,EAC/DhpB,MAAC,KAAE,4BAAgB,GACrB,EAEAmoB,EAAU,IAAI3rB,GAAO,CACnB,MAAMysB,EAAW7B,GAAY5qB,EAAI,SAAS,EAC1C,OACEoF,OAAC,UAAoB,UAAU,iBAAiB,QAAS,IAAMknB,EAAetsB,CAAG,EAC/E,UAAAwD,MAAC,OAAI,UAAU,iBACb,eAACipB,EAAA,CAAS,KAAM,GAAI,EACtB,EACArnB,OAAC,OAAI,UAAU,iBACb,UAAA5B,MAAC,QAAK,UAAU,iBAAkB,SAAAxD,EAAI,KAAK,QAC1C,QAAK,UAAU,iBAAkB,SAAAirB,GAAejrB,EAAI,eAAe,EAAE,GACxE,QACCsO,GAAA,CAAS,KAAM,GAAI,UAAU,qBAAqB,IARxCtO,EAAI,EASjB,CAEJ,CAAC,EAEL,GACF,CAEJ,CAGA,OACEwD,MAAC,OAAI,UAAU,aACb,eAAC,OAAI,UAAU,kBACZ,SAAA+nB,EAAQ,SAAW,EAClBnmB,OAAC,OAAI,UAAU,mBACb,UAAA5B,MAAC6mB,GAAA,CAAO,KAAM,GAAI,EAClB7mB,MAAC,MAAG,wBAAY,EAChBA,MAAC,KAAE,iDAAqC,GAC1C,EAEA+nB,EAAQ,IAAItrB,GAAU,CACpB,MAAMysB,EAAOtC,GAAanqB,EAAO,IAAI,GAAKoqB,GACpCsC,EAAQhC,GAAc1qB,EAAO,KAAK,GAAK0qB,GAAc,KACrDh3B,EAAQsM,EAAO,gBAAkB,EACvC,OACEmF,OAAC,UAAuB,UAAU,oBAAoB,QAAS,IAAMinB,EAAWpsB,CAAM,EACpF,UAAAuD,MAAC,OAAI,UAAU,oBAAoB,MAAO,CAAE,gBAAiB,GAAGmpB,CAAK,MACnE,SAAAnpB,MAACkpB,GAAK,KAAM,GAAI,MAAO,CAAE,MAAAC,EAAM,CAAG,EACpC,EACAvnB,OAAC,OAAI,UAAU,oBACb,UAAA5B,MAAC,QAAK,UAAU,oBAAqB,SAAAvD,EAAO,KAAK,EACjDmF,OAAC,QAAK,UAAU,qBAAsB,UAAAzR,EAAM,IAAEA,IAAU,EAAI,OAAS,SAAQ,GAC/E,QACCqY,GAAA,CAAa,KAAM,GAAI,UAAU,qBAAqB,IAR5C/L,EAAO,EASpB,CAEJ,CAAC,EAEL,EACF,CAEJ,CC9NA,SAAwB2sB,GAAe,CAAE,QAAAh5B,EAAS,UAAAxO,EAAW,OAAAynC,GAAU,CACrE,KAAM,CAAC1qB,EAASC,CAAU,EAAIF,WAAS,EAAI,EACrC,CAAC4qB,EAAWC,CAAY,EAAI7qB,WAAS,MAAM,EAC3C,CAAC8qB,EAASC,CAAU,EAAI/qB,WAAS,CACrC,MAAO,GACP,QAAS,GACT,YAAa,GACb,cAAe,GACf,aAAc,EAAC,CAChB,EAEDG,YAAU,IAAM,CACVzO,GAAS,IACXs5B,EAAA,CAEJ,EAAG,CAACt5B,GAAS,GAAIk5B,CAAS,CAAC,EAE3B,MAAMI,EAAc,SAAY,CAC9B9qB,EAAW,EAAI,EACf,GAAI,CACF,MAAM+qB,MAAU,KACVz7B,MAAgB,KAClBo7B,IAAc,OAChBp7B,EAAU,QAAQy7B,EAAI,UAAY,CAAC,EAEnCz7B,EAAU,QAAQy7B,EAAI,UAAY,EAAE,EAEtC,MAAMC,EAAW17B,EAAU,cAAc,MAAM,GAAG,EAAE,CAAC,EAG/CC,EAAOm7B,IAAc,OAAS,EAAI,GAClC,CAACxnC,EAAO4K,EAASm9B,GAAeC,EAAY,EAAI,MAAM,QAAQ,IAAI,CACtE5qC,EAAG,SAASkR,EAAQ,EAAE,EACtBlR,EAAG,eAAekR,EAAQ,EAAE,GAAK,GACjClR,EAAG,0BAA0BkR,EAAQ,GAAIjC,CAAI,GAAK,GAClDjP,EAAG,kBAAkBkR,EAAQ,EAAE,GAAK,EAAC,CACtC,EAGKwH,GAAc,GACdmyB,EAAc,IAAI,KAAK77B,CAAS,EACtC,KAAO67B,GAAeJ,GAAK,CACzB,MAAM7O,EAAUiP,EAAY,cAAc,MAAM,GAAG,EAAE,CAAC,EACtD,GAAI,CACF,MAAM1xB,EAAO,MAAMnZ,EAAG,eAAekR,EAAQ,GAAI0qB,CAAO,EACxDljB,GAAY,KAAK,CACf,KAAMkjB,EACN,MAAOziB,GAAM,SAAS,QAAU,EAChC,QAAS0xB,EAAY,mBAAmB,QAAS,CAAE,QAAS,QAAS,EACtE,CACH,MAAQ,CACNnyB,GAAY,KAAK,CAAE,KAAMkjB,EAAS,MAAO,EAAG,QAASiP,EAAY,mBAAmB,QAAS,CAAE,QAAS,QAAS,EAAG,CACtH,CACAA,EAAY,QAAQA,EAAY,UAAY,CAAC,CAC/C,CAEAN,EAAW,CACT,MAAA3nC,EACA,QAAS4K,EAAQ,OAAO4D,GAAKA,EAAE,WAAas5B,CAAQ,EACpD,YAAAhyB,GACA,cAAAiyB,GACA,aAAcC,GAAa,OAAO9mC,GAAKA,EAAE,aAAe4mC,CAAQ,EACjE,CACH,OAASvlC,EAAO,CACd,QAAQ,MAAM,yBAA0BA,CAAK,CAC/C,SACEua,EAAW,EAAK,CAClB,CACF,EAGMorB,EAAoBxlB,SAAO,IAAI,EAE/BylB,EAAkB7qB,cAAY,IAAM,CACpC4qB,EAAkB,SAAS,aAAaA,EAAkB,OAAO,EACrEA,EAAkB,QAAU,WAAW,IAAM,CAC3CN,EAAA,CACF,EAAG,GAAG,CACR,EAAG,CAACt5B,GAAS,GAAIk5B,CAAS,CAAC,EAE3BzqB,YAAU,IAAM,CACd,GAAI,CAACzO,GAAS,GAAI,OAClB,MAAM85B,EAAO,GAEPC,EAAUjrC,EAAG,mBAAmBkR,EAAQ,GAAI65B,CAAe,EAC7DE,GAASD,EAAK,KAAKC,CAAO,EAE9B,MAAMC,EAAUlrC,EAAG,0BAA0BkR,EAAQ,GAAI65B,CAAe,EACpEG,GAASF,EAAK,KAAKE,CAAO,EAE9B,MAAMC,EAAQnrC,EAAG,uBAAuBkR,EAAQ,GAAI65B,CAAe,EAC/DI,GAAOH,EAAK,KAAKG,CAAK,EAE1B,MAAMC,EAAUprC,EAAG,sBAAsBkR,EAAQ,GAAI65B,CAAe,EAChEK,GAASJ,EAAK,KAAKI,CAAO,EAE9B,MAAMC,EAAYrrC,EAAG,0BAA0BkR,EAAQ,GAAI65B,CAAe,EAC1E,OAAIM,GAAWL,EAAK,KAAKK,CAAS,EAE3B,IAAM,CACPP,EAAkB,SAAS,aAAaA,EAAkB,OAAO,EACrEE,EAAK,QAAQM,IAAOtrC,EAAG,cAAcsrC,EAAG,CAAC,CAC3C,CACF,EAAG,CAACp6B,GAAS,GAAI65B,CAAe,CAAC,EAGjC,MAAMQ,EAAiB1qB,UAAQ,IAAM,CACnC,KAAM,CAAE,MAAAje,EAAO,QAAA4K,EAAS,YAAAkL,EAAa,cAAAiyB,EAAe,aAAAC,GAAiBN,EAG/DkB,EAAa5oC,EAAM,OACnB6oC,GAAiB7oC,EAAM,UAAYhE,EAAE,SAAW,MAAM,EAAE,OACxD8sC,GAAkB9oC,EAAM,UAAYhE,EAAE,SAAW,SAAS,EAAE,OAC5D+sC,GAAkB/oC,EAAM,UAAYhE,EAAE,SAAW,aAAa,EAAE,OAChEgtC,EAAkBJ,EAAa,EAAI,KAAK,MAAOC,GAAiBD,EAAc,GAAG,EAAI,EAGrF3yB,EAAeH,EAAY,OAAO,CAACrJ,EAAKk4B,IAAQl4B,EAAMk4B,EAAI,MAAO,CAAC,EAClEsE,EAAcnzB,EAAY,OAAS,GACrC,KAAK,MAAOG,EAAeH,EAAY,OAAO/C,GAAKA,EAAE,MAAQ,CAAC,EAAE,OAAU,EAAE,EAAI,IAAM,EAEpFm2B,GAAepzB,EAAY,UAAY/C,EAAE,MAAQ,CAAC,EAAE,OAGpDo2B,EAAiBv+B,EAAQ,OAAO4D,GAAKA,EAAE,SAAW,WAAaA,EAAE,SAAW,OAAO,EAAE,OACrF46B,EAAgBx+B,EAAQ,OAAO4D,GAAKA,EAAE,SAAW,UAAYA,EAAE,SAAW,UAAU,EAAE,OACtF66B,EAAmBz+B,EAAQ,OAAO,CAAC6B,EAAK+B,IAAM/B,GAAO+B,EAAE,cAAgB,GAAI,CAAC,EAG5EuL,EAAaguB,EAAc,OAAO,CAACt7B,EAAKsG,IAAMtG,GAAOsG,EAAE,YAAc,GAAI,CAAC,EAC1Eu2B,EAAe,EAGfC,EAAmBvB,EAAa,OAAO9mC,GAAKA,EAAE,SAAS,EAAE,OACzDsoC,GAAahC,IAAc,OAAS,EAAI,GACxCiC,EAAeC,EAAsB1B,CAAY,EAEvD,MAAO,CACL,SAAU,CAAE,WAAAY,EAAY,eAAAC,GAAgB,gBAAAC,GAAiB,gBAAAC,GAAiB,gBAAAC,CAAA,EAC1E,KAAM,CAAE,aAAA/yB,EAAc,YAAAgzB,EAAa,aAAAC,GAAc,QAASpzB,CAAA,EAC1D,QAAS,CAAE,MAAOlL,EAAQ,OAAQ,QAASu+B,EAAgB,OAAQC,EAAe,WAAYC,CAAA,EAC9F,SAAU,CAAE,WAAAtvB,EAAY,aAAAuvB,CAAA,EACxB,QAAS,CAAE,UAAWC,EAAkB,IAAKC,GAAY,OAAQC,CAAA,CAAa,CAElF,EAAG,CAAC/B,EAASF,CAAS,CAAC,EAGvB,SAASkC,EAAsBlxB,EAAS,CACtC,GAAI,CAACA,EAAQ,OAAQ,MAAO,GAC5B,MAAMmxB,EAAc,CAAC,GAAG,IAAI,IAAInxB,EAAQ,UAAYtX,EAAE,SAAS,EAAE,IAAIA,GAAKA,EAAE,WAAW,CAAC,CAAC,EAAE,OAAO,UAClG,IAAI0oC,EAAS,EACb,MAAM19B,MAAY,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,EACnD,IAAIwJ,EAAY,IAAI,KAAKxJ,CAAK,EAE9B,QAASpB,EAAI,EAAGA,EAAI,GAAIA,IAAK,CAC3B,MAAMkuB,GAAUtjB,EAAU,cAAc,MAAM,GAAG,EAAE,CAAC,EACpD,GAAIi0B,EAAY,SAAS3Q,EAAO,EAC9B4Q,IACAl0B,EAAU,QAAQA,EAAU,UAAY,CAAC,MAEzC,MAEJ,CACA,OAAOk0B,CACT,CAGA,MAAMC,EAAS,CACb,QAAS,UACT,QAAS,UACT,QAAS,UAET,MAAO,UACP,OAAQ,WAGJC,EAAa,CAACD,EAAO,QAASA,EAAO,QAASA,EAAO,KAAK,EAG1DE,EAAkB,CACtB,CAAE,KAAM,YAAa,MAAOpB,EAAe,SAAS,gBACpD,CAAE,KAAM,cAAe,MAAOA,EAAe,SAAS,iBACtD,CAAE,KAAM,cAAe,MAAOA,EAAe,SAAS,gBAAgB,EACtE,OAAO51B,GAAKA,EAAE,MAAQ,CAAC,EAEnBi3B,EAAe/rB,UAAQ,IAAM,CACjC,MAAMgsB,EAAQ,GACd,OAAAvC,EAAQ,QAAQ,QAAQl5B,GAAK,CAC3B,MAAMm2B,EAAMn2B,EAAE,UACdy7B,EAAMtF,CAAG,GAAKsF,EAAMtF,CAAG,GAAK,GAAK,CACnC,CAAC,EACMgE,EAAe,KAAK,QAAQ,IAAI51B,IAAM,CAC3C,GAAGA,EACH,QAASk3B,EAAMl3B,EAAE,IAAI,GAAK,GAC1B,CACJ,EAAG,CAAC20B,EAAQ,QAASiB,EAAe,KAAK,OAAO,CAAC,EAEjD,OAAI9rB,EAEAiD,OAAC,OAAI,UAAU,0BACb,UAAAA,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,UAAO,UAAU,WAAW,QAASynB,EACpC,UAAArpB,MAACuI,GAAA,CAAU,KAAM,GAAI,EAAE,QAEzB,EACAvI,MAAC,MAAG,2BAAe,GACrB,EACA4B,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,OAAI,UAAU,UAAU,EACzBA,MAAC,KAAE,8BAAkB,GACvB,GACF,EAKF4B,OAAC,OAAI,UAAU,kBACb,UAAAA,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,UAAO,UAAU,WAAW,QAASynB,EACpC,UAAArpB,MAACuI,GAAA,CAAU,KAAM,GAAI,EAAE,QAEzB,EACAvI,MAAC,MAAG,2BAAe,EACnB4B,OAAC,OAAI,UAAU,cACb,UAAA5B,MAAC,UACC,UAAWspB,IAAc,OAAS,SAAW,GAC7C,QAAS,IAAMC,EAAa,MAAM,EACnC,oBAGDvpB,MAAC,UACC,UAAWspB,IAAc,QAAU,SAAW,GAC9C,QAAS,IAAMC,EAAa,OAAO,EACpC,oBAED,EACF,GACF,EAGA3nB,OAAC,OAAI,UAAU,gBACb,UAAAA,OAAC,OAAI,UAAU,6BACb,UAAA5B,MAAC,OAAI,UAAU,YACb,eAACgsB,GAAA,CAAW,KAAM,GAAI,EACxB,EACApqB,OAAC,OAAI,UAAU,eACb,UAAAA,OAAC,QAAK,UAAU,aAAc,UAAA6oB,EAAe,SAAS,gBAAgB,KAAC,EACvEzqB,MAAC,QAAK,UAAU,aAAa,oBAAQ,GACvC,EACA4B,OAAC,OAAI,UAAU,cACZ,UAAA6oB,EAAe,SAAS,eAAe,IAAEA,EAAe,SAAS,WAAW,UAC/E,GACF,EAEA7oB,OAAC,OAAI,UAAU,yBACb,UAAA5B,MAAC,OAAI,UAAU,YACb,eAACisB,GAAA,CAAM,KAAM,GAAI,EACnB,EACArqB,OAAC,OAAI,UAAU,eACb,UAAA5B,MAAC,QAAK,UAAU,aAAc,SAAAyqB,EAAe,KAAK,aAAa,EAC/DzqB,MAAC,QAAK,UAAU,aAAa,oBAAQ,GACvC,EACA4B,OAAC,OAAI,UAAU,cAAc,iBACtB6oB,EAAe,KAAK,YAAY,gBACvC,GACF,EAEA7oB,OAAC,OAAI,UAAU,4BACb,UAAA5B,MAAC,OAAI,UAAU,YACb,eAACiP,GAAA,CAAS,KAAM,GAAI,EACtB,EACArN,OAAC,OAAI,UAAU,eACb,UAAA5B,MAAC,QAAK,UAAU,aAAc,SAAAyqB,EAAe,QAAQ,MAAM,EAC3DzqB,MAAC,QAAK,UAAU,aAAa,uBAAW,GAC1C,EACA4B,OAAC,OAAI,UAAU,cACZ,UAAA6oB,EAAe,QAAQ,OAAO,YAAUA,EAAe,QAAQ,QAAQ,YAC1E,GACF,EAEA7oB,OAAC,OAAI,UAAU,6BACb,UAAA5B,MAAC,OAAI,UAAU,YACb,eAACkmB,GAAA,CAAM,KAAM,GAAI,EACnB,EACAtkB,OAAC,OAAI,UAAU,eACb,UAAA5B,MAAC,QAAK,UAAU,aAAc,SAAAyqB,EAAe,SAAS,WAAW,EACjEzqB,MAAC,QAAK,UAAU,aAAa,0BAAc,GAC7C,EACA4B,OAAC,OAAI,UAAU,cACZ,UAAA6oB,EAAe,SAAS,aAAa,QAAQ,CAAC,EAAE,SACnD,GACF,GACF,EAGA7oB,OAAC,OAAI,UAAU,cAEb,UAAAA,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,MAAG,yBAAa,EAChB6rB,EAAgB,OAAS,EACxB7rB,MAACksB,GAAA,CAAoB,MAAM,OAAO,OAAQ,IACxC,SAAAtqB,OAACuqB,GAAA,CACC,UAAAnsB,MAACosB,GAAA,CACC,KAAMP,EACN,GAAG,MACH,GAAG,MACH,YAAa,GACb,YAAa,GACb,aAAc,EACd,QAAQ,QACR,MAAO,CAAC,CAAE,KAAA7hC,EAAM,MAAAxJ,KAAY,GAAGwJ,CAAI,KAAKxJ,CAAK,GAC7C,UAAW,GAEV,WAAgB,IAAI,CAAC6rC,EAAOvjC,UAC1BwjC,GAAA,CAA2B,KAAMV,EAAW9iC,EAAQ8iC,EAAW,MAAM,GAA3D,QAAQ9iC,CAAK,EAAiD,CAC1E,UAEFyjC,GAAA,EAAQ,GACX,EACF,EAEAvsB,MAAC,OAAI,UAAU,UAAU,wBAAY,GAEzC,EAGA4B,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,MAAG,2BAAe,EACnBA,MAACksB,GAAA,CAAoB,MAAM,OAAO,OAAQ,IACxC,SAAAtqB,OAAC4qB,GAAA,CAAS,KAAM/B,EAAe,KAAK,QAClC,UAAAzqB,MAACysB,GAAA,CAAc,gBAAgB,MAAM,QAAS,GAAK,EACnDzsB,MAAC0sB,IAAM,QAAQ,UAAU,KAAM,CAAE,SAAU,IAAM,QAChDC,GAAA,CAAM,KAAM,CAAE,SAAU,IAAM,EAC/B3sB,MAACusB,GAAA,CACC,UAAY/rC,GAAU,CAACA,EAAO,SAAS,EACvC,eAAiBiiB,GAAU,QAAQA,CAAK,KAE1CzC,MAAC4sB,GAAA,CAAI,QAAQ,QAAQ,KAAMjB,EAAO,QAAS,OAAQ,CAAC,EAAG,EAAG,EAAG,CAAC,EAAG,GACnE,EACF,GACF,EAGA/pB,OAAC,OAAI,UAAU,aACb,UAAA5B,MAAC,MAAG,8BAAkB,EACtBA,MAACksB,IAAoB,MAAM,OAAO,OAAQ,IACxC,SAAAtqB,OAACirB,GAAA,CAAU,KAAMf,EACf,UAAA9rB,MAACysB,GAAA,CAAc,gBAAgB,MAAM,QAAS,GAAK,EACnDzsB,MAAC0sB,IAAM,QAAQ,UAAU,KAAM,CAAE,SAAU,IAAM,QAChDC,GAAA,CAAM,KAAM,CAAE,SAAU,IAAM,EAC/B3sB,MAACusB,GAAA,CACC,UAAY/rC,GAAU,CAACA,EAAO,SAAS,IAEzCwf,MAAC8sB,GAAA,CACC,KAAK,WACL,QAAQ,UACR,OAAQnB,EAAO,QACf,YAAa,EACb,IAAK,CAAE,KAAMA,EAAO,QAAS,YAAa,EAAE,EAC9C,EACF,EACF,GACF,EAGA/pB,OAAC,OAAI,UAAU,2BACb,UAAA5B,MAAC,MAAG,4BAAgB,EACpB4B,OAAC,OAAI,UAAU,gBACb,UAAAA,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,OAAI,UAAU,gBAAgB,MAAO,CAAE,gBAAiB,GAAG2rB,EAAO,OAAO,KAAM,MAAOA,EAAO,SAC5F,eAACtT,GAAA,CAAa,KAAM,GAAI,EAC1B,EACAzW,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,QAAK,UAAU,iBAAiB,0BAAc,EAC/C4B,OAAC,QAAK,UAAU,iBAAkB,UAAA6oB,EAAe,KAAK,aAAa,OAAKnB,IAAc,OAAS,EAAI,IAAG,GACxG,GACF,EACA1nB,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,OAAI,UAAU,gBAAgB,MAAO,CAAE,gBAAiB,GAAG2rB,EAAO,OAAO,KAAM,MAAOA,EAAO,SAC5F,eAACoB,GAAA,CAAS,KAAM,GAAI,EACtB,EACAnrB,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,QAAK,UAAU,iBAAiB,6BAAiB,QACjD,QAAK,UAAU,iBAAkB,SAAAyqB,EAAe,QAAQ,UAAU,GACrE,GACF,EACA7oB,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,OAAI,UAAU,gBAAgB,MAAO,CAAE,gBAAiB,GAAG2rB,EAAO,OAAO,KAAM,MAAOA,EAAO,SAC5F,eAAC/a,GAAA,CAAM,KAAM,GAAI,EACnB,EACAhP,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,QAAK,UAAU,iBAAiB,yBAAa,EAC9C4B,OAAC,QAAK,UAAU,iBAAkB,UAAA6oB,EAAe,QAAQ,OAAO,SAAK,GACvE,GACF,EACCA,EAAe,QAAQ,WAAa,GACnC7oB,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,OAAI,UAAU,gBAAgB,MAAO,CAAE,gBAAiB,GAAG2rB,EAAO,MAAM,KAAM,MAAOA,EAAO,QAC3F,eAACqB,GAAA,CAAW,KAAM,GAAI,EACxB,EACAprB,OAAC,OAAI,UAAU,gBACb,UAAA5B,MAAC,QAAK,UAAU,iBAAiB,qBAAS,EAC1C4B,OAAC,QAAK,UAAU,iBAAiB,cAAE6oB,EAAe,QAAQ,WAAW,gBAAe,EAAE,GACxF,GACF,GAEJ,GACF,GACF,QAEC,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;A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","names":["detectConflict","localRecord","serverRecord","compareFields","localModifiedAt","serverUpdatedAt","localCachedAt","conflicts","fieldsToCheck","k","field","localVal","serverVal","deepEqual","cachedVal","localChanged","serverChanged","a","b","keysA","keysB","key","RESOLUTION_STRATEGIES","stampForOffline","record","trackFields","stamped","buildConflictSummary","conflictResult","recordType","capitalize","fieldNames","c","str","DB_NAME","DB_VERSION","STORES","db","initOfflineDB","resolve","reject","request","event","database","pendingStore","getStore","storeName","mode","saveToStore","data","saveAllToStore","items","tx","store","item","getFromStore","getAllFromStore","getByIndex","indexName","value","deleteFromStore","ACTION_TYPES","addPendingAction","type","payload","metadata","action","getPendingActions","getPendingActionCount","removePendingAction","id","updatePendingAction","updates","getRequest","updated","putRequest","cacheProjects","projects","getCachedProjects","companyId","cacheAreas","areas","getCachedAreas","projectId","updateCachedAreaStatus","areaId","status","area","cacheCrewCheckin","checkin","cacheTMTicket","ticket","generateTempId","array","randomPart","cacheDailyReport","report","getCachedDailyReport","date","r","cacheMessage","message","isOnline","listeners","onConnectionChange","callback","getConnectionStatus","notifyConnectionChange","online","isSyncing","syncPendingActions","options","onConflict","results","actions","fetchServerRecord","cachedRecord","conflict","summary","processAction","error","actionType","supabaseUrl","supabaseAnonKey","isSupabaseConfigured","supabase","createClient","CONFIG","observe","operation","context","logToSupabase","category","operationName","fn","args","start","result","duration","FIELD_SESSION_KEY","fieldSessionData","getFieldSession","stored","setFieldSession","session","clearFieldSession","fieldClient","getFieldClient","getSupabaseClient","getClient","isFieldMode","STORAGE_KEY","USER_KEY","DEFAULT_LOCAL_DATA","getLocalData","setLocalData","getLocalUser","user","setLocalUser","corOps","corData","retryCount","corNumber","corId","corIds","groupName","filters","query","client","maxNumber","cor","match","num","laborItem","regularTotal","overtimeTotal","total","itemId","updateData","current","regHours","otHours","regRate","otRate","materialItem","sourceType","unitCost","quantity","qty","cost","equipmentItem","subItem","laborItems","index","materialItems","allowedSourceTypes","equipmentItems","subItems","subcontractorItems","ticketId","workType","jobType","ticketError","rates","ratesError","rateLookup","rate","laborByRole","worker","role","hours","name","unit","lineItem","updateError","errorMessage","percentages","userId","reason","signatureData","signerName","stats","row","entryId","changeOrderId","documentType","documentId","createdBy","expiresAt","tokenResult","tokenError","token","requestId","slot","signature","signatureRequest","document_type","document_id","tableName","costData","localData","newCost","costId","costs","byCategory","totalCost","amount","cat","maxNum","max","inv","cors","corsError","tickets","ticketsError","i","invoice","invoiceData","invoiceError","itemsToInsert","itemsError","newInvoice","invoiceId","paymentAmount","newAmountPaid","isPaidInFull","tmIds","tmError","equipmentOps","activeOnly","equipment","equipmentId","projectEquipment","projectEquipmentId","endDate","today","eq","startDate","days","end","drawRequestOps","totalBilled","sum","dr","totalRetention","drawRequestId","drawRequest","drError","itemsWithDrawId","deleteError","insertError","latestDraw","drawError","acc","scheduledValue","percent","err","getDeviceId","deviceId","auth","email","password","fullName","u","newRole","includeArchived","cached","p","page","limit","count","project","searchQuery","t","checkins","workerMap","photoCount","photoUrls","estimatedMB","filePaths","urlOrPath","batch","newProject","pin","companyCode","rateLimitKey","lockoutKey","MAX_ATTEMPTS","LOCKOUT_MS","lockoutUntil","remainingMs","remainingMins","attempts","projectData","projectError","company","mockToken","excludeProjectId","newArea","projectIds","callbacks","channel","subscription","assignedBy","assignment","oldValue","newValue","sortOrder","categoriesResult","classesResult","categoriesMap","classes","categoryId","laborClassId","ratesWithClassId","materialsSelect","changeOrders","totalApproved","totalPending","ceNumber","tempTicket","workers","workersData","w","itemsData","beforeDate","hasCustomClasses","dynamicWorkers","supervision","operators","laborers","userName","changeOrderValue","photos","isEditable","code","uc","membershipId","approvedBy","accessLevel","removedBy","projectRole","newAccessLevel","newCompanyRole","d","workDate","loadType","loadCount","notes","s","weeks","weeklyData","weekStart","weekKey","file","fileSize","timestamp","randomId","extension","fileName","filePath","base64Data","blob","newFileName","urlsOrPaths","paths","indices","v","fp","j","photoUrlOrPath","pathMatch","issues","photoUrl","tempId","queueId","uploadedUrl","storagePath","details","snapshot","exportType","exportReason","clientEmail","clientName","snapshotId","idempotencyKey","jobId","checkDate","existing","workerName","history","crewHistory","laborRates","ratesLookup","totalManDays","byRole","byDate","dayCost","dayBreakdown","reportDate","crew","areasResult","ticketsResult","completedToday","photosCount","reportData","submittedBy","cachedReport","compiled","senderType","senderName","senderUserId","messageType","parentId","msg","viewerType","requestedBy","neededBy","priority","respondedBy","responseNotes","expectedDelivery","chars","permissions","share","tokenData","shareId","shareIndex","shareToken","totalWeight","completedWeight","progress","photo","reports","reportId","reportIndex","witness","witnesses","witnessIndex","np","notificationTypes","existingIndex","pref","userPreferences","preset","presetId","ds","address","dumpSite","dumpSiteId","wasteType","estimatedCostPerLoad","h","haulOff","newHaulOff","haulOffs","totalLoads","byWasteType","dateMap","loads","daysWithHaulOff","folderData","folderIds","f","counts","countError","countMap","doc","folder","folderId","folderOrder","sort_order","startTime","STORAGE_LIMIT","usageData","currentUsage","usedMB","limitMB","randomBytes","ext","storageData","storageError","urlData","approvalStatus","document","docError","parentDocumentId","parentDoc","parentError","versions","newVersion","updatedDoc","resourceType","resourceId","BrandingContext","createContext","DEFAULT_BRANDING","BrandingProvider","children","branding","setBranding","useState","loading","setLoading","useEffect","loadBranding","loadBrandingByDomain","applyBrandingToDOM","createDefaultBranding","currentDomain","updateBranding","useCallback","prev","cleanedUpdates","allowedFields","checkError","root","favicon","uploadBrandingImage","fileExt","publicUrl","refreshBranding","useMemo","jsx","useBranding","useContext","ThemeContext","ThemeProvider","theme","setTheme","saved","mediaQuery","handleChange","e","toggleTheme","useTheme","ToastContext","ToastProvider","toast","setToast","queue","setQueue","hideToast","showToast","processQueue","next","rest","handleClose","success","warning","info","jsxs","Logo","className","showPoweredBy","getPasswordStrength","pwd","score","generateCode","length","isValidEmail","StepIndicator","steps","currentStep","label","stepNum","isActive","isCompleted","Check","PasswordInput","onChange","placeholder","onKeyDown","autoFocus","showStrength","visible","setVisible","strength","EyeOff","Eye","AppEntry","onForemanAccess","onOfficeLogin","onShowToast","setMode","setCompanyCode","setCompany","setPin","pinState","setPinState","foundProject","setFoundProject","foremanName","setForemanName","pinResetTimeoutRef","useRef","pinSubmitTimeoutRef","setEmail","setPassword","joinStep","setJoinStep","joinCompany","setJoinCompany","officeCode","setOfficeCode","joinName","setJoinName","joinEmail","setJoinEmail","joinPassword","setJoinPassword","joinSuccess","setJoinSuccess","registerStep","setRegisterStep","registerCompanyName","setRegisterCompanyName","registerName","setRegisterName","registerEmail","setRegisterEmail","registerPassword","setRegisterPassword","createdCompany","setCreatedCompany","handleCompanyCodeChange","cleaned","submitCompanyCode","foundCompany","submitPin","pinToSubmit","fallbackProject","handleForemanNameSubmit","handleNumberPad","newPin","handleBackspace","handleBackToCompany","handleOfficeSubmit","verifyJoinCode","verifyOfficeCode","handleJoinSubmit","normalizedEmail","authData","authError","signInData","signInError","existingMembership","ucError","userError","handleRegisterCompany","companyCodeGenerated","officeCodeGenerated","companyData","companyError","resetJoinState","resetRegisterState","HardHat","Briefcase","ArrowLeft","ChevronRight","UserPlus","Building2","Toast","onClose","timer","ThemeToggle","compact","Fragment","Sun","Moon","ErrorBoundary","Component","props","errorInfo","names","AlertTriangle","OfflineIndicator","setIsOnline","pendingCount","setPendingCount","showSynced","setShowSynced","wasOfflineRef","syncedTimeoutRef","unsubscribe","interval","InstallPrompt","deferredPrompt","setDeferredPrompt","showBanner","setShowBanner","dismissed","dismissedAt","handler","handleInstall","outcome","handleDismiss","Download","X","MFAChallenge","factorId","onVerified","onCancel","setCode","verifying","setVerifying","setError","handleVerify","challenge","challengeError","verifyError","handleKeyDown","Shield","Loader2","formatCurrency","calculateProgress","calculateValueProgress","totalValue","earnedValue","getOverallStatus","hasWorking","hasDone","getOverallStatusLabel","calculateScheduleInsights","actualManDays","totalDuration","elapsedDays","expectedProgress","progressDiff","expectedManDays","laborDiff","shouldAutoArchive","archiveDays","lastUpdate","latest","areaDate","hexToRgb","hex","loadImageAsBase64","url","timeout","quality","img","timeoutId","canvas","dataUrl","loadImagesAsBase64","urls","compressImage","maxWidth","ctx","width","height","maxHeight","baseName","compressedFile","CATEGORIES","TRANSLATIONS","WorkDetailsStep","setWorkDate","cePcoNumber","setCePcoNumber","setNotes","lang","FileText","getWorkerState","hasName","hasHours","calculateHoursFromTimeRange","endTime","startHour","startMin","endHour","endMin","totalMinutes","totalHours","regularHours","overtimeHours","WorkerRow","onUpdate","onRemove","roleSelect","workerState","BatchHoursModal","batchHours","setBatchHours","namedWorkerCount","onApply","applyTimePreset","timeStarted","timeEnded","Clock","newStart","calculated","newEnd","CrewHoursStep","activeLaborClassIds","setActiveLaborClassIds","laborCategories","laborClasses","hasCustomLaborClasses","loadingLaborClasses","todaysCrew","showBatchHoursModal","setShowBatchHoursModal","loadingPreviousCrew","namedWorkers","workersNeedingHours","totalRegHours","totalOTHours","onLoadPreviousCrew","onApplyBatchHours","onApplyInlinePreset","onAddCrewWorker","onActivateLaborClass","onDeactivateLaborClass","addSupervision","updateSupervision","removeSupervision","addOperator","updateOperator","removeOperator","addLaborer","updateLaborer","removeLaborer","addDynamicWorker","updateDynamicWorker","removeDynamicWorker","getInactiveLaborClasses","AlertCircle","Copy","inLegacy","o","l","inDynamic","isAdded","activeCategoryClasses","lc","laborClass","idx","inactiveInCategory","sup","operator","laborer","MaterialsStep","setItems","selectedCategory","setSelectedCategory","categoryItems","setCategoryItems","loadingItems","setLoadingItems","materialSearch","setMaterialSearch","searchResults","setSearchResults","allMaterials","setAllMaterials","showCustomForm","setShowCustomForm","customItem","setCustomItem","materialsSearchRef","focusTimeoutRef","loadCategoryItems","loadAllMaterials","allItems","handleMaterialSearch","lowerQuery","selectItem","it","addCustomItemHandler","updateItemQuantity","_","goBack","added","Search","existingItem","catItems","EvidenceStep","onPhotoAdd","onRemovePhoto","maxPhotos","selectedCorId","setSelectedCorId","assignableCORs","Camera","Link","SignatureLinkGenerator","lazy","__vitePreload","TMClientSignature","ReviewStep","step","setStep","validDynamicWorkersList","validSupervision","validOperators","validLaborers","totalWorkers","submittedByName","setSubmittedByName","submittedTicket","submitting","submitProgress","clientSigned","setClientSigned","showSignatureLinkModal","setShowSignatureLinkModal","showOnSiteSignature","setShowOnSiteSignature","onRetryPhotoUpload","CheckCircle2","RotateCcw","failedPhotos","PenLine","Suspense","UserCheck","Wrench","Zap","generateRandomId","TMForm","onSubmit","setSubmittedTicket","setAssignableCORs","loadingCORs","setLoadingCORs","setSupervision","setOperators","setLaborers","setPhotos","setSubmitting","setSubmitProgress","setTodaysCrew","setLoadingPreviousCrew","setLang","setLaborCategories","setLaborClasses","setDynamicWorkers","setLoadingLaborClasses","loadTodaysCrew","loadAssignableCORs","corSub","crewLaborClassIds","initialWorkers","activeIds","classId","applyBatchHours","updatedCount","updatedDynamic","applyInlinePreset","loadPreviousCrew","previousCrew","dateStr","addSupervisionFn","addLaborerFn","addOperatorFn","activateLaborClass","deactivateLaborClass","newSet","newWorkers","getValidDynamicWorkers","allWorkers","handleAddCrewWorker","classWorkers","emptyIndex","emptySupIndex","emptyOpIndex","emptyLabIndex","handlePhotoAdd","files","remainingSlots","filesToAdd","MAX_FILE_SIZE","previewUrl","updatePhotoStatus","photoId","retryPhotoUpload","fileToUpload","removePhoto","canGoNext","hasSupervision","hasOperators","hasLaborers","validationWarnings","warnings","goNext","handleSubmit","allWorkersForSubmit","vs","vo","vl","pendingPhotos","compressedPhotos","compressed","uploadedCount","failedCount","uploadPromises","importError","markError","Globe","CrewCheckin","setWorkers","saving","setSaving","showAddForm","setShowAddForm","newWorker","setNewWorker","recentWorkers","setRecentWorkers","loadingRecent","setLoadingRecent","loadingClasses","setLoadingClasses","defaultRoles","loadRecentWorkers","recent","loadLaborClasses","handleRoleChange","handleAddWorker","updatedWorkers","handleRemoveWorker","handleQuickAdd","recentWorker","availableRecentWorkers","rw","getClassesByCategory","grouped","uncategorized","catId","DailyReport","setReport","fieldNotes","setFieldNotes","setIssues","loadReport","isSubmitted","CheckCircle","task","Upload","InjuryReportForm","onReportCreated","incidentDate","setIncidentDate","incidentTime","setIncidentTime","incidentLocation","setIncidentLocation","incidentDescription","setIncidentDescription","injuryType","setInjuryType","bodyPartAffected","setBodyPartAffected","employeeName","setEmployeeName","employeePhone","setEmployeePhone","employeeEmail","setEmployeeEmail","employeeAddress","setEmployeeAddress","employeeJobTitle","setEmployeeJobTitle","employeeHireDate","setEmployeeHireDate","reportedByName","setReportedByName","reportedByTitle","setReportedByTitle","reportedByPhone","setReportedByPhone","reportedByEmail","setReportedByEmail","setWitnesses","witnessName","setWitnessName","witnessPhone","setWitnessPhone","witnessEmail","setWitnessEmail","witnessTestimony","setWitnessTestimony","medicalTreatmentRequired","setMedicalTreatmentRequired","medicalFacilityName","setMedicalFacilityName","medicalFacilityAddress","setMedicalFacilityAddress","hospitalized","setHospitalized","immediateActionsTaken","setImmediateActionsTaken","correctiveActionsPlanned","setCorrectiveActionsPlanned","safetyEquipmentUsed","setSafetyEquipmentUsed","safetyEquipmentFailed","setSafetyEquipmentFailed","oshaRecordable","setOshaRecordable","workersCompClaim","setWorkersCompClaim","daysAwayFromWork","setDaysAwayFromWork","restrictedWorkDays","setRestrictedWorkDays","handleAddWitness","handleRemoveWitness","validateStep","stepNumber","handleNext","handleBack","LOAD_TYPES","getLoadTypeInfo","DisposalLoadInput","setLoads","setHistory","showHistory","setShowHistory","newLoad","setNewLoad","displayDate","loadDisposalData","loadHistory","load","historyArray","handleAddLoad","handleDeleteLoad","handleIncrementLoad","handleDecrementLoad","loadsByType","Truck","typeData","Minus","Plus","History","ChevronUp","ChevronDown","day","formattedDate","typeInfo","FOLDER_ICONS","Folder","Map","FileSignature","Send","HelpCircle","ClipboardList","FOLDER_COLORS","getFileIcon","mimeType","Image","FileSpreadsheet","File","formatFileSize","bytes","units","size","unitIndex","FolderGrid","folders","setFolders","selectedFolder","setSelectedFolder","documents","setDocuments","loadingDocs","setLoadingDocs","selectedFolderRef","loadFolders","folderList","loadDocuments","folderSub","docSub","openFolder","handleDownload","FolderIcon","folderColor","FileIcon","Icon","color","ForemanMetrics","onBack","timeRange","setTimeRange","metrics","setMetrics","loadMetrics","now","startStr","disposalLoads","dailyReports","currentDate","refreshTimeoutRef","debouncedReload","subs","areaSub","crewSub","tmSub","haulSub","reportSub","sub","derivedMetrics","totalAreas","completedAreas","inProgressAreas","notStartedAreas","progressPercent","avgCrewSize","daysWithCrew","pendingTickets","signedTickets","totalTicketValue","totalTonnage","reportsSubmitted","reportsDue","reportStreak","calculateReportStreak","sortedDates","streak","COLORS","PIE_COLORS","progressPieData","ticketsByDay","byDay","TrendingUp","Users","ResponsiveContainer","PieChart","Pie","entry","Cell","Tooltip","BarChart","CartesianGrid","XAxis","YAxis","Bar","LineChart","Line","Calendar","DollarSign","ALL_ACTIONS","CheckSquare","FolderOpen","BarChart2","ClipboardCheck","DEFAULT_PINNED","getPinStorageKey","ForemanLanding","todayStatus","areasWorking","areasDone","areasRemaining","punchListOpenCount","onNavigate","pinnedIds","setPinnedIds","isEditMode","setIsEditMode","moreCollapsed","setMoreCollapsed","togglePin","actionId","unpinnedActions","getActionStatus","renderPinnedAction","PinOff","renderUnpinnedAction","Pin","Settings","PRIORITY_OPTIONS","STATUS_OPTIONS","Circle","PunchList","showForm","setShowForm","editingItem","setEditingItem","filterStatus","setFilterStatus","filterArea","setFilterArea","formData","setFormData","loadItems","filteredItems","open","inProgress","complete","resetForm","handleStatusChange","newStatus","handleDelete","handleEdit","getAreaName","getPriorityConfig","getStatusConfig","Filter","MapPin","Save","statusConfig","priorityConfig","StatusIcon","nextStatus","User","Edit3","Trash2","ForemanView","onExit","setAreas","updating","setUpdating","expandedGroups","setExpandedGroups","activeView","setActiveView","showProjectInfo","setShowProjectInfo","setPunchListOpenCount","setTodayStatus","isDark","setIsDark","loadAreas","loadTodayStatus","loadPunchListCount","crewWorkers","crewCheckedIn","todayTickets","disposal","debouncedRefresh","matReqSub","projectSub","materialsSub","laborSub","groups","expanded","g","handleStatusUpdate","finalStatus","toggleGroup","group","newTheme","groupedAreas","hasGroups","getGroupProgress","groupAreas","handleNavigate","viewId","Info","Dashboard","n","Setup","BrandingSettings","PricingManager","PublicView","SignaturePage","MembershipManager","PageLoader","PendingApprovalScreen","pendingCompanyName","onCheckStatus","onLogout","checking","setChecking","autoCheckCount","setAutoCheckCount","handleManualCheck","App","view","setView","setUser","userCompanies","setUserCompanies","setProjects","foremanProject","setForemanProject","setShareToken","signatureToken","setSignatureToken","activeTab","setActiveTab","showCompanySwitcher","setShowCompanySwitcher","showMobileMenu","setShowMobileMenu","navigateToProjectId","setNavigateToProjectId","pendingRequestCount","setPendingRequestCount","mfaPending","setMfaPending","mfaFactorId","setMfaFactorId","setPendingCompanyName","checkAuth","authUser","userData","companies","pendingMemberships","savedCompanyId","selectedCompany","fullCompany","path","shareMatch","signatureMatch","handleForemanAccess","handleOfficeLogin","factors","verifiedFactor","handleSwitchCompany","handleLogout","handleExitForeman","handleProjectCreated","loadProjects","projectList","loadPendingRequestCount","m","handleProjectNavigated","isAdmin","ReactDOM","React","registration"],"ignoreList":[],"sources":["../../src/lib/conflictDetection.js","../../src/lib/offlineManager.js","../../src/lib/supabaseClient.js","../../src/lib/observability.js","../../src/lib/fieldSession.js","../../src/lib/localStorageHelpers.js","../../src/lib/corOps.js","../../src/lib/equipmentOps.js","../../src/lib/drawRequestOps.js","../../src/lib/supabase.js","../../src/lib/BrandingContext.jsx","../../src/lib/ThemeContext.jsx","../../src/lib/ToastContext.jsx","../../src/components/Logo.jsx","../../src/components/AppEntry.jsx","../../src/components/Toast.jsx","../../src/components/ThemeToggle.jsx","../../src/components/ErrorBoundary.jsx","../../src/components/OfflineIndicator.jsx","../../src/components/InstallPrompt.jsx","../../src/components/MFAChallenge.jsx","../../src/lib/utils.js","../../src/lib/imageUtils.js","../../src/components/tm/translations.js","../../src/components/tm/WorkDetailsStep.jsx","../../src/components/tm/WorkerRow.jsx","../../src/components/tm/BatchHoursModal.jsx","../../src/components/tm/CrewHoursStep.jsx","../../src/components/tm/MaterialsStep.jsx","../../src/components/tm/EvidenceStep.jsx","../../src/components/tm/ReviewStep.jsx","../../src/components/TMForm.jsx","../../src/components/CrewCheckin.jsx","../../src/components/DailyReport.jsx","../../src/components/InjuryReportForm.jsx","../../src/components/DisposalLoadInput.jsx","../../src/components/documents/FolderGrid.jsx","../../src/components/ForemanMetrics.jsx","../../src/components/ForemanLanding.jsx","../../src/components/PunchList.jsx","../../src/components/ForemanView.jsx","../../src/App.jsx","../../src/main.jsx"],"sourcesContent":["/**\n * FieldSync Offline Conflict Detection\n *\n * Detects and reports conflicts when syncing offline changes\n * back to the server. Uses timestamp-based comparison with\n * user notification instead of silent last-write-wins.\n */\n\n/**\n * Compare a local (offline) record with the server version\n * to detect if a conflict exists.\n *\n * @param {object} localRecord - The locally modified record\n * @param {object} serverRecord - The current server version\n * @param {string[]} compareFields - Fields to check for conflicts\n * @returns {object} Conflict result\n */\nexport function detectConflict(localRecord, serverRecord, compareFields = []) {\n  if (!localRecord || !serverRecord) {\n    return { hasConflict: false, conflicts: [] }\n  }\n\n  // If server record was updated after the local change was made offline,\n  // someone else modified it while we were offline\n  const localModifiedAt = new Date(localRecord._offlineModifiedAt || localRecord.updated_at || 0)\n  const serverUpdatedAt = new Date(serverRecord.updated_at || 0)\n  const localCachedAt = new Date(localRecord._cachedAt || 0)\n\n  // No conflict if server hasn't changed since we cached it\n  if (serverUpdatedAt <= localCachedAt) {\n    return { hasConflict: false, conflicts: [] }\n  }\n\n  // Server was modified after we cached  check specific fields\n  const conflicts = []\n  const fieldsToCheck = compareFields.length > 0\n    ? compareFields\n    : Object.keys(localRecord).filter(k => !k.startsWith('_') && k !== 'id' && k !== 'created_at')\n\n  for (const field of fieldsToCheck) {\n    const localVal = localRecord[field]\n    const serverVal = serverRecord[field]\n\n    if (localVal !== undefined && serverVal !== undefined && !deepEqual(localVal, serverVal)) {\n      // Check if the local value was actually changed from the cached version\n      const cachedVal = localRecord._cachedValues?.[field]\n      const localChanged = cachedVal !== undefined ? !deepEqual(localVal, cachedVal) : true\n      const serverChanged = cachedVal !== undefined ? !deepEqual(serverVal, cachedVal) : true\n\n      if (localChanged && serverChanged) {\n        conflicts.push({\n          field,\n          localValue: localVal,\n          serverValue: serverVal,\n          cachedValue: cachedVal\n        })\n      }\n    }\n  }\n\n  return {\n    hasConflict: conflicts.length > 0,\n    conflicts,\n    localModifiedAt,\n    serverUpdatedAt\n  }\n}\n\n/**\n * Simple deep equality check for JSON-serializable values\n */\nfunction deepEqual(a, b) {\n  if (a === b) return true\n  if (a == null || b == null) return a === b\n  if (typeof a !== typeof b) return false\n  if (typeof a !== 'object') return a === b\n  if (Array.isArray(a) !== Array.isArray(b)) return false\n\n  const keysA = Object.keys(a)\n  const keysB = Object.keys(b)\n  if (keysA.length !== keysB.length) return false\n\n  return keysA.every(key => deepEqual(a[key], b[key]))\n}\n\n/**\n * Resolution strategies for conflicts\n */\nexport const RESOLUTION_STRATEGIES = {\n  KEEP_LOCAL: 'keep_local',\n  KEEP_SERVER: 'keep_server',\n  MERGE: 'merge'\n}\n\n/**\n * Apply a conflict resolution to a record\n *\n * @param {object} localRecord - The local version\n * @param {object} serverRecord - The server version\n * @param {string} strategy - Resolution strategy\n * @param {object} manualMerge - Manual field selections (for MERGE strategy)\n * @returns {object} The resolved record\n */\nexport function resolveConflict(localRecord, serverRecord, strategy, manualMerge = {}) {\n  switch (strategy) {\n    case RESOLUTION_STRATEGIES.KEEP_LOCAL:\n      return { ...localRecord, _resolved: true, _resolvedAt: new Date().toISOString() }\n\n    case RESOLUTION_STRATEGIES.KEEP_SERVER:\n      return { ...serverRecord, _resolved: true, _resolvedAt: new Date().toISOString() }\n\n    case RESOLUTION_STRATEGIES.MERGE: {\n      const merged = { ...serverRecord }\n      for (const [field, source] of Object.entries(manualMerge)) {\n        if (source === 'local') {\n          merged[field] = localRecord[field]\n        }\n        // 'server' is default (already in merged)\n      }\n      merged._resolved = true\n      merged._resolvedAt = new Date().toISOString()\n      return merged\n    }\n\n    default:\n      return serverRecord\n  }\n}\n\n/**\n * Batch conflict detection for a set of pending actions\n *\n * @param {Array} pendingActions - Actions queued offline\n * @param {Function} fetchServerRecord - Async function to fetch server version by (type, id)\n * @returns {Array} Array of { action, conflict } objects\n */\nexport async function detectBatchConflicts(pendingActions, fetchServerRecord) {\n  const results = []\n\n  for (const action of pendingActions) {\n    const recordId = action.payload?.id\n    if (!recordId) {\n      // New records (creates) can't have conflicts\n      results.push({ action, conflict: { hasConflict: false, conflicts: [] } })\n      continue\n    }\n\n    try {\n      const serverRecord = await fetchServerRecord(action.type, recordId)\n      if (!serverRecord) {\n        // Record was deleted on server\n        results.push({\n          action,\n          conflict: {\n            hasConflict: true,\n            conflicts: [{ field: '_deleted', localValue: action.payload, serverValue: null }],\n            deletedOnServer: true\n          }\n        })\n        continue\n      }\n\n      const conflict = detectConflict(action.payload, serverRecord)\n      results.push({ action, conflict })\n    } catch {\n      // Can't fetch server record  skip conflict check, will retry on next sync\n      results.push({ action, conflict: { hasConflict: false, conflicts: [], error: true } })\n    }\n  }\n\n  return results\n}\n\n/**\n * Stamp a record with offline metadata before caching.\n * This enables conflict detection when syncing back.\n *\n * @param {object} record - The record to stamp\n * @param {string[]} trackFields - Fields to track for conflict detection\n * @returns {object} Stamped record\n */\nexport function stampForOffline(record, trackFields = []) {\n  const stamped = {\n    ...record,\n    _cachedAt: new Date().toISOString()\n  }\n\n  if (trackFields.length > 0) {\n    stamped._cachedValues = {}\n    for (const field of trackFields) {\n      if (record[field] !== undefined) {\n        stamped._cachedValues[field] = JSON.parse(JSON.stringify(record[field]))\n      }\n    }\n  }\n\n  return stamped\n}\n\n/**\n * Build a human-readable conflict summary\n *\n * @param {object} conflictResult - Result from detectConflict\n * @param {string} recordType - 'area', 'ticket', 'report', etc.\n * @returns {object} Summary for display\n */\nexport function buildConflictSummary(conflictResult, recordType = 'record') {\n  if (!conflictResult.hasConflict) {\n    return null\n  }\n\n  if (conflictResult.deletedOnServer) {\n    return {\n      title: `${capitalize(recordType)} was deleted`,\n      description: `This ${recordType} was deleted by another user while you were offline.`,\n      severity: 'warning',\n      conflictCount: 1\n    }\n  }\n\n  const fieldNames = conflictResult.conflicts.map(c => c.field).join(', ')\n  return {\n    title: `${capitalize(recordType)} was modified`,\n    description: `The following fields were changed by another user: ${fieldNames}`,\n    severity: conflictResult.conflicts.length > 2 ? 'warning' : 'info',\n    conflictCount: conflictResult.conflicts.length,\n    fields: conflictResult.conflicts\n  }\n}\n\nfunction capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n","/**\n * FieldSync Offline Manager\n * Handles offline data storage, pending actions queue, and sync\n */\n\nimport { detectConflict, stampForOffline, buildConflictSummary, RESOLUTION_STRATEGIES } from './conflictDetection'\n\nconst DB_NAME = 'fieldsync-offline'\nconst DB_VERSION = 2  // Bumped to add T&M tickets, daily reports, messages stores\n\n// Store names\nconst STORES = {\n  PROJECTS: 'projects',\n  AREAS: 'areas',\n  CREW_CHECKINS: 'crew_checkins',\n  TM_TICKETS: 'tm_tickets',\n  DAILY_REPORTS: 'daily_reports',\n  MESSAGES: 'messages',\n  PENDING_ACTIONS: 'pending_actions',\n  CACHED_DATA: 'cached_data'\n}\n\nlet db = null\n\n// Initialize IndexedDB\nexport const initOfflineDB = () => {\n  return new Promise((resolve, reject) => {\n    if (db) {\n      resolve(db)\n      return\n    }\n\n    const request = indexedDB.open(DB_NAME, DB_VERSION)\n\n    request.onerror = () => {\n      console.error('Failed to open offline database')\n      reject(request.error)\n    }\n\n    request.onsuccess = () => {\n      db = request.result\n      resolve(db)\n    }\n\n    request.onupgradeneeded = (event) => {\n      const database = event.target.result\n\n      // Projects store\n      if (!database.objectStoreNames.contains(STORES.PROJECTS)) {\n        const projectStore = database.createObjectStore(STORES.PROJECTS, { keyPath: 'id' })\n        projectStore.createIndex('company_id', 'company_id', { unique: false })\n      }\n\n      // Areas store\n      if (!database.objectStoreNames.contains(STORES.AREAS)) {\n        const areaStore = database.createObjectStore(STORES.AREAS, { keyPath: 'id' })\n        areaStore.createIndex('project_id', 'project_id', { unique: false })\n      }\n\n      // Crew checkins store\n      if (!database.objectStoreNames.contains(STORES.CREW_CHECKINS)) {\n        const checkinStore = database.createObjectStore(STORES.CREW_CHECKINS, { keyPath: 'id' })\n        checkinStore.createIndex('project_id', 'project_id', { unique: false })\n      }\n\n      // T&M tickets store (for offline creation)\n      if (!database.objectStoreNames.contains(STORES.TM_TICKETS)) {\n        const ticketStore = database.createObjectStore(STORES.TM_TICKETS, { keyPath: 'id' })\n        ticketStore.createIndex('project_id', 'project_id', { unique: false })\n      }\n\n      // Daily reports store\n      if (!database.objectStoreNames.contains(STORES.DAILY_REPORTS)) {\n        const reportStore = database.createObjectStore(STORES.DAILY_REPORTS, { keyPath: 'id' })\n        reportStore.createIndex('project_id', 'project_id', { unique: false })\n      }\n\n      // Messages store\n      if (!database.objectStoreNames.contains(STORES.MESSAGES)) {\n        const messageStore = database.createObjectStore(STORES.MESSAGES, { keyPath: 'id' })\n        messageStore.createIndex('project_id', 'project_id', { unique: false })\n      }\n\n      // Pending actions queue - for offline submissions\n      if (!database.objectStoreNames.contains(STORES.PENDING_ACTIONS)) {\n        const pendingStore = database.createObjectStore(STORES.PENDING_ACTIONS, {\n          keyPath: 'id',\n          autoIncrement: true\n        })\n        pendingStore.createIndex('type', 'type', { unique: false })\n        pendingStore.createIndex('created_at', 'created_at', { unique: false })\n      }\n\n      // Generic cached data store\n      if (!database.objectStoreNames.contains(STORES.CACHED_DATA)) {\n        database.createObjectStore(STORES.CACHED_DATA, { keyPath: 'key' })\n      }\n    }\n  })\n}\n\n// Generic store operations\nconst getStore = (storeName, mode = 'readonly') => {\n  if (!db) throw new Error('Database not initialized')\n  const tx = db.transaction(storeName, mode)\n  return tx.objectStore(storeName)\n}\n\n// Save item to store\nexport const saveToStore = async (storeName, data) => {\n  await initOfflineDB()\n  return new Promise((resolve, reject) => {\n    const store = getStore(storeName, 'readwrite')\n    const request = store.put(data)\n    request.onsuccess = () => resolve(request.result)\n    request.onerror = () => reject(request.error)\n  })\n}\n\n// Save multiple items to store\nexport const saveAllToStore = async (storeName, items) => {\n  await initOfflineDB()\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction(storeName, 'readwrite')\n    const store = tx.objectStore(storeName)\n\n    items.forEach(item => store.put(item))\n\n    tx.oncomplete = () => resolve()\n    tx.onerror = () => reject(tx.error)\n  })\n}\n\n// Get item from store\nexport const getFromStore = async (storeName, key) => {\n  await initOfflineDB()\n  return new Promise((resolve, reject) => {\n    const store = getStore(storeName)\n    const request = store.get(key)\n    request.onsuccess = () => resolve(request.result)\n    request.onerror = () => reject(request.error)\n  })\n}\n\n// Get all items from store\nexport const getAllFromStore = async (storeName) => {\n  await initOfflineDB()\n  return new Promise((resolve, reject) => {\n    const store = getStore(storeName)\n    const request = store.getAll()\n    request.onsuccess = () => resolve(request.result || [])\n    request.onerror = () => reject(request.error)\n  })\n}\n\n// Get items by index\nexport const getByIndex = async (storeName, indexName, value) => {\n  await initOfflineDB()\n  return new Promise((resolve, reject) => {\n    const store = getStore(storeName)\n    const index = store.index(indexName)\n    const request = index.getAll(value)\n    request.onsuccess = () => resolve(request.result || [])\n    request.onerror = () => reject(request.error)\n  })\n}\n\n// Delete item from store\nexport const deleteFromStore = async (storeName, key) => {\n  await initOfflineDB()\n  return new Promise((resolve, reject) => {\n    const store = getStore(storeName, 'readwrite')\n    const request = store.delete(key)\n    request.onsuccess = () => resolve()\n    request.onerror = () => reject(request.error)\n  })\n}\n\n// Clear entire store\nexport const clearStore = async (storeName) => {\n  await initOfflineDB()\n  return new Promise((resolve, reject) => {\n    const store = getStore(storeName, 'readwrite')\n    const request = store.clear()\n    request.onsuccess = () => resolve()\n    request.onerror = () => reject(request.error)\n  })\n}\n\n// ============================================\n// Pending Actions Queue\n// ============================================\n\nexport const ACTION_TYPES = {\n  UPDATE_AREA_STATUS: 'UPDATE_AREA_STATUS',\n  CREATE_TM_TICKET: 'CREATE_TM_TICKET',\n  SAVE_CREW_CHECKIN: 'SAVE_CREW_CHECKIN',\n  SUBMIT_DAILY_REPORT: 'SUBMIT_DAILY_REPORT',\n  SEND_MESSAGE: 'SEND_MESSAGE',\n  CREATE_MATERIAL_REQUEST: 'CREATE_MATERIAL_REQUEST'\n}\n\n// Add action to pending queue\nexport const addPendingAction = async (type, payload, metadata = {}) => {\n  await initOfflineDB()\n  const action = {\n    type,\n    payload,\n    metadata,\n    created_at: new Date().toISOString(),\n    attempts: 0,\n    last_error: null\n  }\n\n  return new Promise((resolve, reject) => {\n    const store = getStore(STORES.PENDING_ACTIONS, 'readwrite')\n    const request = store.add(action)\n    request.onsuccess = () => {\n      resolve(request.result)\n    }\n    request.onerror = () => reject(request.error)\n  })\n}\n\n// Get all pending actions\nexport const getPendingActions = async () => {\n  return getAllFromStore(STORES.PENDING_ACTIONS)\n}\n\n// Get pending action count\nexport const getPendingActionCount = async () => {\n  const actions = await getPendingActions()\n  return actions.length\n}\n\n// Remove completed action\nexport const removePendingAction = async (id) => {\n  return deleteFromStore(STORES.PENDING_ACTIONS, id)\n}\n\n// Update action after failed attempt\nexport const updatePendingAction = async (id, updates) => {\n  await initOfflineDB()\n  return new Promise((resolve, reject) => {\n    const store = getStore(STORES.PENDING_ACTIONS, 'readwrite')\n    const getRequest = store.get(id)\n\n    getRequest.onsuccess = () => {\n      const action = getRequest.result\n      if (action) {\n        const updated = { ...action, ...updates }\n        const putRequest = store.put(updated)\n        putRequest.onsuccess = () => resolve(updated)\n        putRequest.onerror = () => reject(putRequest.error)\n      } else {\n        reject(new Error('Action not found'))\n      }\n    }\n    getRequest.onerror = () => reject(getRequest.error)\n  })\n}\n\n// ============================================\n// Project & Area Caching\n// ============================================\n\n// Cache projects for offline access\nexport const cacheProjects = async (projects) => {\n  return saveAllToStore(STORES.PROJECTS, projects)\n}\n\n// Get cached projects\nexport const getCachedProjects = async (companyId) => {\n  if (companyId) {\n    return getByIndex(STORES.PROJECTS, 'company_id', companyId)\n  }\n  return getAllFromStore(STORES.PROJECTS)\n}\n\n// Cache areas for a project (stamped for conflict detection)\nexport const cacheAreas = async (areas) => {\n  const stamped = areas.map(a => stampForOffline(a, ['status', 'weight', 'name']))\n  return saveAllToStore(STORES.AREAS, stamped)\n}\n\n// Get cached areas for a project\nexport const getCachedAreas = async (projectId) => {\n  return getByIndex(STORES.AREAS, 'project_id', projectId)\n}\n\n// Update cached area status (optimistic update with offline tracking)\nexport const updateCachedAreaStatus = async (areaId, status) => {\n  const area = await getFromStore(STORES.AREAS, areaId)\n  if (area) {\n    area.status = status\n    area.updated_at = new Date().toISOString()\n    area._offlineModifiedAt = new Date().toISOString()\n    await saveToStore(STORES.AREAS, area)\n  }\n  return area\n}\n\n// Cache crew checkin\nexport const cacheCrewCheckin = async (checkin) => {\n  return saveToStore(STORES.CREW_CHECKINS, checkin)\n}\n\n// Get cached crew checkin\nexport const getCachedCrewCheckin = async (projectId) => {\n  const checkins = await getByIndex(STORES.CREW_CHECKINS, 'project_id', projectId)\n  // Return the most recent one for today\n  const today = new Date().toISOString().split('T')[0]\n  return checkins.find(c => c.check_in_date === today) || null\n}\n\n// ============================================\n// T&M Ticket Caching\n// ============================================\n\n// Cache a T&M ticket (for optimistic UI during offline creation)\nexport const cacheTMTicket = async (ticket) => {\n  return saveToStore(STORES.TM_TICKETS, ticket)\n}\n\n// Get cached T&M tickets for a project\nexport const getCachedTMTickets = async (projectId) => {\n  return getByIndex(STORES.TM_TICKETS, 'project_id', projectId)\n}\n\n// Generate a temporary ID for offline-created tickets\nexport const generateTempId = () => {\n  const array = new Uint8Array(6)\n  crypto.getRandomValues(array)\n  const randomPart = Array.from(array, b => b.toString(36)).join('')\n  return `temp_${Date.now()}_${randomPart}`\n}\n\n// ============================================\n// Daily Report Caching\n// ============================================\n\n// Cache a daily report\nexport const cacheDailyReport = async (report) => {\n  return saveToStore(STORES.DAILY_REPORTS, report)\n}\n\n// Get cached daily report for project/date\nexport const getCachedDailyReport = async (projectId, date) => {\n  const reports = await getByIndex(STORES.DAILY_REPORTS, 'project_id', projectId)\n  return reports.find(r => r.report_date === date) || null\n}\n\n// ============================================\n// Message Caching\n// ============================================\n\n// Cache a message (for optimistic UI)\nexport const cacheMessage = async (message) => {\n  return saveToStore(STORES.MESSAGES, message)\n}\n\n// Get cached messages for a project\nexport const getCachedMessages = async (projectId) => {\n  return getByIndex(STORES.MESSAGES, 'project_id', projectId)\n}\n\n// ============================================\n// Connection Status\n// ============================================\n\n// Guard for SSR/test environments where navigator is undefined\nlet isOnline = typeof navigator !== 'undefined' ? navigator.onLine : true\nconst listeners = new Set()\n\n// Subscribe to connection changes\nexport const onConnectionChange = (callback) => {\n  listeners.add(callback)\n  return () => listeners.delete(callback)\n}\n\n// Get current connection status\nexport const getConnectionStatus = () => isOnline\n\n// Notify all listeners of connection change\nconst notifyConnectionChange = (online) => {\n  isOnline = online\n  listeners.forEach(callback => callback(online))\n}\n\n// Set up connection listeners\nif (typeof window !== 'undefined') {\n  window.addEventListener('online', () => {\n    notifyConnectionChange(true)\n  })\n\n  window.addEventListener('offline', () => {\n    notifyConnectionChange(false)\n  })\n}\n\n// ============================================\n// Sync Manager\n// ============================================\n\nlet isSyncing = false\n\n// Process pending actions queue with conflict detection\nexport const syncPendingActions = async (db, options = {}) => {\n  if (isSyncing || !isOnline) return { synced: 0, failed: 0, conflicts: [] }\n\n  const { onConflict } = options\n  isSyncing = true\n  const results = { synced: 0, failed: 0, conflicts: [] }\n\n  try {\n    const actions = await getPendingActions()\n\n    for (const action of actions) {\n      try {\n        // Check for conflicts on update actions (not creates)\n        if (action.payload?.id && action.type === ACTION_TYPES.UPDATE_AREA_STATUS) {\n          const serverRecord = await fetchServerRecord(db, action.type, action.payload)\n          if (serverRecord) {\n            const cachedRecord = await getFromStore(STORES.AREAS, action.payload.areaId || action.payload.id)\n            if (cachedRecord) {\n              const conflict = detectConflict(cachedRecord, serverRecord, ['status'])\n              if (conflict.hasConflict) {\n                const summary = buildConflictSummary(conflict, 'area')\n                results.conflicts.push({ action, conflict, summary })\n\n                // Notify caller of conflict\n                if (onConflict) {\n                  const resolution = await onConflict({ action, conflict, summary })\n                  if (resolution === RESOLUTION_STRATEGIES.KEEP_SERVER) {\n                    // Skip this action, accept server version\n                    await removePendingAction(action.id)\n                    continue\n                  }\n                  // KEEP_LOCAL: proceed with processAction below\n                }\n                // Default: proceed with local change (keep_local)\n              }\n            }\n          }\n        }\n\n        await processAction(action, db)\n        await removePendingAction(action.id)\n        results.synced++\n      } catch (error) {\n        results.failed++\n\n        // Update attempt count\n        await updatePendingAction(action.id, {\n          attempts: (action.attempts || 0) + 1,\n          last_error: error.message,\n          last_attempt: new Date().toISOString()\n        })\n      }\n    }\n  } finally {\n    isSyncing = false\n  }\n\n  return results\n}\n\n// Fetch a server record for conflict comparison\nconst fetchServerRecord = async (db, actionType, payload) => {\n  try {\n    switch (actionType) {\n      case ACTION_TYPES.UPDATE_AREA_STATUS:\n        return db.getArea ? await db.getArea(payload.areaId) : null\n      default:\n        return null\n    }\n  } catch {\n    return null\n  }\n}\n\n// Process individual action\nconst processAction = async (action, db) => {\n  const { type, payload } = action\n\n  switch (type) {\n    case ACTION_TYPES.UPDATE_AREA_STATUS:\n      return db.updateAreaStatus(payload.areaId, payload.status)\n\n    case ACTION_TYPES.CREATE_TM_TICKET: {\n      // Complex action - create ticket, upload photos, add workers/items\n      const ticket = await db.createTMTicket(payload.ticket)\n      if (payload.workers?.length > 0) {\n        await db.addTMWorkers(ticket.id, payload.workers)\n      }\n      if (payload.items?.length > 0) {\n        await db.addTMItems(ticket.id, payload.items)\n      }\n      // Note: Photos would need separate handling\n      return ticket\n    }\n\n    case ACTION_TYPES.SAVE_CREW_CHECKIN:\n      return db.saveCrewCheckin(\n        payload.projectId,\n        payload.workers,\n        payload.checkInDate\n      )\n\n    case ACTION_TYPES.SUBMIT_DAILY_REPORT:\n      await db.saveDailyReport(payload.projectId, payload.reportData)\n      return db.submitDailyReport(payload.projectId, payload.submittedBy)\n\n    case ACTION_TYPES.SEND_MESSAGE:\n      return db.sendMessage(\n        payload.projectId,\n        payload.senderType,\n        payload.senderName,\n        payload.content\n      )\n\n    case ACTION_TYPES.CREATE_MATERIAL_REQUEST:\n      return db.createMaterialRequest(\n        payload.projectId,\n        payload.items,\n        payload.requestedBy,\n        payload.neededBy,\n        payload.priority,\n        payload.notes\n      )\n\n    default:\n      throw new Error(`Unknown action type: ${type}`)\n  }\n}\n\n// ============================================\n// Cached Data Helpers\n// ============================================\n\n// Save generic cached data with key\nexport const setCachedData = async (key, data) => {\n  return saveToStore(STORES.CACHED_DATA, { key, data, cached_at: new Date().toISOString() })\n}\n\n// Get generic cached data by key\nexport const getCachedData = async (key) => {\n  const result = await getFromStore(STORES.CACHED_DATA, key)\n  return result?.data || null\n}\n\n// Export store names for external use\nexport { STORES }\n","/**\n * Supabase Client Initialization\n *\n * This file is separate to avoid circular dependencies between\n * supabase.js and observability.js\n */\n\nimport { createClient } from '@supabase/supabase-js'\n\n// For demo purposes, we'll use a mock mode that falls back to localStorage\n// In production, you would set these environment variables\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL || ''\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || ''\n\n// Check if Supabase is configured\nexport const isSupabaseConfigured = Boolean(supabaseUrl && supabaseAnonKey)\n\n// Create client only if configured\nexport const supabase = isSupabaseConfigured\n  ? createClient(supabaseUrl, supabaseAnonKey)\n  : null\n\n// Export URL and key for creating additional clients (field sessions)\nexport { supabaseUrl, supabaseAnonKey }\n","/**\n * FieldSync Observability Layer\n *\n * Vendor-agnostic metrics collection.\n * Works with Supabase now, can add DataDog/Grafana agents later.\n *\n * Usage:\n *   import { observe } from './observability'\n *\n *   // Track slow queries\n *   observe.query('getTMTickets', { duration: 234, rows: 50, company_id: 'uuid' })\n *\n *   // Track errors\n *   observe.error('database', { message: 'Connection failed', company_id: 'uuid' })\n */\n\nimport { supabase, isSupabaseConfigured } from './supabaseClient'\n\n// Configuration\nconst CONFIG = {\n  // Only log queries slower than this (ms)\n  slowQueryThreshold: 200,\n\n  // Enable console logging in development\n  enableConsole: import.meta.env.DEV,\n\n  // Enable Supabase logging only when configured (production)\n  enableSupabase: isSupabaseConfigured,\n\n  // Batch size for sending metrics (future optimization)\n  batchSize: 10,\n}\n\n// Pending metrics queue (for future batching)\nlet pendingMetrics = []\n\n/**\n * Main observability interface\n */\nexport const observe = {\n  /**\n   * Track database query performance\n   *\n   * @param {string} operation - Name of the operation (e.g., 'getTMTickets')\n   * @param {object} context - Query context\n   * @param {number} context.duration - Duration in milliseconds\n   * @param {number} [context.rows] - Number of rows returned\n   * @param {string} [context.company_id] - Company ID\n   * @param {string} [context.project_id] - Project ID\n   * @param {string} [context.user_id] - User ID\n   */\n  query(operation, context) {\n    const event = {\n      type: 'query',\n      operation,\n      duration_ms: context.duration,\n      rows_returned: context.rows,\n      company_id: context.company_id || null,\n      project_id: context.project_id || null,\n      user_id: context.user_id || null,\n      timestamp: new Date().toISOString(),\n    }\n\n    // Console logging (dev only)\n    if (CONFIG.enableConsole) {\n      const icon = context.duration > CONFIG.slowQueryThreshold ? '' : ''\n      console.log(`${icon} [query] ${operation}: ${context.duration}ms`,\n        context.rows ? `(${context.rows} rows)` : '')\n    }\n\n    // Only log slow queries to Supabase to avoid noise\n    if (CONFIG.enableSupabase && context.duration >= CONFIG.slowQueryThreshold) {\n      logToSupabase('query', event)\n    }\n  },\n\n  /**\n   * Track errors with context\n   *\n   * @param {string} category - Error category ('database', 'storage', 'auth', 'network', 'sync')\n   * @param {object} context - Error context\n   * @param {string} context.message - Error message\n   * @param {string} [context.code] - Error code\n   * @param {string} [context.severity] - 'info', 'warning', 'error', 'critical'\n   * @param {string} [context.company_id] - Company ID\n   * @param {string} [context.user_id] - User ID\n   * @param {string} [context.project_id] - Project ID\n   * @param {string} [context.operation] - Operation that failed\n   */\n  error(category, context) {\n    const event = {\n      type: 'error',\n      category,\n      severity: context.severity || 'error',\n      error_code: context.code || null,\n      message: context.message,\n      company_id: context.company_id || null,\n      user_id: context.user_id || null,\n      project_id: context.project_id || null,\n      operation: context.operation || null,\n      context: context.extra || {},\n      timestamp: new Date().toISOString(),\n    }\n\n    // Always log errors to console\n    const icon = {\n      critical: '',\n      error: '',\n      warning: '',\n      info: '',\n    }[event.severity] || ''\n\n    if (CONFIG.enableConsole) {\n      console.error(`${icon} [${category}] ${context.message}`, context)\n    }\n\n    // Always log errors to Supabase\n    if (CONFIG.enableSupabase) {\n      logToSupabase('error', event)\n    }\n  },\n\n  /**\n   * Track storage operations\n   *\n   * @param {string} operation - 'upload', 'download', 'delete'\n   * @param {object} context - Storage context\n   */\n  storage(operation, context) {\n    const event = {\n      type: 'storage',\n      operation,\n      company_id: context.company_id || null,\n      project_id: context.project_id || null,\n      file_size_bytes: context.size || 0,\n      duration_ms: context.duration || 0,\n      success: context.success !== false,\n      error_message: context.error || null,\n      timestamp: new Date().toISOString(),\n    }\n\n    if (CONFIG.enableConsole) {\n      const icon = event.success ? '' : ''\n      console.log(`${icon} [storage:${operation}] ${context.size ? Math.round(context.size / 1024) + 'KB' : ''}`,\n        context.duration ? `${context.duration}ms` : '')\n    }\n\n    // Log failed uploads or slow uploads (>5s) to Supabase\n    if (CONFIG.enableSupabase && (!event.success || event.duration_ms > 5000)) {\n      logToSupabase('storage', event)\n    }\n  },\n\n  /**\n   * Track user activity (lightweight, for health scoring)\n   *\n   * @param {string} action - Action type\n   * @param {object} context - Action context\n   */\n  activity(action, context) {\n    // Only log in development for now\n    if (CONFIG.enableConsole) {\n      console.log(` [activity] ${action}`, context)\n    }\n  },\n}\n\n/**\n * Send event to Supabase\n */\nasync function logToSupabase(type, event) {\n  // Guard: Don't attempt to log if Supabase isn't configured\n  if (!supabase) return\n\n  try {\n    if (type === 'error') {\n      await supabase.rpc('log_error', {\n        p_severity: event.severity,\n        p_category: event.category,\n        p_message: event.message,\n        p_company_id: event.company_id,\n        p_user_id: event.user_id,\n        p_project_id: event.project_id,\n        p_operation: event.operation,\n        p_error_code: event.error_code,\n        p_context: event.context || {},\n      })\n    } else if (type === 'query') {\n      await supabase.rpc('log_query_metric', {\n        p_operation: event.operation,\n        p_duration_ms: event.duration_ms,\n        p_rows_returned: event.rows_returned,\n        p_company_id: event.company_id,\n        p_project_id: event.project_id,\n        p_user_id: event.user_id,\n        p_context: {},\n      })\n    }\n    // Storage metrics logged directly if needed\n  } catch (err) {\n    // Don't let observability errors break the app\n    if (CONFIG.enableConsole) {\n      console.warn('[observability] Failed to log to Supabase:', err.message)\n    }\n  }\n}\n\n/**\n * Helper: Wrap a database function with timing\n *\n * Usage:\n *   const getTMTickets = observe.wrapQuery('getTMTickets', async (projectId) => {\n *     // original implementation\n *   })\n */\nobserve.wrapQuery = function(operationName, fn) {\n  return async function(...args) {\n    const start = performance.now()\n    try {\n      const result = await fn.apply(this, args)\n      const duration = Math.round(performance.now() - start)\n\n      // Try to extract context from args or result\n      const context = {\n        duration,\n        rows: Array.isArray(result) ? result.length : undefined,\n      }\n\n      observe.query(operationName, context)\n      return result\n    } catch (error) {\n      const duration = Math.round(performance.now() - start)\n      observe.error('database', {\n        message: error.message,\n        operation: operationName,\n        severity: 'error',\n        extra: { duration },\n      })\n      throw error\n    }\n  }\n}\n\n/**\n * Helper: Time a block of code\n *\n * Usage:\n *   const duration = await observe.time('loadDashboard', async () => {\n *     // code to time\n *   })\n */\nobserve.time = async function(operationName, fn) {\n  const start = performance.now()\n  try {\n    const result = await fn()\n    const duration = Math.round(performance.now() - start)\n    observe.query(operationName, { duration })\n    return result\n  } catch (error) {\n    observe.error('general', {\n      message: error.message,\n      operation: operationName,\n    })\n    throw error\n  }\n}\n\nexport default observe\n","/**\n * Field Session Management\n *\n * Field workers authenticate via PIN and receive a session token.\n * This token must be included in all subsequent requests.\n */\n\nimport { createClient } from '@supabase/supabase-js'\nimport { supabase, isSupabaseConfigured, supabaseUrl, supabaseAnonKey } from './supabaseClient'\n\nconst FIELD_SESSION_KEY = 'fieldsync_field_session'\n\n// Store field session data in memory\nlet fieldSessionData = null\n\n/**\n * Get stored field session from memory or sessionStorage\n * @returns {Object|null} Session data with token, projectId, companyId\n */\nexport const getFieldSession = () => {\n  if (fieldSessionData) return fieldSessionData\n\n  try {\n    const stored = sessionStorage.getItem(FIELD_SESSION_KEY)\n    if (stored) {\n      fieldSessionData = JSON.parse(stored)\n      return fieldSessionData\n    }\n  } catch (e) {\n    // Ignore parse errors\n  }\n  return null\n}\n\n/**\n * Save field session to memory and sessionStorage\n * @param {Object|null} session - Session data to save\n */\nexport const setFieldSession = (session) => {\n  fieldSessionData = session\n  if (session) {\n    sessionStorage.setItem(FIELD_SESSION_KEY, JSON.stringify(session))\n  } else {\n    sessionStorage.removeItem(FIELD_SESSION_KEY)\n  }\n}\n\n/**\n * Clear field session (logout)\n * Invalidates session on server and clears local storage\n */\nexport const clearFieldSession = async () => {\n  const session = getFieldSession()\n  if (session?.token && isSupabaseConfigured) {\n    // Invalidate on server\n    try {\n      await supabase.rpc('invalidate_field_session', { p_session_token: session.token })\n    } catch (e) {\n      // Ignore errors during logout\n    }\n  }\n  setFieldSession(null)\n}\n\n// Cached field client with session header\nlet fieldClient = null\n\n/**\n * Get Supabase client with field session header\n * Creates client lazily and caches it\n * @returns {Object} Supabase client\n */\nexport const getFieldClient = () => {\n  const session = getFieldSession()\n  if (!session?.token || !isSupabaseConfigured) return supabase\n\n  // Create client with session header if not already created or token changed\n  if (!fieldClient || fieldClient._sessionToken !== session.token) {\n    fieldClient = createClient(supabaseUrl, supabaseAnonKey, {\n      global: {\n        headers: {\n          'x-field-session': session.token\n        }\n      }\n    })\n    fieldClient._sessionToken = session.token\n  }\n\n  return fieldClient\n}\n\n/**\n * Get the appropriate Supabase client for the current context\n * Returns field client if in field mode, otherwise regular client\n * @returns {Object} Supabase client\n */\nexport const getSupabaseClient = () => {\n  const session = getFieldSession()\n  return session?.token ? getFieldClient() : supabase\n}\n\n/**\n * Internal function to get client for db methods\n * Returns null if Supabase is not configured (demo mode)\n * @returns {Object|null} Supabase client\n */\nexport const getClient = () => {\n  if (!isSupabaseConfigured) return null\n  const session = getFieldSession()\n  return session?.token ? getFieldClient() : supabase\n}\n\n/**\n * Check if currently in field mode with valid session\n * @returns {boolean}\n */\nexport const isFieldMode = () => {\n  const session = getFieldSession()\n  return Boolean(session?.token && session?.projectId)\n}\n\n/**\n * Get current field project ID\n * @returns {string|null}\n */\nexport const getFieldProjectId = () => {\n  const session = getFieldSession()\n  return session?.projectId || null\n}\n\n/**\n * Get current field company ID\n * @returns {string|null}\n */\nexport const getFieldCompanyId = () => {\n  const session = getFieldSession()\n  return session?.companyId || null\n}\n\nexport default {\n  getFieldSession,\n  setFieldSession,\n  clearFieldSession,\n  getFieldClient,\n  getSupabaseClient,\n  getClient,\n  isFieldMode,\n  getFieldProjectId,\n  getFieldCompanyId\n}\n","// Shared local storage helpers for demo/offline mode\n// Extracted from supabase.js to avoid circular dependencies\n\nconst STORAGE_KEY = 'fieldsync_data'\nconst USER_KEY = 'fieldsync_user'\n\nconst DEFAULT_LOCAL_DATA = { projects: [], areas: [], users: [], assignments: [] }\n\nexport const getLocalData = () => {\n  try {\n    const data = localStorage.getItem(STORAGE_KEY)\n    return data ? JSON.parse(data) : DEFAULT_LOCAL_DATA\n  } catch {\n    localStorage.removeItem(STORAGE_KEY)\n    return DEFAULT_LOCAL_DATA\n  }\n}\n\nexport const setLocalData = (data) => {\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(data))\n}\n\nexport const getLocalUser = () => {\n  try {\n    const user = localStorage.getItem(USER_KEY)\n    return user ? JSON.parse(user) : null\n  } catch {\n    localStorage.removeItem(USER_KEY)\n    return null\n  }\n}\n\nexport const setLocalUser = (user) => {\n  if (user) {\n    localStorage.setItem(USER_KEY, JSON.stringify(user))\n  } else {\n    localStorage.removeItem(USER_KEY)\n  }\n}\n","// COR (Change Order Request) operations\n// Extracted from supabase.js for maintainability\n// These methods are spread into the `db` object in supabase.js,\n// so all existing `db.createCOR()` etc. calls continue to work unchanged.\n\nimport { supabase, isSupabaseConfigured } from './supabaseClient'\nimport { getClient } from './fieldSession'\nimport { observe } from './observability'\nimport { generateTempId } from './offlineManager'\nimport { getLocalData, setLocalData } from './localStorageHelpers'\n\nexport const corOps = {\n  // Create a new COR (with retry on conflict)\n  async createCOR(corData, retryCount = 0) {\n    if (isSupabaseConfigured) {\n      // Get a fresh COR number if this is a retry\n      let corNumber = corData.cor_number\n      if (retryCount > 0) {\n        corNumber = await this.getNextCORNumber(corData.project_id)\n      }\n\n      const { data, error } = await supabase\n        .from('change_orders')\n        .insert({\n          company_id: corData.company_id,\n          project_id: corData.project_id,\n          area_id: corData.area_id || null,\n          cor_number: corNumber,\n          title: corData.title,\n          description: corData.description || '',\n          scope_of_work: corData.scope_of_work,\n          period_start: corData.period_start,\n          period_end: corData.period_end,\n          status: 'draft',\n          // Default markup percentages (basis points)\n          labor_markup_percent: corData.labor_markup_percent ?? 1500,\n          materials_markup_percent: corData.materials_markup_percent ?? 1500,\n          equipment_markup_percent: corData.equipment_markup_percent ?? 1500,\n          subcontractors_markup_percent: corData.subcontractors_markup_percent ?? 500,\n          // Default fee percentages (basis points)\n          liability_insurance_percent: corData.liability_insurance_percent ?? 144,\n          bond_percent: corData.bond_percent ?? 100,\n          license_fee_percent: corData.license_fee_percent ?? 10,\n          created_by: corData.created_by || null\n        })\n        .select()\n        .single()\n\n      // Handle 409 conflict (duplicate COR number) by retrying with fresh number\n      // PostgreSQL unique violation = 23505, HTTP conflict = 409\n      const isConflict = error?.code === '23505' ||\n                         error?.code === 'PGRST116' ||\n                         error?.status === 409 ||\n                         error?.message?.includes('duplicate') ||\n                         error?.message?.includes('unique_cor_number')\n      if (isConflict && retryCount < 3) {\n        console.warn(`COR number conflict, retrying with fresh number (attempt ${retryCount + 1})`)\n        return this.createCOR(corData, retryCount + 1)\n      }\n\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Update COR fields (not line items)\n  async updateCOR(corId, updates) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_orders')\n        .update({\n          ...updates,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', corId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Delete COR (cascade deletes line items and associations)\n  async deleteCOR(corId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('change_orders')\n        .delete()\n        .eq('id', corId)\n      if (error) throw error\n    }\n  },\n\n  // Bulk update COR group name\n  // Requires migration_cor_enhancements.sql to be run for group_name column\n  async bulkUpdateCORGroup(corIds, groupName) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('change_orders')\n        .update({ group_name: groupName, updated_at: new Date().toISOString() })\n        .in('id', corIds)\n      if (error) {\n        // Check if the error is due to missing group_name column\n        if (error.message?.includes('group_name') || error.code === 'PGRST204') {\n          throw new Error('COR grouping requires a database migration. Please run database/migration_cor_enhancements.sql in Supabase SQL Editor.')\n        }\n        throw error\n      }\n    }\n  },\n\n  // Get all CORs for a project\n  async getCORs(projectId, filters = {}) {\n    if (isSupabaseConfigured) {\n      let query = supabase\n        .from('change_orders')\n        .select(`\n          *,\n          areas (id, name),\n          labor_count:change_order_labor(count),\n          materials_count:change_order_materials(count),\n          equipment_count:change_order_equipment(count),\n          subcontractors_count:change_order_subcontractors(count),\n          tickets_count:change_order_ticket_associations(count)\n        `)\n        .eq('project_id', projectId)\n\n      // Apply filters\n      if (filters.status) {\n        query = query.eq('status', filters.status)\n      }\n      if (filters.area_id) {\n        query = query.eq('area_id', filters.area_id)\n      }\n      if (filters.date_start) {\n        query = query.gte('period_start', filters.date_start)\n      }\n      if (filters.date_end) {\n        query = query.lte('period_end', filters.date_end)\n      }\n\n      query = query.order('created_at', { ascending: false })\n\n      const { data, error } = await query\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  // Get single COR with all line items and full backup documentation\n  async getCORById(corId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_orders')\n        .select(`\n          *,\n          areas (id, name),\n          change_order_labor (*),\n          change_order_materials (*),\n          change_order_equipment (*),\n          change_order_subcontractors (*),\n          change_order_ticket_associations (\n            *,\n            t_and_m_tickets (\n              *,\n              t_and_m_workers (*),\n              t_and_m_items (\n                *,\n                materials_equipment (name, unit, cost_per_unit, category)\n              )\n            )\n          )\n        `)\n        .eq('id', corId)\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Get all CORs for a specific work area\n  async getCORsByArea(projectId, areaId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_orders')\n        .select('*')\n        .eq('project_id', projectId)\n        .eq('area_id', areaId)\n        .order('created_at', { ascending: false })\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  // Get all CORs available for T&M ticket assignment\n  // Used by foremen to assign T&M tickets directly to a COR from the field\n  // Only returns CORs that can still receive tickets (not billed or archived)\n  async getAssignableCORs(projectId) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) return []\n      const { data, error } = await client\n        .from('change_orders')\n        .select('id, cor_number, title, status, cor_total')\n        .eq('project_id', projectId)\n        .in('status', ['draft', 'pending_approval', 'approved'])\n        .order('cor_number', { ascending: true })\n      if (error) throw error\n      return data || []\n    }\n    return []\n  },\n\n  // Get next available COR number for project\n  async getNextCORNumber(projectId) {\n    if (isSupabaseConfigured) {\n      // Get ALL COR numbers for this project to find the highest\n      const { data, error } = await supabase\n        .from('change_orders')\n        .select('cor_number')\n        .eq('project_id', projectId)\n\n      if (error) throw error\n\n      if (data && data.length > 0) {\n        // Extract all numbers and find the maximum\n        let maxNumber = 0\n        for (const cor of data) {\n          const match = cor.cor_number?.match(/COR #(\\d+)/)\n          if (match) {\n            const num = parseInt(match[1])\n            if (num > maxNumber) maxNumber = num\n          }\n        }\n        return `COR #${maxNumber + 1}`\n      }\n      return 'COR #1'\n    }\n    return 'COR #1'\n  },\n\n  // ============================================\n  // COR Line Items - Labor\n  // ============================================\n\n  async addCORLaborItem(corId, laborItem) {\n    if (isSupabaseConfigured) {\n      // Calculate totals\n      const regularTotal = Math.round(laborItem.regular_hours * laborItem.regular_rate)\n      const overtimeTotal = Math.round(laborItem.overtime_hours * laborItem.overtime_rate)\n      const total = regularTotal + overtimeTotal\n\n      const { data, error } = await supabase\n        .from('change_order_labor')\n        .insert({\n          change_order_id: corId,\n          labor_class: laborItem.labor_class,\n          wage_type: laborItem.wage_type || 'standard',\n          regular_hours: laborItem.regular_hours || 0,\n          overtime_hours: laborItem.overtime_hours || 0,\n          regular_rate: laborItem.regular_rate || 0,\n          overtime_rate: laborItem.overtime_rate || 0,\n          regular_total: regularTotal,\n          overtime_total: overtimeTotal,\n          total: total,\n          sort_order: laborItem.sort_order || 0,\n          source_ticket_id: laborItem.source_ticket_id || null\n        })\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async updateCORLaborItem(itemId, updates) {\n    if (isSupabaseConfigured) {\n      // Recalculate totals if hours or rates changed\n      let updateData = { ...updates }\n      if (updates.regular_hours !== undefined || updates.regular_rate !== undefined ||\n          updates.overtime_hours !== undefined || updates.overtime_rate !== undefined) {\n        // Get current values if not provided\n        const { data: current } = await supabase\n          .from('change_order_labor')\n          .select('regular_hours, overtime_hours, regular_rate, overtime_rate')\n          .eq('id', itemId)\n          .single()\n\n        const regHours = updates.regular_hours ?? current?.regular_hours ?? 0\n        const otHours = updates.overtime_hours ?? current?.overtime_hours ?? 0\n        const regRate = updates.regular_rate ?? current?.regular_rate ?? 0\n        const otRate = updates.overtime_rate ?? current?.overtime_rate ?? 0\n\n        updateData.regular_total = Math.round(regHours * regRate)\n        updateData.overtime_total = Math.round(otHours * otRate)\n        updateData.total = updateData.regular_total + updateData.overtime_total\n      }\n\n      const { data, error } = await supabase\n        .from('change_order_labor')\n        .update(updateData)\n        .eq('id', itemId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async deleteCORLaborItem(itemId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('change_order_labor')\n        .delete()\n        .eq('id', itemId)\n      if (error) throw error\n    }\n  },\n\n  // ============================================\n  // COR Line Items - Materials\n  // ============================================\n\n  async addCORMaterialItem(corId, materialItem) {\n    if (isSupabaseConfigured) {\n      const allowedSourceTypes = ['backup_sheet', 'invoice', 'mobilization', 'custom', 'field_ticket', 'rental']\n      const sourceType = allowedSourceTypes.includes(materialItem.source_type) ? materialItem.source_type : 'custom'\n      const unitCost = Math.round(Number(materialItem.unit_cost) || 0)\n      const quantity = Number(materialItem.quantity) || 1\n      const total = Math.round(quantity * unitCost)\n\n      const { data, error } = await supabase\n        .from('change_order_materials')\n        .insert({\n          change_order_id: corId,\n          description: materialItem.description || '',\n          quantity: quantity,\n          unit: materialItem.unit || 'each',\n          unit_cost: unitCost,\n          total: total,\n          source_type: sourceType,\n          source_reference: materialItem.source_reference || null,\n          source_ticket_id: materialItem.source_ticket_id || null,\n          sort_order: materialItem.sort_order || 0\n        })\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async updateCORMaterialItem(itemId, updates) {\n    if (isSupabaseConfigured) {\n      let updateData = { ...updates }\n      if (updates.quantity !== undefined || updates.unit_cost !== undefined) {\n        const { data: current } = await supabase\n          .from('change_order_materials')\n          .select('quantity, unit_cost')\n          .eq('id', itemId)\n          .single()\n\n        const qty = updates.quantity ?? current?.quantity ?? 1\n        const cost = updates.unit_cost ?? current?.unit_cost ?? 0\n        updateData.total = Math.round(qty * cost)\n      }\n\n      const { data, error } = await supabase\n        .from('change_order_materials')\n        .update(updateData)\n        .eq('id', itemId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async deleteCORMaterialItem(itemId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('change_order_materials')\n        .delete()\n        .eq('id', itemId)\n      if (error) throw error\n    }\n  },\n\n  // ============================================\n  // COR Line Items - Equipment\n  // ============================================\n\n  async addCOREquipmentItem(corId, equipmentItem) {\n    if (isSupabaseConfigured) {\n      const allowedSourceTypes = ['backup_sheet', 'invoice', 'custom', 'field_ticket', 'rental']\n      const sourceType = allowedSourceTypes.includes(equipmentItem.source_type) ? equipmentItem.source_type : 'custom'\n      const unitCost = Math.round(Number(equipmentItem.unit_cost) || 0)\n      const quantity = Number(equipmentItem.quantity) || 1\n      const total = Math.round(quantity * unitCost)\n\n      const { data, error } = await supabase\n        .from('change_order_equipment')\n        .insert({\n          change_order_id: corId,\n          description: equipmentItem.description || '',\n          quantity: quantity,\n          unit: equipmentItem.unit || 'day',\n          unit_cost: unitCost,\n          total: total,\n          source_type: sourceType,\n          source_reference: equipmentItem.source_reference || null,\n          source_ticket_id: equipmentItem.source_ticket_id || null,\n          sort_order: equipmentItem.sort_order || 0\n        })\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async updateCOREquipmentItem(itemId, updates) {\n    if (isSupabaseConfigured) {\n      let updateData = { ...updates }\n      if (updates.quantity !== undefined || updates.unit_cost !== undefined) {\n        const { data: current } = await supabase\n          .from('change_order_equipment')\n          .select('quantity, unit_cost')\n          .eq('id', itemId)\n          .single()\n\n        const qty = updates.quantity ?? current?.quantity ?? 1\n        const cost = updates.unit_cost ?? current?.unit_cost ?? 0\n        updateData.total = Math.round(qty * cost)\n      }\n\n      const { data, error } = await supabase\n        .from('change_order_equipment')\n        .update(updateData)\n        .eq('id', itemId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async deleteCOREquipmentItem(itemId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('change_order_equipment')\n        .delete()\n        .eq('id', itemId)\n      if (error) throw error\n    }\n  },\n\n  // ============================================\n  // COR Line Items - Subcontractors\n  // ============================================\n\n  async addCORSubcontractorItem(corId, subItem) {\n    if (isSupabaseConfigured) {\n      const total = Math.round(subItem.quantity * subItem.unit_cost)\n\n      const { data, error } = await supabase\n        .from('change_order_subcontractors')\n        .insert({\n          change_order_id: corId,\n          description: subItem.description,\n          quantity: subItem.quantity || 1,\n          unit: subItem.unit || 'lump sum',\n          unit_cost: subItem.unit_cost || 0,\n          total: total,\n          source_type: subItem.source_type || 'custom',\n          source_reference: subItem.source_reference || null,\n          sort_order: subItem.sort_order || 0\n        })\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async updateCORSubcontractorItem(itemId, updates) {\n    if (isSupabaseConfigured) {\n      let updateData = { ...updates }\n      if (updates.quantity !== undefined || updates.unit_cost !== undefined) {\n        const { data: current } = await supabase\n          .from('change_order_subcontractors')\n          .select('quantity, unit_cost')\n          .eq('id', itemId)\n          .single()\n\n        const qty = updates.quantity ?? current?.quantity ?? 1\n        const cost = updates.unit_cost ?? current?.unit_cost ?? 0\n        updateData.total = Math.round(qty * cost)\n      }\n\n      const { data, error } = await supabase\n        .from('change_order_subcontractors')\n        .update(updateData)\n        .eq('id', itemId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async deleteCORSubcontractorItem(itemId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('change_order_subcontractors')\n        .delete()\n        .eq('id', itemId)\n      if (error) throw error\n    }\n  },\n\n  // ============================================\n  // Bulk Line Item Operations\n  // ============================================\n\n  async addBulkLaborItems(corId, laborItems) {\n    if (isSupabaseConfigured && laborItems.length > 0) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      const items = laborItems.map((item, index) => {\n        const regularTotal = Math.round(item.regular_hours * item.regular_rate)\n        const overtimeTotal = Math.round(item.overtime_hours * item.overtime_rate)\n        return {\n          change_order_id: corId,\n          labor_class: item.labor_class,\n          wage_type: item.wage_type || 'standard',\n          regular_hours: item.regular_hours || 0,\n          overtime_hours: item.overtime_hours || 0,\n          regular_rate: item.regular_rate || 0,\n          overtime_rate: item.overtime_rate || 0,\n          regular_total: regularTotal,\n          overtime_total: overtimeTotal,\n          total: regularTotal + overtimeTotal,\n          sort_order: item.sort_order ?? index,\n          source_ticket_id: item.source_ticket_id || null\n        }\n      })\n\n      const { data, error } = await client\n        .from('change_order_labor')\n        .insert(items)\n        .select()\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  async addBulkMaterialItems(corId, materialItems) {\n    if (isSupabaseConfigured && materialItems.length > 0) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      // Allowed source_type values for materials\n      const allowedSourceTypes = ['backup_sheet', 'invoice', 'mobilization', 'custom', 'field_ticket', 'rental']\n\n      const items = materialItems.map((item, index) => {\n        const sourceType = allowedSourceTypes.includes(item.source_type) ? item.source_type : 'custom'\n        const unitCost = Math.round(Number(item.unit_cost) || 0)\n        const quantity = Number(item.quantity) || 1\n\n        return {\n          change_order_id: corId,\n          description: item.description || '',\n          quantity: quantity,\n          unit: item.unit || 'each',\n          unit_cost: unitCost,\n          total: Math.round(quantity * unitCost),\n          source_type: sourceType,\n          source_reference: item.source_reference || null,\n          source_ticket_id: item.source_ticket_id || null,\n          sort_order: item.sort_order ?? index\n        }\n      })\n\n      const { data, error } = await client\n        .from('change_order_materials')\n        .insert(items)\n        .select()\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  async addBulkEquipmentItems(corId, equipmentItems) {\n    if (isSupabaseConfigured && equipmentItems.length > 0) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      // Allowed source_type values for equipment\n      const allowedSourceTypes = ['backup_sheet', 'invoice', 'custom', 'field_ticket', 'rental']\n\n      const items = equipmentItems.map((item, index) => {\n        const sourceType = allowedSourceTypes.includes(item.source_type) ? item.source_type : 'custom'\n        const unitCost = Math.round(Number(item.unit_cost) || 0)\n        const quantity = Number(item.quantity) || 1\n\n        return {\n          change_order_id: corId,\n          description: item.description || '',\n          quantity: quantity,\n          unit: item.unit || 'day',\n          unit_cost: unitCost,\n          total: Math.round(quantity * unitCost),\n          source_type: sourceType,\n          source_reference: item.source_reference || null,\n          source_ticket_id: item.source_ticket_id || null,\n          sort_order: item.sort_order ?? index\n        }\n      })\n\n      const { data, error } = await client\n        .from('change_order_equipment')\n        .insert(items)\n        .select()\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  async addBulkSubcontractorItems(corId, subItems) {\n    if (isSupabaseConfigured && subItems.length > 0) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      // Build items - requires migration_complete_fixes.sql for company_name column\n      const items = subItems.map((item, index) => ({\n        change_order_id: corId,\n        company_name: item.company_name || '',\n        description: item.description || '',\n        quantity: item.quantity || 1,\n        unit: item.unit || 'lump sum',\n        unit_cost: item.unit_cost || item.total || item.amount || 0,\n        total: item.total || item.amount || 0,\n        source_type: item.source_type || 'invoice',\n        source_reference: item.source_reference || null,\n        sort_order: item.sort_order ?? index\n      }))\n\n      const { data, error } = await client\n        .from('change_order_subcontractors')\n        .insert(items)\n        .select()\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  // Clear all line items for a COR (used when replacing items during update)\n  async clearCORLineItems(corId) {\n    if (!isSupabaseConfigured) return\n\n    const client = getClient()\n    if (!client) {\n      throw new Error('Database client not available')\n    }\n\n    try {\n      // Delete all line items for this COR in parallel\n      const results = await Promise.all([\n        client.from('change_order_labor').delete().eq('change_order_id', corId),\n        client.from('change_order_materials').delete().eq('change_order_id', corId),\n        client.from('change_order_equipment').delete().eq('change_order_id', corId),\n        client.from('change_order_subcontractors').delete().eq('change_order_id', corId)\n      ])\n\n      // Check for any errors\n      for (const result of results) {\n        if (result.error) {\n          throw result.error\n        }\n      }\n    } catch (error) {\n      console.error('Error clearing COR line items:', error)\n      throw error\n    }\n  },\n\n  // Save all line items for a COR (clears existing and adds new)\n  async saveCORLineItems(corId, { laborItems, materialItems, equipmentItems, subcontractorItems }) {\n    if (isSupabaseConfigured) {\n      // Clear existing line items first\n      await this.clearCORLineItems(corId)\n\n      // Add new line items\n      const results = await Promise.all([\n        laborItems?.length > 0 ? this.addBulkLaborItems(corId, laborItems) : [],\n        materialItems?.length > 0 ? this.addBulkMaterialItems(corId, materialItems) : [],\n        equipmentItems?.length > 0 ? this.addBulkEquipmentItems(corId, equipmentItems) : [],\n        subcontractorItems?.length > 0 ? this.addBulkSubcontractorItems(corId, subcontractorItems) : []\n      ])\n\n      return {\n        labor: results[0],\n        materials: results[1],\n        equipment: results[2],\n        subcontractors: results[3]\n      }\n    }\n    return null\n  },\n\n  // ============================================\n  // Ticket-COR Associations (Atomic Operations)\n  // ============================================\n\n  async assignTicketToCOR(ticketId, corId) {\n    if (isSupabaseConfigured) {\n      // Use atomic database function to ensure both junction table and FK stay in sync\n      const { error } = await supabase.rpc('assign_ticket_to_cor', {\n        p_ticket_id: ticketId,\n        p_cor_id: corId\n      })\n      if (error) {\n        observe.error('database', { message: error.message, operation: 'assignTicketToCOR', extra: { ticketId, corId } })\n        throw error\n      }\n      return { ticket_id: ticketId, change_order_id: corId }\n    }\n    return null\n  },\n\n  async unassignTicketFromCOR(ticketId, corId) {\n    if (isSupabaseConfigured) {\n      // Use atomic database function to ensure both junction table and FK stay in sync\n      const { error } = await supabase.rpc('unassign_ticket_from_cor', {\n        p_ticket_id: ticketId,\n        p_cor_id: corId\n      })\n      if (error) {\n        observe.error('database', { message: error.message, operation: 'unassignTicketFromCOR', extra: { ticketId, corId } })\n        throw error\n      }\n    }\n  },\n\n  // Check for data integrity issues between dual associations\n  async checkTicketCORIntegrity() {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase.rpc('check_ticket_cor_integrity')\n      if (error) throw error\n      return data || []\n    }\n    return []\n  },\n\n  // Fix any existing data integrity issues\n  async fixTicketCORIntegrity() {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase.rpc('fix_ticket_cor_integrity')\n      if (error) throw error\n      return data\n    }\n    return 0\n  },\n\n  async getTicketsForCOR(corId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_order_ticket_associations')\n        .select(`\n          *,\n          t_and_m_tickets (\n            *,\n            t_and_m_workers (*),\n            t_and_m_items (\n              *,\n              materials_equipment (name, unit, cost_per_unit, category)\n            )\n          )\n        `)\n        .eq('change_order_id', corId)\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  async getUnassignedTickets(projectId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('t_and_m_tickets')\n        .select(`\n          *,\n          t_and_m_workers (*),\n          t_and_m_items (\n            *,\n            materials_equipment (name, unit, cost_per_unit, category)\n          )\n        `)\n        .eq('project_id', projectId)\n        .is('assigned_cor_id', null)\n        .order('work_date', { ascending: false })\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  async importTicketDataToCOR(ticketId, corId, companyId, workType, jobType) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      // 1. Get ticket with workers and items\n      const { data: ticket, error: ticketError } = await client\n        .from('t_and_m_tickets')\n        .select(`\n          *,\n          t_and_m_workers (*),\n          t_and_m_items (\n            *,\n            materials_equipment (name, unit, cost_per_unit, category)\n          )\n        `)\n        .eq('id', ticketId)\n        .single()\n      if (ticketError) throw ticketError\n\n      // 2. Get labor rates for this company/work type/job type\n      const { data: rates, error: ratesError } = await client\n        .from('labor_rates')\n        .select('*')\n        .eq('company_id', companyId)\n        .eq('work_type', workType || 'demolition')\n        .eq('job_type', jobType || 'standard')\n      if (ratesError) throw ratesError\n\n      // Create rate lookup\n      const rateLookup = {}\n      rates?.forEach(rate => {\n        rateLookup[rate.role.toLowerCase()] = rate\n      })\n\n      // 3. Group workers by role and sum hours\n      const laborByRole = {}\n      ticket.t_and_m_workers?.forEach(worker => {\n        const role = (worker.role || 'laborer').toLowerCase()\n        if (!laborByRole[role]) {\n          laborByRole[role] = { regular_hours: 0, overtime_hours: 0 }\n        }\n        laborByRole[role].regular_hours += parseFloat(worker.hours) || 0\n        laborByRole[role].overtime_hours += parseFloat(worker.overtime_hours) || 0\n      })\n\n      // 4. Create labor items\n      const laborItems = Object.entries(laborByRole).map(([role, hours]) => {\n        const rate = rateLookup[role] || { regular_rate: 0, overtime_rate: 0 }\n        // Convert dollar rates to cents\n        const regRate = Math.round((parseFloat(rate.regular_rate) || 0) * 100)\n        const otRate = Math.round((parseFloat(rate.overtime_rate) || 0) * 100)\n        return {\n          labor_class: role.charAt(0).toUpperCase() + role.slice(1),\n          wage_type: jobType || 'standard',\n          regular_hours: hours.regular_hours,\n          overtime_hours: hours.overtime_hours,\n          regular_rate: regRate,\n          overtime_rate: otRate,\n          source_ticket_id: ticketId\n        }\n      })\n\n      if (laborItems.length > 0) {\n        await this.addBulkLaborItems(corId, laborItems)\n      }\n\n      // 5. Get materials/equipment from t_and_m_items\n      const materialItems = []\n      const equipmentItems = []\n\n      ticket.t_and_m_items?.forEach(item => {\n        const name = item.custom_name || item.materials_equipment?.name || 'Unknown Item'\n        const category = item.custom_category || item.materials_equipment?.category || 'Other'\n        const unit = item.materials_equipment?.unit || 'each'\n        // Convert dollar cost to cents\n        const unitCost = Math.round((parseFloat(item.materials_equipment?.cost_per_unit) || 0) * 100)\n\n        const lineItem = {\n          description: name,\n          quantity: item.quantity || 1,\n          unit: unit,\n          unit_cost: unitCost,\n          source_type: 'backup_sheet',\n          source_ticket_id: ticketId\n        }\n\n        if (category === 'Equipment') {\n          equipmentItems.push(lineItem)\n        } else {\n          materialItems.push(lineItem)\n        }\n      })\n\n      if (materialItems.length > 0) {\n        await this.addBulkMaterialItems(corId, materialItems)\n      }\n      if (equipmentItems.length > 0) {\n        await this.addBulkEquipmentItems(corId, equipmentItems)\n      }\n\n      // 6. Mark association as data_imported and import_status completed\n      const { error: updateError } = await client\n        .from('change_order_ticket_associations')\n        .update({\n          data_imported: true,\n          imported_at: new Date().toISOString(),\n          import_status: 'completed',\n          import_failed_at: null,\n          import_error: null\n        })\n        .eq('change_order_id', corId)\n        .eq('ticket_id', ticketId)\n      if (updateError) throw updateError\n\n      observe.activity('cor_import_success', { ticket_id: ticketId, cor_id: corId, labor_count: laborItems.length, material_count: materialItems.length, equipment_count: equipmentItems.length })\n      return { laborItems, materialItems, equipmentItems }\n    }\n    return null\n  },\n\n  async reimportTicketDataToCOR(ticketId, corId, companyId, workType, jobType) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      // Delete existing line items from this ticket\n      await client\n        .from('change_order_labor')\n        .delete()\n        .eq('change_order_id', corId)\n        .eq('source_ticket_id', ticketId)\n\n      await client\n        .from('change_order_materials')\n        .delete()\n        .eq('change_order_id', corId)\n        .eq('source_ticket_id', ticketId)\n\n      await client\n        .from('change_order_equipment')\n        .delete()\n        .eq('change_order_id', corId)\n        .eq('source_ticket_id', ticketId)\n\n      // Re-import fresh data\n      return this.importTicketDataToCOR(ticketId, corId, companyId, workType, jobType)\n    }\n    return null\n  },\n\n  // Mark a ticket import as failed (for retry tracking)\n  async markImportFailed(ticketId, corId, errorMessage = 'Import failed') {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      const { error } = await client\n        .from('change_order_ticket_associations')\n        .update({\n          import_status: 'failed',\n          import_failed_at: new Date().toISOString(),\n          import_error: errorMessage\n        })\n        .eq('change_order_id', corId)\n        .eq('ticket_id', ticketId)\n      if (error) {\n        observe.error('database', { message: error.message, operation: 'markImportFailed', extra: { ticketId, corId } })\n        throw error\n      }\n      observe.error('cor_import_failed', { ticket_id: ticketId, cor_id: corId, error: errorMessage })\n    }\n  },\n\n  // Get tickets with failed imports for a project (for retry UI)\n  async getTicketsNeedingImport(projectId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('t_and_m_tickets')\n        .select(`\n          id,\n          work_date,\n          ce_pco_number,\n          assigned_cor_id,\n          change_order_ticket_associations!inner (\n            change_order_id,\n            import_status,\n            import_failed_at,\n            import_error\n          )\n        `)\n        .eq('project_id', projectId)\n        .eq('change_order_ticket_associations.import_status', 'failed')\n      if (error) throw error\n      return data || []\n    }\n    return []\n  },\n\n  // Get import status for a specific ticket-COR association\n  async getTicketImportStatus(ticketId, corId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_order_ticket_associations')\n        .select('import_status, import_failed_at, import_error, data_imported')\n        .eq('ticket_id', ticketId)\n        .eq('change_order_id', corId)\n        .single()\n      if (error && error.code !== 'PGRST116') throw error // PGRST116 = no rows\n      return data\n    }\n    return null\n  },\n\n  // ============================================\n  // COR Calculations\n  // ============================================\n\n  async recalculateCOR(corId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase.rpc('recalculate_cor_totals', { cor_id: corId })\n      if (error) throw error\n\n      // Return updated COR\n      return this.getCORById(corId)\n    }\n    return null\n  },\n\n  async updateCORMarkupPercentages(corId, percentages) {\n    if (isSupabaseConfigured) {\n      const updates = {}\n      if (percentages.labor !== undefined) updates.labor_markup_percent = percentages.labor\n      if (percentages.materials !== undefined) updates.materials_markup_percent = percentages.materials\n      if (percentages.equipment !== undefined) updates.equipment_markup_percent = percentages.equipment\n      if (percentages.subcontractors !== undefined) updates.subcontractors_markup_percent = percentages.subcontractors\n\n      const { data, error } = await supabase\n        .from('change_orders')\n        .update(updates)\n        .eq('id', corId)\n        .select()\n        .single()\n      if (error) throw error\n\n      // Trigger recalculation happens via database trigger\n      return data\n    }\n    return null\n  },\n\n  async updateCORFeePercentages(corId, percentages) {\n    if (isSupabaseConfigured) {\n      const updates = {}\n      if (percentages.liabilityInsurance !== undefined) updates.liability_insurance_percent = percentages.liabilityInsurance\n      if (percentages.bond !== undefined) updates.bond_percent = percentages.bond\n      if (percentages.licenseFee !== undefined) updates.license_fee_percent = percentages.licenseFee\n\n      const { data, error } = await supabase\n        .from('change_orders')\n        .update(updates)\n        .eq('id', corId)\n        .select()\n        .single()\n      if (error) throw error\n\n      // Trigger recalculation happens via database trigger\n      return data\n    }\n    return null\n  },\n\n  // ============================================\n  // COR Status & Workflow\n  // ============================================\n\n  async submitCORForApproval(corId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_orders')\n        .update({\n          status: 'pending_approval',\n          submitted_at: new Date().toISOString()\n        })\n        .eq('id', corId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async approveCOR(corId, userId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_orders')\n        .update({\n          status: 'approved',\n          approved_by: userId,\n          approved_at: new Date().toISOString()\n        })\n        .eq('id', corId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async rejectCOR(corId, reason = null) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_orders')\n        .update({\n          status: 'rejected',\n          rejection_reason: reason\n        })\n        .eq('id', corId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async markCORAsBilled(corId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_orders')\n        .update({ status: 'billed' })\n        .eq('id', corId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async closeCOR(corId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_orders')\n        .update({ status: 'closed' })\n        .eq('id', corId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async saveCORSignature(corId, signatureData, signerName) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_orders')\n        .update({\n          gc_signature_data: signatureData,\n          gc_signature_name: signerName,\n          gc_signature_date: new Date().toISOString(),\n          status: 'approved' // Auto-approve when signed\n        })\n        .eq('id', corId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // ============================================\n  // COR Stats & Analytics\n  // ============================================\n\n  async getCORStats(projectId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_orders')\n        .select('status, cor_total')\n        .eq('project_id', projectId)\n\n      if (error) throw error\n\n      const stats = {\n        total_cors: data.length,\n        draft_count: 0,\n        pending_count: 0,\n        approved_count: 0,\n        rejected_count: 0,\n        billed_count: 0,\n        total_approved_value: 0,\n        total_pending_value: 0,\n        total_billed_value: 0\n      }\n\n      data.forEach(cor => {\n        switch (cor.status) {\n          case 'draft':\n            stats.draft_count++\n            break\n          case 'pending_approval':\n            stats.pending_count++\n            stats.total_pending_value += cor.cor_total || 0\n            break\n          case 'approved':\n            stats.approved_count++\n            stats.total_approved_value += cor.cor_total || 0\n            break\n          case 'rejected':\n            stats.rejected_count++\n            break\n          case 'billed':\n          case 'closed':\n            stats.billed_count++\n            stats.total_billed_value += cor.cor_total || 0\n            break\n        }\n      })\n\n      return stats\n    }\n    return {\n      total_cors: 0,\n      draft_count: 0,\n      pending_count: 0,\n      approved_count: 0,\n      rejected_count: 0,\n      billed_count: 0,\n      total_approved_value: 0,\n      total_pending_value: 0,\n      total_billed_value: 0\n    }\n  },\n\n  // Subscribe to COR updates for a project\n  subscribeToCORs(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`change_orders:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'change_orders', filter: `project_id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to T&M ticket associations for a specific COR\n  // Fires when tickets are added to or removed from a COR\n  subscribeToCorTickets(corId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`cor-tickets:${corId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'change_order_ticket_associations', filter: `change_order_id=eq.${corId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // ============================================\n  // COR Log Functions\n  // ============================================\n\n  // Get COR Log entries with joined COR data for a project\n  async getCORLog(projectId) {\n    if (isSupabaseConfigured) {\n      // Direct query with join to avoid RPC type issues\n      const { data, error } = await supabase\n        .from('cor_log_entries')\n        .select(`\n          id,\n          log_number,\n          date_sent_to_client,\n          ce_number,\n          comments,\n          created_at,\n          updated_at,\n          change_order:change_orders (\n            id,\n            cor_number,\n            title,\n            cor_total,\n            status,\n            created_at,\n            approved_at,\n            approved_by\n          )\n        `)\n        .eq('project_id', projectId)\n        .order('log_number', { ascending: true })\n\n      if (error) {\n        console.error('Error fetching COR log:', error)\n        throw error\n      }\n\n      // Transform to match expected format\n      return (data || []).map(row => ({\n        id: row.id,\n        logNumber: row.log_number,\n        dateSentToClient: row.date_sent_to_client,\n        ceNumber: row.ce_number,\n        comments: row.comments,\n        createdAt: row.created_at,\n        updatedAt: row.updated_at,\n        changeOrder: {\n          id: row.change_order?.id,\n          corNumber: row.change_order?.cor_number,\n          title: row.change_order?.title,\n          corTotal: row.change_order?.cor_total,\n          status: row.change_order?.status,\n          createdAt: row.change_order?.created_at,\n          approvedAt: row.change_order?.approved_at,\n          approvedBy: row.change_order?.approved_by\n        }\n      }))\n    }\n    return []\n  },\n\n  // Update user-editable COR Log entry fields\n  async updateCORLogEntry(entryId, updates) {\n    if (isSupabaseConfigured) {\n      const updateData = {\n        updated_at: new Date().toISOString()\n      }\n\n      // Only include fields that are provided\n      if (updates.dateSentToClient !== undefined) {\n        updateData.date_sent_to_client = updates.dateSentToClient || null\n      }\n      if (updates.ceNumber !== undefined) {\n        updateData.ce_number = updates.ceNumber || null\n      }\n      if (updates.comments !== undefined) {\n        updateData.comments = updates.comments || null\n      }\n\n      const { data, error } = await supabase\n        .from('cor_log_entries')\n        .update(updateData)\n        .eq('id', entryId)\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error updating COR log entry:', error)\n        throw error\n      }\n\n      return data\n    }\n    return null\n  },\n\n  // Update change order status\n  async updateChangeOrderStatus(changeOrderId, status) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('change_orders')\n        .update({\n          status: status,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', changeOrderId)\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error updating change order status:', error)\n        throw error\n      }\n\n      return data\n    }\n    return null\n  },\n\n  // Subscribe to COR log changes for a project\n  subscribeToCORLog(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`cor-log:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'cor_log_entries', filter: `project_id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to document changes for a project\n  // Fires when documents are uploaded, updated, or archived\n  subscribeToDocuments(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`documents:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'documents', filter: `project_id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to document folder changes for a project\n  subscribeToDocumentFolders(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`document_folders:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'document_folders', filter: `project_id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to materials/equipment changes for a company\n  subscribeToMaterialsEquipment(companyId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`materials_equipment:${companyId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'materials_equipment', filter: `company_id=eq.${companyId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to labor rate changes for a company\n  subscribeToLaborRates(companyId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`labor_rates:${companyId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'labor_rates', filter: `company_id=eq.${companyId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to project-level changes (name, dates, budget, etc.)\n  subscribeToProject(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`project:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'projects', filter: `id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // ============================================\n  // Signature Workflow Functions\n  // ============================================\n\n  // Create a signature request for a document (COR or T&M)\n  async createSignatureRequest(documentType, documentId, companyId, projectId, createdBy = null, expiresAt = null) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      // Generate a unique token using the database function\n      const { data: tokenResult, error: tokenError } = await client.rpc('generate_signature_token')\n      if (tokenError) throw tokenError\n\n      const { data, error } = await client\n        .from('signature_requests')\n        .insert({\n          document_type: documentType,\n          document_id: documentId,\n          company_id: companyId,\n          project_id: projectId,\n          signature_token: tokenResult,\n          expires_at: expiresAt,\n          created_by: createdBy\n        })\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Get signature request by token (for public signing page)\n  async getSignatureRequestByToken(token) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      // Increment view count\n      await client.rpc('increment_signature_view_count', { token })\n\n      const { data, error } = await client\n        .from('signature_requests')\n        .select(`\n          *,\n          signatures (*)\n        `)\n        .eq('signature_token', token)\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Get all signature requests for a document\n  async getSignatureRequestsForDocument(documentType, documentId) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      const { data, error } = await client\n        .from('signature_requests')\n        .select(`\n          *,\n          signatures (*)\n        `)\n        .eq('document_type', documentType)\n        .eq('document_id', documentId)\n        .order('created_at', { ascending: false })\n      if (error) throw error\n      return data || []\n    }\n    return []\n  },\n\n  // Add a signature to a request\n  async addSignature(requestId, slot, signatureData) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      const { data, error } = await client\n        .from('signatures')\n        .insert({\n          signature_request_id: requestId,\n          signature_slot: slot,\n          signature_image: signatureData.signature,\n          signer_name: signatureData.signerName,\n          signer_title: signatureData.signerTitle || null,\n          signer_company: signatureData.signerCompany || null,\n          signed_at: signatureData.signedAt || new Date().toISOString(),\n          ip_address: signatureData.ipAddress || null,\n          user_agent: signatureData.userAgent || null\n        })\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Sync signature to the main document table (COR or T&M)\n  async syncSignatureToDocument(signature, signatureRequest) {\n    if (!isSupabaseConfigured) return null\n\n    const client = getClient()\n    if (!client) {\n      throw new Error('Database client not available')\n    }\n\n    const { document_type, document_id } = signatureRequest\n    const slot = signature.signature_slot\n\n    // Build update object based on slot\n    const updates = {}\n    if (slot === 1) {\n      // GC signature\n      updates.gc_signature_data = signature.signature_image\n      updates.gc_signature_name = signature.signer_name\n      updates.gc_signature_title = signature.signer_title\n      updates.gc_signature_company = signature.signer_company\n      updates.gc_signature_date = signature.signed_at\n      updates.gc_signature_ip = signature.ip_address\n    } else if (slot === 2) {\n      // Client signature\n      updates.client_signature_data = signature.signature_image\n      updates.client_signature_name = signature.signer_name\n      updates.client_signature_title = signature.signer_title\n      updates.client_signature_company = signature.signer_company\n      updates.client_signature_date = signature.signed_at\n      updates.client_signature_ip = signature.ip_address\n    }\n\n    const tableName = document_type === 'cor' ? 'change_orders' : 't_and_m_tickets'\n    const { data, error } = await client\n      .from(tableName)\n      .update(updates)\n      .eq('id', document_id)\n      .select()\n      .single()\n    if (error) throw error\n    return data\n  },\n\n  // Revoke a signature request\n  async revokeSignatureRequest(requestId) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n\n      const { data, error } = await client\n        .from('signature_requests')\n        .update({ status: 'revoked' })\n        .eq('id', requestId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Get document data for signature page (COR or T&M with project info)\n  async getDocumentForSigning(documentType, documentId) {\n    if (!isSupabaseConfigured) return null\n\n    const client = getClient()\n    if (!client) {\n      throw new Error('Database client not available')\n    }\n\n    if (documentType === 'cor') {\n      const { data, error } = await client\n        .from('change_orders')\n        .select(`\n          *,\n          projects (\n            id,\n            name,\n            job_number,\n            companies (\n              id,\n              name,\n              logo_url\n            )\n          ),\n          change_order_labor (*),\n          change_order_materials (*),\n          change_order_equipment (*),\n          change_order_subcontractors (*)\n        `)\n        .eq('id', documentId)\n        .single()\n      if (error) throw error\n      return data\n    } else if (documentType === 'tm_ticket') {\n      const { data, error } = await client\n        .from('t_and_m_tickets')\n        .select(`\n          *,\n          projects (\n            id,\n            name,\n            job_number,\n            companies (\n              id,\n              name,\n              logo_url\n            )\n          ),\n          t_and_m_workers (*),\n          t_and_m_items (\n            *,\n            materials_equipment (\n              id,\n              name,\n              unit,\n              cost_per_unit,\n              category\n            )\n          )\n        `)\n        .eq('id', documentId)\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // ============================================\n  // Project Costs (Custom Cost Contributors)\n  // ============================================\n\n  // Get all custom costs for a project\n  async getProjectCosts(projectId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('project_costs')\n        .select('*')\n        .eq('project_id', projectId)\n        .order('cost_date', { ascending: false })\n      if (error) {\n        console.error('Error fetching project costs:', error)\n        return []\n      }\n      return data || []\n    }\n    // Demo mode\n    const localData = getLocalData()\n    return (localData.projectCosts || [])\n      .filter(c => c.project_id === projectId)\n      .sort((a, b) => new Date(b.cost_date) - new Date(a.cost_date))\n  },\n\n  // Add a new custom cost\n  async addProjectCost(projectId, companyId, costData) {\n    const cost = {\n      project_id: projectId,\n      company_id: companyId,\n      category: costData.category,\n      description: costData.description,\n      amount: parseFloat(costData.amount),\n      cost_date: costData.cost_date || new Date().toISOString().split('T')[0],\n      notes: costData.notes || null,\n      created_by: costData.created_by || null\n    }\n\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('project_costs')\n        .insert(cost)\n        .select()\n        .single()\n      if (error) {\n        console.error('Error adding project cost:', error)\n        throw error\n      }\n      return data\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.projectCosts) localData.projectCosts = []\n    const newCost = {\n      ...cost,\n      id: crypto.randomUUID(),\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString()\n    }\n    localData.projectCosts.push(newCost)\n    setLocalData(localData)\n    return newCost\n  },\n\n  // Update an existing cost\n  async updateProjectCost(costId, costData) {\n    const updates = {\n      category: costData.category,\n      description: costData.description,\n      amount: parseFloat(costData.amount),\n      cost_date: costData.cost_date,\n      notes: costData.notes || null,\n      updated_at: new Date().toISOString()\n    }\n\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('project_costs')\n        .update(updates)\n        .eq('id', costId)\n        .select()\n        .single()\n      if (error) {\n        console.error('Error updating project cost:', error)\n        throw error\n      }\n      return data\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.projectCosts) return null\n    const index = localData.projectCosts.findIndex(c => c.id === costId)\n    if (index === -1) return null\n    localData.projectCosts[index] = { ...localData.projectCosts[index], ...updates }\n    setLocalData(localData)\n    return localData.projectCosts[index]\n  },\n\n  // Delete a cost\n  async deleteProjectCost(costId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('project_costs')\n        .delete()\n        .eq('id', costId)\n      if (error) {\n        console.error('Error deleting project cost:', error)\n        throw error\n      }\n      return true\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.projectCosts) return true\n    localData.projectCosts = localData.projectCosts.filter(c => c.id !== costId)\n    setLocalData(localData)\n    return true\n  },\n\n  // Get costs summary aggregated by category\n  async getProjectCostsSummary(projectId) {\n    const costs = await this.getProjectCosts(projectId)\n\n    const byCategory = {}\n    let totalCost = 0\n\n    costs.forEach(cost => {\n      const amount = parseFloat(cost.amount) || 0\n      totalCost += amount\n\n      if (!byCategory[cost.category]) {\n        byCategory[cost.category] = {\n          category: cost.category,\n          total: 0,\n          count: 0,\n          items: []\n        }\n      }\n      byCategory[cost.category].total += amount\n      byCategory[cost.category].count++\n      byCategory[cost.category].items.push(cost)\n    })\n\n    // Calculate percentages\n    Object.values(byCategory).forEach(cat => {\n      cat.percentage = totalCost > 0 ? (cat.total / totalCost) * 100 : 0\n    })\n\n    return {\n      totalCost,\n      byCategory,\n      itemCount: costs.length\n    }\n  },\n\n  // ============================================\n  // Invoices\n  // ============================================\n\n  // Get next invoice number for a company\n  async getNextInvoiceNumber(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase.rpc('get_next_invoice_number', {\n        p_company_id: companyId\n      })\n      if (error) {\n        console.error('Error getting next invoice number:', error)\n        // Fallback: generate locally\n        return this._generateLocalInvoiceNumber(companyId)\n      }\n      return data\n    }\n    return this._generateLocalInvoiceNumber(companyId)\n  },\n\n  async _generateLocalInvoiceNumber(companyId) {\n    const invoices = await this.getCompanyInvoices(companyId)\n    const maxNum = invoices.reduce((max, inv) => {\n      const match = inv.invoice_number?.match(/^INV-(\\d+)$/)\n      if (match) {\n        const num = parseInt(match[1], 10)\n        return num > max ? num : max\n      }\n      return max\n    }, 0)\n    return `INV-${String(maxNum + 1).padStart(4, '0')}`\n  },\n\n  // Get billable items for a project (approved CORs and T&M not yet billed)\n  async getBillableItems(projectId) {\n    if (isSupabaseConfigured) {\n      // Get approved CORs that haven't been billed\n      const { data: cors, error: corsError } = await supabase\n        .from('change_orders')\n        .select('id, cor_number, title, cor_total, status, approved_at')\n        .eq('project_id', projectId)\n        .eq('status', 'approved')\n        .order('cor_number', { ascending: true })\n\n      if (corsError) {\n        console.error('Error fetching billable CORs:', corsError)\n      }\n\n      // Get approved T&M tickets with client signature that haven't been billed\n      const { data: tickets, error: ticketsError } = await supabase\n        .from('t_and_m_tickets')\n        .select('id, work_date, ce_pco_number, change_order_value, status, client_signature_date')\n        .eq('project_id', projectId)\n        .eq('status', 'approved')\n        .not('client_signature_data', 'is', null)\n        .order('work_date', { ascending: true })\n\n      if (ticketsError) {\n        console.error('Error fetching billable T&M tickets:', ticketsError)\n      }\n\n      return {\n        cors: cors || [],\n        tickets: tickets || []\n      }\n    }\n    // Demo mode\n    return { cors: [], tickets: [] }\n  },\n\n  // Get all invoices for a project\n  async getProjectInvoices(projectId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('invoices')\n        .select(`\n          *,\n          invoice_items (*)\n        `)\n        .eq('project_id', projectId)\n        .order('invoice_date', { ascending: false })\n\n      if (error) {\n        console.error('Error fetching project invoices:', error)\n        throw error\n      }\n      return data || []\n    }\n    // Demo mode\n    const localData = getLocalData()\n    return (localData.invoices || []).filter(i => i.project_id === projectId)\n  },\n\n  // Get all invoices for a company\n  async getCompanyInvoices(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('invoices')\n        .select('*')\n        .eq('company_id', companyId)\n        .order('invoice_date', { ascending: false })\n\n      if (error) {\n        console.error('Error fetching company invoices:', error)\n        throw error\n      }\n      return data || []\n    }\n    // Demo mode\n    const localData = getLocalData()\n    return (localData.invoices || []).filter(i => i.company_id === companyId)\n  },\n\n  // Create a new invoice with line items\n  async createInvoice(invoice, items) {\n    if (isSupabaseConfigured) {\n      // Start by creating the invoice\n      const { data: invoiceData, error: invoiceError } = await supabase\n        .from('invoices')\n        .insert({\n          project_id: invoice.project_id,\n          company_id: invoice.company_id,\n          invoice_number: invoice.invoice_number,\n          invoice_date: invoice.invoice_date,\n          due_date: invoice.due_date,\n          status: invoice.status || 'draft',\n          retention_percent: invoice.retention_percent || 0,\n          bill_to_name: invoice.bill_to_name,\n          bill_to_address: invoice.bill_to_address,\n          bill_to_contact: invoice.bill_to_contact,\n          notes: invoice.notes,\n          terms: invoice.terms || 'Net 30',\n          created_by: invoice.created_by\n        })\n        .select()\n        .single()\n\n      if (invoiceError) {\n        console.error('Error creating invoice:', invoiceError)\n        throw invoiceError\n      }\n\n      // Now add line items\n      if (items && items.length > 0) {\n        const itemsToInsert = items.map((item, index) => ({\n          invoice_id: invoiceData.id,\n          item_type: item.item_type,\n          reference_id: item.reference_id,\n          reference_number: item.reference_number,\n          description: item.description,\n          amount: item.amount,\n          sort_order: index\n        }))\n\n        const { error: itemsError } = await supabase\n          .from('invoice_items')\n          .insert(itemsToInsert)\n\n        if (itemsError) {\n          console.error('Error creating invoice items:', itemsError)\n          // Delete the invoice if items failed\n          await supabase.from('invoices').delete().eq('id', invoiceData.id)\n          throw itemsError\n        }\n      }\n\n      // Fetch the complete invoice with items\n      return this.getInvoice(invoiceData.id)\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.invoices) localData.invoices = []\n    const newInvoice = {\n      ...invoice,\n      id: generateTempId(),\n      created_at: new Date().toISOString(),\n      invoice_items: items || []\n    }\n    localData.invoices.push(newInvoice)\n    setLocalData(localData)\n    return newInvoice\n  },\n\n  // Get a single invoice by ID\n  async getInvoice(invoiceId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('invoices')\n        .select(`\n          *,\n          invoice_items (*)\n        `)\n        .eq('id', invoiceId)\n        .single()\n\n      if (error) {\n        console.error('Error fetching invoice:', error)\n        throw error\n      }\n      return data\n    }\n    // Demo mode\n    const localData = getLocalData()\n    return (localData.invoices || []).find(i => i.id === invoiceId)\n  },\n\n  // Update invoice\n  async updateInvoice(invoiceId, updates) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('invoices')\n        .update(updates)\n        .eq('id', invoiceId)\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error updating invoice:', error)\n        throw error\n      }\n      return data\n    }\n    // Demo mode\n    const localData = getLocalData()\n    const index = (localData.invoices || []).findIndex(i => i.id === invoiceId)\n    if (index >= 0) {\n      localData.invoices[index] = { ...localData.invoices[index], ...updates }\n      setLocalData(localData)\n      return localData.invoices[index]\n    }\n    return null\n  },\n\n  // Mark invoice as sent\n  async markInvoiceSent(invoiceId) {\n    return this.updateInvoice(invoiceId, {\n      status: 'sent',\n      sent_at: new Date().toISOString()\n    })\n  },\n\n  // Record payment on invoice\n  async recordInvoicePayment(invoiceId, paymentAmount) {\n    const invoice = await this.getInvoice(invoiceId)\n    if (!invoice) throw new Error('Invoice not found')\n\n    const newAmountPaid = (invoice.amount_paid || 0) + paymentAmount\n    const isPaidInFull = newAmountPaid >= invoice.total\n\n    return this.updateInvoice(invoiceId, {\n      amount_paid: newAmountPaid,\n      status: isPaidInFull ? 'paid' : 'partial',\n      paid_at: isPaidInFull ? new Date().toISOString() : null\n    })\n  },\n\n  // Delete invoice (only draft invoices)\n  async deleteInvoice(invoiceId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('invoices')\n        .delete()\n        .eq('id', invoiceId)\n        .eq('status', 'draft') // RLS also enforces this\n\n      if (error) {\n        console.error('Error deleting invoice:', error)\n        throw error\n      }\n      return true\n    }\n    // Demo mode\n    const localData = getLocalData()\n    localData.invoices = (localData.invoices || []).filter(i => i.id !== invoiceId)\n    setLocalData(localData)\n    return true\n  },\n\n  // Mark CORs and T&M tickets as billed after creating invoice\n  async markItemsBilled(corIds = [], tmIds = []) {\n    if (isSupabaseConfigured) {\n      // Update CORs to 'billed' status\n      if (corIds.length > 0) {\n        const { error: corsError } = await supabase\n          .from('change_orders')\n          .update({ status: 'billed' })\n          .in('id', corIds)\n\n        if (corsError) {\n          console.error('Error marking CORs as billed:', corsError)\n        }\n      }\n\n      // Update T&M tickets to 'billed' status\n      if (tmIds.length > 0) {\n        const { error: tmError } = await supabase\n          .from('t_and_m_tickets')\n          .update({ status: 'billed' })\n          .in('id', tmIds)\n\n        if (tmError) {\n          console.error('Error marking T&M tickets as billed:', tmError)\n        }\n      }\n    }\n  },\n}\n","// Equipment tracking operations\n// Extracted from supabase.js for maintainability\n\nimport { supabase, isSupabaseConfigured } from './supabaseClient'\n\nexport const equipmentOps = {\n  // ----------------------------------------\n  // Equipment Catalog (Company-level)\n  // ----------------------------------------\n\n  /**\n   * Get all equipment in company catalog\n   */\n  async getCompanyEquipment(companyId, activeOnly = true) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return []\n    }\n\n    let query = supabase\n      .from('equipment')\n      .select('*')\n      .eq('company_id', companyId)\n      .order('name')\n\n    if (activeOnly) {\n      query = query.eq('is_active', true)\n    }\n\n    const { data, error } = await query\n\n    if (error) {\n      console.error('Error fetching company equipment:', error)\n      return []\n    }\n\n    return data || []\n  },\n\n  /**\n   * Create equipment in company catalog\n   */\n  async createEquipment(equipment) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return null\n    }\n\n    const { data, error } = await supabase\n      .from('equipment')\n      .insert(equipment)\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Error creating equipment:', error)\n      throw error\n    }\n\n    return data\n  },\n\n  /**\n   * Update equipment in catalog\n   */\n  async updateEquipment(equipmentId, updates) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return null\n    }\n\n    const { data, error } = await supabase\n      .from('equipment')\n      .update(updates)\n      .eq('id', equipmentId)\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Error updating equipment:', error)\n      throw error\n    }\n\n    return data\n  },\n\n  /**\n   * Deactivate equipment (soft delete)\n   */\n  async deactivateEquipment(equipmentId) {\n    return this.updateEquipment(equipmentId, { is_active: false })\n  },\n\n  // ----------------------------------------\n  // Project Equipment\n  // ----------------------------------------\n\n  /**\n   * Get all equipment on a project\n   */\n  async getProjectEquipment(projectId) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return []\n    }\n\n    const { data, error } = await supabase\n      .from('project_equipment')\n      .select(`\n        *,\n        equipment:equipment_id (\n          id,\n          name,\n          description,\n          is_owned\n        )\n      `)\n      .eq('project_id', projectId)\n      .order('start_date', { ascending: false })\n\n    if (error) {\n      console.error('Error fetching project equipment:', error)\n      return []\n    }\n\n    return data || []\n  },\n\n  /**\n   * Get equipment currently on site (no end_date)\n   */\n  async getActiveProjectEquipment(projectId) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return []\n    }\n\n    const { data, error } = await supabase\n      .from('project_equipment')\n      .select(`\n        *,\n        equipment:equipment_id (\n          id,\n          name,\n          description,\n          is_owned\n        )\n      `)\n      .eq('project_id', projectId)\n      .is('end_date', null)\n      .order('start_date', { ascending: false })\n\n    if (error) {\n      console.error('Error fetching active project equipment:', error)\n      return []\n    }\n\n    return data || []\n  },\n\n  /**\n   * Add equipment to a project\n   */\n  async addEquipmentToProject(projectEquipment) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return null\n    }\n\n    const { data, error } = await supabase\n      .from('project_equipment')\n      .insert(projectEquipment)\n      .select(`\n        *,\n        equipment:equipment_id (\n          id,\n          name,\n          description,\n          is_owned\n        )\n      `)\n      .single()\n\n    if (error) {\n      console.error('Error adding equipment to project:', error)\n      throw error\n    }\n\n    return data\n  },\n\n  /**\n   * Update project equipment\n   */\n  async updateProjectEquipment(projectEquipmentId, updates) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return null\n    }\n\n    const { data, error } = await supabase\n      .from('project_equipment')\n      .update(updates)\n      .eq('id', projectEquipmentId)\n      .select(`\n        *,\n        equipment:equipment_id (\n          id,\n          name,\n          description,\n          is_owned\n        )\n      `)\n      .single()\n\n    if (error) {\n      console.error('Error updating project equipment:', error)\n      throw error\n    }\n\n    return data\n  },\n\n  /**\n   * Mark equipment as returned (set end_date)\n   */\n  async markEquipmentReturned(projectEquipmentId, endDate = null) {\n    return this.updateProjectEquipment(projectEquipmentId, {\n      end_date: endDate || new Date().toISOString().split('T')[0]\n    })\n  },\n\n  /**\n   * Delete project equipment record\n   */\n  async removeEquipmentFromProject(projectEquipmentId) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return false\n    }\n\n    const { error } = await supabase\n      .from('project_equipment')\n      .delete()\n      .eq('id', projectEquipmentId)\n\n    if (error) {\n      console.error('Error removing project equipment:', error)\n      throw error\n    }\n\n    return true\n  },\n\n  /**\n   * Calculate total equipment cost for a project\n   */\n  calculateProjectEquipmentCost(projectEquipment) {\n    const today = new Date()\n    today.setHours(0, 0, 0, 0)\n\n    return projectEquipment.reduce((total, eq) => {\n      const startDate = new Date(eq.start_date)\n      startDate.setHours(0, 0, 0, 0)\n\n      let endDate\n      if (eq.end_date) {\n        endDate = new Date(eq.end_date)\n        endDate.setHours(0, 0, 0, 0)\n      } else {\n        endDate = today\n      }\n\n      // Calculate days (inclusive)\n      const days = Math.max(1, Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1)\n\n      return total + (eq.daily_rate * days)\n    }, 0)\n  },\n\n  /**\n   * Calculate days on site for a single equipment entry\n   */\n  calculateDaysOnSite(startDate, endDate = null) {\n    const start = new Date(startDate)\n    start.setHours(0, 0, 0, 0)\n\n    let end\n    if (endDate) {\n      end = new Date(endDate)\n    } else {\n      end = new Date()\n    }\n    end.setHours(0, 0, 0, 0)\n\n    return Math.max(1, Math.floor((end - start) / (1000 * 60 * 60 * 24)) + 1)\n  }\n}\n","// Draw Request / Progress Billing operations\n// Extracted from supabase.js for maintainability\n\nimport { supabase, isSupabaseConfigured } from './supabaseClient'\n\nexport const drawRequestOps = {\n  /**\n   * Get next draw number for a project\n   */\n  async getNextDrawNumber(projectId) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return 1\n    }\n\n    const { data, error } = await supabase\n      .from('draw_requests')\n      .select('draw_number')\n      .eq('project_id', projectId)\n      .order('draw_number', { ascending: false })\n      .limit(1)\n      .single()\n\n    if (error && error.code !== 'PGRST116') { // PGRST116 = no rows found\n      console.error('Error getting next draw number:', error)\n    }\n\n    return (data?.draw_number || 0) + 1\n  },\n\n  /**\n   * Get previous billing totals for a project\n   */\n  async getPreviousBillingTotals(projectId) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return { totalBilled: 0, totalRetention: 0 }\n    }\n\n    const { data, error } = await supabase\n      .from('draw_requests')\n      .select('current_billing, retention_held')\n      .eq('project_id', projectId)\n      .in('status', ['submitted', 'approved', 'paid'])\n\n    if (error) {\n      console.error('Error getting previous billing totals:', error)\n      return { totalBilled: 0, totalRetention: 0 }\n    }\n\n    const totalBilled = (data || []).reduce((sum, dr) => sum + (dr.current_billing || 0), 0)\n    const totalRetention = data?.length > 0 ? Math.max(...data.map(dr => dr.retention_held || 0)) : 0\n\n    return { totalBilled, totalRetention }\n  },\n\n  /**\n   * Get all draw requests for a project\n   */\n  async getProjectDrawRequests(projectId) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return []\n    }\n\n    const { data, error } = await supabase\n      .from('draw_requests')\n      .select('*')\n      .eq('project_id', projectId)\n      .order('draw_number', { ascending: false })\n\n    if (error) {\n      console.error('Error fetching draw requests:', error)\n      return []\n    }\n\n    return data || []\n  },\n\n  /**\n   * Get a single draw request with its items\n   */\n  async getDrawRequest(drawRequestId) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return null\n    }\n\n    const { data, error } = await supabase\n      .from('draw_requests')\n      .select(`\n        *,\n        draw_request_items (\n          *\n        )\n      `)\n      .eq('id', drawRequestId)\n      .single()\n\n    if (error) {\n      console.error('Error fetching draw request:', error)\n      return null\n    }\n\n    return data\n  },\n\n  /**\n   * Create a new draw request with items\n   */\n  async createDrawRequest(drawRequest, items) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return null\n    }\n\n    // Insert draw request\n    const { data: dr, error: drError } = await supabase\n      .from('draw_requests')\n      .insert(drawRequest)\n      .select()\n      .single()\n\n    if (drError) {\n      console.error('Error creating draw request:', drError)\n      throw drError\n    }\n\n    // Insert items if provided\n    if (items && items.length > 0) {\n      const itemsWithDrawId = items.map((item, index) => ({\n        ...item,\n        draw_request_id: dr.id,\n        sort_order: index\n      }))\n\n      const { error: itemsError } = await supabase\n        .from('draw_request_items')\n        .insert(itemsWithDrawId)\n\n      if (itemsError) {\n        console.error('Error creating draw request items:', itemsError)\n        // Don't throw - draw request was created, items can be added later\n      }\n    }\n\n    // Fetch complete draw request with items\n    return this.getDrawRequest(dr.id)\n  },\n\n  /**\n   * Update a draw request\n   */\n  async updateDrawRequest(drawRequestId, updates) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return null\n    }\n\n    const { data, error } = await supabase\n      .from('draw_requests')\n      .update(updates)\n      .eq('id', drawRequestId)\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Error updating draw request:', error)\n      throw error\n    }\n\n    return data\n  },\n\n  /**\n   * Update draw request status\n   */\n  async updateDrawRequestStatus(drawRequestId, status) {\n    const updates = { status }\n\n    // Add timestamp based on status\n    if (status === 'submitted') {\n      updates.submitted_at = new Date().toISOString()\n    } else if (status === 'approved') {\n      updates.approved_at = new Date().toISOString()\n    } else if (status === 'paid') {\n      updates.paid_at = new Date().toISOString()\n    }\n\n    return this.updateDrawRequest(drawRequestId, updates)\n  },\n\n  /**\n   * Update draw request items (bulk update)\n   */\n  async updateDrawRequestItems(drawRequestId, items) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return false\n    }\n\n    // Delete existing items\n    const { error: deleteError } = await supabase\n      .from('draw_request_items')\n      .delete()\n      .eq('draw_request_id', drawRequestId)\n\n    if (deleteError) {\n      console.error('Error deleting old draw request items:', deleteError)\n      throw deleteError\n    }\n\n    // Insert new items\n    if (items && items.length > 0) {\n      const itemsWithDrawId = items.map((item, index) => ({\n        ...item,\n        draw_request_id: drawRequestId,\n        sort_order: index\n      }))\n\n      const { error: insertError } = await supabase\n        .from('draw_request_items')\n        .insert(itemsWithDrawId)\n\n      if (insertError) {\n        console.error('Error inserting draw request items:', insertError)\n        throw insertError\n      }\n    }\n\n    return true\n  },\n\n  /**\n   * Delete a draft draw request\n   */\n  async deleteDrawRequest(drawRequestId) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return false\n    }\n\n    const { error } = await supabase\n      .from('draw_requests')\n      .delete()\n      .eq('id', drawRequestId)\n\n    if (error) {\n      console.error('Error deleting draw request:', error)\n      throw error\n    }\n\n    return true\n  },\n\n  /**\n   * Get schedule of values from project areas\n   * Returns areas with their scheduled values for use in draw requests\n   */\n  async getScheduleOfValues(projectId) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return []\n    }\n\n    const { data, error } = await supabase\n      .from('areas')\n      .select('id, name, square_footage, price_per_sqft')\n      .eq('project_id', projectId)\n      .order('created_at')\n\n    if (error) {\n      console.error('Error fetching schedule of values:', error)\n      return []\n    }\n\n    // Calculate scheduled value for each area\n    return (data || []).map((area, index) => ({\n      area_id: area.id,\n      item_number: String(index + 1),\n      description: area.name,\n      scheduled_value: Math.round((area.square_footage || 0) * (area.price_per_sqft || 0) * 100) // Convert to cents\n    }))\n  },\n\n  /**\n   * Get previous draw request items for calculating previous work\n   */\n  async getPreviousDrawItems(projectId) {\n    if (!isSupabaseConfigured) {\n      console.warn('Supabase not configured')\n      return {}\n    }\n\n    // Get the most recent submitted/approved/paid draw request\n    const { data: latestDraw, error: drawError } = await supabase\n      .from('draw_requests')\n      .select('id')\n      .eq('project_id', projectId)\n      .in('status', ['submitted', 'approved', 'paid'])\n      .order('draw_number', { ascending: false })\n      .limit(1)\n      .single()\n\n    if (drawError && drawError.code !== 'PGRST116') {\n      console.error('Error fetching latest draw:', drawError)\n      return {}\n    }\n\n    if (!latestDraw) {\n      return {}\n    }\n\n    // Get items from that draw\n    const { data: items, error: itemsError } = await supabase\n      .from('draw_request_items')\n      .select('area_id, total_percent, total_amount')\n      .eq('draw_request_id', latestDraw.id)\n\n    if (itemsError) {\n      console.error('Error fetching previous draw items:', itemsError)\n      return {}\n    }\n\n    // Return as a map by area_id\n    return (items || []).reduce((acc, item) => {\n      if (item.area_id) {\n        acc[item.area_id] = {\n          previous_percent: item.total_percent || 0,\n          previous_amount: item.total_amount || 0\n        }\n      }\n      return acc\n    }, {})\n  },\n\n  /**\n   * Calculate completion percentage from amount\n   */\n  calculatePercentFromAmount(amount, scheduledValue) {\n    if (!scheduledValue || scheduledValue === 0) return 0\n    return Math.round((amount / scheduledValue) * 10000) // basis points\n  },\n\n  /**\n   * Calculate amount from percentage\n   */\n  calculateAmountFromPercent(percent, scheduledValue) {\n    return Math.round((percent / 10000) * scheduledValue)\n  }\n}\n","import {\n  initOfflineDB,\n  getConnectionStatus,\n  onConnectionChange,\n  cacheProjects,\n  getCachedProjects,\n  cacheAreas,\n  getCachedAreas,\n  updateCachedAreaStatus,\n  cacheCrewCheckin,\n  getCachedCrewCheckin,\n  cacheTMTicket,\n  getCachedTMTickets,\n  generateTempId,\n  cacheDailyReport,\n  getCachedDailyReport,\n  cacheMessage,\n  getCachedMessages,\n  addPendingAction,\n  getPendingActionCount,\n  syncPendingActions,\n  ACTION_TYPES\n} from './offlineManager'\n// Import supabase client from separate file to avoid circular dependency with observability\nimport { supabase, isSupabaseConfigured } from './supabaseClient'\nimport { observe } from './observability'\n// Import field session management from dedicated module\nimport {\n  getFieldSession,\n  setFieldSession,\n  clearFieldSession,\n  getFieldClient,\n  getClient,\n  getSupabaseClient,\n  isFieldMode,\n  getFieldProjectId,\n  getFieldCompanyId\n} from './fieldSession'\nimport { getLocalData, setLocalData, getLocalUser, setLocalUser } from './localStorageHelpers'\nimport { corOps } from './corOps'\nimport { equipmentOps } from './equipmentOps'\nimport { drawRequestOps } from './drawRequestOps'\n\n// Re-export for other modules\nexport { supabase, isSupabaseConfigured }\nexport { clearFieldSession, getSupabaseClient, isFieldMode, getFieldProjectId, getFieldCompanyId }\nexport { equipmentOps, drawRequestOps }\n\n// Initialize offline database (guard for SSR/test environments)\nif (typeof window !== 'undefined') {\n  initOfflineDB().catch(err => console.error('Failed to init offline DB:', err))\n}\n\n// ============================================\n// Security Helpers\n// ============================================\n\n// Get or create a device ID for rate limiting\nconst getDeviceId = () => {\n  const key = 'fieldsync_device_id'\n  let deviceId = localStorage.getItem(key)\n  if (!deviceId) {\n    deviceId = crypto.randomUUID()\n    localStorage.setItem(key, deviceId)\n  }\n  return deviceId\n}\n\n// Simple retry with exponential backoff\nconst withRetry = async (fn, maxRetries = 3, baseDelay = 1000) => {\n  let lastError\n  for (let i = 0; i < maxRetries; i++) {\n    try {\n      return await fn()\n    } catch (error) {\n      lastError = error\n      // Don't retry on auth errors or validation errors\n      if (error.code === 'PGRST301' || error.code === '42501' || error.code === '23514') {\n        throw error\n      }\n      // Wait with exponential backoff\n      if (i < maxRetries - 1) {\n        await new Promise(resolve => setTimeout(resolve, baseDelay * Math.pow(2, i)))\n      }\n    }\n  }\n  throw lastError\n}\n\n// Input validation helpers\nconst validateAmount = (amount) => {\n  if (amount === null || amount === undefined) return true\n  const num = parseFloat(amount)\n  return !isNaN(num) && num >= 0 && num < 10000000\n}\n\nconst validateTextLength = (text, maxLength = 10000) => {\n  if (!text) return true\n  return text.length <= maxLength\n}\n\nconst sanitizeText = (text) => {\n  if (!text) return text\n  // Remove null bytes and trim\n  return text.replace(/\\0/g, '').trim()\n}\n\n// ============================================\n// Authentication\n// ============================================\n\nexport const auth = {\n  // Sign up new user\n  async signUp(email, password, fullName, role) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase.auth.signUp({\n        email,\n        password,\n        options: {\n          data: {\n            name: fullName,\n            role: role\n          }\n        }\n      })\n      if (error) throw error\n      return data\n    } else {\n      // Demo mode - create local user\n      const localData = getLocalData()\n      const user = {\n        id: crypto.randomUUID(),\n        email,\n        name: fullName,\n        role,\n        created_at: new Date().toISOString()\n      }\n      localData.users.push(user)\n      setLocalData(localData)\n      setLocalUser(user)\n      return { user }\n    }\n  },\n\n  // Sign in existing user\n  async signIn(email, password) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email,\n        password\n      })\n      if (error) throw error\n      return data\n    } else {\n      // Demo mode - find local user (password check skipped intentionally)\n      if (import.meta.env.DEV) {\n        console.warn('[auth] Demo mode: password validation is skipped. Do not use demo mode in production.')\n      }\n      const localData = getLocalData()\n      const user = localData.users.find(u => u.email === email)\n      if (!user) throw new Error('User not found')\n      setLocalUser(user)\n      return { user }\n    }\n  },\n\n  // Sign out\n  async signOut() {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase.auth.signOut()\n      if (error) throw error\n    } else {\n      setLocalUser(null)\n    }\n  },\n\n  // Get current user\n  async getUser() {\n    if (isSupabaseConfigured) {\n      const { data: { user } } = await supabase.auth.getUser()\n      return user\n    } else {\n      return getLocalUser()\n    }\n  },\n\n  // Get user profile with role\n  async getProfile() {\n    if (isSupabaseConfigured) {\n      const { data: { user } } = await supabase.auth.getUser()\n      if (!user) return null\n\n      const { data, error } = await supabase\n        .from('users')\n        .select('*')\n        .eq('id', user.id)\n        .single()\n      \n      if (error) {\n        // Profile might not exist yet, return basic info\n        return {\n          id: user.id,\n          email: user.email,\n          name: user.user_metadata?.name || '',\n          role: user.user_metadata?.role || 'foreman'\n        }\n      }\n      return data\n    } else {\n      return getLocalUser()\n    }\n  },\n\n  // Update user role\n  async updateRole(userId, newRole) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('users')\n        .update({ role: newRole })\n        .eq('id', userId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    } else {\n      const localData = getLocalData()\n      const user = localData.users.find(u => u.id === userId)\n      if (user) {\n        user.role = newRole\n        setLocalData(localData)\n        if (getLocalUser()?.id === userId) {\n          setLocalUser(user)\n        }\n      }\n      return user\n    }\n  },\n\n  // Listen to auth changes\n  onAuthStateChange(callback) {\n    if (isSupabaseConfigured) {\n      return supabase.auth.onAuthStateChange(callback)\n    } else {\n      // Demo mode - just call with current state\n      const user = getLocalUser()\n      callback(user ? 'SIGNED_IN' : 'SIGNED_OUT', { user })\n      return { data: { subscription: { unsubscribe: () => {} } } }\n    }\n  }\n}\n\n// Database operations with localStorage fallback\nexport const db = {\n  // Projects\n  async getProjects(companyId = null, includeArchived = false) {\n    if (isSupabaseConfigured) {\n      // If offline, return cached data\n      if (!getConnectionStatus()) {\n        const cached = await getCachedProjects(companyId)\n        if (includeArchived) return cached\n        return cached.filter(p => p.status !== 'archived')\n      }\n\n      const start = performance.now()\n      try {\n        let query = supabase\n          .from('projects')\n          .select('*')\n          .order('created_at', { ascending: false })\n\n        if (companyId) {\n          query = query.eq('company_id', companyId)\n        }\n\n        if (!includeArchived) {\n          query = query.eq('status', 'active')\n        }\n\n        const { data, error } = await query\n        const duration = Math.round(performance.now() - start)\n        observe.query('getProjects', { duration, rows: data?.length, company_id: companyId })\n\n        if (error) {\n          observe.error('database', { message: error.message, operation: 'getProjects', company_id: companyId })\n          // On error, try cache\n          const cached = await getCachedProjects(companyId)\n          if (cached.length > 0) return cached\n          throw error\n        }\n\n        // Cache projects for offline use\n        if (data?.length > 0) {\n          cacheProjects(data).catch(err => console.error('Failed to cache projects:', err))\n        }\n\n        return data\n      } catch (error) {\n        observe.error('database', { message: error.message, operation: 'getProjects', company_id: companyId })\n        throw error\n      }\n    } else {\n      const projects = getLocalData().projects\n      if (includeArchived) return projects\n      return projects.filter(p => p.status !== 'archived')\n    }\n  },\n\n  // Get projects with pagination for scalability (use for large project lists)\n  async getProjectsPaginated(companyId, { page = 0, limit = 25, status = 'active' } = {}) {\n    if (isSupabaseConfigured) {\n      const start = performance.now()\n      try {\n        let query = supabase\n          .from('projects')\n          .select('*', { count: 'exact' })\n          .eq('company_id', companyId)\n          .order('created_at', { ascending: false })\n          .range(page * limit, (page + 1) * limit - 1)\n\n        if (status !== 'all') {\n          query = query.eq('status', status)\n        }\n\n        const { data, error, count } = await query\n        const duration = Math.round(performance.now() - start)\n        observe.query('getProjectsPaginated', { duration, rows: data?.length, page, company_id: companyId })\n\n        if (error) throw error\n\n        return {\n          projects: data || [],\n          totalCount: count || 0,\n          hasMore: (page + 1) * limit < (count || 0),\n          page,\n          limit\n        }\n      } catch (error) {\n        observe.error('database', { message: error.message, operation: 'getProjectsPaginated', company_id: companyId })\n        throw error\n      }\n    }\n    // Demo mode fallback\n    const projects = getLocalData().projects.filter(p =>\n      p.company_id === companyId && (status === 'all' || p.status === status)\n    )\n    const start = page * limit\n    return {\n      projects: projects.slice(start, start + limit),\n      totalCount: projects.length,\n      hasMore: start + limit < projects.length,\n      page,\n      limit\n    }\n  },\n\n  // Get projects with lightweight summary counts (optimized for dashboard)\n  // This reduces the number of queries from 9 per project to a single batch query\n  async getProjectsWithSummary(companyId) {\n    if (isSupabaseConfigured) {\n      const start = performance.now()\n      try {\n        // Fetch projects with embedded counts using Supabase's aggregate functions\n        const { data, error } = await supabase\n          .from('projects')\n          .select(`\n            *,\n            areas:areas(count),\n            tickets:t_and_m_tickets(count),\n            pending_tickets:t_and_m_tickets(count),\n            daily_reports:daily_reports(count)\n          `)\n          .eq('company_id', companyId)\n          .eq('status', 'active')\n          .eq('pending_tickets.status', 'pending')\n          .order('created_at', { ascending: false })\n\n        const duration = Math.round(performance.now() - start)\n        observe.query('getProjectsWithSummary', { duration, rows: data?.length, company_id: companyId })\n\n        if (error) throw error\n\n        // Transform the response to extract counts\n        return (data || []).map(project => ({\n          ...project,\n          areaCount: project.areas?.[0]?.count || 0,\n          ticketCount: project.tickets?.[0]?.count || 0,\n          pendingTicketCount: project.pending_tickets?.[0]?.count || 0,\n          reportCount: project.daily_reports?.[0]?.count || 0,\n          // Remove the raw relation data\n          areas: undefined,\n          tickets: undefined,\n          pending_tickets: undefined,\n          daily_reports: undefined\n        }))\n      } catch (error) {\n        observe.error('database', { message: error.message, operation: 'getProjectsWithSummary', company_id: companyId })\n        // Fall back to regular getProjects on error\n        return this.getProjects(companyId)\n      }\n    }\n    return getLocalData().projects.filter(p => p.company_id === companyId && p.status === 'active')\n  },\n\n  // Get comprehensive project dashboard summary using server-side aggregation\n  // This is the most optimized query - single RPC call returns all project metrics\n  async getProjectDashboardSummary(companyId) {\n    if (isSupabaseConfigured) {\n      const start = performance.now()\n      try {\n        const { data, error } = await supabase\n          .rpc('get_project_dashboard_summary', { p_company_id: companyId })\n\n        const duration = Math.round(performance.now() - start)\n        observe.query('getProjectDashboardSummary', { duration, rows: data?.length, company_id: companyId })\n\n        if (error) {\n          // Fall back to getProjectsWithSummary if RPC doesn't exist yet\n          if (error.message?.includes('function') || error.code === '42883') {\n            return this.getProjectsWithSummary(companyId)\n          }\n          throw error\n        }\n\n        // Transform the snake_case response to camelCase for consistency\n        return (data || []).map(p => ({\n          id: p.project_id,\n          name: p.project_name,\n          status: p.project_status,\n          job_number: p.project_number,\n          address: p.project_address,\n          pin: p.project_pin,\n          created_at: p.created_at,\n          start_date: p.start_date,\n          end_date: p.end_date,\n          // Financial fields\n          contract_value: Number(p.contract_value) || 0,\n          work_type: p.work_type || 'demolition',\n          job_type: p.job_type || 'standard',\n          general_contractor: p.general_contractor || '',\n          // Metrics\n          areaCount: Number(p.total_areas) || 0,\n          completedAreas: Number(p.completed_areas) || 0,\n          inProgressAreas: Number(p.in_progress_areas) || 0,\n          pendingAreas: Number(p.pending_areas) || 0,\n          ticketCount: Number(p.total_tickets) || 0,\n          pendingTicketCount: Number(p.pending_tickets) || 0,\n          submittedTicketCount: Number(p.submitted_tickets) || 0,\n          approvedTicketCount: Number(p.approved_tickets) || 0,\n          totalLaborHours: Number(p.total_labor_hours) || 0,\n          todayLaborHours: Number(p.today_labor_hours) || 0,\n          todayWorkerCount: Number(p.today_worker_count) || 0,\n          lastActivityAt: p.last_activity_at,\n          dailyReportsThisWeek: Number(p.daily_reports_this_week) || 0,\n          corCount: Number(p.cor_count) || 0,\n          pendingCorCount: Number(p.pending_cor_count) || 0,\n          disposalLoadsToday: Number(p.disposal_loads_today) || 0\n        }))\n      } catch (error) {\n        observe.error('database', { message: error.message, operation: 'getProjectDashboardSummary', company_id: companyId })\n        // Fall back to getProjectsWithSummary on error\n        return this.getProjectsWithSummary(companyId)\n      }\n    }\n    // Demo mode - basic project list\n    return getLocalData().projects.filter(p => p.company_id === companyId && p.status === 'active')\n  },\n\n  async getArchivedProjects(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('projects')\n        .select('*')\n        .eq('company_id', companyId)\n        .eq('status', 'archived')\n        .order('archived_at', { ascending: false })\n      if (error) throw error\n      return data\n    } else {\n      return getLocalData().projects.filter(p => p.status === 'archived')\n    }\n  },\n\n  async getProjectCount(companyId) {\n    if (isSupabaseConfigured) {\n      const { count, error } = await supabase\n        .from('projects')\n        .select('*', { count: 'exact', head: true })\n        .eq('company_id', companyId)\n        .in('status', ['active', 'archived'])\n      if (error) throw error\n      return count || 0\n    } else {\n      const projects = getLocalData().projects\n      return projects.filter(p => p.company_id === companyId && p.status !== 'deleted').length\n    }\n  },\n\n  // Universal Search - searches across projects, T&M tickets, CORs, and workers\n  async universalSearch(companyId, query, limit = 10) {\n    if (!isSupabaseConfigured || !query?.trim()) {\n      return { projects: [], tickets: [], cors: [], workers: [] }\n    }\n\n    const searchQuery = query.trim().toLowerCase()\n    const results = { projects: [], tickets: [], cors: [], workers: [] }\n\n    try {\n      // Search projects\n      const { data: projects } = await supabase\n        .from('projects')\n        .select('id, name, job_number, address, status')\n        .eq('company_id', companyId)\n        .eq('status', 'active')\n        .or(`name.ilike.%${searchQuery}%,job_number.ilike.%${searchQuery}%,address.ilike.%${searchQuery}%`)\n        .limit(limit)\n\n      results.projects = projects || []\n\n      // Search T&M tickets\n      const { data: tickets } = await supabase\n        .from('t_and_m_tickets')\n        .select(`\n          id, description, work_date, status, project_id,\n          projects!inner(id, name, company_id)\n        `)\n        .eq('projects.company_id', companyId)\n        .ilike('description', `%${searchQuery}%`)\n        .order('work_date', { ascending: false })\n        .limit(limit)\n\n      results.tickets = (tickets || []).map(t => ({\n        ...t,\n        projectName: t.projects?.name || 'Unknown Project'\n      }))\n\n      // Search Change Orders\n      const { data: cors } = await supabase\n        .from('change_orders')\n        .select(`\n          id, cor_number, title, status, project_id,\n          projects!inner(id, name, company_id)\n        `)\n        .eq('projects.company_id', companyId)\n        .or(`title.ilike.%${searchQuery}%,cor_number.ilike.%${searchQuery}%`)\n        .order('created_at', { ascending: false })\n        .limit(limit)\n\n      results.cors = (cors || []).map(c => ({\n        ...c,\n        projectName: c.projects?.name || 'Unknown Project'\n      }))\n\n      // Search workers from recent crew check-ins\n      const { data: checkins } = await supabase\n        .from('crew_checkins')\n        .select(`\n          workers,\n          project_id,\n          projects!inner(id, name, company_id)\n        `)\n        .eq('projects.company_id', companyId)\n        .order('check_in_date', { ascending: false })\n        .limit(50)\n\n      // Extract unique workers matching query\n      const workerMap = new Map()\n      ;(checkins || []).forEach(checkin => {\n        (checkin.workers || []).forEach(worker => {\n          if (worker.name.toLowerCase().includes(searchQuery)) {\n            const key = worker.name.toLowerCase()\n            if (!workerMap.has(key)) {\n              workerMap.set(key, {\n                name: worker.name,\n                role: worker.role,\n                projectName: checkin.projects?.name,\n                lastProject: checkin.projects\n              })\n            }\n          }\n        })\n      })\n\n      results.workers = Array.from(workerMap.values()).slice(0, limit)\n\n      return results\n    } catch (error) {\n      console.error('Universal search error:', error)\n      return results\n    }\n  },\n\n  async archiveProject(id) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('projects')\n        .update({ \n          status: 'archived',\n          archived_at: new Date().toISOString()\n        })\n        .eq('id', id)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    } else {\n      const localData = getLocalData()\n      const project = localData.projects.find(p => p.id === id)\n      if (project) {\n        project.status = 'archived'\n        project.archived_at = new Date().toISOString()\n        setLocalData(localData)\n      }\n      return project\n    }\n  },\n\n  // Get estimated storage usage for a project (photos only - they're 95% of storage)\n  async getProjectStorageStats(projectId) {\n    if (!isSupabaseConfigured) return { photoCount: 0, estimatedMB: 0 }\n\n    // Get all T&M tickets with photos\n    const { data: tickets, error } = await supabase\n      .from('t_and_m_tickets')\n      .select('photos')\n      .eq('project_id', projectId)\n\n    if (error) throw error\n\n    // Count photos across all tickets\n    let photoCount = 0\n    const photoUrls = []\n    tickets?.forEach(ticket => {\n      if (ticket.photos && Array.isArray(ticket.photos)) {\n        photoCount += ticket.photos.length\n        photoUrls.push(...ticket.photos)\n      }\n    })\n\n    // Estimate: average photo is 1-2MB after compression\n    const estimatedMB = photoCount * 1.5\n\n    return { photoCount, estimatedMB, photoUrls }\n  },\n\n  // Deep archive: archive project AND delete photos to reclaim storage\n  // Call this after user has exported their important documents\n  async archiveProjectDeep(projectId, companyId) {\n    if (!isSupabaseConfigured) return null\n\n    // 1. Get all photo URLs for this project\n    const { photoUrls } = await this.getProjectStorageStats(projectId)\n\n    // 2. Delete all photos from storage\n    if (photoUrls.length > 0) {\n      const filePaths = photoUrls\n        .map(urlOrPath => {\n          if (!urlOrPath) return null\n          if (urlOrPath.startsWith('http')) {\n            try {\n              const urlObj = new URL(urlOrPath)\n              const match = urlObj.pathname.match(/\\/tm-photos\\/(.+)$/)\n              return match ? match[1] : null\n            } catch { return null }\n          }\n          return urlOrPath // already a storage path\n        })\n        .filter(Boolean)\n\n      if (filePaths.length > 0) {\n        // Delete in batches of 100\n        for (let i = 0; i < filePaths.length; i += 100) {\n          const batch = filePaths.slice(i, i + 100)\n          await supabase.storage.from('tm-photos').remove(batch)\n        }\n      }\n    }\n\n    // 3. Clear photo arrays in tickets (keep ticket data for records)\n    await supabase\n      .from('t_and_m_tickets')\n      .update({ photos: [] })\n      .eq('project_id', projectId)\n\n    // 4. Archive the project with cleanup flag\n    const { data, error } = await supabase\n      .from('projects')\n      .update({\n        status: 'archived',\n        archived_at: new Date().toISOString(),\n        photos: [], // Clear project photos too\n        storage_cleaned: true // Flag that photos were removed\n      })\n      .eq('id', projectId)\n      .select()\n      .single()\n\n    if (error) throw error\n    return { ...data, photosDeleted: photoUrls.length }\n  },\n\n  async restoreProject(id) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('projects')\n        .update({\n          status: 'active',\n          archived_at: null\n        })\n        .eq('id', id)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    } else {\n      const localData = getLocalData()\n      const project = localData.projects.find(p => p.id === id)\n      if (project) {\n        project.status = 'active'\n        project.archived_at = null\n        setLocalData(localData)\n      }\n      return project\n    }\n  },\n\n  async getProject(id) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('projects')\n        .select('*')\n        .eq('id', id)\n        .single()\n      if (error) throw error\n      return data\n    } else {\n      return getLocalData().projects.find(p => p.id === id)\n    }\n  },\n\n  async createProject(project) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('projects')\n        .insert({\n          ...project,\n          status: 'active'\n        })\n        .select()\n        .single()\n      if (error) {\n        console.error('Supabase createProject error:', error.message, error.details, error.hint)\n        throw error\n      }\n      return data\n    } else {\n      const localData = getLocalData()\n      const newProject = { \n        ...project, \n        id: crypto.randomUUID(),\n        status: 'active',\n        created_at: new Date().toISOString()\n      }\n      localData.projects.push(newProject)\n      setLocalData(localData)\n      return newProject\n    }\n  },\n\n  // Get project by PIN (for foreman access) - only active projects\n  // Note: For production, use getProjectByPinSecure which includes rate limiting\n  async getProjectByPin(pin) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('projects')\n        .select('*')\n        .eq('pin', pin)\n        .eq('status', 'active')\n        .single()\n      if (error) return null\n      return data\n    } else {\n      const localData = getLocalData()\n      return localData.projects.find(p => p.pin === pin && p.status === 'active') || null\n    }\n  },\n\n  // Get project by PIN within a specific company (secure foreman access)\n  async getProjectByPinAndCompany(pin, companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('projects')\n        .select('*')\n        .eq('pin', pin)\n        .eq('company_id', companyId)\n        .eq('status', 'active')\n        .single()\n      if (error) return null\n      return data\n    } else {\n      const localData = getLocalData()\n      return localData.projects.find(p =>\n        p.pin === pin &&\n        p.company_id === companyId &&\n        p.status === 'active'\n      ) || null\n    }\n  },\n\n  // Secure PIN lookup with rate limiting and session creation\n  // Returns a session token that must be used for all subsequent requests\n  async getProjectByPinSecure(pin, companyCode) {\n    if (isSupabaseConfigured) {\n      // CLIENT-SIDE RATE LIMITING (defense-in-depth)\n      const rateLimitKey = `pin_attempts_${companyCode}`\n      const lockoutKey = `pin_lockout_${companyCode}`\n      const MAX_ATTEMPTS = 5\n      const LOCKOUT_MS = 5 * 60 * 1000 // 5 minutes\n\n      // Check if currently locked out\n      const lockoutUntil = localStorage.getItem(lockoutKey)\n      if (lockoutUntil && Date.now() < parseInt(lockoutUntil)) {\n        const remainingMs = parseInt(lockoutUntil) - Date.now()\n        const remainingMins = Math.ceil(remainingMs / 60000)\n        return {\n          success: false,\n          rateLimited: true,\n          project: null,\n          error: `Too many attempts. Please try again in ${remainingMins} minute${remainingMins > 1 ? 's' : ''}.`\n        }\n      }\n\n      // Track attempts\n      let attempts = parseInt(localStorage.getItem(rateLimitKey) || '0')\n      attempts++\n      localStorage.setItem(rateLimitKey, attempts.toString())\n\n      // Lockout after MAX_ATTEMPTS\n      if (attempts > MAX_ATTEMPTS) {\n        localStorage.setItem(lockoutKey, (Date.now() + LOCKOUT_MS).toString())\n        return {\n          success: false,\n          rateLimited: true,\n          project: null,\n          error: 'Too many failed attempts. Please try again in 5 minutes.'\n        }\n      }\n\n      const deviceId = getDeviceId()\n\n      // Use the new session-based validation\n      const { data, error } = await supabase\n        .rpc('validate_pin_and_create_session', {\n          p_pin: pin,\n          p_company_code: companyCode,\n          p_device_id: deviceId,\n          p_ip_address: null // IP is not available client-side\n        })\n\n      if (error) {\n        console.error('[PIN Auth] RPC error')\n        return { success: false, rateLimited: false, project: null, error: error.message }\n      }\n\n      if (!data || data.length === 0) {\n        return { success: false, rateLimited: false, project: null }\n      }\n\n      const result = data[0]\n\n      // Check error codes\n      if (result.error_code === 'RATE_LIMITED') {\n        return { success: false, rateLimited: true, project: null }\n      }\n\n      if (result.error_code === 'INVALID_COMPANY' || result.error_code === 'INVALID_PIN') {\n        return { success: false, rateLimited: false, project: null }\n      }\n\n      // Check if successful\n      if (!result.success || !result.project_id) {\n        return { success: false, rateLimited: false, project: null }\n      }\n\n      // SUCCESS: Clear rate limit counters\n      localStorage.removeItem(`pin_attempts_${companyCode}`)\n      localStorage.removeItem(`pin_lockout_${companyCode}`)\n\n      // Store the session for subsequent requests\n      setFieldSession({\n        token: result.session_token,\n        projectId: result.project_id,\n        companyId: result.company_id,\n        projectName: result.project_name,\n        companyName: result.company_name,\n        createdAt: new Date().toISOString()\n      })\n\n      // Fetch full project details using the new session\n      const client = getFieldClient()\n      const { data: projectData, error: projectError } = await client\n        .from('projects')\n        .select('*')\n        .eq('id', result.project_id)\n        .single()\n\n      return {\n        success: true,\n        rateLimited: false,\n        sessionToken: result.session_token,\n        project: projectData || {\n          id: result.project_id,\n          name: result.project_name,\n          company_id: result.company_id,\n          status: 'active'\n        }\n      }\n    } else {\n      // Demo mode - create mock session\n      const localData = getLocalData()\n      const companies = localData.companies || []\n      const company = companies.find(c => c.code === companyCode)\n\n      if (!company) {\n        return { success: false, rateLimited: false, project: null }\n      }\n\n      const project = localData.projects.find(\n        p => p.pin === pin && p.company_id === company.id && p.status === 'active'\n      )\n\n      if (project) {\n        // Create mock session for demo mode\n        const mockToken = `demo_${Date.now()}_${Math.random().toString(36).slice(2)}`\n        setFieldSession({\n          token: mockToken,\n          projectId: project.id,\n          companyId: company.id,\n          projectName: project.name,\n          companyName: company.name,\n          createdAt: new Date().toISOString()\n        })\n      }\n\n      return {\n        success: !!project,\n        rateLimited: false,\n        project: project || null\n      }\n    }\n  },\n\n  // Check if PIN is already in use\n  async isPinAvailable(pin, excludeProjectId = null) {\n    if (isSupabaseConfigured) {\n      let query = supabase\n        .from('projects')\n        .select('id')\n        .eq('pin', pin)\n      \n      if (excludeProjectId) {\n        query = query.neq('id', excludeProjectId)\n      }\n      \n      const { data, error } = await query\n      if (error) throw error\n      return data.length === 0\n    } else {\n      const localData = getLocalData()\n      return !localData.projects.some(p => p.pin === pin && p.id !== excludeProjectId)\n    }\n  },\n\n  // Update project PIN\n  async updateProjectPin(projectId, pin) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('projects')\n        .update({ pin })\n        .eq('id', projectId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    } else {\n      const localData = getLocalData()\n      const project = localData.projects.find(p => p.id === projectId)\n      if (project) {\n        project.pin = pin\n        setLocalData(localData)\n      }\n      return project\n    }\n  },\n\n  // Update project - requires companyId for cross-tenant security\n  async updateProject(id, updates, companyId = null) {\n    if (isSupabaseConfigured) {\n      // SECURITY: Require companyId to prevent cross-tenant data access\n      if (!companyId) {\n        console.error('[Security] updateProject called without companyId - this is a security risk')\n        throw new Error('Company ID is required for security verification')\n      }\n\n      const { data, error } = await supabase\n        .from('projects')\n        .update(updates)\n        .eq('id', id)\n        .eq('company_id', companyId)  // Always enforce cross-tenant security\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error updating project')\n        throw error\n      }\n      return data\n    } else {\n      const localData = getLocalData()\n      const project = localData.projects.find(p => p.id === id)\n      if (project) {\n        Object.assign(project, updates)\n        setLocalData(localData)\n      }\n      return project\n    }\n  },\n\n  // Delete project - requires companyId for cross-tenant security\n  async deleteProject(id, companyId = null) {\n    if (isSupabaseConfigured) {\n      let query = supabase\n        .from('projects')\n        .delete()\n        .eq('id', id)\n\n      // Add company_id check if provided (prevents cross-tenant access)\n      if (companyId) {\n        query = query.eq('company_id', companyId)\n      }\n\n      const { error } = await query\n      if (error) throw error\n    } else {\n      const localData = getLocalData()\n      localData.projects = localData.projects.filter(p => p.id !== id)\n      localData.areas = localData.areas.filter(a => a.project_id !== id)\n      setLocalData(localData)\n    }\n  },\n\n  // Areas\n  async getAreas(projectId) {\n    if (isSupabaseConfigured) {\n      // If offline, return cached data\n      if (!getConnectionStatus()) {\n        return getCachedAreas(projectId)\n      }\n\n      const client = getClient()\n      const { data, error } = await client\n        .from('areas')\n        .select('*')\n        .eq('project_id', projectId)\n        .order('sort_order', { ascending: true })\n\n      if (error) {\n        // On error, try cache\n        const cached = await getCachedAreas(projectId)\n        if (cached.length > 0) return cached\n        throw error\n      }\n\n      // Cache areas for offline use\n      if (data?.length > 0) {\n        cacheAreas(data).catch(err => console.error('Failed to cache areas:', err))\n      }\n\n      return data\n    } else {\n      return getLocalData().areas.filter(a => a.project_id === projectId)\n    }\n  },\n\n  async createArea(area) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      const { data, error } = await client\n        .from('areas')\n        .insert(area)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    } else {\n      const localData = getLocalData()\n      const newArea = {\n        ...area,\n        id: crypto.randomUUID(),\n        created_at: new Date().toISOString()\n      }\n      localData.areas.push(newArea)\n      setLocalData(localData)\n      return newArea\n    }\n  },\n\n  // Update area status - projectId optional for cross-tenant security\n  async updateAreaStatus(id, status, projectId = null) {\n    if (isSupabaseConfigured) {\n      // If offline, update cache and queue action\n      if (!getConnectionStatus()) {\n        const area = await updateCachedAreaStatus(id, status)\n        await addPendingAction(ACTION_TYPES.UPDATE_AREA_STATUS, { areaId: id, status })\n        return area\n      }\n\n      const client = getClient()\n      let query = client\n        .from('areas')\n        .update({ status })\n        .eq('id', id)\n\n      // Add project_id check if provided (prevents cross-tenant access)\n      if (projectId) {\n        query = query.eq('project_id', projectId)\n      }\n\n      const { data, error } = await query.select().single()\n\n      if (error) {\n        // If network error, queue for later\n        if (error.message?.includes('fetch') || error.message?.includes('network')) {\n          const area = await updateCachedAreaStatus(id, status)\n          await addPendingAction(ACTION_TYPES.UPDATE_AREA_STATUS, { areaId: id, status })\n          return area\n        }\n        throw error\n      }\n\n      // Update cache with server response\n      if (data) {\n        updateCachedAreaStatus(id, status).catch(err => console.error('Failed to update cached area status:', err))\n      }\n\n      return data\n    } else {\n      const localData = getLocalData()\n      const area = localData.areas.find(a => a.id === id)\n      if (area) {\n        area.status = status\n        area.updated_at = new Date().toISOString()\n      }\n      setLocalData(localData)\n      return area\n    }\n  },\n\n  // Update area (name, weight, sort_order) - projectId optional for security\n  async updateArea(id, updates, projectId = null) {\n    if (isSupabaseConfigured) {\n      let query = supabase\n        .from('areas')\n        .update(updates)\n        .eq('id', id)\n\n      // Add project_id check if provided (prevents cross-tenant access)\n      if (projectId) {\n        query = query.eq('project_id', projectId)\n      }\n\n      const { data, error } = await query.select().single()\n      if (error) throw error\n      return data\n    } else {\n      const localData = getLocalData()\n      const area = localData.areas.find(a => a.id === id)\n      if (area) {\n        Object.assign(area, updates)\n        area.updated_at = new Date().toISOString()\n      }\n      setLocalData(localData)\n      return area\n    }\n  },\n\n  // Delete area - projectId optional for cross-tenant security\n  async deleteArea(id, projectId = null) {\n    if (isSupabaseConfigured) {\n      let query = supabase\n        .from('areas')\n        .delete()\n        .eq('id', id)\n\n      // Add project_id check if provided (prevents cross-tenant access)\n      if (projectId) {\n        query = query.eq('project_id', projectId)\n      }\n\n      const { error } = await query\n      if (error) throw error\n    } else {\n      const localData = getLocalData()\n      localData.areas = localData.areas.filter(a => a.id !== id)\n      setLocalData(localData)\n    }\n  },\n\n  // Real-time subscriptions (Supabase only)\n  subscribeToAreas(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`areas:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'areas', filter: `project_id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to messages for a project (for live chat)\n  subscribeToMessages(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`messages:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'messages', filter: `project_id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to material requests for a project\n  subscribeToMaterialRequests(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`material_requests:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'material_requests', filter: `project_id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to daily reports for a project\n  subscribeToDailyReports(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`daily_reports:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'daily_reports', filter: `project_id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to crew check-ins for a project\n  subscribeToCrewCheckins(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`crew_checkins:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'crew_checkins', filter: `project_id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to injury reports for a company (office-wide)\n  subscribeToInjuryReports(companyId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`injury_reports:${companyId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'injury_reports', filter: `company_id=eq.${companyId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to T&M tickets for a project\n  subscribeToTMTickets(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`tm_tickets:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 't_and_m_tickets', filter: `project_id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // Subscribe to all company activity (for office notifications)\n  subscribeToCompanyActivity(companyId, projectIds, callbacks) {\n    if (!isSupabaseConfigured || !projectIds || projectIds.length === 0) return null\n\n    const channel = supabase.channel(`company_activity:${companyId}`)\n\n    // Subscribe to project-level changes\n    // Use wildcard event '*' for all entities to capture INSERT, UPDATE, and DELETE\n    projectIds.forEach(projectId => {\n      // Messages\n      channel.on('postgres_changes',\n        { event: '*', schema: 'public', table: 'messages', filter: `project_id=eq.${projectId}` },\n        (payload) => callbacks.onMessage?.(payload)\n      )\n\n      // Material requests\n      channel.on('postgres_changes',\n        { event: '*', schema: 'public', table: 'material_requests', filter: `project_id=eq.${projectId}` },\n        (payload) => callbacks.onMaterialRequest?.(payload)\n      )\n\n      // T&M Tickets\n      channel.on('postgres_changes',\n        { event: '*', schema: 'public', table: 't_and_m_tickets', filter: `project_id=eq.${projectId}` },\n        (payload) => callbacks.onTMTicket?.(payload)\n      )\n\n      // Crew check-ins - critical for labor tracking\n      channel.on('postgres_changes',\n        { event: '*', schema: 'public', table: 'crew_checkins', filter: `project_id=eq.${projectId}` },\n        (payload) => callbacks.onCrewCheckin?.(payload)\n      )\n\n      // Area progress updates (INSERT, UPDATE, and DELETE)\n      channel.on('postgres_changes',\n        { event: '*', schema: 'public', table: 'areas', filter: `project_id=eq.${projectId}` },\n        (payload) => callbacks.onAreaUpdate?.(payload)\n      )\n\n      // Change orders (CORs)\n      channel.on('postgres_changes',\n        { event: '*', schema: 'public', table: 'change_orders', filter: `project_id=eq.${projectId}` },\n        (payload) => callbacks.onCORChange?.(payload)\n      )\n\n      // Project-level changes (name, dates, budget updates from office)\n      channel.on('postgres_changes',\n        { event: '*', schema: 'public', table: 'projects', filter: `id=eq.${projectId}` },\n        (payload) => callbacks.onProjectChange?.(payload)\n      )\n    })\n\n    // Subscribe to injury reports company-wide (INSERT, UPDATE, and DELETE)\n    channel.on('postgres_changes',\n      { event: '*', schema: 'public', table: 'injury_reports', filter: `company_id=eq.${companyId}` },\n      (payload) => callbacks.onInjuryReport?.(payload)\n    )\n\n    // Subscribe to materials/equipment pricing changes company-wide\n    channel.on('postgres_changes',\n      { event: '*', schema: 'public', table: 'materials_equipment', filter: `company_id=eq.${companyId}` },\n      (payload) => callbacks.onMaterialsEquipmentChange?.(payload)\n    )\n\n    // Subscribe to labor rate changes company-wide\n    channel.on('postgres_changes',\n      { event: '*', schema: 'public', table: 'labor_rates', filter: `company_id=eq.${companyId}` },\n      (payload) => callbacks.onLaborRateChange?.(payload)\n    )\n\n    return channel.subscribe()\n  },\n\n  unsubscribe(subscription) {\n    if (subscription && isSupabaseConfigured) {\n      supabase.removeChannel(subscription)\n    }\n  },\n\n  // ============================================\n  // Project Assignments (for foremen)\n  // ============================================\n\n  async getAssignedProjects(userId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('project_assignments')\n        .select(`\n          project_id,\n          projects (*)\n        `)\n        .eq('user_id', userId)\n      if (error) throw error\n      return data.map(a => a.projects)\n    } else {\n      const localData = getLocalData()\n      const assignments = localData.assignments?.filter(a => a.user_id === userId) || []\n      return assignments.map(a => localData.projects.find(p => p.id === a.project_id)).filter(Boolean)\n    }\n  },\n\n  async assignUserToProject(projectId, userId, assignedBy) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('project_assignments')\n        .insert({ project_id: projectId, user_id: userId, assigned_by: assignedBy })\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    } else {\n      const localData = getLocalData()\n      if (!localData.assignments) localData.assignments = []\n      const assignment = {\n        id: crypto.randomUUID(),\n        project_id: projectId,\n        user_id: userId,\n        assigned_by: assignedBy,\n        assigned_at: new Date().toISOString()\n      }\n      localData.assignments.push(assignment)\n      setLocalData(localData)\n      return assignment\n    }\n  },\n\n  async removeUserFromProject(projectId, userId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('project_assignments')\n        .delete()\n        .eq('project_id', projectId)\n        .eq('user_id', userId)\n      if (error) throw error\n    } else {\n      const localData = getLocalData()\n      localData.assignments = localData.assignments?.filter(\n        a => !(a.project_id === projectId && a.user_id === userId)\n      ) || []\n      setLocalData(localData)\n    }\n  },\n\n  async getProjectAssignments(projectId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('project_assignments')\n        .select(`\n          user_id,\n          users (id, email, name, role)\n        `)\n        .eq('project_id', projectId)\n      if (error) throw error\n      return data.map(a => a.users)\n    } else {\n      const localData = getLocalData()\n      const assignments = localData.assignments?.filter(a => a.project_id === projectId) || []\n      return assignments.map(a => localData.users.find(u => u.id === a.user_id)).filter(Boolean)\n    }\n  },\n\n  // Get all users (for assignment dropdowns)\n  async getAllUsers() {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('users')\n        .select('*')\n        .order('name')\n      if (error) throw error\n      return data\n    } else {\n      return getLocalData().users || []\n    }\n  },\n\n  // Get all foremen\n  async getForemen() {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('users')\n        .select('*')\n        .eq('role', 'foreman')\n        .order('name')\n      if (error) throw error\n      return data\n    } else {\n      return (getLocalData().users || []).filter(u => u.role === 'foreman')\n    }\n  },\n\n  // ============================================\n  // Activity Logging\n  // ============================================\n\n  async logActivity(userId, projectId, areaId, action, oldValue, newValue) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('activity_log')\n        .insert({\n          user_id: userId,\n          project_id: projectId,\n          area_id: areaId,\n          action,\n          old_value: oldValue,\n          new_value: newValue\n        })\n      if (error) console.error('Error logging activity:', error)\n    }\n    // In demo mode, we skip logging\n  },\n\n  async getProjectActivity(projectId, limit = 50) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('activity_log')\n        .select(`\n          *,\n          users (name, email),\n          areas (name)\n        `)\n        .eq('project_id', projectId)\n        .order('created_at', { ascending: false })\n        .limit(limit)\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  // ============================================\n  // Materials & Equipment (Master List)\n  // ============================================\n\n  async getMaterialsEquipment(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('materials_equipment')\n        .select('*')\n        .eq('company_id', companyId)\n        .eq('active', true)\n        .order('category')\n        .order('name')\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  async getMaterialsEquipmentByCategory(companyId, category) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) return []\n      const { data, error } = await client\n        .from('materials_equipment')\n        .select('*')\n        .eq('company_id', companyId)\n        .eq('category', category)\n        .eq('active', true)\n        .order('name')\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  async getAllMaterialsEquipment(companyId) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) return []\n      const { data, error } = await client\n        .from('materials_equipment')\n        .select('*')\n        .eq('company_id', companyId)\n        .order('category')\n        .order('name')\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  async createMaterialEquipment(item) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('materials_equipment')\n        .insert(item)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async updateMaterialEquipment(id, updates) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('materials_equipment')\n        .update(updates)\n        .eq('id', id)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async deleteMaterialEquipment(id) {\n    if (isSupabaseConfigured) {\n      // Soft delete - just deactivate\n      const { error } = await supabase\n        .from('materials_equipment')\n        .update({ active: false })\n        .eq('id', id)\n      if (error) throw error\n    }\n  },\n\n  // ============================================\n  // Labor Categories & Classes (Company-specific)\n  // ============================================\n\n  // Get all labor categories for a company\n  async getLaborCategories(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('labor_categories')\n        .select('*')\n        .eq('company_id', companyId)\n        .eq('active', true)\n        .order('sort_order')\n        .order('name')\n      if (error) throw error\n      return data || []\n    }\n    return []\n  },\n\n  // Create a new labor category\n  async createLaborCategory(companyId, name, sortOrder = 0) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('labor_categories')\n        .insert({\n          company_id: companyId,\n          name,\n          sort_order: sortOrder\n        })\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Update a labor category\n  async updateLaborCategory(id, updates) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('labor_categories')\n        .update(updates)\n        .eq('id', id)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Delete (soft) a labor category\n  async deleteLaborCategory(id) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('labor_categories')\n        .update({ active: false })\n        .eq('id', id)\n      if (error) throw error\n    }\n  },\n\n  // Get all labor classes for a company (with category info)\n  async getLaborClasses(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('labor_classes')\n        .select(`\n          *,\n          labor_categories (id, name)\n        `)\n        .eq('company_id', companyId)\n        .eq('active', true)\n        .order('sort_order')\n        .order('name')\n      if (error) throw error\n      return data || []\n    }\n    return []\n  },\n\n  // Get labor classes with categories in one call (office use - includes all data)\n  async getLaborClassesWithCategories(companyId) {\n    if (isSupabaseConfigured) {\n      const [categoriesResult, classesResult] = await Promise.all([\n        supabase\n          .from('labor_categories')\n          .select('*')\n          .eq('company_id', companyId)\n          .eq('active', true)\n          .order('sort_order')\n          .order('name'),\n        supabase\n          .from('labor_classes')\n          .select('*')\n          .eq('company_id', companyId)\n          .eq('active', true)\n          .order('sort_order')\n          .order('name')\n      ])\n\n      if (categoriesResult.error) throw categoriesResult.error\n      if (classesResult.error) throw classesResult.error\n\n      return {\n        categories: categoriesResult.data || [],\n        classes: classesResult.data || []\n      }\n    }\n    return { categories: [], classes: [] }\n  },\n\n  // Get labor classes for field users (NO RATES - names and categories only)\n  // Use this for CrewCheckin and TMForm to prevent rate exposure\n  async getLaborClassesForField(companyId) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) return { categories: [], classes: [] }\n\n      // Use the secure RPC function that only returns non-sensitive fields\n      const { data, error } = await client\n        .rpc('get_labor_classes_for_field', { p_company_id: companyId })\n\n      if (error) {\n        console.error('Error loading field labor classes:', error)\n        // Fallback to direct query if RPC not available (pre-migration)\n        const [categoriesResult, classesResult] = await Promise.all([\n          client\n            .from('labor_categories')\n            .select('id, name')\n            .eq('company_id', companyId)\n            .eq('active', true)\n            .order('name'),\n          client\n            .from('labor_classes')\n            .select('id, name, category_id')\n            .eq('company_id', companyId)\n            .eq('active', true)\n            .order('name')\n        ])\n\n        return {\n          categories: categoriesResult.data || [],\n          classes: classesResult.data || []\n        }\n      }\n\n      // Transform RPC result into categories + classes format\n      const categoriesMap = new Map()\n      const classes = []\n\n      for (const row of (data || [])) {\n        if (row.category_id && row.category_name && !categoriesMap.has(row.category_id)) {\n          categoriesMap.set(row.category_id, { id: row.category_id, name: row.category_name })\n        }\n        classes.push({\n          id: row.id,\n          name: row.name,\n          category_id: row.category_id\n        })\n      }\n\n      return {\n        categories: Array.from(categoriesMap.values()),\n        classes\n      }\n    }\n    return { categories: [], classes: [] }\n  },\n\n  // Create a new labor class\n  async createLaborClass(companyId, categoryId, name, sortOrder = 0) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('labor_classes')\n        .insert({\n          company_id: companyId,\n          category_id: categoryId,\n          name,\n          sort_order: sortOrder\n        })\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Update a labor class\n  async updateLaborClass(id, updates) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('labor_classes')\n        .update(updates)\n        .eq('id', id)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Delete (soft) a labor class\n  async deleteLaborClass(id) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('labor_classes')\n        .update({ active: false })\n        .eq('id', id)\n      if (error) throw error\n    }\n  },\n\n  // Get rates for a specific labor class\n  async getLaborClassRates(laborClassId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('labor_class_rates')\n        .select('*')\n        .eq('labor_class_id', laborClassId)\n      if (error) throw error\n      return data || []\n    }\n    return []\n  },\n\n  // Get all rates for all classes in a company\n  async getAllLaborClassRates(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('labor_classes')\n        .select(`\n          id,\n          name,\n          labor_class_rates (*)\n        `)\n        .eq('company_id', companyId)\n        .eq('active', true)\n      if (error) throw error\n      return data || []\n    }\n    return []\n  },\n\n  // Save rates for a labor class (upsert)\n  async saveLaborClassRates(laborClassId, rates) {\n    if (isSupabaseConfigured) {\n      // rates is an array of { work_type, job_type, regular_rate, overtime_rate }\n      const ratesWithClassId = rates.map(r => ({\n        ...r,\n        labor_class_id: laborClassId\n      }))\n\n      // Upsert rates - will insert or update based on unique constraint\n      const { error } = await supabase\n        .from('labor_class_rates')\n        .upsert(ratesWithClassId, {\n          onConflict: 'labor_class_id,work_type,job_type'\n        })\n      if (error) throw error\n    }\n  },\n\n  // Get rate for a specific class/work_type/job_type combo (for cost calculations)\n  async getLaborClassRate(laborClassId, workType, jobType) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('labor_class_rates')\n        .select('regular_rate, overtime_rate')\n        .eq('labor_class_id', laborClassId)\n        .eq('work_type', workType)\n        .eq('job_type', jobType)\n        .single()\n      if (error && error.code !== 'PGRST116') throw error // PGRST116 = no rows\n      return data || null\n    }\n    return null\n  },\n\n  // ============================================\n  // T&M Tickets\n  // ============================================\n\n  async getTMTickets(projectId) {\n    if (isSupabaseConfigured) {\n      const start = performance.now()\n      const client = getClient()\n      const inFieldMode = isFieldMode()\n\n      // SECURITY: Exclude cost_per_unit for field users to protect pricing data\n      const materialsSelect = inFieldMode\n        ? 'materials_equipment (name, unit, category)' // No cost_per_unit for field users\n        : 'materials_equipment (name, unit, cost_per_unit, category)' // Full data for office\n\n      try {\n        const { data, error } = await client\n          .from('t_and_m_tickets')\n          .select(`\n            *,\n            t_and_m_workers (*),\n            t_and_m_items (\n              *,\n              ${materialsSelect}\n            )\n          `)\n          .eq('project_id', projectId)\n          .order('created_at', { ascending: false })\n\n        const duration = Math.round(performance.now() - start)\n        observe.query('getTMTickets', { duration, rows: data?.length, project_id: projectId })\n\n        if (error) throw error\n        return data\n      } catch (error) {\n        observe.error('database', {\n          message: error.message,\n          operation: 'getTMTickets',\n          project_id: projectId\n        })\n        throw error\n      }\n    }\n    return []\n  },\n\n  // Get T&M tickets with pagination for scalability\n  async getTMTicketsPaginated(projectId, { page = 0, limit = 25, status = null } = {}) {\n    if (isSupabaseConfigured) {\n      const start = performance.now()\n      const client = getClient()\n      const inFieldMode = isFieldMode()\n\n      // SECURITY: Exclude cost_per_unit for field users to protect pricing data\n      const materialsSelect = inFieldMode\n        ? 'materials_equipment (name, unit, category)'\n        : 'materials_equipment (name, unit, cost_per_unit, category)'\n\n      try {\n        let query = client\n          .from('t_and_m_tickets')\n          .select(`\n            *,\n            t_and_m_workers (*),\n            t_and_m_items (\n              *,\n              ${materialsSelect}\n            )\n          `, { count: 'exact' })\n          .eq('project_id', projectId)\n          .order('created_at', { ascending: false })\n          .range(page * limit, (page + 1) * limit - 1)\n\n        if (status) {\n          query = query.eq('status', status)\n        }\n\n        const { data, error, count } = await query\n\n        const duration = Math.round(performance.now() - start)\n        observe.query('getTMTicketsPaginated', { duration, rows: data?.length, page, project_id: projectId })\n\n        if (error) throw error\n\n        return {\n          tickets: data || [],\n          totalCount: count || 0,\n          hasMore: (page + 1) * limit < (count || 0),\n          page,\n          limit\n        }\n      } catch (error) {\n        observe.error('database', {\n          message: error.message,\n          operation: 'getTMTicketsPaginated',\n          project_id: projectId\n        })\n        throw error\n      }\n    }\n    return { tickets: [], totalCount: 0, hasMore: false, page: 0, limit: 25 }\n  },\n\n  // Get change order totals for a project\n  async getChangeOrderTotals(projectId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('t_and_m_tickets')\n        .select('ce_pco_number, change_order_value, status')\n        .eq('project_id', projectId)\n        .not('ce_pco_number', 'is', null)\n        .neq('ce_pco_number', '')\n\n      if (error) throw error\n\n      // Group by CE/PCO number\n      const changeOrders = {}\n      let totalApproved = 0\n      let totalPending = 0\n\n      data?.forEach(ticket => {\n        const ceNumber = ticket.ce_pco_number\n        if (!changeOrders[ceNumber]) {\n          changeOrders[ceNumber] = { approved: 0, pending: 0, count: 0 }\n        }\n        changeOrders[ceNumber].count++\n\n        if (ticket.status === 'approved' || ticket.status === 'billed') {\n          const value = parseFloat(ticket.change_order_value) || 0\n          changeOrders[ceNumber].approved += value\n          totalApproved += value\n        } else if (ticket.status === 'pending') {\n          totalPending++\n        }\n      })\n\n      return {\n        changeOrders,\n        totalApprovedValue: totalApproved,\n        pendingCount: totalPending\n      }\n    }\n    return { changeOrders: {}, totalApprovedValue: 0, pendingCount: 0 }\n  },\n\n  async getTMTicketsByStatus(projectId, status) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) return []\n\n      const { data, error } = await client\n        .from('t_and_m_tickets')\n        .select(`\n          *,\n          t_and_m_workers (*),\n          t_and_m_items (\n            *,\n            materials_equipment (name, unit, cost_per_unit, category)\n          )\n        `)\n        .eq('project_id', projectId)\n        .eq('status', status)\n        .order('created_at', { ascending: false })\n      if (error) throw error\n      return data\n    }\n    return []\n  },\n\n  // Get T&M tickets associated with a COR (for backup documentation)\n  async getCORTickets(corId) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) return []\n\n      const { data, error } = await client\n        .from('t_and_m_tickets')\n        .select(`\n          *,\n          t_and_m_workers (*),\n          t_and_m_items (\n            *,\n            materials_equipment (name, unit, cost_per_unit, category)\n          )\n        `)\n        .eq('assigned_cor_id', corId)\n        .order('work_date', { ascending: true })\n      if (error) throw error\n      return data || []\n    }\n    return []\n  },\n\n  async createTMTicket(ticket) {\n    if (isSupabaseConfigured) {\n      // If offline, cache ticket and queue action\n      if (!getConnectionStatus()) {\n        const tempTicket = {\n          id: generateTempId(),\n          project_id: ticket.project_id,\n          work_date: ticket.work_date,\n          ce_pco_number: ticket.ce_pco_number || null,\n          assigned_cor_id: ticket.assigned_cor_id || null,\n          notes: ticket.notes,\n          photos: ticket.photos || [],\n          status: 'pending_sync',\n          created_by_name: ticket.created_by_name || 'Field User',\n          created_at: new Date().toISOString(),\n          _offline: true\n        }\n        await cacheTMTicket(tempTicket)\n        await addPendingAction(ACTION_TYPES.CREATE_TM_TICKET, {\n          ticket: tempTicket,\n          workers: ticket._workers || [],\n          items: ticket._items || []\n        })\n        return tempTicket\n      }\n\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n      const { data, error } = await client\n        .from('t_and_m_tickets')\n        .insert({\n          project_id: ticket.project_id,\n          work_date: ticket.work_date,\n          ce_pco_number: ticket.ce_pco_number || null,\n          assigned_cor_id: ticket.assigned_cor_id || null, // Link to COR if provided\n          notes: ticket.notes,\n          photos: ticket.photos || [],\n          status: 'pending',\n          created_by_name: ticket.created_by_name || 'Field User'\n        })\n        .select()\n        .single()\n\n      if (error) {\n        // If network error, queue for later\n        if (error.message?.includes('fetch') || error.message?.includes('network')) {\n          const tempTicket = {\n            id: generateTempId(),\n            ...ticket,\n            status: 'pending_sync',\n            _offline: true\n          }\n          await cacheTMTicket(tempTicket)\n          await addPendingAction(ACTION_TYPES.CREATE_TM_TICKET, {\n            ticket: tempTicket,\n            workers: ticket._workers || [],\n            items: ticket._items || []\n          })\n          return tempTicket\n        }\n        throw error\n      }\n      return data\n    }\n    return null\n  },\n\n  async addTMWorkers(ticketId, workers) {\n    if (isSupabaseConfigured) {\n      const workersData = workers.map(w => ({\n        ticket_id: ticketId,\n        name: w.name,\n        hours: w.hours,\n        overtime_hours: w.overtime_hours || 0,\n        time_started: w.time_started || null,\n        time_ended: w.time_ended || null,\n        role: w.role || 'Laborer'\n      }))\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n      const { error } = await client\n        .from('t_and_m_workers')\n        .insert(workersData)\n      if (error) throw error\n    }\n  },\n\n  async addTMItems(ticketId, items) {\n    if (isSupabaseConfigured) {\n      const itemsData = items.map(item => ({\n        ticket_id: ticketId,\n        material_equipment_id: item.material_equipment_id || null,\n        custom_name: item.custom_name || null,\n        custom_category: item.custom_category || null,\n        quantity: item.quantity\n      }))\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n      const { error } = await client\n        .from('t_and_m_items')\n        .insert(itemsData)\n      if (error) throw error\n    }\n  },\n\n  // Get the most recent ticket's crew for \"Same as Yesterday\" feature\n  async getPreviousTicketCrew(projectId, beforeDate) {\n    if (!isSupabaseConfigured) return null\n\n    const client = getClient()\n    if (!client) return null\n\n    // Find the most recent ticket before the given date\n    const { data: ticket, error } = await client\n      .from('t_and_m_tickets')\n      .select(`\n        id,\n        work_date,\n        t_and_m_workers (*)\n      `)\n      .eq('project_id', projectId)\n      .lt('work_date', beforeDate)\n      .order('work_date', { ascending: false })\n      .limit(1)\n      .maybeSingle() // Use maybeSingle to return null instead of 406 when no previous tickets\n\n    if (error || !ticket) return null\n\n    // Group workers by role\n    const workers = ticket.t_and_m_workers || []\n\n    // Check if any workers have labor_class_id (indicates custom labor classes)\n    const hasCustomClasses = workers.some(w => w.labor_class_id)\n\n    // Build dynamic workers structure for custom labor classes\n    const dynamicWorkers = {}\n    if (hasCustomClasses) {\n      workers.forEach(w => {\n        if (w.labor_class_id) {\n          if (!dynamicWorkers[w.labor_class_id]) {\n            dynamicWorkers[w.labor_class_id] = []\n          }\n          dynamicWorkers[w.labor_class_id].push({\n            name: w.name,\n            hours: w.hours?.toString() || '',\n            overtimeHours: w.overtime_hours?.toString() || '',\n            timeStarted: w.time_started || '',\n            timeEnded: w.time_ended || ''\n          })\n        }\n      })\n    }\n\n    // Build legacy worker arrays\n    const supervision = workers\n      .filter(w => ['Foreman', 'General Foreman', 'Superintendent'].includes(w.role))\n      .map(w => ({\n        name: w.name,\n        hours: w.hours?.toString() || '',\n        overtimeHours: w.overtime_hours?.toString() || '',\n        timeStarted: w.time_started || '',\n        timeEnded: w.time_ended || '',\n        role: w.role\n      }))\n\n    const operators = workers\n      .filter(w => w.role === 'Operator')\n      .map(w => ({\n        name: w.name,\n        hours: w.hours?.toString() || '',\n        overtimeHours: w.overtime_hours?.toString() || '',\n        timeStarted: w.time_started || '',\n        timeEnded: w.time_ended || ''\n      }))\n\n    const laborers = workers\n      .filter(w => w.role === 'Laborer')\n      .map(w => ({\n        name: w.name,\n        hours: w.hours?.toString() || '',\n        overtimeHours: w.overtime_hours?.toString() || '',\n        timeStarted: w.time_started || '',\n        timeEnded: w.time_ended || ''\n      }))\n\n    return {\n      workDate: ticket.work_date,\n      supervision: supervision.length > 0 ? supervision : null,\n      operators: operators.length > 0 ? operators : null,\n      laborers: laborers.length > 0 ? laborers : null,\n      dynamicWorkers: Object.keys(dynamicWorkers).length > 0 ? dynamicWorkers : null,\n      totalWorkers: workers.length\n    }\n  },\n\n  async updateTMTicketStatus(ticketId, status) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n      const { data, error } = await client\n        .from('t_and_m_tickets')\n        .update({ status })\n        .eq('id', ticketId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Approve T&M ticket (with certification and optional change order value)\n  async approveTMTicket(ticketId, userId, userName, changeOrderValue = null) {\n    if (isSupabaseConfigured) {\n      const updateData = {\n        status: 'approved',\n        approved_by_user_id: userId,\n        approved_by_name: userName,\n        approved_at: new Date().toISOString(),\n        // Clear any previous rejection\n        rejected_by_user_id: null,\n        rejected_by_name: null,\n        rejected_at: null,\n        rejection_reason: null\n      }\n\n      // Add change order value if provided (for tickets with CE/PCO)\n      if (changeOrderValue !== null) {\n        updateData.change_order_value = parseFloat(changeOrderValue) || 0\n      }\n\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n      const { data, error } = await client\n        .from('t_and_m_tickets')\n        .update(updateData)\n        .eq('id', ticketId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Reject T&M ticket (with reason)\n  async rejectTMTicket(ticketId, userId, userName, reason = '') {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n      const { data, error } = await client\n        .from('t_and_m_tickets')\n        .update({\n          status: 'rejected',\n          rejected_by_user_id: userId,\n          rejected_by_name: userName,\n          rejected_at: new Date().toISOString(),\n          rejection_reason: reason,\n          // Clear any previous approval\n          approved_by_user_id: null,\n          approved_by_name: null,\n          approved_at: null\n        })\n        .eq('id', ticketId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Check if user role can approve T&M tickets\n  canApproveTickets(role) {\n    const approverRoles = ['owner', 'admin', 'manager']\n    return approverRoles.includes(role)\n  },\n\n  async updateTMTicketPhotos(ticketId, photos) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n      const { data, error } = await client\n        .from('t_and_m_tickets')\n        .update({ photos })\n        .eq('id', ticketId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Save client signature directly to T&M ticket (on-site signing)\n  async saveTMClientSignature(ticketId, signatureData) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n      const { data, error } = await client\n        .from('t_and_m_tickets')\n        .update({\n          client_signature_data: signatureData.signature,\n          client_signature_name: signatureData.signerName,\n          client_signature_title: signatureData.signerTitle,\n          client_signature_company: signatureData.signerCompany,\n          client_signature_date: signatureData.signedAt,\n          client_signature_ip: null, // Not available in on-site signing\n          status: 'client_signed' // Update status to indicate client has signed\n        })\n        .eq('id', ticketId)\n        .select()\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  async deleteTMTicket(ticketId) {\n    if (isSupabaseConfigured) {\n      const client = getClient()\n      if (!client) {\n        throw new Error('Database client not available')\n      }\n      // Workers and items cascade delete automatically\n      const { error } = await client\n        .from('t_and_m_tickets')\n        .delete()\n        .eq('id', ticketId)\n      if (error) throw error\n    }\n  },\n\n  // Check if a T&M ticket can be edited\n  // Tickets are locked once their associated COR is approved/billed/closed\n  async isTicketEditable(ticket) {\n    // If no assigned COR, ticket is editable\n    if (!ticket?.assigned_cor_id) {\n      return { editable: true }\n    }\n\n    if (isSupabaseConfigured) {\n      try {\n        const { data: cor, error } = await supabase\n          .from('change_orders')\n          .select('id, status, cor_number')\n          .eq('id', ticket.assigned_cor_id)\n          .single()\n\n        if (error || !cor) {\n          // COR not found - allow editing\n          return { editable: true }\n        }\n\n        // Only draft and pending_approval CORs allow ticket editing\n        const editableStatuses = ['draft', 'pending_approval']\n        const isEditable = editableStatuses.includes(cor.status)\n\n        return {\n          editable: isEditable,\n          lockedBy: isEditable ? null : cor,\n          reason: isEditable ? null : `This ticket is linked to ${cor.cor_number} which has been ${cor.status === 'approved' ? 'approved' : cor.status}`\n        }\n      } catch (err) {\n        console.error('Error checking ticket editability:', err)\n        // On error, allow editing to avoid blocking users\n        return { editable: true }\n      }\n    }\n\n    return { editable: true }\n  },\n\n  // ============================================\n  // Companies\n  // ============================================\n\n  async getCompanyByCode(code) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('companies')\n        .select('*')\n        .eq('code', code)\n        .single()\n      if (error) return null\n      return data\n    }\n    return null\n  },\n\n  async getCompany(id) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('companies')\n        .select('*')\n        .eq('id', id)\n        .single()\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Get all companies a user has ACTIVE access to\n  async getUserCompanies(userId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('user_companies')\n        .select(`\n          id,\n          access_level,\n          company_id,\n          status,\n          companies (\n            id,\n            name,\n            code\n          )\n        `)\n        .eq('user_id', userId)\n        .eq('status', 'active')\n        .order('created_at', { ascending: true })\n\n      if (error) {\n        console.error('Error fetching user companies:', error)\n        return []\n      }\n\n      // Flatten the response\n      return data.map(uc => ({\n        id: uc.companies.id,\n        name: uc.companies.name,\n        code: uc.companies.code,\n        access_level: uc.access_level\n      }))\n    }\n    return []\n  },\n\n  // Get count of pending memberships for a user\n  async getUserPendingMemberships(userId) {\n    if (isSupabaseConfigured) {\n      const { count, error } = await supabase\n        .from('user_companies')\n        .select('*', { count: 'exact', head: true })\n        .eq('user_id', userId)\n        .eq('status', 'pending')\n\n      if (error) {\n        console.error('Error fetching pending memberships:', error)\n        return 0\n      }\n      return count || 0\n    }\n    return 0\n  },\n\n  // Get all memberships for a company (for admin view)\n  async getCompanyMemberships(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('user_companies')\n        .select(`\n          id,\n          access_level,\n          company_role,\n          status,\n          created_at,\n          approved_at,\n          approved_by,\n          removed_at,\n          removed_by,\n          users!user_companies_user_id_fkey (\n            id,\n            name,\n            email\n          )\n        `)\n        .eq('company_id', companyId)\n        .order('created_at', { ascending: false })\n\n      if (error) {\n        console.error('Error fetching company memberships:', error)\n        return []\n      }\n      return data || []\n    }\n    return []\n  },\n\n  // Approve a pending membership\n  async approveMembership(membershipId, approvedBy) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('user_companies')\n        .update({\n          status: 'active',\n          approved_at: new Date().toISOString(),\n          approved_by: approvedBy\n        })\n        .eq('id', membershipId)\n\n      if (error) throw error\n    }\n  },\n\n  // Approve a pending membership with access level assignment (uses RPC for security)\n  async approveMembershipWithRole(membershipId, approvedBy, accessLevel = 'member') {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase.rpc('approve_membership_with_role', {\n        membership_id: membershipId,\n        approved_by_user: approvedBy,\n        new_access_level: accessLevel\n      })\n\n      if (error) throw error\n    }\n  },\n\n  // Reject a pending membership (hard delete)\n  async rejectMembership(membershipId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('user_companies')\n        .delete()\n        .eq('id', membershipId)\n\n      if (error) throw error\n    }\n  },\n\n  // Remove an active member (soft delete)\n  async removeMember(membershipId, removedBy) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('user_companies')\n        .update({\n          status: 'removed',\n          removed_at: new Date().toISOString(),\n          removed_by: removedBy\n        })\n        .eq('id', membershipId)\n\n      if (error) throw error\n    }\n  },\n\n  // ============================================\n  // Project Team Management\n  // ============================================\n\n  // Get all team members assigned to a project\n  async getProjectTeam(projectId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('project_users')\n        .select(`\n          id,\n          project_role,\n          assigned_at,\n          notes,\n          users!project_users_user_id_fkey (\n            id,\n            name,\n            email\n          )\n        `)\n        .eq('project_id', projectId)\n        .order('assigned_at', { ascending: true })\n\n      if (error) {\n        console.error('Error fetching project team:', error)\n        return []\n      }\n      return data || []\n    }\n    return []\n  },\n\n  // Get all company members (for adding to project)\n  async getCompanyMembers(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('user_companies')\n        .select(`\n          id,\n          access_level,\n          users!user_companies_user_id_fkey (\n            id,\n            name,\n            email\n          )\n        `)\n        .eq('company_id', companyId)\n        .eq('status', 'active')\n        .order('created_at', { ascending: true })\n\n      if (error) {\n        console.error('Error fetching company members:', error)\n        return []\n      }\n      return data || []\n    }\n    return []\n  },\n\n  // Add a user to a project with a role\n  async addProjectMember(projectId, userId, projectRole, assignedBy) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('project_users')\n        .insert({\n          project_id: projectId,\n          user_id: userId,\n          project_role: projectRole,\n          assigned_by: assignedBy\n        })\n        .select()\n        .single()\n\n      if (error) throw error\n      return data\n    }\n    return null\n  },\n\n  // Update a project member's role\n  async updateProjectMemberRole(projectId, userId, newRole) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('project_users')\n        .update({ project_role: newRole })\n        .eq('project_id', projectId)\n        .eq('user_id', userId)\n\n      if (error) throw error\n    }\n  },\n\n  // Remove a user from a project\n  async removeProjectMember(projectId, userId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('project_users')\n        .delete()\n        .eq('project_id', projectId)\n        .eq('user_id', userId)\n\n      if (error) throw error\n    }\n  },\n\n  // Update a member's access level\n  async updateMemberAccessLevel(membershipId, newAccessLevel) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('user_companies')\n        .update({ access_level: newAccessLevel })\n        .eq('id', membershipId)\n\n      if (error) throw error\n    }\n  },\n\n  // Update a member's company role (job title)\n  async updateMemberCompanyRole(membershipId, newCompanyRole) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('user_companies')\n        .update({ company_role: newCompanyRole })\n        .eq('id', membershipId)\n\n      if (error) throw error\n    }\n  },\n\n  // Repair legacy user - creates missing user_companies record\n  // Called when user has company_id but no active memberships\n  // Uses RPC function to bypass RLS restrictions\n  async repairLegacyUser(userId, companyId, role = 'member') {\n    if (!isSupabaseConfigured || !userId || !companyId) return false\n\n    try {\n      // Use RPC function which has SECURITY DEFINER to bypass RLS\n      const { data, error } = await supabase.rpc('repair_legacy_user', {\n        p_user_id: userId,\n        p_company_id: companyId,\n        p_role: role\n      })\n\n      if (error) {\n        console.error('RPC repair_legacy_user failed:', error)\n        return false\n      }\n\n      return data === true\n    } catch (error) {\n      console.error('Error repairing legacy user:', error)\n      return false\n    }\n  },\n\n  // Check if user is a legacy user (has company_id but no memberships)\n  async isLegacyUser(userId) {\n    if (!isSupabaseConfigured) return false\n\n    try {\n      // Get user's company_id\n      const { data: user } = await supabase\n        .from('users')\n        .select('company_id, role')\n        .eq('id', userId)\n        .single()\n\n      if (!user?.company_id) return false\n\n      // Check if any user_companies records exist\n      const { count } = await supabase\n        .from('user_companies')\n        .select('*', { count: 'exact', head: true })\n        .eq('user_id', userId)\n\n      // Legacy user if has company_id but no memberships\n      return count === 0\n    } catch (error) {\n      console.error('Error checking legacy user:', error)\n      return false\n    }\n  },\n\n  // ============================================\n  // Disposal Load Tracking\n  // ============================================\n\n  // Load type options (matches database enum)\n  DISPOSAL_LOAD_TYPES: [\n    { value: 'concrete', label: 'Concrete' },\n    { value: 'trash', label: 'Trash' },\n    { value: 'metals', label: 'Metals' },\n    { value: 'hazardous_waste', label: 'Hazardous Waste' }\n  ],\n\n  // Get disposal loads for a specific date\n  async getDisposalLoads(projectId, date) {\n    if (!isSupabaseConfigured) return []\n\n    const client = getClient()\n    if (!client) return []\n\n    const start = performance.now()\n    try {\n      const { data, error } = await client\n        .from('disposal_loads')\n        .select('*')\n        .eq('project_id', projectId)\n        .eq('work_date', date)\n        .order('created_at', { ascending: false })\n\n      const duration = Math.round(performance.now() - start)\n      observe.query('getDisposalLoads', { duration, rows: data?.length, project_id: projectId })\n\n      if (error) throw error\n      return data || []\n    } catch (error) {\n      observe.error('database', { message: error.message, operation: 'getDisposalLoads', project_id: projectId })\n      throw error\n    }\n  },\n\n  // Get disposal loads history for the last N days\n  async getDisposalLoadsHistory(projectId, days = 14) {\n    if (!isSupabaseConfigured) return []\n\n    const client = getClient()\n    if (!client) return []\n\n    const start = performance.now()\n    try {\n      // Calculate date range\n      const endDate = new Date()\n      const startDate = new Date()\n      startDate.setDate(startDate.getDate() - days)\n\n      const { data, error } = await client\n        .from('disposal_loads')\n        .select('*')\n        .eq('project_id', projectId)\n        .gte('work_date', startDate.toISOString().split('T')[0])\n        .lte('work_date', endDate.toISOString().split('T')[0])\n        .order('work_date', { ascending: false })\n\n      const duration = Math.round(performance.now() - start)\n      observe.query('getDisposalLoadsHistory', { duration, rows: data?.length, project_id: projectId })\n\n      if (error) throw error\n      // Map work_date to load_date for compatibility\n      return (data || []).map(d => ({ ...d, load_date: d.work_date }))\n    } catch (error) {\n      observe.error('database', { message: error.message, operation: 'getDisposalLoadsHistory', project_id: projectId })\n      throw error\n    }\n  },\n\n  // Add a new disposal load entry\n  async addDisposalLoad(projectId, userId, workDate, loadType, loadCount, notes = null) {\n    if (!isSupabaseConfigured) return null\n\n    const client = getClient()\n    if (!client) {\n      throw new Error('Database client not available')\n    }\n\n    const { data, error } = await client\n      .from('disposal_loads')\n      .insert({\n        project_id: projectId,\n        user_id: userId,\n        work_date: workDate,\n        load_type: loadType,\n        load_count: loadCount,\n        notes\n      })\n      .select()\n      .single()\n\n    if (error) {\n      observe.error('database', { message: error.message, operation: 'addDisposalLoad', project_id: projectId })\n      throw error\n    }\n    return data\n  },\n\n  // Update an existing disposal load entry\n  async updateDisposalLoad(id, loadType, loadCount, notes = null) {\n    if (!isSupabaseConfigured) return null\n\n    const client = getClient()\n    if (!client) {\n      throw new Error('Database client not available')\n    }\n\n    const { data, error } = await client\n      .from('disposal_loads')\n      .update({\n        load_type: loadType,\n        load_count: loadCount,\n        notes\n      })\n      .eq('id', id)\n      .select()\n      .single()\n\n    if (error) {\n      observe.error('database', { message: error.message, operation: 'updateDisposalLoad' })\n      throw error\n    }\n    return data\n  },\n\n  // Delete a disposal load entry\n  async deleteDisposalLoad(id) {\n    if (!isSupabaseConfigured) return false\n\n    const client = getClient()\n    if (!client) {\n      throw new Error('Database client not available')\n    }\n\n    const { error } = await client\n      .from('disposal_loads')\n      .delete()\n      .eq('id', id)\n\n    if (error) {\n      observe.error('database', { message: error.message, operation: 'deleteDisposalLoad' })\n      throw error\n    }\n    return true\n  },\n\n  // Get disposal summary for burn rate view\n  async getDisposalSummary(projectId, startDate = null, endDate = null) {\n    if (!isSupabaseConfigured) return []\n\n    const client = getClient()\n    if (!client) return []\n\n    const start = performance.now()\n    try {\n      // Use RPC function for efficient aggregation\n      const { data, error } = await client.rpc('get_disposal_summary', {\n        p_project_id: projectId,\n        p_start_date: startDate,\n        p_end_date: endDate\n      })\n\n      const duration = Math.round(performance.now() - start)\n      observe.query('getDisposalSummary', { duration, rows: data?.length, project_id: projectId })\n\n      if (error) throw error\n      return data || []\n    } catch (error) {\n      observe.error('database', { message: error.message, operation: 'getDisposalSummary', project_id: projectId })\n      // Fallback to direct query if RPC doesn't exist\n      return this.getDisposalSummaryFallback(projectId, startDate, endDate)\n    }\n  },\n\n  // Fallback aggregation (if RPC not available)\n  async getDisposalSummaryFallback(projectId, startDate, endDate) {\n    const client = getClient() || supabase\n    let query = client\n      .from('disposal_loads')\n      .select('load_type, load_count, work_date')\n      .eq('project_id', projectId)\n\n    if (startDate) {\n      query = query.gte('work_date', startDate)\n    }\n    if (endDate) {\n      query = query.lte('work_date', endDate)\n    }\n\n    const { data, error } = await query\n    if (error) throw error\n\n    // Aggregate in JS\n    const summary = {}\n    data?.forEach(row => {\n      if (!summary[row.load_type]) {\n        summary[row.load_type] = { load_type: row.load_type, total_loads: 0, days: new Set() }\n      }\n      summary[row.load_type].total_loads += row.load_count\n      summary[row.load_type].days.add(row.work_date)\n    })\n\n    return Object.values(summary).map(s => ({\n      load_type: s.load_type,\n      total_loads: s.total_loads,\n      days_with_activity: s.days.size\n    }))\n  },\n\n  // Get weekly disposal summary for charts\n  async getWeeklyDisposalSummary(projectId, weeks = 4) {\n    if (!isSupabaseConfigured) return []\n\n    const client = getClient()\n    if (!client) return []\n\n    const endDate = new Date()\n    const startDate = new Date()\n    startDate.setDate(startDate.getDate() - (weeks * 7))\n\n    const { data, error } = await client\n      .from('disposal_loads')\n      .select('load_type, load_count, work_date')\n      .eq('project_id', projectId)\n      .gte('work_date', startDate.toISOString().split('T')[0])\n      .lte('work_date', endDate.toISOString().split('T')[0])\n      .order('work_date', { ascending: true })\n\n    if (error) throw error\n\n    // Group by week and load type\n    const weeklyData = {}\n    data?.forEach(row => {\n      const date = new Date(row.work_date)\n      const weekStart = new Date(date)\n      weekStart.setDate(date.getDate() - date.getDay())\n      const weekKey = weekStart.toISOString().split('T')[0]\n\n      if (!weeklyData[weekKey]) {\n        weeklyData[weekKey] = { week: weekKey, concrete: 0, trash: 0, metals: 0, hazardous_waste: 0 }\n      }\n      weeklyData[weekKey][row.load_type] += row.load_count\n    })\n\n    return Object.values(weeklyData).sort((a, b) => a.week.localeCompare(b.week))\n  },\n\n  // ============================================\n  // Photo Storage\n  // ============================================\n\n  async uploadPhoto(companyId, projectId, ticketId, file) {\n    if (!isSupabaseConfigured) return null\n\n    const client = getClient()\n    if (!client) {\n      throw new Error('Database client not available')\n    }\n\n    const start = performance.now()\n    const fileSize = file.size || 0\n\n    // Create unique filename with secure random ID\n    const timestamp = Date.now()\n    const array = new Uint8Array(6)\n    crypto.getRandomValues(array)\n    const randomId = Array.from(array, b => b.toString(36)).join('')\n    const extension = file.name?.split('.').pop() || 'jpg'\n    const fileName = `${timestamp}-${randomId}.${extension}`\n\n    // Path: company/project/ticket/filename\n    const filePath = `${companyId}/${projectId}/${ticketId}/${fileName}`\n\n    try {\n      const { data, error } = await client.storage\n        .from('tm-photos')\n        .upload(filePath, file, {\n          cacheControl: '3600',\n          upsert: false\n        })\n\n      const duration = Math.round(performance.now() - start)\n      observe.storage('upload', {\n        company_id: companyId,\n        project_id: projectId,\n        size: fileSize,\n        duration,\n        success: !error\n      })\n\n      if (error) throw error\n\n      // Return the storage path. Callers store this in the DB.\n      // Use db.resolvePhotoUrl(path) to get a displayable signed URL.\n      return filePath\n    } catch (error) {\n      observe.error('storage', {\n        message: error.message,\n        operation: 'uploadPhoto',\n        company_id: companyId,\n        project_id: projectId\n      })\n      throw error\n    }\n  },\n\n  async uploadPhotoBase64(companyId, projectId, ticketId, base64Data, fileName = 'photo.jpg') {\n    if (!isSupabaseConfigured) return null\n\n    const client = getClient()\n    if (!client) {\n      throw new Error('Database client not available')\n    }\n\n    // Convert base64 to blob\n    const base64Response = await fetch(base64Data)\n    const blob = await base64Response.blob()\n\n    // Create unique filename with secure random ID\n    const timestamp = Date.now()\n    const array = new Uint8Array(6)\n    crypto.getRandomValues(array)\n    const randomId = Array.from(array, b => b.toString(36)).join('')\n    const extension = fileName.split('.').pop() || 'jpg'\n    const newFileName = `${timestamp}-${randomId}.${extension}`\n\n    // Path: company/project/ticket/filename\n    const filePath = `${companyId}/${projectId}/${ticketId}/${newFileName}`\n\n    const { data, error } = await client.storage\n      .from('tm-photos')\n      .upload(filePath, blob, {\n        cacheControl: '3600',\n        upsert: false,\n        contentType: blob.type\n      })\n\n    if (error) throw error\n\n    // Return the storage path (bucket is now private; use resolvePhotoUrl for display).\n    return filePath\n  },\n\n  // Convert a stored photo URL or storage path to a signed URL (1-hour expiry).\n  // Handles both old public URLs (\"https:///public/tm-photos/\") and\n  // new storage paths (\"companyId/projectId/ticketId/file.jpg\") transparently.\n  async resolvePhotoUrl(urlOrPath) {\n    if (!urlOrPath || !isSupabaseConfigured) return urlOrPath\n    let filePath\n    if (urlOrPath.startsWith('http')) {\n      try {\n        const urlObj = new URL(urlOrPath)\n        const match = urlObj.pathname.match(/\\/(?:public\\/)?tm-photos\\/(.+)$/)\n        if (!match) return urlOrPath\n        filePath = decodeURIComponent(match[1])\n      } catch { return urlOrPath }\n    } else {\n      filePath = urlOrPath\n    }\n    try {\n      const client = getSupabaseClient()\n      const { data, error } = await client.storage.from('tm-photos').createSignedUrl(filePath, 3600)\n      if (error || !data?.signedUrl) return urlOrPath\n      return data.signedUrl\n    } catch { return urlOrPath }\n  },\n\n  // Batch-convert an array of stored photo URLs/paths to signed URLs (1-hour expiry).\n  async resolvePhotoUrls(urlsOrPaths) {\n    if (!isSupabaseConfigured || !urlsOrPaths?.length) return urlsOrPaths || []\n    const paths = []\n    const indices = []\n    for (let i = 0; i < urlsOrPaths.length; i++) {\n      const v = urlsOrPaths[i]\n      if (!v) continue\n      let fp\n      if (v.startsWith('http')) {\n        try {\n          const urlObj = new URL(v)\n          const match = urlObj.pathname.match(/\\/(?:public\\/)?tm-photos\\/(.+)$/)\n          if (match) fp = decodeURIComponent(match[1])\n        } catch { /* skip */ }\n      } else {\n        fp = v\n      }\n      if (fp) { paths.push(fp); indices.push(i) }\n    }\n    if (!paths.length) return urlsOrPaths\n    try {\n      const client = getSupabaseClient()\n      const { data, error } = await client.storage.from('tm-photos').createSignedUrls(paths, 3600)\n      if (error || !data) return urlsOrPaths\n      const result = [...urlsOrPaths]\n      data.forEach((item, j) => {\n        if (item.signedUrl) result[indices[j]] = item.signedUrl\n      })\n      return result\n    } catch { return urlsOrPaths }\n  },\n\n  async deletePhoto(photoUrlOrPath) {\n    if (!isSupabaseConfigured || !photoUrlOrPath) return\n\n    let filePath\n    if (photoUrlOrPath.startsWith('http')) {\n      // Legacy: extract path from a full public URL\n      try {\n        const url = new URL(photoUrlOrPath)\n        const pathMatch = url.pathname.match(/\\/tm-photos\\/(.+)$/)\n        if (!pathMatch) return\n        filePath = pathMatch[1]\n      } catch { return }\n    } else {\n      // New format: already a storage path\n      filePath = photoUrlOrPath\n    }\n\n    const { error } = await supabase.storage\n      .from('tm-photos')\n      .remove([filePath])\n\n    if (error) throw error\n  },\n\n  // ============================================\n  // Photo Verification & Reliability\n  // ============================================\n\n  // Verify that a photo path/URL exists in storage.\n  // Uses createSignedUrl (works with private bucket) instead of a HEAD request.\n  async verifyPhotoAccessible(photoUrlOrPath) {\n    if (!isSupabaseConfigured || !photoUrlOrPath) return { accessible: false, error: 'Invalid input' }\n\n    let filePath\n    if (photoUrlOrPath.startsWith('http')) {\n      try {\n        const urlObj = new URL(photoUrlOrPath)\n        const match = urlObj.pathname.match(/\\/(?:public\\/)?tm-photos\\/(.+)$/)\n        if (!match) return { accessible: false, error: 'Not a tm-photos URL' }\n        filePath = decodeURIComponent(match[1])\n      } catch {\n        return { accessible: false, error: 'Invalid URL' }\n      }\n    } else {\n      filePath = photoUrlOrPath\n    }\n\n    try {\n      const { data, error } = await supabase.storage\n        .from('tm-photos')\n        .createSignedUrl(filePath, 60)\n      if (error) return { accessible: false, error: error.message }\n      return { accessible: !!data?.signedUrl, status: 200 }\n    } catch (error) {\n      return { accessible: false, error: error.message || 'Verification failed' }\n    }\n  },\n\n  // Verify all photos for a ticket and update verification status\n  async verifyTicketPhotos(ticketId) {\n    if (!isSupabaseConfigured) return { verified: false, issues: [] }\n\n    try {\n      // Get ticket with photos\n      const { data: ticket, error: ticketError } = await supabase\n        .from('t_and_m_tickets')\n        .select('photos')\n        .eq('id', ticketId)\n        .single()\n\n      if (ticketError) throw ticketError\n      if (!ticket?.photos || ticket.photos.length === 0) {\n        // No photos - mark as empty\n        await supabase\n          .from('t_and_m_tickets')\n          .update({\n            photos_verified_at: new Date().toISOString(),\n            photos_verification_status: 'empty',\n            photos_issue_count: 0\n          })\n          .eq('id', ticketId)\n\n        return { verified: true, status: 'empty', issues: [] }\n      }\n\n      // Verify each photo\n      const issues = []\n      for (const photoUrl of ticket.photos) {\n        const result = await this.verifyPhotoAccessible(photoUrl)\n        if (!result.accessible) {\n          issues.push({ url: photoUrl, error: result.error })\n        }\n      }\n\n      // Update verification status\n      const status = issues.length === 0 ? 'verified' : 'issues'\n      await supabase\n        .from('t_and_m_tickets')\n        .update({\n          photos_verified_at: new Date().toISOString(),\n          photos_verification_status: status,\n          photos_issue_count: issues.length\n        })\n        .eq('id', ticketId)\n\n      return {\n        verified: issues.length === 0,\n        status,\n        totalPhotos: ticket.photos.length,\n        issues\n      }\n    } catch (error) {\n      console.error('Error verifying ticket photos:', error)\n      return { verified: false, error: error.message, issues: [] }\n    }\n  },\n\n  // Add entry to photo upload queue for reliable upload tracking\n  async queuePhotoUpload(ticketId, tempId, fileName, fileSize) {\n    if (!isSupabaseConfigured) return null\n\n    const { data, error } = await supabase\n      .from('photo_upload_queue')\n      .insert({\n        ticket_id: ticketId,\n        temp_id: tempId,\n        file_name: fileName,\n        file_size_bytes: fileSize,\n        status: 'pending'\n      })\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Error queueing photo upload:', error)\n      return null\n    }\n    return data\n  },\n\n  // Confirm a queued photo upload (calls database function)\n  async confirmQueuedUpload(queueId, uploadedUrl, storagePath) {\n    if (!isSupabaseConfigured) return false\n\n    const { data, error } = await supabase.rpc('confirm_photo_upload', {\n      p_queue_id: queueId,\n      p_uploaded_url: uploadedUrl,\n      p_storage_path: storagePath\n    })\n\n    if (error) {\n      console.error('Error confirming photo upload:', error)\n      return false\n    }\n    return data === true\n  },\n\n  // Mark a queued photo upload as failed\n  async markQueuedUploadFailed(queueId, errorMessage) {\n    if (!isSupabaseConfigured) return false\n\n    const { data, error } = await supabase.rpc('mark_photo_upload_failed', {\n      p_queue_id: queueId,\n      p_error: errorMessage\n    })\n\n    if (error) {\n      console.error('Error marking photo upload failed:', error)\n      return false\n    }\n    return data === true\n  },\n\n  // Get pending photo uploads for a ticket\n  async getPendingPhotoUploads(ticketId) {\n    if (!isSupabaseConfigured) return []\n\n    const { data, error } = await supabase.rpc('get_pending_photo_uploads', {\n      p_ticket_id: ticketId\n    })\n\n    if (error) {\n      console.error('Error getting pending photo uploads:', error)\n      return []\n    }\n    return data || []\n  },\n\n  // Log photo operation for audit trail\n  async logPhotoOperation(ticketId, operation, details = {}) {\n    if (!isSupabaseConfigured) return\n\n    try {\n      await supabase\n        .from('photo_audit_log')\n        .insert({\n          ticket_id: ticketId,\n          cor_id: details.corId || null,\n          operation,\n          photo_url: details.photoUrl || null,\n          storage_path: details.storagePath || null,\n          details: details.metadata ? details.metadata : null,\n          error_message: details.error || null,\n          triggered_by: details.triggeredBy || 'system'\n        })\n    } catch (error) {\n      // Don't fail the main operation if logging fails\n      console.error('Error logging photo operation:', error)\n    }\n  },\n\n  // ============================================\n  // COR Export Snapshots (Dispute-Ready Exports)\n  // ============================================\n\n  // Save a COR export snapshot for dispute/audit purposes\n  async saveExportSnapshot(corId, snapshot, options = {}) {\n    if (!isSupabaseConfigured) return null\n\n    const {\n      exportType = 'pdf',\n      exportReason = null,\n      clientEmail = null,\n      clientName = null\n    } = options\n\n    try {\n      const { data, error } = await supabase\n        .from('cor_export_snapshots')\n        .insert({\n          cor_id: corId,\n          export_type: exportType,\n          export_reason: exportReason,\n          cor_data: snapshot.cor_data,\n          tickets_data: snapshot.tickets_data,\n          photos_manifest: snapshot.photos_manifest,\n          totals_snapshot: snapshot.totals_snapshot,\n          checksum: snapshot.checksum,\n          client_email: clientEmail,\n          client_name: clientName\n        })\n        .select()\n        .single()\n\n      if (error) throw error\n      return data\n    } catch (error) {\n      console.error('Error saving export snapshot:', error)\n      return null\n    }\n  },\n\n  // Get export history for a COR\n  async getExportSnapshots(corId) {\n    if (!isSupabaseConfigured) return []\n\n    const { data, error } = await supabase\n      .from('cor_export_snapshots')\n      .select('id, exported_at, export_type, export_reason, client_name, client_email, checksum')\n      .eq('cor_id', corId)\n      .order('exported_at', { ascending: false })\n\n    if (error) {\n      console.error('Error fetching export snapshots:', error)\n      return []\n    }\n    return data || []\n  },\n\n  // Get a specific export snapshot with full data\n  async getExportSnapshot(snapshotId) {\n    if (!isSupabaseConfigured) return null\n\n    const { data, error } = await supabase\n      .from('cor_export_snapshots')\n      .select('*')\n      .eq('id', snapshotId)\n      .single()\n\n    if (error) {\n      console.error('Error fetching export snapshot:', error)\n      return null\n    }\n    return data\n  },\n\n  // ============================================\n  // COR Export Jobs (Async Pipeline)\n  // ============================================\n\n  // Request a COR export (idempotent - returns existing job if key matches)\n  async requestCORExport(corId, idempotencyKey, options = {}) {\n    if (!isSupabaseConfigured) return null\n\n    try {\n      const user = await supabase.auth.getUser()\n      const { data, error } = await supabase.rpc('request_cor_export', {\n        p_cor_id: corId,\n        p_idempotency_key: idempotencyKey,\n        p_options: options,\n        p_requested_by: user?.data?.user?.id || null\n      })\n\n      if (error) throw error\n      return data?.[0] || null\n    } catch (error) {\n      observe.error('database', { message: error.message, operation: 'requestCORExport', extra: { corId } })\n      throw error\n    }\n  },\n\n  // Get export job status\n  async getExportJob(jobId) {\n    if (!isSupabaseConfigured) return null\n\n    const { data, error } = await supabase\n      .from('cor_export_jobs')\n      .select('*')\n      .eq('id', jobId)\n      .single()\n\n    if (error) {\n      console.error('Error fetching export job:', error)\n      return null\n    }\n    return data\n  },\n\n  // Get export jobs for a COR\n  async getExportJobs(corId, limit = 10) {\n    if (!isSupabaseConfigured) return []\n\n    const { data, error } = await supabase\n      .from('cor_export_jobs')\n      .select('*')\n      .eq('cor_id', corId)\n      .order('created_at', { ascending: false })\n      .limit(limit)\n\n    if (error) {\n      console.error('Error fetching export jobs:', error)\n      return []\n    }\n    return data || []\n  },\n\n  // Update export job status\n  async updateExportJobStatus(jobId, status, details = {}) {\n    if (!isSupabaseConfigured) return null\n\n    try {\n      const { data, error } = await supabase.rpc('update_export_job_status', {\n        p_job_id: jobId,\n        p_status: status,\n        p_snapshot_id: details.snapshotId || null,\n        p_pdf_url: details.pdfUrl || null,\n        p_error: details.error || null,\n        p_error_details: details.errorDetails || null,\n        p_metrics: details.metrics || null\n      })\n\n      if (error) throw error\n      return data\n    } catch (error) {\n      observe.error('database', { message: error.message, operation: 'updateExportJobStatus', extra: { jobId, status } })\n      throw error\n    }\n  },\n\n  // Get current valid snapshot for a COR (if exists and not stale)\n  async getCurrentCORSnapshot(corId) {\n    if (!isSupabaseConfigured) return null\n\n    // First check if COR has been modified since last snapshot\n    const { data: cor } = await supabase\n      .from('change_orders')\n      .select('version, last_snapshot_version')\n      .eq('id', corId)\n      .single()\n\n    // If version changed, snapshot is stale\n    if (!cor || cor.version !== cor.last_snapshot_version) {\n      return null\n    }\n\n    // Get current snapshot\n    const { data: snapshot } = await supabase\n      .from('cor_export_snapshots')\n      .select('*')\n      .eq('cor_id', corId)\n      .eq('is_current', true)\n      .single()\n\n    return snapshot || null\n  },\n\n  // Save a new snapshot and mark as current\n  async saveCORSnapshot(snapshot, jobId) {\n    if (!isSupabaseConfigured) return null\n\n    try {\n      // Mark previous snapshots as not current\n      await supabase\n        .from('cor_export_snapshots')\n        .update({ is_current: false })\n        .eq('cor_id', snapshot.corId)\n\n      const user = await supabase.auth.getUser()\n\n      // Insert new snapshot\n      const { data, error } = await supabase\n        .from('cor_export_snapshots')\n        .insert({\n          id: snapshot.snapshotId,\n          cor_id: snapshot.corId,\n          job_id: jobId,\n          cor_version: snapshot.corVersion,\n          cor_data: snapshot.corData,\n          tickets_data: snapshot.ticketsData,\n          photos_manifest: snapshot.photoManifest,\n          totals_snapshot: snapshot.totals,\n          checksum: snapshot.checksum,\n          is_current: true,\n          exported_by: user?.data?.user?.id || null\n        })\n        .select()\n        .single()\n\n      if (error) throw error\n\n      // Update COR's last snapshot version\n      await supabase\n        .from('change_orders')\n        .update({ last_snapshot_version: snapshot.corVersion })\n        .eq('id', snapshot.corId)\n\n      return data\n    } catch (error) {\n      observe.error('database', { message: error.message, operation: 'saveCORSnapshot', extra: { corId: snapshot.corId } })\n      throw error\n    }\n  },\n\n  // Update COR aggregated stats (call after ticket changes)\n  async updateCORAggregatedStats(corId) {\n    if (!isSupabaseConfigured) return\n\n    try {\n      await supabase.rpc('update_cor_aggregated_stats', { p_cor_id: corId })\n    } catch (error) {\n      console.error('Error updating COR aggregated stats:', error)\n    }\n  },\n\n  // ============================================\n  // Crew Check-In Functions\n  // ============================================\n\n  // Get today's crew check-in for a project\n  async getCrewCheckin(projectId, date = null) {\n    if (!isSupabaseConfigured) return null\n\n    const checkDate = date || new Date().toISOString().split('T')[0]\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('crew_checkins')\n      .select('*')\n      .eq('project_id', projectId)\n      .eq('check_in_date', checkDate)\n      .maybeSingle() // Use maybeSingle to return null instead of 406 when no rows\n\n    if (error) {\n      console.error('Error fetching crew checkin:', error)\n    }\n    return data\n  },\n\n  // Create or update crew check-in\n  async saveCrewCheckin(projectId, workers, createdBy = null, date = null) {\n    if (!isSupabaseConfigured) return null\n\n    const checkDate = date || new Date().toISOString().split('T')[0]\n\n    // If offline, cache and queue action\n    if (!getConnectionStatus()) {\n      const checkin = {\n        id: generateTempId(),\n        project_id: projectId,\n        check_in_date: checkDate,\n        workers: workers,\n        created_by: createdBy,\n        updated_at: new Date().toISOString(),\n        _offline: true\n      }\n      await cacheCrewCheckin(checkin)\n      await addPendingAction(ACTION_TYPES.SAVE_CREW_CHECKIN, {\n        projectId,\n        workers,\n        checkInDate: checkDate\n      })\n      return checkin\n    }\n\n    const client = getClient()\n    if (!client) {\n      // Offline fallback - queue for later\n      const checkin = {\n        id: generateTempId(),\n        project_id: projectId,\n        check_in_date: checkDate,\n        workers: workers,\n        created_by: createdBy,\n        updated_at: new Date().toISOString(),\n        _offline: true\n      }\n      await cacheCrewCheckin(checkin)\n      await addPendingAction(ACTION_TYPES.SAVE_CREW_CHECKIN, {\n        projectId,\n        workers,\n        checkInDate: checkDate\n      })\n      return checkin\n    }\n\n    const { data, error } = await client\n      .from('crew_checkins')\n      .upsert({\n        project_id: projectId,\n        check_in_date: checkDate,\n        workers: workers,\n        created_by: createdBy,\n        updated_at: new Date().toISOString()\n      }, {\n        onConflict: 'project_id,check_in_date'\n      })\n      .select()\n      .single()\n\n    if (error) {\n      // If network error, queue for later\n      if (error.message?.includes('fetch') || error.message?.includes('network')) {\n        const checkin = {\n          id: generateTempId(),\n          project_id: projectId,\n          check_in_date: checkDate,\n          workers: workers,\n          _offline: true\n        }\n        await cacheCrewCheckin(checkin)\n        await addPendingAction(ACTION_TYPES.SAVE_CREW_CHECKIN, {\n          projectId,\n          workers,\n          checkInDate: checkDate\n        })\n        return checkin\n      }\n      console.error('Error saving crew checkin:', error)\n      throw error\n    }\n\n    // Update cache with server response\n    if (data) {\n      cacheCrewCheckin(data).catch(err => console.error('Failed to cache checkin:', err))\n    }\n    return data\n  },\n\n  // Add a worker to today's check-in\n  async addCrewMember(projectId, worker, createdBy = null) {\n    if (!isSupabaseConfigured) return null\n    \n    const existing = await this.getCrewCheckin(projectId)\n    const workers = existing?.workers || []\n    \n    // Check if already exists\n    if (!workers.find(w => w.name.toLowerCase() === worker.name.toLowerCase())) {\n      workers.push(worker)\n      return await this.saveCrewCheckin(projectId, workers, createdBy)\n    }\n    return existing\n  },\n\n  // Remove a worker from today's check-in\n  async removeCrewMember(projectId, workerName) {\n    if (!isSupabaseConfigured) return null\n    \n    const existing = await this.getCrewCheckin(projectId)\n    if (!existing) return null\n    \n    const workers = existing.workers.filter(\n      w => w.name.toLowerCase() !== workerName.toLowerCase()\n    )\n    return await this.saveCrewCheckin(projectId, workers, existing.created_by)\n  },\n\n  // Get crew check-ins for a project (for office view)\n  async getCrewCheckinHistory(projectId, limit = 30) {\n    if (!isSupabaseConfigured) return []\n    \n    const { data, error } = await supabase\n      .from('crew_checkins')\n      .select('*')\n      .eq('project_id', projectId)\n      .order('check_in_date', { ascending: false })\n      .limit(limit)\n    \n    if (error) {\n      console.error('Error fetching crew history:', error)\n      return []\n    }\n    return data || []\n  },\n\n  // Get unique recent workers from past check-ins (for quick-add feature)\n  async getRecentWorkers(projectId, limit = 30) {\n    if (!isSupabaseConfigured) return []\n\n    const history = await this.getCrewCheckinHistory(projectId, limit)\n\n    // Extract unique workers from all check-ins\n    const workerMap = new Map()\n    history.forEach(checkin => {\n      (checkin.workers || []).forEach(worker => {\n        const key = worker.name.toLowerCase()\n        if (!workerMap.has(key)) {\n          workerMap.set(key, {\n            name: worker.name,\n            role: worker.role,\n            labor_class_id: worker.labor_class_id || null,\n            lastSeen: checkin.check_in_date\n          })\n        }\n      })\n    })\n\n    // Return as array sorted by name\n    return Array.from(workerMap.values()).sort((a, b) =>\n      a.name.localeCompare(b.name)\n    )\n  },\n\n  // Get labor rates for a company (for man day calculations)\n  async getLaborRates(companyId, workType = null, jobType = null) {\n    if (!isSupabaseConfigured) return []\n\n    let query = supabase\n      .from('labor_rates')\n      .select('*')\n      .eq('company_id', companyId)\n\n    if (workType) query = query.eq('work_type', workType)\n    if (jobType) query = query.eq('job_type', jobType)\n\n    const { data, error } = await query\n\n    if (error) {\n      console.error('Error fetching labor rates:', error)\n      return []\n    }\n    return data || []\n  },\n\n  // Calculate man day costs for a project\n  async calculateManDayCosts(projectId, companyId, workType, jobType) {\n    if (!isSupabaseConfigured) return { totalCost: 0, totalManDays: 0, breakdown: [] }\n\n    // Get crew check-in history\n    const crewHistory = await this.getCrewCheckinHistory(projectId, 365)\n\n    // Get labor rates for this work/job type\n    const laborRates = await this.getLaborRates(companyId, workType, jobType)\n\n    // Build rates lookup: { role: regularRate }\n    const ratesLookup = {}\n    laborRates.forEach(rate => {\n      ratesLookup[rate.role.toLowerCase()] = parseFloat(rate.regular_rate) || 0\n    })\n\n    // Calculate costs\n    let totalCost = 0\n    let totalManDays = 0\n    const byRole = {}\n    const byDate = []\n\n    crewHistory.forEach(checkin => {\n      const workers = checkin.workers || []\n      let dayCost = 0\n      const dayBreakdown = {}\n\n      workers.forEach(worker => {\n        const role = (worker.role || 'laborer').toLowerCase()\n        const rate = ratesLookup[role] || 0\n\n        if (!dayBreakdown[role]) {\n          dayBreakdown[role] = { count: 0, cost: 0 }\n        }\n        dayBreakdown[role].count++\n        dayBreakdown[role].cost += rate\n        dayCost += rate\n\n        // Track by role totals\n        if (!byRole[role]) {\n          byRole[role] = { count: 0, cost: 0, rate }\n        }\n        byRole[role].count++\n        byRole[role].cost += rate\n      })\n\n      totalCost += dayCost\n      totalManDays += workers.length\n\n      byDate.push({\n        date: checkin.check_in_date,\n        workers: workers.length,\n        cost: dayCost,\n        breakdown: dayBreakdown\n      })\n    })\n\n    return {\n      totalCost,\n      totalManDays,\n      byRole,\n      byDate,\n      daysWorked: crewHistory.length\n    }\n  },\n\n  // ============================================\n  // Daily Field Reports\n  // ============================================\n\n  // Get or create today's report for a project\n  async getDailyReport(projectId, date = null) {\n    if (!isSupabaseConfigured) return null\n\n    const reportDate = date || new Date().toISOString().split('T')[0]\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('daily_reports')\n      .select('*')\n      .eq('project_id', projectId)\n      .eq('report_date', reportDate)\n      .maybeSingle() // Use maybeSingle to return null instead of 406 when no report exists\n\n    if (error) {\n      console.error('Error fetching daily report:', error)\n    }\n    return data\n  },\n\n  // Compile daily report data from other tables (parallelized for speed)\n  async compileDailyReport(projectId, date = null) {\n    if (!isSupabaseConfigured) return null\n\n    const reportDate = date || new Date().toISOString().split('T')[0]\n    const client = getClient()\n\n    // Run all queries in parallel for faster loading\n    const [crew, areasResult, ticketsResult] = await Promise.all([\n      this.getCrewCheckin(projectId, reportDate),\n      client.from('areas').select('*').eq('project_id', projectId),\n      client.from('t_and_m_tickets').select('*').eq('project_id', projectId).eq('work_date', reportDate)\n    ])\n\n    const areas = areasResult?.data || []\n    const tickets = ticketsResult?.data || []\n\n    const completedToday = areas.filter(a =>\n      a.status === 'done' &&\n      a.completed_at?.startsWith(reportDate)\n    )\n\n    const photosCount = tickets.reduce((sum, t) => sum + (t.photos?.length || 0), 0)\n\n    return {\n      crew_count: crew?.workers?.length || 0,\n      crew_list: crew?.workers || [],\n      tasks_completed: completedToday.length,\n      tasks_total: areas.length,\n      completed_tasks: completedToday.map(a => ({ name: a.name, group: a.group_name })),\n      tm_tickets_count: tickets.length,\n      photos_count: photosCount\n    }\n  },\n\n  // Save/update daily report\n  async saveDailyReport(projectId, reportData, date = null) {\n    if (!isSupabaseConfigured) return null\n\n    const reportDate = date || new Date().toISOString().split('T')[0]\n\n    // If offline, cache and queue action\n    if (!getConnectionStatus()) {\n      const report = {\n        id: generateTempId(),\n        project_id: projectId,\n        report_date: reportDate,\n        ...reportData,\n        updated_at: new Date().toISOString(),\n        _offline: true\n      }\n      await cacheDailyReport(report)\n      // Note: saveDailyReport alone doesn't queue - submitDailyReport handles the full flow\n      return report\n    }\n\n    const client = getClient()\n    const { data, error } = await client\n      .from('daily_reports')\n      .upsert({\n        project_id: projectId,\n        report_date: reportDate,\n        ...reportData,\n        updated_at: new Date().toISOString()\n      }, {\n        onConflict: 'project_id,report_date'\n      })\n      .select()\n      .single()\n\n    if (error) {\n      // If network error, cache locally\n      if (error.message?.includes('fetch') || error.message?.includes('network')) {\n        const report = {\n          id: generateTempId(),\n          project_id: projectId,\n          report_date: reportDate,\n          ...reportData,\n          _offline: true\n        }\n        await cacheDailyReport(report)\n        return report\n      }\n      console.error('Error saving daily report:', error)\n      throw error\n    }\n\n    // Update cache with server response\n    if (data) {\n      cacheDailyReport(data).catch(err => console.error('Failed to cache report:', err))\n    }\n    return data\n  },\n\n  // Submit daily report\n  async submitDailyReport(projectId, submittedBy, date = null) {\n    if (!isSupabaseConfigured) return null\n\n    const reportDate = date || new Date().toISOString().split('T')[0]\n\n    // If offline, queue the submission\n    if (!getConnectionStatus()) {\n      // Try to get cached report data\n      const cachedReport = await getCachedDailyReport(projectId, reportDate)\n      const report = {\n        id: generateTempId(),\n        project_id: projectId,\n        report_date: reportDate,\n        ...(cachedReport || {}),\n        status: 'pending_sync',\n        submitted_by: submittedBy,\n        submitted_at: new Date().toISOString(),\n        _offline: true\n      }\n      await cacheDailyReport(report)\n      await addPendingAction(ACTION_TYPES.SUBMIT_DAILY_REPORT, {\n        projectId,\n        reportData: cachedReport || {},\n        submittedBy\n      })\n      return report\n    }\n\n    // First compile latest data\n    const compiled = await this.compileDailyReport(projectId, reportDate)\n\n    const client = getClient()\n    if (!client) {\n      throw new Error('Database client not available')\n    }\n\n    const { data, error } = await client\n      .from('daily_reports')\n      .upsert({\n        project_id: projectId,\n        report_date: reportDate,\n        ...compiled,\n        status: 'submitted',\n        submitted_at: new Date().toISOString(),\n        submitted_by: submittedBy,\n        updated_at: new Date().toISOString()\n      }, {\n        onConflict: 'project_id,report_date'\n      })\n      .select()\n      .single()\n\n    if (error) {\n      // If network error, queue for later\n      if (error.message?.includes('fetch') || error.message?.includes('network')) {\n        const report = {\n          id: generateTempId(),\n          project_id: projectId,\n          report_date: reportDate,\n          ...compiled,\n          status: 'pending_sync',\n          submitted_by: submittedBy,\n          _offline: true\n        }\n        await cacheDailyReport(report)\n        await addPendingAction(ACTION_TYPES.SUBMIT_DAILY_REPORT, {\n          projectId,\n          reportData: compiled,\n          submittedBy\n        })\n        return report\n      }\n      console.error('Error submitting daily report:', error)\n      throw error\n    }\n\n    // Update cache\n    if (data) {\n      cacheDailyReport(data).catch(err => console.error('Failed to cache report:', err))\n    }\n    return data\n  },\n\n  // Get daily reports for office view\n  async getDailyReports(projectId, limit = 30) {\n    if (!isSupabaseConfigured) return []\n    \n    const { data, error } = await supabase\n      .from('daily_reports')\n      .select('*')\n      .eq('project_id', projectId)\n      .order('report_date', { ascending: false })\n      .limit(limit)\n    \n    if (error) {\n      console.error('Error fetching daily reports:', error)\n      return []\n    }\n    return data || []\n  },\n\n  // ============================================\n  // Messages (Two-way communication)\n  // ============================================\n\n  // Send a message\n  async sendMessage(projectId, message, senderType, senderName, senderUserId = null, photoUrl = null, messageType = 'general', parentId = null) {\n    if (!isSupabaseConfigured) return null\n\n    // If offline, cache and queue message\n    if (!getConnectionStatus()) {\n      const msg = {\n        id: generateTempId(),\n        project_id: projectId,\n        sender_type: senderType,\n        sender_name: senderName,\n        sender_user_id: senderUserId,\n        message: message,\n        photo_url: photoUrl,\n        message_type: messageType,\n        parent_message_id: parentId,\n        created_at: new Date().toISOString(),\n        _offline: true\n      }\n      await cacheMessage(msg)\n      await addPendingAction(ACTION_TYPES.SEND_MESSAGE, {\n        projectId,\n        senderType,\n        senderName,\n        content: message\n      })\n      return msg\n    }\n\n    const { data, error } = await supabase\n      .from('messages')\n      .insert({\n        project_id: projectId,\n        sender_type: senderType,\n        sender_name: senderName,\n        sender_user_id: senderUserId,\n        message: message,\n        photo_url: photoUrl,\n        message_type: messageType,\n        parent_message_id: parentId\n      })\n      .select()\n      .single()\n\n    if (error) {\n      // If network error, queue for later\n      if (error.message?.includes('fetch') || error.message?.includes('network')) {\n        const msg = {\n          id: generateTempId(),\n          project_id: projectId,\n          sender_type: senderType,\n          sender_name: senderName,\n          message: message,\n          created_at: new Date().toISOString(),\n          _offline: true\n        }\n        await cacheMessage(msg)\n        await addPendingAction(ACTION_TYPES.SEND_MESSAGE, {\n          projectId,\n          senderType,\n          senderName,\n          content: message\n        })\n        return msg\n      }\n      console.error('Error sending message:', error)\n      throw error\n    }\n    return data\n  },\n\n  // Get messages for a project\n  async getMessages(projectId, limit = 50) {\n    if (!isSupabaseConfigured) return []\n\n    const client = getClient()\n    const { data, error } = await client\n      .from('messages')\n      .select('*')\n      .eq('project_id', projectId)\n      .order('created_at', { ascending: false })\n      .limit(limit)\n\n    if (error) {\n      return []\n    }\n    return data || []\n  },\n\n  // Get unread message count\n  async getUnreadCount(projectId, viewerType) {\n    if (!isSupabaseConfigured) return 0\n\n    const client = getClient()\n    // Field sees office messages, office sees field messages\n    const senderType = viewerType === 'field' ? 'office' : 'field'\n\n    const { count, error } = await client\n      .from('messages')\n      .select('*', { count: 'exact', head: true })\n      .eq('project_id', projectId)\n      .eq('sender_type', senderType)\n      .eq('is_read', false)\n\n    if (error) {\n      return 0\n    }\n    return count || 0\n  },\n\n  // Mark messages as read\n  async markMessagesRead(projectId, viewerType) {\n    if (!isSupabaseConfigured) return\n\n    const client = getClient()\n    const senderType = viewerType === 'field' ? 'office' : 'field'\n\n    await client\n      .from('messages')\n      .update({ is_read: true, read_at: new Date().toISOString() })\n      .eq('project_id', projectId)\n      .eq('sender_type', senderType)\n      .eq('is_read', false)\n  },\n\n  // ============================================\n  // Material Requests\n  // ============================================\n\n  // Create material request\n  async createMaterialRequest(projectId, items, requestedBy, neededBy = null, priority = 'normal', notes = null) {\n    if (!isSupabaseConfigured) return null\n\n    // If offline, queue the request\n    if (!getConnectionStatus()) {\n      const request = {\n        id: generateTempId(),\n        project_id: projectId,\n        items: items,\n        requested_by: requestedBy,\n        needed_by: neededBy,\n        priority: priority,\n        notes: notes,\n        status: 'pending_sync',\n        created_at: new Date().toISOString(),\n        _offline: true\n      }\n      await addPendingAction(ACTION_TYPES.CREATE_MATERIAL_REQUEST, {\n        projectId,\n        items,\n        requestedBy,\n        neededBy,\n        priority,\n        notes\n      })\n      return request\n    }\n\n    const { data, error } = await supabase\n      .from('material_requests')\n      .insert({\n        project_id: projectId,\n        items: items,\n        requested_by: requestedBy,\n        needed_by: neededBy,\n        priority: priority,\n        notes: notes\n      })\n      .select()\n      .single()\n\n    if (error) {\n      // If network error, queue for later\n      if (error.message?.includes('fetch') || error.message?.includes('network')) {\n        const request = {\n          id: generateTempId(),\n          project_id: projectId,\n          items: items,\n          requested_by: requestedBy,\n          status: 'pending_sync',\n          _offline: true\n        }\n        await addPendingAction(ACTION_TYPES.CREATE_MATERIAL_REQUEST, {\n          projectId,\n          items,\n          requestedBy,\n          neededBy,\n          priority,\n          notes\n        })\n        return request\n      }\n      console.error('Error creating material request:', error)\n      throw error\n    }\n    return data\n  },\n\n  // Get material requests for a project\n  async getMaterialRequests(projectId, status = null) {\n    if (!isSupabaseConfigured) return []\n    \n    let query = supabase\n      .from('material_requests')\n      .select('*')\n      .eq('project_id', projectId)\n      .order('created_at', { ascending: false })\n    \n    if (status) {\n      query = query.eq('status', status)\n    }\n    \n    const { data, error } = await query\n    \n    if (error) {\n      console.error('Error fetching material requests:', error)\n      return []\n    }\n    return data || []\n  },\n\n  // Get pending requests count (for badge)\n  async getPendingRequestsCount(projectId) {\n    if (!isSupabaseConfigured) return 0\n    \n    const { count, error } = await supabase\n      .from('material_requests')\n      .select('*', { count: 'exact', head: true })\n      .eq('project_id', projectId)\n      .eq('status', 'pending')\n    \n    if (error) return 0\n    return count || 0\n  },\n\n  // Update material request status (office action)\n  async updateMaterialRequest(requestId, status, respondedBy, responseNotes = null, expectedDelivery = null) {\n    if (!isSupabaseConfigured) return null\n    \n    const updateData = {\n      status: status,\n      responded_by: respondedBy,\n      responded_at: new Date().toISOString(),\n      response_notes: responseNotes,\n      updated_at: new Date().toISOString()\n    }\n    \n    if (expectedDelivery) {\n      updateData.expected_delivery = expectedDelivery\n    }\n    \n    if (status === 'delivered') {\n      updateData.delivered_at = new Date().toISOString()\n    }\n    \n    const { data, error } = await supabase\n      .from('material_requests')\n      .update(updateData)\n      .eq('id', requestId)\n      .select()\n      .single()\n    \n    if (error) {\n      console.error('Error updating material request:', error)\n      throw error\n    }\n    return data\n  },\n\n  // ============================================\n  // Project Shares (Read-only Portal)\n  // ============================================\n\n  // Generate a unique share token using crypto for security\n  generateShareToken() {\n    const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n    const array = new Uint8Array(12)\n    crypto.getRandomValues(array)\n    return Array.from(array, b => chars[b % chars.length]).join('')\n  },\n\n  // Create a new project share\n  async createProjectShare(projectId, createdBy, permissions, expiresAt = null) {\n    if (!isSupabaseConfigured) {\n      // Demo mode - store in localStorage\n      const localData = getLocalData()\n      if (!localData.projectShares) localData.projectShares = []\n\n      const share = {\n        id: crypto.randomUUID(),\n        project_id: projectId,\n        share_token: this.generateShareToken(),\n        created_by: createdBy,\n        expires_at: expiresAt,\n        is_active: true,\n        permissions: permissions,\n        view_count: 0,\n        last_viewed_at: null,\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n      }\n\n      localData.projectShares.push(share)\n      setLocalData(localData)\n      return share\n    }\n\n    // Use database function to generate unique token\n    const { data: tokenData, error: tokenError } = await supabase.rpc('generate_share_token')\n    if (tokenError) {\n      console.error('Error generating share token:', tokenError)\n      throw tokenError\n    }\n\n    const { data, error } = await supabase\n      .from('project_shares')\n      .insert({\n        project_id: projectId,\n        share_token: tokenData,\n        created_by: createdBy,\n        expires_at: expiresAt,\n        permissions: permissions\n      })\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Error creating project share:', error)\n      throw error\n    }\n    return data\n  },\n\n  // Get share by token (public access)\n  async getShareByToken(token) {\n    if (!isSupabaseConfigured) {\n      // Demo mode\n      const localData = getLocalData()\n      if (!localData.projectShares) return null\n\n      const share = localData.projectShares.find(s =>\n        s.share_token === token &&\n        s.is_active &&\n        (!s.expires_at || new Date(s.expires_at) > new Date())\n      )\n\n      if (share) {\n        // Increment view count\n        share.view_count++\n        share.last_viewed_at = new Date().toISOString()\n        setLocalData(localData)\n      }\n\n      return share\n    }\n\n    const { data, error } = await supabase\n      .from('project_shares')\n      .select('*, projects(*)')\n      .eq('share_token', token)\n      .eq('is_active', true)\n      .single()\n\n    if (error) {\n      console.error('Error fetching share by token:', error)\n      return null\n    }\n\n    // Check if expired\n    if (data.expires_at && new Date(data.expires_at) < new Date()) {\n      return null\n    }\n\n    // Increment view count\n    await supabase.rpc('increment_share_view_count', { token })\n\n    return data\n  },\n\n  // Get all shares for a project\n  async getProjectShares(projectId) {\n    if (!isSupabaseConfigured) {\n      // Demo mode\n      const localData = getLocalData()\n      if (!localData.projectShares) return []\n\n      return localData.projectShares.filter(s => s.project_id === projectId)\n    }\n\n    const { data, error } = await supabase\n      .from('project_shares')\n      .select('*, users(name, email)')\n      .eq('project_id', projectId)\n      .order('created_at', { ascending: false })\n\n    if (error) {\n      console.error('Error fetching project shares:', error)\n      return []\n    }\n    return data || []\n  },\n\n  // Update share (e.g., change permissions or expiration)\n  async updateProjectShare(shareId, updates) {\n    if (!isSupabaseConfigured) {\n      // Demo mode\n      const localData = getLocalData()\n      if (!localData.projectShares) return null\n\n      const shareIndex = localData.projectShares.findIndex(s => s.id === shareId)\n      if (shareIndex === -1) return null\n\n      localData.projectShares[shareIndex] = {\n        ...localData.projectShares[shareIndex],\n        ...updates,\n        updated_at: new Date().toISOString()\n      }\n      setLocalData(localData)\n      return localData.projectShares[shareIndex]\n    }\n\n    const { data, error } = await supabase\n      .from('project_shares')\n      .update(updates)\n      .eq('id', shareId)\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Error updating project share:', error)\n      throw error\n    }\n    return data\n  },\n\n  // Revoke a share (deactivate)\n  async revokeProjectShare(shareId) {\n    return this.updateProjectShare(shareId, { is_active: false })\n  },\n\n  // Delete a share permanently\n  async deleteProjectShare(shareId) {\n    if (!isSupabaseConfigured) {\n      // Demo mode\n      const localData = getLocalData()\n      if (!localData.projectShares) return\n\n      localData.projectShares = localData.projectShares.filter(s => s.id !== shareId)\n      setLocalData(localData)\n      return\n    }\n\n    const { error } = await supabase\n      .from('project_shares')\n      .delete()\n      .eq('id', shareId)\n\n    if (error) {\n      console.error('Error deleting project share:', error)\n      throw error\n    }\n  },\n\n  // Get public project data (filtered by permissions)\n  async getPublicProjectData(shareToken) {\n    const share = await this.getShareByToken(shareToken)\n    if (!share) return null\n\n    const projectId = share.project_id || share.projects?.id\n\n    if (!isSupabaseConfigured) {\n      // Demo mode\n      const localData = getLocalData()\n      const project = localData.projects.find(p => p.id === projectId)\n      if (!project) return null\n\n      const areas = localData.areas.filter(a => a.project_id === projectId)\n\n      // Calculate progress\n      const totalWeight = areas.reduce((sum, area) => sum + parseFloat(area.weight || 0), 0)\n      const completedWeight = areas\n        .filter(a => a.status === 'done')\n        .reduce((sum, area) => sum + parseFloat(area.weight || 0), 0)\n      const progress = totalWeight > 0 ? Math.round((completedWeight / totalWeight) * 100) : 0\n\n      return {\n        share,\n        project,\n        progress,\n        areas: share.permissions.progress ? areas : [],\n        photos: [],\n        dailyReports: [],\n        tmTickets: []\n      }\n    }\n\n    // Get project details\n    const project = share.projects || await this.getProject(projectId)\n    if (!project) return null\n\n    // Build response based on permissions\n    const result = {\n      share,\n      project,\n      areas: [],\n      photos: [],\n      dailyReports: [],\n      tmTickets: []\n    }\n\n    // Get areas for progress calculation\n    if (share.permissions.progress) {\n      result.areas = await this.getAreas(projectId)\n\n      // Calculate progress\n      const totalWeight = result.areas.reduce((sum, area) => sum + parseFloat(area.weight || 0), 0)\n      const completedWeight = result.areas\n        .filter(a => a.status === 'done')\n        .reduce((sum, area) => sum + parseFloat(area.weight || 0), 0)\n      result.progress = totalWeight > 0 ? Math.round((completedWeight / totalWeight) * 100) : 0\n    }\n\n    // Get photos if permitted\n    if (share.permissions.photos) {\n      const { data: tickets } = await supabase\n        .from('t_and_m_tickets')\n        .select('photos, work_date')\n        .eq('project_id', projectId)\n        .not('photos', 'is', null)\n        .order('work_date', { ascending: false })\n        .limit(20)\n\n      result.photos = tickets?.flatMap(t =>\n        (t.photos || []).map(photo => ({\n          url: photo,\n          date: t.work_date\n        }))\n      ) || []\n    }\n\n    // Get daily reports if permitted\n    if (share.permissions.daily_reports) {\n      const { data: reports } = await supabase\n        .from('daily_reports')\n        .select('*')\n        .eq('project_id', projectId)\n        .order('report_date', { ascending: false })\n        .limit(10)\n\n      result.dailyReports = reports || []\n    }\n\n    // Get T&M tickets if permitted\n    if (share.permissions.tm_tickets) {\n      result.tmTickets = await this.getTMTickets(projectId)\n    }\n\n    return result\n  },\n\n  // ============================================\n  // Injury Reports\n  // ============================================\n\n  // Create an injury report\n  async createInjuryReport(reportData) {\n    if (!isSupabaseConfigured) {\n      // Demo mode - store in localStorage\n      const localData = getLocalData()\n      if (!localData.injuryReports) localData.injuryReports = []\n\n      const report = {\n        id: crypto.randomUUID(),\n        ...reportData,\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n      }\n\n      localData.injuryReports.push(report)\n      setLocalData(localData)\n      return report\n    }\n\n    const { data, error } = await supabase\n      .from('injury_reports')\n      .insert(reportData)\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Error creating injury report:', error)\n      throw error\n    }\n    return data\n  },\n\n  // Get all injury reports for a project\n  async getInjuryReports(projectId) {\n    if (!isSupabaseConfigured) {\n      const localData = getLocalData()\n      if (!localData.injuryReports) return []\n      return localData.injuryReports\n        .filter(r => r.project_id === projectId)\n        .sort((a, b) => new Date(b.incident_date) - new Date(a.incident_date))\n    }\n\n    const { data, error } = await supabase\n      .from('injury_reports')\n      .select('*')\n      .eq('project_id', projectId)\n      .order('incident_date', { ascending: false })\n\n    if (error) {\n      console.error('Error fetching injury reports:', error)\n      return []\n    }\n    return data || []\n  },\n\n  // Get all injury reports for a company\n  async getCompanyInjuryReports(companyId, status = null) {\n    if (!isSupabaseConfigured) {\n      const localData = getLocalData()\n      if (!localData.injuryReports) return []\n      let reports = localData.injuryReports.filter(r => r.company_id === companyId)\n      if (status) {\n        reports = reports.filter(r => r.status === status)\n      }\n      return reports.sort((a, b) => new Date(b.incident_date) - new Date(a.incident_date))\n    }\n\n    let query = supabase\n      .from('injury_reports')\n      .select('*, projects(name)')\n      .eq('company_id', companyId)\n      .order('incident_date', { ascending: false })\n\n    if (status) {\n      query = query.eq('status', status)\n    }\n\n    const { data, error } = await query\n\n    if (error) {\n      console.error('Error fetching company injury reports:', error)\n      return []\n    }\n    return data || []\n  },\n\n  // Get a single injury report\n  async getInjuryReport(reportId) {\n    if (!isSupabaseConfigured) {\n      const localData = getLocalData()\n      if (!localData.injuryReports) return null\n      return localData.injuryReports.find(r => r.id === reportId)\n    }\n\n    const { data, error } = await supabase\n      .from('injury_reports')\n      .select('*, projects(name, pin), users(name, email)')\n      .eq('id', reportId)\n      .single()\n\n    if (error) {\n      console.error('Error fetching injury report:', error)\n      return null\n    }\n    return data\n  },\n\n  // Update an injury report\n  async updateInjuryReport(reportId, updates) {\n    if (!isSupabaseConfigured) {\n      const localData = getLocalData()\n      if (!localData.injuryReports) return null\n\n      const reportIndex = localData.injuryReports.findIndex(r => r.id === reportId)\n      if (reportIndex === -1) return null\n\n      localData.injuryReports[reportIndex] = {\n        ...localData.injuryReports[reportIndex],\n        ...updates,\n        updated_at: new Date().toISOString()\n      }\n      setLocalData(localData)\n      return localData.injuryReports[reportIndex]\n    }\n\n    const { data, error } = await supabase\n      .from('injury_reports')\n      .update(updates)\n      .eq('id', reportId)\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Error updating injury report:', error)\n      throw error\n    }\n    return data\n  },\n\n  // Close an injury report\n  async closeInjuryReport(reportId, userId) {\n    return this.updateInjuryReport(reportId, {\n      status: 'closed',\n      closed_at: new Date().toISOString(),\n      closed_by: userId\n    })\n  },\n\n  // Delete an injury report\n  async deleteInjuryReport(reportId) {\n    if (!isSupabaseConfigured) {\n      const localData = getLocalData()\n      if (!localData.injuryReports) return\n\n      localData.injuryReports = localData.injuryReports.filter(r => r.id !== reportId)\n      setLocalData(localData)\n      return\n    }\n\n    const { error } = await supabase\n      .from('injury_reports')\n      .delete()\n      .eq('id', reportId)\n\n    if (error) {\n      console.error('Error deleting injury report:', error)\n      throw error\n    }\n  },\n\n  // Get injury statistics for a company\n  async getInjuryStatistics(companyId, startDate = null, endDate = null) {\n    if (!isSupabaseConfigured) {\n      // Demo mode - calculate locally\n      const localData = getLocalData()\n      if (!localData.injuryReports) {\n        return {\n          total_incidents: 0,\n          minor_injuries: 0,\n          serious_injuries: 0,\n          critical_injuries: 0,\n          near_misses: 0,\n          osha_recordable: 0,\n          total_days_away: 0,\n          total_restricted_days: 0\n        }\n      }\n\n      let reports = localData.injuryReports.filter(r => r.company_id === companyId)\n\n      if (startDate) {\n        reports = reports.filter(r => new Date(r.incident_date) >= new Date(startDate))\n      }\n      if (endDate) {\n        reports = reports.filter(r => new Date(r.incident_date) <= new Date(endDate))\n      }\n\n      return {\n        total_incidents: reports.length,\n        minor_injuries: reports.filter(r => r.injury_type === 'minor').length,\n        serious_injuries: reports.filter(r => r.injury_type === 'serious').length,\n        critical_injuries: reports.filter(r => r.injury_type === 'critical').length,\n        near_misses: reports.filter(r => r.injury_type === 'near_miss').length,\n        osha_recordable: reports.filter(r => r.osha_recordable).length,\n        total_days_away: reports.reduce((sum, r) => sum + (r.days_away_from_work || 0), 0),\n        total_restricted_days: reports.reduce((sum, r) => sum + (r.restricted_work_days || 0), 0)\n      }\n    }\n\n    const { data, error } = await supabase.rpc('get_injury_statistics', {\n      comp_id: companyId,\n      start_date: startDate,\n      end_date: endDate\n    })\n\n    if (error) {\n      console.error('Error fetching injury statistics:', error)\n      return null\n    }\n    return data[0] || null\n  },\n\n  // Add a witness to an injury report\n  async addWitness(reportId, witness) {\n    if (!isSupabaseConfigured) {\n      const localData = getLocalData()\n      if (!localData.injuryReports) return null\n\n      const reportIndex = localData.injuryReports.findIndex(r => r.id === reportId)\n      if (reportIndex === -1) return null\n\n      const report = localData.injuryReports[reportIndex]\n      const witnesses = report.witnesses || []\n      witnesses.push(witness)\n\n      localData.injuryReports[reportIndex] = {\n        ...report,\n        witnesses,\n        updated_at: new Date().toISOString()\n      }\n      setLocalData(localData)\n      return localData.injuryReports[reportIndex]\n    }\n\n    const report = await this.getInjuryReport(reportId)\n    if (!report) return null\n\n    const witnesses = report.witnesses || []\n    witnesses.push(witness)\n\n    return this.updateInjuryReport(reportId, { witnesses })\n  },\n\n  // Remove a witness from an injury report\n  async removeWitness(reportId, witnessIndex) {\n    if (!isSupabaseConfigured) {\n      const localData = getLocalData()\n      if (!localData.injuryReports) return null\n\n      const reportIndex = localData.injuryReports.findIndex(r => r.id === reportId)\n      if (reportIndex === -1) return null\n\n      const report = localData.injuryReports[reportIndex]\n      const witnesses = report.witnesses || []\n      witnesses.splice(witnessIndex, 1)\n\n      localData.injuryReports[reportIndex] = {\n        ...report,\n        witnesses,\n        updated_at: new Date().toISOString()\n      }\n      setLocalData(localData)\n      return localData.injuryReports[reportIndex]\n    }\n\n    const report = await this.getInjuryReport(reportId)\n    if (!report) return null\n\n    const witnesses = report.witnesses || []\n    witnesses.splice(witnessIndex, 1)\n\n    return this.updateInjuryReport(reportId, { witnesses })\n  },\n\n  // ============================================\n  // Notification Preferences\n  // ============================================\n\n  // Get all users in a company (for notification settings)\n  async getCompanyUsers(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('user_companies')\n        .select(`\n          user_id,\n          role,\n          users (\n            id,\n            name,\n            email\n          )\n        `)\n        .eq('company_id', companyId)\n\n      if (error) {\n        console.error('Error fetching company users:', error)\n        return []\n      }\n      return data?.map(uc => ({\n        id: uc.user_id,\n        name: uc.users?.name || uc.users?.email,\n        email: uc.users?.email,\n        role: uc.role\n      })) || []\n    }\n    return []\n  },\n\n  // Get notification preferences for a project\n  async getProjectNotificationPreferences(projectId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('notification_preferences')\n        .select(`\n          *,\n          users (\n            id,\n            name,\n            email\n          )\n        `)\n        .eq('project_id', projectId)\n\n      if (error) {\n        console.error('Error fetching notification preferences:', error)\n        return []\n      }\n      return data || []\n    }\n    // Demo mode - use localStorage\n    const localData = getLocalData()\n    if (!localData.notificationPreferences) return []\n    return localData.notificationPreferences.filter(np => np.project_id === projectId)\n  },\n\n  // Get notification preferences for a user across all projects\n  async getUserNotificationPreferences(userId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('notification_preferences')\n        .select(`\n          *,\n          projects (\n            id,\n            name\n          )\n        `)\n        .eq('user_id', userId)\n\n      if (error) {\n        console.error('Error fetching user notification preferences:', error)\n        return []\n      }\n      return data || []\n    }\n    const localData = getLocalData()\n    if (!localData.notificationPreferences) return []\n    return localData.notificationPreferences.filter(np => np.user_id === userId)\n  },\n\n  // Set notification preferences for a user on a project\n  async setNotificationPreference(projectId, userId, notificationTypes) {\n    if (isSupabaseConfigured) {\n      // Upsert - update if exists, insert if not\n      const { data, error } = await supabase\n        .from('notification_preferences')\n        .upsert({\n          project_id: projectId,\n          user_id: userId,\n          notification_types: notificationTypes,\n          updated_at: new Date().toISOString()\n        }, {\n          onConflict: 'project_id,user_id'\n        })\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error setting notification preference:', error)\n        throw error\n      }\n      return data\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.notificationPreferences) {\n      localData.notificationPreferences = []\n    }\n\n    const existingIndex = localData.notificationPreferences.findIndex(\n      np => np.project_id === projectId && np.user_id === userId\n    )\n\n    const pref = {\n      id: existingIndex >= 0 ? localData.notificationPreferences[existingIndex].id : crypto.randomUUID(),\n      project_id: projectId,\n      user_id: userId,\n      notification_types: notificationTypes,\n      created_at: existingIndex >= 0 ? localData.notificationPreferences[existingIndex].created_at : new Date().toISOString(),\n      updated_at: new Date().toISOString()\n    }\n\n    if (existingIndex >= 0) {\n      localData.notificationPreferences[existingIndex] = pref\n    } else {\n      localData.notificationPreferences.push(pref)\n    }\n\n    setLocalData(localData)\n    return pref\n  },\n\n  // Remove notification preferences for a user on a project\n  async removeNotificationPreference(projectId, userId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('notification_preferences')\n        .delete()\n        .eq('project_id', projectId)\n        .eq('user_id', userId)\n\n      if (error) {\n        console.error('Error removing notification preference:', error)\n        throw error\n      }\n      return true\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.notificationPreferences) return true\n    localData.notificationPreferences = localData.notificationPreferences.filter(\n      np => !(np.project_id === projectId && np.user_id === userId)\n    )\n    setLocalData(localData)\n    return true\n  },\n\n  // Bulk set notification preferences for multiple users on a project\n  async setProjectNotificationPreferences(projectId, userPreferences) {\n    // userPreferences is an array of { userId, notificationTypes }\n    const results = []\n    for (const pref of userPreferences) {\n      if (pref.notificationTypes && pref.notificationTypes.length > 0) {\n        const result = await this.setNotificationPreference(projectId, pref.userId, pref.notificationTypes)\n        results.push(result)\n      } else {\n        await this.removeNotificationPreference(projectId, pref.userId)\n      }\n    }\n    return results\n  },\n\n  // ============================================\n  // Notification Presets (Company-wide roles)\n  // ============================================\n\n  // Get notification presets for a company\n  async getNotificationPresets(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('notification_presets')\n        .select('*')\n        .eq('company_id', companyId)\n        .order('name')\n\n      if (error) {\n        console.error('Error fetching notification presets:', error)\n        return []\n      }\n      return data || []\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.notificationPresets) {\n      // Return default presets\n      return [\n        { id: 'preset-1', name: 'Project Manager', notification_types: ['message', 'material_request', 'injury_report', 'tm_ticket'], company_id: companyId },\n        { id: 'preset-2', name: 'Safety Officer', notification_types: ['injury_report'], company_id: companyId },\n        { id: 'preset-3', name: 'Purchasing', notification_types: ['material_request'], company_id: companyId },\n        { id: 'preset-4', name: 'Accounting', notification_types: ['tm_ticket'], company_id: companyId }\n      ]\n    }\n    return localData.notificationPresets.filter(np => np.company_id === companyId)\n  },\n\n  // Create a notification preset\n  async createNotificationPreset(companyId, name, notificationTypes) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('notification_presets')\n        .insert({\n          company_id: companyId,\n          name,\n          notification_types: notificationTypes\n        })\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error creating notification preset:', error)\n        throw error\n      }\n      return data\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.notificationPresets) {\n      localData.notificationPresets = []\n    }\n    const preset = {\n      id: crypto.randomUUID(),\n      company_id: companyId,\n      name,\n      notification_types: notificationTypes,\n      created_at: new Date().toISOString()\n    }\n    localData.notificationPresets.push(preset)\n    setLocalData(localData)\n    return preset\n  },\n\n  // Update a notification preset\n  async updateNotificationPreset(presetId, name, notificationTypes) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('notification_presets')\n        .update({\n          name,\n          notification_types: notificationTypes,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', presetId)\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error updating notification preset:', error)\n        throw error\n      }\n      return data\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.notificationPresets) return null\n    const index = localData.notificationPresets.findIndex(p => p.id === presetId)\n    if (index === -1) return null\n    localData.notificationPresets[index] = {\n      ...localData.notificationPresets[index],\n      name,\n      notification_types: notificationTypes,\n      updated_at: new Date().toISOString()\n    }\n    setLocalData(localData)\n    return localData.notificationPresets[index]\n  },\n\n  // Delete a notification preset\n  async deleteNotificationPreset(presetId) {\n    if (isSupabaseConfigured) {\n      const { error } = await supabase\n        .from('notification_presets')\n        .delete()\n        .eq('id', presetId)\n\n      if (error) {\n        console.error('Error deleting notification preset:', error)\n        throw error\n      }\n      return true\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.notificationPresets) return true\n    localData.notificationPresets = localData.notificationPresets.filter(p => p.id !== presetId)\n    setLocalData(localData)\n    return true\n  },\n\n  // ============================================\n  // Dump Sites & Haul-Off Tracking\n  // ============================================\n\n  // Get all dump sites for a company\n  async getDumpSites(companyId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('dump_sites')\n        .select(`\n          *,\n          dump_site_rates (*)\n        `)\n        .eq('company_id', companyId)\n        .eq('active', true)\n        .order('name')\n\n      if (error) {\n        console.error('Error fetching dump sites:', error)\n        return []\n      }\n      return data || []\n    }\n    // Demo mode\n    const localData = getLocalData()\n    return (localData.dumpSites || []).filter(ds => ds.company_id === companyId && ds.active)\n  },\n\n  // Create a new dump site\n  async createDumpSite(companyId, name, address = '', notes = '') {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('dump_sites')\n        .insert({\n          company_id: companyId,\n          name,\n          address,\n          notes,\n          active: true\n        })\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error creating dump site:', error)\n        throw error\n      }\n      return data\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.dumpSites) localData.dumpSites = []\n    const dumpSite = {\n      id: crypto.randomUUID(),\n      company_id: companyId,\n      name,\n      address,\n      notes,\n      active: true,\n      created_at: new Date().toISOString(),\n      dump_site_rates: []\n    }\n    localData.dumpSites.push(dumpSite)\n    setLocalData(localData)\n    return dumpSite\n  },\n\n  // Update a dump site\n  async updateDumpSite(dumpSiteId, updates) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('dump_sites')\n        .update({\n          ...updates,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', dumpSiteId)\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error updating dump site:', error)\n        throw error\n      }\n      return data\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.dumpSites) return null\n    const index = localData.dumpSites.findIndex(ds => ds.id === dumpSiteId)\n    if (index === -1) return null\n    localData.dumpSites[index] = { ...localData.dumpSites[index], ...updates }\n    setLocalData(localData)\n    return localData.dumpSites[index]\n  },\n\n  // Delete (soft) a dump site\n  async deleteDumpSite(dumpSiteId) {\n    return this.updateDumpSite(dumpSiteId, { active: false })\n  },\n\n  // Set rate for a waste type at a dump site\n  async setDumpSiteRate(dumpSiteId, wasteType, estimatedCostPerLoad, unit = 'load') {\n    if (isSupabaseConfigured) {\n      // First check if rate exists\n      const { data: existing } = await supabase\n        .from('dump_site_rates')\n        .select('id')\n        .eq('dump_site_id', dumpSiteId)\n        .eq('waste_type', wasteType)\n        .maybeSingle()\n\n      if (existing) {\n        // Update existing rate\n        const { data, error } = await supabase\n          .from('dump_site_rates')\n          .update({\n            estimated_cost_per_load: estimatedCostPerLoad,\n            unit\n          })\n          .eq('id', existing.id)\n          .select()\n          .single()\n\n        if (error) {\n          console.error('Error updating dump site rate:', error)\n          throw error\n        }\n        return data\n      } else {\n        // Insert new rate\n        const { data, error } = await supabase\n          .from('dump_site_rates')\n          .insert({\n            dump_site_id: dumpSiteId,\n            waste_type: wasteType,\n            estimated_cost_per_load: estimatedCostPerLoad,\n            unit\n          })\n          .select()\n          .single()\n\n        if (error) {\n          console.error('Error inserting dump site rate:', error)\n          throw error\n        }\n        return data\n      }\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.dumpSiteRates) localData.dumpSiteRates = []\n    const existingIndex = localData.dumpSiteRates.findIndex(\n      r => r.dump_site_id === dumpSiteId && r.waste_type === wasteType\n    )\n    const rate = {\n      id: existingIndex >= 0 ? localData.dumpSiteRates[existingIndex].id : crypto.randomUUID(),\n      dump_site_id: dumpSiteId,\n      waste_type: wasteType,\n      estimated_cost_per_load: estimatedCostPerLoad,\n      unit,\n      created_at: new Date().toISOString()\n    }\n    if (existingIndex >= 0) {\n      localData.dumpSiteRates[existingIndex] = rate\n    } else {\n      localData.dumpSiteRates.push(rate)\n    }\n    setLocalData(localData)\n    return rate\n  },\n\n  // Get rates for a dump site\n  async getDumpSiteRates(dumpSiteId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('dump_site_rates')\n        .select('*')\n        .eq('dump_site_id', dumpSiteId)\n\n      if (error) {\n        console.error('Error fetching dump site rates:', error)\n        return []\n      }\n      return data || []\n    }\n    // Demo mode\n    const localData = getLocalData()\n    return (localData.dumpSiteRates || []).filter(r => r.dump_site_id === dumpSiteId)\n  },\n\n  // Get all haul-offs for a project\n  async getHaulOffs(projectId) {\n    if (isSupabaseConfigured) {\n      const { data, error } = await supabase\n        .from('haul_offs')\n        .select(`\n          *,\n          dump_sites (name)\n        `)\n        .eq('project_id', projectId)\n        .order('work_date', { ascending: false })\n\n      if (error) {\n        console.error('Error fetching haul-offs:', error)\n        return []\n      }\n      return data || []\n    }\n    // Demo mode\n    const localData = getLocalData()\n    return (localData.haulOffs || [])\n      .filter(h => h.project_id === projectId)\n      .sort((a, b) => new Date(b.work_date) - new Date(a.work_date))\n  },\n\n  // Create a haul-off event\n  async createHaulOff(projectId, data) {\n    const haulOff = {\n      project_id: projectId,\n      dump_site_id: data.dumpSiteId,\n      waste_type: data.wasteType,\n      loads: data.loads,\n      hauling_company: data.haulingCompany || '',\n      work_date: data.workDate,\n      notes: data.notes || '',\n      estimated_cost: data.estimatedCost || 0,\n      created_by: data.createdBy || ''\n    }\n\n    if (isSupabaseConfigured) {\n      const { data: result, error } = await supabase\n        .from('haul_offs')\n        .insert(haulOff)\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error creating haul-off:', error)\n        throw error\n      }\n      return result\n    }\n    // Demo mode\n    const localData = getLocalData()\n    if (!localData.haulOffs) localData.haulOffs = []\n    const newHaulOff = {\n      ...haulOff,\n      id: crypto.randomUUID(),\n      created_at: new Date().toISOString()\n    }\n    localData.haulOffs.push(newHaulOff)\n    setLocalData(localData)\n    return newHaulOff\n  },\n\n  // Calculate haul-off costs for burn rate\n  async calculateHaulOffCosts(projectId) {\n    const haulOffs = await this.getHaulOffs(projectId)\n\n    let totalCost = 0\n    let totalLoads = 0\n    const byWasteType = {}\n    const byDate = []\n\n    // Group by date for daily breakdown\n    const dateMap = {}\n\n    haulOffs.forEach(h => {\n      const cost = parseFloat(h.estimated_cost) || 0\n      const loads = parseInt(h.loads) || 0\n\n      totalCost += cost\n      totalLoads += loads\n\n      // By waste type\n      if (!byWasteType[h.waste_type]) {\n        byWasteType[h.waste_type] = { loads: 0, cost: 0 }\n      }\n      byWasteType[h.waste_type].loads += loads\n      byWasteType[h.waste_type].cost += cost\n\n      // By date\n      if (!dateMap[h.work_date]) {\n        dateMap[h.work_date] = { date: h.work_date, loads: 0, cost: 0 }\n      }\n      dateMap[h.work_date].loads += loads\n      dateMap[h.work_date].cost += cost\n    })\n\n    // Convert dateMap to sorted array\n    Object.values(dateMap)\n      .sort((a, b) => new Date(b.date) - new Date(a.date))\n      .forEach(d => byDate.push(d))\n\n    const daysWithHaulOff = byDate.length\n\n    return {\n      totalCost,\n      totalLoads,\n      byWasteType,\n      byDate,\n      daysWithHaulOff,\n      avgDailyHaulOffCost: daysWithHaulOff > 0 ? totalCost / daysWithHaulOff : 0\n    }\n  },\n\n  // Subscribe to haul-off updates for a project\n  subscribeToHaulOffs(projectId, callback) {\n    if (isSupabaseConfigured) {\n      return supabase\n        .channel(`haul_offs:${projectId}`)\n        .on('postgres_changes',\n          { event: '*', schema: 'public', table: 'haul_offs', filter: `project_id=eq.${projectId}` },\n          callback\n        )\n        .subscribe()\n    }\n    return null\n  },\n\n  // COR, Signature, Invoice, and Project Cost operations (extracted to corOps.js)\n  ...corOps,\n  // ============================================\n  // DOCUMENT MANAGEMENT\n  // ============================================\n\n  // ---- FOLDER MANAGEMENT ----\n\n  /**\n   * Create a new document folder\n   */\n  async createFolder(companyId, projectId, folderData) {\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('document_folders')\n      .insert({\n        company_id: companyId,\n        project_id: projectId,\n        name: folderData.name,\n        description: folderData.description || null,\n        icon: folderData.icon || 'folder',\n        color: folderData.color || 'blue',\n        sort_order: folderData.sort_order || 0,\n        created_by: (await client.auth.getUser()).data.user?.id\n      })\n      .select()\n      .single()\n\n    if (error) throw error\n    return data\n  },\n\n  /**\n   * Get all folders for a project\n   */\n  async getProjectFolders(projectId) {\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('document_folders')\n      .select('*')\n      .eq('project_id', projectId)\n      .order('sort_order', { ascending: true })\n      .order('name', { ascending: true })\n\n    if (error) throw error\n\n    // Get document counts for each folder\n    const folderIds = data.map(f => f.id)\n    if (folderIds.length > 0) {\n      const { data: counts, error: countError } = await client\n        .from('documents')\n        .select('folder_id')\n        .in('folder_id', folderIds)\n        .is('archived_at', null)\n        .eq('is_current', true)\n\n      if (!countError && counts) {\n        const countMap = {}\n        counts.forEach(doc => {\n          countMap[doc.folder_id] = (countMap[doc.folder_id] || 0) + 1\n        })\n        data.forEach(folder => {\n          folder.document_count = countMap[folder.id] || 0\n        })\n      }\n    }\n\n    return data\n  },\n\n  /**\n   * Update a folder\n   */\n  async updateFolder(folderId, updates) {\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('document_folders')\n      .update({\n        ...updates,\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', folderId)\n      .select()\n      .single()\n\n    if (error) throw error\n    return data\n  },\n\n  /**\n   * Delete a folder (moves documents to unfiled)\n   */\n  async deleteFolder(folderId) {\n    const client = getClient()\n\n    // First, unassign all documents from this folder\n    await client\n      .from('documents')\n      .update({ folder_id: null })\n      .eq('folder_id', folderId)\n\n    // Then delete the folder\n    const { error } = await client\n      .from('document_folders')\n      .delete()\n      .eq('id', folderId)\n\n    if (error) throw error\n    return true\n  },\n\n  /**\n   * Reorder folders\n   */\n  async reorderFolders(projectId, folderOrder) {\n    const client = getClient()\n\n    // folderOrder is array of { id, sort_order }\n    const updates = folderOrder.map(({ id, sort_order }) =>\n      client\n        .from('document_folders')\n        .update({ sort_order, updated_at: new Date().toISOString() })\n        .eq('id', id)\n        .eq('project_id', projectId)\n    )\n\n    await Promise.all(updates)\n    return true\n  },\n\n  /**\n   * Get documents in a specific folder\n   */\n  async getFolderDocuments(folderId, options = {}) {\n    const client = getClient()\n    const { page = 0, limit = 25 } = options\n\n    let query = client\n      .from('documents')\n      .select('*', { count: 'exact' })\n      .eq('folder_id', folderId)\n      .is('archived_at', null)\n      .eq('is_current', true)\n      .order('uploaded_at', { ascending: false })\n      .range(page * limit, (page + 1) * limit - 1)\n\n    const { data, error, count } = await query\n\n    if (error) throw error\n\n    return {\n      documents: data || [],\n      totalCount: count || 0,\n      hasMore: (count || 0) > (page + 1) * limit\n    }\n  },\n\n  /**\n   * Move document to folder\n   */\n  async moveDocumentToFolder(documentId, folderId) {\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('documents')\n      .update({ folder_id: folderId })\n      .eq('id', documentId)\n      .select()\n      .single()\n\n    if (error) throw error\n    return data\n  },\n\n  /**\n   * Get unfiled documents (no folder assigned)\n   */\n  async getUnfiledDocuments(projectId, options = {}) {\n    const client = getClient()\n    const { page = 0, limit = 25 } = options\n\n    const { data, error, count } = await client\n      .from('documents')\n      .select('*', { count: 'exact' })\n      .eq('project_id', projectId)\n      .is('folder_id', null)\n      .is('archived_at', null)\n      .eq('is_current', true)\n      .order('uploaded_at', { ascending: false })\n      .range(page * limit, (page + 1) * limit - 1)\n\n    if (error) throw error\n\n    return {\n      documents: data || [],\n      totalCount: count || 0,\n      hasMore: (count || 0) > (page + 1) * limit\n    }\n  },\n\n  // ---- DOCUMENT CRUD ----\n\n  /**\n   * Upload a document to project storage\n   */\n  async uploadDocument(companyId, projectId, file, metadata = {}) {\n    const client = getClient()\n    const startTime = Date.now()\n\n    // Check project storage limit (250 MB default)\n    const STORAGE_LIMIT = 250 * 1024 * 1024 // 250 MB\n    const { data: usageData } = await client\n      .from('documents')\n      .select('file_size_bytes')\n      .eq('project_id', projectId)\n      .is('archived_at', null)\n\n    const currentUsage = usageData?.reduce((sum, doc) => sum + (doc.file_size_bytes || 0), 0) || 0\n    if (currentUsage + file.size > STORAGE_LIMIT) {\n      const usedMB = Math.round(currentUsage / 1024 / 1024)\n      const limitMB = Math.round(STORAGE_LIMIT / 1024 / 1024)\n      throw new Error(`Project storage limit reached (${usedMB}/${limitMB} MB). Contact support to upgrade.`)\n    }\n\n    // Generate secure filename\n    const timestamp = Date.now()\n    const randomBytes = new Uint8Array(6)\n    crypto.getRandomValues(randomBytes)\n    const randomId = Array.from(randomBytes, b => b.toString(36)).join('')\n    const ext = file.name.split('.').pop()?.toLowerCase() || 'bin'\n    const fileName = `${timestamp}-${randomId}.${ext}`\n    const storagePath = `${companyId}/${projectId}/documents/${fileName}`\n\n    try {\n      // Upload to storage\n      const { data: storageData, error: storageError } = await client.storage\n        .from('project-documents')\n        .upload(storagePath, file, {\n          cacheControl: '3600',\n          upsert: false\n        })\n\n      if (storageError) throw storageError\n\n      // Get public URL\n      const { data: urlData } = client.storage\n        .from('project-documents')\n        .getPublicUrl(storagePath)\n\n      const uploadedUrl = urlData.publicUrl\n\n      // Determine approval status (contracts need approval)\n      const approvalStatus = metadata.category === 'contracts' ? 'pending' : 'approved'\n\n      // Create document record\n      const { data: document, error: docError } = await client\n        .from('documents')\n        .insert({\n          company_id: companyId,\n          project_id: projectId,\n          name: metadata.name || file.name.replace(/\\.[^/.]+$/, ''),\n          description: metadata.description || null,\n          file_name: file.name,\n          file_size_bytes: file.size,\n          mime_type: file.type,\n          storage_path: storagePath,\n          folder_id: metadata.folderId || null,\n          category: metadata.category || 'general',\n          tags: metadata.tags || [],\n          visibility: metadata.visibility || 'all',\n          approval_status: approvalStatus,\n          resource_type: metadata.resourceType || null,\n          resource_id: metadata.resourceId || null,\n          uploaded_by: (await client.auth.getUser()).data?.user?.id\n        })\n        .select()\n        .single()\n\n      if (docError) throw docError\n\n      const duration = Date.now() - startTime\n      observe.storage('document_upload', {\n        company_id: companyId,\n        project_id: projectId,\n        file_size: file.size,\n        mime_type: file.type,\n        duration,\n        success: true\n      })\n\n      return { ...document, url: uploadedUrl }\n    } catch (error) {\n      observe.error('storage', {\n        message: error.message,\n        operation: 'uploadDocument',\n        company_id: companyId,\n        project_id: projectId\n      })\n      throw error\n    }\n  },\n\n  /**\n   * Get documents for a project\n   */\n  async getProjectDocuments(projectId, { category = null, page = 0, limit = 25, includeArchived = false } = {}) {\n    const client = getClient()\n\n    let query = client\n      .from('documents')\n      .select('*', { count: 'exact' })\n      .eq('project_id', projectId)\n      .eq('is_current', true)\n      .order('uploaded_at', { ascending: false })\n      .range(page * limit, (page + 1) * limit - 1)\n\n    if (!includeArchived) {\n      query = query.is('archived_at', null)\n    }\n\n    if (category && category !== 'all') {\n      query = query.eq('category', category)\n    }\n\n    const { data, error, count } = await query\n\n    if (error) throw error\n\n    return {\n      documents: data || [],\n      totalCount: count || 0,\n      hasMore: (page + 1) * limit < (count || 0),\n      page,\n      limit\n    }\n  },\n\n  /**\n   * Get a single document by ID\n   */\n  async getDocument(documentId) {\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('documents')\n      .select('*')\n      .eq('id', documentId)\n      .single()\n\n    if (error) throw error\n    return data\n  },\n\n  /**\n   * Get all versions of a document\n   */\n  async getDocumentVersions(documentId) {\n    const client = getClient()\n\n    // First get the document to find parent or self\n    const { data: doc, error: docError } = await client\n      .from('documents')\n      .select('id, parent_document_id')\n      .eq('id', documentId)\n      .single()\n\n    if (docError) throw docError\n\n    // Get all versions (parent + all children with same parent)\n    const parentId = doc.parent_document_id || documentId\n\n    const { data, error } = await client\n      .from('documents')\n      .select('*')\n      .or(`id.eq.${parentId},parent_document_id.eq.${parentId}`)\n      .order('version', { ascending: false })\n\n    if (error) throw error\n    return data || []\n  },\n\n  /**\n   * Upload a new version of an existing document\n   */\n  async uploadDocumentVersion(parentDocumentId, companyId, projectId, file, metadata = {}) {\n    const client = getClient()\n\n    // Get the parent document to copy metadata and determine version\n    const { data: parentDoc, error: parentError } = await client\n      .from('documents')\n      .select('*')\n      .eq('id', parentDocumentId)\n      .single()\n\n    if (parentError) throw parentError\n\n    // Get highest version number\n    const { data: versions } = await client\n      .from('documents')\n      .select('version')\n      .or(`id.eq.${parentDocumentId},parent_document_id.eq.${parentDocumentId}`)\n      .order('version', { ascending: false })\n      .limit(1)\n\n    const newVersion = (versions?.[0]?.version || 1) + 1\n\n    // Mark all previous versions as not current\n    await client\n      .from('documents')\n      .update({ is_current: false })\n      .or(`id.eq.${parentDocumentId},parent_document_id.eq.${parentDocumentId}`)\n\n    // Upload the new version\n    const result = await this.uploadDocument(companyId, projectId, file, {\n      name: metadata.name || parentDoc.name,\n      description: metadata.description || parentDoc.description,\n      category: parentDoc.category,\n      visibility: parentDoc.visibility,\n      tags: parentDoc.tags,\n      resourceType: parentDoc.resource_type,\n      resourceId: parentDoc.resource_id\n    })\n\n    // Update the new document with version info\n    const { data: updatedDoc, error: updateError } = await client\n      .from('documents')\n      .update({\n        version: newVersion,\n        is_current: true,\n        parent_document_id: parentDocumentId\n      })\n      .eq('id', result.id)\n      .select()\n      .single()\n\n    if (updateError) throw updateError\n\n    // Log version creation\n    await client.from('document_audit_log').insert({\n      document_id: result.id,\n      project_id: projectId,\n      company_id: companyId,\n      operation: 'version_created',\n      details: { version: newVersion, parent_id: parentDocumentId },\n      triggered_by: 'user',\n      user_id: (await client.auth.getUser()).data?.user?.id\n    })\n\n    return { ...result, ...updatedDoc }\n  },\n\n  /**\n   * Update document metadata\n   */\n  async updateDocument(documentId, updates) {\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('documents')\n      .update({\n        name: updates.name,\n        description: updates.description,\n        category: updates.category,\n        visibility: updates.visibility,\n        tags: updates.tags\n      })\n      .eq('id', documentId)\n      .select()\n      .single()\n\n    if (error) throw error\n    return data\n  },\n\n  /**\n   * Archive (soft delete) a document\n   */\n  async archiveDocument(documentId) {\n    const client = getClient()\n    const userId = (await client.auth.getUser()).data?.user?.id\n\n    const { data, error } = await client\n      .from('documents')\n      .update({\n        archived_at: new Date().toISOString(),\n        archived_by: userId\n      })\n      .eq('id', documentId)\n      .select()\n      .single()\n\n    if (error) throw error\n\n    // Log the deletion\n    await client.from('document_audit_log').insert({\n      document_id: documentId,\n      project_id: data.project_id,\n      company_id: data.company_id,\n      operation: 'deleted',\n      triggered_by: 'user',\n      user_id: userId\n    })\n\n    return data\n  },\n\n  /**\n   * Restore an archived document\n   */\n  async restoreDocument(documentId) {\n    const client = getClient()\n    const userId = (await client.auth.getUser()).data?.user?.id\n\n    const { data, error } = await client\n      .from('documents')\n      .update({\n        archived_at: null,\n        archived_by: null\n      })\n      .eq('id', documentId)\n      .select()\n      .single()\n\n    if (error) throw error\n\n    // Log the restoration\n    await client.from('document_audit_log').insert({\n      document_id: documentId,\n      project_id: data.project_id,\n      company_id: data.company_id,\n      operation: 'restored',\n      triggered_by: 'user',\n      user_id: userId\n    })\n\n    return data\n  },\n\n  /**\n   * Permanently delete a document (admin only)\n   */\n  async deleteDocumentPermanently(documentId) {\n    const client = getClient()\n\n    // Get document to find storage path\n    const { data: doc, error: docError } = await client\n      .from('documents')\n      .select('storage_path, company_id, project_id')\n      .eq('id', documentId)\n      .single()\n\n    if (docError) throw docError\n\n    // Delete from storage\n    if (doc.storage_path) {\n      await client.storage\n        .from('project-documents')\n        .remove([doc.storage_path])\n    }\n\n    // Delete from database\n    const { error } = await client\n      .from('documents')\n      .delete()\n      .eq('id', documentId)\n\n    if (error) throw error\n    return true\n  },\n\n  /**\n   * Link a document to a resource (COR, T&M ticket, etc.)\n   */\n  async linkDocumentToResource(documentId, resourceType, resourceId) {\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('documents')\n      .update({\n        resource_type: resourceType,\n        resource_id: resourceId\n      })\n      .eq('id', documentId)\n      .select()\n      .single()\n\n    if (error) throw error\n\n    // Log the link\n    await client.from('document_audit_log').insert({\n      document_id: documentId,\n      project_id: data.project_id,\n      company_id: data.company_id,\n      operation: 'linked',\n      details: { resource_type: resourceType, resource_id: resourceId },\n      triggered_by: 'user',\n      user_id: (await client.auth.getUser()).data?.user?.id\n    })\n\n    return data\n  },\n\n  /**\n   * Unlink a document from a resource\n   */\n  async unlinkDocumentFromResource(documentId) {\n    const client = getClient()\n\n    const { data: doc } = await client\n      .from('documents')\n      .select('resource_type, resource_id, project_id, company_id')\n      .eq('id', documentId)\n      .single()\n\n    const { data, error } = await client\n      .from('documents')\n      .update({\n        resource_type: null,\n        resource_id: null\n      })\n      .eq('id', documentId)\n      .select()\n      .single()\n\n    if (error) throw error\n\n    // Log the unlink\n    await client.from('document_audit_log').insert({\n      document_id: documentId,\n      project_id: doc.project_id,\n      company_id: doc.company_id,\n      operation: 'unlinked',\n      details: { resource_type: doc.resource_type, resource_id: doc.resource_id },\n      triggered_by: 'user',\n      user_id: (await client.auth.getUser()).data?.user?.id\n    })\n\n    return data\n  },\n\n  /**\n   * Get documents linked to a specific resource\n   */\n  async getResourceDocuments(resourceType, resourceId) {\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('documents')\n      .select('*')\n      .eq('resource_type', resourceType)\n      .eq('resource_id', resourceId)\n      .is('archived_at', null)\n      .order('uploaded_at', { ascending: false })\n\n    if (error) throw error\n    return data || []\n  },\n\n  /**\n   * Approve a document (admin only)\n   */\n  async approveDocument(documentId) {\n    const client = getClient()\n\n    const { data, error } = await client.rpc('approve_document', {\n      p_document_id: documentId\n    })\n\n    if (error) throw error\n    return data\n  },\n\n  /**\n   * Reject a document (admin only)\n   */\n  async rejectDocument(documentId, reason) {\n    const client = getClient()\n\n    const { data, error } = await client.rpc('reject_document', {\n      p_document_id: documentId,\n      p_reason: reason\n    })\n\n    if (error) throw error\n    return data\n  },\n\n  /**\n   * Get pending documents for approval\n   */\n  async getPendingDocuments(companyId) {\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('documents')\n      .select('*, project:projects(name)')\n      .eq('company_id', companyId)\n      .eq('approval_status', 'pending')\n      .is('archived_at', null)\n      .order('uploaded_at', { ascending: false })\n\n    if (error) throw error\n    return data || []\n  },\n\n  /**\n   * Search documents by name/description\n   */\n  async searchDocuments(projectId, query) {\n    const client = getClient()\n\n    const { data, error } = await client\n      .from('documents')\n      .select('*')\n      .eq('project_id', projectId)\n      .eq('is_current', true)\n      .is('archived_at', null)\n      .or(`name.ilike.%${query}%,description.ilike.%${query}%`)\n      .order('uploaded_at', { ascending: false })\n      .limit(20)\n\n    if (error) throw error\n    return data || []\n  },\n\n  /**\n   * Log document download/view\n   */\n  async logDocumentAccess(documentId, operation = 'downloaded') {\n    const client = getClient()\n\n    const { data: doc } = await client\n      .from('documents')\n      .select('project_id, company_id')\n      .eq('id', documentId)\n      .single()\n\n    if (!doc) return\n\n    await client.from('document_audit_log').insert({\n      document_id: documentId,\n      project_id: doc.project_id,\n      company_id: doc.company_id,\n      operation,\n      triggered_by: 'user',\n      user_id: (await client.auth.getUser()).data?.user?.id\n    })\n  }\n}\n\n// ============================================\n// Offline Support Exports\n// ============================================\n\n// Re-export offline utilities for UI components\nexport {\n  getConnectionStatus,\n  onConnectionChange,\n  getPendingActionCount,\n  syncPendingActions\n}\n\n// Sync pending actions when coming back online\nonConnectionChange(async (online) => {\n  if (online && isSupabaseConfigured) {\n    try {\n      await syncPendingActions(db)\n    } catch (err) {\n      console.error('Error syncing pending actions:', err)\n    }\n  }\n})\n\n","import { createContext, useContext, useState, useEffect, useMemo, useCallback } from 'react'\nimport { supabase, isSupabaseConfigured } from './supabase'\n\nconst BrandingContext = createContext()\n\n// Default branding\nconst DEFAULT_BRANDING = {\n  logo_url: null,\n  favicon_url: null,\n  login_background_url: null,\n  primary_color: '#3B82F6',\n  secondary_color: '#1E40AF',\n  custom_app_name: 'FieldSync',\n  hide_fieldsync_branding: false,\n  email_from_name: 'FieldSync',\n  email_from_address: null,\n  custom_domain: null,\n  domain_verified: false\n}\n\nexport function BrandingProvider({ children, companyId }) {\n  const [branding, setBranding] = useState(DEFAULT_BRANDING)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    if (companyId) {\n      loadBranding(companyId)\n    } else {\n      // Check if we're on a custom domain\n      loadBrandingByDomain()\n    }\n  }, [companyId])\n\n  // Apply branding as CSS variables when branding changes\n  useEffect(() => {\n    applyBrandingToDOM(branding)\n  }, [branding])\n\n  const loadBranding = async (companyId) => {\n    try {\n      setLoading(true)\n\n      if (!isSupabaseConfigured) {\n        // Demo mode - use default branding\n        setBranding(DEFAULT_BRANDING)\n        setLoading(false)\n        return\n      }\n\n      const { data, error } = await supabase\n        .from('company_branding')\n        .select('*')\n        .eq('company_id', companyId)\n        .single()\n\n      if (error) {\n        // If no branding exists, create default one\n        if (error.code === 'PGRST116') {\n          await createDefaultBranding(companyId)\n        } else {\n          console.error('Error loading branding:', error)\n        }\n        setBranding(DEFAULT_BRANDING)\n      } else {\n        setBranding({ ...DEFAULT_BRANDING, ...data })\n      }\n    } catch (error) {\n      console.error('Error in loadBranding:', error)\n      setBranding(DEFAULT_BRANDING)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const loadBrandingByDomain = async () => {\n    try {\n      setLoading(true)\n      const currentDomain = window.location.hostname\n\n      // Skip for localhost\n      if (currentDomain === 'localhost' || currentDomain === '127.0.0.1') {\n        setBranding(DEFAULT_BRANDING)\n        setLoading(false)\n        return\n      }\n\n      if (!isSupabaseConfigured) {\n        setBranding(DEFAULT_BRANDING)\n        setLoading(false)\n        return\n      }\n\n      const { data, error } = await supabase\n        .rpc('get_branding_by_domain', { domain_name: currentDomain })\n\n      if (error || !data || data.length === 0) {\n        setBranding(DEFAULT_BRANDING)\n      } else {\n        setBranding({ ...DEFAULT_BRANDING, ...data[0] })\n      }\n    } catch (error) {\n      console.error('Error loading branding by domain:', error)\n      setBranding(DEFAULT_BRANDING)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const createDefaultBranding = async (companyId) => {\n    try {\n      const { data, error } = await supabase\n        .from('company_branding')\n        .insert({\n          company_id: companyId,\n          ...DEFAULT_BRANDING\n        })\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error creating default branding:', error)\n      }\n    } catch (error) {\n      console.error('Error in createDefaultBranding:', error)\n    }\n  }\n\n  const updateBranding = useCallback(async (updates) => {\n    try {\n      if (!isSupabaseConfigured) {\n        // Demo mode - just update state\n        setBranding(prev => ({ ...prev, ...updates }))\n        return { success: true }\n      }\n\n      if (!companyId) {\n        return { success: false, error: 'No company ID' }\n      }\n\n      // Clean the updates object - remove id, company_id and any undefined values\n      const cleanedUpdates = {}\n      const allowedFields = [\n        'logo_url', 'favicon_url', 'login_background_url',\n        'primary_color', 'secondary_color', 'custom_app_name',\n        'hide_fieldsync_branding', 'email_from_name', 'email_from_address',\n        'custom_domain', 'domain_verified'\n      ]\n\n      for (const field of allowedFields) {\n        if (updates[field] !== undefined) {\n          cleanedUpdates[field] = updates[field]\n        }\n      }\n\n      // First check if branding record exists\n      const { data: existing, error: checkError } = await supabase\n        .from('company_branding')\n        .select('id')\n        .eq('company_id', companyId)\n        .single()\n\n      if (checkError && checkError.code === 'PGRST116') {\n        // No record exists, create one\n        const { data, error } = await supabase\n          .from('company_branding')\n          .insert({\n            company_id: companyId,\n            ...cleanedUpdates\n          })\n          .select()\n          .single()\n\n        if (error) {\n          console.error('Error creating branding:', error)\n          return { success: false, error: error.message }\n        }\n\n        setBranding({ ...DEFAULT_BRANDING, ...data })\n        return { success: true, data }\n      }\n\n      // Record exists, update it\n      const { data, error } = await supabase\n        .from('company_branding')\n        .update(cleanedUpdates)\n        .eq('company_id', companyId)\n        .select()\n        .single()\n\n      if (error) {\n        console.error('Error updating branding:', error)\n        return { success: false, error: error.message }\n      }\n\n      setBranding({ ...DEFAULT_BRANDING, ...data })\n      return { success: true, data }\n    } catch (error) {\n      console.error('Error in updateBranding:', error)\n      return { success: false, error: error.message }\n    }\n  }, [companyId])\n\n  const applyBrandingToDOM = (branding) => {\n    const root = document.documentElement\n\n    // Apply CSS variables\n    root.style.setProperty('--primary-color', branding.primary_color)\n    root.style.setProperty('--secondary-color', branding.secondary_color)\n\n    // Update favicon if provided\n    if (branding.favicon_url) {\n      let favicon = document.querySelector(\"link[rel*='icon']\")\n      if (!favicon) {\n        favicon = document.createElement('link')\n        favicon.rel = 'icon'\n        document.head.appendChild(favicon)\n      }\n      favicon.href = branding.favicon_url\n    }\n\n    // Update page title\n    document.title = branding.custom_app_name || 'FieldSync'\n  }\n\n  const uploadBrandingImage = useCallback(async (file, type) => {\n    try {\n      if (!isSupabaseConfigured) {\n        // Demo mode - create object URL\n        const url = URL.createObjectURL(file)\n        return { success: true, url }\n      }\n\n      const fileExt = file.name.split('.').pop()\n      const fileName = `${companyId}/${type}-${Date.now()}.${fileExt}`\n      const filePath = `branding/${fileName}`\n\n      const { data, error } = await supabase.storage\n        .from('public')\n        .upload(filePath, file, {\n          cacheControl: '3600',\n          upsert: true\n        })\n\n      if (error) {\n        console.error('Error uploading image:', error)\n        return { success: false, error: error.message }\n      }\n\n      const { data: { publicUrl } } = supabase.storage\n        .from('public')\n        .getPublicUrl(filePath)\n\n      return { success: true, url: publicUrl }\n    } catch (error) {\n      console.error('Error in uploadBrandingImage:', error)\n      return { success: false, error: error.message }\n    }\n  }, [companyId])\n\n  const refreshBranding = useCallback(() => {\n    if (companyId) {\n      loadBranding(companyId)\n    } else {\n      loadBrandingByDomain()\n    }\n  }, [companyId])\n\n  const value = useMemo(() => ({\n    branding,\n    loading,\n    updateBranding,\n    uploadBrandingImage,\n    refreshBranding\n  }), [branding, loading, updateBranding, uploadBrandingImage, refreshBranding])\n\n  return (\n    <BrandingContext.Provider value={value}>\n      {children}\n    </BrandingContext.Provider>\n  )\n}\n\nexport function useBranding() {\n  const context = useContext(BrandingContext)\n  if (!context) {\n    throw new Error('useBranding must be used within a BrandingProvider')\n  }\n  return context\n}\n","import { createContext, useContext, useState, useEffect, useMemo, useCallback } from 'react'\n\nconst ThemeContext = createContext()\n\nexport function ThemeProvider({ children }) {\n  const [theme, setTheme] = useState(() => {\n    // Check localStorage first\n    const saved = localStorage.getItem('fieldsync-theme')\n    if (saved === 'light' || saved === 'dark') {\n      return saved\n    }\n    // Fall back to system preference\n    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {\n      return 'light'\n    }\n    return 'dark'\n  })\n\n  // Apply theme to document\n  useEffect(() => {\n    document.documentElement.setAttribute('data-theme', theme)\n    localStorage.setItem('fieldsync-theme', theme)\n  }, [theme])\n\n  // Listen for system preference changes\n  useEffect(() => {\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: light)')\n    const handleChange = (e) => {\n      // Only auto-switch if user hasn't set a preference\n      const saved = localStorage.getItem('fieldsync-theme')\n      if (!saved) {\n        setTheme(e.matches ? 'light' : 'dark')\n      }\n    }\n\n    mediaQuery.addEventListener('change', handleChange)\n    return () => mediaQuery.removeEventListener('change', handleChange)\n  }, [])\n\n  const toggleTheme = useCallback(() => {\n    setTheme(prev => prev === 'dark' ? 'light' : 'dark')\n  }, [])\n\n  const value = useMemo(() => ({\n    theme,\n    setTheme,\n    toggleTheme\n  }), [theme, toggleTheme])\n\n  return (\n    <ThemeContext.Provider value={value}>\n      {children}\n    </ThemeContext.Provider>\n  )\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext)\n  if (!context) {\n    throw new Error('useTheme must be used within a ThemeProvider')\n  }\n  return context\n}\n","import { createContext, useContext, useState, useCallback, useMemo } from 'react'\n\n/**\n * ToastContext - Global toast notification system\n * Eliminates the need to pass onShowToast through props\n *\n * @example\n * // In any component:\n * const { showToast } = useToast()\n * showToast('Operation successful!', 'success')\n */\n\nconst ToastContext = createContext(null)\n\nexport function ToastProvider({ children }) {\n  const [toast, setToast] = useState(null)\n  const [queue, setQueue] = useState([])\n\n  const hideToast = useCallback(() => {\n    setToast(null)\n  }, [])\n\n  const showToast = useCallback((message, type = 'info', duration = 3000) => {\n    // If there's already a toast, queue this one\n    if (toast) {\n      setQueue(prev => [...prev, { message, type, duration }])\n      return\n    }\n\n    setToast({ message, type, duration })\n\n    // Auto-dismiss after duration\n    if (duration > 0) {\n      setTimeout(() => {\n        setToast(null)\n      }, duration)\n    }\n  }, [toast])\n\n  // Process queue when current toast is dismissed\n  const processQueue = useCallback(() => {\n    if (queue.length > 0) {\n      const [next, ...rest] = queue\n      setQueue(rest)\n      setTimeout(() => {\n        showToast(next.message, next.type, next.duration)\n      }, 300) // Small delay between toasts\n    }\n  }, [queue, showToast])\n\n  // Handle toast close\n  const handleClose = useCallback(() => {\n    hideToast()\n    processQueue()\n  }, [hideToast, processQueue])\n\n  // Convenience methods for different toast types\n  const success = useCallback((message, duration) => {\n    showToast(message, 'success', duration)\n  }, [showToast])\n\n  const error = useCallback((message, duration) => {\n    showToast(message, 'error', duration)\n  }, [showToast])\n\n  const warning = useCallback((message, duration) => {\n    showToast(message, 'warning', duration)\n  }, [showToast])\n\n  const info = useCallback((message, duration) => {\n    showToast(message, 'info', duration)\n  }, [showToast])\n\n  const value = useMemo(() => ({\n    toast,\n    showToast,\n    hideToast: handleClose,\n    success,\n    error,\n    warning,\n    info\n  }), [toast, showToast, handleClose, success, error, warning, info])\n\n  return (\n    <ToastContext.Provider value={value}>\n      {children}\n      {toast && (\n        <div className=\"toast-container\">\n          <div className={`toast ${toast.type}`} onClick={handleClose}>\n            {toast.message}\n          </div>\n        </div>\n      )}\n    </ToastContext.Provider>\n  )\n}\n\n/**\n * useToast - Hook to access toast notifications\n * @returns {Object} Toast controls\n *\n * @example\n * const { showToast, success, error } = useToast()\n *\n * // Generic toast\n * showToast('Message', 'success')\n *\n * // Convenience methods\n * success('Saved successfully!')\n * error('Something went wrong')\n */\nexport function useToast() {\n  const context = useContext(ToastContext)\n\n  if (!context) {\n    throw new Error('useToast must be used within a ToastProvider')\n  }\n\n  return context\n}\n\n/**\n * withToast - HOC to inject toast into class components or legacy code\n * @deprecated Prefer useToast hook\n */\nexport function withToast(Component) {\n  return function WithToastComponent(props) {\n    const toast = useToast()\n    return <Component {...props} onShowToast={toast.showToast} toast={toast} />\n  }\n}\n\nexport default ToastContext\n","import { useBranding } from '../lib/BrandingContext'\n\nexport default function Logo({ className = '', showPoweredBy = false }) {\n  const { branding } = useBranding()\n\n  return (\n    <div className={`app-logo ${className}`}>\n      {branding.logo_url ? (\n        <img\n          src={branding.logo_url}\n          alt={branding.custom_app_name || 'Logo'}\n          className=\"custom-logo\"\n        />\n      ) : (\n        <div className=\"logo\">\n          {branding.custom_app_name || 'Field'}\n          <span>Sync</span>\n        </div>\n      )}\n\n      {showPoweredBy && !branding.hide_fieldsync_branding && (\n        <div className=\"powered-by\">\n          Powered by FieldSync\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect, useRef } from 'react'\nimport { HardHat, Briefcase, Building2, UserPlus, Eye, EyeOff, Check, ChevronRight, ArrowLeft } from 'lucide-react'\nimport { db, supabase } from '../lib/supabase'\nimport Logo from './Logo'\n\n// Password strength calculator\nfunction getPasswordStrength(pwd) {\n  if (!pwd) return { score: 0, label: '', color: '' }\n  let score = 0\n  if (pwd.length >= 6) score++\n  if (pwd.length >= 8) score++\n  if (/[A-Z]/.test(pwd) && /[a-z]/.test(pwd)) score++\n  if (/\\d/.test(pwd)) score++\n  if (/[^A-Za-z0-9]/.test(pwd)) score++\n\n  if (score <= 1) return { score: 1, label: 'Weak', color: 'var(--accent-red)' }\n  if (score <= 2) return { score: 2, label: 'Fair', color: 'var(--accent-orange)' }\n  if (score <= 3) return { score: 3, label: 'Good', color: 'var(--accent-amber)' }\n  if (score <= 4) return { score: 4, label: 'Strong', color: 'var(--accent-green)' }\n  return { score: 5, label: 'Very strong', color: 'var(--accent-green)' }\n}\n\n// Generate random alphanumeric code\nfunction generateCode(length = 6) {\n  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789' // Excluding confusing chars (0/O, 1/I/L)\n  const array = new Uint32Array(length)\n  crypto.getRandomValues(array)\n  return Array.from(array, v => chars[v % chars.length]).join('')\n}\n\n// Email validation\nfunction isValidEmail(email) {\n  return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)\n}\n\n// Step indicator component\nfunction StepIndicator({ steps, currentStep }) {\n  return (\n    <div className=\"onboarding-step-indicator\">\n      {steps.map((label, i) => {\n        const stepNum = i + 1\n        const isActive = stepNum === currentStep\n        const isCompleted = stepNum < currentStep\n        return (\n          <div key={i} className=\"onboarding-step-wrapper\">\n            {i > 0 && (\n              <div className={`onboarding-step-line ${isCompleted ? 'completed' : ''}`} />\n            )}\n            <div className={`onboarding-step-circle ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}`}>\n              {isCompleted ? <Check size={14} /> : stepNum}\n            </div>\n            <span className={`onboarding-step-label ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}`}>\n              {label}\n            </span>\n          </div>\n        )\n      })}\n    </div>\n  )\n}\n\n// Password input with strength bar and visibility toggle\nfunction PasswordInput({ value, onChange, placeholder, onKeyDown, autoFocus, showStrength }) {\n  const [visible, setVisible] = useState(false)\n  const strength = getPasswordStrength(value)\n\n  return (\n    <div className=\"password-field\">\n      <div className=\"password-input-wrapper\">\n        <input\n          type={visible ? 'text' : 'password'}\n          value={value}\n          onChange={onChange}\n          placeholder={placeholder || 'Password'}\n          onKeyDown={onKeyDown}\n          autoFocus={autoFocus}\n        />\n        <button\n          type=\"button\"\n          className=\"password-toggle\"\n          onClick={() => setVisible(!visible)}\n          tabIndex={-1}\n          aria-label={visible ? 'Hide password' : 'Show password'}\n        >\n          {visible ? <EyeOff size={18} /> : <Eye size={18} />}\n        </button>\n      </div>\n      {showStrength && value && (\n        <div className=\"password-strength\">\n          <div className=\"password-strength-bar\">\n            <div\n              className=\"password-strength-fill\"\n              style={{\n                width: `${(strength.score / 5) * 100}%`,\n                background: strength.color\n              }}\n            />\n          </div>\n          <span className=\"password-strength-label\" style={{ color: strength.color }}>\n            {strength.label}\n          </span>\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default function AppEntry({ onForemanAccess, onOfficeLogin, onShowToast }) {\n  const [mode, setMode] = useState(null) // null, 'foreman', 'office', 'join', 'register'\n\n  // Foreman state\n  const [companyCode, setCompanyCode] = useState('')\n  const [company, setCompany] = useState(null)\n  const [pin, setPin] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [pinState, setPinState] = useState('') // '', 'error', 'success'\n  const [foundProject, setFoundProject] = useState(null) // Project after PIN success, waiting for name\n  const [foremanName, setForemanName] = useState(() => {\n    try { return localStorage.getItem('fieldsync_foreman_name') || '' } catch { return '' }\n  })\n\n  // Refs for timeout cleanup to prevent memory leaks\n  const pinResetTimeoutRef = useRef(null)\n  const pinSubmitTimeoutRef = useRef(null)\n\n  // Cleanup timeouts on unmount\n  useEffect(() => {\n    return () => {\n      if (pinResetTimeoutRef.current) clearTimeout(pinResetTimeoutRef.current)\n      if (pinSubmitTimeoutRef.current) clearTimeout(pinSubmitTimeoutRef.current)\n    }\n  }, [])\n\n  // Office state\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n\n  // Join state\n  const [joinStep, setJoinStep] = useState(1) // 1: company code, 2: office code, 3: create account\n  const [joinCompany, setJoinCompany] = useState(null)\n  const [officeCode, setOfficeCode] = useState('')\n  const [joinName, setJoinName] = useState('')\n  const [joinEmail, setJoinEmail] = useState('')\n  const [joinPassword, setJoinPassword] = useState('')\n  const [joinSuccess, setJoinSuccess] = useState(false) // Show success screen after join\n\n  // Register state\n  const [registerStep, setRegisterStep] = useState(1) // 1: company info, 2: admin account, 3: success\n  const [registerCompanyName, setRegisterCompanyName] = useState('')\n  const [registerName, setRegisterName] = useState('')\n  const [registerEmail, setRegisterEmail] = useState('')\n  const [registerPassword, setRegisterPassword] = useState('')\n  const [createdCompany, setCreatedCompany] = useState(null) // Stores created company info\n\n  // Handle company code\n  const handleCompanyCodeChange = (value) => {\n    const cleaned = value.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 20)\n    setCompanyCode(cleaned)\n  }\n\n  // Verify company code\n  const submitCompanyCode = async () => {\n    if (companyCode.length < 2) {\n      onShowToast('Enter company code', 'error')\n      return\n    }\n\n    setLoading(true)\n    try {\n      const foundCompany = await db.getCompanyByCode(companyCode)\n      if (foundCompany) {\n        setCompany(foundCompany)\n      } else {\n        onShowToast('Invalid company code', 'error')\n        setCompanyCode('')\n      }\n    } catch (err) {\n      onShowToast('Error checking code', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Submit PIN - uses secure session-based validation with fallback\n  const submitPin = async (pinToSubmit) => {\n    if (pinToSubmit.length !== 4) return\n\n    setLoading(true)\n    setPinState('')\n\n    try {\n      // Try secure PIN validation first (creates a session token)\n      const result = await db.getProjectByPinSecure(pinToSubmit, company.code)\n\n      if (result.rateLimited) {\n        setPinState('error')\n        onShowToast('Too many attempts. Please wait 15 minutes.', 'error')\n        if (pinResetTimeoutRef.current) clearTimeout(pinResetTimeoutRef.current)\n        pinResetTimeoutRef.current = setTimeout(() => {\n          setPin('')\n          setPinState('')\n        }, 800)\n        return\n      }\n\n      if (result.success && result.project) {\n        setFoundProject(result.project)\n        return\n      }\n\n      // If secure method failed but no rate limit, try fallback lookup\n      // This handles cases where the RPC function isn't deployed yet\n      if (result.error) {\n        const fallbackProject = await db.getProjectByPinAndCompany(pinToSubmit, company.id)\n        if (fallbackProject) {\n          setFoundProject(fallbackProject)\n          return\n        }\n      }\n\n      onShowToast('Invalid PIN', 'error')\n      setPin('')\n    } catch (err) {\n      // Try fallback on exception\n      try {\n        const fallbackProject = await db.getProjectByPinAndCompany(pinToSubmit, company.id)\n        if (fallbackProject) {\n          setFoundProject(fallbackProject)\n          return\n        }\n      } catch (fallbackErr) {\n        // Fallback also failed, silent failure\n      }\n      onShowToast('Error checking PIN', 'error')\n      setPin('')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Submit foreman name and enter the project\n  const handleForemanNameSubmit = () => {\n    if (!foremanName.trim()) {\n      onShowToast('Enter your name to continue', 'error')\n      return\n    }\n    try { localStorage.setItem('fieldsync_foreman_name', foremanName.trim()) } catch { /* ignore */ }\n    onForemanAccess(foundProject, foremanName.trim())\n  }\n\n  // Number pad handler\n  const handleNumberPad = (num) => {\n    if (pin.length < 4 && !loading) {\n      const newPin = pin + num\n      setPin(newPin)\n      setPinState('') // Reset any error state\n      if (newPin.length === 4) {\n        // Optimized timing - submit immediately after slight visual feedback\n        if (pinSubmitTimeoutRef.current) clearTimeout(pinSubmitTimeoutRef.current)\n        pinSubmitTimeoutRef.current = setTimeout(() => submitPin(newPin), 150)\n      }\n    }\n  }\n\n  const handleBackspace = () => {\n    if (!loading) {\n      setPin(prev => prev.slice(0, -1))\n      setPinState('') // Reset any error state\n    }\n  }\n\n  // Reset to company code entry\n  const handleBackToCompany = () => {\n    setCompany(null)\n    setPin('')\n    setPinState('')\n  }\n\n  // Handle office login\n  const handleOfficeSubmit = () => {\n    if (!email.trim() || !password.trim()) {\n      onShowToast('Enter email and password', 'error')\n      return\n    }\n    onOfficeLogin(email, password)\n  }\n\n  // Verify company code for joining\n  const verifyJoinCode = async () => {\n    if (companyCode.length < 2) {\n      onShowToast('Enter company code', 'error')\n      return\n    }\n\n    setLoading(true)\n    try {\n      const foundCompany = await db.getCompanyByCode(companyCode)\n      if (foundCompany) {\n        setJoinCompany(foundCompany)\n        setJoinStep(2) // Go to office code step\n      } else {\n        onShowToast('Invalid company code', 'error')\n        setCompanyCode('')\n      }\n    } catch (err) {\n      onShowToast('Error checking code', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Verify office code (secure server-side check)\n  const verifyOfficeCode = async () => {\n    if (!officeCode.trim()) {\n      onShowToast('Enter office code', 'error')\n      return\n    }\n\n    setLoading(true)\n    try {\n      // Use secure RPC function - office code never sent back to client\n      const { data, error } = await supabase.rpc('verify_office_code', {\n        company_id: joinCompany.id,\n        code: officeCode.trim()\n      })\n\n      if (error) throw error\n\n      if (data === true) {\n        setJoinStep(3) // Go to create account step\n      } else {\n        onShowToast('Invalid office code', 'error')\n        setOfficeCode('')\n      }\n    } catch (err) {\n      onShowToast('Error verifying code', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Handle join submit - supports both new users and existing users joining additional companies\n  const handleJoinSubmit = async () => {\n    if (loading) return\n    if (!joinName.trim()) {\n      onShowToast('Enter your name', 'error')\n      return\n    }\n    if (!joinEmail.trim() || !isValidEmail(joinEmail)) {\n      onShowToast('Enter a valid email address', 'error')\n      return\n    }\n    if (joinPassword.length < 6) {\n      onShowToast('Password must be 6+ characters', 'error')\n      return\n    }\n\n    setLoading(true)\n    try {\n      const normalizedEmail = joinEmail.toLowerCase().trim()\n\n      // Try to create a new user first\n      const { data: authData, error: authError } = await supabase.auth.signUp({\n        email: normalizedEmail,\n        password: joinPassword\n      })\n\n      let userId\n\n      // Check if user already exists (signUp returns error or user with identities = [])\n      const userAlreadyExists = authError?.message?.includes('already registered') ||\n        (authData?.user && authData.user.identities?.length === 0)\n\n      if (userAlreadyExists) {\n        // EXISTING USER - verify their password and add them to the new company\n        const { data: signInData, error: signInError } = await supabase.auth.signInWithPassword({\n          email: normalizedEmail,\n          password: joinPassword\n        })\n\n        if (signInError) {\n          // Password doesn't match their existing account\n          onShowToast('Account exists with different password. Use your existing password.', 'error')\n          setLoading(false)\n          return\n        }\n\n        userId = signInData.user.id\n\n        // Check if they're already a member of this company (any status)\n        const { data: existingMembership } = await supabase\n          .from('user_companies')\n          .select('id, status')\n          .eq('user_id', userId)\n          .eq('company_id', joinCompany.id)\n          .maybeSingle()\n\n        if (existingMembership) {\n          if (existingMembership.status === 'active') {\n            onShowToast('You already belong to this company. Logging you in...', 'success')\n            setTimeout(() => window.location.reload(), 1000)\n          } else if (existingMembership.status === 'pending') {\n            onShowToast('Your request is still pending approval.', 'error')\n            await supabase.auth.signOut()\n          } else {\n            onShowToast('Your membership was removed. Contact the company admin.', 'error')\n            await supabase.auth.signOut()\n          }\n          return\n        }\n\n        // Add existing user to new company with PENDING status\n        const { error: ucError } = await supabase\n          .from('user_companies')\n          .insert({\n            user_id: userId,\n            company_id: joinCompany.id,\n            role: 'member',\n            status: 'pending'\n          })\n\n        if (ucError) {\n          console.error('Error adding to user_companies:', ucError)\n          await supabase.auth.signOut()\n          throw new Error('Failed to submit join request')\n        }\n\n        // Sign out so they see the pending screen on next login\n        await supabase.auth.signOut()\n        setJoinSuccess(true)\n\n      } else if (authError) {\n        // Some other signup error\n        throw authError\n\n      } else {\n        // NEW USER - signup succeeded\n        userId = authData.user?.id\n        if (!userId) throw new Error('Failed to create user')\n\n        // Create user record (company_id is their first/primary company)\n        const { error: userError } = await supabase\n          .from('users')\n          .insert({\n            id: userId,\n            email: normalizedEmail,\n            password_hash: 'managed_by_supabase_auth',\n            name: joinName.trim(),\n            company_id: joinCompany.id,\n            role: 'member',\n            is_active: true\n          })\n\n        if (userError) throw userError\n\n        // Add to user_companies junction table with PENDING status\n        const { error: ucError } = await supabase\n          .from('user_companies')\n          .insert({\n            user_id: userId,\n            company_id: joinCompany.id,\n            role: 'member',\n            status: 'pending'\n          })\n\n        if (ucError) {\n          console.error('Error adding to user_companies:', ucError)\n          throw new Error('Failed to submit join request')\n        }\n\n        // Sign out - they need admin approval first\n        await supabase.auth.signOut()\n        setJoinSuccess(true)\n      }\n\n    } catch (err) {\n      console.error('Join error:', err)\n      onShowToast(err.message || 'Error creating account', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Handle company registration\n  const handleRegisterCompany = async () => {\n    if (loading) return\n    if (!registerName.trim()) {\n      onShowToast('Enter your name', 'error')\n      return\n    }\n    if (!registerEmail.trim() || !isValidEmail(registerEmail)) {\n      onShowToast('Enter a valid email address', 'error')\n      return\n    }\n    if (registerPassword.length < 6) {\n      onShowToast('Password must be 6+ characters', 'error')\n      return\n    }\n\n    setLoading(true)\n    try {\n      const normalizedEmail = registerEmail.toLowerCase().trim()\n      const companyCodeGenerated = generateCode(6)\n      const officeCodeGenerated = generateCode(6)\n\n      // Create auth user\n      const { data: authData, error: authError } = await supabase.auth.signUp({\n        email: normalizedEmail,\n        password: registerPassword\n      })\n\n      if (authError) {\n        if (authError.message?.includes('already registered')) {\n          onShowToast('An account with this email already exists. Sign in instead.', 'error')\n        } else {\n          throw authError\n        }\n        return\n      }\n\n      const userId = authData.user?.id\n      if (!userId) throw new Error('Failed to create account')\n\n      // Create company\n      const { data: companyData, error: companyError } = await supabase\n        .from('companies')\n        .insert({\n          name: registerCompanyName.trim(),\n          code: companyCodeGenerated,\n          office_code: officeCodeGenerated,\n          subscription_tier: 'free',\n          owner_user_id: userId\n        })\n        .select()\n        .single()\n\n      if (companyError) {\n        console.error('Company creation error:', companyError)\n        throw new Error('Failed to create company. Please try again.')\n      }\n\n      // Create user record\n      const { error: userError } = await supabase\n        .from('users')\n        .insert({\n          id: userId,\n          email: normalizedEmail,\n          password_hash: 'managed_by_supabase_auth',\n          name: registerName.trim(),\n          company_id: companyData.id,\n          role: 'admin',\n          is_active: true\n        })\n\n      if (userError) {\n        console.error('User record error:', userError)\n        throw new Error('Failed to set up user profile')\n      }\n\n      // Add to user_companies as active administrator\n      const { error: ucError } = await supabase\n        .from('user_companies')\n        .insert({\n          user_id: userId,\n          company_id: companyData.id,\n          role: 'admin',\n          access_level: 'administrator',\n          status: 'active'\n        })\n\n      if (ucError) {\n        console.error('User-company link error:', ucError)\n        throw new Error('Failed to link account to company')\n      }\n\n      // Store the created company info for the success screen\n      setCreatedCompany({\n        name: companyData.name,\n        code: companyCodeGenerated,\n        officeCode: officeCodeGenerated\n      })\n      setRegisterStep(3) // Go to success screen\n\n    } catch (err) {\n      console.error('Registration error:', err)\n      onShowToast(err.message || 'Error creating company', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Reset all join state when switching modes\n  const resetJoinState = () => {\n    setJoinStep(1)\n    setJoinCompany(null)\n    setOfficeCode('')\n    setJoinName('')\n    setJoinEmail('')\n    setJoinPassword('')\n    setJoinSuccess(false)\n    setCompanyCode('')\n  }\n\n  // Reset all register state when switching modes\n  const resetRegisterState = () => {\n    setRegisterStep(1)\n    setRegisterCompanyName('')\n    setRegisterName('')\n    setRegisterEmail('')\n    setRegisterPassword('')\n    setCreatedCompany(null)\n  }\n\n  // Initial selection screen\n  if (mode === null) {\n    return (\n      <div className=\"entry-container\">\n        <div className=\"entry-card animate-fade-in-up\">\n          <Logo className=\"entry-logo\" showPoweredBy={false} />\n\n          <div className=\"entry-buttons stagger-children\">\n            <button\n              className=\"entry-mode-btn foreman\"\n              onClick={() => setMode('foreman')}\n            >\n              <span className=\"entry-mode-icon\"><HardHat size={32} /></span>\n              <span className=\"entry-mode-title\">Foreman</span>\n              <span className=\"entry-mode-desc\">Enter project PIN</span>\n            </button>\n\n            <button\n              className=\"entry-mode-btn office\"\n              onClick={() => setMode('office')}\n            >\n              <span className=\"entry-mode-icon\"><Briefcase size={32} /></span>\n              <span className=\"entry-mode-title\">Office</span>\n              <span className=\"entry-mode-desc\">Sign in to dashboard</span>\n            </button>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  // Foreman flow\n  if (mode === 'foreman') {\n    // Step 3: Name entry (after PIN success)\n    if (foundProject) {\n      return (\n        <div className=\"entry-container\">\n          <div className=\"entry-card animate-fade-in\">\n            <Logo className=\"entry-logo\" showPoweredBy={false} />\n            <div className=\"entry-company-badge\">{foundProject.name}</div>\n            <p className=\"entry-subtitle\">Who's checking in?</p>\n\n            <div className=\"entry-form\">\n              <input\n                type=\"text\"\n                value={foremanName}\n                onChange={(e) => setForemanName(e.target.value)}\n                placeholder=\"Your name\"\n                autoFocus\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') handleForemanNameSubmit()\n                }}\n                style={{ fontSize: '1.1rem', textAlign: 'center' }}\n              />\n              <button\n                className=\"entry-login-btn\"\n                onClick={handleForemanNameSubmit}\n                disabled={!foremanName.trim()}\n              >\n                Enter Site\n              </button>\n            </div>\n\n            <p className=\"entry-hint\" style={{ marginTop: '0.75rem' }}>\n              Your name will appear on reports and submissions\n            </p>\n\n            <button\n              className=\"entry-join-link\"\n              style={{ marginTop: '0.5rem', display: 'flex', alignSelf: 'center' }}\n              onClick={() => {\n                setFoundProject(null)\n                setPin('')\n                setPinState('')\n              }}\n            >\n              <ArrowLeft size={16} />\n              <span>Back</span>\n            </button>\n          </div>\n        </div>\n      )\n    }\n\n    // Step 1: Company code\n    if (!company) {\n      return (\n        <div className=\"entry-container\">\n          <div className=\"entry-card animate-fade-in\">\n            <button className=\"entry-back\" onClick={() => setMode(null)}>\n              <ArrowLeft size={20} />\n            </button>\n\n            <Logo className=\"entry-logo\" showPoweredBy={false} />\n            <p className=\"entry-subtitle\">Enter company code</p>\n\n            <div className=\"entry-input-group\">\n              <input\n                type=\"text\"\n                value={companyCode}\n                onChange={(e) => handleCompanyCodeChange(e.target.value)}\n                placeholder=\"Company Code\"\n                disabled={loading}\n                autoFocus\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') submitCompanyCode()\n                }}\n              />\n              <button\n                className=\"entry-submit-btn\"\n                onClick={submitCompanyCode}\n                disabled={loading || companyCode.length < 2}\n              >\n                {loading ? <div className=\"spinner-small\" /> : <ChevronRight size={20} />}\n              </button>\n            </div>\n          </div>\n        </div>\n      )\n    }\n\n    // Step 2: PIN entry\n    return (\n      <div className=\"entry-container\">\n        <div className=\"entry-card animate-fade-in\">\n          <button className=\"entry-back\" onClick={handleBackToCompany}>\n            <ArrowLeft size={20} />\n          </button>\n\n          <Logo className=\"entry-logo\" showPoweredBy={false} />\n          <div className=\"entry-company-badge\">{company.name}</div>\n          <p className=\"entry-subtitle\">Enter project PIN</p>\n\n          {/* PIN Display */}\n          <div className={`pin-display ${pinState === 'error' ? 'shake' : ''}`}>\n            {[0, 1, 2, 3].map(i => (\n              <div\n                key={i}\n                className={`pin-dot ${pin.length > i ? 'filled' : ''} ${pinState}`}\n              >\n                {pin.length > i ? '' : ''}\n              </div>\n            ))}\n          </div>\n\n          {/* Number Pad */}\n          <div className=\"number-pad\" role=\"group\" aria-label=\"PIN entry keypad\">\n            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (\n              <button\n                key={num}\n                className=\"num-btn\"\n                onClick={() => handleNumberPad(num.toString())}\n                disabled={loading}\n                aria-label={String(num)}\n              >\n                {num}\n              </button>\n            ))}\n            <button className=\"num-btn empty\" disabled aria-hidden=\"true\"></button>\n            <button\n              className=\"num-btn\"\n              onClick={() => handleNumberPad('0')}\n              disabled={loading}\n              aria-label=\"0\"\n            >\n              0\n            </button>\n            <button\n              className=\"num-btn backspace\"\n              onClick={handleBackspace}\n              disabled={loading || pin.length === 0}\n              aria-label=\"Delete last digit\"\n            >\n              <ArrowLeft size={18} />\n            </button>\n          </div>\n\n          {loading && (\n            <div className=\"entry-loading\">\n              <div className=\"spinner\"></div>\n            </div>\n          )}\n        </div>\n      </div>\n    )\n  }\n\n  // Office flow\n  if (mode === 'office') {\n    return (\n      <div className=\"entry-container\">\n        <div className=\"entry-card animate-fade-in\">\n          <button className=\"entry-back\" onClick={() => setMode(null)}>\n            <ArrowLeft size={20} />\n          </button>\n\n          <Logo className=\"entry-logo\" showPoweredBy={false} />\n          <p className=\"entry-subtitle\">Sign in to your account</p>\n\n          <div className=\"entry-form\">\n            <input\n              type=\"email\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              placeholder=\"Email\"\n              autoFocus\n              onKeyDown={(e) => {\n                if (e.key === 'Enter') handleOfficeSubmit()\n              }}\n            />\n            <input\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              placeholder=\"Password\"\n              onKeyDown={(e) => {\n                if (e.key === 'Enter') handleOfficeSubmit()\n              }}\n            />\n            <button\n              className=\"entry-login-btn\"\n              onClick={handleOfficeSubmit}\n            >\n              Sign In\n            </button>\n          </div>\n\n          <div className=\"entry-signup-hint\">\n            <div className=\"entry-signup-options\">\n              <button className=\"entry-join-link\" onClick={() => { resetJoinState(); setMode('join') }}>\n                <UserPlus size={16} />\n                <span>Join your company</span>\n              </button>\n              <button className=\"entry-join-link\" onClick={() => { resetRegisterState(); setMode('register') }}>\n                <Building2 size={16} />\n                <span>Register a new company</span>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  // Join Company flow\n  if (mode === 'join') {\n    // Success screen after joining\n    if (joinSuccess) {\n      return (\n        <div className=\"entry-container\">\n          <div className=\"entry-card animate-scale-in\">\n            <div className=\"entry-success-icon\">\n              <Check size={32} />\n            </div>\n            <h2 className=\"entry-success-title\">Request Submitted</h2>\n            <p className=\"entry-success-message\">\n              Your request to join <strong>{joinCompany?.name}</strong> has been submitted.\n              A company admin will review and approve your access.\n            </p>\n            <p className=\"entry-success-detail\">\n              You'll be able to sign in once approved.\n            </p>\n            <button\n              className=\"entry-login-btn\"\n              onClick={() => {\n                resetJoinState()\n                setMode('office')\n              }}\n              style={{ marginTop: '1.5rem' }}\n            >\n              Back to Sign In\n            </button>\n          </div>\n        </div>\n      )\n    }\n\n    // Step 1: Enter company code\n    if (joinStep === 1) {\n      return (\n        <div className=\"entry-container\">\n          <div className=\"entry-card animate-fade-in\">\n            <button className=\"entry-back\" onClick={() => { resetJoinState(); setMode('office') }}>\n              <ArrowLeft size={20} />\n            </button>\n\n            <Logo className=\"entry-logo\" showPoweredBy={false} />\n            <StepIndicator steps={['Company', 'Verify', 'Account']} currentStep={1} />\n            <p className=\"entry-subtitle\">Enter your company code</p>\n            <p className=\"entry-hint\">Ask your manager or admin for the code</p>\n\n            <div className=\"entry-input-group\">\n              <input\n                type=\"text\"\n                value={companyCode}\n                onChange={(e) => handleCompanyCodeChange(e.target.value)}\n                placeholder=\"Company Code\"\n                disabled={loading}\n                autoFocus\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') verifyJoinCode()\n                }}\n              />\n              <button\n                className=\"entry-submit-btn\"\n                onClick={verifyJoinCode}\n                disabled={loading || companyCode.length < 2}\n              >\n                {loading ? <div className=\"spinner-small\" /> : <ChevronRight size={20} />}\n              </button>\n            </div>\n          </div>\n        </div>\n      )\n    }\n\n    // Step 2: Enter office code\n    if (joinStep === 2) {\n      return (\n        <div className=\"entry-container\">\n          <div className=\"entry-card animate-fade-in\">\n            <button className=\"entry-back\" onClick={() => { setJoinStep(1); setJoinCompany(null); setOfficeCode(''); }}>\n              <ArrowLeft size={20} />\n            </button>\n\n            <Logo className=\"entry-logo\" showPoweredBy={false} />\n            <StepIndicator steps={['Company', 'Verify', 'Account']} currentStep={2} />\n            <div className=\"entry-company-badge\">{joinCompany?.name}</div>\n            <p className=\"entry-subtitle\">Enter office code</p>\n            <p className=\"entry-hint\">This verifies your office access</p>\n\n            <div className=\"entry-input-group\">\n              <input\n                type=\"password\"\n                value={officeCode}\n                onChange={(e) => setOfficeCode(e.target.value)}\n                placeholder=\"Office Code\"\n                disabled={loading}\n                autoFocus\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') verifyOfficeCode()\n                }}\n              />\n              <button\n                className=\"entry-submit-btn\"\n                onClick={verifyOfficeCode}\n                disabled={loading || !officeCode.trim()}\n              >\n                {loading ? <div className=\"spinner-small\" /> : <ChevronRight size={20} />}\n              </button>\n            </div>\n          </div>\n        </div>\n      )\n    }\n\n    // Step 3: Create account\n    return (\n      <div className=\"entry-container\">\n        <div className=\"entry-card animate-fade-in\">\n          <button className=\"entry-back\" onClick={() => { setJoinStep(2); setOfficeCode(''); }}>\n            <ArrowLeft size={20} />\n          </button>\n\n          <Logo className=\"entry-logo\" showPoweredBy={false} />\n          <StepIndicator steps={['Company', 'Verify', 'Account']} currentStep={3} />\n          <div className=\"entry-company-badge\">{joinCompany?.name}</div>\n          <p className=\"entry-subtitle\">Create your account</p>\n\n          <div className=\"entry-form\">\n            <input\n              type=\"text\"\n              value={joinName}\n              onChange={(e) => setJoinName(e.target.value)}\n              placeholder=\"Your Name\"\n              autoFocus\n            />\n            <input\n              type=\"email\"\n              value={joinEmail}\n              onChange={(e) => setJoinEmail(e.target.value)}\n              placeholder=\"Email\"\n              className={joinEmail && !isValidEmail(joinEmail) ? 'input-error' : ''}\n            />\n            <PasswordInput\n              value={joinPassword}\n              onChange={(e) => setJoinPassword(e.target.value)}\n              placeholder=\"Password (6+ characters)\"\n              onKeyDown={(e) => {\n                if (e.key === 'Enter') handleJoinSubmit()\n              }}\n              showStrength={true}\n            />\n            <button\n              className=\"entry-login-btn\"\n              onClick={handleJoinSubmit}\n              disabled={loading || !joinName.trim() || !isValidEmail(joinEmail) || joinPassword.length < 6}\n            >\n              {loading ? (\n                <span className=\"btn-loading\">\n                  <div className=\"spinner-small\" />\n                  Creating account...\n                </span>\n              ) : 'Join Company'}\n            </button>\n          </div>\n\n          <p className=\"entry-join-note\">\n            You'll join as a team member. Your admin can update your role.\n          </p>\n        </div>\n      </div>\n    )\n  }\n\n  // Register Company flow\n  if (mode === 'register') {\n    // Step 3: Success\n    if (registerStep === 3 && createdCompany) {\n      return (\n        <div className=\"entry-container\">\n          <div className=\"entry-card entry-card-wide animate-scale-in\">\n            <div className=\"entry-success-icon\">\n              <Check size={32} />\n            </div>\n            <h2 className=\"entry-success-title\">Company Created</h2>\n            <p className=\"entry-success-message\">\n              <strong>{createdCompany.name}</strong> is ready to go.\n              Save these codes to share with your team.\n            </p>\n\n            <div className=\"entry-codes-grid\">\n              <div className=\"entry-code-card\">\n                <span className=\"entry-code-label\">Company Code</span>\n                <span className=\"entry-code-value\">{createdCompany.code}</span>\n                <span className=\"entry-code-hint\">Share with all employees</span>\n              </div>\n              <div className=\"entry-code-card\">\n                <span className=\"entry-code-label\">Office Code</span>\n                <span className=\"entry-code-value\">{createdCompany.officeCode}</span>\n                <span className=\"entry-code-hint\">Office staff only</span>\n              </div>\n            </div>\n\n            <p className=\"entry-codes-warning\">\n              Save these codes now. You can also find them in your company settings later.\n            </p>\n\n            <button\n              className=\"entry-login-btn\"\n              onClick={() => {\n                // Reload the app to sign them in\n                window.location.reload()\n              }}\n              style={{ marginTop: '0.5rem' }}\n            >\n              Go to Dashboard\n            </button>\n          </div>\n        </div>\n      )\n    }\n\n    // Step 1: Company info\n    if (registerStep === 1) {\n      return (\n        <div className=\"entry-container\">\n          <div className=\"entry-card animate-fade-in\">\n            <button className=\"entry-back\" onClick={() => { resetRegisterState(); setMode('office') }}>\n              <ArrowLeft size={20} />\n            </button>\n\n            <Logo className=\"entry-logo\" showPoweredBy={false} />\n            <StepIndicator steps={['Company', 'Your Account']} currentStep={1} />\n            <p className=\"entry-subtitle\">Register your company</p>\n            <p className=\"entry-hint\">Set up your company on FieldSync</p>\n\n            <div className=\"entry-form\">\n              <input\n                type=\"text\"\n                value={registerCompanyName}\n                onChange={(e) => setRegisterCompanyName(e.target.value)}\n                placeholder=\"Company Name\"\n                autoFocus\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && registerCompanyName.trim()) {\n                    setRegisterStep(2)\n                  }\n                }}\n              />\n              <button\n                className=\"entry-login-btn\"\n                onClick={() => setRegisterStep(2)}\n                disabled={!registerCompanyName.trim()}\n              >\n                Continue\n              </button>\n            </div>\n          </div>\n        </div>\n      )\n    }\n\n    // Step 2: Admin account\n    if (registerStep === 2) {\n      return (\n        <div className=\"entry-container\">\n          <div className=\"entry-card animate-fade-in\">\n            <button className=\"entry-back\" onClick={() => setRegisterStep(1)}>\n              <ArrowLeft size={20} />\n            </button>\n\n            <Logo className=\"entry-logo\" showPoweredBy={false} />\n            <StepIndicator steps={['Company', 'Your Account']} currentStep={2} />\n            <div className=\"entry-company-badge\">{registerCompanyName}</div>\n            <p className=\"entry-subtitle\">Create your admin account</p>\n\n            <div className=\"entry-form\">\n              <input\n                type=\"text\"\n                value={registerName}\n                onChange={(e) => setRegisterName(e.target.value)}\n                placeholder=\"Your Name\"\n                autoFocus\n              />\n              <input\n                type=\"email\"\n                value={registerEmail}\n                onChange={(e) => setRegisterEmail(e.target.value)}\n                placeholder=\"Email\"\n                className={registerEmail && !isValidEmail(registerEmail) ? 'input-error' : ''}\n              />\n              <PasswordInput\n                value={registerPassword}\n                onChange={(e) => setRegisterPassword(e.target.value)}\n                placeholder=\"Password (6+ characters)\"\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') handleRegisterCompany()\n                }}\n                showStrength={true}\n              />\n              <button\n                className=\"entry-login-btn\"\n                onClick={handleRegisterCompany}\n                disabled={loading || !registerName.trim() || !isValidEmail(registerEmail) || registerPassword.length < 6}\n              >\n                {loading ? (\n                  <span className=\"btn-loading\">\n                    <div className=\"spinner-small\" />\n                    Setting up company...\n                  </span>\n                ) : 'Create Company'}\n              </button>\n            </div>\n\n            <p className=\"entry-join-note\">\n              You'll be the administrator. Company and office codes will be generated for you.\n            </p>\n          </div>\n        </div>\n      )\n    }\n  }\n}\n","import { useEffect } from 'react'\n\nexport default function Toast({ message, type = '', onClose }) {\n  useEffect(() => {\n    const timer = setTimeout(onClose, 3000)\n    return () => clearTimeout(timer)\n  }, [onClose])\n\n  return (\n    <div className=\"toast-container\">\n      <div className={`toast ${type}`}>\n        {message}\n      </div>\n    </div>\n  )\n}\n","import { Sun, Moon } from 'lucide-react'\nimport { useTheme } from '../lib/ThemeContext'\n\nexport default function ThemeToggle({ compact = false }) {\n  const { theme, toggleTheme } = useTheme()\n\n  return (\n    <button\n      className={`theme-toggle ${compact ? 'theme-toggle-compact' : ''}`}\n      onClick={toggleTheme}\n      title={`Switch to ${theme === 'dark' ? 'light' : 'dark'} mode`}\n      aria-label={`Switch to ${theme === 'dark' ? 'light' : 'dark'} mode`}\n    >\n      {theme === 'dark' ? (\n        <>\n          <Sun size={compact ? 18 : 16} />\n          {!compact && <span>Light</span>}\n        </>\n      ) : (\n        <>\n          <Moon size={compact ? 18 : 16} />\n          {!compact && <span>Dark</span>}\n        </>\n      )}\n    </button>\n  )\n}\n","import { Component } from 'react'\nimport { AlertTriangle } from 'lucide-react'\n\nexport default class ErrorBoundary extends Component {\n  constructor(props) {\n    super(props)\n    this.state = { hasError: false, error: null, errorInfo: null }\n  }\n\n  static getDerivedStateFromError(error) {\n    return { hasError: true }\n  }\n\n  componentDidCatch(error, errorInfo) {\n    this.setState({ error, errorInfo })\n    // Log error to console for debugging\n    console.error('ErrorBoundary caught an error:', error, errorInfo)\n\n    // Check if this is a chunk loading failure (stale deployment)\n    const isChunkError = error?.message?.includes('Failed to fetch dynamically imported module') ||\n                         error?.message?.includes('Loading chunk') ||\n                         error?.message?.includes('Loading CSS chunk')\n\n    if (isChunkError) {\n      console.warn('[ErrorBoundary] Chunk load failure detected, clearing cache and reloading...')\n      // Clear caches and reload to get fresh assets\n      if ('caches' in window) {\n        caches.keys().then((names) => {\n          Promise.all(names.map((name) => caches.delete(name))).then(() => {\n            window.location.reload()\n          })\n        }).catch(err => {\n          console.warn('[ErrorBoundary] Cache clear failed, reloading anyway:', err.message)\n          window.location.reload()\n        })\n      } else {\n        window.location.reload()\n      }\n    }\n  }\n\n  handleRetry = () => {\n    this.setState({ hasError: false, error: null, errorInfo: null })\n  }\n\n  handleReload = () => {\n    window.location.reload()\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"error-boundary\">\n          <div className=\"error-boundary-content\">\n            <div className=\"error-icon\"><AlertTriangle size={48} /></div>\n            <h2>Something went wrong</h2>\n            <p>We're sorry, but something unexpected happened. Please try again.</p>\n\n            <div className=\"error-actions\">\n              <button className=\"btn btn-primary\" onClick={this.handleRetry}>\n                Try Again\n              </button>\n              <button className=\"btn btn-secondary\" onClick={this.handleReload}>\n                Reload Page\n              </button>\n            </div>\n\n            {/* Show error details in development */}\n            {import.meta.env.DEV && this.state.error && (\n              <details className=\"error-details\">\n                <summary>Error Details (Development Only)</summary>\n                <pre>{this.state.error.toString()}</pre>\n                <pre>{this.state.errorInfo?.componentStack}</pre>\n              </details>\n            )}\n          </div>\n        </div>\n      )\n    }\n\n    return this.props.children\n  }\n}\n","import { useState, useEffect, useRef } from 'react'\nimport { getConnectionStatus, onConnectionChange, getPendingActionCount } from '../lib/supabase'\n\nexport default function OfflineIndicator() {\n  const [isOnline, setIsOnline] = useState(getConnectionStatus())\n  const [pendingCount, setPendingCount] = useState(0)\n  const [showSynced, setShowSynced] = useState(false)\n\n  // Use ref for wasOffline to avoid dependency cycle in useEffect\n  const wasOfflineRef = useRef(false)\n  const syncedTimeoutRef = useRef(null)\n\n  useEffect(() => {\n    // Subscribe to connection changes\n    const unsubscribe = onConnectionChange(async (online) => {\n      setIsOnline(online)\n\n      if (online && wasOfflineRef.current) {\n        // Show \"synced\" message briefly when coming back online\n        setShowSynced(true)\n        if (syncedTimeoutRef.current) clearTimeout(syncedTimeoutRef.current)\n        syncedTimeoutRef.current = setTimeout(() => setShowSynced(false), 3000)\n        wasOfflineRef.current = false\n      }\n\n      if (!online) {\n        wasOfflineRef.current = true\n      }\n\n      // Update pending count\n      const count = await getPendingActionCount()\n      setPendingCount(count)\n    })\n\n    // Initial pending count check\n    getPendingActionCount().then(setPendingCount)\n\n    // Periodically check pending count when offline\n    const interval = setInterval(async () => {\n      if (!getConnectionStatus()) {\n        const count = await getPendingActionCount()\n        setPendingCount(count)\n      }\n    }, 5000)\n\n    return () => {\n      unsubscribe()\n      clearInterval(interval)\n      if (syncedTimeoutRef.current) clearTimeout(syncedTimeoutRef.current)\n    }\n  }, []) // Empty dependency array - runs once on mount\n\n  // Don't show anything if online and no pending actions\n  if (isOnline && pendingCount === 0 && !showSynced) {\n    return null\n  }\n\n  return (\n    <div className={`offline-indicator ${isOnline ? 'online' : 'offline'} ${showSynced ? 'synced' : ''}`}>\n      <div className=\"offline-indicator-content\">\n        {!isOnline ? (\n          <>\n            <span className=\"offline-icon\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                <line x1=\"1\" y1=\"1\" x2=\"23\" y2=\"23\"></line>\n                <path d=\"M16.72 11.06A10.94 10.94 0 0 1 19 12.55\"></path>\n                <path d=\"M5 12.55a10.94 10.94 0 0 1 5.17-2.39\"></path>\n                <path d=\"M10.71 5.05A16 16 0 0 1 22.58 9\"></path>\n                <path d=\"M1.42 9a15.91 15.91 0 0 1 4.7-2.88\"></path>\n                <path d=\"M8.53 16.11a6 6 0 0 1 6.95 0\"></path>\n                <line x1=\"12\" y1=\"20\" x2=\"12.01\" y2=\"20\"></line>\n              </svg>\n            </span>\n            <span className=\"offline-text\">\n              Offline\n              {pendingCount > 0 && (\n                <span className=\"pending-badge\">{pendingCount} pending</span>\n              )}\n            </span>\n          </>\n        ) : showSynced ? (\n          <>\n            <span className=\"online-icon\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                <polyline points=\"20 6 9 17 4 12\"></polyline>\n              </svg>\n            </span>\n            <span className=\"offline-text\">Changes synced!</span>\n          </>\n        ) : pendingCount > 0 ? (\n          <>\n            <span className=\"syncing-icon\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                <polyline points=\"23 4 23 10 17 10\"></polyline>\n                <polyline points=\"1 20 1 14 7 14\"></polyline>\n                <path d=\"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15\"></path>\n              </svg>\n            </span>\n            <span className=\"offline-text\">Syncing {pendingCount}...</span>\n          </>\n        ) : null}\n      </div>\n\n      <style>{`\n        .offline-indicator {\n          position: fixed;\n          bottom: 20px;\n          left: 50%;\n          transform: translateX(-50%);\n          z-index: 9999;\n          padding: 10px 16px;\n          border-radius: 24px;\n          font-size: 14px;\n          font-weight: 500;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n          animation: slideUp 0.3s ease-out;\n        }\n\n        @keyframes slideUp {\n          from {\n            transform: translateX(-50%) translateY(20px);\n            opacity: 0;\n          }\n          to {\n            transform: translateX(-50%) translateY(0);\n            opacity: 1;\n          }\n        }\n\n        .offline-indicator.offline {\n          background: #1f2937;\n          color: #fbbf24;\n        }\n\n        .offline-indicator.online {\n          background: #065f46;\n          color: #d1fae5;\n        }\n\n        .offline-indicator.synced {\n          background: #065f46;\n          color: #d1fae5;\n        }\n\n        .offline-indicator-content {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n\n        .offline-icon,\n        .online-icon,\n        .syncing-icon {\n          display: flex;\n          align-items: center;\n        }\n\n        .syncing-icon svg {\n          animation: spin 1s linear infinite;\n        }\n\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n\n        .offline-text {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n\n        .pending-badge {\n          background: rgba(251, 191, 36, 0.2);\n          padding: 2px 8px;\n          border-radius: 12px;\n          font-size: 12px;\n        }\n\n        @media (max-width: 480px) {\n          .offline-indicator {\n            bottom: 70px; /* Above mobile nav */\n            left: 16px;\n            right: 16px;\n            transform: none;\n          }\n        }\n      `}</style>\n    </div>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { Download, X } from 'lucide-react'\n\nexport default function InstallPrompt() {\n  const [deferredPrompt, setDeferredPrompt] = useState(null)\n  const [showBanner, setShowBanner] = useState(false)\n\n  useEffect(() => {\n    // Don't show if already installed\n    if (window.matchMedia('(display-mode: standalone)').matches) return\n\n    // Check if user dismissed recently\n    const dismissed = localStorage.getItem('pwa-install-dismissed')\n    if (dismissed) {\n      const dismissedAt = parseInt(dismissed, 10)\n      if (Date.now() - dismissedAt < 7 * 24 * 60 * 60 * 1000) return\n    }\n\n    const handler = (e) => {\n      e.preventDefault()\n      setDeferredPrompt(e)\n      setShowBanner(true)\n    }\n\n    window.addEventListener('beforeinstallprompt', handler)\n    return () => window.removeEventListener('beforeinstallprompt', handler)\n  }, [])\n\n  const handleInstall = async () => {\n    if (!deferredPrompt) return\n    deferredPrompt.prompt()\n    const { outcome } = await deferredPrompt.userChoice\n    if (outcome === 'accepted') {\n      setShowBanner(false)\n    }\n    setDeferredPrompt(null)\n  }\n\n  const handleDismiss = () => {\n    setShowBanner(false)\n    localStorage.setItem('pwa-install-dismissed', Date.now().toString())\n  }\n\n  if (!showBanner) return null\n\n  return (\n    <div className=\"install-prompt\">\n      <div className=\"install-prompt-content\">\n        <Download size={20} />\n        <div className=\"install-prompt-text\">\n          <strong>Install FieldSync</strong>\n          <span>Add to home screen for quick access</span>\n        </div>\n      </div>\n      <div className=\"install-prompt-actions\">\n        <button className=\"btn btn-primary btn-small\" onClick={handleInstall}>Install</button>\n        <button className=\"install-prompt-dismiss\" onClick={handleDismiss} aria-label=\"Dismiss\">\n          <X size={18} />\n        </button>\n      </div>\n    </div>\n  )\n}\n","import { useState } from 'react'\nimport { Shield, Loader2 } from 'lucide-react'\nimport { supabase } from '../lib/supabase'\n\nexport default function MFAChallenge({ factorId, onVerified, onCancel }) {\n  const [code, setCode] = useState('')\n  const [verifying, setVerifying] = useState(false)\n  const [error, setError] = useState(null)\n\n  const handleVerify = async () => {\n    if (code.length !== 6) return\n    setVerifying(true)\n    setError(null)\n    try {\n      const { data: challenge, error: challengeError } = await supabase.auth.mfa.challenge({ factorId })\n      if (challengeError) throw challengeError\n\n      const { error: verifyError } = await supabase.auth.mfa.verify({\n        factorId,\n        challengeId: challenge.id,\n        code\n      })\n      if (verifyError) throw verifyError\n\n      onVerified()\n    } catch {\n      setError('Invalid code. Please try again.')\n      setCode('')\n    } finally {\n      setVerifying(false)\n    }\n  }\n\n  const handleKeyDown = (e) => {\n    if (e.key === 'Enter' && code.length === 6) handleVerify()\n  }\n\n  return (\n    <div className=\"mfa-challenge\">\n      <div className=\"mfa-challenge-icon\">\n        <Shield size={40} />\n      </div>\n      <h2>Two-Factor Authentication</h2>\n      <p>Enter the 6-digit code from your authenticator app</p>\n      <div className=\"mfa-code-input\">\n        <input\n          type=\"text\"\n          value={code}\n          onChange={(e) => setCode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\n          onKeyDown={handleKeyDown}\n          placeholder=\"000000\"\n          maxLength={6}\n          autoFocus\n          inputMode=\"numeric\"\n          pattern=\"[0-9]*\"\n          className=\"mfa-input-large\"\n          aria-label=\"MFA verification code\"\n        />\n      </div>\n      {error && <p className=\"mfa-error\">{error}</p>}\n      <div className=\"mfa-challenge-actions\">\n        <button className=\"btn btn-secondary\" onClick={onCancel}>Cancel</button>\n        <button\n          className=\"btn btn-primary\"\n          onClick={handleVerify}\n          disabled={code.length !== 6 || verifying}\n        >\n          {verifying ? <><Loader2 size={14} className=\"spinner\" /> Verifying...</> : 'Verify'}\n        </button>\n      </div>\n    </div>\n  )\n}\n","export function formatCurrency(amount) {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0\n  }).format(amount)\n}\n\nexport function calculateProgress(areas) {\n  if (!areas || areas.length === 0) return 0\n\n  let progress = 0\n  areas.forEach(area => {\n    if (area.status === 'done') {\n      progress += (area.weight || 0)\n    }\n  })\n  return Math.round(progress)\n}\n\n/**\n * Calculate progress based on SOV scheduled values when available\n * Falls back to percentage-based calculation if no scheduled values exist\n * @param {Array} areas - Array of area objects\n * @returns {Object} { progress, earnedValue, totalValue, isValueBased }\n */\nexport function calculateValueProgress(areas) {\n  if (!areas || areas.length === 0) {\n    return { progress: 0, earnedValue: 0, totalValue: 0, isValueBased: false }\n  }\n\n  // Check if any areas have scheduled values\n  const hasScheduledValues = areas.some(a => a.scheduled_value > 0)\n\n  if (hasScheduledValues) {\n    // Value-based calculation using SOV amounts\n    const totalValue = areas.reduce((sum, a) => sum + (a.scheduled_value || 0), 0)\n    const earnedValue = areas\n      .filter(a => a.status === 'done')\n      .reduce((sum, a) => sum + (a.scheduled_value || 0), 0)\n    const progress = totalValue > 0 ? Math.round((earnedValue / totalValue) * 100) : 0\n\n    return { progress, earnedValue, totalValue, isValueBased: true }\n  }\n\n  // Fallback to percentage-based calculation\n  const progress = areas\n    .filter(a => a.status === 'done')\n    .reduce((sum, a) => sum + (a.weight || 0), 0)\n\n  return { progress: Math.round(progress), earnedValue: 0, totalValue: 0, isValueBased: false }\n}\n\nexport function getOverallStatus(areas) {\n  if (!areas || areas.length === 0) return 'not_started'\n  \n  const hasWorking = areas.some(a => a.status === 'working')\n  const hasDone = areas.some(a => a.status === 'done')\n  const allDone = areas.every(a => a.status === 'done')\n\n  if (allDone) return 'done'\n  if (hasWorking || hasDone) return 'working'\n  return 'not_started'\n}\n\nexport function getOverallStatusLabel(areas) {\n  const status = getOverallStatus(areas)\n  if (status === 'done') return 'Complete'\n  if (status === 'working') return 'In Progress'\n  return 'Not Started'\n}\n\nexport function formatStatus(status) {\n  if (status === 'not_started') return 'Not Started'\n  if (status === 'working') return 'Working'\n  if (status === 'done') return 'Done'\n  return status\n}\n\n/**\n * Calculate schedule performance for a project\n * @param {Object} project - Project with start_date, end_date, progress, planned_man_days\n * @param {number} actualManDays - Actual man-days from crew check-ins\n * @returns {Object} { scheduleStatus, scheduleVariance, scheduleLabel, laborStatus, laborVariance, laborLabel, hasScheduleData, hasLaborData }\n */\nexport function calculateScheduleInsights(project, actualManDays = 0) {\n  const today = new Date()\n  today.setHours(0, 0, 0, 0)\n\n  const result = {\n    scheduleStatus: 'on_track',    // 'ahead' | 'on_track' | 'behind'\n    scheduleVariance: 0,           // percentage variance\n    scheduleLabel: 'On Track',     // display label\n    laborStatus: 'on_track',       // 'under' | 'on_track' | 'over'\n    laborVariance: 0,              // percentage variance\n    laborLabel: null,              // display label (null if no planned_man_days)\n    hasScheduleData: false,\n    hasLaborData: false\n  }\n\n  // Schedule performance (time-based)\n  if (project.start_date && project.end_date) {\n    const startDate = new Date(project.start_date)\n    const endDate = new Date(project.end_date)\n    startDate.setHours(0, 0, 0, 0)\n    endDate.setHours(0, 0, 0, 0)\n\n    const totalDuration = Math.max(1, Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)))\n    const elapsedDays = Math.max(0, Math.ceil((today - startDate) / (1000 * 60 * 60 * 24)))\n\n    // Expected progress percentage based on time elapsed\n    const expectedProgress = Math.min(100, (elapsedDays / totalDuration) * 100)\n    const actualProgress = project.progress || 0\n\n    // Calculate variance (positive = ahead, negative = behind)\n    const progressDiff = actualProgress - expectedProgress\n    result.scheduleVariance = Math.round(progressDiff)\n    result.hasScheduleData = true\n\n    // Determine status with 5% tolerance\n    if (progressDiff > 5) {\n      result.scheduleStatus = 'ahead'\n      result.scheduleLabel = `Ahead of Schedule (+${result.scheduleVariance}%)`\n    } else if (progressDiff < -5) {\n      result.scheduleStatus = 'behind'\n      result.scheduleLabel = `Behind Schedule (${result.scheduleVariance}%)`\n    } else {\n      result.scheduleStatus = 'on_track'\n      result.scheduleLabel = 'On Track'\n    }\n  }\n\n  // Labor performance (man-days based)\n  if (project.planned_man_days && project.planned_man_days > 0) {\n    const progress = project.progress || 0\n    const expectedManDays = (progress / 100) * project.planned_man_days\n\n    if (expectedManDays > 0 && actualManDays > 0) {\n      // Variance: (actual - expected) / expected * 100\n      // Positive = over (bad), Negative = under (good)\n      const laborDiff = ((actualManDays - expectedManDays) / expectedManDays) * 100\n      result.laborVariance = Math.round(laborDiff)\n      result.hasLaborData = true\n\n      // Determine status with 10% tolerance\n      if (laborDiff > 10) {\n        result.laborStatus = 'over'\n        result.laborLabel = `Over Planned (+${result.laborVariance}% man-days)`\n      } else if (laborDiff < -10) {\n        result.laborStatus = 'under'\n        result.laborLabel = `Under Planned (${result.laborVariance}% man-days)`\n      } else {\n        result.laborStatus = 'on_track'\n        result.laborLabel = 'Labor On Track'\n      }\n    } else if (actualManDays > 0) {\n      // Has actual man-days but can't calculate expected (progress is 0)\n      result.hasLaborData = true\n      result.laborLabel = `${actualManDays} man-days used`\n    }\n  }\n\n  return result\n}\n\n/**\n * Check if a project should be auto-archived\n * @param {Object} project - Project with progress, status, and areas\n * @param {number} archiveDays - Days after completion to auto-archive (default 30)\n * @returns {boolean}\n */\nexport function shouldAutoArchive(project, archiveDays = 30) {\n  // Already archived\n  if (project.status === 'archived') return false\n\n  // Not complete\n  if (project.progress < 100) return false\n\n  // Check if all areas are done\n  const areas = project.areas || []\n  if (areas.length === 0) return false\n\n  const allDone = areas.every(a => a.status === 'done')\n  if (!allDone) return false\n\n  // Find when project was completed (most recent area updated_at)\n  const lastUpdate = areas.reduce((latest, area) => {\n    const areaDate = new Date(area.updated_at)\n    return areaDate > latest ? areaDate : latest\n  }, new Date(0))\n\n  // If no valid date found, don't archive\n  if (lastUpdate.getTime() === 0) return false\n\n  const daysSinceCompletion = Math.floor((Date.now() - lastUpdate.getTime()) / (1000 * 60 * 60 * 24))\n  return daysSinceCompletion >= archiveDays\n}\n","/**\n * Image utilities for compression, optimization, and PDF generation\n */\n\n/**\n * Convert hex color to RGB array for PDF generation\n * @param {string} hex - Hex color string (with or without #)\n * @returns {number[]} RGB array [r, g, b]\n */\nexport const hexToRgb = (hex) => {\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)\n  return result\n    ? [\n        parseInt(result[1], 16),\n        parseInt(result[2], 16),\n        parseInt(result[3], 16)\n      ]\n    : [59, 130, 246] // Default to primary blue\n}\n\n/**\n * Load an image URL and convert to base64 for PDF embedding\n * Uses JPEG format for smaller file sizes (vs PNG)\n * @param {string} url - Image URL to load\n * @param {number} timeout - Timeout in milliseconds (default 5000)\n * @param {number} quality - JPEG quality 0-1 (default 0.85)\n * @returns {Promise<string|null>} Base64 data URL or null on failure\n */\nexport const loadImageAsBase64 = (url, timeout = 5000, quality = 0.85) => {\n  return new Promise((resolve) => {\n    if (!url) {\n      resolve(null)\n      return\n    }\n\n    const img = new Image()\n    img.crossOrigin = 'anonymous'\n\n    // Set timeout to prevent hanging\n    const timeoutId = setTimeout(() => {\n      img.src = ''\n      resolve(null)\n    }, timeout)\n\n    img.onload = () => {\n      clearTimeout(timeoutId)\n      try {\n        const canvas = document.createElement('canvas')\n        canvas.width = img.width\n        canvas.height = img.height\n        const ctx = canvas.getContext('2d')\n        ctx.drawImage(img, 0, 0)\n        // Use JPEG for photos (smaller than PNG), fallback to PNG for transparency\n        const dataUrl = canvas.toDataURL('image/jpeg', quality)\n        resolve(dataUrl)\n      } catch (e) {\n        // Canvas tainted or other error\n        resolve(null)\n      }\n    }\n\n    img.onerror = () => {\n      clearTimeout(timeoutId)\n      resolve(null)\n    }\n\n    img.src = url\n  })\n}\n\n/**\n * Load multiple images in parallel for faster PDF generation\n * @param {string[]} urls - Array of image URLs to load\n * @param {number} timeout - Timeout per image in milliseconds (default 5000)\n * @param {number} quality - JPEG quality 0-1 (default 0.85)\n * @returns {Promise<(string|null)[]>} Array of base64 data URLs (null for failed loads)\n */\nexport const loadImagesAsBase64 = async (urls, timeout = 5000, quality = 0.85) => {\n  if (!urls || urls.length === 0) {\n    return []\n  }\n\n  // Load all images in parallel\n  const results = await Promise.all(\n    urls.map(url => loadImageAsBase64(url, timeout, quality))\n  )\n\n  return results\n}\n\n/**\n * Compress an image file for faster uploads\n * @param {File} file - The image file to compress\n * @param {number} maxWidth - Maximum width in pixels (default 1920)\n * @param {number} quality - JPEG quality 0-1 (default 0.8)\n * @returns {Promise<File>} - Compressed image file\n */\nexport async function compressImage(file, maxWidth = 1920, quality = 0.8) {\n  // Skip compression for non-image files\n  if (!file.type.startsWith('image/')) {\n    return file\n  }\n\n  // Skip compression for small files (under 500KB)\n  if (file.size < 500 * 1024) {\n    return file\n  }\n\n  return new Promise((resolve) => {\n    const canvas = document.createElement('canvas')\n    const ctx = canvas.getContext('2d')\n    const img = new Image()\n\n    img.onload = () => {\n      let { width, height } = img\n\n      // Calculate new dimensions, maintaining aspect ratio\n      if (width > maxWidth) {\n        height = Math.round((height * maxWidth) / width)\n        width = maxWidth\n      }\n\n      // Also limit height for very tall images\n      const maxHeight = 1920\n      if (height > maxHeight) {\n        width = Math.round((width * maxHeight) / height)\n        height = maxHeight\n      }\n\n      canvas.width = width\n      canvas.height = height\n\n      // Use high-quality rendering\n      ctx.imageSmoothingEnabled = true\n      ctx.imageSmoothingQuality = 'high'\n      ctx.drawImage(img, 0, 0, width, height)\n\n      // Convert to JPEG blob\n      canvas.toBlob(\n        (blob) => {\n          if (blob) {\n            // Create new file with original name but .jpg extension\n            const baseName = file.name.replace(/\\.[^/.]+$/, '')\n            const compressedFile = new File([blob], `${baseName}.jpg`, {\n              type: 'image/jpeg',\n              lastModified: Date.now()\n            })\n\n            resolve(compressedFile)\n          } else {\n            // Fallback to original if compression fails\n            console.warn('Image compression failed, using original')\n            resolve(file)\n          }\n        },\n        'image/jpeg',\n        quality\n      )\n\n      // Clean up object URL\n      URL.revokeObjectURL(img.src)\n    }\n\n    img.onerror = () => {\n      console.warn('Failed to load image for compression, using original')\n      URL.revokeObjectURL(img.src)\n      resolve(file)\n    }\n\n    // Load the image\n    img.src = URL.createObjectURL(file)\n  })\n}\n\n/**\n * Compress multiple images in parallel\n * @param {File[]} files - Array of image files\n * @param {number} maxWidth - Maximum width in pixels\n * @param {number} quality - JPEG quality 0-1\n * @param {function} onProgress - Optional progress callback (completed, total)\n * @returns {Promise<File[]>} - Array of compressed files\n */\nexport async function compressImages(files, maxWidth = 1920, quality = 0.8, onProgress = null) {\n  let completed = 0\n  const total = files.length\n\n  const results = await Promise.all(\n    files.map(async (file) => {\n      const compressed = await compressImage(file, maxWidth, quality)\n      completed++\n      if (onProgress) {\n        onProgress(completed, total)\n      }\n      return compressed\n    })\n  )\n\n  return results\n}\n\n/**\n * Get dimensions of an image file\n * @param {File} file - Image file\n * @returns {Promise<{width: number, height: number}>}\n */\nexport function getImageDimensions(file) {\n  return new Promise((resolve, reject) => {\n    const img = new Image()\n    img.onload = () => {\n      URL.revokeObjectURL(img.src)\n      resolve({ width: img.width, height: img.height })\n    }\n    img.onerror = () => {\n      URL.revokeObjectURL(img.src)\n      reject(new Error('Failed to load image'))\n    }\n    img.src = URL.createObjectURL(file)\n  })\n}\n","export const CATEGORIES = ['Containment', 'PPE', 'Disposal', 'Equipment']\n\nexport const TRANSLATIONS = {\n  en: {\n    // Steps\n    workInfo: 'Work Details',\n    crewHours: 'Crew & Hours',\n    materialsEquipment: 'Materials',\n    evidence: 'Evidence',\n    review: 'Review',\n\n    // Quick Actions\n    quickActions: 'Quick Actions',\n    sameAsYesterday: 'Same as Yesterday',\n    setCrewHours: 'Set Crew Hours',\n    loading: 'Loading...',\n\n    // Worker sections\n    supervision: 'Supervision',\n    operators: 'Operators',\n    laborers: 'Laborers',\n    addSupervision: '+ Add Supervision',\n    addOperator: '+ Add Operator',\n    addLaborer: '+ Add Laborer',\n\n    // Worker fields\n    foreman: 'Foreman',\n    superintendent: 'Superintendent',\n    firstLastName: 'First & Last Name',\n    start: 'Start',\n    end: 'End',\n    regHrs: 'Reg Hrs',\n    otHrs: 'OT Hrs',\n\n    // Materials\n    selectCategory: 'Select a category:',\n    addCustomItem: '+ Add Custom Item',\n    customItem: 'Custom Item',\n    itemName: 'Item Name',\n    category: 'Category',\n    quantity: 'Quantity',\n    addItem: 'Add Item',\n    cancel: 'Cancel',\n    noItemsCategory: 'No items in this category yet',\n\n    // Review\n    workDate: 'Work Date',\n    ceNumber: 'CE/PCO #',\n    optional: 'optional',\n    linkedCOR: 'Link to Change Order',\n    selectCOR: 'Select COR (optional)',\n    noCORs: 'No pending CORs',\n    laborSummary: 'Labor Summary',\n    worker: 'worker',\n    workers_plural: 'workers',\n    totalHours: 'Total Hours',\n    regular: 'Regular',\n    overtime: 'Overtime',\n    materials: 'Materials',\n    item: 'item',\n    items_plural: 'items',\n    noMaterials: 'No materials added',\n    notes: 'Notes',\n    addNotes: 'Add notes about the work performed...',\n    photos: 'Photos',\n    addPhotos: 'Add Photos',\n    maxPhotos: 'max',\n    noPhotos: 'No photos added',\n    certification: 'Certification',\n    certifyStatement: 'I certify that this T&M ticket accurately reflects the work performed.',\n    foremanSignature: \"Foreman's Name (Signature)\",\n    yourName: 'Your name',\n\n    // Work Info step\n    describeWork: 'Describe the work performed',\n    descriptionRequired: 'Description is required',\n    whatWorkPerformed: 'What work was performed today?',\n\n    // Materials search\n    searchMaterials: 'Search materials & equipment...',\n    noSearchResults: 'No items found',\n    orBrowse: 'Or browse by category:',\n\n    // Navigation\n    back: 'Back',\n    next: 'Next',\n    nextCrew: 'Next: Crew',\n    nextMaterials: 'Next: Materials',\n    reviewItems: 'Review',\n    skipNoMaterials: 'Skip (no materials)',\n    submitTM: 'Submit T&M',\n    submitting: 'Submitting...',\n\n    // Batch hours modal\n    applySameHours: 'Apply Same Hours',\n    batchDescription: 'Set start/end time and hours for all workers with names entered.',\n    timeStarted: 'Time Started',\n    timeEnded: 'Time Ended',\n    regularHours: 'Regular Hours',\n    overtimeHours: 'Overtime Hours',\n    willApplyTo: 'Will apply to',\n    applyToAll: 'Apply to All',\n\n    // Time presets\n    preset8hr: '8hr Day',\n    preset10hr: '10hr Day',\n    preset4hr: '4hr Day',\n\n    // Toast messages\n    loadedWorkers: 'Loaded {count} workers from {date}',\n    noPreviousCrew: 'No previous crew found for this project',\n    appliedHours: 'Applied hours to {count} worker(s)',\n\n    // COR\n    assignedToCOR: 'Assigned to COR'\n  },\n  es: {\n    // Steps\n    workInfo: 'Info del Trabajo',\n    crewHours: 'Cuadrilla y Horas',\n    materialsEquipment: 'Materiales',\n    evidence: 'Evidencia',\n    review: 'Revisar',\n\n    // Quick Actions\n    quickActions: 'Acciones Rapidas',\n    sameAsYesterday: 'Igual que Ayer',\n    setCrewHours: 'Poner Horas',\n    loading: 'Cargando...',\n\n    // Worker sections\n    supervision: 'Supervision',\n    operators: 'Operadores',\n    laborers: 'Trabajadores',\n    addSupervision: '+ Agregar Supervision',\n    addOperator: '+ Agregar Operador',\n    addLaborer: '+ Agregar Trabajador',\n\n    // Worker fields\n    foreman: 'Capataz',\n    superintendent: 'Superintendente',\n    firstLastName: 'Nombre y Apellido',\n    start: 'Inicio',\n    end: 'Fin',\n    regHrs: 'Hrs Reg',\n    otHrs: 'Hrs Extra',\n\n    // Materials\n    selectCategory: 'Seleccione una categoria:',\n    addCustomItem: '+ Agregar Articulo',\n    customItem: 'Articulo Personalizado',\n    itemName: 'Nombre del Articulo',\n    category: 'Categoria',\n    quantity: 'Cantidad',\n    addItem: 'Agregar',\n    cancel: 'Cancelar',\n    noItemsCategory: 'No hay articulos en esta categoria',\n\n    // Review\n    workDate: 'Fecha de Trabajo',\n    ceNumber: 'CE/PCO #',\n    optional: 'opcional',\n    linkedCOR: 'Vincular a Orden de Cambio',\n    selectCOR: 'Seleccionar COR (opcional)',\n    noCORs: 'No hay CORs pendientes',\n    laborSummary: 'Resumen de Mano de Obra',\n    worker: 'trabajador',\n    workers_plural: 'trabajadores',\n    totalHours: 'Horas Totales',\n    regular: 'Regular',\n    overtime: 'Extra',\n    materials: 'Materiales',\n    item: 'articulo',\n    items_plural: 'articulos',\n    noMaterials: 'No se agregaron materiales',\n    notes: 'Notas',\n    addNotes: 'Agregar notas sobre el trabajo realizado...',\n    photos: 'Fotos',\n    addPhotos: 'Agregar Fotos',\n    maxPhotos: 'max',\n    noPhotos: 'No se agregaron fotos',\n    certification: 'Certificacion',\n    certifyStatement: 'Certifico que este ticket T&M refleja con precision el trabajo realizado.',\n    foremanSignature: 'Nombre del Capataz (Firma)',\n    yourName: 'Su nombre',\n\n    // Work Info step\n    describeWork: 'Describir el trabajo realizado',\n    descriptionRequired: 'Descripcion es requerida',\n    whatWorkPerformed: 'Que trabajo se realizo hoy?',\n\n    // Materials search\n    searchMaterials: 'Buscar materiales y equipo...',\n    noSearchResults: 'No se encontraron articulos',\n    orBrowse: 'O navegar por categoria:',\n\n    // Navigation\n    back: 'Atras',\n    next: 'Siguiente',\n    nextCrew: 'Siguiente: Cuadrilla',\n    nextMaterials: 'Siguiente: Materiales',\n    reviewItems: 'Revisar',\n    skipNoMaterials: 'Saltar (sin materiales)',\n    submitTM: 'Enviar T&M',\n    submitting: 'Enviando...',\n\n    // Batch hours modal\n    applySameHours: 'Aplicar Mismas Horas',\n    batchDescription: 'Establezca hora de inicio/fin y horas para todos los trabajadores.',\n    timeStarted: 'Hora de Inicio',\n    timeEnded: 'Hora de Fin',\n    regularHours: 'Horas Regulares',\n    overtimeHours: 'Horas Extra',\n    willApplyTo: 'Se aplicara a',\n    applyToAll: 'Aplicar a Todos',\n\n    // Time presets\n    preset8hr: 'Dia 8hr',\n    preset10hr: 'Dia 10hr',\n    preset4hr: 'Dia 4hr',\n\n    // Toast messages\n    loadedWorkers: 'Se cargaron {count} trabajadores del {date}',\n    noPreviousCrew: 'No se encontro equipo anterior para este proyecto',\n    appliedHours: 'Horas aplicadas a {count} trabajador(es)',\n\n    // COR\n    assignedToCOR: 'Asignado a COR'\n  }\n}\n\n// Helper to create a translation function for a given language\nexport const createT = (lang) => (key) => TRANSLATIONS[lang]?.[key] || key\n","import { FileText } from 'lucide-react'\n\n/**\n * WorkDetailsStep - Step 1: Work description, date, CE/PCO, COR linking.\n *\n * Props:\n *  - project: project object\n *  - workDate, setWorkDate\n *  - cePcoNumber, setCePcoNumber\n *  - notes, setNotes (description of work)\n *  - t: translation function\n *  - lang: 'en' | 'es'\n */\nexport default function WorkDetailsStep({\n  project,\n  workDate, setWorkDate,\n  cePcoNumber, setCePcoNumber,\n  notes, setNotes,\n  t, lang\n}) {\n  return (\n    <div className=\"tm-step-content\">\n      {/* Project Info Header */}\n      <div className=\"tm-project-info\">\n        {project.job_number && (\n          <div className=\"tm-project-detail\">\n            <span className=\"tm-project-label\">Job #</span>\n            <span className=\"tm-project-value\">{project.job_number}</span>\n          </div>\n        )}\n        <div className=\"tm-project-detail\">\n          <span className=\"tm-project-label\">Project</span>\n          <span className=\"tm-project-value\">{project.name}</span>\n        </div>\n        {project.address && (\n          <div className=\"tm-project-detail\">\n            <span className=\"tm-project-label\">Address</span>\n            <span className=\"tm-project-value\">{project.address}</span>\n          </div>\n        )}\n        {project.general_contractor && (\n          <div className=\"tm-project-detail\">\n            <span className=\"tm-project-label\">GC</span>\n            <span className=\"tm-project-value\">{project.general_contractor}</span>\n          </div>\n        )}\n      </div>\n\n      <div className=\"tm-field-row\">\n        <div className=\"tm-field tm-field-half\">\n          <label>Date</label>\n          <input\n            type=\"date\"\n            value={workDate}\n            onChange={(e) => setWorkDate(e.target.value)}\n            className=\"tm-date\"\n          />\n        </div>\n        <div className=\"tm-field tm-field-half\">\n          <label>CE / PCO #</label>\n          <input\n            type=\"text\"\n            placeholder=\"Change Event / PCO\"\n            value={cePcoNumber}\n            onChange={(e) => setCePcoNumber(e.target.value)}\n            className=\"tm-input\"\n          />\n        </div>\n      </div>\n\n      {/* Description of Work - REQUIRED */}\n      <div className=\"tm-field tm-description-field\">\n        <label>\n          <FileText size={16} className=\"inline-icon\" />\n          {t('describeWork')} <span className=\"tm-required\">*</span>\n        </label>\n        <textarea\n          placeholder={t('whatWorkPerformed')}\n          value={notes}\n          onChange={(e) => setNotes(e.target.value)}\n          rows={4}\n          className={`tm-description ${!notes.trim() ? 'tm-field-required' : ''}`}\n        />\n      </div>\n    </div>\n  )\n}\n","import { Check } from 'lucide-react'\n\n// Helper to determine worker completion state for visual indicators\nexport const getWorkerState = (worker) => {\n  if (!worker) return 'empty'\n  const hasName = worker.name && worker.name.trim() !== ''\n  const hasHours = parseFloat(worker.hours) > 0 || parseFloat(worker.overtimeHours) > 0\n  if (!hasName) return 'empty'\n  if (hasHours) return 'complete'\n  return 'incomplete'\n}\n\n// Calculate hours from time range (auto-split into regular + OT)\nexport const calculateHoursFromTimeRange = (startTime, endTime) => {\n  if (!startTime || !endTime) return null\n\n  const [startHour, startMin] = startTime.split(':').map(Number)\n  const [endHour, endMin] = endTime.split(':').map(Number)\n\n  let totalMinutes = (endHour * 60 + endMin) - (startHour * 60 + startMin)\n  if (totalMinutes < 0) totalMinutes += 24 * 60 // Handle overnight\n\n  const totalHours = totalMinutes / 60\n  const regularHours = Math.min(totalHours, 8)\n  const overtimeHours = Math.max(0, totalHours - 8)\n\n  return {\n    hours: regularHours.toFixed(1),\n    overtimeHours: overtimeHours > 0 ? overtimeHours.toFixed(1) : ''\n  }\n}\n\n/**\n * WorkerRow - Renders a single worker card with name, time, and hours fields.\n * Used across supervision, operators, laborers, and dynamic labor class sections.\n *\n * Props:\n *  - worker: { name, hours, overtimeHours, timeStarted, timeEnded, role? }\n *  - index: number\n *  - onUpdate: (index, field, value) => void\n *  - onRemove: (index) => void\n *  - t: translation function\n *  - roleSelect?: JSX element for supervision role dropdown (optional)\n */\nexport default function WorkerRow({ worker, index, onUpdate, onRemove, t, roleSelect }) {\n  const workerState = getWorkerState(worker)\n\n  return (\n    <div className={`tm-worker-card-expanded ${workerState !== 'empty' ? `worker-${workerState}` : ''}`}>\n      <div className=\"tm-worker-row-top\">\n        {workerState === 'complete' && (\n          <span className=\"tm-worker-check\"><Check size={14} /></span>\n        )}\n        {roleSelect}\n        <input\n          type=\"text\"\n          placeholder={t('firstLastName')}\n          value={worker.name}\n          onChange={(e) => onUpdate(index, 'name', e.target.value)}\n          className=\"tm-worker-input\"\n        />\n        <button className=\"tm-remove\" onClick={() => onRemove(index)}></button>\n      </div>\n      <div className=\"tm-worker-row-bottom\">\n        <div className=\"tm-time-group\">\n          <label>{t('start')}</label>\n          <input\n            type=\"time\"\n            value={worker.timeStarted}\n            onChange={(e) => onUpdate(index, 'timeStarted', e.target.value)}\n          />\n        </div>\n        <div className=\"tm-time-group\">\n          <label>{t('end')}</label>\n          <input\n            type=\"time\"\n            value={worker.timeEnded}\n            onChange={(e) => onUpdate(index, 'timeEnded', e.target.value)}\n          />\n        </div>\n        <div className=\"tm-time-group\">\n          <label>{t('regHrs')}</label>\n          <input\n            type=\"number\"\n            placeholder=\"0\"\n            value={worker.hours}\n            onChange={(e) => onUpdate(index, 'hours', e.target.value)}\n          />\n        </div>\n        <div className=\"tm-time-group\">\n          <label>{t('otHrs')}</label>\n          <input\n            type=\"number\"\n            placeholder=\"0\"\n            value={worker.overtimeHours}\n            onChange={(e) => onUpdate(index, 'overtimeHours', e.target.value)}\n          />\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { Clock } from 'lucide-react'\nimport { calculateHoursFromTimeRange } from './WorkerRow'\n\n/**\n * BatchHoursModal - Modal for applying the same hours to all named workers.\n *\n * Props:\n *  - batchHours: { timeStarted, timeEnded, hours, overtimeHours }\n *  - setBatchHours: setter\n *  - namedWorkerCount: number of workers with names\n *  - onApply: () => void\n *  - onClose: () => void\n *  - t: translation function\n */\nexport default function BatchHoursModal({ batchHours, setBatchHours, namedWorkerCount, onApply, onClose, t }) {\n  const applyTimePreset = (preset) => {\n    let timeStarted, timeEnded, hours, overtimeHours\n\n    switch (preset) {\n      case 'full':\n        timeStarted = '07:00'\n        timeEnded = '15:30'\n        hours = '8'\n        overtimeHours = ''\n        break\n      case '10hr':\n        timeStarted = '06:00'\n        timeEnded = '16:30'\n        hours = '8'\n        overtimeHours = '2'\n        break\n      case 'half':\n        timeStarted = '07:00'\n        timeEnded = '11:00'\n        hours = '4'\n        overtimeHours = ''\n        break\n      default:\n        return\n    }\n\n    setBatchHours({ timeStarted, timeEnded, hours, overtimeHours })\n  }\n\n  return (\n    <div className=\"tm-modal-overlay\" onClick={onClose}>\n      <div className=\"tm-batch-modal\" onClick={(e) => e.stopPropagation()}>\n        <h3><Clock size={18} /> {t('applySameHours')}</h3>\n        <p className=\"tm-batch-description\">\n          {t('batchDescription')}\n        </p>\n\n        {/* Time Presets - Quick Selection */}\n        <div className=\"tm-time-presets\">\n          <button type=\"button\" className=\"tm-preset-btn\" onClick={() => applyTimePreset('full')}>\n            {t('preset8hr')}\n          </button>\n          <button type=\"button\" className=\"tm-preset-btn\" onClick={() => applyTimePreset('10hr')}>\n            {t('preset10hr')}\n          </button>\n          <button type=\"button\" className=\"tm-preset-btn\" onClick={() => applyTimePreset('half')}>\n            {t('preset4hr')}\n          </button>\n        </div>\n\n        <div className=\"tm-batch-form\">\n          <div className=\"tm-batch-row\">\n            <div className=\"tm-batch-field\">\n              <label>{t('timeStarted')}</label>\n              <input\n                type=\"time\"\n                value={batchHours.timeStarted}\n                onChange={(e) => {\n                  const newStart = e.target.value\n                  const calculated = calculateHoursFromTimeRange(newStart, batchHours.timeEnded)\n                  setBatchHours({\n                    ...batchHours,\n                    timeStarted: newStart,\n                    ...(calculated || {})\n                  })\n                }}\n              />\n            </div>\n            <div className=\"tm-batch-field\">\n              <label>{t('timeEnded')}</label>\n              <input\n                type=\"time\"\n                value={batchHours.timeEnded}\n                onChange={(e) => {\n                  const newEnd = e.target.value\n                  const calculated = calculateHoursFromTimeRange(batchHours.timeStarted, newEnd)\n                  setBatchHours({\n                    ...batchHours,\n                    timeEnded: newEnd,\n                    ...(calculated || {})\n                  })\n                }}\n              />\n            </div>\n          </div>\n          <div className=\"tm-batch-row\">\n            <div className=\"tm-batch-field\">\n              <label>{t('regularHours')}</label>\n              <input\n                type=\"number\"\n                placeholder=\"8\"\n                value={batchHours.hours}\n                onChange={(e) => setBatchHours({ ...batchHours, hours: e.target.value })}\n              />\n            </div>\n            <div className=\"tm-batch-field\">\n              <label>{t('overtimeHours')}</label>\n              <input\n                type=\"number\"\n                placeholder=\"0\"\n                value={batchHours.overtimeHours}\n                onChange={(e) => setBatchHours({ ...batchHours, overtimeHours: e.target.value })}\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"tm-batch-preview\">\n          <strong>{t('willApplyTo')}:</strong>\n          <span>\n            {namedWorkerCount} {t('workers_plural')}\n          </span>\n        </div>\n\n        <div className=\"tm-batch-actions\">\n          <button\n            type=\"button\"\n            className=\"btn btn-secondary\"\n            onClick={onClose}\n          >\n            {t('cancel')}\n          </button>\n          <button\n            type=\"button\"\n            className=\"btn btn-primary\"\n            onClick={onApply}\n            disabled={!batchHours.hours && !batchHours.overtimeHours}\n          >\n            {t('applyToAll')}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { HardHat, Copy, Clock, AlertCircle, Loader2 } from 'lucide-react'\nimport WorkerRow from './WorkerRow'\nimport BatchHoursModal from './BatchHoursModal'\n\n/**\n * CrewHoursStep - Step 2: Worker sections, batch hours, crew selection.\n *\n * Props:\n *  - supervision, setSupervision\n *  - operators, setOperators\n *  - laborers, setLaborers\n *  - dynamicWorkers, setDynamicWorkers\n *  - activeLaborClassIds, setActiveLaborClassIds\n *  - laborCategories, laborClasses\n *  - hasCustomLaborClasses, loadingLaborClasses\n *  - todaysCrew\n *  - showBatchHoursModal, setShowBatchHoursModal\n *  - batchHours, setBatchHours\n *  - loadingPreviousCrew\n *  - namedWorkers, workersWithHours, workersNeedingHours\n *  - totalRegHours, totalOTHours\n *  - onLoadPreviousCrew, onApplyBatchHours, onApplyInlinePreset\n *  - onAddCrewWorker: (worker) => void - handles adding a crew member to proper section\n *  - onActivateLaborClass, onDeactivateLaborClass\n *  - addSupervision, updateSupervision, removeSupervision\n *  - addOperator, updateOperator, removeOperator\n *  - addLaborer, updateLaborer, removeLaborer\n *  - addDynamicWorker, updateDynamicWorker, removeDynamicWorker\n *  - getInactiveLaborClasses\n *  - t, lang\n *  - onShowToast\n */\nexport default function CrewHoursStep({\n  supervision, operators, laborers,\n  dynamicWorkers,\n  activeLaborClassIds, setActiveLaborClassIds,\n  laborCategories, laborClasses,\n  hasCustomLaborClasses, loadingLaborClasses,\n  todaysCrew,\n  showBatchHoursModal, setShowBatchHoursModal,\n  batchHours, setBatchHours,\n  loadingPreviousCrew,\n  namedWorkers, workersNeedingHours,\n  totalRegHours, totalOTHours,\n  onLoadPreviousCrew, onApplyBatchHours, onApplyInlinePreset,\n  onAddCrewWorker,\n  onActivateLaborClass, onDeactivateLaborClass,\n  addSupervision, updateSupervision, removeSupervision,\n  addOperator, updateOperator, removeOperator,\n  addLaborer, updateLaborer, removeLaborer,\n  addDynamicWorker, updateDynamicWorker, removeDynamicWorker,\n  getInactiveLaborClasses,\n  t, lang,\n  onShowToast\n}) {\n  const namedWorkerCount = namedWorkers.length\n\n  return (\n    <div className=\"tm-step-content\">\n      {/* Crew Summary Bar */}\n      <div className=\"tm-crew-summary-bar\">\n        <div className=\"tm-summary-left\">\n          <span className=\"tm-summary-count\">{namedWorkers.length}</span>\n          <span className=\"tm-summary-label\">{namedWorkers.length === 1 ? t('worker') : t('workers_plural')}</span>\n        </div>\n        <div className=\"tm-summary-middle\">\n          <span className=\"tm-summary-hours\">{totalRegHours + totalOTHours}h</span>\n          <span className=\"tm-summary-label\">{lang === 'en' ? 'total' : 'total'}</span>\n        </div>\n        {workersNeedingHours > 0 && (\n          <div className=\"tm-summary-warning\">\n            <AlertCircle size={14} />\n            <span>{workersNeedingHours} {lang === 'en' ? 'need hours' : 'sin horas'}</span>\n          </div>\n        )}\n      </div>\n\n      {/* Quick Actions - Same as Yesterday + Time Presets */}\n      <div className=\"tm-quick-actions-row\">\n        <button\n          className=\"tm-quick-action\"\n          onClick={onLoadPreviousCrew}\n          disabled={loadingPreviousCrew}\n        >\n          <Copy size={16} />\n          <span>{loadingPreviousCrew ? (lang === 'en' ? 'Loading...' : 'Cargando...') : t('sameAsYesterday')}</span>\n        </button>\n        {namedWorkers.length > 0 && (\n          <div className=\"tm-time-presets-inline\">\n            <button className=\"tm-preset-chip\" onClick={() => onApplyInlinePreset('8hr')}>8h</button>\n            <button className=\"tm-preset-chip\" onClick={() => onApplyInlinePreset('10hr')}>10h</button>\n            <button className=\"tm-preset-chip\" onClick={() => onApplyInlinePreset('4hr')}>4h</button>\n            <button className=\"tm-preset-chip more\" onClick={() => setShowBatchHoursModal(true)} title={lang === 'en' ? 'Custom hours' : 'Horas personalizadas'}>\n              <Clock size={14} />\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Select from Today's Crew - Prominent */}\n      {todaysCrew.length > 0 && (\n        <div className=\"tm-crew-select-section\">\n          <div className=\"tm-section-header\">\n            <h4><HardHat size={16} /> {lang === 'en' ? \"Select T&M Workers\" : \"Seleccionar Trabajadores T&M\"}</h4>\n            <span className=\"tm-section-hint\">{lang === 'en' ? 'Tap to add' : 'Toca para agregar'}</span>\n          </div>\n          <div className=\"tm-crew-grid\">\n              {todaysCrew.map((worker, index) => {\n                // Check if already added (in legacy or dynamic sections)\n                const inLegacy =\n                  supervision.some(s => s.name.toLowerCase() === worker.name.toLowerCase()) ||\n                  operators.some(o => o.name.toLowerCase() === worker.name.toLowerCase()) ||\n                  laborers.some(l => l.name.toLowerCase() === worker.name.toLowerCase())\n                const inDynamic = Object.values(dynamicWorkers).some(workers =>\n                  workers.some(w => w.name.toLowerCase() === worker.name.toLowerCase())\n                )\n                const isAdded = inLegacy || inDynamic\n\n                return (\n                  <button\n                    key={index}\n                    className={`tm-crew-item ${isAdded ? 'added' : ''}`}\n                    onClick={() => {\n                      if (!isAdded) {\n                        onAddCrewWorker(worker)\n                      }\n                    }}\n                    disabled={isAdded}\n                  >\n                    <span className=\"tm-crew-item-name\">{worker.name}</span>\n                    <span className={`tm-crew-item-role ${(worker.role || 'laborer').toLowerCase()}`}>\n                      {worker.role || 'Laborer'}\n                    </span>\n                    {isAdded && <span className=\"tm-crew-item-check\">{'\\u2713'}</span>}\n                  </button>\n                )\n              })}\n          </div>\n        </div>\n      )}\n\n      {/* Dynamic Labor Classes (when company has custom classes) */}\n      {/* Only show labor classes that are active (from crew check-in or manually added) */}\n      {hasCustomLaborClasses && !loadingLaborClasses && (\n        <>\n          {/* Render active labor classes grouped by category */}\n          {laborCategories.map(category => {\n            // Only show classes in this category that are active\n            const activeCategoryClasses = laborClasses.filter(\n              lc => lc.category_id === category.id && activeLaborClassIds.has(lc.id)\n            )\n            if (activeCategoryClasses.length === 0) return null\n            return (\n              <div key={category.id} className=\"tm-labor-category-section\">\n                <div className=\"tm-category-header\">{category.name}</div>\n                {activeCategoryClasses.map(laborClass => (\n                  <div key={laborClass.id} className=\"tm-field\">\n                    <div className=\"tm-field-header\">\n                      <label>{laborClass.name}</label>\n                      <button\n                        type=\"button\"\n                        className=\"tm-remove-class-btn\"\n                        onClick={() => onDeactivateLaborClass(laborClass.id)}\n                        title={lang === 'en' ? 'Remove this labor class' : 'Eliminar esta clase'}\n                      >\n                        {'\\u00d7'}\n                      </button>\n                    </div>\n                    <div className=\"tm-workers-list\">\n                      {(dynamicWorkers[laborClass.id] || []).map((worker, idx) => (\n                        <WorkerRow\n                          key={idx}\n                          worker={worker}\n                          index={idx}\n                          onUpdate={(i, field, value) => updateDynamicWorker(laborClass.id, i, field, value)}\n                          onRemove={(i) => removeDynamicWorker(laborClass.id, i)}\n                          t={t}\n                        />\n                      ))}\n                    </div>\n                    <button className=\"tm-add-btn\" onClick={() => addDynamicWorker(laborClass.id)}>\n                      + {lang === 'en' ? 'Add' : 'Agregar'} {laborClass.name}\n                    </button>\n                  </div>\n                ))}\n              </div>\n            )\n          })}\n\n          {/* Active classes without category */}\n          {laborClasses.filter(lc => !lc.category_id && activeLaborClassIds.has(lc.id)).map(laborClass => (\n            <div key={laborClass.id} className=\"tm-field\">\n              <div className=\"tm-field-header\">\n                <label>{laborClass.name}</label>\n                <button\n                  type=\"button\"\n                  className=\"tm-remove-class-btn\"\n                  onClick={() => onDeactivateLaborClass(laborClass.id)}\n                  title={lang === 'en' ? 'Remove this labor class' : 'Eliminar esta clase'}\n                >\n                  {'\\u00d7'}\n                </button>\n              </div>\n              <div className=\"tm-workers-list\">\n                {(dynamicWorkers[laborClass.id] || []).map((worker, idx) => (\n                  <WorkerRow\n                    key={idx}\n                    worker={worker}\n                    index={idx}\n                    onUpdate={(i, field, value) => updateDynamicWorker(laborClass.id, i, field, value)}\n                    onRemove={(i) => removeDynamicWorker(laborClass.id, i)}\n                    t={t}\n                  />\n                ))}\n              </div>\n              <button className=\"tm-add-btn\" onClick={() => addDynamicWorker(laborClass.id)}>\n                + {lang === 'en' ? 'Add' : 'Agregar'} {laborClass.name}\n              </button>\n            </div>\n          ))}\n\n          {/* Add Labor Class dropdown - shows classes not yet active */}\n          {getInactiveLaborClasses().length > 0 && (\n            <div className=\"tm-add-labor-class-section\">\n              <select\n                className=\"tm-add-labor-class-select\"\n                value=\"\"\n                onChange={(e) => {\n                  if (e.target.value) {\n                    onActivateLaborClass(e.target.value)\n                  }\n                }}\n              >\n                <option value=\"\">\n                  + {lang === 'en' ? 'Add Labor Class...' : 'Agregar Clase de Trabajo...'}\n                </option>\n                {laborCategories.map(category => {\n                  const inactiveInCategory = getInactiveLaborClasses().filter(lc => lc.category_id === category.id)\n                  if (inactiveInCategory.length === 0) return null\n                  return (\n                    <optgroup key={category.id} label={category.name}>\n                      {inactiveInCategory.map(lc => (\n                        <option key={lc.id} value={lc.id}>{lc.name}</option>\n                      ))}\n                    </optgroup>\n                  )\n                })}\n                {/* Uncategorized classes */}\n                {getInactiveLaborClasses().filter(lc => !lc.category_id).length > 0 && (\n                  <optgroup label={lang === 'en' ? 'Other' : 'Otros'}>\n                    {getInactiveLaborClasses().filter(lc => !lc.category_id).map(lc => (\n                      <option key={lc.id} value={lc.id}>{lc.name}</option>\n                    ))}\n                  </optgroup>\n                )}\n              </select>\n            </div>\n          )}\n\n          {/* Empty state - no labor classes active yet */}\n          {activeLaborClassIds.size === 0 && (\n            <div className=\"tm-no-labor-classes\">\n              <p>\n                {lang === 'en'\n                  ? 'No labor classes added yet. Select from crew check-in above or add manually:'\n                  : 'No hay clases de trabajo agregadas. Seleccione del check-in o agregue manualmente:'\n                }\n              </p>\n            </div>\n          )}\n        </>\n      )}\n\n      {/* Loading indicator for labor classes */}\n      {loadingLaborClasses && (\n        <div className=\"tm-loading-labor-classes\">\n          <Loader2 size={20} className=\"tm-spinner\" />\n          <span>{lang === 'en' ? 'Loading labor classes...' : 'Cargando clases de trabajo...'}</span>\n        </div>\n      )}\n\n      {/* Hardcoded Worker Sections (fallback when no custom classes) */}\n      {!hasCustomLaborClasses && !loadingLaborClasses && (\n        <>\n          {/* Supervision Section */}\n          <div className=\"tm-field\">\n            <label>{t('supervision')}</label>\n            <div className=\"tm-workers-list\">\n              {supervision.map((sup, index) => (\n                <WorkerRow\n                  key={index}\n                  worker={sup}\n                  index={index}\n                  onUpdate={updateSupervision}\n                  onRemove={removeSupervision}\n                  t={t}\n                  roleSelect={\n                    <div className=\"tm-role-select\">\n                      <select\n                        value={sup.role}\n                        onChange={(e) => updateSupervision(index, 'role', e.target.value)}\n                      >\n                        <option value=\"Foreman\">{t('foreman')}</option>\n                        <option value=\"Superintendent\">{t('superintendent')}</option>\n                      </select>\n                    </div>\n                  }\n                />\n              ))}\n            </div>\n            <button className=\"tm-add-btn\" onClick={addSupervision}>\n              {t('addSupervision')}\n            </button>\n          </div>\n\n          {/* Operators Section */}\n          <div className=\"tm-field\">\n            <label>{t('operators')}</label>\n            <div className=\"tm-workers-list\">\n              {operators.map((operator, index) => (\n                <WorkerRow\n                  key={index}\n                  worker={operator}\n                  index={index}\n                  onUpdate={updateOperator}\n                  onRemove={removeOperator}\n                  t={t}\n                />\n              ))}\n            </div>\n            <button className=\"tm-add-btn\" onClick={addOperator}>\n              {t('addOperator')}\n            </button>\n          </div>\n\n          {/* Laborers Section */}\n          <div className=\"tm-field\">\n            <label>{t('laborers')}</label>\n            <div className=\"tm-workers-list\">\n              {laborers.map((laborer, index) => (\n                <WorkerRow\n                  key={index}\n                  worker={laborer}\n                  index={index}\n                  onUpdate={updateLaborer}\n                  onRemove={removeLaborer}\n                  t={t}\n                />\n              ))}\n            </div>\n            <button className=\"tm-add-btn\" onClick={addLaborer}>\n              {t('addLaborer')}\n            </button>\n          </div>\n        </>\n      )}\n\n      {/* Batch Hours Modal */}\n      {showBatchHoursModal && (\n        <BatchHoursModal\n          batchHours={batchHours}\n          setBatchHours={setBatchHours}\n          namedWorkerCount={namedWorkerCount}\n          onApply={onApplyBatchHours}\n          onClose={() => setShowBatchHoursModal(false)}\n          t={t}\n        />\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect, useRef } from 'react'\nimport { Search } from 'lucide-react'\nimport { CATEGORIES } from './translations'\nimport { db } from '../../lib/supabase'\n\n/**\n * MaterialsStep - Step 3: Material/equipment category browsing and item selection.\n *\n * Props:\n *  - companyId\n *  - items, setItems\n *  - t, lang\n *  - onShowToast\n */\nexport default function MaterialsStep({ companyId, items, setItems, t, lang, onShowToast }) {\n  const [selectedCategory, setSelectedCategory] = useState(null)\n  const [categoryItems, setCategoryItems] = useState([])\n  const [loadingItems, setLoadingItems] = useState(false)\n  const [materialSearch, setMaterialSearch] = useState('')\n  const [searchResults, setSearchResults] = useState([])\n  const [allMaterials, setAllMaterials] = useState([])\n  const [showCustomForm, setShowCustomForm] = useState(false)\n  const [customItem, setCustomItem] = useState({ name: '', category: '', quantity: '' })\n  const materialsSearchRef = useRef(null)\n  const focusTimeoutRef = useRef(null)\n\n  // Load items when category selected\n  useEffect(() => {\n    if (selectedCategory && companyId) {\n      loadCategoryItems(selectedCategory)\n    }\n  }, [selectedCategory, companyId])\n\n  // Auto-focus search on mount when no category selected\n  useEffect(() => {\n    if (!selectedCategory && materialsSearchRef.current) {\n      focusTimeoutRef.current = setTimeout(() => {\n        materialsSearchRef.current?.focus()\n      }, 100)\n    }\n    return () => {\n      if (focusTimeoutRef.current) clearTimeout(focusTimeoutRef.current)\n    }\n  }, [selectedCategory])\n\n  const loadCategoryItems = async (category) => {\n    setLoadingItems(true)\n    try {\n      const data = await db.getMaterialsEquipmentByCategory(companyId, category)\n      setCategoryItems(data)\n    } catch (error) {\n      console.error('Error loading items:', error)\n      onShowToast('Error loading items', 'error')\n    } finally {\n      setLoadingItems(false)\n    }\n  }\n\n  const loadAllMaterials = async () => {\n    if (allMaterials.length > 0) return\n    try {\n      const allItems = []\n      for (const category of CATEGORIES) {\n        const data = await db.getMaterialsEquipmentByCategory(companyId, category)\n        allItems.push(...data.map(item => ({ ...item, category })))\n      }\n      setAllMaterials(allItems)\n    } catch (error) {\n      console.error('Error loading all materials:', error)\n    }\n  }\n\n  const handleMaterialSearch = (query) => {\n    setMaterialSearch(query)\n    if (!query.trim()) {\n      setSearchResults([])\n      return\n    }\n    const lowerQuery = query.toLowerCase()\n    const results = allMaterials.filter(item =>\n      item.name.toLowerCase().includes(lowerQuery) ||\n      item.category.toLowerCase().includes(lowerQuery)\n    )\n    setSearchResults(results.slice(0, 10))\n  }\n\n  const selectItem = (item) => {\n    const existingIndex = items.findIndex(i => i.material_equipment_id === item.id)\n    if (existingIndex >= 0) {\n      setItems(items.map((it, i) =>\n        i === existingIndex ? { ...it, quantity: it.quantity + 1 } : it\n      ))\n    } else {\n      setItems([...items, {\n        material_equipment_id: item.id,\n        name: item.name,\n        unit: item.unit,\n        category: item.category,\n        quantity: 1,\n        isCustom: false\n      }])\n    }\n    onShowToast(`Added ${item.name}`, 'success')\n  }\n\n  const addCustomItemHandler = () => {\n    if (!customItem.name || !customItem.category || !customItem.quantity) {\n      onShowToast('Fill in all fields', 'error')\n      return\n    }\n    setItems([...items, {\n      material_equipment_id: null,\n      custom_name: customItem.name,\n      custom_category: customItem.category,\n      name: customItem.name,\n      category: customItem.category,\n      quantity: parseFloat(customItem.quantity),\n      unit: 'each',\n      isCustom: true\n    }])\n    setCustomItem({ name: '', category: '', quantity: '' })\n    setShowCustomForm(false)\n    setSelectedCategory(null)\n    onShowToast('Custom item added', 'success')\n  }\n\n  const updateItemQuantity = (index, quantity) => {\n    const qty = parseFloat(quantity) || 0\n    if (qty <= 0) {\n      setItems(items.filter((_, i) => i !== index))\n    } else {\n      setItems(items.map((item, i) =>\n        i === index ? { ...item, quantity: qty } : item\n      ))\n    }\n  }\n\n  const goBack = () => {\n    if (showCustomForm) {\n      setShowCustomForm(false)\n    } else if (selectedCategory) {\n      setSelectedCategory(null)\n      setShowCustomForm(false)\n    }\n  }\n\n  // Category detail / custom form view\n  if (selectedCategory || showCustomForm) {\n    return (\n      <div className=\"tm-step-content\">\n        <div className=\"tm-wizard-header\" style={{ margin: '-1rem -1rem 1rem -1rem', padding: '0.75rem 1rem' }}>\n          <button className=\"tm-back-btn\" onClick={goBack}>{'\\u2190'}</button>\n          <h2>{showCustomForm ? 'Add Custom Item' : selectedCategory}</h2>\n          <div className=\"tm-item-count\">{items.length} items</div>\n        </div>\n\n        {showCustomForm ? (\n          <div className=\"tm-custom-form\">\n            <div className=\"tm-field\">\n              <label>Item Name</label>\n              <input\n                type=\"text\"\n                placeholder=\"What did you use?\"\n                value={customItem.name}\n                onChange={(e) => setCustomItem({ ...customItem, name: e.target.value })}\n                autoFocus\n              />\n            </div>\n            <div className=\"tm-field\">\n              <label>Category</label>\n              <div className=\"tm-category-select\">\n                {CATEGORIES.map(cat => (\n                  <button\n                    key={cat}\n                    className={`tm-cat-chip ${customItem.category === cat ? 'active' : ''}`}\n                    onClick={() => setCustomItem({ ...customItem, category: cat })}\n                  >\n                    {cat}\n                  </button>\n                ))}\n              </div>\n            </div>\n            <div className=\"tm-field\">\n              <label>Quantity</label>\n              <input\n                type=\"number\"\n                placeholder=\"How many?\"\n                value={customItem.quantity}\n                onChange={(e) => setCustomItem({ ...customItem, quantity: e.target.value })}\n              />\n            </div>\n            <button className=\"tm-big-btn primary\" onClick={addCustomItemHandler}>\n              Add Custom Item\n            </button>\n          </div>\n        ) : (\n          <div className=\"tm-item-grid\">\n            {loadingItems ? (\n              <div className=\"tm-loading\">Loading...</div>\n            ) : (\n              <>\n                {categoryItems.map(item => {\n                  const added = items.find(i => i.material_equipment_id === item.id)\n                  return (\n                    <button\n                      key={item.id}\n                      className={`tm-item-card ${added ? 'added' : ''}`}\n                      onClick={() => selectItem(item)}\n                    >\n                      <span className=\"tm-item-name\">{item.name}</span>\n                      <span className=\"tm-item-unit\">{item.unit}</span>\n                      {added && <span className=\"tm-item-badge\">{added.quantity}</span>}\n                    </button>\n                  )\n                })}\n                <button\n                  className=\"tm-item-card custom\"\n                  onClick={() => setShowCustomForm(true)}\n                >\n                  <span className=\"tm-item-name\">+ Add Other</span>\n                  <span className=\"tm-item-unit\">Not on list</span>\n                </button>\n              </>\n            )}\n          </div>\n        )}\n\n        {!showCustomForm && items.length > 0 && (\n          <div className=\"tm-wizard-footer\">\n            <button className=\"tm-big-btn primary\" onClick={() => setSelectedCategory(null)}>\n              Done Adding ({items.length} items)\n            </button>\n          </div>\n        )}\n      </div>\n    )\n  }\n\n  // Main materials browse view\n  return (\n    <div className=\"tm-step-content\">\n      {/* Quick Search */}\n      <div className=\"tm-field tm-search-field\">\n        <div className=\"tm-search-input-wrapper\">\n          <Search size={18} className=\"tm-search-icon\" />\n          <input\n            ref={materialsSearchRef}\n            type=\"text\"\n            placeholder={t('searchMaterials')}\n            value={materialSearch}\n            onChange={(e) => handleMaterialSearch(e.target.value)}\n            onFocus={() => loadAllMaterials()}\n            className=\"tm-search-input\"\n          />\n          {materialSearch && (\n            <button className=\"tm-search-clear\" onClick={() => { setMaterialSearch(''); setSearchResults([]); }}>{'\\u00d7'}</button>\n          )}\n        </div>\n\n        {/* Search Results */}\n        {materialSearch && searchResults.length > 0 && (\n          <div className=\"tm-search-results\">\n            {searchResults.map((item, idx) => {\n              const existingItem = items.find(i => i.id === item.id)\n              return (\n                <button\n                  key={idx}\n                  className={`tm-search-result-item ${existingItem ? 'added' : ''}`}\n                  onClick={() => {\n                    if (existingItem) {\n                      updateItemQuantity(items.indexOf(existingItem), existingItem.quantity + 1)\n                    } else {\n                      setItems([...items, { ...item, quantity: 1, isCustom: false }])\n                    }\n                    setMaterialSearch('')\n                    setSearchResults([])\n                  }}\n                >\n                  <span className=\"tm-search-result-name\">{item.name}</span>\n                  <span className=\"tm-search-result-category\">{item.category}</span>\n                  {existingItem && <span className=\"tm-search-result-qty\">{'\\u00d7'}{existingItem.quantity}</span>}\n                </button>\n              )\n            })}\n          </div>\n        )}\n        {materialSearch && searchResults.length === 0 && (\n          <div className=\"tm-search-no-results\">{t('noSearchResults')}</div>\n        )}\n      </div>\n\n      <div className=\"tm-field\">\n        <label>{t('orBrowse')}</label>\n        <div className=\"tm-category-grid\">\n          {CATEGORIES.map(cat => {\n            const catItems = items.filter(i => i.category === cat)\n            return (\n              <button\n                key={cat}\n                className=\"tm-category-card\"\n                onClick={() => setSelectedCategory(cat)}\n              >\n                <span className=\"tm-cat-name\">{cat}</span>\n                {catItems.length > 0 && (\n                  <span className=\"tm-cat-count\">{catItems.length}</span>\n                )}\n              </button>\n            )\n          })}\n        </div>\n      </div>\n\n      {items.length > 0 && (\n        <div className=\"tm-field\">\n          <label>Added Items ({items.length})</label>\n          <div className=\"tm-added-list\">\n            {items.map((item, index) => (\n              <div key={index} className=\"tm-added-item\">\n                <div className=\"tm-added-info\">\n                  {item.isCustom && <span className=\"tm-custom-badge\">Custom</span>}\n                  <span className=\"tm-added-name\">{item.name}</span>\n                </div>\n                <div className=\"tm-added-qty\">\n                  <button onClick={() => updateItemQuantity(index, item.quantity - 1)}>{'\\u2212'}</button>\n                  <span>{item.quantity}</span>\n                  <button onClick={() => updateItemQuantity(index, item.quantity + 1)}>+</button>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","import { Camera, Link } from 'lucide-react'\n\n/**\n * EvidenceStep - Step 4 evidence section: photo capture/upload and COR linking.\n * This is rendered as part of the Review step (step 4) in the wizard.\n *\n * Props:\n *  - photos, onPhotoAdd, onRemovePhoto\n *  - maxPhotos\n *  - selectedCorId, setSelectedCorId\n *  - assignableCORs\n *  - lang\n */\nexport default function EvidenceStep({\n  photos, onPhotoAdd, onRemovePhoto,\n  maxPhotos,\n  selectedCorId, setSelectedCorId,\n  assignableCORs,\n  lang\n}) {\n  return (\n    <>\n      {/* PHOTOS - Prominent Action Card */}\n      <div className={`tm-action-card-prominent ${photos.length > 0 ? 'has-content' : 'needs-action'}`}>\n        <div className=\"tm-action-card-header\">\n          <div className=\"tm-action-card-icon\">\n            <Camera size={24} />\n          </div>\n          <div className=\"tm-action-card-title\">\n            <h4>{lang === 'en' ? 'Photo Evidence' : 'Evidencia Fotogr\\u00e1fica'}</h4>\n            <span className=\"tm-action-card-status\">\n              {photos.length > 0\n                ? `${photos.length} ${lang === 'en' ? 'photo(s) added' : 'foto(s) agregada(s)'}`\n                : (lang === 'en' ? 'Recommended for billing' : 'Recomendado para facturaci\\u00f3n')\n              }\n            </span>\n          </div>\n        </div>\n        {photos.length > 0 && (\n          <div className=\"tm-photo-preview-row\">\n            {photos.map(photo => (\n              <div key={photo.id} className=\"tm-photo-preview-thumb\">\n                <img src={photo.previewUrl} alt={photo.name} />\n                <button className=\"tm-photo-remove-x\" onClick={() => onRemovePhoto(photo.id)}>{'\\u00d7'}</button>\n              </div>\n            ))}\n          </div>\n        )}\n        <label className={`tm-action-card-btn ${photos.length === 0 ? 'primary' : ''}`}>\n          <input\n            type=\"file\"\n            accept=\"image/*\"\n            multiple\n            onChange={onPhotoAdd}\n            style={{ display: 'none' }}\n          />\n          <Camera size={18} />\n          <span>{photos.length > 0 ? (lang === 'en' ? 'Add More Photos' : 'Agregar M\\u00e1s Fotos') : (lang === 'en' ? 'Add Photos' : 'Agregar Fotos')}</span>\n        </label>\n      </div>\n\n      {/* COR LINKING - Prominent Action Card */}\n      <div className={`tm-action-card-prominent ${selectedCorId ? 'has-content' : ''}`}>\n        <div className=\"tm-action-card-header\">\n          <div className=\"tm-action-card-icon cor\">\n            <Link size={24} />\n          </div>\n          <div className=\"tm-action-card-title\">\n            <h4>{lang === 'en' ? 'Link to Change Order' : 'Vincular a Orden de Cambio'}</h4>\n            <span className=\"tm-action-card-status\">\n              {selectedCorId\n                ? `${lang === 'en' ? 'Linked to' : 'Vinculado a'}: ${assignableCORs.find(c => c.id === selectedCorId)?.cor_number || ''}`\n                : (lang === 'en' ? 'Optional - Link this T&M to a COR' : 'Opcional - Vincular este T&M a un COR')\n              }\n            </span>\n          </div>\n        </div>\n        <select\n          value={selectedCorId}\n          onChange={(e) => setSelectedCorId(e.target.value)}\n          className=\"tm-cor-select-prominent\"\n        >\n          <option value=\"\">{lang === 'en' ? '-- Select a COR (optional) --' : '-- Seleccionar COR (opcional) --'}</option>\n          {assignableCORs.map(cor => (\n            <option key={cor.id} value={cor.id}>\n              {cor.cor_number}: {cor.title || 'Untitled'} ({cor.status})\n            </option>\n          ))}\n        </select>\n        {assignableCORs.length === 0 && (\n          <p className=\"tm-cor-hint\">{lang === 'en' ? 'No active CORs available for this project' : 'No hay CORs activos para este proyecto'}</p>\n        )}\n      </div>\n    </>\n  )\n}\n","import { lazy, Suspense } from 'react'\nimport { FileText, HardHat, UserCheck, Wrench, Zap, PenLine, CheckCircle2, Check, AlertCircle, Loader2, RotateCcw } from 'lucide-react'\nimport EvidenceStep from './EvidenceStep'\n\nconst SignatureLinkGenerator = lazy(() => import('../SignatureLinkGenerator'))\nconst TMClientSignature = lazy(() => import('../TMClientSignature'))\n\n/**\n * ReviewStep - Step 4 (review+evidence+submit) and Step 5 (success/signature).\n *\n * Props:\n *  - step: 4 or 5\n *  - setStep\n *  - project, companyId\n *  - workDate, cePcoNumber, notes\n *  - photos, onPhotoAdd, onRemovePhoto, maxPhotos\n *  - selectedCorId, setSelectedCorId, assignableCORs\n *  - items\n *  - hasCustomLaborClasses\n *  - validDynamicWorkersList, validSupervision, validOperators, validLaborers\n *  - totalWorkers, totalRegHours, totalOTHours\n *  - submittedByName, setSubmittedByName\n *  - submittedTicket\n *  - submitting, submitProgress\n *  - clientSigned, setClientSigned\n *  - showSignatureLinkModal, setShowSignatureLinkModal\n *  - showOnSiteSignature, setShowOnSiteSignature\n *  - onRetryPhotoUpload\n *  - t, lang\n *  - onShowToast\n */\nexport default function ReviewStep({\n  step, setStep,\n  project, companyId,\n  workDate, cePcoNumber, notes,\n  photos, onPhotoAdd, onRemovePhoto, maxPhotos,\n  selectedCorId, setSelectedCorId, assignableCORs,\n  items,\n  hasCustomLaborClasses,\n  validDynamicWorkersList, validSupervision, validOperators, validLaborers,\n  totalWorkers, totalRegHours, totalOTHours,\n  submittedByName, setSubmittedByName,\n  submittedTicket,\n  submitting, submitProgress,\n  clientSigned, setClientSigned,\n  showSignatureLinkModal, setShowSignatureLinkModal,\n  showOnSiteSignature, setShowOnSiteSignature,\n  onRetryPhotoUpload,\n  t, lang,\n  onShowToast\n}) {\n  // Step 5: Success & Client Signature\n  if (step === 5 && submittedTicket) {\n    return (\n      <div className=\"tm-step-content tm-success-step\">\n        <div className=\"tm-success-header\">\n          <div className=\"tm-success-icon\">\n            <CheckCircle2 size={48} />\n          </div>\n          <h2>{lang === 'en' ? 'T&M Ticket Submitted!' : '\\u00a1Ticket T&M Enviado!'}</h2>\n          <p className=\"tm-success-subtitle\">\n            {lang === 'en'\n              ? 'Your ticket has been saved and is ready for client signature.'\n              : 'Su ticket ha sido guardado y est\\u00e1 listo para la firma del cliente.'}\n          </p>\n        </div>\n\n        <div className=\"tm-success-summary\">\n          <div className=\"tm-success-stat\">\n            <span className=\"tm-success-stat-value\">{totalWorkers}</span>\n            <span className=\"tm-success-stat-label\">{lang === 'en' ? 'Workers' : 'Trabajadores'}</span>\n          </div>\n          <div className=\"tm-success-stat\">\n            <span className=\"tm-success-stat-value\">{totalRegHours + totalOTHours}</span>\n            <span className=\"tm-success-stat-label\">{lang === 'en' ? 'Total Hours' : 'Horas Total'}</span>\n          </div>\n          <div className=\"tm-success-stat\">\n            <span className=\"tm-success-stat-value\">{new Date(workDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>\n            <span className=\"tm-success-stat-label\">{lang === 'en' ? 'Work Date' : 'Fecha'}</span>\n          </div>\n        </div>\n\n        {/* Failed Photos Retry Section */}\n        {photos.some(p => p.status === 'failed') && (\n          <div className=\"tm-failed-photos-section\">\n            <div className=\"tm-failed-photos-header\">\n              <AlertCircle size={18} />\n              <span>\n                {lang === 'en'\n                  ? `${photos.filter(p => p.status === 'failed').length} photo(s) failed to upload`\n                  : `${photos.filter(p => p.status === 'failed').length} foto(s) no se subieron`}\n              </span>\n            </div>\n            <div className=\"tm-failed-photos-grid\">\n              {photos.filter(p => p.status === 'failed').map(photo => (\n                <div key={photo.id} className=\"tm-failed-photo-item\">\n                  <img src={photo.previewUrl} alt={photo.name} />\n                  <div className=\"tm-failed-photo-overlay\">\n                    <button\n                      className=\"tm-retry-photo-btn\"\n                      onClick={() => onRetryPhotoUpload(photo.id, submittedTicket.id)}\n                      disabled={photo.status === 'uploading' || photo.status === 'compressing'}\n                    >\n                      {photo.status === 'uploading' || photo.status === 'compressing' ? (\n                        <Loader2 size={16} className=\"tm-spinner\" />\n                      ) : (\n                        <>\n                          <RotateCcw size={16} />\n                          <span>{lang === 'en' ? 'Retry' : 'Reintentar'}</span>\n                        </>\n                      )}\n                    </button>\n                  </div>\n                  {photo.error && (\n                    <div className=\"tm-failed-photo-error\" title={photo.error}>\n                      {photo.error.substring(0, 20)}{photo.error.length > 20 ? '...' : ''}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n            <button\n              className=\"tm-retry-all-btn\"\n              onClick={async () => {\n                const failedPhotos = photos.filter(p => p.status === 'failed')\n                for (const photo of failedPhotos) {\n                  await onRetryPhotoUpload(photo.id, submittedTicket.id)\n                }\n              }}\n            >\n              <RotateCcw size={16} />\n              {lang === 'en' ? 'Retry All Failed Photos' : 'Reintentar Todas las Fotos'}\n            </button>\n          </div>\n        )}\n\n        {/* Photo Upload Success Indicator */}\n        {photos.length > 0 && photos.every(p => p.status === 'confirmed') && (\n          <div className=\"tm-photos-success\">\n            <Check size={16} />\n            <span>\n              {lang === 'en'\n                ? `All ${photos.length} photo(s) uploaded successfully`\n                : `${photos.length} foto(s) subidas exitosamente`}\n            </span>\n          </div>\n        )}\n\n        <div className=\"tm-signature-options\">\n          <h3>{lang === 'en' ? 'Get Client Signature' : 'Obtener Firma del Cliente'}</h3>\n          <p className=\"tm-signature-description\">\n            {lang === 'en'\n              ? 'Have the client sign this T&M ticket to verify the work performed.'\n              : 'Haga que el cliente firme este ticket T&M para verificar el trabajo realizado.'}\n          </p>\n\n          {clientSigned ? (\n            <div className=\"tm-signed-confirmation\">\n              <CheckCircle2 size={32} className=\"tm-signed-icon\" />\n              <span>{lang === 'en' ? 'Client signature collected!' : '\\u00a1Firma del cliente recopilada!'}</span>\n            </div>\n          ) : (\n            <div className=\"tm-signature-buttons\">\n              <button\n                className=\"tm-signature-option-btn primary\"\n                onClick={() => setShowOnSiteSignature(true)}\n              >\n                <div className=\"tm-signature-option-icon\">\n                  <PenLine size={24} />\n                </div>\n                <div className=\"tm-signature-option-text\">\n                  <span className=\"tm-signature-option-title\">\n                    {lang === 'en' ? 'Sign Now (On-Site)' : 'Firmar Ahora'}\n                  </span>\n                  <span className=\"tm-signature-option-desc\">\n                    {lang === 'en' ? 'Client signs on this device' : 'Cliente firma en este dispositivo'}\n                  </span>\n                </div>\n              </button>\n\n              <button\n                className=\"tm-signature-option-btn\"\n                onClick={() => setShowSignatureLinkModal(true)}\n              >\n                <div className=\"tm-signature-option-icon\">\n                  <PenLine size={24} />\n                </div>\n                <div className=\"tm-signature-option-text\">\n                  <span className=\"tm-signature-option-title\">\n                    {lang === 'en' ? 'Send Signature Link' : 'Enviar Enlace'}\n                  </span>\n                  <span className=\"tm-signature-option-desc\">\n                    {lang === 'en' ? 'Client signs later via link' : 'Cliente firma despu\\u00e9s v\\u00eda enlace'}\n                  </span>\n                </div>\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Signature Link Generator Modal */}\n        {showSignatureLinkModal && (\n          <Suspense fallback={<div className=\"loading\">Loading...</div>}>\n            <SignatureLinkGenerator\n              documentType=\"tm_ticket\"\n              documentId={submittedTicket.id}\n              companyId={companyId}\n              projectId={project.id}\n              project={project}\n              documentTitle={`T&M - ${new Date(workDate).toLocaleDateString()}`}\n              onClose={() => setShowSignatureLinkModal(false)}\n              onShowToast={onShowToast}\n            />\n          </Suspense>\n        )}\n\n        {/* On-Site Client Signature Modal */}\n        {showOnSiteSignature && (\n          <Suspense fallback={<div className=\"loading\">Loading...</div>}>\n            <TMClientSignature\n              ticketId={submittedTicket.id}\n              ticketSummary={{\n                workDate: workDate,\n                workerCount: totalWorkers,\n                totalHours: totalRegHours + totalOTHours\n              }}\n              lang={lang}\n              onSave={() => {\n                setShowOnSiteSignature(false)\n                setClientSigned(true)\n              }}\n              onClose={() => setShowOnSiteSignature(false)}\n              onShowToast={onShowToast}\n            />\n          </Suspense>\n        )}\n      </div>\n    )\n  }\n\n  // Step 4: Review (includes Evidence + Summary + Certification)\n  return (\n    <div className=\"tm-step-content\">\n      {/* Evidence section (photos + COR linking) */}\n      <EvidenceStep\n        photos={photos}\n        onPhotoAdd={onPhotoAdd}\n        onRemovePhoto={onRemovePhoto}\n        maxPhotos={maxPhotos}\n        selectedCorId={selectedCorId}\n        setSelectedCorId={setSelectedCorId}\n        assignableCORs={assignableCORs}\n        lang={lang}\n      />\n\n      <div className=\"tm-review-divider\">\n        <span>{lang === 'en' ? 'Ticket Summary' : 'Resumen del Ticket'}</span>\n      </div>\n\n      {/* Work Info Summary */}\n      <div className=\"tm-review-section\">\n        <div className=\"tm-review-section-header\">\n          <h4>{'\\ud83d\\udcc5'} {t('workDate')}</h4>\n          <button className=\"tm-edit-link\" onClick={() => setStep(1)}>{lang === 'en' ? 'Edit' : 'Editar'}</button>\n        </div>\n        <div className=\"tm-review-row\">\n          <span>{new Date(workDate).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</span>\n          {cePcoNumber && <span>CE/PCO: {cePcoNumber}</span>}\n        </div>\n      </div>\n\n      {/* Description */}\n      {notes && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4><FileText size={16} className=\"inline-icon\" /> {t('notes')}</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(1)}>{lang === 'en' ? 'Edit' : 'Editar'}</button>\n          </div>\n          <div className=\"tm-review-notes\">{notes}</div>\n        </div>\n      )}\n\n      {/* Dynamic Workers Review (when company has custom classes) */}\n      {hasCustomLaborClasses && validDynamicWorkersList.length > 0 && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4><HardHat size={16} className=\"inline-icon\" /> {lang === 'en' ? 'Workers' : 'Trabajadores'} ({totalRegHours + totalOTHours} hrs)</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(2)}>{lang === 'en' ? 'Edit' : 'Editar'}</button>\n          </div>\n          <div className=\"tm-review-list\">\n            {validDynamicWorkersList.map((w, i) => (\n              <div key={i} className=\"tm-review-row-detailed\">\n                <div className=\"tm-review-worker-name\">\n                  <span className=\"tm-role-badge\">{w.role}</span> {w.name}\n                </div>\n                <div className=\"tm-review-worker-details\">\n                  {w.time_started && w.time_ended && (\n                    <span className=\"tm-review-time\">{w.time_started} - {w.time_ended}</span>\n                  )}\n                  <span className=\"tm-review-hours\">{w.hours || 0} reg{w.overtime_hours > 0 ? ` + ${w.overtime_hours} OT` : ''}</span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Hardcoded Workers Review (fallback when no custom classes) */}\n      {!hasCustomLaborClasses && validSupervision.length > 0 && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4><UserCheck size={16} className=\"inline-icon\" /> Supervision ({validSupervision.reduce((sum, s) => sum + parseFloat(s.hours || 0) + parseFloat(s.overtimeHours || 0), 0)} hrs)</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(2)}>{lang === 'en' ? 'Edit' : 'Editar'}</button>\n          </div>\n          <div className=\"tm-review-list\">\n            {validSupervision.map((s, i) => (\n              <div key={i} className=\"tm-review-row-detailed\">\n                <div className=\"tm-review-worker-name\">\n                  <span className=\"tm-role-badge\">{s.role}</span> {s.name}\n                </div>\n                <div className=\"tm-review-worker-details\">\n                  {s.timeStarted && s.timeEnded && (\n                    <span className=\"tm-review-time\">{s.timeStarted} - {s.timeEnded}</span>\n                  )}\n                  <span className=\"tm-review-hours\">{s.hours || 0} reg{parseFloat(s.overtimeHours) > 0 ? ` + ${s.overtimeHours} OT` : ''}</span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {!hasCustomLaborClasses && validOperators.length > 0 && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4>{'\\ud83d\\ude9c'} Operators ({validOperators.reduce((sum, o) => sum + parseFloat(o.hours || 0) + parseFloat(o.overtimeHours || 0), 0)} hrs)</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(2)}>{lang === 'en' ? 'Edit' : 'Editar'}</button>\n          </div>\n          <div className=\"tm-review-list\">\n            {validOperators.map((o, i) => (\n              <div key={i} className=\"tm-review-row-detailed\">\n                <div className=\"tm-review-worker-name\">{o.name}</div>\n                <div className=\"tm-review-worker-details\">\n                  {o.timeStarted && o.timeEnded && (\n                    <span className=\"tm-review-time\">{o.timeStarted} - {o.timeEnded}</span>\n                  )}\n                  <span className=\"tm-review-hours\">{o.hours || 0} reg{parseFloat(o.overtimeHours) > 0 ? ` + ${o.overtimeHours} OT` : ''}</span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {!hasCustomLaborClasses && validLaborers.length > 0 && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4><HardHat size={16} className=\"inline-icon\" /> Laborers ({validLaborers.reduce((sum, l) => sum + parseFloat(l.hours || 0) + parseFloat(l.overtimeHours || 0), 0)} hrs)</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(2)}>{lang === 'en' ? 'Edit' : 'Editar'}</button>\n          </div>\n          <div className=\"tm-review-list\">\n            {validLaborers.map((l, i) => (\n              <div key={i} className=\"tm-review-row-detailed\">\n                <div className=\"tm-review-worker-name\">{l.name}</div>\n                <div className=\"tm-review-worker-details\">\n                  {l.timeStarted && l.timeEnded && (\n                    <span className=\"tm-review-time\">{l.timeStarted} - {l.timeEnded}</span>\n                  )}\n                  <span className=\"tm-review-hours\">{l.hours || 0} reg{parseFloat(l.overtimeHours) > 0 ? ` + ${l.overtimeHours} OT` : ''}</span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {items.length > 0 && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4><Wrench size={16} className=\"inline-icon\" /> Materials & Equipment ({items.length} items)</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(3)}>{lang === 'en' ? 'Edit' : 'Editar'}</button>\n          </div>\n          <div className=\"tm-review-list\">\n            {items.map((item, i) => (\n              <div key={i} className=\"tm-review-row\">\n                <span>{item.isCustom && <><Zap size={14} className=\"inline-icon\" /> </>}{item.name}</span>\n                <span>{item.quantity} {item.unit}</span>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Submitted By - Certification */}\n      <div className=\"tm-review-section tm-certification\">\n        <div className=\"tm-review-header\">\n          <span><PenLine size={16} className=\"inline-icon\" /> Submitted By</span>\n        </div>\n        <input\n          type=\"text\"\n          className=\"tm-certification-input\"\n          placeholder=\"Enter your name\"\n          value={submittedByName}\n          onChange={(e) => setSubmittedByName(e.target.value)}\n        />\n        <p className=\"tm-certification-note\">\n          By submitting, you certify this T&M is accurate.\n        </p>\n      </div>\n    </div>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { Globe, Check, Loader2, PenLine, AlertCircle, CheckCircle2 } from 'lucide-react'\nimport { db } from '../lib/supabase'\nimport { compressImage } from '../lib/imageUtils'\nimport { TRANSLATIONS } from './tm/translations'\nimport WorkDetailsStep from './tm/WorkDetailsStep'\nimport CrewHoursStep from './tm/CrewHoursStep'\nimport MaterialsStep from './tm/MaterialsStep'\nimport ReviewStep from './tm/ReviewStep'\n\n// Generate secure random ID\nconst generateRandomId = () => {\n  const array = new Uint8Array(6)\n  crypto.getRandomValues(array)\n  return Array.from(array, b => b.toString(36)).join('')\n}\n\n// Calculate hours from time range (auto-split into regular + OT)\nconst calculateHoursFromTimeRange = (startTime, endTime) => {\n  if (!startTime || !endTime) return null\n\n  const [startHour, startMin] = startTime.split(':').map(Number)\n  const [endHour, endMin] = endTime.split(':').map(Number)\n\n  let totalMinutes = (endHour * 60 + endMin) - (startHour * 60 + startMin)\n  if (totalMinutes < 0) totalMinutes += 24 * 60 // Handle overnight\n\n  const totalHours = totalMinutes / 60\n  const regularHours = Math.min(totalHours, 8)\n  const overtimeHours = Math.max(0, totalHours - 8)\n\n  return {\n    hours: regularHours.toFixed(1),\n    overtimeHours: overtimeHours > 0 ? overtimeHours.toFixed(1) : ''\n  }\n}\n\nexport default function TMForm({ project, companyId, maxPhotos = 10, onSubmit, onCancel, onShowToast }) {\n  const [step, setStep] = useState(1)\n  const [workDate, setWorkDate] = useState(new Date().toISOString().split('T')[0])\n\n  // Post-submit signature state\n  const [submittedTicket, setSubmittedTicket] = useState(null)\n  const [showSignatureLinkModal, setShowSignatureLinkModal] = useState(false)\n  const [showOnSiteSignature, setShowOnSiteSignature] = useState(false)\n  const [clientSigned, setClientSigned] = useState(false)\n  const [cePcoNumber, setCePcoNumber] = useState('')\n  const [submittedByName, setSubmittedByName] = useState('')\n\n  // COR assignment state\n  const [selectedCorId, setSelectedCorId] = useState('')\n  const [assignableCORs, setAssignableCORs] = useState([])\n  const [loadingCORs, setLoadingCORs] = useState(false)\n\n  // Batch hours modal state\n  const [showBatchHoursModal, setShowBatchHoursModal] = useState(false)\n  const [batchHours, setBatchHours] = useState({ timeStarted: '', timeEnded: '', hours: '', overtimeHours: '' })\n  const [supervision, setSupervision] = useState([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '', role: 'Foreman' }])\n  const [operators, setOperators] = useState([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n  const [laborers, setLaborers] = useState([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n  const [items, setItems] = useState([])\n  const [notes, setNotes] = useState('')\n  const [photos, setPhotos] = useState([])\n  const [submitting, setSubmitting] = useState(false)\n  const [submitProgress, setSubmitProgress] = useState('')\n\n  // Crew check-in state\n  const [todaysCrew, setTodaysCrew] = useState([])\n\n  // Same as Yesterday state\n  const [loadingPreviousCrew, setLoadingPreviousCrew] = useState(false)\n\n  // Language state\n  const [lang, setLang] = useState('en')\n  const t = (key) => TRANSLATIONS[lang][key] || key\n\n  // Dynamic labor classes state\n  const [laborCategories, setLaborCategories] = useState([])\n  const [laborClasses, setLaborClasses] = useState([])\n  const [dynamicWorkers, setDynamicWorkers] = useState({})\n  const [loadingLaborClasses, setLoadingLaborClasses] = useState(true)\n  const [activeLaborClassIds, setActiveLaborClassIds] = useState(new Set())\n\n  const hasCustomLaborClasses = laborClasses.length > 0\n\n  // Load today's crew and assignable CORs on mount\n  useEffect(() => {\n    loadTodaysCrew()\n    loadAssignableCORs()\n\n    const corSub = db.subscribeToCORs?.(project.id, () => {\n      loadAssignableCORs()\n    })\n\n    return () => {\n      corSub?.unsubscribe?.()\n    }\n  }, [project.id])\n\n  // Load custom labor classes for the company\n  useEffect(() => {\n    const loadLaborClasses = async () => {\n      if (!companyId) {\n        setLoadingLaborClasses(false)\n        return\n      }\n\n      try {\n        const data = await db.getLaborClassesForField(companyId)\n        setLaborCategories(data.categories || [])\n        setLaborClasses(data.classes || [])\n      } catch (err) {\n        console.error('Error loading labor classes:', err)\n      } finally {\n        setLoadingLaborClasses(false)\n      }\n    }\n\n    loadLaborClasses()\n  }, [companyId])\n\n  // Initialize labor classes based on today's crew check-in\n  useEffect(() => {\n    if (loadingLaborClasses || laborClasses.length === 0) return\n\n    const crewLaborClassIds = new Set()\n    todaysCrew.forEach(worker => {\n      if (worker.labor_class_id) {\n        crewLaborClassIds.add(worker.labor_class_id)\n      }\n    })\n\n    const initialWorkers = {}\n    const activeIds = new Set()\n\n    crewLaborClassIds.forEach(classId => {\n      if (laborClasses.some(lc => lc.id === classId)) {\n        initialWorkers[classId] = [{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }]\n        activeIds.add(classId)\n      }\n    })\n\n    setDynamicWorkers(prev => {\n      if (Object.keys(prev).length === 0) {\n        return initialWorkers\n      }\n      return prev\n    })\n\n    setActiveLaborClassIds(prev => {\n      if (prev.size === 0) {\n        return activeIds\n      }\n      return prev\n    })\n  }, [laborClasses, todaysCrew, loadingLaborClasses])\n\n  // Load all CORs that can receive T&M tickets\n  const loadAssignableCORs = async () => {\n    setLoadingCORs(true)\n    try {\n      const cors = await db.getAssignableCORs(project.id)\n      setAssignableCORs(cors || [])\n    } catch (err) {\n      console.error('Error loading assignable CORs:', err)\n    } finally {\n      setLoadingCORs(false)\n    }\n  }\n\n  // Apply batch hours to all workers with names\n  const applyBatchHours = () => {\n    const { timeStarted, timeEnded, hours, overtimeHours } = batchHours\n    let updatedCount = 0\n\n    if (hasCustomLaborClasses) {\n      const updatedDynamic = {}\n      Object.entries(dynamicWorkers).forEach(([classId, workers]) => {\n        updatedDynamic[classId] = workers.map(w => {\n          if (w && w.name && w.name.trim()) {\n            updatedCount++\n            return { ...w, timeStarted, timeEnded, hours, overtimeHours }\n          }\n          return w\n        })\n      })\n      setDynamicWorkers(updatedDynamic)\n    } else {\n      setSupervision(supervision.map(s => {\n        if (s && s.name && s.name.trim()) {\n          updatedCount++\n          return { ...s, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return s\n      }))\n      setOperators(operators.map(o => {\n        if (o && o.name && o.name.trim()) {\n          updatedCount++\n          return { ...o, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return o\n      }))\n      setLaborers(laborers.map(l => {\n        if (l && l.name && l.name.trim()) {\n          updatedCount++\n          return { ...l, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return l\n      }))\n    }\n\n    setShowBatchHoursModal(false)\n    setBatchHours({ timeStarted: '', timeEnded: '', hours: '', overtimeHours: '' })\n\n    if (updatedCount > 0) {\n      onShowToast(t('appliedHours').replace('{count}', updatedCount), 'success')\n    } else {\n      onShowToast(lang === 'en' ? 'Add workers first' : 'Agregue trabajadores primero', 'info')\n    }\n  }\n\n  // Apply preset hours directly to all workers (inline, no modal)\n  const applyInlinePreset = (preset) => {\n    let timeStarted, timeEnded, hours, overtimeHours\n\n    switch (preset) {\n      case '8hr':\n        timeStarted = '07:00'\n        timeEnded = '15:30'\n        hours = '8'\n        overtimeHours = ''\n        break\n      case '10hr':\n        timeStarted = '06:00'\n        timeEnded = '16:30'\n        hours = '8'\n        overtimeHours = '2'\n        break\n      case '4hr':\n        timeStarted = '07:00'\n        timeEnded = '11:00'\n        hours = '4'\n        overtimeHours = ''\n        break\n      default:\n        return\n    }\n\n    let count = 0\n\n    if (hasCustomLaborClasses) {\n      const updatedDynamic = {}\n      Object.entries(dynamicWorkers).forEach(([classId, workers]) => {\n        updatedDynamic[classId] = workers.map(w => {\n          if (w && w.name && w.name.trim()) {\n            count++\n            return { ...w, timeStarted, timeEnded, hours, overtimeHours }\n          }\n          return w\n        })\n      })\n      setDynamicWorkers(updatedDynamic)\n    } else {\n      setSupervision(prev => prev.map(s => {\n        if (s && s.name && s.name.trim()) {\n          count++\n          return { ...s, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return s\n      }))\n      setOperators(prev => prev.map(o => {\n        if (o && o.name && o.name.trim()) {\n          count++\n          return { ...o, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return o\n      }))\n      setLaborers(prev => prev.map(l => {\n        if (l && l.name && l.name.trim()) {\n          count++\n          return { ...l, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return l\n      }))\n    }\n\n    if (count > 0) {\n      onShowToast(t('appliedHours').replace('{count}', count), 'success')\n    } else {\n      onShowToast(lang === 'en' ? 'Add workers first' : 'Agregue trabajadores primero', 'info')\n    }\n  }\n\n  const loadTodaysCrew = async () => {\n    try {\n      const checkin = await db.getCrewCheckin(project.id)\n      if (checkin?.workers) {\n        setTodaysCrew(checkin.workers)\n      }\n    } catch (err) {\n      console.error('Error loading crew:', err)\n    }\n  }\n\n  // Load previous ticket's crew (\"Same as Yesterday\")\n  const loadPreviousCrew = async () => {\n    setLoadingPreviousCrew(true)\n    try {\n      const previousCrew = await db.getPreviousTicketCrew(project.id, workDate)\n\n      if (!previousCrew || previousCrew.totalWorkers === 0) {\n        onShowToast(t('noPreviousCrew'), 'info')\n        return\n      }\n\n      if (hasCustomLaborClasses && previousCrew.dynamicWorkers) {\n        setDynamicWorkers(previousCrew.dynamicWorkers)\n      } else {\n        if (previousCrew.supervision) {\n          setSupervision(previousCrew.supervision)\n        }\n        if (previousCrew.operators) {\n          setOperators(previousCrew.operators)\n        }\n        if (previousCrew.laborers) {\n          setLaborers(previousCrew.laborers)\n        }\n      }\n\n      const dateStr = new Date(previousCrew.workDate).toLocaleDateString()\n      onShowToast(t('loadedWorkers').replace('{count}', previousCrew.totalWorkers).replace('{date}', dateStr), 'success')\n    } catch (error) {\n      console.error('Error loading previous crew:', error)\n      onShowToast(lang === 'en' ? 'Error loading previous crew' : 'Error cargando equipo anterior', 'error')\n    } finally {\n      setLoadingPreviousCrew(false)\n    }\n  }\n\n  // Supervision functions\n  const addSupervisionFn = () => {\n    setSupervision([...supervision, { name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '', role: 'Foreman' }])\n  }\n\n  const updateSupervision = (index, field, value) => {\n    setSupervision(supervision.map((s, i) => {\n      if (i !== index) return s\n      const updated = { ...s, [field]: value }\n      if (field === 'timeStarted' || field === 'timeEnded') {\n        const startTime = field === 'timeStarted' ? value : s.timeStarted\n        const endTime = field === 'timeEnded' ? value : s.timeEnded\n        const calculated = calculateHoursFromTimeRange(startTime, endTime)\n        if (calculated) {\n          updated.hours = calculated.hours\n          updated.overtimeHours = calculated.overtimeHours\n        }\n      }\n      return updated\n    }))\n  }\n\n  const removeSupervision = (index) => {\n    if (supervision.length > 1) {\n      setSupervision(supervision.filter((_, i) => i !== index))\n    } else {\n      setSupervision([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '', role: 'Foreman' }])\n    }\n  }\n\n  // Laborer functions\n  const addLaborerFn = () => {\n    setLaborers([...laborers, { name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n  }\n\n  const updateLaborer = (index, field, value) => {\n    setLaborers(laborers.map((l, i) => {\n      if (i !== index) return l\n      const updated = { ...l, [field]: value }\n      if (field === 'timeStarted' || field === 'timeEnded') {\n        const startTime = field === 'timeStarted' ? value : l.timeStarted\n        const endTime = field === 'timeEnded' ? value : l.timeEnded\n        const calculated = calculateHoursFromTimeRange(startTime, endTime)\n        if (calculated) {\n          updated.hours = calculated.hours\n          updated.overtimeHours = calculated.overtimeHours\n        }\n      }\n      return updated\n    }))\n  }\n\n  const removeLaborer = (index) => {\n    if (laborers.length > 1) {\n      setLaborers(laborers.filter((_, i) => i !== index))\n    } else {\n      setLaborers([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n    }\n  }\n\n  // Operator functions\n  const addOperatorFn = () => {\n    setOperators([...operators, { name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n  }\n\n  const updateOperator = (index, field, value) => {\n    setOperators(operators.map((o, i) => {\n      if (i !== index) return o\n      const updated = { ...o, [field]: value }\n      if (field === 'timeStarted' || field === 'timeEnded') {\n        const startTime = field === 'timeStarted' ? value : o.timeStarted\n        const endTime = field === 'timeEnded' ? value : o.timeEnded\n        const calculated = calculateHoursFromTimeRange(startTime, endTime)\n        if (calculated) {\n          updated.hours = calculated.hours\n          updated.overtimeHours = calculated.overtimeHours\n        }\n      }\n      return updated\n    }))\n  }\n\n  const removeOperator = (index) => {\n    if (operators.length > 1) {\n      setOperators(operators.filter((_, i) => i !== index))\n    } else {\n      setOperators([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n    }\n  }\n\n  // Dynamic worker functions (for custom labor classes)\n  const addDynamicWorker = (classId) => {\n    setDynamicWorkers(prev => ({\n      ...prev,\n      [classId]: [...(prev[classId] || []), { name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }]\n    }))\n  }\n\n  const updateDynamicWorker = (classId, index, field, value) => {\n    setDynamicWorkers(prev => ({\n      ...prev,\n      [classId]: (prev[classId] || []).map((w, i) => {\n        if (i !== index) return w\n        const updated = { ...w, [field]: value }\n        if (field === 'timeStarted' || field === 'timeEnded') {\n          const startTime = field === 'timeStarted' ? value : w.timeStarted\n          const endTime = field === 'timeEnded' ? value : w.timeEnded\n          const calculated = calculateHoursFromTimeRange(startTime, endTime)\n          if (calculated) {\n            updated.hours = calculated.hours\n            updated.overtimeHours = calculated.overtimeHours\n          }\n        }\n        return updated\n      })\n    }))\n  }\n\n  const removeDynamicWorker = (classId, index) => {\n    setDynamicWorkers(prev => {\n      const workers = prev[classId] || []\n      if (workers.length > 1) {\n        return { ...prev, [classId]: workers.filter((_, i) => i !== index) }\n      } else {\n        return { ...prev, [classId]: [{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }] }\n      }\n    })\n  }\n\n  // Activate a labor class\n  const activateLaborClass = (classId) => {\n    if (!classId) return\n    setActiveLaborClassIds(prev => new Set([...prev, classId]))\n    setDynamicWorkers(prev => {\n      if (!prev[classId] || prev[classId].length === 0) {\n        return { ...prev, [classId]: [{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }] }\n      }\n      return prev\n    })\n  }\n\n  // Remove a labor class from the visible list\n  const deactivateLaborClass = (classId) => {\n    setActiveLaborClassIds(prev => {\n      const newSet = new Set(prev)\n      newSet.delete(classId)\n      return newSet\n    })\n    setDynamicWorkers(prev => {\n      const newWorkers = { ...prev }\n      delete newWorkers[classId]\n      return newWorkers\n    })\n  }\n\n  // Get labor classes not currently active\n  const getInactiveLaborClasses = () => {\n    return laborClasses.filter(lc => !activeLaborClassIds.has(lc.id))\n  }\n\n  // Get all valid dynamic workers for submission\n  const getValidDynamicWorkers = () => {\n    if (!dynamicWorkers || typeof dynamicWorkers !== 'object') return []\n    const allWorkers = []\n    Object.entries(dynamicWorkers).forEach(([classId, workers]) => {\n      if (!Array.isArray(workers)) return\n      const laborClass = laborClasses.find(lc => lc.id === classId)\n      workers.forEach(w => {\n        if (w && w.name && w.name.trim() && (parseFloat(w.hours) > 0 || parseFloat(w.overtimeHours) > 0)) {\n          allWorkers.push({\n            name: w.name.trim(),\n            hours: parseFloat(w.hours) || 0,\n            overtime_hours: parseFloat(w.overtimeHours) || 0,\n            time_started: w.timeStarted || null,\n            time_ended: w.timeEnded || null,\n            role: laborClass?.name || 'Worker',\n            labor_class_id: classId\n          })\n        }\n      })\n    })\n    return allWorkers\n  }\n\n  // Handle adding a crew worker from todaysCrew to the appropriate section\n  const handleAddCrewWorker = (worker) => {\n    const validLaborClass = worker.labor_class_id && hasCustomLaborClasses &&\n      laborClasses.some(lc => lc.id === worker.labor_class_id)\n\n    if (validLaborClass) {\n      if (!activeLaborClassIds.has(worker.labor_class_id)) {\n        setActiveLaborClassIds(prev => new Set([...prev, worker.labor_class_id]))\n      }\n\n      const classWorkers = dynamicWorkers[worker.labor_class_id] || []\n      const emptyIndex = classWorkers.findIndex(w => !w || !w.name || !w.name.trim())\n      if (emptyIndex >= 0) {\n        const updated = [...classWorkers]\n        updated[emptyIndex] = { ...updated[emptyIndex], name: worker.name }\n        setDynamicWorkers(prev => ({ ...prev, [worker.labor_class_id]: updated }))\n      } else {\n        setDynamicWorkers(prev => ({\n          ...prev,\n          [worker.labor_class_id]: [...(prev[worker.labor_class_id] || []), {\n            name: worker.name, hours: '', overtimeHours: '', timeStarted: '', timeEnded: ''\n          }]\n        }))\n      }\n    } else {\n      const role = (worker.role || '').toLowerCase()\n\n      if (role.includes('foreman') || role.includes('supervisor') || role.includes('superintendent')) {\n        const emptySupIndex = supervision.findIndex(s => !s || !s.name || !s.name.trim())\n        if (emptySupIndex >= 0) {\n          updateSupervision(emptySupIndex, 'name', worker.name)\n          updateSupervision(emptySupIndex, 'role', role.includes('superintendent') ? 'Superintendent' : 'Foreman')\n        } else {\n          setSupervision([...supervision, {\n            name: worker.name, hours: '', overtimeHours: '', timeStarted: '', timeEnded: '',\n            role: role.includes('superintendent') ? 'Superintendent' : 'Foreman'\n          }])\n        }\n      } else if (role.includes('operator')) {\n        const emptyOpIndex = operators.findIndex(o => !o || !o.name || !o.name.trim())\n        if (emptyOpIndex >= 0) {\n          updateOperator(emptyOpIndex, 'name', worker.name)\n        } else {\n          setOperators([...operators, { name: worker.name, hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n        }\n      } else {\n        const emptyLabIndex = laborers.findIndex(l => !l || !l.name || !l.name.trim())\n        if (emptyLabIndex >= 0) {\n          updateLaborer(emptyLabIndex, 'name', worker.name)\n        } else {\n          setLaborers([...laborers, { name: worker.name, hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n        }\n      }\n    }\n    onShowToast(`Added ${worker.name}`, 'success')\n  }\n\n  // Photo functions\n  const handlePhotoAdd = (e) => {\n    const files = Array.from(e.target.files)\n    if (files.length === 0) return\n\n    const remainingSlots = maxPhotos === -1 ? Infinity : maxPhotos - photos.length\n    if (remainingSlots <= 0) {\n      onShowToast(`Photo limit reached (${maxPhotos} max)`, 'error')\n      e.target.value = ''\n      return\n    }\n\n    const filesToAdd = files.slice(0, remainingSlots)\n    if (filesToAdd.length < files.length) {\n      onShowToast(`Only ${filesToAdd.length} photo(s) added (${maxPhotos} max)`, 'error')\n    }\n\n    const MAX_FILE_SIZE = 10 * 1024 * 1024\n\n    filesToAdd.forEach(file => {\n      if (!file.type.startsWith('image/')) {\n        onShowToast('Please select an image file', 'error')\n        return\n      }\n      if (file.size > MAX_FILE_SIZE) {\n        onShowToast(`Photo too large: ${file.name} (max 10MB)`, 'error')\n        return\n      }\n\n      const previewUrl = URL.createObjectURL(file)\n      const tempId = `photo-${Date.now()}-${generateRandomId()}`\n      setPhotos(prev => [...prev, {\n        id: `${Date.now()}-${generateRandomId()}`,\n        tempId: tempId,\n        file: file,\n        previewUrl: previewUrl,\n        name: file.name,\n        status: 'pending',\n        attempts: 0,\n        error: null,\n        uploadedUrl: null\n      }])\n    })\n\n    e.target.value = ''\n  }\n\n  const updatePhotoStatus = (photoId, updates) => {\n    setPhotos(prev => prev.map(p =>\n      p.id === photoId ? { ...p, ...updates } : p\n    ))\n  }\n\n  const retryPhotoUpload = async (photoId, ticketId) => {\n    const photo = photos.find(p => p.id === photoId)\n    if (!photo || photo.status !== 'failed') return\n\n    updatePhotoStatus(photoId, { status: 'compressing', error: null })\n\n    try {\n      let fileToUpload = photo.file\n      try {\n        fileToUpload = await compressImage(photo.file)\n      } catch (err) {\n        console.warn('Compression failed, using original:', err)\n      }\n\n      updatePhotoStatus(photoId, { status: 'uploading' })\n\n      const url = await db.uploadPhoto(companyId, project.id, ticketId, fileToUpload)\n\n      updatePhotoStatus(photoId, {\n        status: 'confirmed',\n        uploadedUrl: url,\n        attempts: photo.attempts + 1\n      })\n\n      await db.updateTMTicketPhotos(ticketId, [...photos.filter(p => p.uploadedUrl).map(p => p.uploadedUrl), url])\n\n      onShowToast('Photo uploaded successfully', 'success')\n    } catch (err) {\n      console.error('Retry failed:', err)\n      updatePhotoStatus(photoId, {\n        status: 'failed',\n        error: err.message || 'Upload failed',\n        attempts: photo.attempts + 1\n      })\n      onShowToast('Photo retry failed', 'error')\n    }\n  }\n\n  const removePhoto = (photoId) => {\n    const photo = photos.find(p => p.id === photoId)\n    if (photo?.previewUrl) {\n      URL.revokeObjectURL(photo.previewUrl)\n    }\n    setPhotos(photos.filter(p => p.id !== photoId))\n  }\n\n  // Computed values for summaries\n  const validSupervision = supervision.filter(s => s && s.name && s.name.trim() && (parseFloat(s.hours) > 0 || parseFloat(s.overtimeHours) > 0))\n  const validOperators = operators.filter(o => o && o.name && o.name.trim() && (parseFloat(o.hours) > 0 || parseFloat(o.overtimeHours) > 0))\n  const validLaborers = laborers.filter(l => l && l.name && l.name.trim() && (parseFloat(l.hours) > 0 || parseFloat(l.overtimeHours) > 0))\n  const validDynamicWorkersList = getValidDynamicWorkers()\n\n  const totalWorkers = hasCustomLaborClasses\n    ? validDynamicWorkersList.length\n    : validSupervision.length + validOperators.length + validLaborers.length\n  const totalRegHours = hasCustomLaborClasses\n    ? validDynamicWorkersList.reduce((sum, w) => sum + (w.hours || 0), 0)\n    : [...validSupervision, ...validOperators, ...validLaborers].reduce((sum, w) => sum + parseFloat(w.hours || 0), 0)\n  const totalOTHours = hasCustomLaborClasses\n    ? validDynamicWorkersList.reduce((sum, w) => sum + (w.overtime_hours || 0), 0)\n    : [...validSupervision, ...validOperators, ...validLaborers].reduce((sum, w) => sum + parseFloat(w.overtimeHours || 0), 0)\n\n  const namedWorkers = hasCustomLaborClasses\n    ? Object.values(dynamicWorkers || {}).flat().filter(w => w && w.name && w.name.trim())\n    : [\n        ...supervision.filter(s => s && s.name && s.name.trim()),\n        ...operators.filter(o => o && o.name && o.name.trim()),\n        ...laborers.filter(l => l && l.name && l.name.trim())\n      ]\n  const workersNeedingHours = namedWorkers.length - totalWorkers\n\n  // Navigation\n  const canGoNext = () => {\n    if (step === 1) return notes.trim().length > 0\n    if (step === 2) {\n      if (hasCustomLaborClasses) return getValidDynamicWorkers().length > 0\n      const hasSupervision = supervision.some(s => s && s.name && s.name.trim() && (parseFloat(s.hours) > 0 || parseFloat(s.overtimeHours) > 0))\n      const hasOperators = operators.some(o => o && o.name && o.name.trim() && (parseFloat(o.hours) > 0 || parseFloat(o.overtimeHours) > 0))\n      const hasLaborers = laborers.some(l => l && l.name && l.name.trim() && (parseFloat(l.hours) > 0 || parseFloat(l.overtimeHours) > 0))\n      return hasSupervision || hasOperators || hasLaborers\n    }\n    return true\n  }\n\n  // Validation warnings\n  const getValidationWarnings = () => {\n    const warnings = []\n    if (step === 1 && !notes.trim()) {\n      warnings.push(lang === 'en' ? 'Description recommended' : 'Descripcion recomendada')\n    }\n    if (step === 2 && workersNeedingHours > 0) {\n      warnings.push(lang === 'en' ? `${workersNeedingHours} worker(s) have no hours entered` : `${workersNeedingHours} trabajador(es) sin horas`)\n    }\n    if (step === 4 && !submittedByName.trim()) {\n      warnings.push(lang === 'en' ? 'Name required to submit' : 'Nombre requerido')\n    }\n    return warnings\n  }\n\n  const validationWarnings = getValidationWarnings()\n\n  const goNext = () => {\n    if (step < 4) setStep(step + 1)\n  }\n\n  const goBack = () => {\n    if (step > 1) {\n      setStep(step - 1)\n    } else {\n      onCancel()\n    }\n  }\n\n  // Submit\n  const handleSubmit = async () => {\n    if (!submittedByName.trim()) {\n      onShowToast('Enter your name to submit', 'error')\n      return\n    }\n\n    let allWorkersForSubmit = []\n\n    if (hasCustomLaborClasses) {\n      allWorkersForSubmit = getValidDynamicWorkers()\n      if (allWorkersForSubmit.length === 0) {\n        onShowToast('Add at least one worker', 'error')\n        return\n      }\n    } else {\n      const vs = supervision.filter(s => s && s.name && s.name.trim() && (parseFloat(s.hours) > 0 || parseFloat(s.overtimeHours) > 0))\n      const vo = operators.filter(o => o && o.name && o.name.trim() && (parseFloat(o.hours) > 0 || parseFloat(o.overtimeHours) > 0))\n      const vl = laborers.filter(l => l && l.name && l.name.trim() && (parseFloat(l.hours) > 0 || parseFloat(l.overtimeHours) > 0))\n\n      if (vs.length === 0 && vo.length === 0 && vl.length === 0) {\n        onShowToast('Add at least one worker', 'error')\n        return\n      }\n\n      allWorkersForSubmit = [\n        ...vs.map(s => ({ name: s.name.trim(), hours: parseFloat(s.hours) || 0, overtime_hours: parseFloat(s.overtimeHours) || 0, time_started: s.timeStarted || null, time_ended: s.timeEnded || null, role: s.role })),\n        ...vo.map(o => ({ name: o.name.trim(), hours: parseFloat(o.hours) || 0, overtime_hours: parseFloat(o.overtimeHours) || 0, time_started: o.timeStarted || null, time_ended: o.timeEnded || null, role: 'Operator' })),\n        ...vl.map(l => ({ name: l.name.trim(), hours: parseFloat(l.hours) || 0, overtime_hours: parseFloat(l.overtimeHours) || 0, time_started: l.timeStarted || null, time_ended: l.timeEnded || null, role: 'Laborer' }))\n      ]\n    }\n\n    setSubmitting(true)\n    setSubmitProgress('Creating ticket...')\n    try {\n      const ticket = await db.createTMTicket({\n        project_id: project.id,\n        work_date: workDate,\n        ce_pco_number: cePcoNumber.trim() || null,\n        assigned_cor_id: selectedCorId || null,\n        notes: notes.trim() || null,\n        photos: [],\n        created_by_name: submittedByName.trim()\n      })\n\n      if (!ticket || !ticket.id) {\n        throw new Error('Failed to create ticket - no ticket ID returned')\n      }\n\n      // Compress and upload photos\n      let photoUrls = []\n      const pendingPhotos = photos.filter(p => p.status === 'pending')\n      if (pendingPhotos.length > 0) {\n        setSubmitProgress(`Compressing ${pendingPhotos.length} photo${pendingPhotos.length > 1 ? 's' : ''}...`)\n        pendingPhotos.forEach(p => updatePhotoStatus(p.id, { status: 'compressing' }))\n\n        const compressedPhotos = await Promise.all(\n          pendingPhotos.map(async (photo) => {\n            try {\n              const compressed = await compressImage(photo.file)\n              return { ...photo, file: compressed }\n            } catch (err) {\n              console.warn(`Failed to compress photo ${photo.name}, using original:`, err)\n              return photo\n            }\n          })\n        )\n\n        setSubmitProgress(`Uploading ${pendingPhotos.length} photo${pendingPhotos.length > 1 ? 's' : ''}...`)\n        pendingPhotos.forEach(p => updatePhotoStatus(p.id, { status: 'uploading' }))\n\n        let uploadedCount = 0\n        let failedCount = 0\n        const uploadPromises = compressedPhotos.map(async (photo) => {\n          try {\n            const url = await db.uploadPhoto(companyId, project.id, ticket.id, photo.file)\n            uploadedCount++\n            setSubmitProgress(`Uploading ${uploadedCount}/${pendingPhotos.length} photos...`)\n            updatePhotoStatus(photo.id, { status: 'confirmed', uploadedUrl: url, attempts: (photo.attempts || 0) + 1 })\n            return { id: photo.id, url }\n          } catch (err) {\n            console.error(`Photo ${photo.name} upload failed:`, err)\n            failedCount++\n            updatePhotoStatus(photo.id, { status: 'failed', error: err.message || 'Upload failed', attempts: (photo.attempts || 0) + 1 })\n            return { id: photo.id, url: null, error: err.message }\n          }\n        })\n\n        const results = await Promise.all(uploadPromises)\n        photoUrls = results.filter(r => r.url !== null).map(r => r.url)\n\n        if (failedCount > 0 && photoUrls.length > 0) {\n          onShowToast(`${photoUrls.length}/${pendingPhotos.length} photos uploaded. ${failedCount} failed - can retry later.`, 'warning')\n        } else if (failedCount > 0 && photoUrls.length === 0) {\n          onShowToast(`All ${failedCount} photos failed to upload - can retry after submission.`, 'error')\n        }\n      }\n\n      if (photoUrls.length > 0) {\n        setSubmitProgress('Saving photos...')\n        await db.updateTMTicketPhotos(ticket.id, photoUrls)\n      }\n\n      setSubmitProgress('Saving workers...')\n      await db.addTMWorkers(ticket.id, allWorkersForSubmit)\n\n      if (items.length > 0) {\n        setSubmitProgress('Saving materials...')\n        await db.addTMItems(ticket.id, items.map(item => ({\n          material_equipment_id: item.material_equipment_id,\n          custom_name: item.custom_name || null,\n          custom_category: item.custom_category || null,\n          quantity: item.quantity\n        })))\n      }\n\n      if (selectedCorId) {\n        setSubmitProgress('Importing to COR...')\n        try {\n          await db.importTicketDataToCOR(ticket.id, selectedCorId, companyId, project.work_type || 'demolition', project.job_type || 'standard')\n        } catch (importError) {\n          console.error('Error importing to COR:', importError)\n          try {\n            await db.markImportFailed(ticket.id, selectedCorId, importError?.message || 'Import failed')\n          } catch (markError) {\n            console.error('Error marking import failed:', markError)\n          }\n          onShowToast('T&M saved. COR data sync failed - retry from ticket list.', 'warning')\n        }\n      }\n\n      photos.forEach(p => {\n        if (p.previewUrl) URL.revokeObjectURL(p.previewUrl)\n      })\n\n      setSubmittedTicket(ticket)\n      onShowToast('T&M submitted!', 'success')\n      setStep(5)\n    } catch (error) {\n      console.error('Error submitting T&M:', error)\n      onShowToast('Error submitting T&M', 'error')\n    } finally {\n      setSubmitting(false)\n      setSubmitProgress('')\n    }\n  }\n\n  return (\n    <div className=\"tm-wizard\">\n      {/* Header */}\n      <div className=\"tm-wizard-header\">\n        {step < 5 ? (\n          <button className=\"tm-back-btn\" onClick={goBack}>{'\\u2190'}</button>\n        ) : (\n          <div className=\"tm-success-check\"><CheckCircle2 size={24} /></div>\n        )}\n        <h2>\n          {step === 1 && t('workInfo')}\n          {step === 2 && t('crewHours')}\n          {step === 3 && t('materialsEquipment')}\n          {step === 4 && t('review')}\n          {step === 5 && (lang === 'en' ? 'Submitted' : 'Enviado')}\n        </h2>\n        <div className=\"tm-header-right\">\n          {step < 4 && (\n            <button\n              className=\"tm-lang-toggle\"\n              onClick={() => setLang(lang === 'en' ? 'es' : 'en')}\n              title={lang === 'en' ? 'Cambiar a Espanol' : 'Switch to English'}\n            >\n              <Globe size={16} />\n              {lang === 'en' ? 'ES' : 'EN'}\n            </button>\n          )}\n          {step < 5 && (\n            <div className=\"tm-step-dots\">\n              <span className={`tm-dot ${step >= 1 ? 'active' : ''}`}></span>\n              <span className={`tm-dot ${step >= 2 ? 'active' : ''}`}></span>\n              <span className={`tm-dot ${step >= 3 ? 'active' : ''}`}></span>\n              <span className={`tm-dot ${step >= 4 ? 'active' : ''}`}></span>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Step 1: Work Details */}\n      {step === 1 && (\n        <WorkDetailsStep\n          project={project}\n          workDate={workDate}\n          setWorkDate={setWorkDate}\n          cePcoNumber={cePcoNumber}\n          setCePcoNumber={setCePcoNumber}\n          notes={notes}\n          setNotes={setNotes}\n          t={t}\n          lang={lang}\n        />\n      )}\n\n      {/* Step 2: Crew & Hours */}\n      {step === 2 && (\n        <CrewHoursStep\n          supervision={supervision}\n          operators={operators}\n          laborers={laborers}\n          dynamicWorkers={dynamicWorkers}\n          activeLaborClassIds={activeLaborClassIds}\n          setActiveLaborClassIds={setActiveLaborClassIds}\n          laborCategories={laborCategories}\n          laborClasses={laborClasses}\n          hasCustomLaborClasses={hasCustomLaborClasses}\n          loadingLaborClasses={loadingLaborClasses}\n          todaysCrew={todaysCrew}\n          showBatchHoursModal={showBatchHoursModal}\n          setShowBatchHoursModal={setShowBatchHoursModal}\n          batchHours={batchHours}\n          setBatchHours={setBatchHours}\n          loadingPreviousCrew={loadingPreviousCrew}\n          namedWorkers={namedWorkers}\n          workersNeedingHours={workersNeedingHours}\n          totalRegHours={totalRegHours}\n          totalOTHours={totalOTHours}\n          onLoadPreviousCrew={loadPreviousCrew}\n          onApplyBatchHours={applyBatchHours}\n          onApplyInlinePreset={applyInlinePreset}\n          onAddCrewWorker={handleAddCrewWorker}\n          onActivateLaborClass={activateLaborClass}\n          onDeactivateLaborClass={deactivateLaborClass}\n          addSupervision={addSupervisionFn}\n          updateSupervision={updateSupervision}\n          removeSupervision={removeSupervision}\n          addOperator={addOperatorFn}\n          updateOperator={updateOperator}\n          removeOperator={removeOperator}\n          addLaborer={addLaborerFn}\n          updateLaborer={updateLaborer}\n          removeLaborer={removeLaborer}\n          addDynamicWorker={addDynamicWorker}\n          updateDynamicWorker={updateDynamicWorker}\n          removeDynamicWorker={removeDynamicWorker}\n          getInactiveLaborClasses={getInactiveLaborClasses}\n          t={t}\n          lang={lang}\n          onShowToast={onShowToast}\n        />\n      )}\n\n      {/* Step 3: Materials & Equipment */}\n      {step === 3 && (\n        <MaterialsStep\n          companyId={companyId}\n          items={items}\n          setItems={setItems}\n          t={t}\n          lang={lang}\n          onShowToast={onShowToast}\n        />\n      )}\n\n      {/* Step 4: Review + Evidence / Step 5: Success & Signature */}\n      {(step === 4 || step === 5) && (\n        <ReviewStep\n          step={step}\n          setStep={setStep}\n          project={project}\n          companyId={companyId}\n          workDate={workDate}\n          cePcoNumber={cePcoNumber}\n          notes={notes}\n          photos={photos}\n          onPhotoAdd={handlePhotoAdd}\n          onRemovePhoto={removePhoto}\n          maxPhotos={maxPhotos}\n          selectedCorId={selectedCorId}\n          setSelectedCorId={setSelectedCorId}\n          assignableCORs={assignableCORs}\n          items={items}\n          hasCustomLaborClasses={hasCustomLaborClasses}\n          validDynamicWorkersList={validDynamicWorkersList}\n          validSupervision={validSupervision}\n          validOperators={validOperators}\n          validLaborers={validLaborers}\n          totalWorkers={totalWorkers}\n          totalRegHours={totalRegHours}\n          totalOTHours={totalOTHours}\n          submittedByName={submittedByName}\n          setSubmittedByName={setSubmittedByName}\n          submittedTicket={submittedTicket}\n          submitting={submitting}\n          submitProgress={submitProgress}\n          clientSigned={clientSigned}\n          setClientSigned={setClientSigned}\n          showSignatureLinkModal={showSignatureLinkModal}\n          setShowSignatureLinkModal={setShowSignatureLinkModal}\n          showOnSiteSignature={showOnSiteSignature}\n          setShowOnSiteSignature={setShowOnSiteSignature}\n          onRetryPhotoUpload={retryPhotoUpload}\n          t={t}\n          lang={lang}\n          onShowToast={onShowToast}\n        />\n      )}\n\n      {/* Footer */}\n      {step < 5 && (\n        <div className=\"tm-wizard-footer\">\n          {validationWarnings.length > 0 && (\n            <div className=\"tm-validation-summary\">\n              <AlertCircle size={16} />\n              <span>{validationWarnings[0]}</span>\n            </div>\n          )}\n\n          {step === 1 && (\n            <button className=\"tm-big-btn primary\" onClick={goNext} disabled={!canGoNext()}>\n              {t('nextCrew')}\n            </button>\n          )}\n\n          {step === 2 && (\n            <button className=\"tm-big-btn primary\" onClick={goNext} disabled={!canGoNext()}>\n              {t('nextMaterials')} ({totalWorkers} {totalWorkers === 1 ? t('worker') : t('workers_plural')}, {totalRegHours + totalOTHours} hrs)\n            </button>\n          )}\n\n          {step === 3 && (\n            <>\n              <button className=\"tm-big-btn primary\" onClick={goNext}>\n                {lang === 'en' ? 'Review & Submit' : 'Revisar y Enviar'} ({items.length} {items.length === 1 ? t('item') : t('items_plural')})\n              </button>\n              <button className=\"tm-skip-btn\" onClick={goNext}>\n                {t('skipNoMaterials')}\n              </button>\n            </>\n          )}\n\n          {step === 4 && (\n            <button\n              className={`tm-big-btn submit ${submitting ? 'submitting' : ''} ${!submittedByName.trim() ? 'needs-name' : 'ready'}`}\n              onClick={handleSubmit}\n              disabled={submitting || !submittedByName.trim()}\n            >\n              {submitting ? (\n                <>\n                  <Loader2 size={20} className=\"tm-spinner\" />\n                  <span className=\"tm-submit-text\">{submitProgress || t('submitting')}</span>\n                </>\n              ) : !submittedByName.trim() ? (\n                <>\n                  <PenLine size={18} />\n                  <span>{lang === 'en' ? 'Enter name to submit' : 'Ingrese nombre'}</span>\n                </>\n              ) : (\n                <>\n                  <Check size={20} />\n                  <span>{t('submitTM')}</span>\n                </>\n              )}\n            </button>\n          )}\n        </div>\n      )}\n\n      {/* Step 5: Success Footer */}\n      {step === 5 && (\n        <div className=\"tm-wizard-footer\">\n          <button className=\"tm-big-btn primary\" onClick={onSubmit}>\n            <Check size={20} />\n            <span>{lang === 'en' ? 'Done' : 'Listo'}</span>\n          </button>\n          <button className=\"tm-skip-btn\" onClick={onSubmit}>\n            {lang === 'en' ? 'Skip signature for now' : 'Saltar firma por ahora'}\n          </button>\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect, useCallback } from 'react'\nimport { HardHat, UserPlus } from 'lucide-react'\nimport { db } from '../lib/supabase'\n\nexport default function CrewCheckin({ project, companyId, onShowToast }) {\n  const [workers, setWorkers] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [showAddForm, setShowAddForm] = useState(false)\n  const [newWorker, setNewWorker] = useState({ name: '', role: '', labor_class_id: null })\n\n  // Recent workers for quick-add\n  const [recentWorkers, setRecentWorkers] = useState([])\n  const [loadingRecent, setLoadingRecent] = useState(true)\n\n  // Labor classes from company pricing setup\n  const [laborCategories, setLaborCategories] = useState([])\n  const [laborClasses, setLaborClasses] = useState([])\n  const [loadingClasses, setLoadingClasses] = useState(true)\n\n  // Fallback roles if no custom labor classes are set up\n  const defaultRoles = ['Foreman', 'Laborer', 'Supervisor', 'Operator']\n\n  const loadTodaysCrew = useCallback(async () => {\n    try {\n      const checkin = await db.getCrewCheckin(project.id)\n      if (checkin?.workers) {\n        setWorkers(checkin.workers)\n      }\n    } catch (err) {\n      console.error('Error loading crew:', err)\n      onShowToast?.('Error loading today\\'s crew', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }, [project?.id, onShowToast])\n\n  const loadRecentWorkers = useCallback(async () => {\n    try {\n      const recent = await db.getRecentWorkers(project.id, 30)\n      setRecentWorkers(recent)\n    } catch (err) {\n      console.error('Error loading recent workers:', err)\n      // Non-critical  quick-add still works without recent worker list\n    } finally {\n      setLoadingRecent(false)\n    }\n  }, [project?.id])\n\n  const loadLaborClasses = useCallback(async () => {\n    try {\n      // Use field-safe function that doesn't expose labor rates\n      const data = await db.getLaborClassesForField(companyId)\n      setLaborCategories(data.categories || [])\n      setLaborClasses(data.classes || [])\n\n      // Set default selection to first class if available\n      if (data.classes && data.classes.length > 0) {\n        setNewWorker(prev => ({\n          ...prev,\n          role: data.classes[0].name,\n          labor_class_id: data.classes[0].id\n        }))\n      }\n    } catch (err) {\n      console.error('Error loading labor classes:', err)\n      // Show toast but continue with default roles\n      onShowToast?.('Using default roles - custom labor classes unavailable', 'info')\n    } finally {\n      setLoadingClasses(false)\n    }\n  }, [companyId, onShowToast])\n\n  useEffect(() => {\n    if (project?.id) {\n      loadTodaysCrew()\n      loadRecentWorkers()\n      if (companyId) {\n        loadLaborClasses()\n      } else {\n        setLoadingClasses(false)\n      }\n    }\n  }, [project?.id, companyId, loadTodaysCrew, loadRecentWorkers, loadLaborClasses])\n\n  const handleRoleChange = (value) => {\n    // Check if it's a labor class ID (UUID format)\n    const laborClass = laborClasses.find(lc => lc.id === value)\n    if (laborClass) {\n      setNewWorker({\n        ...newWorker,\n        role: laborClass.name,\n        labor_class_id: laborClass.id\n      })\n    } else {\n      // It's a default role\n      setNewWorker({\n        ...newWorker,\n        role: value,\n        labor_class_id: null\n      })\n    }\n  }\n\n  const handleAddWorker = async () => {\n    if (!newWorker.name.trim()) {\n      onShowToast('Enter worker name', 'error')\n      return\n    }\n\n    if (!newWorker.role) {\n      onShowToast('Select a role', 'error')\n      return\n    }\n\n    // Check for duplicate\n    if (workers.find(w => w.name.toLowerCase() === newWorker.name.trim().toLowerCase())) {\n      onShowToast('Worker already added', 'error')\n      return\n    }\n\n    setSaving(true)\n    try {\n      const updatedWorkers = [...workers, {\n        name: newWorker.name.trim(),\n        role: newWorker.role,\n        labor_class_id: newWorker.labor_class_id\n      }]\n\n      await db.saveCrewCheckin(project.id, updatedWorkers)\n      setWorkers(updatedWorkers)\n\n      // Reset form but keep same role selected for quick entry\n      setNewWorker({ ...newWorker, name: '' })\n      setShowAddForm(false)\n      onShowToast('Crew member added', 'success')\n    } catch (err) {\n      console.error('Error adding worker:', err)\n      onShowToast('Error adding crew member', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleRemoveWorker = async (workerName) => {\n    setSaving(true)\n    try {\n      const updatedWorkers = workers.filter(\n        w => w.name.toLowerCase() !== workerName.toLowerCase()\n      )\n      await db.saveCrewCheckin(project.id, updatedWorkers)\n      setWorkers(updatedWorkers)\n      onShowToast('Crew member removed', 'success')\n    } catch (err) {\n      console.error('Error removing worker:', err)\n      onShowToast('Error removing crew member', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  // Quick-add a recent worker with one tap\n  const handleQuickAdd = async (recentWorker) => {\n    // Check if already added\n    if (workers.find(w => w.name.toLowerCase() === recentWorker.name.toLowerCase())) {\n      onShowToast('Already checked in', 'info')\n      return\n    }\n\n    setSaving(true)\n    try {\n      const updatedWorkers = [...workers, {\n        name: recentWorker.name,\n        role: recentWorker.role,\n        labor_class_id: recentWorker.labor_class_id\n      }]\n      await db.saveCrewCheckin(project.id, updatedWorkers)\n      setWorkers(updatedWorkers)\n      onShowToast(`${recentWorker.name} checked in`, 'success')\n    } catch (err) {\n      console.error('Error adding worker:', err)\n      onShowToast('Error adding crew member', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  // Get recent workers not already checked in today\n  const availableRecentWorkers = recentWorkers.filter(\n    rw => !workers.find(w => w.name.toLowerCase() === rw.name.toLowerCase())\n  )\n\n  const today = new Date().toLocaleDateString('en-US', {\n    weekday: 'long',\n    month: 'short',\n    day: 'numeric'\n  })\n\n  // Group labor classes by category for display\n  const getClassesByCategory = () => {\n    const grouped = {}\n    laborCategories.forEach(cat => {\n      grouped[cat.id] = {\n        name: cat.name,\n        classes: laborClasses.filter(lc => lc.category_id === cat.id)\n      }\n    })\n    // Add uncategorized classes\n    const uncategorized = laborClasses.filter(lc => !lc.category_id)\n    if (uncategorized.length > 0) {\n      grouped['uncategorized'] = {\n        name: 'Other',\n        classes: uncategorized\n      }\n    }\n    return grouped\n  }\n\n  const hasCustomClasses = laborClasses.length > 0\n\n  if (loading || loadingClasses) {\n    return (\n      <div className=\"crew-checkin\">\n        <div className=\"crew-header\">\n          <h3><HardHat size={18} className=\"inline-icon\" /> Today's Crew</h3>\n          <span className=\"crew-date\">{today}</span>\n        </div>\n        <div className=\"crew-loading\">Loading...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"crew-checkin\">\n      <div className=\"crew-header\">\n        <h3><HardHat size={18} className=\"inline-icon\" /> Today's Crew</h3>\n        <span className=\"crew-date\">{today}</span>\n      </div>\n\n      {workers.length === 0 ? (\n        <div className=\"crew-empty\">\n          <p>No crew checked in yet</p>\n          <p className=\"crew-empty-hint\">Add your crew for the day</p>\n        </div>\n      ) : (\n        <div className=\"crew-list\">\n          {workers.map((worker) => (\n            <div key={worker.name} className=\"crew-member\">\n              <div className=\"crew-member-info\">\n                <span className=\"crew-member-name\">{worker.name}</span>\n                <span className={`crew-member-role ${(worker.role || 'laborer').toLowerCase().replace(/\\s+/g, '-')}`}>\n                  {worker.role}\n                </span>\n              </div>\n              <button\n                className=\"crew-remove-btn\"\n                onClick={() => handleRemoveWorker(worker.name)}\n                disabled={saving}\n              >\n                \n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Quick-add recent workers */}\n      {!loadingRecent && availableRecentWorkers.length > 0 && (\n        <div className=\"crew-quick-add\">\n          <div className=\"crew-quick-add-header\">\n            <span>Tap to add</span>\n          </div>\n          <div className=\"crew-quick-add-grid\">\n            {availableRecentWorkers.map(rw => (\n              <button\n                key={rw.name}\n                className=\"crew-quick-add-btn\"\n                onClick={() => handleQuickAdd(rw)}\n                disabled={saving}\n              >\n                <span className=\"crew-quick-add-name\">{rw.name}</span>\n                <span className=\"crew-quick-add-role\">{rw.role}</span>\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Manual add form */}\n      {showAddForm ? (\n        <div className=\"crew-add-form\">\n          <input\n            type=\"text\"\n            value={newWorker.name}\n            onChange={(e) => setNewWorker({ ...newWorker, name: e.target.value })}\n            placeholder=\"Name\"\n            autoFocus\n          />\n          <select\n            value={newWorker.labor_class_id || newWorker.role}\n            onChange={(e) => handleRoleChange(e.target.value)}\n          >\n            {hasCustomClasses ? (\n              // Show labor classes from company pricing\n              Object.entries(getClassesByCategory()).map(([catId, category]) => (\n                <optgroup key={catId} label={category.name}>\n                  {category.classes.map(lc => (\n                    <option key={lc.id} value={lc.id}>\n                      {lc.name}\n                    </option>\n                  ))}\n                </optgroup>\n              ))\n            ) : (\n              // Fallback to default roles\n              defaultRoles.map(role => (\n                <option key={role} value={role}>{role}</option>\n              ))\n            )}\n          </select>\n          <div className=\"crew-add-buttons\">\n            <button\n              className=\"crew-add-confirm\"\n              onClick={handleAddWorker}\n              disabled={saving}\n            >\n              {saving ? '...' : 'Add'}\n            </button>\n            <button\n              className=\"crew-add-cancel\"\n              onClick={() => {\n                setShowAddForm(false)\n                setNewWorker({ name: '', role: laborClasses[0]?.name || 'Laborer', labor_class_id: laborClasses[0]?.id || null })\n              }}\n            >\n              Cancel\n            </button>\n          </div>\n        </div>\n      ) : (\n        <button\n          className=\"crew-add-btn\"\n          onClick={() => setShowAddForm(true)}\n        >\n          <UserPlus size={18} />\n          <span>Add New Person</span>\n        </button>\n      )}\n\n      <div className=\"crew-count\">\n        {workers.length} {workers.length === 1 ? 'person' : 'people'} on site\n      </div>\n    </div>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { HardHat, FileText, AlertTriangle, CheckCircle, Upload } from 'lucide-react'\nimport { db, isSupabaseConfigured } from '../lib/supabase'\n\nexport default function DailyReport({ project, onShowToast, onClose }) {\n  const [loading, setLoading] = useState(true)\n  const [submitting, setSubmitting] = useState(false)\n  const [report, setReport] = useState(null)\n  const [fieldNotes, setFieldNotes] = useState('')\n  const [issues, setIssues] = useState('')\n\n  useEffect(() => {\n    if (project?.id) {\n      loadReport()\n    }\n  }, [project?.id])\n\n  const loadReport = async () => {\n    try {\n      // Check for existing report\n      const existing = await db.getDailyReport(project.id)\n      \n      if (existing) {\n        setReport(existing)\n        setFieldNotes(existing.field_notes || '')\n        setIssues(existing.issues || '')\n      } else {\n        // Compile fresh data\n        const compiled = await db.compileDailyReport(project.id)\n        setReport({\n          ...compiled,\n          status: 'draft'\n        })\n      }\n    } catch (err) {\n      console.error('Error loading report:', err)\n      onShowToast('Error loading report', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleSubmit = async () => {\n    // Demo mode warning\n    if (!isSupabaseConfigured) {\n      onShowToast('Demo Mode: Report saved locally only - won\\'t reach office', 'info')\n      onClose()\n      return\n    }\n\n    setSubmitting(true)\n    try {\n      // Save notes first\n      await db.saveDailyReport(project.id, {\n        field_notes: fieldNotes,\n        issues: issues\n      })\n\n      // Then submit\n      const result = await db.submitDailyReport(project.id, 'Field')\n\n      if (result) {\n        onShowToast('Daily report submitted!', 'success')\n        onClose()\n      } else {\n        onShowToast('Report not sent - check connection', 'error')\n      }\n    } catch (err) {\n      console.error('Error submitting report:', err)\n      onShowToast('Error submitting report', 'error')\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  const today = new Date().toLocaleDateString('en-US', { \n    weekday: 'long', \n    month: 'long', \n    day: 'numeric',\n    year: 'numeric'\n  })\n\n  if (loading) {\n    return (\n      <div className=\"daily-report\">\n        <div className=\"daily-report-header\">\n          <button className=\"back-btn-simple\" onClick={onClose}></button>\n          <h2>Daily Report</h2>\n        </div>\n        <div className=\"daily-report-loading\">Compiling report...</div>\n      </div>\n    )\n  }\n\n  // Handle case where report failed to load\n  if (!report) {\n    return (\n      <div className=\"daily-report\">\n        <div className=\"daily-report-header\">\n          <button className=\"back-btn-simple\" onClick={onClose}></button>\n          <h2>Daily Report</h2>\n        </div>\n        <div className=\"daily-report-error\">\n          <p>Unable to load report data.</p>\n          <button className=\"btn btn-secondary\" onClick={loadReport}>Retry</button>\n        </div>\n      </div>\n    )\n  }\n\n  const isSubmitted = report.status === 'submitted'\n\n  return (\n    <div className=\"daily-report\">\n      <div className=\"daily-report-header\">\n        <button className=\"back-btn-simple\" onClick={onClose}></button>\n        <div>\n          <h2>Daily Report</h2>\n          <p className=\"daily-report-date\">{today}</p>\n        </div>\n      </div>\n\n      {isSubmitted && (\n        <div className=\"daily-report-submitted-banner\">\n           Submitted {new Date(report.submitted_at).toLocaleTimeString()}\n        </div>\n      )}\n\n      <div className=\"daily-report-content\">\n        {/* Summary Cards */}\n        <div className=\"daily-report-summary\">\n          <div className=\"daily-report-card\">\n            <div className=\"daily-report-card-value\">{report.crew_count || 0}</div>\n            <div className=\"daily-report-card-label\">Crew on Site</div>\n          </div>\n          <div className=\"daily-report-card\">\n            <div className=\"daily-report-card-value\">{report.tasks_completed || 0}</div>\n            <div className=\"daily-report-card-label\">Tasks Done</div>\n          </div>\n          <div className=\"daily-report-card\">\n            <div className=\"daily-report-card-value\">{report.tm_tickets_count || 0}</div>\n            <div className=\"daily-report-card-label\">T&M Tickets</div>\n          </div>\n          <div className=\"daily-report-card\">\n            <div className=\"daily-report-card-value\">{report.photos_count || 0}</div>\n            <div className=\"daily-report-card-label\">Photos</div>\n          </div>\n        </div>\n\n        {/* Crew List */}\n        {report.crew_list?.length > 0 && (\n          <div className=\"daily-report-section\">\n            <h3><HardHat size={18} className=\"inline-icon\" /> Crew</h3>\n            <div className=\"daily-report-crew\">\n              {report.crew_list.map((worker, i) => (\n                <div key={i} className=\"daily-report-crew-item\">\n                  <span>{worker.name}</span>\n                  <span className=\"daily-report-crew-role\">{worker.role}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Completed Tasks */}\n        {report.completed_tasks?.length > 0 && (\n          <div className=\"daily-report-section\">\n            <h3><CheckCircle size={18} className=\"inline-icon\" /> Completed Today</h3>\n            <ul className=\"daily-report-tasks\">\n              {report.completed_tasks.map((task, i) => (\n                <li key={i}>\n                  {task.name}\n                  {task.group && <span className=\"daily-report-task-group\">{task.group}</span>}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {/* Field Notes */}\n        <div className=\"daily-report-section\">\n          <h3><FileText size={18} className=\"inline-icon\" /> Notes</h3>\n          <textarea\n            value={fieldNotes}\n            onChange={(e) => setFieldNotes(e.target.value)}\n            placeholder=\"Any notes about today's work...\"\n            rows={3}\n            disabled={isSubmitted}\n          />\n        </div>\n\n        {/* Issues */}\n        <div className=\"daily-report-section\">\n          <h3><AlertTriangle size={18} className=\"inline-icon\" /> Issues / Concerns</h3>\n          <textarea\n            value={issues}\n            onChange={(e) => setIssues(e.target.value)}\n            placeholder=\"Any problems, delays, or concerns...\"\n            rows={3}\n            disabled={isSubmitted}\n          />\n        </div>\n      </div>\n\n      {/* Submit Button */}\n      {!isSubmitted && (\n        <div className=\"daily-report-footer\">\n          <button \n            className=\"btn btn-primary daily-report-submit\"\n            onClick={handleSubmit}\n            disabled={submitting}\n          >\n            {submitting ? 'Submitting...' : <><Upload size={16} className=\"inline-icon\" /> Submit Report</>}\n          </button>\n          <p className=\"daily-report-hint\">This will be sent to the office</p>\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState } from 'react'\nimport { db, isSupabaseConfigured } from '../lib/supabase'\nimport Toast from './Toast'\n\nexport default function InjuryReportForm({ project, companyId, user, onClose, onReportCreated }) {\n  const [loading, setLoading] = useState(false)\n  const [toast, setToast] = useState(null)\n  const [step, setStep] = useState(1) // Multi-step form: 1=Incident, 2=Employee, 3=Supervisor, 4=Witnesses, 5=Medical\n\n  // Incident Details\n  const [incidentDate, setIncidentDate] = useState(new Date().toISOString().split('T')[0])\n  const [incidentTime, setIncidentTime] = useState(new Date().toTimeString().split(' ')[0].substring(0, 5))\n  const [incidentLocation, setIncidentLocation] = useState('')\n  const [incidentDescription, setIncidentDescription] = useState('')\n  const [injuryType, setInjuryType] = useState('minor')\n  const [bodyPartAffected, setBodyPartAffected] = useState('')\n\n  // Employee Information\n  const [employeeName, setEmployeeName] = useState('')\n  const [employeePhone, setEmployeePhone] = useState('')\n  const [employeeEmail, setEmployeeEmail] = useState('')\n  const [employeeAddress, setEmployeeAddress] = useState('')\n  const [employeeJobTitle, setEmployeeJobTitle] = useState('')\n  const [employeeHireDate, setEmployeeHireDate] = useState('')\n\n  // Supervisor Information\n  const [reportedByName, setReportedByName] = useState(user?.name || '')\n  const [reportedByTitle, setReportedByTitle] = useState('')\n  const [reportedByPhone, setReportedByPhone] = useState('')\n  const [reportedByEmail, setReportedByEmail] = useState(user?.email || '')\n\n  // Witnesses\n  const [witnesses, setWitnesses] = useState([])\n  const [witnessName, setWitnessName] = useState('')\n  const [witnessPhone, setWitnessPhone] = useState('')\n  const [witnessEmail, setWitnessEmail] = useState('')\n  const [witnessTestimony, setWitnessTestimony] = useState('')\n\n  // Medical Information\n  const [medicalTreatmentRequired, setMedicalTreatmentRequired] = useState(false)\n  const [medicalFacilityName, setMedicalFacilityName] = useState('')\n  const [medicalFacilityAddress, setMedicalFacilityAddress] = useState('')\n  const [hospitalized, setHospitalized] = useState(false)\n\n  // Actions and Safety\n  const [immediateActionsTaken, setImmediateActionsTaken] = useState('')\n  const [correctiveActionsPlanned, setCorrectiveActionsPlanned] = useState('')\n  const [safetyEquipmentUsed, setSafetyEquipmentUsed] = useState('')\n  const [safetyEquipmentFailed, setSafetyEquipmentFailed] = useState('')\n\n  // Regulatory\n  const [oshaRecordable, setOshaRecordable] = useState(false)\n  const [workersCompClaim, setWorkersCompClaim] = useState(false)\n  const [daysAwayFromWork, setDaysAwayFromWork] = useState(0)\n  const [restrictedWorkDays, setRestrictedWorkDays] = useState(0)\n\n  const handleAddWitness = () => {\n    if (!witnessName.trim()) {\n      setToast({ type: 'error', message: 'Please enter witness name' })\n      return\n    }\n\n    const witness = {\n      name: witnessName,\n      phone: witnessPhone,\n      email: witnessEmail,\n      testimony: witnessTestimony\n    }\n\n    setWitnesses([...witnesses, witness])\n    setWitnessName('')\n    setWitnessPhone('')\n    setWitnessEmail('')\n    setWitnessTestimony('')\n    setToast({ type: 'success', message: 'Witness added' })\n  }\n\n  const handleRemoveWitness = (index) => {\n    setWitnesses(witnesses.filter((_, i) => i !== index))\n  }\n\n  const validateStep = (stepNumber) => {\n    switch (stepNumber) {\n      case 1:\n        if (!incidentLocation.trim() || !incidentDescription.trim()) {\n          setToast({ type: 'error', message: 'Please fill in all incident details' })\n          return false\n        }\n        break\n      case 2:\n        if (!employeeName.trim() || !employeeJobTitle.trim()) {\n          setToast({ type: 'error', message: 'Please fill in employee name and job title' })\n          return false\n        }\n        break\n      case 3:\n        if (!reportedByName.trim() || !reportedByTitle.trim()) {\n          setToast({ type: 'error', message: 'Please fill in supervisor name and title' })\n          return false\n        }\n        break\n    }\n    return true\n  }\n\n  const handleNext = () => {\n    if (validateStep(step)) {\n      setStep(step + 1)\n    }\n  }\n\n  const handleBack = () => {\n    setStep(step - 1)\n  }\n\n  const handleSubmit = async () => {\n    if (!validateStep(step)) return\n\n    // Demo mode warning\n    if (!isSupabaseConfigured) {\n      setToast({ type: 'info', message: 'Demo Mode: Report saved locally only - won\\'t reach office' })\n      setTimeout(() => {\n        onClose()\n      }, 1500)\n      return\n    }\n\n    setLoading(true)\n    try {\n      const reportData = {\n        project_id: project.id,\n        company_id: companyId,\n\n        // Incident details\n        incident_date: incidentDate,\n        incident_time: incidentTime,\n        incident_location: incidentLocation,\n        incident_description: incidentDescription,\n        injury_type: injuryType,\n        body_part_affected: bodyPartAffected || null,\n\n        // Employee information\n        employee_name: employeeName,\n        employee_phone: employeePhone || null,\n        employee_email: employeeEmail || null,\n        employee_address: employeeAddress || null,\n        employee_job_title: employeeJobTitle,\n        employee_hire_date: employeeHireDate || null,\n\n        // Medical information\n        medical_treatment_required: medicalTreatmentRequired,\n        medical_facility_name: medicalFacilityName || null,\n        medical_facility_address: medicalFacilityAddress || null,\n        hospitalized: hospitalized,\n\n        // Supervisor information\n        reported_by_name: reportedByName,\n        reported_by_title: reportedByTitle,\n        reported_by_phone: reportedByPhone || null,\n        reported_by_email: reportedByEmail || null,\n\n        // Witnesses\n        witnesses: witnesses,\n\n        // Actions and safety\n        immediate_actions_taken: immediateActionsTaken || null,\n        corrective_actions_planned: correctiveActionsPlanned || null,\n        safety_equipment_used: safetyEquipmentUsed || null,\n        safety_equipment_failed: safetyEquipmentFailed || null,\n\n        // Regulatory\n        osha_recordable: oshaRecordable,\n        workers_comp_claim: workersCompClaim,\n        days_away_from_work: parseInt(daysAwayFromWork) || 0,\n        restricted_work_days: parseInt(restrictedWorkDays) || 0,\n\n        // Status\n        status: 'reported',\n        created_by: user?.id\n      }\n\n      const report = await db.createInjuryReport(reportData)\n\n      setToast({ type: 'success', message: 'Injury report submitted successfully' })\n\n      if (onReportCreated) {\n        onReportCreated(report)\n      }\n\n      setTimeout(() => {\n        onClose()\n      }, 1500)\n    } catch (error) {\n      console.error('Error submitting injury report:', error)\n      setToast({ type: 'error', message: 'Failed to submit injury report' })\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <>\n      <div className=\"modal-overlay\" onClick={onClose}>\n        <div className=\"modal-content injury-report-modal\" onClick={e => e.stopPropagation()}>\n          <div className=\"modal-header\">\n            <h2>Workplace Injury/Incident Report</h2>\n            <button className=\"close-btn\" onClick={onClose}>&times;</button>\n          </div>\n\n          {/* Progress Indicator */}\n          <div className=\"progress-steps\">\n            <div className={`step ${step >= 1 ? 'active' : ''}`}>1. Incident</div>\n            <div className={`step ${step >= 2 ? 'active' : ''}`}>2. Employee</div>\n            <div className={`step ${step >= 3 ? 'active' : ''}`}>3. Supervisor</div>\n            <div className={`step ${step >= 4 ? 'active' : ''}`}>4. Witnesses</div>\n            <div className={`step ${step >= 5 ? 'active' : ''}`}>5. Medical & Safety</div>\n          </div>\n\n          <div className=\"modal-body\">\n            {/* Step 1: Incident Details */}\n            {step === 1 && (\n              <div className=\"form-step\">\n                <h3>Incident Details</h3>\n\n                <div className=\"form-row\">\n                  <div className=\"form-group\">\n                    <label>Date of Incident *</label>\n                    <input\n                      type=\"date\"\n                      value={incidentDate}\n                      onChange={(e) => setIncidentDate(e.target.value)}\n                      max={new Date().toISOString().split('T')[0]}\n                    />\n                  </div>\n                  <div className=\"form-group\">\n                    <label>Time of Incident *</label>\n                    <input\n                      type=\"time\"\n                      value={incidentTime}\n                      onChange={(e) => setIncidentTime(e.target.value)}\n                    />\n                  </div>\n                </div>\n\n                <div className=\"form-group\">\n                  <label>Location on Site *</label>\n                  <input\n                    type=\"text\"\n                    value={incidentLocation}\n                    onChange={(e) => setIncidentLocation(e.target.value)}\n                    placeholder=\"e.g., Floor 2, near elevator shaft\"\n                  />\n                </div>\n\n                <div className=\"form-group\">\n                  <label>Incident Description *</label>\n                  <textarea\n                    value={incidentDescription}\n                    onChange={(e) => setIncidentDescription(e.target.value)}\n                    rows={4}\n                    placeholder=\"Describe what happened in detail...\"\n                  />\n                </div>\n\n                <div className=\"form-row\">\n                  <div className=\"form-group\">\n                    <label>Injury Type *</label>\n                    <select value={injuryType} onChange={(e) => setInjuryType(e.target.value)}>\n                      <option value=\"minor\">Minor Injury</option>\n                      <option value=\"serious\">Serious Injury</option>\n                      <option value=\"critical\">Critical Injury</option>\n                      <option value=\"near_miss\">Near Miss (No Injury)</option>\n                    </select>\n                  </div>\n                  <div className=\"form-group\">\n                    <label>Body Part Affected</label>\n                    <input\n                      type=\"text\"\n                      value={bodyPartAffected}\n                      onChange={(e) => setBodyPartAffected(e.target.value)}\n                      placeholder=\"e.g., Left hand, lower back\"\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Step 2: Employee Information */}\n            {step === 2 && (\n              <div className=\"form-step\">\n                <h3>Injured Employee Information</h3>\n\n                <div className=\"form-group\">\n                  <label>Full Name *</label>\n                  <input\n                    type=\"text\"\n                    value={employeeName}\n                    onChange={(e) => setEmployeeName(e.target.value)}\n                    placeholder=\"First and last name\"\n                  />\n                </div>\n\n                <div className=\"form-row\">\n                  <div className=\"form-group\">\n                    <label>Phone Number</label>\n                    <input\n                      type=\"tel\"\n                      value={employeePhone}\n                      onChange={(e) => setEmployeePhone(e.target.value)}\n                      placeholder=\"(555) 123-4567\"\n                    />\n                  </div>\n                  <div className=\"form-group\">\n                    <label>Email Address</label>\n                    <input\n                      type=\"email\"\n                      value={employeeEmail}\n                      onChange={(e) => setEmployeeEmail(e.target.value)}\n                      placeholder=\"email@example.com\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"form-group\">\n                  <label>Home Address</label>\n                  <input\n                    type=\"text\"\n                    value={employeeAddress}\n                    onChange={(e) => setEmployeeAddress(e.target.value)}\n                    placeholder=\"Street address, city, state, zip\"\n                  />\n                </div>\n\n                <div className=\"form-row\">\n                  <div className=\"form-group\">\n                    <label>Job Title *</label>\n                    <input\n                      type=\"text\"\n                      value={employeeJobTitle}\n                      onChange={(e) => setEmployeeJobTitle(e.target.value)}\n                      placeholder=\"e.g., Carpenter, Electrician\"\n                    />\n                  </div>\n                  <div className=\"form-group\">\n                    <label>Hire Date</label>\n                    <input\n                      type=\"date\"\n                      value={employeeHireDate}\n                      onChange={(e) => setEmployeeHireDate(e.target.value)}\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Step 3: Supervisor Information */}\n            {step === 3 && (\n              <div className=\"form-step\">\n                <h3>Foreman/Supervisor Making Report</h3>\n\n                <div className=\"form-group\">\n                  <label>Your Name *</label>\n                  <input\n                    type=\"text\"\n                    value={reportedByName}\n                    onChange={(e) => setReportedByName(e.target.value)}\n                    placeholder=\"Full name\"\n                  />\n                </div>\n\n                <div className=\"form-row\">\n                  <div className=\"form-group\">\n                    <label>Your Title *</label>\n                    <input\n                      type=\"text\"\n                      value={reportedByTitle}\n                      onChange={(e) => setReportedByTitle(e.target.value)}\n                      placeholder=\"e.g., Site Foreman, Project Manager\"\n                    />\n                  </div>\n                  <div className=\"form-group\">\n                    <label>Your Phone Number</label>\n                    <input\n                      type=\"tel\"\n                      value={reportedByPhone}\n                      onChange={(e) => setReportedByPhone(e.target.value)}\n                      placeholder=\"(555) 123-4567\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"form-group\">\n                  <label>Your Email Address</label>\n                  <input\n                    type=\"email\"\n                    value={reportedByEmail}\n                    onChange={(e) => setReportedByEmail(e.target.value)}\n                    placeholder=\"email@example.com\"\n                  />\n                </div>\n              </div>\n            )}\n\n            {/* Step 4: Witnesses */}\n            {step === 4 && (\n              <div className=\"form-step\">\n                <h3>Witness Testimonies (Optional)</h3>\n\n                {witnesses.length > 0 && (\n                  <div className=\"witnesses-list\">\n                    {witnesses.map((witness, index) => (\n                      <div key={index} className=\"witness-item\">\n                        <div className=\"witness-info\">\n                          <strong>{witness.name}</strong>\n                          {witness.phone && <span>  {witness.phone}</span>}\n                          {witness.testimony && (\n                            <p className=\"witness-testimony\">\"{witness.testimony}\"</p>\n                          )}\n                        </div>\n                        <button\n                          className=\"btn-danger btn-small\"\n                          onClick={() => handleRemoveWitness(index)}\n                        >\n                          Remove\n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                )}\n\n                <div className=\"add-witness-form\">\n                  <div className=\"form-row\">\n                    <div className=\"form-group\">\n                      <label>Witness Name</label>\n                      <input\n                        type=\"text\"\n                        value={witnessName}\n                        onChange={(e) => setWitnessName(e.target.value)}\n                        placeholder=\"Full name\"\n                      />\n                    </div>\n                    <div className=\"form-group\">\n                      <label>Phone Number</label>\n                      <input\n                        type=\"tel\"\n                        value={witnessPhone}\n                        onChange={(e) => setWitnessPhone(e.target.value)}\n                        placeholder=\"(555) 123-4567\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"form-group\">\n                    <label>Email Address</label>\n                    <input\n                      type=\"email\"\n                      value={witnessEmail}\n                      onChange={(e) => setWitnessEmail(e.target.value)}\n                      placeholder=\"email@example.com\"\n                    />\n                  </div>\n\n                  <div className=\"form-group\">\n                    <label>Witness Testimony</label>\n                    <textarea\n                      value={witnessTestimony}\n                      onChange={(e) => setWitnessTestimony(e.target.value)}\n                      rows={3}\n                      placeholder=\"What did the witness see or hear?\"\n                    />\n                  </div>\n\n                  <button className=\"btn-secondary\" onClick={handleAddWitness}>\n                    + Add Witness\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {/* Step 5: Medical & Safety */}\n            {step === 5 && (\n              <div className=\"form-step\">\n                <h3>Medical Treatment & Safety</h3>\n\n                <div className=\"form-group checkbox-group\">\n                  <label>\n                    <input\n                      type=\"checkbox\"\n                      checked={medicalTreatmentRequired}\n                      onChange={(e) => setMedicalTreatmentRequired(e.target.checked)}\n                    />\n                    Medical treatment required\n                  </label>\n                </div>\n\n                {medicalTreatmentRequired && (\n                  <>\n                    <div className=\"form-group\">\n                      <label>Medical Facility Name</label>\n                      <input\n                        type=\"text\"\n                        value={medicalFacilityName}\n                        onChange={(e) => setMedicalFacilityName(e.target.value)}\n                        placeholder=\"Hospital or clinic name\"\n                      />\n                    </div>\n\n                    <div className=\"form-group\">\n                      <label>Medical Facility Address</label>\n                      <input\n                        type=\"text\"\n                        value={medicalFacilityAddress}\n                        onChange={(e) => setMedicalFacilityAddress(e.target.value)}\n                        placeholder=\"Street address\"\n                      />\n                    </div>\n\n                    <div className=\"form-group checkbox-group\">\n                      <label>\n                        <input\n                          type=\"checkbox\"\n                          checked={hospitalized}\n                          onChange={(e) => setHospitalized(e.target.checked)}\n                        />\n                        Employee was hospitalized\n                      </label>\n                    </div>\n                  </>\n                )}\n\n                <div className=\"form-group\">\n                  <label>Immediate Actions Taken</label>\n                  <textarea\n                    value={immediateActionsTaken}\n                    onChange={(e) => setImmediateActionsTaken(e.target.value)}\n                    rows={2}\n                    placeholder=\"What was done immediately after the incident?\"\n                  />\n                </div>\n\n                <div className=\"form-group\">\n                  <label>Corrective Actions Planned</label>\n                  <textarea\n                    value={correctiveActionsPlanned}\n                    onChange={(e) => setCorrectiveActionsPlanned(e.target.value)}\n                    rows={2}\n                    placeholder=\"What will be done to prevent this in the future?\"\n                  />\n                </div>\n\n                <div className=\"form-row\">\n                  <div className=\"form-group\">\n                    <label>Safety Equipment Used</label>\n                    <input\n                      type=\"text\"\n                      value={safetyEquipmentUsed}\n                      onChange={(e) => setSafetyEquipmentUsed(e.target.value)}\n                      placeholder=\"e.g., Hard hat, gloves, harness\"\n                    />\n                  </div>\n                  <div className=\"form-group\">\n                    <label>Safety Equipment Failed</label>\n                    <input\n                      type=\"text\"\n                      value={safetyEquipmentFailed}\n                      onChange={(e) => setSafetyEquipmentFailed(e.target.value)}\n                      placeholder=\"Equipment that failed, if any\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"form-row\">\n                  <div className=\"form-group\">\n                    <label>Days Away From Work</label>\n                    <input\n                      type=\"number\"\n                      min=\"0\"\n                      value={daysAwayFromWork}\n                      onChange={(e) => setDaysAwayFromWork(e.target.value)}\n                    />\n                  </div>\n                  <div className=\"form-group\">\n                    <label>Restricted Work Days</label>\n                    <input\n                      type=\"number\"\n                      min=\"0\"\n                      value={restrictedWorkDays}\n                      onChange={(e) => setRestrictedWorkDays(e.target.value)}\n                    />\n                  </div>\n                </div>\n\n                <div className=\"form-group checkbox-group\">\n                  <label>\n                    <input\n                      type=\"checkbox\"\n                      checked={oshaRecordable}\n                      onChange={(e) => setOshaRecordable(e.target.checked)}\n                    />\n                    OSHA Recordable Incident\n                  </label>\n                </div>\n\n                <div className=\"form-group checkbox-group\">\n                  <label>\n                    <input\n                      type=\"checkbox\"\n                      checked={workersCompClaim}\n                      onChange={(e) => setWorkersCompClaim(e.target.checked)}\n                    />\n                    Workers' Compensation Claim Filed\n                  </label>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Form Navigation */}\n          <div className=\"modal-footer\">\n            <div className=\"form-actions\">\n              {step > 1 && (\n                <button className=\"btn-secondary\" onClick={handleBack}>\n                   Back\n                </button>\n              )}\n              <button className=\"btn-secondary\" onClick={onClose}>\n                Cancel\n              </button>\n              {step < 5 ? (\n                <button className=\"btn-primary\" onClick={handleNext}>\n                  Next \n                </button>\n              ) : (\n                <button\n                  className=\"btn-primary\"\n                  onClick={handleSubmit}\n                  disabled={loading}\n                >\n                  {loading ? 'Submitting...' : 'Submit Report'}\n                </button>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}\n\n      <style>{`\n        .injury-report-modal {\n          max-width: 800px;\n          max-height: 90vh;\n          overflow-y: auto;\n        }\n\n        .progress-steps {\n          display: flex;\n          justify-content: space-between;\n          padding: 1rem 1.5rem;\n          border-bottom: 1px solid var(--border-color);\n          background-color: var(--bg-elevated);\n          overflow-x: auto;\n        }\n\n        .progress-steps .step {\n          font-size: 0.875rem;\n          color: var(--text-muted);\n          font-weight: 500;\n          white-space: nowrap;\n          padding: 0.5rem;\n        }\n\n        .progress-steps .step.active {\n          color: var(--accent-primary);\n          font-weight: 600;\n        }\n\n        .form-step h3 {\n          margin-top: 0;\n          margin-bottom: 1.5rem;\n          color: var(--text-primary);\n          font-size: 1.25rem;\n        }\n\n        .form-row {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 1rem;\n        }\n\n        .form-group {\n          margin-bottom: 1rem;\n        }\n\n        .form-group label {\n          display: block;\n          margin-bottom: 0.5rem;\n          font-weight: 500;\n          color: var(--text-secondary);\n        }\n\n        .form-group input,\n        .form-group select,\n        .form-group textarea {\n          width: 100%;\n          padding: 0.5rem;\n          border: 1px solid var(--border-color);\n          border-radius: 4px;\n          font-size: 1rem;\n          background: var(--bg-card);\n          color: var(--text-primary);\n        }\n\n        .form-group textarea {\n          resize: vertical;\n        }\n\n        .checkbox-group label {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          font-weight: normal;\n          cursor: pointer;\n        }\n\n        .checkbox-group input[type=\"checkbox\"] {\n          width: auto;\n          margin: 0;\n        }\n\n        .witnesses-list {\n          margin-bottom: 1.5rem;\n        }\n\n        .witness-item {\n          border: 1px solid var(--border-color);\n          border-radius: 6px;\n          padding: 1rem;\n          margin-bottom: 0.5rem;\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n        }\n\n        .witness-info {\n          flex: 1;\n          color: var(--text-primary);\n        }\n\n        .witness-testimony {\n          margin-top: 0.5rem;\n          color: var(--text-secondary);\n          font-style: italic;\n          font-size: 0.875rem;\n        }\n\n        .add-witness-form {\n          border: 2px dashed var(--border-color);\n          border-radius: 6px;\n          padding: 1rem;\n          background-color: var(--bg-elevated);\n        }\n\n        .modal-footer {\n          border-top: 1px solid var(--border-color);\n          padding: 1rem 1.5rem;\n        }\n\n        .form-actions {\n          display: flex;\n          justify-content: space-between;\n          gap: 0.5rem;\n        }\n\n        .btn-primary,\n        .btn-secondary,\n        .btn-danger {\n          padding: 0.5rem 1rem;\n          border-radius: 6px;\n          font-weight: 500;\n          cursor: pointer;\n          border: none;\n        }\n\n        .btn-primary {\n          background-color: var(--primary-color, #3b82f6);\n          color: white;\n        }\n\n        .btn-primary:hover:not(:disabled) {\n          opacity: 0.9;\n        }\n\n        .btn-primary:disabled {\n          opacity: 0.5;\n          cursor: not-allowed;\n        }\n\n        .btn-secondary {\n          background-color: var(--bg-elevated);\n          color: var(--text-primary);\n          border: 1px solid var(--border-color);\n        }\n\n        .btn-secondary:hover {\n          background-color: var(--bg-tertiary);\n        }\n\n        .btn-danger {\n          background-color: #ef4444;\n          color: white;\n        }\n\n        .btn-danger:hover {\n          background-color: #dc2626;\n        }\n\n        .btn-small {\n          padding: 0.25rem 0.75rem;\n          font-size: 0.875rem;\n        }\n\n        @media (max-width: 768px) {\n          .injury-report-modal {\n            max-width: 100%;\n            height: 100vh;\n            max-height: 100vh;\n            border-radius: 0;\n          }\n\n          .form-row {\n            grid-template-columns: 1fr;\n          }\n\n          .progress-steps .step {\n            font-size: 0.75rem;\n            padding: 0.25rem;\n          }\n        }\n      `}</style>\n    </>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { Truck, Plus, Minus, Check, X, ChevronDown, ChevronUp, History } from 'lucide-react'\nimport { db } from '../lib/supabase'\n\nconst LOAD_TYPES = [\n  { value: 'concrete', label: 'Concrete', icon: '' },\n  { value: 'trash', label: 'Trash', icon: '' },\n  { value: 'metals', label: 'Metals', icon: '' },\n  { value: 'hazardous_waste', label: 'Hazardous', icon: '' }\n]\n\nconst getLoadTypeInfo = (type) => LOAD_TYPES.find(t => t.value === type) || { label: type, icon: '' }\n\nexport default function DisposalLoadInput({ project, user = null, date, onShowToast }) {\n  const [loads, setLoads] = useState([])\n  const [history, setHistory] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [showAddForm, setShowAddForm] = useState(false)\n  const [showHistory, setShowHistory] = useState(false)\n  const [newLoad, setNewLoad] = useState({ type: 'concrete', count: 1 })\n\n  // Format date for display\n  const displayDate = new Date(date).toLocaleDateString('en-US', {\n    weekday: 'short',\n    month: 'short',\n    day: 'numeric'\n  })\n\n  useEffect(() => {\n    loadDisposalData()\n    loadHistory()\n  }, [project.id, date])\n\n  const loadDisposalData = async () => {\n    try {\n      setLoading(true)\n      const data = await db.getDisposalLoads(project.id, date)\n      setLoads(data || [])\n    } catch (err) {\n      console.error('Error loading disposal loads:', err)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const loadHistory = async () => {\n    try {\n      const data = await db.getDisposalLoadsHistory(project.id, 14) // Last 14 days\n      // Group by date and filter out today\n      const grouped = (data || [])\n        .filter(load => load.load_date !== date)\n        .reduce((acc, load) => {\n          if (!acc[load.load_date]) {\n            acc[load.load_date] = []\n          }\n          acc[load.load_date].push(load)\n          return acc\n        }, {})\n\n      // Convert to array sorted by date descending\n      const historyArray = Object.entries(grouped)\n        .map(([dateStr, loads]) => ({\n          date: dateStr,\n          loads,\n          totalLoads: loads.reduce((sum, l) => sum + l.load_count, 0)\n        }))\n        .sort((a, b) => new Date(b.date) - new Date(a.date))\n\n      setHistory(historyArray)\n    } catch (err) {\n      console.error('Error loading disposal history:', err)\n    }\n  }\n\n  const handleAddLoad = async () => {\n    if (newLoad.count < 1) return\n\n    setSaving(true)\n    try {\n      await db.addDisposalLoad(\n        project.id,\n        user?.id || null,\n        date,\n        newLoad.type,\n        newLoad.count\n      )\n      await loadDisposalData()\n      setNewLoad({ type: 'concrete', count: 1 })\n      setShowAddForm(false)\n      onShowToast?.('Disposal load added', 'success')\n    } catch (err) {\n      console.error('Error adding disposal load:', err)\n      onShowToast?.('Error adding load', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleDeleteLoad = async (id) => {\n    setSaving(true)\n    try {\n      await db.deleteDisposalLoad(id)\n      await loadDisposalData()\n      onShowToast?.('Load removed', 'success')\n    } catch (err) {\n      console.error('Error deleting disposal load:', err)\n      onShowToast?.('Error removing load', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleQuickAdd = async (loadType) => {\n    setSaving(true)\n    try {\n      await db.addDisposalLoad(project.id, user?.id || null, date, loadType, 1)\n      await loadDisposalData()\n      onShowToast?.('Load added', 'success')\n    } catch (err) {\n      console.error('Error adding disposal load:', err)\n      onShowToast?.('Error adding load', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleIncrementLoad = async (load) => {\n    setSaving(true)\n    try {\n      await db.updateDisposalLoad(load.id, load.load_type, load.load_count + 1)\n      await loadDisposalData()\n    } catch (err) {\n      console.error('Error updating load:', err)\n      onShowToast?.('Error updating load', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleDecrementLoad = async (load) => {\n    if (load.load_count <= 1) {\n      await handleDeleteLoad(load.id)\n      return\n    }\n\n    setSaving(true)\n    try {\n      await db.updateDisposalLoad(load.id, load.load_type, load.load_count - 1)\n      await loadDisposalData()\n    } catch (err) {\n      console.error('Error updating load:', err)\n      onShowToast?.('Error updating load', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  // Group loads by type for display\n  const loadsByType = loads.reduce((acc, load) => {\n    if (!acc[load.load_type]) {\n      acc[load.load_type] = { items: [], total: 0 }\n    }\n    acc[load.load_type].items.push(load)\n    acc[load.load_type].total += load.load_count\n    return acc\n  }, {})\n\n  const totalLoads = loads.reduce((sum, l) => sum + l.load_count, 0)\n\n  if (loading) {\n    return (\n      <div className=\"disposal-load-input\">\n        <div className=\"disposal-header\">\n          <Truck size={20} />\n          <span>Disposal Loads</span>\n        </div>\n        <div className=\"disposal-loading\">Loading...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"disposal-load-input\">\n      <div className=\"disposal-header\">\n        <div className=\"disposal-title\">\n          <Truck size={20} />\n          <span>Disposal Loads</span>\n          {totalLoads > 0 && (\n            <span className=\"disposal-badge\">{totalLoads}</span>\n          )}\n        </div>\n        <span className=\"disposal-date\">{displayDate}</span>\n      </div>\n\n      {/* Quick Add Buttons */}\n      <div className=\"disposal-quick-add\">\n        {LOAD_TYPES.map(type => (\n          <button\n            key={type.value}\n            className=\"quick-add-btn\"\n            onClick={() => handleQuickAdd(type.value)}\n            disabled={saving}\n          >\n            <span className=\"quick-add-icon\">{type.icon}</span>\n            <span className=\"quick-add-label\">+ {type.label}</span>\n          </button>\n        ))}\n      </div>\n\n      {/* Current Loads */}\n      {Object.keys(loadsByType).length > 0 ? (\n        <div className=\"disposal-loads-list\">\n          {LOAD_TYPES.map(type => {\n            const typeData = loadsByType[type.value]\n            if (!typeData) return null\n\n            return (\n              <div key={type.value} className=\"disposal-load-row\">\n                <div className=\"load-info\">\n                  <span className=\"load-icon\">{type.icon}</span>\n                  <span className=\"load-label\">{type.label}</span>\n                </div>\n                <div className=\"load-controls\">\n                  <button\n                    className=\"load-btn decrement\"\n                    onClick={() => handleDecrementLoad(typeData.items[0])}\n                    disabled={saving}\n                  >\n                    <Minus size={16} />\n                  </button>\n                  <span className=\"load-count\">{typeData.total}</span>\n                  <button\n                    className=\"load-btn increment\"\n                    onClick={() => handleIncrementLoad(typeData.items[0])}\n                    disabled={saving}\n                  >\n                    <Plus size={16} />\n                  </button>\n                </div>\n              </div>\n            )\n          })}\n        </div>\n      ) : (\n        <div className=\"disposal-empty\">\n          <p>No disposal loads recorded for {displayDate}</p>\n          <p className=\"disposal-hint\">Tap a button above to add loads</p>\n        </div>\n      )}\n\n      {/* Add Custom Amount Form */}\n      {showAddForm && (\n        <div className=\"disposal-add-form\">\n          <div className=\"add-form-row\">\n            <select\n              value={newLoad.type}\n              onChange={(e) => setNewLoad({ ...newLoad, type: e.target.value })}\n              className=\"load-type-select\"\n            >\n              {LOAD_TYPES.map(type => (\n                <option key={type.value} value={type.value}>\n                  {type.icon} {type.label}\n                </option>\n              ))}\n            </select>\n            <div className=\"count-input-group\">\n              <button\n                className=\"count-btn\"\n                onClick={() => setNewLoad({ ...newLoad, count: Math.max(1, newLoad.count - 1) })}\n              >\n                <Minus size={16} />\n              </button>\n              <input\n                type=\"number\"\n                min=\"1\"\n                value={newLoad.count}\n                onChange={(e) => setNewLoad({ ...newLoad, count: parseInt(e.target.value) || 1 })}\n                className=\"count-input\"\n              />\n              <button\n                className=\"count-btn\"\n                onClick={() => setNewLoad({ ...newLoad, count: newLoad.count + 1 })}\n              >\n                <Plus size={16} />\n              </button>\n            </div>\n          </div>\n          <div className=\"add-form-actions\">\n            <button\n              className=\"btn btn-secondary btn-small\"\n              onClick={() => setShowAddForm(false)}\n            >\n              <X size={16} /> Cancel\n            </button>\n            <button\n              className=\"btn btn-primary btn-small\"\n              onClick={handleAddLoad}\n              disabled={saving}\n            >\n              <Check size={16} /> Add\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Toggle Custom Form */}\n      {!showAddForm && (\n        <button\n          className=\"disposal-add-custom\"\n          onClick={() => setShowAddForm(true)}\n        >\n          <Plus size={16} />\n          Add multiple loads\n        </button>\n      )}\n\n      {/* Summary */}\n      {totalLoads > 0 && (\n        <div className=\"disposal-summary\">\n          <strong>{totalLoads}</strong> total load{totalLoads !== 1 ? 's' : ''} today\n        </div>\n      )}\n\n      {/* History Section */}\n      {history.length > 0 && (\n        <div className=\"disposal-history-section\">\n          <button\n            className=\"disposal-history-toggle\"\n            onClick={() => setShowHistory(!showHistory)}\n          >\n            <History size={16} />\n            <span>View History ({history.length} days)</span>\n            {showHistory ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\n          </button>\n\n          {showHistory && (\n            <div className=\"disposal-history-list\">\n              {history.map(day => {\n                const formattedDate = new Date(day.date).toLocaleDateString('en-US', {\n                  weekday: 'short',\n                  month: 'short',\n                  day: 'numeric'\n                })\n\n                // Group loads by type for this day\n                const loadsByType = day.loads.reduce((acc, load) => {\n                  if (!acc[load.load_type]) {\n                    acc[load.load_type] = 0\n                  }\n                  acc[load.load_type] += load.load_count\n                  return acc\n                }, {})\n\n                return (\n                  <div key={day.date} className=\"disposal-history-day\">\n                    <div className=\"disposal-history-header\">\n                      <span className=\"disposal-history-date\">{formattedDate}</span>\n                      <span className=\"disposal-history-total\">{day.totalLoads} load{day.totalLoads !== 1 ? 's' : ''}</span>\n                    </div>\n                    <div className=\"disposal-history-types\">\n                      {Object.entries(loadsByType).map(([type, count]) => {\n                        const typeInfo = getLoadTypeInfo(type)\n                        return (\n                          <span key={type} className=\"disposal-history-type\">\n                            {typeInfo.icon} {count} {typeInfo.label}\n                          </span>\n                        )\n                      })}\n                    </div>\n                  </div>\n                )\n              })}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect, useRef, useCallback } from 'react'\nimport { Folder, FileText, Map, Shield, FileSignature, Camera, ClipboardList, AlertTriangle, HelpCircle, Send, Download, ArrowLeft, Loader2, File, Image, FileSpreadsheet, ChevronRight } from 'lucide-react'\nimport { db } from '../../lib/supabase'\n\n// Icon mapping\nconst FOLDER_ICONS = {\n  folder: Folder,\n  plans: Map,\n  specs: FileText,\n  permits: Shield,\n  contracts: FileSignature,\n  submittals: Send,\n  rfis: HelpCircle,\n  photos: Camera,\n  reports: ClipboardList,\n  safety: AlertTriangle\n}\n\n// Color mapping\nconst FOLDER_COLORS = {\n  blue: '#3b82f6',\n  green: '#10b981',\n  yellow: '#f59e0b',\n  red: '#ef4444',\n  purple: '#8b5cf6',\n  pink: '#ec4899',\n  gray: '#6b7280',\n  orange: '#f97316'\n}\n\n// Get file icon\nconst getFileIcon = (mimeType) => {\n  if (mimeType?.startsWith('image/')) return Image\n  if (mimeType?.includes('spreadsheet') || mimeType?.includes('excel')) return FileSpreadsheet\n  if (mimeType?.includes('pdf')) return FileText\n  return File\n}\n\n// Format file size\nconst formatFileSize = (bytes) => {\n  if (!bytes) return '0 B'\n  const units = ['B', 'KB', 'MB', 'GB']\n  let size = bytes\n  let unitIndex = 0\n  while (size >= 1024 && unitIndex < units.length - 1) {\n    size /= 1024\n    unitIndex++\n  }\n  return `${size.toFixed(size < 10 ? 1 : 0)} ${units[unitIndex]}`\n}\n\nexport default function FolderGrid({ projectId, onShowToast }) {\n  const [folders, setFolders] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [selectedFolder, setSelectedFolder] = useState(null)\n  const [documents, setDocuments] = useState([])\n  const [loadingDocs, setLoadingDocs] = useState(false)\n\n  // Use ref to track selected folder for real-time updates\n  const selectedFolderRef = useRef(null)\n\n  const loadFolders = useCallback(async () => {\n    setLoading(true)\n    try {\n      const folderList = await db.getProjectFolders(projectId)\n      setFolders(folderList)\n    } catch (error) {\n      console.error('Error loading folders:', error)\n      onShowToast?.('Failed to load folders', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }, [projectId, onShowToast])\n\n  const loadDocuments = useCallback(async (folderId) => {\n    if (!folderId) return\n    setLoadingDocs(true)\n    try {\n      const result = await db.getFolderDocuments(folderId)\n      setDocuments(result.documents)\n    } catch (error) {\n      console.error('Error loading documents:', error)\n      onShowToast?.('Failed to load documents', 'error')\n    } finally {\n      setLoadingDocs(false)\n    }\n  }, [onShowToast])\n\n  useEffect(() => {\n    loadFolders()\n\n    // Subscribe to real-time document and folder changes\n    const folderSub = db.subscribeToDocumentFolders?.(projectId, () => {\n      loadFolders()\n    })\n    const docSub = db.subscribeToDocuments?.(projectId, () => {\n      // Refresh folder counts when documents change\n      loadFolders()\n      // If a folder is open, refresh its documents\n      if (selectedFolderRef.current) {\n        loadDocuments(selectedFolderRef.current.id)\n      }\n    })\n\n    return () => {\n      folderSub?.unsubscribe?.()\n      docSub?.unsubscribe?.()\n    }\n  }, [projectId, loadFolders, loadDocuments])\n\n  const openFolder = async (folder) => {\n    setSelectedFolder(folder)\n    selectedFolderRef.current = folder\n    await loadDocuments(folder.id)\n  }\n\n  const handleDownload = async (doc) => {\n    try {\n      await db.logDocumentAccess(doc.id, 'downloaded')\n      const url = doc.url || `${import.meta.env.VITE_SUPABASE_URL}/storage/v1/object/public/project-documents/${doc.storage_path}`\n      window.open(url, '_blank')\n    } catch (error) {\n      console.error('Download error:', error)\n    }\n  }\n\n  const goBack = () => {\n    setSelectedFolder(null)\n    selectedFolderRef.current = null\n    setDocuments([])\n  }\n\n  // Loading\n  if (loading) {\n    return (\n      <div className=\"field-docs\">\n        <div className=\"field-docs-loading\">\n          <Loader2 size={24} className=\"spinner\" />\n          <span>Loading...</span>\n        </div>\n      </div>\n    )\n  }\n\n  // Document list view\n  if (selectedFolder) {\n    const FolderIcon = FOLDER_ICONS[selectedFolder.icon] || Folder\n    const folderColor = FOLDER_COLORS[selectedFolder.color] || FOLDER_COLORS.blue\n\n    return (\n      <div className=\"field-docs\">\n        {/* Header */}\n        <div className=\"field-docs-header\">\n          <button className=\"field-docs-back\" onClick={goBack}>\n            <ArrowLeft size={20} />\n          </button>\n          <div className=\"field-docs-title\">\n            <div className=\"field-docs-title-icon\" style={{ backgroundColor: `${folderColor}15` }}>\n              <FolderIcon size={20} style={{ color: folderColor }} />\n            </div>\n            <div className=\"field-docs-title-text\">\n              <h2>{selectedFolder.name}</h2>\n              <span>{documents.length} files</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Documents */}\n        <div className=\"field-docs-list\">\n          {loadingDocs ? (\n            <div className=\"field-docs-loading\">\n              <Loader2 size={24} className=\"spinner\" />\n              <span>Loading...</span>\n            </div>\n          ) : documents.length === 0 ? (\n            <div className=\"field-docs-empty\">\n              <Folder size={48} style={{ color: folderColor, opacity: 0.3 }} />\n              <p>No documents yet</p>\n            </div>\n          ) : (\n            documents.map(doc => {\n              const FileIcon = getFileIcon(doc.mime_type)\n              return (\n                <button key={doc.id} className=\"field-doc-item\" onClick={() => handleDownload(doc)}>\n                  <div className=\"field-doc-icon\">\n                    <FileIcon size={22} />\n                  </div>\n                  <div className=\"field-doc-info\">\n                    <span className=\"field-doc-name\">{doc.name}</span>\n                    <span className=\"field-doc-size\">{formatFileSize(doc.file_size_bytes)}</span>\n                  </div>\n                  <Download size={20} className=\"field-doc-download\" />\n                </button>\n              )\n            })\n          )}\n        </div>\n      </div>\n    )\n  }\n\n  // Folder grid\n  return (\n    <div className=\"field-docs\">\n      <div className=\"field-docs-grid\">\n        {folders.length === 0 ? (\n          <div className=\"field-docs-empty\">\n            <Folder size={56} />\n            <h3>No documents</h3>\n            <p>Documents will appear here when added</p>\n          </div>\n        ) : (\n          folders.map(folder => {\n            const Icon = FOLDER_ICONS[folder.icon] || Folder\n            const color = FOLDER_COLORS[folder.color] || FOLDER_COLORS.blue\n            const count = folder.document_count || 0\n            return (\n              <button key={folder.id} className=\"field-folder-card\" onClick={() => openFolder(folder)}>\n                <div className=\"field-folder-icon\" style={{ backgroundColor: `${color}12` }}>\n                  <Icon size={28} style={{ color }} />\n                </div>\n                <div className=\"field-folder-info\">\n                  <span className=\"field-folder-name\">{folder.name}</span>\n                  <span className=\"field-folder-count\">{count} {count === 1 ? 'file' : 'files'}</span>\n                </div>\n                <ChevronRight size={20} className=\"field-folder-arrow\" />\n              </button>\n            )\n          })\n        )}\n      </div>\n    </div>\n  )\n}\n","import { useState, useEffect, useMemo, useCallback, useRef } from 'react'\nimport { db } from '../lib/supabase'\nimport {\n  BarChart, Bar, LineChart, Line, PieChart, Pie, Cell,\n  XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer\n} from 'recharts'\nimport {\n  TrendingUp, Users, FileText, Truck, Calendar,\n  CheckCircle2, Clock, DollarSign, ArrowLeft\n} from 'lucide-react'\n\nexport default function ForemanMetrics({ project, companyId, onBack }) {\n  const [loading, setLoading] = useState(true)\n  const [timeRange, setTimeRange] = useState('week') // week, month\n  const [metrics, setMetrics] = useState({\n    areas: [],\n    tickets: [],\n    crewHistory: [],\n    disposalLoads: [],\n    dailyReports: []\n  })\n\n  useEffect(() => {\n    if (project?.id) {\n      loadMetrics()\n    }\n  }, [project?.id, timeRange])\n\n  const loadMetrics = async () => {\n    setLoading(true)\n    try {\n      const now = new Date()\n      const startDate = new Date()\n      if (timeRange === 'week') {\n        startDate.setDate(now.getDate() - 7)\n      } else {\n        startDate.setDate(now.getDate() - 30)\n      }\n      const startStr = startDate.toISOString().split('T')[0]\n\n      // Load all data in parallel\n      const days = timeRange === 'week' ? 7 : 30\n      const [areas, tickets, disposalLoads, dailyReports] = await Promise.all([\n        db.getAreas(project.id),\n        db.getTMTickets?.(project.id) || [],\n        db.getDisposalLoadsHistory?.(project.id, days) || [],\n        db.getDailyReports?.(project.id) || []\n      ])\n\n      // Load crew history for each day\n      const crewHistory = []\n      const currentDate = new Date(startDate)\n      while (currentDate <= now) {\n        const dateStr = currentDate.toISOString().split('T')[0]\n        try {\n          const crew = await db.getCrewCheckin(project.id, dateStr)\n          crewHistory.push({\n            date: dateStr,\n            count: crew?.workers?.length || 0,\n            dayName: currentDate.toLocaleDateString('en-US', { weekday: 'short' })\n          })\n        } catch {\n          crewHistory.push({ date: dateStr, count: 0, dayName: currentDate.toLocaleDateString('en-US', { weekday: 'short' }) })\n        }\n        currentDate.setDate(currentDate.getDate() + 1)\n      }\n\n      setMetrics({\n        areas,\n        tickets: tickets.filter(t => t.work_date >= startStr),\n        crewHistory,\n        disposalLoads: disposalLoads,\n        dailyReports: dailyReports.filter(r => r.report_date >= startStr)\n      })\n    } catch (error) {\n      console.error('Error loading metrics:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Real-time subscriptions - reload metrics when underlying data changes\n  const refreshTimeoutRef = useRef(null)\n\n  const debouncedReload = useCallback(() => {\n    if (refreshTimeoutRef.current) clearTimeout(refreshTimeoutRef.current)\n    refreshTimeoutRef.current = setTimeout(() => {\n      loadMetrics()\n    }, 300)\n  }, [project?.id, timeRange])\n\n  useEffect(() => {\n    if (!project?.id) return\n    const subs = []\n\n    const areaSub = db.subscribeToAreas?.(project.id, debouncedReload)\n    if (areaSub) subs.push(areaSub)\n\n    const crewSub = db.subscribeToCrewCheckins?.(project.id, debouncedReload)\n    if (crewSub) subs.push(crewSub)\n\n    const tmSub = db.subscribeToTMTickets?.(project.id, debouncedReload)\n    if (tmSub) subs.push(tmSub)\n\n    const haulSub = db.subscribeToHaulOffs?.(project.id, debouncedReload)\n    if (haulSub) subs.push(haulSub)\n\n    const reportSub = db.subscribeToDailyReports?.(project.id, debouncedReload)\n    if (reportSub) subs.push(reportSub)\n\n    return () => {\n      if (refreshTimeoutRef.current) clearTimeout(refreshTimeoutRef.current)\n      subs.forEach(sub => db.unsubscribe?.(sub))\n    }\n  }, [project?.id, debouncedReload])\n\n  // Calculate derived metrics\n  const derivedMetrics = useMemo(() => {\n    const { areas, tickets, crewHistory, disposalLoads, dailyReports } = metrics\n\n    // Progress stats\n    const totalAreas = areas.length\n    const completedAreas = areas.filter(a => a.status === 'done').length\n    const inProgressAreas = areas.filter(a => a.status === 'working').length\n    const notStartedAreas = areas.filter(a => a.status === 'not_started').length\n    const progressPercent = totalAreas > 0 ? Math.round((completedAreas / totalAreas) * 100) : 0\n\n    // Crew stats\n    const totalManDays = crewHistory.reduce((sum, day) => sum + day.count, 0)\n    const avgCrewSize = crewHistory.length > 0\n      ? Math.round((totalManDays / crewHistory.filter(d => d.count > 0).length) * 10) / 10 || 0\n      : 0\n    const daysWithCrew = crewHistory.filter(d => d.count > 0).length\n\n    // T&M stats\n    const pendingTickets = tickets.filter(t => t.status === 'pending' || t.status === 'draft').length\n    const signedTickets = tickets.filter(t => t.status === 'signed' || t.status === 'approved').length\n    const totalTicketValue = tickets.reduce((sum, t) => sum + (t.total_amount || 0), 0)\n\n    // Disposal stats\n    const totalLoads = disposalLoads.reduce((sum, d) => sum + (d.load_count || 0), 0)\n    const totalTonnage = 0 // tonnage not tracked in disposal_loads\n\n    // Daily reports\n    const reportsSubmitted = dailyReports.filter(r => r.submitted).length\n    const reportsDue = timeRange === 'week' ? 7 : 30\n    const reportStreak = calculateReportStreak(dailyReports)\n\n    return {\n      progress: { totalAreas, completedAreas, inProgressAreas, notStartedAreas, progressPercent },\n      crew: { totalManDays, avgCrewSize, daysWithCrew, history: crewHistory },\n      tickets: { total: tickets.length, pending: pendingTickets, signed: signedTickets, totalValue: totalTicketValue },\n      disposal: { totalLoads, totalTonnage },\n      reports: { submitted: reportsSubmitted, due: reportsDue, streak: reportStreak }\n    }\n  }, [metrics, timeRange])\n\n  // Calculate consecutive days with reports\n  function calculateReportStreak(reports) {\n    if (!reports.length) return 0\n    const sortedDates = [...new Set(reports.filter(r => r.submitted).map(r => r.report_date))].sort().reverse()\n    let streak = 0\n    const today = new Date().toISOString().split('T')[0]\n    let checkDate = new Date(today)\n\n    for (let i = 0; i < 30; i++) {\n      const dateStr = checkDate.toISOString().split('T')[0]\n      if (sortedDates.includes(dateStr)) {\n        streak++\n        checkDate.setDate(checkDate.getDate() - 1)\n      } else {\n        break\n      }\n    }\n    return streak\n  }\n\n  // Chart colors\n  const COLORS = {\n    primary: '#3b82f6',\n    success: '#22c55e',\n    warning: '#f59e0b',\n    danger: '#ef4444',\n    muted: '#6b7280',\n    purple: '#8b5cf6'\n  }\n\n  const PIE_COLORS = [COLORS.success, COLORS.primary, COLORS.muted]\n\n  // Prepare chart data\n  const progressPieData = [\n    { name: 'Completed', value: derivedMetrics.progress.completedAreas },\n    { name: 'In Progress', value: derivedMetrics.progress.inProgressAreas },\n    { name: 'Not Started', value: derivedMetrics.progress.notStartedAreas }\n  ].filter(d => d.value > 0)\n\n  const ticketsByDay = useMemo(() => {\n    const byDay = {}\n    metrics.tickets.forEach(t => {\n      const day = t.work_date\n      byDay[day] = (byDay[day] || 0) + 1\n    })\n    return derivedMetrics.crew.history.map(d => ({\n      ...d,\n      tickets: byDay[d.date] || 0\n    }))\n  }, [metrics.tickets, derivedMetrics.crew.history])\n\n  if (loading) {\n    return (\n      <div className=\"foreman-metrics loading\">\n        <div className=\"metrics-header\">\n          <button className=\"back-btn\" onClick={onBack}>\n            <ArrowLeft size={20} />\n            Back\n          </button>\n          <h2>Project Metrics</h2>\n        </div>\n        <div className=\"loading-state\">\n          <div className=\"spinner\"></div>\n          <p>Loading metrics...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"foreman-metrics\">\n      <div className=\"metrics-header\">\n        <button className=\"back-btn\" onClick={onBack}>\n          <ArrowLeft size={20} />\n          Back\n        </button>\n        <h2>Project Metrics</h2>\n        <div className=\"time-toggle\">\n          <button\n            className={timeRange === 'week' ? 'active' : ''}\n            onClick={() => setTimeRange('week')}\n          >\n            7 Days\n          </button>\n          <button\n            className={timeRange === 'month' ? 'active' : ''}\n            onClick={() => setTimeRange('month')}\n          >\n            30 Days\n          </button>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"summary-cards\">\n        <div className=\"summary-card progress-card\">\n          <div className=\"card-icon\">\n            <TrendingUp size={24} />\n          </div>\n          <div className=\"card-content\">\n            <span className=\"card-value\">{derivedMetrics.progress.progressPercent}%</span>\n            <span className=\"card-label\">Complete</span>\n          </div>\n          <div className=\"card-detail\">\n            {derivedMetrics.progress.completedAreas}/{derivedMetrics.progress.totalAreas} areas\n          </div>\n        </div>\n\n        <div className=\"summary-card crew-card\">\n          <div className=\"card-icon\">\n            <Users size={24} />\n          </div>\n          <div className=\"card-content\">\n            <span className=\"card-value\">{derivedMetrics.crew.totalManDays}</span>\n            <span className=\"card-label\">Man-Days</span>\n          </div>\n          <div className=\"card-detail\">\n            Avg {derivedMetrics.crew.avgCrewSize} workers/day\n          </div>\n        </div>\n\n        <div className=\"summary-card tickets-card\">\n          <div className=\"card-icon\">\n            <FileText size={24} />\n          </div>\n          <div className=\"card-content\">\n            <span className=\"card-value\">{derivedMetrics.tickets.total}</span>\n            <span className=\"card-label\">T&M Tickets</span>\n          </div>\n          <div className=\"card-detail\">\n            {derivedMetrics.tickets.signed} signed, {derivedMetrics.tickets.pending} pending\n          </div>\n        </div>\n\n        <div className=\"summary-card disposal-card\">\n          <div className=\"card-icon\">\n            <Truck size={24} />\n          </div>\n          <div className=\"card-content\">\n            <span className=\"card-value\">{derivedMetrics.disposal.totalLoads}</span>\n            <span className=\"card-label\">Disposal Loads</span>\n          </div>\n          <div className=\"card-detail\">\n            {derivedMetrics.disposal.totalTonnage.toFixed(1)} tons\n          </div>\n        </div>\n      </div>\n\n      {/* Charts Section */}\n      <div className=\"charts-grid\">\n        {/* Progress Pie Chart */}\n        <div className=\"chart-card\">\n          <h3>Area Progress</h3>\n          {progressPieData.length > 0 ? (\n            <ResponsiveContainer width=\"100%\" height={200}>\n              <PieChart>\n                <Pie\n                  data={progressPieData}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  innerRadius={50}\n                  outerRadius={80}\n                  paddingAngle={2}\n                  dataKey=\"value\"\n                  label={({ name, value }) => `${name}: ${value}`}\n                  labelLine={false}\n                >\n                  {progressPieData.map((entry, index) => (\n                    <Cell key={`cell-${index}`} fill={PIE_COLORS[index % PIE_COLORS.length]} />\n                  ))}\n                </Pie>\n                <Tooltip />\n              </PieChart>\n            </ResponsiveContainer>\n          ) : (\n            <div className=\"no-data\">No area data</div>\n          )}\n        </div>\n\n        {/* Crew Trend Chart */}\n        <div className=\"chart-card\">\n          <h3>Daily Crew Size</h3>\n          <ResponsiveContainer width=\"100%\" height={200}>\n            <BarChart data={derivedMetrics.crew.history}>\n              <CartesianGrid strokeDasharray=\"3 3\" opacity={0.3} />\n              <XAxis dataKey=\"dayName\" tick={{ fontSize: 12 }} />\n              <YAxis tick={{ fontSize: 12 }} />\n              <Tooltip\n                formatter={(value) => [value, 'Workers']}\n                labelFormatter={(label) => `Day: ${label}`}\n              />\n              <Bar dataKey=\"count\" fill={COLORS.primary} radius={[4, 4, 0, 0]} />\n            </BarChart>\n          </ResponsiveContainer>\n        </div>\n\n        {/* T&M Tickets Over Time */}\n        <div className=\"chart-card\">\n          <h3>T&M Tickets by Day</h3>\n          <ResponsiveContainer width=\"100%\" height={200}>\n            <LineChart data={ticketsByDay}>\n              <CartesianGrid strokeDasharray=\"3 3\" opacity={0.3} />\n              <XAxis dataKey=\"dayName\" tick={{ fontSize: 12 }} />\n              <YAxis tick={{ fontSize: 12 }} />\n              <Tooltip\n                formatter={(value) => [value, 'Tickets']}\n              />\n              <Line\n                type=\"monotone\"\n                dataKey=\"tickets\"\n                stroke={COLORS.success}\n                strokeWidth={2}\n                dot={{ fill: COLORS.success, strokeWidth: 2 }}\n              />\n            </LineChart>\n          </ResponsiveContainer>\n        </div>\n\n        {/* Activity Summary */}\n        <div className=\"chart-card activity-card\">\n          <h3>Activity Summary</h3>\n          <div className=\"activity-list\">\n            <div className=\"activity-item\">\n              <div className=\"activity-icon\" style={{ backgroundColor: `${COLORS.success}20`, color: COLORS.success }}>\n                <CheckCircle2 size={20} />\n              </div>\n              <div className=\"activity-info\">\n                <span className=\"activity-label\">Days with Crew</span>\n                <span className=\"activity-value\">{derivedMetrics.crew.daysWithCrew} of {timeRange === 'week' ? 7 : 30}</span>\n              </div>\n            </div>\n            <div className=\"activity-item\">\n              <div className=\"activity-icon\" style={{ backgroundColor: `${COLORS.primary}20`, color: COLORS.primary }}>\n                <Calendar size={20} />\n              </div>\n              <div className=\"activity-info\">\n                <span className=\"activity-label\">Reports Submitted</span>\n                <span className=\"activity-value\">{derivedMetrics.reports.submitted}</span>\n              </div>\n            </div>\n            <div className=\"activity-item\">\n              <div className=\"activity-icon\" style={{ backgroundColor: `${COLORS.warning}20`, color: COLORS.warning }}>\n                <Clock size={20} />\n              </div>\n              <div className=\"activity-info\">\n                <span className=\"activity-label\">Report Streak</span>\n                <span className=\"activity-value\">{derivedMetrics.reports.streak} days</span>\n              </div>\n            </div>\n            {derivedMetrics.tickets.totalValue > 0 && (\n              <div className=\"activity-item\">\n                <div className=\"activity-icon\" style={{ backgroundColor: `${COLORS.purple}20`, color: COLORS.purple }}>\n                  <DollarSign size={20} />\n                </div>\n                <div className=\"activity-info\">\n                  <span className=\"activity-label\">T&M Value</span>\n                  <span className=\"activity-value\">${derivedMetrics.tickets.totalValue.toLocaleString()}</span>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <style>{`\n        .foreman-metrics {\n          padding: 1rem;\n          max-width: 100%;\n          overflow-x: hidden;\n        }\n\n        .foreman-metrics.loading {\n          min-height: 400px;\n        }\n\n        .loading-state {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          padding: 3rem;\n          color: var(--text-secondary);\n        }\n\n        .metrics-header {\n          display: flex;\n          align-items: center;\n          gap: 1rem;\n          margin-bottom: 1.5rem;\n          flex-wrap: wrap;\n        }\n\n        .metrics-header h2 {\n          flex: 1;\n          margin: 0;\n          font-size: 1.25rem;\n          color: var(--text-primary);\n        }\n\n        .back-btn {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          padding: 0.5rem 1rem;\n          background: var(--bg-elevated);\n          border: 1px solid var(--border-color);\n          border-radius: 8px;\n          color: var(--text-primary);\n          cursor: pointer;\n          font-size: 0.875rem;\n        }\n\n        .back-btn:hover {\n          background: var(--bg-tertiary);\n        }\n\n        .time-toggle {\n          display: flex;\n          background: var(--bg-elevated);\n          border-radius: 8px;\n          padding: 4px;\n          gap: 4px;\n        }\n\n        .time-toggle button {\n          padding: 0.5rem 1rem;\n          border: none;\n          background: transparent;\n          border-radius: 6px;\n          color: var(--text-secondary);\n          cursor: pointer;\n          font-size: 0.875rem;\n          transition: all 0.2s;\n        }\n\n        .time-toggle button.active {\n          background: var(--primary-color, #3b82f6);\n          color: white;\n        }\n\n        .summary-cards {\n          display: grid;\n          grid-template-columns: repeat(2, 1fr);\n          gap: 1rem;\n          margin-bottom: 1.5rem;\n        }\n\n        @media (min-width: 640px) {\n          .summary-cards {\n            grid-template-columns: repeat(4, 1fr);\n          }\n        }\n\n        .summary-card {\n          background: var(--bg-card);\n          border: 1px solid var(--border-color);\n          border-radius: 12px;\n          padding: 1rem;\n          display: flex;\n          flex-direction: column;\n          gap: 0.5rem;\n        }\n\n        .card-icon {\n          width: 40px;\n          height: 40px;\n          border-radius: 10px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n\n        .progress-card .card-icon {\n          background: #dbeafe;\n          color: #3b82f6;\n        }\n\n        .crew-card .card-icon {\n          background: #dcfce7;\n          color: #22c55e;\n        }\n\n        .tickets-card .card-icon {\n          background: #fef3c7;\n          color: #f59e0b;\n        }\n\n        .disposal-card .card-icon {\n          background: #f3e8ff;\n          color: #8b5cf6;\n        }\n\n        [data-theme=\"dark\"] .progress-card .card-icon {\n          background: #1e3a5f;\n        }\n\n        [data-theme=\"dark\"] .crew-card .card-icon {\n          background: #14532d;\n        }\n\n        [data-theme=\"dark\"] .tickets-card .card-icon {\n          background: #451a03;\n        }\n\n        [data-theme=\"dark\"] .disposal-card .card-icon {\n          background: #3b0764;\n        }\n\n        .card-content {\n          display: flex;\n          flex-direction: column;\n        }\n\n        .card-value {\n          font-size: 1.5rem;\n          font-weight: 700;\n          color: var(--text-primary);\n          line-height: 1.2;\n        }\n\n        .card-label {\n          font-size: 0.75rem;\n          color: var(--text-secondary);\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n        }\n\n        .card-detail {\n          font-size: 0.75rem;\n          color: var(--text-secondary);\n          margin-top: auto;\n        }\n\n        .charts-grid {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 1rem;\n        }\n\n        @media (min-width: 640px) {\n          .charts-grid {\n            grid-template-columns: repeat(2, 1fr);\n          }\n        }\n\n        .chart-card {\n          background: var(--bg-card);\n          border: 1px solid var(--border-color);\n          border-radius: 12px;\n          padding: 1rem;\n        }\n\n        .chart-card h3 {\n          margin: 0 0 1rem 0;\n          font-size: 0.875rem;\n          font-weight: 600;\n          color: var(--text-primary);\n        }\n\n        .no-data {\n          height: 200px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: var(--text-secondary);\n          font-size: 0.875rem;\n        }\n\n        .activity-card {\n          grid-column: 1 / -1;\n        }\n\n        @media (min-width: 640px) {\n          .activity-card {\n            grid-column: auto;\n          }\n        }\n\n        .activity-list {\n          display: flex;\n          flex-direction: column;\n          gap: 0.75rem;\n        }\n\n        .activity-item {\n          display: flex;\n          align-items: center;\n          gap: 0.75rem;\n        }\n\n        .activity-icon {\n          width: 40px;\n          height: 40px;\n          border-radius: 10px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          flex-shrink: 0;\n        }\n\n        .activity-info {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n        }\n\n        .activity-label {\n          font-size: 0.75rem;\n          color: var(--text-secondary);\n        }\n\n        .activity-value {\n          font-size: 1rem;\n          font-weight: 600;\n          color: var(--text-primary);\n        }\n\n        /* Recharts customization */\n        .recharts-cartesian-grid-horizontal line,\n        .recharts-cartesian-grid-vertical line {\n          stroke: var(--border-color);\n        }\n\n        .recharts-text {\n          fill: var(--text-secondary);\n        }\n\n        .recharts-tooltip-wrapper {\n          outline: none;\n        }\n\n        .recharts-default-tooltip {\n          background: var(--bg-card) !important;\n          border: 1px solid var(--border-color) !important;\n          border-radius: 8px !important;\n        }\n\n        .recharts-tooltip-label {\n          color: var(--text-primary) !important;\n        }\n\n        .recharts-tooltip-item {\n          color: var(--text-secondary) !important;\n        }\n      `}</style>\n    </div>\n  )\n}\n","import { useState, useEffect, useCallback, useMemo } from 'react'\nimport {\n  Users, FileText, ClipboardList, CheckSquare, Truck,\n  FolderOpen, AlertTriangle, BarChart2, ChevronDown, ChevronUp,\n  Pin, PinOff, Settings, TrendingUp, Clock, CheckCircle2, ClipboardCheck\n} from 'lucide-react'\n\n/**\n * ForemanLanding - Mobile-first landing page for foremen\n *\n * Features:\n * - Metrics snapshot (tappable for full view)\n * - Pinnable action cards\n * - Collapsible \"More Actions\" section\n * - Zero training required UX\n */\n\n// All available actions with their config\nconst ALL_ACTIONS = {\n  crew: {\n    id: 'crew',\n    label: 'Crew Check-in',\n    icon: Users,\n    description: 'Log who\\'s on site today'\n  },\n  tm: {\n    id: 'tm',\n    label: 'T&M Ticket',\n    icon: FileText,\n    description: 'Create time & materials ticket'\n  },\n  report: {\n    id: 'report',\n    label: 'Daily Report',\n    icon: ClipboardList,\n    description: 'Submit end-of-day report'\n  },\n  progress: {\n    id: 'progress',\n    label: 'Update Progress',\n    icon: CheckSquare,\n    description: 'Mark tasks complete'\n  },\n  disposal: {\n    id: 'disposal',\n    label: 'Disposal Loads',\n    icon: Truck,\n    description: 'Log haul-off loads'\n  },\n  docs: {\n    id: 'docs',\n    label: 'Documents',\n    icon: FolderOpen,\n    description: 'View project files'\n  },\n  metrics: {\n    id: 'metrics',\n    label: 'Project Metrics',\n    icon: BarChart2,\n    description: 'View charts & trends'\n  },\n  punchlist: {\n    id: 'punchlist',\n    label: 'Punch List',\n    icon: ClipboardCheck,\n    description: 'View & resolve punch items'\n  },\n  injury: {\n    id: 'injury',\n    label: 'Report Injury',\n    icon: AlertTriangle,\n    description: 'Log safety incident',\n    isDanger: true\n  }\n}\n\n// Default pinned actions (sensible defaults for new users)\nconst DEFAULT_PINNED = ['crew', 'tm', 'report', 'progress']\n\n// Storage key generator\nconst getPinStorageKey = (projectId) => `fm_pinned_${projectId}`\n\nexport default function ForemanLanding({\n  project,\n  todayStatus,\n  progress,\n  areasWorking,\n  areasDone,\n  areasRemaining,\n  punchListOpenCount,\n  onNavigate,\n  onShowToast\n}) {\n  // Pinned actions state\n  const [pinnedIds, setPinnedIds] = useState(() => {\n    try {\n      const stored = localStorage.getItem(getPinStorageKey(project?.id))\n      return stored ? JSON.parse(stored) : DEFAULT_PINNED\n    } catch {\n      return DEFAULT_PINNED\n    }\n  })\n\n  // Edit mode for customizing pins\n  const [isEditMode, setIsEditMode] = useState(false)\n\n  // More actions collapsed state\n  const [moreCollapsed, setMoreCollapsed] = useState(true)\n\n  // Save pinned actions to localStorage\n  useEffect(() => {\n    if (project?.id) {\n      try {\n        localStorage.setItem(getPinStorageKey(project.id), JSON.stringify(pinnedIds))\n      } catch {\n        // Storage unavailable\n      }\n    }\n  }, [pinnedIds, project?.id])\n\n  // Toggle pin status\n  const togglePin = useCallback((actionId) => {\n    setPinnedIds(prev => {\n      if (prev.includes(actionId)) {\n        // Don't allow unpinning if only one left\n        if (prev.length <= 1) {\n          onShowToast?.('Keep at least one pinned action', 'info')\n          return prev\n        }\n        return prev.filter(id => id !== actionId)\n      } else {\n        // Max 5 pinned\n        if (prev.length >= 5) {\n          onShowToast?.('Maximum 5 pinned actions', 'info')\n          return prev\n        }\n        return [...prev, actionId]\n      }\n    })\n  }, [onShowToast])\n\n  // Get unpinned actions (for \"More Actions\" section)\n  const unpinnedActions = useMemo(() => {\n    return Object.keys(ALL_ACTIONS).filter(id => !pinnedIds.includes(id))\n  }, [pinnedIds])\n\n  // Get status info for an action\n  const getActionStatus = useCallback((actionId) => {\n    switch (actionId) {\n      case 'crew':\n        return {\n          done: todayStatus.crewCheckedIn,\n          badge: todayStatus.crewCheckedIn ? `${todayStatus.crewCount} on site` : null,\n          status: todayStatus.crewCheckedIn ? 'Done today' : 'Not started'\n        }\n      case 'tm':\n        return {\n          done: false,\n          badge: todayStatus.tmTicketsToday > 0 ? `${todayStatus.tmTicketsToday} today` : null,\n          status: todayStatus.tmTicketsToday > 0 ? `${todayStatus.tmTicketsToday} created` : 'Create new'\n        }\n      case 'report':\n        return {\n          done: todayStatus.dailyReportDone,\n          badge: null,\n          status: todayStatus.dailyReportDone ? 'Submitted' : 'Not submitted'\n        }\n      case 'progress':\n        return {\n          done: areasRemaining === 0,\n          badge: areasRemaining > 0 ? `${areasRemaining} left` : null,\n          status: `${progress}% complete`\n        }\n      case 'disposal':\n        return {\n          done: false,\n          badge: todayStatus.disposalLoadsToday > 0 ? `${todayStatus.disposalLoadsToday} today` : null,\n          status: todayStatus.disposalLoadsToday > 0 ? `${todayStatus.disposalLoadsToday} logged` : 'Log loads'\n        }\n      case 'punchlist':\n        return {\n          done: punchListOpenCount === 0 && punchListOpenCount !== undefined,\n          badge: punchListOpenCount > 0 ? `${punchListOpenCount} open` : null,\n          status: punchListOpenCount > 0 ? `${punchListOpenCount} items open` : 'All clear'\n        }\n      default:\n        return { done: false, badge: null, status: null }\n    }\n  }, [todayStatus, progress, areasRemaining])\n\n  // Render a pinned action card\n  const renderPinnedAction = (actionId) => {\n    const action = ALL_ACTIONS[actionId]\n    if (!action) return null\n\n    const Icon = action.icon\n    const status = getActionStatus(actionId)\n\n    return (\n      <div key={actionId} className=\"fm-pinned-card-wrapper\">\n        <button\n          className={`fm-pinned-card ${status.done ? 'completed' : ''} ${action.isDanger ? 'danger' : ''}`}\n          onClick={() => !isEditMode && onNavigate(actionId)}\n          disabled={isEditMode}\n        >\n          <div className=\"fm-pinned-icon\">\n            <Icon size={28} />\n          </div>\n          <span className=\"fm-pinned-label\">{action.label}</span>\n          {status.badge && !isEditMode && (\n            <span className=\"fm-pinned-badge\">{status.badge}</span>\n          )}\n          {status.done && !isEditMode && (\n            <div className=\"fm-pinned-check\">\n              <CheckCircle2 size={18} />\n            </div>\n          )}\n        </button>\n        {isEditMode && (\n          <button\n            className=\"fm-pin-toggle pinned\"\n            onClick={() => togglePin(actionId)}\n            aria-label={`Unpin ${action.label}`}\n          >\n            <PinOff size={16} />\n          </button>\n        )}\n      </div>\n    )\n  }\n\n  // Render an unpinned action row\n  const renderUnpinnedAction = (actionId) => {\n    const action = ALL_ACTIONS[actionId]\n    if (!action) return null\n\n    const Icon = action.icon\n    const status = getActionStatus(actionId)\n\n    return (\n      <div key={actionId} className=\"fm-action-row-wrapper\">\n        <button\n          className={`fm-action-row ${action.isDanger ? 'danger' : ''}`}\n          onClick={() => !isEditMode && onNavigate(actionId)}\n          disabled={isEditMode}\n        >\n          <Icon size={20} />\n          <span className=\"fm-action-label\">{action.label}</span>\n          {status.badge && !isEditMode && (\n            <span className=\"fm-action-badge\">{status.badge}</span>\n          )}\n        </button>\n        {isEditMode && (\n          <button\n            className=\"fm-pin-toggle\"\n            onClick={() => togglePin(actionId)}\n            aria-label={`Pin ${action.label}`}\n          >\n            <Pin size={16} />\n          </button>\n        )}\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"fm-landing\">\n      {/* Metrics Snapshot - Tappable */}\n      <button\n        className=\"fm-metrics-snapshot\"\n        onClick={() => onNavigate('metrics')}\n        aria-label=\"View full project metrics\"\n      >\n        <div className=\"fm-snapshot-header\">\n          <TrendingUp size={18} />\n          <span>Project Overview</span>\n          <ChevronDown size={16} className=\"fm-snapshot-arrow\" />\n        </div>\n        <div className=\"fm-snapshot-stats\">\n          <div className=\"fm-snapshot-stat main\">\n            <span className=\"fm-snapshot-value\">{progress}%</span>\n            <span className=\"fm-snapshot-label\">Complete</span>\n          </div>\n          <div className=\"fm-snapshot-divider\" />\n          <div className=\"fm-snapshot-stat\">\n            <span className=\"fm-snapshot-value\">{areasWorking}</span>\n            <span className=\"fm-snapshot-label\">In Progress</span>\n          </div>\n          <div className=\"fm-snapshot-stat\">\n            <span className=\"fm-snapshot-value\">{areasDone}</span>\n            <span className=\"fm-snapshot-label\">Done</span>\n          </div>\n          <div className=\"fm-snapshot-stat\">\n            <span className=\"fm-snapshot-value\">{areasRemaining}</span>\n            <span className=\"fm-snapshot-label\">Remaining</span>\n          </div>\n        </div>\n        {todayStatus.crewCheckedIn && (\n          <div className=\"fm-snapshot-today\">\n            <Clock size={14} />\n            <span>{todayStatus.crewCount} crew on site today</span>\n          </div>\n        )}\n      </button>\n\n      {/* Pinned Actions Header */}\n      <div className=\"fm-section-header\">\n        <h2>Quick Actions</h2>\n        <button\n          className={`fm-edit-btn ${isEditMode ? 'active' : ''}`}\n          onClick={() => setIsEditMode(!isEditMode)}\n          aria-label={isEditMode ? 'Done editing' : 'Customize actions'}\n        >\n          {isEditMode ? 'Done' : <Settings size={18} />}\n        </button>\n      </div>\n\n      {isEditMode && (\n        <p className=\"fm-edit-hint\">Tap icons to pin/unpin actions</p>\n      )}\n\n      {/* Pinned Actions Grid */}\n      <div className=\"fm-pinned-grid\">\n        {pinnedIds.map(renderPinnedAction)}\n      </div>\n\n      {/* More Actions Section */}\n      {unpinnedActions.length > 0 && (\n        <div className=\"fm-more-section\">\n          <button\n            className=\"fm-more-header\"\n            onClick={() => setMoreCollapsed(!moreCollapsed)}\n            aria-expanded={!moreCollapsed}\n          >\n            <span>More Actions</span>\n            {moreCollapsed ? <ChevronDown size={20} /> : <ChevronUp size={20} />}\n          </button>\n\n          {!moreCollapsed && (\n            <div className=\"fm-more-content\">\n              {unpinnedActions.map(renderUnpinnedAction)}\n            </div>\n          )}\n        </div>\n      )}\n\n      <style>{`\n        .fm-landing {\n          padding: 0 1rem 2rem;\n        }\n\n        /* Metrics Snapshot */\n        .fm-metrics-snapshot {\n          width: 100%;\n          background: linear-gradient(135deg, var(--primary-color, #3b82f6) 0%, #2563eb 100%);\n          border: none;\n          border-radius: 16px;\n          padding: 1rem;\n          color: white;\n          text-align: left;\n          cursor: pointer;\n          margin-bottom: 1.5rem;\n          transition: transform 0.15s ease, box-shadow 0.15s ease;\n        }\n\n        .fm-metrics-snapshot:active {\n          transform: scale(0.98);\n        }\n\n        .fm-snapshot-header {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          font-size: 0.875rem;\n          opacity: 0.9;\n          margin-bottom: 0.75rem;\n        }\n\n        .fm-snapshot-arrow {\n          margin-left: auto;\n          opacity: 0.7;\n        }\n\n        .fm-snapshot-stats {\n          display: flex;\n          align-items: center;\n          gap: 0.75rem;\n        }\n\n        .fm-snapshot-stat {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          flex: 1;\n        }\n\n        .fm-snapshot-stat.main {\n          flex: 1.5;\n          align-items: flex-start;\n        }\n\n        .fm-snapshot-value {\n          font-size: 1.5rem;\n          font-weight: 700;\n          line-height: 1.2;\n        }\n\n        .fm-snapshot-stat.main .fm-snapshot-value {\n          font-size: 2rem;\n        }\n\n        .fm-snapshot-label {\n          font-size: 0.7rem;\n          opacity: 0.85;\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n        }\n\n        .fm-snapshot-divider {\n          width: 1px;\n          height: 40px;\n          background: rgba(255,255,255,0.3);\n        }\n\n        .fm-snapshot-today {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          margin-top: 0.75rem;\n          padding-top: 0.75rem;\n          border-top: 1px solid rgba(255,255,255,0.2);\n          font-size: 0.8rem;\n          opacity: 0.9;\n        }\n\n        /* Section Header */\n        .fm-section-header {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          margin-bottom: 0.75rem;\n        }\n\n        .fm-section-header h2 {\n          font-size: 1rem;\n          font-weight: 600;\n          color: var(--text-primary);\n          margin: 0;\n        }\n\n        .fm-edit-btn {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          padding: 0.5rem;\n          background: var(--bg-elevated);\n          border: 1px solid var(--border-color);\n          border-radius: 8px;\n          color: var(--text-secondary);\n          cursor: pointer;\n          font-size: 0.8rem;\n          min-width: 36px;\n          min-height: 36px;\n          transition: all 0.15s ease;\n        }\n\n        .fm-edit-btn.active {\n          background: var(--primary-color, #3b82f6);\n          border-color: var(--primary-color, #3b82f6);\n          color: white;\n          padding: 0.5rem 1rem;\n        }\n\n        .fm-edit-hint {\n          font-size: 0.8rem;\n          color: var(--text-secondary);\n          margin: 0 0 0.75rem;\n          text-align: center;\n        }\n\n        /* Pinned Actions Grid */\n        .fm-pinned-grid {\n          display: grid;\n          grid-template-columns: repeat(2, 1fr);\n          gap: 0.75rem;\n          margin-bottom: 1.5rem;\n        }\n\n        .fm-pinned-card-wrapper {\n          position: relative;\n        }\n\n        .fm-pinned-card {\n          width: 100%;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          padding: 1.25rem 1rem;\n          background: var(--bg-card);\n          border: 1px solid var(--border-color);\n          border-radius: 12px;\n          cursor: pointer;\n          transition: all 0.15s ease;\n          min-height: 110px;\n          position: relative;\n        }\n\n        .fm-pinned-card:active:not(:disabled) {\n          transform: scale(0.97);\n          background: var(--bg-elevated);\n        }\n\n        .fm-pinned-card:disabled {\n          opacity: 0.7;\n          cursor: default;\n        }\n\n        .fm-pinned-card.completed {\n          border-color: #22c55e;\n          background: rgba(34, 197, 94, 0.08);\n        }\n\n        .fm-pinned-card.danger {\n          border-color: #f59e0b;\n        }\n\n        .fm-pinned-card.danger .fm-pinned-icon {\n          color: #f59e0b;\n        }\n\n        .fm-pinned-icon {\n          color: var(--primary-color, #3b82f6);\n          margin-bottom: 0.5rem;\n        }\n\n        .fm-pinned-label {\n          font-size: 0.875rem;\n          font-weight: 500;\n          color: var(--text-primary);\n          text-align: center;\n        }\n\n        .fm-pinned-badge {\n          position: absolute;\n          top: 8px;\n          right: 8px;\n          background: var(--primary-color, #3b82f6);\n          color: white;\n          font-size: 0.7rem;\n          font-weight: 600;\n          padding: 0.2rem 0.5rem;\n          border-radius: 10px;\n        }\n\n        .fm-pinned-check {\n          position: absolute;\n          top: 8px;\n          right: 8px;\n          color: #22c55e;\n        }\n\n        .fm-pin-toggle {\n          position: absolute;\n          top: -8px;\n          right: -8px;\n          width: 28px;\n          height: 28px;\n          border-radius: 50%;\n          background: var(--bg-card);\n          border: 2px solid var(--border-color);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          cursor: pointer;\n          color: var(--text-secondary);\n          transition: all 0.15s ease;\n          z-index: 10;\n        }\n\n        .fm-pin-toggle:hover {\n          background: var(--bg-elevated);\n        }\n\n        .fm-pin-toggle.pinned {\n          background: #ef4444;\n          border-color: #ef4444;\n          color: white;\n        }\n\n        /* More Actions Section */\n        .fm-more-section {\n          background: var(--bg-card);\n          border: 1px solid var(--border-color);\n          border-radius: 12px;\n          overflow: hidden;\n        }\n\n        .fm-more-header {\n          width: 100%;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 1rem;\n          background: transparent;\n          border: none;\n          cursor: pointer;\n          font-size: 0.9rem;\n          font-weight: 500;\n          color: var(--text-primary);\n        }\n\n        .fm-more-header:active {\n          background: var(--bg-elevated);\n        }\n\n        .fm-more-content {\n          border-top: 1px solid var(--border-color);\n        }\n\n        .fm-action-row-wrapper {\n          position: relative;\n          display: flex;\n          align-items: center;\n        }\n\n        .fm-action-row-wrapper .fm-pin-toggle {\n          position: static;\n          margin-right: 0.75rem;\n          flex-shrink: 0;\n        }\n\n        .fm-action-row {\n          flex: 1;\n          display: flex;\n          align-items: center;\n          gap: 0.75rem;\n          padding: 1rem;\n          background: transparent;\n          border: none;\n          border-bottom: 1px solid var(--border-color);\n          cursor: pointer;\n          text-align: left;\n          color: var(--text-primary);\n          transition: background 0.15s ease;\n        }\n\n        .fm-action-row:last-child {\n          border-bottom: none;\n        }\n\n        .fm-action-row:active:not(:disabled) {\n          background: var(--bg-elevated);\n        }\n\n        .fm-action-row:disabled {\n          opacity: 0.7;\n          cursor: default;\n        }\n\n        .fm-action-row.danger {\n          color: #f59e0b;\n        }\n\n        .fm-action-label {\n          flex: 1;\n          font-size: 0.9rem;\n        }\n\n        .fm-action-badge {\n          font-size: 0.75rem;\n          color: var(--text-secondary);\n          background: var(--bg-elevated);\n          padding: 0.25rem 0.5rem;\n          border-radius: 6px;\n        }\n\n        /* Dark mode adjustments */\n        [data-theme=\"dark\"] .fm-metrics-snapshot {\n          background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);\n        }\n\n        [data-theme=\"dark\"] .fm-pinned-card.completed {\n          background: rgba(34, 197, 94, 0.15);\n        }\n      `}</style>\n    </div>\n  )\n}\n","import { useState, useEffect, useCallback, useMemo } from 'react'\nimport { CheckCircle2, Circle, Clock, Plus, X, MapPin, User, Filter, Trash2, Edit3, Save } from 'lucide-react'\nimport { supabase, isSupabaseConfigured } from '../lib/supabase'\n\nconst PRIORITY_OPTIONS = [\n  { value: 'high', label: 'High', color: '#ef4444' },\n  { value: 'medium', label: 'Medium', color: '#f59e0b' },\n  { value: 'low', label: 'Low', color: '#6b7280' }\n]\n\nconst STATUS_OPTIONS = [\n  { value: 'open', label: 'Open', icon: Circle, color: '#ef4444' },\n  { value: 'in_progress', label: 'In Progress', icon: Clock, color: '#f59e0b' },\n  { value: 'complete', label: 'Complete', icon: CheckCircle2, color: '#10b981' }\n]\n\n/**\n * PunchList - Tracks deficiency items that need resolution before project closeout.\n * Items are linked to work areas and can include photos, assignees, and priorities.\n */\nexport default function PunchList({ projectId, areas = [], companyId, onShowToast }) {\n  const [items, setItems] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [showForm, setShowForm] = useState(false)\n  const [editingItem, setEditingItem] = useState(null)\n  const [filterStatus, setFilterStatus] = useState('all')\n  const [filterArea, setFilterArea] = useState('all')\n  const [saving, setSaving] = useState(false)\n  const [formData, setFormData] = useState({\n    description: '',\n    area_id: '',\n    assigned_to: '',\n    priority: 'medium',\n    notes: '',\n    photo_url: ''\n  })\n\n  const loadItems = useCallback(async () => {\n    if (!projectId || !isSupabaseConfigured) {\n      setLoading(false)\n      return\n    }\n\n    try {\n      const { data, error } = await supabase\n        .from('punch_list_items')\n        .select('*')\n        .eq('project_id', projectId)\n        .order('created_at', { ascending: false })\n\n      if (error) throw error\n      setItems(data || [])\n    } catch (err) {\n      console.error('Error loading punch list:', err)\n      // Table might not exist yet - that's OK\n      setItems([])\n    } finally {\n      setLoading(false)\n    }\n  }, [projectId])\n\n  useEffect(() => {\n    loadItems()\n  }, [loadItems])\n\n  // Subscribe to real-time updates\n  useEffect(() => {\n    if (!projectId || !isSupabaseConfigured) return\n\n    const channel = supabase\n      .channel(`punch_list:${projectId}`)\n      .on('postgres_changes',\n        { event: '*', schema: 'public', table: 'punch_list_items', filter: `project_id=eq.${projectId}` },\n        () => loadItems()\n      )\n      .subscribe()\n\n    return () => { supabase.removeChannel(channel) }\n  }, [projectId, loadItems])\n\n  const filteredItems = useMemo(() => {\n    return items.filter(item => {\n      if (filterStatus !== 'all' && item.status !== filterStatus) return false\n      if (filterArea !== 'all' && item.area_id !== filterArea) return false\n      return true\n    })\n  }, [items, filterStatus, filterArea])\n\n  const stats = useMemo(() => {\n    const open = items.filter(i => i.status === 'open').length\n    const inProgress = items.filter(i => i.status === 'in_progress').length\n    const complete = items.filter(i => i.status === 'complete').length\n    return { open, inProgress, complete, total: items.length }\n  }, [items])\n\n  const resetForm = () => {\n    setFormData({ description: '', area_id: '', assigned_to: '', priority: 'medium', notes: '', photo_url: '' })\n    setEditingItem(null)\n    setShowForm(false)\n  }\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n\n    if (!formData.description.trim()) {\n      onShowToast?.('Please enter a description', 'error')\n      return\n    }\n\n    setSaving(true)\n    try {\n      if (editingItem) {\n        const { error } = await supabase\n          .from('punch_list_items')\n          .update({\n            description: formData.description.trim(),\n            area_id: formData.area_id || null,\n            assigned_to: formData.assigned_to.trim() || null,\n            priority: formData.priority,\n            notes: formData.notes.trim() || null,\n            photo_url: formData.photo_url || null,\n            updated_at: new Date().toISOString()\n          })\n          .eq('id', editingItem.id)\n\n        if (error) throw error\n        onShowToast?.('Punch item updated', 'success')\n      } else {\n        const { error } = await supabase\n          .from('punch_list_items')\n          .insert({\n            project_id: projectId,\n            company_id: companyId,\n            description: formData.description.trim(),\n            area_id: formData.area_id || null,\n            assigned_to: formData.assigned_to.trim() || null,\n            priority: formData.priority,\n            notes: formData.notes.trim() || null,\n            photo_url: formData.photo_url || null,\n            status: 'open'\n          })\n\n        if (error) throw error\n        onShowToast?.('Punch item added', 'success')\n      }\n\n      resetForm()\n      loadItems()\n    } catch (err) {\n      console.error('Error saving punch item:', err)\n      onShowToast?.(err.message || 'Error saving item', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleStatusChange = async (itemId, newStatus) => {\n    try {\n      const updates = {\n        status: newStatus,\n        updated_at: new Date().toISOString()\n      }\n      if (newStatus === 'complete') {\n        updates.completed_at = new Date().toISOString()\n      } else {\n        updates.completed_at = null\n      }\n\n      const { error } = await supabase\n        .from('punch_list_items')\n        .update(updates)\n        .eq('id', itemId)\n\n      if (error) throw error\n      loadItems()\n    } catch (err) {\n      console.error('Error updating status:', err)\n      onShowToast?.('Error updating status', 'error')\n    }\n  }\n\n  const handleDelete = async (itemId) => {\n    if (!confirm('Delete this punch item?')) return\n\n    try {\n      const { error } = await supabase\n        .from('punch_list_items')\n        .delete()\n        .eq('id', itemId)\n\n      if (error) throw error\n      onShowToast?.('Item deleted', 'success')\n      loadItems()\n    } catch (err) {\n      console.error('Error deleting item:', err)\n      onShowToast?.('Error deleting item', 'error')\n    }\n  }\n\n  const handleEdit = (item) => {\n    setFormData({\n      description: item.description,\n      area_id: item.area_id || '',\n      assigned_to: item.assigned_to || '',\n      priority: item.priority || 'medium',\n      notes: item.notes || '',\n      photo_url: item.photo_url || ''\n    })\n    setEditingItem(item)\n    setShowForm(true)\n  }\n\n  const getAreaName = (areaId) => {\n    if (!areaId) return null\n    const area = areas.find(a => a.id === areaId)\n    return area?.name || null\n  }\n\n  const getPriorityConfig = (priority) =>\n    PRIORITY_OPTIONS.find(p => p.value === priority) || PRIORITY_OPTIONS[1]\n\n  const getStatusConfig = (status) =>\n    STATUS_OPTIONS.find(s => s.value === status) || STATUS_OPTIONS[0]\n\n  return (\n    <div className=\"punch-list-card\">\n      {/* Header */}\n      <div className=\"punch-list-header\">\n        <div className=\"punch-list-title\">\n          <CheckCircle2 size={18} />\n          <h3>Punch List</h3>\n          {stats.total > 0 && (\n            <span className=\"punch-stats-inline\">\n              <span className=\"punch-stat-open\">{stats.open} open</span>\n              {stats.inProgress > 0 && <span className=\"punch-stat-progress\">{stats.inProgress} in progress</span>}\n              <span className=\"punch-stat-complete\">{stats.complete}/{stats.total} complete</span>\n            </span>\n          )}\n        </div>\n        <button className=\"punch-add-btn\" onClick={() => { resetForm(); setShowForm(true) }}>\n          <Plus size={16} />\n          Add Item\n        </button>\n      </div>\n\n      {/* Progress bar */}\n      {stats.total > 0 && (\n        <div className=\"punch-progress-bar\">\n          <div\n            className=\"punch-progress-fill\"\n            style={{ width: `${(stats.complete / stats.total) * 100}%` }}\n          />\n          <span className=\"punch-progress-label\">\n            {Math.round((stats.complete / stats.total) * 100)}% complete\n          </span>\n        </div>\n      )}\n\n      {/* Filters */}\n      {stats.total > 0 && (\n        <div className=\"punch-filters\">\n          <div className=\"punch-filter-group\">\n            <Filter size={14} />\n            <select value={filterStatus} onChange={e => setFilterStatus(e.target.value)} className=\"punch-filter-select\">\n              <option value=\"all\">All Status</option>\n              {STATUS_OPTIONS.map(s => (\n                <option key={s.value} value={s.value}>{s.label}</option>\n              ))}\n            </select>\n          </div>\n          {areas.length > 0 && (\n            <div className=\"punch-filter-group\">\n              <MapPin size={14} />\n              <select value={filterArea} onChange={e => setFilterArea(e.target.value)} className=\"punch-filter-select\">\n                <option value=\"all\">All Areas</option>\n                {areas.map(a => (\n                  <option key={a.id} value={a.id}>{a.name}</option>\n                ))}\n              </select>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Add/Edit Form */}\n      {showForm && (\n        <form className=\"punch-form\" onSubmit={handleSubmit}>\n          <div className=\"punch-form-header\">\n            <h4>{editingItem ? 'Edit Item' : 'New Punch Item'}</h4>\n            <button type=\"button\" className=\"punch-form-close\" onClick={resetForm}>\n              <X size={16} />\n            </button>\n          </div>\n\n          <div className=\"punch-form-field\">\n            <label>Description *</label>\n            <textarea\n              value={formData.description}\n              onChange={e => setFormData(prev => ({ ...prev, description: e.target.value }))}\n              placeholder=\"What needs to be fixed or completed?\"\n              rows={2}\n              required\n            />\n          </div>\n\n          <div className=\"punch-form-row\">\n            <div className=\"punch-form-field\">\n              <label>Area</label>\n              <select\n                value={formData.area_id}\n                onChange={e => setFormData(prev => ({ ...prev, area_id: e.target.value }))}\n              >\n                <option value=\"\">No area</option>\n                {areas.map(a => (\n                  <option key={a.id} value={a.id}>{a.name}</option>\n                ))}\n              </select>\n            </div>\n\n            <div className=\"punch-form-field\">\n              <label>Assigned To</label>\n              <input\n                type=\"text\"\n                value={formData.assigned_to}\n                onChange={e => setFormData(prev => ({ ...prev, assigned_to: e.target.value }))}\n                placeholder=\"Name or company\"\n              />\n            </div>\n\n            <div className=\"punch-form-field\">\n              <label>Priority</label>\n              <select\n                value={formData.priority}\n                onChange={e => setFormData(prev => ({ ...prev, priority: e.target.value }))}\n              >\n                {PRIORITY_OPTIONS.map(p => (\n                  <option key={p.value} value={p.value}>{p.label}</option>\n                ))}\n              </select>\n            </div>\n          </div>\n\n          <div className=\"punch-form-field\">\n            <label>Notes</label>\n            <textarea\n              value={formData.notes}\n              onChange={e => setFormData(prev => ({ ...prev, notes: e.target.value }))}\n              placeholder=\"Additional details...\"\n              rows={2}\n            />\n          </div>\n\n          <div className=\"punch-form-actions\">\n            <button type=\"button\" className=\"punch-btn-cancel\" onClick={resetForm}>Cancel</button>\n            <button type=\"submit\" className=\"punch-btn-save\" disabled={saving}>\n              <Save size={14} />\n              {saving ? 'Saving...' : editingItem ? 'Update' : 'Add Item'}\n            </button>\n          </div>\n        </form>\n      )}\n\n      {/* Items List */}\n      {loading ? (\n        <div className=\"punch-loading\">Loading punch list...</div>\n      ) : filteredItems.length === 0 ? (\n        <div className=\"punch-empty\">\n          <CheckCircle2 size={32} style={{ opacity: 0.3 }} />\n          <p>{items.length === 0 ? 'No punch items yet' : 'No items match filters'}</p>\n          {items.length === 0 && <span>Add items that need attention before project closeout</span>}\n        </div>\n      ) : (\n        <div className=\"punch-items-list\">\n          {filteredItems.map(item => {\n            const statusConfig = getStatusConfig(item.status)\n            const priorityConfig = getPriorityConfig(item.priority)\n            const StatusIcon = statusConfig.icon\n\n            return (\n              <div key={item.id} className={`punch-item punch-item-${item.status}`}>\n                <button\n                  className=\"punch-item-status-btn\"\n                  onClick={() => {\n                    const nextStatus = item.status === 'open' ? 'in_progress' :\n                                       item.status === 'in_progress' ? 'complete' : 'open'\n                    handleStatusChange(item.id, nextStatus)\n                  }}\n                  title={`Click to change status (current: ${statusConfig.label})`}\n                >\n                  <StatusIcon size={18} style={{ color: statusConfig.color }} />\n                </button>\n\n                <div className=\"punch-item-content\">\n                  <div className=\"punch-item-top\">\n                    <span className={`punch-item-desc ${item.status === 'complete' ? 'completed' : ''}`}>\n                      {item.description}\n                    </span>\n                    <div className=\"punch-item-badges\">\n                      <span className=\"punch-priority-badge\" style={{ color: priorityConfig.color, borderColor: `${priorityConfig.color}40` }}>\n                        {priorityConfig.label}\n                      </span>\n                    </div>\n                  </div>\n\n                  <div className=\"punch-item-meta\">\n                    {getAreaName(item.area_id) && (\n                      <span className=\"punch-meta-tag\">\n                        <MapPin size={11} />\n                        {getAreaName(item.area_id)}\n                      </span>\n                    )}\n                    {item.assigned_to && (\n                      <span className=\"punch-meta-tag\">\n                        <User size={11} />\n                        {item.assigned_to}\n                      </span>\n                    )}\n                    {item.completed_at && (\n                      <span className=\"punch-meta-tag completed\">\n                        <CheckCircle2 size={11} />\n                        Done {new Date(item.completed_at).toLocaleDateString()}\n                      </span>\n                    )}\n                  </div>\n\n                  {item.notes && (\n                    <div className=\"punch-item-notes\">{item.notes}</div>\n                  )}\n                </div>\n\n                <div className=\"punch-item-actions\">\n                  <button className=\"punch-action-btn\" onClick={() => handleEdit(item)} title=\"Edit\">\n                    <Edit3 size={14} />\n                  </button>\n                  <button className=\"punch-action-btn delete\" onClick={() => handleDelete(item.id)} title=\"Delete\">\n                    <Trash2 size={14} />\n                  </button>\n                </div>\n              </div>\n            )\n          })}\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect, useCallback, useRef } from 'react'\nimport { db, supabase, isSupabaseConfigured } from '../lib/supabase'\nimport { calculateProgress } from '../lib/utils'\nimport {\n  Info, CheckSquare,\n  ArrowLeft, ChevronDown, ChevronRight,\n  Clock, CheckCircle2, Moon, Sun\n} from 'lucide-react'\nimport TMForm from './TMForm'\nimport CrewCheckin from './CrewCheckin'\nimport DailyReport from './DailyReport'\nimport InjuryReportForm from './InjuryReportForm'\nimport DisposalLoadInput from './DisposalLoadInput'\nimport FolderGrid from './documents/FolderGrid'\nimport ForemanMetrics from './ForemanMetrics'\nimport ForemanLanding from './ForemanLanding'\nimport PunchList from './PunchList'\n\nexport default function ForemanView({ project, companyId, foremanName, onShowToast, onExit }) {\n  const [areas, setAreas] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [updating, setUpdating] = useState(null)\n  const [expandedGroups, setExpandedGroups] = useState({})\n\n  // View states\n  const [activeView, setActiveView] = useState('home') // home, crew, tm, disposal, report, injury, docs, progress, punchlist\n  const [showProjectInfo, setShowProjectInfo] = useState(false)\n\n  // Punch list open count for badge\n  const [punchListOpenCount, setPunchListOpenCount] = useState(0)\n\n  // Today's activity status (for smart cards)\n  const [todayStatus, setTodayStatus] = useState({\n    crewCheckedIn: false,\n    crewCount: 0,\n    tmTicketsToday: 0,\n    dailyReportDone: false,\n    disposalLoadsToday: 0\n  })\n\n  // Theme\n  const [isDark, setIsDark] = useState(() => {\n    if (typeof window !== 'undefined') {\n      return document.documentElement.getAttribute('data-theme') === 'dark'\n    }\n    return false\n  })\n\n  // Get current hour for time-based UI\n  const currentHour = new Date().getHours()\n  const isMorning = currentHour >= 5 && currentHour < 12\n  const isAfternoon = currentHour >= 12 && currentHour < 17\n  const isEvening = currentHour >= 17 || currentHour < 5\n\n  useEffect(() => {\n    if (project?.id) {\n      loadAreas()\n      loadTodayStatus()\n      loadPunchListCount()\n    }\n  }, [project?.id])\n\n  // Load today's activity status\n  const loadTodayStatus = async () => {\n    try {\n      const today = new Date().toISOString().split('T')[0]\n\n      // Load crew check-in for today (returns single object with .workers array, or null)\n      const crew = await db.getCrewCheckin(project.id, today)\n      const crewWorkers = crew?.workers || []\n      const crewCheckedIn = crewWorkers.length > 0\n\n      // Load T&M tickets for today\n      const tickets = await db.getTMTickets?.(project.id) || []\n      const todayTickets = tickets.filter(t => t.work_date === today)\n\n      // Load disposal loads for today\n      const disposal = await db.getDisposalLoads?.(project.id, today) || []\n\n      setTodayStatus({\n        crewCheckedIn,\n        crewCount: crewWorkers.length,\n        tmTicketsToday: todayTickets.length,\n        dailyReportDone: false, // We'll track this separately\n        disposalLoadsToday: disposal.reduce((sum, d) => sum + (d.load_count || 1), 0)\n      })\n    } catch (error) {\n      console.error('Error loading today status:', error)\n    }\n  }\n\n  // Load open punch list item count for badge\n  const loadPunchListCount = async () => {\n    if (!project?.id || !isSupabaseConfigured) return\n    try {\n      const { count } = await supabase\n        .from('punch_list_items')\n        .select('*', { count: 'exact', head: true })\n        .eq('project_id', project.id)\n        .eq('status', 'open')\n      setPunchListOpenCount(count || 0)\n    } catch {\n      // Table may not exist yet\n    }\n  }\n\n  // Real-time subscriptions for live updates\n  const refreshTimeoutRef = useRef(null)\n\n  const debouncedRefresh = useCallback(() => {\n    if (refreshTimeoutRef.current) clearTimeout(refreshTimeoutRef.current)\n    refreshTimeoutRef.current = setTimeout(() => {\n      loadAreas()\n      loadTodayStatus()\n    }, 300)\n  }, [project?.id])\n\n  useEffect(() => {\n    if (!project?.id) return\n    const subs = []\n\n    const areaSub = db.subscribeToAreas?.(project.id, debouncedRefresh)\n    if (areaSub) subs.push(areaSub)\n\n    const crewSub = db.subscribeToCrewCheckins?.(project.id, debouncedRefresh)\n    if (crewSub) subs.push(crewSub)\n\n    const tmSub = db.subscribeToTMTickets?.(project.id, debouncedRefresh)\n    if (tmSub) subs.push(tmSub)\n\n    const haulSub = db.subscribeToHaulOffs?.(project.id, debouncedRefresh)\n    if (haulSub) subs.push(haulSub)\n\n    const reportSub = db.subscribeToDailyReports?.(project.id, debouncedRefresh)\n    if (reportSub) subs.push(reportSub)\n\n    // COR status changes from office (approvals, rejections)\n    const corSub = db.subscribeToCORs?.(project.id, debouncedRefresh)\n    if (corSub) subs.push(corSub)\n\n    // Material request responses from office\n    const matReqSub = db.subscribeToMaterialRequests?.(project.id, debouncedRefresh)\n    if (matReqSub) subs.push(matReqSub)\n\n    // Project-level changes from office (name, dates, budget)\n    const projectSub = db.subscribeToProject?.(project.id, debouncedRefresh)\n    if (projectSub) subs.push(projectSub)\n\n    // Materials/equipment pricing changes from office\n    if (companyId) {\n      const materialsSub = db.subscribeToMaterialsEquipment?.(companyId, debouncedRefresh)\n      if (materialsSub) subs.push(materialsSub)\n\n      const laborSub = db.subscribeToLaborRates?.(companyId, debouncedRefresh)\n      if (laborSub) subs.push(laborSub)\n    }\n\n    return () => {\n      if (refreshTimeoutRef.current) clearTimeout(refreshTimeoutRef.current)\n      subs.forEach(sub => db.unsubscribe?.(sub))\n    }\n  }, [project?.id, debouncedRefresh])\n\n  const loadAreas = async () => {\n    try {\n      const data = await db.getAreas(project.id)\n      setAreas(data)\n      const groups = [...new Set(data.map(a => a.group_name || 'General'))]\n      const expanded = {}\n      groups.forEach(g => expanded[g] = false)\n      setExpandedGroups(expanded)\n    } catch (error) {\n      console.error('Error loading areas:', error)\n      onShowToast?.('Error loading areas', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleStatusUpdate = async (areaId, newStatus) => {\n    const area = areas.find(a => a.id === areaId)\n    if (!area) return\n    const finalStatus = area.status === newStatus ? 'not_started' : newStatus\n    setUpdating(areaId)\n    try {\n      await db.updateAreaStatus(areaId, finalStatus)\n      setAreas(prev => prev.map(a => a.id === areaId ? { ...a, status: finalStatus } : a))\n    } catch (error) {\n      console.error('Error updating status:', error)\n      onShowToast?.('Error updating', 'error')\n    } finally {\n      setUpdating(null)\n    }\n  }\n\n  const toggleGroup = (group) => {\n    setExpandedGroups(prev => ({ ...prev, [group]: !prev[group] }))\n  }\n\n  const toggleTheme = () => {\n    const newTheme = isDark ? 'light' : 'dark'\n    document.documentElement.setAttribute('data-theme', newTheme)\n    localStorage.setItem('theme', newTheme)\n    setIsDark(!isDark)\n  }\n\n  // Calculate stats\n  const progress = calculateProgress(areas)\n  const areasDone = areas.filter(a => a.status === 'done').length\n  const areasWorking = areas.filter(a => a.status === 'working').length\n  const areasRemaining = areas.length - areasDone\n\n  // Group areas\n  const groupedAreas = areas.reduce((acc, area) => {\n    const group = area.group_name || 'General'\n    if (!acc[group]) acc[group] = []\n    acc[group].push(area)\n    return acc\n  }, {})\n\n  const hasGroups = Object.keys(groupedAreas).length > 1 ||\n    (Object.keys(groupedAreas).length === 1 && !groupedAreas['General'])\n\n  const getGroupProgress = (groupAreas) => {\n    const done = groupAreas.filter(a => a.status === 'done').length\n    return `${done}/${groupAreas.length}`\n  }\n\n  // Navigation handler for ForemanLanding (must be before early returns)\n  const handleNavigate = useCallback((viewId) => {\n    setActiveView(viewId)\n  }, [])\n\n  // T&M Form View\n  if (activeView === 'tm') {\n    return (\n      <div className=\"fm-view\">\n        <TMForm\n          project={project}\n          companyId={companyId}\n          onSubmit={() => setActiveView('home')}\n          onCancel={() => setActiveView('home')}\n          onShowToast={onShowToast}\n        />\n      </div>\n    )\n  }\n\n  // Daily Report View\n  if (activeView === 'report') {\n    return (\n      <DailyReport\n        project={project}\n        onShowToast={onShowToast}\n        onClose={() => setActiveView('home')}\n      />\n    )\n  }\n\n  // Injury Report View\n  if (activeView === 'injury') {\n    return (\n      <div className=\"fm-view\">\n        <InjuryReportForm\n          project={project}\n          companyId={companyId}\n          onClose={() => setActiveView('home')}\n          onReportCreated={() => {\n            setActiveView('home')\n            onShowToast?.('Injury report submitted', 'success')\n          }}\n        />\n      </div>\n    )\n  }\n\n  // Crew Check-in View\n  if (activeView === 'crew') {\n    return (\n      <div className=\"fm-view\">\n        <div className=\"fm-subheader\">\n          <button className=\"fm-back\" onClick={() => setActiveView('home')}>\n            <ArrowLeft size={20} />\n          </button>\n          <h2>Crew Check-in</h2>\n        </div>\n        <CrewCheckin project={project} companyId={companyId} onShowToast={onShowToast} />\n      </div>\n    )\n  }\n\n  // Disposal Loads View\n  if (activeView === 'disposal') {\n    return (\n      <div className=\"fm-view\">\n        <div className=\"fm-subheader\">\n          <button className=\"fm-back\" onClick={() => setActiveView('home')}>\n            <ArrowLeft size={20} />\n          </button>\n          <h2>Disposal Loads</h2>\n        </div>\n        <DisposalLoadInput\n          project={project}\n          date={new Date().toISOString().split('T')[0]}\n          onShowToast={onShowToast}\n        />\n      </div>\n    )\n  }\n\n  // Documents View\n  if (activeView === 'docs') {\n    return (\n      <div className=\"fm-view\">\n        <div className=\"fm-subheader\">\n          <button className=\"fm-back\" onClick={() => setActiveView('home')}>\n            <ArrowLeft size={20} />\n          </button>\n          <h2>Documents</h2>\n        </div>\n        <FolderGrid projectId={project.id} onShowToast={onShowToast} />\n      </div>\n    )\n  }\n\n  // Metrics View\n  if (activeView === 'metrics') {\n    return (\n      <ForemanMetrics\n        project={project}\n        companyId={companyId}\n        onBack={() => setActiveView('home')}\n      />\n    )\n  }\n\n  // Punch List View\n  if (activeView === 'punchlist') {\n    return (\n      <div className=\"fm-view\">\n        <div className=\"fm-subheader\">\n          <button className=\"fm-back\" onClick={() => { setActiveView('home'); loadPunchListCount() }}>\n            <ArrowLeft size={20} />\n          </button>\n          <h2>Punch List</h2>\n        </div>\n        <PunchList\n          projectId={project.id}\n          areas={areas}\n          companyId={companyId}\n          onShowToast={onShowToast}\n        />\n      </div>\n    )\n  }\n\n  // Progress View\n  if (activeView === 'progress') {\n    return (\n      <div className=\"fm-view\">\n        <div className=\"fm-subheader\">\n          <button className=\"fm-back\" onClick={() => setActiveView('home')}>\n            <ArrowLeft size={20} />\n          </button>\n          <h2>Progress</h2>\n          <span className=\"fm-subheader-badge\">{progress}%</span>\n        </div>\n\n        <div className=\"fm-progress-content\">\n          {loading ? (\n            <div className=\"fm-loading\">\n              <div className=\"spinner\"></div>\n              <span>Loading...</span>\n            </div>\n          ) : areas.length === 0 ? (\n            <div className=\"fm-empty\">\n              <CheckSquare size={48} />\n              <h3>No tasks yet</h3>\n              <p>Office will add tasks to this project</p>\n            </div>\n          ) : hasGroups ? (\n            Object.entries(groupedAreas).map(([group, groupAreas]) => (\n              <div key={group} className=\"fm-group\">\n                <button className=\"fm-group-header\" onClick={() => toggleGroup(group)}>\n                  <div className=\"fm-group-left\">\n                    {expandedGroups[group] ? <ChevronDown size={18} /> : <ChevronRight size={18} />}\n                    <span>{group}</span>\n                  </div>\n                  <span className=\"fm-group-count\">{getGroupProgress(groupAreas)}</span>\n                </button>\n                {expandedGroups[group] && (\n                  <div className=\"fm-group-items\">\n                    {groupAreas.map(area => (\n                      <div key={area.id} className={`fm-task ${area.status}`}>\n                        <span className=\"fm-task-name\">{area.name}</span>\n                        <div className=\"fm-task-btns\">\n                          <button\n                            className={`fm-status-btn working ${area.status === 'working' ? 'active' : ''}`}\n                            onClick={() => handleStatusUpdate(area.id, 'working')}\n                            disabled={updating === area.id}\n                          >\n                            <Clock size={14} />\n                          </button>\n                          <button\n                            className={`fm-status-btn done ${area.status === 'done' ? 'active' : ''}`}\n                            onClick={() => handleStatusUpdate(area.id, 'done')}\n                            disabled={updating === area.id}\n                          >\n                            <CheckCircle2 size={14} />\n                          </button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            ))\n          ) : (\n            <div className=\"fm-task-list\">\n              {areas.map(area => (\n                <div key={area.id} className={`fm-task ${area.status}`}>\n                  <span className=\"fm-task-name\">{area.name}</span>\n                  <div className=\"fm-task-btns\">\n                    <button\n                      className={`fm-status-btn working ${area.status === 'working' ? 'active' : ''}`}\n                      onClick={() => handleStatusUpdate(area.id, 'working')}\n                      disabled={updating === area.id}\n                    >\n                      <Clock size={14} />\n                    </button>\n                    <button\n                      className={`fm-status-btn done ${area.status === 'done' ? 'active' : ''}`}\n                      onClick={() => handleStatusUpdate(area.id, 'done')}\n                      disabled={updating === area.id}\n                    >\n                      <CheckCircle2 size={14} />\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    )\n  }\n\n  // HOME VIEW - New Mobile Landing Page\n  return (\n    <div className=\"fm-view\">\n      {/* Header */}\n      <div className=\"fm-header\">\n        <button className=\"fm-exit\" onClick={onExit}>\n          <ArrowLeft size={20} />\n        </button>\n        <div className=\"fm-header-center\">\n          <h1 className=\"fm-project-name\">{project.name}</h1>\n          {foremanName && (\n            <span className=\"fm-foreman-name\">{foremanName}</span>\n          )}\n          <button className=\"fm-info-toggle\" onClick={() => setShowProjectInfo(!showProjectInfo)}>\n            <Info size={16} />\n          </button>\n        </div>\n        <button className=\"fm-theme\" onClick={toggleTheme}>\n          {isDark ? <Sun size={20} /> : <Moon size={20} />}\n        </button>\n      </div>\n\n      {/* Project Info (collapsible) */}\n      {showProjectInfo && (\n        <div className=\"fm-project-info\">\n          {project.job_number && <div className=\"fm-info-item\"><span>Job #</span><span>{project.job_number}</span></div>}\n          {project.address && <div className=\"fm-info-item\"><span>Address</span><span>{project.address}</span></div>}\n          {project.general_contractor && <div className=\"fm-info-item\"><span>GC</span><span>{project.general_contractor}</span></div>}\n          {project.client_phone && (\n            <div className=\"fm-info-item\">\n              <span>Phone</span>\n              <a href={`tel:${project.client_phone}`}>{project.client_phone}</a>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* New Mobile-First Landing Page */}\n      <ForemanLanding\n        project={project}\n        todayStatus={todayStatus}\n        progress={progress}\n        areasWorking={areasWorking}\n        areasDone={areasDone}\n        areasRemaining={areasRemaining}\n        punchListOpenCount={punchListOpenCount}\n        onNavigate={handleNavigate}\n        onShowToast={onShowToast}\n      />\n    </div>\n  )\n}\n","import { useState, useEffect, useCallback, lazy, Suspense } from 'react'\nimport { isSupabaseConfigured, auth, supabase, db, clearFieldSession } from './lib/supabase'\nimport { BrandingProvider } from './lib/BrandingContext'\nimport { ThemeProvider } from './lib/ThemeContext'\nimport { ToastProvider } from './lib/ToastContext'\nimport AppEntry from './components/AppEntry'\nimport Toast from './components/Toast'\nimport Logo from './components/Logo'\nimport ThemeToggle from './components/ThemeToggle'\nimport ErrorBoundary from './components/ErrorBoundary'\nimport OfflineIndicator from './components/OfflineIndicator'\nimport InstallPrompt from './components/InstallPrompt'\nimport MFAChallenge from './components/MFAChallenge'\n// ForemanView imported directly to avoid lazy loading bundling issues\nimport ForemanView from './components/ForemanView'\n\n// Lazy load large components for code splitting\nconst Dashboard = lazy(() => import('./components/Dashboard'))\nconst Setup = lazy(() => import('./components/Setup'))\nconst BrandingSettings = lazy(() => import('./components/BrandingSettings'))\nconst PricingManager = lazy(() => import('./components/PricingManager'))\nconst PublicView = lazy(() => import('./components/PublicView'))\nconst SignaturePage = lazy(() => import('./components/SignaturePage'))\nconst MembershipManager = lazy(() => import('./components/MembershipManager'))\n\n// Loading fallback component\nfunction PageLoader() {\n  return (\n    <div className=\"page-loader\">\n      <Logo className=\"loading-logo\" />\n      <div className=\"spinner\"></div>\n    </div>\n  )\n}\n\n// Pending approval screen with auto-polling\nfunction PendingApprovalScreen({ pendingCompanyName, userName, onCheckStatus, onLogout }) {\n  const [checking, setChecking] = useState(false)\n  const [autoCheckCount, setAutoCheckCount] = useState(0)\n\n  // Auto-check status every 30 seconds\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setAutoCheckCount(c => c + 1)\n      onCheckStatus()\n    }, 30000)\n    return () => clearInterval(interval)\n  }, [onCheckStatus])\n\n  const handleManualCheck = async () => {\n    setChecking(true)\n    await onCheckStatus()\n    // Brief delay so the user sees the checking state\n    setTimeout(() => setChecking(false), 1000)\n  }\n\n  return (\n    <div className=\"pending-approval-screen\">\n      <Logo className=\"pending-logo\" />\n\n      <div className=\"pending-pulse-ring\">\n        <div className=\"pending-pulse-dot\" />\n      </div>\n\n      <h2>Awaiting Approval</h2>\n\n      {pendingCompanyName && (\n        <div className=\"pending-company-name\">\n          {pendingCompanyName}\n        </div>\n      )}\n\n      <p className=\"pending-message\">\n        {userName ? `Hi ${userName.split(' ')[0]}, your` : 'Your'} membership request has been submitted.\n        A company administrator will review and approve your access.\n      </p>\n\n      <p className=\"pending-auto-check\">\n        We'll automatically check for updates\n      </p>\n\n      <div className=\"pending-actions\">\n        <button className=\"btn btn-secondary\" onClick={onLogout}>\n          Sign Out\n        </button>\n        <button\n          className=\"btn btn-primary\"\n          onClick={handleManualCheck}\n          disabled={checking}\n        >\n          {checking ? 'Checking...' : 'Check Status'}\n        </button>\n      </div>\n    </div>\n  )\n}\n\nexport default function App() {\n  const [view, setView] = useState('entry') // 'entry', 'foreman', 'office', 'public', 'signature', 'pending'\n  const [user, setUser] = useState(null)\n  const [company, setCompany] = useState(null)\n  const [userCompanies, setUserCompanies] = useState([]) // All companies user can access\n  const [projects, setProjects] = useState([]) // For notification subscriptions\n  const [foremanProject, setForemanProject] = useState(null)\n  const [foremanName, setForemanName] = useState('')\n  const [shareToken, setShareToken] = useState(null)\n  const [signatureToken, setSignatureToken] = useState(null)\n  const [loading, setLoading] = useState(true)\n  const [activeTab, setActiveTab] = useState('dashboard')\n  const [toast, setToast] = useState(null)\n  const [showCompanySwitcher, setShowCompanySwitcher] = useState(false)\n  const [showMobileMenu, setShowMobileMenu] = useState(false)\n  const [navigateToProjectId, setNavigateToProjectId] = useState(null)\n  const [pendingRequestCount, setPendingRequestCount] = useState(0)\n  const [mfaPending, setMfaPending] = useState(false)\n  const [mfaFactorId, setMfaFactorId] = useState(null)\n  const [pendingCompanyName, setPendingCompanyName] = useState('') // Company name for pending screen\n\n  // checkAuth defined before useEffect to avoid ESLint warning\n  const checkAuth = useCallback(async () => {\n    try {\n      // Guard: If Supabase isn't configured, skip auth check\n      if (!isSupabaseConfigured) {\n        setLoading(false)\n        return\n      }\n\n      // Check if user is logged in\n      const { data: { user: authUser } } = await supabase.auth.getUser()\n      if (!authUser) {\n        setLoading(false)\n        return\n      }\n\n      // Get user record\n      const { data: userData } = await supabase\n        .from('users')\n        .select('*')\n        .eq('id', authUser.id)\n        .single()\n\n      if (userData) {\n        setUser(userData)\n\n        // Fetch all companies user has ACTIVE access to\n        let companies = await db.getUserCompanies(authUser.id)\n\n        // If no active companies, check if this is a legacy user\n        if (companies.length === 0 && userData.company_id) {\n          // Legacy user detected - attempt repair\n          const repaired = await db.repairLegacyUser(\n            authUser.id,\n            userData.company_id,\n            userData.role || 'member'\n          )\n\n          if (repaired) {\n            // Retry fetching companies after repair\n            companies = await db.getUserCompanies(authUser.id)\n          }\n        }\n\n        setUserCompanies(companies)\n\n        // If still no active companies, check for pending memberships\n        if (companies.length === 0) {\n          const pendingCount = await db.getUserPendingMemberships(authUser.id)\n          if (pendingCount > 0) {\n            // Try to get the pending company name for context\n            try {\n              const { data: pendingMemberships } = await supabase\n                .from('user_companies')\n                .select('company_id, companies(name)')\n                .eq('user_id', authUser.id)\n                .eq('status', 'pending')\n                .limit(1)\n              if (pendingMemberships?.[0]?.companies?.name) {\n                setPendingCompanyName(pendingMemberships[0].companies.name)\n              }\n            } catch (e) {\n              // Non-critical, continue without company name\n            }\n            setView('pending')\n            return\n          }\n          // No active or pending - show entry screen\n          setToast({ message: 'No company access. Join a company to continue.', type: 'error' })\n          await auth.signOut()\n          return\n        }\n\n        // Use saved company or first available\n        const savedCompanyId = localStorage.getItem('selectedCompanyId')\n        let selectedCompany = null\n\n        if (savedCompanyId && companies.find(c => c.id === savedCompanyId)) {\n          selectedCompany = companies.find(c => c.id === savedCompanyId)\n        } else if (companies.length > 0) {\n          selectedCompany = companies[0]\n        }\n\n        if (selectedCompany) {\n          // Fetch full company data\n          const { data: fullCompany } = await supabase\n            .from('companies')\n            .select('*')\n            .eq('id', selectedCompany.id)\n            .single()\n\n          setCompany(fullCompany)\n          setView('office')\n        }\n      }\n    } catch (error) {\n      console.error('Auth check error:', error)\n    } finally {\n      setLoading(false)\n    }\n  }, [])\n\n  useEffect(() => {\n    // Check if this is a public share link or signature link\n    // Token patterns support alphanumeric, underscore, and hyphen (for UUID-style tokens)\n    const path = window.location.pathname\n    const shareMatch = path.match(/^\\/view\\/([a-zA-Z0-9_-]+)$/)\n    const signatureMatch = path.match(/^\\/sign\\/([a-zA-Z0-9_-]+)$/)\n\n    if (shareMatch) {\n      setShareToken(shareMatch[1])\n      setView('public')\n      setLoading(false)\n    } else if (signatureMatch) {\n      setSignatureToken(signatureMatch[1])\n      setView('signature')\n      setLoading(false)\n    } else {\n      checkAuth()\n    }\n  }, [checkAuth])\n\n  // Listen for auth state changes (handles token refresh and session expiry)\n  useEffect(() => {\n    if (!isSupabaseConfigured) return\n\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      async (event, session) => {\n        if (event === 'SIGNED_OUT' || event === 'USER_DELETED') {\n          // User signed out - reset state, but don't interfere with public/signature views\n          const path = window.location.pathname\n          if (path.startsWith('/sign/') || path.startsWith('/view/')) return\n          setUser(null)\n          setCompany(null)\n          setUserCompanies([])\n          setView('entry')\n        } else if (event === 'TOKEN_REFRESHED') {\n          // Token was refreshed - no action needed, session is valid\n        } else if (event === 'SIGNED_IN' && !user) {\n          // User signed in (might be from another tab or session restore)\n          // Don't override public/signature views - those are accessed without auth\n          const path = window.location.pathname\n          if (!path.startsWith('/sign/') && !path.startsWith('/view/')) {\n            checkAuth()\n          }\n        }\n      }\n    )\n\n    return () => {\n      subscription?.unsubscribe()\n    }\n  }, [user, checkAuth])\n\n  // Foreman accessed project via PIN (and entered their name)\n  const handleForemanAccess = (project, name = '') => {\n    setForemanProject(project)\n    setForemanName(name)\n    setView('foreman')\n  }\n\n  // Office login\n  const handleOfficeLogin = async (email, password) => {\n    try {\n      // Ensure field-session auth does not override office auth\n      await clearFieldSession()\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email,\n        password\n      })\n\n      if (error) {\n        showToast(error.message || 'Invalid credentials', 'error')\n        return\n      }\n\n      // Get user profile\n      const { data: userData, error: userError } = await supabase\n        .from('users')\n        .select('*')\n        .eq('id', data.user.id)\n        .single()\n\n      if (userError) {\n        console.error('User fetch error:', userError)\n        showToast('Error loading profile', 'error')\n        return\n      }\n\n      if (userData) {\n        setUser(userData)\n\n        // Fetch all companies user has access to\n        let companies = await db.getUserCompanies(data.user.id)\n\n        // If no active companies, check if this is a legacy user\n        if (companies.length === 0 && userData.company_id) {\n          // Legacy user detected - attempt repair\n          const repaired = await db.repairLegacyUser(\n            data.user.id,\n            userData.company_id,\n            userData.role || 'member'\n          )\n\n          if (repaired) {\n            // Retry fetching companies after repair\n            companies = await db.getUserCompanies(data.user.id)\n          }\n        }\n\n        setUserCompanies(companies)\n\n        // Use saved company or first available\n        const savedCompanyId = localStorage.getItem('selectedCompanyId')\n        let selectedCompany = null\n\n        if (savedCompanyId && companies.find(c => c.id === savedCompanyId)) {\n          selectedCompany = companies.find(c => c.id === savedCompanyId)\n        } else if (companies.length > 0) {\n          selectedCompany = companies[0]\n        }\n\n        if (selectedCompany) {\n          // Fetch full company data\n          const { data: fullCompany } = await supabase\n            .from('companies')\n            .select('*')\n            .eq('id', selectedCompany.id)\n            .single()\n\n          setCompany(fullCompany)\n\n          // Check if user has MFA enrolled\n          const { data: factors } = await supabase.auth.mfa.listFactors()\n          const verifiedFactor = factors?.totp?.find(f => f.status === 'verified')\n          if (verifiedFactor) {\n            setMfaFactorId(verifiedFactor.id)\n            setMfaPending(true)\n          } else {\n            setView('office')\n          }\n        } else {\n          // Check if there are pending memberships\n          const pendingCount = await db.getUserPendingMemberships(data.user.id)\n          if (pendingCount > 0) {\n            // Try to get the pending company name for context\n            try {\n              const { data: pendingMemberships } = await supabase\n                .from('user_companies')\n                .select('company_id, companies(name)')\n                .eq('user_id', data.user.id)\n                .eq('status', 'pending')\n                .limit(1)\n              if (pendingMemberships?.[0]?.companies?.name) {\n                setPendingCompanyName(pendingMemberships[0].companies.name)\n              }\n            } catch (e) {\n              // Non-critical\n            }\n            setView('pending')\n          } else {\n            showToast('No company access. Please contact admin.', 'error')\n          }\n        }\n      } else {\n        showToast('Profile not found. Please contact admin.', 'error')\n      }\n    } catch (err) {\n      console.error('Login error:', err)\n      showToast('Login failed', 'error')\n    }\n  }\n\n  // Switch company\n  const handleSwitchCompany = async (companyId) => {\n    try {\n      const { data: fullCompany } = await supabase\n        .from('companies')\n        .select('*')\n        .eq('id', companyId)\n        .single()\n\n      if (fullCompany) {\n        setCompany(fullCompany)\n        localStorage.setItem('selectedCompanyId', companyId)\n        setShowCompanySwitcher(false)\n        setActiveTab('dashboard') // Reset to dashboard when switching\n        showToast(`Switched to ${fullCompany.name}`, 'success')\n      }\n    } catch (err) {\n      console.error('Switch company error:', err)\n      showToast('Error switching company', 'error')\n    }\n  }\n\n  const handleLogout = async () => {\n    try {\n      await auth.signOut()\n      setUser(null)\n      setCompany(null)\n      setUserCompanies([])\n      setView('entry')\n      setActiveTab('dashboard')\n      localStorage.removeItem('selectedCompanyId')\n    } catch (error) {\n      console.error('Logout error:', error)\n      showToast('Error signing out', 'error')\n    }\n  }\n\n  const handleExitForeman = async () => {\n    // Clear the field session token\n    await clearFieldSession()\n    setForemanProject(null)\n    setForemanName('')\n    setView('entry')\n  }\n\n  const showToast = useCallback((message, type = '') => {\n    setToast({ message, type })\n  }, [])\n\n  const handleProjectCreated = () => {\n    setActiveTab('dashboard')\n    // Reload projects for notifications\n    if (company?.id) {\n      loadProjects()\n    }\n  }\n\n  // Load projects for notification subscriptions\n  const loadProjects = async () => {\n    if (!company?.id) return\n    try {\n      const projectList = await db.getProjects(company.id)\n      setProjects(projectList)\n    } catch (error) {\n      console.error('Error loading projects:', error)\n    }\n  }\n\n  // Load projects when company changes\n  useEffect(() => {\n    if (company?.id && view === 'office') {\n      loadProjects()\n      loadPendingRequestCount()\n    }\n  }, [company?.id, view])\n\n  // Load pending membership request count (for admin badge)\n  const loadPendingRequestCount = async () => {\n    if (!company?.id) return\n    try {\n      const memberships = await db.getCompanyMemberships(company.id)\n      const pendingCount = memberships.filter(m => m.status === 'pending').length\n      setPendingRequestCount(pendingCount)\n    } catch (error) {\n      console.error('Error loading pending count:', error)\n    }\n  }\n\n  // Clear navigation after project is opened\n  const handleProjectNavigated = useCallback(() => {\n    setNavigateToProjectId(null)\n  }, [])\n\n  // Loading screen\n  if (loading) {\n    return (\n      <ThemeProvider>\n        <BrandingProvider companyId={company?.id}>\n          <div className=\"loading-screen\">\n            <Logo className=\"loading-logo\" />\n            <div className=\"spinner\"></div>\n          </div>\n        </BrandingProvider>\n      </ThemeProvider>\n    )\n  }\n\n  // MFA Challenge screen (shown after login when MFA is enabled)\n  if (mfaPending) {\n    return (\n      <ThemeProvider>\n        <BrandingProvider companyId={company?.id}>\n          <ErrorBoundary>\n            <MFAChallenge\n              factorId={mfaFactorId}\n              onVerified={() => {\n                setMfaPending(false)\n                setView('office')\n              }}\n              onCancel={async () => {\n                setMfaPending(false)\n                setMfaFactorId(null)\n                await auth.signOut()\n                setUser(null)\n                setCompany(null)\n                setUserCompanies([])\n                setView('entry')\n              }}\n            />\n          </ErrorBoundary>\n          {toast && (\n            <Toast\n              message={toast.message}\n              type={toast.type}\n              onClose={() => setToast(null)}\n            />\n          )}\n        </BrandingProvider>\n      </ThemeProvider>\n    )\n  }\n\n  // Entry screen (Foreman / Office selection)\n  if (view === 'entry') {\n    return (\n      <ThemeProvider>\n        <BrandingProvider>\n        <ErrorBoundary>\n          <AppEntry\n            onForemanAccess={handleForemanAccess}\n            onOfficeLogin={handleOfficeLogin}\n            onShowToast={showToast}\n          />\n        </ErrorBoundary>\n        {toast && (\n          <Toast\n            message={toast.message}\n            type={toast.type}\n            onClose={() => setToast(null)}\n          />\n        )}\n        </BrandingProvider>\n      </ThemeProvider>\n    )\n  }\n\n  // Public View (Share Link - No Authentication Required)\n  if (view === 'public' && shareToken) {\n    return (\n      <ThemeProvider>\n        <BrandingProvider>\n          <ErrorBoundary>\n            <Suspense fallback={<PageLoader />}>\n              <PublicView shareToken={shareToken} />\n            </Suspense>\n          </ErrorBoundary>\n          {toast && (\n            <Toast\n              message={toast.message}\n              type={toast.type}\n              onClose={() => setToast(null)}\n            />\n          )}\n        </BrandingProvider>\n      </ThemeProvider>\n    )\n  }\n\n  // Signature View (Public Signing Page - No Authentication Required)\n  if (view === 'signature' && signatureToken) {\n    return (\n      <ThemeProvider>\n        <BrandingProvider>\n          <ErrorBoundary>\n            <Suspense fallback={<PageLoader />}>\n              <SignaturePage signatureToken={signatureToken} />\n            </Suspense>\n          </ErrorBoundary>\n          {toast && (\n            <Toast\n              message={toast.message}\n              type={toast.type}\n              onClose={() => setToast(null)}\n            />\n          )}\n        </BrandingProvider>\n      </ThemeProvider>\n    )\n  }\n\n  // Pending Approval View (User awaiting admin approval)\n  if (view === 'pending') {\n    return (\n      <ThemeProvider>\n        <BrandingProvider>\n          <ErrorBoundary>\n            <PendingApprovalScreen\n              pendingCompanyName={pendingCompanyName}\n              userName={user?.name}\n              onCheckStatus={checkAuth}\n              onLogout={handleLogout}\n            />\n          </ErrorBoundary>\n          {toast && (\n            <Toast\n              message={toast.message}\n              type={toast.type}\n              onClose={() => setToast(null)}\n            />\n          )}\n        </BrandingProvider>\n      </ThemeProvider>\n    )\n  }\n\n  // Foreman View\n  if (view === 'foreman' && foremanProject) {\n    return (\n      <ThemeProvider>\n        <BrandingProvider companyId={foremanProject.company_id}>\n          <ErrorBoundary>\n            <ForemanView\n              project={foremanProject}\n              companyId={foremanProject.company_id}\n              foremanName={foremanName}\n              onShowToast={showToast}\n              onExit={handleExitForeman}\n            />\n          </ErrorBoundary>\n          <OfflineIndicator />\n          {toast && (\n            <Toast\n              message={toast.message}\n              type={toast.type}\n              onClose={() => setToast(null)}\n            />\n          )}\n        </BrandingProvider>\n      </ThemeProvider>\n    )\n  }\n\n  // Check if user is administrator (for Team tab visibility)\n  // Get user's access level in the current company from userCompanies\n  const currentMembership = userCompanies.find(uc => uc.id === company?.id)\n  const accessLevel = currentMembership?.access_level\n  const isAdmin = accessLevel === 'administrator' || company?.owner_user_id === user?.id\n\n  // Office View (full dashboard)\n  return (\n    <ThemeProvider>\n      <BrandingProvider companyId={company?.id}>\n      <ToastProvider>\n      <div>\n        {/* Demo Banner */}\n        {!isSupabaseConfigured && (\n          <div className=\"demo-banner\">\n            Demo Mode - Data saved locally in your browser\n          </div>\n        )}\n\n        {/* Navigation */}\n        <nav className=\"nav\">\n          <div className=\"nav-content\">\n            <Logo />\n            <div className=\"nav-tabs nav-tabs-desktop\">\n              <button\n                className={`nav-tab ${activeTab === 'dashboard' ? 'active' : ''}`}\n                onClick={() => setActiveTab('dashboard')}\n              >\n                Dashboard\n              </button>\n              <button\n                className={`nav-tab ${activeTab === 'setup' ? 'active' : ''}`}\n                onClick={() => setActiveTab('setup')}\n              >\n                + New Project\n              </button>\n              <button\n                className={`nav-tab ${activeTab === 'pricing' ? 'active' : ''}`}\n                onClick={() => setActiveTab('pricing')}\n              >\n                Pricing\n              </button>\n              {isAdmin && (\n                <button\n                  className={`nav-tab ${activeTab === 'branding' ? 'active' : ''}`}\n                  onClick={() => setActiveTab('branding')}\n                >\n                  Branding\n                </button>\n              )}\n              {isAdmin && (\n                <button\n                  className={`nav-tab ${activeTab === 'team' ? 'active' : ''}`}\n                  onClick={() => setActiveTab('team')}\n                >\n                  Team\n                  {pendingRequestCount > 0 && (\n                    <span className=\"nav-tab-badge\">{pendingRequestCount}</span>\n                  )}\n                </button>\n              )}\n            </div>\n            <div className=\"nav-user nav-user-desktop\">\n              {/* Theme Toggle */}\n              <ThemeToggle compact />\n\n              {/* Mobile Menu */}\n              <div className=\"mobile-menu\">\n                <button\n                  className=\"mobile-menu-btn\"\n                  onClick={() => setShowMobileMenu(!showMobileMenu)}\n                  aria-label=\"User menu\"\n                >\n                  \n                </button>\n                {showMobileMenu && (\n                  <div className=\"mobile-menu-dropdown\">\n                    <div className=\"mobile-menu-info\">\n                      <div className=\"mobile-menu-user\">{user?.name || user?.email}</div>\n                      {company && <div className=\"mobile-menu-company\">{company.name}</div>}\n                    </div>\n                    <button\n                      className=\"mobile-menu-logout\"\n                      onClick={() => {\n                        setShowMobileMenu(false)\n                        handleLogout()\n                      }}\n                    >\n                      Sign Out\n                    </button>\n                  </div>\n                )}\n              </div>\n\n              {/* Company Switcher */}\n              {userCompanies.length > 1 && (\n                <div className=\"company-switcher\">\n                  <button\n                    className=\"company-switcher-btn\"\n                    onClick={() => setShowCompanySwitcher(!showCompanySwitcher)}\n                  >\n                    {company?.name || 'Select Company'}\n                    <span className=\"switcher-arrow\"></span>\n                  </button>\n                  {showCompanySwitcher && (\n                    <div className=\"company-dropdown\">\n                      {userCompanies.map(c => (\n                        <button\n                          key={c.id}\n                          className={`company-option ${c.id === company?.id ? 'active' : ''}`}\n                          onClick={() => handleSwitchCompany(c.id)}\n                        >\n                          {c.name}\n                          {c.id === company?.id && <span className=\"check\"></span>}\n                        </button>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n              {userCompanies.length <= 1 && company && (\n                <span className=\"nav-company-name\">{company.name}</span>\n              )}\n              <span className=\"nav-user-name\">{user?.name || user?.email}</span>\n              <button className=\"nav-logout\" onClick={handleLogout}>\n                Sign Out\n              </button>\n            </div>\n\n            {/* Mobile Menu Button */}\n            <button\n              className=\"mobile-menu-btn\"\n              onClick={() => setShowMobileMenu(true)}\n              aria-label=\"Open menu\"\n            >\n              <span className=\"hamburger-icon\">\n                <span></span>\n                <span></span>\n                <span></span>\n              </span>\n            </button>\n          </div>\n        </nav>\n\n        {/* Mobile Drawer */}\n        {showMobileMenu && (\n          <div className=\"mobile-drawer-overlay\" onClick={() => setShowMobileMenu(false)}>\n            <div className=\"mobile-drawer\" onClick={e => e.stopPropagation()}>\n              <div className=\"mobile-drawer-header\">\n                <Logo />\n                <button\n                  className=\"mobile-drawer-close\"\n                  onClick={() => setShowMobileMenu(false)}\n                  aria-label=\"Close menu\"\n                >\n                  \n                </button>\n              </div>\n\n              {/* User Info */}\n              <div className=\"mobile-drawer-user\">\n                <div className=\"mobile-user-avatar\">\n                  {(user?.name || user?.email || 'U')[0].toUpperCase()}\n                </div>\n                <div className=\"mobile-user-info\">\n                  <span className=\"mobile-user-name\">{user?.name || user?.email}</span>\n                  <span className=\"mobile-user-company\">{company?.name}</span>\n                </div>\n              </div>\n\n              {/* Company Switcher (if multiple companies) */}\n              {userCompanies.length > 1 && (\n                <div className=\"mobile-drawer-section\">\n                  <div className=\"mobile-section-title\">Switch Company</div>\n                  <div className=\"mobile-company-list\">\n                    {userCompanies.map(c => (\n                      <button\n                        key={c.id}\n                        className={`mobile-company-option ${c.id === company?.id ? 'active' : ''}`}\n                        onClick={() => {\n                          handleSwitchCompany(c.id)\n                          setShowMobileMenu(false)\n                        }}\n                      >\n                        <span className=\"mobile-company-name\">{c.name}</span>\n                        {c.id === company?.id && <span className=\"mobile-company-check\"></span>}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Navigation Links */}\n              <div className=\"mobile-drawer-section\">\n                <div className=\"mobile-section-title\">Navigation</div>\n                <div className=\"mobile-nav-list\">\n                  <button\n                    className={`mobile-nav-item ${activeTab === 'dashboard' ? 'active' : ''}`}\n                    onClick={() => { setActiveTab('dashboard'); setShowMobileMenu(false) }}\n                  >\n                    Dashboard\n                  </button>\n                  <button\n                    className={`mobile-nav-item ${activeTab === 'setup' ? 'active' : ''}`}\n                    onClick={() => { setActiveTab('setup'); setShowMobileMenu(false) }}\n                  >\n                    + New Project\n                  </button>\n                  <button\n                    className={`mobile-nav-item ${activeTab === 'pricing' ? 'active' : ''}`}\n                    onClick={() => { setActiveTab('pricing'); setShowMobileMenu(false) }}\n                  >\n                    Pricing\n                  </button>\n                  {isAdmin && (\n                    <button\n                      className={`mobile-nav-item ${activeTab === 'branding' ? 'active' : ''}`}\n                      onClick={() => { setActiveTab('branding'); setShowMobileMenu(false) }}\n                    >\n                      Branding\n                    </button>\n                  )}\n                  {isAdmin && (\n                    <button\n                      className={`mobile-nav-item ${activeTab === 'team' ? 'active' : ''}`}\n                      onClick={() => { setActiveTab('team'); setShowMobileMenu(false) }}\n                    >\n                      Team\n                      {pendingRequestCount > 0 && (\n                        <span className=\"mobile-nav-badge\">{pendingRequestCount}</span>\n                      )}\n                    </button>\n                  )}\n                </div>\n              </div>\n\n              {/* Theme Toggle */}\n              <div className=\"mobile-drawer-section\">\n                <div className=\"mobile-section-title\">Appearance</div>\n                <div className=\"mobile-theme-toggle\">\n                  <ThemeToggle />\n                </div>\n              </div>\n\n              {/* Sign Out */}\n              <div className=\"mobile-drawer-footer\">\n                <button\n                  className=\"mobile-logout-btn\"\n                  onClick={() => {\n                    handleLogout()\n                    setShowMobileMenu(false)\n                  }}\n                >\n                  Sign Out\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Main Content */}\n        <ErrorBoundary>\n          <Suspense fallback={<PageLoader />}>\n            <div className=\"container\" key={company?.id}>\n              {activeTab === 'dashboard' && (\n                <Dashboard\n                  company={company}\n                  user={user}\n                  isAdmin={isAdmin}\n                  onShowToast={showToast}\n                  navigateToProjectId={navigateToProjectId}\n                  onProjectNavigated={handleProjectNavigated}\n                />\n              )}\n              {activeTab === 'setup' && (\n                <Setup\n                  company={company}\n                  user={user}\n                  onProjectCreated={handleProjectCreated}\n                  onShowToast={showToast}\n                />\n              )}\n              {activeTab === 'pricing' && (\n                <PricingManager\n                  company={company}\n                  onShowToast={showToast}\n                />\n              )}\n              {activeTab === 'branding' && (\n                <BrandingSettings\n                  company={company}\n                  onShowToast={showToast}\n                />\n              )}\n              {activeTab === 'team' && isAdmin && (\n                <MembershipManager\n                  company={company}\n                  user={user}\n                  onShowToast={showToast}\n                />\n              )}\n            </div>\n          </Suspense>\n        </ErrorBoundary>\n\n        {/* Offline Indicator */}\n        <OfflineIndicator />\n\n        {/* Toast Notifications */}\n        {toast && (\n          <Toast\n            message={toast.message}\n            type={toast.type}\n            onClose={() => setToast(null)}\n          />\n        )}\n        <InstallPrompt />\n      </div>\n      </ToastProvider>\n      </BrandingProvider>\n    </ThemeProvider>\n  )\n}\n\n","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App'\nimport './index.css'\nimport './styles/index.css' // New modular styles (overrides legacy where needed)\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n)\n\n// Register Service Worker for offline support\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', () => {\n    navigator.serviceWorker.register('/sw.js')\n      .then((registration) => {\n        // Check for updates periodically (every 5 minutes)\n        setInterval(() => {\n          registration.update().catch(err => console.debug('[SW] Update check failed:', err.message))\n        }, 300000)\n      })\n      .catch(err => {\n        console.debug('[SW] Registration failed:', err.message)\n      })\n  })\n\n  // Listen for service worker messages\n  navigator.serviceWorker.addEventListener('message', (event) => {\n    if (event.data?.type === 'SW_UPDATED') {\n      // New service worker activated - reload to get fresh assets\n      console.log('[App] Service worker updated, reloading for fresh assets...')\n      window.location.reload()\n    }\n    if (event.data?.type === 'ASSET_NOT_FOUND') {\n      // Asset not found (likely stale chunk reference) - reload page\n      console.warn('[App] Asset not found:', event.data.url, '- reloading...')\n      // Clear service worker cache and reload\n      if ('caches' in window) {\n        caches.keys().then((names) => {\n          names.forEach((name) => caches.delete(name))\n        }).finally(() => {\n          window.location.reload()\n        })\n      } else {\n        window.location.reload()\n      }\n    }\n  })\n}\n"],"file":"index-BIaaQ6dM.js"}