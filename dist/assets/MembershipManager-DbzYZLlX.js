import{c as Y,r as c,d,j as s,T as I,B}from"./index-G650D6qg.js";import{U as J,S as _}from"./users-B0N_B4JC.js";import{U as L,a as H}from"./user-Bfp5scb_.js";import{C as p}from"./chevron-down-BhRuP_PR.js";import{U as V}from"./user-minus-B9OfuiXT.js";import"./react-DXGY7bZi.js";import"./pdf-ChZ1zkDw.js";import"./supabase-VuevzHjS.js";const W=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],X=Y("user-x",W),N=[{value:"member",label:"Member",icon:L,description:"Standard access to projects"},{value:"administrator",label:"Administrator",icon:_,description:"Full control, can manage team"}],R=[{value:"Project Manager",label:"Project Manager"},{value:"Superintendent",label:"Superintendent"},{value:"Job Costing",label:"Job Costing"},{value:"Accounting",label:"Accounting"}];function ae({company:j,user:o,onShowToast:r}){const[i,h]=c.useState("pending"),[x,z]=c.useState([]),[A,f]=c.useState(!0),[t,n]=c.useState(null),[y,b]=c.useState({}),[C,M]=c.useState({});c.useEffect(()=>{j?.id&&u()},[j?.id]);const u=async()=>{try{f(!0);const e=await d.getCompanyMemberships(j.id);z(e)}catch(e){console.error("Error loading members:",e),r("Error loading team members","error")}finally{f(!1)}},k=async e=>{const a=C[e.id];if(!a){r("Please select a role for this member","error");return}try{n(e.id);const l=y[e.id]||"member";await d.approveMembershipWithRole(e.id,o.id,l),await d.updateMemberCompanyRole(e.id,a),r(`${e.users?.name||e.users?.email} approved as ${a}`,"success"),b(v=>{const m={...v};return delete m[e.id],m}),M(v=>{const m={...v};return delete m[e.id],m}),u()}catch(l){console.error("Error approving membership:",l),r("Error approving request","error")}finally{n(null)}},U=(e,a)=>{b(l=>({...l,[e]:a}))},F=(e,a)=>{M(l=>({...l,[e]:a}))},$=async(e,a)=>{try{n(e.id),await d.updateMemberCompanyRole(e.id,a),r(`${e.users?.name||"User"} role updated to ${a}`,"success"),u()}catch(l){console.error("Error updating company role:",l),r("Error updating role","error")}finally{n(null)}},D=async(e,a)=>{if(e.users?.id===o.id&&a!=="administrator"){r("You cannot demote yourself","error");return}try{n(e.id),await d.updateMemberAccessLevel(e.id,a);const l=N.find(v=>v.value===a)?.label||a;r(`${e.users?.name||"User"} is now ${l}`,"success"),u()}catch(l){console.error("Error updating access level:",l),r("Error updating access level","error")}finally{n(null)}},S=async e=>{try{n(e.id),await d.rejectMembership(e.id),r("Request rejected","success"),u()}catch(a){console.error("Error rejecting membership:",a),r("Error rejecting request","error")}finally{n(null)}},q=async e=>{if(e.users?.id===o.id){r("You cannot remove yourself","error");return}try{n(e.id),await d.removeMember(e.id,o.id),r(`${e.users?.name||e.users?.email} removed`,"success"),u()}catch(a){console.error("Error removing member:",a),r("Error removing member","error")}finally{n(null)}},E=x.filter(e=>i==="all"?!0:e.status===i),g=x.filter(e=>e.status==="pending").length,P=x.filter(e=>e.status==="active").length,O=x.filter(e=>e.status==="removed").length;return A?s.jsx("div",{className:"membership-manager",children:s.jsxs("div",{className:"loading",children:[s.jsx("div",{className:"spinner"}),"Loading team members..."]})}):s.jsxs("div",{className:"membership-manager",children:[s.jsxs("div",{className:"membership-header",children:[s.jsxs("h2",{children:[s.jsx(J,{size:24})," Team Members"]}),s.jsxs("p",{className:"membership-subtitle",children:["Manage who has access to ",j?.name]})]}),g>0&&s.jsxs("div",{className:"pending-alert",children:[s.jsx(I,{size:20}),s.jsxs("span",{children:[g," pending request",g>1?"s":""," awaiting approval"]})]}),s.jsxs("div",{className:"tm-filter-tabs",children:[s.jsxs("button",{className:`tm-filter-tab ${i==="pending"?"active":""}`,onClick:()=>h("pending"),children:["Pending",s.jsx("span",{className:"tm-filter-count",children:g})]}),s.jsxs("button",{className:`tm-filter-tab ${i==="active"?"active":""}`,onClick:()=>h("active"),children:["Active",s.jsx("span",{className:"tm-filter-count",children:P})]}),s.jsxs("button",{className:`tm-filter-tab ${i==="removed"?"active":""}`,onClick:()=>h("removed"),children:["Removed",s.jsx("span",{className:"tm-filter-count",children:O})]})]}),s.jsx("div",{className:"member-list",children:E.length===0?s.jsxs("div",{className:"member-empty",children:[i==="pending"&&"No pending requests",i==="active"&&"No active members",i==="removed"&&"No removed members"]}):E.map(e=>s.jsxs("div",{className:`member-card ${e.status}`,children:[s.jsxs("div",{className:"member-info",children:[s.jsxs("div",{className:"member-name",children:[e.users?.name||"Unknown",e.users?.id===o.id&&s.jsx("span",{className:"member-you",children:"(You)"})]}),s.jsx("div",{className:"member-email",children:e.users?.email}),s.jsxs("div",{className:"member-meta",children:[e.status==="pending"&&s.jsxs(s.Fragment,{children:["Requested ",new Date(e.created_at).toLocaleDateString()]}),e.status==="active"&&e.approved_at&&s.jsxs(s.Fragment,{children:["Approved ",new Date(e.approved_at).toLocaleDateString()]}),e.status==="active"&&!e.approved_at&&s.jsxs(s.Fragment,{children:["Member since ",new Date(e.created_at).toLocaleDateString()]}),e.status==="removed"&&e.removed_at&&s.jsxs(s.Fragment,{children:["Removed ",new Date(e.removed_at).toLocaleDateString()]})]}),e.status==="active"&&s.jsxs("div",{className:"member-badges",children:[e.access_level==="administrator"?s.jsxs("span",{className:"access-badge admin",children:[s.jsx(_,{size:12})," Administrator"]}):s.jsxs("span",{className:"access-badge member",children:[s.jsx(L,{size:12})," Member"]}),e.company_role&&s.jsxs("span",{className:"access-badge role",children:[s.jsx(B,{size:12})," ",e.company_role]})]})]}),s.jsxs("div",{className:"member-actions",children:[e.status==="pending"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"role-selector",children:[s.jsxs("select",{value:C[e.id]||"",onChange:a=>F(e.id,a.target.value),disabled:t===e.id,className:"role-select",children:[s.jsx("option",{value:"",children:"Select Role..."}),R.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))]}),s.jsx(p,{size:14,className:"role-select-icon"})]}),s.jsxs("div",{className:"role-selector",children:[s.jsx("select",{value:y[e.id]||"member",onChange:a=>U(e.id,a.target.value),disabled:t===e.id,className:"role-select",children:N.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))}),s.jsx(p,{size:14,className:"role-select-icon"})]}),s.jsx("button",{className:"btn btn-success btn-small",onClick:()=>k(e),disabled:t===e.id,children:t===e.id?"...":s.jsxs(s.Fragment,{children:[s.jsx(H,{size:16})," Approve"]})}),s.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>S(e),disabled:t===e.id,children:t===e.id?"...":s.jsxs(s.Fragment,{children:[s.jsx(X,{size:16})," Reject"]})})]}),e.status==="active"&&e.users?.id!==o.id&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"role-selector",children:[s.jsxs("select",{value:e.company_role||"",onChange:a=>$(e,a.target.value),disabled:t===e.id,className:"role-select",children:[s.jsx("option",{value:"",children:"No Role"}),R.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))]}),s.jsx(p,{size:14,className:"role-select-icon"})]}),s.jsxs("div",{className:"role-selector",children:[s.jsx("select",{value:e.access_level||"member",onChange:a=>D(e,a.target.value),disabled:t===e.id,className:"role-select",children:N.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))}),s.jsx(p,{size:14,className:"role-select-icon"})]}),s.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>q(e),disabled:t===e.id,children:t===e.id?"...":s.jsxs(s.Fragment,{children:[s.jsx(V,{size:16})," Remove"]})})]})]})]},e.id))})]})}export{ae as default};
