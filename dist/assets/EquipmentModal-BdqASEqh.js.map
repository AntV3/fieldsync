{"version":3,"file":"EquipmentModal-BdqASEqh.js","sources":["../../src/components/equipment/EquipmentModal.jsx"],"sourcesContent":["import { useState, useEffect, useCallback, memo } from 'react'\nimport { X, Truck, DollarSign, Calendar, Save, ChevronDown } from 'lucide-react'\nimport { equipmentOps } from '../../lib/supabase'\n\n/**\n * EquipmentModal - Add or edit equipment on a project\n *\n * Features:\n * - Select from company equipment catalog OR enter custom\n * - Pre-fills daily rate from catalog\n * - Start date picker\n * - Notes field\n */\nexport default memo(function EquipmentModal({\n  project,\n  company,\n  user,\n  editItem = null, // Pass existing item for edit mode\n  onSave,\n  onClose\n}) {\n  const [catalogEquipment, setCatalogEquipment] = useState([])\n  const [loading, setLoading] = useState(true) // Start true since we load on mount\n  const [saving, setSaving] = useState(false)\n\n  // Form state\n  const [selectedEquipmentId, setSelectedEquipmentId] = useState('')\n  const [customName, setCustomName] = useState('')\n  const [dailyRate, setDailyRate] = useState('')\n  const [startDate, setStartDate] = useState(new Date().toISOString().split('T')[0])\n  const [endDate, setEndDate] = useState('')\n  const [notes, setNotes] = useState('')\n  const [useCustom, setUseCustom] = useState(false)\n\n  const isEditMode = !!editItem\n\n  // Load equipment catalog\n  const loadCatalog = useCallback(async () => {\n    if (!company?.id) {\n      setLoading(false)\n      return\n    }\n\n    try {\n      setLoading(true)\n      const data = await equipmentOps.getCompanyEquipment(company.id)\n      setCatalogEquipment(data || [])\n    } catch (error) {\n      console.error('Error loading equipment catalog:', error)\n    } finally {\n      setLoading(false)\n    }\n  }, [company?.id])\n\n  useEffect(() => {\n    loadCatalog()\n  }, [loadCatalog])\n\n  // Populate form for edit mode\n  useEffect(() => {\n    if (editItem) {\n      setCustomName(editItem.equipment_name || '')\n      setDailyRate(((editItem.daily_rate || 0) / 100).toFixed(2))\n      setStartDate(editItem.start_date || new Date().toISOString().split('T')[0])\n      setEndDate(editItem.end_date || '')\n      setNotes(editItem.notes || '')\n      setSelectedEquipmentId(editItem.equipment_id || '')\n      setUseCustom(!editItem.equipment_id)\n    }\n  }, [editItem])\n\n  const handleEquipmentSelect = (e) => {\n    const equipmentId = e.target.value\n\n    if (equipmentId === 'custom') {\n      setUseCustom(true)\n      setSelectedEquipmentId('')\n      setCustomName('')\n      setDailyRate('')\n      return\n    }\n\n    setUseCustom(false)\n    setSelectedEquipmentId(equipmentId)\n\n    // Pre-fill rate from catalog\n    const selected = catalogEquipment.find(eq => eq.id === equipmentId)\n    if (selected) {\n      setCustomName(selected.name)\n      setDailyRate(((selected.daily_rate || 0) / 100).toFixed(2))\n    }\n  }\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n\n    // Validation - get name from customName (used for both catalog and custom entries)\n    const name = customName.trim()\n    if (!name) {\n      alert('Please enter equipment name')\n      return\n    }\n\n    const rate = parseFloat(dailyRate)\n    if (isNaN(rate) || rate < 0) {\n      alert('Please enter a valid daily rate')\n      return\n    }\n\n    if (!startDate) {\n      alert('Please select a start date')\n      return\n    }\n\n    try {\n      setSaving(true)\n\n      const equipmentData = {\n        project_id: project.id,\n        equipment_id: useCustom ? null : (selectedEquipmentId || null),\n        equipment_name: name,\n        daily_rate: Math.round(rate * 100), // Convert to cents\n        start_date: startDate,\n        end_date: endDate || null,\n        notes: notes.trim() || null,\n        created_by: user?.id\n      }\n\n      let result\n      if (isEditMode) {\n        // Remove fields that shouldn't be updated\n        delete equipmentData.project_id\n        delete equipmentData.created_by\n        result = await equipmentOps.updateProjectEquipment(editItem.id, equipmentData)\n      } else {\n        result = await equipmentOps.addEquipmentToProject(equipmentData)\n      }\n\n      onSave?.(result)\n    } catch (error) {\n      console.error('Error saving equipment:', error)\n      alert('Failed to save equipment. Please try again.')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  return (\n    <div className=\"modal-backdrop\" onClick={onClose}>\n      <div className=\"modal equipment-modal\" onClick={e => e.stopPropagation()}>\n        <div className=\"modal-header\">\n          <h2>\n            <Truck size={20} />\n            {isEditMode ? 'Edit Equipment' : 'Add Equipment to Project'}\n          </h2>\n          <button className=\"modal-close\" onClick={onClose}>\n            <X size={20} />\n          </button>\n        </div>\n\n        <form onSubmit={handleSubmit}>\n          <div className=\"modal-body\">\n            {/* Equipment Selection */}\n            {!isEditMode && catalogEquipment.length > 0 && (\n              <div className=\"form-group\">\n                <label>Select Equipment</label>\n                <div className=\"select-wrapper\">\n                  <select\n                    value={useCustom ? 'custom' : selectedEquipmentId}\n                    onChange={handleEquipmentSelect}\n                    className=\"form-select\"\n                  >\n                    <option value=\"\">Choose from catalog...</option>\n                    {catalogEquipment.map(eq => (\n                      <option key={eq.id} value={eq.id}>\n                        {eq.name} - ${((eq.daily_rate || 0) / 100).toFixed(0)}/day\n                      </option>\n                    ))}\n                    <option value=\"custom\">+ Add custom equipment</option>\n                  </select>\n                  <ChevronDown size={16} className=\"select-icon\" />\n                </div>\n              </div>\n            )}\n\n            {/* Equipment Name (for custom or if no catalog) */}\n            {(useCustom || isEditMode || catalogEquipment.length === 0) && (\n              <div className=\"form-group\">\n                <label htmlFor=\"equipment-name\">Equipment Name</label>\n                <input\n                  id=\"equipment-name\"\n                  type=\"text\"\n                  value={customName}\n                  onChange={e => setCustomName(e.target.value)}\n                  placeholder=\"e.g., CAT 320 Excavator\"\n                  className=\"form-input\"\n                  required\n                />\n              </div>\n            )}\n\n            {/* Daily Rate */}\n            <div className=\"form-group\">\n              <label htmlFor=\"daily-rate\">\n                <DollarSign size={14} />\n                Daily Rate\n              </label>\n              <div className=\"input-with-prefix\">\n                <span className=\"input-prefix\">$</span>\n                <input\n                  id=\"daily-rate\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0\"\n                  value={dailyRate}\n                  onChange={e => setDailyRate(e.target.value)}\n                  placeholder=\"0.00\"\n                  className=\"form-input\"\n                  required\n                />\n                <span className=\"input-suffix\">/day</span>\n              </div>\n            </div>\n\n            {/* Date Range */}\n            <div className=\"form-row\">\n              <div className=\"form-group\">\n                <label htmlFor=\"start-date\">\n                  <Calendar size={14} />\n                  Start Date\n                </label>\n                <input\n                  id=\"start-date\"\n                  type=\"date\"\n                  value={startDate}\n                  onChange={e => setStartDate(e.target.value)}\n                  className=\"form-input\"\n                  required\n                />\n              </div>\n\n              <div className=\"form-group\">\n                <label htmlFor=\"end-date\">\n                  <Calendar size={14} />\n                  End Date (optional)\n                </label>\n                <input\n                  id=\"end-date\"\n                  type=\"date\"\n                  value={endDate}\n                  onChange={e => setEndDate(e.target.value)}\n                  min={startDate}\n                  className=\"form-input\"\n                  placeholder=\"Leave blank if still on site\"\n                />\n                <span className=\"form-help\">Leave blank if still on site</span>\n              </div>\n            </div>\n\n            {/* Notes */}\n            <div className=\"form-group\">\n              <label htmlFor=\"notes\">Notes (optional)</label>\n              <textarea\n                id=\"notes\"\n                value={notes}\n                onChange={e => setNotes(e.target.value)}\n                placeholder=\"Equipment number, rental company, etc.\"\n                className=\"form-textarea\"\n                rows={2}\n              />\n            </div>\n          </div>\n\n          <div className=\"modal-footer\">\n            <button\n              type=\"button\"\n              className=\"btn btn-outline\"\n              onClick={onClose}\n              disabled={saving}\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              className=\"btn btn-primary\"\n              disabled={saving}\n            >\n              {saving ? (\n                <>\n                  <div className=\"loading-spinner small\" />\n                  Saving...\n                </>\n              ) : (\n                <>\n                  <Save size={16} />\n                  {isEditMode ? 'Update' : 'Add Equipment'}\n                </>\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n})\n"],"names":["EquipmentModal","memo","project","company","user","editItem","onSave","onClose","catalogEquipment","setCatalogEquipment","useState","loading","setLoading","saving","setSaving","selectedEquipmentId","setSelectedEquipmentId","customName","setCustomName","dailyRate","setDailyRate","startDate","setStartDate","endDate","setEndDate","notes","setNotes","useCustom","setUseCustom","isEditMode","loadCatalog","useCallback","data","equipmentOps","error","useEffect","handleEquipmentSelect","e","equipmentId","selected","eq","handleSubmit","name","rate","equipmentData","result","jsx","jsxs","Truck","X","ChevronDown","DollarSign","Calendar","Fragment","Save"],"mappings":"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"}