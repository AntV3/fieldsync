import{j as e,d as X}from"./index-CIwxO8rl.js";import{r as i,X as Y,ae as I,B as L,ag as U,z as W,h as A,d as G}from"./icons-_xHNNQgF.js";import"./react-DXGY7bZi.js";import"./pdf-ChZ1zkDw.js";import"./supabase-VuevzHjS.js";function Z({ticketId:w,ticketSummary:o,lang:k="en",onSave:T,onClose:d,onShowToast:m}){const n=i.useRef(null),[l,P]=i.useState(""),[u,D]=i.useState(""),[h,R]=i.useState(""),[g,p]=i.useState(!1),[z,f]=i.useState(!1),[x,N]=i.useState(!1),y={en:{title:"Client Signature",subtitle:"Sign to verify the work performed",signerName:"Your Name",signerNamePlaceholder:"Full name",signerTitle:"Title",signerTitlePlaceholder:"e.g. Project Manager",signerCompany:"Company",signerCompanyPlaceholder:"Company name",signBelow:"Sign below",signHere:"Sign here",clear:"Clear",cancel:"Cancel",saveSignature:"Submit Signature",saving:"Saving...",workDate:"Work Date",workers:"Workers",hours:"Total Hours",certification:"By signing, I acknowledge that the work described in this T&M ticket was performed as documented.",nameRequired:"Please enter your name",signatureRequired:"Please sign above",signatureSaved:"Signature saved successfully",signatureError:"Error saving signature"},es:{title:"Firma del Cliente",subtitle:"Firme para verificar el trabajo realizado",signerName:"Su Nombre",signerNamePlaceholder:"Nombre completo",signerTitle:"Titulo",signerTitlePlaceholder:"ej. Gerente de Proyecto",signerCompany:"Empresa",signerCompanyPlaceholder:"Nombre de la empresa",signBelow:"Firme abajo",signHere:"Firme aqui",clear:"Borrar",cancel:"Cancelar",saveSignature:"Enviar Firma",saving:"Guardando...",workDate:"Fecha",workers:"Trabajadores",hours:"Horas Total",certification:"Al firmar, reconozco que el trabajo descrito en este ticket T&M fue realizado como se documenta.",nameRequired:"Por favor ingrese su nombre",signatureRequired:"Por favor firme arriba",signatureSaved:"Firma guardada exitosamente",signatureError:"Error al guardar la firma"}},r=y[k]||y.en,v=()=>{const s=n.current;return s?s.getContext("2d"):null},b=s=>{const a=n.current;if(!a)return{x:0,y:0};const t=a.getBoundingClientRect(),c=a.width/t.width,F=a.height/t.height,q=s.touches?.length?s.touches[0].clientX:s.clientX,H=s.touches?.length?s.touches[0].clientY:s.clientY;return{x:(q-t.left)*c,y:(H-t.top)*F}},C=s=>{s.preventDefault();const a=v();if(!a)return;const{x:t,y:c}=b(s);a.beginPath(),a.moveTo(t,c),f(!0),p(!0)},S=s=>{if(!z)return;s.preventDefault();const a=v();if(!a)return;const{x:t,y:c}=b(s);a.lineTo(t,c),a.stroke()},j=()=>{f(!1)},E=()=>{const s=n.current,a=v();!s||!a||(a.clearRect(0,0,s.width,s.height),p(!1))},M=s=>{if(!s)return;n.current=s;const a=s.getContext("2d");a.strokeStyle="#1e293b",a.lineWidth=2,a.lineCap="round",a.lineJoin="round"},B=async()=>{if(!l.trim()){m?.(r.nameRequired,"error");return}if(!g){m?.(r.signatureRequired,"error");return}const s=n.current;if(s){N(!0);try{const a=s.toDataURL("image/png");await X.saveTMClientSignature(w,{signature:a,signerName:l.trim(),signerTitle:u.trim()||null,signerCompany:h.trim()||null,signedAt:new Date().toISOString()}),m?.(r.signatureSaved,"success"),T?.({signerName:l.trim(),signerTitle:u.trim(),signerCompany:h.trim()})}catch(a){console.error("Error saving signature:",a),m?.(r.signatureError,"error")}finally{N(!1)}}};return e.jsx("div",{className:"tm-modal-overlay",onClick:d,children:e.jsxs("div",{className:"tm-client-signature-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"tm-sig-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:r.title}),e.jsx("p",{className:"tm-sig-subtitle",children:r.subtitle})]}),e.jsx("button",{className:"tm-sig-close",onClick:d,children:e.jsx(Y,{size:20})})]}),e.jsxs("div",{className:"tm-sig-body",children:[o&&e.jsxs("div",{className:"tm-sig-summary",children:[e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:r.workDate}),e.jsx("span",{className:"tm-sig-summary-value",children:new Date(o.workDate).toLocaleDateString()})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:r.workers}),e.jsx("span",{className:"tm-sig-summary-value",children:o.workerCount})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:r.hours}),e.jsx("span",{className:"tm-sig-summary-value",children:o.totalHours})]})]}),e.jsxs("div",{className:"tm-sig-fields",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(I,{size:14}),r.signerName," *"]}),e.jsx("input",{type:"text",value:l,onChange:s=>P(s.target.value),placeholder:r.signerNamePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field-row",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(L,{size:14}),r.signerTitle]}),e.jsx("input",{type:"text",value:u,onChange:s=>D(s.target.value),placeholder:r.signerTitlePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(U,{size:14}),r.signerCompany]}),e.jsx("input",{type:"text",value:h,onChange:s=>R(s.target.value),placeholder:r.signerCompanyPlaceholder})]})]})]}),e.jsxs("div",{className:"tm-sig-area",children:[e.jsxs("div",{className:"tm-sig-label",children:[e.jsx(W,{size:14}),e.jsx("span",{children:r.signBelow})]}),e.jsxs("div",{className:"tm-sig-canvas-container",children:[e.jsx("canvas",{ref:M,width:500,height:180,className:"tm-sig-canvas",onMouseDown:C,onMouseMove:S,onMouseUp:j,onMouseLeave:j,onTouchStart:C,onTouchMove:S,onTouchEnd:j}),!g&&e.jsx("div",{className:"tm-sig-placeholder",children:r.signHere})]}),e.jsxs("button",{className:"tm-sig-clear",onClick:E,disabled:!g,children:[e.jsx(A,{size:14})," ",r.clear]})]}),e.jsx("p",{className:"tm-sig-certification",children:r.certification})]}),e.jsxs("div",{className:"tm-sig-footer",children:[e.jsx("button",{className:"tm-sig-btn secondary",onClick:d,disabled:x,children:r.cancel}),e.jsx("button",{className:"tm-sig-btn primary",onClick:B,disabled:!g||!l.trim()||x,children:x?r.saving:e.jsxs(e.Fragment,{children:[e.jsx(G,{size:16})," ",r.saveSignature]})})]})]})})}export{Z as default};
//# sourceMappingURL=TMClientSignature-DiPogMhk.js.map
