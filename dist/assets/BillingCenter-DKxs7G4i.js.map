{"version":3,"mappings":"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","names":["formatDate","dateStr","drawRule","doc","x1","y","x2","color","weight","generateInvoicePDF","invoice","project","company","jsPDF","__vitePreload","n","autoTable","pageWidth","pageHeight","margin","contentWidth","brandHex","primary","hexToRgb","dark","mid","subtle","surface","border","headerH","logoRight","logoData","loadImageAsBase64","taglineParts","leftW","rightW","rightX","metaRows","labelCol","valueCol","label","value","billY","line","projLabel","tableData","item","idx","formatCurrency","totalsW","totalsX","totalsVal","pct","totalBoxH","totalPgs","i","fy","downloadInvoicePDF","safeName","fileName","InvoiceModal","user","selectedItems","onClose","onSuccess","loading","setLoading","useState","saving","setSaving","invoiceNumber","setInvoiceNumber","invoiceDate","setInvoiceDate","dueDate","setDueDate","retentionPercent","setRetentionPercent","notes","setNotes","terms","setTerms","manualItems","setManualItems","errors","setErrors","useEffect","due","nextNumber","db","error","lineItems","useMemo","items","cor","ticket","index","dollarsToCents","totals","subtotal","sum","retentionAmount","total","addManualItem","prev","updateManualItem","field","updated","removeManualItem","_","validate","newErrors","handleSave","invoiceData","itemsData","corIds","c","tmIds","t","jsx","jsxs","Loader2","e","Receipt","X","Plus","FileText","Fragment","Trash2","STATUS_CONFIG","Send","AlertCircle","CheckCircle","BillingCenter","onShowToast","billableItems","setBillableItems","invoices","setInvoices","setSelectedItems","showInvoiceModal","setShowInvoiceModal","editingInvoice","setEditingInvoice","activeDropdown","setActiveDropdown","viewingInvoice","setViewingInvoice","actionLoading","setActionLoading","dropdownRef","useRef","loadData","billable","projectInvoices","handleClickOutside","event","toggleDropdown","useCallback","invoiceId","handleViewInvoice","fullInvoice","handleDownloadPDF","handleMarkSent","handleMarkPaid","selectedCORsTotal","selectedTicketsTotal","allCORsTotal","allTicketsTotal","toggleCOR","corId","newCORs","toggleTicket","ticketId","newTickets","selectAll","clearSelection","handleCreateInvoice","handleInvoiceCreated","getSelectedItemsForInvoice","cors","tickets","hasBillableItems","hasSelection","ClipboardList","DollarSign","StatusIcon","isDropdownOpen","Eye","Download","MoreVertical"],"ignoreList":[],"sources":["../../src/lib/invoicePdfGenerator.js","../../src/components/billing/InvoiceModal.jsx","../../src/components/billing/BillingCenter.jsx"],"sourcesContent":["/**\n * Invoice PDF Generator\n *\n * Generates professional, branded invoice PDFs.\n * Uses jsPDF with autoTable plugin for consistent formatting.\n */\n\nimport { formatCurrency } from './corCalculations'\nimport { hexToRgb, loadImageAsBase64 } from './imageUtils'\n\n// Helper: format a date string to long US format\nfunction formatDate(dateStr) {\n  if (!dateStr) return ''\n  const date = new Date(dateStr + 'T00:00:00')\n  return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })\n}\n\n// Helper: draw a thin horizontal rule\nfunction drawRule(doc, x1, y, x2, color = [226, 232, 240], weight = 0.3) {\n  doc.setDrawColor(...color)\n  doc.setLineWidth(weight)\n  doc.line(x1, y, x2, y)\n}\n\n/**\n * Generate an invoice PDF\n *\n * @param {Object} invoice - Invoice data with items\n * @param {Object} project  - Project data\n * @param {Object} company  - Company data with branding\n * @returns {Promise<jsPDF>} The generated PDF document\n */\nexport async function generateInvoicePDF(invoice, project, company) {\n  const { default: jsPDF } = await import('jspdf')\n  const { default: autoTable } = await import('jspdf-autotable')\n\n  const doc = new jsPDF('portrait', 'mm', 'letter')\n  const pageWidth  = doc.internal.pageSize.width\n  const pageHeight = doc.internal.pageSize.height\n  const margin = 20\n  const contentWidth = pageWidth - margin * 2\n\n  // ─── Brand colours ───────────────────────────────────────────────────────────\n  const brandHex = company?.branding_color || company?.primary_color || '#1E3A5F'\n  const primary  = hexToRgb(brandHex)       // company primary (header, accents)\n  const dark     = [17, 24, 39]             // near-black text\n  const mid      = [71, 85, 105]            // secondary text\n  const subtle   = [148, 163, 184]          // light labels / rules\n  const surface  = [248, 250, 252]          // table alt rows / boxes\n  const border   = [226, 232, 240]\n\n  let y = 0\n\n  // ============================================================\n  // TOP HEADER BAND\n  // ============================================================\n  const headerH = 48\n  doc.setFillColor(...primary)\n  doc.rect(0, 0, pageWidth, headerH, 'F')\n\n  // Logo (if available)\n  let logoRight = margin\n  if (company?.logo_url) {\n    try {\n      const logoData = await loadImageAsBase64(company.logo_url)\n      if (logoData) {\n        const lh = 28\n        const lw = 28\n        doc.addImage(logoData, 'PNG', margin, (headerH - lh) / 2, lw, lh)\n        logoRight = margin + lw + 10\n      }\n    } catch (_) { /* ignore logo errors */ }\n  }\n\n  // Company name in header\n  doc.setFontSize(15)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(255, 255, 255)\n  doc.text(company?.name || 'Company Name', logoRight, headerH / 2 - 2)\n\n  // Contact details sub-line\n  const taglineParts = [company?.phone, company?.email].filter(Boolean)\n  if (taglineParts.length) {\n    doc.setFontSize(8)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(220, 230, 245)\n    doc.text(taglineParts.join('  ·  '), logoRight, headerH / 2 + 5)\n  }\n\n  // \"INVOICE\" — right side of header\n  doc.setFontSize(26)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(255, 255, 255)\n  doc.text('INVOICE', pageWidth - margin, headerH / 2 + 5, { align: 'right' })\n\n  y = headerH + 14\n\n  // ============================================================\n  // INVOICE META  (left)  +  BILL TO  (right)\n  // ============================================================\n  const leftW  = contentWidth * 0.44\n  const rightW = contentWidth * 0.44\n  const rightX = margin + contentWidth - rightW\n\n  // ── Left: invoice details ───────────────────────────────────\n  const metaRows = [\n    ['Invoice #',    invoice.invoice_number || '—'],\n    ['Invoice Date', formatDate(invoice.invoice_date)],\n    ['Due Date',     invoice.due_date ? formatDate(invoice.due_date) : 'Upon Receipt'],\n    ['Terms',        invoice.terms || 'Net 30'],\n  ]\n  const labelCol = margin\n  const valueCol = margin + 30\n\n  doc.setFontSize(8)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(...subtle)\n  doc.text('INVOICE DETAILS', labelCol, y)\n  y += 5\n  drawRule(doc, labelCol, y, labelCol + leftW, border)\n  y += 5\n\n  metaRows.forEach(([label, value]) => {\n    doc.setFont('helvetica', 'normal')\n    doc.setFontSize(9)\n    doc.setTextColor(...mid)\n    doc.text(label, labelCol, y)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(...dark)\n    doc.text(String(value || '—'), valueCol, y)\n    y += 5.5\n  })\n\n  // ── Right: Bill To ──────────────────────────────────────────\n  let billY = headerH + 14\n\n  doc.setFontSize(8)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(...subtle)\n  doc.text('BILL TO', rightX, billY)\n  billY += 5\n  drawRule(doc, rightX, billY, rightX + rightW, border)\n  billY += 5\n\n  if (invoice.bill_to_name) {\n    doc.setFontSize(11)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(...dark)\n    doc.text(invoice.bill_to_name, rightX, billY)\n    billY += 6\n  }\n  if (invoice.bill_to_address) {\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(...mid)\n    const addrLines = doc.splitTextToSize(invoice.bill_to_address, rightW)\n    addrLines.forEach(line => { doc.text(line, rightX, billY); billY += 4.5 })\n  }\n  if (invoice.bill_to_contact) {\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(...mid)\n    doc.text(invoice.bill_to_contact, rightX, billY)\n  }\n\n  y = Math.max(y, billY) + 10\n\n  // Project reference strip\n  doc.setFillColor(...surface)\n  doc.roundedRect(margin, y - 3, contentWidth, 9, 2, 2, 'F')\n  doc.setFontSize(8)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(...mid)\n  doc.text('Project:', margin + 4, y + 3)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(...dark)\n  const projLabel = (project?.name || '') + (project?.job_number ? `  (Job #${project.job_number})` : '')\n  doc.text(projLabel, margin + 22, y + 3)\n  y += 14\n\n  // ============================================================\n  // LINE ITEMS TABLE\n  // ============================================================\n  const tableData = (invoice.invoice_items || []).map((item, idx) => [\n    (idx + 1).toString(),\n    item.reference_number || '—',\n    item.description || '—',\n    formatCurrency(item.amount)\n  ])\n\n  autoTable(doc, {\n    startY: y,\n    head: [['#', 'Ref #', 'Description', 'Amount']],\n    body: tableData.length > 0 ? tableData : [['', '', 'No line items', '']],\n    theme: 'plain',\n    styles: {\n      fontSize: 9,\n      cellPadding: { top: 4, bottom: 4, left: 4, right: 4 },\n      textColor: dark,\n      overflow: 'linebreak'\n    },\n    headStyles: {\n      fillColor: primary,\n      textColor: [255, 255, 255],\n      fontStyle: 'bold',\n      fontSize: 9\n    },\n    alternateRowStyles: { fillColor: surface },\n    columnStyles: {\n      0: { cellWidth: 10, halign: 'center' },\n      1: { cellWidth: 28 },\n      2: { cellWidth: 'auto' },\n      3: { cellWidth: 30, halign: 'right' }\n    },\n    margin: { left: margin, right: margin }\n  })\n\n  y = doc.lastAutoTable.finalY + 8\n\n  // ============================================================\n  // TOTALS BLOCK  (right-aligned)\n  // ============================================================\n  const totalsW   = 80\n  const totalsX   = pageWidth - margin - totalsW\n  const totalsVal = pageWidth - margin\n\n  // Subtotal row\n  doc.setFontSize(9)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(...mid)\n  doc.text('Subtotal', totalsX, y)\n  doc.setTextColor(...dark)\n  doc.text(formatCurrency(invoice.subtotal), totalsVal, y, { align: 'right' })\n  y += 6\n\n  // Retention (if applicable) — retention_percent stored in basis points (1000 = 10%)\n  if (invoice.retention_percent > 0) {\n    const pct = invoice.retention_percent / 100\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(...mid)\n    doc.text(`Retention (${pct}%)`, totalsX, y)\n    doc.setTextColor(220, 38, 38)\n    doc.text(`-${formatCurrency(invoice.retention_amount)}`, totalsVal, y, { align: 'right' })\n    y += 6\n  }\n\n  // Divider\n  drawRule(doc, totalsX, y, totalsVal, border, 0.5)\n  y += 6\n\n  // Total Due — prominent branded block\n  const totalBoxH = 12\n  doc.setFillColor(...primary)\n  doc.roundedRect(totalsX - 4, y - 3, totalsW + 4, totalBoxH, 2, 2, 'F')\n  doc.setFontSize(11)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(255, 255, 255)\n  doc.text('Total Due', totalsX, y + 5)\n  doc.text(formatCurrency(invoice.total), totalsVal, y + 5, { align: 'right' })\n  y += totalBoxH + 10\n\n  // ============================================================\n  // NOTES\n  // ============================================================\n  if (invoice.notes) {\n    if (y > pageHeight - 50) { doc.addPage(); y = margin }\n\n    doc.setFontSize(8)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(...subtle)\n    doc.text('NOTES', margin, y)\n    y += 5\n    drawRule(doc, margin, y, pageWidth - margin, border)\n    y += 5\n\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(...mid)\n    const noteLines = doc.splitTextToSize(invoice.notes, contentWidth)\n    noteLines.forEach(line => { doc.text(line, margin, y); y += 4.5 })\n  }\n\n  // ============================================================\n  // FOOTER (all pages)\n  // ============================================================\n  const totalPgs = doc.internal.getNumberOfPages()\n  for (let i = 1; i <= totalPgs; i++) {\n    doc.setPage(i)\n    const fy = pageHeight - 10\n    drawRule(doc, margin, fy - 4, pageWidth - margin, border, 0.3)\n    doc.setFontSize(7.5)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(...subtle)\n    doc.text(\n      `Invoice ${invoice.invoice_number || ''}  ·  Generated ${new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`,\n      margin,\n      fy\n    )\n    doc.text(`Page ${i} of ${totalPgs}`, pageWidth - margin, fy, { align: 'right' })\n  }\n\n  return doc\n}\n\n/**\n * Generate and download invoice PDF\n */\nexport async function downloadInvoicePDF(invoice, project, company) {\n  const doc = await generateInvoicePDF(invoice, project, company)\n  const safeName = (project?.name || 'Project').replace(/\\s+/g, '_')\n  const fileName = `Invoice_${invoice.invoice_number || 'draft'}_${project?.job_number || safeName}.pdf`\n  doc.save(fileName)\n  return fileName\n}\n\n/**\n * Generate invoice PDF as blob for email / preview\n */\nexport async function getInvoicePDFBlob(invoice, project, company) {\n  const doc = await generateInvoicePDF(invoice, project, company)\n  return doc.output('blob')\n}\n","import { useState, useEffect, useMemo } from 'react'\nimport { X, Receipt, Plus, Trash2, FileText, Loader2 } from 'lucide-react'\nimport { db } from '../../lib/supabase'\nimport { formatCurrency, dollarsToCents } from '../../lib/corCalculations'\n\nexport default function InvoiceModal({\n  project,\n  company,\n  user,\n  selectedItems = { cors: [], tickets: [] },\n  onClose,\n  onSuccess\n}) {\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [invoiceNumber, setInvoiceNumber] = useState('')\n  const [invoiceDate, setInvoiceDate] = useState(new Date().toISOString().split('T')[0])\n  const [dueDate, setDueDate] = useState('')\n  const [retentionPercent, setRetentionPercent] = useState(0)\n  const [notes, setNotes] = useState('')\n  const [terms, setTerms] = useState('Net 30')\n  const [manualItems, setManualItems] = useState([])\n  const [errors, setErrors] = useState({})\n\n  // Initialize due date and invoice number\n  useEffect(() => {\n    const initData = async () => {\n      try {\n        // Set due date to 30 days from now\n        const due = new Date()\n        due.setDate(due.getDate() + 30)\n        setDueDate(due.toISOString().split('T')[0])\n\n        // Get next invoice number\n        const nextNumber = await db.getNextInvoiceNumber(company.id)\n        setInvoiceNumber(nextNumber)\n      } catch (error) {\n        console.error('Error initializing invoice:', error)\n      } finally {\n        setLoading(false)\n      }\n    }\n    initData()\n  }, [company.id])\n\n  // Build line items from selected CORs and T&M tickets\n  const lineItems = useMemo(() => {\n    const items = []\n\n    // Add CORs\n    selectedItems.cors.forEach(cor => {\n      items.push({\n        id: cor.id,\n        item_type: 'cor',\n        reference_id: cor.id,\n        reference_number: cor.cor_number,\n        description: `COR ${cor.cor_number}: ${cor.title || 'Change Order'}`,\n        amount: cor.cor_total || 0 // Already in cents\n      })\n    })\n\n    // Add T&M tickets\n    selectedItems.tickets.forEach(ticket => {\n      items.push({\n        id: ticket.id,\n        item_type: 'tm_ticket',\n        reference_id: ticket.id,\n        reference_number: ticket.ce_pco_number || null,\n        description: `T&M Ticket - ${new Date(ticket.work_date).toLocaleDateString()}`,\n        amount: (parseFloat(ticket.change_order_value) || 0) * 100 // Convert to cents\n      })\n    })\n\n    // Add manual items\n    manualItems.forEach((item, index) => {\n      items.push({\n        id: `manual-${index}`,\n        item_type: 'manual',\n        reference_id: null,\n        reference_number: null,\n        description: item.description,\n        amount: dollarsToCents(parseFloat(item.amount) || 0)\n      })\n    })\n\n    return items\n  }, [selectedItems, manualItems])\n\n  // Calculate totals\n  const totals = useMemo(() => {\n    const subtotal = lineItems.reduce((sum, item) => sum + item.amount, 0)\n    const retentionAmount = Math.round(subtotal * retentionPercent / 100)\n    const total = subtotal - retentionAmount\n\n    return {\n      subtotal,\n      retentionAmount,\n      total\n    }\n  }, [lineItems, retentionPercent])\n\n  // Add manual line item\n  const addManualItem = () => {\n    setManualItems(prev => [...prev, { description: '', amount: '' }])\n  }\n\n  // Update manual line item\n  const updateManualItem = (index, field, value) => {\n    setManualItems(prev => {\n      const updated = [...prev]\n      updated[index] = { ...updated[index], [field]: value }\n      return updated\n    })\n  }\n\n  // Remove manual line item\n  const removeManualItem = (index) => {\n    setManualItems(prev => prev.filter((_, i) => i !== index))\n  }\n\n  // Validate form\n  const validate = () => {\n    const newErrors = {}\n\n    if (!invoiceNumber.trim()) {\n      newErrors.invoiceNumber = 'Invoice number is required'\n    }\n\n    if (!invoiceDate) {\n      newErrors.invoiceDate = 'Invoice date is required'\n    }\n\n    if (lineItems.length === 0) {\n      newErrors.items = 'At least one line item is required'\n    }\n\n    // Validate manual items\n    manualItems.forEach((item, index) => {\n      if (!item.description.trim()) {\n        newErrors[`manual-${index}-desc`] = 'Description required'\n      }\n      if (!item.amount || parseFloat(item.amount) <= 0) {\n        newErrors[`manual-${index}-amount`] = 'Valid amount required'\n      }\n    })\n\n    setErrors(newErrors)\n    return Object.keys(newErrors).length === 0\n  }\n\n  // Handle save\n  const handleSave = async () => {\n    if (!validate()) return\n\n    setSaving(true)\n    try {\n      // Prepare invoice data\n      const invoiceData = {\n        project_id: project.id,\n        company_id: company.id,\n        invoice_number: invoiceNumber,\n        invoice_date: invoiceDate,\n        due_date: dueDate || null,\n        status: 'draft',\n        retention_percent: retentionPercent * 100, // Convert to basis points\n        bill_to_name: project.general_contractor || '',\n        bill_to_address: project.address || '',\n        notes: notes || null,\n        terms: terms || 'Net 30',\n        created_by: user?.id\n      }\n\n      // Prepare items (filter out temp IDs)\n      const itemsData = lineItems.map(item => ({\n        item_type: item.item_type,\n        reference_id: item.item_type !== 'manual' ? item.reference_id : null,\n        reference_number: item.reference_number,\n        description: item.description,\n        amount: item.amount\n      }))\n\n      // Create invoice\n      const invoice = await db.createInvoice(invoiceData, itemsData)\n\n      // Mark CORs and T&M tickets as billed\n      const corIds = selectedItems.cors.map(c => c.id)\n      const tmIds = selectedItems.tickets.map(t => t.id)\n      await db.markItemsBilled(corIds, tmIds)\n\n      onSuccess?.(invoice)\n    } catch (error) {\n      console.error('Error creating invoice:', error)\n      setErrors({ submit: 'Failed to create invoice. Please try again.' })\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"modal-overlay\">\n        <div className=\"modal-content invoice-modal\">\n          <div className=\"invoice-loading\">\n            <Loader2 size={24} className=\"spinning\" />\n            <span>Loading...</span>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"modal-overlay\" onClick={onClose}>\n      <div className=\"modal-content invoice-modal\" onClick={e => e.stopPropagation()}>\n        <div className=\"modal-header\">\n          <h2>\n            <Receipt size={20} />\n            Create Invoice\n          </h2>\n          <button className=\"close-btn\" onClick={onClose} aria-label=\"Close\">\n            <X size={20} />\n          </button>\n        </div>\n\n        <div className=\"modal-body\">\n          {/* Invoice Header Fields */}\n          <div className=\"invoice-header-fields\">\n            <div className=\"form-row\">\n              <div className=\"form-group\">\n                <label htmlFor=\"invoice-number\">Invoice Number *</label>\n                <input\n                  id=\"invoice-number\"\n                  type=\"text\"\n                  value={invoiceNumber}\n                  onChange={e => setInvoiceNumber(e.target.value)}\n                  className={errors.invoiceNumber ? 'error' : ''}\n                />\n                {errors.invoiceNumber && (\n                  <span className=\"form-error\">{errors.invoiceNumber}</span>\n                )}\n              </div>\n\n              <div className=\"form-group\">\n                <label htmlFor=\"invoice-date\">Invoice Date *</label>\n                <input\n                  id=\"invoice-date\"\n                  type=\"date\"\n                  value={invoiceDate}\n                  onChange={e => setInvoiceDate(e.target.value)}\n                  className={errors.invoiceDate ? 'error' : ''}\n                />\n              </div>\n\n              <div className=\"form-group\">\n                <label htmlFor=\"due-date\">Due Date</label>\n                <input\n                  id=\"due-date\"\n                  type=\"date\"\n                  value={dueDate}\n                  onChange={e => setDueDate(e.target.value)}\n                />\n              </div>\n            </div>\n\n            <div className=\"form-row\">\n              <div className=\"form-group\">\n                <label htmlFor=\"bill-to\">Bill To</label>\n                <input\n                  id=\"bill-to\"\n                  type=\"text\"\n                  value={project.general_contractor || ''}\n                  disabled\n                  className=\"disabled\"\n                />\n              </div>\n\n              <div className=\"form-group retention-group\">\n                <label htmlFor=\"retention\">Retention %</label>\n                <div className=\"input-with-suffix\">\n                  <input\n                    id=\"retention\"\n                    type=\"number\"\n                    min=\"0\"\n                    max=\"100\"\n                    step=\"0.5\"\n                    value={retentionPercent}\n                    onChange={e => setRetentionPercent(parseFloat(e.target.value) || 0)}\n                  />\n                  <span className=\"input-suffix\">%</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Line Items */}\n          <div className=\"invoice-line-items\">\n            <div className=\"line-items-header\">\n              <h4>Line Items</h4>\n              <button\n                type=\"button\"\n                className=\"btn btn-text btn-sm\"\n                onClick={addManualItem}\n              >\n                <Plus size={14} />\n                Add Item\n              </button>\n            </div>\n\n            {errors.items && (\n              <div className=\"form-error\">{errors.items}</div>\n            )}\n\n            <div className=\"line-items-table\">\n              <div className=\"line-items-table-header\">\n                <span className=\"col-type\">Type</span>\n                <span className=\"col-desc\">Description</span>\n                <span className=\"col-amount\">Amount</span>\n                <span className=\"col-action\"></span>\n              </div>\n\n              {lineItems.map((item, index) => (\n                <div key={item.id} className=\"line-item-row\">\n                  <span className=\"col-type\">\n                    {item.item_type === 'cor' && <FileText size={14} />}\n                    {item.item_type === 'tm_ticket' && <FileText size={14} />}\n                    {item.item_type === 'manual' && <Plus size={14} />}\n                    {item.item_type === 'cor' ? 'COR' : item.item_type === 'tm_ticket' ? 'T&M' : 'Manual'}\n                  </span>\n\n                  {item.item_type === 'manual' ? (\n                    <>\n                      <input\n                        type=\"text\"\n                        className={`col-desc ${errors[`manual-${index - selectedItems.cors.length - selectedItems.tickets.length}-desc`] ? 'error' : ''}`}\n                        value={manualItems[index - selectedItems.cors.length - selectedItems.tickets.length]?.description || ''}\n                        onChange={e => updateManualItem(\n                          index - selectedItems.cors.length - selectedItems.tickets.length,\n                          'description',\n                          e.target.value\n                        )}\n                        placeholder=\"Description\"\n                      />\n                      <div className=\"col-amount\">\n                        <span className=\"currency-prefix\">$</span>\n                        <input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          className={errors[`manual-${index - selectedItems.cors.length - selectedItems.tickets.length}-amount`] ? 'error' : ''}\n                          value={manualItems[index - selectedItems.cors.length - selectedItems.tickets.length]?.amount || ''}\n                          onChange={e => updateManualItem(\n                            index - selectedItems.cors.length - selectedItems.tickets.length,\n                            'amount',\n                            e.target.value\n                          )}\n                          placeholder=\"0.00\"\n                        />\n                      </div>\n                      <button\n                        type=\"button\"\n                        className=\"btn btn-icon btn-ghost col-action\"\n                        onClick={() => removeManualItem(index - selectedItems.cors.length - selectedItems.tickets.length)}\n                      >\n                        <Trash2 size={14} />\n                      </button>\n                    </>\n                  ) : (\n                    <>\n                      <span className=\"col-desc\">{item.description}</span>\n                      <span className=\"col-amount\">{formatCurrency(item.amount)}</span>\n                      <span className=\"col-action\"></span>\n                    </>\n                  )}\n                </div>\n              ))}\n            </div>\n\n            {/* Totals */}\n            <div className=\"invoice-totals\">\n              <div className=\"total-row\">\n                <span>Subtotal</span>\n                <span>{formatCurrency(totals.subtotal)}</span>\n              </div>\n              {retentionPercent > 0 && (\n                <div className=\"total-row retention\">\n                  <span>Retention ({retentionPercent}%)</span>\n                  <span>-{formatCurrency(totals.retentionAmount)}</span>\n                </div>\n              )}\n              <div className=\"total-row grand-total\">\n                <span>Total Due</span>\n                <span>{formatCurrency(totals.total)}</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Notes and Terms */}\n          <div className=\"form-row\">\n            <div className=\"form-group flex-2\">\n              <label htmlFor=\"notes\">Notes</label>\n              <textarea\n                id=\"notes\"\n                value={notes}\n                onChange={e => setNotes(e.target.value)}\n                rows={2}\n                placeholder=\"Additional notes for the client...\"\n              />\n            </div>\n            <div className=\"form-group\">\n              <label htmlFor=\"terms\">Payment Terms</label>\n              <select\n                id=\"terms\"\n                value={terms}\n                onChange={e => setTerms(e.target.value)}\n              >\n                <option value=\"Due on Receipt\">Due on Receipt</option>\n                <option value=\"Net 15\">Net 15</option>\n                <option value=\"Net 30\">Net 30</option>\n                <option value=\"Net 45\">Net 45</option>\n                <option value=\"Net 60\">Net 60</option>\n              </select>\n            </div>\n          </div>\n\n          {errors.submit && (\n            <div className=\"form-error submit-error\">{errors.submit}</div>\n          )}\n        </div>\n\n        <div className=\"modal-footer\">\n          <button\n            type=\"button\"\n            className=\"btn btn-secondary\"\n            onClick={onClose}\n            disabled={saving}\n          >\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            className=\"btn btn-primary\"\n            onClick={handleSave}\n            disabled={saving || lineItems.length === 0}\n          >\n            {saving ? (\n              <>\n                <Loader2 size={16} className=\"spinning\" />\n                Creating...\n              </>\n            ) : (\n              <>\n                <Receipt size={16} />\n                Create Invoice\n              </>\n            )}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { useState, useEffect, useMemo, useRef, useCallback } from 'react'\nimport { Receipt, Plus, FileText, ClipboardList, Send, DollarSign, Download, MoreVertical, CheckCircle, AlertCircle, Eye, X } from 'lucide-react'\nimport { db } from '../../lib/supabase'\nimport { formatCurrency } from '../../lib/corCalculations'\nimport { downloadInvoicePDF } from '../../lib/invoicePdfGenerator'\nimport InvoiceModal from './InvoiceModal'\n\n// Status display configuration\nconst STATUS_CONFIG = {\n  draft: { label: 'Draft', icon: FileText, className: 'status-draft' },\n  sent: { label: 'Sent', icon: Send, className: 'status-sent' },\n  partial: { label: 'Partial', icon: AlertCircle, className: 'status-partial' },\n  paid: { label: 'Paid', icon: CheckCircle, className: 'status-paid' },\n  void: { label: 'Void', icon: AlertCircle, className: 'status-void' }\n}\n\nexport default function BillingCenter({ project, company, user, onShowToast }) {\n  const [billableItems, setBillableItems] = useState({ cors: [], tickets: [] })\n  const [invoices, setInvoices] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [selectedItems, setSelectedItems] = useState({ cors: new Set(), tickets: new Set() })\n  const [showInvoiceModal, setShowInvoiceModal] = useState(false)\n  const [editingInvoice, setEditingInvoice] = useState(null)\n  const [activeDropdown, setActiveDropdown] = useState(null)\n  const [viewingInvoice, setViewingInvoice] = useState(null)\n  const [actionLoading, setActionLoading] = useState(false)\n  const dropdownRef = useRef(null)\n\n  // Load billable items and invoices\n  useEffect(() => {\n    loadData()\n  }, [project.id])\n\n  const loadData = async () => {\n    try {\n      setLoading(true)\n      const [billable, projectInvoices] = await Promise.all([\n        db.getBillableItems(project.id),\n        db.getProjectInvoices(project.id)\n      ])\n      setBillableItems(billable)\n      setInvoices(projectInvoices)\n    } catch (error) {\n      console.error('Error loading billing data:', error)\n      onShowToast?.('Error loading billing data', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n        setActiveDropdown(null)\n      }\n    }\n\n    if (activeDropdown) {\n      document.addEventListener('mousedown', handleClickOutside)\n      return () => document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [activeDropdown])\n\n  // Toggle dropdown for an invoice\n  const toggleDropdown = useCallback((invoiceId, e) => {\n    e.stopPropagation()\n    setActiveDropdown(prev => prev === invoiceId ? null : invoiceId)\n  }, [])\n\n  // View invoice details\n  const handleViewInvoice = useCallback(async (invoice) => {\n    setActiveDropdown(null)\n    try {\n      // Fetch full invoice with items\n      const fullInvoice = await db.getInvoice(invoice.id)\n      setViewingInvoice(fullInvoice)\n    } catch (error) {\n      console.error('Error fetching invoice:', error)\n      onShowToast?.('Error loading invoice details', 'error')\n    }\n  }, []) // onShowToast is stable (memoized in App.jsx)\n\n  // Download invoice PDF\n  const handleDownloadPDF = useCallback(async (invoice) => {\n    setActiveDropdown(null)\n    setActionLoading(true)\n    try {\n      // Fetch full invoice with items if not already loaded\n      const fullInvoice = await db.getInvoice(invoice.id)\n      const fileName = await downloadInvoicePDF(fullInvoice, project, company)\n      onShowToast?.(`Downloaded ${fileName}`, 'success')\n    } catch (error) {\n      console.error('Error generating PDF:', error)\n      onShowToast?.('Error generating PDF', 'error')\n    } finally {\n      setActionLoading(false)\n    }\n  }, [project, company]) // onShowToast is stable\n\n  // Mark invoice as sent\n  const handleMarkSent = useCallback(async (invoice) => {\n    setActiveDropdown(null)\n    if (invoice.status !== 'draft') {\n      onShowToast?.('Only draft invoices can be marked as sent', 'error')\n      return\n    }\n    try {\n      await db.markInvoiceSent(invoice.id)\n      await loadData()\n      onShowToast?.(`Invoice ${invoice.invoice_number} marked as sent`, 'success')\n    } catch (error) {\n      console.error('Error updating invoice:', error)\n      onShowToast?.('Error updating invoice', 'error')\n    }\n  }, []) // onShowToast is stable\n\n  // Mark invoice as paid\n  const handleMarkPaid = useCallback(async (invoice) => {\n    setActiveDropdown(null)\n    if (invoice.status === 'paid') {\n      onShowToast?.('Invoice is already marked as paid', 'error')\n      return\n    }\n    try {\n      await db.updateInvoice(invoice.id, {\n        status: 'paid',\n        paid_at: new Date().toISOString(),\n        amount_paid: invoice.total\n      })\n      await loadData()\n      onShowToast?.(`Invoice ${invoice.invoice_number} marked as paid`, 'success')\n    } catch (error) {\n      console.error('Error updating invoice:', error)\n      onShowToast?.('Error updating invoice', 'error')\n    }\n  }, []) // onShowToast is stable\n\n  // Calculate totals\n  const totals = useMemo(() => {\n    const selectedCORsTotal = billableItems.cors\n      .filter(cor => selectedItems.cors.has(cor.id))\n      .reduce((sum, cor) => sum + (cor.cor_total || 0), 0)\n\n    const selectedTicketsTotal = billableItems.tickets\n      .filter(t => selectedItems.tickets.has(t.id))\n      .reduce((sum, t) => sum + (parseFloat(t.change_order_value) || 0) * 100, 0) // Convert to cents\n\n    const allCORsTotal = billableItems.cors.reduce((sum, cor) => sum + (cor.cor_total || 0), 0)\n    const allTicketsTotal = billableItems.tickets.reduce((sum, t) => sum + (parseFloat(t.change_order_value) || 0) * 100, 0)\n\n    return {\n      selected: selectedCORsTotal + selectedTicketsTotal,\n      total: allCORsTotal + allTicketsTotal,\n      selectedCount: selectedItems.cors.size + selectedItems.tickets.size\n    }\n  }, [billableItems, selectedItems])\n\n  // Toggle item selection\n  const toggleCOR = (corId) => {\n    setSelectedItems(prev => {\n      const newCORs = new Set(prev.cors)\n      if (newCORs.has(corId)) {\n        newCORs.delete(corId)\n      } else {\n        newCORs.add(corId)\n      }\n      return { ...prev, cors: newCORs }\n    })\n  }\n\n  const toggleTicket = (ticketId) => {\n    setSelectedItems(prev => {\n      const newTickets = new Set(prev.tickets)\n      if (newTickets.has(ticketId)) {\n        newTickets.delete(ticketId)\n      } else {\n        newTickets.add(ticketId)\n      }\n      return { ...prev, tickets: newTickets }\n    })\n  }\n\n  // Select all billable items\n  const selectAll = () => {\n    setSelectedItems({\n      cors: new Set(billableItems.cors.map(c => c.id)),\n      tickets: new Set(billableItems.tickets.map(t => t.id))\n    })\n  }\n\n  // Clear selection\n  const clearSelection = () => {\n    setSelectedItems({ cors: new Set(), tickets: new Set() })\n  }\n\n  // Open invoice modal with selected items\n  const handleCreateInvoice = () => {\n    setEditingInvoice(null)\n    setShowInvoiceModal(true)\n  }\n\n  // Handle invoice creation success\n  const handleInvoiceCreated = async (invoice) => {\n    setShowInvoiceModal(false)\n    clearSelection()\n    await loadData()\n    onShowToast?.(`Invoice ${invoice.invoice_number} created`, 'success')\n  }\n\n  // Get selected items for invoice modal\n  const getSelectedItemsForInvoice = () => {\n    const cors = billableItems.cors.filter(c => selectedItems.cors.has(c.id))\n    const tickets = billableItems.tickets.filter(t => selectedItems.tickets.has(t.id))\n    return { cors, tickets }\n  }\n\n  // Format date for display\n  const formatDate = (dateStr) => {\n    if (!dateStr) return '-'\n    return new Date(dateStr).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: '2-digit'\n    })\n  }\n\n  const hasBillableItems = billableItems.cors.length > 0 || billableItems.tickets.length > 0\n  const hasSelection = totals.selectedCount > 0\n\n  if (loading) {\n    return (\n      <div className=\"billing-center loading\">\n        <div className=\"billing-loading\">\n          <div className=\"spinner\" />\n          <span>Loading billing data...</span>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"billing-center\">\n      {/* Ready to Bill Section */}\n      <div className=\"billing-section\">\n        <div className=\"billing-section-header\">\n          <div className=\"billing-section-title\">\n            <Receipt size={20} />\n            <h3>Ready to Bill</h3>\n            {hasBillableItems && (\n              <span className=\"billing-count\">\n                {billableItems.cors.length + billableItems.tickets.length} items\n              </span>\n            )}\n          </div>\n          {hasBillableItems && (\n            <div className=\"billing-section-actions\">\n              <button\n                className=\"btn btn-text btn-sm\"\n                onClick={hasSelection ? clearSelection : selectAll}\n              >\n                {hasSelection ? 'Clear Selection' : 'Select All'}\n              </button>\n            </div>\n          )}\n        </div>\n\n        {!hasBillableItems ? (\n          <div className=\"billing-empty-state\">\n            <CheckCircle size={32} className=\"text-success\" />\n            <p>No items ready to bill</p>\n            <span>Approved CORs and signed T&M tickets will appear here</span>\n          </div>\n        ) : (\n          <>\n            {/* CORs Section */}\n            {billableItems.cors.length > 0 && (\n              <div className=\"billable-group\">\n                <div className=\"billable-group-header\">\n                  <FileText size={16} />\n                  <span>Change Orders ({billableItems.cors.length})</span>\n                </div>\n                <div className=\"billable-items\">\n                  {billableItems.cors.map(cor => (\n                    <label\n                      key={cor.id}\n                      className={`billable-item ${selectedItems.cors.has(cor.id) ? 'selected' : ''}`}\n                    >\n                      <input\n                        type=\"checkbox\"\n                        checked={selectedItems.cors.has(cor.id)}\n                        onChange={() => toggleCOR(cor.id)}\n                      />\n                      <div className=\"billable-item-content\">\n                        <span className=\"billable-item-number\">{cor.cor_number}</span>\n                        <span className=\"billable-item-title\">{cor.title || 'Untitled COR'}</span>\n                      </div>\n                      <span className=\"billable-item-amount\">\n                        {formatCurrency(cor.cor_total || 0)}\n                      </span>\n                    </label>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* T&M Tickets Section */}\n            {billableItems.tickets.length > 0 && (\n              <div className=\"billable-group\">\n                <div className=\"billable-group-header\">\n                  <ClipboardList size={16} />\n                  <span>T&M Tickets ({billableItems.tickets.length})</span>\n                </div>\n                <div className=\"billable-items\">\n                  {billableItems.tickets.map(ticket => (\n                    <label\n                      key={ticket.id}\n                      className={`billable-item ${selectedItems.tickets.has(ticket.id) ? 'selected' : ''}`}\n                    >\n                      <input\n                        type=\"checkbox\"\n                        checked={selectedItems.tickets.has(ticket.id)}\n                        onChange={() => toggleTicket(ticket.id)}\n                      />\n                      <div className=\"billable-item-content\">\n                        <span className=\"billable-item-number\">\n                          {ticket.ce_pco_number || formatDate(ticket.work_date)}\n                        </span>\n                        <span className=\"billable-item-title\">\n                          T&M Ticket - {formatDate(ticket.work_date)}\n                        </span>\n                      </div>\n                      <span className=\"billable-item-amount\">\n                        {formatCurrency((parseFloat(ticket.change_order_value) || 0) * 100)}\n                      </span>\n                    </label>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Selection Summary & Action */}\n            <div className=\"billing-action-bar\">\n              <div className=\"billing-action-summary\">\n                <span className=\"selected-count\">\n                  {totals.selectedCount} of {billableItems.cors.length + billableItems.tickets.length} selected\n                </span>\n                <span className=\"selected-total\">\n                  {formatCurrency(totals.selected)}\n                </span>\n              </div>\n              <button\n                className=\"btn btn-primary\"\n                disabled={!hasSelection}\n                onClick={handleCreateInvoice}\n              >\n                <Plus size={16} />\n                Create Invoice\n              </button>\n            </div>\n          </>\n        )}\n      </div>\n\n      {/* Recent Invoices Section */}\n      <div className=\"billing-section\">\n        <div className=\"billing-section-header\">\n          <div className=\"billing-section-title\">\n            <DollarSign size={20} />\n            <h3>Invoices</h3>\n            {invoices.length > 0 && (\n              <span className=\"billing-count\">{invoices.length}</span>\n            )}\n          </div>\n        </div>\n\n        {invoices.length === 0 ? (\n          <div className=\"billing-empty-state\">\n            <Receipt size={32} />\n            <p>No invoices yet</p>\n            <span>Create an invoice from the items above</span>\n          </div>\n        ) : (\n          <div className=\"invoice-list\">\n            {invoices.map(invoice => {\n              const StatusIcon = STATUS_CONFIG[invoice.status]?.icon || FileText\n              const isDropdownOpen = activeDropdown === invoice.id\n              return (\n                <div key={invoice.id} className=\"invoice-row\">\n                  <div className=\"invoice-info\">\n                    <span className=\"invoice-number\">{invoice.invoice_number}</span>\n                    <span className=\"invoice-date\">{formatDate(invoice.invoice_date)}</span>\n                  </div>\n                  <span className=\"invoice-amount\">\n                    {formatCurrency(invoice.total || 0)}\n                  </span>\n                  <span className={`invoice-status ${STATUS_CONFIG[invoice.status]?.className || ''}`}>\n                    <StatusIcon size={14} />\n                    {STATUS_CONFIG[invoice.status]?.label || invoice.status}\n                  </span>\n                  <div className=\"invoice-actions\">\n                    <button\n                      className=\"btn btn-sm btn-secondary\"\n                      title=\"View invoice details\"\n                      onClick={() => handleViewInvoice(invoice)}\n                      disabled={actionLoading}\n                    >\n                      <Eye size={14} />\n                      View\n                    </button>\n                    <button\n                      className=\"btn btn-sm btn-primary\"\n                      title=\"Download PDF\"\n                      onClick={() => handleDownloadPDF(invoice)}\n                      disabled={actionLoading}\n                    >\n                      <Download size={14} />\n                      PDF\n                    </button>\n                  </div>\n                  <div className=\"invoice-actions-container\" ref={isDropdownOpen ? dropdownRef : null}>\n                    <button\n                      className=\"btn btn-icon btn-ghost\"\n                      title=\"More options\"\n                      onClick={(e) => toggleDropdown(invoice.id, e)}\n                      disabled={actionLoading}\n                    >\n                      <MoreVertical size={16} />\n                    </button>\n                    {isDropdownOpen && (\n                      <div className=\"invoice-dropdown\">\n                        <button\n                          className=\"dropdown-item\"\n                          onClick={() => handleViewInvoice(invoice)}\n                        >\n                          <Eye size={14} />\n                          View Details\n                        </button>\n                        <button\n                          className=\"dropdown-item\"\n                          onClick={() => handleDownloadPDF(invoice)}\n                        >\n                          <Download size={14} />\n                          Download PDF\n                        </button>\n                        {invoice.status === 'draft' && (\n                          <button\n                            className=\"dropdown-item\"\n                            onClick={() => handleMarkSent(invoice)}\n                          >\n                            <Send size={14} />\n                            Mark as Sent\n                          </button>\n                        )}\n                        {invoice.status !== 'paid' && invoice.status !== 'void' && (\n                          <button\n                            className=\"dropdown-item success\"\n                            onClick={() => handleMarkPaid(invoice)}\n                          >\n                            <CheckCircle size={14} />\n                            Mark as Paid\n                          </button>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Invoice Modal */}\n      {showInvoiceModal && (\n        <InvoiceModal\n          project={project}\n          company={company}\n          user={user}\n          selectedItems={getSelectedItemsForInvoice()}\n          onClose={() => setShowInvoiceModal(false)}\n          onSuccess={handleInvoiceCreated}\n        />\n      )}\n\n      {/* Invoice Detail View Modal */}\n      {viewingInvoice && (\n        <div className=\"modal-overlay\" onClick={() => setViewingInvoice(null)}>\n          <div className=\"modal invoice-detail-modal\" onClick={e => e.stopPropagation()}>\n            <div className=\"modal-header\">\n              <h2>Invoice {viewingInvoice.invoice_number}</h2>\n              <button className=\"btn btn-icon btn-ghost\" onClick={() => setViewingInvoice(null)}>\n                <X size={20} />\n              </button>\n            </div>\n            <div className=\"modal-body\">\n              <div className=\"invoice-detail-header\">\n                <div className=\"invoice-detail-info\">\n                  <div className=\"detail-row\">\n                    <span className=\"detail-label\">Date:</span>\n                    <span className=\"detail-value\">{formatDate(viewingInvoice.invoice_date)}</span>\n                  </div>\n                  <div className=\"detail-row\">\n                    <span className=\"detail-label\">Due:</span>\n                    <span className=\"detail-value\">{viewingInvoice.due_date ? formatDate(viewingInvoice.due_date) : 'Upon Receipt'}</span>\n                  </div>\n                  <div className=\"detail-row\">\n                    <span className=\"detail-label\">Status:</span>\n                    <span className={`invoice-status ${STATUS_CONFIG[viewingInvoice.status]?.className || ''}`}>\n                      {STATUS_CONFIG[viewingInvoice.status]?.label || viewingInvoice.status}\n                    </span>\n                  </div>\n                </div>\n                <div className=\"invoice-detail-billto\">\n                  <span className=\"detail-label\">Bill To:</span>\n                  <div className=\"billto-content\">\n                    {viewingInvoice.bill_to_name && <p>{viewingInvoice.bill_to_name}</p>}\n                    {viewingInvoice.bill_to_address && <p>{viewingInvoice.bill_to_address}</p>}\n                    {viewingInvoice.bill_to_contact && <p>{viewingInvoice.bill_to_contact}</p>}\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"invoice-detail-items\">\n                <h3>Line Items</h3>\n                <table className=\"invoice-items-table\">\n                  <thead>\n                    <tr>\n                      <th>Reference</th>\n                      <th>Description</th>\n                      <th className=\"text-right\">Amount</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {(viewingInvoice.invoice_items || []).map((item, idx) => (\n                      <tr key={item.id || idx}>\n                        <td>{item.reference_number || '-'}</td>\n                        <td>{item.description}</td>\n                        <td className=\"text-right\">{formatCurrency(item.amount)}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n\n              <div className=\"invoice-detail-totals\">\n                <div className=\"total-row\">\n                  <span>Subtotal</span>\n                  <span>{formatCurrency(viewingInvoice.subtotal)}</span>\n                </div>\n                {viewingInvoice.retention_percent > 0 && (\n                  <div className=\"total-row retention\">\n                    <span>Retention ({viewingInvoice.retention_percent / 100}%)</span>\n                    <span>-{formatCurrency(viewingInvoice.retention_amount)}</span>\n                  </div>\n                )}\n                <div className=\"total-row grand-total\">\n                  <span>Total Due</span>\n                  <span>{formatCurrency(viewingInvoice.total)}</span>\n                </div>\n                {viewingInvoice.amount_paid > 0 && (\n                  <div className=\"total-row paid\">\n                    <span>Amount Paid</span>\n                    <span>{formatCurrency(viewingInvoice.amount_paid)}</span>\n                  </div>\n                )}\n              </div>\n\n              {viewingInvoice.notes && (\n                <div className=\"invoice-detail-notes\">\n                  <span className=\"detail-label\">Notes:</span>\n                  <p>{viewingInvoice.notes}</p>\n                </div>\n              )}\n            </div>\n            <div className=\"modal-footer\">\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => setViewingInvoice(null)}\n              >\n                Close\n              </button>\n              <button\n                className=\"btn btn-primary\"\n                onClick={() => {\n                  handleDownloadPDF(viewingInvoice)\n                  setViewingInvoice(null)\n                }}\n              >\n                <Download size={16} />\n                Download PDF\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n"],"file":"BillingCenter-DKxs7G4i.js"}