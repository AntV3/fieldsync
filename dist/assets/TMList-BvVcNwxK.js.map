{"version":3,"mappings":"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","names":["TMDashboard","tickets","laborRates","metrics","useMemo","pending","t","approved","billed","rejected","totalHours","regularHours","overtimeHours","workerHoursMap","workersByRole","ticket","worker","regHrs","otHrs","name","role","materialsCost","item","costPer","uniqueWorkers","topWorkers","a","completedTickets","approvalRate","rates","calculateTicketValue","laborCost","rate","pendingValue","sum","approvedValue","billedValue","monthlyData","date","monthKey","monthLabel","byMonth","byStatus","s","formatCurrency","value","CustomTooltip","active","payload","label","jsxs","jsx","entry","index","ClipboardList","Clock","Users","DollarSign","AlertCircle","CheckCircle","FileText","TrendingUp","ResponsiveContainer","PieChart","Pie","percent","Cell","Tooltip","BarChart","CartesianGrid","XAxis","YAxis","Bar","hours","b","percentage","AreaChart","Area","TMTicketCard","memo","isExpanded","isSelected","isLocked","lockInfo","hasFailedImport","isRetrying","onToggleExpand","onToggleSelect","onApprove","onUpdateStatus","onDelete","onOpenCorAssign","onRetryImport","onShowSignatureLink","formatDate","calculateTotalHours","calculateTicketTotal","totalCost","handleKeyDown","e","Lock","CountBadge","Camera","AlertTriangle","HardHat","Wrench","Fragment","photo","idx","Link","Link2","RefreshCw","loadXLSX","loadJsPDF","__vitePreload","n","TMList","project","company","onShowToast","compact","previewMode","onViewAll","branding","useBranding","setTickets","useState","loading","setLoading","loadingMore","setLoadingMore","filter","setFilter","expandedTicket","setExpandedTicket","selectedTickets","setSelectedTickets","page","setPage","hasMore","setHasMore","totalCount","setTotalCount","TICKETS_PER_PAGE","MAX_TICKETS_IN_MEMORY","viewMode","setViewMode","displayMode","setDisplayMode","saved","expandedMonths","setExpandedMonths","dateFilter","setDateFilter","showChangeOrderModal","setShowChangeOrderModal","pendingApprovalTicket","setPendingApprovalTicket","changeOrderValue","setChangeOrderValue","showSignatureLink","setShowSignatureLink","signatureLinkTicket","setSignatureLinkTicket","showCorAssignModal","setShowCorAssignModal","pendingCorAssignTicket","setPendingCorAssignTicket","availableCors","setAvailableCors","selectedCorForAssign","setSelectedCorForAssign","loadingCors","setLoadingCors","lockedTickets","setLockedTickets","failedImports","setFailedImports","retryingImport","setRetryingImport","useEffect","loadTickets","subscription","db","pageNum","reset","result","prev","combined","ticketsWithCOR","lockResults","importStatusResults","editResult","importStatus","loadMore","updateStatus","useCallback","ticketId","newStatus","error","handleApprove","confirmChangeOrderApproval","deleteTicket","openCorAssignModal","cors","handleAssignToCor","cor","c","handleRetryImport","next","total","w","regHours","otHours","dateStr","toggleTicketSelection","handleToggleExpand","handleShowSignatureLink","toggleSelectAll","currentFiltered","allSelected","clearSelection","getExportTickets","filtered","exportToExcel","exportTickets","XLSX","workersData","itemsData","summaryData","ticketDate","ticketStatus","itemName","category","unit","wb","summarySheet","workersSheet","itemsSheet","fileName","exportToPDF","jsPDFModule","autoTableModule","jsPDF","autoTable","doc","pageWidth","pageHeight","margin","yPos","primaryColor","hexToRgb","secondaryColor","logoOffset","logoBase64","loadImageAsBase64","dates","startDate","endDate","grandTotalHours","grandTotalMaterials","totalWorkers","boxWidth","summaryBoxData","lightPrimary","boxX","supervisionData","operatorsData","laborersData","supervisionRegHours","supervisionOTHours","operatorsRegHours","operatorsOTHours","laborersRegHours","laborersOTHours","rowData","renderLaborTable","title","data","totalRegHours","totalOTHours","categoryData","categoryTotals","categoryOrder","renderMaterialsTable","subtotal","cat","firstTicket","renderSignatureBlock","startY","signatureData","signerName","signerTitle","signerCompany","signedDate","sigLineY","titleCompany","formattedDate","totalPages","i","footerY","filteredTickets","now","currentMonth","currentYear","sevenDaysAgo","ticketsByMonth","groups","currentMonthKey","toggleMonthExpand","newExpanded","totalTicketsCount","TicketSkeleton","allFilteredSelected","someSelected","renderTicketCard","BarChart3","List","FileSpreadsheet","status","Calendar","monthData","ChevronDown","ChevronRight","SignatureLinkGenerator","X"],"ignoreList":[],"sources":["../../src/components/tm/TMDashboard.jsx","../../src/components/tm/TMTicketCard.jsx","../../src/components/TMList.jsx"],"sourcesContent":["import { useMemo } from 'react'\nimport {\n  PieChart, Pie, Cell, ResponsiveContainer,\n  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend,\n  AreaChart, Area\n} from 'recharts'\nimport {\n  ClipboardList, Clock, DollarSign, Users, TrendingUp,\n  CheckCircle, AlertCircle, XCircle, FileText\n} from 'lucide-react'\n\n/**\n * TMDashboard - Visual summary and charts for T&M Tickets section\n * Shows key metrics, status distribution, and trends\n */\nexport default function TMDashboard({ tickets = [], laborRates = {} }) {\n  // Calculate comprehensive metrics\n  const metrics = useMemo(() => {\n    if (!tickets.length) {\n      return {\n        total: 0,\n        pending: 0,\n        approved: 0,\n        billed: 0,\n        rejected: 0,\n        totalHours: 0,\n        regularHours: 0,\n        overtimeHours: 0,\n        materialsCost: 0,\n        uniqueWorkers: 0,\n        avgHoursPerTicket: 0,\n        approvalRate: 0,\n        pendingValue: 0,\n        approvedValue: 0,\n        billedValue: 0,\n        workersByRole: {},\n        topWorkers: [],\n        byMonth: [],\n        byStatus: []\n      }\n    }\n\n    // Status counts\n    const pending = tickets.filter(t => t.status === 'pending').length\n    const approved = tickets.filter(t => t.status === 'approved').length\n    const billed = tickets.filter(t => t.status === 'billed').length\n    const rejected = tickets.filter(t => t.status === 'rejected').length\n\n    // Hours calculations\n    let totalHours = 0\n    let regularHours = 0\n    let overtimeHours = 0\n    const workerHoursMap = {}\n    const workersByRole = { Foreman: 0, Superintendent: 0, Operator: 0, Laborer: 0 }\n\n    tickets.forEach(ticket => {\n      if (ticket.t_and_m_workers) {\n        ticket.t_and_m_workers.forEach(worker => {\n          const regHrs = parseFloat(worker.hours) || 0\n          const otHrs = parseFloat(worker.overtime_hours) || 0\n          regularHours += regHrs\n          overtimeHours += otHrs\n          totalHours += regHrs + otHrs\n\n          // Track worker hours\n          const name = worker.name || 'Unknown'\n          if (!workerHoursMap[name]) {\n            workerHoursMap[name] = { name, hours: 0, role: worker.role || 'Laborer' }\n          }\n          workerHoursMap[name].hours += regHrs + otHrs\n\n          // Count by role\n          const role = worker.role || 'Laborer'\n          if (workersByRole[role] !== undefined) {\n            workersByRole[role] += regHrs + otHrs\n          } else {\n            workersByRole[role] = regHrs + otHrs\n          }\n        })\n      }\n    })\n\n    // Materials cost calculation\n    let materialsCost = 0\n    tickets.forEach(ticket => {\n      if (ticket.t_and_m_items) {\n        ticket.t_and_m_items.forEach(item => {\n          const costPer = item.materials_equipment?.cost_per_unit || 0\n          materialsCost += item.quantity * costPer\n        })\n      }\n    })\n\n    // Unique workers\n    const uniqueWorkers = Object.keys(workerHoursMap).length\n\n    // Top 5 workers by hours\n    const topWorkers = Object.values(workerHoursMap)\n      .sort((a, b) => b.hours - a.hours)\n      .slice(0, 5)\n\n    // Approval rate\n    const completedTickets = approved + billed + rejected\n    const approvalRate = completedTickets > 0\n      ? Math.round(((approved + billed) / completedTickets) * 100)\n      : 0\n\n    // Value calculations (estimate labor cost using default rates if no rates provided)\n    const defaultRates = {\n      Foreman: 85,\n      Superintendent: 95,\n      Operator: 75,\n      Laborer: 55\n    }\n    const rates = { ...defaultRates, ...laborRates }\n\n    const calculateTicketValue = (ticket) => {\n      let laborCost = 0\n      let materialsCost = 0\n\n      if (ticket.t_and_m_workers) {\n        ticket.t_and_m_workers.forEach(worker => {\n          const role = worker.role || 'Laborer'\n          const rate = rates[role] || rates.Laborer\n          const regHrs = parseFloat(worker.hours) || 0\n          const otHrs = parseFloat(worker.overtime_hours) || 0\n          laborCost += regHrs * rate + otHrs * rate * 1.5\n        })\n      }\n\n      if (ticket.t_and_m_items) {\n        ticket.t_and_m_items.forEach(item => {\n          const costPer = item.materials_equipment?.cost_per_unit || 0\n          materialsCost += item.quantity * costPer\n        })\n      }\n\n      return laborCost + materialsCost\n    }\n\n    const pendingValue = tickets\n      .filter(t => t.status === 'pending')\n      .reduce((sum, t) => sum + calculateTicketValue(t), 0)\n    const approvedValue = tickets\n      .filter(t => t.status === 'approved')\n      .reduce((sum, t) => sum + calculateTicketValue(t), 0)\n    const billedValue = tickets\n      .filter(t => t.status === 'billed')\n      .reduce((sum, t) => sum + calculateTicketValue(t), 0)\n\n    // Monthly data for trend chart\n    const monthlyData = {}\n    tickets.forEach(ticket => {\n      const date = new Date(ticket.work_date)\n      const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`\n      const monthLabel = date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' })\n\n      if (!monthlyData[monthKey]) {\n        monthlyData[monthKey] = {\n          month: monthLabel,\n          monthKey,\n          tickets: 0,\n          hours: 0,\n          cost: 0,\n          value: 0\n        }\n      }\n\n      monthlyData[monthKey].tickets += 1\n      monthlyData[monthKey].cost += calculateTicketValue(ticket) - materialsCost\n\n      if (ticket.t_and_m_workers) {\n        ticket.t_and_m_workers.forEach(worker => {\n          const regHrs = parseFloat(worker.hours) || 0\n          const otHrs = parseFloat(worker.overtime_hours) || 0\n          monthlyData[monthKey].hours += regHrs + otHrs\n        })\n      }\n\n      if (ticket.t_and_m_items) {\n        ticket.t_and_m_items.forEach(item => {\n          const costPer = item.materials_equipment?.cost_per_unit || 0\n          monthlyData[monthKey].value += item.quantity * costPer\n        })\n      }\n    })\n\n    const byMonth = Object.values(monthlyData)\n      .sort((a, b) => a.monthKey.localeCompare(b.monthKey))\n      .slice(-6) // Last 6 months\n\n    // Status distribution for pie chart\n    const byStatus = [\n      { name: 'Pending', value: pending, color: '#f59e0b' },\n      { name: 'Approved', value: approved, color: '#10b981' },\n      { name: 'Billed', value: billed, color: '#3b82f6' },\n      { name: 'Rejected', value: rejected, color: '#ef4444' }\n    ].filter(s => s.value > 0)\n\n    return {\n      total: tickets.length,\n      pending,\n      approved,\n      billed,\n      rejected,\n      totalHours,\n      regularHours,\n      overtimeHours,\n      materialsCost,\n      uniqueWorkers,\n      avgHoursPerTicket: tickets.length > 0 ? totalHours / tickets.length : 0,\n      approvalRate,\n      pendingValue,\n      approvedValue,\n      billedValue,\n      workersByRole,\n      topWorkers,\n      byMonth,\n      byStatus\n    }\n  }, [tickets, laborRates])\n\n  // Format currency\n  const formatCurrency = (value) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0\n    }).format(value)\n  }\n\n  // Custom tooltip for charts\n  const CustomTooltip = ({ active, payload, label }) => {\n    if (active && payload && payload.length) {\n      return (\n        <div className=\"tm-chart-tooltip\">\n          <p className=\"tm-tooltip-label\">{label}</p>\n          {payload.map((entry, index) => (\n            <p key={index} style={{ color: entry.color }}>\n              {entry.name}: {entry.name.includes('Cost') || entry.name.includes('Value')\n                ? formatCurrency(entry.value)\n                : entry.value.toFixed(1)}\n            </p>\n          ))}\n        </div>\n      )\n    }\n    return null\n  }\n\n  if (tickets.length === 0) {\n    return (\n      <div className=\"tm-dashboard tm-dashboard-empty\">\n        <div className=\"tm-empty-icon\">\n          <ClipboardList size={48} />\n        </div>\n        <p>No T&M tickets yet</p>\n        <p className=\"tm-empty-hint\">Create tickets to see analytics and trends</p>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"tm-dashboard\">\n      {/* Summary Cards Row */}\n      <div className=\"tm-summary-cards\">\n        <div className=\"tm-summary-card\">\n          <div className=\"tm-card-icon tickets\">\n            <ClipboardList size={20} />\n          </div>\n          <div className=\"tm-card-content\">\n            <span className=\"tm-card-value\">{metrics.total}</span>\n            <span className=\"tm-card-label\">Total Tickets</span>\n          </div>\n        </div>\n\n        <div className=\"tm-summary-card\">\n          <div className=\"tm-card-icon hours\">\n            <Clock size={20} />\n          </div>\n          <div className=\"tm-card-content\">\n            <span className=\"tm-card-value\">{metrics.totalHours.toFixed(1)}</span>\n            <span className=\"tm-card-label\">Total Hours</span>\n            {metrics.overtimeHours > 0 && (\n              <span className=\"tm-card-detail\">{metrics.overtimeHours.toFixed(1)} OT</span>\n            )}\n          </div>\n        </div>\n\n        <div className=\"tm-summary-card\">\n          <div className=\"tm-card-icon workers\">\n            <Users size={20} />\n          </div>\n          <div className=\"tm-card-content\">\n            <span className=\"tm-card-value\">{metrics.uniqueWorkers}</span>\n            <span className=\"tm-card-label\">Workers</span>\n          </div>\n        </div>\n\n        <div className=\"tm-summary-card\">\n          <div className=\"tm-card-icon materials\">\n            <DollarSign size={20} />\n          </div>\n          <div className=\"tm-card-content\">\n            <span className=\"tm-card-value\">{formatCurrency(metrics.materialsCost)}</span>\n            <span className=\"tm-card-label\">Materials</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Status Overview Cards */}\n      <div className=\"tm-status-cards\">\n        <div className=\"tm-status-card pending\">\n          <div className=\"tm-status-header\">\n            <AlertCircle size={16} />\n            <span>Pending</span>\n          </div>\n          <div className=\"tm-status-count\">{metrics.pending}</div>\n          <div className=\"tm-status-value\">{formatCurrency(metrics.pendingValue)}</div>\n        </div>\n\n        <div className=\"tm-status-card approved\">\n          <div className=\"tm-status-header\">\n            <CheckCircle size={16} />\n            <span>Approved</span>\n          </div>\n          <div className=\"tm-status-count\">{metrics.approved}</div>\n          <div className=\"tm-status-value\">{formatCurrency(metrics.approvedValue)}</div>\n        </div>\n\n        <div className=\"tm-status-card billed\">\n          <div className=\"tm-status-header\">\n            <FileText size={16} />\n            <span>Billed</span>\n          </div>\n          <div className=\"tm-status-count\">{metrics.billed}</div>\n          <div className=\"tm-status-value\">{formatCurrency(metrics.billedValue)}</div>\n        </div>\n\n        <div className=\"tm-status-card rate\">\n          <div className=\"tm-status-header\">\n            <TrendingUp size={16} />\n            <span>Approval Rate</span>\n          </div>\n          <div className=\"tm-status-count\">{metrics.approvalRate}%</div>\n          <div className=\"tm-status-value\">{metrics.approved + metrics.billed} / {metrics.total - metrics.pending}</div>\n        </div>\n      </div>\n\n      {/* Charts Row */}\n      <div className=\"tm-charts-row\">\n        {/* Status Distribution Pie Chart */}\n        {metrics.byStatus.length > 0 && (\n          <div className=\"tm-chart-card\">\n            <h4 className=\"tm-chart-title\">Status Distribution</h4>\n            <div className=\"tm-chart-container\">\n              <ResponsiveContainer width=\"100%\" height={200}>\n                <PieChart>\n                  <Pie\n                    data={metrics.byStatus}\n                    cx=\"50%\"\n                    cy=\"50%\"\n                    innerRadius={50}\n                    outerRadius={80}\n                    paddingAngle={2}\n                    dataKey=\"value\"\n                    label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                    labelLine={false}\n                  >\n                    {metrics.byStatus.map((entry, index) => (\n                      <Cell key={`cell-${index}`} fill={entry.color} />\n                    ))}\n                  </Pie>\n                  <Tooltip />\n                </PieChart>\n              </ResponsiveContainer>\n            </div>\n            <div className=\"tm-chart-legend\">\n              {metrics.byStatus.map((entry, index) => (\n                <div key={index} className=\"tm-legend-item\">\n                  <span className=\"tm-legend-color\" style={{ background: entry.color }} />\n                  <span className=\"tm-legend-label\">{entry.name}</span>\n                  <span className=\"tm-legend-value\">{entry.value}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Hours Trend Bar Chart */}\n        {metrics.byMonth.length > 0 && (\n          <div className=\"tm-chart-card wide\">\n            <h4 className=\"tm-chart-title\">Hours by Month</h4>\n            <div className=\"tm-chart-container\">\n              <ResponsiveContainer width=\"100%\" height={200}>\n                <BarChart data={metrics.byMonth}>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"var(--border-color)\" />\n                  <XAxis\n                    dataKey=\"month\"\n                    tick={{ fill: 'var(--text-secondary)', fontSize: 12 }}\n                    axisLine={{ stroke: 'var(--border-color)' }}\n                  />\n                  <YAxis\n                    tick={{ fill: 'var(--text-secondary)', fontSize: 12 }}\n                    axisLine={{ stroke: 'var(--border-color)' }}\n                  />\n                  <Tooltip content={<CustomTooltip />} />\n                  <Bar\n                    dataKey=\"hours\"\n                    name=\"Hours\"\n                    fill=\"var(--primary-color)\"\n                    radius={[4, 4, 0, 0]}\n                  />\n                </BarChart>\n              </ResponsiveContainer>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Second Charts Row */}\n      <div className=\"tm-charts-row\">\n        {/* Labor by Role */}\n        <div className=\"tm-chart-card\">\n          <h4 className=\"tm-chart-title\">Hours by Role</h4>\n          <div className=\"tm-role-breakdown\">\n            {Object.entries(metrics.workersByRole)\n              .filter(([, hours]) => hours > 0)\n              .sort((a, b) => b[1] - a[1])\n              .map(([role, hours]) => {\n                const percentage = (hours / metrics.totalHours) * 100\n                return (\n                  <div key={role} className=\"tm-role-bar\">\n                    <div className=\"tm-role-info\">\n                      <span className=\"tm-role-name\">{role}</span>\n                      <span className=\"tm-role-hours\">{hours.toFixed(1)} hrs</span>\n                    </div>\n                    <div className=\"tm-role-track\">\n                      <div\n                        className=\"tm-role-fill\"\n                        style={{ width: `${percentage}%` }}\n                      />\n                    </div>\n                  </div>\n                )\n              })}\n          </div>\n        </div>\n\n        {/* Top Workers */}\n        {metrics.topWorkers.length > 0 && (\n          <div className=\"tm-chart-card\">\n            <h4 className=\"tm-chart-title\">Top Workers</h4>\n            <div className=\"tm-top-workers\">\n              {metrics.topWorkers.map((worker, index) => (\n                <div key={worker.name} className=\"tm-worker-row\">\n                  <span className=\"tm-worker-rank\">#{index + 1}</span>\n                  <div className=\"tm-worker-info\">\n                    <span className=\"tm-worker-name\">{worker.name}</span>\n                    <span className=\"tm-worker-role\">{worker.role}</span>\n                  </div>\n                  <span className=\"tm-worker-hours\">{worker.hours.toFixed(1)} hrs</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Tickets Trend */}\n        {metrics.byMonth.length > 1 && (\n          <div className=\"tm-chart-card\">\n            <h4 className=\"tm-chart-title\">Ticket Volume</h4>\n            <div className=\"tm-chart-container\">\n              <ResponsiveContainer width=\"100%\" height={150}>\n                <AreaChart data={metrics.byMonth}>\n                  <defs>\n                    <linearGradient id=\"ticketGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"var(--primary-color)\" stopOpacity={0.3}/>\n                      <stop offset=\"95%\" stopColor=\"var(--primary-color)\" stopOpacity={0}/>\n                    </linearGradient>\n                  </defs>\n                  <XAxis\n                    dataKey=\"month\"\n                    tick={{ fill: 'var(--text-secondary)', fontSize: 10 }}\n                    axisLine={false}\n                    tickLine={false}\n                  />\n                  <YAxis hide />\n                  <Tooltip content={<CustomTooltip />} />\n                  <Area\n                    type=\"monotone\"\n                    dataKey=\"tickets\"\n                    name=\"Tickets\"\n                    stroke=\"var(--primary-color)\"\n                    fill=\"url(#ticketGradient)\"\n                    strokeWidth={2}\n                  />\n                </AreaChart>\n              </ResponsiveContainer>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Quick Stats Footer */}\n      <div className=\"tm-quick-stats\">\n        <div className=\"tm-quick-stat\">\n          <span className=\"tm-quick-label\">Avg Hours/Ticket</span>\n          <span className=\"tm-quick-value\">{metrics.avgHoursPerTicket.toFixed(1)}</span>\n        </div>\n        <div className=\"tm-quick-stat\">\n          <span className=\"tm-quick-label\">Regular Hours</span>\n          <span className=\"tm-quick-value\">{metrics.regularHours.toFixed(1)}</span>\n        </div>\n        <div className=\"tm-quick-stat\">\n          <span className=\"tm-quick-label\">Overtime Hours</span>\n          <span className=\"tm-quick-value\">{metrics.overtimeHours.toFixed(1)}</span>\n        </div>\n        <div className=\"tm-quick-stat\">\n          <span className=\"tm-quick-label\">Total Est. Value</span>\n          <span className=\"tm-quick-value\">{formatCurrency(metrics.pendingValue + metrics.approvedValue + metrics.billedValue)}</span>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { memo } from 'react'\nimport { HardHat, FileText, Wrench, Camera, Link, Lock, Link2, RefreshCw, AlertTriangle, CheckCircle } from 'lucide-react'\nimport { CountBadge } from '../ui'\n\n/**\n * Memoized T&M Ticket Card component\n * Prevents unnecessary re-renders when parent list updates\n */\nconst TMTicketCard = memo(function TMTicketCard({\n  ticket,\n  isExpanded,\n  isSelected,\n  isLocked,\n  lockInfo,\n  hasFailedImport,\n  isRetrying,\n  onToggleExpand,\n  onToggleSelect,\n  onApprove,\n  onUpdateStatus,\n  onDelete,\n  onOpenCorAssign,\n  onRetryImport,\n  onShowSignatureLink,\n  formatDate,\n  calculateTotalHours,\n  calculateTicketTotal\n}) {\n  const totalHours = calculateTotalHours(ticket)\n  const totalCost = calculateTicketTotal(ticket)\n\n  const handleKeyDown = (e) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault()\n      onToggleExpand(ticket.id)\n    }\n  }\n\n  return (\n    <div\n      className={`tm-ticket-card hover-lift animate-fade-in-up ${ticket.status} ${isSelected ? 'selected' : ''} ${isLocked ? 'locked' : ''}`}\n      role=\"article\"\n      aria-label={`T&M Ticket for ${formatDate(ticket.work_date)}, ${totalHours} hours, $${totalCost.toFixed(2)}, status: ${ticket.status}`}\n    >\n      <div\n        className=\"tm-ticket-header\"\n        onClick={() => onToggleExpand(ticket.id)}\n        onKeyDown={handleKeyDown}\n        role=\"button\"\n        tabIndex={0}\n        aria-expanded={isExpanded}\n        aria-label={`${isExpanded ? 'Collapse' : 'Expand'} ticket details`}\n      >\n        <input\n          type=\"checkbox\"\n          checked={isSelected}\n          onChange={(e) => onToggleSelect(ticket.id, e)}\n          onClick={(e) => e.stopPropagation()}\n          className=\"tm-checkbox\"\n          aria-label={`Select ticket for ${formatDate(ticket.work_date)}`}\n        />\n        <div className=\"tm-ticket-info\">\n          <span className=\"tm-ticket-date\">{formatDate(ticket.work_date)}</span>\n          {ticket.ce_pco_number && (\n            <span className=\"tm-ce-badge\">{ticket.ce_pco_number}</span>\n          )}\n          {ticket.assigned_cor_id && lockInfo?.lockedBy && (\n            <span className={`tm-cor-badge ${isLocked ? 'locked' : ''}`} title={lockInfo?.reason}>\n              {isLocked && <Lock size={10} />}\n              {lockInfo.lockedBy.cor_number}\n            </span>\n          )}\n          {ticket.photos?.length > 0 && (\n            <CountBadge\n              count={ticket.photos.length}\n              icon={Camera}\n              size=\"small\"\n              variant=\"default\"\n            />\n          )}\n          {hasFailedImport && (\n            <span className=\"tm-import-failed-badge\" title=\"COR data import failed - retry needed\">\n              <AlertTriangle size={12} /> Import Failed\n            </span>\n          )}\n          {ticket.client_signature_data && (\n            <span className=\"tm-verified-badge\" title={`Verified by ${ticket.client_signature_name || 'client'}${ticket.client_signature_date ? ` on ${formatDate(ticket.client_signature_date)}` : ''}`}>\n              <CheckCircle size={12} /> Verified\n            </span>\n          )}\n          <span className={`tm-ticket-status ${ticket.status}`}>{ticket.status}</span>\n        </div>\n        <div className=\"tm-ticket-summary\">\n          <span className=\"tm-ticket-hours\">{totalHours} hrs</span>\n          <span className=\"tm-ticket-total\">${totalCost.toFixed(2)}</span>\n          <span className=\"tm-expand-arrow\" aria-hidden=\"true\">{isExpanded ? '' : ''}</span>\n        </div>\n      </div>\n\n      {isExpanded && (\n        <div className=\"tm-ticket-details\">\n          {ticket.t_and_m_workers?.length > 0 && (\n            <div className=\"tm-detail-section\">\n              <h4><HardHat size={16} className=\"inline-icon\" /> Workers</h4>\n              <div className=\"tm-detail-list\">\n                {ticket.t_and_m_workers.map(worker => (\n                  <div key={worker.id} className=\"tm-detail-row\">\n                    <span>\n                      {worker.role && worker.role !== 'Laborer' && (\n                        <span className=\"tm-role-badge\">{worker.role}</span>\n                      )}\n                      {worker.name}\n                    </span>\n                    <span>\n                      {worker.hours} hrs\n                      {parseFloat(worker.overtime_hours) > 0 && (\n                        <span className=\"tm-ot-badge\"> +{worker.overtime_hours} OT</span>\n                      )}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {ticket.t_and_m_items?.length > 0 && (\n            <div className=\"tm-detail-section\">\n              <h4><Wrench size={16} className=\"inline-icon\" /> Materials & Equipment</h4>\n              <div className=\"tm-detail-list\">\n                {ticket.t_and_m_items.map(item => (\n                  <div key={item.id} className=\"tm-detail-row\">\n                    <span>\n                      {item.custom_name ? (\n                        <><span className=\"tm-custom-badge\">Custom</span> {item.custom_name}</>\n                      ) : (\n                        item.materials_equipment?.name\n                      )}\n                    </span>\n                    <span className=\"tm-detail-qty\">\n                      {item.quantity} {item.materials_equipment?.unit || 'each'}\n                      {item.materials_equipment?.cost_per_unit > 0 && (\n                        <span className=\"tm-item-cost\">\n                          ${(item.quantity * item.materials_equipment.cost_per_unit).toFixed(2)}\n                        </span>\n                      )}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {ticket.notes && (\n            <div className=\"tm-detail-section\">\n              <h4><FileText size={16} className=\"inline-icon\" /> Description</h4>\n              <p className=\"tm-notes-text\">{ticket.notes}</p>\n            </div>\n          )}\n\n          {ticket.photos && ticket.photos.length > 0 && (\n            <div className=\"tm-detail-section\">\n              <h4><Camera size={16} className=\"inline-icon\" /> Photos ({ticket.photos.length})</h4>\n              <div className=\"tm-photos-grid\">\n                {ticket.photos.map((photo, idx) => (\n                  <a key={idx} href={photo} target=\"_blank\" rel=\"noopener noreferrer\" className=\"tm-photo-thumb\">\n                    <img\n                      src={photo}\n                      alt={`Photo ${idx + 1}`}\n                      onError={(e) => {\n                        e.target.onerror = null\n                        e.target.classList.add('photo-error')\n                        e.target.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=='\n                      }}\n                    />\n                  </a>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {ticket.ce_pco_number && ticket.change_order_value > 0 && (\n            <div className=\"tm-change-order-value\">\n              <span className=\"tm-co-label\">Change Order Value:</span>\n              <span className=\"tm-co-amount\">${ticket.change_order_value.toLocaleString()}</span>\n            </div>\n          )}\n\n          {isLocked && (\n            <div className=\"tm-lock-notice\">\n              <Lock size={14} />\n              <span>{lockInfo?.reason || 'This ticket is locked (COR approved)'}</span>\n            </div>\n          )}\n\n          <div className=\"tm-ticket-actions\" role=\"group\" aria-label=\"Ticket actions\">\n            {ticket.status === 'pending' && !isLocked && (\n              <>\n                <button\n                  className=\"btn btn-success btn-small\"\n                  onClick={(e) => { e.stopPropagation(); onApprove(ticket); }}\n                  aria-label=\"Approve this ticket\"\n                >\n                  Approve\n                </button>\n                <button\n                  className=\"btn btn-warning btn-small\"\n                  onClick={(e) => { e.stopPropagation(); onUpdateStatus(ticket.id, 'rejected'); }}\n                  aria-label=\"Reject this ticket\"\n                >\n                  Reject\n                </button>\n              </>\n            )}\n            {ticket.status === 'approved' && !isLocked && (\n              <>\n                <button\n                  className=\"btn btn-primary btn-small\"\n                  onClick={(e) => { e.stopPropagation(); onUpdateStatus(ticket.id, 'billed'); }}\n                  aria-label=\"Mark ticket as billed\"\n                >\n                  Mark Billed\n                </button>\n                <button\n                  className=\"btn btn-secondary btn-small\"\n                  onClick={(e) => { e.stopPropagation(); onShowSignatureLink(ticket); }}\n                  aria-label=\"Get signature link for this ticket\"\n                >\n                  <Link size={14} aria-hidden=\"true\" /> Signature Link\n                </button>\n              </>\n            )}\n            {ticket.status === 'rejected' && !isLocked && (\n              <button\n                className=\"btn btn-secondary btn-small\"\n                onClick={(e) => { e.stopPropagation(); onUpdateStatus(ticket.id, 'pending'); }}\n                aria-label=\"Restore rejected ticket to pending\"\n              >\n                Restore\n              </button>\n            )}\n            {!isLocked && (\n              <button\n                className={`btn btn-small ${ticket.assigned_cor_id ? 'btn-ghost' : 'btn-secondary'}`}\n                onClick={(e) => { e.stopPropagation(); onOpenCorAssign(ticket); }}\n                aria-label={ticket.assigned_cor_id ? 'Change COR link' : 'Link to Change Order'}\n              >\n                <Link2 size={14} aria-hidden=\"true\" /> {ticket.assigned_cor_id ? 'COR' : 'Link COR'}\n              </button>\n            )}\n            {hasFailedImport && !isLocked && (\n              <button\n                className=\"btn btn-warning btn-small\"\n                onClick={(e) => onRetryImport(ticket, e)}\n                disabled={isRetrying}\n                aria-label=\"Retry syncing data to COR\"\n                aria-busy={isRetrying}\n              >\n                <RefreshCw size={14} className={isRetrying ? 'spin' : ''} aria-hidden=\"true\" /> {isRetrying ? 'Syncing...' : 'Retry Sync'}\n              </button>\n            )}\n            {!isLocked && (\n              <button\n                className=\"btn btn-danger btn-small\"\n                onClick={(e) => { e.stopPropagation(); onDelete(ticket.id); }}\n                aria-label=\"Delete this ticket\"\n              >\n                Delete\n              </button>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n})\n\nexport default TMTicketCard\n","import { useState, useEffect, useMemo, useCallback } from 'react'\nimport { FileText, ChevronDown, ChevronRight, Calendar, X, FileSpreadsheet, BarChart3, List } from 'lucide-react'\nimport { db } from '../lib/supabase'\nimport { useBranding } from '../lib/BrandingContext'\nimport { hexToRgb, loadImageAsBase64 } from '../lib/imageUtils'\nimport SignatureLinkGenerator from './SignatureLinkGenerator'\nimport { TicketSkeleton, CountBadge } from './ui'\nimport TMDashboard from './tm/TMDashboard'\nimport TMTicketCard from './tm/TMTicketCard'\n// Dynamic imports for export libraries (loaded on-demand to reduce initial bundle)\n// jsPDF + XLSX together are ~1MB, so we only load them when user actually exports\nconst loadXLSX = () => import('xlsx')\nconst loadJsPDF = () => Promise.all([import('jspdf'), import('jspdf-autotable')])\n\nexport default function TMList({\n  project,\n  company,\n  onShowToast,\n  compact = false,\n  // Preview mode props\n  previewMode = false,   // When true, shows current month tickets with \"See All\" button\n  onViewAll              // Callback when \"See All\" is clicked\n}) {\n  const { branding } = useBranding()\n  const [tickets, setTickets] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [loadingMore, setLoadingMore] = useState(false)\n  const [filter, setFilter] = useState('all')\n  const [expandedTicket, setExpandedTicket] = useState(null)\n  const [selectedTickets, setSelectedTickets] = useState(new Set())\n\n  // Pagination state\n  const [page, setPage] = useState(0)\n  const [hasMore, setHasMore] = useState(true)\n  const [totalCount, setTotalCount] = useState(0)\n  const TICKETS_PER_PAGE = 25\n  const MAX_TICKETS_IN_MEMORY = 500 // Prevent memory bloat from infinite scroll\n\n  // View mode state - in preview mode, we filter to current month\n  const [viewMode, setViewMode] = useState('recent') // 'recent' | 'all'\n  const [displayMode, setDisplayMode] = useState(() => {\n    // Load user preference from localStorage, default to 'dashboard'\n    const saved = localStorage.getItem('fieldsync-tm-default-view')\n    return saved === 'list' || saved === 'dashboard' ? saved : 'dashboard'\n  })\n  const [expandedMonths, setExpandedMonths] = useState(new Set())\n  const [dateFilter, setDateFilter] = useState({ start: '', end: '' })\n\n  // Change order approval modal state\n  const [showChangeOrderModal, setShowChangeOrderModal] = useState(false)\n  const [pendingApprovalTicket, setPendingApprovalTicket] = useState(null)\n  const [changeOrderValue, setChangeOrderValue] = useState('')\n\n  // Signature link modal state\n  const [showSignatureLink, setShowSignatureLink] = useState(false)\n  const [signatureLinkTicket, setSignatureLinkTicket] = useState(null)\n\n  // COR association modal state\n  const [showCorAssignModal, setShowCorAssignModal] = useState(false)\n  const [pendingCorAssignTicket, setPendingCorAssignTicket] = useState(null)\n  const [availableCors, setAvailableCors] = useState([])\n  const [selectedCorForAssign, setSelectedCorForAssign] = useState('')\n  const [loadingCors, setLoadingCors] = useState(false)\n\n  // Track which tickets are locked (linked to approved COR)\n  const [lockedTickets, setLockedTickets] = useState({})\n\n  // Track failed COR imports for retry UI\n  const [failedImports, setFailedImports] = useState({})\n  const [retryingImport, setRetryingImport] = useState(null)\n\n  useEffect(() => {\n    // Reset pagination when project changes\n    setTickets([])\n    setPage(0)\n    setHasMore(true)\n    loadTickets(0, true)\n\n    // Subscribe to real-time updates for T&M tickets\n    const subscription = db.subscribeToTMTickets?.(project.id, () => {\n      // On real-time update, refresh the first page\n      loadTickets(0, true)\n    })\n\n    return () => {\n      if (subscription) db.unsubscribe?.(subscription)\n    }\n  }, [project.id])\n\n  // Save user preference when displayMode changes\n  useEffect(() => {\n    if (!compact) {\n      localStorage.setItem('fieldsync-tm-default-view', displayMode)\n    }\n  }, [displayMode, compact])\n\n  // Reset to preferred view when switching to full mode\n  useEffect(() => {\n    if (!compact) {\n      const saved = localStorage.getItem('fieldsync-tm-default-view')\n      const preferredView = saved === 'list' || saved === 'dashboard' ? saved : 'dashboard'\n      setDisplayMode(preferredView)\n    }\n  }, [compact])\n\n  // Load tickets with pagination\n  const loadTickets = async (pageNum = 0, reset = false) => {\n    try {\n      if (reset) {\n        setLoading(true)\n      } else {\n        setLoadingMore(true)\n      }\n\n      // Use paginated query for scalability\n      const result = await db.getTMTicketsPaginated(project.id, {\n        page: pageNum,\n        limit: TICKETS_PER_PAGE,\n        status: filter !== 'all' ? filter : null\n      })\n\n      if (reset) {\n        setTickets(result.tickets)\n      } else {\n        // Append new tickets but limit total to prevent memory bloat\n        setTickets(prev => {\n          const combined = [...prev, ...result.tickets]\n          // If exceeding limit, keep only the most recent tickets\n          if (combined.length > MAX_TICKETS_IN_MEMORY) {\n            return combined.slice(-MAX_TICKETS_IN_MEMORY)\n          }\n          return combined\n        })\n      }\n\n      setPage(pageNum)\n      setHasMore(result.hasMore)\n      setTotalCount(result.totalCount)\n\n      // Check editability for tickets with COR assignments\n      const ticketsWithCOR = result.tickets.filter(t => t.assigned_cor_id)\n      if (ticketsWithCOR.length > 0) {\n        const lockResults = {}\n        const importStatusResults = {}\n        await Promise.all(ticketsWithCOR.map(async (ticket) => {\n          const editResult = await db.isTicketEditable(ticket)\n          if (!editResult.editable) {\n            lockResults[ticket.id] = editResult\n          }\n          // Check import status for each ticket\n          try {\n            const importStatus = await db.getTicketImportStatus(ticket.id, ticket.assigned_cor_id)\n            if (importStatus?.import_status === 'failed') {\n              importStatusResults[ticket.id] = importStatus\n            }\n          } catch (e) {\n            // Ignore - column may not exist yet\n          }\n        }))\n        setLockedTickets(prev => reset ? lockResults : { ...prev, ...lockResults })\n        setFailedImports(prev => reset ? importStatusResults : { ...prev, ...importStatusResults })\n      }\n    } catch (error) {\n      onShowToast('Error loading T&M tickets', 'error')\n    } finally {\n      setLoading(false)\n      setLoadingMore(false)\n    }\n  }\n\n  // Load more tickets (next page)\n  const loadMore = () => {\n    if (!loadingMore && hasMore) {\n      loadTickets(page + 1, false)\n    }\n  }\n\n  // Reload tickets when filter changes\n  useEffect(() => {\n    if (project?.id) {\n      setTickets([])\n      setPage(0)\n      setHasMore(true)\n      loadTickets(0, true)\n    }\n  }, [filter])\n\n  const updateStatus = useCallback(async (ticketId, newStatus) => {\n    // Check if ticket is locked due to approved COR\n    if (lockedTickets[ticketId]) {\n      onShowToast(lockedTickets[ticketId].reason || 'This ticket is locked (COR approved)', 'error')\n      return\n    }\n\n    try {\n      await db.updateTMTicketStatus(ticketId, newStatus)\n      setTickets(prev => prev.map(t =>\n        t.id === ticketId ? { ...t, status: newStatus } : t\n      ))\n      onShowToast(`Ticket ${newStatus}`, 'success')\n    } catch (error) {\n      console.error('Error updating status:', error)\n      onShowToast('Error updating status', 'error')\n    }\n  }, [lockedTickets]) // onShowToast is stable (memoized in App.jsx)\n\n  // Handle approval - approve directly (CE/PCO is informational only)\n  const handleApprove = useCallback((ticket) => {\n    // Check if ticket is locked due to approved COR\n    if (lockedTickets[ticket.id]) {\n      onShowToast(lockedTickets[ticket.id].reason || 'This ticket is locked (COR approved)', 'error')\n      return\n    }\n\n    updateStatus(ticket.id, 'approved')\n  }, [lockedTickets, updateStatus]) // onShowToast is stable\n\n  // Confirm approval with change order value\n  const confirmChangeOrderApproval = async () => {\n    if (!pendingApprovalTicket) return\n\n    try {\n      const value = parseFloat(changeOrderValue) || 0\n      await db.approveTMTicket(pendingApprovalTicket.id, null, null, value)\n      setTickets(tickets.map(t =>\n        t.id === pendingApprovalTicket.id\n          ? { ...t, status: 'approved', change_order_value: value }\n          : t\n      ))\n      onShowToast(`Ticket approved with $${value.toLocaleString()} change order`, 'success')\n      setShowChangeOrderModal(false)\n      setPendingApprovalTicket(null)\n      setChangeOrderValue('')\n    } catch (error) {\n      console.error('Error approving ticket:', error)\n      onShowToast('Error approving ticket', 'error')\n    }\n  }\n\n  const deleteTicket = useCallback(async (ticketId) => {\n    // Check if ticket is locked due to approved COR\n    if (lockedTickets[ticketId]) {\n      onShowToast(lockedTickets[ticketId].reason || 'This ticket is locked (COR approved)', 'error')\n      return\n    }\n\n    if (!confirm('Delete this T&M ticket?')) return\n    try {\n      await db.deleteTMTicket(ticketId)\n      setTickets(prev => prev.filter(t => t.id !== ticketId))\n      onShowToast('Ticket deleted', 'success')\n    } catch (error) {\n      console.error('Error deleting ticket:', error)\n      onShowToast('Error deleting ticket', 'error')\n    }\n  }, [lockedTickets]) // onShowToast is stable (memoized in App.jsx)\n\n  // Open COR association modal\n  const openCorAssignModal = useCallback(async (ticket) => {\n    setPendingCorAssignTicket(ticket)\n    setSelectedCorForAssign(ticket.assigned_cor_id || '')\n    setShowCorAssignModal(true)\n    setLoadingCors(true)\n\n    try {\n      // Load CORs that can receive tickets (not billed/archived)\n      const cors = await db.getAssignableCORs(project.id)\n      setAvailableCors(cors || [])\n    } catch (error) {\n      console.error('Error loading CORs:', error)\n      onShowToast('Error loading change orders', 'error')\n    } finally {\n      setLoadingCors(false)\n    }\n  }, [project.id]) // onShowToast is stable (memoized in App.jsx)\n\n  // Associate ticket with selected COR\n  const handleAssignToCor = async () => {\n    if (!pendingCorAssignTicket) return\n\n    try {\n      if (selectedCorForAssign) {\n        // Associate with COR using atomic function (ticketId, corId)\n        await db.assignTicketToCOR(pendingCorAssignTicket.id, selectedCorForAssign)\n        const cor = availableCors.find(c => c.id === selectedCorForAssign)\n        onShowToast(`Ticket linked to ${cor?.cor_number || 'COR'}`, 'success')\n      } else if (pendingCorAssignTicket.assigned_cor_id) {\n        // Remove association using atomic function (ticketId, corId)\n        await db.unassignTicketFromCOR(pendingCorAssignTicket.id, pendingCorAssignTicket.assigned_cor_id)\n        onShowToast('Ticket unlinked from COR', 'success')\n      }\n\n      // Refresh tickets\n      loadTickets()\n      setShowCorAssignModal(false)\n      setPendingCorAssignTicket(null)\n      setSelectedCorForAssign('')\n    } catch (error) {\n      console.error('Error updating COR association:', error)\n      onShowToast('Error updating COR link', 'error')\n    }\n  }\n\n  // Retry a failed COR import\n  const handleRetryImport = useCallback(async (ticket, e) => {\n    e?.stopPropagation()\n    if (!ticket.assigned_cor_id) return\n\n    setRetryingImport(ticket.id)\n    try {\n      await db.importTicketDataToCOR(\n        ticket.id,\n        ticket.assigned_cor_id,\n        company.id,\n        project.work_type || 'demolition',\n        project.job_type || 'standard'\n      )\n      onShowToast('COR data import successful!', 'success')\n      // Clear the failed import state for this ticket\n      setFailedImports(prev => {\n        const next = { ...prev }\n        delete next[ticket.id]\n        return next\n      })\n      loadTickets()\n    } catch (error) {\n      console.error('Error retrying import:', error)\n      onShowToast('Import retry failed. Please try again.', 'error')\n    } finally {\n      setRetryingImport(null)\n    }\n  }, [company.id, project.work_type, project.job_type]) // onShowToast and loadTickets are stable\n\n  const calculateTicketTotal = (ticket) => {\n    let total = 0\n    if (ticket.t_and_m_items) {\n      ticket.t_and_m_items.forEach(item => {\n        if (item.materials_equipment?.cost_per_unit) {\n          total += item.quantity * item.materials_equipment.cost_per_unit\n        }\n      })\n    }\n    return total\n  }\n\n  const calculateTotalHours = (ticket) => {\n    if (!ticket.t_and_m_workers) return 0\n    return ticket.t_and_m_workers.reduce((sum, w) => {\n      const regHours = parseFloat(w.hours) || 0\n      const otHours = parseFloat(w.overtime_hours) || 0\n      return sum + regHours + otHours\n    }, 0)\n  }\n\n  const formatDate = (dateStr) => {\n    return new Date(dateStr).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric'\n    })\n  }\n\n  // Selection helpers\n  const toggleTicketSelection = useCallback((ticketId, e) => {\n    e?.stopPropagation()\n    setSelectedTickets(prev => {\n      const next = new Set(prev)\n      if (next.has(ticketId)) {\n        next.delete(ticketId)\n      } else {\n        next.add(ticketId)\n      }\n      return next\n    })\n  }, [])\n\n  // Memoized handlers for TMTicketCard - must be before any early returns\n  const handleToggleExpand = useCallback((ticketId) => {\n    setExpandedTicket(prev => prev === ticketId ? null : ticketId)\n  }, [])\n\n  const handleShowSignatureLink = useCallback((ticket) => {\n    setSignatureLinkTicket(ticket)\n    setShowSignatureLink(true)\n  }, [])\n\n  const toggleSelectAll = () => {\n    const currentFiltered = filter === 'all' ? tickets : tickets.filter(t => t.status === filter)\n    const allSelected = currentFiltered.every(t => selectedTickets.has(t.id))\n    if (allSelected) {\n      setSelectedTickets(new Set())\n    } else {\n      setSelectedTickets(new Set(currentFiltered.map(t => t.id)))\n    }\n  }\n\n  const clearSelection = () => {\n    setSelectedTickets(new Set())\n  }\n\n  // Get tickets to export (selected or all filtered)\n  const getExportTickets = () => {\n    const filtered = filter === 'all' ? tickets : tickets.filter(t => t.status === filter)\n    if (selectedTickets.size > 0) {\n      return filtered.filter(t => selectedTickets.has(t.id))\n    }\n    return filtered\n  }\n\n  // Export to Excel (loads XLSX library on-demand)\n  const exportToExcel = async () => {\n    const exportTickets = getExportTickets()\n\n    if (exportTickets.length === 0) {\n      onShowToast('No tickets to export', 'error')\n      return\n    }\n\n    onShowToast('Preparing Excel export...', 'info')\n\n    // Dynamic import - only loads XLSX when user actually exports\n    const XLSX = (await loadXLSX()).default || await loadXLSX()\n\n    // Create workers sheet\n    const workersData = []\n    // Create items sheet\n    const itemsData = []\n    // Create summary sheet\n    const summaryData = []\n\n    exportTickets.forEach(ticket => {\n      const ticketDate = formatDate(ticket.work_date)\n      const ticketStatus = ticket.status\n      \n      // Workers\n      if (ticket.t_and_m_workers) {\n        ticket.t_and_m_workers.forEach(worker => {\n          const regHours = parseFloat(worker.hours) || 0\n          const otHours = parseFloat(worker.overtime_hours) || 0\n          workersData.push({\n            'Date': ticketDate,\n            'Status': ticketStatus,\n            'Worker Name': worker.name,\n            'Role': worker.role || 'Laborer',\n            'Regular Hours': regHours,\n            'OT Hours': otHours,\n            'Total Hours': regHours + otHours\n          })\n        })\n      }\n      \n      // Items\n      if (ticket.t_and_m_items) {\n        ticket.t_and_m_items.forEach(item => {\n          const itemName = item.custom_name || item.materials_equipment?.name || 'Unknown'\n          const category = item.custom_category || item.materials_equipment?.category || 'Unknown'\n          const unit = item.materials_equipment?.unit || 'each'\n          const costPer = item.materials_equipment?.cost_per_unit || 0\n          const total = item.quantity * costPer\n          \n          itemsData.push({\n            'Date': ticketDate,\n            'Status': ticketStatus,\n            'Category': category,\n            'Item': itemName,\n            'Quantity': item.quantity,\n            'Unit': unit,\n            'Cost/Unit': costPer,\n            'Total': total\n          })\n        })\n      }\n      \n      // Summary\n      summaryData.push({\n        'Date': ticketDate,\n        'Status': ticketStatus,\n        'Workers': ticket.t_and_m_workers?.length || 0,\n        'Total Hours': calculateTotalHours(ticket),\n        'Items': ticket.t_and_m_items?.length || 0,\n        'Materials Cost': calculateTicketTotal(ticket),\n        'Notes': ticket.notes || ''\n      })\n    })\n\n    // Create workbook\n    const wb = XLSX.utils.book_new()\n    \n    // Add sheets\n    const summarySheet = XLSX.utils.json_to_sheet(summaryData)\n    XLSX.utils.book_append_sheet(wb, summarySheet, 'Summary')\n    \n    if (workersData.length > 0) {\n      const workersSheet = XLSX.utils.json_to_sheet(workersData)\n      XLSX.utils.book_append_sheet(wb, workersSheet, 'Workers')\n    }\n    \n    if (itemsData.length > 0) {\n      const itemsSheet = XLSX.utils.json_to_sheet(itemsData)\n      XLSX.utils.book_append_sheet(wb, itemsSheet, 'Materials & Equipment')\n    }\n    \n    // Download\n    const fileName = `${project.name}_TM_${new Date().toISOString().split('T')[0]}.xlsx`\n    XLSX.writeFile(wb, fileName)\n    onShowToast('Export downloaded!', 'success')\n  }\n\n  // Export to PDF - Professional format with company branding (loads jsPDF on-demand)\n  const exportToPDF = async () => {\n    const exportTickets = getExportTickets()\n\n    if (exportTickets.length === 0) {\n      onShowToast('No tickets to export', 'error')\n      return\n    }\n\n    onShowToast('Generating PDF...', 'info')\n\n    // Dynamic import - only loads jsPDF and autoTable when user actually exports\n    const [jsPDFModule, autoTableModule] = await loadJsPDF()\n    const jsPDF = jsPDFModule.default\n    const autoTable = autoTableModule.default\n\n    const doc = new jsPDF()\n    const pageWidth = doc.internal.pageSize.getWidth()\n    const pageHeight = doc.internal.pageSize.getHeight()\n    const margin = 20\n    let yPos = margin\n\n    // Get company colors from branding\n    const primaryColor = hexToRgb(branding?.primary_color || '#3B82F6')\n    const secondaryColor = hexToRgb(branding?.secondary_color || '#1E40AF')\n\n    // Company Header with branded colors\n    doc.setFillColor(...primaryColor)\n    doc.rect(0, 0, pageWidth, 45, 'F')\n\n    // Add accent stripe\n    doc.setFillColor(...secondaryColor)\n    doc.rect(0, 42, pageWidth, 3, 'F')\n\n    // Add company logo if available\n    let logoOffset = margin\n    if (branding?.logo_url) {\n      try {\n        const logoBase64 = await loadImageAsBase64(branding.logo_url)\n        if (logoBase64) {\n          // Add logo (max height 30px, maintain aspect ratio)\n          const logoHeight = 30\n          const logoWidth = 30 // Square assumption, will be adjusted by aspect ratio\n          doc.addImage(logoBase64, 'PNG', margin, 7, logoWidth, logoHeight)\n          logoOffset = margin + logoWidth + 10\n        }\n      } catch (e) {\n        console.error('Error adding logo:', e)\n      }\n    }\n\n    doc.setTextColor(255, 255, 255)\n    doc.setFontSize(22)\n    doc.setFont('helvetica', 'bold')\n    doc.text(company?.name || 'Company Name', logoOffset, 20)\n\n    // Add company tagline/subtitle\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'normal')\n    doc.text('TIME & MATERIALS REPORT', logoOffset, 30)\n\n    // Right side info\n    doc.setFontSize(9)\n    doc.text(`Report Date: ${new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`, pageWidth - margin, 18, { align: 'right' })\n    if (project.job_number) {\n      doc.text(`Job #: ${project.job_number}`, pageWidth - margin, 26, { align: 'right' })\n    }\n    doc.text(`Status: ${filter.charAt(0).toUpperCase() + filter.slice(1)}`, pageWidth - margin, 34, { align: 'right' })\n\n    yPos = 55\n\n    // Project Info Box\n    doc.setFillColor(248, 250, 252) // Light gray\n    doc.rect(margin, yPos - 5, pageWidth - (margin * 2), 30, 'F')\n    doc.setDrawColor(...primaryColor)\n    doc.setLineWidth(0.5)\n    doc.rect(margin, yPos - 5, pageWidth - (margin * 2), 30, 'S')\n\n    doc.setTextColor(...primaryColor)\n    doc.setFontSize(14)\n    doc.setFont('helvetica', 'bold')\n    doc.text(`Project: ${project.name}`, margin + 5, yPos + 7)\n\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(51, 65, 85)\n\n    // Date range\n    const dates = exportTickets.map(t => new Date(t.work_date)).sort((a, b) => a - b)\n    const startDate = dates[0]?.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })\n    const endDate = dates[dates.length - 1]?.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })\n    doc.text(`Date Range: ${startDate} - ${endDate}`, margin + 5, yPos + 17)\n    doc.text(`Total Tickets: ${exportTickets.length}`, pageWidth - margin - 5, yPos + 7, { align: 'right' })\n\n    yPos += 40\n\n    // Summary Section\n    const grandTotalHours = exportTickets.reduce((sum, t) => sum + calculateTotalHours(t), 0)\n    const grandTotalMaterials = exportTickets.reduce((sum, t) => sum + calculateTicketTotal(t), 0)\n    const totalWorkers = new Set(exportTickets.flatMap(t => t.t_and_m_workers?.map(w => w.name) || [])).size\n\n    doc.setTextColor(...primaryColor)\n    doc.setFontSize(12)\n    doc.setFont('helvetica', 'bold')\n    doc.text('SUMMARY', margin, yPos)\n    yPos += 8\n\n    // Summary boxes with brand colors\n    const boxWidth = (pageWidth - margin * 2 - 20) / 3\n    const summaryBoxData = [\n      { label: 'Total Labor Hours', value: grandTotalHours.toFixed(1) },\n      { label: 'Unique Workers', value: totalWorkers.toString() },\n      { label: 'Materials Cost', value: `$${grandTotalMaterials.toFixed(2)}` }\n    ]\n\n    // Create lighter version of primary color for box backgrounds\n    const lightPrimary = primaryColor.map(c => Math.min(255, c + 180))\n\n    summaryBoxData.forEach((item, index) => {\n      const boxX = margin + (index * (boxWidth + 10))\n      doc.setFillColor(...lightPrimary)\n      doc.rect(boxX, yPos, boxWidth, 25, 'F')\n      doc.setDrawColor(...primaryColor)\n      doc.setLineWidth(0.5)\n      doc.rect(boxX, yPos, boxWidth, 25, 'S')\n\n      doc.setTextColor(...primaryColor)\n      doc.setFontSize(16)\n      doc.setFont('helvetica', 'bold')\n      doc.text(item.value, boxX + boxWidth / 2, yPos + 12, { align: 'center' })\n\n      doc.setTextColor(100, 116, 139)\n      doc.setFontSize(8)\n      doc.setFont('helvetica', 'normal')\n      doc.text(item.label, boxX + boxWidth / 2, yPos + 20, { align: 'center' })\n    })\n\n    yPos += 35\n\n    // Collect workers by type\n    const supervisionData = []\n    const operatorsData = []\n    const laborersData = []\n    let supervisionRegHours = 0, supervisionOTHours = 0\n    let operatorsRegHours = 0, operatorsOTHours = 0\n    let laborersRegHours = 0, laborersOTHours = 0\n\n    exportTickets.forEach(ticket => {\n      if (ticket.t_and_m_workers) {\n        ticket.t_and_m_workers.forEach(worker => {\n          const regHrs = parseFloat(worker.hours) || 0\n          const otHrs = parseFloat(worker.overtime_hours) || 0\n          const role = worker.role || 'Laborer'\n          const rowData = [\n            formatDate(ticket.work_date),\n            worker.name,\n            regHrs.toString(),\n            otHrs > 0 ? otHrs.toString() : '-',\n            (regHrs + otHrs).toString()\n          ]\n\n          if (role === 'Foreman' || role === 'Superintendent') {\n            supervisionData.push(rowData)\n            supervisionRegHours += regHrs\n            supervisionOTHours += otHrs\n          } else if (role === 'Operator') {\n            operatorsData.push(rowData)\n            operatorsRegHours += regHrs\n            operatorsOTHours += otHrs\n          } else {\n            laborersData.push(rowData)\n            laborersRegHours += regHrs\n            laborersOTHours += otHrs\n          }\n        })\n      }\n    })\n\n    // Helper function to render a labor table\n    const renderLaborTable = (title, data, regHours, otHours) => {\n      if (data.length === 0) return\n\n      // Check if we need a new page\n      if (yPos > pageHeight - 80) {\n        doc.addPage()\n        yPos = margin\n      }\n\n      doc.setTextColor(...primaryColor)\n      doc.setFontSize(11)\n      doc.setFont('helvetica', 'bold')\n      doc.text(title, margin, yPos)\n      yPos += 5\n\n      autoTable(doc, {\n        startY: yPos,\n        head: [['Date', 'Name', 'Reg Hrs', 'OT Hrs', 'Total']],\n        body: data,\n        margin: { left: margin, right: margin },\n        headStyles: {\n          fillColor: primaryColor,\n          textColor: [255, 255, 255],\n          fontStyle: 'bold',\n          fontSize: 9\n        },\n        bodyStyles: {\n          fontSize: 9,\n          textColor: [51, 65, 85]\n        },\n        alternateRowStyles: {\n          fillColor: [248, 250, 252]\n        },\n        columnStyles: {\n          0: { cellWidth: 30 },\n          2: { halign: 'center', cellWidth: 22 },\n          3: { halign: 'center', cellWidth: 22 },\n          4: { halign: 'center', cellWidth: 22 }\n        },\n        foot: [[\n          '', 'SUBTOTAL:', regHours.toString(), otHours > 0 ? otHours.toString() : '-', (regHours + otHours).toString()\n        ]],\n        footStyles: {\n          fillColor: secondaryColor,\n          textColor: [255, 255, 255],\n          fontStyle: 'bold',\n          fontSize: 9\n        }\n      })\n\n      yPos = doc.lastAutoTable.finalY + 10\n    }\n\n    // Render each labor category\n    if (supervisionData.length > 0 || operatorsData.length > 0 || laborersData.length > 0) {\n      doc.setTextColor(...primaryColor)\n      doc.setFontSize(12)\n      doc.setFont('helvetica', 'bold')\n      doc.text('LABOR', margin, yPos)\n      yPos += 8\n\n      renderLaborTable('SUPERVISION', supervisionData, supervisionRegHours, supervisionOTHours)\n      renderLaborTable('OPERATORS', operatorsData, operatorsRegHours, operatorsOTHours)\n      renderLaborTable('LABORERS', laborersData, laborersRegHours, laborersOTHours)\n\n      // Grand total for all labor\n      const totalRegHours = supervisionRegHours + operatorsRegHours + laborersRegHours\n      const totalOTHours = supervisionOTHours + operatorsOTHours + laborersOTHours\n\n      doc.setFillColor(...primaryColor)\n      doc.rect(margin, yPos, pageWidth - margin * 2, 12, 'F')\n      doc.setTextColor(255, 255, 255)\n      doc.setFontSize(10)\n      doc.setFont('helvetica', 'bold')\n      doc.text('LABOR TOTAL:', margin + 5, yPos + 8)\n      doc.text(`${totalRegHours} Reg + ${totalOTHours} OT = ${totalRegHours + totalOTHours} Hours`, pageWidth - margin - 5, yPos + 8, { align: 'right' })\n\n      yPos += 20\n    }\n\n    // Check if we need a new page\n    if (yPos > pageHeight - 100) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    // Collect materials by category\n    const categoryData = {}\n    const categoryTotals = {}\n    const categoryOrder = ['Containment', 'PPE', 'Disposal', 'Equipment', 'Other']\n\n    exportTickets.forEach(ticket => {\n      if (ticket.t_and_m_items) {\n        ticket.t_and_m_items.forEach(item => {\n          const itemName = item.custom_name || item.materials_equipment?.name || 'Unknown'\n          const category = item.custom_category || item.materials_equipment?.category || 'Other'\n          const unit = item.materials_equipment?.unit || 'each'\n          const costPer = item.materials_equipment?.cost_per_unit || 0\n          const total = item.quantity * costPer\n\n          if (!categoryData[category]) {\n            categoryData[category] = []\n            categoryTotals[category] = 0\n          }\n\n          categoryData[category].push([\n            formatDate(ticket.work_date),\n            itemName,\n            item.quantity.toString(),\n            unit,\n            `$${costPer.toFixed(2)}`,\n            `$${total.toFixed(2)}`\n          ])\n          categoryTotals[category] += total\n        })\n      }\n    })\n\n    // Helper function to render a materials table for a category\n    const renderMaterialsTable = (category, data, subtotal) => {\n      if (!data || data.length === 0) return\n\n      // Check if we need a new page\n      if (yPos > pageHeight - 80) {\n        doc.addPage()\n        yPos = margin\n      }\n\n      doc.setTextColor(...primaryColor)\n      doc.setFontSize(11)\n      doc.setFont('helvetica', 'bold')\n      doc.text(category.toUpperCase(), margin, yPos)\n      yPos += 5\n\n      autoTable(doc, {\n        startY: yPos,\n        head: [['Date', 'Item', 'Qty', 'Unit', 'Rate', 'Total']],\n        body: data,\n        margin: { left: margin, right: margin },\n        headStyles: {\n          fillColor: primaryColor,\n          textColor: [255, 255, 255],\n          fontStyle: 'bold',\n          fontSize: 9\n        },\n        bodyStyles: {\n          fontSize: 9,\n          textColor: [51, 65, 85]\n        },\n        alternateRowStyles: {\n          fillColor: [248, 250, 252]\n        },\n        columnStyles: {\n          2: { halign: 'center', cellWidth: 20 },\n          3: { halign: 'center', cellWidth: 25 },\n          4: { halign: 'right', cellWidth: 25 },\n          5: { halign: 'right', cellWidth: 30 }\n        },\n        foot: [[\n          '', '', '', '', 'Subtotal:', `$${subtotal.toFixed(2)}`\n        ]],\n        footStyles: {\n          fillColor: secondaryColor,\n          textColor: [255, 255, 255],\n          fontStyle: 'bold',\n          fontSize: 9\n        }\n      })\n\n      yPos = doc.lastAutoTable.finalY + 10\n    }\n\n    // Render each category\n    const hasItems = Object.keys(categoryData).length > 0\n\n    if (hasItems) {\n      doc.setTextColor(...primaryColor)\n      doc.setFontSize(12)\n      doc.setFont('helvetica', 'bold')\n      doc.text('MATERIALS & EQUIPMENT', margin, yPos)\n      yPos += 8\n\n      // Render in order\n      categoryOrder.forEach(cat => {\n        if (categoryData[cat]) {\n          renderMaterialsTable(cat, categoryData[cat], categoryTotals[cat])\n        }\n      })\n\n      // Render any other categories not in order\n      Object.keys(categoryData).forEach(cat => {\n        if (!categoryOrder.includes(cat)) {\n          renderMaterialsTable(cat, categoryData[cat], categoryTotals[cat])\n        }\n      })\n\n      // Grand total for all materials\n      doc.setFillColor(...primaryColor)\n      doc.rect(margin, yPos, pageWidth - margin * 2, 12, 'F')\n      doc.setTextColor(255, 255, 255)\n      doc.setFontSize(10)\n      doc.setFont('helvetica', 'bold')\n      doc.text('MATERIALS TOTAL:', margin + 5, yPos + 8)\n      doc.text(`$${grandTotalMaterials.toFixed(2)}`, pageWidth - margin - 5, yPos + 8, { align: 'right' })\n\n      yPos += 20\n    }\n\n    // Check if we need a new page for signature section\n    if (yPos > pageHeight - 80) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    // Authorization Signature Section (Dual Signatures)\n    yPos += 10\n    doc.setDrawColor(...primaryColor)\n    doc.setLineWidth(1)\n    doc.line(margin, yPos, pageWidth - margin, yPos)\n    yPos += 15\n\n    doc.setTextColor(...primaryColor)\n    doc.setFontSize(12)\n    doc.setFont('helvetica', 'bold')\n    doc.text('AUTHORIZATION', margin, yPos)\n    yPos += 10\n\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(71, 85, 105)\n    doc.text('I hereby authorize the above time and materials charges as accurate and approved for billing.', margin, yPos)\n    yPos += 20\n\n    // Helper to get first ticket's signature data (for single-ticket exports)\n    // For multi-ticket exports, signatures would be per-ticket\n    const firstTicket = exportTickets[0] || {}\n\n    // Helper function to render a signature block\n    const renderSignatureBlock = (startY, label, signatureData, signerName, signerTitle, signerCompany, signedDate) => {\n      // Label\n      doc.setFont('helvetica', 'bold')\n      doc.setFontSize(8)\n      doc.setTextColor(...primaryColor)\n      doc.text(label, margin, startY)\n      doc.setFont('helvetica', 'normal')\n      doc.setFontSize(9)\n      doc.setTextColor(100, 116, 139)\n\n      const sigLineY = startY + 18\n\n      // Signature line\n      doc.setDrawColor(...secondaryColor)\n      doc.setLineWidth(0.5)\n      doc.line(margin, sigLineY, margin + 70, sigLineY)\n      doc.text('Signature', margin, sigLineY + 8)\n\n      // Title/Company line\n      doc.line(margin + 85, sigLineY, margin + 145, sigLineY)\n      doc.text('Title / Company', margin + 85, sigLineY + 8)\n\n      // Date line\n      doc.line(pageWidth - margin - 40, sigLineY, pageWidth - margin, sigLineY)\n      doc.text('Date', pageWidth - margin - 40, sigLineY + 8)\n\n      // If signature exists, add it\n      if (signatureData) {\n        try {\n          doc.addImage(signatureData, 'PNG', margin, sigLineY - 16, 60, 16)\n          if (signerName) {\n            doc.setFontSize(8)\n            doc.text(signerName, margin, sigLineY + 15)\n          }\n          if (signerTitle || signerCompany) {\n            const titleCompany = [signerTitle, signerCompany].filter(Boolean).join(' - ')\n            doc.text(titleCompany, margin + 85, sigLineY - 5)\n          }\n          if (signedDate) {\n            const formattedDate = new Date(signedDate).toLocaleDateString()\n            doc.text(formattedDate, pageWidth - margin - 40, sigLineY - 5)\n          }\n        } catch (e) {\n          console.error('Error adding signature to PDF:', e)\n        }\n      }\n\n      return sigLineY + 25\n    }\n\n    // GC Signature (Signature 1)\n    yPos = renderSignatureBlock(\n      yPos,\n      'GC AUTHORIZATION',\n      firstTicket.gc_signature_data,\n      firstTicket.gc_signature_name,\n      firstTicket.gc_signature_title,\n      firstTicket.gc_signature_company,\n      firstTicket.gc_signature_date\n    )\n\n    yPos += 8\n\n    // Client Signature (Signature 2)\n    yPos = renderSignatureBlock(\n      yPos,\n      'CLIENT AUTHORIZATION',\n      firstTicket.client_signature_data,\n      firstTicket.client_signature_name,\n      firstTicket.client_signature_title,\n      firstTicket.client_signature_company,\n      firstTicket.client_signature_date\n    )\n\n    // Add page numbers to all pages\n    const totalPages = doc.internal.getNumberOfPages()\n    for (let i = 1; i <= totalPages; i++) {\n      doc.setPage(i)\n      const footerY = pageHeight - 15\n      doc.setFontSize(8)\n      doc.setTextColor(148, 163, 184)\n      doc.text(`${company?.name || 'Company'} - T&M Report - ${project.name}`, margin, footerY)\n      doc.text(`Page ${i} of ${totalPages}`, pageWidth - margin, footerY, { align: 'right' })\n    }\n\n    // Download\n    const fileName = `${project.name}_TM_Report_${new Date().toISOString().split('T')[0]}.pdf`\n    doc.save(fileName)\n    onShowToast('PDF exported!', 'success')\n  }\n\n  // Filter tickets by status, view mode, and date range\n  const filteredTickets = useMemo(() => {\n    let filtered = filter === 'all'\n      ? [...tickets]\n      : tickets.filter(t => t.status === filter)\n\n    // Apply date filter if set\n    if (dateFilter.start) {\n      const startDate = new Date(dateFilter.start)\n      startDate.setHours(0, 0, 0, 0)\n      filtered = filtered.filter(t => {\n        const ticketDate = new Date(t.work_date)\n        return ticketDate >= startDate\n      })\n    }\n    if (dateFilter.end) {\n      const endDate = new Date(dateFilter.end)\n      endDate.setHours(23, 59, 59, 999)\n      filtered = filtered.filter(t => {\n        const ticketDate = new Date(t.work_date)\n        return ticketDate <= endDate\n      })\n    }\n\n    // In preview mode, show only current month's tickets\n    if (previewMode) {\n      const now = new Date()\n      const currentMonth = now.getMonth()\n      const currentYear = now.getFullYear()\n      filtered = filtered.filter(t => {\n        const ticketDate = new Date(t.work_date)\n        return ticketDate.getMonth() === currentMonth && ticketDate.getFullYear() === currentYear\n      })\n    }\n    // In recent mode (not preview), show only last 7 days\n    else if (viewMode === 'recent') {\n      const sevenDaysAgo = new Date()\n      sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7)\n      sevenDaysAgo.setHours(0, 0, 0, 0)\n      filtered = filtered.filter(t => {\n        const ticketDate = new Date(t.work_date)\n        return ticketDate >= sevenDaysAgo\n      })\n    }\n\n    return filtered\n  }, [tickets, filter, viewMode, dateFilter, previewMode])\n\n  // Group tickets by month for 'all' view\n  const ticketsByMonth = useMemo(() => {\n    if (viewMode !== 'all') return null\n\n    const groups = {}\n    filteredTickets.forEach(ticket => {\n      const date = new Date(ticket.work_date)\n      const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`\n      const monthLabel = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })\n\n      if (!groups[monthKey]) {\n        groups[monthKey] = { label: monthLabel, tickets: [], hours: 0, cost: 0 }\n      }\n      groups[monthKey].tickets.push(ticket)\n      groups[monthKey].hours += calculateTotalHours(ticket)\n      groups[monthKey].cost += calculateTicketTotal(ticket)\n    })\n\n    return Object.entries(groups).sort((a, b) => b[0].localeCompare(a[0]))\n  }, [filteredTickets, viewMode])\n\n  // Auto-expand current month\n  useEffect(() => {\n    if (ticketsByMonth && ticketsByMonth.length > 0) {\n      const currentMonthKey = ticketsByMonth[0][0]\n      setExpandedMonths(new Set([currentMonthKey]))\n    }\n  }, [ticketsByMonth])\n\n  const toggleMonthExpand = (monthKey) => {\n    const newExpanded = new Set(expandedMonths)\n    if (newExpanded.has(monthKey)) {\n      newExpanded.delete(monthKey)\n    } else {\n      newExpanded.add(monthKey)\n    }\n    setExpandedMonths(newExpanded)\n  }\n\n  // Calculate totals for summary\n  const totalHours = filteredTickets.reduce((sum, t) => sum + calculateTotalHours(t), 0)\n  const totalCost = filteredTickets.reduce((sum, t) => sum + calculateTicketTotal(t), 0)\n  const totalTicketsCount = filter === 'all' ? tickets.length : tickets.filter(t => t.status === filter).length\n\n  if (loading) {\n    return (\n      <div className={`tm-list ${compact ? 'tm-list-compact' : ''}`}>\n        <div className=\"tm-loading-skeletons\">\n          {[1, 2, 3].map(i => (\n            <TicketSkeleton key={i} />\n          ))}\n        </div>\n      </div>\n    )\n  }\n\n  // Check if all filtered tickets are selected\n  const allFilteredSelected = filteredTickets.length > 0 && filteredTickets.every(t => selectedTickets.has(t.id))\n  const someSelected = selectedTickets.size > 0\n\n  // Helper function to render a single ticket card using memoized component\n  const renderTicketCard = (ticket) => (\n    <TMTicketCard\n      key={ticket.id}\n      ticket={ticket}\n      isExpanded={expandedTicket === ticket.id}\n      isSelected={selectedTickets.has(ticket.id)}\n      isLocked={!!lockedTickets[ticket.id]}\n      lockInfo={lockedTickets[ticket.id]}\n      hasFailedImport={!!failedImports[ticket.id]}\n      isRetrying={retryingImport === ticket.id}\n      onToggleExpand={handleToggleExpand}\n      onToggleSelect={toggleTicketSelection}\n      onApprove={handleApprove}\n      onUpdateStatus={updateStatus}\n      onDelete={deleteTicket}\n      onOpenCorAssign={openCorAssignModal}\n      onRetryImport={handleRetryImport}\n      onShowSignatureLink={handleShowSignatureLink}\n      formatDate={formatDate}\n      calculateTotalHours={calculateTotalHours}\n      calculateTicketTotal={calculateTicketTotal}\n    />\n  )\n\n  return (\n    <div className={`tm-list ${compact ? 'tm-list-compact' : ''}`}>\n      {/* Header with export buttons - always visible */}\n      <div className=\"tm-list-header\">\n        <div className=\"tm-list-title\">\n          <h3>T&M Tickets</h3>\n          <div className=\"tm-header-controls\">\n            {/* Display Mode Toggle */}\n            {!compact && (\n              <div className=\"tm-display-toggle\">\n                <button\n                  className={`tm-display-btn ${displayMode === 'dashboard' ? 'active' : ''}`}\n                  onClick={() => setDisplayMode('dashboard')}\n                  title=\"Dashboard View\"\n                >\n                  <BarChart3 size={16} /> Dashboard\n                </button>\n                <button\n                  className={`tm-display-btn ${displayMode === 'list' ? 'active' : ''}`}\n                  onClick={() => setDisplayMode('list')}\n                  title=\"List View\"\n                >\n                  <List size={16} /> List\n                </button>\n              </div>\n            )}\n            <div className=\"tm-export-buttons\">\n              {!compact && someSelected && (\n                <button className=\"btn btn-ghost btn-small\" onClick={clearSelection}>\n                  Clear ({selectedTickets.size})\n                </button>\n              )}\n              <button className=\"btn btn-secondary btn-small\" onClick={exportToExcel} disabled={tickets.length === 0}>\n                <FileSpreadsheet size={14} /> Excel {!compact && someSelected ? `(${selectedTickets.size})` : ''}\n              </button>\n              <button className=\"btn btn-secondary btn-small\" onClick={exportToPDF} disabled={tickets.length === 0}>\n                <FileText size={14} /> PDF {!compact && someSelected ? `(${selectedTickets.size})` : ''}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n      {!compact && (\n      <div className=\"tm-list-filters\">\n\n        <div className=\"tm-filter-tabs\">\n          {['all', 'pending', 'approved', 'billed', 'rejected'].map(status => (\n            <button\n              key={status}\n              className={`tm-filter-tab ${filter === status ? 'active' : ''}`}\n              onClick={() => { setFilter(status); clearSelection(); }}\n            >\n              {status.charAt(0).toUpperCase() + status.slice(1)}\n              <span className=\"tm-filter-count\">\n                {status === 'all' ? tickets.length : tickets.filter(t => t.status === status).length}\n              </span>\n            </button>\n          ))}\n        </div>\n\n        {/* View Mode Bar */}\n        <div className=\"view-mode-bar\">\n          <div className=\"view-mode-tabs\">\n            <button\n              className={`view-mode-tab ${viewMode === 'recent' ? 'active' : ''}`}\n              onClick={() => { setViewMode('recent'); setDateFilter({ start: '', end: '' }); }}\n            >\n              Recent (7 days)\n            </button>\n            <button\n              className={`view-mode-tab ${viewMode === 'all' ? 'active' : ''}`}\n              onClick={() => setViewMode('all')}\n            >\n              All ({totalTicketsCount})\n            </button>\n          </div>\n\n          {viewMode === 'all' && (\n            <div className=\"date-filter\">\n              <Calendar size={16} />\n              <input\n                type=\"date\"\n                value={dateFilter.start}\n                onChange={(e) => setDateFilter(prev => ({ ...prev, start: e.target.value }))}\n                placeholder=\"Start date\"\n              />\n              <span>to</span>\n              <input\n                type=\"date\"\n                value={dateFilter.end}\n                onChange={(e) => setDateFilter(prev => ({ ...prev, end: e.target.value }))}\n                placeholder=\"End date\"\n              />\n              {(dateFilter.start || dateFilter.end) && (\n                <button\n                  className=\"btn btn-ghost btn-small\"\n                  onClick={() => setDateFilter({ start: '', end: '' })}\n                >\n                  Clear\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n      )}\n\n      {/* Dashboard View */}\n      {!compact && displayMode === 'dashboard' && (\n        <TMDashboard tickets={tickets} />\n      )}\n\n      {/* List View Content */}\n      {displayMode === 'list' && (\n        <>\n          {/* Summary Bar - hidden in compact mode */}\n          {!compact && filteredTickets.length > 0 && (\n            <div className=\"tm-summary-bar\">\n              <div className=\"tm-summary-stat\">\n                <span className=\"tm-summary-label\">Tickets</span>\n                <span className=\"tm-summary-value\">{filteredTickets.length}</span>\n              </div>\n              <div className=\"tm-summary-stat\">\n                <span className=\"tm-summary-label\">Total Hours</span>\n                <span className=\"tm-summary-value\">{totalHours.toFixed(1)}</span>\n              </div>\n              <div className=\"tm-summary-stat\">\n                <span className=\"tm-summary-label\">Materials Cost</span>\n                <span className=\"tm-summary-value\">${totalCost.toFixed(2)}</span>\n              </div>\n            </div>\n          )}\n\n          {filteredTickets.length === 0 ? (\n        <div className=\"tm-empty-state\">\n          <p>No {filter === 'all' ? '' : filter} T&M tickets{viewMode === 'recent' ? ' in the last 7 days' : ''}</p>\n          {viewMode === 'recent' && totalTicketsCount > 0 && (\n            <button className=\"btn btn-secondary btn-small\" onClick={() => setViewMode('all')}>\n              View All Tickets\n            </button>\n          )}\n        </div>\n      ) : (\n        <div className=\"tm-tickets stagger-children\">\n          {/* Select All Row */}\n          <div className=\"tm-select-all-row\">\n            <label className=\"tm-checkbox-label\" onClick={toggleSelectAll}>\n              <input\n                type=\"checkbox\"\n                checked={allFilteredSelected}\n                onChange={toggleSelectAll}\n                className=\"tm-checkbox\"\n              />\n              <span>Select All ({filteredTickets.length})</span>\n            </label>\n          </div>\n\n          {/* Render tickets - with month grouping in 'all' mode */}\n          {viewMode === 'all' && ticketsByMonth ? (\n            ticketsByMonth.map(([monthKey, monthData]) => (\n              <div key={monthKey} className=\"month-group animate-fade-in\">\n                <div\n                  className=\"month-header\"\n                  onClick={() => toggleMonthExpand(monthKey)}\n                >\n                  <div className=\"month-header-left\">\n                    {expandedMonths.has(monthKey) ? (\n                      <ChevronDown size={18} />\n                    ) : (\n                      <ChevronRight size={18} />\n                    )}\n                    <span className=\"month-label\">{monthData.label}</span>\n                    <CountBadge count={monthData.tickets.length} label=\"tickets\" size=\"small\" />\n                  </div>\n                  <div className=\"month-header-right\">\n                    <span className=\"month-stat\">{monthData.hours.toFixed(1)} hrs</span>\n                    <span className=\"month-stat\">${monthData.cost.toFixed(2)}</span>\n                  </div>\n                </div>\n                {expandedMonths.has(monthKey) && (\n                  <div className=\"month-tickets stagger-children\">\n                    {monthData.tickets.map(ticket => renderTicketCard(ticket))}\n                  </div>\n                )}\n              </div>\n            ))\n          ) : (\n            // Recent view - simple list\n            filteredTickets.map(ticket => renderTicketCard(ticket))\n          )}\n          </div>\n          )}\n\n          {/* Load More Button - for pagination */}\n          {!previewMode && hasMore && !loading && tickets.length > 0 && (\n            <div className=\"tm-load-more\">\n              <button\n                className=\"btn btn-secondary\"\n                onClick={loadMore}\n                disabled={loadingMore}\n              >\n                {loadingMore ? 'Loading...' : `Load More (${tickets.length} of ${totalCount})`}\n              </button>\n            </div>\n          )}\n\n          {/* See All Footer - only in preview mode */}\n          {previewMode && tickets.length > 0 && (\n            <button className=\"tm-see-all-btn\" onClick={onViewAll}>\n              See all {totalCount || tickets.length} T&M tickets\n              <ChevronRight size={16} />\n            </button>\n          )}\n        </>\n      )}\n\n      {/* Change Order Approval Modal */}\n      {showChangeOrderModal && pendingApprovalTicket && (\n        <div className=\"modal-overlay\" onClick={() => setShowChangeOrderModal(false)}>\n          <div className=\"modal change-order-modal\" onClick={(e) => e.stopPropagation()}>\n            <h3>Approve Change Order Work</h3>\n            <p className=\"modal-subtitle\">\n              This T&M ticket is associated with <strong>{pendingApprovalTicket.ce_pco_number}</strong>\n            </p>\n\n            <div className=\"form-group\">\n              <label>Change Order Value ($)</label>\n              <input\n                type=\"number\"\n                value={changeOrderValue}\n                onChange={(e) => setChangeOrderValue(e.target.value)}\n                placeholder=\"Enter the change order amount\"\n                autoFocus\n              />\n              <p className=\"form-help\">\n                This amount will be added to the project's total contract value.\n              </p>\n            </div>\n\n            <div className=\"modal-actions\">\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => setShowChangeOrderModal(false)}\n              >\n                Cancel\n              </button>\n              <button\n                className=\"btn btn-success\"\n                onClick={confirmChangeOrderApproval}\n              >\n                Approve with ${parseFloat(changeOrderValue || 0).toLocaleString()}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Signature Link Generator Modal */}\n      {showSignatureLink && signatureLinkTicket && (\n        <SignatureLinkGenerator\n          documentType=\"tm_ticket\"\n          documentId={signatureLinkTicket.id}\n          companyId={company?.id}\n          projectId={project?.id}\n          documentTitle={`T&M Ticket - ${new Date(signatureLinkTicket.work_date).toLocaleDateString()}${signatureLinkTicket.ce_pco_number ? ` (${signatureLinkTicket.ce_pco_number})` : ''}`}\n          onClose={() => {\n            setShowSignatureLink(false)\n            setSignatureLinkTicket(null)\n          }}\n          onShowToast={onShowToast}\n        />\n      )}\n\n      {/* COR Association Modal */}\n      {showCorAssignModal && pendingCorAssignTicket && (\n        <div className=\"modal-overlay\" onClick={() => setShowCorAssignModal(false)}>\n          <div className=\"modal cor-assign-modal\" onClick={(e) => e.stopPropagation()}>\n            <div className=\"modal-header\">\n              <h3>Link Ticket to Change Order</h3>\n              <button className=\"close-btn\" onClick={() => setShowCorAssignModal(false)}>\n                <X size={20} />\n              </button>\n            </div>\n\n            <div className=\"modal-body\">\n              <p className=\"modal-subtitle\">\n                Ticket: <strong>{new Date(pendingCorAssignTicket.work_date).toLocaleDateString()}</strong>\n                {pendingCorAssignTicket.ce_pco_number && ` (${pendingCorAssignTicket.ce_pco_number})`}\n              </p>\n\n              {loadingCors ? (\n                <div className=\"loading\">Loading change orders...</div>\n              ) : availableCors.length === 0 ? (\n                <div className=\"empty-state\">\n                  <p>No change orders found for this project.</p>\n                  <p className=\"text-muted\">Create a COR first, then link tickets to it.</p>\n                </div>\n              ) : (\n                <div className=\"cor-select-wrapper\">\n                  <label>Select Change Order:</label>\n                  <select\n                    value={selectedCorForAssign}\n                    onChange={(e) => setSelectedCorForAssign(e.target.value)}\n                    className=\"cor-select\"\n                  >\n                    <option value=\"\">-- No COR (unlink) --</option>\n                    {availableCors.map(cor => (\n                      <option key={cor.id} value={cor.id}>\n                        {cor.cor_number} - {cor.title || 'Untitled'} ({cor.status})\n                      </option>\n                    ))}\n                  </select>\n                </div>\n              )}\n            </div>\n\n            <div className=\"modal-footer\">\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => setShowCorAssignModal(false)}\n              >\n                Cancel\n              </button>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAssignToCor}\n                disabled={loadingCors || (availableCors.length === 0)}\n              >\n                {pendingCorAssignTicket.assigned_cor_id && !selectedCorForAssign\n                  ? 'Unlink from COR'\n                  : 'Link to COR'}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n"],"file":"TMList-BvVcNwxK.js"}