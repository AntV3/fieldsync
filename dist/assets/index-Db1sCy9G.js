const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-DneRhhE2.js","assets/users-DtM6gNKP.js","assets/pencil-Q36EQIP5.js","assets/react-DXGY7bZi.js","assets/xlsx-BvJTHLik.js","assets/pdf-ChZ1zkDw.js","assets/corCalculations-BXYP8b42.js","assets/chevron-right-Dgi0W9S7.js","assets/user-minus-DMe_k93W.js","assets/supabase-VuevzHjS.js","assets/Setup-DqsMOzl0.js","assets/BrandingSettings-BWrMEnC_.js","assets/PricingManager-6wLGypMb.js","assets/PublicView-DCX_kOq_.js","assets/SignaturePage-DW6GFrM9.js","assets/MembershipManager-BiL_DD2X.js"])))=>i.map(i=>d[i]);
import{r as oh,a as ch,b as Cg}from"./react-DXGY7bZi.js";import{_ as gr}from"./pdf-ChZ1zkDw.js";import{c as uh}from"./supabase-VuevzHjS.js";function Eg(s,l){for(var i=0;i<l.length;i++){const o=l[i];if(typeof o!="string"&&!Array.isArray(o)){for(const d in o)if(d!=="default"&&!(d in s)){const m=Object.getOwnPropertyDescriptor(o,d);m&&Object.defineProperty(s,d,m.get?m:{enumerable:!0,get:()=>o[d]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const p of m.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&o(p)}).observe(document,{childList:!0,subtree:!0});function i(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function o(d){if(d.ep)return;d.ep=!0;const m=i(d);fetch(d.href,m)}})();var Tc={exports:{}},Ks={};var Gf;function kg(){if(Gf)return Ks;Gf=1;var s=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function i(o,d,m){var p=null;if(m!==void 0&&(p=""+m),d.key!==void 0&&(p=""+d.key),"key"in d){m={};for(var y in d)y!=="key"&&(m[y]=d[y])}else m=d;return d=m.ref,{$$typeof:s,type:o,key:p,ref:d!==void 0?d:null,props:m}}return Ks.Fragment=l,Ks.jsx=i,Ks.jsxs=i,Ks}var Qf;function qg(){return Qf||(Qf=1,Tc.exports=kg()),Tc.exports}var r=qg(),w=oh();const dh=ch(w),Ay=Eg({__proto__:null,default:dh},[w]);var Ac={exports:{}},Js={},Oc={exports:{}},Mc={};var Xf;function Dg(){return Xf||(Xf=1,(function(s){function l(C,X){var I=C.length;C.push(X);e:for(;0<I;){var Se=I-1>>>1,Y=C[Se];if(0<d(Y,X))C[Se]=X,C[I]=Y,I=Se;else break e}}function i(C){return C.length===0?null:C[0]}function o(C){if(C.length===0)return null;var X=C[0],I=C.pop();if(I!==X){C[0]=I;e:for(var Se=0,Y=C.length,je=Y>>>1;Se<je;){var P=2*(Se+1)-1,ye=C[P],qe=P+1,F=C[qe];if(0>d(ye,I))qe<Y&&0>d(F,ye)?(C[Se]=F,C[qe]=I,Se=qe):(C[Se]=ye,C[P]=I,Se=P);else if(qe<Y&&0>d(F,I))C[Se]=F,C[qe]=I,Se=qe;else break e}}return X}function d(C,X){var I=C.sortIndex-X.sortIndex;return I!==0?I:C.id-X.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var m=performance;s.unstable_now=function(){return m.now()}}else{var p=Date,y=p.now();s.unstable_now=function(){return p.now()-y}}var b=[],z=[],B=1,O=null,$=3,W=!1,te=!1,V=!1,oe=!1,ae=typeof setTimeout=="function"?setTimeout:null,me=typeof clearTimeout=="function"?clearTimeout:null,ue=typeof setImmediate<"u"?setImmediate:null;function J(C){for(var X=i(z);X!==null;){if(X.callback===null)o(z);else if(X.startTime<=C)o(z),X.sortIndex=X.expirationTime,l(b,X);else break;X=i(z)}}function xe(C){if(V=!1,J(C),!te)if(i(b)!==null)te=!0,ke||(ke=!0,M());else{var X=i(z);X!==null&&pe(xe,X.startTime-C)}}var ke=!1,Ue=-1,ee=5,ve=-1;function Ve(){return oe?!0:!(s.unstable_now()-ve<ee)}function Me(){if(oe=!1,ke){var C=s.unstable_now();ve=C;var X=!0;try{e:{te=!1,V&&(V=!1,me(Ue),Ue=-1),W=!0;var I=$;try{t:{for(J(C),O=i(b);O!==null&&!(O.expirationTime>C&&Ve());){var Se=O.callback;if(typeof Se=="function"){O.callback=null,$=O.priorityLevel;var Y=Se(O.expirationTime<=C);if(C=s.unstable_now(),typeof Y=="function"){O.callback=Y,J(C),X=!0;break t}O===i(b)&&o(b),J(C)}else o(b);O=i(b)}if(O!==null)X=!0;else{var je=i(z);je!==null&&pe(xe,je.startTime-C),X=!1}}break e}finally{O=null,$=I,W=!1}X=void 0}}finally{X?M():ke=!1}}}var M;if(typeof ue=="function")M=function(){ue(Me)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,ne=G.port2;G.port1.onmessage=Me,M=function(){ne.postMessage(null)}}else M=function(){ae(Me,0)};function pe(C,X){Ue=ae(function(){C(s.unstable_now())},X)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(C){C.callback=null},s.unstable_forceFrameRate=function(C){0>C||125<C?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<C?Math.floor(1e3/C):5},s.unstable_getCurrentPriorityLevel=function(){return $},s.unstable_next=function(C){switch($){case 1:case 2:case 3:var X=3;break;default:X=$}var I=$;$=X;try{return C()}finally{$=I}},s.unstable_requestPaint=function(){oe=!0},s.unstable_runWithPriority=function(C,X){switch(C){case 1:case 2:case 3:case 4:case 5:break;default:C=3}var I=$;$=C;try{return X()}finally{$=I}},s.unstable_scheduleCallback=function(C,X,I){var Se=s.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?Se+I:Se):I=Se,C){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=I+Y,C={id:B++,callback:X,priorityLevel:C,startTime:I,expirationTime:Y,sortIndex:-1},I>Se?(C.sortIndex=I,l(z,C),i(b)===null&&C===i(z)&&(V?(me(Ue),Ue=-1):V=!0,pe(xe,I-Se))):(C.sortIndex=Y,l(b,C),te||W||(te=!0,ke||(ke=!0,M()))),C},s.unstable_shouldYield=Ve,s.unstable_wrapCallback=function(C){var X=$;return function(){var I=$;$=X;try{return C.apply(this,arguments)}finally{$=I}}}})(Mc)),Mc}var Vf;function Tg(){return Vf||(Vf=1,Oc.exports=Dg()),Oc.exports}var Zf;function Ag(){if(Zf)return Js;Zf=1;var s=Tg(),l=oh(),i=Cg();function o(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function m(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function p(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function y(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function b(e){if(m(e)!==e)throw Error(o(188))}function z(e){var t=e.alternate;if(!t){if(t=m(e),t===null)throw Error(o(188));return t!==e?null:e}for(var a=e,n=t;;){var c=a.return;if(c===null)break;var u=c.alternate;if(u===null){if(n=c.return,n!==null){a=n;continue}break}if(c.child===u.child){for(u=c.child;u;){if(u===a)return b(c),e;if(u===n)return b(c),t;u=u.sibling}throw Error(o(188))}if(a.return!==n.return)a=c,n=u;else{for(var f=!1,g=c.child;g;){if(g===a){f=!0,a=c,n=u;break}if(g===n){f=!0,n=c,a=u;break}g=g.sibling}if(!f){for(g=u.child;g;){if(g===a){f=!0,a=u,n=c;break}if(g===n){f=!0,n=u,a=c;break}g=g.sibling}if(!f)throw Error(o(189))}}if(a.alternate!==n)throw Error(o(190))}if(a.tag!==3)throw Error(o(188));return a.stateNode.current===a?e:t}function B(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=B(e),t!==null)return t;e=e.sibling}return null}var O=Object.assign,$=Symbol.for("react.element"),W=Symbol.for("react.transitional.element"),te=Symbol.for("react.portal"),V=Symbol.for("react.fragment"),oe=Symbol.for("react.strict_mode"),ae=Symbol.for("react.profiler"),me=Symbol.for("react.consumer"),ue=Symbol.for("react.context"),J=Symbol.for("react.forward_ref"),xe=Symbol.for("react.suspense"),ke=Symbol.for("react.suspense_list"),Ue=Symbol.for("react.memo"),ee=Symbol.for("react.lazy"),ve=Symbol.for("react.activity"),Ve=Symbol.for("react.memo_cache_sentinel"),Me=Symbol.iterator;function M(e){return e===null||typeof e!="object"?null:(e=Me&&e[Me]||e["@@iterator"],typeof e=="function"?e:null)}var G=Symbol.for("react.client.reference");function ne(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===G?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case V:return"Fragment";case ae:return"Profiler";case oe:return"StrictMode";case xe:return"Suspense";case ke:return"SuspenseList";case ve:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case te:return"Portal";case ue:return e.displayName||"Context";case me:return(e._context.displayName||"Context")+".Consumer";case J:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ue:return t=e.displayName||null,t!==null?t:ne(e.type)||"Memo";case ee:t=e._payload,e=e._init;try{return ne(e(t))}catch{}}return null}var pe=Array.isArray,C=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I={pending:!1,data:null,method:null,action:null},Se=[],Y=-1;function je(e){return{current:e}}function P(e){0>Y||(e.current=Se[Y],Se[Y]=null,Y--)}function ye(e,t){Y++,Se[Y]=e.current,e.current=t}var qe=je(null),F=je(null),fe=je(null),Be=je(null);function le(e,t){switch(ye(fe,t),ye(F,e),ye(qe,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?df(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=df(t),e=mf(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}P(qe),ye(qe,e)}function Ce(){P(qe),P(F),P(fe)}function Fe(e){e.memoizedState!==null&&ye(Be,e);var t=qe.current,a=mf(t,e.type);t!==a&&(ye(F,e),ye(qe,a))}function Le(e){F.current===e&&(P(qe),P(F)),Be.current===e&&(P(Be),Qs._currentValue=I)}var rt,xt;function Ze(e){if(rt===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);rt=t&&t[1]||"",xt=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+rt+e+xt}var ra=!1;function ot(e,t){if(!e||ra)return"";ra=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(t){var L=function(){throw Error()};if(Object.defineProperty(L.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(L,[])}catch(A){var D=A}Reflect.construct(e,[],L)}else{try{L.call()}catch(A){D=A}e.call(L.prototype)}}else{try{throw Error()}catch(A){D=A}(L=e())&&typeof L.catch=="function"&&L.catch(function(){})}}catch(A){if(A&&D&&typeof A.stack=="string")return[A.stack,D.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var u=n.DetermineComponentFrameRoot(),f=u[0],g=u[1];if(f&&g){var j=f.split(`
`),k=g.split(`
`);for(c=n=0;n<j.length&&!j[n].includes("DetermineComponentFrameRoot");)n++;for(;c<k.length&&!k[c].includes("DetermineComponentFrameRoot");)c++;if(n===j.length||c===k.length)for(n=j.length-1,c=k.length-1;1<=n&&0<=c&&j[n]!==k[c];)c--;for(;1<=n&&0<=c;n--,c--)if(j[n]!==k[c]){if(n!==1||c!==1)do if(n--,c--,0>c||j[n]!==k[c]){var R=`
`+j[n].replace(" at new "," at ");return e.displayName&&R.includes("<anonymous>")&&(R=R.replace("<anonymous>",e.displayName)),R}while(1<=n&&0<=c);break}}}finally{ra=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?Ze(a):""}function St(e,t){switch(e.tag){case 26:case 27:case 5:return Ze(e.type);case 16:return Ze("Lazy");case 13:return e.child!==t&&t!==null?Ze("Suspense Fallback"):Ze("Suspense");case 19:return Ze("SuspenseList");case 0:case 15:return ot(e.type,!1);case 11:return ot(e.type.render,!1);case 1:return ot(e.type,!0);case 31:return Ze("Activity");default:return""}}function yr(e){try{var t="",a=null;do t+=St(e,a),a=e,e=e.return;while(e);return t}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var mn=Object.prototype.hasOwnProperty,Xn=s.unstable_scheduleCallback,Ra=s.unstable_cancelCallback,fn=s.unstable_shouldYield,hn=s.unstable_requestPaint,yt=s.unstable_now,Ua=s.unstable_getCurrentPriorityLevel,Vn=s.unstable_ImmediatePriority,Zn=s.unstable_UserBlockingPriority,sa=s.unstable_NormalPriority,Ha=s.unstable_LowPriority,vt=s.unstable_IdlePriority,La=s.log,Kn=s.unstable_setDisableYieldValue,ya=null,wt=null;function se(e){if(typeof La=="function"&&Kn(e),wt&&typeof wt.setStrictMode=="function")try{wt.setStrictMode(ya,e)}catch{}}var kt=Math.clz32?Math.clz32:vr,Z=Math.log,as=Math.LN2;function vr(e){return e>>>=0,e===0?32:31-(Z(e)/as|0)|0}var va=256,pn=262144,Nt=4194304;function qt(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ea(e,t,a){var n=e.pendingLanes;if(n===0)return 0;var c=0,u=e.suspendedLanes,f=e.pingedLanes;e=e.warmLanes;var g=n&134217727;return g!==0?(n=g&~u,n!==0?c=qt(n):(f&=g,f!==0?c=qt(f):a||(a=g&~e,a!==0&&(c=qt(a))))):(g=n&~u,g!==0?c=qt(g):f!==0?c=qt(f):a||(a=n&~e,a!==0&&(c=qt(a)))),c===0?0:t!==0&&t!==c&&(t&u)===0&&(u=c&-c,a=t&-t,u>=a||u===32&&(a&4194048)!==0)?t:c}function ka(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function Dt(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function K(){var e=Nt;return Nt<<=1,(Nt&62914560)===0&&(Nt=4194304),e}function Ut(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function ba(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function tl(e,t,a,n,c,u){var f=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var g=e.entanglements,j=e.expirationTimes,k=e.hiddenUpdates;for(a=f&~a;0<a;){var R=31-kt(a),L=1<<R;g[R]=0,j[R]=-1;var D=k[R];if(D!==null)for(k[R]=null,R=0;R<D.length;R++){var A=D[R];A!==null&&(A.lane&=-536870913)}a&=~L}n!==0&&al(e,n,0),u!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=u&~(f&~t))}function al(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var n=31-kt(t);e.entangledLanes|=t,e.entanglements[n]=e.entanglements[n]|1073741824|a&261930}function br(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var n=31-kt(a),c=1<<n;c&t|e[n]&t&&(e[n]|=t),a&=~c}}function nl(e,t){var a=t&-t;return a=(a&42)!==0?1:ns(a),(a&(e.suspendedLanes|t))!==0?0:a}function ns(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function rs(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function rl(){var e=X.p;return e!==0?e:(e=window.event,e===void 0?32:zf(e.type))}function sl(e,t){var a=X.p;try{return X.p=e,t()}finally{X.p=a}}var qa=Math.random().toString(36).slice(2),tt="__reactFiber$"+qa,Rt="__reactProps$"+qa,gn="__reactContainer$"+qa,Da="__reactEvents$"+qa,Ni="__reactListeners$"+qa,Ci="__reactHandles$"+qa,Ba="__reactResources$"+qa,Jn="__reactMarker$"+qa;function jr(e){delete e[tt],delete e[Rt],delete e[Da],delete e[Ni],delete e[Ci]}function Tt(e){var t=e[tt];if(t)return t;for(var a=e.parentNode;a;){if(t=a[gn]||a[tt]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=vf(e);e!==null;){if(a=e[tt])return a;e=vf(e)}return t}e=a,a=e.parentNode}return null}function Ya(e){if(e=e[tt]||e[gn]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function Ga(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(o(33))}function _n(e){var t=e[Ba];return t||(t=e[Ba]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function mt(e){e[Jn]=!0}var xr=new Set,ll={};function Qa(e,t){Ht(e,t),Ht(e+"Capture",t)}function Ht(e,t){for(ll[e]=t,e=0;e<t.length;e++)xr.add(t[e])}var il=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ol={},ss={};function ou(e){return mn.call(ss,e)?!0:mn.call(ol,e)?!1:il.test(e)?ss[e]=!0:(ol[e]=!0,!1)}function Fn(e,t,a){if(ou(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var n=t.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function ja(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function la(e,t,a,n){if(n===null)e.removeAttribute(a);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+n)}}function Bt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Xa(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function yn(e,t,a){var n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var c=n.get,u=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(f){a=""+f,u.call(this,f)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(f){a=""+f},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ta(e){if(!e._valueTracker){var t=Xa(e)?"checked":"value";e._valueTracker=yn(e,t,""+e[t])}}function vn(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),n="";return e&&(n=Xa(e)?e.checked?"true":"false":e.value),e=n,e!==a?(t.setValue(e),!0):!1}function xa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var bn=/[\n"\\]/g;function ct(e){return e.replace(bn,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Va(e,t,a,n,c,u,f,g){e.name="",f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"?e.type=f:e.removeAttribute("type"),t!=null?f==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+Bt(t)):e.value!==""+Bt(t)&&(e.value=""+Bt(t)):f!=="submit"&&f!=="reset"||e.removeAttribute("value"),t!=null?Sa(e,f,Bt(t)):a!=null?Sa(e,f,Bt(a)):n!=null&&e.removeAttribute("value"),c==null&&u!=null&&(e.defaultChecked=!!u),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"?e.name=""+Bt(g):e.removeAttribute("name")}function cl(e,t,a,n,c,u,f,g){if(u!=null&&typeof u!="function"&&typeof u!="symbol"&&typeof u!="boolean"&&(e.type=u),t!=null||a!=null){if(!(u!=="submit"&&u!=="reset"||t!=null)){Ta(e);return}a=a!=null?""+Bt(a):"",t=t!=null?""+Bt(t):a,g||t===e.value||(e.value=t),e.defaultValue=t}n=n??c,n=typeof n!="function"&&typeof n!="symbol"&&!!n,e.checked=g?e.checked:!!n,e.defaultChecked=!!n,f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"&&(e.name=f),Ta(e)}function Sa(e,t,a){t==="number"&&xa(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function h(e,t,a,n){if(e=e.options,t){t={};for(var c=0;c<a.length;c++)t["$"+a[c]]=!0;for(a=0;a<e.length;a++)c=t.hasOwnProperty("$"+e[a].value),e[a].selected!==c&&(e[a].selected=c),c&&n&&(e[a].defaultSelected=!0)}else{for(a=""+Bt(a),t=null,c=0;c<e.length;c++){if(e[c].value===a){e[c].selected=!0,n&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function S(e,t,a){if(t!=null&&(t=""+Bt(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+Bt(a):""}function T(e,t,a,n){if(t==null){if(n!=null){if(a!=null)throw Error(o(92));if(pe(n)){if(1<n.length)throw Error(o(93));n=n[0]}a=n}a==null&&(a=""),t=a}a=Bt(t),e.defaultValue=a,n=e.textContent,n===a&&n!==""&&n!==null&&(e.value=n),Ta(e)}function q(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var U=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Q(e,t,a){var n=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?n?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":n?e.setProperty(t,a):typeof a!="number"||a===0||U.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function ie(e,t,a){if(t!=null&&typeof t!="object")throw Error(o(62));if(e=e.style,a!=null){for(var n in a)!a.hasOwnProperty(n)||t!=null&&t.hasOwnProperty(n)||(n.indexOf("--")===0?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="");for(var c in t)n=t[c],t.hasOwnProperty(c)&&a[c]!==n&&Q(e,c,n)}else for(var u in t)t.hasOwnProperty(u)&&Q(e,u,t[u])}function he(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ft=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),$e=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function bt(e){return $e.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Za(){}var Ei=null;function ki(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Sr=null,wr=null;function cu(e){var t=Ya(e);if(t&&(e=t.stateNode)){var a=e[Rt]||null;e:switch(e=t.stateNode,t.type){case"input":if(Va(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+ct(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var n=a[t];if(n!==e&&n.form===e.form){var c=n[Rt]||null;if(!c)throw Error(o(90));Va(n,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(t=0;t<a.length;t++)n=a[t],n.form===e.form&&vn(n)}break e;case"textarea":S(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&h(e,!!a.multiple,t,!1)}}}var qi=!1;function uu(e,t,a){if(qi)return e(t,a);qi=!0;try{var n=e(t);return n}finally{if(qi=!1,(Sr!==null||wr!==null)&&($l(),Sr&&(t=Sr,e=wr,wr=Sr=null,cu(t),e)))for(t=0;t<e.length;t++)cu(e[t])}}function ls(e,t){var a=e.stateNode;if(a===null)return null;var n=a[Rt]||null;if(n===null)return null;a=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(o(231,t,typeof a));return a}var Ka=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Di=!1;if(Ka)try{var is={};Object.defineProperty(is,"passive",{get:function(){Di=!0}}),window.addEventListener("test",is,is),window.removeEventListener("test",is,is)}catch{Di=!1}var jn=null,Ti=null,ul=null;function du(){if(ul)return ul;var e,t=Ti,a=t.length,n,c="value"in jn?jn.value:jn.textContent,u=c.length;for(e=0;e<a&&t[e]===c[e];e++);var f=a-e;for(n=1;n<=f&&t[a-n]===c[u-n];n++);return ul=c.slice(e,1<n?1-n:void 0)}function dl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function ml(){return!0}function mu(){return!1}function Yt(e){function t(a,n,c,u,f){this._reactName=a,this._targetInst=c,this.type=n,this.nativeEvent=u,this.target=f,this.currentTarget=null;for(var g in e)e.hasOwnProperty(g)&&(a=e[g],this[g]=a?a(u):u[g]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?ml:mu,this.isPropagationStopped=mu,this}return O(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=ml)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=ml)},persist:function(){},isPersistent:ml}),t}var $n={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fl=Yt($n),os=O({},$n,{view:0,detail:0}),wh=Yt(os),Ai,Oi,cs,hl=O({},os,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zi,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cs&&(cs&&e.type==="mousemove"?(Ai=e.screenX-cs.screenX,Oi=e.screenY-cs.screenY):Oi=Ai=0,cs=e),Ai)},movementY:function(e){return"movementY"in e?e.movementY:Oi}}),fu=Yt(hl),Nh=O({},hl,{dataTransfer:0}),Ch=Yt(Nh),Eh=O({},os,{relatedTarget:0}),Mi=Yt(Eh),kh=O({},$n,{animationName:0,elapsedTime:0,pseudoElement:0}),qh=Yt(kh),Dh=O({},$n,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Th=Yt(Dh),Ah=O({},$n,{data:0}),hu=Yt(Ah),Oh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Mh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rh(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=zh[e])?!!t[e]:!1}function zi(){return Rh}var Uh=O({},os,{key:function(e){if(e.key){var t=Oh[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=dl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Mh[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zi,charCode:function(e){return e.type==="keypress"?dl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?dl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Hh=Yt(Uh),Lh=O({},hl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pu=Yt(Lh),Bh=O({},os,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zi}),Yh=Yt(Bh),Gh=O({},$n,{propertyName:0,elapsedTime:0,pseudoElement:0}),Qh=Yt(Gh),Xh=O({},hl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Vh=Yt(Xh),Zh=O({},$n,{newState:0,oldState:0}),Kh=Yt(Zh),Jh=[9,13,27,32],Ri=Ka&&"CompositionEvent"in window,us=null;Ka&&"documentMode"in document&&(us=document.documentMode);var Fh=Ka&&"TextEvent"in window&&!us,gu=Ka&&(!Ri||us&&8<us&&11>=us),_u=" ",yu=!1;function vu(e,t){switch(e){case"keyup":return Jh.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Nr=!1;function $h(e,t){switch(e){case"compositionend":return bu(t);case"keypress":return t.which!==32?null:(yu=!0,_u);case"textInput":return e=t.data,e===_u&&yu?null:e;default:return null}}function Wh(e,t){if(Nr)return e==="compositionend"||!Ri&&vu(e,t)?(e=du(),ul=Ti=jn=null,Nr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return gu&&t.locale!=="ko"?null:t.data;default:return null}}var Ph={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ju(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Ph[e.type]:t==="textarea"}function xu(e,t,a,n){Sr?wr?wr.push(n):wr=[n]:Sr=n,t=ni(t,"onChange"),0<t.length&&(a=new fl("onChange","change",null,a,n),e.push({event:a,listeners:t}))}var ds=null,ms=null;function Ih(e){rf(e,0)}function pl(e){var t=Ga(e);if(vn(t))return e}function Su(e,t){if(e==="change")return t}var wu=!1;if(Ka){var Ui;if(Ka){var Hi="oninput"in document;if(!Hi){var Nu=document.createElement("div");Nu.setAttribute("oninput","return;"),Hi=typeof Nu.oninput=="function"}Ui=Hi}else Ui=!1;wu=Ui&&(!document.documentMode||9<document.documentMode)}function Cu(){ds&&(ds.detachEvent("onpropertychange",Eu),ms=ds=null)}function Eu(e){if(e.propertyName==="value"&&pl(ms)){var t=[];xu(t,ms,e,ki(e)),uu(Ih,t)}}function ep(e,t,a){e==="focusin"?(Cu(),ds=t,ms=a,ds.attachEvent("onpropertychange",Eu)):e==="focusout"&&Cu()}function tp(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return pl(ms)}function ap(e,t){if(e==="click")return pl(t)}function np(e,t){if(e==="input"||e==="change")return pl(t)}function rp(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Kt=typeof Object.is=="function"?Object.is:rp;function fs(e,t){if(Kt(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(n=0;n<a.length;n++){var c=a[n];if(!mn.call(t,c)||!Kt(e[c],t[c]))return!1}return!0}function ku(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function qu(e,t){var a=ku(e);e=0;for(var n;a;){if(a.nodeType===3){if(n=e+a.textContent.length,e<=t&&n>=t)return{node:a,offset:t-e};e=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=ku(a)}}function Du(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Du(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Tu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=xa(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=xa(e.document)}return t}function Li(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var sp=Ka&&"documentMode"in document&&11>=document.documentMode,Cr=null,Bi=null,hs=null,Yi=!1;function Au(e,t,a){var n=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Yi||Cr==null||Cr!==xa(n)||(n=Cr,"selectionStart"in n&&Li(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),hs&&fs(hs,n)||(hs=n,n=ni(Bi,"onSelect"),0<n.length&&(t=new fl("onSelect","select",null,t,a),e.push({event:t,listeners:n}),t.target=Cr)))}function Wn(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Er={animationend:Wn("Animation","AnimationEnd"),animationiteration:Wn("Animation","AnimationIteration"),animationstart:Wn("Animation","AnimationStart"),transitionrun:Wn("Transition","TransitionRun"),transitionstart:Wn("Transition","TransitionStart"),transitioncancel:Wn("Transition","TransitionCancel"),transitionend:Wn("Transition","TransitionEnd")},Gi={},Ou={};Ka&&(Ou=document.createElement("div").style,"AnimationEvent"in window||(delete Er.animationend.animation,delete Er.animationiteration.animation,delete Er.animationstart.animation),"TransitionEvent"in window||delete Er.transitionend.transition);function Pn(e){if(Gi[e])return Gi[e];if(!Er[e])return e;var t=Er[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in Ou)return Gi[e]=t[a];return e}var Mu=Pn("animationend"),zu=Pn("animationiteration"),Ru=Pn("animationstart"),lp=Pn("transitionrun"),ip=Pn("transitionstart"),op=Pn("transitioncancel"),Uu=Pn("transitionend"),Hu=new Map,Qi="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Qi.push("scrollEnd");function wa(e,t){Hu.set(e,t),Qa(t,[e])}var gl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},ia=[],kr=0,Xi=0;function _l(){for(var e=kr,t=Xi=kr=0;t<e;){var a=ia[t];ia[t++]=null;var n=ia[t];ia[t++]=null;var c=ia[t];ia[t++]=null;var u=ia[t];if(ia[t++]=null,n!==null&&c!==null){var f=n.pending;f===null?c.next=c:(c.next=f.next,f.next=c),n.pending=c}u!==0&&Lu(a,c,u)}}function yl(e,t,a,n){ia[kr++]=e,ia[kr++]=t,ia[kr++]=a,ia[kr++]=n,Xi|=n,e.lanes|=n,e=e.alternate,e!==null&&(e.lanes|=n)}function Vi(e,t,a,n){return yl(e,t,a,n),vl(e)}function In(e,t){return yl(e,null,null,t),vl(e)}function Lu(e,t,a){e.lanes|=a;var n=e.alternate;n!==null&&(n.lanes|=a);for(var c=!1,u=e.return;u!==null;)u.childLanes|=a,n=u.alternate,n!==null&&(n.childLanes|=a),u.tag===22&&(e=u.stateNode,e===null||e._visibility&1||(c=!0)),e=u,u=u.return;return e.tag===3?(u=e.stateNode,c&&t!==null&&(c=31-kt(a),e=u.hiddenUpdates,n=e[c],n===null?e[c]=[t]:n.push(t),t.lane=a|536870912),u):null}function vl(e){if(50<Rs)throw Rs=0,tc=null,Error(o(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var qr={};function cp(e,t,a,n){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jt(e,t,a,n){return new cp(e,t,a,n)}function Zi(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Ja(e,t){var a=e.alternate;return a===null?(a=Jt(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Bu(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function bl(e,t,a,n,c,u){var f=0;if(n=e,typeof e=="function")Zi(e)&&(f=1);else if(typeof e=="string")f=hg(e,a,qe.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ve:return e=Jt(31,a,t,c),e.elementType=ve,e.lanes=u,e;case V:return er(a.children,c,u,t);case oe:f=8,c|=24;break;case ae:return e=Jt(12,a,t,c|2),e.elementType=ae,e.lanes=u,e;case xe:return e=Jt(13,a,t,c),e.elementType=xe,e.lanes=u,e;case ke:return e=Jt(19,a,t,c),e.elementType=ke,e.lanes=u,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case ue:f=10;break e;case me:f=9;break e;case J:f=11;break e;case Ue:f=14;break e;case ee:f=16,n=null;break e}f=29,a=Error(o(130,e===null?"null":typeof e,"")),n=null}return t=Jt(f,a,t,c),t.elementType=e,t.type=n,t.lanes=u,t}function er(e,t,a,n){return e=Jt(7,e,n,t),e.lanes=a,e}function Ki(e,t,a){return e=Jt(6,e,null,t),e.lanes=a,e}function Yu(e){var t=Jt(18,null,null,0);return t.stateNode=e,t}function Ji(e,t,a){return t=Jt(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Gu=new WeakMap;function oa(e,t){if(typeof e=="object"&&e!==null){var a=Gu.get(e);return a!==void 0?a:(t={value:e,source:t,stack:yr(t)},Gu.set(e,t),t)}return{value:e,source:t,stack:yr(t)}}var Dr=[],Tr=0,jl=null,ps=0,ca=[],ua=0,xn=null,Aa=1,Oa="";function Fa(e,t){Dr[Tr++]=ps,Dr[Tr++]=jl,jl=e,ps=t}function Qu(e,t,a){ca[ua++]=Aa,ca[ua++]=Oa,ca[ua++]=xn,xn=e;var n=Aa;e=Oa;var c=32-kt(n)-1;n&=~(1<<c),a+=1;var u=32-kt(t)+c;if(30<u){var f=c-c%5;u=(n&(1<<f)-1).toString(32),n>>=f,c-=f,Aa=1<<32-kt(t)+c|a<<c|n,Oa=u+e}else Aa=1<<u|a<<c|n,Oa=e}function Fi(e){e.return!==null&&(Fa(e,1),Qu(e,1,0))}function $i(e){for(;e===jl;)jl=Dr[--Tr],Dr[Tr]=null,ps=Dr[--Tr],Dr[Tr]=null;for(;e===xn;)xn=ca[--ua],ca[ua]=null,Oa=ca[--ua],ca[ua]=null,Aa=ca[--ua],ca[ua]=null}function Xu(e,t){ca[ua++]=Aa,ca[ua++]=Oa,ca[ua++]=xn,Aa=t.id,Oa=t.overflow,xn=e}var At=null,at=null,He=!1,Sn=null,da=!1,Wi=Error(o(519));function wn(e){var t=Error(o(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw gs(oa(t,e)),Wi}function Vu(e){var t=e.stateNode,a=e.type,n=e.memoizedProps;switch(t[tt]=e,t[Rt]=n,a){case"dialog":Oe("cancel",t),Oe("close",t);break;case"iframe":case"object":case"embed":Oe("load",t);break;case"video":case"audio":for(a=0;a<Hs.length;a++)Oe(Hs[a],t);break;case"source":Oe("error",t);break;case"img":case"image":case"link":Oe("error",t),Oe("load",t);break;case"details":Oe("toggle",t);break;case"input":Oe("invalid",t),cl(t,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":Oe("invalid",t);break;case"textarea":Oe("invalid",t),T(t,n.value,n.defaultValue,n.children)}a=n.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||n.suppressHydrationWarning===!0||cf(t.textContent,a)?(n.popover!=null&&(Oe("beforetoggle",t),Oe("toggle",t)),n.onScroll!=null&&Oe("scroll",t),n.onScrollEnd!=null&&Oe("scrollend",t),n.onClick!=null&&(t.onclick=Za),t=!0):t=!1,t||wn(e,!0)}function Zu(e){for(At=e.return;At;)switch(At.tag){case 5:case 31:case 13:da=!1;return;case 27:case 3:da=!0;return;default:At=At.return}}function Ar(e){if(e!==At)return!1;if(!He)return Zu(e),He=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||gc(e.type,e.memoizedProps)),a=!a),a&&at&&wn(e),Zu(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));at=yf(e)}else if(t===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));at=yf(e)}else t===27?(t=at,Hn(e.type)?(e=jc,jc=null,at=e):at=t):at=At?fa(e.stateNode.nextSibling):null;return!0}function tr(){at=At=null,He=!1}function Pi(){var e=Sn;return e!==null&&(Vt===null?Vt=e:Vt.push.apply(Vt,e),Sn=null),e}function gs(e){Sn===null?Sn=[e]:Sn.push(e)}var Ii=je(null),ar=null,$a=null;function Nn(e,t,a){ye(Ii,t._currentValue),t._currentValue=a}function Wa(e){e._currentValue=Ii.current,P(Ii)}function eo(e,t,a){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===a)break;e=e.return}}function to(e,t,a,n){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var u=c.dependencies;if(u!==null){var f=c.child;u=u.firstContext;e:for(;u!==null;){var g=u;u=c;for(var j=0;j<t.length;j++)if(g.context===t[j]){u.lanes|=a,g=u.alternate,g!==null&&(g.lanes|=a),eo(u.return,a,e),n||(f=null);break e}u=g.next}}else if(c.tag===18){if(f=c.return,f===null)throw Error(o(341));f.lanes|=a,u=f.alternate,u!==null&&(u.lanes|=a),eo(f,a,e),f=null}else f=c.child;if(f!==null)f.return=c;else for(f=c;f!==null;){if(f===e){f=null;break}if(c=f.sibling,c!==null){c.return=f.return,f=c;break}f=f.return}c=f}}function Or(e,t,a,n){e=null;for(var c=t,u=!1;c!==null;){if(!u){if((c.flags&524288)!==0)u=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var f=c.alternate;if(f===null)throw Error(o(387));if(f=f.memoizedProps,f!==null){var g=c.type;Kt(c.pendingProps.value,f.value)||(e!==null?e.push(g):e=[g])}}else if(c===Be.current){if(f=c.alternate,f===null)throw Error(o(387));f.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(Qs):e=[Qs])}c=c.return}e!==null&&to(t,e,a,n),t.flags|=262144}function xl(e){for(e=e.firstContext;e!==null;){if(!Kt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function nr(e){ar=e,$a=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Ot(e){return Ku(ar,e)}function Sl(e,t){return ar===null&&nr(e),Ku(e,t)}function Ku(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},$a===null){if(e===null)throw Error(o(308));$a=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else $a=$a.next=t;return a}var up=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},dp=s.unstable_scheduleCallback,mp=s.unstable_NormalPriority,ht={$$typeof:ue,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ao(){return{controller:new up,data:new Map,refCount:0}}function _s(e){e.refCount--,e.refCount===0&&dp(mp,function(){e.controller.abort()})}var ys=null,no=0,Mr=0,zr=null;function fp(e,t){if(ys===null){var a=ys=[];no=0,Mr=ic(),zr={status:"pending",value:void 0,then:function(n){a.push(n)}}}return no++,t.then(Ju,Ju),t}function Ju(){if(--no===0&&ys!==null){zr!==null&&(zr.status="fulfilled");var e=ys;ys=null,Mr=0,zr=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function hp(e,t){var a=[],n={status:"pending",value:null,reason:null,then:function(c){a.push(c)}};return e.then(function(){n.status="fulfilled",n.value=t;for(var c=0;c<a.length;c++)(0,a[c])(t)},function(c){for(n.status="rejected",n.reason=c,c=0;c<a.length;c++)(0,a[c])(void 0)}),n}var Fu=C.S;C.S=function(e,t){Am=yt(),typeof t=="object"&&t!==null&&typeof t.then=="function"&&fp(e,t),Fu!==null&&Fu(e,t)};var rr=je(null);function ro(){var e=rr.current;return e!==null?e:et.pooledCache}function wl(e,t){t===null?ye(rr,rr.current):ye(rr,t.pool)}function $u(){var e=ro();return e===null?null:{parent:ht._currentValue,pool:e}}var Rr=Error(o(460)),so=Error(o(474)),Nl=Error(o(542)),Cl={then:function(){}};function Wu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Pu(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(Za,Za),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,ed(e),e;default:if(typeof t.status=="string")t.then(Za,Za);else{if(e=et,e!==null&&100<e.shellSuspendCounter)throw Error(o(482));e=t,e.status="pending",e.then(function(n){if(t.status==="pending"){var c=t;c.status="fulfilled",c.value=n}},function(n){if(t.status==="pending"){var c=t;c.status="rejected",c.reason=n}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,ed(e),e}throw lr=t,Rr}}function sr(e){try{var t=e._init;return t(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(lr=a,Rr):a}}var lr=null;function Iu(){if(lr===null)throw Error(o(459));var e=lr;return lr=null,e}function ed(e){if(e===Rr||e===Nl)throw Error(o(483))}var Ur=null,vs=0;function El(e){var t=vs;return vs+=1,Ur===null&&(Ur=[]),Pu(Ur,e,t)}function bs(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function kl(e,t){throw t.$$typeof===$?Error(o(525)):(e=Object.prototype.toString.call(t),Error(o(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function td(e){function t(N,x){if(e){var E=N.deletions;E===null?(N.deletions=[x],N.flags|=16):E.push(x)}}function a(N,x){if(!e)return null;for(;x!==null;)t(N,x),x=x.sibling;return null}function n(N){for(var x=new Map;N!==null;)N.key!==null?x.set(N.key,N):x.set(N.index,N),N=N.sibling;return x}function c(N,x){return N=Ja(N,x),N.index=0,N.sibling=null,N}function u(N,x,E){return N.index=E,e?(E=N.alternate,E!==null?(E=E.index,E<x?(N.flags|=67108866,x):E):(N.flags|=67108866,x)):(N.flags|=1048576,x)}function f(N){return e&&N.alternate===null&&(N.flags|=67108866),N}function g(N,x,E,H){return x===null||x.tag!==6?(x=Ki(E,N.mode,H),x.return=N,x):(x=c(x,E),x.return=N,x)}function j(N,x,E,H){var ge=E.type;return ge===V?R(N,x,E.props.children,H,E.key):x!==null&&(x.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===ee&&sr(ge)===x.type)?(x=c(x,E.props),bs(x,E),x.return=N,x):(x=bl(E.type,E.key,E.props,null,N.mode,H),bs(x,E),x.return=N,x)}function k(N,x,E,H){return x===null||x.tag!==4||x.stateNode.containerInfo!==E.containerInfo||x.stateNode.implementation!==E.implementation?(x=Ji(E,N.mode,H),x.return=N,x):(x=c(x,E.children||[]),x.return=N,x)}function R(N,x,E,H,ge){return x===null||x.tag!==7?(x=er(E,N.mode,H,ge),x.return=N,x):(x=c(x,E),x.return=N,x)}function L(N,x,E){if(typeof x=="string"&&x!==""||typeof x=="number"||typeof x=="bigint")return x=Ki(""+x,N.mode,E),x.return=N,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case W:return E=bl(x.type,x.key,x.props,null,N.mode,E),bs(E,x),E.return=N,E;case te:return x=Ji(x,N.mode,E),x.return=N,x;case ee:return x=sr(x),L(N,x,E)}if(pe(x)||M(x))return x=er(x,N.mode,E,null),x.return=N,x;if(typeof x.then=="function")return L(N,El(x),E);if(x.$$typeof===ue)return L(N,Sl(N,x),E);kl(N,x)}return null}function D(N,x,E,H){var ge=x!==null?x.key:null;if(typeof E=="string"&&E!==""||typeof E=="number"||typeof E=="bigint")return ge!==null?null:g(N,x,""+E,H);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case W:return E.key===ge?j(N,x,E,H):null;case te:return E.key===ge?k(N,x,E,H):null;case ee:return E=sr(E),D(N,x,E,H)}if(pe(E)||M(E))return ge!==null?null:R(N,x,E,H,null);if(typeof E.then=="function")return D(N,x,El(E),H);if(E.$$typeof===ue)return D(N,x,Sl(N,E),H);kl(N,E)}return null}function A(N,x,E,H,ge){if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return N=N.get(E)||null,g(x,N,""+H,ge);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case W:return N=N.get(H.key===null?E:H.key)||null,j(x,N,H,ge);case te:return N=N.get(H.key===null?E:H.key)||null,k(x,N,H,ge);case ee:return H=sr(H),A(N,x,E,H,ge)}if(pe(H)||M(H))return N=N.get(E)||null,R(x,N,H,ge,null);if(typeof H.then=="function")return A(N,x,E,El(H),ge);if(H.$$typeof===ue)return A(N,x,E,Sl(x,H),ge);kl(x,H)}return null}function ce(N,x,E,H){for(var ge=null,Ye=null,de=x,Ne=x=0,Re=null;de!==null&&Ne<E.length;Ne++){de.index>Ne?(Re=de,de=null):Re=de.sibling;var Ge=D(N,de,E[Ne],H);if(Ge===null){de===null&&(de=Re);break}e&&de&&Ge.alternate===null&&t(N,de),x=u(Ge,x,Ne),Ye===null?ge=Ge:Ye.sibling=Ge,Ye=Ge,de=Re}if(Ne===E.length)return a(N,de),He&&Fa(N,Ne),ge;if(de===null){for(;Ne<E.length;Ne++)de=L(N,E[Ne],H),de!==null&&(x=u(de,x,Ne),Ye===null?ge=de:Ye.sibling=de,Ye=de);return He&&Fa(N,Ne),ge}for(de=n(de);Ne<E.length;Ne++)Re=A(de,N,Ne,E[Ne],H),Re!==null&&(e&&Re.alternate!==null&&de.delete(Re.key===null?Ne:Re.key),x=u(Re,x,Ne),Ye===null?ge=Re:Ye.sibling=Re,Ye=Re);return e&&de.forEach(function(Qn){return t(N,Qn)}),He&&Fa(N,Ne),ge}function be(N,x,E,H){if(E==null)throw Error(o(151));for(var ge=null,Ye=null,de=x,Ne=x=0,Re=null,Ge=E.next();de!==null&&!Ge.done;Ne++,Ge=E.next()){de.index>Ne?(Re=de,de=null):Re=de.sibling;var Qn=D(N,de,Ge.value,H);if(Qn===null){de===null&&(de=Re);break}e&&de&&Qn.alternate===null&&t(N,de),x=u(Qn,x,Ne),Ye===null?ge=Qn:Ye.sibling=Qn,Ye=Qn,de=Re}if(Ge.done)return a(N,de),He&&Fa(N,Ne),ge;if(de===null){for(;!Ge.done;Ne++,Ge=E.next())Ge=L(N,Ge.value,H),Ge!==null&&(x=u(Ge,x,Ne),Ye===null?ge=Ge:Ye.sibling=Ge,Ye=Ge);return He&&Fa(N,Ne),ge}for(de=n(de);!Ge.done;Ne++,Ge=E.next())Ge=A(de,N,Ne,Ge.value,H),Ge!==null&&(e&&Ge.alternate!==null&&de.delete(Ge.key===null?Ne:Ge.key),x=u(Ge,x,Ne),Ye===null?ge=Ge:Ye.sibling=Ge,Ye=Ge);return e&&de.forEach(function(Ng){return t(N,Ng)}),He&&Fa(N,Ne),ge}function Ie(N,x,E,H){if(typeof E=="object"&&E!==null&&E.type===V&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case W:e:{for(var ge=E.key;x!==null;){if(x.key===ge){if(ge=E.type,ge===V){if(x.tag===7){a(N,x.sibling),H=c(x,E.props.children),H.return=N,N=H;break e}}else if(x.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===ee&&sr(ge)===x.type){a(N,x.sibling),H=c(x,E.props),bs(H,E),H.return=N,N=H;break e}a(N,x);break}else t(N,x);x=x.sibling}E.type===V?(H=er(E.props.children,N.mode,H,E.key),H.return=N,N=H):(H=bl(E.type,E.key,E.props,null,N.mode,H),bs(H,E),H.return=N,N=H)}return f(N);case te:e:{for(ge=E.key;x!==null;){if(x.key===ge)if(x.tag===4&&x.stateNode.containerInfo===E.containerInfo&&x.stateNode.implementation===E.implementation){a(N,x.sibling),H=c(x,E.children||[]),H.return=N,N=H;break e}else{a(N,x);break}else t(N,x);x=x.sibling}H=Ji(E,N.mode,H),H.return=N,N=H}return f(N);case ee:return E=sr(E),Ie(N,x,E,H)}if(pe(E))return ce(N,x,E,H);if(M(E)){if(ge=M(E),typeof ge!="function")throw Error(o(150));return E=ge.call(E),be(N,x,E,H)}if(typeof E.then=="function")return Ie(N,x,El(E),H);if(E.$$typeof===ue)return Ie(N,x,Sl(N,E),H);kl(N,E)}return typeof E=="string"&&E!==""||typeof E=="number"||typeof E=="bigint"?(E=""+E,x!==null&&x.tag===6?(a(N,x.sibling),H=c(x,E),H.return=N,N=H):(a(N,x),H=Ki(E,N.mode,H),H.return=N,N=H),f(N)):a(N,x)}return function(N,x,E,H){try{vs=0;var ge=Ie(N,x,E,H);return Ur=null,ge}catch(de){if(de===Rr||de===Nl)throw de;var Ye=Jt(29,de,null,N.mode);return Ye.lanes=H,Ye.return=N,Ye}finally{}}}var ir=td(!0),ad=td(!1),Cn=!1;function lo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function io(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function En(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function kn(e,t,a){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,(Xe&2)!==0){var c=n.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),n.pending=t,t=vl(e),Lu(e,null,a),t}return yl(e,n,t,a),vl(e)}function js(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,br(e,a)}}function oo(e,t){var a=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,a===n)){var c=null,u=null;if(a=a.firstBaseUpdate,a!==null){do{var f={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};u===null?c=u=f:u=u.next=f,a=a.next}while(a!==null);u===null?c=u=t:u=u.next=t}else c=u=t;a={baseState:n.baseState,firstBaseUpdate:c,lastBaseUpdate:u,shared:n.shared,callbacks:n.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var co=!1;function xs(){if(co){var e=zr;if(e!==null)throw e}}function Ss(e,t,a,n){co=!1;var c=e.updateQueue;Cn=!1;var u=c.firstBaseUpdate,f=c.lastBaseUpdate,g=c.shared.pending;if(g!==null){c.shared.pending=null;var j=g,k=j.next;j.next=null,f===null?u=k:f.next=k,f=j;var R=e.alternate;R!==null&&(R=R.updateQueue,g=R.lastBaseUpdate,g!==f&&(g===null?R.firstBaseUpdate=k:g.next=k,R.lastBaseUpdate=j))}if(u!==null){var L=c.baseState;f=0,R=k=j=null,g=u;do{var D=g.lane&-536870913,A=D!==g.lane;if(A?(ze&D)===D:(n&D)===D){D!==0&&D===Mr&&(co=!0),R!==null&&(R=R.next={lane:0,tag:g.tag,payload:g.payload,callback:null,next:null});e:{var ce=e,be=g;D=t;var Ie=a;switch(be.tag){case 1:if(ce=be.payload,typeof ce=="function"){L=ce.call(Ie,L,D);break e}L=ce;break e;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=be.payload,D=typeof ce=="function"?ce.call(Ie,L,D):ce,D==null)break e;L=O({},L,D);break e;case 2:Cn=!0}}D=g.callback,D!==null&&(e.flags|=64,A&&(e.flags|=8192),A=c.callbacks,A===null?c.callbacks=[D]:A.push(D))}else A={lane:D,tag:g.tag,payload:g.payload,callback:g.callback,next:null},R===null?(k=R=A,j=L):R=R.next=A,f|=D;if(g=g.next,g===null){if(g=c.shared.pending,g===null)break;A=g,g=A.next,A.next=null,c.lastBaseUpdate=A,c.shared.pending=null}}while(!0);R===null&&(j=L),c.baseState=j,c.firstBaseUpdate=k,c.lastBaseUpdate=R,u===null&&(c.shared.lanes=0),On|=f,e.lanes=f,e.memoizedState=L}}function nd(e,t){if(typeof e!="function")throw Error(o(191,e));e.call(t)}function rd(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)nd(a[e],t)}var Hr=je(null),ql=je(0);function sd(e,t){e=ln,ye(ql,e),ye(Hr,t),ln=e|t.baseLanes}function uo(){ye(ql,ln),ye(Hr,Hr.current)}function mo(){ln=ql.current,P(Hr),P(ql)}var Ft=je(null),ma=null;function qn(e){var t=e.alternate;ye(ut,ut.current&1),ye(Ft,e),ma===null&&(t===null||Hr.current!==null||t.memoizedState!==null)&&(ma=e)}function fo(e){ye(ut,ut.current),ye(Ft,e),ma===null&&(ma=e)}function ld(e){e.tag===22?(ye(ut,ut.current),ye(Ft,e),ma===null&&(ma=e)):Dn()}function Dn(){ye(ut,ut.current),ye(Ft,Ft.current)}function $t(e){P(Ft),ma===e&&(ma=null),P(ut)}var ut=je(0);function Dl(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||vc(a)||bc(a)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder==="forwards"||t.memoizedProps.revealOrder==="backwards"||t.memoizedProps.revealOrder==="unstable_legacy-backwards"||t.memoizedProps.revealOrder==="together")){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Pa=0,we=null,We=null,pt=null,Tl=!1,Lr=!1,or=!1,Al=0,ws=0,Br=null,pp=0;function lt(){throw Error(o(321))}function ho(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Kt(e[a],t[a]))return!1;return!0}function po(e,t,a,n,c,u){return Pa=u,we=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,C.H=e===null||e.memoizedState===null?Qd:Do,or=!1,u=a(n,c),or=!1,Lr&&(u=od(t,a,n,c)),id(e),u}function id(e){C.H=Es;var t=We!==null&&We.next!==null;if(Pa=0,pt=We=we=null,Tl=!1,ws=0,Br=null,t)throw Error(o(300));e===null||gt||(e=e.dependencies,e!==null&&xl(e)&&(gt=!0))}function od(e,t,a,n){we=e;var c=0;do{if(Lr&&(Br=null),ws=0,Lr=!1,25<=c)throw Error(o(301));if(c+=1,pt=We=null,e.updateQueue!=null){var u=e.updateQueue;u.lastEffect=null,u.events=null,u.stores=null,u.memoCache!=null&&(u.memoCache.index=0)}C.H=Xd,u=t(a,n)}while(Lr);return u}function gp(){var e=C.H,t=e.useState()[0];return t=typeof t.then=="function"?Ns(t):t,e=e.useState()[0],(We!==null?We.memoizedState:null)!==e&&(we.flags|=1024),t}function go(){var e=Al!==0;return Al=0,e}function _o(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function yo(e){if(Tl){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}Tl=!1}Pa=0,pt=We=we=null,Lr=!1,ws=Al=0,Br=null}function Lt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pt===null?we.memoizedState=pt=e:pt=pt.next=e,pt}function dt(){if(We===null){var e=we.alternate;e=e!==null?e.memoizedState:null}else e=We.next;var t=pt===null?we.memoizedState:pt.next;if(t!==null)pt=t,We=e;else{if(e===null)throw we.alternate===null?Error(o(467)):Error(o(310));We=e,e={memoizedState:We.memoizedState,baseState:We.baseState,baseQueue:We.baseQueue,queue:We.queue,next:null},pt===null?we.memoizedState=pt=e:pt=pt.next=e}return pt}function Ol(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ns(e){var t=ws;return ws+=1,Br===null&&(Br=[]),e=Pu(Br,e,t),t=we,(pt===null?t.memoizedState:pt.next)===null&&(t=t.alternate,C.H=t===null||t.memoizedState===null?Qd:Do),e}function Ml(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Ns(e);if(e.$$typeof===ue)return Ot(e)}throw Error(o(438,String(e)))}function vo(e){var t=null,a=we.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var n=we.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(t={data:n.data.map(function(c){return c.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=Ol(),we.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),n=0;n<e;n++)a[n]=Ve;return t.index++,a}function Ia(e,t){return typeof t=="function"?t(e):t}function zl(e){var t=dt();return bo(t,We,e)}function bo(e,t,a){var n=e.queue;if(n===null)throw Error(o(311));n.lastRenderedReducer=a;var c=e.baseQueue,u=n.pending;if(u!==null){if(c!==null){var f=c.next;c.next=u.next,u.next=f}t.baseQueue=c=u,n.pending=null}if(u=e.baseState,c===null)e.memoizedState=u;else{t=c.next;var g=f=null,j=null,k=t,R=!1;do{var L=k.lane&-536870913;if(L!==k.lane?(ze&L)===L:(Pa&L)===L){var D=k.revertLane;if(D===0)j!==null&&(j=j.next={lane:0,revertLane:0,gesture:null,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),L===Mr&&(R=!0);else if((Pa&D)===D){k=k.next,D===Mr&&(R=!0);continue}else L={lane:0,revertLane:k.revertLane,gesture:null,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null},j===null?(g=j=L,f=u):j=j.next=L,we.lanes|=D,On|=D;L=k.action,or&&a(u,L),u=k.hasEagerState?k.eagerState:a(u,L)}else D={lane:L,revertLane:k.revertLane,gesture:k.gesture,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null},j===null?(g=j=D,f=u):j=j.next=D,we.lanes|=L,On|=L;k=k.next}while(k!==null&&k!==t);if(j===null?f=u:j.next=g,!Kt(u,e.memoizedState)&&(gt=!0,R&&(a=zr,a!==null)))throw a;e.memoizedState=u,e.baseState=f,e.baseQueue=j,n.lastRenderedState=u}return c===null&&(n.lanes=0),[e.memoizedState,n.dispatch]}function jo(e){var t=dt(),a=t.queue;if(a===null)throw Error(o(311));a.lastRenderedReducer=e;var n=a.dispatch,c=a.pending,u=t.memoizedState;if(c!==null){a.pending=null;var f=c=c.next;do u=e(u,f.action),f=f.next;while(f!==c);Kt(u,t.memoizedState)||(gt=!0),t.memoizedState=u,t.baseQueue===null&&(t.baseState=u),a.lastRenderedState=u}return[u,n]}function cd(e,t,a){var n=we,c=dt(),u=He;if(u){if(a===void 0)throw Error(o(407));a=a()}else a=t();var f=!Kt((We||c).memoizedState,a);if(f&&(c.memoizedState=a,gt=!0),c=c.queue,wo(md.bind(null,n,c,e),[e]),c.getSnapshot!==t||f||pt!==null&&pt.memoizedState.tag&1){if(n.flags|=2048,Yr(9,{destroy:void 0},dd.bind(null,n,c,a,t),null),et===null)throw Error(o(349));u||(Pa&127)!==0||ud(n,t,a)}return a}function ud(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=we.updateQueue,t===null?(t=Ol(),we.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function dd(e,t,a,n){t.value=a,t.getSnapshot=n,fd(t)&&hd(e)}function md(e,t,a){return a(function(){fd(t)&&hd(e)})}function fd(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Kt(e,a)}catch{return!0}}function hd(e){var t=In(e,2);t!==null&&Zt(t,e,2)}function xo(e){var t=Lt();if(typeof e=="function"){var a=e;if(e=a(),or){se(!0);try{a()}finally{se(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:e},t}function pd(e,t,a,n){return e.baseState=a,bo(e,We,typeof n=="function"?n:Ia)}function _p(e,t,a,n,c){if(Hl(e))throw Error(o(485));if(e=t.action,e!==null){var u={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(f){u.listeners.push(f)}};C.T!==null?a(!0):u.isTransition=!1,n(u),a=t.pending,a===null?(u.next=t.pending=u,gd(t,u)):(u.next=a.next,t.pending=a.next=u)}}function gd(e,t){var a=t.action,n=t.payload,c=e.state;if(t.isTransition){var u=C.T,f={};C.T=f;try{var g=a(c,n),j=C.S;j!==null&&j(f,g),_d(e,t,g)}catch(k){So(e,t,k)}finally{u!==null&&f.types!==null&&(u.types=f.types),C.T=u}}else try{u=a(c,n),_d(e,t,u)}catch(k){So(e,t,k)}}function _d(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(n){yd(e,t,n)},function(n){return So(e,t,n)}):yd(e,t,a)}function yd(e,t,a){t.status="fulfilled",t.value=a,vd(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,gd(e,a)))}function So(e,t,a){var n=e.pending;if(e.pending=null,n!==null){n=n.next;do t.status="rejected",t.reason=a,vd(t),t=t.next;while(t!==n)}e.action=null}function vd(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function bd(e,t){return t}function jd(e,t){if(He){var a=et.formState;if(a!==null){e:{var n=we;if(He){if(at){t:{for(var c=at,u=da;c.nodeType!==8;){if(!u){c=null;break t}if(c=fa(c.nextSibling),c===null){c=null;break t}}u=c.data,c=u==="F!"||u==="F"?c:null}if(c){at=fa(c.nextSibling),n=c.data==="F!";break e}}wn(n)}n=!1}n&&(t=a[0])}}return a=Lt(),a.memoizedState=a.baseState=t,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:bd,lastRenderedState:t},a.queue=n,a=Bd.bind(null,we,n),n.dispatch=a,n=xo(!1),u=qo.bind(null,we,!1,n.queue),n=Lt(),c={state:t,dispatch:null,action:e,pending:null},n.queue=c,a=_p.bind(null,we,c,u,a),c.dispatch=a,n.memoizedState=e,[t,a,!1]}function xd(e){var t=dt();return Sd(t,We,e)}function Sd(e,t,a){if(t=bo(e,t,bd)[0],e=zl(Ia)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var n=Ns(t)}catch(f){throw f===Rr?Nl:f}else n=t;t=dt();var c=t.queue,u=c.dispatch;return a!==t.memoizedState&&(we.flags|=2048,Yr(9,{destroy:void 0},yp.bind(null,c,a),null)),[n,u,e]}function yp(e,t){e.action=t}function wd(e){var t=dt(),a=We;if(a!==null)return Sd(t,a,e);dt(),t=t.memoizedState,a=dt();var n=a.queue.dispatch;return a.memoizedState=e,[t,n,!1]}function Yr(e,t,a,n){return e={tag:e,create:a,deps:n,inst:t,next:null},t=we.updateQueue,t===null&&(t=Ol(),we.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(n=a.next,a.next=e,e.next=n,t.lastEffect=e),e}function Nd(){return dt().memoizedState}function Rl(e,t,a,n){var c=Lt();we.flags|=e,c.memoizedState=Yr(1|t,{destroy:void 0},a,n===void 0?null:n)}function Ul(e,t,a,n){var c=dt();n=n===void 0?null:n;var u=c.memoizedState.inst;We!==null&&n!==null&&ho(n,We.memoizedState.deps)?c.memoizedState=Yr(t,u,a,n):(we.flags|=e,c.memoizedState=Yr(1|t,u,a,n))}function Cd(e,t){Rl(8390656,8,e,t)}function wo(e,t){Ul(2048,8,e,t)}function vp(e){we.flags|=4;var t=we.updateQueue;if(t===null)t=Ol(),we.updateQueue=t,t.events=[e];else{var a=t.events;a===null?t.events=[e]:a.push(e)}}function Ed(e){var t=dt().memoizedState;return vp({ref:t,nextImpl:e}),function(){if((Xe&2)!==0)throw Error(o(440));return t.impl.apply(void 0,arguments)}}function kd(e,t){return Ul(4,2,e,t)}function qd(e,t){return Ul(4,4,e,t)}function Dd(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Td(e,t,a){a=a!=null?a.concat([e]):null,Ul(4,4,Dd.bind(null,t,e),a)}function No(){}function Ad(e,t){var a=dt();t=t===void 0?null:t;var n=a.memoizedState;return t!==null&&ho(t,n[1])?n[0]:(a.memoizedState=[e,t],e)}function Od(e,t){var a=dt();t=t===void 0?null:t;var n=a.memoizedState;if(t!==null&&ho(t,n[1]))return n[0];if(n=e(),or){se(!0);try{e()}finally{se(!1)}}return a.memoizedState=[n,t],n}function Co(e,t,a){return a===void 0||(Pa&1073741824)!==0&&(ze&261930)===0?e.memoizedState=t:(e.memoizedState=a,e=Mm(),we.lanes|=e,On|=e,a)}function Md(e,t,a,n){return Kt(a,t)?a:Hr.current!==null?(e=Co(e,a,n),Kt(e,t)||(gt=!0),e):(Pa&42)===0||(Pa&1073741824)!==0&&(ze&261930)===0?(gt=!0,e.memoizedState=a):(e=Mm(),we.lanes|=e,On|=e,t)}function zd(e,t,a,n,c){var u=X.p;X.p=u!==0&&8>u?u:8;var f=C.T,g={};C.T=g,qo(e,!1,t,a);try{var j=c(),k=C.S;if(k!==null&&k(g,j),j!==null&&typeof j=="object"&&typeof j.then=="function"){var R=hp(j,n);Cs(e,t,R,It(e))}else Cs(e,t,n,It(e))}catch(L){Cs(e,t,{then:function(){},status:"rejected",reason:L},It())}finally{X.p=u,f!==null&&g.types!==null&&(f.types=g.types),C.T=f}}function bp(){}function Eo(e,t,a,n){if(e.tag!==5)throw Error(o(476));var c=Rd(e).queue;zd(e,c,t,I,a===null?bp:function(){return Ud(e),a(n)})}function Rd(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:I,baseState:I,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:I},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Ud(e){var t=Rd(e);t.next===null&&(t=e.alternate.memoizedState),Cs(e,t.next.queue,{},It())}function ko(){return Ot(Qs)}function Hd(){return dt().memoizedState}function Ld(){return dt().memoizedState}function jp(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=It();e=En(a);var n=kn(t,e,a);n!==null&&(Zt(n,t,a),js(n,t,a)),t={cache:ao()},e.payload=t;return}t=t.return}}function xp(e,t,a){var n=It();a={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},Hl(e)?Yd(t,a):(a=Vi(e,t,a,n),a!==null&&(Zt(a,e,n),Gd(a,t,n)))}function Bd(e,t,a){var n=It();Cs(e,t,a,n)}function Cs(e,t,a,n){var c={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(Hl(e))Yd(t,c);else{var u=e.alternate;if(e.lanes===0&&(u===null||u.lanes===0)&&(u=t.lastRenderedReducer,u!==null))try{var f=t.lastRenderedState,g=u(f,a);if(c.hasEagerState=!0,c.eagerState=g,Kt(g,f))return yl(e,t,c,0),et===null&&_l(),!1}catch{}finally{}if(a=Vi(e,t,c,n),a!==null)return Zt(a,e,n),Gd(a,t,n),!0}return!1}function qo(e,t,a,n){if(n={lane:2,revertLane:ic(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Hl(e)){if(t)throw Error(o(479))}else t=Vi(e,a,n,2),t!==null&&Zt(t,e,2)}function Hl(e){var t=e.alternate;return e===we||t!==null&&t===we}function Yd(e,t){Lr=Tl=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function Gd(e,t,a){if((a&4194048)!==0){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,br(e,a)}}var Es={readContext:Ot,use:Ml,useCallback:lt,useContext:lt,useEffect:lt,useImperativeHandle:lt,useLayoutEffect:lt,useInsertionEffect:lt,useMemo:lt,useReducer:lt,useRef:lt,useState:lt,useDebugValue:lt,useDeferredValue:lt,useTransition:lt,useSyncExternalStore:lt,useId:lt,useHostTransitionStatus:lt,useFormState:lt,useActionState:lt,useOptimistic:lt,useMemoCache:lt,useCacheRefresh:lt};Es.useEffectEvent=lt;var Qd={readContext:Ot,use:Ml,useCallback:function(e,t){return Lt().memoizedState=[e,t===void 0?null:t],e},useContext:Ot,useEffect:Cd,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,Rl(4194308,4,Dd.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Rl(4194308,4,e,t)},useInsertionEffect:function(e,t){Rl(4,2,e,t)},useMemo:function(e,t){var a=Lt();t=t===void 0?null:t;var n=e();if(or){se(!0);try{e()}finally{se(!1)}}return a.memoizedState=[n,t],n},useReducer:function(e,t,a){var n=Lt();if(a!==void 0){var c=a(t);if(or){se(!0);try{a(t)}finally{se(!1)}}}else c=t;return n.memoizedState=n.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},n.queue=e,e=e.dispatch=xp.bind(null,we,e),[n.memoizedState,e]},useRef:function(e){var t=Lt();return e={current:e},t.memoizedState=e},useState:function(e){e=xo(e);var t=e.queue,a=Bd.bind(null,we,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:No,useDeferredValue:function(e,t){var a=Lt();return Co(a,e,t)},useTransition:function(){var e=xo(!1);return e=zd.bind(null,we,e.queue,!0,!1),Lt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var n=we,c=Lt();if(He){if(a===void 0)throw Error(o(407));a=a()}else{if(a=t(),et===null)throw Error(o(349));(ze&127)!==0||ud(n,t,a)}c.memoizedState=a;var u={value:a,getSnapshot:t};return c.queue=u,Cd(md.bind(null,n,u,e),[e]),n.flags|=2048,Yr(9,{destroy:void 0},dd.bind(null,n,u,a,t),null),a},useId:function(){var e=Lt(),t=et.identifierPrefix;if(He){var a=Oa,n=Aa;a=(n&~(1<<32-kt(n)-1)).toString(32)+a,t="_"+t+"R_"+a,a=Al++,0<a&&(t+="H"+a.toString(32)),t+="_"}else a=pp++,t="_"+t+"r_"+a.toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:ko,useFormState:jd,useActionState:jd,useOptimistic:function(e){var t=Lt();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=qo.bind(null,we,!0,a),a.dispatch=t,[e,t]},useMemoCache:vo,useCacheRefresh:function(){return Lt().memoizedState=jp.bind(null,we)},useEffectEvent:function(e){var t=Lt(),a={impl:e};return t.memoizedState=a,function(){if((Xe&2)!==0)throw Error(o(440));return a.impl.apply(void 0,arguments)}}},Do={readContext:Ot,use:Ml,useCallback:Ad,useContext:Ot,useEffect:wo,useImperativeHandle:Td,useInsertionEffect:kd,useLayoutEffect:qd,useMemo:Od,useReducer:zl,useRef:Nd,useState:function(){return zl(Ia)},useDebugValue:No,useDeferredValue:function(e,t){var a=dt();return Md(a,We.memoizedState,e,t)},useTransition:function(){var e=zl(Ia)[0],t=dt().memoizedState;return[typeof e=="boolean"?e:Ns(e),t]},useSyncExternalStore:cd,useId:Hd,useHostTransitionStatus:ko,useFormState:xd,useActionState:xd,useOptimistic:function(e,t){var a=dt();return pd(a,We,e,t)},useMemoCache:vo,useCacheRefresh:Ld};Do.useEffectEvent=Ed;var Xd={readContext:Ot,use:Ml,useCallback:Ad,useContext:Ot,useEffect:wo,useImperativeHandle:Td,useInsertionEffect:kd,useLayoutEffect:qd,useMemo:Od,useReducer:jo,useRef:Nd,useState:function(){return jo(Ia)},useDebugValue:No,useDeferredValue:function(e,t){var a=dt();return We===null?Co(a,e,t):Md(a,We.memoizedState,e,t)},useTransition:function(){var e=jo(Ia)[0],t=dt().memoizedState;return[typeof e=="boolean"?e:Ns(e),t]},useSyncExternalStore:cd,useId:Hd,useHostTransitionStatus:ko,useFormState:wd,useActionState:wd,useOptimistic:function(e,t){var a=dt();return We!==null?pd(a,We,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:vo,useCacheRefresh:Ld};Xd.useEffectEvent=Ed;function To(e,t,a,n){t=e.memoizedState,a=a(n,t),a=a==null?t:O({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Ao={enqueueSetState:function(e,t,a){e=e._reactInternals;var n=It(),c=En(n);c.payload=t,a!=null&&(c.callback=a),t=kn(e,c,n),t!==null&&(Zt(t,e,n),js(t,e,n))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var n=It(),c=En(n);c.tag=1,c.payload=t,a!=null&&(c.callback=a),t=kn(e,c,n),t!==null&&(Zt(t,e,n),js(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=It(),n=En(a);n.tag=2,t!=null&&(n.callback=t),t=kn(e,n,a),t!==null&&(Zt(t,e,a),js(t,e,a))}};function Vd(e,t,a,n,c,u,f){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,u,f):t.prototype&&t.prototype.isPureReactComponent?!fs(a,n)||!fs(c,u):!0}function Zd(e,t,a,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,n),t.state!==e&&Ao.enqueueReplaceState(t,t.state,null)}function cr(e,t){var a=t;if("ref"in t){a={};for(var n in t)n!=="ref"&&(a[n]=t[n])}if(e=e.defaultProps){a===t&&(a=O({},a));for(var c in e)a[c]===void 0&&(a[c]=e[c])}return a}function Kd(e){gl(e)}function Jd(e){console.error(e)}function Fd(e){gl(e)}function Ll(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function $d(e,t,a){try{var n=e.onCaughtError;n(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function Oo(e,t,a){return a=En(a),a.tag=3,a.payload={element:null},a.callback=function(){Ll(e,t)},a}function Wd(e){return e=En(e),e.tag=3,e}function Pd(e,t,a,n){var c=a.type.getDerivedStateFromError;if(typeof c=="function"){var u=n.value;e.payload=function(){return c(u)},e.callback=function(){$d(t,a,n)}}var f=a.stateNode;f!==null&&typeof f.componentDidCatch=="function"&&(e.callback=function(){$d(t,a,n),typeof c!="function"&&(Mn===null?Mn=new Set([this]):Mn.add(this));var g=n.stack;this.componentDidCatch(n.value,{componentStack:g!==null?g:""})})}function Sp(e,t,a,n,c){if(a.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(t=a.alternate,t!==null&&Or(t,a,c,!0),a=Ft.current,a!==null){switch(a.tag){case 31:case 13:return ma===null?Wl():a.alternate===null&&it===0&&(it=3),a.flags&=-257,a.flags|=65536,a.lanes=c,n===Cl?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([n]):t.add(n),rc(e,n,c)),!1;case 22:return a.flags|=65536,n===Cl?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([n])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([n]):a.add(n)),rc(e,n,c)),!1}throw Error(o(435,a.tag))}return rc(e,n,c),Wl(),!1}if(He)return t=Ft.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=c,n!==Wi&&(e=Error(o(422),{cause:n}),gs(oa(e,a)))):(n!==Wi&&(t=Error(o(423),{cause:n}),gs(oa(t,a))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,n=oa(n,a),c=Oo(e.stateNode,n,c),oo(e,c),it!==4&&(it=2)),!1;var u=Error(o(520),{cause:n});if(u=oa(u,a),zs===null?zs=[u]:zs.push(u),it!==4&&(it=2),t===null)return!0;n=oa(n,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=c&-c,a.lanes|=e,e=Oo(a.stateNode,n,e),oo(a,e),!1;case 1:if(t=a.type,u=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||u!==null&&typeof u.componentDidCatch=="function"&&(Mn===null||!Mn.has(u))))return a.flags|=65536,c&=-c,a.lanes|=c,c=Wd(c),Pd(c,e,a,n),oo(a,c),!1}a=a.return}while(a!==null);return!1}var Mo=Error(o(461)),gt=!1;function Mt(e,t,a,n){t.child=e===null?ad(t,null,a,n):ir(t,e.child,a,n)}function Id(e,t,a,n,c){a=a.render;var u=t.ref;if("ref"in n){var f={};for(var g in n)g!=="ref"&&(f[g]=n[g])}else f=n;return nr(t),n=po(e,t,a,f,u,c),g=go(),e!==null&&!gt?(_o(e,t,c),en(e,t,c)):(He&&g&&Fi(t),t.flags|=1,Mt(e,t,n,c),t.child)}function em(e,t,a,n,c){if(e===null){var u=a.type;return typeof u=="function"&&!Zi(u)&&u.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=u,tm(e,t,u,n,c)):(e=bl(a.type,null,n,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(u=e.child,!Go(e,c)){var f=u.memoizedProps;if(a=a.compare,a=a!==null?a:fs,a(f,n)&&e.ref===t.ref)return en(e,t,c)}return t.flags|=1,e=Ja(u,n),e.ref=t.ref,e.return=t,t.child=e}function tm(e,t,a,n,c){if(e!==null){var u=e.memoizedProps;if(fs(u,n)&&e.ref===t.ref)if(gt=!1,t.pendingProps=n=u,Go(e,c))(e.flags&131072)!==0&&(gt=!0);else return t.lanes=e.lanes,en(e,t,c)}return zo(e,t,a,n,c)}function am(e,t,a,n){var c=n.children,u=e!==null?e.memoizedState:null;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((t.flags&128)!==0){if(u=u!==null?u.baseLanes|a:a,e!==null){for(n=t.child=e.child,c=0;n!==null;)c=c|n.lanes|n.childLanes,n=n.sibling;n=c&~u}else n=0,t.child=null;return nm(e,t,u,a,n)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&wl(t,u!==null?u.cachePool:null),u!==null?sd(t,u):uo(),ld(t);else return n=t.lanes=536870912,nm(e,t,u!==null?u.baseLanes|a:a,a,n)}else u!==null?(wl(t,u.cachePool),sd(t,u),Dn(),t.memoizedState=null):(e!==null&&wl(t,null),uo(),Dn());return Mt(e,t,c,a),t.child}function ks(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function nm(e,t,a,n,c){var u=ro();return u=u===null?null:{parent:ht._currentValue,pool:u},t.memoizedState={baseLanes:a,cachePool:u},e!==null&&wl(t,null),uo(),ld(t),e!==null&&Or(e,t,n,!0),t.childLanes=c,null}function Bl(e,t){return t=Gl({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function rm(e,t,a){return ir(t,e.child,null,a),e=Bl(t,t.pendingProps),e.flags|=2,$t(t),t.memoizedState=null,e}function wp(e,t,a){var n=t.pendingProps,c=(t.flags&128)!==0;if(t.flags&=-129,e===null){if(He){if(n.mode==="hidden")return e=Bl(t,n),t.lanes=536870912,ks(null,e);if(fo(t),(e=at)?(e=_f(e,da),e=e!==null&&e.data==="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:xn!==null?{id:Aa,overflow:Oa}:null,retryLane:536870912,hydrationErrors:null},a=Yu(e),a.return=t,t.child=a,At=t,at=null)):e=null,e===null)throw wn(t);return t.lanes=536870912,null}return Bl(t,n)}var u=e.memoizedState;if(u!==null){var f=u.dehydrated;if(fo(t),c)if(t.flags&256)t.flags&=-257,t=rm(e,t,a);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(o(558));else if(gt||Or(e,t,a,!1),c=(a&e.childLanes)!==0,gt||c){if(n=et,n!==null&&(f=nl(n,a),f!==0&&f!==u.retryLane))throw u.retryLane=f,In(e,f),Zt(n,e,f),Mo;Wl(),t=rm(e,t,a)}else e=u.treeContext,at=fa(f.nextSibling),At=t,He=!0,Sn=null,da=!1,e!==null&&Xu(t,e),t=Bl(t,n),t.flags|=4096;return t}return e=Ja(e.child,{mode:n.mode,children:n.children}),e.ref=t.ref,t.child=e,e.return=t,e}function Yl(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(o(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function zo(e,t,a,n,c){return nr(t),a=po(e,t,a,n,void 0,c),n=go(),e!==null&&!gt?(_o(e,t,c),en(e,t,c)):(He&&n&&Fi(t),t.flags|=1,Mt(e,t,a,c),t.child)}function sm(e,t,a,n,c,u){return nr(t),t.updateQueue=null,a=od(t,n,a,c),id(e),n=go(),e!==null&&!gt?(_o(e,t,u),en(e,t,u)):(He&&n&&Fi(t),t.flags|=1,Mt(e,t,a,u),t.child)}function lm(e,t,a,n,c){if(nr(t),t.stateNode===null){var u=qr,f=a.contextType;typeof f=="object"&&f!==null&&(u=Ot(f)),u=new a(n,u),t.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=Ao,t.stateNode=u,u._reactInternals=t,u=t.stateNode,u.props=n,u.state=t.memoizedState,u.refs={},lo(t),f=a.contextType,u.context=typeof f=="object"&&f!==null?Ot(f):qr,u.state=t.memoizedState,f=a.getDerivedStateFromProps,typeof f=="function"&&(To(t,a,f,n),u.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(f=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),f!==u.state&&Ao.enqueueReplaceState(u,u.state,null),Ss(t,n,u,c),xs(),u.state=t.memoizedState),typeof u.componentDidMount=="function"&&(t.flags|=4194308),n=!0}else if(e===null){u=t.stateNode;var g=t.memoizedProps,j=cr(a,g);u.props=j;var k=u.context,R=a.contextType;f=qr,typeof R=="object"&&R!==null&&(f=Ot(R));var L=a.getDerivedStateFromProps;R=typeof L=="function"||typeof u.getSnapshotBeforeUpdate=="function",g=t.pendingProps!==g,R||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(g||k!==f)&&Zd(t,u,n,f),Cn=!1;var D=t.memoizedState;u.state=D,Ss(t,n,u,c),xs(),k=t.memoizedState,g||D!==k||Cn?(typeof L=="function"&&(To(t,a,L,n),k=t.memoizedState),(j=Cn||Vd(t,a,j,n,D,k,f))?(R||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(t.flags|=4194308)):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=k),u.props=n,u.state=k,u.context=f,n=j):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{u=t.stateNode,io(e,t),f=t.memoizedProps,R=cr(a,f),u.props=R,L=t.pendingProps,D=u.context,k=a.contextType,j=qr,typeof k=="object"&&k!==null&&(j=Ot(k)),g=a.getDerivedStateFromProps,(k=typeof g=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(f!==L||D!==j)&&Zd(t,u,n,j),Cn=!1,D=t.memoizedState,u.state=D,Ss(t,n,u,c),xs();var A=t.memoizedState;f!==L||D!==A||Cn||e!==null&&e.dependencies!==null&&xl(e.dependencies)?(typeof g=="function"&&(To(t,a,g,n),A=t.memoizedState),(R=Cn||Vd(t,a,R,n,D,A,j)||e!==null&&e.dependencies!==null&&xl(e.dependencies))?(k||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(n,A,j),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(n,A,j)),typeof u.componentDidUpdate=="function"&&(t.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof u.componentDidUpdate!="function"||f===e.memoizedProps&&D===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&D===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=A),u.props=n,u.state=A,u.context=j,n=R):(typeof u.componentDidUpdate!="function"||f===e.memoizedProps&&D===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&D===e.memoizedState||(t.flags|=1024),n=!1)}return u=n,Yl(e,t),n=(t.flags&128)!==0,u||n?(u=t.stateNode,a=n&&typeof a.getDerivedStateFromError!="function"?null:u.render(),t.flags|=1,e!==null&&n?(t.child=ir(t,e.child,null,c),t.child=ir(t,null,a,c)):Mt(e,t,a,c),t.memoizedState=u.state,e=t.child):e=en(e,t,c),e}function im(e,t,a,n){return tr(),t.flags|=256,Mt(e,t,a,n),t.child}var Ro={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Uo(e){return{baseLanes:e,cachePool:$u()}}function Ho(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=Pt),e}function om(e,t,a){var n=t.pendingProps,c=!1,u=(t.flags&128)!==0,f;if((f=u)||(f=e!==null&&e.memoizedState===null?!1:(ut.current&2)!==0),f&&(c=!0,t.flags&=-129),f=(t.flags&32)!==0,t.flags&=-33,e===null){if(He){if(c?qn(t):Dn(),(e=at)?(e=_f(e,da),e=e!==null&&e.data!=="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:xn!==null?{id:Aa,overflow:Oa}:null,retryLane:536870912,hydrationErrors:null},a=Yu(e),a.return=t,t.child=a,At=t,at=null)):e=null,e===null)throw wn(t);return bc(e)?t.lanes=32:t.lanes=536870912,null}var g=n.children;return n=n.fallback,c?(Dn(),c=t.mode,g=Gl({mode:"hidden",children:g},c),n=er(n,c,a,null),g.return=t,n.return=t,g.sibling=n,t.child=g,n=t.child,n.memoizedState=Uo(a),n.childLanes=Ho(e,f,a),t.memoizedState=Ro,ks(null,n)):(qn(t),Lo(t,g))}var j=e.memoizedState;if(j!==null&&(g=j.dehydrated,g!==null)){if(u)t.flags&256?(qn(t),t.flags&=-257,t=Bo(e,t,a)):t.memoizedState!==null?(Dn(),t.child=e.child,t.flags|=128,t=null):(Dn(),g=n.fallback,c=t.mode,n=Gl({mode:"visible",children:n.children},c),g=er(g,c,a,null),g.flags|=2,n.return=t,g.return=t,n.sibling=g,t.child=n,ir(t,e.child,null,a),n=t.child,n.memoizedState=Uo(a),n.childLanes=Ho(e,f,a),t.memoizedState=Ro,t=ks(null,n));else if(qn(t),bc(g)){if(f=g.nextSibling&&g.nextSibling.dataset,f)var k=f.dgst;f=k,n=Error(o(419)),n.stack="",n.digest=f,gs({value:n,source:null,stack:null}),t=Bo(e,t,a)}else if(gt||Or(e,t,a,!1),f=(a&e.childLanes)!==0,gt||f){if(f=et,f!==null&&(n=nl(f,a),n!==0&&n!==j.retryLane))throw j.retryLane=n,In(e,n),Zt(f,e,n),Mo;vc(g)||Wl(),t=Bo(e,t,a)}else vc(g)?(t.flags|=192,t.child=e.child,t=null):(e=j.treeContext,at=fa(g.nextSibling),At=t,He=!0,Sn=null,da=!1,e!==null&&Xu(t,e),t=Lo(t,n.children),t.flags|=4096);return t}return c?(Dn(),g=n.fallback,c=t.mode,j=e.child,k=j.sibling,n=Ja(j,{mode:"hidden",children:n.children}),n.subtreeFlags=j.subtreeFlags&65011712,k!==null?g=Ja(k,g):(g=er(g,c,a,null),g.flags|=2),g.return=t,n.return=t,n.sibling=g,t.child=n,ks(null,n),n=t.child,g=e.child.memoizedState,g===null?g=Uo(a):(c=g.cachePool,c!==null?(j=ht._currentValue,c=c.parent!==j?{parent:j,pool:j}:c):c=$u(),g={baseLanes:g.baseLanes|a,cachePool:c}),n.memoizedState=g,n.childLanes=Ho(e,f,a),t.memoizedState=Ro,ks(e.child,n)):(qn(t),a=e.child,e=a.sibling,a=Ja(a,{mode:"visible",children:n.children}),a.return=t,a.sibling=null,e!==null&&(f=t.deletions,f===null?(t.deletions=[e],t.flags|=16):f.push(e)),t.child=a,t.memoizedState=null,a)}function Lo(e,t){return t=Gl({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Gl(e,t){return e=Jt(22,e,null,t),e.lanes=0,e}function Bo(e,t,a){return ir(t,e.child,null,a),e=Lo(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function cm(e,t,a){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),eo(e.return,t,a)}function Yo(e,t,a,n,c,u){var f=e.memoizedState;f===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:a,tailMode:c,treeForkCount:u}:(f.isBackwards=t,f.rendering=null,f.renderingStartTime=0,f.last=n,f.tail=a,f.tailMode=c,f.treeForkCount=u)}function um(e,t,a){var n=t.pendingProps,c=n.revealOrder,u=n.tail;n=n.children;var f=ut.current,g=(f&2)!==0;if(g?(f=f&1|2,t.flags|=128):f&=1,ye(ut,f),Mt(e,t,n,a),n=He?ps:0,!g&&e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&cm(e,a,t);else if(e.tag===19)cm(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(c){case"forwards":for(a=t.child,c=null;a!==null;)e=a.alternate,e!==null&&Dl(e)===null&&(c=a),a=a.sibling;a=c,a===null?(c=t.child,t.child=null):(c=a.sibling,a.sibling=null),Yo(t,!1,c,a,u,n);break;case"backwards":case"unstable_legacy-backwards":for(a=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&Dl(e)===null){t.child=c;break}e=c.sibling,c.sibling=a,a=c,c=e}Yo(t,!0,a,null,u,n);break;case"together":Yo(t,!1,null,null,void 0,n);break;default:t.memoizedState=null}return t.child}function en(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),On|=t.lanes,(a&t.childLanes)===0)if(e!==null){if(Or(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(o(153));if(t.child!==null){for(e=t.child,a=Ja(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=Ja(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function Go(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&xl(e)))}function Np(e,t,a){switch(t.tag){case 3:le(t,t.stateNode.containerInfo),Nn(t,ht,e.memoizedState.cache),tr();break;case 27:case 5:Fe(t);break;case 4:le(t,t.stateNode.containerInfo);break;case 10:Nn(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,fo(t),null;break;case 13:var n=t.memoizedState;if(n!==null)return n.dehydrated!==null?(qn(t),t.flags|=128,null):(a&t.child.childLanes)!==0?om(e,t,a):(qn(t),e=en(e,t,a),e!==null?e.sibling:null);qn(t);break;case 19:var c=(e.flags&128)!==0;if(n=(a&t.childLanes)!==0,n||(Or(e,t,a,!1),n=(a&t.childLanes)!==0),c){if(n)return um(e,t,a);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),ye(ut,ut.current),n)break;return null;case 22:return t.lanes=0,am(e,t,a,t.pendingProps);case 24:Nn(t,ht,e.memoizedState.cache)}return en(e,t,a)}function dm(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)gt=!0;else{if(!Go(e,a)&&(t.flags&128)===0)return gt=!1,Np(e,t,a);gt=(e.flags&131072)!==0}else gt=!1,He&&(t.flags&1048576)!==0&&Qu(t,ps,t.index);switch(t.lanes=0,t.tag){case 16:e:{var n=t.pendingProps;if(e=sr(t.elementType),t.type=e,typeof e=="function")Zi(e)?(n=cr(e,n),t.tag=1,t=lm(null,t,e,n,a)):(t.tag=0,t=zo(null,t,e,n,a));else{if(e!=null){var c=e.$$typeof;if(c===J){t.tag=11,t=Id(null,t,e,n,a);break e}else if(c===Ue){t.tag=14,t=em(null,t,e,n,a);break e}}throw t=ne(e)||e,Error(o(306,t,""))}}return t;case 0:return zo(e,t,t.type,t.pendingProps,a);case 1:return n=t.type,c=cr(n,t.pendingProps),lm(e,t,n,c,a);case 3:e:{if(le(t,t.stateNode.containerInfo),e===null)throw Error(o(387));n=t.pendingProps;var u=t.memoizedState;c=u.element,io(e,t),Ss(t,n,null,a);var f=t.memoizedState;if(n=f.cache,Nn(t,ht,n),n!==u.cache&&to(t,[ht],a,!0),xs(),n=f.element,u.isDehydrated)if(u={element:n,isDehydrated:!1,cache:f.cache},t.updateQueue.baseState=u,t.memoizedState=u,t.flags&256){t=im(e,t,n,a);break e}else if(n!==c){c=oa(Error(o(424)),t),gs(c),t=im(e,t,n,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(at=fa(e.firstChild),At=t,He=!0,Sn=null,da=!0,a=ad(t,null,n,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(tr(),n===c){t=en(e,t,a);break e}Mt(e,t,n,a)}t=t.child}return t;case 26:return Yl(e,t),e===null?(a=Sf(t.type,null,t.pendingProps,null))?t.memoizedState=a:He||(a=t.type,e=t.pendingProps,n=ri(fe.current).createElement(a),n[tt]=t,n[Rt]=e,zt(n,a,e),mt(n),t.stateNode=n):t.memoizedState=Sf(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Fe(t),e===null&&He&&(n=t.stateNode=bf(t.type,t.pendingProps,fe.current),At=t,da=!0,c=at,Hn(t.type)?(jc=c,at=fa(n.firstChild)):at=c),Mt(e,t,t.pendingProps.children,a),Yl(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&He&&((c=n=at)&&(n=tg(n,t.type,t.pendingProps,da),n!==null?(t.stateNode=n,At=t,at=fa(n.firstChild),da=!1,c=!0):c=!1),c||wn(t)),Fe(t),c=t.type,u=t.pendingProps,f=e!==null?e.memoizedProps:null,n=u.children,gc(c,u)?n=null:f!==null&&gc(c,f)&&(t.flags|=32),t.memoizedState!==null&&(c=po(e,t,gp,null,null,a),Qs._currentValue=c),Yl(e,t),Mt(e,t,n,a),t.child;case 6:return e===null&&He&&((e=a=at)&&(a=ag(a,t.pendingProps,da),a!==null?(t.stateNode=a,At=t,at=null,e=!0):e=!1),e||wn(t)),null;case 13:return om(e,t,a);case 4:return le(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=ir(t,null,n,a):Mt(e,t,n,a),t.child;case 11:return Id(e,t,t.type,t.pendingProps,a);case 7:return Mt(e,t,t.pendingProps,a),t.child;case 8:return Mt(e,t,t.pendingProps.children,a),t.child;case 12:return Mt(e,t,t.pendingProps.children,a),t.child;case 10:return n=t.pendingProps,Nn(t,t.type,n.value),Mt(e,t,n.children,a),t.child;case 9:return c=t.type._context,n=t.pendingProps.children,nr(t),c=Ot(c),n=n(c),t.flags|=1,Mt(e,t,n,a),t.child;case 14:return em(e,t,t.type,t.pendingProps,a);case 15:return tm(e,t,t.type,t.pendingProps,a);case 19:return um(e,t,a);case 31:return wp(e,t,a);case 22:return am(e,t,a,t.pendingProps);case 24:return nr(t),n=Ot(ht),e===null?(c=ro(),c===null&&(c=et,u=ao(),c.pooledCache=u,u.refCount++,u!==null&&(c.pooledCacheLanes|=a),c=u),t.memoizedState={parent:n,cache:c},lo(t),Nn(t,ht,c)):((e.lanes&a)!==0&&(io(e,t),Ss(t,null,null,a),xs()),c=e.memoizedState,u=t.memoizedState,c.parent!==n?(c={parent:n,cache:n},t.memoizedState=c,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=c),Nn(t,ht,n)):(n=u.cache,Nn(t,ht,n),n!==c.cache&&to(t,[ht],a,!0))),Mt(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(o(156,t.tag))}function tn(e){e.flags|=4}function Qo(e,t,a,n,c){if((t=(e.mode&32)!==0)&&(t=!1),t){if(e.flags|=16777216,(c&335544128)===c)if(e.stateNode.complete)e.flags|=8192;else if(Hm())e.flags|=8192;else throw lr=Cl,so}else e.flags&=-16777217}function mm(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!kf(t))if(Hm())e.flags|=8192;else throw lr=Cl,so}function Ql(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?K():536870912,e.lanes|=t,Vr|=t)}function qs(e,t){if(!He)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var n=null;a!==null;)a.alternate!==null&&(n=a),a=a.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function nt(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,n=0;if(t)for(var c=e.child;c!==null;)a|=c.lanes|c.childLanes,n|=c.subtreeFlags&65011712,n|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)a|=c.lanes|c.childLanes,n|=c.subtreeFlags,n|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=n,e.childLanes=a,t}function Cp(e,t,a){var n=t.pendingProps;switch($i(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nt(t),null;case 1:return nt(t),null;case 3:return a=t.stateNode,n=null,e!==null&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Wa(ht),Ce(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Ar(t)?tn(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Pi())),nt(t),null;case 26:var c=t.type,u=t.memoizedState;return e===null?(tn(t),u!==null?(nt(t),mm(t,u)):(nt(t),Qo(t,c,null,n,a))):u?u!==e.memoizedState?(tn(t),nt(t),mm(t,u)):(nt(t),t.flags&=-16777217):(e=e.memoizedProps,e!==n&&tn(t),nt(t),Qo(t,c,e,n,a)),null;case 27:if(Le(t),a=fe.current,c=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&tn(t);else{if(!n){if(t.stateNode===null)throw Error(o(166));return nt(t),null}e=qe.current,Ar(t)?Vu(t):(e=bf(c,n,a),t.stateNode=e,tn(t))}return nt(t),null;case 5:if(Le(t),c=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&tn(t);else{if(!n){if(t.stateNode===null)throw Error(o(166));return nt(t),null}if(u=qe.current,Ar(t))Vu(t);else{var f=ri(fe.current);switch(u){case 1:u=f.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:u=f.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":u=f.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":u=f.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":u=f.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof n.is=="string"?f.createElement("select",{is:n.is}):f.createElement("select"),n.multiple?u.multiple=!0:n.size&&(u.size=n.size);break;default:u=typeof n.is=="string"?f.createElement(c,{is:n.is}):f.createElement(c)}}u[tt]=t,u[Rt]=n;e:for(f=t.child;f!==null;){if(f.tag===5||f.tag===6)u.appendChild(f.stateNode);else if(f.tag!==4&&f.tag!==27&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}t.stateNode=u;e:switch(zt(u,c,n),c){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&tn(t)}}return nt(t),Qo(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,a),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==n&&tn(t);else{if(typeof n!="string"&&t.stateNode===null)throw Error(o(166));if(e=fe.current,Ar(t)){if(e=t.stateNode,a=t.memoizedProps,n=null,c=At,c!==null)switch(c.tag){case 27:case 5:n=c.memoizedProps}e[tt]=t,e=!!(e.nodeValue===a||n!==null&&n.suppressHydrationWarning===!0||cf(e.nodeValue,a)),e||wn(t,!0)}else e=ri(e).createTextNode(n),e[tt]=t,t.stateNode=e}return nt(t),null;case 31:if(a=t.memoizedState,e===null||e.memoizedState!==null){if(n=Ar(t),a!==null){if(e===null){if(!n)throw Error(o(318));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(557));e[tt]=t}else tr(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;nt(t),e=!1}else a=Pi(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return t.flags&256?($t(t),t):($t(t),null);if((t.flags&128)!==0)throw Error(o(558))}return nt(t),null;case 13:if(n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=Ar(t),n!==null&&n.dehydrated!==null){if(e===null){if(!c)throw Error(o(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(o(317));c[tt]=t}else tr(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;nt(t),c=!1}else c=Pi(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return t.flags&256?($t(t),t):($t(t),null)}return $t(t),(t.flags&128)!==0?(t.lanes=a,t):(a=n!==null,e=e!==null&&e.memoizedState!==null,a&&(n=t.child,c=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(c=n.alternate.memoizedState.cachePool.pool),u=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),u!==c&&(n.flags|=2048)),a!==e&&a&&(t.child.flags|=8192),Ql(t,t.updateQueue),nt(t),null);case 4:return Ce(),e===null&&dc(t.stateNode.containerInfo),nt(t),null;case 10:return Wa(t.type),nt(t),null;case 19:if(P(ut),n=t.memoizedState,n===null)return nt(t),null;if(c=(t.flags&128)!==0,u=n.rendering,u===null)if(c)qs(n,!1);else{if(it!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(u=Dl(e),u!==null){for(t.flags|=128,qs(n,!1),e=u.updateQueue,t.updateQueue=e,Ql(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)Bu(a,e),a=a.sibling;return ye(ut,ut.current&1|2),He&&Fa(t,n.treeForkCount),t.child}e=e.sibling}n.tail!==null&&yt()>Jl&&(t.flags|=128,c=!0,qs(n,!1),t.lanes=4194304)}else{if(!c)if(e=Dl(u),e!==null){if(t.flags|=128,c=!0,e=e.updateQueue,t.updateQueue=e,Ql(t,e),qs(n,!0),n.tail===null&&n.tailMode==="hidden"&&!u.alternate&&!He)return nt(t),null}else 2*yt()-n.renderingStartTime>Jl&&a!==536870912&&(t.flags|=128,c=!0,qs(n,!1),t.lanes=4194304);n.isBackwards?(u.sibling=t.child,t.child=u):(e=n.last,e!==null?e.sibling=u:t.child=u,n.last=u)}return n.tail!==null?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=yt(),e.sibling=null,a=ut.current,ye(ut,c?a&1|2:a&1),He&&Fa(t,n.treeForkCount),e):(nt(t),null);case 22:case 23:return $t(t),mo(),n=t.memoizedState!==null,e!==null?e.memoizedState!==null!==n&&(t.flags|=8192):n&&(t.flags|=8192),n?(a&536870912)!==0&&(t.flags&128)===0&&(nt(t),t.subtreeFlags&6&&(t.flags|=8192)):nt(t),a=t.updateQueue,a!==null&&Ql(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),n=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),n!==a&&(t.flags|=2048),e!==null&&P(rr),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),Wa(ht),nt(t),null;case 25:return null;case 30:return null}throw Error(o(156,t.tag))}function Ep(e,t){switch($i(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Wa(ht),Ce(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return Le(t),null;case 31:if(t.memoizedState!==null){if($t(t),t.alternate===null)throw Error(o(340));tr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if($t(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(o(340));tr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return P(ut),null;case 4:return Ce(),null;case 10:return Wa(t.type),null;case 22:case 23:return $t(t),mo(),e!==null&&P(rr),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return Wa(ht),null;case 25:return null;default:return null}}function fm(e,t){switch($i(t),t.tag){case 3:Wa(ht),Ce();break;case 26:case 27:case 5:Le(t);break;case 4:Ce();break;case 31:t.memoizedState!==null&&$t(t);break;case 13:$t(t);break;case 19:P(ut);break;case 10:Wa(t.type);break;case 22:case 23:$t(t),mo(),e!==null&&P(rr);break;case 24:Wa(ht)}}function Ds(e,t){try{var a=t.updateQueue,n=a!==null?a.lastEffect:null;if(n!==null){var c=n.next;a=c;do{if((a.tag&e)===e){n=void 0;var u=a.create,f=a.inst;n=u(),f.destroy=n}a=a.next}while(a!==c)}}catch(g){Je(t,t.return,g)}}function Tn(e,t,a){try{var n=t.updateQueue,c=n!==null?n.lastEffect:null;if(c!==null){var u=c.next;n=u;do{if((n.tag&e)===e){var f=n.inst,g=f.destroy;if(g!==void 0){f.destroy=void 0,c=t;var j=a,k=g;try{k()}catch(R){Je(c,j,R)}}}n=n.next}while(n!==u)}}catch(R){Je(t,t.return,R)}}function hm(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{rd(t,a)}catch(n){Je(e,e.return,n)}}}function pm(e,t,a){a.props=cr(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(n){Je(e,t,n)}}function Ts(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;case 30:n=e.stateNode;break;default:n=e.stateNode}typeof a=="function"?e.refCleanup=a(n):a.current=n}}catch(c){Je(e,t,c)}}function Ma(e,t){var a=e.ref,n=e.refCleanup;if(a!==null)if(typeof n=="function")try{n()}catch(c){Je(e,t,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(c){Je(e,t,c)}else a.current=null}function gm(e){var t=e.type,a=e.memoizedProps,n=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break e;case"img":a.src?n.src=a.src:a.srcSet&&(n.srcset=a.srcSet)}}catch(c){Je(e,e.return,c)}}function Xo(e,t,a){try{var n=e.stateNode;Fp(n,e.type,a,t),n[Rt]=t}catch(c){Je(e,e.return,c)}}function _m(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Hn(e.type)||e.tag===4}function Vo(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||_m(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Hn(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Zo(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=Za));else if(n!==4&&(n===27&&Hn(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(Zo(e,t,a),e=e.sibling;e!==null;)Zo(e,t,a),e=e.sibling}function Xl(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(n!==4&&(n===27&&Hn(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(Xl(e,t,a),e=e.sibling;e!==null;)Xl(e,t,a),e=e.sibling}function ym(e){var t=e.stateNode,a=e.memoizedProps;try{for(var n=e.type,c=t.attributes;c.length;)t.removeAttributeNode(c[0]);zt(t,n,a),t[tt]=e,t[Rt]=a}catch(u){Je(e,e.return,u)}}var an=!1,_t=!1,Ko=!1,vm=typeof WeakSet=="function"?WeakSet:Set,Ct=null;function kp(e,t){if(e=e.containerInfo,hc=di,e=Tu(e),Li(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var n=a.getSelection&&a.getSelection();if(n&&n.rangeCount!==0){a=n.anchorNode;var c=n.anchorOffset,u=n.focusNode;n=n.focusOffset;try{a.nodeType,u.nodeType}catch{a=null;break e}var f=0,g=-1,j=-1,k=0,R=0,L=e,D=null;t:for(;;){for(var A;L!==a||c!==0&&L.nodeType!==3||(g=f+c),L!==u||n!==0&&L.nodeType!==3||(j=f+n),L.nodeType===3&&(f+=L.nodeValue.length),(A=L.firstChild)!==null;)D=L,L=A;for(;;){if(L===e)break t;if(D===a&&++k===c&&(g=f),D===u&&++R===n&&(j=f),(A=L.nextSibling)!==null)break;L=D,D=L.parentNode}L=A}a=g===-1||j===-1?null:{start:g,end:j}}else a=null}a=a||{start:0,end:0}}else a=null;for(pc={focusedElem:e,selectionRange:a},di=!1,Ct=t;Ct!==null;)if(t=Ct,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ct=e;else for(;Ct!==null;){switch(t=Ct,u=t.alternate,e=t.flags,t.tag){case 0:if((e&4)!==0&&(e=t.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)c=e[a],c.ref.impl=c.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&u!==null){e=void 0,a=t,c=u.memoizedProps,u=u.memoizedState,n=a.stateNode;try{var ce=cr(a.type,c);e=n.getSnapshotBeforeUpdate(ce,u),n.__reactInternalSnapshotBeforeUpdate=e}catch(be){Je(a,a.return,be)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)yc(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":yc(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(o(163))}if(e=t.sibling,e!==null){e.return=t.return,Ct=e;break}Ct=t.return}}function bm(e,t,a){var n=a.flags;switch(a.tag){case 0:case 11:case 15:rn(e,a),n&4&&Ds(5,a);break;case 1:if(rn(e,a),n&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(f){Je(a,a.return,f)}else{var c=cr(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(c,t,e.__reactInternalSnapshotBeforeUpdate)}catch(f){Je(a,a.return,f)}}n&64&&hm(a),n&512&&Ts(a,a.return);break;case 3:if(rn(e,a),n&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{rd(e,t)}catch(f){Je(a,a.return,f)}}break;case 27:t===null&&n&4&&ym(a);case 26:case 5:rn(e,a),t===null&&n&4&&gm(a),n&512&&Ts(a,a.return);break;case 12:rn(e,a);break;case 31:rn(e,a),n&4&&Sm(e,a);break;case 13:rn(e,a),n&4&&wm(e,a),n&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=Up.bind(null,a),ng(e,a))));break;case 22:if(n=a.memoizedState!==null||an,!n){t=t!==null&&t.memoizedState!==null||_t,c=an;var u=_t;an=n,(_t=t)&&!u?sn(e,a,(a.subtreeFlags&8772)!==0):rn(e,a),an=c,_t=u}break;case 30:break;default:rn(e,a)}}function jm(e){var t=e.alternate;t!==null&&(e.alternate=null,jm(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&jr(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var st=null,Gt=!1;function nn(e,t,a){for(a=a.child;a!==null;)xm(e,t,a),a=a.sibling}function xm(e,t,a){if(wt&&typeof wt.onCommitFiberUnmount=="function")try{wt.onCommitFiberUnmount(ya,a)}catch{}switch(a.tag){case 26:_t||Ma(a,t),nn(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:_t||Ma(a,t);var n=st,c=Gt;Hn(a.type)&&(st=a.stateNode,Gt=!1),nn(e,t,a),Bs(a.stateNode),st=n,Gt=c;break;case 5:_t||Ma(a,t);case 6:if(n=st,c=Gt,st=null,nn(e,t,a),st=n,Gt=c,st!==null)if(Gt)try{(st.nodeType===9?st.body:st.nodeName==="HTML"?st.ownerDocument.body:st).removeChild(a.stateNode)}catch(u){Je(a,t,u)}else try{st.removeChild(a.stateNode)}catch(u){Je(a,t,u)}break;case 18:st!==null&&(Gt?(e=st,pf(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),Ir(e)):pf(st,a.stateNode));break;case 4:n=st,c=Gt,st=a.stateNode.containerInfo,Gt=!0,nn(e,t,a),st=n,Gt=c;break;case 0:case 11:case 14:case 15:Tn(2,a,t),_t||Tn(4,a,t),nn(e,t,a);break;case 1:_t||(Ma(a,t),n=a.stateNode,typeof n.componentWillUnmount=="function"&&pm(a,t,n)),nn(e,t,a);break;case 21:nn(e,t,a);break;case 22:_t=(n=_t)||a.memoizedState!==null,nn(e,t,a),_t=n;break;default:nn(e,t,a)}}function Sm(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Ir(e)}catch(a){Je(t,t.return,a)}}}function wm(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Ir(e)}catch(a){Je(t,t.return,a)}}function qp(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new vm),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new vm),t;default:throw Error(o(435,e.tag))}}function Vl(e,t){var a=qp(e);t.forEach(function(n){if(!a.has(n)){a.add(n);var c=Hp.bind(null,e,n);n.then(c,c)}})}function Qt(e,t){var a=t.deletions;if(a!==null)for(var n=0;n<a.length;n++){var c=a[n],u=e,f=t,g=f;e:for(;g!==null;){switch(g.tag){case 27:if(Hn(g.type)){st=g.stateNode,Gt=!1;break e}break;case 5:st=g.stateNode,Gt=!1;break e;case 3:case 4:st=g.stateNode.containerInfo,Gt=!0;break e}g=g.return}if(st===null)throw Error(o(160));xm(u,f,c),st=null,Gt=!1,u=c.alternate,u!==null&&(u.return=null),c.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)Nm(t,e),t=t.sibling}var Na=null;function Nm(e,t){var a=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Qt(t,e),Xt(e),n&4&&(Tn(3,e,e.return),Ds(3,e),Tn(5,e,e.return));break;case 1:Qt(t,e),Xt(e),n&512&&(_t||a===null||Ma(a,a.return)),n&64&&an&&(e=e.updateQueue,e!==null&&(n=e.callbacks,n!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?n:a.concat(n))));break;case 26:var c=Na;if(Qt(t,e),Xt(e),n&512&&(_t||a===null||Ma(a,a.return)),n&4){var u=a!==null?a.memoizedState:null;if(n=e.memoizedState,a===null)if(n===null)if(e.stateNode===null){e:{n=e.type,a=e.memoizedProps,c=c.ownerDocument||c;t:switch(n){case"title":u=c.getElementsByTagName("title")[0],(!u||u[Jn]||u[tt]||u.namespaceURI==="http://www.w3.org/2000/svg"||u.hasAttribute("itemprop"))&&(u=c.createElement(n),c.head.insertBefore(u,c.querySelector("head > title"))),zt(u,n,a),u[tt]=e,mt(u),n=u;break e;case"link":var f=Cf("link","href",c).get(n+(a.href||""));if(f){for(var g=0;g<f.length;g++)if(u=f[g],u.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&u.getAttribute("rel")===(a.rel==null?null:a.rel)&&u.getAttribute("title")===(a.title==null?null:a.title)&&u.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){f.splice(g,1);break t}}u=c.createElement(n),zt(u,n,a),c.head.appendChild(u);break;case"meta":if(f=Cf("meta","content",c).get(n+(a.content||""))){for(g=0;g<f.length;g++)if(u=f[g],u.getAttribute("content")===(a.content==null?null:""+a.content)&&u.getAttribute("name")===(a.name==null?null:a.name)&&u.getAttribute("property")===(a.property==null?null:a.property)&&u.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&u.getAttribute("charset")===(a.charSet==null?null:a.charSet)){f.splice(g,1);break t}}u=c.createElement(n),zt(u,n,a),c.head.appendChild(u);break;default:throw Error(o(468,n))}u[tt]=e,mt(u),n=u}e.stateNode=n}else Ef(c,e.type,e.stateNode);else e.stateNode=Nf(c,n,e.memoizedProps);else u!==n?(u===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):u.count--,n===null?Ef(c,e.type,e.stateNode):Nf(c,n,e.memoizedProps)):n===null&&e.stateNode!==null&&Xo(e,e.memoizedProps,a.memoizedProps)}break;case 27:Qt(t,e),Xt(e),n&512&&(_t||a===null||Ma(a,a.return)),a!==null&&n&4&&Xo(e,e.memoizedProps,a.memoizedProps);break;case 5:if(Qt(t,e),Xt(e),n&512&&(_t||a===null||Ma(a,a.return)),e.flags&32){c=e.stateNode;try{q(c,"")}catch(ce){Je(e,e.return,ce)}}n&4&&e.stateNode!=null&&(c=e.memoizedProps,Xo(e,c,a!==null?a.memoizedProps:c)),n&1024&&(Ko=!0);break;case 6:if(Qt(t,e),Xt(e),n&4){if(e.stateNode===null)throw Error(o(162));n=e.memoizedProps,a=e.stateNode;try{a.nodeValue=n}catch(ce){Je(e,e.return,ce)}}break;case 3:if(ii=null,c=Na,Na=si(t.containerInfo),Qt(t,e),Na=c,Xt(e),n&4&&a!==null&&a.memoizedState.isDehydrated)try{Ir(t.containerInfo)}catch(ce){Je(e,e.return,ce)}Ko&&(Ko=!1,Cm(e));break;case 4:n=Na,Na=si(e.stateNode.containerInfo),Qt(t,e),Xt(e),Na=n;break;case 12:Qt(t,e),Xt(e);break;case 31:Qt(t,e),Xt(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,Vl(e,n)));break;case 13:Qt(t,e),Xt(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(Kl=yt()),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,Vl(e,n)));break;case 22:c=e.memoizedState!==null;var j=a!==null&&a.memoizedState!==null,k=an,R=_t;if(an=k||c,_t=R||j,Qt(t,e),_t=R,an=k,Xt(e),n&8192)e:for(t=e.stateNode,t._visibility=c?t._visibility&-2:t._visibility|1,c&&(a===null||j||an||_t||ur(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){j=a=t;try{if(u=j.stateNode,c)f=u.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none";else{g=j.stateNode;var L=j.memoizedProps.style,D=L!=null&&L.hasOwnProperty("display")?L.display:null;g.style.display=D==null||typeof D=="boolean"?"":(""+D).trim()}}catch(ce){Je(j,j.return,ce)}}}else if(t.tag===6){if(a===null){j=t;try{j.stateNode.nodeValue=c?"":j.memoizedProps}catch(ce){Je(j,j.return,ce)}}}else if(t.tag===18){if(a===null){j=t;try{var A=j.stateNode;c?gf(A,!0):gf(j.stateNode,!1)}catch(ce){Je(j,j.return,ce)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}n&4&&(n=e.updateQueue,n!==null&&(a=n.retryQueue,a!==null&&(n.retryQueue=null,Vl(e,a))));break;case 19:Qt(t,e),Xt(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,Vl(e,n)));break;case 30:break;case 21:break;default:Qt(t,e),Xt(e)}}function Xt(e){var t=e.flags;if(t&2){try{for(var a,n=e.return;n!==null;){if(_m(n)){a=n;break}n=n.return}if(a==null)throw Error(o(160));switch(a.tag){case 27:var c=a.stateNode,u=Vo(e);Xl(e,u,c);break;case 5:var f=a.stateNode;a.flags&32&&(q(f,""),a.flags&=-33);var g=Vo(e);Xl(e,g,f);break;case 3:case 4:var j=a.stateNode.containerInfo,k=Vo(e);Zo(e,k,j);break;default:throw Error(o(161))}}catch(R){Je(e,e.return,R)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Cm(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;Cm(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function rn(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)bm(e,t.alternate,t),t=t.sibling}function ur(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Tn(4,t,t.return),ur(t);break;case 1:Ma(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&pm(t,t.return,a),ur(t);break;case 27:Bs(t.stateNode);case 26:case 5:Ma(t,t.return),ur(t);break;case 22:t.memoizedState===null&&ur(t);break;case 30:ur(t);break;default:ur(t)}e=e.sibling}}function sn(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var n=t.alternate,c=e,u=t,f=u.flags;switch(u.tag){case 0:case 11:case 15:sn(c,u,a),Ds(4,u);break;case 1:if(sn(c,u,a),n=u,c=n.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(k){Je(n,n.return,k)}if(n=u,c=n.updateQueue,c!==null){var g=n.stateNode;try{var j=c.shared.hiddenCallbacks;if(j!==null)for(c.shared.hiddenCallbacks=null,c=0;c<j.length;c++)nd(j[c],g)}catch(k){Je(n,n.return,k)}}a&&f&64&&hm(u),Ts(u,u.return);break;case 27:ym(u);case 26:case 5:sn(c,u,a),a&&n===null&&f&4&&gm(u),Ts(u,u.return);break;case 12:sn(c,u,a);break;case 31:sn(c,u,a),a&&f&4&&Sm(c,u);break;case 13:sn(c,u,a),a&&f&4&&wm(c,u);break;case 22:u.memoizedState===null&&sn(c,u,a),Ts(u,u.return);break;case 30:break;default:sn(c,u,a)}t=t.sibling}}function Jo(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&_s(a))}function Fo(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&_s(e))}function Ca(e,t,a,n){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Em(e,t,a,n),t=t.sibling}function Em(e,t,a,n){var c=t.flags;switch(t.tag){case 0:case 11:case 15:Ca(e,t,a,n),c&2048&&Ds(9,t);break;case 1:Ca(e,t,a,n);break;case 3:Ca(e,t,a,n),c&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&_s(e)));break;case 12:if(c&2048){Ca(e,t,a,n),e=t.stateNode;try{var u=t.memoizedProps,f=u.id,g=u.onPostCommit;typeof g=="function"&&g(f,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(j){Je(t,t.return,j)}}else Ca(e,t,a,n);break;case 31:Ca(e,t,a,n);break;case 13:Ca(e,t,a,n);break;case 23:break;case 22:u=t.stateNode,f=t.alternate,t.memoizedState!==null?u._visibility&2?Ca(e,t,a,n):As(e,t):u._visibility&2?Ca(e,t,a,n):(u._visibility|=2,Gr(e,t,a,n,(t.subtreeFlags&10256)!==0||!1)),c&2048&&Jo(f,t);break;case 24:Ca(e,t,a,n),c&2048&&Fo(t.alternate,t);break;default:Ca(e,t,a,n)}}function Gr(e,t,a,n,c){for(c=c&&((t.subtreeFlags&10256)!==0||!1),t=t.child;t!==null;){var u=e,f=t,g=a,j=n,k=f.flags;switch(f.tag){case 0:case 11:case 15:Gr(u,f,g,j,c),Ds(8,f);break;case 23:break;case 22:var R=f.stateNode;f.memoizedState!==null?R._visibility&2?Gr(u,f,g,j,c):As(u,f):(R._visibility|=2,Gr(u,f,g,j,c)),c&&k&2048&&Jo(f.alternate,f);break;case 24:Gr(u,f,g,j,c),c&&k&2048&&Fo(f.alternate,f);break;default:Gr(u,f,g,j,c)}t=t.sibling}}function As(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,n=t,c=n.flags;switch(n.tag){case 22:As(a,n),c&2048&&Jo(n.alternate,n);break;case 24:As(a,n),c&2048&&Fo(n.alternate,n);break;default:As(a,n)}t=t.sibling}}var Os=8192;function Qr(e,t,a){if(e.subtreeFlags&Os)for(e=e.child;e!==null;)km(e,t,a),e=e.sibling}function km(e,t,a){switch(e.tag){case 26:Qr(e,t,a),e.flags&Os&&e.memoizedState!==null&&pg(a,Na,e.memoizedState,e.memoizedProps);break;case 5:Qr(e,t,a);break;case 3:case 4:var n=Na;Na=si(e.stateNode.containerInfo),Qr(e,t,a),Na=n;break;case 22:e.memoizedState===null&&(n=e.alternate,n!==null&&n.memoizedState!==null?(n=Os,Os=16777216,Qr(e,t,a),Os=n):Qr(e,t,a));break;default:Qr(e,t,a)}}function qm(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Ms(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var n=t[a];Ct=n,Tm(n,e)}qm(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Dm(e),e=e.sibling}function Dm(e){switch(e.tag){case 0:case 11:case 15:Ms(e),e.flags&2048&&Tn(9,e,e.return);break;case 3:Ms(e);break;case 12:Ms(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Zl(e)):Ms(e);break;default:Ms(e)}}function Zl(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var n=t[a];Ct=n,Tm(n,e)}qm(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Tn(8,t,t.return),Zl(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,Zl(t));break;default:Zl(t)}e=e.sibling}}function Tm(e,t){for(;Ct!==null;){var a=Ct;switch(a.tag){case 0:case 11:case 15:Tn(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var n=a.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:_s(a.memoizedState.cache)}if(n=a.child,n!==null)n.return=a,Ct=n;else e:for(a=e;Ct!==null;){n=Ct;var c=n.sibling,u=n.return;if(jm(n),n===a){Ct=null;break e}if(c!==null){c.return=u,Ct=c;break e}Ct=u}}}var Dp={getCacheForType:function(e){var t=Ot(ht),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a},cacheSignal:function(){return Ot(ht).controller.signal}},Tp=typeof WeakMap=="function"?WeakMap:Map,Xe=0,et=null,Ae=null,ze=0,Ke=0,Wt=null,An=!1,Xr=!1,$o=!1,ln=0,it=0,On=0,dr=0,Wo=0,Pt=0,Vr=0,zs=null,Vt=null,Po=!1,Kl=0,Am=0,Jl=1/0,Fl=null,Mn=null,jt=0,zn=null,Zr=null,on=0,Io=0,ec=null,Om=null,Rs=0,tc=null;function It(){return(Xe&2)!==0&&ze!==0?ze&-ze:C.T!==null?ic():rl()}function Mm(){if(Pt===0)if((ze&536870912)===0||He){var e=pn;pn<<=1,(pn&3932160)===0&&(pn=262144),Pt=e}else Pt=536870912;return e=Ft.current,e!==null&&(e.flags|=32),Pt}function Zt(e,t,a){(e===et&&(Ke===2||Ke===9)||e.cancelPendingCommit!==null)&&(Kr(e,0),Rn(e,ze,Pt,!1)),ba(e,a),((Xe&2)===0||e!==et)&&(e===et&&((Xe&2)===0&&(dr|=a),it===4&&Rn(e,ze,Pt,!1)),za(e))}function zm(e,t,a){if((Xe&6)!==0)throw Error(o(327));var n=!a&&(t&127)===0&&(t&e.expiredLanes)===0||ka(e,t),c=n?Mp(e,t):nc(e,t,!0),u=n;do{if(c===0){Xr&&!n&&Rn(e,t,0,!1);break}else{if(a=e.current.alternate,u&&!Ap(a)){c=nc(e,t,!1),u=!1;continue}if(c===2){if(u=t,e.errorRecoveryDisabledLanes&u)var f=0;else f=e.pendingLanes&-536870913,f=f!==0?f:f&536870912?536870912:0;if(f!==0){t=f;e:{var g=e;c=zs;var j=g.current.memoizedState.isDehydrated;if(j&&(Kr(g,f).flags|=256),f=nc(g,f,!1),f!==2){if($o&&!j){g.errorRecoveryDisabledLanes|=u,dr|=u,c=4;break e}u=Vt,Vt=c,u!==null&&(Vt===null?Vt=u:Vt.push.apply(Vt,u))}c=f}if(u=!1,c!==2)continue}}if(c===1){Kr(e,0),Rn(e,t,0,!0);break}e:{switch(n=e,u=c,u){case 0:case 1:throw Error(o(345));case 4:if((t&4194048)!==t)break;case 6:Rn(n,t,Pt,!An);break e;case 2:Vt=null;break;case 3:case 5:break;default:throw Error(o(329))}if((t&62914560)===t&&(c=Kl+300-yt(),10<c)){if(Rn(n,t,Pt,!An),Ea(n,0,!0)!==0)break e;on=t,n.timeoutHandle=ff(Rm.bind(null,n,a,Vt,Fl,Po,t,Pt,dr,Vr,An,u,"Throttled",-0,0),c);break e}Rm(n,a,Vt,Fl,Po,t,Pt,dr,Vr,An,u,null,-0,0)}}break}while(!0);za(e)}function Rm(e,t,a,n,c,u,f,g,j,k,R,L,D,A){if(e.timeoutHandle=-1,L=t.subtreeFlags,L&8192||(L&16785408)===16785408){L={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Za},km(t,u,L);var ce=(u&62914560)===u?Kl-yt():(u&4194048)===u?Am-yt():0;if(ce=gg(L,ce),ce!==null){on=u,e.cancelPendingCommit=ce(Xm.bind(null,e,t,u,a,n,c,f,g,j,R,L,null,D,A)),Rn(e,u,f,!k);return}}Xm(e,t,u,a,n,c,f,g,j)}function Ap(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var n=0;n<a.length;n++){var c=a[n],u=c.getSnapshot;c=c.value;try{if(!Kt(u(),c))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Rn(e,t,a,n){t&=~Wo,t&=~dr,e.suspendedLanes|=t,e.pingedLanes&=~t,n&&(e.warmLanes|=t),n=e.expirationTimes;for(var c=t;0<c;){var u=31-kt(c),f=1<<u;n[u]=-1,c&=~f}a!==0&&al(e,a,t)}function $l(){return(Xe&6)===0?(Us(0),!1):!0}function ac(){if(Ae!==null){if(Ke===0)var e=Ae.return;else e=Ae,$a=ar=null,yo(e),Ur=null,vs=0,e=Ae;for(;e!==null;)fm(e.alternate,e),e=e.return;Ae=null}}function Kr(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,Pp(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),on=0,ac(),et=e,Ae=a=Ja(e.current,null),ze=t,Ke=0,Wt=null,An=!1,Xr=ka(e,t),$o=!1,Vr=Pt=Wo=dr=On=it=0,Vt=zs=null,Po=!1,(t&8)!==0&&(t|=t&32);var n=e.entangledLanes;if(n!==0)for(e=e.entanglements,n&=t;0<n;){var c=31-kt(n),u=1<<c;t|=e[c],n&=~u}return ln=t,_l(),a}function Um(e,t){we=null,C.H=Es,t===Rr||t===Nl?(t=Iu(),Ke=3):t===so?(t=Iu(),Ke=4):Ke=t===Mo?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,Wt=t,Ae===null&&(it=1,Ll(e,oa(t,e.current)))}function Hm(){var e=Ft.current;return e===null?!0:(ze&4194048)===ze?ma===null:(ze&62914560)===ze||(ze&536870912)!==0?e===ma:!1}function Lm(){var e=C.H;return C.H=Es,e===null?Es:e}function Bm(){var e=C.A;return C.A=Dp,e}function Wl(){it=4,An||(ze&4194048)!==ze&&Ft.current!==null||(Xr=!0),(On&134217727)===0&&(dr&134217727)===0||et===null||Rn(et,ze,Pt,!1)}function nc(e,t,a){var n=Xe;Xe|=2;var c=Lm(),u=Bm();(et!==e||ze!==t)&&(Fl=null,Kr(e,t)),t=!1;var f=it;e:do try{if(Ke!==0&&Ae!==null){var g=Ae,j=Wt;switch(Ke){case 8:ac(),f=6;break e;case 3:case 2:case 9:case 6:Ft.current===null&&(t=!0);var k=Ke;if(Ke=0,Wt=null,Jr(e,g,j,k),a&&Xr){f=0;break e}break;default:k=Ke,Ke=0,Wt=null,Jr(e,g,j,k)}}Op(),f=it;break}catch(R){Um(e,R)}while(!0);return t&&e.shellSuspendCounter++,$a=ar=null,Xe=n,C.H=c,C.A=u,Ae===null&&(et=null,ze=0,_l()),f}function Op(){for(;Ae!==null;)Ym(Ae)}function Mp(e,t){var a=Xe;Xe|=2;var n=Lm(),c=Bm();et!==e||ze!==t?(Fl=null,Jl=yt()+500,Kr(e,t)):Xr=ka(e,t);e:do try{if(Ke!==0&&Ae!==null){t=Ae;var u=Wt;t:switch(Ke){case 1:Ke=0,Wt=null,Jr(e,t,u,1);break;case 2:case 9:if(Wu(u)){Ke=0,Wt=null,Gm(t);break}t=function(){Ke!==2&&Ke!==9||et!==e||(Ke=7),za(e)},u.then(t,t);break e;case 3:Ke=7;break e;case 4:Ke=5;break e;case 7:Wu(u)?(Ke=0,Wt=null,Gm(t)):(Ke=0,Wt=null,Jr(e,t,u,7));break;case 5:var f=null;switch(Ae.tag){case 26:f=Ae.memoizedState;case 5:case 27:var g=Ae;if(f?kf(f):g.stateNode.complete){Ke=0,Wt=null;var j=g.sibling;if(j!==null)Ae=j;else{var k=g.return;k!==null?(Ae=k,Pl(k)):Ae=null}break t}}Ke=0,Wt=null,Jr(e,t,u,5);break;case 6:Ke=0,Wt=null,Jr(e,t,u,6);break;case 8:ac(),it=6;break e;default:throw Error(o(462))}}zp();break}catch(R){Um(e,R)}while(!0);return $a=ar=null,C.H=n,C.A=c,Xe=a,Ae!==null?0:(et=null,ze=0,_l(),it)}function zp(){for(;Ae!==null&&!fn();)Ym(Ae)}function Ym(e){var t=dm(e.alternate,e,ln);e.memoizedProps=e.pendingProps,t===null?Pl(e):Ae=t}function Gm(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=sm(a,t,t.pendingProps,t.type,void 0,ze);break;case 11:t=sm(a,t,t.pendingProps,t.type.render,t.ref,ze);break;case 5:yo(t);default:fm(a,t),t=Ae=Bu(t,ln),t=dm(a,t,ln)}e.memoizedProps=e.pendingProps,t===null?Pl(e):Ae=t}function Jr(e,t,a,n){$a=ar=null,yo(t),Ur=null,vs=0;var c=t.return;try{if(Sp(e,c,t,a,ze)){it=1,Ll(e,oa(a,e.current)),Ae=null;return}}catch(u){if(c!==null)throw Ae=c,u;it=1,Ll(e,oa(a,e.current)),Ae=null;return}t.flags&32768?(He||n===1?e=!0:Xr||(ze&536870912)!==0?e=!1:(An=e=!0,(n===2||n===9||n===3||n===6)&&(n=Ft.current,n!==null&&n.tag===13&&(n.flags|=16384))),Qm(t,e)):Pl(t)}function Pl(e){var t=e;do{if((t.flags&32768)!==0){Qm(t,An);return}e=t.return;var a=Cp(t.alternate,t,ln);if(a!==null){Ae=a;return}if(t=t.sibling,t!==null){Ae=t;return}Ae=t=e}while(t!==null);it===0&&(it=5)}function Qm(e,t){do{var a=Ep(e.alternate,e);if(a!==null){a.flags&=32767,Ae=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){Ae=e;return}Ae=e=a}while(e!==null);it=6,Ae=null}function Xm(e,t,a,n,c,u,f,g,j){e.cancelPendingCommit=null;do Il();while(jt!==0);if((Xe&6)!==0)throw Error(o(327));if(t!==null){if(t===e.current)throw Error(o(177));if(u=t.lanes|t.childLanes,u|=Xi,tl(e,a,u,f,g,j),e===et&&(Ae=et=null,ze=0),Zr=t,zn=e,on=a,Io=u,ec=c,Om=n,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Lp(sa,function(){return Fm(),null})):(e.callbackNode=null,e.callbackPriority=0),n=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||n){n=C.T,C.T=null,c=X.p,X.p=2,f=Xe,Xe|=4;try{kp(e,t,a)}finally{Xe=f,X.p=c,C.T=n}}jt=1,Vm(),Zm(),Km()}}function Vm(){if(jt===1){jt=0;var e=zn,t=Zr,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=C.T,C.T=null;var n=X.p;X.p=2;var c=Xe;Xe|=4;try{Nm(t,e);var u=pc,f=Tu(e.containerInfo),g=u.focusedElem,j=u.selectionRange;if(f!==g&&g&&g.ownerDocument&&Du(g.ownerDocument.documentElement,g)){if(j!==null&&Li(g)){var k=j.start,R=j.end;if(R===void 0&&(R=k),"selectionStart"in g)g.selectionStart=k,g.selectionEnd=Math.min(R,g.value.length);else{var L=g.ownerDocument||document,D=L&&L.defaultView||window;if(D.getSelection){var A=D.getSelection(),ce=g.textContent.length,be=Math.min(j.start,ce),Ie=j.end===void 0?be:Math.min(j.end,ce);!A.extend&&be>Ie&&(f=Ie,Ie=be,be=f);var N=qu(g,be),x=qu(g,Ie);if(N&&x&&(A.rangeCount!==1||A.anchorNode!==N.node||A.anchorOffset!==N.offset||A.focusNode!==x.node||A.focusOffset!==x.offset)){var E=L.createRange();E.setStart(N.node,N.offset),A.removeAllRanges(),be>Ie?(A.addRange(E),A.extend(x.node,x.offset)):(E.setEnd(x.node,x.offset),A.addRange(E))}}}}for(L=[],A=g;A=A.parentNode;)A.nodeType===1&&L.push({element:A,left:A.scrollLeft,top:A.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<L.length;g++){var H=L[g];H.element.scrollLeft=H.left,H.element.scrollTop=H.top}}di=!!hc,pc=hc=null}finally{Xe=c,X.p=n,C.T=a}}e.current=t,jt=2}}function Zm(){if(jt===2){jt=0;var e=zn,t=Zr,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=C.T,C.T=null;var n=X.p;X.p=2;var c=Xe;Xe|=4;try{bm(e,t.alternate,t)}finally{Xe=c,X.p=n,C.T=a}}jt=3}}function Km(){if(jt===4||jt===3){jt=0,hn();var e=zn,t=Zr,a=on,n=Om;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?jt=5:(jt=0,Zr=zn=null,Jm(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(Mn=null),rs(a),t=t.stateNode,wt&&typeof wt.onCommitFiberRoot=="function")try{wt.onCommitFiberRoot(ya,t,void 0,(t.current.flags&128)===128)}catch{}if(n!==null){t=C.T,c=X.p,X.p=2,C.T=null;try{for(var u=e.onRecoverableError,f=0;f<n.length;f++){var g=n[f];u(g.value,{componentStack:g.stack})}}finally{C.T=t,X.p=c}}(on&3)!==0&&Il(),za(e),c=e.pendingLanes,(a&261930)!==0&&(c&42)!==0?e===tc?Rs++:(Rs=0,tc=e):Rs=0,Us(0)}}function Jm(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,_s(t)))}function Il(){return Vm(),Zm(),Km(),Fm()}function Fm(){if(jt!==5)return!1;var e=zn,t=Io;Io=0;var a=rs(on),n=C.T,c=X.p;try{X.p=32>a?32:a,C.T=null,a=ec,ec=null;var u=zn,f=on;if(jt=0,Zr=zn=null,on=0,(Xe&6)!==0)throw Error(o(331));var g=Xe;if(Xe|=4,Dm(u.current),Em(u,u.current,f,a),Xe=g,Us(0,!1),wt&&typeof wt.onPostCommitFiberRoot=="function")try{wt.onPostCommitFiberRoot(ya,u)}catch{}return!0}finally{X.p=c,C.T=n,Jm(e,t)}}function $m(e,t,a){t=oa(a,t),t=Oo(e.stateNode,t,2),e=kn(e,t,2),e!==null&&(ba(e,2),za(e))}function Je(e,t,a){if(e.tag===3)$m(e,e,a);else for(;t!==null;){if(t.tag===3){$m(t,e,a);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Mn===null||!Mn.has(n))){e=oa(a,e),a=Wd(2),n=kn(t,a,2),n!==null&&(Pd(a,n,t,e),ba(n,2),za(n));break}}t=t.return}}function rc(e,t,a){var n=e.pingCache;if(n===null){n=e.pingCache=new Tp;var c=new Set;n.set(t,c)}else c=n.get(t),c===void 0&&(c=new Set,n.set(t,c));c.has(a)||($o=!0,c.add(a),e=Rp.bind(null,e,t,a),t.then(e,e))}function Rp(e,t,a){var n=e.pingCache;n!==null&&n.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,et===e&&(ze&a)===a&&(it===4||it===3&&(ze&62914560)===ze&&300>yt()-Kl?(Xe&2)===0&&Kr(e,0):Wo|=a,Vr===ze&&(Vr=0)),za(e)}function Wm(e,t){t===0&&(t=K()),e=In(e,t),e!==null&&(ba(e,t),za(e))}function Up(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),Wm(e,a)}function Hp(e,t){var a=0;switch(e.tag){case 31:case 13:var n=e.stateNode,c=e.memoizedState;c!==null&&(a=c.retryLane);break;case 19:n=e.stateNode;break;case 22:n=e.stateNode._retryCache;break;default:throw Error(o(314))}n!==null&&n.delete(t),Wm(e,a)}function Lp(e,t){return Xn(e,t)}var ei=null,Fr=null,sc=!1,ti=!1,lc=!1,Un=0;function za(e){e!==Fr&&e.next===null&&(Fr===null?ei=Fr=e:Fr=Fr.next=e),ti=!0,sc||(sc=!0,Yp())}function Us(e,t){if(!lc&&ti){lc=!0;do for(var a=!1,n=ei;n!==null;){if(e!==0){var c=n.pendingLanes;if(c===0)var u=0;else{var f=n.suspendedLanes,g=n.pingedLanes;u=(1<<31-kt(42|e)+1)-1,u&=c&~(f&~g),u=u&201326741?u&201326741|1:u?u|2:0}u!==0&&(a=!0,tf(n,u))}else u=ze,u=Ea(n,n===et?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(u&3)===0||ka(n,u)||(a=!0,tf(n,u));n=n.next}while(a);lc=!1}}function Bp(){Pm()}function Pm(){ti=sc=!1;var e=0;Un!==0&&Wp()&&(e=Un);for(var t=yt(),a=null,n=ei;n!==null;){var c=n.next,u=Im(n,t);u===0?(n.next=null,a===null?ei=c:a.next=c,c===null&&(Fr=a)):(a=n,(e!==0||(u&3)!==0)&&(ti=!0)),n=c}jt!==0&&jt!==5||Us(e),Un!==0&&(Un=0)}function Im(e,t){for(var a=e.suspendedLanes,n=e.pingedLanes,c=e.expirationTimes,u=e.pendingLanes&-62914561;0<u;){var f=31-kt(u),g=1<<f,j=c[f];j===-1?((g&a)===0||(g&n)!==0)&&(c[f]=Dt(g,t)):j<=t&&(e.expiredLanes|=g),u&=~g}if(t=et,a=ze,a=Ea(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n=e.callbackNode,a===0||e===t&&(Ke===2||Ke===9)||e.cancelPendingCommit!==null)return n!==null&&n!==null&&Ra(n),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||ka(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(n!==null&&Ra(n),rs(a)){case 2:case 8:a=Zn;break;case 32:a=sa;break;case 268435456:a=vt;break;default:a=sa}return n=ef.bind(null,e),a=Xn(a,n),e.callbackPriority=t,e.callbackNode=a,t}return n!==null&&n!==null&&Ra(n),e.callbackPriority=2,e.callbackNode=null,2}function ef(e,t){if(jt!==0&&jt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(Il()&&e.callbackNode!==a)return null;var n=ze;return n=Ea(e,e===et?n:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n===0?null:(zm(e,n,t),Im(e,yt()),e.callbackNode!=null&&e.callbackNode===a?ef.bind(null,e):null)}function tf(e,t){if(Il())return null;zm(e,t,!0)}function Yp(){Ip(function(){(Xe&6)!==0?Xn(Vn,Bp):Pm()})}function ic(){if(Un===0){var e=Mr;e===0&&(e=va,va<<=1,(va&261888)===0&&(va=256)),Un=e}return Un}function af(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:bt(""+e)}function nf(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function Gp(e,t,a,n,c){if(t==="submit"&&a&&a.stateNode===c){var u=af((c[Rt]||null).action),f=n.submitter;f&&(t=(t=f[Rt]||null)?af(t.formAction):f.getAttribute("formAction"),t!==null&&(u=t,f=null));var g=new fl("action","action",null,n,c);e.push({event:g,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(Un!==0){var j=f?nf(c,f):new FormData(c);Eo(a,{pending:!0,data:j,method:c.method,action:u},null,j)}}else typeof u=="function"&&(g.preventDefault(),j=f?nf(c,f):new FormData(c),Eo(a,{pending:!0,data:j,method:c.method,action:u},u,j))},currentTarget:c}]})}}for(var oc=0;oc<Qi.length;oc++){var cc=Qi[oc],Qp=cc.toLowerCase(),Xp=cc[0].toUpperCase()+cc.slice(1);wa(Qp,"on"+Xp)}wa(Mu,"onAnimationEnd"),wa(zu,"onAnimationIteration"),wa(Ru,"onAnimationStart"),wa("dblclick","onDoubleClick"),wa("focusin","onFocus"),wa("focusout","onBlur"),wa(lp,"onTransitionRun"),wa(ip,"onTransitionStart"),wa(op,"onTransitionCancel"),wa(Uu,"onTransitionEnd"),Ht("onMouseEnter",["mouseout","mouseover"]),Ht("onMouseLeave",["mouseout","mouseover"]),Ht("onPointerEnter",["pointerout","pointerover"]),Ht("onPointerLeave",["pointerout","pointerover"]),Qa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Qa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Qa("onBeforeInput",["compositionend","keypress","textInput","paste"]),Qa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Qa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Qa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Vp=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Hs));function rf(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var n=e[a],c=n.event;n=n.listeners;e:{var u=void 0;if(t)for(var f=n.length-1;0<=f;f--){var g=n[f],j=g.instance,k=g.currentTarget;if(g=g.listener,j!==u&&c.isPropagationStopped())break e;u=g,c.currentTarget=k;try{u(c)}catch(R){gl(R)}c.currentTarget=null,u=j}else for(f=0;f<n.length;f++){if(g=n[f],j=g.instance,k=g.currentTarget,g=g.listener,j!==u&&c.isPropagationStopped())break e;u=g,c.currentTarget=k;try{u(c)}catch(R){gl(R)}c.currentTarget=null,u=j}}}}function Oe(e,t){var a=t[Da];a===void 0&&(a=t[Da]=new Set);var n=e+"__bubble";a.has(n)||(sf(t,e,2,!1),a.add(n))}function uc(e,t,a){var n=0;t&&(n|=4),sf(a,e,n,t)}var ai="_reactListening"+Math.random().toString(36).slice(2);function dc(e){if(!e[ai]){e[ai]=!0,xr.forEach(function(a){a!=="selectionchange"&&(Vp.has(a)||uc(a,!1,e),uc(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ai]||(t[ai]=!0,uc("selectionchange",!1,t))}}function sf(e,t,a,n){switch(zf(t)){case 2:var c=vg;break;case 8:c=bg;break;default:c=Cc}a=c.bind(null,t,a,e),c=void 0,!Di||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),n?c!==void 0?e.addEventListener(t,a,{capture:!0,passive:c}):e.addEventListener(t,a,!0):c!==void 0?e.addEventListener(t,a,{passive:c}):e.addEventListener(t,a,!1)}function mc(e,t,a,n,c){var u=n;if((t&1)===0&&(t&2)===0&&n!==null)e:for(;;){if(n===null)return;var f=n.tag;if(f===3||f===4){var g=n.stateNode.containerInfo;if(g===c)break;if(f===4)for(f=n.return;f!==null;){var j=f.tag;if((j===3||j===4)&&f.stateNode.containerInfo===c)return;f=f.return}for(;g!==null;){if(f=Tt(g),f===null)return;if(j=f.tag,j===5||j===6||j===26||j===27){n=u=f;continue e}g=g.parentNode}}n=n.return}uu(function(){var k=u,R=ki(a),L=[];e:{var D=Hu.get(e);if(D!==void 0){var A=fl,ce=e;switch(e){case"keypress":if(dl(a)===0)break e;case"keydown":case"keyup":A=Hh;break;case"focusin":ce="focus",A=Mi;break;case"focusout":ce="blur",A=Mi;break;case"beforeblur":case"afterblur":A=Mi;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=fu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=Ch;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=Yh;break;case Mu:case zu:case Ru:A=qh;break;case Uu:A=Qh;break;case"scroll":case"scrollend":A=wh;break;case"wheel":A=Vh;break;case"copy":case"cut":case"paste":A=Th;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=pu;break;case"toggle":case"beforetoggle":A=Kh}var be=(t&4)!==0,Ie=!be&&(e==="scroll"||e==="scrollend"),N=be?D!==null?D+"Capture":null:D;be=[];for(var x=k,E;x!==null;){var H=x;if(E=H.stateNode,H=H.tag,H!==5&&H!==26&&H!==27||E===null||N===null||(H=ls(x,N),H!=null&&be.push(Ls(x,H,E))),Ie)break;x=x.return}0<be.length&&(D=new A(D,ce,null,a,R),L.push({event:D,listeners:be}))}}if((t&7)===0){e:{if(D=e==="mouseover"||e==="pointerover",A=e==="mouseout"||e==="pointerout",D&&a!==Ei&&(ce=a.relatedTarget||a.fromElement)&&(Tt(ce)||ce[gn]))break e;if((A||D)&&(D=R.window===R?R:(D=R.ownerDocument)?D.defaultView||D.parentWindow:window,A?(ce=a.relatedTarget||a.toElement,A=k,ce=ce?Tt(ce):null,ce!==null&&(Ie=m(ce),be=ce.tag,ce!==Ie||be!==5&&be!==27&&be!==6)&&(ce=null)):(A=null,ce=k),A!==ce)){if(be=fu,H="onMouseLeave",N="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(be=pu,H="onPointerLeave",N="onPointerEnter",x="pointer"),Ie=A==null?D:Ga(A),E=ce==null?D:Ga(ce),D=new be(H,x+"leave",A,a,R),D.target=Ie,D.relatedTarget=E,H=null,Tt(R)===k&&(be=new be(N,x+"enter",ce,a,R),be.target=E,be.relatedTarget=Ie,H=be),Ie=H,A&&ce)t:{for(be=Zp,N=A,x=ce,E=0,H=N;H;H=be(H))E++;H=0;for(var ge=x;ge;ge=be(ge))H++;for(;0<E-H;)N=be(N),E--;for(;0<H-E;)x=be(x),H--;for(;E--;){if(N===x||x!==null&&N===x.alternate){be=N;break t}N=be(N),x=be(x)}be=null}else be=null;A!==null&&lf(L,D,A,be,!1),ce!==null&&Ie!==null&&lf(L,Ie,ce,be,!0)}}e:{if(D=k?Ga(k):window,A=D.nodeName&&D.nodeName.toLowerCase(),A==="select"||A==="input"&&D.type==="file")var Ye=Su;else if(ju(D))if(wu)Ye=np;else{Ye=tp;var de=ep}else A=D.nodeName,!A||A.toLowerCase()!=="input"||D.type!=="checkbox"&&D.type!=="radio"?k&&he(k.elementType)&&(Ye=Su):Ye=ap;if(Ye&&(Ye=Ye(e,k))){xu(L,Ye,a,R);break e}de&&de(e,D,k),e==="focusout"&&k&&D.type==="number"&&k.memoizedProps.value!=null&&Sa(D,"number",D.value)}switch(de=k?Ga(k):window,e){case"focusin":(ju(de)||de.contentEditable==="true")&&(Cr=de,Bi=k,hs=null);break;case"focusout":hs=Bi=Cr=null;break;case"mousedown":Yi=!0;break;case"contextmenu":case"mouseup":case"dragend":Yi=!1,Au(L,a,R);break;case"selectionchange":if(sp)break;case"keydown":case"keyup":Au(L,a,R)}var Ne;if(Ri)e:{switch(e){case"compositionstart":var Re="onCompositionStart";break e;case"compositionend":Re="onCompositionEnd";break e;case"compositionupdate":Re="onCompositionUpdate";break e}Re=void 0}else Nr?vu(e,a)&&(Re="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(Re="onCompositionStart");Re&&(gu&&a.locale!=="ko"&&(Nr||Re!=="onCompositionStart"?Re==="onCompositionEnd"&&Nr&&(Ne=du()):(jn=R,Ti="value"in jn?jn.value:jn.textContent,Nr=!0)),de=ni(k,Re),0<de.length&&(Re=new hu(Re,e,null,a,R),L.push({event:Re,listeners:de}),Ne?Re.data=Ne:(Ne=bu(a),Ne!==null&&(Re.data=Ne)))),(Ne=Fh?$h(e,a):Wh(e,a))&&(Re=ni(k,"onBeforeInput"),0<Re.length&&(de=new hu("onBeforeInput","beforeinput",null,a,R),L.push({event:de,listeners:Re}),de.data=Ne)),Gp(L,e,k,a,R)}rf(L,t)})}function Ls(e,t,a){return{instance:e,listener:t,currentTarget:a}}function ni(e,t){for(var a=t+"Capture",n=[];e!==null;){var c=e,u=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||u===null||(c=ls(e,a),c!=null&&n.unshift(Ls(e,c,u)),c=ls(e,t),c!=null&&n.push(Ls(e,c,u))),e.tag===3)return n;e=e.return}return[]}function Zp(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function lf(e,t,a,n,c){for(var u=t._reactName,f=[];a!==null&&a!==n;){var g=a,j=g.alternate,k=g.stateNode;if(g=g.tag,j!==null&&j===n)break;g!==5&&g!==26&&g!==27||k===null||(j=k,c?(k=ls(a,u),k!=null&&f.unshift(Ls(a,k,j))):c||(k=ls(a,u),k!=null&&f.push(Ls(a,k,j)))),a=a.return}f.length!==0&&e.push({event:t,listeners:f})}var Kp=/\r\n?/g,Jp=/\u0000|\uFFFD/g;function of(e){return(typeof e=="string"?e:""+e).replace(Kp,`
`).replace(Jp,"")}function cf(e,t){return t=of(t),of(e)===t}function Pe(e,t,a,n,c,u){switch(a){case"children":typeof n=="string"?t==="body"||t==="textarea"&&n===""||q(e,n):(typeof n=="number"||typeof n=="bigint")&&t!=="body"&&q(e,""+n);break;case"className":ja(e,"class",n);break;case"tabIndex":ja(e,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":ja(e,a,n);break;case"style":ie(e,n,u);break;case"data":if(t!=="object"){ja(e,"data",n);break}case"src":case"href":if(n===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(a);break}n=bt(""+n),e.setAttribute(a,n);break;case"action":case"formAction":if(typeof n=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof u=="function"&&(a==="formAction"?(t!=="input"&&Pe(e,t,"name",c.name,c,null),Pe(e,t,"formEncType",c.formEncType,c,null),Pe(e,t,"formMethod",c.formMethod,c,null),Pe(e,t,"formTarget",c.formTarget,c,null)):(Pe(e,t,"encType",c.encType,c,null),Pe(e,t,"method",c.method,c,null),Pe(e,t,"target",c.target,c,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(a);break}n=bt(""+n),e.setAttribute(a,n);break;case"onClick":n!=null&&(e.onclick=Za);break;case"onScroll":n!=null&&Oe("scroll",e);break;case"onScrollEnd":n!=null&&Oe("scrollend",e);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(o(61));if(a=n.__html,a!=null){if(c.children!=null)throw Error(o(60));e.innerHTML=a}}break;case"multiple":e.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":e.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){e.removeAttribute("xlink:href");break}a=bt(""+n),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,""+n):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":n===!0?e.setAttribute(a,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,n):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?e.setAttribute(a,n):e.removeAttribute(a);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?e.removeAttribute(a):e.setAttribute(a,n);break;case"popover":Oe("beforetoggle",e),Oe("toggle",e),Fn(e,"popover",n);break;case"xlinkActuate":la(e,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":la(e,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":la(e,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":la(e,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":la(e,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":la(e,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":la(e,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":la(e,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":la(e,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":Fn(e,"is",n);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=ft.get(a)||a,Fn(e,a,n))}}function fc(e,t,a,n,c,u){switch(a){case"style":ie(e,n,u);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(o(61));if(a=n.__html,a!=null){if(c.children!=null)throw Error(o(60));e.innerHTML=a}}break;case"children":typeof n=="string"?q(e,n):(typeof n=="number"||typeof n=="bigint")&&q(e,""+n);break;case"onScroll":n!=null&&Oe("scroll",e);break;case"onScrollEnd":n!=null&&Oe("scrollend",e);break;case"onClick":n!=null&&(e.onclick=Za);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ll.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(c=a.endsWith("Capture"),t=a.slice(2,c?a.length-7:void 0),u=e[Rt]||null,u=u!=null?u[a]:null,typeof u=="function"&&e.removeEventListener(t,u,c),typeof n=="function")){typeof u!="function"&&u!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,n,c);break e}a in e?e[a]=n:n===!0?e.setAttribute(a,""):Fn(e,a,n)}}}function zt(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Oe("error",e),Oe("load",e);var n=!1,c=!1,u;for(u in a)if(a.hasOwnProperty(u)){var f=a[u];if(f!=null)switch(u){case"src":n=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:Pe(e,t,u,f,a,null)}}c&&Pe(e,t,"srcSet",a.srcSet,a,null),n&&Pe(e,t,"src",a.src,a,null);return;case"input":Oe("invalid",e);var g=u=f=c=null,j=null,k=null;for(n in a)if(a.hasOwnProperty(n)){var R=a[n];if(R!=null)switch(n){case"name":c=R;break;case"type":f=R;break;case"checked":j=R;break;case"defaultChecked":k=R;break;case"value":u=R;break;case"defaultValue":g=R;break;case"children":case"dangerouslySetInnerHTML":if(R!=null)throw Error(o(137,t));break;default:Pe(e,t,n,R,a,null)}}cl(e,u,g,j,k,f,c,!1);return;case"select":Oe("invalid",e),n=f=u=null;for(c in a)if(a.hasOwnProperty(c)&&(g=a[c],g!=null))switch(c){case"value":u=g;break;case"defaultValue":f=g;break;case"multiple":n=g;default:Pe(e,t,c,g,a,null)}t=u,a=f,e.multiple=!!n,t!=null?h(e,!!n,t,!1):a!=null&&h(e,!!n,a,!0);return;case"textarea":Oe("invalid",e),u=c=n=null;for(f in a)if(a.hasOwnProperty(f)&&(g=a[f],g!=null))switch(f){case"value":n=g;break;case"defaultValue":c=g;break;case"children":u=g;break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(o(91));break;default:Pe(e,t,f,g,a,null)}T(e,n,c,u);return;case"option":for(j in a)if(a.hasOwnProperty(j)&&(n=a[j],n!=null))switch(j){case"selected":e.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:Pe(e,t,j,n,a,null)}return;case"dialog":Oe("beforetoggle",e),Oe("toggle",e),Oe("cancel",e),Oe("close",e);break;case"iframe":case"object":Oe("load",e);break;case"video":case"audio":for(n=0;n<Hs.length;n++)Oe(Hs[n],e);break;case"image":Oe("error",e),Oe("load",e);break;case"details":Oe("toggle",e);break;case"embed":case"source":case"link":Oe("error",e),Oe("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(k in a)if(a.hasOwnProperty(k)&&(n=a[k],n!=null))switch(k){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:Pe(e,t,k,n,a,null)}return;default:if(he(t)){for(R in a)a.hasOwnProperty(R)&&(n=a[R],n!==void 0&&fc(e,t,R,n,a,void 0));return}}for(g in a)a.hasOwnProperty(g)&&(n=a[g],n!=null&&Pe(e,t,g,n,a,null))}function Fp(e,t,a,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,u=null,f=null,g=null,j=null,k=null,R=null;for(A in a){var L=a[A];if(a.hasOwnProperty(A)&&L!=null)switch(A){case"checked":break;case"value":break;case"defaultValue":j=L;default:n.hasOwnProperty(A)||Pe(e,t,A,null,n,L)}}for(var D in n){var A=n[D];if(L=a[D],n.hasOwnProperty(D)&&(A!=null||L!=null))switch(D){case"type":u=A;break;case"name":c=A;break;case"checked":k=A;break;case"defaultChecked":R=A;break;case"value":f=A;break;case"defaultValue":g=A;break;case"children":case"dangerouslySetInnerHTML":if(A!=null)throw Error(o(137,t));break;default:A!==L&&Pe(e,t,D,A,n,L)}}Va(e,f,g,j,k,R,u,c);return;case"select":A=f=g=D=null;for(u in a)if(j=a[u],a.hasOwnProperty(u)&&j!=null)switch(u){case"value":break;case"multiple":A=j;default:n.hasOwnProperty(u)||Pe(e,t,u,null,n,j)}for(c in n)if(u=n[c],j=a[c],n.hasOwnProperty(c)&&(u!=null||j!=null))switch(c){case"value":D=u;break;case"defaultValue":g=u;break;case"multiple":f=u;default:u!==j&&Pe(e,t,c,u,n,j)}t=g,a=f,n=A,D!=null?h(e,!!a,D,!1):!!n!=!!a&&(t!=null?h(e,!!a,t,!0):h(e,!!a,a?[]:"",!1));return;case"textarea":A=D=null;for(g in a)if(c=a[g],a.hasOwnProperty(g)&&c!=null&&!n.hasOwnProperty(g))switch(g){case"value":break;case"children":break;default:Pe(e,t,g,null,n,c)}for(f in n)if(c=n[f],u=a[f],n.hasOwnProperty(f)&&(c!=null||u!=null))switch(f){case"value":D=c;break;case"defaultValue":A=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(o(91));break;default:c!==u&&Pe(e,t,f,c,n,u)}S(e,D,A);return;case"option":for(var ce in a)if(D=a[ce],a.hasOwnProperty(ce)&&D!=null&&!n.hasOwnProperty(ce))switch(ce){case"selected":e.selected=!1;break;default:Pe(e,t,ce,null,n,D)}for(j in n)if(D=n[j],A=a[j],n.hasOwnProperty(j)&&D!==A&&(D!=null||A!=null))switch(j){case"selected":e.selected=D&&typeof D!="function"&&typeof D!="symbol";break;default:Pe(e,t,j,D,n,A)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var be in a)D=a[be],a.hasOwnProperty(be)&&D!=null&&!n.hasOwnProperty(be)&&Pe(e,t,be,null,n,D);for(k in n)if(D=n[k],A=a[k],n.hasOwnProperty(k)&&D!==A&&(D!=null||A!=null))switch(k){case"children":case"dangerouslySetInnerHTML":if(D!=null)throw Error(o(137,t));break;default:Pe(e,t,k,D,n,A)}return;default:if(he(t)){for(var Ie in a)D=a[Ie],a.hasOwnProperty(Ie)&&D!==void 0&&!n.hasOwnProperty(Ie)&&fc(e,t,Ie,void 0,n,D);for(R in n)D=n[R],A=a[R],!n.hasOwnProperty(R)||D===A||D===void 0&&A===void 0||fc(e,t,R,D,n,A);return}}for(var N in a)D=a[N],a.hasOwnProperty(N)&&D!=null&&!n.hasOwnProperty(N)&&Pe(e,t,N,null,n,D);for(L in n)D=n[L],A=a[L],!n.hasOwnProperty(L)||D===A||D==null&&A==null||Pe(e,t,L,D,n,A)}function uf(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function $p(){if(typeof performance.getEntriesByType=="function"){for(var e=0,t=0,a=performance.getEntriesByType("resource"),n=0;n<a.length;n++){var c=a[n],u=c.transferSize,f=c.initiatorType,g=c.duration;if(u&&g&&uf(f)){for(f=0,g=c.responseEnd,n+=1;n<a.length;n++){var j=a[n],k=j.startTime;if(k>g)break;var R=j.transferSize,L=j.initiatorType;R&&uf(L)&&(j=j.responseEnd,f+=R*(j<g?1:(g-k)/(j-k)))}if(--n,t+=8*(u+f)/(c.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var hc=null,pc=null;function ri(e){return e.nodeType===9?e:e.ownerDocument}function df(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function mf(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function gc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var _c=null;function Wp(){var e=window.event;return e&&e.type==="popstate"?e===_c?!1:(_c=e,!0):(_c=null,!1)}var ff=typeof setTimeout=="function"?setTimeout:void 0,Pp=typeof clearTimeout=="function"?clearTimeout:void 0,hf=typeof Promise=="function"?Promise:void 0,Ip=typeof queueMicrotask=="function"?queueMicrotask:typeof hf<"u"?function(e){return hf.resolve(null).then(e).catch(eg)}:ff;function eg(e){setTimeout(function(){throw e})}function Hn(e){return e==="head"}function pf(e,t){var a=t,n=0;do{var c=a.nextSibling;if(e.removeChild(a),c&&c.nodeType===8)if(a=c.data,a==="/$"||a==="/&"){if(n===0){e.removeChild(c),Ir(t);return}n--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")n++;else if(a==="html")Bs(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,Bs(a);for(var u=a.firstChild;u;){var f=u.nextSibling,g=u.nodeName;u[Jn]||g==="SCRIPT"||g==="STYLE"||g==="LINK"&&u.rel.toLowerCase()==="stylesheet"||a.removeChild(u),u=f}}else a==="body"&&Bs(e.ownerDocument.body);a=c}while(a);Ir(t)}function gf(e,t){var a=e;e=0;do{var n=a.nextSibling;if(a.nodeType===1?t?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(t?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),n&&n.nodeType===8)if(a=n.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=n}while(a)}function yc(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":yc(a),jr(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function tg(e,t,a,n){for(;e.nodeType===1;){var c=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!n&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(n){if(!e[Jn])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(u=e.getAttribute("rel"),u==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(u!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(u=e.getAttribute("src"),(u!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&u&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var u=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===u)return e}else return e;if(e=fa(e.nextSibling),e===null)break}return null}function ag(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=fa(e.nextSibling),e===null))return null;return e}function _f(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!t||(e=fa(e.nextSibling),e===null))return null;return e}function vc(e){return e.data==="$?"||e.data==="$~"}function bc(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function ng(e,t){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=t;else if(e.data!=="$?"||a.readyState!=="loading")t();else{var n=function(){t(),a.removeEventListener("DOMContentLoaded",n)};a.addEventListener("DOMContentLoaded",n),e._reactRetry=n}}function fa(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="$~"||t==="&"||t==="F!"||t==="F")break;if(t==="/$"||t==="/&")return null}}return e}var jc=null;function yf(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(t===0)return fa(e.nextSibling);t--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||t++}e=e.nextSibling}return null}function vf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(t===0)return e;t--}else a!=="/$"&&a!=="/&"||t++}e=e.previousSibling}return null}function bf(e,t,a){switch(t=ri(a),e){case"html":if(e=t.documentElement,!e)throw Error(o(452));return e;case"head":if(e=t.head,!e)throw Error(o(453));return e;case"body":if(e=t.body,!e)throw Error(o(454));return e;default:throw Error(o(451))}}function Bs(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);jr(e)}var ha=new Map,jf=new Set;function si(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var cn=X.d;X.d={f:rg,r:sg,D:lg,C:ig,L:og,m:cg,X:dg,S:ug,M:mg};function rg(){var e=cn.f(),t=$l();return e||t}function sg(e){var t=Ya(e);t!==null&&t.tag===5&&t.type==="form"?Ud(t):cn.r(e)}var $r=typeof document>"u"?null:document;function xf(e,t,a){var n=$r;if(n&&typeof t=="string"&&t){var c=ct(t);c='link[rel="'+e+'"][href="'+c+'"]',typeof a=="string"&&(c+='[crossorigin="'+a+'"]'),jf.has(c)||(jf.add(c),e={rel:e,crossOrigin:a,href:t},n.querySelector(c)===null&&(t=n.createElement("link"),zt(t,"link",e),mt(t),n.head.appendChild(t)))}}function lg(e){cn.D(e),xf("dns-prefetch",e,null)}function ig(e,t){cn.C(e,t),xf("preconnect",e,t)}function og(e,t,a){cn.L(e,t,a);var n=$r;if(n&&e&&t){var c='link[rel="preload"][as="'+ct(t)+'"]';t==="image"&&a&&a.imageSrcSet?(c+='[imagesrcset="'+ct(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(c+='[imagesizes="'+ct(a.imageSizes)+'"]')):c+='[href="'+ct(e)+'"]';var u=c;switch(t){case"style":u=Wr(e);break;case"script":u=Pr(e)}ha.has(u)||(e=O({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),ha.set(u,e),n.querySelector(c)!==null||t==="style"&&n.querySelector(Ys(u))||t==="script"&&n.querySelector(Gs(u))||(t=n.createElement("link"),zt(t,"link",e),mt(t),n.head.appendChild(t)))}}function cg(e,t){cn.m(e,t);var a=$r;if(a&&e){var n=t&&typeof t.as=="string"?t.as:"script",c='link[rel="modulepreload"][as="'+ct(n)+'"][href="'+ct(e)+'"]',u=c;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":u=Pr(e)}if(!ha.has(u)&&(e=O({rel:"modulepreload",href:e},t),ha.set(u,e),a.querySelector(c)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Gs(u)))return}n=a.createElement("link"),zt(n,"link",e),mt(n),a.head.appendChild(n)}}}function ug(e,t,a){cn.S(e,t,a);var n=$r;if(n&&e){var c=_n(n).hoistableStyles,u=Wr(e);t=t||"default";var f=c.get(u);if(!f){var g={loading:0,preload:null};if(f=n.querySelector(Ys(u)))g.loading=5;else{e=O({rel:"stylesheet",href:e,"data-precedence":t},a),(a=ha.get(u))&&xc(e,a);var j=f=n.createElement("link");mt(j),zt(j,"link",e),j._p=new Promise(function(k,R){j.onload=k,j.onerror=R}),j.addEventListener("load",function(){g.loading|=1}),j.addEventListener("error",function(){g.loading|=2}),g.loading|=4,li(f,t,n)}f={type:"stylesheet",instance:f,count:1,state:g},c.set(u,f)}}}function dg(e,t){cn.X(e,t);var a=$r;if(a&&e){var n=_n(a).hoistableScripts,c=Pr(e),u=n.get(c);u||(u=a.querySelector(Gs(c)),u||(e=O({src:e,async:!0},t),(t=ha.get(c))&&Sc(e,t),u=a.createElement("script"),mt(u),zt(u,"link",e),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},n.set(c,u))}}function mg(e,t){cn.M(e,t);var a=$r;if(a&&e){var n=_n(a).hoistableScripts,c=Pr(e),u=n.get(c);u||(u=a.querySelector(Gs(c)),u||(e=O({src:e,async:!0,type:"module"},t),(t=ha.get(c))&&Sc(e,t),u=a.createElement("script"),mt(u),zt(u,"link",e),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},n.set(c,u))}}function Sf(e,t,a,n){var c=(c=fe.current)?si(c):null;if(!c)throw Error(o(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=Wr(a.href),a=_n(c).hoistableStyles,n=a.get(t),n||(n={type:"style",instance:null,count:0,state:null},a.set(t,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=Wr(a.href);var u=_n(c).hoistableStyles,f=u.get(e);if(f||(c=c.ownerDocument||c,f={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,f),(u=c.querySelector(Ys(e)))&&!u._p&&(f.instance=u,f.state.loading=5),ha.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},ha.set(e,a),u||fg(c,e,a,f.state))),t&&n===null)throw Error(o(528,""));return f}if(t&&n!==null)throw Error(o(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=Pr(a),a=_n(c).hoistableScripts,n=a.get(t),n||(n={type:"script",instance:null,count:0,state:null},a.set(t,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,e))}}function Wr(e){return'href="'+ct(e)+'"'}function Ys(e){return'link[rel="stylesheet"]['+e+"]"}function wf(e){return O({},e,{"data-precedence":e.precedence,precedence:null})}function fg(e,t,a,n){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?n.loading=1:(t=e.createElement("link"),n.preload=t,t.addEventListener("load",function(){return n.loading|=1}),t.addEventListener("error",function(){return n.loading|=2}),zt(t,"link",a),mt(t),e.head.appendChild(t))}function Pr(e){return'[src="'+ct(e)+'"]'}function Gs(e){return"script[async]"+e}function Nf(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var n=e.querySelector('style[data-href~="'+ct(a.href)+'"]');if(n)return t.instance=n,mt(n),n;var c=O({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return n=(e.ownerDocument||e).createElement("style"),mt(n),zt(n,"style",c),li(n,a.precedence,e),t.instance=n;case"stylesheet":c=Wr(a.href);var u=e.querySelector(Ys(c));if(u)return t.state.loading|=4,t.instance=u,mt(u),u;n=wf(a),(c=ha.get(c))&&xc(n,c),u=(e.ownerDocument||e).createElement("link"),mt(u);var f=u;return f._p=new Promise(function(g,j){f.onload=g,f.onerror=j}),zt(u,"link",n),t.state.loading|=4,li(u,a.precedence,e),t.instance=u;case"script":return u=Pr(a.src),(c=e.querySelector(Gs(u)))?(t.instance=c,mt(c),c):(n=a,(c=ha.get(u))&&(n=O({},a),Sc(n,c)),e=e.ownerDocument||e,c=e.createElement("script"),mt(c),zt(c,"link",n),e.head.appendChild(c),t.instance=c);case"void":return null;default:throw Error(o(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(n=t.instance,t.state.loading|=4,li(n,a.precedence,e));return t.instance}function li(e,t,a){for(var n=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=n.length?n[n.length-1]:null,u=c,f=0;f<n.length;f++){var g=n[f];if(g.dataset.precedence===t)u=g;else if(u!==c)break}u?u.parentNode.insertBefore(e,u.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function xc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Sc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var ii=null;function Cf(e,t,a){if(ii===null){var n=new Map,c=ii=new Map;c.set(a,n)}else c=ii,n=c.get(a),n||(n=new Map,c.set(a,n));if(n.has(e))return n;for(n.set(e,null),a=a.getElementsByTagName(e),c=0;c<a.length;c++){var u=a[c];if(!(u[Jn]||u[tt]||e==="link"&&u.getAttribute("rel")==="stylesheet")&&u.namespaceURI!=="http://www.w3.org/2000/svg"){var f=u.getAttribute(t)||"";f=e+f;var g=n.get(f);g?g.push(u):n.set(f,[u])}}return n}function Ef(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function hg(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function kf(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function pg(e,t,a,n){if(a.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var c=Wr(n.href),u=t.querySelector(Ys(c));if(u){t=u._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(e.count++,e=oi.bind(e),t.then(e,e)),a.state.loading|=4,a.instance=u,mt(u);return}u=t.ownerDocument||t,n=wf(n),(c=ha.get(c))&&xc(n,c),u=u.createElement("link"),mt(u);var f=u;f._p=new Promise(function(g,j){f.onload=g,f.onerror=j}),zt(u,"link",n),a.instance=u}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,t),(t=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=oi.bind(e),t.addEventListener("load",a),t.addEventListener("error",a))}}var wc=0;function gg(e,t){return e.stylesheets&&e.count===0&&ui(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var n=setTimeout(function(){if(e.stylesheets&&ui(e,e.stylesheets),e.unsuspend){var u=e.unsuspend;e.unsuspend=null,u()}},6e4+t);0<e.imgBytes&&wc===0&&(wc=62500*$p());var c=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&ui(e,e.stylesheets),e.unsuspend)){var u=e.unsuspend;e.unsuspend=null,u()}},(e.imgBytes>wc?50:800)+t);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(n),clearTimeout(c)}}:null}function oi(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ui(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var ci=null;function ui(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,ci=new Map,t.forEach(_g,e),ci=null,oi.call(e))}function _g(e,t){if(!(t.state.loading&4)){var a=ci.get(e);if(a)var n=a.get(null);else{a=new Map,ci.set(e,a);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),u=0;u<c.length;u++){var f=c[u];(f.nodeName==="LINK"||f.getAttribute("media")!=="not all")&&(a.set(f.dataset.precedence,f),n=f)}n&&a.set(null,n)}c=t.instance,f=c.getAttribute("data-precedence"),u=a.get(f)||n,u===n&&a.set(null,c),a.set(f,c),this.count++,n=oi.bind(this),c.addEventListener("load",n),c.addEventListener("error",n),u?u.parentNode.insertBefore(c,u.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),t.state.loading|=4}}var Qs={$$typeof:ue,Provider:null,Consumer:null,_currentValue:I,_currentValue2:I,_threadCount:0};function yg(e,t,a,n,c,u,f,g,j){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ut(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ut(0),this.hiddenUpdates=Ut(null),this.identifierPrefix=n,this.onUncaughtError=c,this.onCaughtError=u,this.onRecoverableError=f,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function qf(e,t,a,n,c,u,f,g,j,k,R,L){return e=new yg(e,t,a,f,j,k,R,L,g),t=1,u===!0&&(t|=24),u=Jt(3,null,null,t),e.current=u,u.stateNode=e,t=ao(),t.refCount++,e.pooledCache=t,t.refCount++,u.memoizedState={element:n,isDehydrated:a,cache:t},lo(u),e}function Df(e){return e?(e=qr,e):qr}function Tf(e,t,a,n,c,u){c=Df(c),n.context===null?n.context=c:n.pendingContext=c,n=En(t),n.payload={element:a},u=u===void 0?null:u,u!==null&&(n.callback=u),a=kn(e,n,t),a!==null&&(Zt(a,e,t),js(a,e,t))}function Af(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function Nc(e,t){Af(e,t),(e=e.alternate)&&Af(e,t)}function Of(e){if(e.tag===13||e.tag===31){var t=In(e,67108864);t!==null&&Zt(t,e,67108864),Nc(e,67108864)}}function Mf(e){if(e.tag===13||e.tag===31){var t=It();t=ns(t);var a=In(e,t);a!==null&&Zt(a,e,t),Nc(e,t)}}var di=!0;function vg(e,t,a,n){var c=C.T;C.T=null;var u=X.p;try{X.p=2,Cc(e,t,a,n)}finally{X.p=u,C.T=c}}function bg(e,t,a,n){var c=C.T;C.T=null;var u=X.p;try{X.p=8,Cc(e,t,a,n)}finally{X.p=u,C.T=c}}function Cc(e,t,a,n){if(di){var c=Ec(n);if(c===null)mc(e,t,n,mi,a),Rf(e,n);else if(xg(c,e,t,a,n))n.stopPropagation();else if(Rf(e,n),t&4&&-1<jg.indexOf(e)){for(;c!==null;){var u=Ya(c);if(u!==null)switch(u.tag){case 3:if(u=u.stateNode,u.current.memoizedState.isDehydrated){var f=qt(u.pendingLanes);if(f!==0){var g=u;for(g.pendingLanes|=2,g.entangledLanes|=2;f;){var j=1<<31-kt(f);g.entanglements[1]|=j,f&=~j}za(u),(Xe&6)===0&&(Jl=yt()+500,Us(0))}}break;case 31:case 13:g=In(u,2),g!==null&&Zt(g,u,2),$l(),Nc(u,2)}if(u=Ec(n),u===null&&mc(e,t,n,mi,a),u===c)break;c=u}c!==null&&n.stopPropagation()}else mc(e,t,n,null,a)}}function Ec(e){return e=ki(e),kc(e)}var mi=null;function kc(e){if(mi=null,e=Tt(e),e!==null){var t=m(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=p(t),e!==null)return e;e=null}else if(a===31){if(e=y(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return mi=e,null}function zf(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ua()){case Vn:return 2;case Zn:return 8;case sa:case Ha:return 32;case vt:return 268435456;default:return 32}default:return 32}}var qc=!1,Ln=null,Bn=null,Yn=null,Xs=new Map,Vs=new Map,Gn=[],jg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Rf(e,t){switch(e){case"focusin":case"focusout":Ln=null;break;case"dragenter":case"dragleave":Bn=null;break;case"mouseover":case"mouseout":Yn=null;break;case"pointerover":case"pointerout":Xs.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vs.delete(t.pointerId)}}function Zs(e,t,a,n,c,u){return e===null||e.nativeEvent!==u?(e={blockedOn:t,domEventName:a,eventSystemFlags:n,nativeEvent:u,targetContainers:[c]},t!==null&&(t=Ya(t),t!==null&&Of(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function xg(e,t,a,n,c){switch(t){case"focusin":return Ln=Zs(Ln,e,t,a,n,c),!0;case"dragenter":return Bn=Zs(Bn,e,t,a,n,c),!0;case"mouseover":return Yn=Zs(Yn,e,t,a,n,c),!0;case"pointerover":var u=c.pointerId;return Xs.set(u,Zs(Xs.get(u)||null,e,t,a,n,c)),!0;case"gotpointercapture":return u=c.pointerId,Vs.set(u,Zs(Vs.get(u)||null,e,t,a,n,c)),!0}return!1}function Uf(e){var t=Tt(e.target);if(t!==null){var a=m(t);if(a!==null){if(t=a.tag,t===13){if(t=p(a),t!==null){e.blockedOn=t,sl(e.priority,function(){Mf(a)});return}}else if(t===31){if(t=y(a),t!==null){e.blockedOn=t,sl(e.priority,function(){Mf(a)});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function fi(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=Ec(e.nativeEvent);if(a===null){a=e.nativeEvent;var n=new a.constructor(a.type,a);Ei=n,a.target.dispatchEvent(n),Ei=null}else return t=Ya(a),t!==null&&Of(t),e.blockedOn=a,!1;t.shift()}return!0}function Hf(e,t,a){fi(e)&&a.delete(t)}function Sg(){qc=!1,Ln!==null&&fi(Ln)&&(Ln=null),Bn!==null&&fi(Bn)&&(Bn=null),Yn!==null&&fi(Yn)&&(Yn=null),Xs.forEach(Hf),Vs.forEach(Hf)}function hi(e,t){e.blockedOn===t&&(e.blockedOn=null,qc||(qc=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Sg)))}var pi=null;function Lf(e){pi!==e&&(pi=e,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){pi===e&&(pi=null);for(var t=0;t<e.length;t+=3){var a=e[t],n=e[t+1],c=e[t+2];if(typeof n!="function"){if(kc(n||a)===null)continue;break}var u=Ya(a);u!==null&&(e.splice(t,3),t-=3,Eo(u,{pending:!0,data:c,method:a.method,action:n},n,c))}}))}function Ir(e){function t(j){return hi(j,e)}Ln!==null&&hi(Ln,e),Bn!==null&&hi(Bn,e),Yn!==null&&hi(Yn,e),Xs.forEach(t),Vs.forEach(t);for(var a=0;a<Gn.length;a++){var n=Gn[a];n.blockedOn===e&&(n.blockedOn=null)}for(;0<Gn.length&&(a=Gn[0],a.blockedOn===null);)Uf(a),a.blockedOn===null&&Gn.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(n=0;n<a.length;n+=3){var c=a[n],u=a[n+1],f=c[Rt]||null;if(typeof u=="function")f||Lf(a);else if(f){var g=null;if(u&&u.hasAttribute("formAction")){if(c=u,f=u[Rt]||null)g=f.formAction;else if(kc(c)!==null)continue}else g=f.action;typeof g=="function"?a[n+1]=g:(a.splice(n,3),n-=3),Lf(a)}}}function Bf(){function e(u){u.canIntercept&&u.info==="react-transition"&&u.intercept({handler:function(){return new Promise(function(f){return c=f})},focusReset:"manual",scroll:"manual"})}function t(){c!==null&&(c(),c=null),n||setTimeout(a,20)}function a(){if(!n&&!navigation.transition){var u=navigation.currentEntry;u&&u.url!=null&&navigation.navigate(u.url,{state:u.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,c=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(a,100),function(){n=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),c!==null&&(c(),c=null)}}}function Dc(e){this._internalRoot=e}gi.prototype.render=Dc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(o(409));var a=t.current,n=It();Tf(a,n,e,t,null,null)},gi.prototype.unmount=Dc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Tf(e.current,2,null,e,null,null),$l(),t[gn]=null}};function gi(e){this._internalRoot=e}gi.prototype.unstable_scheduleHydration=function(e){if(e){var t=rl();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Gn.length&&t!==0&&t<Gn[a].priority;a++);Gn.splice(a,0,e),a===0&&Uf(e)}};var Yf=l.version;if(Yf!=="19.2.0")throw Error(o(527,Yf,"19.2.0"));X.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(o(188)):(e=Object.keys(e).join(","),Error(o(268,e)));return e=z(t),e=e!==null?B(e):null,e=e===null?null:e.stateNode,e};var wg={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:C,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _i=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_i.isDisabled&&_i.supportsFiber)try{ya=_i.inject(wg),wt=_i}catch{}}return Js.createRoot=function(e,t){if(!d(e))throw Error(o(299));var a=!1,n="",c=Kd,u=Jd,f=Fd;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onUncaughtError!==void 0&&(c=t.onUncaughtError),t.onCaughtError!==void 0&&(u=t.onCaughtError),t.onRecoverableError!==void 0&&(f=t.onRecoverableError)),t=qf(e,1,!1,null,null,a,n,null,c,u,f,Bf),e[gn]=t.current,dc(e),new Dc(t)},Js.hydrateRoot=function(e,t,a){if(!d(e))throw Error(o(299));var n=!1,c="",u=Kd,f=Jd,g=Fd,j=null;return a!=null&&(a.unstable_strictMode===!0&&(n=!0),a.identifierPrefix!==void 0&&(c=a.identifierPrefix),a.onUncaughtError!==void 0&&(u=a.onUncaughtError),a.onCaughtError!==void 0&&(f=a.onCaughtError),a.onRecoverableError!==void 0&&(g=a.onRecoverableError),a.formState!==void 0&&(j=a.formState)),t=qf(e,1,!0,t,a??null,n,c,j,u,f,g,Bf),t.context=Df(null),a=t.current,n=It(),n=ns(n),c=En(n),c.callback=null,kn(a,c,n),a=n,t.current.lanes=a,ba(t,a),za(t),e[gn]=t.current,dc(e),new gi(t)},Js.version="19.2.0",Js}var Kf;function Og(){if(Kf)return Ac.exports;Kf=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(l){console.error(l)}}return s(),Ac.exports=Ag(),Ac.exports}var Mg=Og();const zg=ch(Mg),Rg="fieldsync-offline",Ug=2,Qe={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",TM_TICKETS:"tm_tickets",DAILY_REPORTS:"daily_reports",MESSAGES:"messages",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let pr=null;const dn=()=>new Promise((s,l)=>{if(pr){s(pr);return}const i=indexedDB.open(Rg,Ug);i.onerror=()=>{console.error("Failed to open offline database"),l(i.error)},i.onsuccess=()=>{pr=i.result,s(pr)},i.onupgradeneeded=o=>{const d=o.target.result;if(d.objectStoreNames.contains(Qe.PROJECTS)||d.createObjectStore(Qe.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),d.objectStoreNames.contains(Qe.AREAS)||d.createObjectStore(Qe.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Qe.CREW_CHECKINS)||d.createObjectStore(Qe.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Qe.TM_TICKETS)||d.createObjectStore(Qe.TM_TICKETS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Qe.DAILY_REPORTS)||d.createObjectStore(Qe.DAILY_REPORTS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Qe.MESSAGES)||d.createObjectStore(Qe.MESSAGES,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!d.objectStoreNames.contains(Qe.PENDING_ACTIONS)){const m=d.createObjectStore(Qe.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});m.createIndex("type","type",{unique:!1}),m.createIndex("created_at","created_at",{unique:!1})}d.objectStoreNames.contains(Qe.CACHED_DATA)||d.createObjectStore(Qe.CACHED_DATA,{keyPath:"key"})}}),_r=(s,l="readonly")=>{if(!pr)throw new Error("Database not initialized");return pr.transaction(s,l).objectStore(s)},el=async(s,l)=>(await dn(),new Promise((i,o)=>{const m=_r(s,"readwrite").put(l);m.onsuccess=()=>i(m.result),m.onerror=()=>o(m.error)})),mh=async(s,l)=>(await dn(),new Promise((i,o)=>{const d=pr.transaction(s,"readwrite"),m=d.objectStore(s);l.forEach(p=>m.put(p)),d.oncomplete=()=>i(),d.onerror=()=>o(d.error)})),Hg=async(s,l)=>(await dn(),new Promise((i,o)=>{const m=_r(s).get(l);m.onsuccess=()=>i(m.result),m.onerror=()=>o(m.error)})),fh=async s=>(await dn(),new Promise((l,i)=>{const d=_r(s).getAll();d.onsuccess=()=>l(d.result||[]),d.onerror=()=>i(d.error)})),tu=async(s,l,i)=>(await dn(),new Promise((o,d)=>{const y=_r(s).index(l).getAll(i);y.onsuccess=()=>o(y.result||[]),y.onerror=()=>d(y.error)})),Lg=async(s,l)=>(await dn(),new Promise((i,o)=>{const m=_r(s,"readwrite").delete(l);m.onsuccess=()=>i(),m.onerror=()=>o(m.error)})),Et={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},pa=async(s,l,i={})=>{await dn();const o={type:s,payload:l,metadata:i,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((d,m)=>{const y=_r(Qe.PENDING_ACTIONS,"readwrite").add(o);y.onsuccess=()=>{d(y.result)},y.onerror=()=>m(y.error)})},hh=async()=>fh(Qe.PENDING_ACTIONS),ji=async()=>(await hh()).length,Bg=async s=>Lg(Qe.PENDING_ACTIONS,s),Yg=async(s,l)=>(await dn(),new Promise((i,o)=>{const d=_r(Qe.PENDING_ACTIONS,"readwrite"),m=d.get(s);m.onsuccess=()=>{const p=m.result;if(p){const y={...p,...l},b=d.put(y);b.onsuccess=()=>i(y),b.onerror=()=>o(b.error)}else o(new Error("Action not found"))},m.onerror=()=>o(m.error)})),Gg=async s=>mh(Qe.PROJECTS,s),Jf=async s=>s?tu(Qe.PROJECTS,"company_id",s):fh(Qe.PROJECTS),Qg=async s=>mh(Qe.AREAS,s),Ff=async s=>tu(Qe.AREAS,"project_id",s),zc=async(s,l)=>{const i=await Hg(Qe.AREAS,s);return i&&(i.status=l,i.updated_at=new Date().toISOString(),await el(Qe.AREAS,i)),i},Rc=async s=>el(Qe.CREW_CHECKINS,s),$f=async s=>el(Qe.TM_TICKETS,s),ea=()=>{const s=new Uint8Array(6);crypto.getRandomValues(s);const l=Array.from(s,i=>i.toString(36)).join("");return`temp_${Date.now()}_${l}`},es=async s=>el(Qe.DAILY_REPORTS,s),Xg=async(s,l)=>(await tu(Qe.DAILY_REPORTS,"project_id",s)).find(o=>o.report_date===l)||null,Wf=async s=>el(Qe.MESSAGES,s);let au=typeof navigator<"u"?navigator.onLine:!0;const Vc=new Set,nu=s=>(Vc.add(s),()=>Vc.delete(s)),ga=()=>au,Pf=s=>{au=s,Vc.forEach(l=>l(s))};typeof window<"u"&&(window.addEventListener("online",()=>{Pf(!0)}),window.addEventListener("offline",()=>{Pf(!1)}));let Uc=!1;const ph=async s=>{if(Uc||!au)return{synced:0,failed:0};Uc=!0;const l={synced:0,failed:0};try{const i=await hh();for(const o of i)try{await Vg(o,s),await Bg(o.id),l.synced++}catch(d){console.error(`Failed to sync action ${o.type}:`,d),l.failed++,await Yg(o.id,{attempts:(o.attempts||0)+1,last_error:d.message,last_attempt:new Date().toISOString()})}}finally{Uc=!1}return l},Vg=async(s,l)=>{const{type:i,payload:o}=s;switch(i){case Et.UPDATE_AREA_STATUS:return l.updateAreaStatus(o.areaId,o.status);case Et.CREATE_TM_TICKET:const d=await l.createTMTicket(o.ticket);return o.workers?.length>0&&await l.addTMWorkers(d.id,o.workers),o.items?.length>0&&await l.addTMItems(d.id,o.items),d;case Et.SAVE_CREW_CHECKIN:return l.saveCrewCheckin(o.projectId,o.workers,o.checkInDate);case Et.SUBMIT_DAILY_REPORT:return await l.saveDailyReport(o.projectId,o.reportData),l.submitDailyReport(o.projectId,o.submittedBy);case Et.SEND_MESSAGE:return l.sendMessage(o.projectId,o.senderType,o.senderName,o.content);case Et.CREATE_MATERIAL_REQUEST:return l.createMaterialRequest(o.projectId,o.items,o.requestedBy,o.neededBy,o.priority,o.notes);default:throw new Error(`Unknown action type: ${i}`)}},gh="https://cegifnrcwdilromcyouq.supabase.co",ru="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlZ2lmbnJjd2RpbHJvbWN5b3VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTQ5OTAsImV4cCI6MjA4MDIzMDk5MH0.qAiBG5XaB0C1E0U2tQbQkrhpm1iUhM6A2MXngEHhX4A",v=!!ru,_=v?uh(gh,ru):null,yi={slowQueryThreshold:200,enableSupabase:v},Te={query(s,l){const i={type:"query",operation:s,duration_ms:l.duration,rows_returned:l.rows,company_id:l.company_id||null,project_id:l.project_id||null,user_id:l.user_id||null,timestamp:new Date().toISOString()};yi.enableSupabase&&l.duration>=yi.slowQueryThreshold&&Hc("query",i)},error(s,l){const i={type:"error",category:s,severity:l.severity||"error",error_code:l.code||null,message:l.message,company_id:l.company_id||null,user_id:l.user_id||null,project_id:l.project_id||null,operation:l.operation||null,context:l.extra||{},timestamp:new Date().toISOString()};yi.enableSupabase&&Hc("error",i)},storage(s,l){const i={type:"storage",operation:s,company_id:l.company_id||null,project_id:l.project_id||null,file_size_bytes:l.size||0,duration_ms:l.duration||0,success:l.success!==!1,error_message:l.error||null,timestamp:new Date().toISOString()};yi.enableSupabase&&(!i.success||i.duration_ms>5e3)&&Hc("storage",i)},activity(s,l){}};async function Hc(s,l){if(_)try{s==="error"?await _.rpc("log_error",{p_severity:l.severity,p_category:l.category,p_message:l.message,p_company_id:l.company_id,p_user_id:l.user_id,p_project_id:l.project_id,p_operation:l.operation,p_error_code:l.error_code,p_context:l.context||{}}):s==="query"&&await _.rpc("log_query_metric",{p_operation:l.operation,p_duration_ms:l.duration_ms,p_rows_returned:l.rows_returned,p_company_id:l.company_id,p_project_id:l.project_id,p_user_id:l.user_id,p_context:{}})}catch{}}Te.wrapQuery=function(s,l){return async function(...i){const o=performance.now();try{const d=await l.apply(this,i),p={duration:Math.round(performance.now()-o),rows:Array.isArray(d)?d.length:void 0};return Te.query(s,p),d}catch(d){const m=Math.round(performance.now()-o);throw Te.error("database",{message:d.message,operation:s,severity:"error",extra:{duration:m}}),d}}};Te.time=async function(s,l){const i=performance.now();try{const o=await l(),d=Math.round(performance.now()-i);return Te.query(s,{duration:d}),o}catch(o){throw Te.error("general",{message:o.message,operation:s}),o}};typeof window<"u"&&dn().catch(s=>console.error("Failed to init offline DB:",s));const Zc="fieldsync_field_session";let Ws=null;const su=()=>{if(Ws)return Ws;try{const s=sessionStorage.getItem(Zc);if(s)return Ws=JSON.parse(s),Ws}catch{}return null},Kc=s=>{Ws=s,s?sessionStorage.setItem(Zc,JSON.stringify(s)):sessionStorage.removeItem(Zc)},_h=async()=>{const s=su();if(s?.token&&v)try{await _.rpc("invalidate_field_session",{p_session_token:s.token})}catch{}Kc(null)};let Fs=null;const yh=()=>{const s=su();return!s?.token||!v?_:((!Fs||Fs._sessionToken!==s.token)&&(Fs=uh(gh,ru,{global:{headers:{"x-field-session":s.token}}}),Fs._sessionToken=s.token),Fs)},ta=()=>v?su()?.token?yh():_:null,Jc="fieldsync_data",Si="fieldsync_user",Zg=()=>{const s="fieldsync_device_id";let l=localStorage.getItem(s);return l||(l=crypto.randomUUID(),localStorage.setItem(s,l)),l},If={projects:[],areas:[],users:[],assignments:[]},re=()=>{try{const s=localStorage.getItem(Jc);return s?JSON.parse(s):If}catch{return localStorage.removeItem(Jc),If}},De=s=>{localStorage.setItem(Jc,JSON.stringify(s))},vi=()=>{try{const s=localStorage.getItem(Si);return s?JSON.parse(s):null}catch{return localStorage.removeItem(Si),null}},bi=s=>{s?localStorage.setItem(Si,JSON.stringify(s)):localStorage.removeItem(Si)},Fc={async signUp(s,l,i,o){if(v){const{data:d,error:m}=await _.auth.signUp({email:s,password:l,options:{data:{name:i,role:o}}});if(m)throw m;return d}else{const d=re(),m={id:crypto.randomUUID(),email:s,name:i,role:o,created_at:new Date().toISOString()};return d.users.push(m),De(d),bi(m),{user:m}}},async signIn(s,l){if(v){const{data:i,error:o}=await _.auth.signInWithPassword({email:s,password:l});if(o)throw o;return i}else{const o=re().users.find(d=>d.email===s);if(!o)throw new Error("User not found");return bi(o),{user:o}}},async signOut(){if(v){const{error:s}=await _.auth.signOut();if(s)throw s}else bi(null)},async getUser(){if(v){const{data:{user:s}}=await _.auth.getUser();return s}else return vi()},async getProfile(){if(v){const{data:{user:s}}=await _.auth.getUser();if(!s)return null;const{data:l,error:i}=await _.from("users").select("*").eq("id",s.id).single();return i?{id:s.id,email:s.email,name:s.user_metadata?.name||"",role:s.user_metadata?.role||"foreman"}:l}else return vi()},async updateRole(s,l){if(v){const{data:i,error:o}=await _.from("users").update({role:l}).eq("id",s).select().single();if(o)throw o;return i}else{const i=re(),o=i.users.find(d=>d.id===s);return o&&(o.role=l,De(i),vi()?.id===s&&bi(o)),o}},onAuthStateChange(s){if(v)return _.auth.onAuthStateChange(s);{const l=vi();return s(l?"SIGNED_IN":"SIGNED_OUT",{user:l}),{data:{subscription:{unsubscribe:()=>{}}}}}}},_e={async getProjects(s=null,l=!1){if(v){if(!ga()){const o=await Jf(s);return l?o:o.filter(d=>d.status!=="archived")}const i=performance.now();try{let o=_.from("projects").select("*").order("created_at",{ascending:!1});s&&(o=o.eq("company_id",s)),l||(o=o.eq("status","active"));const{data:d,error:m}=await o,p=Math.round(performance.now()-i);if(Te.query("getProjects",{duration:p,rows:d?.length,company_id:s}),m){Te.error("database",{message:m.message,operation:"getProjects",company_id:s});const y=await Jf(s);if(y.length>0)return y;throw m}return d?.length>0&&Gg(d).catch(y=>console.error("Failed to cache projects:",y)),d}catch(o){throw Te.error("database",{message:o.message,operation:"getProjects",company_id:s}),o}}else{const i=re().projects;return l?i:i.filter(o=>o.status!=="archived")}},async getProjectsPaginated(s,{page:l=0,limit:i=25,status:o="active"}={}){if(v){const p=performance.now();try{let y=_.from("projects").select("*",{count:"exact"}).eq("company_id",s).order("created_at",{ascending:!1}).range(l*i,(l+1)*i-1);o!=="all"&&(y=y.eq("status",o));const{data:b,error:z,count:B}=await y,O=Math.round(performance.now()-p);if(Te.query("getProjectsPaginated",{duration:O,rows:b?.length,page:l,company_id:s}),z)throw z;return{projects:b||[],totalCount:B||0,hasMore:(l+1)*i<(B||0),page:l,limit:i}}catch(y){throw Te.error("database",{message:y.message,operation:"getProjectsPaginated",company_id:s}),y}}const d=re().projects.filter(p=>p.company_id===s&&(o==="all"||p.status===o)),m=l*i;return{projects:d.slice(m,m+i),totalCount:d.length,hasMore:m+i<d.length,page:l,limit:i}},async getProjectsWithSummary(s){if(v){const l=performance.now();try{const{data:i,error:o}=await _.from("projects").select(`
            *,
            areas:areas(count),
            tickets:t_and_m_tickets(count),
            pending_tickets:t_and_m_tickets(count),
            daily_reports:daily_reports(count)
          `).eq("company_id",s).eq("status","active").eq("pending_tickets.status","pending").order("created_at",{ascending:!1}),d=Math.round(performance.now()-l);if(Te.query("getProjectsWithSummary",{duration:d,rows:i?.length,company_id:s}),o)throw o;return(i||[]).map(m=>({...m,areaCount:m.areas?.[0]?.count||0,ticketCount:m.tickets?.[0]?.count||0,pendingTicketCount:m.pending_tickets?.[0]?.count||0,reportCount:m.daily_reports?.[0]?.count||0,areas:void 0,tickets:void 0,pending_tickets:void 0,daily_reports:void 0}))}catch(i){return Te.error("database",{message:i.message,operation:"getProjectsWithSummary",company_id:s}),this.getProjects(s)}}return re().projects.filter(l=>l.company_id===s&&l.status==="active")},async getProjectDashboardSummary(s){if(v){const l=performance.now();try{const{data:i,error:o}=await _.rpc("get_project_dashboard_summary",{p_company_id:s}),d=Math.round(performance.now()-l);if(Te.query("getProjectDashboardSummary",{duration:d,rows:i?.length,company_id:s}),o){if(o.message?.includes("function")||o.code==="42883")return this.getProjectsWithSummary(s);throw o}return(i||[]).map(m=>({id:m.project_id,name:m.project_name,status:m.project_status,job_number:m.project_number,address:m.project_address,pin:m.project_pin,created_at:m.created_at,start_date:m.start_date,end_date:m.end_date,contract_value:Number(m.contract_value)||0,work_type:m.work_type||"demolition",job_type:m.job_type||"standard",general_contractor:m.general_contractor||"",areaCount:Number(m.total_areas)||0,completedAreas:Number(m.completed_areas)||0,inProgressAreas:Number(m.in_progress_areas)||0,pendingAreas:Number(m.pending_areas)||0,ticketCount:Number(m.total_tickets)||0,pendingTicketCount:Number(m.pending_tickets)||0,submittedTicketCount:Number(m.submitted_tickets)||0,approvedTicketCount:Number(m.approved_tickets)||0,totalLaborHours:Number(m.total_labor_hours)||0,todayLaborHours:Number(m.today_labor_hours)||0,todayWorkerCount:Number(m.today_worker_count)||0,lastActivityAt:m.last_activity_at,dailyReportsThisWeek:Number(m.daily_reports_this_week)||0,corCount:Number(m.cor_count)||0,pendingCorCount:Number(m.pending_cor_count)||0,disposalLoadsToday:Number(m.disposal_loads_today)||0}))}catch(i){return Te.error("database",{message:i.message,operation:"getProjectDashboardSummary",company_id:s}),this.getProjectsWithSummary(s)}}return re().projects.filter(l=>l.company_id===s&&l.status==="active")},async getArchivedProjects(s){if(v){const{data:l,error:i}=await _.from("projects").select("*").eq("company_id",s).eq("status","archived").order("archived_at",{ascending:!1});if(i)throw i;return l}else return re().projects.filter(l=>l.status==="archived")},async getProjectCount(s){if(v){const{count:l,error:i}=await _.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",s).in("status",["active","archived"]);if(i)throw i;return l||0}else return re().projects.filter(i=>i.company_id===s&&i.status!=="deleted").length},async archiveProject(s){if(v){const{data:l,error:i}=await _.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",s).select().single();if(i)throw i;return l}else{const l=re(),i=l.projects.find(o=>o.id===s);return i&&(i.status="archived",i.archived_at=new Date().toISOString(),De(l)),i}},async getProjectStorageStats(s){if(!v)return{photoCount:0,estimatedMB:0};const{data:l,error:i}=await _.from("t_and_m_tickets").select("photos").eq("project_id",s);if(i)throw i;let o=0;const d=[];l?.forEach(p=>{p.photos&&Array.isArray(p.photos)&&(o+=p.photos.length,d.push(...p.photos))});const m=o*1.5;return{photoCount:o,estimatedMB:m,photoUrls:d}},async archiveProjectDeep(s,l){if(!v)return null;const{photoUrls:i}=await this.getProjectStorageStats(s);if(i.length>0){const m=i.map(p=>{try{const b=new URL(p).pathname.match(/\/tm-photos\/(.+)$/);return b?b[1]:null}catch{return null}}).filter(Boolean);if(m.length>0)for(let p=0;p<m.length;p+=100){const y=m.slice(p,p+100);await _.storage.from("tm-photos").remove(y)}}await _.from("t_and_m_tickets").update({photos:[]}).eq("project_id",s);const{data:o,error:d}=await _.from("projects").update({status:"archived",archived_at:new Date().toISOString(),photos:[],storage_cleaned:!0}).eq("id",s).select().single();if(d)throw d;return{...o,photosDeleted:i.length}},async restoreProject(s){if(v){const{data:l,error:i}=await _.from("projects").update({status:"active",archived_at:null}).eq("id",s).select().single();if(i)throw i;return l}else{const l=re(),i=l.projects.find(o=>o.id===s);return i&&(i.status="active",i.archived_at=null,De(l)),i}},async getProject(s){if(v){const{data:l,error:i}=await _.from("projects").select("*").eq("id",s).single();if(i)throw i;return l}else return re().projects.find(l=>l.id===s)},async createProject(s){if(v){const{data:l,error:i}=await _.from("projects").insert({...s,status:"active"}).select().single();if(i)throw console.error("Supabase createProject error:",i.message,i.details,i.hint),i;return l}else{const l=re(),i={...s,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return l.projects.push(i),De(l),i}},async getProjectByPin(s){if(v){const{data:l,error:i}=await _.from("projects").select("*").eq("pin",s).eq("status","active").single();return i?null:l}else return re().projects.find(i=>i.pin===s&&i.status==="active")||null},async getProjectByPinAndCompany(s,l){if(console.log("[PIN Auth Fallback] Trying direct lookup",{pin:"****",companyId:l}),v){const{data:i,error:o}=await _.from("projects").select("*").eq("pin",s).eq("company_id",l).eq("status","active").single();return console.log("[PIN Auth Fallback] Result:",{data:i,error:o}),o?null:i}else return re().projects.find(o=>o.pin===s&&o.company_id===l&&o.status==="active")||null},async getProjectByPinSecure(s,l){if(v){const i=Zg();console.log("[PIN Auth] Starting secure PIN validation",{pin:"****",companyCode:l,deviceId:i});const{data:o,error:d}=await _.rpc("validate_pin_and_create_session",{p_pin:s,p_company_code:l,p_device_id:i,p_ip_address:null});if(console.log("[PIN Auth] RPC response:",{data:o,error:d}),d)return console.error("[PIN Auth] RPC error:",d),{success:!1,rateLimited:!1,project:null,error:d.message};if(!o||o.length===0)return console.warn("[PIN Auth] RPC returned empty data"),{success:!1,rateLimited:!1,project:null};const m=o[0];if(console.log("[PIN Auth] RPC result:",m),m.error_code==="RATE_LIMITED")return console.warn("[PIN Auth] Rate limited"),{success:!1,rateLimited:!0,project:null};if(m.error_code==="INVALID_COMPANY"||m.error_code==="INVALID_PIN")return console.warn("[PIN Auth] Invalid company or PIN:",m.error_code),{success:!1,rateLimited:!1,project:null};if(!m.success||!m.project_id)return console.warn("[PIN Auth] Validation failed:",{success:m.success,project_id:m.project_id}),{success:!1,rateLimited:!1,project:null};console.log("[PIN Auth] Validation successful, creating session"),Kc({token:m.session_token,projectId:m.project_id,companyId:m.company_id,projectName:m.project_name,companyName:m.company_name,createdAt:new Date().toISOString()});const p=yh(),{data:y,error:b}=await p.from("projects").select("*").eq("id",m.project_id).single();return console.log("[PIN Auth] Project fetch result:",{projectData:y,projectError:b}),{success:!0,rateLimited:!1,sessionToken:m.session_token,project:y||{id:m.project_id,name:m.project_name,company_id:m.company_id,status:"active"}}}else{const i=re(),d=(i.companies||[]).find(p=>p.code===l);if(!d)return{success:!1,rateLimited:!1,project:null};const m=i.projects.find(p=>p.pin===s&&p.company_id===d.id&&p.status==="active");if(m){const p=`demo_${Date.now()}_${Math.random().toString(36).slice(2)}`;Kc({token:p,projectId:m.id,companyId:d.id,projectName:m.name,companyName:d.name,createdAt:new Date().toISOString()})}return{success:!!m,rateLimited:!1,project:m||null}}},async isPinAvailable(s,l=null){if(v){let i=_.from("projects").select("id").eq("pin",s);l&&(i=i.neq("id",l));const{data:o,error:d}=await i;if(d)throw d;return o.length===0}else return!re().projects.some(o=>o.pin===s&&o.id!==l)},async updateProjectPin(s,l){if(v){const{data:i,error:o}=await _.from("projects").update({pin:l}).eq("id",s).select().single();if(o)throw o;return i}else{const i=re(),o=i.projects.find(d=>d.id===s);return o&&(o.pin=l,De(i)),o}},async updateProject(s,l){if(v){const{data:i,error:o}=await _.from("projects").update(l).eq("id",s).select().single();if(o)throw console.error("Error updating project:",o),o;return i}else{const i=re(),o=i.projects.find(d=>d.id===s);return o&&(Object.assign(o,l),De(i)),o}},async deleteProject(s){if(v){const{error:l}=await _.from("projects").delete().eq("id",s);if(l)throw l}else{const l=re();l.projects=l.projects.filter(i=>i.id!==s),l.areas=l.areas.filter(i=>i.project_id!==s),De(l)}},async getAreas(s){if(v){if(!ga())return Ff(s);const l=ta(),{data:i,error:o}=await l.from("areas").select("*").eq("project_id",s).order("sort_order",{ascending:!0});if(o){const d=await Ff(s);if(d.length>0)return d;throw o}return i?.length>0&&Qg(i).catch(d=>console.error("Failed to cache areas:",d)),i}else return re().areas.filter(l=>l.project_id===s)},async createArea(s){if(v){const l=ta(),{data:i,error:o}=await l.from("areas").insert(s).select().single();if(o)throw o;return i}else{const l=re(),i={...s,id:crypto.randomUUID(),created_at:new Date().toISOString()};return l.areas.push(i),De(l),i}},async updateAreaStatus(s,l){if(v){if(!ga()){const m=await zc(s,l);return await pa(Et.UPDATE_AREA_STATUS,{areaId:s,status:l}),m}const i=ta(),{data:o,error:d}=await i.from("areas").update({status:l}).eq("id",s).select().single();if(d){if(d.message?.includes("fetch")||d.message?.includes("network")){const m=await zc(s,l);return await pa(Et.UPDATE_AREA_STATUS,{areaId:s,status:l}),m}throw d}return o&&zc(s,l).catch(m=>console.error("Failed to update cached area:",m)),o}else{const i=re(),o=i.areas.find(d=>d.id===s);return o&&(o.status=l,o.updated_at=new Date().toISOString()),De(i),o}},async updateArea(s,l){if(v){const{data:i,error:o}=await _.from("areas").update(l).eq("id",s).select().single();if(o)throw o;return i}else{const i=re(),o=i.areas.find(d=>d.id===s);return o&&(Object.assign(o,l),o.updated_at=new Date().toISOString()),De(i),o}},async deleteArea(s){if(v){const{error:l}=await _.from("areas").delete().eq("id",s);if(l)throw l}else{const l=re();l.areas=l.areas.filter(i=>i.id!==s),De(l)}},subscribeToAreas(s,l){return v?_.channel(`areas:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${s}`},l).subscribe():null},subscribeToMessages(s,l){return v?_.channel(`messages:${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${s}`},l).subscribe():null},subscribeToMaterialRequests(s,l){return v?_.channel(`material_requests:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${s}`},l).subscribe():null},subscribeToDailyReports(s,l){return v?_.channel(`daily_reports:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${s}`},l).subscribe():null},subscribeToCrewCheckins(s,l){return v?_.channel(`crew_checkins:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${s}`},l).subscribe():null},subscribeToInjuryReports(s,l){return v?_.channel(`injury_reports:${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${s}`},l).subscribe():null},subscribeToTMTickets(s,l){return v?_.channel(`tm_tickets:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${s}`},l).subscribe():null},subscribeToCompanyActivity(s,l,i){if(!v||!l||l.length===0)return null;const o=_.channel(`company_activity:${s}`);return l.forEach(d=>{o.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${d}`},m=>i.onMessage?.(m)),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"material_requests",filter:`project_id=eq.${d}`},m=>i.onMaterialRequest?.(m)),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${d}`},m=>i.onTMTicket?.(m)),o.on("postgres_changes",{event:"UPDATE",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${d}`},m=>i.onTMTicket?.(m)),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"crew_checkins",filter:`project_id=eq.${d}`},m=>i.onCrewCheckin?.(m)),o.on("postgres_changes",{event:"UPDATE",schema:"public",table:"crew_checkins",filter:`project_id=eq.${d}`},m=>i.onCrewCheckin?.(m)),o.on("postgres_changes",{event:"UPDATE",schema:"public",table:"areas",filter:`project_id=eq.${d}`},m=>i.onAreaUpdate?.(m)),o.on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${d}`},m=>i.onCORChange?.(m))}),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${s}`},d=>i.onInjuryReport?.(d)),o.subscribe()},unsubscribe(s){s&&v&&_.removeChannel(s)},async getAssignedProjects(s){if(v){const{data:l,error:i}=await _.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",s);if(i)throw i;return l.map(o=>o.projects)}else{const l=re();return(l.assignments?.filter(o=>o.user_id===s)||[]).map(o=>l.projects.find(d=>d.id===o.project_id)).filter(Boolean)}},async assignUserToProject(s,l,i){if(v){const{data:o,error:d}=await _.from("project_assignments").insert({project_id:s,user_id:l,assigned_by:i}).select().single();if(d)throw d;return o}else{const o=re();o.assignments||(o.assignments=[]);const d={id:crypto.randomUUID(),project_id:s,user_id:l,assigned_by:i,assigned_at:new Date().toISOString()};return o.assignments.push(d),De(o),d}},async removeUserFromProject(s,l){if(v){const{error:i}=await _.from("project_assignments").delete().eq("project_id",s).eq("user_id",l);if(i)throw i}else{const i=re();i.assignments=i.assignments?.filter(o=>!(o.project_id===s&&o.user_id===l))||[],De(i)}},async getProjectAssignments(s){if(v){const{data:l,error:i}=await _.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",s);if(i)throw i;return l.map(o=>o.users)}else{const l=re();return(l.assignments?.filter(o=>o.project_id===s)||[]).map(o=>l.users.find(d=>d.id===o.user_id)).filter(Boolean)}},async getAllUsers(){if(v){const{data:s,error:l}=await _.from("users").select("*").order("name");if(l)throw l;return s}else return re().users||[]},async getForemen(){if(v){const{data:s,error:l}=await _.from("users").select("*").eq("role","foreman").order("name");if(l)throw l;return s}else return(re().users||[]).filter(s=>s.role==="foreman")},async logActivity(s,l,i,o,d,m){if(v){const{error:p}=await _.from("activity_log").insert({user_id:s,project_id:l,area_id:i,action:o,old_value:d,new_value:m});p&&console.error("Error logging activity:",p)}},async getProjectActivity(s,l=50){if(v){const{data:i,error:o}=await _.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",s).order("created_at",{ascending:!1}).limit(l);if(o)throw o;return i}return[]},async getMaterialsEquipment(s){if(v){const{data:l,error:i}=await _.from("materials_equipment").select("*").eq("company_id",s).eq("active",!0).order("category").order("name");if(i)throw i;return l}return[]},async getMaterialsEquipmentByCategory(s,l){if(v){const{data:i,error:o}=await _.from("materials_equipment").select("*").eq("company_id",s).eq("category",l).eq("active",!0).order("name");if(o)throw o;return i}return[]},async getAllMaterialsEquipment(s){if(v){const{data:l,error:i}=await _.from("materials_equipment").select("*").eq("company_id",s).order("category").order("name");if(i)throw i;return l}return[]},async createMaterialEquipment(s){if(v){const{data:l,error:i}=await _.from("materials_equipment").insert(s).select().single();if(i)throw i;return l}return null},async updateMaterialEquipment(s,l){if(v){const{data:i,error:o}=await _.from("materials_equipment").update(l).eq("id",s).select().single();if(o)throw o;return i}return null},async deleteMaterialEquipment(s){if(v){const{error:l}=await _.from("materials_equipment").update({active:!1}).eq("id",s);if(l)throw l}},async getLaborCategories(s){if(v){const{data:l,error:i}=await _.from("labor_categories").select("*").eq("company_id",s).eq("active",!0).order("sort_order").order("name");if(i)throw i;return l||[]}return[]},async createLaborCategory(s,l,i=0){if(v){const{data:o,error:d}=await _.from("labor_categories").insert({company_id:s,name:l,sort_order:i}).select().single();if(d)throw d;return o}return null},async updateLaborCategory(s,l){if(v){const{data:i,error:o}=await _.from("labor_categories").update(l).eq("id",s).select().single();if(o)throw o;return i}return null},async deleteLaborCategory(s){if(v){const{error:l}=await _.from("labor_categories").update({active:!1}).eq("id",s);if(l)throw l}},async getLaborClasses(s){if(v){const{data:l,error:i}=await _.from("labor_classes").select(`
          *,
          labor_categories (id, name)
        `).eq("company_id",s).eq("active",!0).order("sort_order").order("name");if(i)throw i;return l||[]}return[]},async getLaborClassesWithCategories(s){if(v){const[l,i]=await Promise.all([_.from("labor_categories").select("*").eq("company_id",s).eq("active",!0).order("sort_order").order("name"),_.from("labor_classes").select("*").eq("company_id",s).eq("active",!0).order("sort_order").order("name")]);if(l.error)throw l.error;if(i.error)throw i.error;return{categories:l.data||[],classes:i.data||[]}}return{categories:[],classes:[]}},async getLaborClassesForField(s){if(v){const{data:l,error:i}=await _.rpc("get_labor_classes_for_field",{p_company_id:s});if(i){console.error("Error loading field labor classes:",i);const[m,p]=await Promise.all([_.from("labor_categories").select("id, name").eq("company_id",s).eq("active",!0).order("name"),_.from("labor_classes").select("id, name, category_id").eq("company_id",s).eq("active",!0).order("name")]);return{categories:m.data||[],classes:p.data||[]}}const o=new Map,d=[];for(const m of l||[])m.category_id&&m.category_name&&!o.has(m.category_id)&&o.set(m.category_id,{id:m.category_id,name:m.category_name}),d.push({id:m.id,name:m.name,category_id:m.category_id});return{categories:Array.from(o.values()),classes:d}}return{categories:[],classes:[]}},async createLaborClass(s,l,i,o=0){if(v){const{data:d,error:m}=await _.from("labor_classes").insert({company_id:s,category_id:l,name:i,sort_order:o}).select().single();if(m)throw m;return d}return null},async updateLaborClass(s,l){if(v){const{data:i,error:o}=await _.from("labor_classes").update(l).eq("id",s).select().single();if(o)throw o;return i}return null},async deleteLaborClass(s){if(v){const{error:l}=await _.from("labor_classes").update({active:!1}).eq("id",s);if(l)throw l}},async getLaborClassRates(s){if(v){const{data:l,error:i}=await _.from("labor_class_rates").select("*").eq("labor_class_id",s);if(i)throw i;return l||[]}return[]},async getAllLaborClassRates(s){if(v){const{data:l,error:i}=await _.from("labor_classes").select(`
          id,
          name,
          labor_class_rates (*)
        `).eq("company_id",s).eq("active",!0);if(i)throw i;return l||[]}return[]},async saveLaborClassRates(s,l){if(v){const i=l.map(d=>({...d,labor_class_id:s})),{error:o}=await _.from("labor_class_rates").upsert(i,{onConflict:"labor_class_id,work_type,job_type"});if(o)throw o}},async getLaborClassRate(s,l,i){if(v){const{data:o,error:d}=await _.from("labor_class_rates").select("regular_rate, overtime_rate").eq("labor_class_id",s).eq("work_type",l).eq("job_type",i).single();if(d&&d.code!=="PGRST116")throw d;return o||null}return null},async getTMTickets(s){if(v){const l=performance.now(),i=ta();try{const{data:o,error:d}=await i.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          `).eq("project_id",s).order("created_at",{ascending:!1}),m=Math.round(performance.now()-l);if(Te.query("getTMTickets",{duration:m,rows:o?.length,project_id:s}),d)throw d;return o}catch(o){throw Te.error("database",{message:o.message,operation:"getTMTickets",project_id:s}),o}}return[]},async getTMTicketsPaginated(s,{page:l=0,limit:i=25,status:o=null}={}){if(v){const d=performance.now(),m=ta();try{let p=m.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          `,{count:"exact"}).eq("project_id",s).order("created_at",{ascending:!1}).range(l*i,(l+1)*i-1);o&&(p=p.eq("status",o));const{data:y,error:b,count:z}=await p,B=Math.round(performance.now()-d);if(Te.query("getTMTicketsPaginated",{duration:B,rows:y?.length,page:l,project_id:s}),b)throw b;return{tickets:y||[],totalCount:z||0,hasMore:(l+1)*i<(z||0),page:l,limit:i}}catch(p){throw Te.error("database",{message:p.message,operation:"getTMTicketsPaginated",project_id:s}),p}}return{tickets:[],totalCount:0,hasMore:!1,page:0,limit:25}},async getChangeOrderTotals(s){if(v){const{data:l,error:i}=await _.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",s).not("ce_pco_number","is",null).neq("ce_pco_number","");if(i)throw i;const o={};let d=0,m=0;return l?.forEach(p=>{const y=p.ce_pco_number;if(o[y]||(o[y]={approved:0,pending:0,count:0}),o[y].count++,p.status==="approved"||p.status==="billed"){const b=parseFloat(p.change_order_value)||0;o[y].approved+=b,d+=b}else p.status==="pending"&&m++}),{changeOrders:o,totalApprovedValue:d,pendingCount:m}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(s,l){if(v){const{data:i,error:o}=await _.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",s).eq("status",l).order("created_at",{ascending:!1});if(o)throw o;return i}return[]},async getCORTickets(s){if(v){const{data:l,error:i}=await _.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",s).order("work_date",{ascending:!0});if(i)throw i;return l||[]}return[]},async createTMTicket(s){if(v){if(!ga()){const o={id:ea(),project_id:s.project_id,work_date:s.work_date,ce_pco_number:s.ce_pco_number||null,assigned_cor_id:s.assigned_cor_id||null,notes:s.notes,photos:s.photos||[],status:"pending_sync",created_by_name:s.created_by_name||"Field User",created_at:new Date().toISOString(),_offline:!0};return await $f(o),await pa(Et.CREATE_TM_TICKET,{ticket:o,workers:s._workers||[],items:s._items||[]}),o}const{data:l,error:i}=await _.from("t_and_m_tickets").insert({project_id:s.project_id,work_date:s.work_date,ce_pco_number:s.ce_pco_number||null,assigned_cor_id:s.assigned_cor_id||null,notes:s.notes,photos:s.photos||[],status:"pending",created_by_name:s.created_by_name||"Field User"}).select().single();if(i){if(i.message?.includes("fetch")||i.message?.includes("network")){const o={id:ea(),...s,status:"pending_sync",_offline:!0};return await $f(o),await pa(Et.CREATE_TM_TICKET,{ticket:o,workers:s._workers||[],items:s._items||[]}),o}throw i}return l}return null},async addTMWorkers(s,l){if(v){const i=l.map(d=>({ticket_id:s,name:d.name,hours:d.hours,overtime_hours:d.overtime_hours||0,time_started:d.time_started||null,time_ended:d.time_ended||null,role:d.role||"Laborer"})),{error:o}=await _.from("t_and_m_workers").insert(i);if(o)throw o}},async addTMItems(s,l){if(v){const i=l.map(d=>({ticket_id:s,material_equipment_id:d.material_equipment_id||null,custom_name:d.custom_name||null,custom_category:d.custom_category||null,quantity:d.quantity})),{error:o}=await _.from("t_and_m_items").insert(i);if(o)throw o}},async getPreviousTicketCrew(s,l){if(!v)return null;const{data:i,error:o}=await _.from("t_and_m_tickets").select(`
        id,
        work_date,
        t_and_m_workers (*)
      `).eq("project_id",s).lt("work_date",l).order("work_date",{ascending:!1}).limit(1).single();if(o||!i)return null;const d=i.t_and_m_workers||[],m=d.filter(b=>["Foreman","General Foreman","Superintendent"].includes(b.role)).map(b=>({name:b.name,hours:b.hours?.toString()||"",overtimeHours:b.overtime_hours?.toString()||"",timeStarted:b.time_started||"",timeEnded:b.time_ended||"",role:b.role})),p=d.filter(b=>b.role==="Operator").map(b=>({name:b.name,hours:b.hours?.toString()||"",overtimeHours:b.overtime_hours?.toString()||"",timeStarted:b.time_started||"",timeEnded:b.time_ended||""})),y=d.filter(b=>b.role==="Laborer").map(b=>({name:b.name,hours:b.hours?.toString()||"",overtimeHours:b.overtime_hours?.toString()||"",timeStarted:b.time_started||"",timeEnded:b.time_ended||""}));return{workDate:i.work_date,supervision:m.length>0?m:null,operators:p.length>0?p:null,laborers:y.length>0?y:null,totalWorkers:d.length}},async updateTMTicketStatus(s,l){if(v){const{data:i,error:o}=await _.from("t_and_m_tickets").update({status:l}).eq("id",s).select().single();if(o)throw o;return i}return null},async approveTMTicket(s,l,i,o=null){if(v){const d={status:"approved",approved_by_user_id:l,approved_by_name:i,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};o!==null&&(d.change_order_value=parseFloat(o)||0);const{data:m,error:p}=await _.from("t_and_m_tickets").update(d).eq("id",s).select().single();if(p)throw p;return m}return null},async rejectTMTicket(s,l,i,o=""){if(v){const{data:d,error:m}=await _.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:l,rejected_by_name:i,rejected_at:new Date().toISOString(),rejection_reason:o,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",s).select().single();if(m)throw m;return d}return null},canApproveTickets(s){return["owner","admin","manager"].includes(s)},async updateTMTicketPhotos(s,l){if(v){const{data:i,error:o}=await _.from("t_and_m_tickets").update({photos:l}).eq("id",s).select().single();if(o)throw o;return i}return null},async saveTMClientSignature(s,l){if(v){const{data:i,error:o}=await _.from("t_and_m_tickets").update({client_signature_data:l.signature,client_signature_name:l.signerName,client_signature_title:l.signerTitle,client_signature_company:l.signerCompany,client_signature_date:l.signedAt,client_signature_ip:null,status:"client_signed"}).eq("id",s).select().single();if(o)throw o;return i}return null},async deleteTMTicket(s){if(v){const{error:l}=await _.from("t_and_m_tickets").delete().eq("id",s);if(l)throw l}},async isTicketEditable(s){if(!s?.assigned_cor_id)return{editable:!0};if(v)try{const{data:l,error:i}=await _.from("change_orders").select("id, status, cor_number").eq("id",s.assigned_cor_id).single();if(i||!l)return{editable:!0};const d=["draft","pending_approval"].includes(l.status);return{editable:d,lockedBy:d?null:l,reason:d?null:`This ticket is linked to ${l.cor_number} which has been ${l.status==="approved"?"approved":l.status}`}}catch(l){return console.error("Error checking ticket editability:",l),{editable:!0}}return{editable:!0}},async getCompanyByCode(s){if(console.log("[Company Lookup] Looking up company by code:",s),v){const{data:l,error:i}=await _.from("companies").select("*").eq("code",s).single();return console.log("[Company Lookup] Result:",{data:l?{id:l.id,name:l.name,code:l.code}:null,error:i}),i?null:l}return null},async getCompany(s){if(v){const{data:l,error:i}=await _.from("companies").select("*").eq("id",s).single();if(i)throw i;return l}return null},async getUserCompanies(s){if(v){const{data:l,error:i}=await _.from("user_companies").select(`
          id,
          access_level,
          company_id,
          status,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",s).eq("status","active").order("created_at",{ascending:!0});return i?(console.error("Error fetching user companies:",i),[]):l.map(o=>({id:o.companies.id,name:o.companies.name,code:o.companies.code,access_level:o.access_level}))}return[]},async getUserPendingMemberships(s){if(v){const{count:l,error:i}=await _.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",s).eq("status","pending");return i?(console.error("Error fetching pending memberships:",i),0):l||0}return 0},async getCompanyMemberships(s){if(v){const{data:l,error:i}=await _.from("user_companies").select(`
          id,
          access_level,
          company_role,
          status,
          created_at,
          approved_at,
          approved_by,
          removed_at,
          removed_by,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",s).order("created_at",{ascending:!1});return i?(console.error("Error fetching company memberships:",i),[]):l||[]}return[]},async approveMembership(s,l){if(v){const{error:i}=await _.from("user_companies").update({status:"active",approved_at:new Date().toISOString(),approved_by:l}).eq("id",s);if(i)throw i}},async approveMembershipWithRole(s,l,i="member"){if(v){const{error:o}=await _.rpc("approve_membership_with_role",{membership_id:s,approved_by_user:l,new_access_level:i});if(o)throw o}},async rejectMembership(s){if(v){const{error:l}=await _.from("user_companies").delete().eq("id",s);if(l)throw l}},async removeMember(s,l){if(v){const{error:i}=await _.from("user_companies").update({status:"removed",removed_at:new Date().toISOString(),removed_by:l}).eq("id",s);if(i)throw i}},async getProjectTeam(s){if(v){const{data:l,error:i}=await _.from("project_users").select(`
          id,
          project_role,
          assigned_at,
          notes,
          users!project_users_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("project_id",s).order("assigned_at",{ascending:!0});return i?(console.error("Error fetching project team:",i),[]):l||[]}return[]},async getCompanyMembers(s){if(v){const{data:l,error:i}=await _.from("user_companies").select(`
          id,
          access_level,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",s).eq("status","active").order("created_at",{ascending:!0});return i?(console.error("Error fetching company members:",i),[]):l||[]}return[]},async addProjectMember(s,l,i,o){if(v){const{data:d,error:m}=await _.from("project_users").insert({project_id:s,user_id:l,project_role:i,assigned_by:o}).select().single();if(m)throw m;return d}return null},async updateProjectMemberRole(s,l,i){if(v){const{error:o}=await _.from("project_users").update({project_role:i}).eq("project_id",s).eq("user_id",l);if(o)throw o}},async removeProjectMember(s,l){if(v){const{error:i}=await _.from("project_users").delete().eq("project_id",s).eq("user_id",l);if(i)throw i}},async updateMemberAccessLevel(s,l){if(v){const{error:i}=await _.from("user_companies").update({access_level:l}).eq("id",s);if(i)throw i}},async updateMemberCompanyRole(s,l){if(v){const{error:i}=await _.from("user_companies").update({company_role:l}).eq("id",s);if(i)throw i}},async repairLegacyUser(s,l,i="member"){if(!v||!s||!l)return!1;try{const{data:o,error:d}=await _.rpc("repair_legacy_user",{p_user_id:s,p_company_id:l,p_role:i});return d?(console.error("RPC repair_legacy_user failed:",d),!1):o===!0}catch(o){return console.error("Error repairing legacy user:",o),!1}},async isLegacyUser(s){if(!v)return!1;try{const{data:l}=await _.from("users").select("company_id, role").eq("id",s).single();if(!l?.company_id)return!1;const{count:i}=await _.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",s);return i===0}catch(l){return console.error("Error checking legacy user:",l),!1}},DISPOSAL_LOAD_TYPES:[{value:"concrete",label:"Concrete"},{value:"trash",label:"Trash"},{value:"metals",label:"Metals"},{value:"hazardous_waste",label:"Hazardous Waste"}],async getDisposalLoads(s,l){if(!v)return[];const i=performance.now();try{const{data:o,error:d}=await _.from("disposal_loads").select("*").eq("project_id",s).eq("work_date",l).order("created_at",{ascending:!1}),m=Math.round(performance.now()-i);if(Te.query("getDisposalLoads",{duration:m,rows:o?.length,project_id:s}),d)throw d;return o||[]}catch(o){throw Te.error("database",{message:o.message,operation:"getDisposalLoads",project_id:s}),o}},async getDisposalLoadsHistory(s,l=14){if(!v)return[];const i=performance.now();try{const o=new Date,d=new Date;d.setDate(d.getDate()-l);const{data:m,error:p}=await _.from("disposal_loads").select("*").eq("project_id",s).gte("work_date",d.toISOString().split("T")[0]).lte("work_date",o.toISOString().split("T")[0]).order("work_date",{ascending:!1}),y=Math.round(performance.now()-i);if(Te.query("getDisposalLoadsHistory",{duration:y,rows:m?.length,project_id:s}),p)throw p;return(m||[]).map(b=>({...b,load_date:b.work_date}))}catch(o){throw Te.error("database",{message:o.message,operation:"getDisposalLoadsHistory",project_id:s}),o}},async addDisposalLoad(s,l,i,o,d,m=null){if(!v)return null;const{data:p,error:y}=await _.from("disposal_loads").insert({project_id:s,user_id:l,work_date:i,load_type:o,load_count:d,notes:m}).select().single();if(y)throw Te.error("database",{message:y.message,operation:"addDisposalLoad",project_id:s}),y;return p},async updateDisposalLoad(s,l,i,o=null){if(!v)return null;const{data:d,error:m}=await _.from("disposal_loads").update({load_type:l,load_count:i,notes:o}).eq("id",s).select().single();if(m)throw Te.error("database",{message:m.message,operation:"updateDisposalLoad"}),m;return d},async deleteDisposalLoad(s){if(!v)return!1;const{error:l}=await _.from("disposal_loads").delete().eq("id",s);if(l)throw Te.error("database",{message:l.message,operation:"deleteDisposalLoad"}),l;return!0},async getDisposalSummary(s,l=null,i=null){if(!v)return[];const o=performance.now();try{const{data:d,error:m}=await _.rpc("get_disposal_summary",{p_project_id:s,p_start_date:l,p_end_date:i}),p=Math.round(performance.now()-o);if(Te.query("getDisposalSummary",{duration:p,rows:d?.length,project_id:s}),m)throw m;return d||[]}catch(d){return Te.error("database",{message:d.message,operation:"getDisposalSummary",project_id:s}),this.getDisposalSummaryFallback(s,l,i)}},async getDisposalSummaryFallback(s,l,i){let o=_.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",s);l&&(o=o.gte("work_date",l)),i&&(o=o.lte("work_date",i));const{data:d,error:m}=await o;if(m)throw m;const p={};return d?.forEach(y=>{p[y.load_type]||(p[y.load_type]={load_type:y.load_type,total_loads:0,days:new Set}),p[y.load_type].total_loads+=y.load_count,p[y.load_type].days.add(y.work_date)}),Object.values(p).map(y=>({load_type:y.load_type,total_loads:y.total_loads,days_with_activity:y.days.size}))},async getWeeklyDisposalSummary(s,l=4){if(!v)return[];const i=new Date,o=new Date;o.setDate(o.getDate()-l*7);const{data:d,error:m}=await _.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",s).gte("work_date",o.toISOString().split("T")[0]).lte("work_date",i.toISOString().split("T")[0]).order("work_date",{ascending:!0});if(m)throw m;const p={};return d?.forEach(y=>{const b=new Date(y.work_date),z=new Date(b);z.setDate(b.getDate()-b.getDay());const B=z.toISOString().split("T")[0];p[B]||(p[B]={week:B,concrete:0,trash:0,metals:0,hazardous_waste:0}),p[B][y.load_type]+=y.load_count}),Object.values(p).sort((y,b)=>y.week.localeCompare(b.week))},async uploadPhoto(s,l,i,o){if(!v)return null;const d=performance.now(),m=o.size||0,p=Date.now(),y=new Uint8Array(6);crypto.getRandomValues(y);const b=Array.from(y,$=>$.toString(36)).join(""),z=o.name?.split(".").pop()||"jpg",B=`${p}-${b}.${z}`,O=`${s}/${l}/${i}/${B}`;try{const{data:$,error:W}=await _.storage.from("tm-photos").upload(O,o,{cacheControl:"3600",upsert:!1}),te=Math.round(performance.now()-d);if(Te.storage("upload",{company_id:s,project_id:l,size:m,duration:te,success:!W}),W)throw W;const{data:V}=_.storage.from("tm-photos").getPublicUrl(O);return V.publicUrl}catch($){throw Te.error("storage",{message:$.message,operation:"uploadPhoto",company_id:s,project_id:l}),$}},async uploadPhotoBase64(s,l,i,o,d="photo.jpg"){if(!v)return null;const p=await(await fetch(o)).blob(),y=Date.now(),b=new Uint8Array(6);crypto.getRandomValues(b);const z=Array.from(b,oe=>oe.toString(36)).join(""),B=d.split(".").pop()||"jpg",O=`${y}-${z}.${B}`,$=`${s}/${l}/${i}/${O}`,{data:W,error:te}=await _.storage.from("tm-photos").upload($,p,{cacheControl:"3600",upsert:!1,contentType:p.type});if(te)throw te;const{data:V}=_.storage.from("tm-photos").getPublicUrl($);return V.publicUrl},async deletePhoto(s){if(!v)return;const i=new URL(s).pathname.match(/\/tm-photos\/(.+)$/);if(!i)return;const o=i[1],{error:d}=await _.storage.from("tm-photos").remove([o]);if(d)throw d},async verifyPhotoAccessible(s){if(!v||!s)return{accessible:!1,error:"Invalid URL"};try{const l=await fetch(s,{method:"HEAD"});return{accessible:l.ok,status:l.status,error:l.ok?null:`HTTP ${l.status}`}}catch(l){return{accessible:!1,error:l.message||"Network error"}}},async verifyTicketPhotos(s){if(!v)return{verified:!1,issues:[]};try{const{data:l,error:i}=await _.from("t_and_m_tickets").select("photos").eq("id",s).single();if(i)throw i;if(!l?.photos||l.photos.length===0)return await _.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:"empty",photos_issue_count:0}).eq("id",s),{verified:!0,status:"empty",issues:[]};const o=[];for(const m of l.photos){const p=await this.verifyPhotoAccessible(m);p.accessible||o.push({url:m,error:p.error})}const d=o.length===0?"verified":"issues";return await _.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:d,photos_issue_count:o.length}).eq("id",s),{verified:o.length===0,status:d,totalPhotos:l.photos.length,issues:o}}catch(l){return console.error("Error verifying ticket photos:",l),{verified:!1,error:l.message,issues:[]}}},async queuePhotoUpload(s,l,i,o){if(!v)return null;const{data:d,error:m}=await _.from("photo_upload_queue").insert({ticket_id:s,temp_id:l,file_name:i,file_size_bytes:o,status:"pending"}).select().single();return m?(console.error("Error queueing photo upload:",m),null):d},async confirmQueuedUpload(s,l,i){if(!v)return!1;const{data:o,error:d}=await _.rpc("confirm_photo_upload",{p_queue_id:s,p_uploaded_url:l,p_storage_path:i});return d?(console.error("Error confirming photo upload:",d),!1):o===!0},async markQueuedUploadFailed(s,l){if(!v)return!1;const{data:i,error:o}=await _.rpc("mark_photo_upload_failed",{p_queue_id:s,p_error:l});return o?(console.error("Error marking photo upload failed:",o),!1):i===!0},async getPendingPhotoUploads(s){if(!v)return[];const{data:l,error:i}=await _.rpc("get_pending_photo_uploads",{p_ticket_id:s});return i?(console.error("Error getting pending photo uploads:",i),[]):l||[]},async logPhotoOperation(s,l,i={}){if(v)try{await _.from("photo_audit_log").insert({ticket_id:s,cor_id:i.corId||null,operation:l,photo_url:i.photoUrl||null,storage_path:i.storagePath||null,details:i.metadata?i.metadata:null,error_message:i.error||null,triggered_by:i.triggeredBy||"system"})}catch(o){console.error("Error logging photo operation:",o)}},async saveExportSnapshot(s,l,i={}){if(!v)return null;const{exportType:o="pdf",exportReason:d=null,clientEmail:m=null,clientName:p=null}=i;try{const{data:y,error:b}=await _.from("cor_export_snapshots").insert({cor_id:s,export_type:o,export_reason:d,cor_data:l.cor_data,tickets_data:l.tickets_data,photos_manifest:l.photos_manifest,totals_snapshot:l.totals_snapshot,checksum:l.checksum,client_email:m,client_name:p}).select().single();if(b)throw b;return y}catch(y){return console.error("Error saving export snapshot:",y),null}},async getExportSnapshots(s){if(!v)return[];const{data:l,error:i}=await _.from("cor_export_snapshots").select("id, exported_at, export_type, export_reason, client_name, client_email, checksum").eq("cor_id",s).order("exported_at",{ascending:!1});return i?(console.error("Error fetching export snapshots:",i),[]):l||[]},async getExportSnapshot(s){if(!v)return null;const{data:l,error:i}=await _.from("cor_export_snapshots").select("*").eq("id",s).single();return i?(console.error("Error fetching export snapshot:",i),null):l},async requestCORExport(s,l,i={}){if(!v)return null;try{const o=await _.auth.getUser(),{data:d,error:m}=await _.rpc("request_cor_export",{p_cor_id:s,p_idempotency_key:l,p_options:i,p_requested_by:o?.data?.user?.id||null});if(m)throw m;return d?.[0]||null}catch(o){throw Te.error("database",{message:o.message,operation:"requestCORExport",extra:{corId:s}}),o}},async getExportJob(s){if(!v)return null;const{data:l,error:i}=await _.from("cor_export_jobs").select("*").eq("id",s).single();return i?(console.error("Error fetching export job:",i),null):l},async getExportJobs(s,l=10){if(!v)return[];const{data:i,error:o}=await _.from("cor_export_jobs").select("*").eq("cor_id",s).order("created_at",{ascending:!1}).limit(l);return o?(console.error("Error fetching export jobs:",o),[]):i||[]},async updateExportJobStatus(s,l,i={}){if(!v)return null;try{const{data:o,error:d}=await _.rpc("update_export_job_status",{p_job_id:s,p_status:l,p_snapshot_id:i.snapshotId||null,p_pdf_url:i.pdfUrl||null,p_error:i.error||null,p_error_details:i.errorDetails||null,p_metrics:i.metrics||null});if(d)throw d;return o}catch(o){throw Te.error("database",{message:o.message,operation:"updateExportJobStatus",extra:{jobId:s,status:l}}),o}},async getCurrentCORSnapshot(s){if(!v)return null;const{data:l}=await _.from("change_orders").select("version, last_snapshot_version").eq("id",s).single();if(!l||l.version!==l.last_snapshot_version)return null;const{data:i}=await _.from("cor_export_snapshots").select("*").eq("cor_id",s).eq("is_current",!0).single();return i||null},async saveCORSnapshot(s,l){if(!v)return null;try{await _.from("cor_export_snapshots").update({is_current:!1}).eq("cor_id",s.corId);const i=await _.auth.getUser(),{data:o,error:d}=await _.from("cor_export_snapshots").insert({id:s.snapshotId,cor_id:s.corId,job_id:l,cor_version:s.corVersion,cor_data:s.corData,tickets_data:s.ticketsData,photos_manifest:s.photoManifest,totals_snapshot:s.totals,checksum:s.checksum,is_current:!0,exported_by:i?.data?.user?.id||null}).select().single();if(d)throw d;return await _.from("change_orders").update({last_snapshot_version:s.corVersion}).eq("id",s.corId),o}catch(i){throw Te.error("database",{message:i.message,operation:"saveCORSnapshot",extra:{corId:s.corId}}),i}},async updateCORAggregatedStats(s){if(v)try{await _.rpc("update_cor_aggregated_stats",{p_cor_id:s})}catch(l){console.error("Error updating COR aggregated stats:",l)}},async getCrewCheckin(s,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],o=ta(),{data:d,error:m}=await o.from("crew_checkins").select("*").eq("project_id",s).eq("check_in_date",i).single();return m&&m.code,d},async saveCrewCheckin(s,l,i=null,o=null){if(!v)return null;const d=o||new Date().toISOString().split("T")[0];if(!ga()){const b={id:ea(),project_id:s,check_in_date:d,workers:l,created_by:i,updated_at:new Date().toISOString(),_offline:!0};return await Rc(b),await pa(Et.SAVE_CREW_CHECKIN,{projectId:s,workers:l,checkInDate:d}),b}const m=ta(),{data:p,error:y}=await m.from("crew_checkins").upsert({project_id:s,check_in_date:d,workers:l,created_by:i,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(y){if(y.message?.includes("fetch")||y.message?.includes("network")){const b={id:ea(),project_id:s,check_in_date:d,workers:l,_offline:!0};return await Rc(b),await pa(Et.SAVE_CREW_CHECKIN,{projectId:s,workers:l,checkInDate:d}),b}throw console.error("Error saving crew checkin:",y),y}return p&&Rc(p).catch(b=>console.error("Failed to cache checkin:",b)),p},async addCrewMember(s,l,i=null){if(!v)return null;const o=await this.getCrewCheckin(s),d=o?.workers||[];return d.find(m=>m.name.toLowerCase()===l.name.toLowerCase())?o:(d.push(l),await this.saveCrewCheckin(s,d,i))},async removeCrewMember(s,l){if(!v)return null;const i=await this.getCrewCheckin(s);if(!i)return null;const o=i.workers.filter(d=>d.name.toLowerCase()!==l.toLowerCase());return await this.saveCrewCheckin(s,o,i.created_by)},async getCrewCheckinHistory(s,l=30){if(!v)return[];const{data:i,error:o}=await _.from("crew_checkins").select("*").eq("project_id",s).order("check_in_date",{ascending:!1}).limit(l);return o?(console.error("Error fetching crew history:",o),[]):i||[]},async getLaborRates(s,l=null,i=null){if(!v)return[];let o=_.from("labor_rates").select("*").eq("company_id",s);l&&(o=o.eq("work_type",l)),i&&(o=o.eq("job_type",i));const{data:d,error:m}=await o;return m?(console.error("Error fetching labor rates:",m),[]):d||[]},async calculateManDayCosts(s,l,i,o){if(!v)return{totalCost:0,totalManDays:0,breakdown:[]};const d=await this.getCrewCheckinHistory(s,365),m=await this.getLaborRates(l,i,o),p={};m.forEach(O=>{p[O.role.toLowerCase()]=parseFloat(O.regular_rate)||0});let y=0,b=0;const z={},B=[];return d.forEach(O=>{const $=O.workers||[];let W=0;const te={};$.forEach(V=>{const oe=(V.role||"laborer").toLowerCase(),ae=p[oe]||0;te[oe]||(te[oe]={count:0,cost:0}),te[oe].count++,te[oe].cost+=ae,W+=ae,z[oe]||(z[oe]={count:0,cost:0,rate:ae}),z[oe].count++,z[oe].cost+=ae}),y+=W,b+=$.length,B.push({date:O.check_in_date,workers:$.length,cost:W,breakdown:te})}),{totalCost:y,totalManDays:b,byRole:z,byDate:B,daysWorked:d.length}},async getDailyReport(s,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],o=ta(),{data:d,error:m}=await o.from("daily_reports").select("*").eq("project_id",s).eq("report_date",i).single();return m&&m.code,d},async compileDailyReport(s,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],o=ta(),d=await this.getCrewCheckin(s,i),{data:m}=await o.from("areas").select("*").eq("project_id",s),p=m?.filter(z=>z.status==="done"&&z.completed_at?.startsWith(i))||[],{data:y}=await o.from("t_and_m_tickets").select("*").eq("project_id",s).eq("work_date",i),b=y?.reduce((z,B)=>z+(B.photos?.length||0),0)||0;return{crew_count:d?.workers?.length||0,crew_list:d?.workers||[],tasks_completed:p.length,tasks_total:m?.length||0,completed_tasks:p.map(z=>({name:z.name,group:z.group_name})),tm_tickets_count:y?.length||0,photos_count:b}},async saveDailyReport(s,l,i=null){if(!v)return null;const o=i||new Date().toISOString().split("T")[0];if(!ga()){const y={id:ea(),project_id:s,report_date:o,...l,updated_at:new Date().toISOString(),_offline:!0};return await es(y),y}const d=ta(),{data:m,error:p}=await d.from("daily_reports").upsert({project_id:s,report_date:o,...l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(p){if(p.message?.includes("fetch")||p.message?.includes("network")){const y={id:ea(),project_id:s,report_date:o,...l,_offline:!0};return await es(y),y}throw console.error("Error saving daily report:",p),p}return m&&es(m).catch(y=>console.error("Failed to cache report:",y)),m},async submitDailyReport(s,l,i=null){if(!v)return null;const o=i||new Date().toISOString().split("T")[0];if(!ga()){const y=await Xg(s,o),b={id:ea(),project_id:s,report_date:o,...y||{},status:"pending_sync",submitted_by:l,submitted_at:new Date().toISOString(),_offline:!0};return await es(b),await pa(Et.SUBMIT_DAILY_REPORT,{projectId:s,reportData:y||{},submittedBy:l}),b}const d=await this.compileDailyReport(s,o),{data:m,error:p}=await _.from("daily_reports").upsert({project_id:s,report_date:o,...d,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(p){if(p.message?.includes("fetch")||p.message?.includes("network")){const y={id:ea(),project_id:s,report_date:o,...d,status:"pending_sync",submitted_by:l,_offline:!0};return await es(y),await pa(Et.SUBMIT_DAILY_REPORT,{projectId:s,reportData:d,submittedBy:l}),y}throw console.error("Error submitting daily report:",p),p}return m&&es(m).catch(y=>console.error("Failed to cache report:",y)),m},async getDailyReports(s,l=30){if(!v)return[];const{data:i,error:o}=await _.from("daily_reports").select("*").eq("project_id",s).order("report_date",{ascending:!1}).limit(l);return o?(console.error("Error fetching daily reports:",o),[]):i||[]},async sendMessage(s,l,i,o,d=null,m=null,p="general",y=null){if(!v)return null;if(!ga()){const B={id:ea(),project_id:s,sender_type:i,sender_name:o,sender_user_id:d,message:l,photo_url:m,message_type:p,parent_message_id:y,created_at:new Date().toISOString(),_offline:!0};return await Wf(B),await pa(Et.SEND_MESSAGE,{projectId:s,senderType:i,senderName:o,content:l}),B}const{data:b,error:z}=await _.from("messages").insert({project_id:s,sender_type:i,sender_name:o,sender_user_id:d,message:l,photo_url:m,message_type:p,parent_message_id:y}).select().single();if(z){if(z.message?.includes("fetch")||z.message?.includes("network")){const B={id:ea(),project_id:s,sender_type:i,sender_name:o,message:l,created_at:new Date().toISOString(),_offline:!0};return await Wf(B),await pa(Et.SEND_MESSAGE,{projectId:s,senderType:i,senderName:o,content:l}),B}throw console.error("Error sending message:",z),z}return b},async getMessages(s,l=50){if(!v)return[];const i=ta(),{data:o,error:d}=await i.from("messages").select("*").eq("project_id",s).order("created_at",{ascending:!1}).limit(l);return d?[]:o||[]},async getUnreadCount(s,l){if(!v)return 0;const i=ta(),o=l==="field"?"office":"field",{count:d,error:m}=await i.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",s).eq("sender_type",o).eq("is_read",!1);return m?0:d||0},async markMessagesRead(s,l){if(!v)return;const i=ta(),o=l==="field"?"office":"field";await i.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",s).eq("sender_type",o).eq("is_read",!1)},async createMaterialRequest(s,l,i,o=null,d="normal",m=null){if(!v)return null;if(!ga()){const b={id:ea(),project_id:s,items:l,requested_by:i,needed_by:o,priority:d,notes:m,status:"pending_sync",created_at:new Date().toISOString(),_offline:!0};return await pa(Et.CREATE_MATERIAL_REQUEST,{projectId:s,items:l,requestedBy:i,neededBy:o,priority:d,notes:m}),b}const{data:p,error:y}=await _.from("material_requests").insert({project_id:s,items:l,requested_by:i,needed_by:o,priority:d,notes:m}).select().single();if(y){if(y.message?.includes("fetch")||y.message?.includes("network")){const b={id:ea(),project_id:s,items:l,requested_by:i,status:"pending_sync",_offline:!0};return await pa(Et.CREATE_MATERIAL_REQUEST,{projectId:s,items:l,requestedBy:i,neededBy:o,priority:d,notes:m}),b}throw console.error("Error creating material request:",y),y}return p},async getMaterialRequests(s,l=null){if(!v)return[];let i=_.from("material_requests").select("*").eq("project_id",s).order("created_at",{ascending:!1});l&&(i=i.eq("status",l));const{data:o,error:d}=await i;return d?(console.error("Error fetching material requests:",d),[]):o||[]},async getPendingRequestsCount(s){if(!v)return 0;const{count:l,error:i}=await _.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",s).eq("status","pending");return i?0:l||0},async updateMaterialRequest(s,l,i,o=null,d=null){if(!v)return null;const m={status:l,responded_by:i,responded_at:new Date().toISOString(),response_notes:o,updated_at:new Date().toISOString()};d&&(m.expected_delivery=d),l==="delivered"&&(m.delivered_at=new Date().toISOString());const{data:p,error:y}=await _.from("material_requests").update(m).eq("id",s).select().single();if(y)throw console.error("Error updating material request:",y),y;return p},generateShareToken(){const s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",l=new Uint8Array(12);return crypto.getRandomValues(l),Array.from(l,i=>s[i%s.length]).join("")},async createProjectShare(s,l,i,o=null){if(!v){const b=re();b.projectShares||(b.projectShares=[]);const z={id:crypto.randomUUID(),project_id:s,share_token:this.generateShareToken(),created_by:l,expires_at:o,is_active:!0,permissions:i,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return b.projectShares.push(z),De(b),z}const{data:d,error:m}=await _.rpc("generate_share_token");if(m)throw console.error("Error generating share token:",m),m;const{data:p,error:y}=await _.from("project_shares").insert({project_id:s,share_token:d,created_by:l,expires_at:o,permissions:i}).select().single();if(y)throw console.error("Error creating project share:",y),y;return p},async getShareByToken(s){if(!v){const o=re();if(!o.projectShares)return null;const d=o.projectShares.find(m=>m.share_token===s&&m.is_active&&(!m.expires_at||new Date(m.expires_at)>new Date));return d&&(d.view_count++,d.last_viewed_at=new Date().toISOString(),De(o)),d}const{data:l,error:i}=await _.from("project_shares").select("*, projects(*)").eq("share_token",s).eq("is_active",!0).single();return i?(console.error("Error fetching share by token:",i),null):l.expires_at&&new Date(l.expires_at)<new Date?null:(await _.rpc("increment_share_view_count",{token:s}),l)},async getProjectShares(s){if(!v){const o=re();return o.projectShares?o.projectShares.filter(d=>d.project_id===s):[]}const{data:l,error:i}=await _.from("project_shares").select("*, users(name, email)").eq("project_id",s).order("created_at",{ascending:!1});return i?(console.error("Error fetching project shares:",i),[]):l||[]},async updateProjectShare(s,l){if(!v){const d=re();if(!d.projectShares)return null;const m=d.projectShares.findIndex(p=>p.id===s);return m===-1?null:(d.projectShares[m]={...d.projectShares[m],...l,updated_at:new Date().toISOString()},De(d),d.projectShares[m])}const{data:i,error:o}=await _.from("project_shares").update(l).eq("id",s).select().single();if(o)throw console.error("Error updating project share:",o),o;return i},async revokeProjectShare(s){return this.updateProjectShare(s,{is_active:!1})},async deleteProjectShare(s){if(!v){const i=re();if(!i.projectShares)return;i.projectShares=i.projectShares.filter(o=>o.id!==s),De(i);return}const{error:l}=await _.from("project_shares").delete().eq("id",s);if(l)throw console.error("Error deleting project share:",l),l},async getPublicProjectData(s){const l=await this.getShareByToken(s);if(!l)return null;const i=l.project_id||l.projects?.id;if(!v){const m=re(),p=m.projects.find(O=>O.id===i);if(!p)return null;const y=m.areas.filter(O=>O.project_id===i),b=y.reduce((O,$)=>O+parseFloat($.weight||0),0),z=y.filter(O=>O.status==="done").reduce((O,$)=>O+parseFloat($.weight||0),0),B=b>0?Math.round(z/b*100):0;return{share:l,project:p,progress:B,areas:l.permissions.progress?y:[],photos:[],dailyReports:[],tmTickets:[]}}const o=l.projects||await this.getProject(i);if(!o)return null;const d={share:l,project:o,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(l.permissions.progress){d.areas=await this.getAreas(i);const m=d.areas.reduce((y,b)=>y+parseFloat(b.weight||0),0),p=d.areas.filter(y=>y.status==="done").reduce((y,b)=>y+parseFloat(b.weight||0),0);d.progress=m>0?Math.round(p/m*100):0}if(l.permissions.photos){const{data:m}=await _.from("t_and_m_tickets").select("photos, work_date").eq("project_id",i).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);d.photos=m?.flatMap(p=>(p.photos||[]).map(y=>({url:y,date:p.work_date})))||[]}if(l.permissions.daily_reports){const{data:m}=await _.from("daily_reports").select("*").eq("project_id",i).order("report_date",{ascending:!1}).limit(10);d.dailyReports=m||[]}return l.permissions.tm_tickets&&(d.tmTickets=await this.getTMTickets(i)),d},async createInjuryReport(s){if(!v){const o=re();o.injuryReports||(o.injuryReports=[]);const d={id:crypto.randomUUID(),...s,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return o.injuryReports.push(d),De(o),d}const{data:l,error:i}=await _.from("injury_reports").insert(s).select().single();if(i)throw console.error("Error creating injury report:",i),i;return l},async getInjuryReports(s){if(!v){const o=re();return o.injuryReports?o.injuryReports.filter(d=>d.project_id===s).sort((d,m)=>new Date(m.incident_date)-new Date(d.incident_date)):[]}const{data:l,error:i}=await _.from("injury_reports").select("*").eq("project_id",s).order("incident_date",{ascending:!1});return i?(console.error("Error fetching injury reports:",i),[]):l||[]},async getCompanyInjuryReports(s,l=null){if(!v){const m=re();if(!m.injuryReports)return[];let p=m.injuryReports.filter(y=>y.company_id===s);return l&&(p=p.filter(y=>y.status===l)),p.sort((y,b)=>new Date(b.incident_date)-new Date(y.incident_date))}let i=_.from("injury_reports").select("*, projects(name)").eq("company_id",s).order("incident_date",{ascending:!1});l&&(i=i.eq("status",l));const{data:o,error:d}=await i;return d?(console.error("Error fetching company injury reports:",d),[]):o||[]},async getInjuryReport(s){if(!v){const o=re();return o.injuryReports?o.injuryReports.find(d=>d.id===s):null}const{data:l,error:i}=await _.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",s).single();return i?(console.error("Error fetching injury report:",i),null):l},async updateInjuryReport(s,l){if(!v){const d=re();if(!d.injuryReports)return null;const m=d.injuryReports.findIndex(p=>p.id===s);return m===-1?null:(d.injuryReports[m]={...d.injuryReports[m],...l,updated_at:new Date().toISOString()},De(d),d.injuryReports[m])}const{data:i,error:o}=await _.from("injury_reports").update(l).eq("id",s).select().single();if(o)throw console.error("Error updating injury report:",o),o;return i},async closeInjuryReport(s,l){return this.updateInjuryReport(s,{status:"closed",closed_at:new Date().toISOString(),closed_by:l})},async deleteInjuryReport(s){if(!v){const i=re();if(!i.injuryReports)return;i.injuryReports=i.injuryReports.filter(o=>o.id!==s),De(i);return}const{error:l}=await _.from("injury_reports").delete().eq("id",s);if(l)throw console.error("Error deleting injury report:",l),l},async getInjuryStatistics(s,l=null,i=null){if(!v){const m=re();if(!m.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let p=m.injuryReports.filter(y=>y.company_id===s);return l&&(p=p.filter(y=>new Date(y.incident_date)>=new Date(l))),i&&(p=p.filter(y=>new Date(y.incident_date)<=new Date(i))),{total_incidents:p.length,minor_injuries:p.filter(y=>y.injury_type==="minor").length,serious_injuries:p.filter(y=>y.injury_type==="serious").length,critical_injuries:p.filter(y=>y.injury_type==="critical").length,near_misses:p.filter(y=>y.injury_type==="near_miss").length,osha_recordable:p.filter(y=>y.osha_recordable).length,total_days_away:p.reduce((y,b)=>y+(b.days_away_from_work||0),0),total_restricted_days:p.reduce((y,b)=>y+(b.restricted_work_days||0),0)}}const{data:o,error:d}=await _.rpc("get_injury_statistics",{comp_id:s,start_date:l,end_date:i});return d?(console.error("Error fetching injury statistics:",d),null):o[0]||null},async addWitness(s,l){if(!v){const d=re();if(!d.injuryReports)return null;const m=d.injuryReports.findIndex(b=>b.id===s);if(m===-1)return null;const p=d.injuryReports[m],y=p.witnesses||[];return y.push(l),d.injuryReports[m]={...p,witnesses:y,updated_at:new Date().toISOString()},De(d),d.injuryReports[m]}const i=await this.getInjuryReport(s);if(!i)return null;const o=i.witnesses||[];return o.push(l),this.updateInjuryReport(s,{witnesses:o})},async removeWitness(s,l){if(!v){const d=re();if(!d.injuryReports)return null;const m=d.injuryReports.findIndex(b=>b.id===s);if(m===-1)return null;const p=d.injuryReports[m],y=p.witnesses||[];return y.splice(l,1),d.injuryReports[m]={...p,witnesses:y,updated_at:new Date().toISOString()},De(d),d.injuryReports[m]}const i=await this.getInjuryReport(s);if(!i)return null;const o=i.witnesses||[];return o.splice(l,1),this.updateInjuryReport(s,{witnesses:o})},async getCompanyUsers(s){if(v){const{data:l,error:i}=await _.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",s);return i?(console.error("Error fetching company users:",i),[]):l?.map(o=>({id:o.user_id,name:o.users?.name||o.users?.email,email:o.users?.email,role:o.role}))||[]}return[]},async getProjectNotificationPreferences(s){if(v){const{data:i,error:o}=await _.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",s);return o?(console.error("Error fetching notification preferences:",o),[]):i||[]}const l=re();return l.notificationPreferences?l.notificationPreferences.filter(i=>i.project_id===s):[]},async getUserNotificationPreferences(s){if(v){const{data:i,error:o}=await _.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",s);return o?(console.error("Error fetching user notification preferences:",o),[]):i||[]}const l=re();return l.notificationPreferences?l.notificationPreferences.filter(i=>i.user_id===s):[]},async setNotificationPreference(s,l,i){if(v){const{data:p,error:y}=await _.from("notification_preferences").upsert({project_id:s,user_id:l,notification_types:i,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(y)throw console.error("Error setting notification preference:",y),y;return p}const o=re();o.notificationPreferences||(o.notificationPreferences=[]);const d=o.notificationPreferences.findIndex(p=>p.project_id===s&&p.user_id===l),m={id:d>=0?o.notificationPreferences[d].id:crypto.randomUUID(),project_id:s,user_id:l,notification_types:i,created_at:d>=0?o.notificationPreferences[d].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return d>=0?o.notificationPreferences[d]=m:o.notificationPreferences.push(m),De(o),m},async removeNotificationPreference(s,l){if(v){const{error:o}=await _.from("notification_preferences").delete().eq("project_id",s).eq("user_id",l);if(o)throw console.error("Error removing notification preference:",o),o;return!0}const i=re();return i.notificationPreferences&&(i.notificationPreferences=i.notificationPreferences.filter(o=>!(o.project_id===s&&o.user_id===l)),De(i)),!0},async setProjectNotificationPreferences(s,l){const i=[];for(const o of l)if(o.notificationTypes&&o.notificationTypes.length>0){const d=await this.setNotificationPreference(s,o.userId,o.notificationTypes);i.push(d)}else await this.removeNotificationPreference(s,o.userId);return i},async getNotificationPresets(s){if(v){const{data:i,error:o}=await _.from("notification_presets").select("*").eq("company_id",s).order("name");return o?(console.error("Error fetching notification presets:",o),[]):i||[]}const l=re();return l.notificationPresets?l.notificationPresets.filter(i=>i.company_id===s):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:s},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:s},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:s},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:s}]},async createNotificationPreset(s,l,i){if(v){const{data:m,error:p}=await _.from("notification_presets").insert({company_id:s,name:l,notification_types:i}).select().single();if(p)throw console.error("Error creating notification preset:",p),p;return m}const o=re();o.notificationPresets||(o.notificationPresets=[]);const d={id:crypto.randomUUID(),company_id:s,name:l,notification_types:i,created_at:new Date().toISOString()};return o.notificationPresets.push(d),De(o),d},async updateNotificationPreset(s,l,i){if(v){const{data:m,error:p}=await _.from("notification_presets").update({name:l,notification_types:i,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(p)throw console.error("Error updating notification preset:",p),p;return m}const o=re();if(!o.notificationPresets)return null;const d=o.notificationPresets.findIndex(m=>m.id===s);return d===-1?null:(o.notificationPresets[d]={...o.notificationPresets[d],name:l,notification_types:i,updated_at:new Date().toISOString()},De(o),o.notificationPresets[d])},async deleteNotificationPreset(s){if(v){const{error:i}=await _.from("notification_presets").delete().eq("id",s);if(i)throw console.error("Error deleting notification preset:",i),i;return!0}const l=re();return l.notificationPresets&&(l.notificationPresets=l.notificationPresets.filter(i=>i.id!==s),De(l)),!0},async getDumpSites(s){if(v){const{data:i,error:o}=await _.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",s).eq("active",!0).order("name");return o?(console.error("Error fetching dump sites:",o),[]):i||[]}return(re().dumpSites||[]).filter(i=>i.company_id===s&&i.active)},async createDumpSite(s,l,i="",o=""){if(v){const{data:p,error:y}=await _.from("dump_sites").insert({company_id:s,name:l,address:i,notes:o,active:!0}).select().single();if(y)throw console.error("Error creating dump site:",y),y;return p}const d=re();d.dumpSites||(d.dumpSites=[]);const m={id:crypto.randomUUID(),company_id:s,name:l,address:i,notes:o,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return d.dumpSites.push(m),De(d),m},async updateDumpSite(s,l){if(v){const{data:d,error:m}=await _.from("dump_sites").update({...l,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(m)throw console.error("Error updating dump site:",m),m;return d}const i=re();if(!i.dumpSites)return null;const o=i.dumpSites.findIndex(d=>d.id===s);return o===-1?null:(i.dumpSites[o]={...i.dumpSites[o],...l},De(i),i.dumpSites[o])},async deleteDumpSite(s){return this.updateDumpSite(s,{active:!1})},async setDumpSiteRate(s,l,i,o="load"){if(v){const{data:y}=await _.from("dump_site_rates").select("id").eq("dump_site_id",s).eq("waste_type",l).maybeSingle();if(y){const{data:b,error:z}=await _.from("dump_site_rates").update({estimated_cost_per_load:i,unit:o}).eq("id",y.id).select().single();if(z)throw console.error("Error updating dump site rate:",z),z;return b}else{const{data:b,error:z}=await _.from("dump_site_rates").insert({dump_site_id:s,waste_type:l,estimated_cost_per_load:i,unit:o}).select().single();if(z)throw console.error("Error inserting dump site rate:",z),z;return b}}const d=re();d.dumpSiteRates||(d.dumpSiteRates=[]);const m=d.dumpSiteRates.findIndex(y=>y.dump_site_id===s&&y.waste_type===l),p={id:m>=0?d.dumpSiteRates[m].id:crypto.randomUUID(),dump_site_id:s,waste_type:l,estimated_cost_per_load:i,unit:o,created_at:new Date().toISOString()};return m>=0?d.dumpSiteRates[m]=p:d.dumpSiteRates.push(p),De(d),p},async getDumpSiteRates(s){if(v){const{data:i,error:o}=await _.from("dump_site_rates").select("*").eq("dump_site_id",s);return o?(console.error("Error fetching dump site rates:",o),[]):i||[]}return(re().dumpSiteRates||[]).filter(i=>i.dump_site_id===s)},async getHaulOffs(s){if(v){const{data:i,error:o}=await _.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",s).order("work_date",{ascending:!1});return o?(console.error("Error fetching haul-offs:",o),[]):i||[]}return(re().haulOffs||[]).filter(i=>i.project_id===s).sort((i,o)=>new Date(o.work_date)-new Date(i.work_date))},async createHaulOff(s,l){const i={project_id:s,dump_site_id:l.dumpSiteId,waste_type:l.wasteType,loads:l.loads,hauling_company:l.haulingCompany||"",work_date:l.workDate,notes:l.notes||"",estimated_cost:l.estimatedCost||0,created_by:l.createdBy||""};if(v){const{data:m,error:p}=await _.from("haul_offs").insert(i).select().single();if(p)throw console.error("Error creating haul-off:",p),p;return m}const o=re();o.haulOffs||(o.haulOffs=[]);const d={...i,id:crypto.randomUUID(),created_at:new Date().toISOString()};return o.haulOffs.push(d),De(o),d},async calculateHaulOffCosts(s){const l=await this.getHaulOffs(s);let i=0,o=0;const d={},m=[],p={};l.forEach(b=>{const z=parseFloat(b.estimated_cost)||0,B=parseInt(b.loads)||0;i+=z,o+=B,d[b.waste_type]||(d[b.waste_type]={loads:0,cost:0}),d[b.waste_type].loads+=B,d[b.waste_type].cost+=z,p[b.work_date]||(p[b.work_date]={date:b.work_date,loads:0,cost:0}),p[b.work_date].loads+=B,p[b.work_date].cost+=z}),Object.values(p).sort((b,z)=>new Date(z.date)-new Date(b.date)).forEach(b=>m.push(b));const y=m.length;return{totalCost:i,totalLoads:o,byWasteType:d,byDate:m,daysWithHaulOff:y,avgDailyHaulOffCost:y>0?i/y:0}},subscribeToHaulOffs(s,l){return v?_.channel(`haul_offs:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${s}`},l).subscribe():null},async createCOR(s,l=0){if(v){let i=s.cor_number;l>0&&(i=await this.getNextCORNumber(s.project_id));const{data:o,error:d}=await _.from("change_orders").insert({company_id:s.company_id,project_id:s.project_id,area_id:s.area_id||null,cor_number:i,title:s.title,description:s.description||"",scope_of_work:s.scope_of_work,period_start:s.period_start,period_end:s.period_end,status:"draft",labor_markup_percent:s.labor_markup_percent??1500,materials_markup_percent:s.materials_markup_percent??1500,equipment_markup_percent:s.equipment_markup_percent??1500,subcontractors_markup_percent:s.subcontractors_markup_percent??500,liability_insurance_percent:s.liability_insurance_percent??144,bond_percent:s.bond_percent??100,license_fee_percent:s.license_fee_percent??10,created_by:s.created_by||null}).select().single();if((d?.code==="23505"||d?.code==="PGRST116"||d?.status===409||d?.message?.includes("duplicate")||d?.message?.includes("unique_cor_number"))&&l<3)return console.warn(`COR number conflict, retrying with fresh number (attempt ${l+1})`),this.createCOR(s,l+1);if(d)throw d;return o}return null},async updateCOR(s,l){if(v){const{data:i,error:o}=await _.from("change_orders").update({...l,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(o)throw o;return i}return null},async deleteCOR(s){if(v){const{error:l}=await _.from("change_orders").delete().eq("id",s);if(l)throw l}},async bulkUpdateCORGroup(s,l){if(v){const{error:i}=await _.from("change_orders").update({group_name:l,updated_at:new Date().toISOString()}).in("id",s);if(i)throw i.message?.includes("group_name")||i.code==="PGRST204"?new Error("COR grouping requires a database migration. Please run database/migration_cor_enhancements.sql in Supabase SQL Editor."):i}},async getCORs(s,l={}){if(v){let i=_.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",s);l.status&&(i=i.eq("status",l.status)),l.area_id&&(i=i.eq("area_id",l.area_id)),l.date_start&&(i=i.gte("period_start",l.date_start)),l.date_end&&(i=i.lte("period_end",l.date_end)),i=i.order("created_at",{ascending:!1});const{data:o,error:d}=await i;if(d)throw d;return o}return[]},async getCORById(s){if(v){const{data:l,error:i}=await _.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              *,
              t_and_m_workers (*),
              t_and_m_items (
                *,
                materials_equipment (name, unit, cost_per_unit, category)
              )
            )
          )
        `).eq("id",s).single();if(i)throw i;return l}return null},async getCORsByArea(s,l){if(v){const{data:i,error:o}=await _.from("change_orders").select("*").eq("project_id",s).eq("area_id",l).order("created_at",{ascending:!1});if(o)throw o;return i}return[]},async getAssignableCORs(s){if(v){const{data:l,error:i}=await _.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",s).in("status",["draft","pending_approval","approved"]).order("cor_number",{ascending:!0});if(i)throw i;return l||[]}return[]},async getNextCORNumber(s){if(v){const{data:l,error:i}=await _.from("change_orders").select("cor_number").eq("project_id",s);if(i)throw i;if(l&&l.length>0){let o=0;for(const d of l){const m=d.cor_number?.match(/COR #(\d+)/);if(m){const p=parseInt(m[1]);p>o&&(o=p)}}return`COR #${o+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(s,l){if(v){const i=Math.round(l.regular_hours*l.regular_rate),o=Math.round(l.overtime_hours*l.overtime_rate),d=i+o,{data:m,error:p}=await _.from("change_order_labor").insert({change_order_id:s,labor_class:l.labor_class,wage_type:l.wage_type||"standard",regular_hours:l.regular_hours||0,overtime_hours:l.overtime_hours||0,regular_rate:l.regular_rate||0,overtime_rate:l.overtime_rate||0,regular_total:i,overtime_total:o,total:d,sort_order:l.sort_order||0,source_ticket_id:l.source_ticket_id||null}).select().single();if(p)throw p;return m}return null},async updateCORLaborItem(s,l){if(v){let i={...l};if(l.regular_hours!==void 0||l.regular_rate!==void 0||l.overtime_hours!==void 0||l.overtime_rate!==void 0){const{data:m}=await _.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",s).single(),p=l.regular_hours??m?.regular_hours??0,y=l.overtime_hours??m?.overtime_hours??0,b=l.regular_rate??m?.regular_rate??0,z=l.overtime_rate??m?.overtime_rate??0;i.regular_total=Math.round(p*b),i.overtime_total=Math.round(y*z),i.total=i.regular_total+i.overtime_total}const{data:o,error:d}=await _.from("change_order_labor").update(i).eq("id",s).select().single();if(d)throw d;return o}return null},async deleteCORLaborItem(s){if(v){const{error:l}=await _.from("change_order_labor").delete().eq("id",s);if(l)throw l}},async addCORMaterialItem(s,l){if(v){const o=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",d=Math.round(Number(l.unit_cost)||0),m=Number(l.quantity)||1,p=Math.round(m*d),{data:y,error:b}=await _.from("change_order_materials").insert({change_order_id:s,description:l.description||"",quantity:m,unit:l.unit||"each",unit_cost:d,total:p,source_type:o,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(b)throw b;return y}return null},async updateCORMaterialItem(s,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await _.from("change_order_materials").select("quantity, unit_cost").eq("id",s).single(),p=l.quantity??m?.quantity??1,y=l.unit_cost??m?.unit_cost??0;i.total=Math.round(p*y)}const{data:o,error:d}=await _.from("change_order_materials").update(i).eq("id",s).select().single();if(d)throw d;return o}return null},async deleteCORMaterialItem(s){if(v){const{error:l}=await _.from("change_order_materials").delete().eq("id",s);if(l)throw l}},async addCOREquipmentItem(s,l){if(v){const o=["backup_sheet","invoice","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",d=Math.round(Number(l.unit_cost)||0),m=Number(l.quantity)||1,p=Math.round(m*d),{data:y,error:b}=await _.from("change_order_equipment").insert({change_order_id:s,description:l.description||"",quantity:m,unit:l.unit||"day",unit_cost:d,total:p,source_type:o,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(b)throw b;return y}return null},async updateCOREquipmentItem(s,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await _.from("change_order_equipment").select("quantity, unit_cost").eq("id",s).single(),p=l.quantity??m?.quantity??1,y=l.unit_cost??m?.unit_cost??0;i.total=Math.round(p*y)}const{data:o,error:d}=await _.from("change_order_equipment").update(i).eq("id",s).select().single();if(d)throw d;return o}return null},async deleteCOREquipmentItem(s){if(v){const{error:l}=await _.from("change_order_equipment").delete().eq("id",s);if(l)throw l}},async addCORSubcontractorItem(s,l){if(v){const i=Math.round(l.quantity*l.unit_cost),{data:o,error:d}=await _.from("change_order_subcontractors").insert({change_order_id:s,description:l.description,quantity:l.quantity||1,unit:l.unit||"lump sum",unit_cost:l.unit_cost||0,total:i,source_type:l.source_type||"custom",source_reference:l.source_reference||null,sort_order:l.sort_order||0}).select().single();if(d)throw d;return o}return null},async updateCORSubcontractorItem(s,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await _.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",s).single(),p=l.quantity??m?.quantity??1,y=l.unit_cost??m?.unit_cost??0;i.total=Math.round(p*y)}const{data:o,error:d}=await _.from("change_order_subcontractors").update(i).eq("id",s).select().single();if(d)throw d;return o}return null},async deleteCORSubcontractorItem(s){if(v){const{error:l}=await _.from("change_order_subcontractors").delete().eq("id",s);if(l)throw l}},async addBulkLaborItems(s,l){if(v&&l.length>0){const i=l.map((m,p)=>{const y=Math.round(m.regular_hours*m.regular_rate),b=Math.round(m.overtime_hours*m.overtime_rate);return{change_order_id:s,labor_class:m.labor_class,wage_type:m.wage_type||"standard",regular_hours:m.regular_hours||0,overtime_hours:m.overtime_hours||0,regular_rate:m.regular_rate||0,overtime_rate:m.overtime_rate||0,regular_total:y,overtime_total:b,total:y+b,sort_order:m.sort_order??p,source_ticket_id:m.source_ticket_id||null}}),{data:o,error:d}=await _.from("change_order_labor").insert(i).select();if(d)throw d;return o}return[]},async addBulkMaterialItems(s,l){if(v&&l.length>0){const i=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"],o=l.map((p,y)=>{const b=i.includes(p.source_type)?p.source_type:"custom",z=Math.round(Number(p.unit_cost)||0),B=Number(p.quantity)||1;return{change_order_id:s,description:p.description||"",quantity:B,unit:p.unit||"each",unit_cost:z,total:Math.round(B*z),source_type:b,source_reference:p.source_reference||null,source_ticket_id:p.source_ticket_id||null,sort_order:p.sort_order??y}}),{data:d,error:m}=await _.from("change_order_materials").insert(o).select();if(m)throw m;return d}return[]},async addBulkEquipmentItems(s,l){if(v&&l.length>0){const i=["backup_sheet","invoice","custom","field_ticket","rental"],o=l.map((p,y)=>{const b=i.includes(p.source_type)?p.source_type:"custom",z=Math.round(Number(p.unit_cost)||0),B=Number(p.quantity)||1;return{change_order_id:s,description:p.description||"",quantity:B,unit:p.unit||"day",unit_cost:z,total:Math.round(B*z),source_type:b,source_reference:p.source_reference||null,source_ticket_id:p.source_ticket_id||null,sort_order:p.sort_order??y}}),{data:d,error:m}=await _.from("change_order_equipment").insert(o).select();if(m)throw m;return d}return[]},async addBulkSubcontractorItems(s,l){if(v&&l.length>0){const i=l.map((m,p)=>({change_order_id:s,company_name:m.company_name||"",description:m.description||"",quantity:m.quantity||1,unit:m.unit||"lump sum",unit_cost:m.unit_cost||m.total||m.amount||0,total:m.total||m.amount||0,source_type:m.source_type||"invoice",source_reference:m.source_reference||null,sort_order:m.sort_order??p})),{data:o,error:d}=await _.from("change_order_subcontractors").insert(i).select();if(d)throw d;return o}return[]},async clearCORLineItems(s){v&&(await _.from("change_order_labor").delete().eq("change_order_id",s),await _.from("change_order_materials").delete().eq("change_order_id",s),await _.from("change_order_equipment").delete().eq("change_order_id",s),await _.from("change_order_subcontractors").delete().eq("change_order_id",s))},async saveCORLineItems(s,{laborItems:l,materialItems:i,equipmentItems:o,subcontractorItems:d}){if(v){await this.clearCORLineItems(s);const m=await Promise.all([l?.length>0?this.addBulkLaborItems(s,l):[],i?.length>0?this.addBulkMaterialItems(s,i):[],o?.length>0?this.addBulkEquipmentItems(s,o):[],d?.length>0?this.addBulkSubcontractorItems(s,d):[]]);return{labor:m[0],materials:m[1],equipment:m[2],subcontractors:m[3]}}return null},async assignTicketToCOR(s,l){if(v){const{error:i}=await _.rpc("assign_ticket_to_cor",{p_ticket_id:s,p_cor_id:l});if(i)throw Te.error("database",{message:i.message,operation:"assignTicketToCOR",extra:{ticketId:s,corId:l}}),i;return{ticket_id:s,change_order_id:l}}return null},async unassignTicketFromCOR(s,l){if(v){const{error:i}=await _.rpc("unassign_ticket_from_cor",{p_ticket_id:s,p_cor_id:l});if(i)throw Te.error("database",{message:i.message,operation:"unassignTicketFromCOR",extra:{ticketId:s,corId:l}}),i}},async checkTicketCORIntegrity(){if(v){const{data:s,error:l}=await _.rpc("check_ticket_cor_integrity");if(l)throw l;return s||[]}return[]},async fixTicketCORIntegrity(){if(v){const{data:s,error:l}=await _.rpc("fix_ticket_cor_integrity");if(l)throw l;return s}return 0},async getTicketsForCOR(s){if(v){const{data:l,error:i}=await _.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",s);if(i)throw i;return l}return[]},async getUnassignedTickets(s){if(v){const{data:l,error:i}=await _.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",s).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(i)throw i;return l}return[]},async importTicketDataToCOR(s,l,i,o,d){if(v){const{data:m,error:p}=await _.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",s).single();if(p)throw p;const{data:y,error:b}=await _.from("labor_rates").select("*").eq("company_id",i).eq("work_type",o||"demolition").eq("job_type",d||"standard");if(b)throw b;const z={};y?.forEach(V=>{z[V.role.toLowerCase()]=V});const B={};m.t_and_m_workers?.forEach(V=>{const oe=(V.role||"laborer").toLowerCase();B[oe]||(B[oe]={regular_hours:0,overtime_hours:0}),B[oe].regular_hours+=parseFloat(V.hours)||0,B[oe].overtime_hours+=parseFloat(V.overtime_hours)||0});const O=Object.entries(B).map(([V,oe])=>{const ae=z[V]||{regular_rate:0,overtime_rate:0},me=Math.round((parseFloat(ae.regular_rate)||0)*100),ue=Math.round((parseFloat(ae.overtime_rate)||0)*100);return{labor_class:V.charAt(0).toUpperCase()+V.slice(1),wage_type:d||"standard",regular_hours:oe.regular_hours,overtime_hours:oe.overtime_hours,regular_rate:me,overtime_rate:ue,source_ticket_id:s}});O.length>0&&await this.addBulkLaborItems(l,O);const $=[],W=[];m.t_and_m_items?.forEach(V=>{const oe=V.custom_name||V.materials_equipment?.name||"Unknown Item",ae=V.custom_category||V.materials_equipment?.category||"Other",me=V.materials_equipment?.unit||"each",ue=Math.round((parseFloat(V.materials_equipment?.cost_per_unit)||0)*100),J={description:oe,quantity:V.quantity||1,unit:me,unit_cost:ue,source_type:"backup_sheet",source_ticket_id:s};ae==="Equipment"?W.push(J):$.push(J)}),$.length>0&&await this.addBulkMaterialItems(l,$),W.length>0&&await this.addBulkEquipmentItems(l,W);const{error:te}=await _.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString(),import_status:"completed",import_failed_at:null,import_error:null}).eq("change_order_id",l).eq("ticket_id",s);if(te)throw te;return Te.activity("cor_import_success",{ticket_id:s,cor_id:l,labor_count:O.length,material_count:$.length,equipment_count:W.length}),{laborItems:O,materialItems:$,equipmentItems:W}}return null},async reimportTicketDataToCOR(s,l,i,o,d){return v?(await _.from("change_order_labor").delete().eq("change_order_id",l).eq("source_ticket_id",s),await _.from("change_order_materials").delete().eq("change_order_id",l).eq("source_ticket_id",s),await _.from("change_order_equipment").delete().eq("change_order_id",l).eq("source_ticket_id",s),this.importTicketDataToCOR(s,l,i,o,d)):null},async markImportFailed(s,l,i="Import failed"){if(v){const{error:o}=await _.from("change_order_ticket_associations").update({import_status:"failed",import_failed_at:new Date().toISOString(),import_error:i}).eq("change_order_id",l).eq("ticket_id",s);if(o)throw Te.error("database",{message:o.message,operation:"markImportFailed",extra:{ticketId:s,corId:l}}),o;Te.error("cor_import_failed",{ticket_id:s,cor_id:l,error:i})}},async getTicketsNeedingImport(s){if(v){const{data:l,error:i}=await _.from("t_and_m_tickets").select(`
          id,
          work_date,
          ce_pco_number,
          assigned_cor_id,
          change_order_ticket_associations!inner (
            change_order_id,
            import_status,
            import_failed_at,
            import_error
          )
        `).eq("project_id",s).eq("change_order_ticket_associations.import_status","failed");if(i)throw i;return l||[]}return[]},async getTicketImportStatus(s,l){if(v){const{data:i,error:o}=await _.from("change_order_ticket_associations").select("import_status, import_failed_at, import_error, data_imported").eq("ticket_id",s).eq("change_order_id",l).single();if(o&&o.code!=="PGRST116")throw o;return i}return null},async recalculateCOR(s){if(v){const{error:l}=await _.rpc("recalculate_cor_totals",{cor_id:s});if(l)throw l;return this.getCORById(s)}return null},async updateCORMarkupPercentages(s,l){if(v){const i={};l.labor!==void 0&&(i.labor_markup_percent=l.labor),l.materials!==void 0&&(i.materials_markup_percent=l.materials),l.equipment!==void 0&&(i.equipment_markup_percent=l.equipment),l.subcontractors!==void 0&&(i.subcontractors_markup_percent=l.subcontractors);const{data:o,error:d}=await _.from("change_orders").update(i).eq("id",s).select().single();if(d)throw d;return o}return null},async updateCORFeePercentages(s,l){if(v){const i={};l.liabilityInsurance!==void 0&&(i.liability_insurance_percent=l.liabilityInsurance),l.bond!==void 0&&(i.bond_percent=l.bond),l.licenseFee!==void 0&&(i.license_fee_percent=l.licenseFee);const{data:o,error:d}=await _.from("change_orders").update(i).eq("id",s).select().single();if(d)throw d;return o}return null},async submitCORForApproval(s){if(v){const{data:l,error:i}=await _.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",s).select().single();if(i)throw i;return l}return null},async approveCOR(s,l){if(v){const{data:i,error:o}=await _.from("change_orders").update({status:"approved",approved_by:l,approved_at:new Date().toISOString()}).eq("id",s).select().single();if(o)throw o;return i}return null},async rejectCOR(s,l=null){if(v){const{data:i,error:o}=await _.from("change_orders").update({status:"rejected",rejection_reason:l}).eq("id",s).select().single();if(o)throw o;return i}return null},async markCORAsBilled(s){if(v){const{data:l,error:i}=await _.from("change_orders").update({status:"billed"}).eq("id",s).select().single();if(i)throw i;return l}return null},async closeCOR(s){if(v){const{data:l,error:i}=await _.from("change_orders").update({status:"closed"}).eq("id",s).select().single();if(i)throw i;return l}return null},async saveCORSignature(s,l,i){if(v){const{data:o,error:d}=await _.from("change_orders").update({gc_signature_data:l,gc_signature_name:i,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",s).select().single();if(d)throw d;return o}return null},async getCORStats(s){if(v){const{data:l,error:i}=await _.from("change_orders").select("status, cor_total").eq("project_id",s);if(i)throw i;const o={total_cors:l.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return l.forEach(d=>{switch(d.status){case"draft":o.draft_count++;break;case"pending_approval":o.pending_count++,o.total_pending_value+=d.cor_total||0;break;case"approved":o.approved_count++,o.total_approved_value+=d.cor_total||0;break;case"rejected":o.rejected_count++;break;case"billed":case"closed":o.billed_count++,o.total_billed_value+=d.cor_total||0;break}}),o}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(s,l){return v?_.channel(`change_orders:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${s}`},l).subscribe():null},subscribeToCorTickets(s,l){return v?_.channel(`cor-tickets:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${s}`},l).subscribe():null},async getCORLog(s){if(v){const{data:l,error:i}=await _.from("cor_log_entries").select(`
          id,
          log_number,
          date_sent_to_client,
          ce_number,
          comments,
          created_at,
          updated_at,
          change_order:change_orders (
            id,
            cor_number,
            title,
            cor_total,
            status,
            created_at,
            approved_at,
            approved_by
          )
        `).eq("project_id",s).order("log_number",{ascending:!0});if(i)throw console.error("Error fetching COR log:",i),i;return(l||[]).map(o=>({id:o.id,logNumber:o.log_number,dateSentToClient:o.date_sent_to_client,ceNumber:o.ce_number,comments:o.comments,createdAt:o.created_at,updatedAt:o.updated_at,changeOrder:{id:o.change_order?.id,corNumber:o.change_order?.cor_number,title:o.change_order?.title,corTotal:o.change_order?.cor_total,status:o.change_order?.status,createdAt:o.change_order?.created_at,approvedAt:o.change_order?.approved_at,approvedBy:o.change_order?.approved_by}}))}return[]},async updateCORLogEntry(s,l){if(v){const i={updated_at:new Date().toISOString()};l.dateSentToClient!==void 0&&(i.date_sent_to_client=l.dateSentToClient||null),l.ceNumber!==void 0&&(i.ce_number=l.ceNumber||null),l.comments!==void 0&&(i.comments=l.comments||null);const{data:o,error:d}=await _.from("cor_log_entries").update(i).eq("id",s).select().single();if(d)throw console.error("Error updating COR log entry:",d),d;return o}return null},async updateChangeOrderStatus(s,l){if(v){const{data:i,error:o}=await _.from("change_orders").update({status:l,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(o)throw console.error("Error updating change order status:",o),o;return i}return null},subscribeToCORLog(s,l){return v?_.channel(`cor-log:${s}`).on("postgres_changes",{event:"*",schema:"public",table:"cor_log_entries",filter:`project_id=eq.${s}`},l).subscribe():null},async createSignatureRequest(s,l,i,o,d=null,m=null){if(v){const{data:p,error:y}=await _.rpc("generate_signature_token");if(y)throw y;const{data:b,error:z}=await _.from("signature_requests").insert({document_type:s,document_id:l,company_id:i,project_id:o,signature_token:p,expires_at:m,created_by:d}).select().single();if(z)throw z;return b}return null},async getSignatureRequestByToken(s){if(v){await _.rpc("increment_signature_view_count",{token:s});const{data:l,error:i}=await _.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",s).single();if(i)throw i;return l}return null},async getSignatureRequestsForDocument(s,l){if(v){const{data:i,error:o}=await _.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",s).eq("document_id",l).order("created_at",{ascending:!1});if(o)throw o;return i||[]}return[]},async addSignature(s,l,i){if(v){const{data:o,error:d}=await _.from("signatures").insert({signature_request_id:s,signature_slot:l,signature_image:i.signature,signer_name:i.signerName,signer_title:i.signerTitle||null,signer_company:i.signerCompany||null,signed_at:i.signedAt||new Date().toISOString(),ip_address:i.ipAddress||null,user_agent:i.userAgent||null}).select().single();if(d)throw d;return o}return null},async syncSignatureToDocument(s,l){if(!v)return null;const{document_type:i,document_id:o}=l,d=s.signature_slot,m={};d===1?(m.gc_signature_data=s.signature_image,m.gc_signature_name=s.signer_name,m.gc_signature_title=s.signer_title,m.gc_signature_company=s.signer_company,m.gc_signature_date=s.signed_at,m.gc_signature_ip=s.ip_address):d===2&&(m.client_signature_data=s.signature_image,m.client_signature_name=s.signer_name,m.client_signature_title=s.signer_title,m.client_signature_company=s.signer_company,m.client_signature_date=s.signed_at,m.client_signature_ip=s.ip_address);const p=i==="cor"?"change_orders":"t_and_m_tickets",{data:y,error:b}=await _.from(p).update(m).eq("id",o).select().single();if(b)throw b;return y},async revokeSignatureRequest(s){if(v){const{data:l,error:i}=await _.from("signature_requests").update({status:"revoked"}).eq("id",s).select().single();if(i)throw i;return l}return null},async getDocumentForSigning(s,l){if(!v)return null;if(s==="cor"){const{data:i,error:o}=await _.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",l).single();if(o)throw o;return i}else if(s==="tm_ticket"){const{data:i,error:o}=await _.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (*)
        `).eq("id",l).single();if(o)throw o;return i}return null},async getProjectCosts(s){if(v){const{data:i,error:o}=await _.from("project_costs").select("*").eq("project_id",s).order("cost_date",{ascending:!1});return o?(console.error("Error fetching project costs:",o),[]):i||[]}return(re().projectCosts||[]).filter(i=>i.project_id===s).sort((i,o)=>new Date(o.cost_date)-new Date(i.cost_date))},async addProjectCost(s,l,i){const o={project_id:s,company_id:l,category:i.category,description:i.description,amount:parseFloat(i.amount),cost_date:i.cost_date||new Date().toISOString().split("T")[0],notes:i.notes||null,created_by:i.created_by||null};if(v){const{data:p,error:y}=await _.from("project_costs").insert(o).select().single();if(y)throw console.error("Error adding project cost:",y),y;return p}const d=re();d.projectCosts||(d.projectCosts=[]);const m={...o,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return d.projectCosts.push(m),De(d),m},async updateProjectCost(s,l){const i={category:l.category,description:l.description,amount:parseFloat(l.amount),cost_date:l.cost_date,notes:l.notes||null,updated_at:new Date().toISOString()};if(v){const{data:m,error:p}=await _.from("project_costs").update(i).eq("id",s).select().single();if(p)throw console.error("Error updating project cost:",p),p;return m}const o=re();if(!o.projectCosts)return null;const d=o.projectCosts.findIndex(m=>m.id===s);return d===-1?null:(o.projectCosts[d]={...o.projectCosts[d],...i},De(o),o.projectCosts[d])},async deleteProjectCost(s){if(v){const{error:i}=await _.from("project_costs").delete().eq("id",s);if(i)throw console.error("Error deleting project cost:",i),i;return!0}const l=re();return l.projectCosts&&(l.projectCosts=l.projectCosts.filter(i=>i.id!==s),De(l)),!0},async getProjectCostsSummary(s){const l=await this.getProjectCosts(s),i={};let o=0;return l.forEach(d=>{const m=parseFloat(d.amount)||0;o+=m,i[d.category]||(i[d.category]={category:d.category,total:0,count:0,items:[]}),i[d.category].total+=m,i[d.category].count++,i[d.category].items.push(d)}),Object.values(i).forEach(d=>{d.percentage=o>0?d.total/o*100:0}),{totalCost:o,byCategory:i,itemCount:l.length}},async getNextInvoiceNumber(s){if(v){const{data:l,error:i}=await _.rpc("get_next_invoice_number",{p_company_id:s});return i?(console.error("Error getting next invoice number:",i),this._generateLocalInvoiceNumber(s)):l}return this._generateLocalInvoiceNumber(s)},async _generateLocalInvoiceNumber(s){const i=(await this.getCompanyInvoices(s)).reduce((o,d)=>{const m=d.invoice_number?.match(/^INV-(\d+)$/);if(m){const p=parseInt(m[1],10);return p>o?p:o}return o},0);return`INV-${String(i+1).padStart(4,"0")}`},async getBillableItems(s){if(v){const{data:l,error:i}=await _.from("change_orders").select("id, cor_number, title, cor_total, status, approved_at").eq("project_id",s).eq("status","approved").order("cor_number",{ascending:!0});i&&console.error("Error fetching billable CORs:",i);const{data:o,error:d}=await _.from("t_and_m_tickets").select("id, work_date, ce_pco_number, change_order_value, status, client_signature_date").eq("project_id",s).eq("status","approved").not("client_signature_data","is",null).order("work_date",{ascending:!0});return d&&console.error("Error fetching billable T&M tickets:",d),{cors:l||[],tickets:o||[]}}return{cors:[],tickets:[]}},async getProjectInvoices(s){if(v){const{data:i,error:o}=await _.from("invoices").select(`
          *,
          invoice_items (*)
        `).eq("project_id",s).order("invoice_date",{ascending:!1});if(o)throw console.error("Error fetching project invoices:",o),o;return i||[]}return(re().invoices||[]).filter(i=>i.project_id===s)},async getCompanyInvoices(s){if(v){const{data:i,error:o}=await _.from("invoices").select("*").eq("company_id",s).order("invoice_date",{ascending:!1});if(o)throw console.error("Error fetching company invoices:",o),o;return i||[]}return(re().invoices||[]).filter(i=>i.company_id===s)},async createInvoice(s,l){if(v){const{data:d,error:m}=await _.from("invoices").insert({project_id:s.project_id,company_id:s.company_id,invoice_number:s.invoice_number,invoice_date:s.invoice_date,due_date:s.due_date,status:s.status||"draft",retention_percent:s.retention_percent||0,bill_to_name:s.bill_to_name,bill_to_address:s.bill_to_address,bill_to_contact:s.bill_to_contact,notes:s.notes,terms:s.terms||"Net 30",created_by:s.created_by}).select().single();if(m)throw console.error("Error creating invoice:",m),m;if(l&&l.length>0){const p=l.map((b,z)=>({invoice_id:d.id,item_type:b.item_type,reference_id:b.reference_id,reference_number:b.reference_number,description:b.description,amount:b.amount,sort_order:z})),{error:y}=await _.from("invoice_items").insert(p);if(y)throw console.error("Error creating invoice items:",y),await _.from("invoices").delete().eq("id",d.id),y}return this.getInvoice(d.id)}const i=re();i.invoices||(i.invoices=[]);const o={...s,id:ea(),created_at:new Date().toISOString(),invoice_items:l||[]};return i.invoices.push(o),De(i),o},async getInvoice(s){if(v){const{data:i,error:o}=await _.from("invoices").select(`
          *,
          invoice_items (*)
        `).eq("id",s).single();if(o)throw console.error("Error fetching invoice:",o),o;return i}return(re().invoices||[]).find(i=>i.id===s)},async updateInvoice(s,l){if(v){const{data:d,error:m}=await _.from("invoices").update(l).eq("id",s).select().single();if(m)throw console.error("Error updating invoice:",m),m;return d}const i=re(),o=(i.invoices||[]).findIndex(d=>d.id===s);return o>=0?(i.invoices[o]={...i.invoices[o],...l},De(i),i.invoices[o]):null},async markInvoiceSent(s){return this.updateInvoice(s,{status:"sent",sent_at:new Date().toISOString()})},async recordInvoicePayment(s,l){const i=await this.getInvoice(s);if(!i)throw new Error("Invoice not found");const o=(i.amount_paid||0)+l,d=o>=i.total;return this.updateInvoice(s,{amount_paid:o,status:d?"paid":"partial",paid_at:d?new Date().toISOString():null})},async deleteInvoice(s){if(v){const{error:i}=await _.from("invoices").delete().eq("id",s).eq("status","draft");if(i)throw console.error("Error deleting invoice:",i),i;return!0}const l=re();return l.invoices=(l.invoices||[]).filter(i=>i.id!==s),De(l),!0},async markItemsBilled(s=[],l=[]){if(v){if(s.length>0){const{error:i}=await _.from("change_orders").update({status:"billed"}).in("id",s);i&&console.error("Error marking CORs as billed:",i)}if(l.length>0){const{error:i}=await _.from("t_and_m_tickets").update({status:"billed"}).in("id",l);i&&console.error("Error marking T&M tickets as billed:",i)}}}},Kg={async getCompanyEquipment(s,l=!0){if(!v)return console.warn("Supabase not configured"),[];let i=_.from("equipment").select("*").eq("company_id",s).order("name");l&&(i=i.eq("is_active",!0));const{data:o,error:d}=await i;return d?(console.error("Error fetching company equipment:",d),[]):o||[]},async createEquipment(s){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await _.from("equipment").insert(s).select().single();if(i)throw console.error("Error creating equipment:",i),i;return l},async updateEquipment(s,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await _.from("equipment").update(l).eq("id",s).select().single();if(o)throw console.error("Error updating equipment:",o),o;return i},async deactivateEquipment(s){return this.updateEquipment(s,{is_active:!1})},async getProjectEquipment(s){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await _.from("project_equipment").select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).eq("project_id",s).order("start_date",{ascending:!1});return i?(console.error("Error fetching project equipment:",i),[]):l||[]},async getActiveProjectEquipment(s){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await _.from("project_equipment").select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).eq("project_id",s).is("end_date",null).order("start_date",{ascending:!1});return i?(console.error("Error fetching active project equipment:",i),[]):l||[]},async addEquipmentToProject(s){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await _.from("project_equipment").insert(s).select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).single();if(i)throw console.error("Error adding equipment to project:",i),i;return l},async updateProjectEquipment(s,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await _.from("project_equipment").update(l).eq("id",s).select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).single();if(o)throw console.error("Error updating project equipment:",o),o;return i},async markEquipmentReturned(s,l=null){return this.updateProjectEquipment(s,{end_date:l||new Date().toISOString().split("T")[0]})},async removeEquipmentFromProject(s){if(!v)return console.warn("Supabase not configured"),!1;const{error:l}=await _.from("project_equipment").delete().eq("id",s);if(l)throw console.error("Error removing project equipment:",l),l;return!0},calculateProjectEquipmentCost(s){const l=new Date;return l.setHours(0,0,0,0),s.reduce((i,o)=>{const d=new Date(o.start_date);d.setHours(0,0,0,0);let m;o.end_date?(m=new Date(o.end_date),m.setHours(0,0,0,0)):m=l;const p=Math.max(1,Math.floor((m-d)/(1e3*60*60*24))+1);return i+o.daily_rate*p},0)},calculateDaysOnSite(s,l=null){const i=new Date(s);i.setHours(0,0,0,0);let o;return l?o=new Date(l):o=new Date,o.setHours(0,0,0,0),Math.max(1,Math.floor((o-i)/(1e3*60*60*24))+1)}},Jg={async getNextDrawNumber(s){if(!v)return console.warn("Supabase not configured"),1;const{data:l,error:i}=await _.from("draw_requests").select("draw_number").eq("project_id",s).order("draw_number",{ascending:!1}).limit(1).single();return i&&i.code!=="PGRST116"&&console.error("Error getting next draw number:",i),(l?.draw_number||0)+1},async getPreviousBillingTotals(s){if(!v)return console.warn("Supabase not configured"),{totalBilled:0,totalRetention:0};const{data:l,error:i}=await _.from("draw_requests").select("current_billing, retention_held").eq("project_id",s).in("status",["submitted","approved","paid"]);if(i)return console.error("Error getting previous billing totals:",i),{totalBilled:0,totalRetention:0};const o=(l||[]).reduce((m,p)=>m+(p.current_billing||0),0),d=l?.length>0?Math.max(...l.map(m=>m.retention_held||0)):0;return{totalBilled:o,totalRetention:d}},async getProjectDrawRequests(s){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await _.from("draw_requests").select("*").eq("project_id",s).order("draw_number",{ascending:!1});return i?(console.error("Error fetching draw requests:",i),[]):l||[]},async getDrawRequest(s){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await _.from("draw_requests").select(`
        *,
        draw_request_items (
          *
        )
      `).eq("id",s).single();return i?(console.error("Error fetching draw request:",i),null):l},async createDrawRequest(s,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await _.from("draw_requests").insert(s).select().single();if(o)throw console.error("Error creating draw request:",o),o;if(l&&l.length>0){const d=l.map((p,y)=>({...p,draw_request_id:i.id,sort_order:y})),{error:m}=await _.from("draw_request_items").insert(d);m&&console.error("Error creating draw request items:",m)}return this.getDrawRequest(i.id)},async updateDrawRequest(s,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await _.from("draw_requests").update(l).eq("id",s).select().single();if(o)throw console.error("Error updating draw request:",o),o;return i},async updateDrawRequestStatus(s,l){const i={status:l};return l==="submitted"?i.submitted_at=new Date().toISOString():l==="approved"?i.approved_at=new Date().toISOString():l==="paid"&&(i.paid_at=new Date().toISOString()),this.updateDrawRequest(s,i)},async updateDrawRequestItems(s,l){if(!v)return console.warn("Supabase not configured"),!1;const{error:i}=await _.from("draw_request_items").delete().eq("draw_request_id",s);if(i)throw console.error("Error deleting old draw request items:",i),i;if(l&&l.length>0){const o=l.map((m,p)=>({...m,draw_request_id:s,sort_order:p})),{error:d}=await _.from("draw_request_items").insert(o);if(d)throw console.error("Error inserting draw request items:",d),d}return!0},async deleteDrawRequest(s){if(!v)return console.warn("Supabase not configured"),!1;const{error:l}=await _.from("draw_requests").delete().eq("id",s);if(l)throw console.error("Error deleting draw request:",l),l;return!0},async getScheduleOfValues(s){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await _.from("areas").select("id, name, square_footage, price_per_sqft").eq("project_id",s).order("created_at");return i?(console.error("Error fetching schedule of values:",i),[]):(l||[]).map((o,d)=>({area_id:o.id,item_number:String(d+1),description:o.name,scheduled_value:Math.round((o.square_footage||0)*(o.price_per_sqft||0)*100)}))},async getPreviousDrawItems(s){if(!v)return console.warn("Supabase not configured"),{};const{data:l,error:i}=await _.from("draw_requests").select("id").eq("project_id",s).in("status",["submitted","approved","paid"]).order("draw_number",{ascending:!1}).limit(1).single();if(i&&i.code!=="PGRST116")return console.error("Error fetching latest draw:",i),{};if(!l)return{};const{data:o,error:d}=await _.from("draw_request_items").select("area_id, total_percent, total_amount").eq("draw_request_id",l.id);return d?(console.error("Error fetching previous draw items:",d),{}):(o||[]).reduce((m,p)=>(p.area_id&&(m[p.area_id]={previous_percent:p.total_percent||0,previous_amount:p.total_amount||0}),m),{})},calculatePercentFromAmount(s,l){return!l||l===0?0:Math.round(s/l*1e4)},calculateAmountFromPercent(s,l){return Math.round(s/1e4*l)}};nu(async s=>{if(s&&v)try{await ph(_e)}catch(l){console.error("Error syncing pending actions:",l)}});const Oy=Object.freeze(Object.defineProperty({__proto__:null,auth:Fc,clearFieldSession:_h,db:_e,drawRequestOps:Jg,equipmentOps:Kg,getConnectionStatus:ga,getPendingActionCount:ji,isSupabaseConfigured:v,onConnectionChange:nu,supabase:_,syncPendingActions:ph},Symbol.toStringTag,{value:"Module"})),vh=w.createContext(),aa={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function mr({children:s,companyId:l}){const[i,o]=w.useState(aa),[d,m]=w.useState(!0);w.useEffect(()=>{l?p(l):y()},[l]),w.useEffect(()=>{B(i)},[i]);const p=async W=>{try{if(m(!0),!v){o(aa),m(!1);return}const{data:te,error:V}=await _.from("company_branding").select("*").eq("company_id",W).single();V?(V.code==="PGRST116"?await b(W):console.error("Error loading branding:",V),o(aa)):o({...aa,...te})}catch(te){console.error("Error in loadBranding:",te),o(aa)}finally{m(!1)}},y=async()=>{try{m(!0);const W=window.location.hostname;if(W==="localhost"||W==="127.0.0.1"){o(aa),m(!1);return}if(!v){o(aa),m(!1);return}const{data:te,error:V}=await _.rpc("get_branding_by_domain",{domain_name:W});V||!te||te.length===0?o(aa):o({...aa,...te[0]})}catch(W){console.error("Error loading branding by domain:",W),o(aa)}finally{m(!1)}},b=async W=>{try{const{data:te,error:V}=await _.from("company_branding").insert({company_id:W,...aa}).select().single();V&&console.error("Error creating default branding:",V)}catch(te){console.error("Error in createDefaultBranding:",te)}},z=async W=>{try{if(!v)return o(J=>({...J,...W})),{success:!0};if(!l)return{success:!1,error:"No company ID"};const te={},V=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const J of V)W[J]!==void 0&&(te[J]=W[J]);const{data:oe,error:ae}=await _.from("company_branding").select("id").eq("company_id",l).single();if(ae&&ae.code==="PGRST116"){const{data:J,error:xe}=await _.from("company_branding").insert({company_id:l,...te}).select().single();return xe?(console.error("Error creating branding:",xe),{success:!1,error:xe.message}):(o({...aa,...J}),{success:!0,data:J})}const{data:me,error:ue}=await _.from("company_branding").update(te).eq("company_id",l).select().single();return ue?(console.error("Error updating branding:",ue),{success:!1,error:ue.message}):(o({...aa,...me}),{success:!0,data:me})}catch(te){return console.error("Error in updateBranding:",te),{success:!1,error:te.message}}},B=W=>{const te=document.documentElement;if(te.style.setProperty("--primary-color",W.primary_color),te.style.setProperty("--secondary-color",W.secondary_color),W.favicon_url){let V=document.querySelector("link[rel*='icon']");V||(V=document.createElement("link"),V.rel="icon",document.head.appendChild(V)),V.href=W.favicon_url}document.title=W.custom_app_name||"FieldSync"},$={branding:i,loading:d,updateBranding:z,uploadBrandingImage:async(W,te)=>{try{if(!v)return{success:!0,url:URL.createObjectURL(W)};const V=W.name.split(".").pop(),ae=`branding/${`${l}/${te}-${Date.now()}.${V}`}`,{data:me,error:ue}=await _.storage.from("public").upload(ae,W,{cacheControl:"3600",upsert:!0});if(ue)return console.error("Error uploading image:",ue),{success:!1,error:ue.message};const{data:{publicUrl:J}}=_.storage.from("public").getPublicUrl(ae);return{success:!0,url:J}}catch(V){return console.error("Error in uploadBrandingImage:",V),{success:!1,error:V.message}}},refreshBranding:()=>l?p(l):y()};return r.jsx(vh.Provider,{value:$,children:s})}function Fg(){const s=w.useContext(vh);if(!s)throw new Error("useBranding must be used within a BrandingProvider");return s}const bh=w.createContext();function fr({children:s}){const[l,i]=w.useState(()=>{const d=localStorage.getItem("fieldsync-theme");return d==="light"||d==="dark"?d:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"});w.useEffect(()=>{document.documentElement.setAttribute("data-theme",l),localStorage.setItem("fieldsync-theme",l)},[l]),w.useEffect(()=>{const d=window.matchMedia("(prefers-color-scheme: light)"),m=p=>{localStorage.getItem("fieldsync-theme")||i(p.matches?"light":"dark")};return d.addEventListener("change",m),()=>d.removeEventListener("change",m)},[]);const o=()=>{i(d=>d==="dark"?"light":"dark")};return r.jsx(bh.Provider,{value:{theme:l,setTheme:i,toggleTheme:o},children:s})}function $g(){const s=w.useContext(bh);if(!s)throw new Error("useTheme must be used within a ThemeProvider");return s}const Wg=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Pg=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(l,i,o)=>o?o.toUpperCase():i.toLowerCase()),eh=s=>{const l=Pg(s);return l.charAt(0).toUpperCase()+l.slice(1)},jh=(...s)=>s.filter((l,i,o)=>!!l&&l.trim()!==""&&o.indexOf(l)===i).join(" ").trim(),Ig=s=>{for(const l in s)if(l.startsWith("aria-")||l==="role"||l==="title")return!0};var e_={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const t_=w.forwardRef(({color:s="currentColor",size:l=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:d="",children:m,iconNode:p,...y},b)=>w.createElement("svg",{ref:b,...e_,width:l,height:l,stroke:s,strokeWidth:o?Number(i)*24/Number(l):i,className:jh("lucide",d),...!m&&!Ig(y)&&{"aria-hidden":"true"},...y},[...p.map(([z,B])=>w.createElement(z,B)),...Array.isArray(m)?m:[m]]));const Ee=(s,l)=>{const i=w.forwardRef(({className:o,...d},m)=>w.createElement(t_,{ref:m,iconNode:l,className:jh(`lucide-${Wg(eh(s))}`,`lucide-${s}`,o),...d}));return i.displayName=eh(s),i};const a_=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],xh=Ee("briefcase",a_);const n_=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],r_=Ee("building",n_);const s_=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Lc=Ee("camera",s_);const l_=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],na=Ee("check",l_);const i_=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],o_=Ee("chevron-down",i_);const c_=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],u_=Ee("chevron-up",c_);const d_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ps=Ee("circle-alert",d_);const m_=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],f_=Ee("circle-check-big",m_);const h_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Bc=Ee("circle-check",h_);const p_=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],th=Ee("clipboard-list",p_);const g_=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Is=Ee("clock",g_);const __=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],$c=Ee("copy",__);const y_=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],ah=Ee("external-link",y_);const v_=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],wi=Ee("file-text",v_);const b_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],j_=Ee("globe",b_);const x_=[["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["rect",{x:"2",y:"15",width:"20",height:"4",rx:"1",key:"g3x8cw"}]],un=Ee("hard-hat",x_);const S_=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],w_=Ee("history",S_);const N_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],C_=Ee("info",N_);const E_=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Sh=Ee("link",E_);const k_=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],$s=Ee("loader-circle",k_);const q_=[["path",{d:"M5 12h14",key:"1ays0h"}]],nh=Ee("minus",q_);const D_=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],T_=Ee("moon",D_);const A_=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Yc=Ee("pen-line",A_);const O_=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],M_=Ee("pen",O_);const z_=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Gc=Ee("plus",z_);const R_=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],U_=Ee("refresh-cw",R_);const H_=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Wc=Ee("rotate-ccw",H_);const L_=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],B_=Ee("search",L_);const Y_=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],G_=Ee("send",Y_);const Q_=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],X_=Ee("square-check-big",Q_);const V_=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Z_=Ee("sun",V_);const K_=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],J_=Ee("trash-2",K_);const F_=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],lu=Ee("triangle-alert",F_);const $_=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],Pc=Ee("truck",$_);const W_=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],P_=Ee("upload",W_);const I_=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ey=Ee("user-check",I_);const ty=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ay=Ee("user",ty);const ny=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],ry=Ee("wrench",ny);const sy=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],iu=Ee("x",sy);const ly=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Ic=Ee("zap",ly);function _a({className:s="",showPoweredBy:l=!1}){const{branding:i}=Fg();return r.jsxs("div",{className:`app-logo ${s}`,children:[i.logo_url?r.jsx("img",{src:i.logo_url,alt:i.custom_app_name||"Logo",className:"custom-logo"}):r.jsxs("div",{className:"logo",children:[i.custom_app_name||"Field",r.jsx("span",{children:"Sync"})]}),l&&!i.hide_fieldsync_branding&&r.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function iy({onForemanAccess:s,onOfficeLogin:l,onShowToast:i}){const[o,d]=w.useState(null),[m,p]=w.useState(""),[y,b]=w.useState(null),[z,B]=w.useState(""),[O,$]=w.useState(!1),[W,te]=w.useState(""),[V,oe]=w.useState(""),[ae,me]=w.useState(""),[ue,J]=w.useState(1),[xe,ke]=w.useState(null),[Ue,ee]=w.useState(""),[ve,Ve]=w.useState(""),[Me,M]=w.useState(""),[G,ne]=w.useState(""),pe=F=>{const fe=F.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);p(fe)},C=async()=>{if(m.length<2){i("Enter company code","error");return}$(!0);try{const F=await _e.getCompanyByCode(m);F?b(F):(i("Invalid company code","error"),p(""))}catch{i("Error checking code","error")}finally{$(!1)}},X=async F=>{if(F.length===4){$(!0),te("");try{const fe=await _e.getProjectByPinSecure(F,y.code);if(fe.rateLimited){te("error"),i("Too many attempts. Please wait 15 minutes.","error"),setTimeout(()=>{B(""),te("")},800);return}if(fe.success&&fe.project){s(fe.project);return}if(fe.error){console.warn("Secure PIN validation failed, trying fallback:",fe.error);const Be=await _e.getProjectByPinAndCompany(F,y.id);if(Be){s(Be);return}}i("Invalid PIN","error"),B("")}catch(fe){console.error("PIN validation error:",fe);try{const Be=await _e.getProjectByPinAndCompany(F,y.id);if(Be){s(Be);return}}catch(Be){console.error("Fallback PIN validation also failed:",Be)}i("Error checking PIN","error"),B("")}finally{$(!1)}}},I=F=>{if(z.length<4&&!O){const fe=z+F;B(fe),te(""),fe.length===4&&setTimeout(()=>X(fe),150)}},Se=()=>{O||(B(F=>F.slice(0,-1)),te(""))},Y=()=>{b(null),B(""),te("")},je=()=>{if(!V.trim()||!ae.trim()){i("Enter email and password","error");return}l(V,ae)},P=async()=>{if(m.length<2){i("Enter company code","error");return}$(!0);try{const F=await _e.getCompanyByCode(m);F?(ke(F),J(2)):(i("Invalid company code","error"),p(""))}catch{i("Error checking code","error")}finally{$(!1)}},ye=async()=>{if(!Ue.trim()){i("Enter office code","error");return}$(!0);try{const{data:F,error:fe}=await _.rpc("verify_office_code",{company_id:xe.id,code:Ue.trim()});if(fe)throw fe;F===!0?J(3):(i("Invalid office code","error"),ee(""))}catch{i("Error verifying code","error")}finally{$(!1)}},qe=async()=>{if(!ve.trim()){i("Enter your name","error");return}if(!Me.trim()||!Me.includes("@")){i("Enter valid email","error");return}if(G.length<6){i("Password must be 6+ characters","error");return}$(!0);try{const F=Me.toLowerCase().trim(),{data:fe,error:Be}=await _.auth.signUp({email:F,password:G});let le;if(Be?.message?.includes("already registered")||fe?.user&&fe.user.identities?.length===0){const{data:Fe,error:Le}=await _.auth.signInWithPassword({email:F,password:G});if(Le){i("Account exists with different password. Use your existing password.","error"),$(!1);return}le=Fe.user.id;const{data:rt}=await _.from("user_companies").select("id, status").eq("user_id",le).eq("company_id",xe.id).maybeSingle();if(rt){rt.status==="active"?(i("You already belong to this company. Logging you in...","success"),setTimeout(()=>window.location.reload(),1e3)):rt.status==="pending"?(i("Your request is still pending approval.","error"),await _.auth.signOut()):(i("Your membership was removed. Contact the company admin.","error"),await _.auth.signOut());return}const{error:xt}=await _.from("user_companies").insert({user_id:le,company_id:xe.id,role:"member",status:"pending"});if(xt)throw console.error("Error adding to user_companies:",xt),await _.auth.signOut(),new Error("Failed to submit join request");await _.auth.signOut(),i("Request to join submitted! Awaiting admin approval.","success")}else{if(Be)throw Be;{if(le=fe.user?.id,!le)throw new Error("Failed to create user");const{error:Fe}=await _.from("users").insert({id:le,email:F,password_hash:"managed_by_supabase_auth",name:ve.trim(),company_id:xe.id,role:"member",is_active:!0});if(Fe)throw Fe;const{error:Le}=await _.from("user_companies").insert({user_id:le,company_id:xe.id,role:"member",status:"pending"});if(Le)throw console.error("Error adding to user_companies:",Le),new Error("Failed to submit join request");await _.auth.signOut(),i("Account created! Awaiting admin approval.","success")}}}catch(F){console.error("Join error:",F),i(F.message||"Error creating account","error")}finally{$(!1)}};if(o===null)return r.jsx("div",{className:"entry-container",children:r.jsxs("div",{className:"entry-card",children:[r.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),r.jsxs("div",{className:"entry-buttons",children:[r.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>d("foreman"),children:[r.jsx("span",{className:"entry-mode-icon",children:r.jsx(un,{size:32})}),r.jsx("span",{className:"entry-mode-title",children:"Foreman"}),r.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),r.jsxs("button",{className:"entry-mode-btn office",onClick:()=>d("office"),children:[r.jsx("span",{className:"entry-mode-icon",children:r.jsx(xh,{size:32})}),r.jsx("span",{className:"entry-mode-title",children:"Office"}),r.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(o==="foreman")return y?r.jsx("div",{className:"entry-container",children:r.jsxs("div",{className:"entry-card",children:[r.jsx("button",{className:"entry-back",onClick:Y,children:""}),r.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),r.jsx("div",{className:"entry-company-badge",children:y.name}),r.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),r.jsx("div",{className:`pin-display ${W==="error"?"shake":""}`,children:[0,1,2,3].map(F=>r.jsx("div",{className:`pin-dot ${z.length>F?"filled":""} ${W}`,children:z.length>F?"":""},F))}),r.jsxs("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map(F=>r.jsx("button",{className:"num-btn",onClick:()=>I(F.toString()),disabled:O,children:F},F)),r.jsx("button",{className:"num-btn empty",disabled:!0}),r.jsx("button",{className:"num-btn",onClick:()=>I("0"),disabled:O,children:"0"}),r.jsx("button",{className:"num-btn backspace",onClick:Se,disabled:O||z.length===0,children:""})]}),O&&r.jsx("div",{className:"entry-loading",children:r.jsx("div",{className:"spinner"})})]})}):r.jsx("div",{className:"entry-container",children:r.jsxs("div",{className:"entry-card",children:[r.jsx("button",{className:"entry-back",onClick:()=>d(null),children:""}),r.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),r.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),r.jsxs("div",{className:"entry-input-group",children:[r.jsx("input",{type:"text",value:m,onChange:F=>pe(F.target.value),placeholder:"Company Code",disabled:O,autoFocus:!0,onKeyDown:F=>{F.key==="Enter"&&C()}}),r.jsx("button",{className:"entry-submit-btn",onClick:C,disabled:O||m.length<2,children:O?"...":""})]})]})});if(o==="office")return r.jsx("div",{className:"entry-container",children:r.jsxs("div",{className:"entry-card",children:[r.jsx("button",{className:"entry-back",onClick:()=>d(null),children:""}),r.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),r.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),r.jsxs("div",{className:"entry-form",children:[r.jsx("input",{type:"email",value:V,onChange:F=>oe(F.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:F=>{F.key==="Enter"&&je()}}),r.jsx("input",{type:"password",value:ae,onChange:F=>me(F.target.value),placeholder:"Password",onKeyDown:F=>{F.key==="Enter"&&je()}}),r.jsx("button",{className:"entry-login-btn",onClick:je,children:"Sign In"})]}),r.jsxs("div",{className:"entry-signup-hint",children:[r.jsx("p",{children:"New employee?"}),r.jsx("button",{className:"entry-join-link",onClick:()=>d("join"),children:"Join your company"})]})]})});if(o==="join")return ue===1?r.jsx("div",{className:"entry-container",children:r.jsxs("div",{className:"entry-card",children:[r.jsx("button",{className:"entry-back",onClick:()=>d("office"),children:""}),r.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),r.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),r.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),r.jsxs("div",{className:"entry-input-group",children:[r.jsx("input",{type:"text",value:m,onChange:F=>pe(F.target.value),placeholder:"Company Code",disabled:O,autoFocus:!0,onKeyDown:F=>{F.key==="Enter"&&P()}}),r.jsx("button",{className:"entry-submit-btn",onClick:P,disabled:O||m.length<2,children:O?"...":""})]})]})}):ue===2?r.jsx("div",{className:"entry-container",children:r.jsxs("div",{className:"entry-card",children:[r.jsx("button",{className:"entry-back",onClick:()=>{J(1),ke(null),ee("")},children:""}),r.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),r.jsx("div",{className:"entry-company-badge",children:xe?.name}),r.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),r.jsx("p",{className:"entry-hint",children:"This code is only for office staff"}),r.jsxs("div",{className:"entry-input-group",children:[r.jsx("input",{type:"password",value:Ue,onChange:F=>ee(F.target.value),placeholder:"Office Code",disabled:O,autoFocus:!0,onKeyDown:F=>{F.key==="Enter"&&ye()}}),r.jsx("button",{className:"entry-submit-btn",onClick:ye,disabled:O||!Ue.trim(),children:O?"...":""})]})]})}):r.jsx("div",{className:"entry-container",children:r.jsxs("div",{className:"entry-card",children:[r.jsx("button",{className:"entry-back",onClick:()=>{J(2),ee("")},children:""}),r.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),r.jsx("div",{className:"entry-company-badge",children:xe?.name}),r.jsx("p",{className:"entry-subtitle",children:"Create your account"}),r.jsxs("div",{className:"entry-form",children:[r.jsx("input",{type:"text",value:ve,onChange:F=>Ve(F.target.value),placeholder:"Your Name",autoFocus:!0}),r.jsx("input",{type:"email",value:Me,onChange:F=>M(F.target.value),placeholder:"Email"}),r.jsx("input",{type:"password",value:G,onChange:F=>ne(F.target.value),placeholder:"Password (6+ characters)",onKeyDown:F=>{F.key==="Enter"&&qe()}}),r.jsx("button",{className:"entry-login-btn",onClick:qe,disabled:O,children:O?"Creating...":"Join Company"})]}),r.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})})}function hr({message:s,type:l="",onClose:i}){return w.useEffect(()=>{const o=setTimeout(i,3e3);return()=>clearTimeout(o)},[i]),r.jsx("div",{className:"toast-container",children:r.jsx("div",{className:`toast ${l}`,children:s})})}function eu({compact:s=!1}){const{theme:l,toggleTheme:i}=$g();return r.jsx("button",{className:`theme-toggle ${s?"theme-toggle-compact":""}`,onClick:i,title:`Switch to ${l==="dark"?"light":"dark"} mode`,"aria-label":`Switch to ${l==="dark"?"light":"dark"} mode`,children:l==="dark"?r.jsxs(r.Fragment,{children:[r.jsx(Z_,{size:s?18:16}),!s&&r.jsx("span",{children:"Light"})]}):r.jsxs(r.Fragment,{children:[r.jsx(T_,{size:s?18:16}),!s&&r.jsx("span",{children:"Dark"})]})})}class ts extends w.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0}}componentDidCatch(l,i){this.setState({error:l,errorInfo:i}),console.error("ErrorBoundary caught an error:",l,i)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?r.jsx("div",{className:"error-boundary",children:r.jsxs("div",{className:"error-boundary-content",children:[r.jsx("div",{className:"error-icon",children:r.jsx(lu,{size:48})}),r.jsx("h2",{children:"Something went wrong"}),r.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),r.jsxs("div",{className:"error-actions",children:[r.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),r.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function rh(){const[s,l]=w.useState(ga()),[i,o]=w.useState(0),[d,m]=w.useState(!1),[p,y]=w.useState(!1);return w.useEffect(()=>{const b=nu(async B=>{l(B),B&&p&&(m(!0),setTimeout(()=>m(!1),3e3)),B||y(!0);const O=await ji();o(O)});ji().then(o);const z=setInterval(async()=>{if(!ga()){const B=await ji();o(B)}},5e3);return()=>{b(),clearInterval(z)}},[p]),s&&i===0&&!d?null:r.jsxs("div",{className:`offline-indicator ${s?"online":"offline"} ${d?"synced":""}`,children:[r.jsx("div",{className:"offline-indicator-content",children:s?d?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"online-icon",children:r.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("polyline",{points:"20 6 9 17 4 12"})})}),r.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):i>0?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"syncing-icon",children:r.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("polyline",{points:"23 4 23 10 17 10"}),r.jsx("polyline",{points:"1 20 1 14 7 14"}),r.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),r.jsxs("span",{className:"offline-text",children:["Syncing ",i,"..."]})]}):null:r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"offline-icon",children:r.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),r.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),r.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),r.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),r.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),r.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),r.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),r.jsxs("span",{className:"offline-text",children:["Offline",i>0&&r.jsxs("span",{className:"pending-badge",children:[i," pending"]})]})]})}),r.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function My(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function oy(s){if(!s||s.length===0)return 0;let l=0;return s.forEach(i=>{i.status==="done"&&(l+=i.weight||0)}),Math.round(l)}function zy(s){if(!s||s.length===0)return{progress:0,earnedValue:0,totalValue:0,isValueBased:!1};if(s.some(o=>o.scheduled_value>0)){const o=s.reduce((p,y)=>p+(y.scheduled_value||0),0),d=s.filter(p=>p.status==="done").reduce((p,y)=>p+(y.scheduled_value||0),0);return{progress:o>0?Math.round(d/o*100):0,earnedValue:d,totalValue:o,isValueBased:!0}}const i=s.filter(o=>o.status==="done").reduce((o,d)=>o+(d.weight||0),0);return{progress:Math.round(i),earnedValue:0,totalValue:0,isValueBased:!1}}function cy(s){if(!s||s.length===0)return"not_started";const l=s.some(d=>d.status==="working"),i=s.some(d=>d.status==="done");return s.every(d=>d.status==="done")?"done":l||i?"working":"not_started"}function Ry(s){const l=cy(s);return l==="done"?"Complete":l==="working"?"In Progress":"Not Started"}function Uy(s,l=0){const i=new Date;i.setHours(0,0,0,0);const o={scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1};if(s.start_date&&s.end_date){const d=new Date(s.start_date),m=new Date(s.end_date);d.setHours(0,0,0,0),m.setHours(0,0,0,0);const p=Math.max(1,Math.ceil((m-d)/(1e3*60*60*24))),y=Math.max(0,Math.ceil((i-d)/(1e3*60*60*24))),b=Math.min(100,y/p*100),B=(s.progress||0)-b;o.scheduleVariance=Math.round(B),o.hasScheduleData=!0,B>5?(o.scheduleStatus="ahead",o.scheduleLabel=`Ahead of Schedule (+${o.scheduleVariance}%)`):B<-5?(o.scheduleStatus="behind",o.scheduleLabel=`Behind Schedule (${o.scheduleVariance}%)`):(o.scheduleStatus="on_track",o.scheduleLabel="On Track")}if(s.planned_man_days&&s.planned_man_days>0){const m=(s.progress||0)/100*s.planned_man_days;if(m>0&&l>0){const p=(l-m)/m*100;o.laborVariance=Math.round(p),o.hasLaborData=!0,p>10?(o.laborStatus="over",o.laborLabel=`Over Planned (+${o.laborVariance}% man-days)`):p<-10?(o.laborStatus="under",o.laborLabel=`Under Planned (${o.laborVariance}% man-days)`):(o.laborStatus="on_track",o.laborLabel="Labor On Track")}else l>0&&(o.hasLaborData=!0,o.laborLabel=`${l} man-days used`)}return o}function Hy(s,l=30){if(s.status==="archived"||s.progress<100)return!1;const i=s.areas||[];if(i.length===0||!i.every(p=>p.status==="done"))return!1;const d=i.reduce((p,y)=>{const b=new Date(y.updated_at);return b>p?b:p},new Date(0));return d.getTime()===0?!1:Math.floor((Date.now()-d.getTime())/(1e3*60*60*24))>=l}const Ly=s=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[59,130,246]},By=(s,l=5e3)=>new Promise(i=>{if(!s){i(null);return}const o=new Image;o.crossOrigin="anonymous";const d=setTimeout(()=>{o.src="",i(null)},l);o.onload=()=>{clearTimeout(d);try{const m=document.createElement("canvas");m.width=o.width,m.height=o.height,m.getContext("2d").drawImage(o,0,0),i(m.toDataURL("image/png"))}catch{i(null)}},o.onerror=()=>{clearTimeout(d),i(null)},o.src=s});async function sh(s,l=1920,i=.8){return!s.type.startsWith("image/")||s.size<500*1024?s:new Promise(o=>{const d=document.createElement("canvas"),m=d.getContext("2d"),p=new Image;p.onload=()=>{let{width:y,height:b}=p;y>l&&(b=Math.round(b*l/y),y=l);const z=1920;b>z&&(y=Math.round(y*z/b),b=z),d.width=y,d.height=b,m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high",m.drawImage(p,0,0,y,b),d.toBlob(B=>{if(B){const O=s.name.replace(/\.[^/.]+$/,""),$=new File([B],`${O}.jpg`,{type:"image/jpeg",lastModified:Date.now()});o($)}else console.warn("Image compression failed, using original"),o(s)},"image/jpeg",i),URL.revokeObjectURL(p.src)},p.onerror=()=>{console.warn("Failed to load image for compression, using original"),URL.revokeObjectURL(p.src),o(s)},p.src=URL.createObjectURL(s)})}function uy(){w.useEffect(()=>{const s=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${s}px`,document.body.style.width="100%",()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.top="",document.body.style.width="",window.scrollTo(0,s)}},[])}const lh=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";function dy({documentType:s,documentId:l,companyId:i,projectId:o,documentTitle:d="",onClose:m,onShowToast:p}){const[y,b]=w.useState(!0),[z,B]=w.useState(!1),[O,$]=w.useState([]),[W,te]=w.useState(null),[V,oe]=w.useState(!1),ae="7";uy(),w.useEffect(()=>{me()},[s,l]);const me=async()=>{try{b(!0);const ee=await _e.getSignatureRequestsForDocument(s,l);$(ee||[])}catch(ee){console.error("Error loading signature requests:",ee)}finally{b(!1)}},ue=async()=>{try{B(!0);let ee=null;if(ae!=="never"){const Ve=parseInt(ae);ee=new Date,ee.setDate(ee.getDate()+Ve),ee=ee.toISOString()}const ve=await _e.createSignatureRequest(s,l,i,o,null,ee);if(ve){const Ve=`${window.location.origin}/sign/${ve.signature_token}`;te(Ve),await me(),p?.("Signature link created","success")}}catch(ee){console.error("Error generating signature link:",ee),p?.("Failed to create signature link","error")}finally{B(!1)}},J=async ee=>{try{await navigator.clipboard.writeText(ee),oe(!0),p?.("Link copied to clipboard","success"),setTimeout(()=>oe(!1),2e3)}catch(ve){console.error("Error copying to clipboard:",ve)}},xe=async ee=>{if(confirm("Are you sure you want to revoke this signature link? It will no longer be usable."))try{await _e.revokeSignatureRequest(ee),await me(),p?.("Signature link revoked","success")}catch(ve){console.error("Error revoking signature request:",ve),p?.("Failed to revoke link","error")}},ke=ee=>{switch(ee){case"pending":return{label:"Awaiting Signatures",color:"#f59e0b",bg:"#fef3c7"};case"partially_signed":return{label:"1 of 2 Signed",color:"#3b82f6",bg:"#dbeafe"};case"completed":return{label:"Fully Signed",color:"#10b981",bg:"#d1fae5"};case"revoked":return{label:"Revoked",color:"#ef4444",bg:"#fee2e2"};case"expired":return{label:"Expired",color:"#6b7280",bg:"#f3f4f6"};default:return{label:ee,color:"#6b7280",bg:"#f3f4f6"}}},Ue=s==="cor"?"Change Order":"T&M Ticket";return r.jsx("div",{className:"modal-overlay",onClick:m,role:"dialog","aria-modal":"true",children:r.jsxs("div",{className:"modal-content signature-link-modal",onClick:ee=>ee.stopPropagation(),children:[r.jsxs("div",{className:"modal-header",children:[r.jsxs("div",{children:[r.jsx("h2",{children:"Get Signature Link"}),d&&r.jsx("span",{className:"modal-subtitle",children:d})]}),r.jsx("button",{className:"close-btn",onClick:m,"aria-label":"Close",children:r.jsx(iu,{size:20})})]}),r.jsxs("div",{className:"modal-body",children:[r.jsxs("div",{className:"signature-link-section",children:[r.jsxs("h3",{children:[r.jsx(Sh,{size:16}),"Create New Signature Link"]}),r.jsxs("p",{className:"section-description",children:["Generate a secure link that allows GC/Client to sign this ",Ue," without logging in."]}),r.jsxs("div",{className:"link-options",children:[r.jsxs("div",{className:"link-expiration-info",children:[r.jsx(Is,{size:14}),r.jsx("span",{children:"Link expires in 7 days"})]}),r.jsx("button",{className:"btn btn-primary",onClick:ue,disabled:z,children:z?"Generating...":"Generate Link"})]}),W&&r.jsxs("div",{className:"new-link-box",children:[r.jsxs("div",{className:"link-display",children:[r.jsx("input",{type:"text",value:W,readOnly:!0,className:"link-input"}),r.jsxs("button",{className:"btn btn-secondary copy-btn",onClick:()=>J(W),children:[V?r.jsx(na,{size:16}):r.jsx($c,{size:16}),V?"Copied!":"Copy"]})]}),r.jsxs("a",{href:W,target:"_blank",rel:"noopener noreferrer",className:"preview-link",children:[r.jsx(ah,{size:14}),"Preview link"]})]})]}),r.jsxs("div",{className:"signature-link-section",children:[r.jsxs("h3",{children:[r.jsx(Is,{size:16}),"Existing Signature Links"]}),y?r.jsx("div",{className:"loading-inline",children:"Loading..."}):O.length===0?r.jsxs("p",{className:"empty-state",children:["No signature links have been created for this ",Ue,"."]}):r.jsx("div",{className:"existing-links-list",children:O.map(ee=>{const ve=ke(ee.status),Ve=`${window.location.origin}/sign/${ee.signature_token}`,Me=ee.signatures?.length||0;return r.jsxs("div",{className:"existing-link-card",children:[r.jsxs("div",{className:"link-card-header",children:[r.jsx("span",{className:"status-badge",style:{color:ve.color,backgroundColor:ve.bg},children:ve.label}),r.jsxs("span",{className:"link-created",children:["Created ",lh(ee.created_at)]})]}),r.jsxs("div",{className:"link-card-body",children:[r.jsxs("div",{className:"link-info",children:[r.jsxs("span",{className:"link-token",children:["...",ee.signature_token.slice(-8)]}),ee.expires_at&&r.jsxs("span",{className:"link-expires",children:["Expires ",lh(ee.expires_at)]}),r.jsxs("span",{className:"link-views",children:[ee.view_count," view",ee.view_count!==1?"s":""]})]}),Me>0&&r.jsx("div",{className:"signatures-summary",children:ee.signatures.map(M=>r.jsxs("div",{className:"sig-item",children:[r.jsx(na,{size:12}),r.jsxs("span",{children:["Slot ",M.signature_slot,": ",M.signer_name,M.signer_company&&` (${M.signer_company})`]})]},M.id))})]}),r.jsxs("div",{className:"link-card-actions",children:[ee.status!=="revoked"&&ee.status!=="expired"&&r.jsxs(r.Fragment,{children:[r.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>J(Ve),children:[r.jsx($c,{size:14})," Copy"]}),r.jsxs("a",{href:Ve,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-small",children:[r.jsx(ah,{size:14})," Open"]})]}),ee.status!=="completed"&&ee.status!=="revoked"&&r.jsxs("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>xe(ee.id),children:[r.jsx(J_,{size:14})," Revoke"]})]})]},ee.id)})})]}),r.jsxs("div",{className:"signature-info-box",children:[r.jsx(Ps,{size:16}),r.jsxs("div",{children:[r.jsx("strong",{children:"How it works:"}),r.jsxs("ul",{children:[r.jsx("li",{children:"Share the link with your GC or Client"}),r.jsx("li",{children:"They can view the document and sign without logging in"}),r.jsx("li",{children:"Supports 2 signatures (GC + Client)"}),r.jsx("li",{children:"Signatures are recorded with name, title, company, date, and IP"})]})]})]})]}),r.jsx("div",{className:"modal-footer",children:r.jsx("button",{className:"btn btn-secondary",onClick:m,children:"Close"})})]})})}function my({ticketId:s,ticketSummary:l,lang:i="en",onSave:o,onClose:d,onShowToast:m}){const p=w.useRef(null),[y,b]=w.useState(""),[z,B]=w.useState(""),[O,$]=w.useState(""),[W,te]=w.useState(!1),[V,oe]=w.useState(!1),[ae,me]=w.useState(!1),ue={en:{title:"Client Signature",subtitle:"Sign to verify the work performed",signerName:"Your Name",signerNamePlaceholder:"Full name",signerTitle:"Title",signerTitlePlaceholder:"e.g. Project Manager",signerCompany:"Company",signerCompanyPlaceholder:"Company name",signBelow:"Sign below",signHere:"Sign here",clear:"Clear",cancel:"Cancel",saveSignature:"Submit Signature",saving:"Saving...",workDate:"Work Date",workers:"Workers",hours:"Total Hours",certification:"By signing, I acknowledge that the work described in this T&M ticket was performed as documented.",nameRequired:"Please enter your name",signatureRequired:"Please sign above",signatureSaved:"Signature saved successfully",signatureError:"Error saving signature"},es:{title:"Firma del Cliente",subtitle:"Firme para verificar el trabajo realizado",signerName:"Su Nombre",signerNamePlaceholder:"Nombre completo",signerTitle:"Titulo",signerTitlePlaceholder:"ej. Gerente de Proyecto",signerCompany:"Empresa",signerCompanyPlaceholder:"Nombre de la empresa",signBelow:"Firme abajo",signHere:"Firme aqui",clear:"Borrar",cancel:"Cancelar",saveSignature:"Enviar Firma",saving:"Guardando...",workDate:"Fecha",workers:"Trabajadores",hours:"Horas Total",certification:"Al firmar, reconozco que el trabajo descrito en este ticket T&M fue realizado como se documenta.",nameRequired:"Por favor ingrese su nombre",signatureRequired:"Por favor firme arriba",signatureSaved:"Firma guardada exitosamente",signatureError:"Error al guardar la firma"}},J=ue[i]||ue.en,xe=()=>{const G=p.current;return G?G.getContext("2d"):null},ke=G=>{const ne=p.current;if(!ne)return{x:0,y:0};const pe=ne.getBoundingClientRect(),C=ne.width/pe.width,X=ne.height/pe.height,I=G.touches?G.touches[0].clientX:G.clientX,Se=G.touches?G.touches[0].clientY:G.clientY;return{x:(I-pe.left)*C,y:(Se-pe.top)*X}},Ue=G=>{G.preventDefault();const ne=xe();if(!ne)return;const{x:pe,y:C}=ke(G);ne.beginPath(),ne.moveTo(pe,C),oe(!0),te(!0)},ee=G=>{if(!V)return;G.preventDefault();const ne=xe();if(!ne)return;const{x:pe,y:C}=ke(G);ne.lineTo(pe,C),ne.stroke()},ve=()=>{oe(!1)},Ve=()=>{const G=p.current,ne=xe();!G||!ne||(ne.clearRect(0,0,G.width,G.height),te(!1))},Me=G=>{if(!G)return;p.current=G;const ne=G.getContext("2d");ne.strokeStyle="#1e293b",ne.lineWidth=2,ne.lineCap="round",ne.lineJoin="round"},M=async()=>{if(!y.trim()){m?.(J.nameRequired,"error");return}if(!W){m?.(J.signatureRequired,"error");return}const G=p.current;if(G){me(!0);try{const ne=G.toDataURL("image/png");await _e.saveTMClientSignature(s,{signature:ne,signerName:y.trim(),signerTitle:z.trim()||null,signerCompany:O.trim()||null,signedAt:new Date().toISOString()}),m?.(J.signatureSaved,"success"),o?.({signerName:y.trim(),signerTitle:z.trim(),signerCompany:O.trim()})}catch(ne){console.error("Error saving signature:",ne),m?.(J.signatureError,"error")}finally{me(!1)}}};return r.jsx("div",{className:"tm-modal-overlay",onClick:d,children:r.jsxs("div",{className:"tm-client-signature-modal",onClick:G=>G.stopPropagation(),children:[r.jsxs("div",{className:"tm-sig-header",children:[r.jsxs("div",{children:[r.jsx("h2",{children:J.title}),r.jsx("p",{className:"tm-sig-subtitle",children:J.subtitle})]}),r.jsx("button",{className:"tm-sig-close",onClick:d,children:r.jsx(iu,{size:20})})]}),r.jsxs("div",{className:"tm-sig-body",children:[l&&r.jsxs("div",{className:"tm-sig-summary",children:[r.jsxs("div",{className:"tm-sig-summary-item",children:[r.jsx("span",{className:"tm-sig-summary-label",children:J.workDate}),r.jsx("span",{className:"tm-sig-summary-value",children:new Date(l.workDate).toLocaleDateString()})]}),r.jsxs("div",{className:"tm-sig-summary-item",children:[r.jsx("span",{className:"tm-sig-summary-label",children:J.workers}),r.jsx("span",{className:"tm-sig-summary-value",children:l.workerCount})]}),r.jsxs("div",{className:"tm-sig-summary-item",children:[r.jsx("span",{className:"tm-sig-summary-label",children:J.hours}),r.jsx("span",{className:"tm-sig-summary-value",children:l.totalHours})]})]}),r.jsxs("div",{className:"tm-sig-fields",children:[r.jsxs("div",{className:"tm-sig-field",children:[r.jsxs("label",{children:[r.jsx(ay,{size:14}),J.signerName," *"]}),r.jsx("input",{type:"text",value:y,onChange:G=>b(G.target.value),placeholder:J.signerNamePlaceholder})]}),r.jsxs("div",{className:"tm-sig-field-row",children:[r.jsxs("div",{className:"tm-sig-field",children:[r.jsxs("label",{children:[r.jsx(xh,{size:14}),J.signerTitle]}),r.jsx("input",{type:"text",value:z,onChange:G=>B(G.target.value),placeholder:J.signerTitlePlaceholder})]}),r.jsxs("div",{className:"tm-sig-field",children:[r.jsxs("label",{children:[r.jsx(r_,{size:14}),J.signerCompany]}),r.jsx("input",{type:"text",value:O,onChange:G=>$(G.target.value),placeholder:J.signerCompanyPlaceholder})]})]})]}),r.jsxs("div",{className:"tm-sig-area",children:[r.jsxs("div",{className:"tm-sig-label",children:[r.jsx(M_,{size:14}),r.jsx("span",{children:J.signBelow})]}),r.jsxs("div",{className:"tm-sig-canvas-container",children:[r.jsx("canvas",{ref:Me,width:500,height:180,className:"tm-sig-canvas",onMouseDown:Ue,onMouseMove:ee,onMouseUp:ve,onMouseLeave:ve,onTouchStart:Ue,onTouchMove:ee,onTouchEnd:ve}),!W&&r.jsx("div",{className:"tm-sig-placeholder",children:J.signHere})]}),r.jsxs("button",{className:"tm-sig-clear",onClick:Ve,disabled:!W,children:[r.jsx(Wc,{size:14})," ",J.clear]})]}),r.jsx("p",{className:"tm-sig-certification",children:J.certification})]}),r.jsxs("div",{className:"tm-sig-footer",children:[r.jsx("button",{className:"tm-sig-btn secondary",onClick:d,disabled:ae,children:J.cancel}),r.jsx("button",{className:"tm-sig-btn primary",onClick:M,disabled:!W||!y.trim()||ae,children:ae?J.saving:r.jsxs(r.Fragment,{children:[r.jsx(na,{size:16})," ",J.saveSignature]})})]})]})})}const ih=()=>{const s=new Uint8Array(6);return crypto.getRandomValues(s),Array.from(s,l=>l.toString(36)).join("")},Qc=["Containment","PPE","Disposal","Equipment"],fy={en:{workInfo:"Work Details",crewHours:"Crew & Hours",materialsEquipment:"Materials",evidence:"Evidence",review:"Review",quickActions:"Quick Actions",sameAsYesterday:"Same as Yesterday",setCrewHours:"Set Crew Hours",loading:"Loading...",supervision:"Supervision",operators:"Operators",laborers:"Laborers",addSupervision:"+ Add Supervision",addOperator:"+ Add Operator",addLaborer:"+ Add Laborer",foreman:"Foreman",superintendent:"Superintendent",firstLastName:"First & Last Name",start:"Start",end:"End",regHrs:"Reg Hrs",otHrs:"OT Hrs",selectCategory:"Select a category:",addCustomItem:"+ Add Custom Item",customItem:"Custom Item",itemName:"Item Name",category:"Category",quantity:"Quantity",addItem:"Add Item",cancel:"Cancel",noItemsCategory:"No items in this category yet",workDate:"Work Date",ceNumber:"CE/PCO #",optional:"optional",linkedCOR:"Link to Change Order",selectCOR:"Select COR (optional)",noCORs:"No pending CORs",laborSummary:"Labor Summary",worker:"worker",workers_plural:"workers",totalHours:"Total Hours",regular:"Regular",overtime:"Overtime",materials:"Materials",item:"item",items_plural:"items",noMaterials:"No materials added",notes:"Notes",addNotes:"Add notes about the work performed...",photos:"Photos",addPhotos:"Add Photos",maxPhotos:"max",noPhotos:"No photos added",certification:"Certification",certifyStatement:"I certify that this T&M ticket accurately reflects the work performed.",foremanSignature:"Foreman's Name (Signature)",yourName:"Your name",describeWork:"Describe the work performed",descriptionRequired:"Description is required",whatWorkPerformed:"What work was performed today?",searchMaterials:"Search materials & equipment...",noSearchResults:"No items found",orBrowse:"Or browse by category:",back:"Back",next:"Next",nextCrew:"Next: Crew",nextMaterials:"Next: Materials",reviewItems:"Review",skipNoMaterials:"Skip (no materials)",submitTM:"Submit T&M",submitting:"Submitting...",applySameHours:"Apply Same Hours",batchDescription:"Set start/end time and hours for all workers with names entered.",timeStarted:"Time Started",timeEnded:"Time Ended",regularHours:"Regular Hours",overtimeHours:"Overtime Hours",willApplyTo:"Will apply to",applyToAll:"Apply to All",preset8hr:"8hr Day",preset10hr:"10hr Day",preset4hr:"4hr Day",loadedWorkers:"Loaded {count} workers from {date}",noPreviousCrew:"No previous crew found for this project",appliedHours:"Applied hours to {count} worker(s)",assignedToCOR:"Assigned to COR"},es:{workInfo:"Info del Trabajo",crewHours:"Cuadrilla y Horas",materialsEquipment:"Materiales",evidence:"Evidencia",review:"Revisar",quickActions:"Acciones Rapidas",sameAsYesterday:"Igual que Ayer",setCrewHours:"Poner Horas",loading:"Cargando...",supervision:"Supervision",operators:"Operadores",laborers:"Trabajadores",addSupervision:"+ Agregar Supervision",addOperator:"+ Agregar Operador",addLaborer:"+ Agregar Trabajador",foreman:"Capataz",superintendent:"Superintendente",firstLastName:"Nombre y Apellido",start:"Inicio",end:"Fin",regHrs:"Hrs Reg",otHrs:"Hrs Extra",selectCategory:"Seleccione una categoria:",addCustomItem:"+ Agregar Articulo",customItem:"Articulo Personalizado",itemName:"Nombre del Articulo",category:"Categoria",quantity:"Cantidad",addItem:"Agregar",cancel:"Cancelar",noItemsCategory:"No hay articulos en esta categoria",workDate:"Fecha de Trabajo",ceNumber:"CE/PCO #",optional:"opcional",linkedCOR:"Vincular a Orden de Cambio",selectCOR:"Seleccionar COR (opcional)",noCORs:"No hay CORs pendientes",laborSummary:"Resumen de Mano de Obra",worker:"trabajador",workers_plural:"trabajadores",totalHours:"Horas Totales",regular:"Regular",overtime:"Extra",materials:"Materiales",item:"articulo",items_plural:"articulos",noMaterials:"No se agregaron materiales",notes:"Notas",addNotes:"Agregar notas sobre el trabajo realizado...",photos:"Fotos",addPhotos:"Agregar Fotos",maxPhotos:"max",noPhotos:"No se agregaron fotos",certification:"Certificacion",certifyStatement:"Certifico que este ticket T&M refleja con precision el trabajo realizado.",foremanSignature:"Nombre del Capataz (Firma)",yourName:"Su nombre",describeWork:"Describir el trabajo realizado",descriptionRequired:"Descripcion es requerida",whatWorkPerformed:"Que trabajo se realizo hoy?",searchMaterials:"Buscar materiales y equipo...",noSearchResults:"No se encontraron articulos",orBrowse:"O navegar por categoria:",back:"Atras",next:"Siguiente",nextCrew:"Siguiente: Cuadrilla",nextMaterials:"Siguiente: Materiales",reviewItems:"Revisar",skipNoMaterials:"Saltar (sin materiales)",submitTM:"Enviar T&M",submitting:"Enviando...",applySameHours:"Aplicar Mismas Horas",batchDescription:"Establezca hora de inicio/fin y horas para todos los trabajadores.",timeStarted:"Hora de Inicio",timeEnded:"Hora de Fin",regularHours:"Horas Regulares",overtimeHours:"Horas Extra",willApplyTo:"Se aplicara a",applyToAll:"Aplicar a Todos",preset8hr:"Dia 8hr",preset10hr:"Dia 10hr",preset4hr:"Dia 4hr",loadedWorkers:"Se cargaron {count} trabajadores del {date}",noPreviousCrew:"No se encontro equipo anterior para este proyecto",appliedHours:"Horas aplicadas a {count} trabajador(es)",assignedToCOR:"Asignado a COR"}};function hy({project:s,companyId:l,maxPhotos:i=10,onSubmit:o,onCancel:d,onShowToast:m}){const[p,y]=w.useState(1),[b,z]=w.useState(new Date().toISOString().split("T")[0]),[B,O]=w.useState(null),[$,W]=w.useState(!1),[te,V]=w.useState(!1),[oe,ae]=w.useState(!1),[me,ue]=w.useState(""),[J,xe]=w.useState(""),[ke,Ue]=w.useState(""),[ee,ve]=w.useState([]),[Ve,Me]=w.useState(!1),[M,G]=w.useState(!1),[ne,pe]=w.useState({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),[C,X]=w.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}]),[I,Se]=w.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[Y,je]=w.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[P,ye]=w.useState([]),[qe,F]=w.useState(""),[fe,Be]=w.useState([]),[le,Ce]=w.useState(!1),[Fe,Le]=w.useState(""),[rt,xt]=w.useState([]),[Ze,ra]=w.useState(!1),[ot,St]=w.useState(null),[yr,mn]=w.useState([]),[Xn,Ra]=w.useState(!1),[fn,hn]=w.useState(""),[yt,Ua]=w.useState([]),[Vn,Zn]=w.useState([]),[sa,Ha]=w.useState(!1),[vt,La]=w.useState({name:"",category:"",quantity:""}),Kn=w.useRef(null),[ya,wt]=w.useState(!1),[se,kt]=w.useState("en"),Z=h=>fy[se][h]||h,[as,vr]=w.useState([]),[va,pn]=w.useState([]),[Nt,qt]=w.useState({}),[Ea,ka]=w.useState(!0),Dt=va.length>0,K=(h,S)=>{if(!h||!S)return null;const[T,q]=h.split(":").map(Number),[U,Q]=S.split(":").map(Number);let ie=U*60+Q-(T*60+q);ie<0&&(ie+=1440);const he=ie/60,ft=Math.min(he,8),$e=Math.max(0,he-8);return{hours:ft.toFixed(1),overtimeHours:$e>0?$e.toFixed(1):""}},Ut=h=>{if(!h)return"empty";const S=h.name&&h.name.trim()!=="",T=parseFloat(h.hours)>0||parseFloat(h.overtimeHours)>0;return S?T?"complete":"incomplete":"empty"},ba=h=>{let S,T,q,U;switch(h){case"full":S="07:00",T="15:30",q="8",U="";break;case"10hr":S="06:00",T="16:30",q="8",U="2";break;case"half":S="07:00",T="11:00",q="4",U="";break;default:return}pe({timeStarted:S,timeEnded:T,hours:q,overtimeHours:U})};w.useEffect(()=>{nl(),tl()},[s.id]),w.useEffect(()=>{(async()=>{if(!l){ka(!1);return}try{const S=await _e.getLaborClassesForField(l);if(vr(S.categories||[]),pn(S.classes||[]),S.classes&&S.classes.length>0){const T={};S.classes.forEach(q=>{T[q.id]=[{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}),qt(T)}}catch(S){console.error("Error loading labor classes:",S)}finally{ka(!1)}})()},[l]);const tl=async()=>{Me(!0);try{const h=await _e.getAssignableCORs(s.id);ve(h||[])}catch(h){console.error("Error loading assignable CORs:",h)}finally{Me(!1)}},al=()=>{const{timeStarted:h,timeEnded:S,hours:T,overtimeHours:q}=ne;X(C.map(Q=>Q&&Q.name&&Q.name.trim()?{...Q,timeStarted:h,timeEnded:S,hours:T,overtimeHours:q}:Q)),Se(I.map(Q=>Q&&Q.name&&Q.name.trim()?{...Q,timeStarted:h,timeEnded:S,hours:T,overtimeHours:q}:Q)),je(Y.map(Q=>Q&&Q.name&&Q.name.trim()?{...Q,timeStarted:h,timeEnded:S,hours:T,overtimeHours:q}:Q));const U=[...C.filter(Q=>Q&&Q.name&&Q.name.trim()),...I.filter(Q=>Q&&Q.name&&Q.name.trim()),...Y.filter(Q=>Q&&Q.name&&Q.name.trim())].length;G(!1),pe({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),m(`Applied hours to ${U} worker${U!==1?"s":""}`,"success")},br=h=>{let S,T,q,U;switch(h){case"8hr":S="07:00",T="15:30",q="8",U="";break;case"10hr":S="06:00",T="16:30",q="8",U="2";break;case"4hr":S="07:00",T="11:00",q="4",U="";break;default:return}X(ie=>ie.map(he=>he&&he.name&&he.name.trim()?{...he,timeStarted:S,timeEnded:T,hours:q,overtimeHours:U}:he)),Se(ie=>ie.map(he=>he&&he.name&&he.name.trim()?{...he,timeStarted:S,timeEnded:T,hours:q,overtimeHours:U}:he)),je(ie=>ie.map(he=>he&&he.name&&he.name.trim()?{...he,timeStarted:S,timeEnded:T,hours:q,overtimeHours:U}:he));const Q=[...C.filter(ie=>ie&&ie.name&&ie.name.trim()),...I.filter(ie=>ie&&ie.name&&ie.name.trim()),...Y.filter(ie=>ie&&ie.name&&ie.name.trim())].length;Q>0?m(Z("appliedHours").replace("{count}",Q),"success"):m(se==="en"?"Add workers first":"Agregue trabajadores primero","info")},nl=async()=>{try{const h=await _e.getCrewCheckin(s.id);h?.workers&&xt(h.workers)}catch(h){console.error("Error loading crew:",h)}};w.useEffect(()=>{ot&&l&&ns(ot)},[ot,l]),w.useEffect(()=>{p===3&&Kn.current&&!ot&&setTimeout(()=>{Kn.current?.focus()},100)},[p,ot]);const ns=async h=>{Ra(!0);try{const S=await _e.getMaterialsEquipmentByCategory(l,h);mn(S)}catch(S){console.error("Error loading items:",S),m("Error loading items","error")}finally{Ra(!1)}},rs=async()=>{if(!(Vn.length>0))try{const h=[];for(const S of Qc){const T=await _e.getMaterialsEquipmentByCategory(l,S);h.push(...T.map(q=>({...q,category:S})))}Zn(h)}catch(h){console.error("Error loading all materials:",h)}},rl=h=>{if(hn(h),!h.trim()){Ua([]);return}const S=h.toLowerCase(),T=Vn.filter(q=>q.name.toLowerCase().includes(S)||q.category.toLowerCase().includes(S));Ua(T.slice(0,10))},sl=async()=>{wt(!0);try{const h=await _e.getPreviousTicketCrew(s.id,b);if(!h||h.totalWorkers===0){m("No previous crew found for this project","info");return}h.supervision&&X(h.supervision),h.operators&&Se(h.operators),h.laborers&&je(h.laborers);const S=new Date(h.workDate).toLocaleDateString();m(`Loaded ${h.totalWorkers} workers from ${S}`,"success")}catch(h){console.error("Error loading previous crew:",h),m("Error loading previous crew","error")}finally{wt(!1)}},qa=()=>{X([...C,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},tt=(h,S,T)=>{X(C.map((q,U)=>{if(U!==h)return q;const Q={...q,[S]:T};if(S==="timeStarted"||S==="timeEnded"){const ie=S==="timeStarted"?T:q.timeStarted,he=S==="timeEnded"?T:q.timeEnded,ft=K(ie,he);ft&&(Q.hours=ft.hours,Q.overtimeHours=ft.overtimeHours)}return Q}))},Rt=h=>{C.length>1?X(C.filter((S,T)=>T!==h)):X([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},gn=()=>{je([...Y,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Da=(h,S,T)=>{je(Y.map((q,U)=>{if(U!==h)return q;const Q={...q,[S]:T};if(S==="timeStarted"||S==="timeEnded"){const ie=S==="timeStarted"?T:q.timeStarted,he=S==="timeEnded"?T:q.timeEnded,ft=K(ie,he);ft&&(Q.hours=ft.hours,Q.overtimeHours=ft.overtimeHours)}return Q}))},Ni=h=>{Y.length>1?je(Y.filter((S,T)=>T!==h)):je([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Ci=()=>{Se([...I,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Ba=(h,S,T)=>{Se(I.map((q,U)=>{if(U!==h)return q;const Q={...q,[S]:T};if(S==="timeStarted"||S==="timeEnded"){const ie=S==="timeStarted"?T:q.timeStarted,he=S==="timeEnded"?T:q.timeEnded,ft=K(ie,he);ft&&(Q.hours=ft.hours,Q.overtimeHours=ft.overtimeHours)}return Q}))},Jn=h=>{I.length>1?Se(I.filter((S,T)=>T!==h)):Se([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},jr=h=>{qt(S=>({...S,[h]:[...S[h]||[],{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}))},Tt=(h,S,T,q)=>{qt(U=>({...U,[h]:(U[h]||[]).map((Q,ie)=>{if(ie!==S)return Q;const he={...Q,[T]:q};if(T==="timeStarted"||T==="timeEnded"){const ft=T==="timeStarted"?q:Q.timeStarted,$e=T==="timeEnded"?q:Q.timeEnded,bt=K(ft,$e);bt&&(he.hours=bt.hours,he.overtimeHours=bt.overtimeHours)}return he})}))},Ya=(h,S)=>{qt(T=>{const q=T[h]||[];return q.length>1?{...T,[h]:q.filter((U,Q)=>Q!==S)}:{...T,[h]:[{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}})},Ga=()=>{if(!Nt||typeof Nt!="object")return[];const h=[];return Object.entries(Nt).forEach(([S,T])=>{if(!Array.isArray(T))return;const q=va.find(U=>U.id===S);T.forEach(U=>{U&&U.name&&U.name.trim()&&(parseFloat(U.hours)>0||parseFloat(U.overtimeHours)>0)&&h.push({name:U.name.trim(),hours:parseFloat(U.hours)||0,overtime_hours:parseFloat(U.overtimeHours)||0,time_started:U.timeStarted||null,time_ended:U.timeEnded||null,role:q?.name||"Worker",labor_class_id:S})})}),h},_n=h=>{const S=P.findIndex(T=>T.material_equipment_id===h.id);S>=0?ye(P.map((T,q)=>q===S?{...T,quantity:T.quantity+1}:T)):ye([...P,{material_equipment_id:h.id,name:h.name,unit:h.unit,category:h.category,quantity:1,isCustom:!1}]),m(`Added ${h.name}`,"success")},mt=()=>{if(!vt.name||!vt.category||!vt.quantity){m("Fill in all fields","error");return}ye([...P,{material_equipment_id:null,custom_name:vt.name,custom_category:vt.category,name:vt.name,category:vt.category,quantity:parseFloat(vt.quantity),unit:"each",isCustom:!0}]),La({name:"",category:"",quantity:""}),Ha(!1),St(null),m("Custom item added","success")},xr=(h,S)=>{const T=parseFloat(S)||0;T<=0?ll(h):ye(P.map((q,U)=>U===h?{...q,quantity:T}:q))},ll=h=>{ye(P.filter((S,T)=>T!==h))},Qa=h=>{const S=Array.from(h.target.files);if(S.length===0)return;const T=i===-1?1/0:i-fe.length;if(T<=0){m(`Photo limit reached (${i} max)`,"error"),h.target.value="";return}const q=S.slice(0,T);q.length<S.length&&m(`Only ${q.length} photo(s) added (${i} max)`,"error");const U=10*1024*1024;q.forEach(Q=>{if(!Q.type.startsWith("image/")){m("Please select an image file","error");return}if(Q.size>U){m(`Photo too large: ${Q.name} (max 10MB)`,"error");return}const ie=URL.createObjectURL(Q),he=`photo-${Date.now()}-${ih()}`;Be(ft=>[...ft,{id:`${Date.now()}-${ih()}`,tempId:he,file:Q,previewUrl:ie,name:Q.name,status:"pending",attempts:0,error:null,uploadedUrl:null}])}),h.target.value=""},Ht=(h,S)=>{Be(T=>T.map(q=>q.id===h?{...q,...S}:q))},il=async(h,S)=>{const T=fe.find(q=>q.id===h);if(!(!T||T.status!=="failed")){Ht(h,{status:"compressing",error:null});try{let q=T.file;try{q=await sh(T.file)}catch(Q){console.warn("Compression failed, using original:",Q)}Ht(h,{status:"uploading"});const U=await _e.uploadPhoto(l,s.id,S,q);Ht(h,{status:"confirmed",uploadedUrl:U,attempts:T.attempts+1}),await _e.updateTMTicketPhotos(S,[...fe.filter(Q=>Q.uploadedUrl).map(Q=>Q.uploadedUrl),U]),m("Photo uploaded successfully","success")}catch(q){console.error("Retry failed:",q),Ht(h,{status:"failed",error:q.message||"Upload failed",attempts:T.attempts+1}),m("Photo retry failed","error")}}},ol=h=>{const S=fe.find(T=>T.id===h);S?.previewUrl&&URL.revokeObjectURL(S.previewUrl),Be(fe.filter(T=>T.id!==h))},ss=()=>{if(p===1)return qe.trim().length>0;if(p===2){if(Dt)return Ga().length>0;{const h=C.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0)),S=I.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0)),T=Y.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0));return h||S||T}}return!0},Fn=(()=>{const h=[];return p===1&&(qe.trim()||h.push(se==="en"?"Description recommended":"Descripcin recomendada")),p===2&&Sa>0&&h.push(se==="en"?`${Sa} worker(s) have no hours entered`:`${Sa} trabajador(es) sin horas`),p===5&&(J.trim()||h.push(se==="en"?"Name required to submit":"Nombre requerido")),h})(),ja=()=>{p<5&&y(p+1)},la=()=>{ot?(St(null),Ha(!1)):sa?Ha(!1):p>1?y(p-1):d()},Bt=async()=>{if(!J.trim()){m("Enter your name to submit","error");return}let h=[];if(Dt){if(h=Ga(),h.length===0){m("Add at least one worker","error");return}}else{const S=C.filter(U=>U&&U.name&&U.name.trim()&&(parseFloat(U.hours)>0||parseFloat(U.overtimeHours)>0)),T=I.filter(U=>U&&U.name&&U.name.trim()&&(parseFloat(U.hours)>0||parseFloat(U.overtimeHours)>0)),q=Y.filter(U=>U&&U.name&&U.name.trim()&&(parseFloat(U.hours)>0||parseFloat(U.overtimeHours)>0));if(S.length===0&&T.length===0&&q.length===0){m("Add at least one worker","error");return}h=[...S.map(U=>({name:U.name.trim(),hours:parseFloat(U.hours)||0,overtime_hours:parseFloat(U.overtimeHours)||0,time_started:U.timeStarted||null,time_ended:U.timeEnded||null,role:U.role})),...T.map(U=>({name:U.name.trim(),hours:parseFloat(U.hours)||0,overtime_hours:parseFloat(U.overtimeHours)||0,time_started:U.timeStarted||null,time_ended:U.timeEnded||null,role:"Operator"})),...q.map(U=>({name:U.name.trim(),hours:parseFloat(U.hours)||0,overtime_hours:parseFloat(U.overtimeHours)||0,time_started:U.timeStarted||null,time_ended:U.timeEnded||null,role:"Laborer"}))]}Ce(!0),Le("Creating ticket...");try{const S=await _e.createTMTicket({project_id:s.id,work_date:b,ce_pco_number:me.trim()||null,assigned_cor_id:ke||null,notes:qe.trim()||null,photos:[],created_by_name:J.trim()});let T=[];const q=fe.filter(U=>U.status==="pending");if(q.length>0){Le(`Compressing ${q.length} photo${q.length>1?"s":""}...`),q.forEach($e=>Ht($e.id,{status:"compressing"}));const U=await Promise.all(q.map(async $e=>{try{const bt=await sh($e.file);return{...$e,file:bt}}catch(bt){return console.warn(`Failed to compress photo ${$e.name}, using original:`,bt),$e}}));Le(`Uploading ${q.length} photo${q.length>1?"s":""}...`),q.forEach($e=>Ht($e.id,{status:"uploading"}));let Q=0,ie=0;const he=U.map(async $e=>{try{const bt=await _e.uploadPhoto(l,s.id,S.id,$e.file);return Q++,Le(`Uploading ${Q}/${q.length} photos...`),Ht($e.id,{status:"confirmed",uploadedUrl:bt,attempts:($e.attempts||0)+1}),{id:$e.id,url:bt}}catch(bt){return console.error(`Photo ${$e.name} upload failed:`,bt),ie++,Ht($e.id,{status:"failed",error:bt.message||"Upload failed",attempts:($e.attempts||0)+1}),{id:$e.id,url:null,error:bt.message}}});T=(await Promise.all(he)).filter($e=>$e.url!==null).map($e=>$e.url),ie>0&&T.length>0?m(`${T.length}/${q.length} photos uploaded. ${ie} failed - can retry later.`,"warning"):ie>0&&T.length===0&&m(`All ${ie} photos failed to upload - can retry after submission.`,"error")}if(T.length>0&&(Le("Saving photos..."),await _e.updateTMTicketPhotos(S.id,T)),Le("Saving workers..."),await _e.addTMWorkers(S.id,h),P.length>0&&(Le("Saving materials..."),await _e.addTMItems(S.id,P.map(U=>({material_equipment_id:U.material_equipment_id,custom_name:U.custom_name||null,custom_category:U.custom_category||null,quantity:U.quantity})))),ke){Le("Importing to COR...");try{await _e.importTicketDataToCOR(S.id,ke,l,s.work_type||"demolition",s.job_type||"standard")}catch(U){console.error("Error importing to COR:",U);try{await _e.markImportFailed(S.id,ke,U?.message||"Import failed")}catch(Q){console.error("Error marking import failed:",Q)}m("T&M saved. COR data sync failed - retry from ticket list.","warning")}}fe.forEach(U=>{U.previewUrl&&URL.revokeObjectURL(U.previewUrl)}),O(S),m("T&M submitted!","success"),y(6)}catch(S){console.error("Error submitting T&M:",S),m("Error submitting T&M","error")}finally{Ce(!1),Le("")}},Xa=C.filter(h=>h&&h.name&&h.name.trim()&&(parseFloat(h.hours)>0||parseFloat(h.overtimeHours)>0)),yn=I.filter(h=>h&&h.name&&h.name.trim()&&(parseFloat(h.hours)>0||parseFloat(h.overtimeHours)>0)),Ta=Y.filter(h=>h&&h.name&&h.name.trim()&&(parseFloat(h.hours)>0||parseFloat(h.overtimeHours)>0)),vn=Ga(),xa=Dt?vn.length:Xa.length+yn.length+Ta.length,bn=Dt?vn.reduce((h,S)=>h+(S.hours||0),0):[...Xa,...yn,...Ta].reduce((h,S)=>h+parseFloat(S.hours||0),0),ct=Dt?vn.reduce((h,S)=>h+(S.overtime_hours||0),0):[...Xa,...yn,...Ta].reduce((h,S)=>h+parseFloat(S.overtimeHours||0),0);P.reduce((h,S)=>h+S.quantity,0);const Va=Dt?Object.values(Nt||{}).flat().filter(h=>h&&h.name&&h.name.trim()):[...C.filter(h=>h&&h.name&&h.name.trim()),...I.filter(h=>h&&h.name&&h.name.trim()),...Y.filter(h=>h&&h.name&&h.name.trim())],cl=xa,Sa=Va.length-cl;return p===3&&(ot||sa)?r.jsxs("div",{className:"tm-wizard",children:[r.jsxs("div",{className:"tm-wizard-header",children:[r.jsx("button",{className:"tm-back-btn",onClick:la,children:""}),r.jsx("h2",{children:sa?"Add Custom Item":ot}),r.jsxs("div",{className:"tm-item-count",children:[P.length," items"]})]}),sa?r.jsxs("div",{className:"tm-custom-form",children:[r.jsxs("div",{className:"tm-field",children:[r.jsx("label",{children:"Item Name"}),r.jsx("input",{type:"text",placeholder:"What did you use?",value:vt.name,onChange:h=>La({...vt,name:h.target.value}),autoFocus:!0})]}),r.jsxs("div",{className:"tm-field",children:[r.jsx("label",{children:"Category"}),r.jsx("div",{className:"tm-category-select",children:Qc.map(h=>r.jsx("button",{className:`tm-cat-chip ${vt.category===h?"active":""}`,onClick:()=>La({...vt,category:h}),children:h},h))})]}),r.jsxs("div",{className:"tm-field",children:[r.jsx("label",{children:"Quantity"}),r.jsx("input",{type:"number",placeholder:"How many?",value:vt.quantity,onChange:h=>La({...vt,quantity:h.target.value})})]}),r.jsx("button",{className:"tm-big-btn primary",onClick:mt,children:"Add Custom Item"})]}):r.jsx("div",{className:"tm-item-grid",children:Xn?r.jsx("div",{className:"tm-loading",children:"Loading..."}):r.jsxs(r.Fragment,{children:[yr.map(h=>{const S=P.find(T=>T.material_equipment_id===h.id);return r.jsxs("button",{className:`tm-item-card ${S?"added":""}`,onClick:()=>_n(h),children:[r.jsx("span",{className:"tm-item-name",children:h.name}),r.jsx("span",{className:"tm-item-unit",children:h.unit}),S&&r.jsx("span",{className:"tm-item-badge",children:S.quantity})]},h.id)}),r.jsxs("button",{className:"tm-item-card custom",onClick:()=>Ha(!0),children:[r.jsx("span",{className:"tm-item-name",children:"+ Add Other"}),r.jsx("span",{className:"tm-item-unit",children:"Not on list"})]})]})}),!sa&&P.length>0&&r.jsx("div",{className:"tm-wizard-footer",children:r.jsxs("button",{className:"tm-big-btn primary",onClick:()=>St(null),children:["Done Adding (",P.length," items)"]})})]}):r.jsxs("div",{className:"tm-wizard",children:[r.jsxs("div",{className:"tm-wizard-header",children:[p<5?r.jsx("button",{className:"tm-back-btn",onClick:la,children:""}):r.jsx("div",{className:"tm-success-check",children:r.jsx(Bc,{size:24})}),r.jsxs("h2",{children:[p===1&&Z("workInfo"),p===2&&Z("crewHours"),p===3&&Z("materialsEquipment"),p===4&&Z("evidence"),p===5&&Z("review"),p===6&&(se==="en"?"Submitted":"Enviado")]}),r.jsxs("div",{className:"tm-header-right",children:[p<5&&r.jsxs("button",{className:"tm-lang-toggle",onClick:()=>kt(se==="en"?"es":"en"),title:se==="en"?"Cambiar a Espaol":"Switch to English",children:[r.jsx(j_,{size:16}),se==="en"?"ES":"EN"]}),p<6&&r.jsxs("div",{className:"tm-step-dots",children:[r.jsx("span",{className:`tm-dot ${p>=1?"active":""}`}),r.jsx("span",{className:`tm-dot ${p>=2?"active":""}`}),r.jsx("span",{className:`tm-dot ${p>=3?"active":""}`}),r.jsx("span",{className:`tm-dot ${p>=4?"active":""}`}),r.jsx("span",{className:`tm-dot ${p>=5?"active":""}`})]})]})]}),p===1&&r.jsxs("div",{className:"tm-step-content",children:[r.jsxs("div",{className:"tm-project-info",children:[s.job_number&&r.jsxs("div",{className:"tm-project-detail",children:[r.jsx("span",{className:"tm-project-label",children:"Job #"}),r.jsx("span",{className:"tm-project-value",children:s.job_number})]}),r.jsxs("div",{className:"tm-project-detail",children:[r.jsx("span",{className:"tm-project-label",children:"Project"}),r.jsx("span",{className:"tm-project-value",children:s.name})]}),s.address&&r.jsxs("div",{className:"tm-project-detail",children:[r.jsx("span",{className:"tm-project-label",children:"Address"}),r.jsx("span",{className:"tm-project-value",children:s.address})]}),s.general_contractor&&r.jsxs("div",{className:"tm-project-detail",children:[r.jsx("span",{className:"tm-project-label",children:"GC"}),r.jsx("span",{className:"tm-project-value",children:s.general_contractor})]})]}),r.jsxs("div",{className:"tm-field-row",children:[r.jsxs("div",{className:"tm-field tm-field-half",children:[r.jsx("label",{children:"Date"}),r.jsx("input",{type:"date",value:b,onChange:h=>z(h.target.value),className:"tm-date"})]}),r.jsxs("div",{className:"tm-field tm-field-half",children:[r.jsx("label",{children:"CE / PCO #"}),r.jsx("input",{type:"text",placeholder:"Change Event / PCO",value:me,onChange:h=>ue(h.target.value),className:"tm-input"})]})]}),r.jsxs("div",{className:"tm-field tm-description-field",children:[r.jsxs("label",{children:[r.jsx(wi,{size:16,className:"inline-icon"}),Z("describeWork")," ",r.jsx("span",{className:"tm-required",children:"*"})]}),r.jsx("textarea",{placeholder:Z("whatWorkPerformed"),value:qe,onChange:h=>F(h.target.value),rows:4,className:`tm-description ${qe.trim()?"":"tm-field-required"}`})]})]}),p===2&&r.jsxs("div",{className:"tm-step-content",children:[r.jsxs("div",{className:"tm-crew-summary-pill",children:[r.jsxs("span",{className:"pill-stat",children:[Va.length," ",Va.length===1?Z("worker"):Z("workers_plural")]}),r.jsxs("span",{className:"pill-stat",children:[bn+ct,"h ","total"]}),Sa>0&&r.jsxs("span",{className:"pill-warning",children:[r.jsx(Ps,{size:14}),Sa," ",se==="en"?"need hours":"sin horas"]})]}),rt.length>0&&r.jsxs("div",{className:"tm-crew-picker",children:[r.jsxs("button",{className:"tm-crew-picker-btn",onClick:()=>ra(!Ze),children:[r.jsx(un,{size:16})," ",Ze?"Hide":"Select from"," Today's Crew (",rt.length,")"]}),Ze&&r.jsx("div",{className:"tm-crew-list",children:rt.map((h,S)=>{const T=C.some(Q=>Q.name.toLowerCase()===h.name.toLowerCase())||I.some(Q=>Q.name.toLowerCase()===h.name.toLowerCase())||Y.some(Q=>Q.name.toLowerCase()===h.name.toLowerCase()),q=Object.values(Nt).some(Q=>Q.some(ie=>ie.name.toLowerCase()===h.name.toLowerCase())),U=T||q;return r.jsxs("button",{className:`tm-crew-item ${U?"added":""}`,onClick:()=>{if(!U){if(h.labor_class_id&&Dt&&Nt[h.labor_class_id]){const Q=Nt[h.labor_class_id]||[],ie=Q.findIndex(he=>!he||!he.name||!he.name.trim());if(ie>=0){const he=[...Q];he[ie]={...he[ie],name:h.name},qt({...Nt,[h.labor_class_id]:he})}else qt({...Nt,[h.labor_class_id]:[...Q,{name:h.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]})}else{const Q=(h.role||"").toLowerCase();if(Q.includes("foreman")||Q.includes("supervisor")||Q.includes("superintendent")){const ie=C.findIndex(he=>!he||!he.name||!he.name.trim());ie>=0?(tt(ie,"name",h.name),tt(ie,"role",Q.includes("superintendent")?"Superintendent":"Foreman")):X([...C,{name:h.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:Q.includes("superintendent")?"Superintendent":"Foreman"}])}else if(Q.includes("operator")){const ie=I.findIndex(he=>!he||!he.name||!he.name.trim());ie>=0?Ba(ie,"name",h.name):Se([...I,{name:h.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}else{const ie=Y.findIndex(he=>!he||!he.name||!he.name.trim());ie>=0?Da(ie,"name",h.name):je([...Y,{name:h.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}}m(`Added ${h.name}`,"success")}},disabled:U,children:[r.jsx("span",{className:"tm-crew-item-name",children:h.name}),r.jsx("span",{className:`tm-crew-item-role ${(h.role||"laborer").toLowerCase()}`,children:h.role||"Laborer"}),U&&r.jsx("span",{className:"tm-crew-item-check",children:""})]},S)})})]}),r.jsxs("div",{className:"tm-quick-actions-panel",children:[r.jsxs("div",{className:"tm-batch-hours-header",children:[r.jsx(Ic,{size:18}),r.jsx("span",{children:Z("quickActions")})]}),r.jsxs("div",{className:"tm-quick-actions-buttons",children:[r.jsxs("button",{type:"button",className:"tm-quick-action-btn primary",onClick:sl,disabled:ya,children:[r.jsx($c,{size:16}),Z(ya?"loading":"sameAsYesterday")]}),r.jsxs("button",{type:"button",className:"tm-quick-action-btn",onClick:()=>G(!0),children:[r.jsx(Is,{size:16}),Z("setCrewHours")]})]})]}),r.jsxs("div",{className:"tm-inline-presets",children:[r.jsx("span",{className:"tm-inline-presets-label",children:se==="en"?"Apply to all:":"Aplicar a todos:"}),r.jsxs("div",{className:"tm-inline-presets-buttons",children:[r.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>br("8hr"),children:Z("preset8hr")}),r.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>br("10hr"),children:Z("preset10hr")}),r.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>br("4hr"),children:Z("preset4hr")})]})]}),r.jsxs("div",{className:`tm-running-total ${xa>0?"has-data":""}`,children:[r.jsxs("div",{className:"tm-running-total-workers",children:[r.jsx(un,{size:18}),r.jsx("span",{className:"tm-running-total-count",children:Va.length}),r.jsx("span",{className:"tm-running-total-label",children:Va.length===1?Z("worker"):Z("workers_plural")}),Sa>0&&r.jsxs("span",{className:"tm-running-total-warning",children:["(",Sa," ",se==="en"?"need hours":"sin horas",")"]})]}),r.jsxs("div",{className:"tm-running-total-hours",children:[r.jsx(Is,{size:18}),r.jsx("span",{className:"tm-running-total-count",children:bn+ct}),r.jsx("span",{className:"tm-running-total-label",children:se==="en"?"total hrs":"hrs total"}),ct>0&&r.jsxs("span",{className:"tm-running-total-ot",children:["(",ct," OT)"]})]})]}),Dt&&!Ea&&r.jsxs(r.Fragment,{children:[as.map(h=>{const S=va.filter(T=>T.category_id===h.id);return S.length===0?null:r.jsxs("div",{className:"tm-labor-category-section",children:[r.jsx("div",{className:"tm-category-header",children:h.name}),S.map(T=>r.jsxs("div",{className:"tm-field",children:[r.jsx("label",{children:T.name}),r.jsx("div",{className:"tm-workers-list",children:(Nt[T.id]||[]).map((q,U)=>{const Q=Ut(q);return r.jsxs("div",{className:`tm-worker-card-expanded ${Q!=="empty"?`worker-${Q}`:""}`,children:[r.jsxs("div",{className:"tm-worker-row-top",children:[Q==="complete"&&r.jsx("span",{className:"tm-worker-check",children:r.jsx(na,{size:14})}),r.jsx("input",{type:"text",placeholder:Z("firstLastName"),value:q.name,onChange:ie=>Tt(T.id,U,"name",ie.target.value),className:"tm-worker-input"}),r.jsx("button",{className:"tm-remove",onClick:()=>Ya(T.id,U),children:""})]}),r.jsxs("div",{className:"tm-worker-row-bottom",children:[r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("start")}),r.jsx("input",{type:"time",value:q.timeStarted,onChange:ie=>Tt(T.id,U,"timeStarted",ie.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("end")}),r.jsx("input",{type:"time",value:q.timeEnded,onChange:ie=>Tt(T.id,U,"timeEnded",ie.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("regHrs")}),r.jsx("input",{type:"number",placeholder:"0",value:q.hours,onChange:ie=>Tt(T.id,U,"hours",ie.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("otHrs")}),r.jsx("input",{type:"number",placeholder:"0",value:q.overtimeHours,onChange:ie=>Tt(T.id,U,"overtimeHours",ie.target.value)})]})]})]},U)})}),r.jsxs("button",{className:"tm-add-btn",onClick:()=>jr(T.id),children:["+ ",se==="en"?"Add":"Agregar"," ",T.name]})]},T.id))]},h.id)}),va.filter(h=>!h.category_id).map(h=>r.jsxs("div",{className:"tm-field",children:[r.jsx("label",{children:h.name}),r.jsx("div",{className:"tm-workers-list",children:(Nt[h.id]||[]).map((S,T)=>{const q=Ut(S);return r.jsxs("div",{className:`tm-worker-card-expanded ${q!=="empty"?`worker-${q}`:""}`,children:[r.jsxs("div",{className:"tm-worker-row-top",children:[q==="complete"&&r.jsx("span",{className:"tm-worker-check",children:r.jsx(na,{size:14})}),r.jsx("input",{type:"text",placeholder:Z("firstLastName"),value:S.name,onChange:U=>Tt(h.id,T,"name",U.target.value),className:"tm-worker-input"}),r.jsx("button",{className:"tm-remove",onClick:()=>Ya(h.id,T),children:""})]}),r.jsxs("div",{className:"tm-worker-row-bottom",children:[r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("start")}),r.jsx("input",{type:"time",value:S.timeStarted,onChange:U=>Tt(h.id,T,"timeStarted",U.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("end")}),r.jsx("input",{type:"time",value:S.timeEnded,onChange:U=>Tt(h.id,T,"timeEnded",U.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("regHrs")}),r.jsx("input",{type:"number",placeholder:"0",value:S.hours,onChange:U=>Tt(h.id,T,"hours",U.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("otHrs")}),r.jsx("input",{type:"number",placeholder:"0",value:S.overtimeHours,onChange:U=>Tt(h.id,T,"overtimeHours",U.target.value)})]})]})]},T)})}),r.jsxs("button",{className:"tm-add-btn",onClick:()=>jr(h.id),children:["+ ",se==="en"?"Add":"Agregar"," ",h.name]})]},h.id))]}),Ea&&r.jsxs("div",{className:"tm-loading-labor-classes",children:[r.jsx($s,{size:20,className:"tm-spinner"}),r.jsx("span",{children:se==="en"?"Loading labor classes...":"Cargando clases de trabajo..."})]}),!Dt&&!Ea&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"tm-field",children:[r.jsx("label",{children:Z("supervision")}),r.jsx("div",{className:"tm-workers-list",children:C.map((h,S)=>{const T=Ut(h);return r.jsxs("div",{className:`tm-worker-card-expanded ${T!=="empty"?`worker-${T}`:""}`,children:[r.jsxs("div",{className:"tm-worker-row-top",children:[T==="complete"&&r.jsx("span",{className:"tm-worker-check",children:r.jsx(na,{size:14})}),r.jsx("div",{className:"tm-role-select",children:r.jsxs("select",{value:h.role,onChange:q=>tt(S,"role",q.target.value),children:[r.jsx("option",{value:"Foreman",children:Z("foreman")}),r.jsx("option",{value:"Superintendent",children:Z("superintendent")})]})}),r.jsx("input",{type:"text",placeholder:Z("firstLastName"),value:h.name,onChange:q=>tt(S,"name",q.target.value),className:"tm-worker-input"}),r.jsx("button",{className:"tm-remove",onClick:()=>Rt(S),children:""})]}),r.jsxs("div",{className:"tm-worker-row-bottom",children:[r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("start")}),r.jsx("input",{type:"time",value:h.timeStarted,onChange:q=>tt(S,"timeStarted",q.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("end")}),r.jsx("input",{type:"time",value:h.timeEnded,onChange:q=>tt(S,"timeEnded",q.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("regHrs")}),r.jsx("input",{type:"number",placeholder:"0",value:h.hours,onChange:q=>tt(S,"hours",q.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("otHrs")}),r.jsx("input",{type:"number",placeholder:"0",value:h.overtimeHours,onChange:q=>tt(S,"overtimeHours",q.target.value)})]})]})]},S)})}),r.jsx("button",{className:"tm-add-btn",onClick:qa,children:Z("addSupervision")})]}),r.jsxs("div",{className:"tm-field",children:[r.jsx("label",{children:Z("operators")}),r.jsx("div",{className:"tm-workers-list",children:I.map((h,S)=>{const T=Ut(h);return r.jsxs("div",{className:`tm-worker-card-expanded ${T!=="empty"?`worker-${T}`:""}`,children:[r.jsxs("div",{className:"tm-worker-row-top",children:[T==="complete"&&r.jsx("span",{className:"tm-worker-check",children:r.jsx(na,{size:14})}),r.jsx("input",{type:"text",placeholder:Z("firstLastName"),value:h.name,onChange:q=>Ba(S,"name",q.target.value),className:"tm-worker-input"}),r.jsx("button",{className:"tm-remove",onClick:()=>Jn(S),children:""})]}),r.jsxs("div",{className:"tm-worker-row-bottom",children:[r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("start")}),r.jsx("input",{type:"time",value:h.timeStarted,onChange:q=>Ba(S,"timeStarted",q.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("end")}),r.jsx("input",{type:"time",value:h.timeEnded,onChange:q=>Ba(S,"timeEnded",q.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("regHrs")}),r.jsx("input",{type:"number",placeholder:"0",value:h.hours,onChange:q=>Ba(S,"hours",q.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("otHrs")}),r.jsx("input",{type:"number",placeholder:"0",value:h.overtimeHours,onChange:q=>Ba(S,"overtimeHours",q.target.value)})]})]})]},S)})}),r.jsx("button",{className:"tm-add-btn",onClick:Ci,children:Z("addOperator")})]}),r.jsxs("div",{className:"tm-field",children:[r.jsx("label",{children:Z("laborers")}),r.jsx("div",{className:"tm-workers-list",children:Y.map((h,S)=>{const T=Ut(h);return r.jsxs("div",{className:`tm-worker-card-expanded ${T!=="empty"?`worker-${T}`:""}`,children:[r.jsxs("div",{className:"tm-worker-row-top",children:[T==="complete"&&r.jsx("span",{className:"tm-worker-check",children:r.jsx(na,{size:14})}),r.jsx("input",{type:"text",placeholder:Z("firstLastName"),value:h.name,onChange:q=>Da(S,"name",q.target.value),className:"tm-worker-input"}),r.jsx("button",{className:"tm-remove",onClick:()=>Ni(S),children:""})]}),r.jsxs("div",{className:"tm-worker-row-bottom",children:[r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("start")}),r.jsx("input",{type:"time",value:h.timeStarted,onChange:q=>Da(S,"timeStarted",q.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("end")}),r.jsx("input",{type:"time",value:h.timeEnded,onChange:q=>Da(S,"timeEnded",q.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("regHrs")}),r.jsx("input",{type:"number",placeholder:"0",value:h.hours,onChange:q=>Da(S,"hours",q.target.value)})]}),r.jsxs("div",{className:"tm-time-group",children:[r.jsx("label",{children:Z("otHrs")}),r.jsx("input",{type:"number",placeholder:"0",value:h.overtimeHours,onChange:q=>Da(S,"overtimeHours",q.target.value)})]})]})]},S)})}),r.jsx("button",{className:"tm-add-btn",onClick:gn,children:Z("addLaborer")})]})]})]}),p===3&&!ot&&r.jsxs("div",{className:"tm-step-content",children:[r.jsxs("div",{className:"tm-field tm-search-field",children:[r.jsxs("div",{className:"tm-search-input-wrapper",children:[r.jsx(B_,{size:18,className:"tm-search-icon"}),r.jsx("input",{ref:Kn,type:"text",placeholder:Z("searchMaterials"),value:fn,onChange:h=>rl(h.target.value),onFocus:()=>rs(),className:"tm-search-input"}),fn&&r.jsx("button",{className:"tm-search-clear",onClick:()=>{hn(""),Ua([])},children:""})]}),fn&&yt.length>0&&r.jsx("div",{className:"tm-search-results",children:yt.map((h,S)=>{const T=P.find(q=>q.id===h.id);return r.jsxs("button",{className:`tm-search-result-item ${T?"added":""}`,onClick:()=>{T?xr(P.indexOf(T),T.quantity+1):ye([...P,{...h,quantity:1,isCustom:!1}]),hn(""),Ua([])},children:[r.jsx("span",{className:"tm-search-result-name",children:h.name}),r.jsx("span",{className:"tm-search-result-category",children:h.category}),T&&r.jsxs("span",{className:"tm-search-result-qty",children:["",T.quantity]})]},S)})}),fn&&yt.length===0&&r.jsx("div",{className:"tm-search-no-results",children:Z("noSearchResults")})]}),r.jsxs("div",{className:"tm-field",children:[r.jsx("label",{children:Z("orBrowse")}),r.jsx("div",{className:"tm-category-grid",children:Qc.map(h=>{const S=P.filter(T=>T.category===h);return r.jsxs("button",{className:"tm-category-card",onClick:()=>St(h),children:[r.jsx("span",{className:"tm-cat-name",children:h}),S.length>0&&r.jsx("span",{className:"tm-cat-count",children:S.length})]},h)})})]}),P.length>0&&r.jsxs("div",{className:"tm-field",children:[r.jsxs("label",{children:["Added Items (",P.length,")"]}),r.jsx("div",{className:"tm-added-list",children:P.map((h,S)=>r.jsxs("div",{className:"tm-added-item",children:[r.jsxs("div",{className:"tm-added-info",children:[h.isCustom&&r.jsx("span",{className:"tm-custom-badge",children:"Custom"}),r.jsx("span",{className:"tm-added-name",children:h.name})]}),r.jsxs("div",{className:"tm-added-qty",children:[r.jsx("button",{onClick:()=>xr(S,h.quantity-1),children:""}),r.jsx("span",{children:h.quantity}),r.jsx("button",{onClick:()=>xr(S,h.quantity+1),children:"+"})]})]},S))})]})]}),p===4&&r.jsxs("div",{className:"tm-step-content",children:[r.jsxs("div",{className:"tm-evidence-section",children:[r.jsxs("h3",{children:[r.jsx(Lc,{size:18})," ",Z("photos")]}),fe.length>0&&r.jsx("div",{className:"tm-photo-grid",children:fe.map(h=>r.jsxs("div",{className:`tm-photo-item ${h.status?`photo-${h.status}`:""}`,children:[r.jsx("img",{src:h.previewUrl,alt:h.name}),h.status==="compressing"&&r.jsxs("div",{className:"tm-photo-status compressing",children:[r.jsx($s,{size:20,className:"tm-spinner"}),r.jsx("span",{children:se==="en"?"Compressing":"Comprimiendo"})]}),h.status==="uploading"&&r.jsxs("div",{className:"tm-photo-status uploading",children:[r.jsx($s,{size:20,className:"tm-spinner"}),r.jsx("span",{children:se==="en"?"Uploading":"Subiendo"})]}),h.status==="confirmed"&&r.jsx("div",{className:"tm-photo-status confirmed",children:r.jsx(na,{size:20})}),h.status==="failed"&&r.jsxs("div",{className:"tm-photo-status failed",title:h.error||"Upload failed",children:[r.jsx(Ps,{size:20}),r.jsx("span",{children:se==="en"?"Failed":"Error"})]}),(!h.status||h.status==="pending"||h.status==="failed")&&r.jsx("button",{className:"tm-photo-remove",onClick:()=>ol(h.id),children:""})]},h.id))}),(i===-1||fe.length<i)&&r.jsxs("label",{className:"tm-photo-btn",children:[r.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:Qa,style:{display:"none"}}),r.jsx(Lc,{size:16,className:"inline-icon"})," ",fe.length>0?se==="en"?"Add More Photos":"Ms Fotos":Z("addPhotos")]}),i!==-1&&r.jsxs("p",{className:"tm-photo-hint",children:[fe.length,"/",i," ",Z("maxPhotos")]})]}),r.jsxs("div",{className:"tm-evidence-section",children:[r.jsxs("h3",{children:[r.jsx(Sh,{size:18})," ",Z("linkedCOR")]}),r.jsxs("div",{className:"tm-cor-row",children:[r.jsxs("select",{value:ke,onChange:h=>Ue(h.target.value),className:"tm-input tm-select",children:[r.jsxs("option",{value:"",children:["-- ",se==="en"?"No COR":"Sin COR"," --"]}),ee.map(h=>r.jsxs("option",{value:h.id,children:[h.cor_number,": ",h.title||"Untitled"," (",h.status,")"]},h.id))]}),r.jsx("button",{type:"button",className:"tm-refresh-btn",onClick:tl,disabled:Ve,title:se==="en"?"Refresh COR list":"Actualizar lista",children:r.jsx(U_,{size:16,className:Ve?"spinning":""})})]}),ee.length===0&&!Ve&&r.jsx("p",{className:"tm-cor-hint",children:Z("noCORs")})]})]}),p===5&&r.jsxs("div",{className:"tm-step-content",children:[r.jsxs("div",{className:"tm-review-section",children:[r.jsxs("div",{className:"tm-review-section-header",children:[r.jsxs("h4",{children:[" ",Z("workDate")]}),r.jsx("button",{className:"tm-edit-link",onClick:()=>y(1),children:se==="en"?"Edit":"Editar"})]}),r.jsxs("div",{className:"tm-review-row",children:[r.jsx("span",{children:new Date(b).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),me&&r.jsxs("span",{children:["CE/PCO: ",me]})]})]}),qe&&r.jsxs("div",{className:"tm-review-section",children:[r.jsxs("div",{className:"tm-review-section-header",children:[r.jsxs("h4",{children:[r.jsx(wi,{size:16,className:"inline-icon"})," ",Z("notes")]}),r.jsx("button",{className:"tm-edit-link",onClick:()=>y(1),children:se==="en"?"Edit":"Editar"})]}),r.jsx("div",{className:"tm-review-notes",children:qe})]}),fe.length>0&&r.jsxs("div",{className:"tm-review-section",children:[r.jsxs("div",{className:"tm-review-section-header",children:[r.jsxs("h4",{children:[r.jsx(Lc,{size:16,className:"inline-icon"})," ",Z("photos")," (",fe.length,")"]}),r.jsx("button",{className:"tm-edit-link",onClick:()=>y(4),children:se==="en"?"Edit":"Editar"})]}),r.jsx("div",{className:"tm-review-photos",children:fe.map(h=>r.jsx("img",{src:h.previewUrl,alt:h.name},h.id))})]}),ke&&r.jsxs("div",{className:"tm-review-section",children:[r.jsxs("div",{className:"tm-review-section-header",children:[r.jsxs("h4",{children:[" ",Z("linkedCOR")]}),r.jsx("button",{className:"tm-edit-link",onClick:()=>y(4),children:se==="en"?"Edit":"Editar"})]}),r.jsxs("div",{className:"tm-review-cor",children:[ee.find(h=>h.id===ke)?.cor_number,": ",ee.find(h=>h.id===ke)?.title||"Untitled"]})]}),Dt&&vn.length>0&&r.jsxs("div",{className:"tm-review-section",children:[r.jsxs("div",{className:"tm-review-section-header",children:[r.jsxs("h4",{children:[r.jsx(un,{size:16,className:"inline-icon"})," ",se==="en"?"Workers":"Trabajadores"," (",bn+ct," hrs)"]}),r.jsx("button",{className:"tm-edit-link",onClick:()=>y(2),children:se==="en"?"Edit":"Editar"})]}),r.jsx("div",{className:"tm-review-list",children:vn.map((h,S)=>r.jsxs("div",{className:"tm-review-row-detailed",children:[r.jsxs("div",{className:"tm-review-worker-name",children:[r.jsx("span",{className:"tm-role-badge",children:h.role})," ",h.name]}),r.jsxs("div",{className:"tm-review-worker-details",children:[h.time_started&&h.time_ended&&r.jsxs("span",{className:"tm-review-time",children:[h.time_started," - ",h.time_ended]}),r.jsxs("span",{className:"tm-review-hours",children:[h.hours||0," reg",h.overtime_hours>0?` + ${h.overtime_hours} OT`:""]})]})]},S))})]}),!Dt&&Xa.length>0&&r.jsxs("div",{className:"tm-review-section",children:[r.jsxs("div",{className:"tm-review-section-header",children:[r.jsxs("h4",{children:[r.jsx(ey,{size:16,className:"inline-icon"})," Supervision (",Xa.reduce((h,S)=>h+parseFloat(S.hours||0)+parseFloat(S.overtimeHours||0),0)," hrs)"]}),r.jsx("button",{className:"tm-edit-link",onClick:()=>y(2),children:se==="en"?"Edit":"Editar"})]}),r.jsx("div",{className:"tm-review-list",children:Xa.map((h,S)=>r.jsxs("div",{className:"tm-review-row-detailed",children:[r.jsxs("div",{className:"tm-review-worker-name",children:[r.jsx("span",{className:"tm-role-badge",children:h.role})," ",h.name]}),r.jsxs("div",{className:"tm-review-worker-details",children:[h.timeStarted&&h.timeEnded&&r.jsxs("span",{className:"tm-review-time",children:[h.timeStarted," - ",h.timeEnded]}),r.jsxs("span",{className:"tm-review-hours",children:[h.hours||0," reg",parseFloat(h.overtimeHours)>0?` + ${h.overtimeHours} OT`:""]})]})]},S))})]}),!Dt&&yn.length>0&&r.jsxs("div",{className:"tm-review-section",children:[r.jsxs("div",{className:"tm-review-section-header",children:[r.jsxs("h4",{children:[" Operators (",yn.reduce((h,S)=>h+parseFloat(S.hours||0)+parseFloat(S.overtimeHours||0),0)," hrs)"]}),r.jsx("button",{className:"tm-edit-link",onClick:()=>y(2),children:se==="en"?"Edit":"Editar"})]}),r.jsx("div",{className:"tm-review-list",children:yn.map((h,S)=>r.jsxs("div",{className:"tm-review-row-detailed",children:[r.jsx("div",{className:"tm-review-worker-name",children:h.name}),r.jsxs("div",{className:"tm-review-worker-details",children:[h.timeStarted&&h.timeEnded&&r.jsxs("span",{className:"tm-review-time",children:[h.timeStarted," - ",h.timeEnded]}),r.jsxs("span",{className:"tm-review-hours",children:[h.hours||0," reg",parseFloat(h.overtimeHours)>0?` + ${h.overtimeHours} OT`:""]})]})]},S))})]}),!Dt&&Ta.length>0&&r.jsxs("div",{className:"tm-review-section",children:[r.jsxs("div",{className:"tm-review-section-header",children:[r.jsxs("h4",{children:[r.jsx(un,{size:16,className:"inline-icon"})," Laborers (",Ta.reduce((h,S)=>h+parseFloat(S.hours||0)+parseFloat(S.overtimeHours||0),0)," hrs)"]}),r.jsx("button",{className:"tm-edit-link",onClick:()=>y(2),children:se==="en"?"Edit":"Editar"})]}),r.jsx("div",{className:"tm-review-list",children:Ta.map((h,S)=>r.jsxs("div",{className:"tm-review-row-detailed",children:[r.jsx("div",{className:"tm-review-worker-name",children:h.name}),r.jsxs("div",{className:"tm-review-worker-details",children:[h.timeStarted&&h.timeEnded&&r.jsxs("span",{className:"tm-review-time",children:[h.timeStarted," - ",h.timeEnded]}),r.jsxs("span",{className:"tm-review-hours",children:[h.hours||0," reg",parseFloat(h.overtimeHours)>0?` + ${h.overtimeHours} OT`:""]})]})]},S))})]}),P.length>0&&r.jsxs("div",{className:"tm-review-section",children:[r.jsxs("div",{className:"tm-review-section-header",children:[r.jsxs("h4",{children:[r.jsx(ry,{size:16,className:"inline-icon"})," Materials & Equipment (",P.length," items)"]}),r.jsx("button",{className:"tm-edit-link",onClick:()=>y(3),children:se==="en"?"Edit":"Editar"})]}),r.jsx("div",{className:"tm-review-list",children:P.map((h,S)=>r.jsxs("div",{className:"tm-review-row",children:[r.jsxs("span",{children:[h.isCustom&&r.jsxs(r.Fragment,{children:[r.jsx(Ic,{size:14,className:"inline-icon"})," "]}),h.name]}),r.jsxs("span",{children:[h.quantity," ",h.unit]})]},S))})]}),r.jsxs("div",{className:"tm-review-section tm-certification",children:[r.jsx("div",{className:"tm-review-header",children:r.jsxs("span",{children:[r.jsx(Yc,{size:16,className:"inline-icon"})," Submitted By"]})}),r.jsx("input",{type:"text",className:"tm-certification-input",placeholder:"Enter your name",value:J,onChange:h=>xe(h.target.value)}),r.jsx("p",{className:"tm-certification-note",children:"By submitting, you certify this T&M is accurate."})]})]}),p===6&&B&&r.jsxs("div",{className:"tm-step-content tm-success-step",children:[r.jsxs("div",{className:"tm-success-header",children:[r.jsx("div",{className:"tm-success-icon",children:r.jsx(Bc,{size:48})}),r.jsx("h2",{children:se==="en"?"T&M Ticket Submitted!":"Ticket T&M Enviado!"}),r.jsx("p",{className:"tm-success-subtitle",children:se==="en"?"Your ticket has been saved and is ready for client signature.":"Su ticket ha sido guardado y est listo para la firma del cliente."})]}),r.jsxs("div",{className:"tm-success-summary",children:[r.jsxs("div",{className:"tm-success-stat",children:[r.jsx("span",{className:"tm-success-stat-value",children:xa}),r.jsx("span",{className:"tm-success-stat-label",children:se==="en"?"Workers":"Trabajadores"})]}),r.jsxs("div",{className:"tm-success-stat",children:[r.jsx("span",{className:"tm-success-stat-value",children:bn+ct}),r.jsx("span",{className:"tm-success-stat-label",children:se==="en"?"Total Hours":"Horas Total"})]}),r.jsxs("div",{className:"tm-success-stat",children:[r.jsx("span",{className:"tm-success-stat-value",children:new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),r.jsx("span",{className:"tm-success-stat-label",children:se==="en"?"Work Date":"Fecha"})]})]}),fe.some(h=>h.status==="failed")&&r.jsxs("div",{className:"tm-failed-photos-section",children:[r.jsxs("div",{className:"tm-failed-photos-header",children:[r.jsx(Ps,{size:18}),r.jsx("span",{children:se==="en"?`${fe.filter(h=>h.status==="failed").length} photo(s) failed to upload`:`${fe.filter(h=>h.status==="failed").length} foto(s) no se subieron`})]}),r.jsx("div",{className:"tm-failed-photos-grid",children:fe.filter(h=>h.status==="failed").map(h=>r.jsxs("div",{className:"tm-failed-photo-item",children:[r.jsx("img",{src:h.previewUrl,alt:h.name}),r.jsx("div",{className:"tm-failed-photo-overlay",children:r.jsx("button",{className:"tm-retry-photo-btn",onClick:()=>il(h.id,B.id),disabled:h.status==="uploading"||h.status==="compressing",children:h.status==="uploading"||h.status==="compressing"?r.jsx($s,{size:16,className:"tm-spinner"}):r.jsxs(r.Fragment,{children:[r.jsx(Wc,{size:16}),r.jsx("span",{children:se==="en"?"Retry":"Reintentar"})]})})}),h.error&&r.jsxs("div",{className:"tm-failed-photo-error",title:h.error,children:[h.error.substring(0,20),h.error.length>20?"...":""]})]},h.id))}),r.jsxs("button",{className:"tm-retry-all-btn",onClick:async()=>{const h=fe.filter(S=>S.status==="failed");for(const S of h)await il(S.id,B.id)},children:[r.jsx(Wc,{size:16}),se==="en"?"Retry All Failed Photos":"Reintentar Todas las Fotos"]})]}),fe.length>0&&fe.every(h=>h.status==="confirmed")&&r.jsxs("div",{className:"tm-photos-success",children:[r.jsx(na,{size:16}),r.jsx("span",{children:se==="en"?`All ${fe.length} photo(s) uploaded successfully`:`${fe.length} foto(s) subidas exitosamente`})]}),r.jsxs("div",{className:"tm-signature-options",children:[r.jsx("h3",{children:se==="en"?"Get Client Signature":"Obtener Firma del Cliente"}),r.jsx("p",{className:"tm-signature-description",children:se==="en"?"Have the client sign this T&M ticket to verify the work performed.":"Haga que el cliente firme este ticket T&M para verificar el trabajo realizado."}),oe?r.jsxs("div",{className:"tm-signed-confirmation",children:[r.jsx(Bc,{size:32,className:"tm-signed-icon"}),r.jsx("span",{children:se==="en"?"Client signature collected!":"Firma del cliente recopilada!"})]}):r.jsxs("div",{className:"tm-signature-buttons",children:[r.jsxs("button",{className:"tm-signature-option-btn primary",onClick:()=>V(!0),children:[r.jsx("div",{className:"tm-signature-option-icon",children:r.jsx(Yc,{size:24})}),r.jsxs("div",{className:"tm-signature-option-text",children:[r.jsx("span",{className:"tm-signature-option-title",children:se==="en"?"Sign Now (On-Site)":"Firmar Ahora"}),r.jsx("span",{className:"tm-signature-option-desc",children:se==="en"?"Client signs on this device":"Cliente firma en este dispositivo"})]})]}),r.jsxs("button",{className:"tm-signature-option-btn",onClick:()=>W(!0),children:[r.jsx("div",{className:"tm-signature-option-icon",children:r.jsx(G_,{size:24})}),r.jsxs("div",{className:"tm-signature-option-text",children:[r.jsx("span",{className:"tm-signature-option-title",children:se==="en"?"Send Signature Link":"Enviar Enlace"}),r.jsx("span",{className:"tm-signature-option-desc",children:se==="en"?"Client signs later via link":"Cliente firma despus va enlace"})]})]})]})]})]}),$&&B&&r.jsx(dy,{documentType:"tm_ticket",documentId:B.id,companyId:l,projectId:s.id,documentTitle:`T&M - ${new Date(b).toLocaleDateString()}`,onClose:()=>W(!1),onShowToast:m}),te&&B&&r.jsx(my,{ticketId:B.id,ticketSummary:{workDate:b,workerCount:xa,totalHours:bn+ct},lang:se,onSave:()=>{V(!1),ae(!0)},onClose:()=>V(!1),onShowToast:m}),p<6&&r.jsxs("div",{className:"tm-wizard-footer",children:[Fn.length>0&&r.jsxs("div",{className:"tm-validation-summary",children:[r.jsx(Ps,{size:16}),r.jsx("span",{children:Fn[0]})]}),p===1&&r.jsx("button",{className:"tm-big-btn primary",onClick:ja,disabled:!ss(),children:Z("nextCrew")}),p===2&&r.jsx(r.Fragment,{children:r.jsxs("button",{className:"tm-big-btn primary",onClick:ja,disabled:!ss(),children:[Z("nextMaterials")," (",xa," ",Z(xa===1?"worker":"workers_plural"),", ",bn+ct," hrs)"]})}),p===3&&r.jsxs(r.Fragment,{children:[r.jsxs("button",{className:"tm-big-btn primary",onClick:ja,children:[se==="en"?"Next: Evidence":"Siguiente: Evidencia"," (",P.length," ",P.length===1?Z("item"):Z("items_plural"),")"]}),r.jsx("button",{className:"tm-skip-btn",onClick:ja,children:Z("skipNoMaterials")})]}),p===4&&r.jsxs(r.Fragment,{children:[r.jsxs("button",{className:"tm-big-btn primary",onClick:ja,children:[Z("reviewItems")," (",fe.length," ",se==="en"?"photos":"fotos",")"]}),r.jsx("button",{className:"tm-skip-btn",onClick:ja,children:se==="en"?"Skip (no photos)":"Saltar (sin fotos)"})]}),p===5&&r.jsx("button",{className:`tm-big-btn submit ${le?"submitting":""} ${J.trim()?"ready":"needs-name"}`,onClick:Bt,disabled:le||!J.trim(),children:le?r.jsxs(r.Fragment,{children:[r.jsx($s,{size:20,className:"tm-spinner"}),r.jsx("span",{className:"tm-submit-text",children:Fe||Z("submitting")})]}):J.trim()?r.jsxs(r.Fragment,{children:[r.jsx(na,{size:20}),r.jsx("span",{children:Z("submitTM")})]}):r.jsxs(r.Fragment,{children:[r.jsx(Yc,{size:18}),r.jsx("span",{children:se==="en"?"Enter name to submit":"Ingrese nombre"})]})})]}),p===6&&r.jsxs("div",{className:"tm-wizard-footer",children:[r.jsxs("button",{className:"tm-big-btn primary",onClick:o,children:[r.jsx(na,{size:20}),r.jsx("span",{children:se==="en"?"Done":"Listo"})]}),r.jsx("button",{className:"tm-skip-btn",onClick:o,children:se==="en"?"Skip signature for now":"Saltar firma por ahora"})]}),M&&r.jsx("div",{className:"tm-modal-overlay",onClick:()=>G(!1),children:r.jsxs("div",{className:"tm-batch-modal",onClick:h=>h.stopPropagation(),children:[r.jsxs("h3",{children:[r.jsx(Is,{size:18})," ",Z("applySameHours")]}),r.jsx("p",{className:"tm-batch-description",children:Z("batchDescription")}),r.jsxs("div",{className:"tm-time-presets",children:[r.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>ba("full"),children:Z("preset8hr")}),r.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>ba("10hr"),children:Z("preset10hr")}),r.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>ba("half"),children:Z("preset4hr")})]}),r.jsxs("div",{className:"tm-batch-form",children:[r.jsxs("div",{className:"tm-batch-row",children:[r.jsxs("div",{className:"tm-batch-field",children:[r.jsx("label",{children:Z("timeStarted")}),r.jsx("input",{type:"time",value:ne.timeStarted,onChange:h=>{const S=h.target.value,T=K(S,ne.timeEnded);pe({...ne,timeStarted:S,...T||{}})}})]}),r.jsxs("div",{className:"tm-batch-field",children:[r.jsx("label",{children:Z("timeEnded")}),r.jsx("input",{type:"time",value:ne.timeEnded,onChange:h=>{const S=h.target.value,T=K(ne.timeStarted,S);pe({...ne,timeEnded:S,...T||{}})}})]})]}),r.jsxs("div",{className:"tm-batch-row",children:[r.jsxs("div",{className:"tm-batch-field",children:[r.jsx("label",{children:Z("regularHours")}),r.jsx("input",{type:"number",placeholder:"8",value:ne.hours,onChange:h=>pe({...ne,hours:h.target.value})})]}),r.jsxs("div",{className:"tm-batch-field",children:[r.jsx("label",{children:Z("overtimeHours")}),r.jsx("input",{type:"number",placeholder:"0",value:ne.overtimeHours,onChange:h=>pe({...ne,overtimeHours:h.target.value})})]})]})]}),r.jsxs("div",{className:"tm-batch-preview",children:[r.jsxs("strong",{children:[Z("willApplyTo"),":"]}),r.jsxs("span",{children:[[...C.filter(h=>h&&h.name&&h.name.trim()),...I.filter(h=>h&&h.name&&h.name.trim()),...Y.filter(h=>h&&h.name&&h.name.trim())].length," ",Z("workers_plural")]})]}),r.jsxs("div",{className:"tm-batch-actions",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>G(!1),children:Z("cancel")}),r.jsx("button",{type:"button",className:"btn btn-primary",onClick:al,disabled:!ne.hours&&!ne.overtimeHours,children:Z("applyToAll")})]})]})})]})}function py({project:s,companyId:l,onShowToast:i}){const[o,d]=w.useState([]),[m,p]=w.useState(!0),[y,b]=w.useState(!1),[z,B]=w.useState(!1),[O,$]=w.useState({name:"",role:"",labor_class_id:null}),[W,te]=w.useState([]),[V,oe]=w.useState([]),[ae,me]=w.useState(!0),ue=["Foreman","Laborer","Supervisor","Operator"];w.useEffect(()=>{xe(),l?J():me(!1)},[s.id,l]);const J=async()=>{try{const M=await _e.getLaborClassesForField(l);te(M.categories||[]),oe(M.classes||[]),M.classes&&M.classes.length>0&&$(G=>({...G,role:M.classes[0].name,labor_class_id:M.classes[0].id}))}catch(M){console.error("Error loading labor classes:",M)}finally{me(!1)}},xe=async()=>{try{const M=await _e.getCrewCheckin(s.id);M?.workers&&d(M.workers)}catch(M){console.error("Error loading crew:",M)}finally{p(!1)}},ke=M=>{const G=V.find(ne=>ne.id===M);$(G?{...O,role:G.name,labor_class_id:G.id}:{...O,role:M,labor_class_id:null})},Ue=async()=>{if(!O.name.trim()){i("Enter worker name","error");return}if(!O.role){i("Select a role","error");return}if(o.find(M=>M.name.toLowerCase()===O.name.trim().toLowerCase())){i("Worker already added","error");return}b(!0);try{const M=[...o,{name:O.name.trim(),role:O.role,labor_class_id:O.labor_class_id}];await _e.saveCrewCheckin(s.id,M),d(M),$({...O,name:""}),B(!1),i("Crew member added","success")}catch(M){console.error("Error adding worker:",M),i("Error adding crew member","error")}finally{b(!1)}},ee=async M=>{b(!0);try{const G=o.filter(ne=>ne.name.toLowerCase()!==M.toLowerCase());await _e.saveCrewCheckin(s.id,G),d(G),i("Crew member removed","success")}catch(G){console.error("Error removing worker:",G),i("Error removing crew member","error")}finally{b(!1)}},ve=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}),Ve=()=>{const M={};W.forEach(ne=>{M[ne.id]={name:ne.name,classes:V.filter(pe=>pe.category_id===ne.id)}});const G=V.filter(ne=>!ne.category_id);return G.length>0&&(M.uncategorized={name:"Other",classes:G}),M},Me=V.length>0;return m||ae?r.jsxs("div",{className:"crew-checkin",children:[r.jsxs("div",{className:"crew-header",children:[r.jsxs("h3",{children:[r.jsx(un,{size:18,className:"inline-icon"})," Today's Crew"]}),r.jsx("span",{className:"crew-date",children:ve})]}),r.jsx("div",{className:"crew-loading",children:"Loading..."})]}):r.jsxs("div",{className:"crew-checkin",children:[r.jsxs("div",{className:"crew-header",children:[r.jsxs("h3",{children:[r.jsx(un,{size:18,className:"inline-icon"})," Today's Crew"]}),r.jsx("span",{className:"crew-date",children:ve})]}),o.length===0?r.jsxs("div",{className:"crew-empty",children:[r.jsx("p",{children:"No crew checked in yet"}),r.jsx("p",{className:"crew-empty-hint",children:"Add your crew for the day"})]}):r.jsx("div",{className:"crew-list",children:o.map(M=>r.jsxs("div",{className:"crew-member",children:[r.jsxs("div",{className:"crew-member-info",children:[r.jsx("span",{className:"crew-member-name",children:M.name}),r.jsx("span",{className:`crew-member-role ${(M.role||"laborer").toLowerCase().replace(/\s+/g,"-")}`,children:M.role})]}),r.jsx("button",{className:"crew-remove-btn",onClick:()=>ee(M.name),disabled:y,children:""})]},M.name))}),z?r.jsxs("div",{className:"crew-add-form",children:[r.jsx("input",{type:"text",value:O.name,onChange:M=>$({...O,name:M.target.value}),placeholder:"Name",autoFocus:!0}),r.jsx("select",{value:O.labor_class_id||O.role,onChange:M=>ke(M.target.value),children:Me?Object.entries(Ve()).map(([M,G])=>r.jsx("optgroup",{label:G.name,children:G.classes.map(ne=>r.jsx("option",{value:ne.id,children:ne.name},ne.id))},M)):ue.map(M=>r.jsx("option",{value:M,children:M},M))}),r.jsxs("div",{className:"crew-add-buttons",children:[r.jsx("button",{className:"crew-add-confirm",onClick:Ue,disabled:y,children:y?"...":"Add"}),r.jsx("button",{className:"crew-add-cancel",onClick:()=>{B(!1),$({name:"",role:V[0]?.name||"Laborer",labor_class_id:V[0]?.id||null})},children:"Cancel"})]})]}):r.jsx("button",{className:"crew-add-btn",onClick:()=>B(!0),children:"+ Add Crew Member"}),r.jsxs("div",{className:"crew-count",children:[o.length," ",o.length===1?"person":"people"," on site"]})]})}function gy({project:s,onShowToast:l,onClose:i}){const[o,d]=w.useState(!0),[m,p]=w.useState(!1),[y,b]=w.useState(null),[z,B]=w.useState(""),[O,$]=w.useState("");w.useEffect(()=>{W()},[s.id]);const W=async()=>{try{const ae=await _e.getDailyReport(s.id);if(ae)b(ae),B(ae.field_notes||""),$(ae.issues||"");else{const me=await _e.compileDailyReport(s.id);b({...me,status:"draft"})}}catch(ae){console.error("Error loading report:",ae),l("Error loading report","error")}finally{d(!1)}},te=async()=>{if(!v){l("Demo Mode: Report saved locally only - won't reach office","info"),i();return}p(!0);try{await _e.saveDailyReport(s.id,{field_notes:z,issues:O}),await _e.submitDailyReport(s.id,"Field")?(l("Daily report submitted!","success"),i()):l("Report not sent - check connection","error")}catch(ae){console.error("Error submitting report:",ae),l("Error submitting report","error")}finally{p(!1)}},V=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});if(o)return r.jsxs("div",{className:"daily-report",children:[r.jsxs("div",{className:"daily-report-header",children:[r.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),r.jsx("h2",{children:"Daily Report"})]}),r.jsx("div",{className:"daily-report-loading",children:"Compiling report..."})]});const oe=y?.status==="submitted";return r.jsxs("div",{className:"daily-report",children:[r.jsxs("div",{className:"daily-report-header",children:[r.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),r.jsxs("div",{children:[r.jsx("h2",{children:"Daily Report"}),r.jsx("p",{className:"daily-report-date",children:V})]})]}),oe&&r.jsxs("div",{className:"daily-report-submitted-banner",children:[" Submitted ",new Date(y.submitted_at).toLocaleTimeString()]}),r.jsxs("div",{className:"daily-report-content",children:[r.jsxs("div",{className:"daily-report-summary",children:[r.jsxs("div",{className:"daily-report-card",children:[r.jsx("div",{className:"daily-report-card-value",children:y.crew_count||0}),r.jsx("div",{className:"daily-report-card-label",children:"Crew on Site"})]}),r.jsxs("div",{className:"daily-report-card",children:[r.jsx("div",{className:"daily-report-card-value",children:y.tasks_completed||0}),r.jsx("div",{className:"daily-report-card-label",children:"Tasks Done"})]}),r.jsxs("div",{className:"daily-report-card",children:[r.jsx("div",{className:"daily-report-card-value",children:y.tm_tickets_count||0}),r.jsx("div",{className:"daily-report-card-label",children:"T&M Tickets"})]}),r.jsxs("div",{className:"daily-report-card",children:[r.jsx("div",{className:"daily-report-card-value",children:y.photos_count||0}),r.jsx("div",{className:"daily-report-card-label",children:"Photos"})]})]}),y.crew_list?.length>0&&r.jsxs("div",{className:"daily-report-section",children:[r.jsxs("h3",{children:[r.jsx(un,{size:18,className:"inline-icon"})," Crew"]}),r.jsx("div",{className:"daily-report-crew",children:y.crew_list.map((ae,me)=>r.jsxs("div",{className:"daily-report-crew-item",children:[r.jsx("span",{children:ae.name}),r.jsx("span",{className:"daily-report-crew-role",children:ae.role})]},me))})]}),y.completed_tasks?.length>0&&r.jsxs("div",{className:"daily-report-section",children:[r.jsxs("h3",{children:[r.jsx(f_,{size:18,className:"inline-icon"})," Completed Today"]}),r.jsx("ul",{className:"daily-report-tasks",children:y.completed_tasks.map((ae,me)=>r.jsxs("li",{children:[ae.name,ae.group&&r.jsx("span",{className:"daily-report-task-group",children:ae.group})]},me))})]}),r.jsxs("div",{className:"daily-report-section",children:[r.jsxs("h3",{children:[r.jsx(wi,{size:18,className:"inline-icon"})," Notes"]}),r.jsx("textarea",{value:z,onChange:ae=>B(ae.target.value),placeholder:"Any notes about today's work...",rows:3,disabled:oe})]}),r.jsxs("div",{className:"daily-report-section",children:[r.jsxs("h3",{children:[r.jsx(lu,{size:18,className:"inline-icon"})," Issues / Concerns"]}),r.jsx("textarea",{value:O,onChange:ae=>$(ae.target.value),placeholder:"Any problems, delays, or concerns...",rows:3,disabled:oe})]})]}),!oe&&r.jsxs("div",{className:"daily-report-footer",children:[r.jsx("button",{className:"btn btn-primary daily-report-submit",onClick:te,disabled:m,children:m?"Submitting...":r.jsxs(r.Fragment,{children:[r.jsx(P_,{size:16,className:"inline-icon"})," Submit Report"]})}),r.jsx("p",{className:"daily-report-hint",children:"This will be sent to the office"})]})]})}function _y({project:s,companyId:l,user:i,onClose:o,onReportCreated:d}){const[m,p]=w.useState(!1),[y,b]=w.useState(null),[z,B]=w.useState(1),[O,$]=w.useState(new Date().toISOString().split("T")[0]),[W,te]=w.useState(new Date().toTimeString().split(" ")[0].substring(0,5)),[V,oe]=w.useState(""),[ae,me]=w.useState(""),[ue,J]=w.useState("minor"),[xe,ke]=w.useState(""),[Ue,ee]=w.useState(""),[ve,Ve]=w.useState(""),[Me,M]=w.useState(""),[G,ne]=w.useState(""),[pe,C]=w.useState(""),[X,I]=w.useState(""),[Se,Y]=w.useState(i?.name||""),[je,P]=w.useState(""),[ye,qe]=w.useState(""),[F,fe]=w.useState(i?.email||""),[Be,le]=w.useState([]),[Ce,Fe]=w.useState(""),[Le,rt]=w.useState(""),[xt,Ze]=w.useState(""),[ra,ot]=w.useState(""),[St,yr]=w.useState(!1),[mn,Xn]=w.useState(""),[Ra,fn]=w.useState(""),[hn,yt]=w.useState(!1),[Ua,Vn]=w.useState(""),[Zn,sa]=w.useState(""),[Ha,vt]=w.useState(""),[La,Kn]=w.useState(""),[ya,wt]=w.useState(!1),[se,kt]=w.useState(!1),[Z,as]=w.useState(0),[vr,va]=w.useState(0),pn=()=>{if(!Ce.trim()){b({type:"error",message:"Please enter witness name"});return}const K={name:Ce,phone:Le,email:xt,testimony:ra};le([...Be,K]),Fe(""),rt(""),Ze(""),ot(""),b({type:"success",message:"Witness added"})},Nt=K=>{le(Be.filter((Ut,ba)=>ba!==K))},qt=K=>{switch(K){case 1:if(!V.trim()||!ae.trim())return b({type:"error",message:"Please fill in all incident details"}),!1;break;case 2:if(!Ue.trim()||!pe.trim())return b({type:"error",message:"Please fill in employee name and job title"}),!1;break;case 3:if(!Se.trim()||!je.trim())return b({type:"error",message:"Please fill in supervisor name and title"}),!1;break}return!0},Ea=()=>{qt(z)&&B(z+1)},ka=()=>{B(z-1)},Dt=async()=>{if(qt(z)){if(!v){b({type:"info",message:"Demo Mode: Report saved locally only - won't reach office"}),setTimeout(()=>{o()},1500);return}p(!0);try{const K={project_id:s.id,company_id:l,incident_date:O,incident_time:W,incident_location:V,incident_description:ae,injury_type:ue,body_part_affected:xe||null,employee_name:Ue,employee_phone:ve||null,employee_email:Me||null,employee_address:G||null,employee_job_title:pe,employee_hire_date:X||null,medical_treatment_required:St,medical_facility_name:mn||null,medical_facility_address:Ra||null,hospitalized:hn,reported_by_name:Se,reported_by_title:je,reported_by_phone:ye||null,reported_by_email:F||null,witnesses:Be,immediate_actions_taken:Ua||null,corrective_actions_planned:Zn||null,safety_equipment_used:Ha||null,safety_equipment_failed:La||null,osha_recordable:ya,workers_comp_claim:se,days_away_from_work:parseInt(Z)||0,restricted_work_days:parseInt(vr)||0,status:"reported",created_by:i?.id},Ut=await _e.createInjuryReport(K);b({type:"success",message:"Injury report submitted successfully"}),d&&d(Ut),setTimeout(()=>{o()},1500)}catch(K){console.error("Error submitting injury report:",K),b({type:"error",message:"Failed to submit injury report"})}finally{p(!1)}}};return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"modal-overlay",onClick:o,children:r.jsxs("div",{className:"modal-content injury-report-modal",onClick:K=>K.stopPropagation(),children:[r.jsxs("div",{className:"modal-header",children:[r.jsx("h2",{children:"Workplace Injury/Incident Report"}),r.jsx("button",{className:"close-btn",onClick:o,children:""})]}),r.jsxs("div",{className:"progress-steps",children:[r.jsx("div",{className:`step ${z>=1?"active":""}`,children:"1. Incident"}),r.jsx("div",{className:`step ${z>=2?"active":""}`,children:"2. Employee"}),r.jsx("div",{className:`step ${z>=3?"active":""}`,children:"3. Supervisor"}),r.jsx("div",{className:`step ${z>=4?"active":""}`,children:"4. Witnesses"}),r.jsx("div",{className:`step ${z>=5?"active":""}`,children:"5. Medical & Safety"})]}),r.jsxs("div",{className:"modal-body",children:[z===1&&r.jsxs("div",{className:"form-step",children:[r.jsx("h3",{children:"Incident Details"}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Date of Incident *"}),r.jsx("input",{type:"date",value:O,onChange:K=>$(K.target.value),max:new Date().toISOString().split("T")[0]})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Time of Incident *"}),r.jsx("input",{type:"time",value:W,onChange:K=>te(K.target.value)})]})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Location on Site *"}),r.jsx("input",{type:"text",value:V,onChange:K=>oe(K.target.value),placeholder:"e.g., Floor 2, near elevator shaft"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Incident Description *"}),r.jsx("textarea",{value:ae,onChange:K=>me(K.target.value),rows:4,placeholder:"Describe what happened in detail..."})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Injury Type *"}),r.jsxs("select",{value:ue,onChange:K=>J(K.target.value),children:[r.jsx("option",{value:"minor",children:"Minor Injury"}),r.jsx("option",{value:"serious",children:"Serious Injury"}),r.jsx("option",{value:"critical",children:"Critical Injury"}),r.jsx("option",{value:"near_miss",children:"Near Miss (No Injury)"})]})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Body Part Affected"}),r.jsx("input",{type:"text",value:xe,onChange:K=>ke(K.target.value),placeholder:"e.g., Left hand, lower back"})]})]})]}),z===2&&r.jsxs("div",{className:"form-step",children:[r.jsx("h3",{children:"Injured Employee Information"}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Full Name *"}),r.jsx("input",{type:"text",value:Ue,onChange:K=>ee(K.target.value),placeholder:"First and last name"})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Phone Number"}),r.jsx("input",{type:"tel",value:ve,onChange:K=>Ve(K.target.value),placeholder:"(555) 123-4567"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Email Address"}),r.jsx("input",{type:"email",value:Me,onChange:K=>M(K.target.value),placeholder:"email@example.com"})]})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Home Address"}),r.jsx("input",{type:"text",value:G,onChange:K=>ne(K.target.value),placeholder:"Street address, city, state, zip"})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Job Title *"}),r.jsx("input",{type:"text",value:pe,onChange:K=>C(K.target.value),placeholder:"e.g., Carpenter, Electrician"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Hire Date"}),r.jsx("input",{type:"date",value:X,onChange:K=>I(K.target.value)})]})]})]}),z===3&&r.jsxs("div",{className:"form-step",children:[r.jsx("h3",{children:"Foreman/Supervisor Making Report"}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Your Name *"}),r.jsx("input",{type:"text",value:Se,onChange:K=>Y(K.target.value),placeholder:"Full name"})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Your Title *"}),r.jsx("input",{type:"text",value:je,onChange:K=>P(K.target.value),placeholder:"e.g., Site Foreman, Project Manager"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Your Phone Number"}),r.jsx("input",{type:"tel",value:ye,onChange:K=>qe(K.target.value),placeholder:"(555) 123-4567"})]})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Your Email Address"}),r.jsx("input",{type:"email",value:F,onChange:K=>fe(K.target.value),placeholder:"email@example.com"})]})]}),z===4&&r.jsxs("div",{className:"form-step",children:[r.jsx("h3",{children:"Witness Testimonies (Optional)"}),Be.length>0&&r.jsx("div",{className:"witnesses-list",children:Be.map((K,Ut)=>r.jsxs("div",{className:"witness-item",children:[r.jsxs("div",{className:"witness-info",children:[r.jsx("strong",{children:K.name}),K.phone&&r.jsxs("span",{children:["  ",K.phone]}),K.testimony&&r.jsxs("p",{className:"witness-testimony",children:['"',K.testimony,'"']})]}),r.jsx("button",{className:"btn-danger btn-small",onClick:()=>Nt(Ut),children:"Remove"})]},Ut))}),r.jsxs("div",{className:"add-witness-form",children:[r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Witness Name"}),r.jsx("input",{type:"text",value:Ce,onChange:K=>Fe(K.target.value),placeholder:"Full name"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Phone Number"}),r.jsx("input",{type:"tel",value:Le,onChange:K=>rt(K.target.value),placeholder:"(555) 123-4567"})]})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Email Address"}),r.jsx("input",{type:"email",value:xt,onChange:K=>Ze(K.target.value),placeholder:"email@example.com"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Witness Testimony"}),r.jsx("textarea",{value:ra,onChange:K=>ot(K.target.value),rows:3,placeholder:"What did the witness see or hear?"})]}),r.jsx("button",{className:"btn-secondary",onClick:pn,children:"+ Add Witness"})]})]}),z===5&&r.jsxs("div",{className:"form-step",children:[r.jsx("h3",{children:"Medical Treatment & Safety"}),r.jsx("div",{className:"form-group checkbox-group",children:r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:St,onChange:K=>yr(K.target.checked)}),"Medical treatment required"]})}),St&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Medical Facility Name"}),r.jsx("input",{type:"text",value:mn,onChange:K=>Xn(K.target.value),placeholder:"Hospital or clinic name"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Medical Facility Address"}),r.jsx("input",{type:"text",value:Ra,onChange:K=>fn(K.target.value),placeholder:"Street address"})]}),r.jsx("div",{className:"form-group checkbox-group",children:r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:hn,onChange:K=>yt(K.target.checked)}),"Employee was hospitalized"]})})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Immediate Actions Taken"}),r.jsx("textarea",{value:Ua,onChange:K=>Vn(K.target.value),rows:2,placeholder:"What was done immediately after the incident?"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Corrective Actions Planned"}),r.jsx("textarea",{value:Zn,onChange:K=>sa(K.target.value),rows:2,placeholder:"What will be done to prevent this in the future?"})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Safety Equipment Used"}),r.jsx("input",{type:"text",value:Ha,onChange:K=>vt(K.target.value),placeholder:"e.g., Hard hat, gloves, harness"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Safety Equipment Failed"}),r.jsx("input",{type:"text",value:La,onChange:K=>Kn(K.target.value),placeholder:"Equipment that failed, if any"})]})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Days Away From Work"}),r.jsx("input",{type:"number",min:"0",value:Z,onChange:K=>as(K.target.value)})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Restricted Work Days"}),r.jsx("input",{type:"number",min:"0",value:vr,onChange:K=>va(K.target.value)})]})]}),r.jsx("div",{className:"form-group checkbox-group",children:r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:ya,onChange:K=>wt(K.target.checked)}),"OSHA Recordable Incident"]})}),r.jsx("div",{className:"form-group checkbox-group",children:r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:se,onChange:K=>kt(K.target.checked)}),"Workers' Compensation Claim Filed"]})})]})]}),r.jsx("div",{className:"modal-footer",children:r.jsxs("div",{className:"form-actions",children:[z>1&&r.jsx("button",{className:"btn-secondary",onClick:ka,children:" Back"}),r.jsx("button",{className:"btn-secondary",onClick:o,children:"Cancel"}),z<5?r.jsx("button",{className:"btn-primary",onClick:Ea,children:"Next "}):r.jsx("button",{className:"btn-primary",onClick:Dt,disabled:m,children:m?"Submitting...":"Submit Report"})]})})]})}),y&&r.jsx(hr,{message:y.message,type:y.type,onClose:()=>b(null)}),r.jsx("style",{children:`
        .injury-report-modal {
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid var(--border-color);
          background-color: var(--bg-elevated);
          overflow-x: auto;
        }

        .progress-steps .step {
          font-size: 0.875rem;
          color: var(--text-muted);
          font-weight: 500;
          white-space: nowrap;
          padding: 0.5rem;
        }

        .progress-steps .step.active {
          color: var(--accent-primary);
          font-weight: 600;
        }

        .form-step h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          color: var(--text-primary);
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 1rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-group textarea {
          resize: vertical;
        }

        .checkbox-group label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: normal;
          cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
          width: auto;
          margin: 0;
        }

        .witnesses-list {
          margin-bottom: 1.5rem;
        }

        .witness-item {
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .witness-info {
          flex: 1;
          color: var(--text-primary);
        }

        .witness-testimony {
          margin-top: 0.5rem;
          color: var(--text-secondary);
          font-style: italic;
          font-size: 0.875rem;
        }

        .add-witness-form {
          border: 2px dashed var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          background-color: var(--bg-elevated);
        }

        .modal-footer {
          border-top: 1px solid var(--border-color);
          padding: 1rem 1.5rem;
        }

        .form-actions {
          display: flex;
          justify-content: space-between;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
        }

        @media (max-width: 768px) {
          .injury-report-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }

          .form-row {
            grid-template-columns: 1fr;
          }

          .progress-steps .step {
            font-size: 0.75rem;
            padding: 0.25rem;
          }
        }
      `})]})}const xi=[{value:"concrete",label:"Concrete",icon:""},{value:"trash",label:"Trash",icon:""},{value:"metals",label:"Metals",icon:""},{value:"hazardous_waste",label:"Hazardous",icon:""}],yy=s=>xi.find(l=>l.value===s)||{label:s,icon:""};function vy({project:s,user:l=null,date:i,onShowToast:o}){const[d,m]=w.useState([]),[p,y]=w.useState([]),[b,z]=w.useState(!0),[B,O]=w.useState(!1),[$,W]=w.useState(!1),[te,V]=w.useState(!1),[oe,ae]=w.useState({type:"concrete",count:1}),me=new Date(i).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});w.useEffect(()=>{ue(),J()},[s.id,i]);const ue=async()=>{try{z(!0);const M=await _e.getDisposalLoads(s.id,i);m(M||[])}catch(M){console.error("Error loading disposal loads:",M)}finally{z(!1)}},J=async()=>{try{const G=(await _e.getDisposalLoadsHistory(s.id,14)||[]).filter(pe=>pe.load_date!==i).reduce((pe,C)=>(pe[C.load_date]||(pe[C.load_date]=[]),pe[C.load_date].push(C),pe),{}),ne=Object.entries(G).map(([pe,C])=>({date:pe,loads:C,totalLoads:C.reduce((X,I)=>X+I.load_count,0)})).sort((pe,C)=>new Date(C.date)-new Date(pe.date));y(ne)}catch(M){console.error("Error loading disposal history:",M)}},xe=async()=>{if(!(oe.count<1)){O(!0);try{await _e.addDisposalLoad(s.id,l?.id||null,i,oe.type,oe.count),await ue(),ae({type:"concrete",count:1}),W(!1),o?.("Disposal load added","success")}catch(M){console.error("Error adding disposal load:",M),o?.("Error adding load","error")}finally{O(!1)}}},ke=async M=>{O(!0);try{await _e.deleteDisposalLoad(M),await ue(),o?.("Load removed","success")}catch(G){console.error("Error deleting disposal load:",G),o?.("Error removing load","error")}finally{O(!1)}},Ue=async M=>{O(!0);try{await _e.addDisposalLoad(s.id,l?.id||null,i,M,1),await ue(),o?.("Load added","success")}catch(G){console.error("Error adding disposal load:",G),o?.("Error adding load","error")}finally{O(!1)}},ee=async M=>{O(!0);try{await _e.updateDisposalLoad(M.id,M.load_type,M.load_count+1),await ue()}catch(G){console.error("Error updating load:",G),o?.("Error updating load","error")}finally{O(!1)}},ve=async M=>{if(M.load_count<=1){await ke(M.id);return}O(!0);try{await _e.updateDisposalLoad(M.id,M.load_type,M.load_count-1),await ue()}catch(G){console.error("Error updating load:",G),o?.("Error updating load","error")}finally{O(!1)}},Ve=d.reduce((M,G)=>(M[G.load_type]||(M[G.load_type]={items:[],total:0}),M[G.load_type].items.push(G),M[G.load_type].total+=G.load_count,M),{}),Me=d.reduce((M,G)=>M+G.load_count,0);return b?r.jsxs("div",{className:"disposal-load-input",children:[r.jsxs("div",{className:"disposal-header",children:[r.jsx(Pc,{size:20}),r.jsx("span",{children:"Disposal Loads"})]}),r.jsx("div",{className:"disposal-loading",children:"Loading..."})]}):r.jsxs("div",{className:"disposal-load-input",children:[r.jsxs("div",{className:"disposal-header",children:[r.jsxs("div",{className:"disposal-title",children:[r.jsx(Pc,{size:20}),r.jsx("span",{children:"Disposal Loads"}),Me>0&&r.jsx("span",{className:"disposal-badge",children:Me})]}),r.jsx("span",{className:"disposal-date",children:me})]}),r.jsx("div",{className:"disposal-quick-add",children:xi.map(M=>r.jsxs("button",{className:"quick-add-btn",onClick:()=>Ue(M.value),disabled:B,children:[r.jsx("span",{className:"quick-add-icon",children:M.icon}),r.jsxs("span",{className:"quick-add-label",children:["+ ",M.label]})]},M.value))}),Object.keys(Ve).length>0?r.jsx("div",{className:"disposal-loads-list",children:xi.map(M=>{const G=Ve[M.value];return G?r.jsxs("div",{className:"disposal-load-row",children:[r.jsxs("div",{className:"load-info",children:[r.jsx("span",{className:"load-icon",children:M.icon}),r.jsx("span",{className:"load-label",children:M.label})]}),r.jsxs("div",{className:"load-controls",children:[r.jsx("button",{className:"load-btn decrement",onClick:()=>ve(G.items[0]),disabled:B,children:r.jsx(nh,{size:16})}),r.jsx("span",{className:"load-count",children:G.total}),r.jsx("button",{className:"load-btn increment",onClick:()=>ee(G.items[0]),disabled:B,children:r.jsx(Gc,{size:16})})]})]},M.value):null})}):r.jsxs("div",{className:"disposal-empty",children:[r.jsxs("p",{children:["No disposal loads recorded for ",me]}),r.jsx("p",{className:"disposal-hint",children:"Tap a button above to add loads"})]}),$&&r.jsxs("div",{className:"disposal-add-form",children:[r.jsxs("div",{className:"add-form-row",children:[r.jsx("select",{value:oe.type,onChange:M=>ae({...oe,type:M.target.value}),className:"load-type-select",children:xi.map(M=>r.jsxs("option",{value:M.value,children:[M.icon," ",M.label]},M.value))}),r.jsxs("div",{className:"count-input-group",children:[r.jsx("button",{className:"count-btn",onClick:()=>ae({...oe,count:Math.max(1,oe.count-1)}),children:r.jsx(nh,{size:16})}),r.jsx("input",{type:"number",min:"1",value:oe.count,onChange:M=>ae({...oe,count:parseInt(M.target.value)||1}),className:"count-input"}),r.jsx("button",{className:"count-btn",onClick:()=>ae({...oe,count:oe.count+1}),children:r.jsx(Gc,{size:16})})]})]}),r.jsxs("div",{className:"add-form-actions",children:[r.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>W(!1),children:[r.jsx(iu,{size:16})," Cancel"]}),r.jsxs("button",{className:"btn btn-primary btn-small",onClick:xe,disabled:B,children:[r.jsx(na,{size:16})," Add"]})]})]}),!$&&r.jsxs("button",{className:"disposal-add-custom",onClick:()=>W(!0),children:[r.jsx(Gc,{size:16}),"Add multiple loads"]}),Me>0&&r.jsxs("div",{className:"disposal-summary",children:[r.jsx("strong",{children:Me})," total load",Me!==1?"s":""," today"]}),p.length>0&&r.jsxs("div",{className:"disposal-history-section",children:[r.jsxs("button",{className:"disposal-history-toggle",onClick:()=>V(!te),children:[r.jsx(w_,{size:16}),r.jsxs("span",{children:["View History (",p.length," days)"]}),te?r.jsx(u_,{size:16}):r.jsx(o_,{size:16})]}),te&&r.jsx("div",{className:"disposal-history-list",children:p.map(M=>{const G=new Date(M.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),ne=M.loads.reduce((pe,C)=>(pe[C.load_type]||(pe[C.load_type]=0),pe[C.load_type]+=C.load_count,pe),{});return r.jsxs("div",{className:"disposal-history-day",children:[r.jsxs("div",{className:"disposal-history-header",children:[r.jsx("span",{className:"disposal-history-date",children:G}),r.jsxs("span",{className:"disposal-history-total",children:[M.totalLoads," load",M.totalLoads!==1?"s":""]})]}),r.jsx("div",{className:"disposal-history-types",children:Object.entries(ne).map(([pe,C])=>{const X=yy(pe);return r.jsxs("span",{className:"disposal-history-type",children:[X.icon," ",C," ",X.label]},pe)})})]},M.date)})})]})]})}function by({project:s,companyId:l,onShowToast:i,onExit:o}){const[d,m]=w.useState([]),[p,y]=w.useState(!0),[b,z]=w.useState(null),[B,O]=w.useState({}),[$,W]=w.useState(!1),[te,V]=w.useState(!1),[oe,ae]=w.useState(!1),[me,ue]=w.useState(!1),[J,xe]=w.useState(!1),[ke,Ue]=w.useState(!1),[ee,ve]=w.useState("actions");w.useEffect(()=>{Ve()},[s.id]);const Ve=async()=>{try{const Y=await _e.getAreas(s.id);m(Y);const je=[...new Set(Y.map(ye=>ye.group_name||"General"))],P={};je.forEach(ye=>P[ye]=!1),O(P)}catch(Y){console.error("Error loading areas:",Y),i("Error loading areas","error")}finally{y(!1)}},Me=async(Y,je)=>{const P=d.find(qe=>qe.id===Y);if(!P)return;const ye=P.status===je?"not_started":je;z(Y);try{await _e.updateAreaStatus(Y,ye),m(qe=>qe.map(F=>F.id===Y?{...F,status:ye}:F)),i("Updated","success")}catch(qe){console.error("Error updating status:",qe),i("Error updating","error")}finally{z(null)}},M=Y=>{O(je=>({...je,[Y]:!je[Y]}))};if(p)return r.jsx("div",{className:"foreman-container",children:r.jsxs("div",{className:"loading",children:[r.jsx("div",{className:"spinner"}),"Loading..."]})});if($)return r.jsx("div",{className:"foreman-container",children:r.jsx(hy,{project:s,companyId:l,onSubmit:()=>W(!1),onCancel:()=>W(!1),onShowToast:i})});if(me)return r.jsx(gy,{project:s,onShowToast:i,onClose:()=>ue(!1)});if(J)return r.jsx("div",{className:"foreman-container",children:r.jsx(_y,{project:s,companyId:l,onClose:()=>xe(!1),onReportCreated:()=>{xe(!1),i("Injury report submitted","success")}})});if(te)return r.jsxs("div",{className:"foreman-container",children:[r.jsxs("div",{className:"foreman-view-header",children:[r.jsx("button",{className:"back-btn-simple",onClick:()=>V(!1),children:""}),r.jsx("h2",{children:"Crew Check-in"})]}),r.jsx(py,{project:s,companyId:l,onShowToast:i})]});if(oe)return r.jsxs("div",{className:"foreman-container",children:[r.jsxs("div",{className:"foreman-view-header",children:[r.jsx("button",{className:"back-btn-simple",onClick:()=>ae(!1),children:""}),r.jsx("h2",{children:"Disposal Loads"})]}),r.jsx(vy,{project:s,date:new Date().toISOString().split("T")[0],onShowToast:i})]});const G=oy(d),ne=d.reduce((Y,je)=>{const P=je.group_name||"General";return Y[P]||(Y[P]=[]),Y[P].push(je),Y},{}),pe=Object.keys(ne).length>1||Object.keys(ne).length===1&&!ne.General,C=Y=>`${Y.filter(P=>P.status==="done").length}/${Y.length}`,X=d.filter(Y=>Y.status==="done").length,I=d.filter(Y=>Y.status==="working").length,Se=d.length-X;return r.jsxs("div",{className:"foreman-container",children:[r.jsxs("div",{className:"foreman-header",children:[r.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),r.jsxs("div",{className:"foreman-header-info",children:[r.jsx("div",{className:"foreman-project-name",children:s.name}),r.jsxs("div",{className:"foreman-progress",children:[G,"% Complete"]})]}),r.jsxs("div",{className:"foreman-header-actions",children:[r.jsx(eu,{compact:!0}),r.jsx("button",{className:"foreman-info-btn",onClick:()=>Ue(!ke),children:r.jsx(C_,{size:20})})]})]}),ke&&r.jsxs("div",{className:"foreman-project-info",children:[s.job_number&&r.jsxs("div",{className:"foreman-info-row",children:[r.jsx("span",{className:"foreman-info-label",children:"Job #"}),r.jsx("span",{className:"foreman-info-value",children:s.job_number})]}),s.address&&r.jsxs("div",{className:"foreman-info-row",children:[r.jsx("span",{className:"foreman-info-label",children:"Address"}),r.jsx("span",{className:"foreman-info-value",children:s.address})]}),s.general_contractor&&r.jsxs("div",{className:"foreman-info-row",children:[r.jsx("span",{className:"foreman-info-label",children:"GC / Client"}),r.jsx("span",{className:"foreman-info-value",children:s.general_contractor})]}),s.client_contact&&r.jsxs("div",{className:"foreman-info-row",children:[r.jsx("span",{className:"foreman-info-label",children:"Contact"}),r.jsx("span",{className:"foreman-info-value",children:s.client_contact})]}),s.client_phone&&r.jsxs("div",{className:"foreman-info-row",children:[r.jsx("span",{className:"foreman-info-label",children:"Phone"}),r.jsx("a",{href:`tel:${s.client_phone}`,className:"foreman-info-value foreman-info-link",children:s.client_phone})]})]}),r.jsxs("div",{className:"foreman-stats",children:[r.jsxs("div",{className:"foreman-stat",children:[r.jsx("div",{className:"foreman-stat-value working",children:I}),r.jsx("div",{className:"foreman-stat-label",children:"Working"})]}),r.jsxs("div",{className:"foreman-stat",children:[r.jsx("div",{className:"foreman-stat-value done",children:X}),r.jsx("div",{className:"foreman-stat-label",children:"Done"})]}),r.jsxs("div",{className:"foreman-stat",children:[r.jsx("div",{className:"foreman-stat-value remaining",children:Se}),r.jsx("div",{className:"foreman-stat-label",children:"Remaining"})]})]}),r.jsxs("div",{className:"foreman-tabs",children:[r.jsxs("button",{className:`foreman-tab ${ee==="actions"?"active":""}`,onClick:()=>ve("actions"),children:[r.jsx(Ic,{size:18}),"Actions"]}),r.jsxs("button",{className:`foreman-tab ${ee==="progress"?"active":""}`,onClick:()=>ve("progress"),children:[r.jsx(X_,{size:18}),"Progress"]})]}),ee==="actions"&&r.jsxs("div",{className:"field-actions",children:[r.jsxs("button",{className:"field-action-btn",onClick:()=>V(!0),children:[r.jsx(un,{size:22}),"Crew Check-in"]}),r.jsxs("button",{className:"field-action-btn",onClick:()=>W(!0),children:[r.jsx(wi,{size:22}),"T&M Ticket"]}),r.jsxs("button",{className:"field-action-btn",onClick:()=>ae(!0),children:[r.jsx(Pc,{size:22}),"Disposal Loads"]}),r.jsxs("button",{className:"field-action-btn",onClick:()=>ue(!0),children:[r.jsx(th,{size:22}),"Daily Report"]}),r.jsxs("button",{className:"field-action-btn danger",onClick:()=>xe(!0),children:[r.jsx(lu,{size:22}),"Report Injury"]})]}),ee==="progress"&&r.jsxs("div",{className:"foreman-areas",children:[pe?Object.entries(ne).map(([Y,je])=>r.jsxs("div",{className:"foreman-group",children:[r.jsxs("div",{className:"foreman-group-header",onClick:()=>M(Y),children:[r.jsxs("div",{className:"foreman-group-title",children:[r.jsx("span",{className:"foreman-group-arrow",children:B[Y]?"":""}),r.jsx("span",{className:"foreman-group-name",children:Y})]}),r.jsx("span",{className:"foreman-group-progress",children:C(je)})]}),B[Y]&&r.jsx("div",{className:"foreman-group-tasks",children:je.map(P=>r.jsxs("div",{className:`foreman-area-card ${P.status}`,children:[r.jsx("div",{className:"foreman-area-name",children:P.name}),r.jsxs("div",{className:"foreman-area-buttons",children:[r.jsx("button",{className:`foreman-btn working ${P.status==="working"?"active":""}`,onClick:()=>Me(P.id,"working"),disabled:b===P.id,children:b===P.id?"...":"Working"}),r.jsx("button",{className:`foreman-btn done ${P.status==="done"?"active":""}`,onClick:()=>Me(P.id,"done"),disabled:b===P.id,children:b===P.id?"...":"Done"})]})]},P.id))})]},Y)):d.map(Y=>r.jsxs("div",{className:`foreman-area-card ${Y.status}`,children:[r.jsx("div",{className:"foreman-area-name",children:Y.name}),r.jsxs("div",{className:"foreman-area-buttons",children:[r.jsx("button",{className:`foreman-btn working ${Y.status==="working"?"active":""}`,onClick:()=>Me(Y.id,"working"),disabled:b===Y.id,children:b===Y.id?"...":"Working"}),r.jsx("button",{className:`foreman-btn done ${Y.status==="done"?"active":""}`,onClick:()=>Me(Y.id,"done"),disabled:b===Y.id,children:b===Y.id?"...":"Done"})]})]},Y.id)),d.length===0&&r.jsxs("div",{className:"foreman-empty",children:[r.jsx(th,{size:48,className:"foreman-empty-icon"}),r.jsx("div",{className:"foreman-empty-text",children:"No areas yet"}),r.jsx("div",{className:"foreman-empty-subtext",children:"Office needs to add areas to this project"})]})]})]})}const jy=w.lazy(()=>gr(()=>import("./Dashboard-DneRhhE2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),xy=w.lazy(()=>gr(()=>import("./Setup-DqsMOzl0.js"),__vite__mapDeps([10,4,3,5,9]))),Sy=w.lazy(()=>gr(()=>import("./BrandingSettings-BWrMEnC_.js"),__vite__mapDeps([11,3,5,9]))),wy=w.lazy(()=>gr(()=>import("./PricingManager-6wLGypMb.js"),__vite__mapDeps([12,7,2,3,5,9]))),Ny=w.lazy(()=>gr(()=>import("./PublicView-DCX_kOq_.js"),__vite__mapDeps([13,3,5,9]))),Cy=w.lazy(()=>gr(()=>import("./SignaturePage-DW6GFrM9.js"),__vite__mapDeps([14,6,5,1,7,3,9]))),Ey=w.lazy(()=>gr(()=>import("./MembershipManager-BiL_DD2X.js"),__vite__mapDeps([15,1,8,3,5,9])));function Xc(){return r.jsxs("div",{className:"page-loader",children:[r.jsx(_a,{className:"loading-logo"}),r.jsx("div",{className:"spinner"})]})}function ky(){const[s,l]=w.useState("entry"),[i,o]=w.useState(null),[d,m]=w.useState(null),[p,y]=w.useState([]),[b,z]=w.useState([]),[B,O]=w.useState(null),[$,W]=w.useState(null),[te,V]=w.useState(null),[oe,ae]=w.useState(!0),[me,ue]=w.useState("dashboard"),[J,xe]=w.useState(null),[ke,Ue]=w.useState(!1),[ee,ve]=w.useState(!1),[Ve,Me]=w.useState(null),[M,G]=w.useState(0);w.useEffect(()=>{const le=window.location.pathname,Ce=le.match(/^\/view\/([a-zA-Z0-9_-]+)$/),Fe=le.match(/^\/sign\/([a-zA-Z0-9_-]+)$/);Ce?(W(Ce[1]),l("public"),ae(!1)):Fe?(V(Fe[1]),l("signature"),ae(!1)):ne()},[]),w.useEffect(()=>{if(!v)return;const{data:{subscription:le}}=_.auth.onAuthStateChange(async(Ce,Fe)=>{Ce==="SIGNED_OUT"||Ce==="USER_DELETED"?(o(null),m(null),y([]),l("entry")):Ce==="TOKEN_REFRESHED"||Ce==="SIGNED_IN"&&!i&&ne()});return()=>{le?.unsubscribe()}},[i]);const ne=async()=>{try{if(!v){ae(!1);return}const{data:{user:le}}=await _.auth.getUser();if(!le){ae(!1);return}const{data:Ce,error:Fe}=await _.from("users").select("*").eq("id",le.id).single();if(Ce){o(Ce);let Le=await _e.getUserCompanies(le.id);if(Le.length===0&&Ce.company_id&&await _e.repairLegacyUser(le.id,Ce.company_id,Ce.role||"member")&&(Le=await _e.getUserCompanies(le.id)),y(Le),Le.length===0){if(await _e.getUserPendingMemberships(le.id)>0){l("pending");return}Y("No company access. Join a company to continue.","error"),await Fc.signOut();return}const rt=localStorage.getItem("selectedCompanyId");let xt=null;if(rt&&Le.find(Ze=>Ze.id===rt)?xt=Le.find(Ze=>Ze.id===rt):Le.length>0&&(xt=Le[0]),xt){const{data:Ze}=await _.from("companies").select("*").eq("id",xt.id).single();m(Ze),l("office")}}}catch(le){console.error("Auth check error:",le)}finally{ae(!1)}},pe=le=>{O(le),l("foreman")},C=async(le,Ce)=>{try{const{data:Fe,error:Le}=await _.auth.signInWithPassword({email:le,password:Ce});if(Le){Y(Le.message||"Invalid credentials","error");return}const{data:rt,error:xt}=await _.from("users").select("*").eq("id",Fe.user.id).single();if(xt){console.error("User fetch error:",xt),Y("Error loading profile","error");return}if(rt){o(rt);let Ze=await _e.getUserCompanies(Fe.user.id);Ze.length===0&&rt.company_id&&await _e.repairLegacyUser(Fe.user.id,rt.company_id,rt.role||"member")&&(Ze=await _e.getUserCompanies(Fe.user.id)),y(Ze);const ra=localStorage.getItem("selectedCompanyId");let ot=null;if(ra&&Ze.find(St=>St.id===ra)?ot=Ze.find(St=>St.id===ra):Ze.length>0&&(ot=Ze[0]),ot){const{data:St}=await _.from("companies").select("*").eq("id",ot.id).single();m(St),l("office")}else await _e.getUserPendingMemberships(Fe.user.id)>0?l("pending"):Y("No company access. Please contact admin.","error")}else Y("Profile not found. Please contact admin.","error")}catch(Fe){console.error("Login error:",Fe),Y("Login failed","error")}},X=async le=>{try{const{data:Ce}=await _.from("companies").select("*").eq("id",le).single();Ce&&(m(Ce),localStorage.setItem("selectedCompanyId",le),Ue(!1),ue("dashboard"),Y(`Switched to ${Ce.name}`,"success"))}catch(Ce){console.error("Switch company error:",Ce),Y("Error switching company","error")}},I=async()=>{try{await Fc.signOut(),o(null),m(null),y([]),l("entry"),ue("dashboard"),localStorage.removeItem("selectedCompanyId")}catch(le){console.error("Logout error:",le),Y("Error signing out","error")}},Se=async()=>{await _h(),O(null),l("entry")},Y=w.useCallback((le,Ce="")=>{xe({message:le,type:Ce})},[]),je=()=>{ue("dashboard"),d?.id&&P()},P=async()=>{if(d?.id)try{const le=await _e.getProjects(d.id);z(le)}catch(le){console.error("Error loading projects:",le)}};w.useEffect(()=>{d?.id&&s==="office"&&(P(),ye())},[d?.id,s]);const ye=async()=>{if(d?.id)try{const Ce=(await _e.getCompanyMemberships(d.id)).filter(Fe=>Fe.status==="pending").length;G(Ce)}catch(le){console.error("Error loading pending count:",le)}},qe=w.useCallback(()=>{Me(null)},[]);if(oe)return r.jsx(fr,{children:r.jsx(mr,{companyId:d?.id,children:r.jsxs("div",{className:"loading-screen",children:[r.jsx(_a,{className:"loading-logo"}),r.jsx("div",{className:"spinner"})]})})});if(s==="entry")return r.jsx(fr,{children:r.jsxs(mr,{children:[r.jsx(ts,{children:r.jsx(iy,{onForemanAccess:pe,onOfficeLogin:C,onShowToast:Y})}),J&&r.jsx(hr,{message:J.message,type:J.type,onClose:()=>xe(null)})]})});if(s==="public"&&$)return r.jsx(fr,{children:r.jsxs(mr,{children:[r.jsx(ts,{children:r.jsx(w.Suspense,{fallback:r.jsx(Xc,{}),children:r.jsx(Ny,{shareToken:$})})}),J&&r.jsx(hr,{message:J.message,type:J.type,onClose:()=>xe(null)})]})});if(s==="signature"&&te)return r.jsx(fr,{children:r.jsxs(mr,{children:[r.jsx(ts,{children:r.jsx(w.Suspense,{fallback:r.jsx(Xc,{}),children:r.jsx(Cy,{signatureToken:te})})}),J&&r.jsx(hr,{message:J.message,type:J.type,onClose:()=>xe(null)})]})});if(s==="pending")return r.jsx(fr,{children:r.jsxs(mr,{children:[r.jsx(ts,{children:r.jsxs("div",{className:"pending-approval-screen",children:[r.jsx(_a,{className:"pending-logo"}),r.jsx("h2",{children:"Awaiting Approval"}),r.jsx("p",{children:"Your membership request has been submitted."}),r.jsx("p",{children:"A company admin will review your request."}),r.jsxs("div",{className:"pending-actions",children:[r.jsx("button",{className:"btn btn-secondary",onClick:I,children:"Sign Out"}),r.jsx("button",{className:"btn btn-primary",onClick:ne,children:"Check Status"})]})]})}),J&&r.jsx(hr,{message:J.message,type:J.type,onClose:()=>xe(null)})]})});if(s==="foreman"&&B)return r.jsx(fr,{children:r.jsxs(mr,{companyId:B.company_id,children:[r.jsx(ts,{children:r.jsx(by,{project:B,companyId:B.company_id,onShowToast:Y,onExit:Se})}),r.jsx(rh,{}),J&&r.jsx(hr,{message:J.message,type:J.type,onClose:()=>xe(null)})]})});const Be=p.find(le=>le.id===d?.id)?.access_level==="administrator"||d?.owner_user_id===i?.id;return r.jsx(fr,{children:r.jsx(mr,{companyId:d?.id,children:r.jsxs("div",{children:[!v&&r.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),r.jsx("nav",{className:"nav",children:r.jsxs("div",{className:"nav-content",children:[r.jsx(_a,{}),r.jsxs("div",{className:"nav-tabs nav-tabs-desktop",children:[r.jsx("button",{className:`nav-tab ${me==="dashboard"?"active":""}`,onClick:()=>ue("dashboard"),children:"Dashboard"}),r.jsx("button",{className:`nav-tab ${me==="setup"?"active":""}`,onClick:()=>ue("setup"),children:"+ New Project"}),r.jsx("button",{className:`nav-tab ${me==="pricing"?"active":""}`,onClick:()=>ue("pricing"),children:"Pricing"}),Be&&r.jsx("button",{className:`nav-tab ${me==="branding"?"active":""}`,onClick:()=>ue("branding"),children:"Branding"}),Be&&r.jsxs("button",{className:`nav-tab ${me==="team"?"active":""}`,onClick:()=>ue("team"),children:["Team",M>0&&r.jsx("span",{className:"nav-tab-badge",children:M})]})]}),r.jsxs("div",{className:"nav-user nav-user-desktop",children:[r.jsx(eu,{compact:!0}),r.jsxs("div",{className:"mobile-menu",children:[r.jsx("button",{className:"mobile-menu-btn",onClick:()=>ve(!ee),"aria-label":"User menu",children:""}),ee&&r.jsxs("div",{className:"mobile-menu-dropdown",children:[r.jsxs("div",{className:"mobile-menu-info",children:[r.jsx("div",{className:"mobile-menu-user",children:i?.name||i?.email}),d&&r.jsx("div",{className:"mobile-menu-company",children:d.name})]}),r.jsx("button",{className:"mobile-menu-logout",onClick:()=>{ve(!1),I()},children:"Sign Out"})]})]}),p.length>1&&r.jsxs("div",{className:"company-switcher",children:[r.jsxs("button",{className:"company-switcher-btn",onClick:()=>Ue(!ke),children:[d?.name||"Select Company",r.jsx("span",{className:"switcher-arrow",children:""})]}),ke&&r.jsx("div",{className:"company-dropdown",children:p.map(le=>r.jsxs("button",{className:`company-option ${le.id===d?.id?"active":""}`,onClick:()=>X(le.id),children:[le.name,le.id===d?.id&&r.jsx("span",{className:"check",children:""})]},le.id))})]}),p.length<=1&&d&&r.jsx("span",{className:"nav-company-name",children:d.name}),r.jsx("span",{className:"nav-user-name",children:i?.name||i?.email}),r.jsx("button",{className:"nav-logout",onClick:I,children:"Sign Out"})]}),r.jsx("button",{className:"mobile-menu-btn",onClick:()=>ve(!0),"aria-label":"Open menu",children:r.jsxs("span",{className:"hamburger-icon",children:[r.jsx("span",{}),r.jsx("span",{}),r.jsx("span",{})]})})]})}),ee&&r.jsx("div",{className:"mobile-drawer-overlay",onClick:()=>ve(!1),children:r.jsxs("div",{className:"mobile-drawer",onClick:le=>le.stopPropagation(),children:[r.jsxs("div",{className:"mobile-drawer-header",children:[r.jsx(_a,{}),r.jsx("button",{className:"mobile-drawer-close",onClick:()=>ve(!1),"aria-label":"Close menu",children:""})]}),r.jsxs("div",{className:"mobile-drawer-user",children:[r.jsx("div",{className:"mobile-user-avatar",children:(i?.name||i?.email||"U")[0].toUpperCase()}),r.jsxs("div",{className:"mobile-user-info",children:[r.jsx("span",{className:"mobile-user-name",children:i?.name||i?.email}),r.jsx("span",{className:"mobile-user-company",children:d?.name})]})]}),p.length>1&&r.jsxs("div",{className:"mobile-drawer-section",children:[r.jsx("div",{className:"mobile-section-title",children:"Switch Company"}),r.jsx("div",{className:"mobile-company-list",children:p.map(le=>r.jsxs("button",{className:`mobile-company-option ${le.id===d?.id?"active":""}`,onClick:()=>{X(le.id),ve(!1)},children:[r.jsx("span",{className:"mobile-company-name",children:le.name}),le.id===d?.id&&r.jsx("span",{className:"mobile-company-check",children:""})]},le.id))})]}),r.jsxs("div",{className:"mobile-drawer-section",children:[r.jsx("div",{className:"mobile-section-title",children:"Navigation"}),r.jsxs("div",{className:"mobile-nav-list",children:[r.jsx("button",{className:`mobile-nav-item ${me==="dashboard"?"active":""}`,onClick:()=>{ue("dashboard"),ve(!1)},children:"Dashboard"}),r.jsx("button",{className:`mobile-nav-item ${me==="setup"?"active":""}`,onClick:()=>{ue("setup"),ve(!1)},children:"+ New Project"}),r.jsx("button",{className:`mobile-nav-item ${me==="pricing"?"active":""}`,onClick:()=>{ue("pricing"),ve(!1)},children:"Pricing"}),Be&&r.jsx("button",{className:`mobile-nav-item ${me==="branding"?"active":""}`,onClick:()=>{ue("branding"),ve(!1)},children:"Branding"}),Be&&r.jsxs("button",{className:`mobile-nav-item ${me==="team"?"active":""}`,onClick:()=>{ue("team"),ve(!1)},children:["Team",M>0&&r.jsx("span",{className:"mobile-nav-badge",children:M})]})]})]}),r.jsxs("div",{className:"mobile-drawer-section",children:[r.jsx("div",{className:"mobile-section-title",children:"Appearance"}),r.jsx("div",{className:"mobile-theme-toggle",children:r.jsx(eu,{})})]}),r.jsx("div",{className:"mobile-drawer-footer",children:r.jsx("button",{className:"mobile-logout-btn",onClick:()=>{I(),ve(!1)},children:"Sign Out"})})]})}),r.jsx(ts,{children:r.jsx(w.Suspense,{fallback:r.jsx(Xc,{}),children:r.jsxs("div",{className:"container",children:[me==="dashboard"&&r.jsx(jy,{company:d,user:i,isAdmin:Be,onShowToast:Y,navigateToProjectId:Ve,onProjectNavigated:qe}),me==="setup"&&r.jsx(xy,{company:d,user:i,onProjectCreated:je,onShowToast:Y}),me==="pricing"&&r.jsx(wy,{company:d,onShowToast:Y}),me==="branding"&&r.jsx(Sy,{company:d,onShowToast:Y}),me==="team"&&Be&&r.jsx(Ey,{company:d,user:i,onShowToast:Y})]},d?.id)})}),r.jsx(rh,{}),J&&r.jsx(hr,{message:J.message,type:J.type,onClose:()=>xe(null)})]})})})}zg.createRoot(document.getElementById("root")).render(r.jsx(dh.StrictMode,{children:r.jsx(ky,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(s=>{setInterval(()=>{s.update().catch(()=>{})},3e5)}).catch(()=>{})});export{Wc as A,xh as B,Ps as C,Jg as D,Kg as E,wi as F,u_ as G,un as H,C_ as I,zy as J,Uy as K,Sh as L,nh as M,My as N,Hy as O,Yc as P,cy as Q,U_ as R,dy as S,lu as T,Ry as U,_a as V,ry as W,iu as X,ay as Y,ey as Z,Oy as _,Is as a,na as b,Ee as c,Ay as d,th as e,f_ as f,Lc as g,_e as h,o_ as i,r as j,Ly as k,By as l,hr as m,_y as n,$s as o,X_ as p,G_ as q,w as r,J_ as s,Gc as t,Fg as u,B_ as v,Pc as w,Te as x,_ as y,M_ as z};
