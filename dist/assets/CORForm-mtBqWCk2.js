import{ar as p,as as e,aZ as ve,a_ as P,aT as ut,a$ as Ee,b0 as dt,aE as b,b1 as Te,b2 as $,b3 as z,b4 as Le,b5 as mt,b6 as Fe}from"./index-Cv-cBSFm.js";import{r as o,X as Ce,e as qe,F as Pe,N as pt,a3 as ht,l as _t,q as $e,y as ze,C as jt,ai as ge,n as xe,ay as bt,u as vt}from"./icons-HD9y4hwp.js";import"./react-DXGY7bZi.js";import"./pdf-aQqpMATS.js";import"./supabase-VuevzHjS.js";const ye=()=>{const N=new Uint8Array(6);return crypto.getRandomValues(N),Array.from(N,L=>L.toString(36)).join("")};function gt({projectId:N,corId:L,onImport:Q,onClose:l,onShowToast:S}){const[A,y]=o.useState([]),[V,D]=o.useState(!0),[v,O]=o.useState(new Set),[ke,te]=o.useState(null),[R,ae]=o.useState(""),[h,U]=o.useState("unassigned");o.useEffect(()=>{g()},[N]);const g=async()=>{try{const r=await p.getTMTickets(N);y(r||[])}catch(r){console.error("Error loading tickets:",r),S?.("Error loading tickets","error")}finally{D(!1)}},j=o.useMemo(()=>{let r=[...A];if(h==="unassigned"?r=r.filter(i=>!i.assigned_cor_id):h==="approved"&&(r=r.filter(i=>i.status==="approved")),R){const i=R.toLowerCase();r=r.filter(d=>d.work_description?.toLowerCase().includes(i)||d.ce_pco_number?.toLowerCase().includes(i)||d.ticket_date?.includes(i))}return r.sort((i,d)=>new Date(d.ticket_date)-new Date(i.ticket_date)),r},[A,h,R]),M=r=>{const i=new Set(v);i.has(r)?i.delete(r):i.add(r),O(i)},fe=()=>{v.size===j.length?O(new Set):O(new Set(j.map(r=>r.id)))},E=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Ne=r=>{const i=r.t_and_m_workers||r.workers||[],d=r.t_and_m_items||r.items||[],_=i.length,c=d.length,x=d.filter(u=>{const C=(u.materials_equipment?.category||u.category||"").toLowerCase();return C==="equipment"||C==="rental"}).length;let Y=0;return i.forEach(u=>{Y+=(parseFloat(u.regular_hours)||parseFloat(u.hours)||0)+(parseFloat(u.overtime_hours)||0)}),{workerCount:_,itemCount:c,equipmentCount:x,laborHours:Y}},X=()=>{if(v.size===0){S?.("Please select at least one ticket","error");return}const r=A.filter(c=>v.has(c.id)),i=[],d=[],_=[];r.forEach(c=>{(c.t_and_m_workers||c.workers||[]).forEach(u=>{i.push({id:`import-${c.id}-${u.id||Date.now()}-${ye()}`,worker_name:u.name||u.worker_name||"",labor_class:u.role||u.labor_class||"Laborer",wage_type:"standard",regular_hours:parseFloat(u.regular_hours)||parseFloat(u.hours)||0,overtime_hours:parseFloat(u.overtime_hours)||0,regular_rate:parseFloat(u.regular_rate)||0,overtime_rate:parseFloat(u.overtime_rate)||0,total:0,source_ticket_id:c.id,source_ticket_date:c.ticket_date||c.work_date})}),(c.t_and_m_items||c.items||[]).forEach(u=>{const C=u.materials_equipment||{},F=u.custom_name||C.name||u.description||u.name||"Unnamed item",se=u.unit||C.unit||"each",I=parseFloat(u.unit_cost)||parseFloat(C.cost_per_unit)||0,B=parseFloat(u.quantity)||1,T=(C.category||u.category||"").toLowerCase();T==="equipment"||T==="rental"?_.push({id:`import-${c.id}-${u.id||Date.now()}-${ye()}`,description:F,source_type:"T&M Ticket",source_reference:`T&M #${c.id?.slice(-6)||""} - ${E(c.ticket_date||c.work_date)}`,quantity:B,unit:se,unit_cost:ve(I),total:ve(B*I),source_ticket_id:c.id}):d.push({id:`import-${c.id}-${u.id||Date.now()}-${ye()}`,description:F,source_type:"T&M Ticket",source_reference:`T&M #${c.id?.slice(-6)||""} - ${E(c.ticket_date||c.work_date)}`,quantity:B,unit:se,unit_cost:ve(I),total:ve(B*I),source_ticket_id:c.id})})}),Q?.({ticketIds:Array.from(v),laborItems:i,materialsItems:d,equipmentItems:_}),l?.()};return V?e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-label":"Loading tickets",children:e.jsx("div",{className:"modal-content ticket-selector-modal",onClick:r=>r.stopPropagation(),children:e.jsx("div",{className:"loading",role:"status","aria-live":"polite",children:"Loading tickets..."})})}):e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"ticket-selector-title",children:e.jsxs("div",{className:"modal-content ticket-selector-modal",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"ticket-selector-title",children:"Import from T&M Tickets"}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close ticket selector",children:e.jsx(Ce,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"ticket-selector-controls",children:[e.jsxs("div",{className:"ticket-search",children:[e.jsx(qe,{size:16,"aria-hidden":"true"}),e.jsx("input",{type:"text",placeholder:"Search tickets...",value:R,onChange:r=>ae(r.target.value),"aria-label":"Search tickets"})]}),e.jsxs("div",{className:"ticket-filters",role:"group","aria-label":"Filter tickets by status",children:[e.jsx("button",{className:`filter-btn ${h==="unassigned"?"active":""}`,onClick:()=>U("unassigned"),"aria-pressed":h==="unassigned",children:"Unassigned"}),e.jsx("button",{className:`filter-btn ${h==="approved"?"active":""}`,onClick:()=>U("approved"),"aria-pressed":h==="approved",children:"Approved"}),e.jsx("button",{className:`filter-btn ${h==="all"?"active":""}`,onClick:()=>U("all"),"aria-pressed":h==="all",children:"All"})]})]}),e.jsxs("div",{className:"ticket-selector-header",children:[e.jsxs("label",{className:"select-all",children:[e.jsx("input",{type:"checkbox",checked:v.size===j.length&&j.length>0,onChange:fe,"aria-label":`Select all ${j.length} tickets`}),e.jsxs("span",{children:["Select All (",j.length,")"]})]}),e.jsxs("span",{className:"selected-count",children:[v.size," selected"]})]}),e.jsx("div",{className:"modal-body ticket-selector-body",children:j.length===0?e.jsxs("div",{className:"ticket-empty",children:[e.jsx(Pe,{size:32}),e.jsx("p",{children:"No tickets found"}),h==="unassigned"&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>U("all"),children:"Show all tickets"})]}):e.jsx("div",{className:"ticket-list",children:j.map(r=>{const i=Ne(r),d=v.has(r.id),_=ke===r.id;return e.jsxs("div",{className:`ticket-item ${d?"selected":""} ${r.assigned_cor_id?"assigned":""}`,children:[e.jsxs("div",{className:"ticket-item-main",children:[e.jsx("label",{className:"ticket-checkbox",children:e.jsx("input",{type:"checkbox",checked:d,onChange:()=>M(r.id),disabled:r.assigned_cor_id&&r.assigned_cor_id!==L})}),e.jsxs("div",{className:"ticket-item-info",onClick:()=>te(_?null:r.id),children:[e.jsxs("div",{className:"ticket-item-header",children:[e.jsx("span",{className:"ticket-date",children:E(r.ticket_date)}),e.jsx("span",{className:`ticket-status ${r.status}`,children:r.status}),r.ce_pco_number&&e.jsxs("span",{className:"ticket-pco",children:["CE/PCO: ",r.ce_pco_number]})]}),e.jsx("div",{className:"ticket-item-desc",children:r.work_description||"No description"}),e.jsxs("div",{className:"ticket-item-summary",children:[i.workerCount>0&&e.jsxs("span",{children:[e.jsx(pt,{size:12})," ",i.workerCount," workers"]}),i.itemCount>0&&e.jsxs("span",{children:[e.jsx(ht,{size:12})," ",i.itemCount," items"]}),i.equipmentCount>0&&e.jsxs("span",{children:[e.jsx(_t,{size:12})," ",i.equipmentCount," equipment"]}),i.laborHours>0&&e.jsxs("span",{children:[i.laborHours," hrs"]})]})]}),e.jsx("button",{className:"ticket-expand-btn",onClick:()=>te(_?null:r.id),children:_?e.jsx($e,{size:16}):e.jsx(ze,{size:16})})]}),_&&e.jsxs("div",{className:"ticket-item-details",children:[(r.t_and_m_workers||r.workers)?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Workers"}),e.jsx("ul",{children:(r.t_and_m_workers||r.workers).map((c,x)=>e.jsxs("li",{children:[c.name||c.role," - ",c.regular_hours||0," reg hrs",c.overtime_hours>0&&`, ${c.overtime_hours} OT hrs`]},x))})]}),(r.t_and_m_items||r.items)?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Materials"}),e.jsx("ul",{children:(r.t_and_m_items||r.items).map((c,x)=>e.jsxs("li",{children:[c.description||c.name," - ",c.quantity," ",c.unit]},x))})]}),r.materials_equipment?.filter(c=>c.type==="equipment").length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Equipment"}),e.jsx("ul",{children:r.materials_equipment.filter(c=>c.type==="equipment").map((c,x)=>e.jsx("li",{children:c.description||c.name},x))})]})]})]},r.id)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:X,disabled:v.size===0,children:[e.jsx(jt,{size:16})," Import ",v.size," Ticket",v.size!==1?"s":""]})]})]})})}function Ct({project:N,company:L,areas:Q,existingCOR:l,onClose:S,onSaved:A,onShowToast:y}){const[V,D]=o.useState(!1),[v,O]=o.useState(!!l?.id),[ke,te]=o.useState([]),[R,ae]=o.useState(!1),[h,U]=o.useState([]),[g,j]=o.useState({labor:l?.change_order_labor?.length>0,materials:l?.change_order_materials?.length>0,equipment:l?.change_order_equipment?.length>0,subcontractors:l?.change_order_subcontractors?.length>0,markups:!1}),[M,fe]=o.useState([]),[E,Ne]=o.useState(""),[X,r]=o.useState("all"),[i,d]=o.useState(""),[_,c]=o.useState(l?.title||""),[x,Y]=o.useState(l?.scope_of_work||""),[u,C]=o.useState(l?.cor_number||""),[F,se]=o.useState(l?.group_name||""),[I,B]=o.useState(l?.area_id||""),[T,Se]=o.useState(l?.period_start||""),[re,Ae]=o.useState(l?.period_end||""),[q,Z]=o.useState(l?.change_order_labor||[]),[k,W]=o.useState(l?.change_order_materials||[]),[f,G]=o.useState(l?.change_order_equipment||[]),[w,ne]=o.useState(l?.change_order_subcontractors||[]),[le,De]=o.useState(l?.labor_markup_percent??P.labor_markup),[ce,Oe]=o.useState(l?.materials_markup_percent??P.materials_markup),[oe,Re]=o.useState(l?.equipment_markup_percent??P.equipment_markup),[ie,Ue]=o.useState(l?.subcontractors_markup_percent??P.subcontractors_markup),[ue,Be]=o.useState(l?.liability_insurance_percent??P.liability_insurance),[de,We]=o.useState(l?.bond_percent??P.bond),[me,Ge]=o.useState(l?.license_fee_percent??P.license_fee);o.useEffect(()=>{(async()=>{if(!l?.id){O(!1);return}if(!(l.change_order_labor?.length>0||l.change_order_materials?.length>0||l.change_order_equipment?.length>0||l.change_order_subcontractors?.length>0)&&(l.labor_count?.[0]?.count>0||l.materials_count?.[0]?.count>0||l.equipment_count?.[0]?.count>0||l.subcontractors_count?.[0]?.count>0))try{const n=await p.getCORById(l.id);n&&(Z(n.change_order_labor||[]),W(n.change_order_materials||[]),G(n.change_order_equipment||[]),ne(n.change_order_subcontractors||[]),j({labor:n.change_order_labor?.length>0,materials:n.change_order_materials?.length>0,equipment:n.change_order_equipment?.length>0,subcontractors:n.change_order_subcontractors?.length>0,markups:!1}))}catch(n){console.error("Error fetching full COR data for editing:",n),y?.("Error loading COR details for editing","error")}O(!1)})()},[l?.id]),o.useEffect(()=>{Ze(),He(),l||Je()},[]);const He=async()=>{try{const t=await p.getAllMaterialsEquipment(L?.id);fe(t||[])}catch(t){console.error("Error loading company materials:",t)}},Qe=o.useMemo(()=>M.filter(t=>!["Containment","PPE","Disposal"].includes(t.category)||t.active===!1||X!=="all"&&t.category!==X?!1:E?t.name.toLowerCase().includes(E.toLowerCase()):!0),[M,E,X]),Ve=o.useMemo(()=>M.filter(t=>t.category!=="Equipment"||t.active===!1?!1:i?t.name.toLowerCase().includes(i.toLowerCase()):!0),[M,i]),Xe=t=>{W([...k,{description:t.name,source_type:"field_ticket",source_reference:"",quantity:1,unit:t.unit||"each",unit_cost:t.cost_per_unit||0,total:t.cost_per_unit||0}])},Ye=t=>{G([...f,{description:t.name,source_type:"rental",source_reference:"",quantity:1,unit:t.unit||"day",unit_cost:t.cost_per_unit||0,total:t.cost_per_unit||0}])},Ze=async()=>{try{const t=await p.getLaborRates?.(L?.id,N?.work_type,N?.job_type);te(t||[])}catch(t){console.error("Error loading labor rates:",t)}},we=t=>{const s=t?.toLowerCase()||"";return ke.find(a=>a.role?.toLowerCase()===s)||null},Je=async()=>{try{const t=await p.getNextCORNumber?.(N.id);C(t||`COR-${Date.now()}`)}catch(t){console.error("Error generating COR number:",t),C(`COR-${Date.now()}`)}},J=t=>{j(s=>({...s,[t]:!s[t]}))},pe=o.useMemo(()=>({title:_,scope_of_work:x,area_id:I||null,cor_number:u,group_name:F||null,period_start:T||null,period_end:re||null,change_order_labor:q,change_order_materials:k,change_order_equipment:f,change_order_subcontractors:w,labor_markup_percent:le,materials_markup_percent:ce,equipment_markup_percent:oe,subcontractors_markup_percent:ie,liability_insurance_percent:ue,bond_percent:de,license_fee_percent:me}),[_,x,I,u,F,T,re,q,k,f,w,le,ce,oe,ie,ue,de,me]),m=o.useMemo(()=>ut(pe),[pe]),Ke=()=>{const t=Ee[0],s=we(t);Z([...q,{id:`temp-${Date.now()}`,labor_class:t,wage_type:"standard",regular_hours:0,overtime_hours:0,regular_rate:s?Math.round((parseFloat(s.regular_rate)||0)*100):0,overtime_rate:s?Math.round((parseFloat(s.overtime_rate)||0)*100):0,total:0}]),g.labor||J("labor")},H=(t,s,a)=>{const n=[...q];if(n[t]={...n[t],[s]:a},s==="labor_class"){const ee=we(a);ee&&(n[t].regular_rate=Math.round((parseFloat(ee.regular_rate)||0)*100),n[t].overtime_rate=Math.round((parseFloat(ee.overtime_rate)||0)*100))}const{total:be}=mt(n[t].regular_hours,n[t].overtime_hours,n[t].regular_rate,n[t].overtime_rate);n[t].total=be,Z(n)},et=t=>{Z(q.filter((s,a)=>a!==t))},tt=()=>{W([...k,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"each",unit_cost:0,total:0}]),g.materials||J("materials")},he=(t,s,a)=>{const n=[...k];n[t]={...n[t],[s]:a},n[t].total=Fe(n[t].quantity,n[t].unit_cost),W(n)},at=t=>{W(k.filter((s,a)=>a!==t))},st=()=>{G([...f,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"day",unit_cost:0,total:0}]),g.equipment||J("equipment")},_e=(t,s,a)=>{const n=[...f];n[t]={...n[t],[s]:a},n[t].total=Fe(n[t].quantity,n[t].unit_cost),G(n)},rt=t=>{G(f.filter((s,a)=>a!==t))},nt=()=>{ne([...w,{id:`temp-${Date.now()}`,company_name:"",description:"",source_type:"invoice",source_reference:"",amount:0,total:0}]),g.subcontractors||J("subcontractors")},je=(t,s,a)=>{const n=[...w];n[t]={...n[t],[s]:a},s==="amount"&&(n[t].total=parseInt(a)||0),ne(n)},lt=t=>{ne(w.filter((s,a)=>a!==t))},ct=t=>{t.ticketIds?.length>0&&U(a=>[...new Set([...a,...t.ticketIds])]),t.laborItems?.length>0&&(Z([...q,...t.laborItems]),j(a=>({...a,labor:!0}))),t.materialsItems?.length>0&&(W([...k,...t.materialsItems]),j(a=>({...a,materials:!0}))),t.equipmentItems?.length>0&&(G([...f,...t.equipmentItems]),j(a=>({...a,equipment:!0})));const s=(t.laborItems?.length||0)+(t.materialsItems?.length||0)+(t.equipmentItems?.length||0);y?.(`Imported ${s} item(s) from ${t.ticketIds.length} ticket(s)`,"success")},Ie=_.trim().length>0,Me=()=>({company_id:L.id,project_id:N.id,title:_,scope_of_work:x||"",area_id:I||null,cor_number:u,group_name:F||null,period_start:T||new Date().toISOString().split("T")[0],period_end:re||new Date().toISOString().split("T")[0],labor_markup_percent:le,materials_markup_percent:ce,equipment_markup_percent:oe,subcontractors_markup_percent:ie,liability_insurance_percent:ue,bond_percent:de,license_fee_percent:me,...m}),ot=async()=>{if(!Ie){y?.("Title is required","error");return}D(!0);try{const t=Me();let s;if(l?.id?s=await p.updateCOR(l.id,t):(t.status="draft",s=await p.createCOR(t)),s?.id&&(await p.saveCORLineItems(s.id,{laborItems:q,materialItems:k,equipmentItems:f,subcontractorItems:w}),h.length>0))for(const a of h)try{await p.assignTicketToCOR(a,s.id)}catch(n){console.warn(`Could not link ticket ${a} to COR:`,n)}y?.(l?.id?"COR saved":"COR saved as draft","success"),A?.(s),S?.()}catch(t){console.error("Error saving COR:",t),y?.("Error saving COR","error")}finally{D(!1)}},it=async()=>{const t=Le(pe);if(!t.valid){y?.(t.errors[0],"error");return}D(!0);try{const s=Me();let a,n;if(l?.id?(a=await p.updateCOR(l.id,s),n=l.id,await p.saveCORLineItems(l.id,{laborItems:q,materialItems:k,equipmentItems:f,subcontractorItems:w}),await p.submitCORForApproval(l.id)):(s.status="draft",a=await p.createCOR(s),a?.id&&(n=a.id,await p.saveCORLineItems(a.id,{laborItems:q,materialItems:k,equipmentItems:f,subcontractorItems:w}),await p.submitCORForApproval(a.id))),n&&h.length>0)for(const be of h)try{await p.assignTicketToCOR(be,n)}catch(ee){console.warn(`Could not link ticket ${be} to COR:`,ee)}y?.("COR submitted for approval","success"),A?.(a),S?.()}catch(s){console.error("Error submitting COR:",s),y?.("Error submitting COR","error")}finally{D(!1)}},K=({section:t,label:s,count:a,subtotal:n})=>e.jsxs("div",{className:`cor-section-header ${g[t]?"expanded":""}`,onClick:()=>J(t),children:[e.jsxs("div",{className:"cor-section-title",children:[g[t]?e.jsx($e,{size:18}):e.jsx(ze,{size:18}),e.jsx("span",{children:s}),a>0&&e.jsx("span",{className:"cor-section-count",children:a})]}),n>0&&e.jsx("span",{className:"cor-section-subtotal",children:b(n)})]});return v?e.jsx("div",{className:"modal-overlay",onClick:S,children:e.jsxs("div",{className:"modal-content cor-form-modal cor-form-simplified",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Loading COR..."}),e.jsx("button",{className:"close-btn",onClick:S,children:e.jsx(Ce,{size:20})})]}),e.jsx("div",{className:"modal-body cor-form-body",style:{padding:"2rem",textAlign:"center",color:"var(--text-secondary)"},children:"Loading change order data for editing..."})]})}):e.jsxs("div",{className:"modal-overlay",onClick:S,children:[e.jsxs("div",{className:"modal-content cor-form-modal cor-form-simplified",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:l?"Edit Change Order Request":"New Change Order Request"}),e.jsx("button",{className:"close-btn",onClick:S,children:e.jsx(Ce,{size:20})})]}),e.jsxs("div",{className:"modal-body cor-form-body",children:[e.jsxs("div",{className:"cor-form-required",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group cor-number-field",children:[e.jsx("label",{children:"COR #"}),e.jsx("input",{type:"text",value:u,onChange:t=>C(t.target.value),className:"input-small"})]}),e.jsxs("div",{className:"form-group flex-grow required",children:[e.jsx("label",{children:"Title"}),e.jsx("input",{type:"text",value:_,onChange:t=>c(t.target.value),placeholder:"e.g., Additional Demolition Work - Building A",className:"input-required"})]})]}),e.jsxs("div",{className:"form-group required",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:x,onChange:t=>Y(t.target.value),rows:2,placeholder:"Describe the scope of work",className:"input-required"})]}),e.jsxs("div",{className:"form-row form-row-compact",children:[Q&&Q.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Area"}),e.jsxs("select",{value:I,onChange:t=>B(t.target.value),children:[e.jsx("option",{value:"",children:"None"}),Q.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Group"}),e.jsx("input",{type:"text",value:F,onChange:t=>se(t.target.value),placeholder:"e.g., Phase 1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"date",value:T,onChange:t=>Se(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"date",value:re,onChange:t=>Ae(t.target.value),min:T})]})]})]}),e.jsx("div",{className:"cor-import-bar",children:e.jsxs("button",{className:"btn btn-ghost",onClick:()=>ae(!0),children:[e.jsx(Pe,{size:16})," Import from T&M Tickets"]})}),e.jsxs("div",{className:"cor-sections",children:[e.jsxs("div",{className:"cor-section",children:[e.jsx(K,{section:"labor",label:"Labor",count:q.length,subtotal:m.labor_subtotal}),g.labor&&e.jsxs("div",{className:"cor-section-content",children:[q.map((t,s)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("select",{value:t.labor_class,onChange:a=>H(s,"labor_class",a.target.value),children:Ee.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("select",{value:t.wage_type,onChange:a=>H(s,"wage_type",a.target.value),children:dt.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Reg hrs",value:t.regular_hours||"",onChange:a=>H(s,"regular_hours",a.target.value),className:"input-small"}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"$/hr",value:t.regular_rate?(t.regular_rate/100).toFixed(2):"",onChange:a=>{const n=a.target.value;H(s,"regular_rate",Math.round(parseFloat(n||0)*100))},className:"input-small"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"OT hrs",value:t.overtime_hours||"",onChange:a=>H(s,"overtime_hours",a.target.value),className:"input-small"}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"$/hr",value:t.overtime_rate?(t.overtime_rate/100).toFixed(2):"",onChange:a=>{const n=a.target.value;H(s,"overtime_rate",Math.round(parseFloat(n||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:b(t.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>et(s),children:e.jsx(ge,{size:14})})]})},t.id||s)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:Ke,children:[e.jsx(xe,{size:14})," Add Labor"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(K,{section:"materials",label:"Materials",count:k.length,subtotal:m.materials_subtotal}),g.materials&&e.jsxs("div",{className:"cor-section-content",children:[M.filter(t=>["Containment","PPE","Disposal"].includes(t.category)&&t.active!==!1).length>0&&e.jsxs("div",{className:"quick-select-compact",children:[e.jsxs("div",{className:"quick-select-search",children:[e.jsx(qe,{size:14}),e.jsx("input",{type:"text",placeholder:"Search materials...",value:E,onChange:t=>Ne(t.target.value)})]}),e.jsx("div",{className:"quick-select-items",children:Qe.slice(0,8).map(t=>e.jsx("button",{className:"quick-item",onClick:()=>Xe(t),children:t.name},t.id))})]}),k.map((t,s)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Description",value:t.description,onChange:a=>he(s,"description",a.target.value),className:"input-wide"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Qty",value:t.quantity||"",onChange:a=>he(s,"quantity",a.target.value),className:"input-small"}),e.jsx("select",{value:t.unit,onChange:a=>he(s,"unit",a.target.value),children:Te.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"$/unit",value:t.unit_cost?(t.unit_cost/100).toFixed(2):"",onChange:a=>{const n=a.target.value;he(s,"unit_cost",Math.round(parseFloat(n||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:b(t.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>at(s),children:e.jsx(ge,{size:14})})]})},t.id||s)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:tt,children:[e.jsx(xe,{size:14})," Add Material"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(K,{section:"equipment",label:"Equipment",count:f.length,subtotal:m.equipment_subtotal}),g.equipment&&e.jsxs("div",{className:"cor-section-content",children:[M.filter(t=>t.category==="Equipment"&&t.active!==!1).length>0&&e.jsxs("div",{className:"quick-select-compact",children:[e.jsxs("div",{className:"quick-select-search",children:[e.jsx(qe,{size:14}),e.jsx("input",{type:"text",placeholder:"Search equipment...",value:i,onChange:t=>d(t.target.value)})]}),e.jsx("div",{className:"quick-select-items",children:Ve.slice(0,8).map(t=>e.jsx("button",{className:"quick-item",onClick:()=>Ye(t),children:t.name},t.id))})]}),f.map((t,s)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Description",value:t.description,onChange:a=>_e(s,"description",a.target.value),className:"input-wide"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Qty",value:t.quantity||"",onChange:a=>_e(s,"quantity",a.target.value),className:"input-small"}),e.jsx("select",{value:t.unit,onChange:a=>_e(s,"unit",a.target.value),children:Te.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"$/unit",value:t.unit_cost?(t.unit_cost/100).toFixed(2):"",onChange:a=>{const n=a.target.value;_e(s,"unit_cost",Math.round(parseFloat(n||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:b(t.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>rt(s),children:e.jsx(ge,{size:14})})]})},t.id||s)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:st,children:[e.jsx(xe,{size:14})," Add Equipment"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(K,{section:"subcontractors",label:"Subcontractors",count:w.length,subtotal:m.subcontractors_subtotal}),g.subcontractors&&e.jsxs("div",{className:"cor-section-content",children:[w.map((t,s)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Company",value:t.company_name,onChange:a=>je(s,"company_name",a.target.value),className:"input-wide"}),e.jsx("input",{type:"text",placeholder:"Description",value:t.description,onChange:a=>je(s,"description",a.target.value),className:"input-wide"}),e.jsx("input",{type:"text",placeholder:"Invoice #",value:t.source_reference||"",onChange:a=>je(s,"source_reference",a.target.value),className:"input-small"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Amount",value:t.amount?(t.amount/100).toFixed(2):"",onChange:a=>{const n=a.target.value;je(s,"amount",Math.round(parseFloat(n||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:b(t.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>lt(s),children:e.jsx(ge,{size:14})})]})},t.id||s)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:nt,children:[e.jsx(xe,{size:14})," Add Subcontractor"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(K,{section:"markups",label:"Markups & Fees",count:0,subtotal:m.total_markup_amount+m.total_fees}),g.markups&&e.jsxs("div",{className:"cor-section-content markups-content",children:[e.jsxs("div",{className:"markups-grid-compact",children:[e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Labor Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:$(le),onChange:t=>De(z(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",b(m.labor_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Materials Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:$(ce),onChange:t=>Oe(z(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",b(m.materials_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Equipment Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:$(oe),onChange:t=>Re(z(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",b(m.equipment_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Subcontractors Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:$(ie),onChange:t=>Ue(z(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",b(m.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"fees-grid-compact",children:[e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Liability Insurance"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:$(ue),onChange:t=>Be(z(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",b(m.liability_insurance_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Bond"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:$(de),onChange:t=>We(z(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",b(m.bond_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"City License Fee"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:$(me),onChange:t=>Ge(z(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",b(m.license_fee_amount)]})]})]})]})]})]}),e.jsxs("div",{className:"cor-summary-bar",children:[e.jsxs("div",{className:"cor-summary-item",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:b(m.cor_subtotal)})]}),e.jsxs("div",{className:"cor-summary-item total",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:b(m.cor_total)})]})]})]}),e.jsxs("div",{className:"modal-footer cor-form-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:S,disabled:V,children:"Cancel"}),e.jsxs("div",{className:"footer-actions",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:ot,disabled:V||!Ie,children:[e.jsx(bt,{size:16})," Save Draft"]}),e.jsxs("button",{className:"btn btn-primary",onClick:it,disabled:V||!Le(pe).valid,children:[e.jsx(vt,{size:16})," Submit"]})]})]})]}),R&&e.jsx(gt,{projectId:N.id,corId:l?.id,onImport:ct,onClose:()=>ae(!1),onShowToast:y})]})}export{Ct as default};
//# sourceMappingURL=CORForm-mtBqWCk2.js.map
