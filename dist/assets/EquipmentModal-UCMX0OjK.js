import{b as O,e as q,j as e}from"./index-DRoKgDCS.js";import{r as a}from"./router-CeQ1XyMZ.js";import{p as U,X as $,y as X,x as P,au as B}from"./icons-CvO0oR7x.js";import"./pdf-rft6H0l9.js";import"./supabase-Ce1s_jZn.js";const Y=a.memo(function({project:T,company:p,user:z,editItem:s=null,onSave:A,onClose:h}){const{showToast:o}=O(),[d,M]=a.useState([]),[H,x]=a.useState(!0),[j,y]=a.useState(!1),[b,f]=a.useState(""),[E,c]=a.useState(""),[S,u]=a.useState(""),[m,C]=a.useState(new Date().toISOString().split("T")[0]),[_,D]=a.useState(""),[w,F]=a.useState(""),[g,v]=a.useState(!1),r=!!s,k=a.useCallback(async()=>{if(!p?.id){x(!1);return}try{x(!0);const t=await q.getCompanyEquipment(p.id);M(t||[])}catch(t){console.error("Error loading equipment catalog:",t)}finally{x(!1)}},[p?.id]);a.useEffect(()=>{k()},[k]),a.useEffect(()=>{s&&(c(s.equipment_name||""),u(((s.daily_rate||0)/100).toFixed(2)),C(s.start_date||new Date().toISOString().split("T")[0]),D(s.end_date||""),F(s.notes||""),f(s.equipment_id||""),v(!s.equipment_id))},[s]);const R=t=>{const i=t.target.value;if(i==="custom"){v(!0),f(""),c(""),u("");return}v(!1),f(i);const l=d.find(n=>n.id===i);l&&(c(l.name),u(((l.daily_rate||0)/100).toFixed(2)))},L=async t=>{t.preventDefault();const i=E.trim();if(!i){o("Please enter equipment name","warning");return}const l=parseFloat(S);if(isNaN(l)||l<0){o("Please enter a valid daily rate","warning");return}if(!m){o("Please select a start date","warning");return}try{y(!0);const n={project_id:T.id,equipment_id:g?null:b||null,equipment_name:i,daily_rate:Math.round(l*100),start_date:m,end_date:_||null,notes:w.trim()||null,created_by:z?.id};let N;r?(delete n.project_id,delete n.created_by,N=await q.updateProjectEquipment(s.id,n)):N=await q.addEquipmentToProject(n),A?.(N)}catch(n){console.error("Error saving equipment:",n),o("Failed to save equipment. Please try again.","error")}finally{y(!1)}};return e.jsx("div",{className:"modal-overlay",onClick:h,children:e.jsxs("div",{className:"modal-content equipment-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(U,{size:20}),r?"Edit Equipment":"Add Equipment to Project"]}),e.jsx("button",{className:"close-btn",onClick:h,"aria-label":"Close",children:e.jsx($,{size:20})})]}),e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{className:"modal-body",children:[!r&&d.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Equipment"}),e.jsxs("select",{value:g?"custom":b,onChange:R,className:"form-select",children:[e.jsx("option",{value:"",children:"Choose from catalog..."}),d.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - $",((t.daily_rate||0)/100).toFixed(0),"/day"]},t.id)),e.jsx("option",{value:"custom",children:"+ Add custom equipment"})]})]}),(g||r||d.length===0)&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"equipment-name",children:"Equipment Name"}),e.jsx("input",{id:"equipment-name",type:"text",value:E,onChange:t=>c(t.target.value),placeholder:"e.g., CAT 320 Excavator",className:"form-input",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"daily-rate",children:[e.jsx(X,{size:14}),"Daily Rate"]}),e.jsxs("div",{className:"input-with-prefix",children:[e.jsx("span",{className:"input-prefix",children:"$"}),e.jsx("input",{id:"daily-rate",type:"number",step:"0.01",min:"0",value:S,onChange:t=>u(t.target.value),placeholder:"0.00",className:"form-input",required:!0}),e.jsx("span",{className:"input-suffix",children:"/day"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"start-date",children:[e.jsx(P,{size:14}),"Start Date"]}),e.jsx("input",{id:"start-date",type:"date",value:m,onChange:t=>C(t.target.value),className:"form-input",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"end-date",children:[e.jsx(P,{size:14}),"End Date (optional)"]}),e.jsx("input",{id:"end-date",type:"date",value:_,onChange:t=>D(t.target.value),min:m,className:"form-input",placeholder:"Leave blank if still on site"}),e.jsx("span",{className:"form-help",children:"Leave blank if still on site"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"notes",children:"Notes (optional)"}),e.jsx("textarea",{id:"notes",value:w,onChange:t=>F(t.target.value),placeholder:"Equipment number, rental company, etc.",className:"form-textarea",rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:h,disabled:j,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading-spinner small"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{size:16}),r?"Update":"Add Equipment"]})})]})]})]})})});export{Y as default};
