const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TMList-UmbuiWDG.js","assets/pdf-aQqpMATS.js","assets/index-DaMZDs6Q.js","assets/icons-BkAyv-fR.js","assets/react-DXGY7bZi.js","assets/supabase-VuevzHjS.js","assets/index-bnmWjRZ8.css","assets/SignatureLinkGenerator-AxrH5SMg.js","assets/corCalculations-vdJc_BOT.js","assets/CORLogPreview-CUfhJHBJ.js","assets/CORList-DSrDjrZd.js","assets/CORLog-Bjj91iSr.js","assets/BillingCenter-DH2MMxQ2.js","assets/ShareModal-C25vue3I.js","assets/NotificationSettings-DVzG7EVq.js","assets/CORForm-CNykKirM.js","assets/CORDetail-GJwa29ff.js","assets/SignatureCanvas-VDOt4ILp.js","assets/DrawRequestModal-C4fw0mA_.js","assets/EquipmentModal-DG4Hwgtg.js","assets/AddCostModal-Ddu-_W6k.js","assets/DocumentsTab-DVIQu0ne.js"])))=>i.map(i=>d[i]);
import{_ as xe}from"./pdf-aQqpMATS.js";import{r as bs,c as wt,a as Bn,S as Wn,b as Un,u as ts,s as Hn,d as Kn,e as Gn,f as Yn,g as Jn,h as Xn,i as Qn,j as Ye,k as Ct,l as Zn,m as ja,n as ei,o as si,p as ti,D as Ya,q as kt,t as ai,v as ri,w as ni,x as ga,y as ii,z as li,A as Ja,Z as Xa,L as js,C as oi,B as ci,E as $e,F as ba,G as _t,H as di,I as Ks,J as St,K as Qa,M as Za,N as ui,O as mi,P as Dt,Q as Et,R as hi,T as pi,U as er,V as ya,W as xi,X as fi,Y as vi,_ as ji,$ as gi,a0 as bi,a1 as sr,a2 as yi,a3 as Ni,a4 as wi,a5 as Ci,a6 as ki,a7 as _i,a8 as Si,a9 as Di,aa as Na,ab as wa,ac as Ca,ad as Ei,ae as Pi,af as Ri,ag as es,ah as Ti,ai as Ai,aj as Oi,ak as tr,al as dt,am as Fi,an as Mi,ao as $i,ap as Ii,aq as zi,ar as W,as as e,at as Pt,au as Li,av as ar,aw as rr,ax as nr,ay as Rt,az as ka,aA as qi,aB as Vi,aC as Bi,aD as ss,aE as Wi,aF as ir,aG as vs,aH as lr,aI as Ui,aJ as Hi,aK as ms,aL as _a,aM as pe,aN as Ki,aO as Gi,aP as Yi,aQ as Ji}from"./index-DaMZDs6Q.js";import{r as o,e as or,X as Je,a4 as Xi,Y as jt,y as ze,F as rs,s as be,N as Ie,a2 as Ls,T as qs,a5 as Qi,a6 as Zi,b as Vs,a7 as cr,a8 as Sa,a9 as el,R as dr,D as We,aa as ur,O as Gs,H as He,W as gt,ab as ut,ac as sl,c as ys,K as Tt,ad as At,m as mr,C as hr,Q as ps,ae as pr,af as tl,ag as al,ah as rl,j as nl,ai as il,aj as ll,l as Ke,p as Ot,q as ls,ak as xr,n as gs,al as ol,z as cl,i as dl,am as ul,an as mt,a as Da,L as Ea,ao as Pa,d as ml,ap as Ra}from"./icons-BkAyv-fR.js";import{f as we}from"./corCalculations-vdJc_BOT.js";function Bs(){return Bs=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(s[a]=r[a])}return s},Bs.apply(null,arguments)}function Ta(s,t){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,a)}return r}function hl(s){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ta(Object(r),!0).forEach(function(a){pl(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Ta(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function pl(s,t,r){return(t=xl(t))in s?Object.defineProperty(s,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[t]=r,s}function xl(s){var t=fl(s,"string");return typeof t=="symbol"?t:t+""}function fl(s,t){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var a=r.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}var Ne=32,vl={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function jl(s){var{data:t,iconType:r,inactiveColor:a}=s,n=Ne/2,i=Ne/6,l=Ne/3,d=t.inactive?a:t.color,u=r??t.type;if(u==="none")return null;if(u==="plainline"){var h;return o.createElement("line",{strokeWidth:4,fill:"none",stroke:d,strokeDasharray:(h=t.payload)===null||h===void 0?void 0:h.strokeDasharray,x1:0,y1:n,x2:Ne,y2:n,className:"recharts-legend-icon"})}if(u==="line")return o.createElement("path",{strokeWidth:4,fill:"none",stroke:d,d:"M0,".concat(n,"h").concat(l,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(2*l,",").concat(n,`
            H`).concat(Ne,"M").concat(2*l,",").concat(n,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(l,",").concat(n),className:"recharts-legend-icon"});if(u==="rect")return o.createElement("path",{stroke:"none",fill:d,d:"M0,".concat(Ne/8,"h").concat(Ne,"v").concat(Ne*3/4,"h").concat(-Ne,"z"),className:"recharts-legend-icon"});if(o.isValidElement(t.legendIcon)){var c=hl({},t);return delete c.legendIcon,o.cloneElement(t.legendIcon,c)}return o.createElement(Un,{fill:d,cx:n,cy:n,size:Ne,sizeType:"diameter",type:u})}function gl(s){var{payload:t,iconSize:r,layout:a,formatter:n,inactiveColor:i,iconType:l}=s,d={x:0,y:0,width:Ne,height:Ne},u={display:a==="horizontal"?"inline-block":"block",marginRight:10},h={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((c,f)=>{var x=c.formatter||n,j=wt({"recharts-legend-item":!0,["legend-item-".concat(f)]:!0,inactive:c.inactive});if(c.type==="none")return null;var m=c.inactive?i:c.color,p=x?x(c.value,c,f):c.value;return o.createElement("li",Bs({className:j,style:u,key:"legend-item-".concat(f)},Bn(s,c,f)),o.createElement(Wn,{width:r,height:r,viewBox:d,style:h,"aria-label":"".concat(p," legend icon")},o.createElement(jl,{data:c,iconType:l,inactiveColor:i})),o.createElement("span",{className:"recharts-legend-item-text",style:{color:m}},p))})}var bl=s=>{var t=bs(s,vl),{payload:r,layout:a,align:n}=t;if(!r||!r.length)return null;var i={padding:0,margin:0,textAlign:a==="horizontal"?n:"left"};return o.createElement("ul",{className:"recharts-default-legend",style:i},o.createElement(gl,Bs({},t,{payload:r})))};function yl(){return ts(Hn)}var Nl=["contextPayload"];function bt(){return bt=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(s[a]=r[a])}return s},bt.apply(null,arguments)}function Aa(s,t){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,a)}return r}function is(s){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Aa(Object(r),!0).forEach(function(a){wl(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Aa(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function wl(s,t,r){return(t=Cl(t))in s?Object.defineProperty(s,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[t]=r,s}function Cl(s){var t=kl(s,"string");return typeof t=="symbol"?t:t+""}function kl(s,t){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var a=r.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function _l(s,t){if(s==null)return{};var r,a,n=Sl(s,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(s,r)&&(n[r]=s[r])}return n}function Sl(s,t){if(s==null)return{};var r={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(t.indexOf(a)!==-1)continue;r[a]=s[a]}return r}function Dl(s){return s.value}function El(s){var{contextPayload:t}=s,r=_l(s,Nl),a=ei(t,s.payloadUniqBy,Dl),n=is(is({},r),{},{payload:a});return o.isValidElement(s.content)?o.cloneElement(s.content,n):typeof s.content=="function"?o.createElement(s.content,n):o.createElement(bl,n)}function Pl(s,t,r,a,n,i){var{layout:l,align:d,verticalAlign:u}=t,h,c;return(!s||(s.left===void 0||s.left===null)&&(s.right===void 0||s.right===null))&&(d==="center"&&l==="vertical"?h={left:((a||0)-i.width)/2}:h=d==="right"?{right:r&&r.right||0}:{left:r&&r.left||0}),(!s||(s.top===void 0||s.top===null)&&(s.bottom===void 0||s.bottom===null))&&(u==="middle"?c={top:((n||0)-i.height)/2}:c=u==="bottom"?{bottom:r&&r.bottom||0}:{top:r&&r.top||0}),is(is({},h),c)}function Rl(s){var t=Ct();return o.useEffect(()=>{t(Zn(s))},[t,s]),null}function Tl(s){var t=Ct();return o.useEffect(()=>(t(ja(s)),()=>{t(ja({width:0,height:0}))}),[t,s]),null}function Al(s,t,r,a){return s==="vertical"&&Ye(t)?{height:t}:s==="horizontal"?{width:r||a}:null}var Ol={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function Ys(s){var t=bs(s,Ol),r=yl(),a=Kn(),n=Gn(),{width:i,height:l,wrapperStyle:d,portal:u}=t,[h,c]=Yn([r]),f=Jn(),x=Xn();if(f==null||x==null)return null;var j=f-(n?.left||0)-(n?.right||0),m=Al(t.layout,l,i,j),p=u?d:is(is({position:"absolute",width:m?.width||i||"auto",height:m?.height||l||"auto"},Pl(d,t,n,f,x,h)),d),N=u??a;if(N==null||r==null)return null;var D=o.createElement("div",{className:"recharts-legend-wrapper",style:p,ref:c},o.createElement(Rl,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),!u&&o.createElement(Tl,{width:h.width,height:h.height}),o.createElement(El,bt({},t,m,{margin:n,chartWidth:f,chartHeight:x,contextPayload:r})));return Qn.createPortal(D,N)}Ys.displayName="Legend";function Oa(s,t){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,a)}return r}function Fa(s){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Oa(Object(r),!0).forEach(function(a){Fl(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Oa(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function Fl(s,t,r){return(t=Ml(t))in s?Object.defineProperty(s,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[t]=r,s}function Ml(s){var t=$l(s,"string");return typeof t=="symbol"?t:t+""}function $l(s,t){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var a=r.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Ws(){return Ws=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(s[a]=r[a])}return s},Ws.apply(null,arguments)}var Il=(s,t)=>{var r;if(o.isValidElement(s))r=o.cloneElement(s,t);else if(typeof s=="function")r=s(t);else{if(!$e(t.x1)||!$e(t.y1)||!$e(t.x2)||!$e(t.y2))return null;r=o.createElement("line",Ws({},t,{className:"recharts-reference-line-line"}))}return r},zl=(s,t,r,a,n,i)=>{var{x:l,width:d}=i,u=n.y.apply(s,{position:r});if(_t(u)||t==="discard"&&!n.y.isInRange(u))return null;var h=[{x:l+d,y:u},{x:l,y:u}];return a==="left"?h.reverse():h},Ll=(s,t,r,a,n,i)=>{var{y:l,height:d}=i,u=n.x.apply(s,{position:r});if(_t(u)||t==="discard"&&!n.x.isInRange(u))return null;var h=[{x:u,y:l+d},{x:u,y:l}];return a==="top"?h.reverse():h},ql=(s,t,r,a)=>{var n=s.map(i=>a.apply(i,{position:r}));return t==="discard"&&n.some(i=>!a.isInRange(i))?null:n},Vl=(s,t,r,a,n,i)=>{var{x:l,y:d,segment:u,ifOverflow:h}=i,c=ba(l),f=ba(d);return f?zl(d,h,r,n,s,t):c?Ll(l,h,r,a,s,t):u!=null&&u.length===2?ql(u,h,r,s):null};function Bl(s){var t=Ct();return o.useEffect(()=>(t(si(s)),()=>{t(ti(s))})),null}function Wl(s){var{xAxisId:t,yAxisId:r,shape:a,className:n,ifOverflow:i}=s,l=kt(),d=ai(),u=ts(I=>ri(I,t)),h=ts(I=>ni(I,r)),c=ts(I=>ga(I,"xAxis",t,l)),f=ts(I=>ga(I,"yAxis",r,l)),x=ii();if(!d||!x||u==null||h==null||c==null||f==null)return null;var j=li({x:c,y:f}),m=Vl(j,x,s.position,u.orientation,h.orientation,s);if(!m)return null;var[{x:p,y:N},{x:D,y:v}]=m,T=i==="hidden"?"url(#".concat(d,")"):void 0,w=Fa(Fa({clipPath:T},Ja(s)),{},{x1:p,y1:N,x2:D,y2:v}),k=di({x1:p,y1:N,x2:D,y2:v});return o.createElement(Xa,{zIndex:s.zIndex},o.createElement(js,{className:wt("recharts-reference-line",n)},Il(a,w),o.createElement(oi,Ws({},k,{lowerWidth:k.width,upperWidth:k.width}),o.createElement(ci,{label:s.label}),s.children)))}var Ul={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:Ya.line};function fr(s){var t=bs(s,Ul);return o.createElement(o.Fragment,null,o.createElement(Bl,{yAxisId:t.yAxisId,xAxisId:t.xAxisId,ifOverflow:t.ifOverflow,x:t.x,y:t.y,segment:t.segment}),o.createElement(Wl,t))}fr.displayName="ReferenceLine";var vr=(s,t,r)=>Qa(s,"xAxis",Dt(s,t),r),jr=(s,t,r)=>Za(s,"xAxis",Dt(s,t),r),gr=(s,t,r)=>Qa(s,"yAxis",Et(s,t),r),br=(s,t,r)=>Za(s,"yAxis",Et(s,t),r),Hl=Ks([St,vr,gr,jr,br],(s,t,r,a,n)=>er(s,"xAxis")?ya(t,a,!1):ya(r,n,!1)),Kl=(s,t)=>t,yr=Ks([xi,Kl],(s,t)=>s.filter(r=>r.type==="area").find(r=>r.id===t)),Nr=s=>{var t=St(s),r=er(t,"xAxis");return r?"yAxis":"xAxis"},Gl=(s,t)=>{var r=Nr(s);return r==="yAxis"?Et(s,t):Dt(s,t)},Yl=(s,t,r)=>hi(s,Nr(s),Gl(s,t),r),Jl=Ks([yr,Yl],(s,t)=>{var r;if(!(s==null||t==null)){var{stackId:a}=s,n=pi(s);if(!(a==null||n==null)){var i=(r=t[a])===null||r===void 0?void 0:r.stackedData,l=i?.find(d=>d.key===n);if(l!=null)return l.map(d=>[d[0],d[1]])}}}),Xl=Ks([St,vr,gr,jr,br,Jl,ui,Hl,yr,mi],(s,t,r,a,n,i,l,d,u,h)=>{var{chartData:c,dataStartIndex:f,dataEndIndex:x}=l;if(!(u==null||s!=="horizontal"&&s!=="vertical"||t==null||r==null||a==null||n==null||a.length===0||n.length===0||d==null)){var{data:j}=u,m;if(j&&j.length>0?m=j:m=c?.slice(f,x+1),m!=null)return vo({layout:s,xAxis:t,yAxis:r,xAxisTicks:a,yAxisTicks:n,dataStartIndex:f,areaSettings:u,stackedData:i,displayedData:m,chartBaseValue:h,bandSize:d})}}),Ql=["id"],Zl=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function Ge(){return Ge=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(s[a]=r[a])}return s},Ge.apply(null,arguments)}function wr(s,t){if(s==null)return{};var r,a,n=eo(s,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(s,r)&&(n[r]=s[r])}return n}function eo(s,t){if(s==null)return{};var r={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(t.indexOf(a)!==-1)continue;r[a]=s[a]}return r}function Ma(s,t){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,a)}return r}function as(s){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ma(Object(r),!0).forEach(function(a){so(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Ma(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function so(s,t,r){return(t=to(t))in s?Object.defineProperty(s,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[t]=r,s}function to(s){var t=ao(s,"string");return typeof t=="symbol"?t:t+""}function ao(s,t){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var a=r.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Us(s,t){return s&&s!=="none"?s:t}var ro=s=>{var{dataKey:t,name:r,stroke:a,fill:n,legendType:i,hide:l}=s;return[{inactive:l,dataKey:t,type:i,color:Us(a,n),value:sr(r,t),payload:s}]},no=o.memo(s=>{var{dataKey:t,data:r,stroke:a,strokeWidth:n,fill:i,name:l,hide:d,unit:u,tooltipType:h,id:c}=s,f={dataDefinedOnItem:r,positions:void 0,settings:{stroke:a,strokeWidth:n,fill:i,dataKey:t,nameKey:void 0,name:sr(l,t),hide:d,type:h,color:Us(a,i),unit:u,graphicalItemId:c}};return o.createElement(yi,{tooltipEntrySettings:f})});function io(s){var{clipPathId:t,points:r,props:a}=s,{needClip:n,dot:i,dataKey:l}=a,d=tr(a);return o.createElement(Fi,{points:r,dot:i,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:l,baseProps:d,needClip:n,clipPathId:t})}function lo(s){var{showLabels:t,children:r,points:a}=s,n=a.map(i=>{var l,d,u={x:(l=i.x)!==null&&l!==void 0?l:0,y:(d=i.y)!==null&&d!==void 0?d:0,width:0,lowerWidth:0,upperWidth:0,height:0};return as(as({},u),{},{value:i.value,payload:i.payload,parentViewBox:void 0,viewBox:u,fill:void 0})});return o.createElement(Oi,{value:t?n:void 0},r)}function $a(s){var{points:t,baseLine:r,needClip:a,clipPathId:n,props:i}=s,{layout:l,type:d,stroke:u,connectNulls:h,isRange:c}=i,{id:f}=i,x=wr(i,Ql),j=tr(x),m=Ja(x);return o.createElement(o.Fragment,null,t?.length>1&&o.createElement(js,{clipPath:a?"url(#clipPath-".concat(n,")"):void 0},o.createElement(dt,Ge({},m,{id:f,points:t,connectNulls:h,type:d,baseLine:r,layout:l,stroke:"none",className:"recharts-area-area"})),u!=="none"&&o.createElement(dt,Ge({},j,{className:"recharts-area-curve",layout:l,type:d,connectNulls:h,fill:"none",points:t})),u!=="none"&&c&&o.createElement(dt,Ge({},j,{className:"recharts-area-curve",layout:l,type:d,connectNulls:h,fill:"none",points:r}))),o.createElement(io,{points:t,props:x,clipPathId:n}))}function oo(s){var t,r,{alpha:a,baseLine:n,points:i,strokeWidth:l}=s,d=(t=i[0])===null||t===void 0?void 0:t.y,u=(r=i[i.length-1])===null||r===void 0?void 0:r.y;if(!$e(d)||!$e(u))return null;var h=a*Math.abs(d-u),c=Math.max(...i.map(f=>f.x||0));return Ye(n)?c=Math.max(n,c):n&&Array.isArray(n)&&n.length&&(c=Math.max(...n.map(f=>f.x||0),c)),Ye(c)?o.createElement("rect",{x:0,y:d<u?d:d-h,width:c+(l?parseInt("".concat(l),10):1),height:Math.floor(h)}):null}function co(s){var t,r,{alpha:a,baseLine:n,points:i,strokeWidth:l}=s,d=(t=i[0])===null||t===void 0?void 0:t.x,u=(r=i[i.length-1])===null||r===void 0?void 0:r.x;if(!$e(d)||!$e(u))return null;var h=a*Math.abs(d-u),c=Math.max(...i.map(f=>f.y||0));return Ye(n)?c=Math.max(n,c):n&&Array.isArray(n)&&n.length&&(c=Math.max(...n.map(f=>f.y||0),c)),Ye(c)?o.createElement("rect",{x:d<u?d:d-h,y:0,width:h,height:Math.floor(c+(l?parseInt("".concat(l),10):1))}):null}function uo(s){var{alpha:t,layout:r,points:a,baseLine:n,strokeWidth:i}=s;return r==="vertical"?o.createElement(oo,{alpha:t,points:a,baseLine:n,strokeWidth:i}):o.createElement(co,{alpha:t,points:a,baseLine:n,strokeWidth:i})}function mo(s){var{needClip:t,clipPathId:r,props:a,previousPointsRef:n,previousBaselineRef:i}=s,{points:l,baseLine:d,isAnimationActive:u,animationBegin:h,animationDuration:c,animationEasing:f,onAnimationStart:x,onAnimationEnd:j}=a,m=o.useMemo(()=>({points:l,baseLine:d}),[l,d]),p=Ei(m,"recharts-area-"),N=Pi(),[D,v]=o.useState(!1),T=!D,w=o.useCallback(()=>{typeof j=="function"&&j(),v(!1)},[j]),k=o.useCallback(()=>{typeof x=="function"&&x(),v(!0)},[x]);if(N==null)return null;var I=n.current,B=i.current;return o.createElement(lo,{showLabels:T,points:l},a.children,o.createElement(Ri,{animationId:p,begin:h,duration:c,isActive:u,easing:f,onAnimationEnd:w,onAnimationStart:k,key:p},R=>{if(I){var _=I.length/l.length,F=R===1?l:l.map((A,V)=>{var E=Math.floor(V*_);if(I[E]){var te=I[E];return as(as({},A),{},{x:es(te.x,A.x,R),y:es(te.y,A.y,R)})}return A}),L;return Ye(d)?L=es(B,d,R):Ti(d)||_t(d)?L=es(B,0,R):L=d.map((A,V)=>{var E=Math.floor(V*_);if(Array.isArray(B)&&B[E]){var te=B[E];return as(as({},A),{},{x:es(te.x,A.x,R),y:es(te.y,A.y,R)})}return A}),R>0&&(n.current=F,i.current=L),o.createElement($a,{points:F,baseLine:L,needClip:t,clipPathId:r,props:a})}return R>0&&(n.current=l,i.current=d),o.createElement(js,null,u&&o.createElement("defs",null,o.createElement("clipPath",{id:"animationClipPath-".concat(r)},o.createElement(uo,{alpha:R,points:l,baseLine:d,layout:N,strokeWidth:a.strokeWidth}))),o.createElement(js,{clipPath:"url(#animationClipPath-".concat(r,")")},o.createElement($a,{points:l,baseLine:d,needClip:t,clipPathId:r,props:a})))}),o.createElement(Ai,{label:a.label}))}function ho(s){var{needClip:t,clipPathId:r,props:a}=s,n=o.useRef(null),i=o.useRef();return o.createElement(mo,{needClip:t,clipPathId:r,props:a,previousPointsRef:n,previousBaselineRef:i})}class po extends o.PureComponent{render(){var{hide:t,dot:r,points:a,className:n,top:i,left:l,needClip:d,xAxisId:u,yAxisId:h,width:c,height:f,id:x,baseLine:j,zIndex:m}=this.props;if(t)return null;var p=wt("recharts-area",n),N=x,{r:D,strokeWidth:v}=_i(r),T=Si(r),w=D*2+v,k=d?"url(#clipPath-".concat(T?"":"dots-").concat(N,")"):void 0;return o.createElement(Xa,{zIndex:m},o.createElement(js,{className:p},d&&o.createElement("defs",null,o.createElement(Di,{clipPathId:N,xAxisId:u,yAxisId:h}),!T&&o.createElement("clipPath",{id:"clipPath-dots-".concat(N)},o.createElement("rect",{x:l-w/2,y:i-w/2,width:c+w,height:f+w}))),o.createElement(ho,{needClip:d,clipPathId:N,props:this.props})),o.createElement(Na,{points:a,mainColor:Us(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:k}),this.props.isRange&&Array.isArray(j)&&o.createElement(Na,{points:j,mainColor:Us(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:k}))}}var Cr={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:Ya.area};function xo(s){var t,r=bs(s,Cr),{activeDot:a,animationBegin:n,animationDuration:i,animationEasing:l,connectNulls:d,dot:u,fill:h,fillOpacity:c,hide:f,isAnimationActive:x,legendType:j,stroke:m,xAxisId:p,yAxisId:N}=r,D=wr(r,Zl),v=Ni(),T=wi(),{needClip:w}=Ci(p,N),k=kt(),{points:I,isRange:B,baseLine:R}=(t=ts(E=>Xl(E,s.id,k)))!==null&&t!==void 0?t:{},_=ki();if(v!=="horizontal"&&v!=="vertical"||_==null||T!=="AreaChart"&&T!=="ComposedChart")return null;var{height:F,width:L,x:A,y:V}=_;return!I||!I.length?null:o.createElement(po,Ge({},D,{activeDot:a,animationBegin:n,animationDuration:i,animationEasing:l,baseLine:R,connectNulls:d,dot:u,fill:h,fillOpacity:c,height:F,hide:f,layout:v,isAnimationActive:x==="auto"?!Mi.isSsr:x,isRange:B,legendType:j,needClip:w,points:I,stroke:m,width:L,left:A,top:V,xAxisId:p,yAxisId:N}))}var fo=(s,t,r,a,n)=>{var i=r??t;if(Ye(i))return i;var l=s==="horizontal"?n:a,d=l.scale.domain();if(l.type==="number"){var u=Math.max(d[0],d[1]),h=Math.min(d[0],d[1]);return i==="dataMin"?h:i==="dataMax"||u<0?u:Math.max(Math.min(d[0],d[1]),0)}return i==="dataMin"?d[0]:i==="dataMax"?d[1]:d[0]};function vo(s){var{areaSettings:{connectNulls:t,baseValue:r,dataKey:a},stackedData:n,layout:i,chartBaseValue:l,xAxis:d,yAxis:u,displayedData:h,dataStartIndex:c,xAxisTicks:f,yAxisTicks:x,bandSize:j}=s,m=n&&n.length,p=fo(i,l,r,d,u),N=i==="horizontal",D=!1,v=h.map((w,k)=>{var I,B,R;if(m)R=n[c+k];else{var _=wa(w,a);Array.isArray(_)?(R=_,D=!0):R=[p,_]}var F=(I=(B=R)===null||B===void 0?void 0:B[1])!==null&&I!==void 0?I:null,L=F==null||m&&!t&&wa(w,a)==null;return N?{x:Ca({axis:d,ticks:f,bandSize:j,entry:w,index:k}),y:L?null:u.scale(F),value:R,payload:w}:{x:L?null:d.scale(F),y:Ca({axis:u,ticks:x,bandSize:j,entry:w,index:k}),value:R,payload:w}}),T;return m||D?T=v.map(w=>{var k=Array.isArray(w.value)?w.value[0]:null;return N?{x:w.x,y:k!=null&&w.y!=null?u.scale(k):null,payload:w.payload}:{x:k!=null?d.scale(k):null,y:w.y,payload:w.payload}}):T=N?u.scale(p):d.scale(p),{points:v,baseLine:T,isRange:D}}function jo(s){var t=bs(s,Cr),r=kt();return o.createElement(vi,{id:t.id,type:"area"},a=>o.createElement(o.Fragment,null,o.createElement(ji,{legendPayload:ro(t)}),o.createElement(no,{dataKey:t.dataKey,data:t.data,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,unit:t.unit,tooltipType:t.tooltipType,id:a}),o.createElement(gi,{type:"area",id:a,data:t.data,dataKey:t.dataKey,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,stackId:bi(t.stackId),hide:t.hide,barSize:void 0,baseValue:t.baseValue,isPanorama:r,connectNulls:t.connectNulls}),o.createElement(xo,Ge({},t,{id:a}))))}var xs=o.memo(jo,fi);xs.displayName="Area";var go=["axis"],bo=o.forwardRef((s,t)=>o.createElement($i,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:go,tooltipPayloadSearcher:Ii,categoricalChartProps:s,ref:t}));const Ia={WARNING:"warning",ERROR:"error"},Ce={DATABASE:"database",NETWORK:"network",AUTH:"auth",VALIDATION:"validation",STORAGE:"storage",SYNC:"sync",GENERAL:"general"};function yo(s){const t=s?.message?.toLowerCase()||"",r=s?.code?.toLowerCase()||"";return t.includes("fetch")||t.includes("network")||t.includes("offline")?Ce.NETWORK:t.includes("auth")||t.includes("unauthorized")||r.includes("auth")?Ce.AUTH:t.includes("storage")||t.includes("bucket")||t.includes("upload")?Ce.STORAGE:t.includes("validation")||t.includes("invalid")||t.includes("required")?Ce.VALIDATION:t.includes("sync")||t.includes("conflict")?Ce.SYNC:s?.code||t.includes("database")||t.includes("supabase")?Ce.DATABASE:Ce.GENERAL}function No(s,t,r){return r?.userMessage?r.userMessage:t===Ce.NETWORK?"Network connection issue. Your changes will sync when back online.":t===Ce.AUTH?"Session expired. Please sign in again.":t===Ce.STORAGE?"Failed to upload file. Please try again.":t===Ce.VALIDATION?s?.message||"Please check your input and try again.":t===Ce.SYNC?"Sync conflict detected. Please refresh and try again.":r?.operation?`Failed to ${r.operation.replace(/([A-Z])/g," $1").toLowerCase().trim()}. Please try again.`:"Something went wrong. Please try again."}function wo(s,t={}){const{operation:r="unknown",category:a=yo(s),severity:n=Ia.ERROR,showToast:i,userMessage:l,companyId:d,projectId:u,userId:h,silent:c=!1,rethrow:f=!1}=t;if(zi.error(a,{message:s?.message||"Unknown error",code:s?.code,severity:n,operation:r,company_id:d,project_id:u,user_id:h,extra:{stack:s?.stack,name:s?.name}}),!c&&i){const x=No(s,a,{operation:r,userMessage:l}),j=n===Ia.WARNING?"warning":"error";i(x,j)}if(f)throw s;return null}async function ye(s,t={}){const{fallback:r=null,context:a={},showToast:n,silent:i=!0}=t;try{return await s()}catch(l){return wo(l,{...a,showToast:n,silent:i}),r}}const os={budget:{healthy:.6,warning:.75,critical:.85},schedule:{healthy:.05,warning:.15,critical:.25},corExposure:{healthy:.05,warning:.15,critical:.25},activity:{healthy:1,warning:3,critical:5},safety:{healthy:0,warning:1,critical:2}},Co={budget:.3,schedule:.25,corExposure:.2,activity:.15,safety:.1};function Ns(s,t){if(s<=t.healthy)return 0;if(s>=t.critical)return 100;const r=t.critical-t.healthy;return(s-t.healthy)/r*100}function ws(s){return s<=25?"healthy":s<=60?"warning":"critical"}function ko(s,t,r=os.budget){if(!t||t<=0)return{score:0,status:"healthy",ratio:0,label:"No revenue yet"};const a=s/t,n=Ns(a,r),i=ws(n);let l;return a<r.healthy?l=`Costs at ${(a*100).toFixed(0)}% of revenue`:a<r.warning?l=`Costs at ${(a*100).toFixed(0)}% - monitor closely`:l=`Costs at ${(a*100).toFixed(0)}% - review immediately`,{score:n,status:i,ratio:a,label:l}}function _o(s,t,r=os.schedule){if(!t||t<=0)return{score:0,status:"healthy",variance:0,label:"No schedule baseline"};const a=(t-s)/t,n=Math.max(0,a),i=Ns(n,r),l=ws(i);let d;return a<=0?d=s>=100?"Complete":"On or ahead of schedule":a<r.warning?d=`${(a*100).toFixed(0)}% behind schedule`:d=`${(a*100).toFixed(0)}% behind - needs attention`,{score:i,status:l,variance:a,label:d}}function So(s,t,r=os.corExposure){if(!t||t<=0)return{score:0,status:"healthy",exposure:0,label:"No contract value"};const a=s/t,n=Ns(a,r),i=ws(n);let l;return a<r.healthy?l=s>0?`$${ht(s)} pending`:"No pending CORs":a<r.warning?l=`$${ht(s)} pending (${(a*100).toFixed(0)}% of contract)`:l=`High exposure: $${ht(s)} (${(a*100).toFixed(0)}%)`,{score:n,status:i,exposure:a,label:l}}function Do(s,t=os.activity){if(!s)return{score:100,status:"critical",daysSince:null,label:"No reports filed"};const r=new Date(s),n=Math.floor((new Date-r)/(1e3*60*60*24)),i=Ns(n,t),l=ws(i);let d;return n===0?d="Report filed today":n===1?d="Report filed yesterday":n<=t.warning?d=`Last report ${n} days ago`:d=`No report in ${n} days - may be stalled`,{score:i,status:l,daysSince:n,label:d}}function Eo(s,t=os.safety){const r=s||0,a=Ns(r,t),n=ws(a);let i;return r===0?i="No incidents":r===1?i="1 incident in last 30 days":i=`${r} incidents - safety review needed`,{score:a,status:n,count:r,label:i}}function Po(s,t={}){const r={...os,...t.thresholds},a={...Co,...t.weights},n=ko(s.totalCosts,s.earnedRevenue,r.budget),i=_o(s.actualProgress,s.expectedProgress,r.schedule),l=So(s.pendingCORValue,s.contractValue,r.corExposure),d=Do(s.lastReportDate,r.activity),u=Eo(s.recentInjuryCount,r.safety),h=Math.round(n.score*a.budget+i.score*a.schedule+l.score*a.corExposure+d.score*a.activity+u.score*a.safety);let c;h<=25?c="healthy":h<=60?c="warning":c="critical";let f;return c==="healthy"?f="Project is on track":c==="warning"?f="Some factors need attention":f="Immediate review recommended",{score:h,status:c,label:f,factors:{budget:{...n,weight:a.budget},schedule:{...i,weight:a.schedule},corExposure:{...l,weight:a.corExposure},activity:{...d,weight:a.activity},safety:{...u,weight:a.safety}}}}function Ro(s,t){const r=[],{factors:a}=s;a.budget.status==="critical"&&r.push({type:"critical",title:"Budget Alert",description:a.budget.label,action:"Review costs immediately",actionTarget:"financials",projectId:t.id}),a.activity.status==="critical"&&r.push({type:"critical",title:"Activity Alert",description:a.activity.label,action:"Check project status",actionTarget:"overview",projectId:t.id}),a.safety.status==="critical"&&r.push({type:"critical",title:"Safety Alert",description:a.safety.label,action:"Review safety reports",actionTarget:"reports",projectId:t.id}),a.budget.status==="warning"&&r.push({type:"warning",title:"Budget Watch",description:a.budget.label,action:"Monitor costs",actionTarget:"financials",projectId:t.id}),(a.schedule.status==="critical"||a.schedule.status==="warning")&&r.push({type:a.schedule.status==="critical"?"critical":"warning",title:"Schedule Alert",description:a.schedule.label,action:"Review progress",actionTarget:"overview",projectId:t.id}),(a.corExposure.status==="warning"||a.corExposure.status==="critical")&&r.push({type:a.corExposure.status==="critical"?"critical":"warning",title:"COR Exposure",description:a.corExposure.label,action:"Review pending CORs",actionTarget:"cors",projectId:t.id}),a.activity.status==="warning"&&r.push({type:"info",title:"Activity Notice",description:a.activity.label,action:"File daily report",actionTarget:"reports",projectId:t.id});const n={critical:0,warning:1,info:2};return r.sort((i,l)=>n[i.type]-n[l.type]),r}function To(s){const{actualProgress:t,totalCosts:r,earnedRevenue:a,contractValue:n}=s;if(!t||t<=0)return{estimatedCompletionCost:null,estimatedFinalMargin:null,estimatedCompletionDate:null};const i=r/t,l=Math.round(i*100),d=n>0?(n-l)/n*100:0;let u=null;if(s.startDate&&t>0&&t<100){const h=new Date(s.startDate),c=new Date,f=Math.max(1,(c-h)/(1e3*60*60*24)),x=t/f,m=(100-t)/x;u=new Date(c.getTime()+m*24*60*60*1e3)}return{estimatedCompletionCost:l,estimatedFinalMargin:d,estimatedCompletionDate:u,costPerPercent:i}}function ht(s){return s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toFixed(0)}const Js=()=>xe(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),ue=210,U=14,Re=ue-U*2,ns=s=>s?new Date(s+(s.includes("T")?"":"T12:00:00")).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"—",Te=(s,t,r=30)=>t+r>s.internal.pageSize.height-20?(s.addPage(),20):t;async function Ao(s,t){const a=(await Js()).default,n=new a;let i=20;n.setFontSize(18),n.setFont(void 0,"bold"),n.text("Daily Reports",ue/2,i,{align:"center"}),i+=8,n.setFontSize(11),n.setFont(void 0,"normal"),n.text(`Project: ${t.name}`,ue/2,i,{align:"center"}),i+=6,n.text(`${s.length} report${s.length!==1?"s":""}`,ue/2,i,{align:"center"}),i+=12,s.forEach((d,u)=>{i=Te(n,i,60),n.setDrawColor(200,200,200),n.setFillColor(245,247,250),n.roundedRect(U,i-2,Re,10,2,2,"F"),n.setFontSize(11),n.setFont(void 0,"bold"),n.setTextColor(30,30,30),n.text(`${ns(d.report_date)}`,U+4,i+5);const h=d.status==="submitted"?"Submitted":"Draft";n.setFontSize(9),n.setFont(void 0,"normal"),n.text(h,ue-U-4,i+5,{align:"right"}),i+=14,n.setTextColor(0,0,0),n.setFontSize(9);const c=[`Crew: ${d.crew_count||0}`,`Tasks: ${d.tasks_completed||0}/${d.tasks_total||0}`,`T&M Tickets: ${d.tm_tickets_count||0}`,`Photos: ${d.photos_count||0}`];if(n.text(c.join("    |    "),U+4,i),i+=7,d.crew_list?.length>0){n.setFont(void 0,"bold"),n.text("Crew:",U+4,i),n.setFont(void 0,"normal");const f=d.crew_list.map(j=>`${j.name} (${j.role||"Laborer"})`).join(", "),x=n.splitTextToSize(f,Re-8);i+=4,n.text(x,U+4,i),i+=x.length*4+2}if(d.field_notes){i=Te(n,i,15),n.setFont(void 0,"bold"),n.text("Field Notes:",U+4,i),n.setFont(void 0,"normal"),i+=4;const f=n.splitTextToSize(d.field_notes,Re-8);n.text(f,U+4,i),i+=f.length*4+2}if(d.issues){i=Te(n,i,15),n.setFont(void 0,"bold"),n.text("Issues:",U+4,i),n.setFont(void 0,"normal"),i+=4;const f=n.splitTextToSize(d.issues,Re-8);n.text(f,U+4,i),i+=f.length*4+2}i+=8,u<s.length-1&&(n.setDrawColor(220,220,220),n.line(U,i,ue-U,i),i+=6)});const l=`${t.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;n.save(l)}async function Oo(s,t){const a=(await Js()).default,n=new a;let i=20;n.setFontSize(18),n.setFont(void 0,"bold"),n.text("Incident / Injury Reports",ue/2,i,{align:"center"}),i+=8,n.setFontSize(11),n.setFont(void 0,"normal"),n.text(`Project: ${t.name}`,ue/2,i,{align:"center"}),i+=6,n.text(`${s.length} report${s.length!==1?"s":""}`,ue/2,i,{align:"center"}),i+=12,s.forEach((d,u)=>{i=Te(n,i,50);const c={minor:[34,197,94],serious:[245,158,11],critical:[239,68,68],near_miss:[59,130,246]}[d.injury_type]||[128,128,128];n.setFillColor(...c),n.roundedRect(U,i-2,3,14,1,1,"F"),n.setFontSize(11),n.setFont(void 0,"bold"),n.setTextColor(30,30,30),n.text(`${ns(d.incident_date)}`,U+8,i+4),n.setFontSize(9);const f=(d.injury_type||"").replace("_"," ").toUpperCase();if(n.text(f,U+8,i+10),n.setFont(void 0,"normal"),n.text(d.status==="open"?"OPEN":"CLOSED",ue-U-4,i+4,{align:"right"}),i+=16,n.setTextColor(0,0,0),d.description){n.setFontSize(9),n.setFont(void 0,"bold"),n.text("Description:",U+4,i),n.setFont(void 0,"normal"),i+=4;const x=n.splitTextToSize(d.description,Re-8);n.text(x,U+4,i),i+=x.length*4+2}d.location&&(n.setFont(void 0,"bold"),n.text("Location: ",U+4,i),n.setFont(void 0,"normal"),n.text(d.location,U+30,i),i+=6),i+=6,u<s.length-1&&(n.setDrawColor(220,220,220),n.line(U,i,ue-U,i),i+=6)});const l=`${t.name}_Incident_Reports_${new Date().toISOString().split("T")[0]}.pdf`;n.save(l)}async function Fo(s,t){const a=(await Js()).default,n=new a;let i=20;n.setFontSize(18),n.setFont(void 0,"bold"),n.text("Crew Check-In History",ue/2,i,{align:"center"}),i+=8,n.setFontSize(11),n.setFont(void 0,"normal"),n.text(`Project: ${t.name}`,ue/2,i,{align:"center"}),i+=6,n.text(`${s.length} check-in${s.length!==1?"s":""}`,ue/2,i,{align:"center"}),i+=12,s.forEach((d,u)=>{i=Te(n,i,30);const h=d.workers||[];n.setFillColor(245,247,250),n.roundedRect(U,i-2,Re,9,2,2,"F"),n.setFontSize(10),n.setFont(void 0,"bold"),n.setTextColor(30,30,30),n.text(ns(d.check_in_date),U+4,i+4),n.setFont(void 0,"normal"),n.text(`${h.length} workers`,ue-U-4,i+4,{align:"right"}),i+=12,n.setTextColor(0,0,0),n.setFontSize(9),h.length>0&&(n.setFont(void 0,"bold"),n.text("Name",U+4,i),n.text("Role",110,i),i+=5,n.setFont(void 0,"normal"),h.forEach(c=>{i=Te(n,i,6),n.text(c.name||"—",U+4,i),n.text(c.role||"Laborer",110,i),i+=4.5})),i+=6,u<s.length-1&&(n.setDrawColor(220,220,220),n.line(U,i,ue-U,i),i+=5)});const l=`${t.name}_Crew_Checkins_${new Date().toISOString().split("T")[0]}.pdf`;n.save(l)}async function Mo({dailyReports:s=[],incidentReports:t=[],crewCheckins:r=[],project:a}){const i=(await Js()).default,l=new i;let d=20;l.setFontSize(22),l.setFont(void 0,"bold"),l.text("Field Documents Report",ue/2,d,{align:"center"}),d+=10,l.setFontSize(13),l.setFont(void 0,"normal"),l.text(`Project: ${a.name}`,ue/2,d,{align:"center"}),d+=8,l.setFontSize(10),l.text(`Generated: ${new Date().toLocaleDateString()}`,ue/2,d,{align:"center"}),d+=16,l.setFontSize(11),l.setFont(void 0,"bold"),l.text("Document Summary",U,d),d+=8,l.setFontSize(10),l.setFont(void 0,"normal"),[["Daily Reports",`${s.length}`],["Incident Reports",`${t.length}`],["Crew Check-Ins",`${r.length}`]].forEach(([c,f])=>{l.text(c,U+4,d),l.text(f,100,d),d+=6}),s.length>0&&(l.addPage(),d=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Daily Reports",U,d),d+=10,s.forEach((c,f)=>{if(d=Te(l,d,40),l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(ns(c.report_date),U+2,d),l.setFont(void 0,"normal"),l.setFontSize(8),l.text(`Crew: ${c.crew_count||0} | Tasks: ${c.tasks_completed||0}/${c.tasks_total||0} | T&M: ${c.tm_tickets_count||0}`,U+60,d),d+=6,l.setTextColor(0,0,0),l.setFontSize(9),c.field_notes){const x=l.splitTextToSize(c.field_notes,Re-4);l.text(x,U+2,d),d+=x.length*4+2}if(c.issues){l.setFont(void 0,"bold"),l.text("Issues: ",U+2,d),l.setFont(void 0,"normal");const x=l.splitTextToSize(c.issues,Re-20);l.text(x,U+20,d),d+=x.length*4+2}d+=4,f<s.length-1&&(l.setDrawColor(220,220,220),l.line(U,d,ue-U,d),d+=4)})),t.length>0&&(l.addPage(),d=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Incident / Injury Reports",U,d),d+=10,t.forEach((c,f)=>{d=Te(l,d,35),l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(ns(c.incident_date),U+2,d),l.setFontSize(8),l.setFont(void 0,"normal");const x=(c.injury_type||"").replace("_"," ").toUpperCase();if(l.text(`${x} — ${c.status?.toUpperCase()||""}`,U+60,d),d+=6,l.setTextColor(0,0,0),l.setFontSize(9),c.description){const j=l.splitTextToSize(c.description,Re-4);l.text(j,U+2,d),d+=j.length*4+2}c.location&&(l.text(`Location: ${c.location}`,U+2,d),d+=5),d+=4,f<t.length-1&&(l.setDrawColor(220,220,220),l.line(U,d,ue-U,d),d+=4)})),r.length>0&&(l.addPage(),d=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Crew Check-In History",U,d),d+=10,r.forEach((c,f)=>{d=Te(l,d,20);const x=c.workers||[];if(l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(ns(c.check_in_date),U+2,d),l.setFont(void 0,"normal"),l.setFontSize(8),l.text(`${x.length} workers`,U+60,d),d+=6,l.setTextColor(0,0,0),l.setFontSize(8),x.length>0){const j=x.map(p=>`${p.name} (${p.role||"Laborer"})`).join(", "),m=l.splitTextToSize(j,Re-4);l.text(m,U+2,d),d+=m.length*3.5+3}f<r.length-1&&(l.setDrawColor(230,230,230),l.line(U,d,ue-U,d),d+=3)}));const h=`${a.name}_Field_Documents_${new Date().toISOString().split("T")[0]}.pdf`;l.save(h)}function Xs(s,t,r="text/csv"){const a=new Blob([s],{type:r}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}function za(s){if(s==null)return"";const t=String(s);return t.includes(",")||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t}function Ft(s,t){const r=s.map(n=>za(n.label)).join(","),a=t.map(n=>s.map(i=>za(n[i.key])).join(","));return[r,...a].join(`
`)}function $o(s,t){const r=[{key:"category",label:"Category"},{key:"description",label:"Description"},{key:"amount",label:"Amount"},{key:"date",label:"Date"},{key:"type",label:"Type"}],a=[];a.push({category:"Revenue",description:"Original Contract Value",amount:s.contract_value||0,date:s.start_date||"",type:"Contract"}),t?.earnedRevenue&&a.push({category:"Revenue",description:"Earned Revenue (Progress)",amount:t.earnedRevenue,date:new Date().toISOString().split("T")[0],type:"Earned"}),t?.approvedCORs&&t.approvedCORs.forEach(u=>{a.push({category:"Revenue",description:`COR: ${u.cor_number} - ${u.title}`,amount:(u.cor_total||0)/100,date:u.approved_at?.split("T")[0]||"",type:"Change Order"})}),t?.laborByDate&&t.laborByDate.forEach(u=>{a.push({category:"Cost",description:"Labor",amount:u.cost,date:u.date,type:"Labor"})}),t?.haulOffByDate&&t.haulOffByDate.forEach(u=>{a.push({category:"Cost",description:"Disposal/Haul-off",amount:u.cost,date:u.date,type:"Disposal"})}),t?.customCosts&&t.customCosts.forEach(u=>{a.push({category:"Cost",description:u.description||u.category||"Other",amount:parseFloat(u.amount)||0,date:u.cost_date||"",type:u.category||"Other"})});const n=a.filter(u=>u.category==="Revenue").reduce((u,h)=>u+(parseFloat(h.amount)||0),0),i=a.filter(u=>u.category==="Cost").reduce((u,h)=>u+(parseFloat(h.amount)||0),0);a.push({category:"",description:"",amount:"",date:"",type:""}),a.push({category:"Summary",description:"Total Revenue",amount:n,date:"",type:""}),a.push({category:"Summary",description:"Total Costs",amount:i,date:"",type:""}),a.push({category:"Summary",description:"Gross Profit",amount:n-i,date:"",type:""}),a.push({category:"Summary",description:"Margin %",amount:n>0?((n-i)/n*100).toFixed(1)+"%":"N/A",date:"",type:""});const l=Ft(r,a),d=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_Financials_${new Date().toISOString().split("T")[0]}.csv`;Xs(l,d)}function Lc(s,t){const r=[],a=[{key:"section",label:"Section"},{key:"description",label:"Description"},{key:"quantity",label:"Quantity"},{key:"unit",label:"Unit"},{key:"rate",label:"Rate"},{key:"total",label:"Total"}];r.push({section:"COR Info",description:`${s.cor_number} - ${s.title}`,quantity:"",unit:"",rate:"",total:""}),r.push({section:"Status",description:s.status,quantity:"",unit:"",rate:"",total:""}),r.push({section:"Period",description:`${s.period_start||""} to ${s.period_end||""}`,quantity:"",unit:"",rate:"",total:""}),r.push({section:"",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor?.length>0&&(r.push({section:"LABOR",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor.forEach(l=>{const d=parseFloat(l.regular_hours)||0,u=parseFloat(l.overtime_hours)||0;r.push({section:"",description:l.description||l.classification,quantity:d+u,unit:"hours",rate:(parseInt(l.regular_rate)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_materials?.length>0&&(r.push({section:"MATERIALS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_materials.forEach(l=>{r.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"each",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_equipment?.length>0&&(r.push({section:"EQUIPMENT",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_equipment.forEach(l=>{r.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"day",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_subcontractors?.length>0&&(r.push({section:"SUBCONTRACTORS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_subcontractors.forEach(l=>{r.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"lump sum",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})}));const n=Ft(a,r),i=`COR_${s.cor_number||s.id}_${new Date().toISOString().split("T")[0]}.csv`;Xs(n,i)}function qc(s,t){const r=[{key:"date",label:"Date"},{key:"status",label:"Status"},{key:"workers",label:"Worker Count"},{key:"totalHours",label:"Total Hours"},{key:"otHours",label:"OT Hours"},{key:"materialsCost",label:"Materials Cost"},{key:"corNumber",label:"COR #"},{key:"notes",label:"Notes"}],a=s.map(l=>{const d=l.t_and_m_workers||[],u=l.t_and_m_items||[],h=d.reduce((x,j)=>x+(parseFloat(j.hours)||0),0),c=d.reduce((x,j)=>x+(parseFloat(j.overtime_hours)||0),0),f=u.reduce((x,j)=>x+(parseFloat(j.quantity)||0)*(j.materials_equipment?.cost_per_unit||0),0);return{date:l.work_date,status:l.status,workers:d.length,totalHours:(h+c).toFixed(1),otHours:c.toFixed(1),materialsCost:f.toFixed(2),corNumber:l.assigned_cor_id?"Linked":"",notes:l.notes||""}}),n=Ft(r,a),i=`${t.name.replace(/[^a-zA-Z0-9]/g,"_")}_TM_Tickets_${new Date().toISOString().split("T")[0]}.csv`;Xs(n,i)}function Io(s,t){const r=[],a=new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"});r.push("!TRNS	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),r.push("!SPL	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),r.push("!ENDTRNS");const n=s.contract_value||0;r.push(`TRNS	GENERAL JOURNAL	${a}	Accounts Receivable	${s.name}	${n.toFixed(2)}	FieldSync - Contract Revenue`),r.push(`SPL	GENERAL JOURNAL	${a}	Construction Revenue	${s.name}	${(-n).toFixed(2)}	Contract: ${s.name}`),r.push("ENDTRNS");const i=t?.totalLaborCost||0;i>0&&(r.push(`TRNS	GENERAL JOURNAL	${a}	Direct Labor	${s.name}	${i.toFixed(2)}	Labor costs - ${s.name}`),r.push(`SPL	GENERAL JOURNAL	${a}	Accounts Payable	${s.name}	${(-i).toFixed(2)}	Labor costs`),r.push("ENDTRNS"));const l=t?.totalDisposalCost||0;l>0&&(r.push(`TRNS	GENERAL JOURNAL	${a}	Disposal Expense	${s.name}	${l.toFixed(2)}	Disposal costs - ${s.name}`),r.push(`SPL	GENERAL JOURNAL	${a}	Accounts Payable	${s.name}	${(-l).toFixed(2)}	Disposal costs`),r.push("ENDTRNS"));const d=r.join(`
`),u=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_QB_${new Date().toISOString().split("T")[0]}.iif`;Xs(d,u,"application/x-iif")}function zo({isOpen:s,onClose:t,companyId:r,onSelectProject:a,onSelectTicket:n,onSelectCOR:i,onShowToast:l}){const[d,u]=o.useState(""),[h,c]=o.useState({projects:[],tickets:[],cors:[],workers:[]}),[f,x]=o.useState(!1),[j,m]=o.useState(0),p=o.useRef(null),N=o.useRef(null),D=o.useRef(null);o.useEffect(()=>()=>{N.current&&clearTimeout(N.current),D.current&&clearTimeout(D.current)},[]),o.useEffect(()=>{s&&(u(""),c({projects:[],tickets:[],cors:[],workers:[]}),m(0),D.current=setTimeout(()=>p.current?.focus(),50))},[s]);const v=o.useCallback(async _=>{if(!_.trim()||_.length<2){c({projects:[],tickets:[],cors:[],workers:[]});return}x(!0);try{const F=await W.universalSearch(r,_.trim());c(F),m(0)}catch(F){console.error("Search error:",F),l?.("Search failed","error")}finally{x(!1)}},[r,l]),T=_=>{const F=_.target.value;u(F),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{v(F)},200)},k=(()=>{const _=[];return h.projects.forEach(F=>_.push({type:"project",data:F})),h.tickets.forEach(F=>_.push({type:"ticket",data:F})),h.cors.forEach(F=>_.push({type:"cor",data:F})),h.workers.forEach(F=>_.push({type:"worker",data:F})),_})(),I=k.length>0,B=_=>{_.key==="Escape"?t():_.key==="ArrowDown"?(_.preventDefault(),m(F=>Math.min(F+1,k.length-1))):_.key==="ArrowUp"?(_.preventDefault(),m(F=>Math.max(F-1,0))):_.key==="Enter"&&I&&(_.preventDefault(),R(k[j]))},R=_=>{if(_){switch(_.type){case"project":a?.(_.data);break;case"ticket":n?.(_.data);break;case"cor":i?.(_.data);break;case"worker":_.data.lastProject&&a?.(_.data.lastProject);break}t()}};return s?e.jsx("div",{className:"universal-search-overlay",onClick:t,children:e.jsxs("div",{className:"universal-search-modal",onClick:_=>_.stopPropagation(),children:[e.jsxs("div",{className:"universal-search-input-wrapper",children:[e.jsx(or,{size:20,className:"universal-search-icon"}),e.jsx("input",{ref:p,type:"text",value:d,onChange:T,onKeyDown:B,placeholder:"Search projects, tickets, CORs, workers...",className:"universal-search-input",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),d&&e.jsx("button",{className:"universal-search-clear",onClick:()=>u(""),children:e.jsx(Je,{size:16})}),e.jsx("div",{className:"universal-search-shortcut",children:e.jsx("span",{children:"esc"})})]}),e.jsx("div",{className:"universal-search-results",children:f?e.jsxs("div",{className:"universal-search-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Searching..."})]}):d.trim()?I?e.jsxs(e.Fragment,{children:[h.projects.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(jt,{size:14}),e.jsx("span",{children:"Projects"})]}),h.projects.map((_,F)=>{const L=F;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>R({type:"project",data:_}),onMouseEnter:()=>m(L),children:[e.jsx(jt,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:_.name}),_.job_number&&e.jsxs("span",{className:"universal-search-item-meta",children:["#",_.job_number]})]}),e.jsx(ze,{size:16,className:"universal-search-item-arrow"})]},_.id)})]}),h.tickets.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(rs,{size:14}),e.jsx("span",{children:"T&M Tickets"})]}),h.tickets.map((_,F)=>{const L=h.projects.length+F;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>R({type:"ticket",data:_}),onMouseEnter:()=>m(L),children:[e.jsx(rs,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[_.description?.substring(0,50)||"T&M Ticket",_.description?.length>50&&"..."]}),e.jsxs("span",{className:"universal-search-item-meta",children:[_.projectName," • ",_.work_date]})]}),e.jsx("span",{className:`universal-search-item-badge ${_.status}`,children:_.status})]},_.id)})]}),h.cors.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(be,{size:14}),e.jsx("span",{children:"Change Orders"})]}),h.cors.map((_,F)=>{const L=h.projects.length+h.tickets.length+F;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>R({type:"cor",data:_}),onMouseEnter:()=>m(L),children:[e.jsx(be,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[_.cor_number?`COR #${_.cor_number}: `:"",_.title]}),e.jsx("span",{className:"universal-search-item-meta",children:_.projectName})]}),e.jsx("span",{className:`universal-search-item-badge ${_.status}`,children:_.status})]},_.id)})]}),h.workers.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(Ie,{size:14}),e.jsx("span",{children:"Workers"})]}),h.workers.map((_,F)=>{const L=h.projects.length+h.tickets.length+h.cors.length+F;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>R({type:"worker",data:_}),onMouseEnter:()=>m(L),children:[e.jsx(Ie,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:_.name}),e.jsxs("span",{className:"universal-search-item-meta",children:[_.role," • ",_.projectName]})]}),e.jsx(ze,{size:16,className:"universal-search-item-arrow"})]},`${_.name}-${F}`)})]})]}):e.jsx("div",{className:"universal-search-no-results",children:e.jsxs("span",{children:['No results for "',d,'"']})}):e.jsxs("div",{className:"universal-search-empty",children:[e.jsxs("div",{className:"universal-search-tip",children:[e.jsx(Xi,{size:14}),e.jsx("span",{children:"Type to search across all data"})]}),e.jsxs("div",{className:"universal-search-hints",children:[e.jsx("span",{children:"Projects"}),e.jsx("span",{children:"T&M Tickets"}),e.jsx("span",{children:"Change Orders"}),e.jsx("span",{children:"Workers"})]})]})}),e.jsxs("div",{className:"universal-search-footer",children:[e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↑↓"})," navigate"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↵"})," select"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"esc"})," close"]})]})]})}):null}function Lo(){const[s,t]=o.useState(!1);return o.useEffect(()=>{const r=a=>{(a.metaKey||a.ctrlKey)&&a.key==="k"&&(a.preventDefault(),t(n=>!n))};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]),{isOpen:s,setIsOpen:t,open:()=>t(!0),close:()=>t(!1)}}function qo({alerts:s=[],onAction:t,onSnooze:r,onDismiss:a,snoozeDurationLabel:n,totalUnfiltered:i=0,maxVisible:l=5,className:d=""}){const[u,h]=o.useState(new Set),c=s.filter(j=>!u.has(j.id||`${j.projectId}-${j.type}-${j.title}`)).slice(0,l),f=o.useCallback(j=>{const m=j.id||`${j.projectId}-${j.type}-${j.title}`;h(p=>new Set([...p,m])),r?r(j):a?.(j)},[r,a]);if(c.length===0)return null;const x=i>0?i-s.length:0;return e.jsxs("div",{className:`smart-alerts ${d}`,role:"region","aria-label":"Project alerts","aria-live":"polite",children:[c.map((j,m)=>e.jsx(Vo,{alert:j,onAction:t,onDismiss:()=>f(j),snoozeDurationLabel:n},j.id||`${j.projectId}-${j.type}-${m}`)),s.length>l&&e.jsx("div",{className:"smart-alerts__overflow",children:e.jsxs("span",{className:"smart-alerts__overflow-text",children:["+",s.length-l," more alert",s.length-l!==1?"s":""]})}),x>0&&e.jsx("div",{className:"smart-alerts__filtered-note",children:e.jsxs("span",{className:"smart-alerts__filtered-text",children:[x," alert",x!==1?"s":""," hidden by filters"]})})]})}function Vo({alert:s,onAction:t,onDismiss:r,snoozeDurationLabel:a}){const{type:n="info",title:i,description:l,action:d,actionTarget:u,projectId:h,projectName:c}=s,x={critical:Qi,warning:qs,info:Ls}[n]||Ls,j=()=>{t?.({target:u,projectId:h,alert:s})},m=a?`Snooze for ${a}`:"Dismiss alert";return e.jsxs("div",{className:`smart-alert smart-alert--${n}`,role:"alert","aria-live":n==="critical"?"assertive":"polite",children:[e.jsx(x,{className:"smart-alert__icon","aria-hidden":"true"}),e.jsxs("div",{className:"smart-alert__content",children:[e.jsxs("div",{className:"smart-alert__title",children:[c&&e.jsxs("span",{className:"smart-alert__project",children:[c,": "]}),i]}),l&&e.jsx("div",{className:"smart-alert__description",children:l}),d&&e.jsx("div",{className:"smart-alert__action",children:e.jsxs("button",{type:"button",className:"smart-alert__action-btn",onClick:j,children:[d,e.jsx(Zi,{size:14,"aria-hidden":"true"})]})})]}),r&&e.jsx("button",{type:"button",className:"smart-alert__dismiss",onClick:r,"aria-label":m,title:m,children:a?e.jsx(Vs,{size:16,"aria-hidden":"true"}):e.jsx(Je,{size:18,"aria-hidden":"true"})})]})}const kr="fieldsync_alert_preferences",yt="fieldsync_snoozed_alerts",_r={budget:{id:"budget",label:"Budget Alerts",description:"Cost overruns and budget warnings",alertTitles:["Budget Alert","Budget Watch"]},schedule:{id:"schedule",label:"Schedule Alerts",description:"Projects falling behind schedule",alertTitles:["Schedule Alert"]},corExposure:{id:"corExposure",label:"Change Order Alerts",description:"Pending COR exposure warnings",alertTitles:["COR Exposure"]},activity:{id:"activity",label:"Activity Alerts",description:"Stale daily reports and inactivity",alertTitles:["Activity Alert","Activity Notice"]},safety:{id:"safety",label:"Safety Alerts",description:"Injury reports and safety incidents",alertTitles:["Safety Alert"]}},Sr={all:{id:"all",label:"All Alerts",description:"Critical, warning, and informational"},warning:{id:"warning",label:"Warnings & Critical",description:"Only warnings and critical alerts"},critical:{id:"critical",label:"Critical Only",description:"Only the most urgent alerts"}},Hs={"1h":{id:"1h",label:"1 hour",ms:3600*1e3},"4h":{id:"4h",label:"4 hours",ms:14400*1e3},"1d":{id:"1d",label:"1 day",ms:1440*60*1e3},"1w":{id:"1w",label:"1 week",ms:10080*60*1e3}},Nt={enabledCategories:["budget","schedule","corExposure","activity","safety"],minimumSeverity:"all",snoozeDuration:"1d"};function Bo(){try{const s=localStorage.getItem(kr);if(s){const t=JSON.parse(s);return{...Nt,...t}}}catch(s){console.warn("Failed to load alert preferences:",s)}return{...Nt}}function Wo(s){try{localStorage.setItem(kr,JSON.stringify(s))}catch(t){console.warn("Failed to save alert preferences:",t)}}function Uo(){try{const s=localStorage.getItem(yt);if(s){const t=JSON.parse(s),r=Date.now(),a={};for(const[n,i]of Object.entries(t))i>r&&(a[n]=i);return Object.keys(a).length!==Object.keys(t).length&&localStorage.setItem(yt,JSON.stringify(a)),a}}catch(s){console.warn("Failed to load snoozed alerts:",s)}return{}}function pt(s){try{localStorage.setItem(yt,JSON.stringify(s))}catch(t){console.warn("Failed to save snoozed alerts:",t)}}function xt(s){return`${s.projectId}-${s.title}`}function Ho(){const[s,t]=o.useState(Bo),[r,a]=o.useState(Uo),n=o.useCallback(p=>{t(N=>{const D=typeof p=="function"?p(N):{...N,...p};return Wo(D),D})},[]),i=o.useCallback(p=>{n(N=>{const D=N.enabledCategories.includes(p)?N.enabledCategories.filter(v=>v!==p):[...N.enabledCategories,p];return{...N,enabledCategories:D}})},[n]),l=o.useCallback(p=>{n(N=>({...N,minimumSeverity:p}))},[n]),d=o.useCallback(p=>{n(N=>({...N,snoozeDuration:p}))},[n]),u=o.useCallback(p=>{const N=xt(p),D=Hs[s.snoozeDuration]?.ms||Hs["1d"].ms,v=Date.now()+D;a(T=>{const w={...T,[N]:v};return pt(w),w})},[s.snoozeDuration]),h=o.useCallback(p=>{const N=xt(p);a(D=>{const v={...D};return delete v[N],pt(v),v})},[]),c=o.useCallback(()=>{a({}),pt({})},[]),f=o.useCallback(()=>{n(Nt),c()},[n,c]),x={};for(const[p,N]of Object.entries(_r))for(const D of N.alertTitles)x[D]=p;const j=o.useCallback(p=>{const N=Date.now(),{enabledCategories:D,minimumSeverity:v}=s;return p.filter(T=>{const w=x[T.title];if(w&&!D.includes(w)||v==="critical"&&T.type!=="critical"||v==="warning"&&T.type==="info")return!1;const k=xt(T),I=r[k];return!(I&&I>N)})},[s,r]),m=Object.values(r).filter(p=>p>Date.now()).length;return{preferences:s,toggleCategory:i,setMinimumSeverity:l,setSnoozeDuration:d,snoozeAlert:u,unsnoozeAlert:h,clearAllSnoozes:c,resetToDefaults:f,filterAlerts:j,snoozedCount:m}}function Ko({preferences:s,onToggleCategory:t,onSetSeverity:r,onSetSnoozeDuration:a,onResetDefaults:n,onClearSnoozes:i,snoozedCount:l=0,onClose:d,className:u=""}){const[h,c]=o.useState(!1);return e.jsxs("div",{className:`alert-preferences ${u}`,children:[e.jsxs("button",{type:"button",className:"alert-preferences__toggle",onClick:()=>c(!h),"aria-expanded":h,"aria-label":"Alert preferences",title:"Customize alerts",children:[e.jsx(cr,{size:16}),!h&&s.enabledCategories.length<5&&e.jsxs("span",{className:"alert-preferences__filter-badge",children:[s.enabledCategories.length,"/5"]})]}),h&&e.jsxs("div",{className:"alert-preferences__panel",role:"dialog","aria-label":"Alert Preferences",children:[e.jsxs("div",{className:"alert-preferences__header",children:[e.jsxs("h4",{className:"alert-preferences__title",children:[e.jsx(Sa,{size:16}),"Alert Preferences"]}),e.jsx("button",{type:"button",className:"alert-preferences__close",onClick:()=>c(!1),"aria-label":"Close preferences",children:e.jsx(Je,{size:16})})]}),e.jsxs("div",{className:"alert-preferences__section",children:[e.jsx("h5",{className:"alert-preferences__section-title",children:"Alert Types"}),e.jsx("p",{className:"alert-preferences__section-desc",children:"Choose which alerts matter to you"}),e.jsx("div",{className:"alert-preferences__categories",children:Object.entries(_r).map(([f,x])=>{const j=s.enabledCategories.includes(f);return e.jsxs("label",{className:`alert-preferences__category ${j?"alert-preferences__category--enabled":""}`,children:[e.jsx("input",{type:"checkbox",checked:j,onChange:()=>t(f),className:"alert-preferences__checkbox"}),e.jsxs("div",{className:"alert-preferences__category-info",children:[e.jsx("span",{className:"alert-preferences__category-label",children:x.label}),e.jsx("span",{className:"alert-preferences__category-desc",children:x.description})]}),j?e.jsx(Sa,{size:14}):e.jsx(el,{size:14})]},f)})})]}),e.jsxs("div",{className:"alert-preferences__section",children:[e.jsx("h5",{className:"alert-preferences__section-title",children:"Minimum Severity"}),e.jsx("p",{className:"alert-preferences__section-desc",children:"Filter out lower-priority alerts"}),e.jsx("div",{className:"alert-preferences__severity-options",children:Object.entries(Sr).map(([f,x])=>e.jsxs("label",{className:`alert-preferences__severity ${s.minimumSeverity===f?"alert-preferences__severity--selected":""}`,children:[e.jsx("input",{type:"radio",name:"severity",value:f,checked:s.minimumSeverity===f,onChange:()=>r(f),className:"alert-preferences__radio"}),e.jsx("span",{className:"alert-preferences__severity-label",children:x.label}),e.jsx("span",{className:"alert-preferences__severity-desc",children:x.description})]},f))})]}),e.jsxs("div",{className:"alert-preferences__section",children:[e.jsxs("h5",{className:"alert-preferences__section-title",children:[e.jsx(Vs,{size:14}),"Snooze Duration"]}),e.jsx("p",{className:"alert-preferences__section-desc",children:"How long dismissed alerts stay hidden"}),e.jsx("div",{className:"alert-preferences__snooze-options",children:Object.entries(Hs).map(([f,x])=>e.jsx("button",{type:"button",className:`alert-preferences__snooze-btn ${s.snoozeDuration===f?"alert-preferences__snooze-btn--selected":""}`,onClick:()=>a(f),children:x.label},f))}),l>0&&e.jsxs("div",{className:"alert-preferences__snoozed-info",children:[e.jsxs("span",{children:[l," alert",l!==1?"s":""," snoozed"]}),e.jsx("button",{type:"button",className:"alert-preferences__clear-snoozes",onClick:i,children:"Show all"})]})]}),e.jsx("div",{className:"alert-preferences__actions",children:e.jsxs("button",{type:"button",className:"alert-preferences__reset",onClick:n,children:[e.jsx(dr,{size:14}),"Reset to Defaults"]})})]})]})}function Go({preferences:s,snoozedCount:t=0}){const r=[];return s.enabledCategories.length<5&&r.push(`${s.enabledCategories.length}/5 types`),s.minimumSeverity!=="all"&&r.push(Sr[s.minimumSeverity]?.label||s.minimumSeverity),t>0&&r.push(`${t} snoozed`),r.length===0?null:e.jsxs("span",{className:"alert-filter-summary",children:[e.jsx(cr,{size:12}),r.join(" · ")]})}const Yo=o.memo(function({progress:t=0,areasComplete:r=0,totalAreas:a=0,areasWorking:n=0,size:i=110,strokeWidth:l=9}){const[d,u]=o.useState(0),h=o.useRef(null);o.useEffect(()=>{const m=d,p=Math.min(100,Math.max(0,t)),N=800,D=performance.now(),v=T=>{const w=T-D,k=Math.min(w/N,1),I=1-Math.pow(1-k,3),B=m+(p-m)*I;u(B),k<1&&(h.current=requestAnimationFrame(v))};return h.current=requestAnimationFrame(v),()=>{h.current&&cancelAnimationFrame(h.current)}},[t]);const c=(i-l)/2,f=c*2*Math.PI,x=f-d/100*f,j=()=>d>=80?"var(--accent-green)":d>=50||d>=25?"var(--accent-blue)":"var(--text-muted)";return e.jsxs("div",{className:"overview-progress-gauge",children:[e.jsxs("div",{className:"progress-gauge-circle",style:{width:i,height:i},children:[e.jsxs("svg",{width:i,height:i,viewBox:`0 0 ${i} ${i}`,children:[e.jsx("circle",{className:"gauge-track",cx:i/2,cy:i/2,r:c,fill:"none",strokeWidth:l,stroke:"var(--bg-tertiary)"}),e.jsx("circle",{className:"gauge-fill",cx:i/2,cy:i/2,r:c,fill:"none",stroke:j(),strokeWidth:l,strokeDasharray:f,strokeDashoffset:x,strokeLinecap:"round",transform:`rotate(-90 ${i/2} ${i/2})`,style:{transition:"stroke 0.3s ease"}})]}),e.jsxs("div",{className:"gauge-center",children:[e.jsxs("span",{className:"gauge-value",children:[Math.round(d),"%"]}),e.jsx("span",{className:"gauge-label",children:"Complete"})]})]}),e.jsxs("div",{className:"gauge-areas-status",children:[e.jsxs("span",{className:"areas-count",children:[e.jsx("strong",{children:r}),"/",a," Areas Done"]}),n>0&&e.jsxs("span",{className:"areas-active",children:[n," active"]})]})]})}),J={contract:"#3b82f6",revenue:"#10b981",costs:"#f59e0b",profit:"#22c55e",loss:"#ef4444",tmValue:"#8b5cf6",corValue:"#14b8a6",labor:"#6366f1",disposal:"#14b8a6",equipment:"#f97316",materials:"#a855f7",subcontractor:"#ec4899",other:"#6b7280"},fs={duration:800},La={contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"12px 16px"},labelStyle:{color:"var(--text-primary)",fontWeight:600,marginBottom:"8px"}},qa={labor:{label:"Labor",color:J.labor,icon:"HardHat"},disposal:{label:"Disposal",color:J.disposal,icon:"Trash2"},equipment:{label:"Equipment",color:J.equipment,icon:"Truck"},materials:{label:"Materials",color:J.materials,icon:"Package"},subcontractor:{label:"Subcontractor",color:J.subcontractor,icon:"Users"},other:{label:"Other",color:J.other,icon:"MoreHorizontal"}},Va=[{id:"7d",label:"7D",days:7},{id:"30d",label:"30D",days:30},{id:"90d",label:"90D",days:90},{id:"all",label:"All",days:null}],Ue=s=>s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(0)}K`:`$${s.toFixed(0)}`,Mt=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}),Jo={revenue:{id:"revenueGradient",color:J.revenue,startOpacity:.3,endOpacity:0},costs:{id:"costsGradient",color:J.costs,startOpacity:.3,endOpacity:0},tmValue:{id:"tmValueGradient",color:J.tmValue,startOpacity:.2,endOpacity:0}},Xo=o.memo(function({earnedRevenue:t=0,totalCosts:r=0,laborCost:a=0,disposalCost:n=0,equipmentCost:i=0,materialsCost:l=0,otherCost:d=0,contractValue:u=0}){const h=t-r,c=t>0?h/t*100:0,f=h>=0,x=p=>p>=1e6?`$${(p/1e6).toFixed(1)}M`:p>=1e3?`$${(p/1e3).toFixed(1)}K`:`$${p.toFixed(0)}`,j=[{key:"labor",value:a,color:J.labor,label:"Labor"},{key:"disposal",value:n,color:J.disposal,label:"Disposal"},{key:"equipment",value:i,color:J.equipment,label:"Equipment"},{key:"materials",value:l,color:J.materials,label:"Materials"},{key:"other",value:d,color:J.other,label:"Other"}].filter(p=>p.value>0),m=j.length>0&&r>0;return e.jsxs("div",{className:"overview-financial-card animate-fade-in-up",children:[e.jsxs("div",{className:"financial-metrics-row",children:[e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value green",children:x(t)}),e.jsx("span",{className:"financial-metric-label",children:"Earned"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value amber",children:x(r)}),e.jsx("span",{className:"financial-metric-label",children:"Costs"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsxs("span",{className:`financial-metric-value ${f?"green":"red"}`,children:[f?"":"-",x(Math.abs(h))]}),e.jsxs("span",{className:"financial-metric-label",children:["Profit",e.jsxs("span",{className:`margin-badge ${f?"positive":"negative"}`,children:[c>=0?"+":"",c.toFixed(0),"%"]})]})]})]}),m&&e.jsxs("div",{className:"cost-breakdown-section",children:[e.jsx("div",{className:"cost-breakdown-bar",children:j.map((p,N)=>{const D=p.value/r*100;return e.jsx("div",{className:"cost-segment",style:{width:`${D}%`,backgroundColor:p.color,animationDelay:`${N*100}ms`},title:`${p.label}: ${x(p.value)} (${D.toFixed(0)}%)`},p.key)})}),e.jsx("div",{className:"cost-breakdown-legend",children:j.slice(0,4).map(p=>e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot",style:{backgroundColor:p.color}}),e.jsx("span",{className:"legend-label",children:p.label})]},p.key))})]})]})}),Qo=()=>xe(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),$s={contract:J.contract,tm:J.costs},Ba=[{id:"7d",label:"7D",days:7},{id:"14d",label:"14D",days:14},{id:"30d",label:"30D",days:30}],Zo=o.memo(function({project:t,onShowToast:r}){const[a,n]=o.useState([]),[i,l]=o.useState([]),[d,u]=o.useState(new Date().toISOString().split("T")[0]),[h,c]=o.useState("14d"),[f,x]=o.useState(!0),[j,m]=o.useState(!1);o.useEffect(()=>{t?.id&&p()},[t?.id]);const p=async()=>{x(!0);try{const[A,V]=await Promise.all([W.getCrewCheckinHistory(t.id,365),W.getTMTickets(t.id)]);n(A||[]),l(V||[])}catch(A){console.error("Error loading crew metrics:",A)}finally{x(!1)}},N=o.useMemo(()=>{const A={};return i.forEach(V=>{const E=V.work_date;E&&(A[E]||(A[E]=new Set),(V.t_and_m_workers||[]).forEach(te=>{A[E].add(te.name.toLowerCase().trim())}))}),A},[i]),D=o.useMemo(()=>{const A={};return a.forEach(V=>{A[V.check_in_date]=V.workers||[]}),A},[a]),v=D[d]||[],T=N[d]||new Set,w=o.useMemo(()=>{const A=[],V=[];return v.forEach(E=>{T.has(E.name.toLowerCase().trim())?V.push(E):A.push(E)}),{total:v.length,contract:A,tm:V}},[v,T]),k=o.useMemo(()=>{const A=Ba.find(te=>te.id===h)?.days||14,V=[],E=new Date;for(let te=A-1;te>=0;te--){const z=new Date(E);z.setDate(z.getDate()-te);const de=z.toISOString().split("T")[0],ve=D[de]||[],me=N[de]||new Set;let De=0,$=0;ve.forEach(b=>{me.has(b.name.toLowerCase().trim())?$++:De++}),V.push({date:de,displayDate:Mt(de),contract:De,tm:$,total:ve.length})}return V},[D,N,h]),I=o.useCallback(A=>{const V=new Date(d+"T12:00:00");V.setDate(V.getDate()+A),u(V.toISOString().split("T")[0])},[d]),B=d===new Date().toISOString().split("T")[0],R=A=>new Date(A+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),_=o.useCallback(A=>{A?.date&&u(A.date)},[]),F=({active:A,payload:V,label:E})=>{if(!A||!V?.length)return null;const te=(V[0]?.value||0)+(V[1]?.value||0);return e.jsxs("div",{style:{...La.contentStyle,fontSize:"0.8rem"},children:[e.jsx("p",{style:{...La.labelStyle,fontSize:"0.85rem",marginBottom:6},children:E}),e.jsxs("p",{style:{margin:"3px 0",color:$s.contract},children:["Contract: ",e.jsx("strong",{children:V[0]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:$s.tm},children:["T&M: ",e.jsx("strong",{children:V[1]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:"var(--text-primary)",borderTop:"1px solid var(--border-color)",paddingTop:4},children:["Total: ",e.jsx("strong",{children:te})]})]})},L=o.useCallback(async()=>{m(!0),r?.("Generating crew report PDF...","info");try{const V=(await Qo()).default,E=new V,te=E.internal.pageSize.width;let z=20;E.setFontSize(18),E.setFont(void 0,"bold"),E.text("Crew On-Site Report",te/2,z,{align:"center"}),z+=8,E.setFontSize(11),E.setFont(void 0,"normal"),E.text(`Project: ${t.name}`,te/2,z,{align:"center"}),z+=6,E.text(`Date: ${R(d)}`,te/2,z,{align:"center"}),z+=12,E.setFontSize(12),E.setFont(void 0,"bold"),E.text("Selected Day Summary",14,z),z+=7,E.setFontSize(10),E.setFont(void 0,"normal"),E.text(`Total Crew On-Site: ${w.total}`,14,z),z+=5,E.text(`Contract Workers: ${w.contract.length}`,14,z),z+=5,E.text(`T&M Workers: ${w.tm.length}`,14,z),z+=10,w.contract.length>0&&(E.setFontSize(12),E.setFont(void 0,"bold"),E.text("Contract Workers",14,z),z+=7,E.setFontSize(9),E.setFont(void 0,"bold"),E.text("Name",14,z),E.text("Role",100,z),z+=5,E.setFont(void 0,"normal"),w.contract.forEach(me=>{z>270&&(E.addPage(),z=20),E.text(me.name,14,z),E.text(me.role||"—",100,z),z+=5}),z+=8),w.tm.length>0&&(z>240&&(E.addPage(),z=20),E.setFontSize(12),E.setFont(void 0,"bold"),E.text("T&M Workers (Extra Work)",14,z),z+=7,E.setFontSize(9),E.setFont(void 0,"bold"),E.text("Name",14,z),E.text("Role",100,z),z+=5,E.setFont(void 0,"normal"),w.tm.forEach(me=>{z>270&&(E.addPage(),z=20),E.text(me.name,14,z),E.text(me.role||"—",100,z),z+=5}),z+=8),z>200&&(E.addPage(),z=20),E.setFontSize(12),E.setFont(void 0,"bold"),E.text("Daily Timeline",14,z),z+=7,E.setFontSize(8),E.setFont(void 0,"bold"),E.text("Date",14,z),E.text("Total",70,z),E.text("Contract",95,z),E.text("T&M",125,z),z+=5,E.setFont(void 0,"normal"),k.forEach(me=>{z>275&&(E.addPage(),z=20),E.text(me.displayDate,14,z),E.text(String(me.total),70,z),E.text(String(me.contract),95,z),E.text(String(me.tm),125,z),z+=4.5});const de=E.internal.pageSize.height-10;E.setFontSize(8),E.setTextColor(128,128,128),E.text(`Generated ${new Date().toLocaleString()} — FieldSync`,te/2,de,{align:"center"});const ve=`${t.name}_Crew_Report_${d}.pdf`;E.save(ve),r?.("PDF exported!","success")}catch(A){console.error("Error exporting crew PDF:",A),r?.("Error generating PDF","error")}finally{m(!1)}},[t,d,w,k,r]);return f?e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsx("div",{className:"crew-metrics-header",children:e.jsxs("h3",{children:[e.jsx(Ie,{size:18})," Crew On-Site"]})}),e.jsxs("div",{className:"crew-metrics-loading",children:[e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"})]})]}):e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsxs("div",{className:"crew-metrics-header",children:[e.jsxs("h3",{children:[e.jsx(Ie,{size:18})," Crew On-Site"]}),e.jsx("div",{className:"crew-metrics-actions",children:e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:L,disabled:j,title:"Export crew report as PDF",children:[e.jsx(We,{size:14})," ",j?"Exporting...":"PDF"]})})]}),e.jsxs("div",{className:"crew-date-nav",children:[e.jsx("button",{className:"crew-date-btn",onClick:()=>I(-1),children:e.jsx(ur,{size:16})}),e.jsxs("span",{className:"crew-date-label",children:[e.jsx(Gs,{size:14}),B?"Today":R(d)]}),e.jsx("button",{className:"crew-date-btn",onClick:()=>I(1),disabled:B,children:e.jsx(ze,{size:16})})]}),e.jsxs("div",{className:"crew-stats-row",children:[e.jsxs("div",{className:"crew-stat total",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(Ie,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:w.total}),e.jsx("span",{className:"crew-stat-label",children:"Total On-Site"})]})]}),e.jsxs("div",{className:"crew-stat contract",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(He,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:w.contract.length}),e.jsx("span",{className:"crew-stat-label",children:"Contract"})]})]}),e.jsxs("div",{className:"crew-stat tm",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(gt,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:w.tm.length}),e.jsx("span",{className:"crew-stat-label",children:"T&M"})]})]})]}),w.total>0&&e.jsxs("div",{className:"crew-breakdown-bar",children:[e.jsx("div",{className:"crew-bar-segment contract",style:{width:`${w.contract.length/w.total*100}%`},title:`${w.contract.length} Contract`}),e.jsx("div",{className:"crew-bar-segment tm",style:{width:`${w.tm.length/w.total*100}%`},title:`${w.tm.length} T&M`})]}),w.total>0&&e.jsxs("div",{className:"crew-name-lists",children:[w.contract.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header contract",children:[e.jsx(He,{size:13}),e.jsxs("span",{children:["Contract (",w.contract.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:w.contract.map((A,V)=>e.jsxs("span",{className:"crew-name-tag contract",children:[A.name,A.role&&A.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:A.role})]},V))})]}),w.tm.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header tm",children:[e.jsx(gt,{size:13}),e.jsxs("span",{children:["T&M (",w.tm.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:w.tm.map((A,V)=>e.jsxs("span",{className:"crew-name-tag tm",children:[A.name,A.role&&A.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:A.role})]},V))})]})]}),e.jsxs("div",{className:"crew-timeline-section",children:[e.jsxs("div",{className:"crew-timeline-header",children:[e.jsx("span",{className:"crew-timeline-title",children:"Daily Breakdown"}),e.jsx("div",{className:"crew-time-range-pills",children:Ba.map(A=>e.jsx("button",{className:`crew-range-pill ${h===A.id?"active":""}`,onClick:()=>c(A.id),children:A.label},A.id))})]}),e.jsx("div",{className:"crew-chart-container",children:e.jsx(Pt,{width:"100%",height:140,children:e.jsxs(Li,{data:k,onClick:A=>A?.activePayload?.[0]&&_(A.activePayload[0].payload),style:{cursor:"pointer"},children:[e.jsx(ar,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(rr,{dataKey:"displayDate",tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:{stroke:"var(--border-color)"},tickLine:!1,interval:h==="30d"?4:h==="14d"?1:0}),e.jsx(nr,{tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:!1,tickLine:!1,allowDecimals:!1,width:30}),e.jsx(Rt,{content:e.jsx(F,{})}),e.jsx(Ys,{wrapperStyle:{fontSize:"0.75rem",paddingTop:4},iconType:"circle",iconSize:8}),e.jsx(ka,{dataKey:"contract",name:"Contract",stackId:"crew",fill:$s.contract,radius:[0,0,0,0]}),e.jsx(ka,{dataKey:"tm",name:"T&M (Extra Work)",stackId:"crew",fill:$s.tm,radius:[3,3,0,0]})]})})})]}),w.total===0&&e.jsx("div",{className:"crew-empty",children:e.jsx("p",{children:"No crew checked in for this date"})})]})}),ie=o.memo(function({width:t,height:r,borderRadius:a="8px",className:n="",variant:i="default"}){const d=(()=>{switch(i){case"text":return{height:"1em",borderRadius:"4px"};case"circular":return{borderRadius:"50%"};case"rectangular":return{borderRadius:"0"};default:return{borderRadius:a}}})();return e.jsx("div",{className:`skeleton ${n}`,style:{width:t||"100%",height:r||d.height||"1rem",borderRadius:d.borderRadius},"aria-hidden":"true"})});o.memo(function({showProgress:t=!1}){return e.jsxs("div",{className:"metric-skeleton",children:[e.jsx(ie,{width:"60%",height:"0.75rem",className:"skeleton-label"}),e.jsx(ie,{width:"80%",height:"1.75rem",className:"skeleton-value"}),t&&e.jsx(ie,{width:"100%",height:"6px",className:"skeleton-progress"})]})});const Vc=o.memo(function({lines:t=3,showHeader:r=!0,showAction:a=!1}){return e.jsxs("div",{className:"card-skeleton","aria-busy":"true","aria-label":"Loading content",children:[r&&e.jsxs("div",{className:"card-skeleton-header",children:[e.jsx(ie,{width:"40%",height:"1.25rem"}),a&&e.jsx(ie,{width:"80px",height:"32px"})]}),e.jsx("div",{className:"card-skeleton-body",children:Array.from({length:t}).map((n,i)=>e.jsx(ie,{width:`${100-i*15}%`,height:"1rem",className:"skeleton-line"},i))})]})});o.memo(function({count:t=3,showAvatar:r=!1,showAction:a=!1}){return e.jsx("div",{className:"list-skeleton","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:t}).map((n,i)=>e.jsxs("div",{className:"list-item-skeleton",children:[r&&e.jsx(ie,{width:"40px",height:"40px",variant:"circular"}),e.jsxs("div",{className:"list-item-skeleton-content",children:[e.jsx(ie,{width:"60%",height:"1rem"}),e.jsx(ie,{width:"40%",height:"0.75rem"})]}),a&&e.jsx(ie,{width:"60px",height:"28px"})]},i))})});o.memo(function(){return e.jsx("div",{className:"financial-row-skeleton","aria-busy":"true","aria-label":"Loading financial data",children:[1,2,3].map(t=>e.jsxs("div",{className:"financial-card-skeleton",children:[e.jsxs("div",{className:"financial-card-skeleton-header",children:[e.jsx(ie,{width:"24px",height:"24px",variant:"circular"}),e.jsx(ie,{width:"60%",height:"1rem"})]}),e.jsx(ie,{width:"50%",height:"2rem",className:"skeleton-hero-value"}),e.jsxs("div",{className:"financial-card-skeleton-details",children:[e.jsx(ie,{width:"100%",height:"0.875rem"}),e.jsx(ie,{width:"80%",height:"0.875rem"})]})]},t))})});o.memo(function({height:t="200px"}){return e.jsxs("div",{className:"chart-skeleton",style:{height:t},"aria-busy":"true","aria-label":"Loading chart",children:[e.jsx("div",{className:"chart-skeleton-bars",children:[40,65,45,80,55,70,50,75,60,85].map((r,a)=>e.jsx("div",{className:"chart-skeleton-bar",style:{height:`${r}%`}},a))}),e.jsx(ie,{width:"100%",height:"1px",className:"chart-skeleton-axis"})]})});const Ve=o.memo(function({count:t=3}){return e.jsx("div",{className:"ticket-skeleton-list","aria-busy":"true","aria-label":"Loading tickets",children:Array.from({length:t}).map((r,a)=>e.jsxs("div",{className:"ticket-skeleton-item",children:[e.jsxs("div",{className:"ticket-skeleton-header",children:[e.jsx(ie,{width:"100px",height:"0.875rem"}),e.jsx(ie,{width:"80px",height:"24px",borderRadius:"12px"})]}),e.jsx(ie,{width:"90%",height:"1rem"}),e.jsxs("div",{className:"ticket-skeleton-footer",children:[e.jsx(ie,{width:"60px",height:"0.75rem"}),e.jsx(ie,{width:"60px",height:"0.75rem"}),e.jsx(ie,{width:"60px",height:"0.75rem"})]})]},a))})}),ec=o.memo(function(){return e.jsx("div",{className:"hero-metrics-skeleton","aria-busy":"true","aria-label":"Loading metrics",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"hero-metric-skeleton",children:[e.jsx(ie,{width:"80px",height:"0.75rem",className:"skeleton-label"}),e.jsx(ie,{width:"120px",height:"1.75rem",className:"skeleton-value"}),e.jsx(ie,{width:"100%",height:"4px",className:"skeleton-bar"})]},t))})}),Dr=o.memo(function({title:t="Unable to load data",message:r="Something went wrong. Please try again.",error:a=null,onRetry:n=null,retryLabel:i="Try Again",variant:l="default",icon:d=null}){const h=d||(a?.message?.includes("network")||a?.message?.includes("offline")?sl:qs);return l==="compact"?e.jsxs("div",{className:"error-state error-state-compact",role:"alert",children:[e.jsx(h,{size:16,className:"error-state-icon","aria-hidden":"true"}),e.jsx("span",{className:"error-state-message",children:r}),n&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:n,"aria-label":i,children:e.jsx(ut,{size:14})})]}):l==="inline"?e.jsxs("div",{className:"error-state error-state-inline",role:"alert",children:[e.jsxs("div",{className:"error-state-content",children:[e.jsx(h,{size:20,className:"error-state-icon","aria-hidden":"true"}),e.jsxs("div",{className:"error-state-text",children:[e.jsx("span",{className:"error-state-title",children:t}),e.jsx("span",{className:"error-state-message",children:r})]})]}),n&&e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:n,children:[e.jsx(ut,{size:14})," ",i]})]}):e.jsxs("div",{className:"error-state",role:"alert","aria-live":"polite",children:[e.jsx("div",{className:"error-state-icon-wrapper",children:e.jsx(h,{size:32,className:"error-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"error-state-title",children:t}),e.jsx("p",{className:"error-state-message",children:r}),!1,n&&e.jsxs("button",{className:"btn btn-primary",onClick:n,children:[e.jsx(ut,{size:16})," ",i]})]})}),Wa=o.memo(function({title:t="No data yet",message:r="Items will appear here once added.",icon:a=null,action:n=null,actionLabel:i="Get Started",onAction:l=null}){return e.jsxs("div",{className:"empty-state",role:"status",children:[a&&e.jsx("div",{className:"empty-state-icon-wrapper",children:e.jsx(a,{size:32,className:"empty-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"empty-state-title",children:t}),e.jsx("p",{className:"empty-state-message",children:r}),l&&e.jsx("button",{className:"btn btn-primary btn-small",onClick:l,children:i}),n&&!l&&n]})});o.memo(function({label:t,error:r,required:a=!1,hint:n,children:i,className:l=""}){return e.jsxs("div",{className:`form-field ${r?"has-error":""} ${l}`,children:[t&&e.jsxs("label",{className:"form-field-label",children:[t,a&&e.jsx("span",{className:"form-field-required",children:"*"})]}),e.jsx("div",{className:"form-field-input",children:i}),r&&e.jsxs("div",{className:"form-field-error",role:"alert",children:[e.jsx(ys,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:r})]}),n&&!r&&e.jsx("div",{className:"form-field-hint",children:n})]})});o.memo(function({type:t="text",value:r,onChange:a,onBlur:n,error:i,placeholder:l,disabled:d,min:u,max:h,step:c,pattern:f,required:x,autoComplete:j,name:m,id:p,className:N="","aria-label":D,"aria-describedby":v}){const T=p||m,w=i?`${T}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:t,id:T,name:m,value:r,onChange:a,onBlur:n,placeholder:l,disabled:d,min:u,max:h,step:c,pattern:f,required:x,autoComplete:j,className:`validated-input ${i?"has-error":""} ${N}`,"aria-label":D,"aria-invalid":!!i,"aria-describedby":i?w:v}),i&&e.jsxs("div",{id:w,className:"input-error-inline",role:"alert",children:[e.jsx(ys,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:i})]})]})});o.memo(function({value:t,onChange:r,onBlur:a,error:n,disabled:i,required:l,name:d,id:u,className:h="",children:c,"aria-label":f}){const x=u||d,j=n?`${x}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("select",{id:x,name:d,value:t,onChange:r,onBlur:a,disabled:i,required:l,className:`validated-select ${n?"has-error":""} ${h}`,"aria-label":f,"aria-invalid":!!n,"aria-describedby":n?j:void 0,children:c}),n&&e.jsxs("div",{id:j,className:"input-error-inline",role:"alert",children:[e.jsx(ys,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:n})]})]})});o.memo(function({value:t,onChange:r,onBlur:a,error:n,placeholder:i,disabled:l,required:d,rows:u=3,maxLength:h,name:c,id:f,className:x="","aria-label":j}){const m=f||c,p=n?`${m}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("textarea",{id:m,name:c,value:t,onChange:r,onBlur:a,placeholder:i,disabled:l,required:d,rows:u,maxLength:h,className:`validated-textarea ${n?"has-error":""} ${x}`,"aria-label":j,"aria-invalid":!!n,"aria-describedby":n?p:void 0}),h&&e.jsxs("div",{className:"textarea-counter",children:[t?.length||0," / ",h]}),n&&e.jsxs("div",{id:p,className:"input-error-inline",role:"alert",children:[e.jsx(ys,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:n})]})]})});const sc=o.memo(function({count:t,label:r,variant:a="default",size:n="medium",pulse:i=!1,icon:l}){const[d,u]=o.useState(t),[h,c]=o.useState(!1);return o.useEffect(()=>{if(t!==d){c(!0);const f=setTimeout(()=>{c(!1),u(t)},400);return()=>clearTimeout(f)}},[t,d]),e.jsxs("span",{className:`count-badge count-badge-${a} count-badge-${n} ${i?"badge-new":""} ${h?"animate-count-up":""}`,title:r,children:[l&&e.jsx(l,{size:n==="small"?12:n==="large"?18:14}),e.jsx("span",{className:"count-badge-value",children:t}),r&&e.jsx("span",{className:"count-badge-label",children:r})]})}),tc=o.memo(function({value:t,max:r=100,showLabel:a=!1,size:n="medium",variant:i="default",animated:l=!0}){const d=Math.min(100,Math.max(0,t/r*100)),u=n==="small"?"4px":n==="large"?"8px":"6px",h=i==="default"?d>=80?"danger":d>=60?"warning":"success":i;return e.jsxs("div",{className:`mini-progress mini-progress-${n}`,children:[e.jsx("div",{className:"mini-progress-track",style:{height:u},children:e.jsx("div",{className:`mini-progress-fill mini-progress-${h} ${l?"progress-animate":""}`,style:{width:`${d}%`}})}),a&&e.jsxs("span",{className:"mini-progress-label",children:[Math.round(d),"%"]})]})}),ac=o.memo(function({value:t,previousValue:r,format:a="percent",inverted:n=!1,showValue:i=!0}){const l=t-r,d=r!==0?l/r*100:0;let u=l===0?"neutral":l>0?"up":"down",h="neutral";l!==0&&(n?h=l>0?"negative":"positive":h=l>0?"positive":"negative");const c=u==="up"?Tt:u==="down"?At:mr,f=()=>{const x=Math.abs(l);switch(a){case"percent":return`${Math.abs(d).toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(x);default:return x.toLocaleString()}};return e.jsxs("span",{className:`trend-indicator trend-${h}`,children:[e.jsx(c,{size:14}),i&&e.jsx("span",{className:"trend-value",children:f()})]})});o.memo(function({status:t="default",label:r,size:a="medium",pulse:n=!1}){return e.jsxs("span",{className:`status-dot-container status-dot-${a}`,children:[e.jsx("span",{className:`status-dot status-dot-${t} ${n?"status-dot-pulse":""}`}),r&&e.jsx("span",{className:"status-dot-label",children:r})]})});o.memo(function({data:t=[],width:r=80,height:a=24,strokeWidth:n=2,color:i="var(--accent-blue)",showArea:l=!0}){if(!t.length)return null;const d=Math.max(...t),u=Math.min(...t),h=d-u||1,c=t.map((x,j)=>{const m=j/(t.length-1)*r,p=a-(x-u)/h*(a-n*2)-n;return`${m},${p}`}).join(" "),f=`0,${a} ${c} ${r},${a}`;return e.jsxs("svg",{width:r,height:a,className:"sparkline",viewBox:`0 0 ${r} ${a}`,children:[l&&e.jsx("polygon",{points:f,fill:i,fillOpacity:"0.15"}),e.jsx("polyline",{points:c,fill:"none",stroke:i,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"})]})});o.memo(function({items:t=[]}){return e.jsx("div",{className:"quick-stats",children:t.map((r,a)=>e.jsxs("span",{className:"quick-stat-item",children:[r.icon&&e.jsx(r.icon,{size:12}),e.jsx("span",{className:"quick-stat-value",children:r.value}),r.label&&e.jsx("span",{className:"quick-stat-label",children:r.label})]},a))})});o.memo(function({status:t,label:r,size:a="medium"}){const n={success:hr,warning:qs,danger:qs,info:Vs,pending:Vs},i=n[t]||n.info;return e.jsxs("span",{className:`status-indicator status-indicator-${t} status-indicator-${a}`,children:[e.jsx(i,{size:a==="small"?12:a==="large"?18:14}),r&&e.jsx("span",{className:"status-indicator-label",children:r})]})});o.memo(function({current:t,previous:r,format:a="number",label:n,inverted:i=!1}){const l=t-r,d=i?l<0:l>0,u=i?l>0:l<0,h=c=>{switch(a){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(Math.abs(c));case"percent":return`${Math.abs(c).toFixed(1)}%`;default:return Math.abs(c).toLocaleString()}};return e.jsxs("div",{className:`metric-delta ${d?"positive":u?"negative":"neutral"}`,children:[e.jsx("span",{className:"metric-delta-arrow",children:l>0?"↑":l<0?"↓":"→"}),e.jsx("span",{className:"metric-delta-value",children:h(l)}),n&&e.jsx("span",{className:"metric-delta-label",children:n})]})});o.memo(function({value:t,max:r=100,size:a=40,strokeWidth:n=4,showValue:i=!0,color:l="var(--accent-blue)"}){const d=Math.min(100,Math.max(0,t/r*100)),u=(a-n)/2,h=u*2*Math.PI,c=h-d/100*h;return e.jsxs("div",{className:"circular-progress",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,viewBox:`0 0 ${a} ${a}`,children:[e.jsx("circle",{className:"circular-progress-track",cx:a/2,cy:a/2,r:u,fill:"none",strokeWidth:n}),e.jsx("circle",{className:"circular-progress-fill",cx:a/2,cy:a/2,r:u,fill:"none",stroke:l,strokeWidth:n,strokeDasharray:h,strokeDashoffset:c,strokeLinecap:"round",transform:`rotate(-90 ${a/2} ${a/2})`,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),i&&e.jsxs("span",{className:"circular-progress-value",children:[Math.round(d),"%"]})]})});o.memo(function({isOpen:t,onClose:r,title:a,children:n,size:i="medium",className:l="",showCloseButton:d=!0,closeOnOverlayClick:u=!0,closeOnEscape:h=!0,footer:c,ariaDescribedBy:f}){const x=o.useRef(null),j=o.useRef(null),m=o.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`);o.useEffect(()=>{if(t){j.current=document.activeElement;const v=setTimeout(()=>{x.current?.focus()},10);return()=>clearTimeout(v)}},[t]),o.useEffect(()=>{!t&&j.current&&j.current.focus()},[t]),o.useEffect(()=>{if(!t||!h)return;const v=T=>{T.key==="Escape"&&(T.preventDefault(),r())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[t,h,r]),o.useEffect(()=>{if(t){const v=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=v}}},[t]);const p=o.useCallback(v=>{if(v.key!=="Tab")return;const T=x.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!T||T.length===0)return;const w=T[0],k=T[T.length-1];v.shiftKey?document.activeElement===w&&(v.preventDefault(),k.focus()):document.activeElement===k&&(v.preventDefault(),w.focus())},[]),N=v=>{u&&v.target===v.currentTarget&&r()};if(!t)return null;const D={small:"modal-small",medium:"modal-medium",large:"modal-large",full:"modal-full"};return e.jsx("div",{className:"modal-overlay",onClick:N,role:"presentation",children:e.jsxs("div",{ref:x,className:`modal-content ${D[i]||""} ${l}`,role:"dialog","aria-modal":"true","aria-labelledby":a?m.current:void 0,"aria-describedby":f,tabIndex:-1,onKeyDown:p,onClick:v=>v.stopPropagation(),children:[a&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:m.current,children:a}),d&&e.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close modal",type:"button",children:e.jsx(Je,{size:20})})]}),e.jsx("div",{className:"modal-body",children:n}),c&&e.jsx("div",{className:"modal-footer",children:c})]})})});const hs=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Is=o.memo(function({icon:t,label:r,value:a,formattedValue:n,subLabel:i,progress:l,progressLabel:d,variant:u="default",trend:h,previousValue:c}){const f={default:"var(--accent-blue)",success:"var(--accent-green)",warning:"var(--accent-amber)",danger:"var(--accent-red)"};return e.jsxs("div",{className:"hero-metric-card hover-lift animate-fade-in-up",children:[e.jsxs("div",{className:"hero-metric-header",children:[e.jsx("div",{className:"hero-metric-icon",style:{color:f[u]},children:e.jsx(t,{size:18})}),e.jsx("span",{className:"hero-metric-label",children:r})]}),e.jsxs("div",{className:"hero-metric-value-row",children:[e.jsx("span",{className:`hero-metric-value hero-metric-${u}`,children:n}),h!==void 0&&c!==void 0&&e.jsx(ac,{value:a,previousValue:c,format:"currency",inverted:r.toLowerCase().includes("cost")})]}),i&&e.jsx("span",{className:"hero-metric-sublabel",children:i}),l!==void 0&&e.jsxs("div",{className:"hero-metric-progress",children:[e.jsx(tc,{value:l,max:100,size:"small",variant:u,showLabel:!0}),d&&e.jsx("span",{className:"hero-metric-progress-label",children:d})]})]})}),rc=o.memo(function({contractValue:t=0,earnedRevenue:r=0,totalCosts:a=0,profit:n=0,progress:i=0,corApprovedValue:l=0,loading:d=!1,previousData:u}){const h=t+l,c=r>0?n/r*100:0,f=r>0?a/r*100:0,x=h>0?r/h*100:0,j=h>0?a/h*100:0,m=o.useMemo(()=>c>=20?"success":c>=10?"warning":c<0?"danger":"default",[c]),p=o.useMemo(()=>f<=60?"success":f<=80?"warning":"danger",[f]);return d?e.jsx(ec,{}):e.jsxs("div",{className:"hero-metrics stagger-children",children:[e.jsx(Is,{icon:ps,label:"Contract Value",value:h,formattedValue:hs(h),subLabel:l>0?`+${hs(l)} CORs`:null,variant:"default"}),e.jsx(Is,{icon:Tt,label:"Earned Revenue",value:r,formattedValue:hs(r),progress:x,progressLabel:`${Math.round(x)}% of contract`,variant:"success",previousValue:u?.earnedRevenue,trend:u?r:void 0}),e.jsx(Is,{icon:pr,label:"Total Costs",value:a,formattedValue:hs(a),progress:j,progressLabel:`${Math.round(f)}% of revenue`,variant:p,previousValue:u?.totalCosts,trend:u?a:void 0}),e.jsx(Is,{icon:tl,label:"Profit",value:n,formattedValue:hs(n),subLabel:`${c>=0?"+":""}${c.toFixed(1)}% margin`,variant:m,previousValue:u?.profit,trend:u?n:void 0})]})}),Ua=[{id:"overview",label:"Overview",shortLabel:"Overview",icon:rl,description:"Metrics & trends",step:null},{id:"cors",label:"Change Orders",shortLabel:"CORs",icon:rs,description:"CORs & approvals",step:1},{id:"tickets",label:"T&M Tickets",shortLabel:"Tickets",icon:be,description:"Field data",step:2},{id:"billing",label:"Billing",shortLabel:"Billing",icon:pr,description:"Invoices & billing",step:3}],nc=o.memo(function({activeSection:t="overview",onSectionChange:r,collapsed:a=!1,onToggleCollapse:n,onMobileClose:i,stats:l={}}){const{corCount:d=0,ticketCount:u=0,corPending:h=0,ticketPending:c=0,billableCount:f=0,invoiceCount:x=0}=l,j=m=>m==="cors"&&d>0?{count:d,variant:h>0?"warning":"default",pending:h}:m==="tickets"&&u>0?{count:u,variant:c>0?"warning":"default",pending:c}:m==="billing"&&f>0?{count:f,variant:"success",pending:f}:null;return e.jsxs("nav",{className:`financials-nav ${a?"collapsed":""}`,"aria-label":"Financials sections",children:[i&&e.jsxs("div",{className:"financials-nav-mobile-header",children:[e.jsx("span",{className:"financials-nav-mobile-title",children:"Financials"}),e.jsx("button",{className:"financials-nav-mobile-close",onClick:i,"aria-label":"Close menu",children:e.jsx(Je,{size:20})})]}),e.jsxs("button",{className:"financials-nav-toggle",onClick:n,"aria-label":a?"Expand sidebar":"Collapse sidebar",title:a?"Expand sidebar":"Collapse sidebar",children:[a?e.jsx(al,{size:18}):e.jsx(ur,{size:18}),!a&&e.jsx("span",{children:"Collapse"})]}),e.jsx("div",{className:"financials-nav-items",children:Ua.map((m,p)=>{const N=t===m.id,D=m.icon,v=j(m.id),T=p<Ua.length-1&&m.step!==null;return e.jsxs("div",{className:"financials-nav-item-wrapper",children:[e.jsxs("button",{className:`financials-nav-item ${N?"active":""}`,onClick:()=>r?.(m.id),"aria-current":N?"page":void 0,title:`${m.label}${v?` (${v.count})`:""}`,children:[m.step&&!a&&e.jsx("span",{className:"financials-nav-step",children:m.step}),e.jsxs("div",{className:"financials-nav-icon",children:[e.jsx(D,{size:a?22:20}),v&&v.pending>0&&e.jsx("span",{className:"financials-nav-dot"})]}),a&&e.jsx("span",{className:"financials-nav-short-label",children:m.shortLabel}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"financials-nav-content",children:[e.jsx("span",{className:"financials-nav-label",children:m.label}),e.jsx("span",{className:"financials-nav-desc",children:m.description})]}),v&&e.jsx(sc,{count:v.count,size:"small",variant:v.variant}),e.jsx(ze,{size:16,className:"financials-nav-arrow"})]})]}),T&&!a&&e.jsx("div",{className:"financials-nav-connector",children:e.jsx("div",{className:"connector-line"})})]},m.id)})}),a&&e.jsxs("button",{className:"financials-nav-expand-btn",onClick:n,"aria-label":"Expand sidebar",children:[e.jsx(ze,{size:14}),e.jsx("span",{children:"Expand"})]})]})});function ic(s,t,r=[],a=null,n=[]){const i=t?.contract_value||0,l=s?.laborByDate||[],d=s?.haulOffByDate||[],u=s?.materialsEquipmentByDate||[],h=s?.customCosts||[],c=new Set;l.forEach(k=>c.add(k.date)),d.forEach(k=>c.add(k.date)),u.forEach(k=>c.add(k.date)),h.forEach(k=>{k.cost_date&&c.add(k.cost_date)}),r.forEach(k=>{k.work_date&&c.add(k.work_date),k.ticket_date&&c.add(k.ticket_date),k.created_at&&c.add(k.created_at.split("T")[0])}),n.forEach(k=>{k.status==="done"&&k.updated_at&&c.add(k.updated_at.split("T")[0])});const f=[...c].sort((k,I)=>new Date(k)-new Date(I));if(f.length===0)return[];const x={},j=n.reduce((k,I)=>k+(parseFloat(I.weight)||0),0);n.forEach(k=>{if(k.status==="done"&&k.updated_at){const I=k.updated_at.split("T")[0],B=parseFloat(k.weight)||0,R=k.scheduled_value?parseFloat(k.scheduled_value):j>0?B/j*i:0;x[I]||(x[I]=0),x[I]+=R}});let m=0,p=0;const N={};r.forEach(k=>{const I=k.work_date||k.ticket_date||k.created_at?.split("T")[0];if(!I)return;let B=0;const R=k.t_and_m_workers||k.workers||[];Array.isArray(R)&&R.forEach(F=>{const L=parseFloat(F.hours)||parseFloat(F.regular_hours)||0,A=parseFloat(F.overtime_hours)||0,V=parseFloat(F.regular_rate)||parseFloat(F.rate)||65,E=parseFloat(F.overtime_rate)||V*1.5;B+=L*V+A*E});const _=k.t_and_m_items||k.items||[];Array.isArray(_)&&_.forEach(F=>{const L=parseFloat(F.quantity)||1,A=parseFloat(F.unit_cost)||parseFloat(F.materials_equipment?.cost_per_unit)||0;B+=L*A}),N[I]||(N[I]=0),N[I]+=B});const D={};h.forEach(k=>{const I=k.cost_date;I&&(D[I]||(D[I]=0),D[I]+=parseFloat(k.amount)||0)});const v={};u.forEach(k=>{k.date&&(v[k.date]=k.cost||0)});let T=0;return f.map(k=>{const B=l.find(de=>de.date===k)?.cost||0,_=d.find(de=>de.date===k)?.cost||0,F=v[k]||0,L=D[k]||0,A=B+F+_+L;m+=A;const V=N[k]||0;p+=V;const E=x[k]||0;T+=E;const z=Object.keys(x).length>0?T:s?.billable||0;return{date:k,contract:i,revenue:Math.round(z),costs:Math.round(m),tmValue:Math.round(p),corValue:Math.round(a?.total_approved_value||0),profit:Math.round(z-m),dailyLabor:Math.round(B),dailyRevenue:Math.round(E),dailyMaterials:Math.round(F),dailyHaulOff:Math.round(_),dailyCustom:Math.round(L),dailyTM:Math.round(V),dailyTotal:Math.round(A)}})}function lc(s,t){if(!t||!s.length)return s;const r=new Date,a=new Date;return a.setDate(r.getDate()-t),s.filter(n=>new Date(n.date)>=a)}function oc(s=0,t=0,r=[]){const a=[];s>0&&a.push({name:"Labor",value:s,color:J.labor,category:"labor"}),t>0&&a.push({name:"Disposal",value:t,color:J.disposal,category:"disposal"});const n={};r.forEach(l=>{const d=l.category||"other";n[d]||(n[d]={items:[],total:0}),n[d].items.push(l),n[d].total+=parseFloat(l.amount)||0}),Object.entries(n).forEach(([l,d])=>{if(d.total>0){const u=qa[l]||qa.other;a.push({name:u.label,value:d.total,color:u.color,category:l,items:d.items})}});const i=a.reduce((l,d)=>l+d.value,0);return a.forEach(l=>{l.percentage=i>0?Math.round(l.value/i*100):0}),a.sort((l,d)=>d.value-l.value),a}function Ha(s,t){if(!s||s.length<2)return{direction:"flat",percentage:0};const r=s.slice(-7);if(r.length<2)return{direction:"flat",percentage:0};const a=r[0][t]||0,n=r[r.length-1][t]||0;if(a===0)return{direction:n>0?"up":"flat",percentage:0};const i=(n-a)/a*100;return{direction:i>5?"up":i<-5?"down":"flat",percentage:Math.abs(Math.round(i))}}function cc({active:s,payload:t,label:r}){if(!s||!t||!t.length)return null;const a=i=>i>=1e6?`$${(i/1e6).toFixed(2)}M`:i>=1e3?`$${(i/1e3).toFixed(1)}K`:`$${i.toFixed(0)}`,n=t[0]?.payload||{};return e.jsxs("div",{className:"chart-tooltip",children:[e.jsx("div",{className:"chart-tooltip-date",children:Mt(r)}),e.jsxs("div",{className:"chart-tooltip-rows",children:[n.contract!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:J.contract}}),"Contract"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(n.contract)})]}),n.revenue!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:J.revenue}}),"Revenue"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(n.revenue)})]}),n.costs!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:J.costs}}),"Costs"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(n.costs)})]}),n.tmValue!==void 0&&n.tmValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:J.tmValue}}),"T&M Value"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(n.tmValue)})]}),n.corValue!==void 0&&n.corValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:J.corValue}}),"COR Approved"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(n.corValue)})]}),n.profit!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:n.profit>=0?J.profit:J.loss}}),n.profit>=0?"Profit":"Loss"]}),e.jsx("span",{className:"chart-tooltip-value",style:{color:n.profit>=0?J.profit:J.loss},children:a(Math.abs(n.profit))})]})]}),(n.dailyRevenue>0||n.dailyLabor>0||n.dailyMaterials>0||n.dailyHaulOff>0||n.dailyTM>0)&&e.jsxs("div",{className:"chart-tooltip-daily",children:[e.jsx("div",{className:"chart-tooltip-daily-label",children:"Today's Activity"}),n.dailyRevenue>0&&e.jsx("div",{className:"chart-tooltip-daily-row earned",children:e.jsxs("span",{style:{color:J.revenue},children:["Areas Completed: ",a(n.dailyRevenue)]})}),n.dailyLabor>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Labor: ",a(n.dailyLabor)]}),n.dailyMaterials>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Materials: ",a(n.dailyMaterials)]}),n.dailyHaulOff>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Disposal: ",a(n.dailyHaulOff)]}),n.dailyTM>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["T&M Added: ",a(n.dailyTM)]}),n.dailyTotal>0&&e.jsx("div",{className:"chart-tooltip-daily-row total",children:e.jsxs("strong",{children:["Day Costs: ",a(n.dailyTotal)]})})]}),e.jsx("div",{className:"chart-tooltip-hint",children:"Click to see details"})]})}function dc({projectData:s,project:t,tmTickets:r=[],corStats:a=null,areas:n=[],onDrillDown:i}){const[l,d]=o.useState("30d"),[u,h]=o.useState(null),c=o.useMemo(()=>{const p=ic(s,t,r,a,n),N=Va.find(D=>D.id===l);return lc(p,N?.days)},[s,t,r,a,n,l]),f=o.useMemo(()=>Ha(c,"costs"),[c]),x=o.useMemo(()=>Ha(c,"revenue"),[c]),j=p=>{if(p?.activePayload?.[0]){const N=p.activePayload[0].payload;i?.(N.date,N)}},m=({trend:p})=>p.direction==="up"?e.jsx(Tt,{size:14,className:"trend-icon up"}):p.direction==="down"?e.jsx(At,{size:14,className:"trend-icon down"}):e.jsx(mr,{size:14,className:"trend-icon flat"});return c.length?e.jsxs("div",{className:"financial-trend-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[e.jsx("h3",{children:"Financial Trend"}),e.jsxs("div",{className:"chart-trend-indicators",children:[e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:J.revenue},children:"Revenue"}),e.jsx(m,{trend:x}),x.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[x.percentage,"%"]})]}),e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:J.costs},children:"Costs"}),e.jsx(m,{trend:f}),f.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[f.percentage,"%"]})]})]})]}),e.jsx("div",{className:"time-range-selector",children:Va.map(p=>e.jsx("button",{className:l===p.id?"active":"",onClick:()=>d(p.id),children:p.label},p.id))})]}),e.jsx("div",{className:"chart-container",children:e.jsx(Pt,{width:"100%",height:300,children:e.jsxs(bo,{data:c,onClick:j,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:Object.values(Jo).map(p=>e.jsxs("linearGradient",{id:p.id,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:p.color,stopOpacity:p.startOpacity}),e.jsx("stop",{offset:"95%",stopColor:p.color,stopOpacity:p.endOpacity})]},p.id))}),e.jsx(ar,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(rr,{dataKey:"date",tickFormatter:Mt,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(nr,{tickFormatter:Ue,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:!1,width:60}),e.jsx(Rt,{content:e.jsx(cc,{})}),e.jsx(Ys,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,formatter:p=>e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:p})}),c[0]?.contract>0&&e.jsx(fr,{y:c[0].contract,stroke:J.contract,strokeDasharray:"5 5",strokeWidth:2,label:{value:"Contract",position:"right",fill:J.contract,fontSize:11}}),e.jsx(xs,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:J.revenue,strokeWidth:2,fill:"url(#revenueGradient)",animationDuration:fs.duration,onMouseEnter:()=>h("revenue"),onMouseLeave:()=>h(null),style:{opacity:u&&u!=="revenue"?.3:1}}),e.jsx(xs,{type:"monotone",dataKey:"costs",name:"Costs",stroke:J.costs,strokeWidth:2,fill:"url(#costsGradient)",animationDuration:fs.duration,onMouseEnter:()=>h("costs"),onMouseLeave:()=>h(null),style:{opacity:u&&u!=="costs"?.3:1}}),c.some(p=>p.tmValue>0)&&e.jsx(xs,{type:"monotone",dataKey:"tmValue",name:"T&M Value",stroke:J.tmValue,strokeWidth:2,fill:"url(#tmValueGradient)",animationDuration:fs.duration,onMouseEnter:()=>h("tmValue"),onMouseLeave:()=>h(null),style:{opacity:u&&u!=="tmValue"?.3:1}}),c.some(p=>p.corValue>0)&&e.jsx(xs,{type:"monotone",dataKey:"corValue",name:"COR Approved",stroke:J.corValue,strokeWidth:2,strokeDasharray:"4 2",fill:"transparent",animationDuration:fs.duration,onMouseEnter:()=>h("corValue"),onMouseLeave:()=>h(null),style:{opacity:u&&u!=="corValue"?.3:1}})]})})}),e.jsxs("div",{className:"chart-quick-stats",children:[e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Current Revenue"}),e.jsx("span",{className:"stat-value",style:{color:J.revenue},children:Ue(c[c.length-1]?.revenue||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Total Costs"}),e.jsx("span",{className:"stat-value",style:{color:J.costs},children:Ue(c[c.length-1]?.costs||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Margin"}),e.jsx("span",{className:"stat-value",style:{color:(c[c.length-1]?.profit||0)>=0?J.profit:J.loss},children:(()=>{const p=c[c.length-1];return!p||!p.revenue?"0%":`${((p.revenue-p.costs)/p.revenue*100).toFixed(1)}%`})()})]}),c[c.length-1]?.tmValue>0&&e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"T&M Pending"}),e.jsx("span",{className:"stat-value",style:{color:J.tmValue},children:Ue(c[c.length-1]?.tmValue||0)})]})]})]}):e.jsx("div",{className:"financial-trend-chart empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No financial data available yet."}),e.jsx("span",{children:"Start tracking labor and costs to see trends."})]})})}function uc({laborCost:s=0,haulOffCost:t=0,customCosts:r=[],onSegmentClick:a}){const[n,i]=o.useState(null),l=o.useMemo(()=>oc(s,t,r),[s,t,r]),d=o.useMemo(()=>l.reduce((j,m)=>j+m.value,0),[l]),u=(j,m)=>{i(m)},h=()=>{i(null)},c=(j,m)=>{a&&a(l[m])},f=({active:j,payload:m})=>{if(!j||!m||!m.length)return null;const p=m[0].payload;return e.jsxs("div",{className:"chart-tooltip donut-tooltip",children:[e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:p.color}}),p.name]}),e.jsx("span",{className:"chart-tooltip-value",children:Ue(p.value)})]}),e.jsxs("div",{className:"donut-tooltip-pct",children:[p.percentage,"% of total costs"]}),p.items&&p.items.length>0&&e.jsx("div",{className:"donut-tooltip-items",children:e.jsxs("div",{className:"donut-tooltip-items-label",children:[p.items.length," item",p.items.length>1?"s":""]})}),a&&e.jsx("div",{className:"chart-tooltip-hint",children:"Click to view details"})]})},x=j=>{const{payload:m}=j;return e.jsx("div",{className:"donut-legend",children:m.map((p,N)=>e.jsxs("div",{className:`donut-legend-item ${n===N?"active":""}`,onMouseEnter:()=>i(N),onMouseLeave:()=>i(null),onClick:()=>c(null,N),children:[e.jsx("span",{className:"donut-legend-color",style:{backgroundColor:p.payload.color}}),e.jsx("span",{className:"donut-legend-name",children:p.value}),e.jsx("span",{className:"donut-legend-value",children:Ue(p.payload.value)})]},`legend-${N}`))})};return!l.length||d===0?e.jsx("div",{className:"cost-donut empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No cost data available."}),e.jsx("span",{children:"Add labor, disposal, or custom costs to see breakdown."})]})}):e.jsx("div",{className:"cost-donut",children:e.jsxs("div",{className:"donut-chart-container",children:[e.jsx(Pt,{width:"100%",height:200,children:e.jsxs(qi,{children:[e.jsx(Vi,{data:l,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",onMouseEnter:u,onMouseLeave:h,onClick:c,animationDuration:fs.duration,animationEasing:"ease-out",children:l.map((j,m)=>e.jsx(Bi,{fill:j.color,stroke:"var(--card-bg)",strokeWidth:2,style:{filter:n===m?"brightness(1.1)":"none",cursor:a?"pointer":"default",transform:n===m?"scale(1.05)":"scale(1)",transformOrigin:"center",transition:"all 0.2s ease"}},`cell-${m}`))}),e.jsx(Rt,{content:e.jsx(f,{})}),e.jsx(Ys,{content:x})]})}),e.jsxs("div",{className:"donut-center-label",children:[e.jsx("span",{className:"donut-center-value",children:Ue(d)}),e.jsx("span",{className:"donut-center-text",children:"Total"})]})]})})}const Be=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0);function mc({revenue:s,totalCosts:t,contractValue:r,progress:a}){const n=s-t,i=s>0?n/s*100:0,l=r,d=a>0?t/(a/100):t,u=l-d,h=l>0?u/l*100:0,c=i>=20,f=i>=0&&i<20,x=i<0,j=c?"healthy":f?"warning":"loss",m=c?"On Track":f?"Watch Margin":"Over Cost",p=c?nl:f?ys:At;return e.jsxs("div",{className:`profitability-card ${j}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${j}`,children:[e.jsx(p,{size:14}),e.jsx("span",{children:m})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${i<0?"negative":""}`,children:[Math.round(i),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${i<0?"negative":i<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(i),100)}%`}})})]}),a>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${h<0?"negative":""}`,children:[Math.round(h),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${h<0?"negative":h<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(h),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:Be(s)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",Be(t)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${n<0?"negative":"positive"}`,children:[n>=0?"":"-",Be(Math.abs(n))]})]})]}),a>10&&e.jsxs("div",{className:"profitability-insight",children:[c&&e.jsxs("p",{children:["At ",Math.round(a),"% complete, you're at ",Be(n)," profit.",u>0&&` Projected final profit: ${Be(u)}`]}),f&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",u<0&&` Trending toward ${Be(u)} loss.`]}),x&&e.jsxs("p",{children:["Currently over cost by ",Be(Math.abs(n)),". Immediate review recommended."]})]})]})}const ft=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),zs={labor:{label:"Labor",Icon:He,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Ke,color:"#10b981"},equipment:{label:"Equipment",Icon:gt,color:"#f59e0b"},materials:{label:"Materials",Icon:ll,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:Ie,color:"#ec4899"},other:{label:"Other",Icon:il,color:"#6b7280"}};function hc({laborCost:s=0,haulOffCost:t=0,customCosts:r=[],onAddCost:a,onDeleteCost:n}){const[i,l]=o.useState(!0),[d,u]=o.useState(null),h=[];s>0&&h.push({category:"labor",label:"Labor",amount:s,source:"auto",description:"From crew check-ins"}),t>0&&h.push({category:"disposal",label:"Disposal",amount:t,source:"auto",description:"From haul-off logs"});const c={};r.forEach(m=>{c[m.category]||(c[m.category]={category:m.category,items:[],total:0}),c[m.category].items.push(m),c[m.category].total+=parseFloat(m.amount)||0}),Object.values(c).forEach(m=>{const p=zs[m.category]||zs.other;h.push({category:m.category,label:p.label,amount:m.total,source:"manual",items:m.items})});const f=h.reduce((m,p)=>m+p.amount,0);h.forEach(m=>{m.percentage=f>0?m.amount/f*100:0}),h.sort((m,p)=>p.amount-m.amount);const x=m=>{u(d===m?null:m)},j=m=>{m.items&&m.items.length>0&&(l(!1),u(m.category))};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsxs("div",{className:"cost-contributors-title",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:ft(f)})]}),h.length>0&&e.jsxs("div",{className:"cost-view-toggle",children:[e.jsx("button",{className:i?"active":"",onClick:()=>l(!0),children:"Chart"}),e.jsx("button",{className:i?"":"active",onClick:()=>l(!1),children:"List"})]})]}),h.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):i?e.jsx(uc,{laborCost:s,haulOffCost:t,customCosts:r,onSegmentClick:j}):e.jsx("div",{className:"cost-breakdown",children:h.map(m=>{const p=zs[m.category]||zs.other,N=p.Icon,D=m.items&&m.items.length>0,v=d===m.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${D?"expandable":""}`,onClick:()=>D&&x(m.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(m.percentage,2)}%`,backgroundColor:p.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(N,{size:14,style:{color:p.color}}),e.jsx("span",{children:m.label}),m.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),D&&(v?e.jsx(Ot,{size:14}):e.jsx(ls,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:ft(m.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(m.percentage),"%"]})]})]})]}),v&&D&&e.jsx("div",{className:"cost-category-items",children:m.items.map(T=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:T.description}),e.jsx("span",{className:"cost-item-date",children:new Date(T.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:ft(T.amount)}),n&&e.jsx("button",{className:"cost-item-delete",onClick:w=>{w.stopPropagation(),confirm("Delete this cost entry?")&&n(T.id)},children:e.jsx(xr,{size:14})})]})]},T.id))})]},m.category)})}),a&&e.jsxs("button",{className:"cost-add-btn",onClick:a,children:[e.jsx(gs,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const Er=[{value:"concrete",label:"Concrete",icon:"🧱"},{value:"trash",label:"Trash",icon:"🗑️"},{value:"metals",label:"Metals",icon:"🔩"},{value:"hazardous_waste",label:"Hazardous",icon:"☣️"}],pc=s=>Er.find(t=>t.value===s)||{label:s,icon:"📦"};function xc({project:s,period:t="week"}){const[r,a]=o.useState([]),[n,i]=o.useState(!0),[l,d]=o.useState(!1);o.useEffect(()=>{s?.id&&u()},[s?.id,t]);const u=async()=>{try{i(!0);const m=t==="week"?7:t==="month"?30:14,p=await W.getDisposalLoadsHistory(s.id,m);a(p||[])}catch(m){console.error("Error loading disposal summary:",m)}finally{i(!1)}},h=r.reduce((m,p)=>{const N=p.load_type;return m[N]||(m[N]=0),m[N]+=p.load_count,m},{}),c=r.reduce((m,p)=>{const N=p.load_date||p.work_date;return m[N]||(m[N]={date:N,loads:[],total:0}),m[N].loads.push(p),m[N].total+=p.load_count,m},{}),f=Object.values(c).sort((m,p)=>new Date(p.date)-new Date(m.date)).slice(0,7),x=r.reduce((m,p)=>m+p.load_count,0),j=x>0;return n?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Ke,{size:18}),e.jsx("span",{children:"Disposal Loads"})]})}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Ke,{size:18}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("span",{className:"period-badge",children:t==="week"?"Last 7 days":t==="month"?"Last 30 days":"Last 14 days"})]}),j?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"disposal-total-value",children:x}),e.jsx("span",{className:"disposal-total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:Er.map(m=>{const p=h[m.value]||0;if(p===0)return null;const N=Math.round(p/x*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"disposal-type-info",children:[e.jsx("span",{className:"disposal-type-icon",children:m.icon}),e.jsx("span",{className:"disposal-type-label",children:m.label})]}),e.jsxs("div",{className:"disposal-type-stats",children:[e.jsx("span",{className:"disposal-type-count",children:p}),e.jsx("div",{className:"disposal-type-bar",children:e.jsx("div",{className:"disposal-type-bar-fill",style:{width:`${N}%`}})})]})]},m.value)})}),f.length>0&&e.jsxs("button",{className:"disposal-expand-btn",onClick:()=>d(!l),children:[l?e.jsx(Ot,{size:16}):e.jsx(ls,{size:16}),e.jsxs("span",{children:[l?"Hide":"View"," Daily Breakdown"]})]}),l&&f.length>0&&e.jsx("div",{className:"disposal-daily-breakdown",children:f.map(m=>{const p=new Date(m.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),N=m.loads.reduce((D,v)=>(D[v.load_type]||(D[v.load_type]=0),D[v.load_type]+=v.load_count,D),{});return e.jsxs("div",{className:"disposal-daily-row",children:[e.jsxs("div",{className:"disposal-daily-header",children:[e.jsx("span",{className:"disposal-daily-date",children:p}),e.jsxs("span",{className:"disposal-daily-total",children:[m.total," loads"]})]}),e.jsx("div",{className:"disposal-daily-types",children:Object.entries(N).map(([D,v])=>{const T=pc(D);return e.jsxs("span",{className:"disposal-daily-type",children:[T.icon," ",v]},D)})})]},m.date)})})]}):e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx(Ke,{size:32}),e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("span",{className:"text-muted",children:"Loads will appear here when logged by field crews"})]})]})}const vt=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",fc=o.memo(function({project:t,onAddEquipment:r,onEditEquipment:a,onShowToast:n}){const[i,l]=o.useState([]),[d,u]=o.useState(!0),[h,c]=o.useState(!0),[f,x]=o.useState(0),j=o.useCallback(async()=>{if(t?.id)try{u(!0);const v=await ss.getProjectEquipment(t.id);l(v||[]);const T=ss.calculateProjectEquipmentCost(v||[]);x(T)}catch(v){console.error("Error loading equipment:",v),n?.("Failed to load equipment","error")}finally{u(!1)}},[t?.id]);o.useEffect(()=>{j()},[j]);const m=o.useCallback(async v=>{try{await ss.markEquipmentReturned(v.id),n?.(`${v.equipment_name} marked as returned`,"success"),j()}catch(T){console.error("Error marking equipment returned:",T),n?.("Failed to update equipment","error")}},[j]),p=o.useCallback(async v=>{if(confirm(`Remove ${v.equipment_name} from this project?`))try{await ss.removeEquipmentFromProject(v.id),n?.("Equipment removed","success"),j()}catch(T){console.error("Error removing equipment:",T),n?.("Failed to remove equipment","error")}},[j]),N=o.useMemo(()=>i.filter(v=>!v.end_date),[i]),D=o.useMemo(()=>i.filter(v=>v.end_date),[i]);return e.jsxs("div",{className:"project-equipment-card",children:[e.jsxs("div",{className:"project-equipment-header",children:[e.jsxs("div",{className:"project-equipment-title",children:[e.jsx(Ke,{size:18}),e.jsx("h3",{children:"Equipment on Site"}),i.length>0&&e.jsxs("span",{className:"equipment-count",children:[N.length," active"]})]}),e.jsxs("div",{className:"project-equipment-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>r?.(),title:"Add equipment",children:[e.jsx(gs,{size:14}),e.jsx("span",{children:"Add"})]}),i.length>0&&e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>c(!h),children:h?e.jsx(Ot,{size:16}):e.jsx(ls,{size:16})})]})]}),d?e.jsx("div",{className:"equipment-loading",children:e.jsx("div",{className:"loading-spinner small"})}):i.length===0?e.jsxs("div",{className:"equipment-empty",children:[e.jsx("p",{children:"No equipment tracked on this project"}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>r?.(),children:[e.jsx(gs,{size:14}),"Track Equipment"]})]}):h?e.jsxs(e.Fragment,{children:[N.length>0&&e.jsx("div",{className:"equipment-list",children:N.map(v=>{const T=ss.calculateDaysOnSite(v.start_date,v.end_date),w=v.daily_rate*T;return e.jsxs("div",{className:"equipment-item active",children:[e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:v.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[e.jsx(Gs,{size:12}),"On-site since ",vt(v.start_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-rate",children:[we(v.daily_rate),"/day"]}),e.jsxs("span",{className:"equipment-days",children:[T," days"]}),e.jsx("span",{className:"equipment-total",children:we(w)})]})]}),e.jsxs("div",{className:"equipment-item-actions",children:[e.jsxs("button",{className:"btn btn-xs btn-outline",onClick:()=>m(v),title:"Mark as returned",children:[e.jsx(dr,{size:12}),"Returned"]}),e.jsx("button",{className:"btn btn-xs btn-ghost",onClick:()=>a?.(v),title:"Edit",children:e.jsx(ol,{size:12})}),e.jsx("button",{className:"btn btn-xs btn-ghost text-danger",onClick:()=>p(v),title:"Remove",children:e.jsx(xr,{size:12})})]})]},v.id)})}),D.length>0&&e.jsxs("details",{className:"equipment-returned-section",children:[e.jsx("summary",{className:"equipment-returned-toggle",children:e.jsxs("span",{children:["Returned Equipment (",D.length,")"]})}),e.jsx("div",{className:"equipment-list returned",children:D.map(v=>{const T=ss.calculateDaysOnSite(v.start_date,v.end_date),w=v.daily_rate*T;return e.jsx("div",{className:"equipment-item returned",children:e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:v.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[vt(v.start_date)," - ",vt(v.end_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-days",children:[T," days"]}),e.jsx("span",{className:"equipment-total",children:we(w)})]})]})},v.id)})})]}),e.jsxs("div",{className:"equipment-total-row",children:[e.jsx("span",{children:"Total Equipment Cost"}),e.jsx("span",{className:"equipment-grand-total",children:we(f)})]})]}):e.jsxs("div",{className:"equipment-summary-collapsed",children:[e.jsxs("span",{children:[N.length," active, ",D.length," returned"]}),e.jsx("span",{className:"equipment-grand-total",children:we(f)})]})]})}),vc=o.memo(function({project:t,areas:r=[],corStats:a={},onCreateDraw:n,onViewDraw:i,onShowToast:l}){const[d,u]=o.useState([]),[h,c]=o.useState(!0),f=o.useMemo(()=>r.reduce((w,k)=>{const I=(k.square_footage||0)*(k.price_per_sqft||0);return w+Math.round(I*100)},0),[r]),x=o.useMemo(()=>a?.approvedTotal||0,[a?.approvedTotal]),j=f+x,m=o.useCallback(async()=>{if(t?.id)try{c(!0);const w=await Wi.getProjectDrawRequests(t.id);u(w||[])}catch(w){console.error("Error loading draw requests:",w)}finally{c(!1)}},[t?.id]);o.useEffect(()=>{m()},[m]);const p=o.useMemo(()=>{const w=d.filter(R=>["submitted","approved","paid"].includes(R.status)),k=w.reduce((R,_)=>R+(_.previous_billings||0)+(_.current_billing||0),0),B=w[0]?.retention_held||0;return{billedToDate:k,retentionHeld:B}},[d]),N=j>0?Math.round(p.billedToDate/j*100):0,D=d.length>0?Math.max(...d.map(w=>w.draw_number))+1:1,v=w=>w?new Date(w).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",T=w=>{switch(w){case"draft":return e.jsx("span",{className:"badge badge-muted",children:"Draft"});case"submitted":return e.jsx("span",{className:"badge badge-warning",children:"Submitted"});case"approved":return e.jsx("span",{className:"badge badge-success",children:"Approved"});case"paid":return e.jsx("span",{className:"badge badge-info",children:"Paid"});case"rejected":return e.jsx("span",{className:"badge badge-danger",children:"Rejected"});default:return null}};return e.jsxs("div",{className:"progress-billing-card",children:[e.jsxs("div",{className:"progress-billing-header",children:[e.jsxs("div",{className:"progress-billing-title",children:[e.jsx(cl,{size:18}),e.jsx("h3",{children:"Progress Billing"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>n?.(),disabled:f===0,title:f===0?"Add areas with contract values first":`Create Draw #${D}`,children:[e.jsx(gs,{size:14}),e.jsxs("span",{children:["Draw #",D]})]})]}),e.jsxs("div",{className:"progress-billing-contract",children:[e.jsxs("div",{className:"contract-row",children:[e.jsx("span",{className:"contract-label",children:"Original Contract"}),e.jsx("span",{className:"contract-value",children:we(f)})]}),x>0&&e.jsxs("div",{className:"contract-row co",children:[e.jsx("span",{className:"contract-label",children:"Approved COs"}),e.jsxs("span",{className:"contract-value positive",children:["+",we(x)]})]}),e.jsxs("div",{className:"contract-row revised",children:[e.jsx("span",{className:"contract-label",children:"Revised Contract"}),e.jsx("span",{className:"contract-value",children:we(j)})]})]}),e.jsxs("div",{className:"progress-billing-status",children:[e.jsx("div",{className:"billing-progress-bar",children:e.jsx("div",{className:"billing-progress-fill",style:{width:`${Math.min(N,100)}%`}})}),e.jsxs("div",{className:"billing-stats",children:[e.jsxs("div",{className:"billing-stat",children:[e.jsx("span",{className:"billing-stat-value",children:we(p.billedToDate)}),e.jsxs("span",{className:"billing-stat-label",children:["Billed to Date (",N,"%)"]})]}),p.retentionHeld>0&&e.jsxs("div",{className:"billing-stat retention",children:[e.jsxs("span",{className:"billing-stat-value",children:["-",we(p.retentionHeld)]}),e.jsx("span",{className:"billing-stat-label",children:"Retention Held"})]}),e.jsxs("div",{className:"billing-stat remaining",children:[e.jsx("span",{className:"billing-stat-value",children:we(j-p.billedToDate)}),e.jsx("span",{className:"billing-stat-label",children:"Balance to Finish"})]})]})]}),h?e.jsx("div",{className:"progress-billing-loading",children:e.jsx("div",{className:"loading-spinner small"})}):d.length===0?e.jsxs("div",{className:"progress-billing-empty",children:[e.jsx("p",{children:"No draw requests yet"}),f>0&&e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>n?.(),children:[e.jsx(gs,{size:14}),"Create First Draw Request"]})]}):e.jsxs("div",{className:"progress-billing-draws",children:[e.jsx("div",{className:"draws-header",children:e.jsx("span",{children:"Recent Draws"})}),e.jsx("div",{className:"draws-list",children:d.slice(0,3).map(w=>e.jsxs("button",{className:"draw-item",onClick:()=>i?.(w),children:[e.jsxs("div",{className:"draw-item-info",children:[e.jsxs("span",{className:"draw-number",children:["Draw #",w.draw_number]}),e.jsx("span",{className:"draw-date",children:v(w.period_end||w.created_at)})]}),e.jsx("div",{className:"draw-item-amount",children:we(w.current_billing||0)}),T(w.status),e.jsx(ze,{size:16,className:"draw-item-arrow"})]},w.id))}),d.length>3&&e.jsxs("button",{className:"btn btn-sm btn-ghost view-all-draws",children:["View all ",d.length," draws"]})]})]})});function jc({project:s,company:t,onShowToast:r}){const[a,n]=o.useState(null),[i,l]=o.useState(!0),[d,u]=o.useState(!1);o.useEffect(()=>{if(s?.id&&t?.id){h();const m=W.subscribeToCrewCheckins?.(s.id,()=>{h()});return()=>{m&&W.unsubscribe?.(m)}}},[s?.id,t?.id]);const h=async()=>{try{const m=await W.calculateManDayCosts(s.id,t.id,s.work_type||"demolition",s.job_type||"standard");n(m)}catch(m){console.error("Error loading man day costs:",m)}finally{l(!1)}},c=m=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),f=m=>new Date(m).toLocaleDateString("en-US",{month:"short",day:"numeric"}),x=m=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[m]||m.charAt(0).toUpperCase()+m.slice(1);if(i)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!a||a.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(He,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const j=Object.entries(a.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>u(!d),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:c(a.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:d?"▼ Collapse":"▶ Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:c(a.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.daysWorked>0?c(a.totalCost/a.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),d&&e.jsxs("div",{className:"man-day-details",children:[j.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:j.map(([m,p])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:x(m)}),e.jsxs("span",{className:"role-rate",children:[c(p.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[p.count," days"]}),e.jsx("span",{className:"role-cost",children:c(p.cost)})]})]},m))})]}),a.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:a.byDate.slice(0,7).map((m,p)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:f(m.date)}),e.jsxs("span",{className:"date-workers",children:[m.workers," crew"]}),e.jsx("span",{className:"date-cost",children:c(m.cost)})]},p))}),a.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",a.byDate.length-7," more days"]})]})]})]})}const gc=()=>xe(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]);function Pr({project:s,company:t,onShowToast:r}){const{branding:a}=ir(),[n,i]=o.useState([]),[l,d]=o.useState(!0),[u,h]=o.useState(null),[c,f]=o.useState(null),[x,j]=o.useState(new Set),[m,p]=o.useState(!1),[N,D]=o.useState("recent"),[v,T]=o.useState(new Set),[w,k]=o.useState({start:"",end:""});o.useEffect(()=>{I();const b=W.subscribeToDailyReports?.(s.id,()=>{I()});return()=>{b&&W.unsubscribe?.(b)}},[s.id]);const I=o.useCallback(async()=>{try{h(null);const b=await W.getDailyReports(s.id,365);i(b||[])}catch(b){console.error("Error loading daily reports:",b),h(b),r?.("Error loading daily reports","error")}finally{d(!1)}},[s.id]),B=o.useMemo(()=>{let b=[...n];if(w.start){const C=new Date(w.start);C.setHours(0,0,0,0),b=b.filter(K=>new Date(K.report_date||K.created_at)>=C)}if(w.end){const C=new Date(w.end);C.setHours(23,59,59,999),b=b.filter(K=>new Date(K.report_date||K.created_at)<=C)}if(N==="recent"){const C=new Date;C.setDate(C.getDate()-7),C.setHours(0,0,0,0),b=b.filter(K=>new Date(K.report_date||K.created_at)>=C)}return b},[n,N,w]),R=o.useMemo(()=>{if(N!=="all")return null;const b={};return B.forEach(C=>{const K=new Date(C.report_date||C.created_at),P=`${K.getFullYear()}-${String(K.getMonth()+1).padStart(2,"0")}`,Q=K.toLocaleDateString("en-US",{month:"long",year:"numeric"});b[P]||(b[P]={label:Q,reports:[]}),b[P].reports.push(C)}),Object.entries(b).sort((C,K)=>K[0].localeCompare(C[0]))},[B,N]);o.useEffect(()=>{if(R&&R.length>0){const b=R[0][0];T(new Set([b]))}},[R]);const _=()=>{p(!m),m&&j(new Set)},F=b=>{const C=new Set(x);C.has(b)?C.delete(b):C.add(b),j(C)},L=()=>{x.size===B.length?j(new Set):j(new Set(B.map(b=>b.id)))},A=b=>{const C=new Set(v);C.has(b)?C.delete(b):C.add(b),T(C)},V=()=>x.size>0?B.filter(b=>x.has(b.id)):B,E=b=>new Date(b).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),te=b=>new Date(b).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),z=b=>{switch(b){case"submitted":return"✓";case"reviewed":return"✓✓";case"draft":return"○";default:return"○"}},de=b=>{switch(b){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return b}},ve=async()=>{const b=V();if(b.length===0){r?.("No reports to export","error");return}r?.("Generating PDF...","info");const K=(await gc()).default,P=new K,Q=P.internal.pageSize.getWidth(),ee=20;let re=ee;const je=vs(a?.primary_color||"#3B82F6"),Xe=vs(a?.secondary_color||"#1E40AF");P.setFillColor(...je),P.rect(0,0,Q,45,"F"),P.setFillColor(...Xe),P.rect(0,42,Q,3,"F");let Ee=ee;if(a?.logo_url)try{const ae=await lr(a.logo_url);ae&&(P.addImage(ae,"PNG",ee,7,30,30),Ee=ee+40)}catch(ae){console.error("Error adding logo:",ae)}P.setTextColor(255,255,255),P.setFontSize(22),P.setFont("helvetica","bold"),P.text(t?.name||"Company Name",Ee,20),P.setFontSize(10),P.setFont("helvetica","normal"),P.text("DAILY REPORTS SUMMARY",Ee,30),P.setFontSize(9),P.text(`Generated: ${new Date().toLocaleDateString()}`,Q-ee,20,{align:"right"}),s.job_number&&P.text(`Job #: ${s.job_number}`,Q-ee,28,{align:"right"}),re=55,P.setFillColor(248,250,252),P.rect(ee,re-5,Q-ee*2,20,"F"),P.setTextColor(...je),P.setFontSize(14),P.setFont("helvetica","bold"),P.text(`Project: ${s.name}`,ee+5,re+7),P.setFontSize(10),P.setTextColor(100,100,100),P.text(`${b.length} Report${b.length!==1?"s":""}`,Q-ee-5,re+7,{align:"right"}),re+=25,b.forEach((ae,Pe)=>{re>250&&(P.addPage(),re=ee),P.setFillColor(...je),P.setTextColor(255,255,255),P.rect(ee,re,Q-ee*2,10,"F"),P.setFontSize(11),P.setFont("helvetica","bold"),P.text(E(ae.report_date||ae.created_at),ee+5,re+7),P.text(de(ae.status),Q-ee-5,re+7,{align:"right"}),re+=15,P.setTextColor(50,50,50),P.setFontSize(10),P.setFont("helvetica","normal");const Qs=`Crew: ${ae.crew_count||0}  |  Tasks: ${ae.tasks_completed||0}  |  T&M: ${ae.tm_tickets_count||0}  |  Photos: ${ae.photos_count||0}`;if(P.text(Qs,ee+5,re),re+=8,ae.crew_list?.length>0){P.setFont("helvetica","bold"),P.text("Crew:",ee+5,re),P.setFont("helvetica","normal");const ke=ae.crew_list.map(cs=>`${cs.name} (${cs.role})`).join(", "),Cs=P.splitTextToSize(ke,Q-ee*2-30);P.text(Cs,ee+25,re),re+=Cs.length*5+3}if(ae.field_notes){P.setFont("helvetica","bold"),P.text("Notes:",ee+5,re),P.setFont("helvetica","normal");const ke=P.splitTextToSize(ae.field_notes,Q-ee*2-30);P.text(ke,ee+25,re),re+=ke.length*5+3}if(ae.issues){P.setTextColor(180,50,50),P.setFont("helvetica","bold"),P.text("Issues:",ee+5,re),P.setFont("helvetica","normal");const ke=P.splitTextToSize(ae.issues,Q-ee*2-30);P.text(ke,ee+25,re),P.setTextColor(50,50,50),re+=ke.length*5+3}re+=10});const se=P.internal.getNumberOfPages();for(let ae=1;ae<=se;ae++)P.setPage(ae),P.setFontSize(8),P.setTextColor(150,150,150),P.text(`Page ${ae} of ${se}`,Q/2,P.internal.pageSize.getHeight()-10,{align:"center"});const Ae=`${s.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;P.save(Ae),r?.("PDF exported!","success")},me=b=>e.jsxs("div",{className:`daily-report-card ${b.status} ${x.has(b.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>f(c===b.id?null:b.id),children:[m&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:x.has(b.id),onChange:C=>{C.stopPropagation(),F(b.id)},onClick:C=>C.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:E(b.report_date||b.created_at)}),e.jsxs("span",{className:`report-status ${b.status}`,children:[z(b.status)," ",de(b.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[b.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[b.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:c===b.id?"▼":"▶"})]})]}),c===b.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),b.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:b.crew_list.map((C,K)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:C.name}),e.jsx("span",{className:"crew-role",children:C.role})]},K))})]}),b.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:b.completed_tasks.map((C,K)=>e.jsxs("li",{children:[C.name,C.group&&e.jsx("span",{className:"task-group",children:C.group})]},K))})]}),b.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:b.field_notes})]}),b.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:b.issues})]}),b.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",b.submitted_by||"Field"," at ",te(b.submitted_at)]})})]})]},b.id);if(l)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});if(u)return e.jsx("div",{className:"daily-reports-list card",children:e.jsx(Dr,{title:"Unable to load reports",message:"There was a problem loading daily reports. Please try again.",error:u,onRetry:I})});const De=n.length,$=B.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${m?"btn-primary":"btn-secondary"}`,onClick:_,children:m?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:ve,children:["PDF",x.size>0?` (${x.size})`:""]})]})})]}),n.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${N==="recent"?"active":""}`,onClick:()=>D("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${N==="all"?"active":""}`,onClick:()=>D("all"),children:["All (",De,")"]})]}),N==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Gs,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:w.start,onChange:b=>k(C=>({...C,start:b.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:w.end,onChange:b=>k(C=>({...C,end:b.target.value})),className:"date-input"}),(w.start||w.end)&&e.jsx("button",{className:"date-clear",onClick:()=>k({start:"",end:""}),children:"Clear"})]})]}),m&&B.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:x.size===B.length&&B.length>0,onChange:L}),"Select All (",B.length,")"]}),x.size>0&&e.jsxs("span",{className:"selected-count",children:[x.size," selected"]})]}),n.length===0?e.jsx(Wa,{icon:be,title:"No daily reports yet",message:"Reports from the field will appear here"}):B.length===0?e.jsx(Wa,{icon:be,title:"No reports in this time period",message:N==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"}):N==="recent"?e.jsxs("div",{className:"daily-reports",children:[B.map(b=>me(b)),De>$&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>D("all"),children:["View All ",De," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:R?.map(([b,{label:C,reports:K}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>A(b),children:[v.has(b)?e.jsx(ls,{size:18,className:"month-chevron"}):e.jsx(ze,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:C}),e.jsxs("span",{className:"month-count",children:[K.length," report",K.length!==1?"s":""]})]}),v.has(b)&&e.jsx("div",{className:"month-reports",children:K.map(P=>me(P))})]},b))})]})}const bc=Object.freeze(Object.defineProperty({__proto__:null,default:Pr},Symbol.toStringTag,{value:"Module"})),Ka=o.memo(function({report:t,formatDate:r,formatTime:a,getInjuryTypeColor:n,getInjuryTypeLabel:i,getStatusColor:l,onViewDetails:d}){const u=()=>d(t),h=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),d(t))};return e.jsxs("div",{className:"report-card",onClick:u,onKeyDown:h,role:"button",tabIndex:0,"aria-label":`Injury report for ${t.employee_name} on ${r(t.incident_date)}`,children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[r(t.incident_date)," at ",a(t.incident_time)]}),e.jsx("div",{className:"employee-name",children:t.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:n(t.injury_type)},children:i(t.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:l(t.status)},children:t.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",t.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",t.reported_by_name," (",t.reported_by_title,")"]}),t.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",t.body_part_affected]}),t.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[t.incident_description.substring(0,150),t.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]})}),yc=()=>xe(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]);function Rr({project:s,companyId:t,company:r,user:a,onShowToast:n}){const{branding:i}=ir(),[l,d]=o.useState([]),[u,h]=o.useState(null),[c,f]=o.useState(!1),[x,j]=o.useState(!0),[m,p]=o.useState(null),[N,D]=o.useState(null),[v,T]=o.useState("recent"),[w,k]=o.useState(new Set),[I,B]=o.useState({start:"",end:""});o.useEffect(()=>{R();const $=t||s?.company_id,b=$?W.subscribeToInjuryReports?.($,()=>{R()}):null;return()=>{b&&W.unsubscribe?.(b)}},[s?.id,t]);const R=o.useCallback(async()=>{j(!0),p(null);try{const $=s?await W.getInjuryReports(s.id):await W.getCompanyInjuryReports(t);d($)}catch($){console.error("Error loading injury reports:",$),p($),D({type:"error",message:"Failed to load injury reports"})}finally{j(!1)}},[s?.id,t]),_=()=>{R(),f(!1),D({type:"success",message:"Injury report created successfully"})},F=$=>{h($)},L=()=>{h(null)},A=$=>$?new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",V=$=>$?new Date(`2000-01-01T${$}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",E=$=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[$]||$,te=$=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[$]||"#9ca3af",z=$=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[$]||"#9ca3af",de=o.useMemo(()=>{let $=[...l];if(I.start){const b=new Date(I.start);b.setHours(0,0,0,0),$=$.filter(C=>new Date(C.incident_date)>=b)}if(I.end){const b=new Date(I.end);b.setHours(23,59,59,999),$=$.filter(C=>new Date(C.incident_date)<=b)}if(v==="recent"){const b=new Date;b.setDate(b.getDate()-7),b.setHours(0,0,0,0),$=$.filter(C=>new Date(C.incident_date)>=b)}return $},[l,v,I]),ve=o.useMemo(()=>{if(v!=="all")return null;const $={};return de.forEach(b=>{const C=new Date(b.incident_date),K=`${C.getFullYear()}-${String(C.getMonth()+1).padStart(2,"0")}`,P=C.toLocaleDateString("en-US",{month:"long",year:"numeric"});$[K]||($[K]={label:P,reports:[]}),$[K].reports.push(b)}),Object.entries($).sort((b,C)=>C[0].localeCompare(b[0]))},[de,v]);o.useEffect(()=>{if(ve&&ve.length>0){const $=ve[0][0];k(new Set([$]))}},[ve]);const me=$=>{const b=new Set(w);b.has($)?b.delete($):b.add($),k(b)},De=async()=>{if(l.length===0){D({type:"error",message:"No reports to export"});return}D({type:"info",message:"Generating PDF..."});const b=(await yc()).default,C=new b,K=C.internal.pageSize.getWidth(),P=20;let Q=P;const ee=vs(i?.primary_color||"#3B82F6"),re=vs(i?.secondary_color||"#1E40AF");C.setFillColor(...ee),C.rect(0,0,K,45,"F"),C.setFillColor(...re),C.rect(0,42,K,3,"F");let je=P;if(i?.logo_url)try{const se=await lr(i.logo_url);se&&(C.addImage(se,"PNG",P,7,30,30),je=P+40)}catch(se){console.error("Error adding logo:",se)}C.setTextColor(255,255,255),C.setFontSize(22),C.setFont("helvetica","bold"),C.text(r?.name||"Company",je,20),C.setFontSize(10),C.setFont("helvetica","normal"),C.text("INJURY & INCIDENT REPORTS",je,30),C.setFontSize(9),C.text(`Generated: ${new Date().toLocaleDateString()}`,K-P,20,{align:"right"}),C.text(`Total Reports: ${l.length}`,K-P,28,{align:"right"}),Q=55,s&&(C.setFillColor(248,250,252),C.rect(P,Q-5,K-P*2,15,"F"),C.setTextColor(...ee),C.setFontSize(12),C.setFont("helvetica","bold"),C.text(`Project: ${s.name}`,P+5,Q+5),Q+=20),l.forEach(se=>{Q>200&&(C.addPage(),Q=P);const Ae=vs(z(se.injury_type));C.setFillColor(...Ae),C.rect(P,Q,K-P*2,12,"F"),C.setTextColor(255,255,255),C.setFontSize(11),C.setFont("helvetica","bold"),C.text(`${se.employee_name} - ${E(se.injury_type)}`,P+5,Q+8),C.text(A(se.incident_date),K-P-5,Q+8,{align:"right"}),Q+=17,C.setTextColor(50,50,50),C.setFontSize(9),C.setFont("helvetica","normal"),C.text(`Location: ${se.incident_location}`,P+5,Q),se.incident_time&&C.text(`Time: ${V(se.incident_time)}`,P+100,Q),Q+=6,C.setFont("helvetica","bold"),C.text("Description:",P+5,Q),C.setFont("helvetica","normal"),Q+=5;const ae=C.splitTextToSize(se.incident_description,K-P*2-10);C.text(ae,P+5,Q),Q+=ae.length*4+3;const Pe=[];se.body_part_affected&&Pe.push(`Body Part: ${se.body_part_affected}`),se.osha_recordable&&Pe.push("OSHA Recordable"),se.workers_comp_claim&&Pe.push("Workers' Comp Filed"),se.medical_treatment_required&&Pe.push("Medical Treatment Required"),Pe.length>0&&(C.setFontSize(8),C.setTextColor(100,100,100),C.text(Pe.join("  |  "),P+5,Q),Q+=5),C.setFontSize(8),C.text(`Reported by: ${se.reported_by_name} (${se.reported_by_title})`,P+5,Q),Q+=12});const Xe=C.internal.getNumberOfPages();for(let se=1;se<=Xe;se++)C.setPage(se),C.setFontSize(8),C.setTextColor(150,150,150),C.text(`Page ${se} of ${Xe}`,K/2,C.internal.pageSize.getHeight()-10,{align:"center"}),C.text("CONFIDENTIAL - Injury Report",P,C.internal.pageSize.getHeight()-10);const Ee=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;C.save(Ee),D({type:"success",message:"PDF exported!"})};return x?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):m?e.jsx("div",{className:"injury-reports-section card",children:e.jsx(Dr,{title:"Unable to load reports",message:"There was a problem loading injury reports. Please try again.",error:m,onRetry:R})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[l.length>0&&e.jsx("button",{className:"btn-secondary",onClick:De,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>f(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${v==="recent"?"active":""}`,onClick:()=>{T("recent"),B({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${v==="all"?"active":""}`,onClick:()=>T("all"),children:["All (",l.length,")"]})]}),v==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Gs,{size:16}),e.jsx("input",{type:"date",value:I.start,onChange:$=>B(b=>({...b,start:$.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:I.end,onChange:$=>B(b=>({...b,end:$.target.value})),placeholder:"End date"}),(I.start||I.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>B({start:"",end:""}),children:"Clear"})]})]}),de.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:"🏥"}),e.jsxs("h4",{children:["No Injury Reports",v==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),v==="recent"&&l.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>T("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:v==="all"&&ve?ve.map(([$,b])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>me($),children:e.jsxs("div",{className:"month-header-left",children:[w.has($)?e.jsx(ls,{size:18}):e.jsx(ze,{size:18}),e.jsx("span",{className:"month-label",children:b.label}),e.jsxs("span",{className:"month-count",children:[b.reports.length," reports"]})]})}),w.has($)&&e.jsx("div",{className:"month-reports",children:b.reports.map(C=>e.jsx(Ka,{report:C,formatDate:A,formatTime:V,getInjuryTypeColor:z,getInjuryTypeLabel:E,getStatusColor:te,onViewDetails:F},C.id))})]},$)):de.map($=>e.jsx(Ka,{report:$,formatDate:A,formatTime:V,getInjuryTypeColor:z,getInjuryTypeLabel:E,getStatusColor:te,onViewDetails:F},$.id))}),u&&e.jsx("div",{className:"modal-overlay",onClick:L,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:$=>$.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:L,children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[A(u.incident_date)," at ",V(u.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:u.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:z(u.injury_type)},children:E(u.injury_type)})})]}),u.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:u.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:u.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:u.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:u.employee_job_title})]}),u.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:u.employee_phone})]}),u.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:u.employee_email})]}),u.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:u.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:u.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:u.reported_by_title})]}),u.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:u.reported_by_phone})]}),u.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:u.reported_by_email})]})]})]}),u.witnesses&&u.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),u.witnesses.map(($,b)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:$.name}),$.phone&&e.jsxs("span",{children:[" • ",$.phone]}),$.email&&e.jsxs("span",{children:[" • ",$.email]})]}),$.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',$.testimony,'"']})})]},b))]}),u.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[u.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:u.medical_facility_name})]}),u.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:u.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:u.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),u.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:u.immediate_actions_taken})]}),u.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:u.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[u.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:u.safety_equipment_used})]}),u.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:u.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:u.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:u.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:u.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:u.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",A(u.created_at)]})]})]})}),c&&e.jsx(Ui,{project:s,companyId:t,user:a,onClose:()=>f(!1),onReportCreated:_}),N&&e.jsx(Hi,{message:N.message,type:N.type,onClose:()=>D(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const Nc=Object.freeze(Object.defineProperty({__proto__:null,default:Rr},Symbol.toStringTag,{value:"Module"})),Ga=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function wc({project:s,company:t,user:r,isAdmin:a,onShowToast:n}){const[i,l]=o.useState([]),[d,u]=o.useState([]),[h,c]=o.useState(!0),[f,x]=o.useState(!1),[j,m]=o.useState(""),[p,N]=o.useState("Team Member"),[D,v]=o.useState(null);o.useEffect(()=>{s?.id&&T()},[s?.id]),o.useEffect(()=>{f&&t?.id&&w()},[f,t?.id]);const T=async()=>{try{c(!0);const R=await W.getProjectTeam(s.id);l(R)}catch(R){console.error("Error loading project team:",R)}finally{c(!1)}},w=async()=>{try{const R=await W.getCompanyMembers(t.id),_=i.map(L=>L.users?.id),F=R.filter(L=>!_.includes(L.users?.id));u(F)}catch(R){console.error("Error loading company members:",R)}},k=async()=>{if(!j){n("Select a team member","error");return}try{v("add"),await W.addProjectMember(s.id,j,p,r.id),n("Team member added","success"),x(!1),m(""),N("Team Member"),T()}catch(R){console.error("Error adding team member:",R),n("Error adding team member","error")}finally{v(null)}},I=async(R,_)=>{try{v(R.id),await W.updateProjectMemberRole(s.id,R.users?.id,_),n("Role updated","success"),T()}catch(F){console.error("Error updating role:",F),n("Error updating role","error")}finally{v(null)}},B=async R=>{try{v(R.id),await W.removeProjectMember(s.id,R.users?.id),n("Team member removed","success"),T()}catch(_){console.error("Error removing team member:",_),n("Error removing team member","error")}finally{v(null)}};return h?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(Ie,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(Ie,{size:18})," Project Team"]}),a&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>x(!0),children:[e.jsx(dl,{size:14})," Add"]})]}),i.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",a&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:i.map(R=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:R.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:R.users?.email})]}),e.jsx("div",{className:"team-member-role",children:a?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:R.project_role,onChange:_=>I(R,_.target.value),disabled:D===R.id,className:"role-select",children:Ga.map(_=>e.jsx("option",{value:_,children:_},_))}),e.jsx(ls,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:R.project_role})}),a&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>B(R),disabled:D===R.id,title:"Remove from project",children:e.jsx(ul,{size:14})})]},R.id))}),f&&e.jsx("div",{className:"modal-overlay",onClick:()=>x(!1),children:e.jsxs("div",{className:"modal-content small",onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:e.jsx(Je,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:j,onChange:R=>m(R.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),d.map(R=>e.jsx("option",{value:R.users?.id,children:R.users?.name||R.users?.email},R.users?.id))]}),d.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:p,onChange:R=>N(R.target.value),className:"form-select",children:Ga.map(R=>e.jsx("option",{value:R,children:R},R))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:k,disabled:!j||D==="add",children:D==="add"?"Adding...":"Add to Project"})]})]})})]})}function Cc({onShowToast:s,onClose:t}){const[r,a]=o.useState("loading"),[n,i]=o.useState([]),[l,d]=o.useState(null),[u,h]=o.useState(null),[c,f]=o.useState(null),[x,j]=o.useState(""),[m,p]=o.useState(!1),[N,D]=o.useState(!1),[v,T]=o.useState(null);o.useEffect(()=>{w()},[]);const w=async()=>{try{const{data:F,error:L}=await ms.auth.mfa.listFactors();if(L)throw L;const A=(F?.totp||[]).filter(V=>V.status==="verified");i(A),a("overview")}catch{a("overview")}},k=async()=>{T(null);try{const{data:F,error:L}=await ms.auth.mfa.enroll({factorType:"totp",friendlyName:"FieldSync Authenticator"});if(L)throw L;d(F.totp.qr_code),h(F.totp.secret),f(F.id),a("enroll")}catch(F){T(F.message),s?.("Failed to start MFA enrollment","error")}},I=async()=>{if(x.length===6){p(!0),T(null);try{const{data:F,error:L}=await ms.auth.mfa.challenge({factorId:c});if(L)throw L;const{error:A}=await ms.auth.mfa.verify({factorId:c,challengeId:F.id,code:x});if(A)throw A;a("success"),s?.("MFA enabled successfully!","success"),await w()}catch{T("Invalid code. Please try again."),j("")}finally{p(!1)}}},B=async F=>{try{const{error:L}=await ms.auth.mfa.unenroll({factorId:F});if(L)throw L;s?.("MFA disabled","success"),await w()}catch{s?.("Failed to disable MFA","error")}},R=()=>{navigator.clipboard.writeText(u),D(!0),setTimeout(()=>D(!1),2e3)},_=n.length>0;return e.jsxs("div",{className:"mfa-setup",children:[e.jsxs("div",{className:"mfa-header",children:[e.jsxs("div",{className:"mfa-title",children:[_?e.jsx(mt,{size:20,className:"text-success"}):e.jsx(Da,{size:20}),e.jsx("h3",{children:"Two-Factor Authentication"})]}),t&&e.jsx("button",{className:"close-btn",onClick:t,"aria-label":"Close",children:e.jsx(Je,{size:20})})]}),r==="loading"&&e.jsxs("div",{className:"mfa-loading",children:[e.jsx(Ea,{size:24,className:"spinner"})," Loading..."]}),r==="overview"&&e.jsxs("div",{className:"mfa-overview",children:[e.jsx("p",{className:"mfa-description",children:"Add an extra layer of security to your account. When enabled, you will need to enter a code from your authenticator app each time you sign in."}),_?e.jsxs("div",{className:"mfa-status mfa-status-enabled",children:[e.jsx(mt,{size:18}),e.jsx("span",{children:"MFA is enabled"}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>B(n[0].id),children:[e.jsx(Pa,{size:14})," Disable"]})]}):e.jsxs("div",{className:"mfa-status mfa-status-disabled",children:[e.jsx(Pa,{size:18}),e.jsx("span",{children:"MFA is not enabled"}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:k,children:[e.jsx(Da,{size:14})," Enable MFA"]})]})]}),r==="enroll"&&e.jsxs("div",{className:"mfa-enroll",children:[e.jsx("p",{children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):"}),l&&e.jsx("div",{className:"mfa-qr-container",children:e.jsx("img",{src:l,alt:"MFA QR Code",className:"mfa-qr"})}),e.jsxs("div",{className:"mfa-secret",children:[e.jsx("span",{className:"mfa-secret-label",children:"Or enter this key manually:"}),e.jsxs("div",{className:"mfa-secret-value",children:[e.jsx("code",{children:u}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:R,"aria-label":"Copy secret key",children:N?e.jsx(hr,{size:14}):e.jsx(ml,{size:14})})]})]}),e.jsxs("div",{className:"mfa-verify-section",children:[e.jsx("label",{htmlFor:"mfa-verify-code",children:"Enter the 6-digit code from your app:"}),e.jsxs("div",{className:"mfa-code-input",children:[e.jsx("input",{id:"mfa-verify-code",type:"text",value:x,onChange:F=>j(F.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,autoFocus:!0,inputMode:"numeric",pattern:"[0-9]*"}),e.jsx("button",{className:"btn btn-primary",onClick:I,disabled:x.length!==6||m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(Ea,{size:14,className:"spinner"})," Verifying..."]}):"Verify & Enable"})]}),v&&e.jsx("p",{className:"mfa-error",children:v})]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>a("overview"),children:"Cancel"})]}),r==="success"&&e.jsxs("div",{className:"mfa-success",children:[e.jsx(mt,{size:48,className:"text-success"}),e.jsx("h4",{children:"MFA Enabled"}),e.jsx("p",{children:"Your account is now protected with two-factor authentication."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>a("overview"),children:"Done"})]})]})}o.lazy(()=>xe(()=>import("./TMList-UmbuiWDG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])));o.lazy(()=>xe(()=>import("./CORLogPreview-CUfhJHBJ.js"),__vite__mapDeps([9,2,3,4,1,5,6,8])));o.lazy(()=>xe(()=>import("./CORList-DSrDjrZd.js"),__vite__mapDeps([10,1,2,3,4,5,6,8,11])));o.lazy(()=>xe(()=>import("./BillingCenter-DH2MMxQ2.js"),__vite__mapDeps([12,2,3,4,1,5,6,8])));o.lazy(()=>xe(()=>Promise.resolve().then(()=>bc),void 0));o.lazy(()=>xe(()=>Promise.resolve().then(()=>Nc),void 0));const kc=o.lazy(()=>xe(()=>import("./ShareModal-C25vue3I.js"),__vite__mapDeps([13,2,3,4,1,5,6]))),_c=o.lazy(()=>xe(()=>import("./NotificationSettings-DVzG7EVq.js"),__vite__mapDeps([14,2,3,4,1,5,6]))),Sc=o.lazy(()=>xe(()=>import("./CORForm-CNykKirM.js"),__vite__mapDeps([15,2,3,4,1,5,6,8]))),Dc=o.lazy(()=>xe(()=>import("./CORDetail-GJwa29ff.js"),__vite__mapDeps([16,2,3,4,1,5,6,8,17,7]))),Ec=o.lazy(()=>xe(()=>import("./CORLog-Bjj91iSr.js").then(s=>s.a),__vite__mapDeps([11,1,2,3,4,5,6,8]))),Pc=o.lazy(()=>xe(()=>import("./DrawRequestModal-C4fw0mA_.js"),__vite__mapDeps([18,2,3,4,1,5,6,8]))),Rc=o.lazy(()=>xe(()=>import("./EquipmentModal-DG4Hwgtg.js"),__vite__mapDeps([19,2,3,4,1,5,6]))),Tc=o.lazy(()=>xe(()=>import("./AddCostModal-Ddu-_W6k.js"),__vite__mapDeps([20,2,3,4,1,5,6]))),Ac=o.lazy(()=>xe(()=>import("./DocumentsTab-DVIQu0ne.js"),__vite__mapDeps([21,2,3,4,1,5,6])));function Oc({company:s,user:t,isAdmin:r,onShowToast:a,navigateToProjectId:n,onProjectNavigated:i}){const[l,d]=o.useState([]),[u,h]=o.useState([]),[c,f]=o.useState(null),[x,j]=o.useState([]),[m,p]=o.useState(!0),[N,D]=o.useState(!1),[v,T]=o.useState(null),[w,k]=o.useState(!1),[I,B]=o.useState(!1),[R,_]=o.useState(!1),[F,L]=o.useState("overview"),[A,V]=o.useState("overview"),[E,te]=o.useState(!0),[z,de]=o.useState(!1),[ve,me]=o.useState(!1),[De,$]=o.useState("list"),[b,C]=o.useState("preview"),[K,P]=o.useState([]),[Q,ee]=o.useState(!1),[re,je]=o.useState(null),[Xe,Ee]=o.useState(!1),[se,Ae]=o.useState(null),[ae,Pe]=o.useState(0),[Qs,ke]=o.useState(!1),[Cs,cs]=o.useState(!1),[Tr,ks]=o.useState(!1),[$t,_s]=o.useState(null),[Ar,Or]=o.useState(0),[Fr,Ss]=o.useState(!1),[It,Ds]=o.useState(null),[Mr,$r]=o.useState(0),{isOpen:Ir,setIsOpen:zr,close:Lr}=Lo(),ge=Ho(),ds=o.useRef(null),Es=o.useRef(!1),Zs=o.useRef(!1),et=o.useRef(new Map),zt=300*1e3,fe=o.useCallback((g={})=>{const{refreshAreas:M=!1,refreshCOR:q=!1,projectId:O=null}=g;M&&O&&(Es.current=O),q&&(Zs.current=!0),ds.current&&clearTimeout(ds.current),ds.current=setTimeout(async()=>{Es.current&&(await st(Es.current),Es.current=!1),Zs.current&&(Pe(X=>X+1),Zs.current=!1),await us()},150)},[]);o.useEffect(()=>()=>{ds.current&&clearTimeout(ds.current)},[]),o.useEffect(()=>{s?.id&&(us(),Br())},[s?.id]);const qr=o.useRef([]),Vr=l.map(g=>g.id).sort().join(",");o.useEffect(()=>{if(!s?.id||l.length===0)return;const g=l.map(q=>q.id).sort();qr.current=g;const M=W.subscribeToCompanyActivity?.(s.id,g,{onMessage:()=>fe(),onMaterialRequest:()=>fe(),onTMTicket:()=>fe(),onCrewCheckin:()=>fe(),onAreaUpdate:()=>fe(),onCORChange:()=>fe({refreshCOR:!0}),onInjuryReport:()=>fe(),onProjectChange:()=>fe(),onMaterialsEquipmentChange:()=>fe(),onLaborRateChange:()=>fe()});return()=>{M&&W.unsubscribe?.(M)}},[s?.id,Vr,fe]),o.useEffect(()=>(z?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[z]);const Br=async()=>{try{const g=await W.getDumpSites(s.id);P(g||[])}catch(g){console.error("Error loading dump sites:",g)}},Lt=o.useRef(null);o.useEffect(()=>{if(n&&n!==Lt.current&&l.length>0){const g=l.find(M=>M.id===n);g&&(Lt.current=n,f(g),i?.())}},[n,l,i]),o.useEffect(()=>{if(c){st(c.id);const g=[],M=c.id,q=W.subscribeToAreas?.(M,()=>{fe({refreshAreas:!0,projectId:M})});q&&g.push(q);const O=W.subscribeToDailyReports?.(M,()=>{fe()});O&&g.push(O);const X=W.subscribeToCrewCheckins?.(M,()=>{fe()});X&&g.push(X);const Y=W.subscribeToHaulOffs?.(M,()=>{fe()});Y&&g.push(Y);const Z=W.subscribeToCORs?.(M,()=>{fe({refreshCOR:!0})});return Z&&g.push(Z),()=>{g.forEach(le=>W.unsubscribe?.(le))}}},[c,fe]),o.useEffect(()=>{A==="tickets"&&C("full")},[A]);const Wr=async(g,M=!1)=>{const q=g.id,O=et.current.get(q);if(O&&!M&&Date.now()-O.timestamp<zt)return O.data;try{const[X,Y,Z,le,oe,ce,Le,Ts,S,G,he,Oe]=await Promise.all([ye(()=>W.getAreas(g.id),{fallback:[],context:{operation:"getAreas",projectId:g.id}}),ye(()=>W.getTMTickets(g.id),{fallback:[],context:{operation:"getTMTickets",projectId:g.id}}),ye(()=>W.getChangeOrderTotals(g.id),{fallback:null,context:{operation:"getChangeOrderTotals",projectId:g.id}}),ye(()=>W.getDailyReports(g.id,100),{fallback:[],context:{operation:"getDailyReports",projectId:g.id}}),ye(()=>W.getInjuryReports(g.id),{fallback:[],context:{operation:"getInjuryReports",projectId:g.id}}),ye(()=>W.calculateManDayCosts(g.id,s?.id,g.work_type||"demolition",g.job_type||"standard"),{fallback:null,context:{operation:"calculateManDayCosts",projectId:g.id}}),ye(()=>W.calculateHaulOffCosts(g.id),{fallback:null,context:{operation:"calculateHaulOffCosts",projectId:g.id}}),ye(()=>W.getProjectCosts(g.id),{fallback:[],context:{operation:"getProjectCosts",projectId:g.id}}),ye(()=>W.getCORStats(g.id),{fallback:null,context:{operation:"getCORStats",projectId:g.id}}),ye(()=>W.getCrewCheckinHistory(g.id,60),{fallback:[],context:{operation:"getCrewCheckinHistory",projectId:g.id}}),ye(()=>W.getMaterialRequests(g.id),{fallback:[],context:{operation:"getMaterialRequests",projectId:g.id}}),ye(()=>W.getWeeklyDisposalSummary(g.id,4),{fallback:[],context:{operation:"getWeeklyDisposalSummary",projectId:g.id}})]),Se=_a(X),tt=Se.progress,ia=Z?.totalApprovedValue||0,la=g.contract_value+ia,As=Se.isValueBased?Se.earnedValue:tt/100*la,Cn=Y.filter(H=>H.status==="pending").length,at=new Date;at.setDate(at.getDate()-7);const kn=le.filter(H=>new Date(H.report_date)>=at).length,oa=Ts.reduce((H,ne)=>{const Ze=parseFloat(ne.amount);return H+(isNaN(Ze)?0:Ze)},0);let Os=0;const Fs={};Y.forEach(H=>{const ne=H.work_date||H.ticket_date||H.created_at?.split("T")[0],Ze=H.t_and_m_items||H.items||[];let Ms=0;Ze.forEach(ct=>{const qn=parseFloat(ct.quantity)||1,Vn=parseFloat(ct.unit_cost)||parseFloat(ct.materials_equipment?.cost_per_unit)||0;Ms+=qn*Vn}),Ms>0&&ne&&(Os+=Ms,Fs[ne]||(Fs[ne]={date:ne,cost:0}),Fs[ne].cost+=Ms)});const ca=Object.values(Fs).sort((H,ne)=>new Date(ne.date)-new Date(H.date)),rt=ce?.totalCost||0,_n=Le?.totalCost||0,da=rt+Os+oa,ua=As-da,Sn=As>0?ua/As*100:0,ma=ce?.byDate?.length||0,Dn=ca.length,nt=Math.max(ma,Dn),ha=rt+Os,En=nt>0?ha/nt:0,Fe=Ji({...g,progress:tt},ce?.totalManDays||0),qe={},pa=new Set;(G||[]).forEach(H=>{const ne=H.workers||[];qe[H.check_in_date]=ne.length,ne.forEach(Ze=>pa.add(Ze.name?.toLowerCase()))});const Me=Object.keys(qe).sort(),Pn=Me.length>0?Math.round(Me.reduce((H,ne)=>H+qe[ne],0)/Me.length*10)/10:0,Rn=Me.length>0?Math.max(...Me.map(H=>qe[H])):0,it=Me.slice(-7),lt=Me.slice(-14,-7),xa=it.length>0?it.reduce((H,ne)=>H+qe[ne],0)/it.length:0,ot=lt.length>0?lt.reduce((H,ne)=>H+qe[ne],0)/lt.length:0,Tn=(he||[]).filter(H=>H.status==="pending").length,An=(he||[]).filter(H=>H.status==="ordered").length,On=(he||[]).filter(H=>H.status==="delivered").length,Fn=(he||[]).filter(H=>H.priority==="urgent"&&H.status==="pending").length,Mn=le.filter(H=>H.issues&&H.issues.trim().length>0).length,$n=Y.reduce((H,ne)=>H+(ne.photos?.length||0),0),In=(Oe||[]).reduce((H,ne)=>H+(ne.concrete||0)+(ne.trash||0)+(ne.metals||0)+(ne.hazardous_waste||0),0),fa=oe.length>0?new Date(oe[0]?.incident_date||oe[0]?.created_at):null,zn=fa?Math.floor((new Date-fa)/(1e3*60*60*24)):null,Ln=X.filter(H=>H.status==="done"),va={...g,areas:X,progress:tt,billable:As,changeOrderValue:ia,revisedContractValue:la,changeOrderPending:Z?.pendingCount||0,totalTickets:Y.length,pendingTickets:Cn,approvedTickets:Y.filter(H=>H.status==="approved").length,tmTickets:Y,dailyReportsCount:le.length,recentDailyReports:kn,injuryReportsCount:oe.length,lastDailyReport:le[0]?.report_date||null,isValueBased:Se.isValueBased,earnedValue:Se.earnedValue,totalSOVValue:Se.totalValue,laborCost:rt,laborDaysWorked:ma,laborManDays:ce?.totalManDays||0,laborByDate:ce?.byDate||[],dailyBurn:En,materialsEquipmentCost:Os,materialsEquipmentByDate:ca,haulOffCost:_n,haulOffLoads:Le?.totalLoads||0,haulOffDays:Le?.daysWithHaulOff||0,haulOffByType:Le?.byWasteType||{},haulOffByDate:Le?.byDate||[],customCosts:Ts,customCostTotal:oa,totalBurn:ha,totalBurnDays:nt,allCostsTotal:da,currentProfit:ua,profitMargin:Sn,corPendingValue:S?.total_pending_value||0,corPendingCount:S?.pending_count||0,corApprovedValue:S?.total_approved_value||0,corBilledValue:S?.total_billed_value||0,corTotalCount:S?.total_cors||0,corStats:S,scheduleStatus:Fe.scheduleStatus,scheduleVariance:Fe.scheduleVariance,scheduleLabel:Fe.scheduleLabel,laborStatus:Fe.laborStatus,laborVariance:Fe.laborVariance,laborLabel:Fe.laborLabel,hasScheduleData:Fe.hasScheduleData,hasLaborData:Fe.hasLaborData,actualManDays:ce?.totalManDays||0,crewHistory:G||[],crewByDate:qe,uniqueWorkerCount:pa.size,avgCrewSize:Pn,peakCrewSize:Rn,crewDaysTracked:Me.length,crewTrend:ot>0?(xa-ot)/ot*100:0,recentCrewAvg:xa,materialRequests:he||[],pendingMaterialRequests:Tn,orderedMaterialRequests:An,deliveredMaterialRequests:On,urgentMaterialRequests:Fn,totalMaterialRequests:(he||[]).length,reportsWithIssues:Mn,totalPhotosFromTickets:$n,dailyReports:le,weeklyDisposal:Oe||[],disposalTotalLoads:In,daysSinceLastInjury:zn,injuryReports:oe,oshaRecordable:oe.filter(H=>H.osha_recordable).length,completedAreasCount:Ln.length,hasError:!1,_detailsLoaded:!0};return et.current.set(q,{data:va,timestamp:Date.now()}),va}catch(X){return console.error(`Error loading details for project ${g.id}:`,X),{...g,hasError:!0,_detailsLoaded:!1}}},us=async()=>{try{const g=await W.getProjectDashboardSummary(s?.id);d(g);const M=g.map(q=>{const O=et.current.get(q.id);if(O&&Date.now()-O.timestamp<zt)return O.data;const X=q.areaCount||0,Y=q.completedAreas||0,Z=X>0?Math.round(Y/X*100):0;return{...q,progress:Z,areas:[],totalTickets:q.ticketCount||0,pendingTickets:q.pendingTicketCount||0,approvedTickets:q.approvedTicketCount||0,dailyReportsCount:q.dailyReportsThisWeek||0,recentDailyReports:q.dailyReportsThisWeek||0,corTotalCount:q.corCount||0,billable:0,changeOrderValue:0,revisedContractValue:q.contract_value||0,changeOrderPending:0,tmTickets:[],injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,materialsEquipmentCost:0,materialsEquipmentByDate:[],haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corStats:null,scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1,actualManDays:0,hasError:!1,_detailsLoaded:!1}});h(M)}catch(g){console.error("Error loading projects:",g),a("Error loading projects","error")}finally{p(!1)}},st=async g=>{try{const M=await W.getAreas(g);j(M)}catch(M){console.error("Error loading areas:",M)}},Ps=async g=>{if(f(g),!g._detailsLoaded){const M=await Wr(g);h(q=>q.map(O=>O.id===g.id?M:O)),f(M)}},qt=()=>{f(null),j([]),D(!1),T(null),L("overview"),us()},Vt=()=>{T({name:c.name,job_number:c.job_number||"",address:c.address||"",general_contractor:c.general_contractor||"",client_contact:c.client_contact||"",client_phone:c.client_phone||"",contract_value:c.contract_value,work_type:c.work_type||"demolition",job_type:c.job_type||"standard",pin:c.pin||"",default_dump_site_id:c.default_dump_site_id||"",areas:x.map(g=>({id:g.id,name:g.name,weight:g.weight,isNew:!1}))}),D(!0)},Ur=()=>{D(!1),T(null)},_e=(g,M)=>{T(q=>({...q,[g]:M}))},Bt=(g,M,q)=>{T(O=>({...O,areas:O.areas.map((X,Y)=>Y===g?{...X,[M]:q}:X)}))},Hr=()=>{T(g=>({...g,areas:[...g.areas,{id:null,name:"",weight:"",isNew:!0}]}))},Kr=g=>{v.areas.length>1&&T(M=>({...M,areas:M.areas.filter((q,O)=>O!==g)}))},Gr=async()=>{if(!v.name.trim()){a("Please enter a project name","error");return}const g=parseFloat(v.contract_value);if(!g||g<=0){a("Please enter a valid contract value","error");return}if(v.pin&&v.pin.length!==4){a("PIN must be 4 digits","error");return}if(v.pin&&v.pin!==c.pin&&!await W.isPinAvailable(v.pin,c.id)){a("This PIN is already in use","error");return}const M=v.areas.filter(O=>O.name.trim()&&parseFloat(O.weight)>0);if(M.length===0){a("Please add at least one area","error");return}if(M.reduce((O,X)=>O+parseFloat(X.weight),0)!==100){a("Area weights must total 100%","error");return}k(!0);try{await W.updateProject(c.id,{name:v.name.trim(),job_number:v.job_number?.trim()||null,address:v.address?.trim()||null,general_contractor:v.general_contractor?.trim()||null,client_contact:v.client_contact?.trim()||null,client_phone:v.client_phone?.trim()||null,contract_value:g,work_type:v.work_type||"demolition",job_type:v.job_type||"standard",pin:v.pin||null,default_dump_site_id:v.default_dump_site_id||null},s?.id);const O=x.map(Z=>Z.id),X=v.areas.filter(Z=>Z.id).map(Z=>Z.id);for(const Z of O)X.includes(Z)||await W.deleteArea(Z);for(let Z=0;Z<M.length;Z++){const le=M[Z];le.id?await W.updateArea(le.id,{name:le.name.trim(),weight:parseFloat(le.weight),sort_order:Z}):await W.createArea({project_id:c.id,name:le.name.trim(),weight:parseFloat(le.weight),status:"not_started",sort_order:Z})}const Y=await W.getProject(c.id);f(Y),await st(c.id),D(!1),T(null),a("Project updated!","success")}catch(O){console.error("Error saving project:",O?.message||O),a(O?.message||"Error saving changes","error")}finally{k(!1)}},Yr=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await W.deleteProject(c.id),a("Project deleted","success"),qt()}catch(g){console.error("Error deleting project:",g),a("Error deleting project","error")}},y=o.useMemo(()=>c?u.find(g=>g.id===c.id):null,[c,u]),Jr=o.useMemo(()=>{if(!c)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const g=_a(x),M=g.progress,q=y?.changeOrderValue||0,O=c.contract_value+q,X=g.isValueBased?g.earnedValue:M/100*O;return{progress:M,billable:X,changeOrderValue:q,revisedContractValue:O,isValueBased:g.isValueBased,earnedValue:g.earnedValue,totalSOVValue:g.totalValue}},[c,x,y]),Xr=o.useMemo(()=>{const g=u.reduce((oe,ce)=>oe+(ce.contract_value||0),0),M=u.reduce((oe,ce)=>oe+(ce.changeOrderValue||0),0),q=g+M,O=u.reduce((oe,ce)=>oe+(ce.billable||0),0),X=q-O,Y=q>0?Math.round(O/q*100):0,Z=u.reduce((oe,ce)=>oe+(ce.corPendingValue||0),0),le=u.reduce((oe,ce)=>oe+(ce.corPendingCount||0),0);return{totalOriginalContract:g,totalChangeOrders:M,totalPortfolioValue:q,totalEarned:O,totalRemaining:X,weightedCompletion:Y,totalPendingCORValue:Z,totalPendingCORCount:le}},[u]),Qr=o.useMemo(()=>{let g=0,M=0,q=0,O=0,X=0;for(const Y of u){const Z=Y.revisedContractValue||Y.contract_value;Y.progress>=100&&g++,Y.progress<100&&Y.billable<=Z*(Y.progress/100)*1.1&&M++,Y.billable>Z*.9&&Y.progress<90&&q++,Y.billable>Z&&O++,(Y.changeOrderValue||0)>0&&X++}return{projectsComplete:g,projectsOnTrack:M,projectsAtRisk:q,projectsOverBudget:O,projectsWithChangeOrders:X}},[u]),Zr=o.useMemo(()=>{let g=0,M=0,q=0,O=0,X=0,Y=0;for(const Z of u)Z.hasScheduleData&&(Z.scheduleStatus==="ahead"?g++:Z.scheduleStatus==="behind"?q++:M++),Z.hasLaborData&&(Z.laborStatus==="over"?O++:Z.laborStatus==="under"?X++:Y++);return{scheduleAhead:g,scheduleOnTrack:M,scheduleBehind:q,laborOver:O,laborUnder:X,laborOnTrack:Y,hasAnyScheduleData:g+M+q>0,hasAnyLaborData:O+X+Y>0}},[u]),Qe=o.useMemo(()=>{const g=u.map(O=>{const X={id:O.id,name:O.name,totalCosts:O.totalCosts||0,earnedRevenue:O.billable||0,actualProgress:O.progress||0,expectedProgress:O.expectedProgress||O.progress,pendingCORValue:O.corPendingValue||0,contractValue:O.revisedContractValue||O.contract_value||0,lastReportDate:O.lastDailyReport,recentInjuryCount:O.recentInjuryCount||0,startDate:O.start_date},Y=Po(X),Z=Ro(Y,{...X,name:O.name}),le=To(X),oe=Z.map(ce=>({...ce,projectName:O.name,projectId:O.id}));return{projectId:O.id,projectName:O.name,riskScore:Y.score,riskStatus:Y.status,riskLabel:Y.label,factors:Y.factors,alerts:oe,projections:le}}),M=g.flatMap(O=>O.alerts).sort((O,X)=>{const Y={critical:0,warning:1,info:2};return Y[O.type]-Y[X.type]}),q=ge.filterAlerts(M);return{projectRisks:g,allAlerts:M,filteredAlerts:q,criticalCount:q.filter(O=>O.type==="critical").length,warningCount:q.filter(O=>O.type==="warning").length}},[u,ge.filterAlerts]),en=o.useCallback(({target:g,projectId:M,alert:q})=>{const O=l.find(X=>X.id===M);O&&(f(O),g==="financials"?L("financials"):g==="reports"?L("reports"):g==="cors"?(L("financials"),V("cors")):L("overview"))},[l]);o.useEffect(()=>{const g=async()=>{for(const M of u)if(Ki(M,30))try{await W.archiveProject(M.id),a(`Project "${M.name}" has been auto-archived after 30 days of completion`,"info")}catch(q){console.error("Failed to auto-archive project:",q)}};u.length>0&&g()},[]);const sn=o.useCallback(()=>{_s(null),ks(!0)},[]),tn=o.useCallback(g=>{_s(g),ks(!0)},[]),an=o.useCallback(()=>{Ds(null),Ss(!0)},[]),rn=o.useCallback(g=>{Ds(g),Ss(!0)},[]),nn=o.useCallback(()=>{C("full")},[]),ln=o.useCallback(()=>{te(g=>!g)},[]),on=o.useCallback(()=>{de(g=>!g)},[]),Wt=o.useCallback(()=>{de(!1)},[]),Ut=o.useCallback(()=>{me(g=>!g)},[]),Rs=o.useCallback(async(g="all")=>{if(c){a("Gathering field data...","info");try{const[M,q,O]=await Promise.all([W.getDailyReports(c.id,365),W.getInjuryReports(c.id),W.getCrewCheckinHistory(c.id,365)]);g==="daily"?await Ao(M||[],c):g==="incidents"?await Oo(q||[],c):g==="crew"?await Fo(O||[],c):await Mo({dailyReports:M||[],incidentReports:q||[],crewCheckins:O||[],project:c}),a("PDF exported!","success")}catch(M){console.error("Error exporting field documents:",M),a("Error generating PDF","error")}}},[c,a]),cn=o.useCallback(()=>{C("preview")},[]),dn=o.useCallback(()=>{$("log")},[]),Ht=o.useCallback(()=>{je(null),ee(!0)},[]),un=o.useCallback(g=>{Ae(g),Ee(!0)},[]),mn=o.useCallback(g=>{je(g),ee(!0)},[]),hn=o.useCallback(()=>{ke(!0)},[]),pn=o.useCallback(async g=>{try{await W.deleteProjectCost(g),us(),a?.("Cost deleted","success")}catch{a?.("Error deleting cost","error")}},[]),xn=o.useMemo(()=>({corCount:y?.corStats?.total||0,ticketCount:y?.totalTickets||0,corPending:y?.corStats?.pending||0,ticketPending:y?.pendingTickets||0}),[y?.corStats?.total,y?.totalTickets,y?.corStats?.pending,y?.pendingTickets]),{totalOriginalContract:fn,totalChangeOrders:Kt,totalPortfolioValue:vn,totalEarned:jn,totalRemaining:gn,weightedCompletion:bn,totalPendingCORValue:yn,totalPendingCORCount:Gt}=Xr,{projectsComplete:Yt,projectsOnTrack:Jt,projectsAtRisk:Xt,projectsOverBudget:Qt,projectsWithChangeOrders:Zt}=Qr,{scheduleAhead:ea,scheduleOnTrack:sa,scheduleBehind:ta,laborOver:aa,laborUnder:ra,laborOnTrack:na,hasAnyScheduleData:Nn,hasAnyLaborData:wn}=Zr;if(m)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(c){const{progress:g,billable:M,changeOrderValue:q,revisedContractValue:O,isValueBased:X,earnedValue:Y,totalSOVValue:Z}=Jr;if(N&&v){const S=v.areas.reduce((G,he)=>G+(parseFloat(he.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Ur,style:{marginBottom:"1.5rem"},children:"← Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:v.name,onChange:G=>_e("name",G.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:v.job_number,onChange:G=>_e("job_number",G.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:v.address,onChange:G=>_e("address",G.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:v.general_contractor,onChange:G=>_e("general_contractor",G.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:v.client_contact,onChange:G=>_e("client_contact",G.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:v.client_phone,onChange:G=>_e("client_phone",G.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:v.contract_value,onChange:G=>_e("contract_value",G.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:v.pin,onChange:G=>_e("pin",G.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:v.work_type,onChange:G=>_e("work_type",G.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:v.job_type,onChange:G=>_e("job_type",G.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:v.default_dump_site_id,onChange:G=>_e("default_dump_site_id",G.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),K.map(G=>e.jsx("option",{value:G.id,children:G.name},G.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),v.areas.map((G,he)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:G.name,onChange:Oe=>Bt(he,"name",Oe.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:G.weight,onChange:Oe=>Bt(he,"weight",Oe.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>Kr(he),children:"×"})]},he)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${S===100?"valid":"invalid"}`,children:[S,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:Hr,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:Gr,disabled:w,style:{flex:1},children:w?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:Yr,children:"Delete Project"})]})}const le=x.filter(S=>S.status==="done").length,oe=x.filter(S=>S.status==="working").length,ce=x.filter(S=>S.status==="not_started").length,Le=(y?.pendingTickets||0)+(y?.changeOrderPending||0),Ts=[{id:"overview",label:"Overview",Icon:Ra},{id:"financials",label:"Financials",Icon:ps,badge:Le},{id:"reports",label:"Reports",Icon:be},{id:"documents",label:"Documents",Icon:jt},{id:"info",label:"Info",Icon:Ls}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:qt,children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>B(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>_(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:Vt,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:c.name}),(c.job_number||c.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[c.job_number&&`Job #${c.job_number}`,c.job_number&&c.work_type&&" • ",c.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[g,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:pe(M)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:pe(O-M)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:Ts.map(S=>e.jsxs("button",{className:`pv-tab ${F===S.id?"active":""} ${S.badge>0?"has-badge":""}`,onClick:()=>L(S.id),children:[e.jsx(S.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:S.label}),S.badge>0&&e.jsx("span",{className:"pv-tab-badge",children:S.badge})]},S.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[F==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab animate-fade-in",children:[e.jsxs("div",{className:"overview-hero-split",children:[e.jsx(Yo,{progress:g,areasComplete:le,totalAreas:x.length,areasWorking:oe}),e.jsx(Xo,{earnedRevenue:M,totalCosts:y?.allCostsTotal||0,laborCost:y?.laborCost||0,disposalCost:y?.haulOffCost||0,equipmentCost:y?.materialsEquipmentCost||0,materialsCost:0,otherCost:y?.customCostTotal||0,contractValue:O})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(Zo,{project:c,onShowToast:a}),e.jsxs("div",{className:"overview-section-card overview-work-areas-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[le>0&&e.jsxs("span",{className:"section-badge done",children:[le," Done"]}),oe>0&&e.jsxs("span",{className:"section-badge working",children:[oe," Active"]}),ce>0&&e.jsxs("span",{className:"section-badge pending",children:[ce," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list work-areas-scroll stagger-areas",children:x.map(S=>e.jsxs("div",{className:`work-area-item ${S.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[S.status==="done"&&e.jsx("span",{className:"status-icon done",children:"✓"}),S.status==="working"&&e.jsx("span",{className:"status-icon working",children:"●"}),S.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:"○"})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:S.name}),e.jsx("span",{className:"work-area-weight",children:S.scheduled_value?pe(S.scheduled_value):`${S.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${S.status}`,style:{width:S.status==="done"?"100%":S.status==="working"?"50%":"0%"}})})]},S.id))})]})]}),e.jsxs("div",{className:"overview-bottom-strip",children:[(y?.pendingTickets>0||y?.changeOrderPending>0||y?.pendingMaterialRequests>0||y?.urgentMaterialRequests>0)&&e.jsxs("div",{className:"overview-attention-inline",children:[y?.urgentMaterialRequests>0&&e.jsxs("div",{className:"attention-chip warning",onClick:()=>L("reports"),children:[e.jsx(AlertTriangle,{size:14}),e.jsxs("span",{children:[y.urgentMaterialRequests," urgent material request",y.urgentMaterialRequests!==1?"s":""]})]}),y?.pendingMaterialRequests>0&&!y?.urgentMaterialRequests&&e.jsxs("div",{className:"attention-chip info",onClick:()=>L("reports"),children:[e.jsx(Package,{size:14}),e.jsxs("span",{children:[y.pendingMaterialRequests," material request",y.pendingMaterialRequests!==1?"s":""," pending"]})]}),y?.pendingTickets>0&&e.jsxs("div",{className:"attention-chip warning",onClick:()=>L("financials"),children:[e.jsx(be,{size:14}),e.jsxs("span",{children:[y.pendingTickets," T&M pending"]})]}),y?.changeOrderPending>0&&e.jsxs("div",{className:"attention-chip info",onClick:()=>L("financials"),children:[e.jsx(rs,{size:14}),e.jsxs("span",{children:[y.changeOrderPending," CO pending"]})]})]}),e.jsxs("div",{className:"overview-quick-actions",children:[e.jsxs("button",{className:"overview-action-btn",onClick:()=>L("reports"),children:[e.jsx(be,{size:15}),e.jsxs("span",{children:[y?.dailyReportsCount||0," Reports"]})]}),e.jsxs("button",{className:"overview-action-btn",onClick:()=>L("financials"),children:[e.jsx(ps,{size:15}),e.jsxs("span",{children:[y?.totalTickets||0," T&M Tickets"]})]}),e.jsx("span",{className:"overview-action-divider"}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Rs("all"),children:[e.jsx(We,{size:15}),e.jsx("span",{children:"Export All Docs"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Rs("daily"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Daily"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Rs("incidents"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Incidents"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Rs("crew"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Crew"})]})]})]})]}),F==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsxs("div",{className:"export-actions",style:{display:"flex",gap:"8px",marginLeft:"auto",marginBottom:"12px",justifyContent:"flex-end"},children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>$o(c,{earnedRevenue:M,approvedCORs:y?.cors?.filter(S=>S.status==="approved"),laborByDate:y?.laborByDate,haulOffByDate:y?.haulOffByDate,customCosts:y?.customCosts}),children:[e.jsx(We,{size:14})," Export CSV"]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>Io(c,{totalLaborCost:y?.totalLaborCost||0,totalDisposalCost:y?.totalDisposalCost||0}),children:[e.jsx(We,{size:14})," QuickBooks"]})]}),e.jsx(rc,{contractValue:c?.contract_value||0,earnedRevenue:M,totalCosts:y?.allCostsTotal||0,profit:y?.currentProfit||0,progress:g,corApprovedValue:q,loading:!y}),e.jsxs("div",{className:`financials-layout ${E?"sidebar-collapsed":""}`,children:[e.jsxs("button",{className:"financials-mobile-menu-toggle",onClick:on,"aria-label":"Open navigation menu",title:"Open navigation menu",children:[e.jsx(Menu,{size:20}),e.jsx("span",{children:"Menu"})]}),z&&e.jsx("div",{className:"financials-sidebar-overlay",onClick:Wt,"aria-hidden":"true"}),e.jsx("div",{className:`financials-sidebar ${E?"collapsed":""} ${z?"mobile-open":""}`,children:e.jsx(nc,{activeSection:A,onSectionChange:S=>{V(S),de(!1)},collapsed:E,onToggleCollapse:ln,onMobileClose:Wt,stats:xn})}),e.jsxs("div",{className:"financials-main",children:[A==="overview"&&e.jsxs("div",{className:"financials-overview animate-fade-in",children:[e.jsx(dc,{projectData:y,project:c,tmTickets:y?.tmTickets||[],corStats:y?.corStats,areas:x}),e.jsxs("div",{className:"financials-analysis-row stagger-children",children:[e.jsx(BurnRateCard,{dailyBurn:y?.dailyBurn||0,totalBurn:y?.totalBurn||0,daysWorked:y?.totalBurnDays||0,laborCost:y?.laborCost||0,materialsEquipmentCost:y?.materialsEquipmentCost||0,progress:g,contractValue:O,laborByDate:y?.laborByDate||[],materialsEquipmentByDate:y?.materialsEquipmentByDate||[]}),e.jsx(mc,{revenue:M,totalCosts:y?.allCostsTotal||0,contractValue:O,progress:g})]}),e.jsxs("div",{className:"cost-disposal-row",children:[e.jsx(hc,{laborCost:y?.laborCost||0,haulOffCost:y?.haulOffCost||0,customCosts:y?.customCosts||[],onAddCost:hn,onDeleteCost:pn}),e.jsx(xc,{project:c,period:"week"})]}),e.jsx(fc,{project:c,onAddEquipment:sn,onEditEquipment:tn,onShowToast:a},Ar),e.jsx(vc,{project:c,areas:x,corStats:y?.corStats,onCreateDraw:an,onViewDraw:rn,onShowToast:a},Mr),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(He,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:pe(y?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(jc,{project:c,company:s,onShowToast:a})})]})]}),A==="cors"&&e.jsxs("div",{className:"financials-cors animate-fade-in",children:[e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(CORLogPreview,{project:c,onShowToast:a,onToggleList:Ut,showingList:ve,onViewFullLog:dn,onCreateCOR:Ht})})}),ve&&e.jsx("div",{className:"financials-section cor-section-list animate-fade-in",style:{marginTop:"1rem"},children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(CORList,{project:c,company:s,areas:x,refreshKey:ae,onShowToast:a,previewMode:!1,onViewAll:Ut,onDisplayModeChange:$,onCreateCOR:Ht,onViewCOR:un,onEditCOR:mn})})})]}),A==="tickets"&&e.jsx("div",{className:"financials-tickets animate-fade-in",children:e.jsxs("div",{className:"financials-section tm-section",children:[b==="full"&&e.jsx("button",{className:"section-back-btn",onClick:cn,children:"← Back to summary"}),e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(TMList,{project:c,company:s,onShowToast:a,compact:b==="preview",previewMode:b==="preview",onViewAll:nn})})]})}),A==="billing"&&e.jsx("div",{className:"financials-billing animate-fade-in",children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(BillingCenter,{project:c,company:s,user:t,onShowToast:a})})})]})]})]}),F==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(be,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:y?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:y?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((y?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:y?.totalTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"T&M Tickets"}),(y?.pendingTickets||0)>0&&e.jsxs("div",{className:"reports-metric-status",style:{background:"#fef3c7",color:"#92400e"},children:[y.pendingTickets," pending"]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:y?.totalPhotosFromTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"Photos Captured"})]})]})}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsx("div",{className:"reports-insight-header",children:e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Users,{size:18}),e.jsx("h3",{children:"Crew Analytics"})]})}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.uniqueWorkerCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Workers"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.avgCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Avg Crew / Day"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.peakCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Peak Crew Size"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.crewDaysTracked||0}),e.jsx("span",{className:"reports-stat-label",children:"Days Tracked"})]})]}),(y?.crewTrend||0)!==0&&e.jsxs("div",{className:`reports-trend-badge ${y.crewTrend>0?"up":"down"}`,children:[y.crewTrend>0?e.jsx(TrendingUp,{size:14}):e.jsx(TrendingDown,{size:14}),e.jsxs("span",{children:[Math.abs(Math.round(y.crewTrend)),"% ",y.crewTrend>0?"increase":"decrease"," vs prior week"]})]}),y?.crewByDate&&Object.keys(y.crewByDate).length>0&&e.jsxs("div",{className:"reports-mini-chart",children:[e.jsx("div",{className:"reports-mini-chart-label",children:"Recent Crew Size"}),e.jsx("div",{className:"reports-mini-bars",children:Object.keys(y.crewByDate).sort().slice(-14).map(S=>{const G=y.crewByDate[S],he=y.peakCrewSize||1;return e.jsx("div",{className:"reports-mini-bar-wrap",title:`${new Date(S+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}: ${G} workers`,children:e.jsx("div",{className:"reports-mini-bar",style:{height:`${G/he*100}%`}})},S)})})]})]})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Shield,{size:18}),e.jsx("h3",{children:"Safety Dashboard"})]}),e.jsx("span",{className:`reports-section-badge ${(y?.injuryReportsCount||0)>0?"warning":"success"}`,children:(y?.injuryReportsCount||0)>0?`${y.injuryReportsCount} incident${y.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsx("div",{className:"reports-safety-hero",children:e.jsxs("div",{className:`reports-safety-days ${y?.daysSinceLastInjury===null||y?.daysSinceLastInjury>30?"excellent":y?.daysSinceLastInjury>7?"good":"caution"}`,children:[e.jsx("span",{className:"reports-safety-days-value",children:y?.daysSinceLastInjury!==null?y.daysSinceLastInjury:"--"}),e.jsx("span",{className:"reports-safety-days-label",children:y?.daysSinceLastInjury!==null?"Days Since Last Incident":"No Incidents Recorded"})]})}),e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.injuryReportsCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Incidents"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.oshaRecordable||0}),e.jsx("span",{className:"reports-stat-label",children:"OSHA Recordable"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.reportsWithIssues||0}),e.jsx("span",{className:"reports-stat-label",children:"Reports w/ Issues"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.laborManDays||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Man-Days"})]})]})]})]})]}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Package,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("span",{className:"reports-section-count",children:[y?.totalMaterialRequests||0," total"]})]}),e.jsx("div",{className:"reports-insight-body",children:(y?.totalMaterialRequests||0)===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Package,{size:32}),e.jsx("p",{children:"No material requests yet"}),e.jsx("span",{children:"Requests from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-material-pipeline",children:[y?.urgentMaterialRequests>0&&e.jsxs("div",{className:"reports-material-status urgent",children:[e.jsx(AlertTriangle,{size:14}),e.jsxs("span",{children:[y.urgentMaterialRequests," Urgent"]})]}),e.jsxs("div",{className:"reports-material-status pending",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[y?.pendingMaterialRequests||0," Pending"]})]}),e.jsxs("div",{className:"reports-material-status ordered",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[y?.orderedMaterialRequests||0," Ordered"]})]}),e.jsxs("div",{className:"reports-material-status delivered",children:[e.jsx(CheckCircle2,{size:14}),e.jsxs("span",{children:[y?.deliveredMaterialRequests||0," Delivered"]})]})]}),e.jsx("div",{className:"reports-recent-list",children:(y?.materialRequests||[]).slice(0,3).map(S=>e.jsxs("div",{className:`reports-recent-item ${S.status}`,children:[e.jsxs("div",{className:"reports-recent-item-main",children:[e.jsx("span",{className:`reports-recent-item-status ${S.status}`,children:S.status}),e.jsx("span",{className:"reports-recent-item-date",children:new Date(S.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"reports-recent-item-detail",children:[(S.items||[]).slice(0,2).map((G,he)=>e.jsxs("span",{children:[G.name,G.quantity?` (${G.quantity})`:""]},he)),(S.items||[]).length>2&&e.jsxs("span",{className:"reports-recent-more",children:["+",(S.items||[]).length-2," more"]})]}),S.priority==="urgent"&&e.jsx("span",{className:"reports-urgent-tag",children:"URGENT"})]},S.id))})]})})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Ke,{size:18}),e.jsx("h3",{children:"Disposal Trends"})]}),e.jsxs("span",{className:"reports-section-count",children:[y?.disposalTotalLoads||0," loads"]})]}),e.jsx("div",{className:"reports-insight-body",children:(y?.weeklyDisposal||[]).length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Ke,{size:32}),e.jsx("p",{children:"No disposal data yet"}),e.jsx("span",{children:"Disposal loads from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-disposal-chart",children:[e.jsx("div",{className:"reports-disposal-bars",children:(y?.weeklyDisposal||[]).map((S,G)=>{const he=(S.concrete||0)+(S.trash||0)+(S.metals||0)+(S.hazardous_waste||0),Oe=Math.max(...(y?.weeklyDisposal||[]).map(Se=>(Se.concrete||0)+(Se.trash||0)+(Se.metals||0)+(Se.hazardous_waste||0)))||1;return e.jsxs("div",{className:"reports-disposal-bar-col",children:[e.jsxs("div",{className:"reports-disposal-bar-stack",style:{height:`${he/Oe*100}%`},children:[S.concrete>0&&e.jsx("div",{className:"reports-disposal-seg concrete",style:{flex:S.concrete},title:`Concrete: ${S.concrete}`}),S.trash>0&&e.jsx("div",{className:"reports-disposal-seg trash",style:{flex:S.trash},title:`Trash: ${S.trash}`}),S.metals>0&&e.jsx("div",{className:"reports-disposal-seg metals",style:{flex:S.metals},title:`Metals: ${S.metals}`}),S.hazardous_waste>0&&e.jsx("div",{className:"reports-disposal-seg hazardous",style:{flex:S.hazardous_waste},title:`Hazardous: ${S.hazardous_waste}`})]}),e.jsx("span",{className:"reports-disposal-bar-label",children:new Date(S.week+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},G)})}),e.jsxs("div",{className:"reports-disposal-legend",children:[e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot concrete"}),"Concrete"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot trash"}),"Trash"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot metals"}),"Metals"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot hazardous"}),"Hazardous"]})]})]}),(y?.haulOffCost||0)>0&&e.jsxs("div",{className:"reports-disposal-cost",children:[e.jsx("span",{children:"Total Disposal Cost"}),e.jsx("strong",{children:pe(y.haulOffCost)})]})]})})]})]}),e.jsxs("div",{className:"reports-insight-card reports-activity-summary",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(be,{size:18}),e.jsx("h3",{children:"Field Activity Summary"})]}),e.jsx("div",{className:"reports-activity-badges",children:y?.lastDailyReport&&e.jsxs("span",{className:"reports-last-filed",children:["Last report: ",new Date(y.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ","(",Math.floor((new Date-new Date(y.lastDailyReport))/(1e3*60*60*24)),"d ago)"]})})]}),e.jsx("div",{className:"reports-insight-body",children:e.jsxs("div",{className:"reports-activity-grid",children:[e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(be,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.dailyReportsCount||0}),e.jsx("span",{children:"Daily Reports Filed"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(rs,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.totalTickets||0}),e.jsx("span",{children:"T&M Tickets Created"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Camera,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.totalPhotosFromTickets||0}),e.jsx("span",{children:"Photos Documented"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(He,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsxs("strong",{children:[y?.completedAreasCount||0,"/",x.length]}),e.jsx("span",{children:"Work Areas Complete"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(ps,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:pe(y?.allCostsTotal||0)}),e.jsx("span",{children:"Total Costs Tracked"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Users,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.laborManDays||0}),e.jsx("span",{children:"Total Man-Days"})]})]})]})})]}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(be,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[y?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(Pr,{project:c,company:s,onShowToast:a})})})]}),e.jsxs("div",{className:`reports-section-card ${(y?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(y?.injuryReportsCount||0)>0?"warning":"success"}`,children:(y?.injuryReportsCount||0)>0?"⚠":"✓"}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(y?.injuryReportsCount||0)>0?"warning":"success"}`,children:(y?.injuryReportsCount||0)>0?`${y.injuryReportsCount} incident${y.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(Rr,{project:c,companyId:s?.id||c?.company_id,company:s,user:t,onShowToast:a})})})]})]}),F==="documents"&&e.jsx("div",{className:"pv-tab-panel documents-tab",children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(Ac,{project:c,companyId:s?.id||c?.company_id,onShowToast:a,userRole:t?.access_level||"office"})})}),F==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:c.name}),c.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",c.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:Vt,children:e.jsx("span",{children:"Edit Project"})})]}),c.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(MapPin,{size:14}),e.jsx("span",{children:c.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(He,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:c.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(rs,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:c.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ps,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:pe(O)}),e.jsx("span",{className:"info-quick-label",children:q>0?`Incl. +${pe(q)} COs`:"Contract Value"})]})]}),c.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:c.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Building2,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[c.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:c.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),c.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:c.client_contact})]}),c.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(Phone,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${c.client_phone}`,className:"info-detail-value link",children:c.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Ra,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[le>0&&e.jsxs("span",{className:"info-badge done",children:[le," Done"]}),oe>0&&e.jsxs("span",{className:"info-badge working",children:[oe," Active"]}),ce>0&&e.jsxs("span",{className:"info-badge pending",children:[ce," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:x.map(S=>e.jsxs("div",{className:`info-area-item ${S.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[S.status==="done"&&e.jsx("span",{className:"status-dot done",children:"✓"}),S.status==="working"&&e.jsx("span",{className:"status-dot working",children:"●"}),S.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:"○"})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:S.name}),e.jsx("span",{className:`info-area-status-label ${S.status}`,children:S.status==="done"?"Complete":S.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[S.weight,"%"]})]},S.id))})]}),e.jsx(wc,{project:c,company:s,user:t,isAdmin:r,onShowToast:a}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(Ls,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:pe(c.contract_value)})]}),q>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",pe(q)]})]}),c.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:K.find(S=>S.id===c.default_dump_site_id)?.name||"Unknown"})]})]})]}),e.jsx("div",{className:"info-section-card",children:e.jsx(Cc,{onShowToast:a})})]})]}),I&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(kc,{project:c,user:t,onClose:()=>B(!1),onShareCreated:S=>{a("Share link created successfully!","success")}})}),R&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(o.Suspense,{fallback:null,children:e.jsx(_c,{project:c,company:s,onShowToast:a,onClose:()=>_(!1)})})}),Q&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Sc,{project:c,company:s,areas:x,existingCOR:re,onClose:()=>{ee(!1),je(null)},onSaved:()=>{ee(!1),je(null),Pe(S=>S+1)},onShowToast:a})}),Xe&&se&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Dc,{cor:se,project:c,company:s,areas:x,onClose:()=>{Ee(!1),Ae(null)},onEdit:S=>{Ee(!1),Ae(null),je(S),ee(!0)},onShowToast:a,onStatusChange:()=>{}})}),De==="log"&&c&&e.jsx("div",{className:"cor-log-modal-overlay",onClick:()=>$("list"),children:e.jsxs("div",{className:"cor-log-modal",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"cor-log-modal-header",children:[e.jsx("h2",{children:"Change Order Log"}),e.jsx("button",{className:"cor-log-modal-close",onClick:()=>$("list"),title:"Close",children:"✕"})]}),e.jsx("div",{className:"cor-log-modal-content",children:e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:e.jsx(Ec,{project:c,company:s,onShowToast:a})})})]})}),Qs&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Tc,{onClose:()=>ke(!1),saving:Cs,onSave:async S=>{try{cs(!0),await W.addProjectCost(c.id,s.id,S),ke(!1),us(),a("Cost added successfully","success")}catch(G){console.error("Error adding cost:",G),a("Error adding cost","error")}finally{cs(!1)}}})}),Tr&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Rc,{project:c,company:s,user:t,editItem:$t,onSave:()=>{ks(!1),_s(null),Or(S=>S+1),a($t?"Equipment updated":"Equipment added","success")},onClose:()=>{ks(!1),_s(null)}})}),Fr&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Pc,{project:c,company:s,areas:x,corStats:u.find(S=>S.id===c?.id)?.corStats,editDrawRequest:It,onSave:()=>{Ss(!1),Ds(null),$r(S=>S+1),a(It?"Draw request updated":"Draw request created","success")},onClose:()=>{Ss(!1),Ds(null)}})})]})}return l.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(be,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("button",{className:"search-trigger-btn",onClick:()=>zr(!0),children:[e.jsx(or,{size:16}),e.jsx("span",{children:"Search"}),e.jsx("span",{className:"shortcut",children:"⌘K"})]}),e.jsxs("div",{className:"bo-project-count",children:[l.length," Active Project",l.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(bn,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:pe(jn)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:pe(vn)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:pe(gn)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Kt>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:pe(fn)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",Zt," project",Zt!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",pe(Kt)]})]})]}),Gt>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:pe(yn)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",Gt," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[Yt>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:Yt}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),Jt>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Jt}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Xt>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:Xt}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),Qt>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:Qt}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),Nn&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[ea>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:ea}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),sa>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:sa}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),ta>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:ta}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),wn&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),ra>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[ra," under"]}),na>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[na," on track"]}),aa>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[aa," over"]})]})]})]}),Qe.allAlerts.length>0&&e.jsxs("div",{className:"smart-alerts-section",style:{marginBottom:"var(--space-lg, 1.5rem)"},children:[e.jsxs("div",{className:"smart-alerts-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"var(--space-sm, 0.5rem)"},children:[e.jsxs("h3",{style:{fontSize:"var(--font-size-md, 1rem)",fontWeight:"var(--font-weight-semibold, 600)",color:"var(--text-primary)",margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:["Needs Attention",Qe.criticalCount>0&&e.jsxs("span",{style:{padding:"2px 8px",fontSize:"0.75rem",fontWeight:600,borderRadius:"9999px",background:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"},children:[Qe.criticalCount," critical"]}),e.jsx(Go,{preferences:ge.preferences,snoozedCount:ge.snoozedCount})]}),e.jsx(Ko,{preferences:ge.preferences,onToggleCategory:ge.toggleCategory,onSetSeverity:ge.setMinimumSeverity,onSetSnoozeDuration:ge.setSnoozeDuration,onResetDefaults:ge.resetToDefaults,onClearSnoozes:ge.clearAllSnoozes,snoozedCount:ge.snoozedCount})]}),e.jsx(qo,{alerts:Qe.filteredAlerts,totalUnfiltered:Qe.allAlerts.length,onAction:en,onSnooze:ge.snoozeAlert,snoozeDurationLabel:Hs[ge.preferences.snoozeDuration]?.label,maxVisible:5})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[l.length," active"]})]}),e.jsx("div",{className:"project-list",children:u.map(g=>{const M=Qe.projectRisks.find(q=>q.projectId===g.id);return e.jsx(Fc,{project:g,riskScore:M?.riskScore,riskStatus:M?.riskStatus,onClick:()=>Ps(g)},g.id)})}),e.jsx(zo,{isOpen:Ir,onClose:Lr,companyId:s?.id,onSelectProject:g=>{Ps(g)},onSelectTicket:g=>{const M=l.find(q=>q.id===g.project_id);M&&(Ps(M),L("financials"),V("tickets"))},onSelectCOR:g=>{const M=l.find(q=>q.id===g.project_id);M&&(Ps(M),L("financials"),V("cors"),Ae(g),Ee(!0))},onShowToast:a})]})}function Fc({project:s,riskScore:t,riskStatus:r,onClick:a}){const n=Gi(s.areas||[]),i=Yi(s.areas||[]),l=s.contract_value-s.billable,d=s.billable>s.contract_value*.9&&s.progress<90,u={healthy:{bg:"var(--status-success-bg, #064e3b)",color:"var(--status-success, #059669)"},warning:{bg:"var(--status-warning-bg, #78350f)",color:"var(--status-warning, #d97706)"},critical:{bg:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"}},h=u[r]||u.healthy;return e.jsxs("div",{className:`project-card enhanced ${d?"at-risk":""}`,onClick:a,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[typeof t=="number"&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,background:h.bg,color:h.color},title:`Risk Score: ${t}`,"aria-label":`Risk score ${t}, ${r}`,children:t}),e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:s.name}),e.jsx("div",{className:"project-card-value",children:pe(s.contract_value)})]})]}),e.jsx("span",{className:`status-badge ${n}`,children:i})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[s.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:pe(s.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${l<0?"negative":""}`,children:pe(Math.abs(l))}),e.jsx("span",{className:"stat-label",children:l>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${s.progress}%`}})}),(s.pendingTickets>0||s.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[s.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[s.pendingTickets," Pending T&M"]}),s.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[s.approvedTickets," Approved T&M"]})]}),s.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${s.scheduleStatus}`,children:s.scheduleLabel}),s.hasLaborData&&s.laborLabel&&e.jsx("span",{className:`labor-indicator ${s.laborStatus}`,children:s.laborLabel})]})]})}const Bc=Object.freeze(Object.defineProperty({__proto__:null,default:Oc},Symbol.toStringTag,{value:"Module"}));export{bo as A,sc as C,Bc as D,Ve as T,xs as a,qc as b,Vc as c,Lc as e};
//# sourceMappingURL=Dashboard-Bokdow8T.js.map
