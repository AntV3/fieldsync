const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/safeXlsx-F6PERwMH.js","assets/pdf-Dbgi5wV4.js"])))=>i.map(i=>d[i]);
import{_ as be}from"./pdf-Dbgi5wV4.js";import{as as e,aF as et,ar as y,aG as Ee,aH as tt}from"./index-Da6Ug3b9.js";import{r as i,a4 as ze,aS as at,n as st,y as lt,P as nt,c as rt,ac as ot,D as it,v as ke,F as Fe,O as ct,aR as dt,aQ as ut,s as Ce,X as ne,aT as ht,h as mt,$ as pt,C as Pe}from"./icons-BDU0tZd_.js";import{k as gt,f,a as xt,b as bt}from"./corCalculations-vdJc_BOT.js";import{C as Ct,a as ft}from"./Dashboard-Dap7f_CW.js";import{u as jt,C as _t,P as vt}from"./CORLog-D9fZDhx3.js";import"./react-DXGY7bZi.js";import"./supabase-VuevzHjS.js";const Nt=i.memo(function({cor:r,isSelected:D,selectMode:V,areas:g,onToggleSelect:R,onView:X,onEdit:re,onDelete:b,onSubmitForApproval:G}){const O=gt(r.status),oe=["draft","pending_approval","approved"].includes(r.status),w=["draft","pending_approval","rejected"].includes(r.status),o=r.status==="draft",Y=d=>g?.find(I=>I.id===d)?.name||"No Area",q=()=>{V?R(r.id):X?.(r)},ie=d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),q())};return e.jsxs("div",{className:`cor-card hover-lift animate-fade-in-up ${r.status} ${D?"selected":""}`,onClick:q,onKeyDown:ie,tabIndex:0,role:"button","aria-label":`${V?D?"Deselect":"Select":"View"} COR ${r.cor_number}: ${r.title||"Untitled"}, ${O.label}, ${f(r.cor_total||0)}`,children:[e.jsxs("div",{className:"cor-card-header",children:[e.jsxs("div",{className:"cor-card-left",children:[V&&e.jsx("button",{className:"cor-select-checkbox",onClick:d=>{d.stopPropagation(),R(r.id,d)},"aria-label":D?"Deselect":"Select",children:D?e.jsx(ze,{size:18}):e.jsx(at,{size:18})}),e.jsx("span",{className:"cor-number",children:r.cor_number}),e.jsx("span",{className:"cor-status-badge",style:{backgroundColor:O.bgColor,color:O.color},children:O.label}),(r.gc_signature_data||r.client_signature_data)&&e.jsxs("span",{className:"cor-signed-badge",title:`Signed by ${r.gc_signature_name||r.client_signature_name||"Client"}`,children:[e.jsx(st,{size:12})," Signed"]})]}),e.jsx("div",{className:"cor-card-right",children:e.jsx("span",{className:"cor-total",children:f(r.cor_total||0)})})]}),e.jsxs("div",{className:"cor-card-body",children:[e.jsx("h4",{className:"cor-title",children:r.title||"Untitled COR"}),e.jsxs("div",{className:"cor-meta",children:[r.group_name&&e.jsx("span",{className:"cor-group-badge",children:r.group_name}),r.area_id&&e.jsx("span",{className:"cor-area",children:Y(r.area_id)}),e.jsx("span",{className:"cor-period",children:xt(r.period_start,r.period_end)})]})]}),e.jsxs("div",{className:"cor-card-footer",children:[e.jsx("span",{className:"cor-created",children:bt(r.created_at)}),e.jsxs("div",{className:"cor-actions",onClick:d=>d.stopPropagation(),children:[o&&e.jsx("button",{className:"cor-action-btn submit",onClick:d=>G(r.id,d),title:"Submit for Approval","aria-label":`Submit COR ${r.cor_number} for approval`,children:e.jsx(lt,{size:14,"aria-hidden":"true"})}),oe&&e.jsx("button",{className:"cor-action-btn edit",onClick:d=>{d.stopPropagation(),re?.(r)},title:"Edit","aria-label":`Edit COR ${r.cor_number}`,children:e.jsx(nt,{size:14,"aria-hidden":"true"})}),e.jsx("button",{className:"cor-action-btn view",onClick:d=>{d.stopPropagation(),X?.(r)},title:"View Details","aria-label":`View COR ${r.cor_number} details`,children:e.jsx(rt,{size:14,"aria-hidden":"true"})}),w&&e.jsx("button",{className:"cor-action-btn delete",onClick:d=>b(r.id,d),title:"Delete","aria-label":`Delete COR ${r.cor_number}`,children:e.jsx(ot,{size:14,"aria-hidden":"true"})})]})]})]})}),H={draft:{label:"Draft",color:[107,114,128],bgColor:[243,244,246]},pending_approval:{label:"Pending Approval",color:[217,119,6],bgColor:[254,243,199]},approved:{label:"Approved",color:[5,150,105],bgColor:[209,250,229]},rejected:{label:"Rejected",color:[220,38,38],bgColor:[254,226,226]},billed:{label:"Billed",color:[37,99,235],bgColor:[219,234,254]},closed:{label:"Closed",color:[75,85,99],bgColor:[229,231,235]}};function At({project:h,company:r,areas:D,refreshKey:V,onShowToast:g,onCreateCOR:R,onViewCOR:X,onEditCOR:re,previewMode:b=!1,previewLimit:G=5,onViewAll:O,onDisplayModeChange:oe}){const{branding:w}=et(),[o,Y]=i.useState([]),[q,ie]=i.useState(!0),[d,fe]=i.useState("all"),[I,St]=i.useState("all"),[Q,Ae]=i.useState("all"),[yt,Dt]=i.useState(null),[E,ce]=i.useState(new Set),[B,de]=i.useState(!1),[Le,k]=i.useState(!1),[J,ue]=i.useState(""),[K,Z]=i.useState(!1),he=i.useRef(null);i.useEffect(()=>{const t=s=>{he.current&&!he.current.contains(s.target)&&Z(!1)};return K&&document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[K]);const[W,$e]=i.useState("list"),ee=t=>{$e(t),oe?.(t)},[v,je]=i.useState(b?"all":"recent"),[me,_e]=i.useState(new Set),[j,te]=i.useState({start:"",end:""}),[ve,Te]=i.useState(null),F=i.useCallback(async()=>{try{const t=await y.getCORs(h.id);Y(t||[])}catch(t){console.error("Error loading CORs:",t),g?.("Error loading change order requests","error")}finally{ie(!1)}},[h.id]),N=i.useCallback(async()=>{try{const t=await y.getCORStats?.(h.id);Te(t)}catch(t){console.error("Error loading COR stats:",t)}},[h.id]);i.useEffect(()=>{F(),N();const t=y.subscribeToCORs?.(h.id,()=>{F(),N()});return()=>{t&&y.unsubscribe?.(t)}},[h.id,V,F,N]);const Ve=async()=>{if(o.length===0){g?.("No CORs to export","error");return}g?.("Generating Excel report...","info");try{const{loadXLSXSafe:t}=await be(async()=>{const{loadXLSXSafe:l}=await import("./safeXlsx-F6PERwMH.js");return{loadXLSXSafe:l}},__vite__mapDeps([0,1])),s=await t(),a=o.filter(l=>l.status==="approved"),c=o.filter(l=>["draft","pending_approval"].includes(l.status)),z=o.filter(l=>l.status==="rejected"),p=o.filter(l=>l.status==="billed"),_=o.reduce((l,m)=>l+(m.cor_total||0),0)/100,A=a.reduce((l,m)=>l+(m.cor_total||0),0)/100,S=c.reduce((l,m)=>l+(m.cor_total||0),0)/100,x=s.utils.book_new(),le=[["CHANGE ORDER REQUEST SUMMARY"],[],["Company:",r?.name||""],["Project:",h.name],["Job Number:",h.job_number||"N/A"],["Report Date:",new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})],[],["FINANCIAL OVERVIEW"],[],["Category","Count","Value"],["Total CORs",o.length,_],["Approved",a.length,A],["Pending Approval",c.length,S],["Rejected",z.length,z.reduce((l,m)=>l+(m.cor_total||0),0)/100],["Billed",p.length,p.reduce((l,m)=>l+(m.cor_total||0),0)/100],[],["CONTRACT IMPACT"],[],["Original Contract Value:",h.contract_value||0],["Total Approved CORs:",A],["Revised Contract Value:",(h.contract_value||0)+A],["Pending COR Value:",S],["Potential Total:",(h.contract_value||0)+A+S]],U=s.utils.aoa_to_sheet(le);U["!cols"]=[{wch:25},{wch:15},{wch:18}],s.utils.book_append_sheet(x,U,"Summary");const pe=["COR #","Title","Description","Amount","Status","Created Date","Submitted Date","Approved Date","Approved By","Work Period Start","Work Period End","Area"],L=o.map(l=>[l.cor_number||"",l.title||"Untitled",l.scope_of_work||"",(l.cor_total||0)/100,H[l.status]?.label||l.status,l.created_at?new Date(l.created_at).toLocaleDateString():"",l.submitted_at?new Date(l.submitted_at).toLocaleDateString():"",l.approved_at?new Date(l.approved_at).toLocaleDateString():"",l.approved_by_name||"",l.period_start?new Date(l.period_start).toLocaleDateString():"",l.period_end?new Date(l.period_end).toLocaleDateString():"",l.area?.name||""]),$=s.utils.aoa_to_sheet([pe,...L]);$["!cols"]=[{wch:10},{wch:30},{wch:40},{wch:14},{wch:16},{wch:12},{wch:12},{wch:12},{wch:18},{wch:12},{wch:12},{wch:15}];for(let l=1;l<=L.length;l++){const m=s.utils.encode_cell({r:l,c:3});$[m]&&($[m].z="$#,##0.00")}s.utils.book_append_sheet(x,$,"COR Details"),[{name:"Approved CORs",data:a,status:"approved"},{name:"Pending CORs",data:c,status:"pending"}].forEach(({name:l,data:m})=>{if(m.length>0){const ge=[["COR #","Title","Amount","Date"],...m.map(u=>[u.cor_number||"",u.title||"Untitled",(u.cor_total||0)/100,u.created_at?new Date(u.created_at).toLocaleDateString():""]),[],["TOTAL","",m.reduce((u,C)=>u+(C.cor_total||0),0)/100,""]],n=s.utils.aoa_to_sheet(ge);n["!cols"]=[{wch:12},{wch:40},{wch:14},{wch:12}],s.utils.book_append_sheet(x,n,l)}});const we=`COR_Report_${h.job_number||h.name}_${new Date().toISOString().split("T")[0]}.xlsx`;s.writeFile(x,we),g?.("Excel report exported successfully","success")}catch(t){console.error("Export error:",t),g?.("Export failed","error")}},Ge=async()=>{if(o.length===0){g?.("No CORs to export","error");return}g?.("Generating PDF report...","info");try{const{default:t}=await be(async()=>{const{default:n}=await import("./pdf-Dbgi5wV4.js").then(u=>u.j);return{default:n}},[]),{default:s}=await be(async()=>{const{default:n}=await import("./pdf-Dbgi5wV4.js").then(u=>u.b);return{default:n}},[]),a=new t("landscape"),c=a.internal.pageSize.width,z=a.internal.pageSize.height,p=15,_=Ee(w?.primary_color||"#3B82F6"),A=Ee(w?.secondary_color||"#1E40AF");a.setFillColor(..._),a.rect(0,0,c,40,"F"),a.setFillColor(...A),a.rect(0,38,c,3,"F");let S=p;if(w?.logo_url)try{const n=await tt(w.logo_url);n&&(a.addImage(n,"PNG",p,6,28,28),S=p+35)}catch(n){console.error("Logo load error:",n)}a.setTextColor(255,255,255),a.setFontSize(20),a.setFont("helvetica","bold"),a.text(r?.name||"Company",S,18),a.setFontSize(11),a.setFont("helvetica","normal"),a.text("CHANGE ORDER REQUEST REPORT",S,28),a.setFontSize(9),a.text(new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}),c-p,15,{align:"right"}),h.job_number&&a.text(`Job #: ${h.job_number}`,c-p,23,{align:"right"}),a.text(`${o.length} Change Orders`,c-p,31,{align:"right"});let x=50;a.setFillColor(248,250,252),a.setDrawColor(..._),a.setLineWidth(.5),a.roundedRect(p,x,c-p*2,25,3,3,"FD"),a.setTextColor(..._),a.setFontSize(14),a.setFont("helvetica","bold"),a.text(h.name,p+8,x+10),a.setTextColor(100,116,139),a.setFontSize(9),a.setFont("helvetica","normal"),h.address&&a.text(h.address,p+8,x+18),x+=35;const le=o.filter(n=>n.status==="approved"),U=o.filter(n=>["draft","pending_approval"].includes(n.status)),pe=o.reduce((n,u)=>n+(u.cor_total||0),0),L=le.reduce((n,u)=>n+(u.cor_total||0),0),$=U.reduce((n,u)=>n+(u.cor_total||0),0),T=(c-p*2-30)/4;[{label:"Total CORs",value:o.length.toString(),subValue:f(pe)},{label:"Approved",value:le.length.toString(),subValue:f(L),color:[5,150,105]},{label:"Pending",value:U.length.toString(),subValue:f($),color:[217,119,6]},{label:"Revised Contract",value:f((h.contract_value||0)*100+L),subValue:`+${f(L)} from original`,color:_}].forEach((n,u)=>{const C=p+u*(T+10),xe=n.color||_,Ke=xe.map(Ze=>Math.min(255,Ze+200));a.setFillColor(...Ke),a.setDrawColor(...xe),a.roundedRect(C,x,T,32,2,2,"FD"),a.setTextColor(...xe),a.setFontSize(18),a.setFont("helvetica","bold"),a.text(n.value,C+T/2,x+14,{align:"center"}),a.setTextColor(100,116,139),a.setFontSize(8),a.setFont("helvetica","normal"),a.text(n.label,C+T/2,x+22,{align:"center"}),n.subValue&&(a.setFontSize(7),a.text(n.subValue,C+T/2,x+28,{align:"center"}))}),x+=42,a.setTextColor(..._),a.setFontSize(11),a.setFont("helvetica","bold"),a.text("CHANGE ORDER DETAILS",p,x),x+=5;const l=o.map((n,u)=>{const C=H[n.status]||{label:n.status,color:[107,114,128]};return[(u+1).toString(),n.cor_number||"-",n.title||"Untitled",f(n.cor_total||0),C.label,n.created_at?new Date(n.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"}):"-"]});s(a,{startY:x,head:[["#","COR #","Description","Amount","Status","Date"]],body:l,theme:"grid",styles:{fontSize:9,cellPadding:4,lineColor:[226,232,240],lineWidth:.1},headStyles:{fillColor:_,textColor:[255,255,255],fontStyle:"bold",halign:"center"},columnStyles:{0:{cellWidth:12,halign:"center"},1:{cellWidth:25,halign:"center"},2:{cellWidth:"auto"},3:{cellWidth:30,halign:"right",fontStyle:"bold"},4:{cellWidth:28,halign:"center"},5:{cellWidth:28,halign:"center"}},alternateRowStyles:{fillColor:[248,250,252]},didParseCell:n=>{if(n.column.index===4&&n.section==="body"){const u=Object.keys(H).find(C=>H[C].label===n.cell.raw);u&&(n.cell.styles.textColor=H[u].color,n.cell.styles.fontStyle="bold")}}});const m=z-12;a.setDrawColor(226,232,240),a.setLineWidth(.5),a.line(p,m-5,c-p,m-5),a.setTextColor(148,163,184),a.setFontSize(8),a.setFont("helvetica","normal"),a.text(`Generated on ${new Date().toLocaleString()}`,p,m),a.text(`${r?.name||"FieldSync"} â€¢ Confidential`,c/2,m,{align:"center"}),a.text("Page 1 of 1",c-p,m,{align:"right"});const ge=`COR_Report_${h.job_number||h.name}_${new Date().toISOString().split("T")[0]}.pdf`;a.save(ge),g?.("PDF report exported successfully","success")}catch(t){console.error("Export error:",t),g?.("Export failed","error")}},Ie=i.useCallback(async(t,s)=>{if(s?.stopPropagation(),!!confirm("Are you sure you want to delete this COR? This action cannot be undone."))try{await y.deleteCOR(t),Y(a=>a.filter(c=>c.id!==t)),g?.("COR deleted","success"),N()}catch(a){console.error("Error deleting COR:",a),g?.("Error deleting COR","error")}},[N]),Be=i.useCallback(async(t,s)=>{s?.stopPropagation();try{await y.submitCORForApproval(t),await F(),g?.("COR submitted for approval","success"),N()}catch(a){console.error("Error submitting COR:",a?.message||a),g?.(a?.message||"Error submitting COR","error")}},[F,N]),We=i.useCallback((t,s)=>{s?.stopPropagation(),ce(a=>{const c=new Set(a);return c.has(t)?c.delete(t):c.add(t),c})},[]),Me=()=>{de(!1),ce(new Set)},Ne=async()=>{if(!J.trim()){g?.("Please enter a group name","error");return}try{await y.bulkUpdateCORGroup([...E],J.trim()),g?.(`${E.size} CORs grouped as "${J.trim()}"`,"success"),k(!1),ue(""),ce(new Set),de(!1),F()}catch(t){console.error("Error grouping CORs:",t),g?.("Error grouping CORs","error")}},ae=i.useMemo(()=>{const t=o.map(s=>s.group_name).filter(Boolean);return[...new Set(t)].sort()},[o]),Se=i.useMemo(()=>{let t=[...o];if(d!=="all"&&(t=t.filter(s=>s.status===d)),I!=="all"&&(t=t.filter(s=>s.area_id===I)),Q!=="all"&&(t=t.filter(s=>s.group_name===Q)),j.start){const s=new Date(j.start);s.setHours(0,0,0,0),t=t.filter(a=>new Date(a.created_at)>=s)}if(j.end){const s=new Date(j.end);s.setHours(23,59,59,999),t=t.filter(a=>new Date(a.created_at)<=s)}if(v==="recent"&&!b){const s=new Date;s.setDate(s.getDate()-7),s.setHours(0,0,0,0),t=t.filter(a=>new Date(a.created_at)>=s)}return t.sort((s,a)=>new Date(a.created_at)-new Date(s.created_at)),b&&(t=t.slice(0,G)),t},[o,d,I,Q,v,j,b,G]),{paginatedItems:Ue,searchTerm:ye,setSearchTerm:De,currentPage:He,totalPages:Re,goToPage:Xe,pageSize:Ye,setPageSize:qe,totalItems:Qe}=jt(Se,{pageSize:25,searchFields:["title","cor_number","scope_of_work","status"]}),se=b?Se:Ue,P=i.useMemo(()=>{if(v!=="all")return null;const t={};return se.forEach(s=>{const a=new Date(s.created_at),c=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,z=a.toLocaleDateString("en-US",{month:"long",year:"numeric"});t[c]||(t[c]={label:z,cors:[],totalAmount:0}),t[c].cors.push(s),t[c].totalAmount+=s.cor_total||0}),Object.entries(t).sort((s,a)=>a[0].localeCompare(s[0]))},[se,v]);i.useEffect(()=>{if(P&&P.length>0){const t=P[0][0];_e(new Set([t]))}},[P]);const Je=t=>{const s=new Set(me);s.has(t)?s.delete(t):s.add(t),_e(s)},M=i.useMemo(()=>({all:o.length,draft:o.filter(t=>t.status==="draft").length,pending_approval:o.filter(t=>t.status==="pending_approval").length,approved:o.filter(t=>t.status==="approved").length,rejected:o.filter(t=>t.status==="rejected").length,billed:o.filter(t=>t.status==="billed").length,closed:o.filter(t=>t.status==="closed").length}),[o]);d==="all"?o.length:o.filter(t=>t.status===d).length;const Oe=t=>e.jsx(Nt,{cor:t,isSelected:E.has(t.id),selectMode:B,areas:D,onToggleSelect:We,onView:X,onEdit:re,onDelete:Ie,onSubmitForApproval:Be},t.id);return q?e.jsx("div",{className:"cor-list",children:e.jsx("div",{className:"cor-loading-skeletons",children:[1,2,3].map(t=>e.jsx(Ct,{},t))})}):e.jsxs("div",{className:`cor-list ${b?"cor-list-preview":""}`,children:[e.jsxs("div",{className:"cor-list-header",children:[e.jsxs("div",{className:"cor-list-info",children:[e.jsx("h3",{children:"Change Orders"}),e.jsxs("div",{className:"cor-stats-inline",children:[e.jsxs("span",{className:"cor-stat-item",children:[M.all," total"]}),M.pending_approval>0&&e.jsxs("span",{className:"cor-stat-item pending",children:[M.pending_approval," pending"]}),ve?.totalApproved>0&&e.jsx("span",{className:"cor-stat-item approved",children:f(ve.totalApproved)})]})]}),e.jsxs("div",{className:"cor-header-actions",children:[e.jsxs("div",{className:"cor-export-dropdown",ref:he,children:[e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>Z(!K),disabled:o.length===0,children:[e.jsx(it,{size:14})," Export ",e.jsx(ke,{size:12})]}),K&&e.jsxs("div",{className:"cor-export-menu",children:[e.jsxs("button",{onClick:()=>{Ge(),Z(!1)},children:[e.jsx(Fe,{size:14})," Export as PDF"]}),e.jsxs("button",{onClick:()=>{Ve(),Z(!1)},children:[e.jsx(ct,{size:14})," Export as Excel"]})]})]}),e.jsxs("div",{className:"cor-display-toggle",children:[e.jsxs("button",{className:`cor-display-btn ${W==="list"?"active":""}`,onClick:()=>ee("list"),title:"List View",children:[e.jsx(dt,{size:14}),e.jsx("span",{children:"List"})]}),e.jsxs("button",{className:`cor-display-btn log-btn ${W==="log"?"active":""}`,onClick:()=>ee("log"),title:"COR Log - Edit & Export for Clients",children:[e.jsx(ut,{size:14}),e.jsx("span",{children:"COR Log"})]})]}),b?e.jsx(e.Fragment,{children:e.jsxs("button",{className:"btn btn-primary btn-small",onClick:R,children:[e.jsx(Ce,{size:14})," New COR"]})}):e.jsxs(e.Fragment,{children:[W==="list"&&e.jsx("button",{className:`btn btn-secondary btn-small ${B?"active":""}`,onClick:()=>B?Me():de(!0),children:B?e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:14})," Cancel"]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{size:14})," Select"]})}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:R,children:[e.jsx(Ce,{size:14})," New COR"]})]})]})]}),W==="log"&&e.jsx("div",{className:"cor-log-modal-overlay",onClick:()=>ee("list"),children:e.jsxs("div",{className:"cor-log-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"cor-log-modal-header",children:[e.jsx("h2",{children:"Change Order Log"}),e.jsx("button",{className:"cor-log-modal-close",onClick:()=>ee("list"),title:"Close",children:e.jsx(ne,{size:24})})]}),e.jsx("div",{className:"cor-log-modal-content",children:e.jsx(_t,{project:h,company:r,onShowToast:g})})]})}),W==="list"&&e.jsxs(e.Fragment,{children:[B&&E.size>0&&e.jsxs("div",{className:"cor-selection-bar",children:[e.jsxs("span",{className:"selection-count",children:[E.size," selected"]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:()=>k(!0),children:[e.jsx(ht,{size:14})," Group Selected"]})]}),!b&&e.jsxs("div",{className:"cor-controls",children:[e.jsx("div",{className:"cor-filter-pills",role:"tablist",children:[{id:"all",label:"All"},{id:"draft",label:"Draft"},{id:"pending_approval",label:"Pending"},{id:"approved",label:"Approved"}].map(t=>e.jsxs("button",{role:"tab","aria-selected":d===t.id,className:`cor-pill ${d===t.id?"active":""}`,onClick:()=>fe(t.id),children:[t.label,M[t.id]>0&&e.jsx("span",{className:"cor-pill-count",children:M[t.id]})]},t.id))}),ae.length>0&&e.jsxs("select",{className:"cor-group-filter",value:Q,onChange:t=>Ae(t.target.value),children:[e.jsx("option",{value:"all",children:"All Groups"}),ae.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("div",{className:"cor-view-toggle",children:[e.jsx("button",{className:`cor-toggle-btn ${v==="recent"?"active":""}`,onClick:()=>{je("recent"),te({start:"",end:""})},children:"Recent"}),e.jsx("button",{className:`cor-toggle-btn ${v==="all"?"active":""}`,onClick:()=>je("all"),children:"All"})]})]}),!b&&e.jsxs("div",{className:"cor-search",children:[e.jsx(mt,{size:14,className:"cor-search-icon"}),e.jsx("input",{type:"text",className:"cor-search-input",placeholder:"Search CORs by title, number, scope, or status...",value:ye,onChange:t=>De(t.target.value)}),ye&&e.jsx("button",{className:"cor-search-clear",onClick:()=>De(""),children:e.jsx(ne,{size:14})})]}),v==="all"&&!b&&e.jsxs("div",{className:"cor-date-filter",children:[e.jsx(pt,{size:14}),e.jsx("input",{type:"date",value:j.start,onChange:t=>te(s=>({...s,start:t.target.value}))}),e.jsx("span",{className:"cor-date-sep",children:"to"}),e.jsx("input",{type:"date",value:j.end,onChange:t=>te(s=>({...s,end:t.target.value}))}),(j.start||j.end)&&e.jsx("button",{className:"cor-clear-btn",onClick:()=>te({start:"",end:""}),children:"Clear"})]}),se.length===0?e.jsxs("div",{className:"cor-empty",children:[e.jsx(Fe,{size:24,className:"cor-empty-icon"}),e.jsxs("p",{children:["No change orders ",d!=="all"?`(${d.replace("_"," ")})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:R,children:[e.jsx(Ce,{size:14})," Create COR"]})]}):e.jsx("div",{className:"cor-cards stagger-children",children:v==="all"&&P?P.map(([t,s])=>e.jsxs("div",{className:"cor-month-group animate-fade-in",children:[e.jsxs("button",{className:"cor-month-header",onClick:()=>Je(t),children:[e.jsxs("div",{className:"cor-month-left",children:[me.has(t)?e.jsx(ke,{size:16}):e.jsx(Pe,{size:16}),e.jsx("span",{children:s.label}),e.jsx(ft,{count:s.cors.length,size:"small"})]}),e.jsx("span",{className:"cor-month-total",children:f(s.totalAmount)})]}),me.has(t)&&e.jsx("div",{className:"cor-month-items stagger-children",children:s.cors.map(a=>Oe(a))})]},t)):se.map(t=>Oe(t))}),!b&&Re>1&&e.jsx(vt,{currentPage:He,totalPages:Re,onPageChange:Xe,pageSize:Ye,onPageSizeChange:qe,totalItems:Qe}),b&&o.length>G&&e.jsxs("button",{className:"cor-see-all-btn",onClick:O,children:["See all ",o.length," change orders",e.jsx(Pe,{size:16})]})]}),Le&&e.jsx("div",{className:"modal-overlay",onClick:()=>k(!1),children:e.jsxs("div",{className:"modal-content cor-group-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Group ",E.size," CORs"]}),e.jsx("button",{className:"close-btn",onClick:()=>k(!1),children:e.jsx(ne,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Group Name"}),e.jsx("input",{type:"text",value:J,onChange:t=>ue(t.target.value),placeholder:"e.g., Phase 1, Building A, Week 1",autoFocus:!0,onKeyDown:t=>{t.key==="Enter"&&Ne(),t.key==="Escape"&&k(!1)}})]}),ae.length>0&&e.jsxs("div",{className:"existing-groups",children:[e.jsx("label",{children:"Or select existing group:"}),e.jsx("div",{className:"group-chips",children:ae.map(t=>e.jsx("button",{className:"group-chip",onClick:()=>ue(t),children:t},t))})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>k(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:Ne,children:"Group CORs"})]})]})})]})}export{At as default};
//# sourceMappingURL=CORList-Bk8clyeZ.js.map
