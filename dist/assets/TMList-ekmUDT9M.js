import{_ as ot}from"./pdf-aQqpMATS.js";import{j as e,u as La,d as Q,k as Ft,l as $a}from"./index-BzQR2bAR.js";import{r as d,s as Dt,c as Ha,N as Wa,aa as qa,a as Ka,j as Xt,F as ht,a3 as Va,ap as Mt,f as Rt,T as Ua,H as Ga,W as Ya,g as Xa,aq as Za,R as Ja,af as Qa,ar as es,z as ts,_ as as,q as ss,y as zt,X as rs}from"./icons-BBuiljtY.js";import ns from"./SignatureLinkGenerator-DUdvHhAA.js";import{i as is,a as He,g as ct,b as dt,c as ls,d as Bt,S as os,e as he,s as cs,f as ds,h as _e,j as us,k as ve,l as je,m as xe,n as ye,o as Zt,p as Jt,q as Qt,r as ms,t as hs,u as Lt,v as ps,w as $t,x as vs,L as ze,y as xs,z as gs,D as pt,A as ea,R as fs,B as bs,C as js,Z as vt,E as ta,F as ys,G as _s,H as ks,I as Ns,J as aa,K as Be,M as sa,N as Cs,O as Ss,P as Ts,Q as Ps,T as Ht,U as ra,V as na,W as ia,X as la,Y as Is,_ as oa,$ as As,a0 as Os,a1 as me,a2 as ws,a3 as Es,a4 as Fs,a5 as Ds,a6 as Ms,a7 as Wt,a8 as Rs,a9 as zs,aa as it,ab as Bs,ac as Ls,ad as lt,ae as $s,af as qt,ag as Kt,ah as Hs,ai as Ws,aj as ca,ak as qs}from"./Dashboard-RUTtIO_-.js";import"./react-DXGY7bZi.js";import"./supabase-VuevzHjS.js";import"./corCalculations-D9qkkIbo.js";var Vt=(t,a,s)=>{var r=s??t;if(!He(r))return ct(r,a,0)},Ks=(t,a,s)=>{var r={},o=t.filter(is),l=t.filter(x=>x.stackId==null),u=o.reduce((x,k)=>(x[k.stackId]||(x[k.stackId]=[]),x[k.stackId].push(k),x),r),h=Object.entries(u).map(x=>{var[k,C]=x,T=C.map(w=>w.dataKey),y=Vt(a,s,C[0].barSize);return{stackId:k,dataKeys:T,barSize:y}}),g=l.map(x=>{var k=[x.dataKey].filter(T=>T!=null),C=Vt(a,s,x.barSize);return{stackId:void 0,dataKeys:k,barSize:C}});return[...h,...g]};function Ut(t,a){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),s.push.apply(s,r)}return s}function Re(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?Ut(Object(s),!0).forEach(function(r){Vs(t,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Ut(Object(s)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(s,r))})}return t}function Vs(t,a,s){return(a=Us(a))in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}function Us(t){var a=Gs(t,"string");return typeof a=="symbol"?a:a+""}function Gs(t,a){if(typeof t!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var r=s.call(t,a);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function Ys(t,a,s,r,o){var l=r.length;if(!(l<1)){var u=ct(t,s,0,!0),h,g=[];if(dt(r[0].barSize)){var x=!1,k=s/l,C=r.reduce((f,N)=>f+(N.barSize||0),0);C+=(l-1)*u,C>=s&&(C-=(l-1)*u,u=0),C>=s&&k>0&&(x=!0,k*=.9,C=l*k);var T=(s-C)/2>>0,y={offset:T-u,size:0};h=r.reduce((f,N)=>{var $,A={stackId:N.stackId,dataKeys:N.dataKeys,position:{offset:y.offset+y.size+u,size:x?k:($=N.barSize)!==null&&$!==void 0?$:0}},M=[...f,A];return y=M[M.length-1].position,M},g)}else{var w=ct(a,s,0,!0);s-2*w-(l-1)*u<=0&&(u=0);var I=(s-2*w-(l-1)*u)/l;I>1&&(I>>=0);var F=dt(o)?Math.min(I,o):I;h=r.reduce((f,N,$)=>[...f,{stackId:N.stackId,dataKeys:N.dataKeys,position:{offset:w+(I+u)*$+(I-F)/2,size:F}}],g)}return h}}var Xs=(t,a,s,r,o,l,u)=>{var h=He(u)?a:u,g=Ys(s,r,o!==l?o:l,t,h);return o!==l&&g!=null&&(g=g.map(x=>Re(Re({},x),{},{position:Re(Re({},x.position),{},{offset:x.position.offset-o/2})}))),g},Zs=(t,a)=>{var s=ls(a);if(!(!t||s==null||a==null)){var{stackId:r}=a;if(r!=null){var o=t[r];if(o){var{stackedData:l}=o;if(l)return l.find(u=>u.key===s)}}}};function Js(t,a){return t&&typeof t=="object"&&"zIndex"in t&&typeof t.zIndex=="number"&&dt(t.zIndex)?t.zIndex:a}var Qs=["children"];function er(t,a){if(t==null)return{};var s,r,o=tr(t,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(r=0;r<l.length;r++)s=l[r],a.indexOf(s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(o[s]=t[s])}return o}function tr(t,a){if(t==null)return{};var s={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(a.indexOf(r)!==-1)continue;s[r]=t[r]}return s}var ar={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},sr=d.createContext(ar);function rr(t){var{children:a}=t,s=er(t,Qs);return d.createElement(sr.Provider,{value:s},a)}var nr="Invariant failed";function ir(t,a){throw new Error(nr)}function ut(){return ut=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)({}).hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},ut.apply(null,arguments)}function Le(t){return d.createElement(os,ut({shapeType:"rectangle",activeClassName:"recharts-active-bar"},t))}var lr=function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(r,o)=>{if(Bt(a))return a;var l=Bt(r)||He(r);return l?a(r,o):(l||ir(),s)}},or=(t,a,s)=>s,cr=(t,a)=>a,we=he([Jt,cr],(t,a)=>t.filter(s=>s.type==="bar").find(s=>s.id===a)),dr=he([we],t=>t?.maxBarSize),ur=(t,a,s,r)=>r,mr=he([_e,Jt,ve,xe,or],(t,a,s,r,o)=>a.filter(l=>t==="horizontal"?l.xAxisId===s:l.yAxisId===r).filter(l=>l.isPanorama===o).filter(l=>l.hide===!1).filter(l=>l.type==="bar")),hr=(t,a,s)=>{var r=_e(t),o=ve(t,a),l=xe(t,a);if(!(o==null||l==null))return r==="horizontal"?Lt(t,"yAxis",l,s):Lt(t,"xAxis",o,s)},pr=(t,a)=>{var s=_e(t),r=ve(t,a),o=xe(t,a);if(!(r==null||o==null))return s==="horizontal"?$t(t,"xAxis",r):$t(t,"yAxis",o)},vr=he([mr,ps,pr],Ks),xr=(t,a,s)=>{var r,o,l=we(t,a);if(l!=null){var u=ve(t,a),h=xe(t,a);if(!(u==null||h==null)){var g=_e(t),x=Qt(t),{maxBarSize:k}=l,C=He(k)?x:k,T,y;return g==="horizontal"?(T=je(t,"xAxis",u,s),y=ye(t,"xAxis",u,s)):(T=je(t,"yAxis",h,s),y=ye(t,"yAxis",h,s)),(r=(o=Zt(T,y,!0))!==null&&o!==void 0?o:C)!==null&&r!==void 0?r:0}}},da=(t,a,s)=>{var r=_e(t),o=ve(t,a),l=xe(t,a);if(!(o==null||l==null)){var u,h;return r==="horizontal"?(u=je(t,"xAxis",o,s),h=ye(t,"xAxis",o,s)):(u=je(t,"yAxis",l,s),h=ye(t,"yAxis",l,s)),Zt(u,h)}},gr=he([vr,Qt,ms,hs,xr,da,dr],Xs),fr=(t,a,s)=>{var r=ve(t,a);if(r!=null)return je(t,"xAxis",r,s)},br=(t,a,s)=>{var r=xe(t,a);if(r!=null)return je(t,"yAxis",r,s)},jr=(t,a,s)=>{var r=ve(t,a);if(r!=null)return ye(t,"xAxis",r,s)},yr=(t,a,s)=>{var r=xe(t,a);if(r!=null)return ye(t,"yAxis",r,s)},_r=he([gr,we],(t,a)=>{if(!(t==null||a==null)){var s=t.find(r=>r.stackId===a.stackId&&a.dataKey!=null&&r.dataKeys.includes(a.dataKey));if(s!=null)return s.position}}),kr=he([hr,we],Zs),Nr=he([cs,ds,fr,br,jr,yr,_r,_e,us,da,kr,we,ur],(t,a,s,r,o,l,u,h,g,x,k,C,T)=>{var{chartData:y,dataStartIndex:w,dataEndIndex:I}=g;if(!(C==null||u==null||a==null||h!=="horizontal"&&h!=="vertical"||s==null||r==null||o==null||l==null||x==null)){var{data:F}=C,f;if(F!=null&&F.length>0?f=F:f=y?.slice(w,I+1),f!=null)return Qr({layout:h,barSettings:C,pos:u,parentViewBox:a,bandSize:x,xAxis:s,yAxis:r,xAxisTicks:o,yAxisTicks:l,stackedData:k,displayedData:f,offset:t,cells:T,dataStartIndex:w})}}),Cr=["index"];function mt(){return mt=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)({}).hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},mt.apply(null,arguments)}function Sr(t,a){if(t==null)return{};var s,r,o=Tr(t,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(r=0;r<l.length;r++)s=l[r],a.indexOf(s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(o[s]=t[s])}return o}function Tr(t,a){if(t==null)return{};var s={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(a.indexOf(r)!==-1)continue;s[r]=t[r]}return s}var ua=d.createContext(void 0),Pr=t=>{var a=d.useContext(ua);if(a!=null)return a.stackId;if(t!=null)return vs(t)},Ir=(t,a)=>"recharts-bar-stack-clip-path-".concat(t,"-").concat(a),Ar=t=>{var a=d.useContext(ua);if(a!=null){var{stackId:s}=a;return"url(#".concat(Ir(s,t),")")}},Or=t=>{var{index:a}=t,s=Sr(t,Cr),r=Ar(a);return d.createElement(ze,mt({className:"recharts-bar-stack-layer",clipPath:r},s))},wr=["onMouseEnter","onMouseLeave","onClick"],Er=["value","background","tooltipPosition"],Fr=["id"],Dr=["onMouseEnter","onClick","onMouseLeave"];function le(){return le=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)({}).hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},le.apply(null,arguments)}function Gt(t,a){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),s.push.apply(s,r)}return s}function Z(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?Gt(Object(s),!0).forEach(function(r){Mr(t,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Gt(Object(s)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(s,r))})}return t}function Mr(t,a,s){return(a=Rr(a))in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}function Rr(t){var a=zr(t,"string");return typeof a=="symbol"?a:a+""}function zr(t,a){if(typeof t!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var r=s.call(t,a);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function $e(t,a){if(t==null)return{};var s,r,o=Br(t,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(r=0;r<l.length;r++)s=l[r],a.indexOf(s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(o[s]=t[s])}return o}function Br(t,a){if(t==null)return{};var s={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(a.indexOf(r)!==-1)continue;s[r]=t[r]}return s}var Lr=t=>{var{dataKey:a,name:s,fill:r,legendType:o,hide:l}=t;return[{inactive:l,dataKey:a,type:o,color:r,value:ta(s,a),payload:t}]},$r=d.memo(t=>{var{dataKey:a,stroke:s,strokeWidth:r,fill:o,name:l,hide:u,unit:h,tooltipType:g,id:x}=t,k={dataDefinedOnItem:void 0,positions:void 0,settings:{stroke:s,strokeWidth:r,fill:o,dataKey:a,nameKey:void 0,name:ta(l,a),hide:u,type:g,color:o,unit:h,graphicalItemId:x}};return d.createElement(ys,{tooltipEntrySettings:k})});function Hr(t){var a=Be(ra),{data:s,dataKey:r,background:o,allOtherBarProps:l}=t,{onMouseEnter:u,onMouseLeave:h,onClick:g}=l,x=$e(l,wr),k=na(u,r,l.id),C=ia(h),T=la(g,r,l.id);if(!o||s==null)return null;var y=Is(o);return d.createElement(vt,{zIndex:Js(o,pt.barBackground)},s.map((w,I)=>{var{value:F,background:f,tooltipPosition:N}=w,$=$e(w,Er);if(!f)return null;var A=k(w,I),M=C(w,I),p=T(w,I),V=Z(Z(Z(Z(Z({option:o,isActive:String(I)===a},$),{},{fill:"#eee"},f),y),oa(x,w,I)),{},{onMouseEnter:A,onMouseLeave:M,onClick:p,dataKey:r,index:I,className:"recharts-bar-background-rectangle"});return d.createElement(Le,le({key:"background-bar-".concat(I)},V))}))}function Wr(t){var{showLabels:a,children:s,rects:r}=t,o=r?.map(l=>{var u={x:l.x,y:l.y,width:l.width,lowerWidth:l.width,upperWidth:l.width,height:l.height};return Z(Z({},u),{},{value:l.value,payload:l.payload,parentViewBox:l.parentViewBox,viewBox:u,fill:l.fill})});return d.createElement(Es,{value:a?o:void 0},s)}function qr(t){var{shape:a,activeBar:s,baseProps:r,entry:o,index:l,dataKey:u}=t,h=Be(ra),g=Be(Ds),x=s&&String(l)===h&&(g==null||u===g),k=x?s:a;return x?d.createElement(vt,{zIndex:pt.activeBar},d.createElement(Le,le({},r,{name:String(r.name)},o,{isActive:x,option:k,index:l,dataKey:u}))):d.createElement(Le,le({},r,{name:String(r.name)},o,{isActive:x,option:k,index:l,dataKey:u}))}function Kr(t){var{shape:a,baseProps:s,entry:r,index:o,dataKey:l}=t;return d.createElement(Le,le({},s,{name:String(s.name)},r,{isActive:!1,option:a,index:o,dataKey:l}))}function Vr(t){var a,{data:s,props:r}=t,o=(a=Fs(r))!==null&&a!==void 0?a:{},{id:l}=o,u=$e(o,Fr),{shape:h,dataKey:g,activeBar:x}=r,{onMouseEnter:k,onClick:C,onMouseLeave:T}=r,y=$e(r,Dr),w=na(k,g,l),I=ia(T),F=la(C,g,l);return s?d.createElement(d.Fragment,null,s.map((f,N)=>d.createElement(Or,le({index:N,key:"rectangle-".concat(f?.x,"-").concat(f?.y,"-").concat(f?.value,"-").concat(N),className:"recharts-bar-rectangle"},oa(y,f,N),{onMouseEnter:w(f,N),onMouseLeave:I(f,N),onClick:F(f,N)}),x?d.createElement(qr,{shape:h,activeBar:x,baseProps:u,entry:f,index:N,dataKey:g}):d.createElement(Kr,{shape:h,baseProps:u,entry:f,index:N,dataKey:g})))):null}function Ur(t){var{props:a,previousRectanglesRef:s}=t,{data:r,layout:o,isAnimationActive:l,animationBegin:u,animationDuration:h,animationEasing:g,onAnimationEnd:x,onAnimationStart:k}=a,C=s.current,T=As(a,"recharts-bar-"),[y,w]=d.useState(!1),I=!y,F=d.useCallback(()=>{typeof x=="function"&&x(),w(!1)},[x]),f=d.useCallback(()=>{typeof k=="function"&&k(),w(!0)},[k]);return d.createElement(Wr,{showLabels:I,rects:r},d.createElement(Os,{animationId:T,begin:u,duration:h,isActive:l,easing:g,onAnimationEnd:F,onAnimationStart:f,key:T},N=>{var $=N===1?r:r?.map((A,M)=>{var p=C&&C[M];if(p)return Z(Z({},A),{},{x:me(p.x,A.x,N),y:me(p.y,A.y,N),width:me(p.width,A.width,N),height:me(p.height,A.height,N)});if(o==="horizontal"){var V=me(0,A.height,N),G=me(A.stackedBarStart,A.y,N);return Z(Z({},A),{},{y:G,height:V})}var z=me(0,A.width,N),Y=me(A.stackedBarStart,A.x,N);return Z(Z({},A),{},{width:z,x:Y})});return N>0&&(s.current=$??null),$==null?null:d.createElement(ze,null,d.createElement(Vr,{props:a,data:$}))}),d.createElement(ws,{label:a.label}),a.children)}function Gr(t){var a=d.useRef(null);return d.createElement(Ur,{previousRectanglesRef:a,props:t})}var ma=0,Yr=(t,a)=>{var s=Array.isArray(t.value)?t.value[1]:t.value;return{x:t.x,y:t.y,value:s,errorVal:sa(t,a)}};class Xr extends d.PureComponent{render(){var{hide:a,data:s,dataKey:r,className:o,xAxisId:l,yAxisId:u,needClip:h,background:g,id:x}=this.props;if(a||s==null)return null;var k=Cs("recharts-bar",o),C=x;return d.createElement(ze,{className:k,id:x},h&&d.createElement("defs",null,d.createElement(Ss,{clipPathId:C,xAxisId:l,yAxisId:u})),d.createElement(ze,{className:"recharts-bar-rectangles",clipPath:h?"url(#clipPath-".concat(C,")"):void 0},d.createElement(Hr,{data:s,dataKey:r,background:g,allOtherBarProps:this.props}),d.createElement(Gr,this.props)))}}var Zr={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",background:!1,hide:!1,isAnimationActive:"auto",label:!1,legendType:"rect",minPointSize:ma,xAxisId:0,yAxisId:0,zIndex:pt.bar};function Jr(t){var{xAxisId:a,yAxisId:s,hide:r,legendType:o,minPointSize:l,activeBar:u,animationBegin:h,animationDuration:g,animationEasing:x,isAnimationActive:k}=t,{needClip:C}=_s(a,s),T=ks(),y=ea(),w=Ns(t.children,aa),I=Be(N=>Nr(N,t.id,y,w));if(T!=="vertical"&&T!=="horizontal")return null;var F,f=I?.[0];return f==null||f.height==null||f.width==null?F=0:F=T==="vertical"?f.height/2:f.width/2,d.createElement(rr,{xAxisId:a,yAxisId:s,data:I,dataPointFormatter:Yr,errorBarOffset:F},d.createElement(Xr,le({},t,{layout:T,needClip:C,data:I,xAxisId:a,yAxisId:s,hide:r,legendType:o,minPointSize:l,activeBar:u,animationBegin:h,animationDuration:g,animationEasing:x,isAnimationActive:k})))}function Qr(t){var{layout:a,barSettings:{dataKey:s,minPointSize:r},pos:o,bandSize:l,xAxis:u,yAxis:h,xAxisTicks:g,yAxisTicks:x,stackedData:k,displayedData:C,offset:T,cells:y,parentViewBox:w,dataStartIndex:I}=t,F=a==="horizontal"?h:u,f=k?F.scale.domain():null,N=Ts({numericAxis:F}),$=F.scale(N);return C.map((A,M)=>{var p,V,G,z,Y,X;if(k){var _=k[M+I];if(_==null)return null;p=Ps(_,f)}else p=sa(A,s),Array.isArray(p)||(p=[N,p]);var S=lr(r,ma)(p[1],M);if(a==="horizontal"){var D,[H,B]=[h.scale(p[0]),h.scale(p[1])];V=Ht({axis:u,ticks:g,bandSize:l,offset:o.offset,entry:A,index:M}),G=(D=B??H)!==null&&D!==void 0?D:void 0,z=o.size;var R=H-B;if(Y=Ms(R)?0:R,X={x:V,y:T.top,width:z,height:T.height},Math.abs(S)>0&&Math.abs(Y)<Math.abs(S)){var ee=Wt(Y||S)*(Math.abs(S)-Math.abs(Y));G-=ee,Y+=ee}}else{var[ge,ke]=[u.scale(p[0]),u.scale(p[1])];if(V=ge,G=Ht({axis:h,ticks:x,bandSize:l,offset:o.offset,entry:A,index:M}),z=ke-ge,Y=o.size,X={x:T.left,y:G,width:T.width,height:Y},Math.abs(S)>0&&Math.abs(z)<Math.abs(S)){var pe=Wt(z||S)*(Math.abs(S)-Math.abs(z));z+=pe}}if(V==null||G==null||z==null||Y==null)return null;var We=Z(Z({},A),{},{stackedBarStart:$,x:V,y:G,width:z,height:Y,value:k?p:p[1],payload:A,background:X,tooltipPosition:{x:V+z/2,y:G+Y/2},parentViewBox:w},y&&y[M]&&y[M].props);return We}).filter(Boolean)}function en(t){var a=gs(t,Zr),s=Pr(a.stackId),r=ea();return d.createElement(fs,{id:a.id,type:"bar"},o=>d.createElement(d.Fragment,null,d.createElement(bs,{legendPayload:Lr(a)}),d.createElement($r,{dataKey:a.dataKey,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,name:a.name,hide:a.hide,unit:a.unit,tooltipType:a.tooltipType,id:o}),d.createElement(js,{type:"bar",id:o,data:void 0,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,dataKey:a.dataKey,stackId:s,hide:a.hide,barSize:a.barSize,minPointSize:a.minPointSize,maxBarSize:a.maxBarSize,isPanorama:r}),d.createElement(vt,{zIndex:a.zIndex},d.createElement(Jr,le({},a,{id:o})))))}var ha=d.memo(en,xs);ha.displayName="Bar";var tn=["axis","item"],an=d.forwardRef((t,a)=>d.createElement(Rs,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:tn,tooltipPayloadSearcher:zs,categoricalChartProps:t,ref:a}));function sn({tickets:t=[],laborRates:a={}}){const s=d.useMemo(()=>{if(!t.length)return{total:0,pending:0,approved:0,billed:0,rejected:0,totalHours:0,regularHours:0,overtimeHours:0,materialsCost:0,uniqueWorkers:0,avgHoursPerTicket:0,approvalRate:0,pendingValue:0,approvedValue:0,billedValue:0,workersByRole:{},topWorkers:[],byMonth:[],byStatus:[]};const l=t.filter(_=>_.status==="pending").length,u=t.filter(_=>_.status==="approved").length,h=t.filter(_=>_.status==="billed").length,g=t.filter(_=>_.status==="rejected").length;let x=0,k=0,C=0;const T={},y={Foreman:0,Superintendent:0,Operator:0,Laborer:0};t.forEach(_=>{_.t_and_m_workers&&_.t_and_m_workers.forEach(S=>{const D=parseFloat(S.hours)||0,H=parseFloat(S.overtime_hours)||0;k+=D,C+=H,x+=D+H;const B=S.name||"Unknown";T[B]||(T[B]={name:B,hours:0,role:S.role||"Laborer"}),T[B].hours+=D+H;const R=S.role||"Laborer";y[R]!==void 0?y[R]+=D+H:y[R]=D+H})});let w=0;t.forEach(_=>{_.t_and_m_items&&_.t_and_m_items.forEach(S=>{const D=S.materials_equipment?.cost_per_unit||0;w+=S.quantity*D})});const I=Object.keys(T).length,F=Object.values(T).sort((_,S)=>S.hours-_.hours).slice(0,5),f=u+h+g,N=f>0?Math.round((u+h)/f*100):0,A={...{Foreman:85,Superintendent:95,Operator:75,Laborer:55},...a},M=_=>{let S=0,D=0;return _.t_and_m_workers&&_.t_and_m_workers.forEach(H=>{const B=H.role||"Laborer",R=A[B]||A.Laborer,ee=parseFloat(H.hours)||0,ge=parseFloat(H.overtime_hours)||0;S+=ee*R+ge*R*1.5}),_.t_and_m_items&&_.t_and_m_items.forEach(H=>{const B=H.materials_equipment?.cost_per_unit||0;D+=H.quantity*B}),S+D},p=t.filter(_=>_.status==="pending").reduce((_,S)=>_+M(S),0),V=t.filter(_=>_.status==="approved").reduce((_,S)=>_+M(S),0),G=t.filter(_=>_.status==="billed").reduce((_,S)=>_+M(S),0),z={};t.forEach(_=>{const S=new Date(_.work_date),D=`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`,H=S.toLocaleDateString("en-US",{month:"short",year:"2-digit"});z[D]||(z[D]={month:H,monthKey:D,tickets:0,hours:0,cost:0,value:0}),z[D].tickets+=1,z[D].cost+=M(_)-w,_.t_and_m_workers&&_.t_and_m_workers.forEach(B=>{const R=parseFloat(B.hours)||0,ee=parseFloat(B.overtime_hours)||0;z[D].hours+=R+ee}),_.t_and_m_items&&_.t_and_m_items.forEach(B=>{const R=B.materials_equipment?.cost_per_unit||0;z[D].value+=B.quantity*R})});const Y=Object.values(z).sort((_,S)=>_.monthKey.localeCompare(S.monthKey)).slice(-6),X=[{name:"Pending",value:l,color:"#f59e0b"},{name:"Approved",value:u,color:"#10b981"},{name:"Billed",value:h,color:"#3b82f6"},{name:"Rejected",value:g,color:"#ef4444"}].filter(_=>_.value>0);return{total:t.length,pending:l,approved:u,billed:h,rejected:g,totalHours:x,regularHours:k,overtimeHours:C,materialsCost:w,uniqueWorkers:I,avgHoursPerTicket:t.length>0?x/t.length:0,approvalRate:N,pendingValue:p,approvedValue:V,billedValue:G,workersByRole:y,topWorkers:F,byMonth:Y,byStatus:X}},[t,a]),r=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),o=({active:l,payload:u,label:h})=>l&&u&&u.length?e.jsxs("div",{className:"tm-chart-tooltip",children:[e.jsx("p",{className:"tm-tooltip-label",children:h}),u.map((g,x)=>e.jsxs("p",{style:{color:g.color},children:[g.name,": ",g.name.includes("Cost")||g.name.includes("Value")?r(g.value):g.value.toFixed(1)]},x))]}):null;return t.length===0?e.jsxs("div",{className:"tm-dashboard tm-dashboard-empty",children:[e.jsx("div",{className:"tm-empty-icon",children:e.jsx(Dt,{size:48})}),e.jsx("p",{children:"No T&M tickets yet"}),e.jsx("p",{className:"tm-empty-hint",children:"Create tickets to see analytics and trends"})]}):e.jsxs("div",{className:"tm-dashboard",children:[e.jsxs("div",{className:"tm-summary-cards",children:[e.jsxs("div",{className:"tm-summary-card",children:[e.jsx("div",{className:"tm-card-icon tickets",children:e.jsx(Dt,{size:20})}),e.jsxs("div",{className:"tm-card-content",children:[e.jsx("span",{className:"tm-card-value",children:s.total}),e.jsx("span",{className:"tm-card-label",children:"Total Tickets"})]})]}),e.jsxs("div",{className:"tm-summary-card",children:[e.jsx("div",{className:"tm-card-icon hours",children:e.jsx(Ha,{size:20})}),e.jsxs("div",{className:"tm-card-content",children:[e.jsx("span",{className:"tm-card-value",children:s.totalHours.toFixed(1)}),e.jsx("span",{className:"tm-card-label",children:"Total Hours"}),s.overtimeHours>0&&e.jsxs("span",{className:"tm-card-detail",children:[s.overtimeHours.toFixed(1)," OT"]})]})]}),e.jsxs("div",{className:"tm-summary-card",children:[e.jsx("div",{className:"tm-card-icon workers",children:e.jsx(Wa,{size:20})}),e.jsxs("div",{className:"tm-card-content",children:[e.jsx("span",{className:"tm-card-value",children:s.uniqueWorkers}),e.jsx("span",{className:"tm-card-label",children:"Workers"})]})]}),e.jsxs("div",{className:"tm-summary-card",children:[e.jsx("div",{className:"tm-card-icon materials",children:e.jsx(qa,{size:20})}),e.jsxs("div",{className:"tm-card-content",children:[e.jsx("span",{className:"tm-card-value",children:r(s.materialsCost)}),e.jsx("span",{className:"tm-card-label",children:"Materials"})]})]})]}),e.jsxs("div",{className:"tm-status-cards",children:[e.jsxs("div",{className:"tm-status-card pending",children:[e.jsxs("div",{className:"tm-status-header",children:[e.jsx(Ka,{size:16}),e.jsx("span",{children:"Pending"})]}),e.jsx("div",{className:"tm-status-count",children:s.pending}),e.jsx("div",{className:"tm-status-value",children:r(s.pendingValue)})]}),e.jsxs("div",{className:"tm-status-card approved",children:[e.jsxs("div",{className:"tm-status-header",children:[e.jsx(Xt,{size:16}),e.jsx("span",{children:"Approved"})]}),e.jsx("div",{className:"tm-status-count",children:s.approved}),e.jsx("div",{className:"tm-status-value",children:r(s.approvedValue)})]}),e.jsxs("div",{className:"tm-status-card billed",children:[e.jsxs("div",{className:"tm-status-header",children:[e.jsx(ht,{size:16}),e.jsx("span",{children:"Billed"})]}),e.jsx("div",{className:"tm-status-count",children:s.billed}),e.jsx("div",{className:"tm-status-value",children:r(s.billedValue)})]}),e.jsxs("div",{className:"tm-status-card rate",children:[e.jsxs("div",{className:"tm-status-header",children:[e.jsx(Va,{size:16}),e.jsx("span",{children:"Approval Rate"})]}),e.jsxs("div",{className:"tm-status-count",children:[s.approvalRate,"%"]}),e.jsxs("div",{className:"tm-status-value",children:[s.approved+s.billed," / ",s.total-s.pending]})]})]}),e.jsxs("div",{className:"tm-charts-row",children:[s.byStatus.length>0&&e.jsxs("div",{className:"tm-chart-card",children:[e.jsx("h4",{className:"tm-chart-title",children:"Status Distribution"}),e.jsx("div",{className:"tm-chart-container",children:e.jsx(it,{width:"100%",height:200,children:e.jsxs(Bs,{children:[e.jsx(Ls,{data:s.byStatus,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",label:({name:l,percent:u})=>`${l} ${(u*100).toFixed(0)}%`,labelLine:!1,children:s.byStatus.map((l,u)=>e.jsx(aa,{fill:l.color},`cell-${u}`))}),e.jsx(lt,{})]})})}),e.jsx("div",{className:"tm-chart-legend",children:s.byStatus.map((l,u)=>e.jsxs("div",{className:"tm-legend-item",children:[e.jsx("span",{className:"tm-legend-color",style:{background:l.color}}),e.jsx("span",{className:"tm-legend-label",children:l.name}),e.jsx("span",{className:"tm-legend-value",children:l.value})]},u))})]}),s.byMonth.length>0&&e.jsxs("div",{className:"tm-chart-card wide",children:[e.jsx("h4",{className:"tm-chart-title",children:"Hours by Month"}),e.jsx("div",{className:"tm-chart-container",children:e.jsx(it,{width:"100%",height:200,children:e.jsxs(an,{data:s.byMonth,children:[e.jsx($s,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(qt,{dataKey:"month",tick:{fill:"var(--text-secondary)",fontSize:12},axisLine:{stroke:"var(--border-color)"}}),e.jsx(Kt,{tick:{fill:"var(--text-secondary)",fontSize:12},axisLine:{stroke:"var(--border-color)"}}),e.jsx(lt,{content:e.jsx(o,{})}),e.jsx(ha,{dataKey:"hours",name:"Hours",fill:"var(--primary-color)",radius:[4,4,0,0]})]})})})]})]}),e.jsxs("div",{className:"tm-charts-row",children:[e.jsxs("div",{className:"tm-chart-card",children:[e.jsx("h4",{className:"tm-chart-title",children:"Hours by Role"}),e.jsx("div",{className:"tm-role-breakdown",children:Object.entries(s.workersByRole).filter(([,l])=>l>0).sort((l,u)=>u[1]-l[1]).map(([l,u])=>{const h=u/s.totalHours*100;return e.jsxs("div",{className:"tm-role-bar",children:[e.jsxs("div",{className:"tm-role-info",children:[e.jsx("span",{className:"tm-role-name",children:l}),e.jsxs("span",{className:"tm-role-hours",children:[u.toFixed(1)," hrs"]})]}),e.jsx("div",{className:"tm-role-track",children:e.jsx("div",{className:"tm-role-fill",style:{width:`${h}%`}})})]},l)})})]}),s.topWorkers.length>0&&e.jsxs("div",{className:"tm-chart-card",children:[e.jsx("h4",{className:"tm-chart-title",children:"Top Workers"}),e.jsx("div",{className:"tm-top-workers",children:s.topWorkers.map((l,u)=>e.jsxs("div",{className:"tm-worker-row",children:[e.jsxs("span",{className:"tm-worker-rank",children:["#",u+1]}),e.jsxs("div",{className:"tm-worker-info",children:[e.jsx("span",{className:"tm-worker-name",children:l.name}),e.jsx("span",{className:"tm-worker-role",children:l.role})]}),e.jsxs("span",{className:"tm-worker-hours",children:[l.hours.toFixed(1)," hrs"]})]},l.name))})]}),s.byMonth.length>1&&e.jsxs("div",{className:"tm-chart-card",children:[e.jsx("h4",{className:"tm-chart-title",children:"Ticket Volume"}),e.jsx("div",{className:"tm-chart-container",children:e.jsx(it,{width:"100%",height:150,children:e.jsxs(Hs,{data:s.byMonth,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"ticketGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--primary-color)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--primary-color)",stopOpacity:0})]})}),e.jsx(qt,{dataKey:"month",tick:{fill:"var(--text-secondary)",fontSize:10},axisLine:!1,tickLine:!1}),e.jsx(Kt,{hide:!0}),e.jsx(lt,{content:e.jsx(o,{})}),e.jsx(Ws,{type:"monotone",dataKey:"tickets",name:"Tickets",stroke:"var(--primary-color)",fill:"url(#ticketGradient)",strokeWidth:2})]})})})]})]}),e.jsxs("div",{className:"tm-quick-stats",children:[e.jsxs("div",{className:"tm-quick-stat",children:[e.jsx("span",{className:"tm-quick-label",children:"Avg Hours/Ticket"}),e.jsx("span",{className:"tm-quick-value",children:s.avgHoursPerTicket.toFixed(1)})]}),e.jsxs("div",{className:"tm-quick-stat",children:[e.jsx("span",{className:"tm-quick-label",children:"Regular Hours"}),e.jsx("span",{className:"tm-quick-value",children:s.regularHours.toFixed(1)})]}),e.jsxs("div",{className:"tm-quick-stat",children:[e.jsx("span",{className:"tm-quick-label",children:"Overtime Hours"}),e.jsx("span",{className:"tm-quick-value",children:s.overtimeHours.toFixed(1)})]}),e.jsxs("div",{className:"tm-quick-stat",children:[e.jsx("span",{className:"tm-quick-label",children:"Total Est. Value"}),e.jsx("span",{className:"tm-quick-value",children:r(s.pendingValue+s.approvedValue+s.billedValue)})]})]})]})}const rn=d.memo(function({ticket:a,isExpanded:s,isSelected:r,isLocked:o,lockInfo:l,hasFailedImport:u,isRetrying:h,onToggleExpand:g,onToggleSelect:x,onApprove:k,onUpdateStatus:C,onDelete:T,onOpenCorAssign:y,onRetryImport:w,onShowSignatureLink:I,formatDate:F,calculateTotalHours:f,calculateTicketTotal:N}){const $=f(a),A=N(a),M=p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),g(a.id))};return e.jsxs("div",{className:`tm-ticket-card hover-lift animate-fade-in-up ${a.status} ${r?"selected":""} ${o?"locked":""}`,role:"article","aria-label":`T&M Ticket for ${F(a.work_date)}, ${$} hours, $${A.toFixed(2)}, status: ${a.status}`,children:[e.jsxs("div",{className:"tm-ticket-header",onClick:()=>g(a.id),onKeyDown:M,role:"button",tabIndex:0,"aria-expanded":s,"aria-label":`${s?"Collapse":"Expand"} ticket details`,children:[e.jsx("input",{type:"checkbox",checked:r,onChange:p=>x(a.id,p),onClick:p=>p.stopPropagation(),className:"tm-checkbox","aria-label":`Select ticket for ${F(a.work_date)}`}),e.jsxs("div",{className:"tm-ticket-info",children:[e.jsx("span",{className:"tm-ticket-date",children:F(a.work_date)}),a.ce_pco_number&&e.jsx("span",{className:"tm-ce-badge",children:a.ce_pco_number}),a.assigned_cor_id&&l?.lockedBy&&e.jsxs("span",{className:`tm-cor-badge ${o?"locked":""}`,title:l?.reason,children:[o&&e.jsx(Mt,{size:10}),l.lockedBy.cor_number]}),a.photos?.length>0&&e.jsx(ca,{count:a.photos.length,icon:Rt,size:"small",variant:"default"}),u&&e.jsxs("span",{className:"tm-import-failed-badge",title:"COR data import failed - retry needed",children:[e.jsx(Ua,{size:12})," Import Failed"]}),a.client_signature_data&&e.jsxs("span",{className:"tm-verified-badge",title:`Verified by ${a.client_signature_name||"client"}${a.client_signature_date?` on ${F(a.client_signature_date)}`:""}`,children:[e.jsx(Xt,{size:12})," Verified"]}),e.jsx("span",{className:`tm-ticket-status ${a.status}`,children:a.status})]}),e.jsxs("div",{className:"tm-ticket-summary",children:[e.jsxs("span",{className:"tm-ticket-hours",children:[$," hrs"]}),e.jsxs("span",{className:"tm-ticket-total",children:["$",A.toFixed(2)]}),e.jsx("span",{className:"tm-expand-arrow","aria-hidden":"true",children:s?"▼":"▶"})]})]}),s&&e.jsxs("div",{className:"tm-ticket-details",children:[a.t_and_m_workers?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Ga,{size:16,className:"inline-icon"})," Workers"]}),e.jsx("div",{className:"tm-detail-list",children:a.t_and_m_workers.map(p=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsxs("span",{children:[p.role&&p.role!=="Laborer"&&e.jsx("span",{className:"tm-role-badge",children:p.role}),p.name]}),e.jsxs("span",{children:[p.hours," hrs",parseFloat(p.overtime_hours)>0&&e.jsxs("span",{className:"tm-ot-badge",children:[" +",p.overtime_hours," OT"]})]})]},p.id))})]}),a.t_and_m_items?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Ya,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsx("div",{className:"tm-detail-list",children:a.t_and_m_items.map(p=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsx("span",{children:p.custom_name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"tm-custom-badge",children:"Custom"})," ",p.custom_name]}):p.materials_equipment?.name}),e.jsxs("span",{className:"tm-detail-qty",children:[p.quantity," ",p.materials_equipment?.unit||"each",p.materials_equipment?.cost_per_unit>0&&e.jsxs("span",{className:"tm-item-cost",children:["$",(p.quantity*p.materials_equipment.cost_per_unit).toFixed(2)]})]})]},p.id))})]}),a.notes&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(ht,{size:16,className:"inline-icon"})," Description"]}),e.jsx("p",{className:"tm-notes-text",children:a.notes})]}),a.photos&&a.photos.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Rt,{size:16,className:"inline-icon"})," Photos (",a.photos.length,")"]}),e.jsx("div",{className:"tm-photos-grid",children:a.photos.map((p,V)=>e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",className:"tm-photo-thumb",children:e.jsx("img",{src:p,alt:`Photo ${V+1}`,onError:G=>{G.target.onerror=null,G.target.classList.add("photo-error"),G.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=="}})},V))})]}),a.ce_pco_number&&a.change_order_value>0&&e.jsxs("div",{className:"tm-change-order-value",children:[e.jsx("span",{className:"tm-co-label",children:"Change Order Value:"}),e.jsxs("span",{className:"tm-co-amount",children:["$",a.change_order_value.toLocaleString()]})]}),o&&e.jsxs("div",{className:"tm-lock-notice",children:[e.jsx(Mt,{size:14}),e.jsx("span",{children:l?.reason||"This ticket is locked (COR approved)"})]}),e.jsxs("div",{className:"tm-ticket-actions",role:"group","aria-label":"Ticket actions",children:[a.status==="pending"&&!o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:p=>{p.stopPropagation(),k(a)},"aria-label":"Approve this ticket",children:"Approve"}),e.jsx("button",{className:"btn btn-warning btn-small",onClick:p=>{p.stopPropagation(),C(a.id,"rejected")},"aria-label":"Reject this ticket",children:"Reject"})]}),a.status==="approved"&&!o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary btn-small",onClick:p=>{p.stopPropagation(),C(a.id,"billed")},"aria-label":"Mark ticket as billed",children:"Mark Billed"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:p=>{p.stopPropagation(),I(a)},"aria-label":"Get signature link for this ticket",children:[e.jsx(Xa,{size:14,"aria-hidden":"true"})," Signature Link"]})]}),a.status==="rejected"&&!o&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:p=>{p.stopPropagation(),C(a.id,"pending")},"aria-label":"Restore rejected ticket to pending",children:"Restore"}),!o&&e.jsxs("button",{className:`btn btn-small ${a.assigned_cor_id?"btn-ghost":"btn-secondary"}`,onClick:p=>{p.stopPropagation(),y(a)},"aria-label":a.assigned_cor_id?"Change COR link":"Link to Change Order",children:[e.jsx(Za,{size:14,"aria-hidden":"true"})," ",a.assigned_cor_id?"COR":"Link COR"]}),u&&!o&&e.jsxs("button",{className:"btn btn-warning btn-small",onClick:p=>w(a,p),disabled:h,"aria-label":"Retry syncing data to COR","aria-busy":h,children:[e.jsx(Ja,{size:14,className:h?"spin":"","aria-hidden":"true"})," ",h?"Syncing...":"Retry Sync"]}),!o&&e.jsx("button",{className:"btn btn-danger btn-small",onClick:p=>{p.stopPropagation(),T(a.id)},"aria-label":"Delete this ticket",children:"Delete"})]})]})]})}),Yt=()=>ot(()=>import("./xlsx-BvJTHLik.js"),[]),nn=()=>Promise.all([ot(()=>import("./pdf-aQqpMATS.js").then(t=>t.j),[]),ot(()=>import("./pdf-aQqpMATS.js").then(t=>t.c),[])]);function xn({project:t,company:a,onShowToast:s,compact:r=!1,previewMode:o=!1,onViewAll:l}){const{branding:u}=La(),[h,g]=d.useState([]),[x,k]=d.useState(!0),[C,T]=d.useState(!1),[y,w]=d.useState("all"),[I,F]=d.useState(null),[f,N]=d.useState(new Set),[$,A]=d.useState(0),[M,p]=d.useState(!0),[V,G]=d.useState(0),z=25,Y=500,[X,_]=d.useState("recent"),[S,D]=d.useState(()=>{const n=localStorage.getItem("fieldsync-tm-default-view");return n==="list"||n==="dashboard"?n:"dashboard"}),[H,B]=d.useState(new Set),[R,ee]=d.useState({start:"",end:""}),[ge,ke]=d.useState(!1),[pe,We]=d.useState(null),[qe,xt]=d.useState(""),[pa,gt]=d.useState(!1),[Ne,ft]=d.useState(null),[va,Ce]=d.useState(!1),[se,bt]=d.useState(null),[Ee,xa]=d.useState([]),[Se,Ke]=d.useState(""),[jt,yt]=d.useState(!1),[te,ga]=d.useState({}),[fa,_t]=d.useState({}),[ba,kt]=d.useState(null);d.useEffect(()=>{g([]),A(0),p(!0),fe(0,!0);const n=Q.subscribeToTMTickets?.(t.id,()=>{fe(0,!0)});return()=>{n&&Q.unsubscribe?.(n)}},[t.id]),d.useEffect(()=>{r||localStorage.setItem("fieldsync-tm-default-view",S)},[S,r]),d.useEffect(()=>{if(!r){const n=localStorage.getItem("fieldsync-tm-default-view");D(n==="list"||n==="dashboard"?n:"dashboard")}},[r]);const fe=async(n=0,c=!1)=>{try{c?k(!0):T(!0);const b=await Q.getTMTicketsPaginated(t.id,{page:n,limit:z,status:y!=="all"?y:null});g(c?b.tickets:q=>{const i=[...q,...b.tickets];return i.length>Y?i.slice(-Y):i}),A(n),p(b.hasMore),G(b.totalCount);const O=b.tickets.filter(q=>q.assigned_cor_id);if(O.length>0){const q={},i={};await Promise.all(O.map(async E=>{const re=await Q.isTicketEditable(E);re.editable||(q[E.id]=re);try{const m=await Q.getTicketImportStatus(E.id,E.assigned_cor_id);m?.import_status==="failed"&&(i[E.id]=m)}catch{}})),ga(E=>c?q:{...E,...q}),_t(E=>c?i:{...E,...i})}}catch{s("Error loading T&M tickets","error")}finally{k(!1),T(!1)}},ja=()=>{!C&&M&&fe($+1,!1)};d.useEffect(()=>{t?.id&&(g([]),A(0),p(!0),fe(0,!0))},[y]);const Ve=d.useCallback(async(n,c)=>{if(te[n]){s(te[n].reason||"This ticket is locked (COR approved)","error");return}try{await Q.updateTMTicketStatus(n,c),g(b=>b.map(O=>O.id===n?{...O,status:c}:O)),s(`Ticket ${c}`,"success")}catch(b){console.error("Error updating status:",b),s("Error updating status","error")}},[te]),ya=d.useCallback(n=>{if(te[n.id]){s(te[n.id].reason||"This ticket is locked (COR approved)","error");return}Ve(n.id,"approved")},[te,Ve]),_a=async()=>{if(pe)try{const n=parseFloat(qe)||0;await Q.approveTMTicket(pe.id,null,null,n),g(h.map(c=>c.id===pe.id?{...c,status:"approved",change_order_value:n}:c)),s(`Ticket approved with $${n.toLocaleString()} change order`,"success"),ke(!1),We(null),xt("")}catch(n){console.error("Error approving ticket:",n),s("Error approving ticket","error")}},ka=d.useCallback(async n=>{if(te[n]){s(te[n].reason||"This ticket is locked (COR approved)","error");return}if(confirm("Delete this T&M ticket?"))try{await Q.deleteTMTicket(n),g(c=>c.filter(b=>b.id!==n)),s("Ticket deleted","success")}catch(c){console.error("Error deleting ticket:",c),s("Error deleting ticket","error")}},[te]),Na=d.useCallback(async n=>{bt(n),Ke(n.assigned_cor_id||""),Ce(!0),yt(!0);try{const c=await Q.getAssignableCORs(t.id);xa(c||[])}catch(c){console.error("Error loading CORs:",c),s("Error loading change orders","error")}finally{yt(!1)}},[t.id]),Ca=async()=>{if(se)try{if(Se){await Q.assignTicketToCOR(se.id,Se);const n=Ee.find(c=>c.id===Se);s(`Ticket linked to ${n?.cor_number||"COR"}`,"success")}else se.assigned_cor_id&&(await Q.unassignTicketFromCOR(se.id,se.assigned_cor_id),s("Ticket unlinked from COR","success"));fe(),Ce(!1),bt(null),Ke("")}catch(n){console.error("Error updating COR association:",n),s("Error updating COR link","error")}},Sa=d.useCallback(async(n,c)=>{if(c?.stopPropagation(),!!n.assigned_cor_id){kt(n.id);try{await Q.importTicketDataToCOR(n.id,n.assigned_cor_id,a.id,t.work_type||"demolition",t.job_type||"standard"),s("COR data import successful!","success"),_t(b=>{const O={...b};return delete O[n.id],O}),fe()}catch(b){console.error("Error retrying import:",b),s("Import retry failed. Please try again.","error")}finally{kt(null)}}},[a.id,t.work_type,t.job_type]),Te=n=>{let c=0;return n.t_and_m_items&&n.t_and_m_items.forEach(b=>{b.materials_equipment?.cost_per_unit&&(c+=b.quantity*b.materials_equipment.cost_per_unit)}),c},Pe=n=>n.t_and_m_workers?n.t_and_m_workers.reduce((c,b)=>{const O=parseFloat(b.hours)||0,q=parseFloat(b.overtime_hours)||0;return c+O+q},0):0,Fe=n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Ta=d.useCallback((n,c)=>{c?.stopPropagation(),N(b=>{const O=new Set(b);return O.has(n)?O.delete(n):O.add(n),O})},[]),Pa=d.useCallback(n=>{F(c=>c===n?null:n)},[]),Ia=d.useCallback(n=>{ft(n),gt(!0)},[]),Nt=()=>{const n=y==="all"?h:h.filter(b=>b.status===y),c=n.every(b=>f.has(b.id));N(c?new Set:new Set(n.map(b=>b.id)))},Ct=()=>{N(new Set)},St=()=>{const n=y==="all"?h:h.filter(c=>c.status===y);return f.size>0?n.filter(c=>f.has(c.id)):n},Aa=async()=>{const n=St();if(n.length===0){s("No tickets to export","error");return}s("Preparing Excel export...","info");const c=(await Yt()).default||await Yt(),b=[],O=[],q=[];n.forEach(m=>{const v=Fe(m.work_date),L=m.status;m.t_and_m_workers&&m.t_and_m_workers.forEach(U=>{const oe=parseFloat(U.hours)||0,ce=parseFloat(U.overtime_hours)||0;b.push({Date:v,Status:L,"Worker Name":U.name,Role:U.role||"Laborer","Regular Hours":oe,"OT Hours":ce,"Total Hours":oe+ce})}),m.t_and_m_items&&m.t_and_m_items.forEach(U=>{const oe=U.custom_name||U.materials_equipment?.name||"Unknown",ce=U.custom_category||U.materials_equipment?.category||"Unknown",Ge=U.materials_equipment?.unit||"each",De=U.materials_equipment?.cost_per_unit||0,Ye=U.quantity*De;O.push({Date:v,Status:L,Category:ce,Item:oe,Quantity:U.quantity,Unit:Ge,"Cost/Unit":De,Total:Ye})}),q.push({Date:v,Status:L,Workers:m.t_and_m_workers?.length||0,"Total Hours":Pe(m),Items:m.t_and_m_items?.length||0,"Materials Cost":Te(m),Notes:m.notes||""})});const i=c.utils.book_new(),E=c.utils.json_to_sheet(q);if(c.utils.book_append_sheet(i,E,"Summary"),b.length>0){const m=c.utils.json_to_sheet(b);c.utils.book_append_sheet(i,m,"Workers")}if(O.length>0){const m=c.utils.json_to_sheet(O);c.utils.book_append_sheet(i,m,"Materials & Equipment")}const re=`${t.name}_TM_${new Date().toISOString().split("T")[0]}.xlsx`;c.writeFile(i,re),s("Export downloaded!","success")},Oa=async()=>{const n=St();if(n.length===0){s("No tickets to export","error");return}s("Generating PDF...","info");const[c,b]=await nn(),O=c.default,q=b.default,i=new O,E=i.internal.pageSize.getWidth(),re=i.internal.pageSize.getHeight(),m=20;let v=m;const L=Ft(u?.primary_color||"#3B82F6"),U=Ft(u?.secondary_color||"#1E40AF");i.setFillColor(...L),i.rect(0,0,E,45,"F"),i.setFillColor(...U),i.rect(0,42,E,3,"F");let oe=m;if(u?.logo_url)try{const j=await $a(u.logo_url);j&&(i.addImage(j,"PNG",m,7,30,30),oe=m+30+10)}catch(j){console.error("Error adding logo:",j)}i.setTextColor(255,255,255),i.setFontSize(22),i.setFont("helvetica","bold"),i.text(a?.name||"Company Name",oe,20),i.setFontSize(10),i.setFont("helvetica","normal"),i.text("TIME & MATERIALS REPORT",oe,30),i.setFontSize(9),i.text(`Report Date: ${new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,E-m,18,{align:"right"}),t.job_number&&i.text(`Job #: ${t.job_number}`,E-m,26,{align:"right"}),i.text(`Status: ${y.charAt(0).toUpperCase()+y.slice(1)}`,E-m,34,{align:"right"}),v=55,i.setFillColor(248,250,252),i.rect(m,v-5,E-m*2,30,"F"),i.setDrawColor(...L),i.setLineWidth(.5),i.rect(m,v-5,E-m*2,30,"S"),i.setTextColor(...L),i.setFontSize(14),i.setFont("helvetica","bold"),i.text(`Project: ${t.name}`,m+5,v+7),i.setFontSize(10),i.setFont("helvetica","normal"),i.setTextColor(51,65,85);const ce=n.map(j=>new Date(j.work_date)).sort((j,P)=>j-P),Ge=ce[0]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),De=ce[ce.length-1]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});i.text(`Date Range: ${Ge} - ${De}`,m+5,v+17),i.text(`Total Tickets: ${n.length}`,E-m-5,v+7,{align:"right"}),v+=40;const Ye=n.reduce((j,P)=>j+Pe(P),0),It=n.reduce((j,P)=>j+Te(P),0),Ma=new Set(n.flatMap(j=>j.t_and_m_workers?.map(P=>P.name)||[])).size;i.setTextColor(...L),i.setFontSize(12),i.setFont("helvetica","bold"),i.text("SUMMARY",m,v),v+=8;const Ie=(E-m*2-20)/3,Ra=[{label:"Total Labor Hours",value:Ye.toFixed(1)},{label:"Unique Workers",value:Ma.toString()},{label:"Materials Cost",value:`$${It.toFixed(2)}`}],za=L.map(j=>Math.min(255,j+180));Ra.forEach((j,P)=>{const W=m+P*(Ie+10);i.setFillColor(...za),i.rect(W,v,Ie,25,"F"),i.setDrawColor(...L),i.setLineWidth(.5),i.rect(W,v,Ie,25,"S"),i.setTextColor(...L),i.setFontSize(16),i.setFont("helvetica","bold"),i.text(j.value,W+Ie/2,v+12,{align:"center"}),i.setTextColor(100,116,139),i.setFontSize(8),i.setFont("helvetica","normal"),i.text(j.label,W+Ie/2,v+20,{align:"center"})}),v+=35;const Xe=[],Ze=[],Je=[];let Qe=0,et=0,tt=0,at=0,st=0,rt=0;n.forEach(j=>{j.t_and_m_workers&&j.t_and_m_workers.forEach(P=>{const W=parseFloat(P.hours)||0,K=parseFloat(P.overtime_hours)||0,ue=P.role||"Laborer",ie=[Fe(j.work_date),P.name,W.toString(),K>0?K.toString():"-",(W+K).toString()];ue==="Foreman"||ue==="Superintendent"?(Xe.push(ie),Qe+=W,et+=K):ue==="Operator"?(Ze.push(ie),tt+=W,at+=K):(Je.push(ie),st+=W,rt+=K)})});const nt=(j,P,W,K)=>{P.length!==0&&(v>re-80&&(i.addPage(),v=m),i.setTextColor(...L),i.setFontSize(11),i.setFont("helvetica","bold"),i.text(j,m,v),v+=5,q(i,{startY:v,head:[["Date","Name","Reg Hrs","OT Hrs","Total"]],body:P,margin:{left:m,right:m},headStyles:{fillColor:L,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:30},2:{halign:"center",cellWidth:22},3:{halign:"center",cellWidth:22},4:{halign:"center",cellWidth:22}},foot:[["","SUBTOTAL:",W.toString(),K>0?K.toString():"-",(W+K).toString()]],footStyles:{fillColor:U,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),v=i.lastAutoTable.finalY+10)};if(Xe.length>0||Ze.length>0||Je.length>0){i.setTextColor(...L),i.setFontSize(12),i.setFont("helvetica","bold"),i.text("LABOR",m,v),v+=8,nt("SUPERVISION",Xe,Qe,et),nt("OPERATORS",Ze,tt,at),nt("LABORERS",Je,st,rt);const j=Qe+tt+st,P=et+at+rt;i.setFillColor(...L),i.rect(m,v,E-m*2,12,"F"),i.setTextColor(255,255,255),i.setFontSize(10),i.setFont("helvetica","bold"),i.text("LABOR TOTAL:",m+5,v+8),i.text(`${j} Reg + ${P} OT = ${j+P} Hours`,E-m-5,v+8,{align:"right"}),v+=20}v>re-100&&(i.addPage(),v=m);const de={},Me={},At=["Containment","PPE","Disposal","Equipment","Other"];n.forEach(j=>{j.t_and_m_items&&j.t_and_m_items.forEach(P=>{const W=P.custom_name||P.materials_equipment?.name||"Unknown",K=P.custom_category||P.materials_equipment?.category||"Other",ue=P.materials_equipment?.unit||"each",ie=P.materials_equipment?.cost_per_unit||0,Ae=P.quantity*ie;de[K]||(de[K]=[],Me[K]=0),de[K].push([Fe(j.work_date),W,P.quantity.toString(),ue,`$${ie.toFixed(2)}`,`$${Ae.toFixed(2)}`]),Me[K]+=Ae})});const Ot=(j,P,W)=>{!P||P.length===0||(v>re-80&&(i.addPage(),v=m),i.setTextColor(...L),i.setFontSize(11),i.setFont("helvetica","bold"),i.text(j.toUpperCase(),m,v),v+=5,q(i,{startY:v,head:[["Date","Item","Qty","Unit","Rate","Total"]],body:P,margin:{left:m,right:m},headStyles:{fillColor:L,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{2:{halign:"center",cellWidth:20},3:{halign:"center",cellWidth:25},4:{halign:"right",cellWidth:25},5:{halign:"right",cellWidth:30}},foot:[["","","","","Subtotal:",`$${W.toFixed(2)}`]],footStyles:{fillColor:U,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),v=i.lastAutoTable.finalY+10)};Object.keys(de).length>0&&(i.setTextColor(...L),i.setFontSize(12),i.setFont("helvetica","bold"),i.text("MATERIALS & EQUIPMENT",m,v),v+=8,At.forEach(j=>{de[j]&&Ot(j,de[j],Me[j])}),Object.keys(de).forEach(j=>{At.includes(j)||Ot(j,de[j],Me[j])}),i.setFillColor(...L),i.rect(m,v,E-m*2,12,"F"),i.setTextColor(255,255,255),i.setFontSize(10),i.setFont("helvetica","bold"),i.text("MATERIALS TOTAL:",m+5,v+8),i.text(`$${It.toFixed(2)}`,E-m-5,v+8,{align:"right"}),v+=20),v>re-80&&(i.addPage(),v=m),v+=10,i.setDrawColor(...L),i.setLineWidth(1),i.line(m,v,E-m,v),v+=15,i.setTextColor(...L),i.setFontSize(12),i.setFont("helvetica","bold"),i.text("AUTHORIZATION",m,v),v+=10,i.setFontSize(10),i.setFont("helvetica","normal"),i.setTextColor(71,85,105),i.text("I hereby authorize the above time and materials charges as accurate and approved for billing.",m,v),v+=20;const ne=n[0]||{},wt=(j,P,W,K,ue,ie,Ae)=>{i.setFont("helvetica","bold"),i.setFontSize(8),i.setTextColor(...L),i.text(P,m,j),i.setFont("helvetica","normal"),i.setFontSize(9),i.setTextColor(100,116,139);const J=j+18;if(i.setDrawColor(...U),i.setLineWidth(.5),i.line(m,J,m+70,J),i.text("Signature",m,J+8),i.line(m+85,J,m+145,J),i.text("Title / Company",m+85,J+8),i.line(E-m-40,J,E-m,J),i.text("Date",E-m-40,J+8),W)try{if(i.addImage(W,"PNG",m,J-16,60,16),K&&(i.setFontSize(8),i.text(K,m,J+15)),ue||ie){const Oe=[ue,ie].filter(Boolean).join(" - ");i.text(Oe,m+85,J-5)}if(Ae){const Oe=new Date(Ae).toLocaleDateString();i.text(Oe,E-m-40,J-5)}}catch(Oe){console.error("Error adding signature to PDF:",Oe)}return J+25};v=wt(v,"GC AUTHORIZATION",ne.gc_signature_data,ne.gc_signature_name,ne.gc_signature_title,ne.gc_signature_company,ne.gc_signature_date),v+=8,v=wt(v,"CLIENT AUTHORIZATION",ne.client_signature_data,ne.client_signature_name,ne.client_signature_title,ne.client_signature_company,ne.client_signature_date);const Et=i.internal.getNumberOfPages();for(let j=1;j<=Et;j++){i.setPage(j);const P=re-15;i.setFontSize(8),i.setTextColor(148,163,184),i.text(`${a?.name||"Company"} - T&M Report - ${t.name}`,m,P),i.text(`Page ${j} of ${Et}`,E-m,P,{align:"right"})}const Ba=`${t.name}_TM_Report_${new Date().toISOString().split("T")[0]}.pdf`;i.save(Ba),s("PDF exported!","success")},ae=d.useMemo(()=>{let n=y==="all"?[...h]:h.filter(c=>c.status===y);if(R.start){const c=new Date(R.start);c.setHours(0,0,0,0),n=n.filter(b=>new Date(b.work_date)>=c)}if(R.end){const c=new Date(R.end);c.setHours(23,59,59,999),n=n.filter(b=>new Date(b.work_date)<=c)}if(o){const c=new Date,b=c.getMonth(),O=c.getFullYear();n=n.filter(q=>{const i=new Date(q.work_date);return i.getMonth()===b&&i.getFullYear()===O})}else if(X==="recent"){const c=new Date;c.setDate(c.getDate()-7),c.setHours(0,0,0,0),n=n.filter(b=>new Date(b.work_date)>=c)}return n},[h,y,X,R,o]),be=d.useMemo(()=>{if(X!=="all")return null;const n={};return ae.forEach(c=>{const b=new Date(c.work_date),O=`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}`,q=b.toLocaleDateString("en-US",{month:"long",year:"numeric"});n[O]||(n[O]={label:q,tickets:[],hours:0,cost:0}),n[O].tickets.push(c),n[O].hours+=Pe(c),n[O].cost+=Te(c)}),Object.entries(n).sort((c,b)=>b[0].localeCompare(c[0]))},[ae,X]);d.useEffect(()=>{if(be&&be.length>0){const n=be[0][0];B(new Set([n]))}},[be]);const wa=n=>{const c=new Set(H);c.has(n)?c.delete(n):c.add(n),B(c)},Ea=ae.reduce((n,c)=>n+Pe(c),0),Fa=ae.reduce((n,c)=>n+Te(c),0),Tt=y==="all"?h.length:h.filter(n=>n.status===y).length;if(x)return e.jsx("div",{className:`tm-list ${r?"tm-list-compact":""}`,children:e.jsx("div",{className:"tm-loading-skeletons",children:[1,2,3].map(n=>e.jsx(qs,{},n))})});const Da=ae.length>0&&ae.every(n=>f.has(n.id)),Ue=f.size>0,Pt=n=>e.jsx(rn,{ticket:n,isExpanded:I===n.id,isSelected:f.has(n.id),isLocked:!!te[n.id],lockInfo:te[n.id],hasFailedImport:!!fa[n.id],isRetrying:ba===n.id,onToggleExpand:Pa,onToggleSelect:Ta,onApprove:ya,onUpdateStatus:Ve,onDelete:ka,onOpenCorAssign:Na,onRetryImport:Sa,onShowSignatureLink:Ia,formatDate:Fe,calculateTotalHours:Pe,calculateTicketTotal:Te},n.id);return e.jsxs("div",{className:`tm-list ${r?"tm-list-compact":""}`,children:[e.jsx("div",{className:"tm-list-header",children:e.jsxs("div",{className:"tm-list-title",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("div",{className:"tm-header-controls",children:[!r&&e.jsxs("div",{className:"tm-display-toggle",children:[e.jsxs("button",{className:`tm-display-btn ${S==="dashboard"?"active":""}`,onClick:()=>D("dashboard"),title:"Dashboard View",children:[e.jsx(Qa,{size:16})," Dashboard"]}),e.jsxs("button",{className:`tm-display-btn ${S==="list"?"active":""}`,onClick:()=>D("list"),title:"List View",children:[e.jsx(es,{size:16})," List"]})]}),e.jsxs("div",{className:"tm-export-buttons",children:[!r&&Ue&&e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:Ct,children:["Clear (",f.size,")"]}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:Aa,disabled:h.length===0,children:[e.jsx(ts,{size:14})," Excel ",!r&&Ue?`(${f.size})`:""]}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:Oa,disabled:h.length===0,children:[e.jsx(ht,{size:14})," PDF ",!r&&Ue?`(${f.size})`:""]})]})]})]})}),!r&&e.jsxs("div",{className:"tm-list-filters",children:[e.jsx("div",{className:"tm-filter-tabs",children:["all","pending","approved","billed","rejected"].map(n=>e.jsxs("button",{className:`tm-filter-tab ${y===n?"active":""}`,onClick:()=>{w(n),Ct()},children:[n.charAt(0).toUpperCase()+n.slice(1),e.jsx("span",{className:"tm-filter-count",children:n==="all"?h.length:h.filter(c=>c.status===n).length})]},n))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${X==="recent"?"active":""}`,onClick:()=>{_("recent"),ee({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${X==="all"?"active":""}`,onClick:()=>_("all"),children:["All (",Tt,")"]})]}),X==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(as,{size:16}),e.jsx("input",{type:"date",value:R.start,onChange:n=>ee(c=>({...c,start:n.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:R.end,onChange:n=>ee(c=>({...c,end:n.target.value})),placeholder:"End date"}),(R.start||R.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>ee({start:"",end:""}),children:"Clear"})]})]})]}),!r&&S==="dashboard"&&e.jsx(sn,{tickets:h}),S==="list"&&e.jsxs(e.Fragment,{children:[!r&&ae.length>0&&e.jsxs("div",{className:"tm-summary-bar",children:[e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Tickets"}),e.jsx("span",{className:"tm-summary-value",children:ae.length})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Total Hours"}),e.jsx("span",{className:"tm-summary-value",children:Ea.toFixed(1)})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Materials Cost"}),e.jsxs("span",{className:"tm-summary-value",children:["$",Fa.toFixed(2)]})]})]}),ae.length===0?e.jsxs("div",{className:"tm-empty-state",children:[e.jsxs("p",{children:["No ",y==="all"?"":y," T&M tickets",X==="recent"?" in the last 7 days":""]}),X==="recent"&&Tt>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>_("all"),children:"View All Tickets"})]}):e.jsxs("div",{className:"tm-tickets stagger-children",children:[e.jsx("div",{className:"tm-select-all-row",children:e.jsxs("label",{className:"tm-checkbox-label",onClick:Nt,children:[e.jsx("input",{type:"checkbox",checked:Da,onChange:Nt,className:"tm-checkbox"}),e.jsxs("span",{children:["Select All (",ae.length,")"]})]})}),X==="all"&&be?be.map(([n,c])=>e.jsxs("div",{className:"month-group animate-fade-in",children:[e.jsxs("div",{className:"month-header",onClick:()=>wa(n),children:[e.jsxs("div",{className:"month-header-left",children:[H.has(n)?e.jsx(ss,{size:18}):e.jsx(zt,{size:18}),e.jsx("span",{className:"month-label",children:c.label}),e.jsx(ca,{count:c.tickets.length,label:"tickets",size:"small"})]}),e.jsxs("div",{className:"month-header-right",children:[e.jsxs("span",{className:"month-stat",children:[c.hours.toFixed(1)," hrs"]}),e.jsxs("span",{className:"month-stat",children:["$",c.cost.toFixed(2)]})]})]}),H.has(n)&&e.jsx("div",{className:"month-tickets stagger-children",children:c.tickets.map(b=>Pt(b))})]},n)):ae.map(n=>Pt(n))]}),!o&&M&&!x&&h.length>0&&e.jsx("div",{className:"tm-load-more",children:e.jsx("button",{className:"btn btn-secondary",onClick:ja,disabled:C,children:C?"Loading...":`Load More (${h.length} of ${V})`})}),o&&h.length>0&&e.jsxs("button",{className:"tm-see-all-btn",onClick:l,children:["See all ",V||h.length," T&M tickets",e.jsx(zt,{size:16})]})]}),ge&&pe&&e.jsx("div",{className:"modal-overlay",onClick:()=>ke(!1),children:e.jsxs("div",{className:"modal change-order-modal",onClick:n=>n.stopPropagation(),children:[e.jsx("h3",{children:"Approve Change Order Work"}),e.jsxs("p",{className:"modal-subtitle",children:["This T&M ticket is associated with ",e.jsx("strong",{children:pe.ce_pco_number})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Change Order Value ($)"}),e.jsx("input",{type:"number",value:qe,onChange:n=>xt(n.target.value),placeholder:"Enter the change order amount",autoFocus:!0}),e.jsx("p",{className:"form-help",children:"This amount will be added to the project's total contract value."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>ke(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:_a,children:["Approve with $",parseFloat(qe||0).toLocaleString()]})]})]})}),pa&&Ne&&e.jsx(ns,{documentType:"tm_ticket",documentId:Ne.id,companyId:a?.id,projectId:t?.id,documentTitle:`T&M Ticket - ${new Date(Ne.work_date).toLocaleDateString()}${Ne.ce_pco_number?` (${Ne.ce_pco_number})`:""}`,onClose:()=>{gt(!1),ft(null)},onShowToast:s}),va&&se&&e.jsx("div",{className:"modal-overlay",onClick:()=>Ce(!1),children:e.jsxs("div",{className:"modal cor-assign-modal",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Link Ticket to Change Order"}),e.jsx("button",{className:"close-btn",onClick:()=>Ce(!1),children:e.jsx(rs,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{className:"modal-subtitle",children:["Ticket: ",e.jsx("strong",{children:new Date(se.work_date).toLocaleDateString()}),se.ce_pco_number&&` (${se.ce_pco_number})`]}),jt?e.jsx("div",{className:"loading",children:"Loading change orders..."}):Ee.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No change orders found for this project."}),e.jsx("p",{className:"text-muted",children:"Create a COR first, then link tickets to it."})]}):e.jsxs("div",{className:"cor-select-wrapper",children:[e.jsx("label",{children:"Select Change Order:"}),e.jsxs("select",{value:Se,onChange:n=>Ke(n.target.value),className:"cor-select",children:[e.jsx("option",{value:"",children:"-- No COR (unlink) --"}),Ee.map(n=>e.jsxs("option",{value:n.id,children:[n.cor_number," - ",n.title||"Untitled"," (",n.status,")"]},n.id))]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>Ce(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:Ca,disabled:jt||Ee.length===0,children:se.assigned_cor_id&&!Se?"Unlink from COR":"Link to COR"})]})]})})]})}export{xn as default};
//# sourceMappingURL=TMList-ekmUDT9M.js.map
