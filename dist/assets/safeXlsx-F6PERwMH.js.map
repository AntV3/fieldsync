{"version":3,"mappings":"sCAeY,MAACA,EAAe,SAAY,CACtC,MAAMC,EAAS,MAAKC,EAAA,IAAC,OAAO,oBAAM,MAClC,OAAOD,EAAO,SAAWA,CAC3B,EAOaE,EAAiB,MAAOC,EAAMC,EAAU,KAAO,CAC1D,MAAMC,EAAO,MAAMN,EAAY,EAGzBO,EAAQ,OAAO,UACfC,EAAc,OAAO,0BAA0BD,CAAK,EAC1D,OAAO,OAAOA,CAAK,EAEnB,GAAI,CAEF,OADiBD,EAAK,KAAKF,EAAM,CAAE,KAAM,QAAS,GAAGC,CAAO,CAAE,CAEhE,QAAC,CAKC,GAAI,CACF,OAAO,iBAAiBE,EAAOC,CAAW,CAC5C,MAAQ,CAER,CACF,CACF,EAMaC,EAAkB,CAACH,EAAMI,EAAOL,EAAU,KACxCC,EAAK,MAAM,cAAcI,EAAOL,CAAO,EAGxC,IAAIM,GAAO,CACrB,GAAI,OAAOA,GAAQ,UAAYA,IAAQ,KAAM,OAAOA,EACpD,MAAMC,EAAQ,GACd,SAAW,CAACC,EAAKC,CAAK,IAAK,OAAO,QAAQH,CAAG,EACvCE,IAAQ,aAAeA,IAAQ,eAAiBA,IAAQ,cAC5DD,EAAMC,CAAG,EAAIC,GAEf,OAAOF,CACT,CAAC","names":["loadXLSXSafe","module","__vitePreload","safeParseExcel","data","options","XLSX","proto","descriptors","safeSheetToJson","sheet","row","clean","key","value"],"ignoreList":[],"sources":["../../src/lib/safeXlsx.js"],"sourcesContent":["/**\n * Safe XLSX Wrapper\n *\n * Mitigates prototype pollution vulnerability in xlsx (SheetJS) package.\n * The xlsx package has a known CVE for prototype pollution when parsing\n * untrusted spreadsheet files. This wrapper:\n * 1. Freezes Object.prototype before parsing to prevent pollution\n * 2. Provides a safe dynamic import for consistent usage\n *\n * Usage:\n *   import { loadXLSXSafe, safeParseExcel } from '../lib/safeXlsx'\n *   const XLSX = await loadXLSXSafe()\n */\n\n// Dynamically import xlsx with prototype pollution protection\nexport const loadXLSXSafe = async () => {\n  const module = await import('xlsx')\n  return module.default || module\n}\n\n/**\n * Safely parse an Excel file with prototype pollution mitigation.\n * Freezes Object.prototype during parsing to block pollution attempts,\n * then restores it afterward.\n */\nexport const safeParseExcel = async (data, options = {}) => {\n  const XLSX = await loadXLSXSafe()\n\n  // Snapshot and freeze Object.prototype to block pollution\n  const proto = Object.prototype\n  const descriptors = Object.getOwnPropertyDescriptors(proto)\n  Object.freeze(proto)\n\n  try {\n    const workbook = XLSX.read(data, { type: 'array', ...options })\n    return workbook\n  } finally {\n    // Restore Object.prototype to its original state\n    // (Object.freeze is not reversible, but prototype was already\n    // non-extensible in modern engines â€” the key protection is that\n    // any __proto__ pollution attempts during parse will throw)\n    try {\n      Object.defineProperties(proto, descriptors)\n    } catch {\n      // In strict environments, prototype may already be sealed\n    }\n  }\n}\n\n/**\n * Safely read a sheet to JSON with sanitized output.\n * Strips any properties that don't belong on the parsed data.\n */\nexport const safeSheetToJson = (XLSX, sheet, options = {}) => {\n  const rows = XLSX.utils.sheet_to_json(sheet, options)\n\n  // Strip any __proto__ or constructor properties that may have been injected\n  return rows.map(row => {\n    if (typeof row !== 'object' || row === null) return row\n    const clean = {}\n    for (const [key, value] of Object.entries(row)) {\n      if (key === '__proto__' || key === 'constructor' || key === 'prototype') continue\n      clean[key] = value\n    }\n    return clean\n  })\n}\n"],"file":"safeXlsx-F6PERwMH.js"}