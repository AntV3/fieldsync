import{d as g,j as e}from"./index-CscNh3uR.js";import{r as t,X as B,g as O,c as N,d as w,b as C,aB as S,$ as I,a as P}from"./icons-esROBZsd.js";import"./react-DXGY7bZi.js";import"./pdf-aQqpMATS.js";import"./supabase-VuevzHjS.js";function Y(){t.useEffect(()=>{const n=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${n}px`,document.body.style.width="100%",()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.top="",document.body.style.width="",window.scrollTo(0,n)}},[])}const L=n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";function J({documentType:n,documentId:c,companyId:_,projectId:E,documentTitle:x="",onClose:d,onShowToast:r}){const[z,h]=t.useState(!0),[m,k]=t.useState(!1),[b,R]=t.useState([]),[o,G]=t.useState(null),[p,j]=t.useState(!1),y="7";Y(),t.useEffect(()=>{u()},[n,c]);const u=async()=>{try{h(!0);const s=await g.getSignatureRequestsForDocument(n,c);R(s||[])}catch(s){console.error("Error loading signature requests:",s)}finally{h(!1)}},D=async()=>{try{k(!0);let s=null;if(y!=="never"){const a=parseInt(y);s=new Date,s.setDate(s.getDate()+a),s=s.toISOString()}const i=await g.createSignatureRequest(n,c,_,E,null,s);if(i){const a=`${window.location.origin}/sign/${i.signature_token}`;G(a),await u(),r?.("Signature link created","success")}}catch(s){console.error("Error generating signature link:",s),r?.("Failed to create signature link","error")}finally{k(!1)}},f=async s=>{try{await navigator.clipboard.writeText(s),j(!0),r?.("Link copied to clipboard","success"),setTimeout(()=>j(!1),2e3)}catch(i){console.error("Error copying to clipboard:",i)}},$=async s=>{if(confirm("Are you sure you want to revoke this signature link? It will no longer be usable."))try{await g.revokeSignatureRequest(s),await u(),r?.("Signature link revoked","success")}catch(i){console.error("Error revoking signature request:",i),r?.("Failed to revoke link","error")}},F=s=>{switch(s){case"pending":return{label:"Awaiting Signatures",color:"#f59e0b",bg:"#fef3c7"};case"partially_signed":return{label:"1 of 2 Signed",color:"#3b82f6",bg:"#dbeafe"};case"completed":return{label:"Fully Signed",color:"#10b981",bg:"#d1fae5"};case"revoked":return{label:"Revoked",color:"#ef4444",bg:"#fee2e2"};case"expired":return{label:"Expired",color:"#6b7280",bg:"#f3f4f6"};default:return{label:s,color:"#6b7280",bg:"#f3f4f6"}}},v=n==="cor"?"Change Order":"T&M Ticket";return e.jsx("div",{className:"modal-overlay",onClick:d,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content signature-link-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Get Signature Link"}),x&&e.jsx("span",{className:"modal-subtitle",children:x})]}),e.jsx("button",{className:"close-btn",onClick:d,"aria-label":"Close",children:e.jsx(B,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(O,{size:16}),"Create New Signature Link"]}),e.jsxs("p",{className:"section-description",children:["Generate a secure link that allows GC/Client to sign this ",v," without logging in."]}),e.jsxs("div",{className:"link-options",children:[e.jsxs("div",{className:"link-expiration-info",children:[e.jsx(N,{size:14}),e.jsx("span",{children:"Link expires in 7 days"})]}),e.jsx("button",{className:"btn btn-primary",onClick:D,disabled:m,children:m?"Generating...":"Generate Link"})]}),o&&e.jsxs("div",{className:"new-link-box",children:[e.jsxs("div",{className:"link-display",children:[e.jsx("input",{type:"text",value:o,readOnly:!0,className:"link-input"}),e.jsxs("button",{className:"btn btn-secondary copy-btn",onClick:()=>f(o),children:[p?e.jsx(w,{size:16}):e.jsx(C,{size:16}),p?"Copied!":"Copy"]})]}),e.jsxs("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"preview-link",children:[e.jsx(S,{size:14}),"Preview link"]})]})]}),e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(N,{size:16}),"Existing Signature Links"]}),z?e.jsx("div",{className:"loading-inline",children:"Loading..."}):b.length===0?e.jsxs("p",{className:"empty-state",children:["No signature links have been created for this ",v,"."]}):e.jsx("div",{className:"existing-links-list",children:b.map(s=>{const i=F(s.status),a=`${window.location.origin}/sign/${s.signature_token}`,A=s.signatures?.length||0;return e.jsxs("div",{className:"existing-link-card",children:[e.jsxs("div",{className:"link-card-header",children:[e.jsx("span",{className:"status-badge",style:{color:i.color,backgroundColor:i.bg},children:i.label}),e.jsxs("span",{className:"link-created",children:["Created ",L(s.created_at)]})]}),e.jsxs("div",{className:"link-card-body",children:[e.jsxs("div",{className:"link-info",children:[e.jsxs("span",{className:"link-token",children:["...",s.signature_token.slice(-8)]}),s.expires_at&&e.jsxs("span",{className:"link-expires",children:["Expires ",L(s.expires_at)]}),e.jsxs("span",{className:"link-views",children:[s.view_count," view",s.view_count!==1?"s":""]})]}),A>0&&e.jsx("div",{className:"signatures-summary",children:s.signatures.map(l=>e.jsxs("div",{className:"sig-item",children:[e.jsx(w,{size:12}),e.jsxs("span",{children:["Slot ",l.signature_slot,": ",l.signer_name,l.signer_company&&` (${l.signer_company})`]})]},l.id))})]}),e.jsxs("div",{className:"link-card-actions",children:[s.status!=="revoked"&&s.status!=="expired"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>f(a),children:[e.jsx(C,{size:14})," Copy"]}),e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-small",children:[e.jsx(S,{size:14})," Open"]})]}),s.status!=="completed"&&s.status!=="revoked"&&e.jsxs("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>$(s.id),children:[e.jsx(I,{size:14})," Revoke"]})]})]},s.id)})})]}),e.jsxs("div",{className:"signature-info-box",children:[e.jsx(P,{size:16}),e.jsxs("div",{children:[e.jsx("strong",{children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Share the link with your GC or Client"}),e.jsx("li",{children:"They can view the document and sign without logging in"}),e.jsx("li",{children:"Supports 2 signatures (GC + Client)"}),e.jsx("li",{children:"Signatures are recorded with name, title, company, date, and IP"})]})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:d,children:"Close"})})]})})}export{J as default};
//# sourceMappingURL=SignatureLinkGenerator-WQIFk-CN.js.map
