{"version":3,"file":"DrawRequestModal-BfWYlaGs.js","sources":["../../src/components/billing/DrawRequestModal.jsx"],"sourcesContent":["import { useState, useEffect, useCallback, useMemo, memo } from 'react'\nimport { X, FileSpreadsheet, Calendar, Percent, Save, Download, ChevronDown } from 'lucide-react'\nimport { drawRequestOps } from '../../lib/supabase'\nimport { formatCurrency } from '../../lib/corCalculations'\n\n/**\n * DrawRequestModal - Create or edit a draw request / pay application\n *\n * Features:\n * - Period selection (start/end dates)\n * - Schedule of values table with % completion entry\n * - Auto-calculates amounts from percentages\n * - Retention calculation\n * - Summary with current payment due\n */\nexport default memo(function DrawRequestModal({\n  project,\n  company,\n  areas = [],\n  corStats = {},\n  editDrawRequest = null,\n  onSave,\n  onClose,\n  onDownloadPDF\n}) {\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n\n  // Draw request header fields\n  const [drawNumber, setDrawNumber] = useState(1)\n  const [periodStart, setPeriodStart] = useState('')\n  const [periodEnd, setPeriodEnd] = useState(new Date().toISOString().split('T')[0])\n  const [retentionPercent, setRetentionPercent] = useState(10) // Display as whole number\n  const [notes, setNotes] = useState('')\n\n  // Schedule of values items\n  const [sovItems, setSovItems] = useState([])\n\n  // Previous billing info\n  const [previousBillings, setPreviousBillings] = useState(0)\n  const [previousRetention, setPreviousRetention] = useState(0)\n\n  const isEditMode = !!editDrawRequest\n\n  // Calculate contract values\n  const originalContract = useMemo(() => {\n    return areas.reduce((sum, area) => {\n      const value = (area.square_footage || 0) * (area.price_per_sqft || 0)\n      return sum + Math.round(value * 100)\n    }, 0)\n  }, [areas])\n\n  const approvedCOs = corStats?.approvedTotal || 0\n  const revisedContract = originalContract + approvedCOs\n\n  // Initialize data\n  const initializeDrawRequest = useCallback(async () => {\n    if (!project?.id) return\n\n    try {\n      setLoading(true)\n\n      if (editDrawRequest) {\n        // Edit mode - populate from existing draw request\n        setDrawNumber(editDrawRequest.draw_number)\n        setPeriodStart(editDrawRequest.period_start || '')\n        setPeriodEnd(editDrawRequest.period_end || '')\n        setRetentionPercent((editDrawRequest.retention_percent || 1000) / 100)\n        setNotes(editDrawRequest.notes || '')\n        setPreviousBillings(editDrawRequest.previous_billings || 0)\n        setPreviousRetention(editDrawRequest.previous_retention || 0)\n\n        // Load items\n        const fullDraw = await drawRequestOps.getDrawRequest(editDrawRequest.id)\n        if (fullDraw?.draw_request_items) {\n          setSovItems(fullDraw.draw_request_items.map(item => ({\n            ...item,\n            current_percent_input: (item.current_percent || 0) / 100 // Convert to display %\n          })))\n        }\n      } else {\n        // New draw - get next number and previous data\n        const nextNum = await drawRequestOps.getNextDrawNumber(project.id)\n        setDrawNumber(nextNum)\n\n        // Get previous billing totals\n        const { totalBilled, totalRetention } = await drawRequestOps.getPreviousBillingTotals(project.id)\n        setPreviousBillings(totalBilled)\n        setPreviousRetention(totalRetention)\n\n        // Get previous item progress\n        const previousItems = await drawRequestOps.getPreviousDrawItems(project.id)\n\n        // Build SOV items from areas\n        const sov = await drawRequestOps.getScheduleOfValues(project.id)\n        setSovItems(sov.map(item => {\n          const prev = previousItems[item.area_id] || { previous_percent: 0, previous_amount: 0 }\n          return {\n            ...item,\n            previous_percent: prev.previous_percent,\n            previous_amount: prev.previous_amount,\n            current_percent: 0,\n            current_percent_input: 0,\n            current_amount: 0\n          }\n        }))\n      }\n    } catch (error) {\n      console.error('Error initializing draw request:', error)\n    } finally {\n      setLoading(false)\n    }\n  }, [project?.id, editDrawRequest])\n\n  useEffect(() => {\n    initializeDrawRequest()\n  }, [initializeDrawRequest])\n\n  // Handle percentage change for an item\n  const handlePercentChange = (index, value) => {\n    const percent = parseFloat(value) || 0\n    const item = sovItems[index]\n\n    // Calculate remaining available (100% - previous%)\n    const previousPct = (item.previous_percent || 0) / 100\n    const maxAllowed = 100 - previousPct\n\n    // Clamp to valid range\n    const clampedPercent = Math.min(Math.max(0, percent), maxAllowed)\n\n    // Calculate amount from percentage\n    const currentAmount = drawRequestOps.calculateAmountFromPercent(\n      clampedPercent * 100, // Convert back to basis points\n      item.scheduled_value\n    )\n\n    setSovItems(prev => prev.map((it, i) =>\n      i === index\n        ? {\n            ...it,\n            current_percent_input: clampedPercent,\n            current_percent: Math.round(clampedPercent * 100), // Store as basis points\n            current_amount: currentAmount\n          }\n        : it\n    ))\n  }\n\n  // Calculate totals\n  const totals = useMemo(() => {\n    const scheduledTotal = sovItems.reduce((sum, item) => sum + (item.scheduled_value || 0), 0)\n    const previousTotal = sovItems.reduce((sum, item) => sum + (item.previous_amount || 0), 0)\n    const currentTotal = sovItems.reduce((sum, item) => sum + (item.current_amount || 0), 0)\n    const completedTotal = previousTotal + currentTotal\n\n    // Retention calculation\n    const retentionBasisPoints = retentionPercent * 100\n    const totalRetention = Math.round((completedTotal * retentionBasisPoints) / 10000)\n    const currentRetentionChange = totalRetention - previousRetention\n\n    // Payment due = current billing - retention increase\n    const paymentDue = currentTotal - currentRetentionChange\n\n    // Balance to finish\n    const balanceToFinish = scheduledTotal - completedTotal\n\n    return {\n      scheduledTotal,\n      previousTotal,\n      currentTotal,\n      completedTotal,\n      totalRetention,\n      currentRetentionChange,\n      paymentDue,\n      balanceToFinish\n    }\n  }, [sovItems, retentionPercent, previousRetention])\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n\n    if (totals.currentTotal === 0) {\n      alert('Please enter at least one line item with work completed this period.')\n      return\n    }\n\n    try {\n      setSaving(true)\n\n      const drawRequestData = {\n        project_id: project.id,\n        company_id: company.id,\n        draw_number: drawNumber,\n        period_start: periodStart || null,\n        period_end: periodEnd || null,\n        retention_percent: Math.round(retentionPercent * 100), // Convert to basis points\n        original_contract: originalContract,\n        approved_changes: approvedCOs,\n        previous_billings: previousBillings,\n        current_billing: totals.currentTotal,\n        retention_held: totals.totalRetention,\n        previous_retention: previousRetention,\n        notes: notes.trim() || null\n      }\n\n      const itemsData = sovItems.map(item => ({\n        area_id: item.area_id,\n        item_number: item.item_number,\n        description: item.description,\n        scheduled_value: item.scheduled_value,\n        previous_percent: item.previous_percent || 0,\n        previous_amount: item.previous_amount || 0,\n        current_percent: item.current_percent || 0,\n        current_amount: item.current_amount || 0\n      }))\n\n      let result\n      if (isEditMode) {\n        // Update existing\n        await drawRequestOps.updateDrawRequest(editDrawRequest.id, drawRequestData)\n        await drawRequestOps.updateDrawRequestItems(editDrawRequest.id, itemsData)\n        result = await drawRequestOps.getDrawRequest(editDrawRequest.id)\n      } else {\n        // Create new\n        result = await drawRequestOps.createDrawRequest(drawRequestData, itemsData)\n      }\n\n      onSave?.(result)\n    } catch (error) {\n      console.error('Error saving draw request:', error)\n      alert('Failed to save draw request. Please try again.')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  return (\n    <div className=\"modal-backdrop\" onClick={onClose}>\n      <div className=\"modal draw-request-modal\" onClick={e => e.stopPropagation()}>\n        <div className=\"modal-header\">\n          <h2>\n            <FileSpreadsheet size={20} />\n            {isEditMode ? `Edit Draw #${drawNumber}` : `Create Draw #${drawNumber}`}\n          </h2>\n          <button className=\"modal-close\" onClick={onClose}>\n            <X size={20} />\n          </button>\n        </div>\n\n        {loading ? (\n          <div className=\"modal-body\">\n            <div className=\"draw-request-loading\">\n              <div className=\"loading-spinner\" />\n              <p>Loading schedule of values...</p>\n            </div>\n          </div>\n        ) : (\n          <form onSubmit={handleSubmit}>\n            <div className=\"modal-body\">\n              {/* Period & Retention Row */}\n              <div className=\"draw-request-header-fields\">\n                <div className=\"form-group\">\n                  <label htmlFor=\"period-start\">\n                    <Calendar size={14} />\n                    Period Start\n                  </label>\n                  <input\n                    id=\"period-start\"\n                    type=\"date\"\n                    value={periodStart}\n                    onChange={e => setPeriodStart(e.target.value)}\n                    className=\"form-input\"\n                  />\n                </div>\n\n                <div className=\"form-group\">\n                  <label htmlFor=\"period-end\">\n                    <Calendar size={14} />\n                    Period End\n                  </label>\n                  <input\n                    id=\"period-end\"\n                    type=\"date\"\n                    value={periodEnd}\n                    onChange={e => setPeriodEnd(e.target.value)}\n                    className=\"form-input\"\n                    required\n                  />\n                </div>\n\n                <div className=\"form-group\">\n                  <label htmlFor=\"retention\">\n                    <Percent size={14} />\n                    Retention\n                  </label>\n                  <div className=\"input-with-suffix\">\n                    <input\n                      id=\"retention\"\n                      type=\"number\"\n                      step=\"0.5\"\n                      min=\"0\"\n                      max=\"20\"\n                      value={retentionPercent}\n                      onChange={e => setRetentionPercent(parseFloat(e.target.value) || 0)}\n                      className=\"form-input\"\n                    />\n                    <span className=\"input-suffix\">%</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Contract Summary */}\n              <div className=\"draw-contract-summary\">\n                <div className=\"contract-item\">\n                  <span>Original Contract</span>\n                  <span>{formatCurrency(originalContract)}</span>\n                </div>\n                {approvedCOs > 0 && (\n                  <div className=\"contract-item\">\n                    <span>Approved COs</span>\n                    <span className=\"positive\">+{formatCurrency(approvedCOs)}</span>\n                  </div>\n                )}\n                <div className=\"contract-item total\">\n                  <span>Revised Contract</span>\n                  <span>{formatCurrency(revisedContract)}</span>\n                </div>\n              </div>\n\n              {/* Schedule of Values Table */}\n              <div className=\"sov-table-container\">\n                <table className=\"sov-table\">\n                  <thead>\n                    <tr>\n                      <th className=\"sov-col-num\">#</th>\n                      <th className=\"sov-col-desc\">Description</th>\n                      <th className=\"sov-col-scheduled\">Scheduled Value</th>\n                      <th className=\"sov-col-prev\">Previous %</th>\n                      <th className=\"sov-col-current\">This Period %</th>\n                      <th className=\"sov-col-total\">Total %</th>\n                      <th className=\"sov-col-amount\">This Amount</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {sovItems.map((item, index) => {\n                      const prevPct = (item.previous_percent || 0) / 100\n                      const currPct = item.current_percent_input || 0\n                      const totalPct = prevPct + currPct\n                      const isComplete = totalPct >= 100\n\n                      return (\n                        <tr key={item.area_id || index} className={isComplete ? 'complete' : ''}>\n                          <td className=\"sov-col-num\">{item.item_number}</td>\n                          <td className=\"sov-col-desc\">{item.description}</td>\n                          <td className=\"sov-col-scheduled\">{formatCurrency(item.scheduled_value)}</td>\n                          <td className=\"sov-col-prev\">{prevPct.toFixed(0)}%</td>\n                          <td className=\"sov-col-current\">\n                            {isComplete && prevPct >= 100 ? (\n                              <span className=\"complete-indicator\">-</span>\n                            ) : (\n                              <div className=\"sov-input-wrapper\">\n                                <input\n                                  type=\"number\"\n                                  step=\"1\"\n                                  min=\"0\"\n                                  max={100 - prevPct}\n                                  value={currPct || ''}\n                                  onChange={e => handlePercentChange(index, e.target.value)}\n                                  className=\"sov-percent-input\"\n                                  placeholder=\"0\"\n                                />\n                                <span className=\"sov-input-suffix\">%</span>\n                              </div>\n                            )}\n                          </td>\n                          <td className=\"sov-col-total\">\n                            <span className={totalPct >= 100 ? 'complete' : ''}>\n                              {totalPct.toFixed(0)}%\n                            </span>\n                          </td>\n                          <td className=\"sov-col-amount\">\n                            {item.current_amount > 0 ? formatCurrency(item.current_amount) : '-'}\n                          </td>\n                        </tr>\n                      )\n                    })}\n                  </tbody>\n                  <tfoot>\n                    <tr className=\"sov-totals\">\n                      <td colSpan=\"2\">Totals</td>\n                      <td>{formatCurrency(totals.scheduledTotal)}</td>\n                      <td></td>\n                      <td></td>\n                      <td></td>\n                      <td>{formatCurrency(totals.currentTotal)}</td>\n                    </tr>\n                  </tfoot>\n                </table>\n              </div>\n\n              {/* Summary */}\n              <div className=\"draw-summary\">\n                <div className=\"draw-summary-row\">\n                  <span>Previous Billings</span>\n                  <span>{formatCurrency(totals.previousTotal)}</span>\n                </div>\n                <div className=\"draw-summary-row current\">\n                  <span>Current Billing (This Draw)</span>\n                  <span>{formatCurrency(totals.currentTotal)}</span>\n                </div>\n                <div className=\"draw-summary-row\">\n                  <span>Total Completed</span>\n                  <span>{formatCurrency(totals.completedTotal)}</span>\n                </div>\n                <div className=\"draw-summary-divider\" />\n                <div className=\"draw-summary-row retention\">\n                  <span>Retention ({retentionPercent}%)</span>\n                  <span>-{formatCurrency(totals.totalRetention)}</span>\n                </div>\n                {previousRetention > 0 && (\n                  <div className=\"draw-summary-row\">\n                    <span>Less Previous Retention</span>\n                    <span>+{formatCurrency(previousRetention)}</span>\n                  </div>\n                )}\n                <div className=\"draw-summary-divider\" />\n                <div className=\"draw-summary-row total\">\n                  <span>Current Payment Due</span>\n                  <span>{formatCurrency(totals.paymentDue)}</span>\n                </div>\n                <div className=\"draw-summary-row balance\">\n                  <span>Balance to Finish</span>\n                  <span>{formatCurrency(totals.balanceToFinish)}</span>\n                </div>\n              </div>\n\n              {/* Notes */}\n              <div className=\"form-group\">\n                <label htmlFor=\"draw-notes\">Notes (optional)</label>\n                <textarea\n                  id=\"draw-notes\"\n                  value={notes}\n                  onChange={e => setNotes(e.target.value)}\n                  placeholder=\"Additional notes for this draw request...\"\n                  className=\"form-textarea\"\n                  rows={2}\n                />\n              </div>\n            </div>\n\n            <div className=\"modal-footer\">\n              <button\n                type=\"button\"\n                className=\"btn btn-outline\"\n                onClick={onClose}\n                disabled={saving}\n              >\n                Cancel\n              </button>\n              {isEditMode && onDownloadPDF && (\n                <button\n                  type=\"button\"\n                  className=\"btn btn-outline\"\n                  onClick={() => onDownloadPDF?.(editDrawRequest)}\n                  disabled={saving}\n                >\n                  <Download size={16} />\n                  Download PDF\n                </button>\n              )}\n              <button\n                type=\"submit\"\n                className=\"btn btn-primary\"\n                disabled={saving || totals.currentTotal === 0}\n              >\n                {saving ? (\n                  <>\n                    <div className=\"loading-spinner small\" />\n                    Saving...\n                  </>\n                ) : (\n                  <>\n                    <Save size={16} />\n                    {isEditMode ? 'Update Draw' : 'Create Draw'}\n                  </>\n                )}\n              </button>\n            </div>\n          </form>\n        )}\n      </div>\n    </div>\n  )\n})\n"],"names":["DrawRequestModal","memo","project","company","areas","corStats","editDrawRequest","onSave","onClose","onDownloadPDF","loading","setLoading","useState","saving","setSaving","drawNumber","setDrawNumber","periodStart","setPeriodStart","periodEnd","setPeriodEnd","retentionPercent","setRetentionPercent","notes","setNotes","sovItems","setSovItems","previousBillings","setPreviousBillings","previousRetention","setPreviousRetention","isEditMode","originalContract","useMemo","sum","area","value","approvedCOs","revisedContract","initializeDrawRequest","useCallback","fullDraw","drawRequestOps","item","nextNum","totalBilled","totalRetention","previousItems","sov","prev","error","useEffect","handlePercentChange","index","percent","maxAllowed","clampedPercent","currentAmount","it","i","totals","scheduledTotal","previousTotal","currentTotal","completedTotal","retentionBasisPoints","currentRetentionChange","paymentDue","balanceToFinish","handleSubmit","e","drawRequestData","itemsData","result","jsx","jsxs","FileSpreadsheet","X","Calendar","Percent","formatCurrency","prevPct","currPct","totalPct","isComplete","Download","Fragment","Save"],"mappings":"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"}