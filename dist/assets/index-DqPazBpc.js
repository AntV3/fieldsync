const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SignatureLinkGenerator-Di9J-Bwj.js","assets/icons-CQuOocZj.js","assets/react-DXGY7bZi.js","assets/pdf-aQqpMATS.js","assets/supabase-VuevzHjS.js","assets/TMClientSignature-CXFJD4Sz.js","assets/Dashboard-BtKwdqNr.js","assets/corCalculations-D9qkkIbo.js","assets/Setup-XUaAzQ2L.js","assets/BrandingSettings-C3vyziFw.js","assets/PricingManager-CujZuyuS.js","assets/PublicView-BSrYvido.js","assets/SignaturePage-GSE1HtXS.js","assets/MembershipManager-BnqY4UXX.js"])))=>i.map(i=>d[i]);
import{r as N,H as bn,B as xg,S as ih,M as oh,T as Di,C as al,G as Ng,F as ss,a as Uc,b as Eg,c as Ci,d as sr,L as rl,e as Cg,f as Fc,g as qg,U as Dg,W as Tg,Z as Ag,P as Hc,R as Yf,h as ch,i as Og,j as kg,k as $c,l as Gf,m as Lc,X as zg,n as Mg,o as Rg,p as uh,q as dh,s as Ug,t as Hg,u as Lg,v as Bg,w as el,A as ns,D as Yg,x as mh,I as Gg,y as Qg,z as Xg,E as Qf,J as Vg,K as Zg,N as Kg,O as Jg}from"./icons-CQuOocZj.js";import{r as Fg,b as $g,a as Wg}from"./react-DXGY7bZi.js";import{_ as lr}from"./pdf-aQqpMATS.js";import{c as fh}from"./supabase-VuevzHjS.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const h of m.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function i(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function o(d){if(d.ep)return;d.ep=!0;const m=i(d);fetch(d.href,m)}})();var Bc={exports:{}},Ws={};var Xf;function Pg(){if(Xf)return Ws;Xf=1;var n=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function i(o,d,m){var h=null;if(m!==void 0&&(h=""+m),d.key!==void 0&&(h=""+d.key),"key"in d){m={};for(var g in d)g!=="key"&&(m[g]=d[g])}else m=d;return d=m.ref,{$$typeof:n,type:o,key:h,ref:d!==void 0?d:null,props:m}}return Ws.Fragment=l,Ws.jsx=i,Ws.jsxs=i,Ws}var Vf;function Ig(){return Vf||(Vf=1,Bc.exports=Pg()),Bc.exports}var s=Ig(),Yc={exports:{}},Ps={},Gc={exports:{}},Qc={};var Zf;function e_(){return Zf||(Zf=1,(function(n){function l(D,Q){var I=D.length;D.push(Q);e:for(;0<I;){var Se=I-1>>>1,ce=D[Se];if(0<d(ce,Q))D[Se]=Q,D[I]=ce,I=Se;else break e}}function i(D){return D.length===0?null:D[0]}function o(D){if(D.length===0)return null;var Q=D[0],I=D.pop();if(I!==Q){D[0]=I;e:for(var Se=0,ce=D.length,He=ce>>>1;Se<He;){var fe=2*(Se+1)-1,je=D[fe],Ue=fe+1,vt=D[Ue];if(0>d(je,I))Ue<ce&&0>d(vt,je)?(D[Se]=vt,D[Ue]=I,Se=Ue):(D[Se]=je,D[fe]=I,Se=fe);else if(Ue<ce&&0>d(vt,I))D[Se]=vt,D[Ue]=I,Se=Ue;else break e}}return Q}function d(D,Q){var I=D.sortIndex-Q.sortIndex;return I!==0?I:D.id-Q.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var m=performance;n.unstable_now=function(){return m.now()}}else{var h=Date,g=h.now();n.unstable_now=function(){return h.now()-g}}var b=[],k=[],B=1,S=null,X=3,te=!1,F=!1,Z=!1,U=!1,K=typeof setTimeout=="function"?setTimeout:null,ne=typeof clearTimeout=="function"?clearTimeout:null,ie=typeof setImmediate<"u"?setImmediate:null;function me(D){for(var Q=i(k);Q!==null;){if(Q.callback===null)o(k);else if(Q.startTime<=D)o(k),Q.sortIndex=Q.expirationTime,l(b,Q);else break;Q=i(k)}}function be(D){if(Z=!1,me(D),!F)if(i(b)!==null)F=!0,we||(we=!0,R());else{var Q=i(k);Q!==null&&re(be,Q.startTime-D)}}var we=!1,Re=-1,Ve=5,Te=-1;function nt(){return U?!0:!(n.unstable_now()-Te<Ve)}function Fe(){if(U=!1,we){var D=n.unstable_now();Te=D;var Q=!0;try{e:{F=!1,Z&&(Z=!1,ne(Re),Re=-1),te=!0;var I=X;try{t:{for(me(D),S=i(b);S!==null&&!(S.expirationTime>D&&nt());){var Se=S.callback;if(typeof Se=="function"){S.callback=null,X=S.priorityLevel;var ce=Se(S.expirationTime<=D);if(D=n.unstable_now(),typeof ce=="function"){S.callback=ce,me(D),Q=!0;break t}S===i(b)&&o(b),me(D)}else o(b);S=i(b)}if(S!==null)Q=!0;else{var He=i(k);He!==null&&re(be,He.startTime-D),Q=!1}}break e}finally{S=null,X=I,te=!1}Q=void 0}}finally{Q?R():we=!1}}}var R;if(typeof ie=="function")R=function(){ie(Fe)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,de=G.port2;G.port1.onmessage=Fe,R=function(){de.postMessage(null)}}else R=function(){K(Fe,0)};function re(D,Q){Re=K(function(){D(n.unstable_now())},Q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(D){D.callback=null},n.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ve=0<D?Math.floor(1e3/D):5},n.unstable_getCurrentPriorityLevel=function(){return X},n.unstable_next=function(D){switch(X){case 1:case 2:case 3:var Q=3;break;default:Q=X}var I=X;X=Q;try{return D()}finally{X=I}},n.unstable_requestPaint=function(){U=!0},n.unstable_runWithPriority=function(D,Q){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var I=X;X=D;try{return Q()}finally{X=I}},n.unstable_scheduleCallback=function(D,Q,I){var Se=n.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?Se+I:Se):I=Se,D){case 1:var ce=-1;break;case 2:ce=250;break;case 5:ce=1073741823;break;case 4:ce=1e4;break;default:ce=5e3}return ce=I+ce,D={id:B++,callback:Q,priorityLevel:D,startTime:I,expirationTime:ce,sortIndex:-1},I>Se?(D.sortIndex=I,l(k,D),i(b)===null&&D===i(k)&&(Z?(ne(Re),Re=-1):Z=!0,re(be,I-Se))):(D.sortIndex=ce,l(b,D),F||te||(F=!0,we||(we=!0,R()))),D},n.unstable_shouldYield=nt,n.unstable_wrapCallback=function(D){var Q=X;return function(){var I=X;X=Q;try{return D.apply(this,arguments)}finally{X=I}}}})(Qc)),Qc}var Kf;function t_(){return Kf||(Kf=1,Gc.exports=e_()),Gc.exports}var Jf;function a_(){if(Jf)return Ps;Jf=1;var n=t_(),l=Fg(),i=$g();function o(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function m(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function h(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function g(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function b(e){if(m(e)!==e)throw Error(o(188))}function k(e){var t=e.alternate;if(!t){if(t=m(e),t===null)throw Error(o(188));return t!==e?null:e}for(var a=e,r=t;;){var c=a.return;if(c===null)break;var u=c.alternate;if(u===null){if(r=c.return,r!==null){a=r;continue}break}if(c.child===u.child){for(u=c.child;u;){if(u===a)return b(c),e;if(u===r)return b(c),t;u=u.sibling}throw Error(o(188))}if(a.return!==r.return)a=c,r=u;else{for(var f=!1,_=c.child;_;){if(_===a){f=!0,a=c,r=u;break}if(_===r){f=!0,r=c,a=u;break}_=_.sibling}if(!f){for(_=u.child;_;){if(_===a){f=!0,a=u,r=c;break}if(_===r){f=!0,r=u,a=c;break}_=_.sibling}if(!f)throw Error(o(189))}}if(a.alternate!==r)throw Error(o(190))}if(a.tag!==3)throw Error(o(188));return a.stateNode.current===a?e:t}function B(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=B(e),t!==null)return t;e=e.sibling}return null}var S=Object.assign,X=Symbol.for("react.element"),te=Symbol.for("react.transitional.element"),F=Symbol.for("react.portal"),Z=Symbol.for("react.fragment"),U=Symbol.for("react.strict_mode"),K=Symbol.for("react.profiler"),ne=Symbol.for("react.consumer"),ie=Symbol.for("react.context"),me=Symbol.for("react.forward_ref"),be=Symbol.for("react.suspense"),we=Symbol.for("react.suspense_list"),Re=Symbol.for("react.memo"),Ve=Symbol.for("react.lazy"),Te=Symbol.for("react.activity"),nt=Symbol.for("react.memo_cache_sentinel"),Fe=Symbol.iterator;function R(e){return e===null||typeof e!="object"?null:(e=Fe&&e[Fe]||e["@@iterator"],typeof e=="function"?e:null)}var G=Symbol.for("react.client.reference");function de(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===G?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Z:return"Fragment";case K:return"Profiler";case U:return"StrictMode";case be:return"Suspense";case we:return"SuspenseList";case Te:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case F:return"Portal";case ie:return e.displayName||"Context";case ne:return(e._context.displayName||"Context")+".Consumer";case me:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Re:return t=e.displayName||null,t!==null?t:de(e.type)||"Memo";case Ve:t=e._payload,e=e._init;try{return de(e(t))}catch{}}return null}var re=Array.isArray,D=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I={pending:!1,data:null,method:null,action:null},Se=[],ce=-1;function He(e){return{current:e}}function fe(e){0>ce||(e.current=Se[ce],Se[ce]=null,ce--)}function je(e,t){ce++,Se[ce]=e.current,e.current=t}var Ue=He(null),vt=He(null),qe=He(null),J=He(null);function W(e,t){switch(je(qe,t),je(vt,e),je(Ue,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?uf(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=uf(t),e=df(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}fe(Ue),je(Ue,e)}function ve(){fe(Ue),fe(vt),fe(qe)}function Ge(e){e.memoizedState!==null&&je(J,e);var t=Ue.current,a=df(t,e.type);t!==a&&(je(vt,e),je(Ue,a))}function Ze(e){vt.current===e&&(fe(Ue),fe(vt)),J.current===e&&(fe(J),Ks._currentValue=I)}var tt,ft;function Qe(e){if(tt===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);tt=t&&t[1]||"",ft=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+tt+e+ft}var Yt=!1;function ct(e,t){if(!e||Yt)return"";Yt=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var Y=function(){throw Error()};if(Object.defineProperty(Y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Y,[])}catch(z){var O=z}Reflect.construct(e,[],Y)}else{try{Y.call()}catch(z){O=z}e.call(Y.prototype)}}else{try{throw Error()}catch(z){O=z}(Y=e())&&typeof Y.catch=="function"&&Y.catch(function(){})}}catch(z){if(z&&O&&typeof z.stack=="string")return[z.stack,O.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var u=r.DetermineComponentFrameRoot(),f=u[0],_=u[1];if(f&&_){var j=f.split(`
`),A=_.split(`
`);for(c=r=0;r<j.length&&!j[r].includes("DetermineComponentFrameRoot");)r++;for(;c<A.length&&!A[c].includes("DetermineComponentFrameRoot");)c++;if(r===j.length||c===A.length)for(r=j.length-1,c=A.length-1;1<=r&&0<=c&&j[r]!==A[c];)c--;for(;1<=r&&0<=c;r--,c--)if(j[r]!==A[c]){if(r!==1||c!==1)do if(r--,c--,0>c||j[r]!==A[c]){var H=`
`+j[r].replace(" at new "," at ");return e.displayName&&H.includes("<anonymous>")&&(H=H.replace("<anonymous>",e.displayName)),H}while(1<=r&&0<=c);break}}}finally{Yt=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?Qe(a):""}function Nt(e,t){switch(e.tag){case 26:case 27:case 5:return Qe(e.type);case 16:return Qe("Lazy");case 13:return e.child!==t&&t!==null?Qe("Suspense Fallback"):Qe("Suspense");case 19:return Qe("SuspenseList");case 0:case 15:return ct(e.type,!1);case 11:return ct(e.type.render,!1);case 1:return ct(e.type,!0);case 31:return Qe("Activity");default:return""}}function wn(e){try{var t="",a=null;do t+=Nt(e,a),a=e,e=e.return;while(e);return t}catch(r){return`
Error generating stack: `+r.message+`
`+r.stack}}var or=Object.prototype.hasOwnProperty,Yr=n.unstable_scheduleCallback,ka=n.unstable_cancelCallback,cr=n.unstable_shouldYield,ur=n.unstable_requestPaint,bt=n.unstable_now,za=n.unstable_getCurrentPriorityLevel,Gr=n.unstable_ImmediatePriority,Qr=n.unstable_UserBlockingPriority,la=n.unstable_NormalPriority,Ma=n.unstable_LowPriority,jt=n.unstable_IdlePriority,Ra=n.log,Xr=n.unstable_setDisableYieldValue,ya=null,Et=null;function ee(e){if(typeof Ra=="function"&&Xr(e),Et&&typeof Et.setStrictMode=="function")try{Et.setStrictMode(ya,e)}catch{}}var Tt=Math.clz32?Math.clz32:xn,P=Math.log,Sn=Math.LN2;function xn(e){return e>>>=0,e===0?32:31-(P(e)/Sn|0)|0}var Mt=256,dr=262144,Ct=4194304;function lt(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ia(e,t,a){var r=e.pendingLanes;if(r===0)return 0;var c=0,u=e.suspendedLanes,f=e.pingedLanes;e=e.warmLanes;var _=r&134217727;return _!==0?(r=_&~u,r!==0?c=lt(r):(f&=_,f!==0?c=lt(f):a||(a=_&~e,a!==0&&(c=lt(a))))):(_=r&~u,_!==0?c=lt(_):f!==0?c=lt(f):a||(a=r&~e,a!==0&&(c=lt(a)))),c===0?0:t!==0&&t!==c&&(t&u)===0&&(u=c&-c,a=t&-t,u>=a||u===32&&(a&4194048)!==0)?t:c}function xa(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function Ua(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function V(){var e=Ct;return Ct<<=1,(Ct&62914560)===0&&(Ct=4194304),e}function Ie(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function Gt(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Vr(e,t,a,r,c,u){var f=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var _=e.entanglements,j=e.expirationTimes,A=e.hiddenUpdates;for(a=f&~a;0<a;){var H=31-Tt(a),Y=1<<H;_[H]=0,j[H]=-1;var O=A[H];if(O!==null)for(A[H]=null,H=0;H<O.length;H++){var z=O[H];z!==null&&(z.lane&=-536870913)}a&=~Y}r!==0&&Nn(e,r,0),u!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=u&~(f&~t))}function Nn(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-Tt(t);e.entangledLanes|=t,e.entanglements[r]=e.entanglements[r]|1073741824|a&261930}function sl(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var r=31-Tt(a),c=1<<r;c&t|e[r]&t&&(e[r]|=t),a&=~c}}function ll(e,t){var a=t&-t;return a=(a&42)!==0?1:Zr(a),(a&(e.suspendedLanes|t))!==0?0:a}function Zr(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ls(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function il(){var e=Q.p;return e!==0?e:(e=window.event,e===void 0?32:zf(e.type))}function ol(e,t){var a=Q.p;try{return Q.p=e,t()}finally{Q.p=a}}var Na=Math.random().toString(36).slice(2),wt="__reactFiber$"+Na,Rt="__reactProps$"+Na,Ht="__reactContainer$"+Na,is="__reactEvents$"+Na,Ai="__reactListeners$"+Na,mr="__reactHandles$"+Na,cl="__reactResources$"+Na,Kr="__reactMarker$"+Na;function Ea(e){delete e[wt],delete e[Rt],delete e[is],delete e[Ai],delete e[mr]}function fr(e){var t=e[wt];if(t)return t;for(var a=e.parentNode;a;){if(t=a[Ht]||a[wt]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=yf(e);e!==null;){if(a=e[wt])return a;e=yf(e)}return t}e=a,a=e.parentNode}return null}function Ha(e){if(e=e[wt]||e[Ht]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function Ut(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(o(33))}function La(e){var t=e[cl];return t||(t=e[cl]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function ht(e){e[Kr]=!0}var os=new Set,Jr={};function va(e,t){hr(e,t),hr(e+"Capture",t)}function hr(e,t){for(Jr[e]=t,e=0;e<t.length;e++)os.add(t[e])}var Oi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),En={},ul={};function ki(e){return or.call(ul,e)?!0:or.call(En,e)?!1:Oi.test(e)?ul[e]=!0:(En[e]=!0,!1)}function $t(e,t,a){if(ki(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var r=t.toLowerCase().slice(0,5);if(r!=="data-"&&r!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function Fr(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function ba(e,t,a,r){if(r===null)e.removeAttribute(a);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+r)}}function Lt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ba(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function pr(e,t,a){var r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,u=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(f){a=""+f,u.call(this,f)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return a},setValue:function(f){a=""+f},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ca(e){if(!e._valueTracker){var t=Ba(e)?"checked":"value";e._valueTracker=pr(e,t,""+e[t])}}function gr(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),r="";return e&&(r=Ba(e)?e.checked?"true":"false":e.value),e=r,e!==a?(t.setValue(e),!0):!1}function qa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var $r=/[\n"\\]/g;function qt(e){return e.replace($r,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function _r(e,t,a,r,c,u,f,_){e.name="",f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"?e.type=f:e.removeAttribute("type"),t!=null?f==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+Lt(t)):e.value!==""+Lt(t)&&(e.value=""+Lt(t)):f!=="submit"&&f!=="reset"||e.removeAttribute("value"),t!=null?Ya(e,f,Lt(t)):a!=null?Ya(e,f,Lt(a)):r!=null&&e.removeAttribute("value"),c==null&&u!=null&&(e.defaultChecked=!!u),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?e.name=""+Lt(_):e.removeAttribute("name")}function dl(e,t,a,r,c,u,f,_){if(u!=null&&typeof u!="function"&&typeof u!="symbol"&&typeof u!="boolean"&&(e.type=u),t!=null||a!=null){if(!(u!=="submit"&&u!=="reset"||t!=null)){Ca(e);return}a=a!=null?""+Lt(a):"",t=t!=null?""+Lt(t):a,_||t===e.value||(e.value=t),e.defaultValue=t}r=r??c,r=typeof r!="function"&&typeof r!="symbol"&&!!r,e.checked=_?e.checked:!!r,e.defaultChecked=!!r,f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"&&(e.name=f),Ca(e)}function Ya(e,t,a){t==="number"&&qa(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function Wr(e,t,a,r){if(e=e.options,t){t={};for(var c=0;c<a.length;c++)t["$"+a[c]]=!0;for(a=0;a<e.length;a++)c=t.hasOwnProperty("$"+e[a].value),e[a].selected!==c&&(e[a].selected=c),c&&r&&(e[a].defaultSelected=!0)}else{for(a=""+Lt(a),t=null,c=0;c<e.length;c++){if(e[c].value===a){e[c].selected=!0,r&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function cs(e,t,a){if(t!=null&&(t=""+Lt(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+Lt(a):""}function Pr(e,t,a,r){if(t==null){if(r!=null){if(a!=null)throw Error(o(92));if(re(r)){if(1<r.length)throw Error(o(93));r=r[0]}a=r}a==null&&(a=""),t=a}a=Lt(t),e.defaultValue=a,r=e.textContent,r===a&&r!==""&&r!==null&&(e.value=r),Ca(e)}function Ga(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var zi=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function p(e,t,a){var r=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?r?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":r?e.setProperty(t,a):typeof a!="number"||a===0||zi.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function w(e,t,a){if(t!=null&&typeof t!="object")throw Error(o(62));if(e=e.style,a!=null){for(var r in a)!a.hasOwnProperty(r)||t!=null&&t.hasOwnProperty(r)||(r.indexOf("--")===0?e.setProperty(r,""):r==="float"?e.cssFloat="":e[r]="");for(var c in t)r=t[c],t.hasOwnProperty(c)&&a[c]!==r&&p(e,c,r)}else for(var u in t)t.hasOwnProperty(u)&&p(e,u,t[u])}function C(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var q=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),M=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function $(e){return M.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function oe(){}var he=null;function pe(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ne=null,ut=null;function ou(e){var t=Ha(e);if(t&&(e=t.stateNode)){var a=e[Rt]||null;e:switch(e=t.stateNode,t.type){case"input":if(_r(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+qt(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var r=a[t];if(r!==e&&r.form===e.form){var c=r[Rt]||null;if(!c)throw Error(o(90));_r(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(t=0;t<a.length;t++)r=a[t],r.form===e.form&&gr(r)}break e;case"textarea":cs(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&Wr(e,!!a.multiple,t,!1)}}}var Mi=!1;function cu(e,t,a){if(Mi)return e(t,a);Mi=!0;try{var r=e(t);return r}finally{if(Mi=!1,(Ne!==null||ut!==null)&&(Pl(),Ne&&(t=Ne,e=ut,ut=Ne=null,ou(t),e)))for(t=0;t<e.length;t++)ou(e[t])}}function us(e,t){var a=e.stateNode;if(a===null)return null;var r=a[Rt]||null;if(r===null)return null;a=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(o(231,t,typeof a));return a}var Qa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ri=!1;if(Qa)try{var ds={};Object.defineProperty(ds,"passive",{get:function(){Ri=!0}}),window.addEventListener("test",ds,ds),window.removeEventListener("test",ds,ds)}catch{Ri=!1}var yr=null,Ui=null,ml=null;function uu(){if(ml)return ml;var e,t=Ui,a=t.length,r,c="value"in yr?yr.value:yr.textContent,u=c.length;for(e=0;e<a&&t[e]===c[e];e++);var f=a-e;for(r=1;r<=f&&t[a-r]===c[u-r];r++);return ml=c.slice(e,1<r?1-r:void 0)}function fl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function hl(){return!0}function du(){return!1}function Qt(e){function t(a,r,c,u,f){this._reactName=a,this._targetInst=c,this.type=r,this.nativeEvent=u,this.target=f,this.currentTarget=null;for(var _ in e)e.hasOwnProperty(_)&&(a=e[_],this[_]=a?a(u):u[_]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?hl:du,this.isPropagationStopped=du,this}return S(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=hl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=hl)},persist:function(){},isPersistent:hl}),t}var Ir={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pl=Qt(Ir),ms=S({},Ir,{view:0,detail:0}),wh=Qt(ms),Hi,Li,fs,gl=S({},ms,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yi,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==fs&&(fs&&e.type==="mousemove"?(Hi=e.screenX-fs.screenX,Li=e.screenY-fs.screenY):Li=Hi=0,fs=e),Hi)},movementY:function(e){return"movementY"in e?e.movementY:Li}}),mu=Qt(gl),Sh=S({},gl,{dataTransfer:0}),xh=Qt(Sh),Nh=S({},ms,{relatedTarget:0}),Bi=Qt(Nh),Eh=S({},Ir,{animationName:0,elapsedTime:0,pseudoElement:0}),Ch=Qt(Eh),qh=S({},Ir,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Dh=Qt(qh),Th=S({},Ir,{data:0}),fu=Qt(Th),Ah={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Oh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zh(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=kh[e])?!!t[e]:!1}function Yi(){return zh}var Mh=S({},ms,{key:function(e){if(e.key){var t=Ah[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=fl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Oh[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yi,charCode:function(e){return e.type==="keypress"?fl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?fl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rh=Qt(Mh),Uh=S({},gl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hu=Qt(Uh),Hh=S({},ms,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yi}),Lh=Qt(Hh),Bh=S({},Ir,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yh=Qt(Bh),Gh=S({},gl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Qh=Qt(Gh),Xh=S({},Ir,{newState:0,oldState:0}),Vh=Qt(Xh),Zh=[9,13,27,32],Gi=Qa&&"CompositionEvent"in window,hs=null;Qa&&"documentMode"in document&&(hs=document.documentMode);var Kh=Qa&&"TextEvent"in window&&!hs,pu=Qa&&(!Gi||hs&&8<hs&&11>=hs),gu=" ",_u=!1;function yu(e,t){switch(e){case"keyup":return Zh.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Cn=!1;function Jh(e,t){switch(e){case"compositionend":return vu(t);case"keypress":return t.which!==32?null:(_u=!0,gu);case"textInput":return e=t.data,e===gu&&_u?null:e;default:return null}}function Fh(e,t){if(Cn)return e==="compositionend"||!Gi&&yu(e,t)?(e=uu(),ml=Ui=yr=null,Cn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return pu&&t.locale!=="ko"?null:t.data;default:return null}}var $h={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!$h[e.type]:t==="textarea"}function ju(e,t,a,r){Ne?ut?ut.push(r):ut=[r]:Ne=r,t=si(t,"onChange"),0<t.length&&(a=new pl("onChange","change",null,a,r),e.push({event:a,listeners:t}))}var ps=null,gs=null;function Wh(e){rf(e,0)}function _l(e){var t=Ut(e);if(gr(t))return e}function wu(e,t){if(e==="change")return t}var Su=!1;if(Qa){var Qi;if(Qa){var Xi="oninput"in document;if(!Xi){var xu=document.createElement("div");xu.setAttribute("oninput","return;"),Xi=typeof xu.oninput=="function"}Qi=Xi}else Qi=!1;Su=Qi&&(!document.documentMode||9<document.documentMode)}function Nu(){ps&&(ps.detachEvent("onpropertychange",Eu),gs=ps=null)}function Eu(e){if(e.propertyName==="value"&&_l(gs)){var t=[];ju(t,gs,e,pe(e)),cu(Wh,t)}}function Ph(e,t,a){e==="focusin"?(Nu(),ps=t,gs=a,ps.attachEvent("onpropertychange",Eu)):e==="focusout"&&Nu()}function Ih(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return _l(gs)}function ep(e,t){if(e==="click")return _l(t)}function tp(e,t){if(e==="input"||e==="change")return _l(t)}function ap(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Wt=typeof Object.is=="function"?Object.is:ap;function _s(e,t){if(Wt(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),r=Object.keys(t);if(a.length!==r.length)return!1;for(r=0;r<a.length;r++){var c=a[r];if(!or.call(t,c)||!Wt(e[c],t[c]))return!1}return!0}function Cu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function qu(e,t){var a=Cu(e);e=0;for(var r;a;){if(a.nodeType===3){if(r=e+a.textContent.length,e<=t&&r>=t)return{node:a,offset:t-e};e=r}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Cu(a)}}function Du(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Du(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Tu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=qa(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=qa(e.document)}return t}function Vi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var rp=Qa&&"documentMode"in document&&11>=document.documentMode,qn=null,Zi=null,ys=null,Ki=!1;function Au(e,t,a){var r=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Ki||qn==null||qn!==qa(r)||(r=qn,"selectionStart"in r&&Vi(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ys&&_s(ys,r)||(ys=r,r=si(Zi,"onSelect"),0<r.length&&(t=new pl("onSelect","select",null,t,a),e.push({event:t,listeners:r}),t.target=qn)))}function en(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Dn={animationend:en("Animation","AnimationEnd"),animationiteration:en("Animation","AnimationIteration"),animationstart:en("Animation","AnimationStart"),transitionrun:en("Transition","TransitionRun"),transitionstart:en("Transition","TransitionStart"),transitioncancel:en("Transition","TransitionCancel"),transitionend:en("Transition","TransitionEnd")},Ji={},Ou={};Qa&&(Ou=document.createElement("div").style,"AnimationEvent"in window||(delete Dn.animationend.animation,delete Dn.animationiteration.animation,delete Dn.animationstart.animation),"TransitionEvent"in window||delete Dn.transitionend.transition);function tn(e){if(Ji[e])return Ji[e];if(!Dn[e])return e;var t=Dn[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in Ou)return Ji[e]=t[a];return e}var ku=tn("animationend"),zu=tn("animationiteration"),Mu=tn("animationstart"),np=tn("transitionrun"),sp=tn("transitionstart"),lp=tn("transitioncancel"),Ru=tn("transitionend"),Uu=new Map,Fi="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Fi.push("scrollEnd");function ja(e,t){Uu.set(e,t),va(t,[e])}var yl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},oa=[],Tn=0,$i=0;function vl(){for(var e=Tn,t=$i=Tn=0;t<e;){var a=oa[t];oa[t++]=null;var r=oa[t];oa[t++]=null;var c=oa[t];oa[t++]=null;var u=oa[t];if(oa[t++]=null,r!==null&&c!==null){var f=r.pending;f===null?c.next=c:(c.next=f.next,f.next=c),r.pending=c}u!==0&&Hu(a,c,u)}}function bl(e,t,a,r){oa[Tn++]=e,oa[Tn++]=t,oa[Tn++]=a,oa[Tn++]=r,$i|=r,e.lanes|=r,e=e.alternate,e!==null&&(e.lanes|=r)}function Wi(e,t,a,r){return bl(e,t,a,r),jl(e)}function an(e,t){return bl(e,null,null,t),jl(e)}function Hu(e,t,a){e.lanes|=a;var r=e.alternate;r!==null&&(r.lanes|=a);for(var c=!1,u=e.return;u!==null;)u.childLanes|=a,r=u.alternate,r!==null&&(r.childLanes|=a),u.tag===22&&(e=u.stateNode,e===null||e._visibility&1||(c=!0)),e=u,u=u.return;return e.tag===3?(u=e.stateNode,c&&t!==null&&(c=31-Tt(a),e=u.hiddenUpdates,r=e[c],r===null?e[c]=[t]:r.push(t),t.lane=a|536870912),u):null}function jl(e){if(50<Bs)throw Bs=0,ic=null,Error(o(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var An={};function ip(e,t,a,r){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pt(e,t,a,r){return new ip(e,t,a,r)}function Pi(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Xa(e,t){var a=e.alternate;return a===null?(a=Pt(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Lu(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function wl(e,t,a,r,c,u){var f=0;if(r=e,typeof e=="function")Pi(e)&&(f=1);else if(typeof e=="string")f=mg(e,a,Ue.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case Te:return e=Pt(31,a,t,c),e.elementType=Te,e.lanes=u,e;case Z:return rn(a.children,c,u,t);case U:f=8,c|=24;break;case K:return e=Pt(12,a,t,c|2),e.elementType=K,e.lanes=u,e;case be:return e=Pt(13,a,t,c),e.elementType=be,e.lanes=u,e;case we:return e=Pt(19,a,t,c),e.elementType=we,e.lanes=u,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case ie:f=10;break e;case ne:f=9;break e;case me:f=11;break e;case Re:f=14;break e;case Ve:f=16,r=null;break e}f=29,a=Error(o(130,e===null?"null":typeof e,"")),r=null}return t=Pt(f,a,t,c),t.elementType=e,t.type=r,t.lanes=u,t}function rn(e,t,a,r){return e=Pt(7,e,r,t),e.lanes=a,e}function Ii(e,t,a){return e=Pt(6,e,null,t),e.lanes=a,e}function Bu(e){var t=Pt(18,null,null,0);return t.stateNode=e,t}function eo(e,t,a){return t=Pt(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Yu=new WeakMap;function ca(e,t){if(typeof e=="object"&&e!==null){var a=Yu.get(e);return a!==void 0?a:(t={value:e,source:t,stack:wn(t)},Yu.set(e,t),t)}return{value:e,source:t,stack:wn(t)}}var On=[],kn=0,Sl=null,vs=0,ua=[],da=0,vr=null,Da=1,Ta="";function Va(e,t){On[kn++]=vs,On[kn++]=Sl,Sl=e,vs=t}function Gu(e,t,a){ua[da++]=Da,ua[da++]=Ta,ua[da++]=vr,vr=e;var r=Da;e=Ta;var c=32-Tt(r)-1;r&=~(1<<c),a+=1;var u=32-Tt(t)+c;if(30<u){var f=c-c%5;u=(r&(1<<f)-1).toString(32),r>>=f,c-=f,Da=1<<32-Tt(t)+c|a<<c|r,Ta=u+e}else Da=1<<u|a<<c|r,Ta=e}function to(e){e.return!==null&&(Va(e,1),Gu(e,1,0))}function ao(e){for(;e===Sl;)Sl=On[--kn],On[kn]=null,vs=On[--kn],On[kn]=null;for(;e===vr;)vr=ua[--da],ua[da]=null,Ta=ua[--da],ua[da]=null,Da=ua[--da],ua[da]=null}function Qu(e,t){ua[da++]=Da,ua[da++]=Ta,ua[da++]=vr,Da=t.id,Ta=t.overflow,vr=e}var At=null,at=null,Me=!1,br=null,ma=!1,ro=Error(o(519));function jr(e){var t=Error(o(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw bs(ca(t,e)),ro}function Xu(e){var t=e.stateNode,a=e.type,r=e.memoizedProps;switch(t[wt]=e,t[Rt]=r,a){case"dialog":Oe("cancel",t),Oe("close",t);break;case"iframe":case"object":case"embed":Oe("load",t);break;case"video":case"audio":for(a=0;a<Gs.length;a++)Oe(Gs[a],t);break;case"source":Oe("error",t);break;case"img":case"image":case"link":Oe("error",t),Oe("load",t);break;case"details":Oe("toggle",t);break;case"input":Oe("invalid",t),dl(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0);break;case"select":Oe("invalid",t);break;case"textarea":Oe("invalid",t),Pr(t,r.value,r.defaultValue,r.children)}a=r.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||r.suppressHydrationWarning===!0||of(t.textContent,a)?(r.popover!=null&&(Oe("beforetoggle",t),Oe("toggle",t)),r.onScroll!=null&&Oe("scroll",t),r.onScrollEnd!=null&&Oe("scrollend",t),r.onClick!=null&&(t.onclick=oe),t=!0):t=!1,t||jr(e,!0)}function Vu(e){for(At=e.return;At;)switch(At.tag){case 5:case 31:case 13:ma=!1;return;case 27:case 3:ma=!0;return;default:At=At.return}}function zn(e){if(e!==At)return!1;if(!Me)return Vu(e),Me=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||wc(e.type,e.memoizedProps)),a=!a),a&&at&&jr(e),Vu(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));at=_f(e)}else if(t===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));at=_f(e)}else t===27?(t=at,Mr(e.type)?(e=Cc,Cc=null,at=e):at=t):at=At?ha(e.stateNode.nextSibling):null;return!0}function nn(){at=At=null,Me=!1}function no(){var e=br;return e!==null&&(Kt===null?Kt=e:Kt.push.apply(Kt,e),br=null),e}function bs(e){br===null?br=[e]:br.push(e)}var so=He(null),sn=null,Za=null;function wr(e,t,a){je(so,t._currentValue),t._currentValue=a}function Ka(e){e._currentValue=so.current,fe(so)}function lo(e,t,a){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===a)break;e=e.return}}function io(e,t,a,r){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var u=c.dependencies;if(u!==null){var f=c.child;u=u.firstContext;e:for(;u!==null;){var _=u;u=c;for(var j=0;j<t.length;j++)if(_.context===t[j]){u.lanes|=a,_=u.alternate,_!==null&&(_.lanes|=a),lo(u.return,a,e),r||(f=null);break e}u=_.next}}else if(c.tag===18){if(f=c.return,f===null)throw Error(o(341));f.lanes|=a,u=f.alternate,u!==null&&(u.lanes|=a),lo(f,a,e),f=null}else f=c.child;if(f!==null)f.return=c;else for(f=c;f!==null;){if(f===e){f=null;break}if(c=f.sibling,c!==null){c.return=f.return,f=c;break}f=f.return}c=f}}function Mn(e,t,a,r){e=null;for(var c=t,u=!1;c!==null;){if(!u){if((c.flags&524288)!==0)u=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var f=c.alternate;if(f===null)throw Error(o(387));if(f=f.memoizedProps,f!==null){var _=c.type;Wt(c.pendingProps.value,f.value)||(e!==null?e.push(_):e=[_])}}else if(c===J.current){if(f=c.alternate,f===null)throw Error(o(387));f.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(Ks):e=[Ks])}c=c.return}e!==null&&io(t,e,a,r),t.flags|=262144}function xl(e){for(e=e.firstContext;e!==null;){if(!Wt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ln(e){sn=e,Za=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Ot(e){return Zu(sn,e)}function Nl(e,t){return sn===null&&ln(e),Zu(e,t)}function Zu(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},Za===null){if(e===null)throw Error(o(308));Za=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Za=Za.next=t;return a}var op=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,r){e.push(r)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},cp=n.unstable_scheduleCallback,up=n.unstable_NormalPriority,pt={$$typeof:ie,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function oo(){return{controller:new op,data:new Map,refCount:0}}function js(e){e.refCount--,e.refCount===0&&cp(up,function(){e.controller.abort()})}var ws=null,co=0,Rn=0,Un=null;function dp(e,t){if(ws===null){var a=ws=[];co=0,Rn=fc(),Un={status:"pending",value:void 0,then:function(r){a.push(r)}}}return co++,t.then(Ku,Ku),t}function Ku(){if(--co===0&&ws!==null){Un!==null&&(Un.status="fulfilled");var e=ws;ws=null,Rn=0,Un=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function mp(e,t){var a=[],r={status:"pending",value:null,reason:null,then:function(c){a.push(c)}};return e.then(function(){r.status="fulfilled",r.value=t;for(var c=0;c<a.length;c++)(0,a[c])(t)},function(c){for(r.status="rejected",r.reason=c,c=0;c<a.length;c++)(0,a[c])(void 0)}),r}var Ju=D.S;D.S=function(e,t){Am=bt(),typeof t=="object"&&t!==null&&typeof t.then=="function"&&dp(e,t),Ju!==null&&Ju(e,t)};var on=He(null);function uo(){var e=on.current;return e!==null?e:et.pooledCache}function El(e,t){t===null?je(on,on.current):je(on,t.pool)}function Fu(){var e=uo();return e===null?null:{parent:pt._currentValue,pool:e}}var Hn=Error(o(460)),mo=Error(o(474)),Cl=Error(o(542)),ql={then:function(){}};function $u(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Wu(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(oe,oe),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Iu(e),e;default:if(typeof t.status=="string")t.then(oe,oe);else{if(e=et,e!==null&&100<e.shellSuspendCounter)throw Error(o(482));e=t,e.status="pending",e.then(function(r){if(t.status==="pending"){var c=t;c.status="fulfilled",c.value=r}},function(r){if(t.status==="pending"){var c=t;c.status="rejected",c.reason=r}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Iu(e),e}throw un=t,Hn}}function cn(e){try{var t=e._init;return t(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(un=a,Hn):a}}var un=null;function Pu(){if(un===null)throw Error(o(459));var e=un;return un=null,e}function Iu(e){if(e===Hn||e===Cl)throw Error(o(483))}var Ln=null,Ss=0;function Dl(e){var t=Ss;return Ss+=1,Ln===null&&(Ln=[]),Wu(Ln,e,t)}function xs(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Tl(e,t){throw t.$$typeof===X?Error(o(525)):(e=Object.prototype.toString.call(t),Error(o(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function ed(e){function t(E,x){if(e){var T=E.deletions;T===null?(E.deletions=[x],E.flags|=16):T.push(x)}}function a(E,x){if(!e)return null;for(;x!==null;)t(E,x),x=x.sibling;return null}function r(E){for(var x=new Map;E!==null;)E.key!==null?x.set(E.key,E):x.set(E.index,E),E=E.sibling;return x}function c(E,x){return E=Xa(E,x),E.index=0,E.sibling=null,E}function u(E,x,T){return E.index=T,e?(T=E.alternate,T!==null?(T=T.index,T<x?(E.flags|=67108866,x):T):(E.flags|=67108866,x)):(E.flags|=1048576,x)}function f(E){return e&&E.alternate===null&&(E.flags|=67108866),E}function _(E,x,T,L){return x===null||x.tag!==6?(x=Ii(T,E.mode,L),x.return=E,x):(x=c(x,T),x.return=E,x)}function j(E,x,T,L){var ge=T.type;return ge===Z?H(E,x,T.props.children,L,T.key):x!==null&&(x.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===Ve&&cn(ge)===x.type)?(x=c(x,T.props),xs(x,T),x.return=E,x):(x=wl(T.type,T.key,T.props,null,E.mode,L),xs(x,T),x.return=E,x)}function A(E,x,T,L){return x===null||x.tag!==4||x.stateNode.containerInfo!==T.containerInfo||x.stateNode.implementation!==T.implementation?(x=eo(T,E.mode,L),x.return=E,x):(x=c(x,T.children||[]),x.return=E,x)}function H(E,x,T,L,ge){return x===null||x.tag!==7?(x=rn(T,E.mode,L,ge),x.return=E,x):(x=c(x,T),x.return=E,x)}function Y(E,x,T){if(typeof x=="string"&&x!==""||typeof x=="number"||typeof x=="bigint")return x=Ii(""+x,E.mode,T),x.return=E,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case te:return T=wl(x.type,x.key,x.props,null,E.mode,T),xs(T,x),T.return=E,T;case F:return x=eo(x,E.mode,T),x.return=E,x;case Ve:return x=cn(x),Y(E,x,T)}if(re(x)||R(x))return x=rn(x,E.mode,T,null),x.return=E,x;if(typeof x.then=="function")return Y(E,Dl(x),T);if(x.$$typeof===ie)return Y(E,Nl(E,x),T);Tl(E,x)}return null}function O(E,x,T,L){var ge=x!==null?x.key:null;if(typeof T=="string"&&T!==""||typeof T=="number"||typeof T=="bigint")return ge!==null?null:_(E,x,""+T,L);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case te:return T.key===ge?j(E,x,T,L):null;case F:return T.key===ge?A(E,x,T,L):null;case Ve:return T=cn(T),O(E,x,T,L)}if(re(T)||R(T))return ge!==null?null:H(E,x,T,L,null);if(typeof T.then=="function")return O(E,x,Dl(T),L);if(T.$$typeof===ie)return O(E,x,Nl(E,T),L);Tl(E,T)}return null}function z(E,x,T,L,ge){if(typeof L=="string"&&L!==""||typeof L=="number"||typeof L=="bigint")return E=E.get(T)||null,_(x,E,""+L,ge);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case te:return E=E.get(L.key===null?T:L.key)||null,j(x,E,L,ge);case F:return E=E.get(L.key===null?T:L.key)||null,A(x,E,L,ge);case Ve:return L=cn(L),z(E,x,T,L,ge)}if(re(L)||R(L))return E=E.get(T)||null,H(x,E,L,ge,null);if(typeof L.then=="function")return z(E,x,T,Dl(L),ge);if(L.$$typeof===ie)return z(E,x,T,Nl(x,L),ge);Tl(x,L)}return null}function se(E,x,T,L){for(var ge=null,Le=null,ue=x,Ee=x=0,ze=null;ue!==null&&Ee<T.length;Ee++){ue.index>Ee?(ze=ue,ue=null):ze=ue.sibling;var Be=O(E,ue,T[Ee],L);if(Be===null){ue===null&&(ue=ze);break}e&&ue&&Be.alternate===null&&t(E,ue),x=u(Be,x,Ee),Le===null?ge=Be:Le.sibling=Be,Le=Be,ue=ze}if(Ee===T.length)return a(E,ue),Me&&Va(E,Ee),ge;if(ue===null){for(;Ee<T.length;Ee++)ue=Y(E,T[Ee],L),ue!==null&&(x=u(ue,x,Ee),Le===null?ge=ue:Le.sibling=ue,Le=ue);return Me&&Va(E,Ee),ge}for(ue=r(ue);Ee<T.length;Ee++)ze=z(ue,E,Ee,T[Ee],L),ze!==null&&(e&&ze.alternate!==null&&ue.delete(ze.key===null?Ee:ze.key),x=u(ze,x,Ee),Le===null?ge=ze:Le.sibling=ze,Le=ze);return e&&ue.forEach(function(Br){return t(E,Br)}),Me&&Va(E,Ee),ge}function ye(E,x,T,L){if(T==null)throw Error(o(151));for(var ge=null,Le=null,ue=x,Ee=x=0,ze=null,Be=T.next();ue!==null&&!Be.done;Ee++,Be=T.next()){ue.index>Ee?(ze=ue,ue=null):ze=ue.sibling;var Br=O(E,ue,Be.value,L);if(Br===null){ue===null&&(ue=ze);break}e&&ue&&Br.alternate===null&&t(E,ue),x=u(Br,x,Ee),Le===null?ge=Br:Le.sibling=Br,Le=Br,ue=ze}if(Be.done)return a(E,ue),Me&&Va(E,Ee),ge;if(ue===null){for(;!Be.done;Ee++,Be=T.next())Be=Y(E,Be.value,L),Be!==null&&(x=u(Be,x,Ee),Le===null?ge=Be:Le.sibling=Be,Le=Be);return Me&&Va(E,Ee),ge}for(ue=r(ue);!Be.done;Ee++,Be=T.next())Be=z(ue,E,Ee,Be.value,L),Be!==null&&(e&&Be.alternate!==null&&ue.delete(Be.key===null?Ee:Be.key),x=u(Be,x,Ee),Le===null?ge=Be:Le.sibling=Be,Le=Be);return e&&ue.forEach(function(Sg){return t(E,Sg)}),Me&&Va(E,Ee),ge}function Pe(E,x,T,L){if(typeof T=="object"&&T!==null&&T.type===Z&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case te:e:{for(var ge=T.key;x!==null;){if(x.key===ge){if(ge=T.type,ge===Z){if(x.tag===7){a(E,x.sibling),L=c(x,T.props.children),L.return=E,E=L;break e}}else if(x.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===Ve&&cn(ge)===x.type){a(E,x.sibling),L=c(x,T.props),xs(L,T),L.return=E,E=L;break e}a(E,x);break}else t(E,x);x=x.sibling}T.type===Z?(L=rn(T.props.children,E.mode,L,T.key),L.return=E,E=L):(L=wl(T.type,T.key,T.props,null,E.mode,L),xs(L,T),L.return=E,E=L)}return f(E);case F:e:{for(ge=T.key;x!==null;){if(x.key===ge)if(x.tag===4&&x.stateNode.containerInfo===T.containerInfo&&x.stateNode.implementation===T.implementation){a(E,x.sibling),L=c(x,T.children||[]),L.return=E,E=L;break e}else{a(E,x);break}else t(E,x);x=x.sibling}L=eo(T,E.mode,L),L.return=E,E=L}return f(E);case Ve:return T=cn(T),Pe(E,x,T,L)}if(re(T))return se(E,x,T,L);if(R(T)){if(ge=R(T),typeof ge!="function")throw Error(o(150));return T=ge.call(T),ye(E,x,T,L)}if(typeof T.then=="function")return Pe(E,x,Dl(T),L);if(T.$$typeof===ie)return Pe(E,x,Nl(E,T),L);Tl(E,T)}return typeof T=="string"&&T!==""||typeof T=="number"||typeof T=="bigint"?(T=""+T,x!==null&&x.tag===6?(a(E,x.sibling),L=c(x,T),L.return=E,E=L):(a(E,x),L=Ii(T,E.mode,L),L.return=E,E=L),f(E)):a(E,x)}return function(E,x,T,L){try{Ss=0;var ge=Pe(E,x,T,L);return Ln=null,ge}catch(ue){if(ue===Hn||ue===Cl)throw ue;var Le=Pt(29,ue,null,E.mode);return Le.lanes=L,Le.return=E,Le}finally{}}}var dn=ed(!0),td=ed(!1),Sr=!1;function fo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ho(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function xr(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Nr(e,t,a){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,(Xe&2)!==0){var c=r.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),r.pending=t,t=jl(e),Hu(e,null,a),t}return bl(e,r,t,a),jl(e)}function Ns(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var r=t.lanes;r&=e.pendingLanes,a|=r,t.lanes=a,sl(e,a)}}function po(e,t){var a=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,a===r)){var c=null,u=null;if(a=a.firstBaseUpdate,a!==null){do{var f={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};u===null?c=u=f:u=u.next=f,a=a.next}while(a!==null);u===null?c=u=t:u=u.next=t}else c=u=t;a={baseState:r.baseState,firstBaseUpdate:c,lastBaseUpdate:u,shared:r.shared,callbacks:r.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var go=!1;function Es(){if(go){var e=Un;if(e!==null)throw e}}function Cs(e,t,a,r){go=!1;var c=e.updateQueue;Sr=!1;var u=c.firstBaseUpdate,f=c.lastBaseUpdate,_=c.shared.pending;if(_!==null){c.shared.pending=null;var j=_,A=j.next;j.next=null,f===null?u=A:f.next=A,f=j;var H=e.alternate;H!==null&&(H=H.updateQueue,_=H.lastBaseUpdate,_!==f&&(_===null?H.firstBaseUpdate=A:_.next=A,H.lastBaseUpdate=j))}if(u!==null){var Y=c.baseState;f=0,H=A=j=null,_=u;do{var O=_.lane&-536870913,z=O!==_.lane;if(z?(ke&O)===O:(r&O)===O){O!==0&&O===Rn&&(go=!0),H!==null&&(H=H.next={lane:0,tag:_.tag,payload:_.payload,callback:null,next:null});e:{var se=e,ye=_;O=t;var Pe=a;switch(ye.tag){case 1:if(se=ye.payload,typeof se=="function"){Y=se.call(Pe,Y,O);break e}Y=se;break e;case 3:se.flags=se.flags&-65537|128;case 0:if(se=ye.payload,O=typeof se=="function"?se.call(Pe,Y,O):se,O==null)break e;Y=S({},Y,O);break e;case 2:Sr=!0}}O=_.callback,O!==null&&(e.flags|=64,z&&(e.flags|=8192),z=c.callbacks,z===null?c.callbacks=[O]:z.push(O))}else z={lane:O,tag:_.tag,payload:_.payload,callback:_.callback,next:null},H===null?(A=H=z,j=Y):H=H.next=z,f|=O;if(_=_.next,_===null){if(_=c.shared.pending,_===null)break;z=_,_=z.next,z.next=null,c.lastBaseUpdate=z,c.shared.pending=null}}while(!0);H===null&&(j=Y),c.baseState=j,c.firstBaseUpdate=A,c.lastBaseUpdate=H,u===null&&(c.shared.lanes=0),Tr|=f,e.lanes=f,e.memoizedState=Y}}function ad(e,t){if(typeof e!="function")throw Error(o(191,e));e.call(t)}function rd(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)ad(a[e],t)}var Bn=He(null),Al=He(0);function nd(e,t){e=ar,je(Al,e),je(Bn,t),ar=e|t.baseLanes}function _o(){je(Al,ar),je(Bn,Bn.current)}function yo(){ar=Al.current,fe(Bn),fe(Al)}var It=He(null),fa=null;function Er(e){var t=e.alternate;je(dt,dt.current&1),je(It,e),fa===null&&(t===null||Bn.current!==null||t.memoizedState!==null)&&(fa=e)}function vo(e){je(dt,dt.current),je(It,e),fa===null&&(fa=e)}function sd(e){e.tag===22?(je(dt,dt.current),je(It,e),fa===null&&(fa=e)):Cr()}function Cr(){je(dt,dt.current),je(It,It.current)}function ea(e){fe(It),fa===e&&(fa=null),fe(dt)}var dt=He(0);function Ol(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||Nc(a)||Ec(a)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder==="forwards"||t.memoizedProps.revealOrder==="backwards"||t.memoizedProps.revealOrder==="unstable_legacy-backwards"||t.memoizedProps.revealOrder==="together")){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ja=0,xe=null,$e=null,gt=null,kl=!1,Yn=!1,mn=!1,zl=0,qs=0,Gn=null,fp=0;function it(){throw Error(o(321))}function bo(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Wt(e[a],t[a]))return!1;return!0}function jo(e,t,a,r,c,u){return Ja=u,xe=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,D.H=e===null||e.memoizedState===null?Gd:Ro,mn=!1,u=a(r,c),mn=!1,Yn&&(u=id(t,a,r,c)),ld(e),u}function ld(e){D.H=As;var t=$e!==null&&$e.next!==null;if(Ja=0,gt=$e=xe=null,kl=!1,qs=0,Gn=null,t)throw Error(o(300));e===null||_t||(e=e.dependencies,e!==null&&xl(e)&&(_t=!0))}function id(e,t,a,r){xe=e;var c=0;do{if(Yn&&(Gn=null),qs=0,Yn=!1,25<=c)throw Error(o(301));if(c+=1,gt=$e=null,e.updateQueue!=null){var u=e.updateQueue;u.lastEffect=null,u.events=null,u.stores=null,u.memoCache!=null&&(u.memoCache.index=0)}D.H=Qd,u=t(a,r)}while(Yn);return u}function hp(){var e=D.H,t=e.useState()[0];return t=typeof t.then=="function"?Ds(t):t,e=e.useState()[0],($e!==null?$e.memoizedState:null)!==e&&(xe.flags|=1024),t}function wo(){var e=zl!==0;return zl=0,e}function So(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function xo(e){if(kl){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}kl=!1}Ja=0,gt=$e=xe=null,Yn=!1,qs=zl=0,Gn=null}function Bt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?xe.memoizedState=gt=e:gt=gt.next=e,gt}function mt(){if($e===null){var e=xe.alternate;e=e!==null?e.memoizedState:null}else e=$e.next;var t=gt===null?xe.memoizedState:gt.next;if(t!==null)gt=t,$e=e;else{if(e===null)throw xe.alternate===null?Error(o(467)):Error(o(310));$e=e,e={memoizedState:$e.memoizedState,baseState:$e.baseState,baseQueue:$e.baseQueue,queue:$e.queue,next:null},gt===null?xe.memoizedState=gt=e:gt=gt.next=e}return gt}function Ml(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ds(e){var t=qs;return qs+=1,Gn===null&&(Gn=[]),e=Wu(Gn,e,t),t=xe,(gt===null?t.memoizedState:gt.next)===null&&(t=t.alternate,D.H=t===null||t.memoizedState===null?Gd:Ro),e}function Rl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Ds(e);if(e.$$typeof===ie)return Ot(e)}throw Error(o(438,String(e)))}function No(e){var t=null,a=xe.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var r=xe.alternate;r!==null&&(r=r.updateQueue,r!==null&&(r=r.memoCache,r!=null&&(t={data:r.data.map(function(c){return c.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=Ml(),xe.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),r=0;r<e;r++)a[r]=nt;return t.index++,a}function Fa(e,t){return typeof t=="function"?t(e):t}function Ul(e){var t=mt();return Eo(t,$e,e)}function Eo(e,t,a){var r=e.queue;if(r===null)throw Error(o(311));r.lastRenderedReducer=a;var c=e.baseQueue,u=r.pending;if(u!==null){if(c!==null){var f=c.next;c.next=u.next,u.next=f}t.baseQueue=c=u,r.pending=null}if(u=e.baseState,c===null)e.memoizedState=u;else{t=c.next;var _=f=null,j=null,A=t,H=!1;do{var Y=A.lane&-536870913;if(Y!==A.lane?(ke&Y)===Y:(Ja&Y)===Y){var O=A.revertLane;if(O===0)j!==null&&(j=j.next={lane:0,revertLane:0,gesture:null,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null}),Y===Rn&&(H=!0);else if((Ja&O)===O){A=A.next,O===Rn&&(H=!0);continue}else Y={lane:0,revertLane:A.revertLane,gesture:null,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null},j===null?(_=j=Y,f=u):j=j.next=Y,xe.lanes|=O,Tr|=O;Y=A.action,mn&&a(u,Y),u=A.hasEagerState?A.eagerState:a(u,Y)}else O={lane:Y,revertLane:A.revertLane,gesture:A.gesture,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null},j===null?(_=j=O,f=u):j=j.next=O,xe.lanes|=Y,Tr|=Y;A=A.next}while(A!==null&&A!==t);if(j===null?f=u:j.next=_,!Wt(u,e.memoizedState)&&(_t=!0,H&&(a=Un,a!==null)))throw a;e.memoizedState=u,e.baseState=f,e.baseQueue=j,r.lastRenderedState=u}return c===null&&(r.lanes=0),[e.memoizedState,r.dispatch]}function Co(e){var t=mt(),a=t.queue;if(a===null)throw Error(o(311));a.lastRenderedReducer=e;var r=a.dispatch,c=a.pending,u=t.memoizedState;if(c!==null){a.pending=null;var f=c=c.next;do u=e(u,f.action),f=f.next;while(f!==c);Wt(u,t.memoizedState)||(_t=!0),t.memoizedState=u,t.baseQueue===null&&(t.baseState=u),a.lastRenderedState=u}return[u,r]}function od(e,t,a){var r=xe,c=mt(),u=Me;if(u){if(a===void 0)throw Error(o(407));a=a()}else a=t();var f=!Wt(($e||c).memoizedState,a);if(f&&(c.memoizedState=a,_t=!0),c=c.queue,To(dd.bind(null,r,c,e),[e]),c.getSnapshot!==t||f||gt!==null&&gt.memoizedState.tag&1){if(r.flags|=2048,Qn(9,{destroy:void 0},ud.bind(null,r,c,a,t),null),et===null)throw Error(o(349));u||(Ja&127)!==0||cd(r,t,a)}return a}function cd(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=xe.updateQueue,t===null?(t=Ml(),xe.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function ud(e,t,a,r){t.value=a,t.getSnapshot=r,md(t)&&fd(e)}function dd(e,t,a){return a(function(){md(t)&&fd(e)})}function md(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Wt(e,a)}catch{return!0}}function fd(e){var t=an(e,2);t!==null&&Jt(t,e,2)}function qo(e){var t=Bt();if(typeof e=="function"){var a=e;if(e=a(),mn){ee(!0);try{a()}finally{ee(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fa,lastRenderedState:e},t}function hd(e,t,a,r){return e.baseState=a,Eo(e,$e,typeof r=="function"?r:Fa)}function pp(e,t,a,r,c){if(Bl(e))throw Error(o(485));if(e=t.action,e!==null){var u={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(f){u.listeners.push(f)}};D.T!==null?a(!0):u.isTransition=!1,r(u),a=t.pending,a===null?(u.next=t.pending=u,pd(t,u)):(u.next=a.next,t.pending=a.next=u)}}function pd(e,t){var a=t.action,r=t.payload,c=e.state;if(t.isTransition){var u=D.T,f={};D.T=f;try{var _=a(c,r),j=D.S;j!==null&&j(f,_),gd(e,t,_)}catch(A){Do(e,t,A)}finally{u!==null&&f.types!==null&&(u.types=f.types),D.T=u}}else try{u=a(c,r),gd(e,t,u)}catch(A){Do(e,t,A)}}function gd(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(r){_d(e,t,r)},function(r){return Do(e,t,r)}):_d(e,t,a)}function _d(e,t,a){t.status="fulfilled",t.value=a,yd(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,pd(e,a)))}function Do(e,t,a){var r=e.pending;if(e.pending=null,r!==null){r=r.next;do t.status="rejected",t.reason=a,yd(t),t=t.next;while(t!==r)}e.action=null}function yd(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function vd(e,t){return t}function bd(e,t){if(Me){var a=et.formState;if(a!==null){e:{var r=xe;if(Me){if(at){t:{for(var c=at,u=ma;c.nodeType!==8;){if(!u){c=null;break t}if(c=ha(c.nextSibling),c===null){c=null;break t}}u=c.data,c=u==="F!"||u==="F"?c:null}if(c){at=ha(c.nextSibling),r=c.data==="F!";break e}}jr(r)}r=!1}r&&(t=a[0])}}return a=Bt(),a.memoizedState=a.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:vd,lastRenderedState:t},a.queue=r,a=Ld.bind(null,xe,r),r.dispatch=a,r=qo(!1),u=Mo.bind(null,xe,!1,r.queue),r=Bt(),c={state:t,dispatch:null,action:e,pending:null},r.queue=c,a=pp.bind(null,xe,c,u,a),c.dispatch=a,r.memoizedState=e,[t,a,!1]}function jd(e){var t=mt();return wd(t,$e,e)}function wd(e,t,a){if(t=Eo(e,t,vd)[0],e=Ul(Fa)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var r=Ds(t)}catch(f){throw f===Hn?Cl:f}else r=t;t=mt();var c=t.queue,u=c.dispatch;return a!==t.memoizedState&&(xe.flags|=2048,Qn(9,{destroy:void 0},gp.bind(null,c,a),null)),[r,u,e]}function gp(e,t){e.action=t}function Sd(e){var t=mt(),a=$e;if(a!==null)return wd(t,a,e);mt(),t=t.memoizedState,a=mt();var r=a.queue.dispatch;return a.memoizedState=e,[t,r,!1]}function Qn(e,t,a,r){return e={tag:e,create:a,deps:r,inst:t,next:null},t=xe.updateQueue,t===null&&(t=Ml(),xe.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(r=a.next,a.next=e,e.next=r,t.lastEffect=e),e}function xd(){return mt().memoizedState}function Hl(e,t,a,r){var c=Bt();xe.flags|=e,c.memoizedState=Qn(1|t,{destroy:void 0},a,r===void 0?null:r)}function Ll(e,t,a,r){var c=mt();r=r===void 0?null:r;var u=c.memoizedState.inst;$e!==null&&r!==null&&bo(r,$e.memoizedState.deps)?c.memoizedState=Qn(t,u,a,r):(xe.flags|=e,c.memoizedState=Qn(1|t,u,a,r))}function Nd(e,t){Hl(8390656,8,e,t)}function To(e,t){Ll(2048,8,e,t)}function _p(e){xe.flags|=4;var t=xe.updateQueue;if(t===null)t=Ml(),xe.updateQueue=t,t.events=[e];else{var a=t.events;a===null?t.events=[e]:a.push(e)}}function Ed(e){var t=mt().memoizedState;return _p({ref:t,nextImpl:e}),function(){if((Xe&2)!==0)throw Error(o(440));return t.impl.apply(void 0,arguments)}}function Cd(e,t){return Ll(4,2,e,t)}function qd(e,t){return Ll(4,4,e,t)}function Dd(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Td(e,t,a){a=a!=null?a.concat([e]):null,Ll(4,4,Dd.bind(null,t,e),a)}function Ao(){}function Ad(e,t){var a=mt();t=t===void 0?null:t;var r=a.memoizedState;return t!==null&&bo(t,r[1])?r[0]:(a.memoizedState=[e,t],e)}function Od(e,t){var a=mt();t=t===void 0?null:t;var r=a.memoizedState;if(t!==null&&bo(t,r[1]))return r[0];if(r=e(),mn){ee(!0);try{e()}finally{ee(!1)}}return a.memoizedState=[r,t],r}function Oo(e,t,a){return a===void 0||(Ja&1073741824)!==0&&(ke&261930)===0?e.memoizedState=t:(e.memoizedState=a,e=km(),xe.lanes|=e,Tr|=e,a)}function kd(e,t,a,r){return Wt(a,t)?a:Bn.current!==null?(e=Oo(e,a,r),Wt(e,t)||(_t=!0),e):(Ja&42)===0||(Ja&1073741824)!==0&&(ke&261930)===0?(_t=!0,e.memoizedState=a):(e=km(),xe.lanes|=e,Tr|=e,t)}function zd(e,t,a,r,c){var u=Q.p;Q.p=u!==0&&8>u?u:8;var f=D.T,_={};D.T=_,Mo(e,!1,t,a);try{var j=c(),A=D.S;if(A!==null&&A(_,j),j!==null&&typeof j=="object"&&typeof j.then=="function"){var H=mp(j,r);Ts(e,t,H,ra(e))}else Ts(e,t,r,ra(e))}catch(Y){Ts(e,t,{then:function(){},status:"rejected",reason:Y},ra())}finally{Q.p=u,f!==null&&_.types!==null&&(f.types=_.types),D.T=f}}function yp(){}function ko(e,t,a,r){if(e.tag!==5)throw Error(o(476));var c=Md(e).queue;zd(e,c,t,I,a===null?yp:function(){return Rd(e),a(r)})}function Md(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:I,baseState:I,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fa,lastRenderedState:I},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fa,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Rd(e){var t=Md(e);t.next===null&&(t=e.alternate.memoizedState),Ts(e,t.next.queue,{},ra())}function zo(){return Ot(Ks)}function Ud(){return mt().memoizedState}function Hd(){return mt().memoizedState}function vp(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=ra();e=xr(a);var r=Nr(t,e,a);r!==null&&(Jt(r,t,a),Ns(r,t,a)),t={cache:oo()},e.payload=t;return}t=t.return}}function bp(e,t,a){var r=ra();a={lane:r,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},Bl(e)?Bd(t,a):(a=Wi(e,t,a,r),a!==null&&(Jt(a,e,r),Yd(a,t,r)))}function Ld(e,t,a){var r=ra();Ts(e,t,a,r)}function Ts(e,t,a,r){var c={lane:r,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(Bl(e))Bd(t,c);else{var u=e.alternate;if(e.lanes===0&&(u===null||u.lanes===0)&&(u=t.lastRenderedReducer,u!==null))try{var f=t.lastRenderedState,_=u(f,a);if(c.hasEagerState=!0,c.eagerState=_,Wt(_,f))return bl(e,t,c,0),et===null&&vl(),!1}catch{}finally{}if(a=Wi(e,t,c,r),a!==null)return Jt(a,e,r),Yd(a,t,r),!0}return!1}function Mo(e,t,a,r){if(r={lane:2,revertLane:fc(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},Bl(e)){if(t)throw Error(o(479))}else t=Wi(e,a,r,2),t!==null&&Jt(t,e,2)}function Bl(e){var t=e.alternate;return e===xe||t!==null&&t===xe}function Bd(e,t){Yn=kl=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function Yd(e,t,a){if((a&4194048)!==0){var r=t.lanes;r&=e.pendingLanes,a|=r,t.lanes=a,sl(e,a)}}var As={readContext:Ot,use:Rl,useCallback:it,useContext:it,useEffect:it,useImperativeHandle:it,useLayoutEffect:it,useInsertionEffect:it,useMemo:it,useReducer:it,useRef:it,useState:it,useDebugValue:it,useDeferredValue:it,useTransition:it,useSyncExternalStore:it,useId:it,useHostTransitionStatus:it,useFormState:it,useActionState:it,useOptimistic:it,useMemoCache:it,useCacheRefresh:it};As.useEffectEvent=it;var Gd={readContext:Ot,use:Rl,useCallback:function(e,t){return Bt().memoizedState=[e,t===void 0?null:t],e},useContext:Ot,useEffect:Nd,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,Hl(4194308,4,Dd.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Hl(4194308,4,e,t)},useInsertionEffect:function(e,t){Hl(4,2,e,t)},useMemo:function(e,t){var a=Bt();t=t===void 0?null:t;var r=e();if(mn){ee(!0);try{e()}finally{ee(!1)}}return a.memoizedState=[r,t],r},useReducer:function(e,t,a){var r=Bt();if(a!==void 0){var c=a(t);if(mn){ee(!0);try{a(t)}finally{ee(!1)}}}else c=t;return r.memoizedState=r.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},r.queue=e,e=e.dispatch=bp.bind(null,xe,e),[r.memoizedState,e]},useRef:function(e){var t=Bt();return e={current:e},t.memoizedState=e},useState:function(e){e=qo(e);var t=e.queue,a=Ld.bind(null,xe,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:Ao,useDeferredValue:function(e,t){var a=Bt();return Oo(a,e,t)},useTransition:function(){var e=qo(!1);return e=zd.bind(null,xe,e.queue,!0,!1),Bt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var r=xe,c=Bt();if(Me){if(a===void 0)throw Error(o(407));a=a()}else{if(a=t(),et===null)throw Error(o(349));(ke&127)!==0||cd(r,t,a)}c.memoizedState=a;var u={value:a,getSnapshot:t};return c.queue=u,Nd(dd.bind(null,r,u,e),[e]),r.flags|=2048,Qn(9,{destroy:void 0},ud.bind(null,r,u,a,t),null),a},useId:function(){var e=Bt(),t=et.identifierPrefix;if(Me){var a=Ta,r=Da;a=(r&~(1<<32-Tt(r)-1)).toString(32)+a,t="_"+t+"R_"+a,a=zl++,0<a&&(t+="H"+a.toString(32)),t+="_"}else a=fp++,t="_"+t+"r_"+a.toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:zo,useFormState:bd,useActionState:bd,useOptimistic:function(e){var t=Bt();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=Mo.bind(null,xe,!0,a),a.dispatch=t,[e,t]},useMemoCache:No,useCacheRefresh:function(){return Bt().memoizedState=vp.bind(null,xe)},useEffectEvent:function(e){var t=Bt(),a={impl:e};return t.memoizedState=a,function(){if((Xe&2)!==0)throw Error(o(440));return a.impl.apply(void 0,arguments)}}},Ro={readContext:Ot,use:Rl,useCallback:Ad,useContext:Ot,useEffect:To,useImperativeHandle:Td,useInsertionEffect:Cd,useLayoutEffect:qd,useMemo:Od,useReducer:Ul,useRef:xd,useState:function(){return Ul(Fa)},useDebugValue:Ao,useDeferredValue:function(e,t){var a=mt();return kd(a,$e.memoizedState,e,t)},useTransition:function(){var e=Ul(Fa)[0],t=mt().memoizedState;return[typeof e=="boolean"?e:Ds(e),t]},useSyncExternalStore:od,useId:Ud,useHostTransitionStatus:zo,useFormState:jd,useActionState:jd,useOptimistic:function(e,t){var a=mt();return hd(a,$e,e,t)},useMemoCache:No,useCacheRefresh:Hd};Ro.useEffectEvent=Ed;var Qd={readContext:Ot,use:Rl,useCallback:Ad,useContext:Ot,useEffect:To,useImperativeHandle:Td,useInsertionEffect:Cd,useLayoutEffect:qd,useMemo:Od,useReducer:Co,useRef:xd,useState:function(){return Co(Fa)},useDebugValue:Ao,useDeferredValue:function(e,t){var a=mt();return $e===null?Oo(a,e,t):kd(a,$e.memoizedState,e,t)},useTransition:function(){var e=Co(Fa)[0],t=mt().memoizedState;return[typeof e=="boolean"?e:Ds(e),t]},useSyncExternalStore:od,useId:Ud,useHostTransitionStatus:zo,useFormState:Sd,useActionState:Sd,useOptimistic:function(e,t){var a=mt();return $e!==null?hd(a,$e,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:No,useCacheRefresh:Hd};Qd.useEffectEvent=Ed;function Uo(e,t,a,r){t=e.memoizedState,a=a(r,t),a=a==null?t:S({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Ho={enqueueSetState:function(e,t,a){e=e._reactInternals;var r=ra(),c=xr(r);c.payload=t,a!=null&&(c.callback=a),t=Nr(e,c,r),t!==null&&(Jt(t,e,r),Ns(t,e,r))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var r=ra(),c=xr(r);c.tag=1,c.payload=t,a!=null&&(c.callback=a),t=Nr(e,c,r),t!==null&&(Jt(t,e,r),Ns(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=ra(),r=xr(a);r.tag=2,t!=null&&(r.callback=t),t=Nr(e,r,a),t!==null&&(Jt(t,e,a),Ns(t,e,a))}};function Xd(e,t,a,r,c,u,f){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,u,f):t.prototype&&t.prototype.isPureReactComponent?!_s(a,r)||!_s(c,u):!0}function Vd(e,t,a,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,r),t.state!==e&&Ho.enqueueReplaceState(t,t.state,null)}function fn(e,t){var a=t;if("ref"in t){a={};for(var r in t)r!=="ref"&&(a[r]=t[r])}if(e=e.defaultProps){a===t&&(a=S({},a));for(var c in e)a[c]===void 0&&(a[c]=e[c])}return a}function Zd(e){yl(e)}function Kd(e){console.error(e)}function Jd(e){yl(e)}function Yl(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(r){setTimeout(function(){throw r})}}function Fd(e,t,a){try{var r=e.onCaughtError;r(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function Lo(e,t,a){return a=xr(a),a.tag=3,a.payload={element:null},a.callback=function(){Yl(e,t)},a}function $d(e){return e=xr(e),e.tag=3,e}function Wd(e,t,a,r){var c=a.type.getDerivedStateFromError;if(typeof c=="function"){var u=r.value;e.payload=function(){return c(u)},e.callback=function(){Fd(t,a,r)}}var f=a.stateNode;f!==null&&typeof f.componentDidCatch=="function"&&(e.callback=function(){Fd(t,a,r),typeof c!="function"&&(Ar===null?Ar=new Set([this]):Ar.add(this));var _=r.stack;this.componentDidCatch(r.value,{componentStack:_!==null?_:""})})}function jp(e,t,a,r,c){if(a.flags|=32768,r!==null&&typeof r=="object"&&typeof r.then=="function"){if(t=a.alternate,t!==null&&Mn(t,a,c,!0),a=It.current,a!==null){switch(a.tag){case 31:case 13:return fa===null?Il():a.alternate===null&&ot===0&&(ot=3),a.flags&=-257,a.flags|=65536,a.lanes=c,r===ql?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([r]):t.add(r),uc(e,r,c)),!1;case 22:return a.flags|=65536,r===ql?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([r]):a.add(r)),uc(e,r,c)),!1}throw Error(o(435,a.tag))}return uc(e,r,c),Il(),!1}if(Me)return t=It.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=c,r!==ro&&(e=Error(o(422),{cause:r}),bs(ca(e,a)))):(r!==ro&&(t=Error(o(423),{cause:r}),bs(ca(t,a))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,r=ca(r,a),c=Lo(e.stateNode,r,c),po(e,c),ot!==4&&(ot=2)),!1;var u=Error(o(520),{cause:r});if(u=ca(u,a),Ls===null?Ls=[u]:Ls.push(u),ot!==4&&(ot=2),t===null)return!0;r=ca(r,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=c&-c,a.lanes|=e,e=Lo(a.stateNode,r,e),po(a,e),!1;case 1:if(t=a.type,u=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||u!==null&&typeof u.componentDidCatch=="function"&&(Ar===null||!Ar.has(u))))return a.flags|=65536,c&=-c,a.lanes|=c,c=$d(c),Wd(c,e,a,r),po(a,c),!1}a=a.return}while(a!==null);return!1}var Bo=Error(o(461)),_t=!1;function kt(e,t,a,r){t.child=e===null?td(t,null,a,r):dn(t,e.child,a,r)}function Pd(e,t,a,r,c){a=a.render;var u=t.ref;if("ref"in r){var f={};for(var _ in r)_!=="ref"&&(f[_]=r[_])}else f=r;return ln(t),r=jo(e,t,a,f,u,c),_=wo(),e!==null&&!_t?(So(e,t,c),$a(e,t,c)):(Me&&_&&to(t),t.flags|=1,kt(e,t,r,c),t.child)}function Id(e,t,a,r,c){if(e===null){var u=a.type;return typeof u=="function"&&!Pi(u)&&u.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=u,em(e,t,u,r,c)):(e=wl(a.type,null,r,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(u=e.child,!Jo(e,c)){var f=u.memoizedProps;if(a=a.compare,a=a!==null?a:_s,a(f,r)&&e.ref===t.ref)return $a(e,t,c)}return t.flags|=1,e=Xa(u,r),e.ref=t.ref,e.return=t,t.child=e}function em(e,t,a,r,c){if(e!==null){var u=e.memoizedProps;if(_s(u,r)&&e.ref===t.ref)if(_t=!1,t.pendingProps=r=u,Jo(e,c))(e.flags&131072)!==0&&(_t=!0);else return t.lanes=e.lanes,$a(e,t,c)}return Yo(e,t,a,r,c)}function tm(e,t,a,r){var c=r.children,u=e!==null?e.memoizedState:null;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.mode==="hidden"){if((t.flags&128)!==0){if(u=u!==null?u.baseLanes|a:a,e!==null){for(r=t.child=e.child,c=0;r!==null;)c=c|r.lanes|r.childLanes,r=r.sibling;r=c&~u}else r=0,t.child=null;return am(e,t,u,a,r)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&El(t,u!==null?u.cachePool:null),u!==null?nd(t,u):_o(),sd(t);else return r=t.lanes=536870912,am(e,t,u!==null?u.baseLanes|a:a,a,r)}else u!==null?(El(t,u.cachePool),nd(t,u),Cr(),t.memoizedState=null):(e!==null&&El(t,null),_o(),Cr());return kt(e,t,c,a),t.child}function Os(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function am(e,t,a,r,c){var u=uo();return u=u===null?null:{parent:pt._currentValue,pool:u},t.memoizedState={baseLanes:a,cachePool:u},e!==null&&El(t,null),_o(),sd(t),e!==null&&Mn(e,t,r,!0),t.childLanes=c,null}function Gl(e,t){return t=Xl({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function rm(e,t,a){return dn(t,e.child,null,a),e=Gl(t,t.pendingProps),e.flags|=2,ea(t),t.memoizedState=null,e}function wp(e,t,a){var r=t.pendingProps,c=(t.flags&128)!==0;if(t.flags&=-129,e===null){if(Me){if(r.mode==="hidden")return e=Gl(t,r),t.lanes=536870912,Os(null,e);if(vo(t),(e=at)?(e=gf(e,ma),e=e!==null&&e.data==="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:vr!==null?{id:Da,overflow:Ta}:null,retryLane:536870912,hydrationErrors:null},a=Bu(e),a.return=t,t.child=a,At=t,at=null)):e=null,e===null)throw jr(t);return t.lanes=536870912,null}return Gl(t,r)}var u=e.memoizedState;if(u!==null){var f=u.dehydrated;if(vo(t),c)if(t.flags&256)t.flags&=-257,t=rm(e,t,a);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(o(558));else if(_t||Mn(e,t,a,!1),c=(a&e.childLanes)!==0,_t||c){if(r=et,r!==null&&(f=ll(r,a),f!==0&&f!==u.retryLane))throw u.retryLane=f,an(e,f),Jt(r,e,f),Bo;Il(),t=rm(e,t,a)}else e=u.treeContext,at=ha(f.nextSibling),At=t,Me=!0,br=null,ma=!1,e!==null&&Qu(t,e),t=Gl(t,r),t.flags|=4096;return t}return e=Xa(e.child,{mode:r.mode,children:r.children}),e.ref=t.ref,t.child=e,e.return=t,e}function Ql(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(o(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function Yo(e,t,a,r,c){return ln(t),a=jo(e,t,a,r,void 0,c),r=wo(),e!==null&&!_t?(So(e,t,c),$a(e,t,c)):(Me&&r&&to(t),t.flags|=1,kt(e,t,a,c),t.child)}function nm(e,t,a,r,c,u){return ln(t),t.updateQueue=null,a=id(t,r,a,c),ld(e),r=wo(),e!==null&&!_t?(So(e,t,u),$a(e,t,u)):(Me&&r&&to(t),t.flags|=1,kt(e,t,a,u),t.child)}function sm(e,t,a,r,c){if(ln(t),t.stateNode===null){var u=An,f=a.contextType;typeof f=="object"&&f!==null&&(u=Ot(f)),u=new a(r,u),t.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=Ho,t.stateNode=u,u._reactInternals=t,u=t.stateNode,u.props=r,u.state=t.memoizedState,u.refs={},fo(t),f=a.contextType,u.context=typeof f=="object"&&f!==null?Ot(f):An,u.state=t.memoizedState,f=a.getDerivedStateFromProps,typeof f=="function"&&(Uo(t,a,f,r),u.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(f=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),f!==u.state&&Ho.enqueueReplaceState(u,u.state,null),Cs(t,r,u,c),Es(),u.state=t.memoizedState),typeof u.componentDidMount=="function"&&(t.flags|=4194308),r=!0}else if(e===null){u=t.stateNode;var _=t.memoizedProps,j=fn(a,_);u.props=j;var A=u.context,H=a.contextType;f=An,typeof H=="object"&&H!==null&&(f=Ot(H));var Y=a.getDerivedStateFromProps;H=typeof Y=="function"||typeof u.getSnapshotBeforeUpdate=="function",_=t.pendingProps!==_,H||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(_||A!==f)&&Vd(t,u,r,f),Sr=!1;var O=t.memoizedState;u.state=O,Cs(t,r,u,c),Es(),A=t.memoizedState,_||O!==A||Sr?(typeof Y=="function"&&(Uo(t,a,Y,r),A=t.memoizedState),(j=Sr||Xd(t,a,j,r,O,A,f))?(H||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(t.flags|=4194308)):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=A),u.props=r,u.state=A,u.context=f,r=j):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{u=t.stateNode,ho(e,t),f=t.memoizedProps,H=fn(a,f),u.props=H,Y=t.pendingProps,O=u.context,A=a.contextType,j=An,typeof A=="object"&&A!==null&&(j=Ot(A)),_=a.getDerivedStateFromProps,(A=typeof _=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(f!==Y||O!==j)&&Vd(t,u,r,j),Sr=!1,O=t.memoizedState,u.state=O,Cs(t,r,u,c),Es();var z=t.memoizedState;f!==Y||O!==z||Sr||e!==null&&e.dependencies!==null&&xl(e.dependencies)?(typeof _=="function"&&(Uo(t,a,_,r),z=t.memoizedState),(H=Sr||Xd(t,a,H,r,O,z,j)||e!==null&&e.dependencies!==null&&xl(e.dependencies))?(A||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(r,z,j),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(r,z,j)),typeof u.componentDidUpdate=="function"&&(t.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof u.componentDidUpdate!="function"||f===e.memoizedProps&&O===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&O===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=z),u.props=r,u.state=z,u.context=j,r=H):(typeof u.componentDidUpdate!="function"||f===e.memoizedProps&&O===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&O===e.memoizedState||(t.flags|=1024),r=!1)}return u=r,Ql(e,t),r=(t.flags&128)!==0,u||r?(u=t.stateNode,a=r&&typeof a.getDerivedStateFromError!="function"?null:u.render(),t.flags|=1,e!==null&&r?(t.child=dn(t,e.child,null,c),t.child=dn(t,null,a,c)):kt(e,t,a,c),t.memoizedState=u.state,e=t.child):e=$a(e,t,c),e}function lm(e,t,a,r){return nn(),t.flags|=256,kt(e,t,a,r),t.child}var Go={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Qo(e){return{baseLanes:e,cachePool:Fu()}}function Xo(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=aa),e}function im(e,t,a){var r=t.pendingProps,c=!1,u=(t.flags&128)!==0,f;if((f=u)||(f=e!==null&&e.memoizedState===null?!1:(dt.current&2)!==0),f&&(c=!0,t.flags&=-129),f=(t.flags&32)!==0,t.flags&=-33,e===null){if(Me){if(c?Er(t):Cr(),(e=at)?(e=gf(e,ma),e=e!==null&&e.data!=="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:vr!==null?{id:Da,overflow:Ta}:null,retryLane:536870912,hydrationErrors:null},a=Bu(e),a.return=t,t.child=a,At=t,at=null)):e=null,e===null)throw jr(t);return Ec(e)?t.lanes=32:t.lanes=536870912,null}var _=r.children;return r=r.fallback,c?(Cr(),c=t.mode,_=Xl({mode:"hidden",children:_},c),r=rn(r,c,a,null),_.return=t,r.return=t,_.sibling=r,t.child=_,r=t.child,r.memoizedState=Qo(a),r.childLanes=Xo(e,f,a),t.memoizedState=Go,Os(null,r)):(Er(t),Vo(t,_))}var j=e.memoizedState;if(j!==null&&(_=j.dehydrated,_!==null)){if(u)t.flags&256?(Er(t),t.flags&=-257,t=Zo(e,t,a)):t.memoizedState!==null?(Cr(),t.child=e.child,t.flags|=128,t=null):(Cr(),_=r.fallback,c=t.mode,r=Xl({mode:"visible",children:r.children},c),_=rn(_,c,a,null),_.flags|=2,r.return=t,_.return=t,r.sibling=_,t.child=r,dn(t,e.child,null,a),r=t.child,r.memoizedState=Qo(a),r.childLanes=Xo(e,f,a),t.memoizedState=Go,t=Os(null,r));else if(Er(t),Ec(_)){if(f=_.nextSibling&&_.nextSibling.dataset,f)var A=f.dgst;f=A,r=Error(o(419)),r.stack="",r.digest=f,bs({value:r,source:null,stack:null}),t=Zo(e,t,a)}else if(_t||Mn(e,t,a,!1),f=(a&e.childLanes)!==0,_t||f){if(f=et,f!==null&&(r=ll(f,a),r!==0&&r!==j.retryLane))throw j.retryLane=r,an(e,r),Jt(f,e,r),Bo;Nc(_)||Il(),t=Zo(e,t,a)}else Nc(_)?(t.flags|=192,t.child=e.child,t=null):(e=j.treeContext,at=ha(_.nextSibling),At=t,Me=!0,br=null,ma=!1,e!==null&&Qu(t,e),t=Vo(t,r.children),t.flags|=4096);return t}return c?(Cr(),_=r.fallback,c=t.mode,j=e.child,A=j.sibling,r=Xa(j,{mode:"hidden",children:r.children}),r.subtreeFlags=j.subtreeFlags&65011712,A!==null?_=Xa(A,_):(_=rn(_,c,a,null),_.flags|=2),_.return=t,r.return=t,r.sibling=_,t.child=r,Os(null,r),r=t.child,_=e.child.memoizedState,_===null?_=Qo(a):(c=_.cachePool,c!==null?(j=pt._currentValue,c=c.parent!==j?{parent:j,pool:j}:c):c=Fu(),_={baseLanes:_.baseLanes|a,cachePool:c}),r.memoizedState=_,r.childLanes=Xo(e,f,a),t.memoizedState=Go,Os(e.child,r)):(Er(t),a=e.child,e=a.sibling,a=Xa(a,{mode:"visible",children:r.children}),a.return=t,a.sibling=null,e!==null&&(f=t.deletions,f===null?(t.deletions=[e],t.flags|=16):f.push(e)),t.child=a,t.memoizedState=null,a)}function Vo(e,t){return t=Xl({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Xl(e,t){return e=Pt(22,e,null,t),e.lanes=0,e}function Zo(e,t,a){return dn(t,e.child,null,a),e=Vo(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function om(e,t,a){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),lo(e.return,t,a)}function Ko(e,t,a,r,c,u){var f=e.memoizedState;f===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:a,tailMode:c,treeForkCount:u}:(f.isBackwards=t,f.rendering=null,f.renderingStartTime=0,f.last=r,f.tail=a,f.tailMode=c,f.treeForkCount=u)}function cm(e,t,a){var r=t.pendingProps,c=r.revealOrder,u=r.tail;r=r.children;var f=dt.current,_=(f&2)!==0;if(_?(f=f&1|2,t.flags|=128):f&=1,je(dt,f),kt(e,t,r,a),r=Me?vs:0,!_&&e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&om(e,a,t);else if(e.tag===19)om(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(c){case"forwards":for(a=t.child,c=null;a!==null;)e=a.alternate,e!==null&&Ol(e)===null&&(c=a),a=a.sibling;a=c,a===null?(c=t.child,t.child=null):(c=a.sibling,a.sibling=null),Ko(t,!1,c,a,u,r);break;case"backwards":case"unstable_legacy-backwards":for(a=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&Ol(e)===null){t.child=c;break}e=c.sibling,c.sibling=a,a=c,c=e}Ko(t,!0,a,null,u,r);break;case"together":Ko(t,!1,null,null,void 0,r);break;default:t.memoizedState=null}return t.child}function $a(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),Tr|=t.lanes,(a&t.childLanes)===0)if(e!==null){if(Mn(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(o(153));if(t.child!==null){for(e=t.child,a=Xa(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=Xa(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function Jo(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&xl(e)))}function Sp(e,t,a){switch(t.tag){case 3:W(t,t.stateNode.containerInfo),wr(t,pt,e.memoizedState.cache),nn();break;case 27:case 5:Ge(t);break;case 4:W(t,t.stateNode.containerInfo);break;case 10:wr(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,vo(t),null;break;case 13:var r=t.memoizedState;if(r!==null)return r.dehydrated!==null?(Er(t),t.flags|=128,null):(a&t.child.childLanes)!==0?im(e,t,a):(Er(t),e=$a(e,t,a),e!==null?e.sibling:null);Er(t);break;case 19:var c=(e.flags&128)!==0;if(r=(a&t.childLanes)!==0,r||(Mn(e,t,a,!1),r=(a&t.childLanes)!==0),c){if(r)return cm(e,t,a);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),je(dt,dt.current),r)break;return null;case 22:return t.lanes=0,tm(e,t,a,t.pendingProps);case 24:wr(t,pt,e.memoizedState.cache)}return $a(e,t,a)}function um(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)_t=!0;else{if(!Jo(e,a)&&(t.flags&128)===0)return _t=!1,Sp(e,t,a);_t=(e.flags&131072)!==0}else _t=!1,Me&&(t.flags&1048576)!==0&&Gu(t,vs,t.index);switch(t.lanes=0,t.tag){case 16:e:{var r=t.pendingProps;if(e=cn(t.elementType),t.type=e,typeof e=="function")Pi(e)?(r=fn(e,r),t.tag=1,t=sm(null,t,e,r,a)):(t.tag=0,t=Yo(null,t,e,r,a));else{if(e!=null){var c=e.$$typeof;if(c===me){t.tag=11,t=Pd(null,t,e,r,a);break e}else if(c===Re){t.tag=14,t=Id(null,t,e,r,a);break e}}throw t=de(e)||e,Error(o(306,t,""))}}return t;case 0:return Yo(e,t,t.type,t.pendingProps,a);case 1:return r=t.type,c=fn(r,t.pendingProps),sm(e,t,r,c,a);case 3:e:{if(W(t,t.stateNode.containerInfo),e===null)throw Error(o(387));r=t.pendingProps;var u=t.memoizedState;c=u.element,ho(e,t),Cs(t,r,null,a);var f=t.memoizedState;if(r=f.cache,wr(t,pt,r),r!==u.cache&&io(t,[pt],a,!0),Es(),r=f.element,u.isDehydrated)if(u={element:r,isDehydrated:!1,cache:f.cache},t.updateQueue.baseState=u,t.memoizedState=u,t.flags&256){t=lm(e,t,r,a);break e}else if(r!==c){c=ca(Error(o(424)),t),bs(c),t=lm(e,t,r,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(at=ha(e.firstChild),At=t,Me=!0,br=null,ma=!0,a=td(t,null,r,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(nn(),r===c){t=$a(e,t,a);break e}kt(e,t,r,a)}t=t.child}return t;case 26:return Ql(e,t),e===null?(a=wf(t.type,null,t.pendingProps,null))?t.memoizedState=a:Me||(a=t.type,e=t.pendingProps,r=li(qe.current).createElement(a),r[wt]=t,r[Rt]=e,zt(r,a,e),ht(r),t.stateNode=r):t.memoizedState=wf(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Ge(t),e===null&&Me&&(r=t.stateNode=vf(t.type,t.pendingProps,qe.current),At=t,ma=!0,c=at,Mr(t.type)?(Cc=c,at=ha(r.firstChild)):at=c),kt(e,t,t.pendingProps.children,a),Ql(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&Me&&((c=r=at)&&(r=Ip(r,t.type,t.pendingProps,ma),r!==null?(t.stateNode=r,At=t,at=ha(r.firstChild),ma=!1,c=!0):c=!1),c||jr(t)),Ge(t),c=t.type,u=t.pendingProps,f=e!==null?e.memoizedProps:null,r=u.children,wc(c,u)?r=null:f!==null&&wc(c,f)&&(t.flags|=32),t.memoizedState!==null&&(c=jo(e,t,hp,null,null,a),Ks._currentValue=c),Ql(e,t),kt(e,t,r,a),t.child;case 6:return e===null&&Me&&((e=a=at)&&(a=eg(a,t.pendingProps,ma),a!==null?(t.stateNode=a,At=t,at=null,e=!0):e=!1),e||jr(t)),null;case 13:return im(e,t,a);case 4:return W(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=dn(t,null,r,a):kt(e,t,r,a),t.child;case 11:return Pd(e,t,t.type,t.pendingProps,a);case 7:return kt(e,t,t.pendingProps,a),t.child;case 8:return kt(e,t,t.pendingProps.children,a),t.child;case 12:return kt(e,t,t.pendingProps.children,a),t.child;case 10:return r=t.pendingProps,wr(t,t.type,r.value),kt(e,t,r.children,a),t.child;case 9:return c=t.type._context,r=t.pendingProps.children,ln(t),c=Ot(c),r=r(c),t.flags|=1,kt(e,t,r,a),t.child;case 14:return Id(e,t,t.type,t.pendingProps,a);case 15:return em(e,t,t.type,t.pendingProps,a);case 19:return cm(e,t,a);case 31:return wp(e,t,a);case 22:return tm(e,t,a,t.pendingProps);case 24:return ln(t),r=Ot(pt),e===null?(c=uo(),c===null&&(c=et,u=oo(),c.pooledCache=u,u.refCount++,u!==null&&(c.pooledCacheLanes|=a),c=u),t.memoizedState={parent:r,cache:c},fo(t),wr(t,pt,c)):((e.lanes&a)!==0&&(ho(e,t),Cs(t,null,null,a),Es()),c=e.memoizedState,u=t.memoizedState,c.parent!==r?(c={parent:r,cache:r},t.memoizedState=c,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=c),wr(t,pt,r)):(r=u.cache,wr(t,pt,r),r!==c.cache&&io(t,[pt],a,!0))),kt(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(o(156,t.tag))}function Wa(e){e.flags|=4}function Fo(e,t,a,r,c){if((t=(e.mode&32)!==0)&&(t=!1),t){if(e.flags|=16777216,(c&335544128)===c)if(e.stateNode.complete)e.flags|=8192;else if(Um())e.flags|=8192;else throw un=ql,mo}else e.flags&=-16777217}function dm(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Cf(t))if(Um())e.flags|=8192;else throw un=ql,mo}function Vl(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?V():536870912,e.lanes|=t,Kn|=t)}function ks(e,t){if(!Me)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var r=null;a!==null;)a.alternate!==null&&(r=a),a=a.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function rt(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,r=0;if(t)for(var c=e.child;c!==null;)a|=c.lanes|c.childLanes,r|=c.subtreeFlags&65011712,r|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)a|=c.lanes|c.childLanes,r|=c.subtreeFlags,r|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=r,e.childLanes=a,t}function xp(e,t,a){var r=t.pendingProps;switch(ao(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rt(t),null;case 1:return rt(t),null;case 3:return a=t.stateNode,r=null,e!==null&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),Ka(pt),ve(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(zn(t)?Wa(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,no())),rt(t),null;case 26:var c=t.type,u=t.memoizedState;return e===null?(Wa(t),u!==null?(rt(t),dm(t,u)):(rt(t),Fo(t,c,null,r,a))):u?u!==e.memoizedState?(Wa(t),rt(t),dm(t,u)):(rt(t),t.flags&=-16777217):(e=e.memoizedProps,e!==r&&Wa(t),rt(t),Fo(t,c,e,r,a)),null;case 27:if(Ze(t),a=qe.current,c=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==r&&Wa(t);else{if(!r){if(t.stateNode===null)throw Error(o(166));return rt(t),null}e=Ue.current,zn(t)?Xu(t):(e=vf(c,r,a),t.stateNode=e,Wa(t))}return rt(t),null;case 5:if(Ze(t),c=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==r&&Wa(t);else{if(!r){if(t.stateNode===null)throw Error(o(166));return rt(t),null}if(u=Ue.current,zn(t))Xu(t);else{var f=li(qe.current);switch(u){case 1:u=f.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:u=f.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":u=f.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":u=f.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":u=f.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof r.is=="string"?f.createElement("select",{is:r.is}):f.createElement("select"),r.multiple?u.multiple=!0:r.size&&(u.size=r.size);break;default:u=typeof r.is=="string"?f.createElement(c,{is:r.is}):f.createElement(c)}}u[wt]=t,u[Rt]=r;e:for(f=t.child;f!==null;){if(f.tag===5||f.tag===6)u.appendChild(f.stateNode);else if(f.tag!==4&&f.tag!==27&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}t.stateNode=u;e:switch(zt(u,c,r),c){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&Wa(t)}}return rt(t),Fo(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,a),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==r&&Wa(t);else{if(typeof r!="string"&&t.stateNode===null)throw Error(o(166));if(e=qe.current,zn(t)){if(e=t.stateNode,a=t.memoizedProps,r=null,c=At,c!==null)switch(c.tag){case 27:case 5:r=c.memoizedProps}e[wt]=t,e=!!(e.nodeValue===a||r!==null&&r.suppressHydrationWarning===!0||of(e.nodeValue,a)),e||jr(t,!0)}else e=li(e).createTextNode(r),e[wt]=t,t.stateNode=e}return rt(t),null;case 31:if(a=t.memoizedState,e===null||e.memoizedState!==null){if(r=zn(t),a!==null){if(e===null){if(!r)throw Error(o(318));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(557));e[wt]=t}else nn(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;rt(t),e=!1}else a=no(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return t.flags&256?(ea(t),t):(ea(t),null);if((t.flags&128)!==0)throw Error(o(558))}return rt(t),null;case 13:if(r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=zn(t),r!==null&&r.dehydrated!==null){if(e===null){if(!c)throw Error(o(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(o(317));c[wt]=t}else nn(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;rt(t),c=!1}else c=no(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return t.flags&256?(ea(t),t):(ea(t),null)}return ea(t),(t.flags&128)!==0?(t.lanes=a,t):(a=r!==null,e=e!==null&&e.memoizedState!==null,a&&(r=t.child,c=null,r.alternate!==null&&r.alternate.memoizedState!==null&&r.alternate.memoizedState.cachePool!==null&&(c=r.alternate.memoizedState.cachePool.pool),u=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),u!==c&&(r.flags|=2048)),a!==e&&a&&(t.child.flags|=8192),Vl(t,t.updateQueue),rt(t),null);case 4:return ve(),e===null&&_c(t.stateNode.containerInfo),rt(t),null;case 10:return Ka(t.type),rt(t),null;case 19:if(fe(dt),r=t.memoizedState,r===null)return rt(t),null;if(c=(t.flags&128)!==0,u=r.rendering,u===null)if(c)ks(r,!1);else{if(ot!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(u=Ol(e),u!==null){for(t.flags|=128,ks(r,!1),e=u.updateQueue,t.updateQueue=e,Vl(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)Lu(a,e),a=a.sibling;return je(dt,dt.current&1|2),Me&&Va(t,r.treeForkCount),t.child}e=e.sibling}r.tail!==null&&bt()>$l&&(t.flags|=128,c=!0,ks(r,!1),t.lanes=4194304)}else{if(!c)if(e=Ol(u),e!==null){if(t.flags|=128,c=!0,e=e.updateQueue,t.updateQueue=e,Vl(t,e),ks(r,!0),r.tail===null&&r.tailMode==="hidden"&&!u.alternate&&!Me)return rt(t),null}else 2*bt()-r.renderingStartTime>$l&&a!==536870912&&(t.flags|=128,c=!0,ks(r,!1),t.lanes=4194304);r.isBackwards?(u.sibling=t.child,t.child=u):(e=r.last,e!==null?e.sibling=u:t.child=u,r.last=u)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=bt(),e.sibling=null,a=dt.current,je(dt,c?a&1|2:a&1),Me&&Va(t,r.treeForkCount),e):(rt(t),null);case 22:case 23:return ea(t),yo(),r=t.memoizedState!==null,e!==null?e.memoizedState!==null!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?(a&536870912)!==0&&(t.flags&128)===0&&(rt(t),t.subtreeFlags&6&&(t.flags|=8192)):rt(t),a=t.updateQueue,a!==null&&Vl(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),r=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(r=t.memoizedState.cachePool.pool),r!==a&&(t.flags|=2048),e!==null&&fe(on),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),Ka(pt),rt(t),null;case 25:return null;case 30:return null}throw Error(o(156,t.tag))}function Np(e,t){switch(ao(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ka(pt),ve(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return Ze(t),null;case 31:if(t.memoizedState!==null){if(ea(t),t.alternate===null)throw Error(o(340));nn()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if(ea(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(o(340));nn()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return fe(dt),null;case 4:return ve(),null;case 10:return Ka(t.type),null;case 22:case 23:return ea(t),yo(),e!==null&&fe(on),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return Ka(pt),null;case 25:return null;default:return null}}function mm(e,t){switch(ao(t),t.tag){case 3:Ka(pt),ve();break;case 26:case 27:case 5:Ze(t);break;case 4:ve();break;case 31:t.memoizedState!==null&&ea(t);break;case 13:ea(t);break;case 19:fe(dt);break;case 10:Ka(t.type);break;case 22:case 23:ea(t),yo(),e!==null&&fe(on);break;case 24:Ka(pt)}}function zs(e,t){try{var a=t.updateQueue,r=a!==null?a.lastEffect:null;if(r!==null){var c=r.next;a=c;do{if((a.tag&e)===e){r=void 0;var u=a.create,f=a.inst;r=u(),f.destroy=r}a=a.next}while(a!==c)}}catch(_){Je(t,t.return,_)}}function qr(e,t,a){try{var r=t.updateQueue,c=r!==null?r.lastEffect:null;if(c!==null){var u=c.next;r=u;do{if((r.tag&e)===e){var f=r.inst,_=f.destroy;if(_!==void 0){f.destroy=void 0,c=t;var j=a,A=_;try{A()}catch(H){Je(c,j,H)}}}r=r.next}while(r!==u)}}catch(H){Je(t,t.return,H)}}function fm(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{rd(t,a)}catch(r){Je(e,e.return,r)}}}function hm(e,t,a){a.props=fn(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(r){Je(e,t,r)}}function Ms(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;case 30:r=e.stateNode;break;default:r=e.stateNode}typeof a=="function"?e.refCleanup=a(r):a.current=r}}catch(c){Je(e,t,c)}}function Aa(e,t){var a=e.ref,r=e.refCleanup;if(a!==null)if(typeof r=="function")try{r()}catch(c){Je(e,t,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(c){Je(e,t,c)}else a.current=null}function pm(e){var t=e.type,a=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&r.focus();break e;case"img":a.src?r.src=a.src:a.srcSet&&(r.srcset=a.srcSet)}}catch(c){Je(e,e.return,c)}}function $o(e,t,a){try{var r=e.stateNode;Kp(r,e.type,a,t),r[Rt]=t}catch(c){Je(e,e.return,c)}}function gm(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Mr(e.type)||e.tag===4}function Wo(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||gm(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Mr(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Po(e,t,a){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=oe));else if(r!==4&&(r===27&&Mr(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(Po(e,t,a),e=e.sibling;e!==null;)Po(e,t,a),e=e.sibling}function Zl(e,t,a){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(r!==4&&(r===27&&Mr(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(Zl(e,t,a),e=e.sibling;e!==null;)Zl(e,t,a),e=e.sibling}function _m(e){var t=e.stateNode,a=e.memoizedProps;try{for(var r=e.type,c=t.attributes;c.length;)t.removeAttributeNode(c[0]);zt(t,r,a),t[wt]=e,t[Rt]=a}catch(u){Je(e,e.return,u)}}var Pa=!1,yt=!1,Io=!1,ym=typeof WeakSet=="function"?WeakSet:Set,Dt=null;function Ep(e,t){if(e=e.containerInfo,bc=fi,e=Tu(e),Vi(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var r=a.getSelection&&a.getSelection();if(r&&r.rangeCount!==0){a=r.anchorNode;var c=r.anchorOffset,u=r.focusNode;r=r.focusOffset;try{a.nodeType,u.nodeType}catch{a=null;break e}var f=0,_=-1,j=-1,A=0,H=0,Y=e,O=null;t:for(;;){for(var z;Y!==a||c!==0&&Y.nodeType!==3||(_=f+c),Y!==u||r!==0&&Y.nodeType!==3||(j=f+r),Y.nodeType===3&&(f+=Y.nodeValue.length),(z=Y.firstChild)!==null;)O=Y,Y=z;for(;;){if(Y===e)break t;if(O===a&&++A===c&&(_=f),O===u&&++H===r&&(j=f),(z=Y.nextSibling)!==null)break;Y=O,O=Y.parentNode}Y=z}a=_===-1||j===-1?null:{start:_,end:j}}else a=null}a=a||{start:0,end:0}}else a=null;for(jc={focusedElem:e,selectionRange:a},fi=!1,Dt=t;Dt!==null;)if(t=Dt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Dt=e;else for(;Dt!==null;){switch(t=Dt,u=t.alternate,e=t.flags,t.tag){case 0:if((e&4)!==0&&(e=t.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)c=e[a],c.ref.impl=c.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&u!==null){e=void 0,a=t,c=u.memoizedProps,u=u.memoizedState,r=a.stateNode;try{var se=fn(a.type,c);e=r.getSnapshotBeforeUpdate(se,u),r.__reactInternalSnapshotBeforeUpdate=e}catch(ye){Je(a,a.return,ye)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)xc(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":xc(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(o(163))}if(e=t.sibling,e!==null){e.return=t.return,Dt=e;break}Dt=t.return}}function vm(e,t,a){var r=a.flags;switch(a.tag){case 0:case 11:case 15:er(e,a),r&4&&zs(5,a);break;case 1:if(er(e,a),r&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(f){Je(a,a.return,f)}else{var c=fn(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(c,t,e.__reactInternalSnapshotBeforeUpdate)}catch(f){Je(a,a.return,f)}}r&64&&fm(a),r&512&&Ms(a,a.return);break;case 3:if(er(e,a),r&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{rd(e,t)}catch(f){Je(a,a.return,f)}}break;case 27:t===null&&r&4&&_m(a);case 26:case 5:er(e,a),t===null&&r&4&&pm(a),r&512&&Ms(a,a.return);break;case 12:er(e,a);break;case 31:er(e,a),r&4&&wm(e,a);break;case 13:er(e,a),r&4&&Sm(e,a),r&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=Mp.bind(null,a),tg(e,a))));break;case 22:if(r=a.memoizedState!==null||Pa,!r){t=t!==null&&t.memoizedState!==null||yt,c=Pa;var u=yt;Pa=r,(yt=t)&&!u?tr(e,a,(a.subtreeFlags&8772)!==0):er(e,a),Pa=c,yt=u}break;case 30:break;default:er(e,a)}}function bm(e){var t=e.alternate;t!==null&&(e.alternate=null,bm(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&Ea(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var st=null,Xt=!1;function Ia(e,t,a){for(a=a.child;a!==null;)jm(e,t,a),a=a.sibling}function jm(e,t,a){if(Et&&typeof Et.onCommitFiberUnmount=="function")try{Et.onCommitFiberUnmount(ya,a)}catch{}switch(a.tag){case 26:yt||Aa(a,t),Ia(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:yt||Aa(a,t);var r=st,c=Xt;Mr(a.type)&&(st=a.stateNode,Xt=!1),Ia(e,t,a),Xs(a.stateNode),st=r,Xt=c;break;case 5:yt||Aa(a,t);case 6:if(r=st,c=Xt,st=null,Ia(e,t,a),st=r,Xt=c,st!==null)if(Xt)try{(st.nodeType===9?st.body:st.nodeName==="HTML"?st.ownerDocument.body:st).removeChild(a.stateNode)}catch(u){Je(a,t,u)}else try{st.removeChild(a.stateNode)}catch(u){Je(a,t,u)}break;case 18:st!==null&&(Xt?(e=st,hf(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),ts(e)):hf(st,a.stateNode));break;case 4:r=st,c=Xt,st=a.stateNode.containerInfo,Xt=!0,Ia(e,t,a),st=r,Xt=c;break;case 0:case 11:case 14:case 15:qr(2,a,t),yt||qr(4,a,t),Ia(e,t,a);break;case 1:yt||(Aa(a,t),r=a.stateNode,typeof r.componentWillUnmount=="function"&&hm(a,t,r)),Ia(e,t,a);break;case 21:Ia(e,t,a);break;case 22:yt=(r=yt)||a.memoizedState!==null,Ia(e,t,a),yt=r;break;default:Ia(e,t,a)}}function wm(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{ts(e)}catch(a){Je(t,t.return,a)}}}function Sm(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{ts(e)}catch(a){Je(t,t.return,a)}}function Cp(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new ym),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new ym),t;default:throw Error(o(435,e.tag))}}function Kl(e,t){var a=Cp(e);t.forEach(function(r){if(!a.has(r)){a.add(r);var c=Rp.bind(null,e,r);r.then(c,c)}})}function Vt(e,t){var a=t.deletions;if(a!==null)for(var r=0;r<a.length;r++){var c=a[r],u=e,f=t,_=f;e:for(;_!==null;){switch(_.tag){case 27:if(Mr(_.type)){st=_.stateNode,Xt=!1;break e}break;case 5:st=_.stateNode,Xt=!1;break e;case 3:case 4:st=_.stateNode.containerInfo,Xt=!0;break e}_=_.return}if(st===null)throw Error(o(160));jm(u,f,c),st=null,Xt=!1,u=c.alternate,u!==null&&(u.return=null),c.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)xm(t,e),t=t.sibling}var wa=null;function xm(e,t){var a=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Vt(t,e),Zt(e),r&4&&(qr(3,e,e.return),zs(3,e),qr(5,e,e.return));break;case 1:Vt(t,e),Zt(e),r&512&&(yt||a===null||Aa(a,a.return)),r&64&&Pa&&(e=e.updateQueue,e!==null&&(r=e.callbacks,r!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?r:a.concat(r))));break;case 26:var c=wa;if(Vt(t,e),Zt(e),r&512&&(yt||a===null||Aa(a,a.return)),r&4){var u=a!==null?a.memoizedState:null;if(r=e.memoizedState,a===null)if(r===null)if(e.stateNode===null){e:{r=e.type,a=e.memoizedProps,c=c.ownerDocument||c;t:switch(r){case"title":u=c.getElementsByTagName("title")[0],(!u||u[Kr]||u[wt]||u.namespaceURI==="http://www.w3.org/2000/svg"||u.hasAttribute("itemprop"))&&(u=c.createElement(r),c.head.insertBefore(u,c.querySelector("head > title"))),zt(u,r,a),u[wt]=e,ht(u),r=u;break e;case"link":var f=Nf("link","href",c).get(r+(a.href||""));if(f){for(var _=0;_<f.length;_++)if(u=f[_],u.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&u.getAttribute("rel")===(a.rel==null?null:a.rel)&&u.getAttribute("title")===(a.title==null?null:a.title)&&u.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){f.splice(_,1);break t}}u=c.createElement(r),zt(u,r,a),c.head.appendChild(u);break;case"meta":if(f=Nf("meta","content",c).get(r+(a.content||""))){for(_=0;_<f.length;_++)if(u=f[_],u.getAttribute("content")===(a.content==null?null:""+a.content)&&u.getAttribute("name")===(a.name==null?null:a.name)&&u.getAttribute("property")===(a.property==null?null:a.property)&&u.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&u.getAttribute("charset")===(a.charSet==null?null:a.charSet)){f.splice(_,1);break t}}u=c.createElement(r),zt(u,r,a),c.head.appendChild(u);break;default:throw Error(o(468,r))}u[wt]=e,ht(u),r=u}e.stateNode=r}else Ef(c,e.type,e.stateNode);else e.stateNode=xf(c,r,e.memoizedProps);else u!==r?(u===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):u.count--,r===null?Ef(c,e.type,e.stateNode):xf(c,r,e.memoizedProps)):r===null&&e.stateNode!==null&&$o(e,e.memoizedProps,a.memoizedProps)}break;case 27:Vt(t,e),Zt(e),r&512&&(yt||a===null||Aa(a,a.return)),a!==null&&r&4&&$o(e,e.memoizedProps,a.memoizedProps);break;case 5:if(Vt(t,e),Zt(e),r&512&&(yt||a===null||Aa(a,a.return)),e.flags&32){c=e.stateNode;try{Ga(c,"")}catch(se){Je(e,e.return,se)}}r&4&&e.stateNode!=null&&(c=e.memoizedProps,$o(e,c,a!==null?a.memoizedProps:c)),r&1024&&(Io=!0);break;case 6:if(Vt(t,e),Zt(e),r&4){if(e.stateNode===null)throw Error(o(162));r=e.memoizedProps,a=e.stateNode;try{a.nodeValue=r}catch(se){Je(e,e.return,se)}}break;case 3:if(ci=null,c=wa,wa=ii(t.containerInfo),Vt(t,e),wa=c,Zt(e),r&4&&a!==null&&a.memoizedState.isDehydrated)try{ts(t.containerInfo)}catch(se){Je(e,e.return,se)}Io&&(Io=!1,Nm(e));break;case 4:r=wa,wa=ii(e.stateNode.containerInfo),Vt(t,e),Zt(e),wa=r;break;case 12:Vt(t,e),Zt(e);break;case 31:Vt(t,e),Zt(e),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,Kl(e,r)));break;case 13:Vt(t,e),Zt(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(Fl=bt()),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,Kl(e,r)));break;case 22:c=e.memoizedState!==null;var j=a!==null&&a.memoizedState!==null,A=Pa,H=yt;if(Pa=A||c,yt=H||j,Vt(t,e),yt=H,Pa=A,Zt(e),r&8192)e:for(t=e.stateNode,t._visibility=c?t._visibility&-2:t._visibility|1,c&&(a===null||j||Pa||yt||hn(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){j=a=t;try{if(u=j.stateNode,c)f=u.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none";else{_=j.stateNode;var Y=j.memoizedProps.style,O=Y!=null&&Y.hasOwnProperty("display")?Y.display:null;_.style.display=O==null||typeof O=="boolean"?"":(""+O).trim()}}catch(se){Je(j,j.return,se)}}}else if(t.tag===6){if(a===null){j=t;try{j.stateNode.nodeValue=c?"":j.memoizedProps}catch(se){Je(j,j.return,se)}}}else if(t.tag===18){if(a===null){j=t;try{var z=j.stateNode;c?pf(z,!0):pf(j.stateNode,!1)}catch(se){Je(j,j.return,se)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}r&4&&(r=e.updateQueue,r!==null&&(a=r.retryQueue,a!==null&&(r.retryQueue=null,Kl(e,a))));break;case 19:Vt(t,e),Zt(e),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,Kl(e,r)));break;case 30:break;case 21:break;default:Vt(t,e),Zt(e)}}function Zt(e){var t=e.flags;if(t&2){try{for(var a,r=e.return;r!==null;){if(gm(r)){a=r;break}r=r.return}if(a==null)throw Error(o(160));switch(a.tag){case 27:var c=a.stateNode,u=Wo(e);Zl(e,u,c);break;case 5:var f=a.stateNode;a.flags&32&&(Ga(f,""),a.flags&=-33);var _=Wo(e);Zl(e,_,f);break;case 3:case 4:var j=a.stateNode.containerInfo,A=Wo(e);Po(e,A,j);break;default:throw Error(o(161))}}catch(H){Je(e,e.return,H)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Nm(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;Nm(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function er(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)vm(e,t.alternate,t),t=t.sibling}function hn(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:qr(4,t,t.return),hn(t);break;case 1:Aa(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&hm(t,t.return,a),hn(t);break;case 27:Xs(t.stateNode);case 26:case 5:Aa(t,t.return),hn(t);break;case 22:t.memoizedState===null&&hn(t);break;case 30:hn(t);break;default:hn(t)}e=e.sibling}}function tr(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var r=t.alternate,c=e,u=t,f=u.flags;switch(u.tag){case 0:case 11:case 15:tr(c,u,a),zs(4,u);break;case 1:if(tr(c,u,a),r=u,c=r.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(A){Je(r,r.return,A)}if(r=u,c=r.updateQueue,c!==null){var _=r.stateNode;try{var j=c.shared.hiddenCallbacks;if(j!==null)for(c.shared.hiddenCallbacks=null,c=0;c<j.length;c++)ad(j[c],_)}catch(A){Je(r,r.return,A)}}a&&f&64&&fm(u),Ms(u,u.return);break;case 27:_m(u);case 26:case 5:tr(c,u,a),a&&r===null&&f&4&&pm(u),Ms(u,u.return);break;case 12:tr(c,u,a);break;case 31:tr(c,u,a),a&&f&4&&wm(c,u);break;case 13:tr(c,u,a),a&&f&4&&Sm(c,u);break;case 22:u.memoizedState===null&&tr(c,u,a),Ms(u,u.return);break;case 30:break;default:tr(c,u,a)}t=t.sibling}}function ec(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&js(a))}function tc(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&js(e))}function Sa(e,t,a,r){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Em(e,t,a,r),t=t.sibling}function Em(e,t,a,r){var c=t.flags;switch(t.tag){case 0:case 11:case 15:Sa(e,t,a,r),c&2048&&zs(9,t);break;case 1:Sa(e,t,a,r);break;case 3:Sa(e,t,a,r),c&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&js(e)));break;case 12:if(c&2048){Sa(e,t,a,r),e=t.stateNode;try{var u=t.memoizedProps,f=u.id,_=u.onPostCommit;typeof _=="function"&&_(f,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(j){Je(t,t.return,j)}}else Sa(e,t,a,r);break;case 31:Sa(e,t,a,r);break;case 13:Sa(e,t,a,r);break;case 23:break;case 22:u=t.stateNode,f=t.alternate,t.memoizedState!==null?u._visibility&2?Sa(e,t,a,r):Rs(e,t):u._visibility&2?Sa(e,t,a,r):(u._visibility|=2,Xn(e,t,a,r,(t.subtreeFlags&10256)!==0||!1)),c&2048&&ec(f,t);break;case 24:Sa(e,t,a,r),c&2048&&tc(t.alternate,t);break;default:Sa(e,t,a,r)}}function Xn(e,t,a,r,c){for(c=c&&((t.subtreeFlags&10256)!==0||!1),t=t.child;t!==null;){var u=e,f=t,_=a,j=r,A=f.flags;switch(f.tag){case 0:case 11:case 15:Xn(u,f,_,j,c),zs(8,f);break;case 23:break;case 22:var H=f.stateNode;f.memoizedState!==null?H._visibility&2?Xn(u,f,_,j,c):Rs(u,f):(H._visibility|=2,Xn(u,f,_,j,c)),c&&A&2048&&ec(f.alternate,f);break;case 24:Xn(u,f,_,j,c),c&&A&2048&&tc(f.alternate,f);break;default:Xn(u,f,_,j,c)}t=t.sibling}}function Rs(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,r=t,c=r.flags;switch(r.tag){case 22:Rs(a,r),c&2048&&ec(r.alternate,r);break;case 24:Rs(a,r),c&2048&&tc(r.alternate,r);break;default:Rs(a,r)}t=t.sibling}}var Us=8192;function Vn(e,t,a){if(e.subtreeFlags&Us)for(e=e.child;e!==null;)Cm(e,t,a),e=e.sibling}function Cm(e,t,a){switch(e.tag){case 26:Vn(e,t,a),e.flags&Us&&e.memoizedState!==null&&fg(a,wa,e.memoizedState,e.memoizedProps);break;case 5:Vn(e,t,a);break;case 3:case 4:var r=wa;wa=ii(e.stateNode.containerInfo),Vn(e,t,a),wa=r;break;case 22:e.memoizedState===null&&(r=e.alternate,r!==null&&r.memoizedState!==null?(r=Us,Us=16777216,Vn(e,t,a),Us=r):Vn(e,t,a));break;default:Vn(e,t,a)}}function qm(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Hs(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var r=t[a];Dt=r,Tm(r,e)}qm(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Dm(e),e=e.sibling}function Dm(e){switch(e.tag){case 0:case 11:case 15:Hs(e),e.flags&2048&&qr(9,e,e.return);break;case 3:Hs(e);break;case 12:Hs(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Jl(e)):Hs(e);break;default:Hs(e)}}function Jl(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var r=t[a];Dt=r,Tm(r,e)}qm(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:qr(8,t,t.return),Jl(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,Jl(t));break;default:Jl(t)}e=e.sibling}}function Tm(e,t){for(;Dt!==null;){var a=Dt;switch(a.tag){case 0:case 11:case 15:qr(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var r=a.memoizedState.cachePool.pool;r!=null&&r.refCount++}break;case 24:js(a.memoizedState.cache)}if(r=a.child,r!==null)r.return=a,Dt=r;else e:for(a=e;Dt!==null;){r=Dt;var c=r.sibling,u=r.return;if(bm(r),r===a){Dt=null;break e}if(c!==null){c.return=u,Dt=c;break e}Dt=u}}}var qp={getCacheForType:function(e){var t=Ot(pt),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a},cacheSignal:function(){return Ot(pt).controller.signal}},Dp=typeof WeakMap=="function"?WeakMap:Map,Xe=0,et=null,Ae=null,ke=0,Ke=0,ta=null,Dr=!1,Zn=!1,ac=!1,ar=0,ot=0,Tr=0,pn=0,rc=0,aa=0,Kn=0,Ls=null,Kt=null,nc=!1,Fl=0,Am=0,$l=1/0,Wl=null,Ar=null,St=0,Or=null,Jn=null,rr=0,sc=0,lc=null,Om=null,Bs=0,ic=null;function ra(){return(Xe&2)!==0&&ke!==0?ke&-ke:D.T!==null?fc():il()}function km(){if(aa===0)if((ke&536870912)===0||Me){var e=dr;dr<<=1,(dr&3932160)===0&&(dr=262144),aa=e}else aa=536870912;return e=It.current,e!==null&&(e.flags|=32),aa}function Jt(e,t,a){(e===et&&(Ke===2||Ke===9)||e.cancelPendingCommit!==null)&&(Fn(e,0),kr(e,ke,aa,!1)),Gt(e,a),((Xe&2)===0||e!==et)&&(e===et&&((Xe&2)===0&&(pn|=a),ot===4&&kr(e,ke,aa,!1)),Oa(e))}function zm(e,t,a){if((Xe&6)!==0)throw Error(o(327));var r=!a&&(t&127)===0&&(t&e.expiredLanes)===0||xa(e,t),c=r?Op(e,t):cc(e,t,!0),u=r;do{if(c===0){Zn&&!r&&kr(e,t,0,!1);break}else{if(a=e.current.alternate,u&&!Tp(a)){c=cc(e,t,!1),u=!1;continue}if(c===2){if(u=t,e.errorRecoveryDisabledLanes&u)var f=0;else f=e.pendingLanes&-536870913,f=f!==0?f:f&536870912?536870912:0;if(f!==0){t=f;e:{var _=e;c=Ls;var j=_.current.memoizedState.isDehydrated;if(j&&(Fn(_,f).flags|=256),f=cc(_,f,!1),f!==2){if(ac&&!j){_.errorRecoveryDisabledLanes|=u,pn|=u,c=4;break e}u=Kt,Kt=c,u!==null&&(Kt===null?Kt=u:Kt.push.apply(Kt,u))}c=f}if(u=!1,c!==2)continue}}if(c===1){Fn(e,0),kr(e,t,0,!0);break}e:{switch(r=e,u=c,u){case 0:case 1:throw Error(o(345));case 4:if((t&4194048)!==t)break;case 6:kr(r,t,aa,!Dr);break e;case 2:Kt=null;break;case 3:case 5:break;default:throw Error(o(329))}if((t&62914560)===t&&(c=Fl+300-bt(),10<c)){if(kr(r,t,aa,!Dr),ia(r,0,!0)!==0)break e;rr=t,r.timeoutHandle=mf(Mm.bind(null,r,a,Kt,Wl,nc,t,aa,pn,Kn,Dr,u,"Throttled",-0,0),c);break e}Mm(r,a,Kt,Wl,nc,t,aa,pn,Kn,Dr,u,null,-0,0)}}break}while(!0);Oa(e)}function Mm(e,t,a,r,c,u,f,_,j,A,H,Y,O,z){if(e.timeoutHandle=-1,Y=t.subtreeFlags,Y&8192||(Y&16785408)===16785408){Y={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:oe},Cm(t,u,Y);var se=(u&62914560)===u?Fl-bt():(u&4194048)===u?Am-bt():0;if(se=hg(Y,se),se!==null){rr=u,e.cancelPendingCommit=se(Qm.bind(null,e,t,u,a,r,c,f,_,j,H,Y,null,O,z)),kr(e,u,f,!A);return}}Qm(e,t,u,a,r,c,f,_,j)}function Tp(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var r=0;r<a.length;r++){var c=a[r],u=c.getSnapshot;c=c.value;try{if(!Wt(u(),c))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function kr(e,t,a,r){t&=~rc,t&=~pn,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var c=t;0<c;){var u=31-Tt(c),f=1<<u;r[u]=-1,c&=~f}a!==0&&Nn(e,a,t)}function Pl(){return(Xe&6)===0?(Ys(0),!1):!0}function oc(){if(Ae!==null){if(Ke===0)var e=Ae.return;else e=Ae,Za=sn=null,xo(e),Ln=null,Ss=0,e=Ae;for(;e!==null;)mm(e.alternate,e),e=e.return;Ae=null}}function Fn(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,$p(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),rr=0,oc(),et=e,Ae=a=Xa(e.current,null),ke=t,Ke=0,ta=null,Dr=!1,Zn=xa(e,t),ac=!1,Kn=aa=rc=pn=Tr=ot=0,Kt=Ls=null,nc=!1,(t&8)!==0&&(t|=t&32);var r=e.entangledLanes;if(r!==0)for(e=e.entanglements,r&=t;0<r;){var c=31-Tt(r),u=1<<c;t|=e[c],r&=~u}return ar=t,vl(),a}function Rm(e,t){xe=null,D.H=As,t===Hn||t===Cl?(t=Pu(),Ke=3):t===mo?(t=Pu(),Ke=4):Ke=t===Bo?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,ta=t,Ae===null&&(ot=1,Yl(e,ca(t,e.current)))}function Um(){var e=It.current;return e===null?!0:(ke&4194048)===ke?fa===null:(ke&62914560)===ke||(ke&536870912)!==0?e===fa:!1}function Hm(){var e=D.H;return D.H=As,e===null?As:e}function Lm(){var e=D.A;return D.A=qp,e}function Il(){ot=4,Dr||(ke&4194048)!==ke&&It.current!==null||(Zn=!0),(Tr&134217727)===0&&(pn&134217727)===0||et===null||kr(et,ke,aa,!1)}function cc(e,t,a){var r=Xe;Xe|=2;var c=Hm(),u=Lm();(et!==e||ke!==t)&&(Wl=null,Fn(e,t)),t=!1;var f=ot;e:do try{if(Ke!==0&&Ae!==null){var _=Ae,j=ta;switch(Ke){case 8:oc(),f=6;break e;case 3:case 2:case 9:case 6:It.current===null&&(t=!0);var A=Ke;if(Ke=0,ta=null,$n(e,_,j,A),a&&Zn){f=0;break e}break;default:A=Ke,Ke=0,ta=null,$n(e,_,j,A)}}Ap(),f=ot;break}catch(H){Rm(e,H)}while(!0);return t&&e.shellSuspendCounter++,Za=sn=null,Xe=r,D.H=c,D.A=u,Ae===null&&(et=null,ke=0,vl()),f}function Ap(){for(;Ae!==null;)Bm(Ae)}function Op(e,t){var a=Xe;Xe|=2;var r=Hm(),c=Lm();et!==e||ke!==t?(Wl=null,$l=bt()+500,Fn(e,t)):Zn=xa(e,t);e:do try{if(Ke!==0&&Ae!==null){t=Ae;var u=ta;t:switch(Ke){case 1:Ke=0,ta=null,$n(e,t,u,1);break;case 2:case 9:if($u(u)){Ke=0,ta=null,Ym(t);break}t=function(){Ke!==2&&Ke!==9||et!==e||(Ke=7),Oa(e)},u.then(t,t);break e;case 3:Ke=7;break e;case 4:Ke=5;break e;case 7:$u(u)?(Ke=0,ta=null,Ym(t)):(Ke=0,ta=null,$n(e,t,u,7));break;case 5:var f=null;switch(Ae.tag){case 26:f=Ae.memoizedState;case 5:case 27:var _=Ae;if(f?Cf(f):_.stateNode.complete){Ke=0,ta=null;var j=_.sibling;if(j!==null)Ae=j;else{var A=_.return;A!==null?(Ae=A,ei(A)):Ae=null}break t}}Ke=0,ta=null,$n(e,t,u,5);break;case 6:Ke=0,ta=null,$n(e,t,u,6);break;case 8:oc(),ot=6;break e;default:throw Error(o(462))}}kp();break}catch(H){Rm(e,H)}while(!0);return Za=sn=null,D.H=r,D.A=c,Xe=a,Ae!==null?0:(et=null,ke=0,vl(),ot)}function kp(){for(;Ae!==null&&!cr();)Bm(Ae)}function Bm(e){var t=um(e.alternate,e,ar);e.memoizedProps=e.pendingProps,t===null?ei(e):Ae=t}function Ym(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=nm(a,t,t.pendingProps,t.type,void 0,ke);break;case 11:t=nm(a,t,t.pendingProps,t.type.render,t.ref,ke);break;case 5:xo(t);default:mm(a,t),t=Ae=Lu(t,ar),t=um(a,t,ar)}e.memoizedProps=e.pendingProps,t===null?ei(e):Ae=t}function $n(e,t,a,r){Za=sn=null,xo(t),Ln=null,Ss=0;var c=t.return;try{if(jp(e,c,t,a,ke)){ot=1,Yl(e,ca(a,e.current)),Ae=null;return}}catch(u){if(c!==null)throw Ae=c,u;ot=1,Yl(e,ca(a,e.current)),Ae=null;return}t.flags&32768?(Me||r===1?e=!0:Zn||(ke&536870912)!==0?e=!1:(Dr=e=!0,(r===2||r===9||r===3||r===6)&&(r=It.current,r!==null&&r.tag===13&&(r.flags|=16384))),Gm(t,e)):ei(t)}function ei(e){var t=e;do{if((t.flags&32768)!==0){Gm(t,Dr);return}e=t.return;var a=xp(t.alternate,t,ar);if(a!==null){Ae=a;return}if(t=t.sibling,t!==null){Ae=t;return}Ae=t=e}while(t!==null);ot===0&&(ot=5)}function Gm(e,t){do{var a=Np(e.alternate,e);if(a!==null){a.flags&=32767,Ae=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){Ae=e;return}Ae=e=a}while(e!==null);ot=6,Ae=null}function Qm(e,t,a,r,c,u,f,_,j){e.cancelPendingCommit=null;do ti();while(St!==0);if((Xe&6)!==0)throw Error(o(327));if(t!==null){if(t===e.current)throw Error(o(177));if(u=t.lanes|t.childLanes,u|=$i,Vr(e,a,u,f,_,j),e===et&&(Ae=et=null,ke=0),Jn=t,Or=e,rr=a,sc=u,lc=c,Om=r,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Up(la,function(){return Jm(),null})):(e.callbackNode=null,e.callbackPriority=0),r=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||r){r=D.T,D.T=null,c=Q.p,Q.p=2,f=Xe,Xe|=4;try{Ep(e,t,a)}finally{Xe=f,Q.p=c,D.T=r}}St=1,Xm(),Vm(),Zm()}}function Xm(){if(St===1){St=0;var e=Or,t=Jn,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=D.T,D.T=null;var r=Q.p;Q.p=2;var c=Xe;Xe|=4;try{xm(t,e);var u=jc,f=Tu(e.containerInfo),_=u.focusedElem,j=u.selectionRange;if(f!==_&&_&&_.ownerDocument&&Du(_.ownerDocument.documentElement,_)){if(j!==null&&Vi(_)){var A=j.start,H=j.end;if(H===void 0&&(H=A),"selectionStart"in _)_.selectionStart=A,_.selectionEnd=Math.min(H,_.value.length);else{var Y=_.ownerDocument||document,O=Y&&Y.defaultView||window;if(O.getSelection){var z=O.getSelection(),se=_.textContent.length,ye=Math.min(j.start,se),Pe=j.end===void 0?ye:Math.min(j.end,se);!z.extend&&ye>Pe&&(f=Pe,Pe=ye,ye=f);var E=qu(_,ye),x=qu(_,Pe);if(E&&x&&(z.rangeCount!==1||z.anchorNode!==E.node||z.anchorOffset!==E.offset||z.focusNode!==x.node||z.focusOffset!==x.offset)){var T=Y.createRange();T.setStart(E.node,E.offset),z.removeAllRanges(),ye>Pe?(z.addRange(T),z.extend(x.node,x.offset)):(T.setEnd(x.node,x.offset),z.addRange(T))}}}}for(Y=[],z=_;z=z.parentNode;)z.nodeType===1&&Y.push({element:z,left:z.scrollLeft,top:z.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<Y.length;_++){var L=Y[_];L.element.scrollLeft=L.left,L.element.scrollTop=L.top}}fi=!!bc,jc=bc=null}finally{Xe=c,Q.p=r,D.T=a}}e.current=t,St=2}}function Vm(){if(St===2){St=0;var e=Or,t=Jn,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=D.T,D.T=null;var r=Q.p;Q.p=2;var c=Xe;Xe|=4;try{vm(e,t.alternate,t)}finally{Xe=c,Q.p=r,D.T=a}}St=3}}function Zm(){if(St===4||St===3){St=0,ur();var e=Or,t=Jn,a=rr,r=Om;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?St=5:(St=0,Jn=Or=null,Km(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(Ar=null),ls(a),t=t.stateNode,Et&&typeof Et.onCommitFiberRoot=="function")try{Et.onCommitFiberRoot(ya,t,void 0,(t.current.flags&128)===128)}catch{}if(r!==null){t=D.T,c=Q.p,Q.p=2,D.T=null;try{for(var u=e.onRecoverableError,f=0;f<r.length;f++){var _=r[f];u(_.value,{componentStack:_.stack})}}finally{D.T=t,Q.p=c}}(rr&3)!==0&&ti(),Oa(e),c=e.pendingLanes,(a&261930)!==0&&(c&42)!==0?e===ic?Bs++:(Bs=0,ic=e):Bs=0,Ys(0)}}function Km(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,js(t)))}function ti(){return Xm(),Vm(),Zm(),Jm()}function Jm(){if(St!==5)return!1;var e=Or,t=sc;sc=0;var a=ls(rr),r=D.T,c=Q.p;try{Q.p=32>a?32:a,D.T=null,a=lc,lc=null;var u=Or,f=rr;if(St=0,Jn=Or=null,rr=0,(Xe&6)!==0)throw Error(o(331));var _=Xe;if(Xe|=4,Dm(u.current),Em(u,u.current,f,a),Xe=_,Ys(0,!1),Et&&typeof Et.onPostCommitFiberRoot=="function")try{Et.onPostCommitFiberRoot(ya,u)}catch{}return!0}finally{Q.p=c,D.T=r,Km(e,t)}}function Fm(e,t,a){t=ca(a,t),t=Lo(e.stateNode,t,2),e=Nr(e,t,2),e!==null&&(Gt(e,2),Oa(e))}function Je(e,t,a){if(e.tag===3)Fm(e,e,a);else for(;t!==null;){if(t.tag===3){Fm(t,e,a);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ar===null||!Ar.has(r))){e=ca(a,e),a=$d(2),r=Nr(t,a,2),r!==null&&(Wd(a,r,t,e),Gt(r,2),Oa(r));break}}t=t.return}}function uc(e,t,a){var r=e.pingCache;if(r===null){r=e.pingCache=new Dp;var c=new Set;r.set(t,c)}else c=r.get(t),c===void 0&&(c=new Set,r.set(t,c));c.has(a)||(ac=!0,c.add(a),e=zp.bind(null,e,t,a),t.then(e,e))}function zp(e,t,a){var r=e.pingCache;r!==null&&r.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,et===e&&(ke&a)===a&&(ot===4||ot===3&&(ke&62914560)===ke&&300>bt()-Fl?(Xe&2)===0&&Fn(e,0):rc|=a,Kn===ke&&(Kn=0)),Oa(e)}function $m(e,t){t===0&&(t=V()),e=an(e,t),e!==null&&(Gt(e,t),Oa(e))}function Mp(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),$m(e,a)}function Rp(e,t){var a=0;switch(e.tag){case 31:case 13:var r=e.stateNode,c=e.memoizedState;c!==null&&(a=c.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(o(314))}r!==null&&r.delete(t),$m(e,a)}function Up(e,t){return Yr(e,t)}var ai=null,Wn=null,dc=!1,ri=!1,mc=!1,zr=0;function Oa(e){e!==Wn&&e.next===null&&(Wn===null?ai=Wn=e:Wn=Wn.next=e),ri=!0,dc||(dc=!0,Lp())}function Ys(e,t){if(!mc&&ri){mc=!0;do for(var a=!1,r=ai;r!==null;){if(e!==0){var c=r.pendingLanes;if(c===0)var u=0;else{var f=r.suspendedLanes,_=r.pingedLanes;u=(1<<31-Tt(42|e)+1)-1,u&=c&~(f&~_),u=u&201326741?u&201326741|1:u?u|2:0}u!==0&&(a=!0,ef(r,u))}else u=ke,u=ia(r,r===et?u:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),(u&3)===0||xa(r,u)||(a=!0,ef(r,u));r=r.next}while(a);mc=!1}}function Hp(){Wm()}function Wm(){ri=dc=!1;var e=0;zr!==0&&Fp()&&(e=zr);for(var t=bt(),a=null,r=ai;r!==null;){var c=r.next,u=Pm(r,t);u===0?(r.next=null,a===null?ai=c:a.next=c,c===null&&(Wn=a)):(a=r,(e!==0||(u&3)!==0)&&(ri=!0)),r=c}St!==0&&St!==5||Ys(e),zr!==0&&(zr=0)}function Pm(e,t){for(var a=e.suspendedLanes,r=e.pingedLanes,c=e.expirationTimes,u=e.pendingLanes&-62914561;0<u;){var f=31-Tt(u),_=1<<f,j=c[f];j===-1?((_&a)===0||(_&r)!==0)&&(c[f]=Ua(_,t)):j<=t&&(e.expiredLanes|=_),u&=~_}if(t=et,a=ke,a=ia(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),r=e.callbackNode,a===0||e===t&&(Ke===2||Ke===9)||e.cancelPendingCommit!==null)return r!==null&&r!==null&&ka(r),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||xa(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(r!==null&&ka(r),ls(a)){case 2:case 8:a=Qr;break;case 32:a=la;break;case 268435456:a=jt;break;default:a=la}return r=Im.bind(null,e),a=Yr(a,r),e.callbackPriority=t,e.callbackNode=a,t}return r!==null&&r!==null&&ka(r),e.callbackPriority=2,e.callbackNode=null,2}function Im(e,t){if(St!==0&&St!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(ti()&&e.callbackNode!==a)return null;var r=ke;return r=ia(e,e===et?r:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),r===0?null:(zm(e,r,t),Pm(e,bt()),e.callbackNode!=null&&e.callbackNode===a?Im.bind(null,e):null)}function ef(e,t){if(ti())return null;zm(e,t,!0)}function Lp(){Wp(function(){(Xe&6)!==0?Yr(Gr,Hp):Wm()})}function fc(){if(zr===0){var e=Rn;e===0&&(e=Mt,Mt<<=1,(Mt&261888)===0&&(Mt=256)),zr=e}return zr}function tf(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:$(""+e)}function af(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function Bp(e,t,a,r,c){if(t==="submit"&&a&&a.stateNode===c){var u=tf((c[Rt]||null).action),f=r.submitter;f&&(t=(t=f[Rt]||null)?tf(t.formAction):f.getAttribute("formAction"),t!==null&&(u=t,f=null));var _=new pl("action","action",null,r,c);e.push({event:_,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(zr!==0){var j=f?af(c,f):new FormData(c);ko(a,{pending:!0,data:j,method:c.method,action:u},null,j)}}else typeof u=="function"&&(_.preventDefault(),j=f?af(c,f):new FormData(c),ko(a,{pending:!0,data:j,method:c.method,action:u},u,j))},currentTarget:c}]})}}for(var hc=0;hc<Fi.length;hc++){var pc=Fi[hc],Yp=pc.toLowerCase(),Gp=pc[0].toUpperCase()+pc.slice(1);ja(Yp,"on"+Gp)}ja(ku,"onAnimationEnd"),ja(zu,"onAnimationIteration"),ja(Mu,"onAnimationStart"),ja("dblclick","onDoubleClick"),ja("focusin","onFocus"),ja("focusout","onBlur"),ja(np,"onTransitionRun"),ja(sp,"onTransitionStart"),ja(lp,"onTransitionCancel"),ja(Ru,"onTransitionEnd"),hr("onMouseEnter",["mouseout","mouseover"]),hr("onMouseLeave",["mouseout","mouseover"]),hr("onPointerEnter",["pointerout","pointerover"]),hr("onPointerLeave",["pointerout","pointerover"]),va("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),va("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),va("onBeforeInput",["compositionend","keypress","textInput","paste"]),va("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),va("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),va("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qp=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Gs));function rf(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var r=e[a],c=r.event;r=r.listeners;e:{var u=void 0;if(t)for(var f=r.length-1;0<=f;f--){var _=r[f],j=_.instance,A=_.currentTarget;if(_=_.listener,j!==u&&c.isPropagationStopped())break e;u=_,c.currentTarget=A;try{u(c)}catch(H){yl(H)}c.currentTarget=null,u=j}else for(f=0;f<r.length;f++){if(_=r[f],j=_.instance,A=_.currentTarget,_=_.listener,j!==u&&c.isPropagationStopped())break e;u=_,c.currentTarget=A;try{u(c)}catch(H){yl(H)}c.currentTarget=null,u=j}}}}function Oe(e,t){var a=t[is];a===void 0&&(a=t[is]=new Set);var r=e+"__bubble";a.has(r)||(nf(t,e,2,!1),a.add(r))}function gc(e,t,a){var r=0;t&&(r|=4),nf(a,e,r,t)}var ni="_reactListening"+Math.random().toString(36).slice(2);function _c(e){if(!e[ni]){e[ni]=!0,os.forEach(function(a){a!=="selectionchange"&&(Qp.has(a)||gc(a,!1,e),gc(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ni]||(t[ni]=!0,gc("selectionchange",!1,t))}}function nf(e,t,a,r){switch(zf(t)){case 2:var c=_g;break;case 8:c=yg;break;default:c=Oc}a=c.bind(null,t,a,e),c=void 0,!Ri||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),r?c!==void 0?e.addEventListener(t,a,{capture:!0,passive:c}):e.addEventListener(t,a,!0):c!==void 0?e.addEventListener(t,a,{passive:c}):e.addEventListener(t,a,!1)}function yc(e,t,a,r,c){var u=r;if((t&1)===0&&(t&2)===0&&r!==null)e:for(;;){if(r===null)return;var f=r.tag;if(f===3||f===4){var _=r.stateNode.containerInfo;if(_===c)break;if(f===4)for(f=r.return;f!==null;){var j=f.tag;if((j===3||j===4)&&f.stateNode.containerInfo===c)return;f=f.return}for(;_!==null;){if(f=fr(_),f===null)return;if(j=f.tag,j===5||j===6||j===26||j===27){r=u=f;continue e}_=_.parentNode}}r=r.return}cu(function(){var A=u,H=pe(a),Y=[];e:{var O=Uu.get(e);if(O!==void 0){var z=pl,se=e;switch(e){case"keypress":if(fl(a)===0)break e;case"keydown":case"keyup":z=Rh;break;case"focusin":se="focus",z=Bi;break;case"focusout":se="blur",z=Bi;break;case"beforeblur":case"afterblur":z=Bi;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":z=mu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":z=xh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":z=Lh;break;case ku:case zu:case Mu:z=Ch;break;case Ru:z=Yh;break;case"scroll":case"scrollend":z=wh;break;case"wheel":z=Qh;break;case"copy":case"cut":case"paste":z=Dh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":z=hu;break;case"toggle":case"beforetoggle":z=Vh}var ye=(t&4)!==0,Pe=!ye&&(e==="scroll"||e==="scrollend"),E=ye?O!==null?O+"Capture":null:O;ye=[];for(var x=A,T;x!==null;){var L=x;if(T=L.stateNode,L=L.tag,L!==5&&L!==26&&L!==27||T===null||E===null||(L=us(x,E),L!=null&&ye.push(Qs(x,L,T))),Pe)break;x=x.return}0<ye.length&&(O=new z(O,se,null,a,H),Y.push({event:O,listeners:ye}))}}if((t&7)===0){e:{if(O=e==="mouseover"||e==="pointerover",z=e==="mouseout"||e==="pointerout",O&&a!==he&&(se=a.relatedTarget||a.fromElement)&&(fr(se)||se[Ht]))break e;if((z||O)&&(O=H.window===H?H:(O=H.ownerDocument)?O.defaultView||O.parentWindow:window,z?(se=a.relatedTarget||a.toElement,z=A,se=se?fr(se):null,se!==null&&(Pe=m(se),ye=se.tag,se!==Pe||ye!==5&&ye!==27&&ye!==6)&&(se=null)):(z=null,se=A),z!==se)){if(ye=mu,L="onMouseLeave",E="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(ye=hu,L="onPointerLeave",E="onPointerEnter",x="pointer"),Pe=z==null?O:Ut(z),T=se==null?O:Ut(se),O=new ye(L,x+"leave",z,a,H),O.target=Pe,O.relatedTarget=T,L=null,fr(H)===A&&(ye=new ye(E,x+"enter",se,a,H),ye.target=T,ye.relatedTarget=Pe,L=ye),Pe=L,z&&se)t:{for(ye=Xp,E=z,x=se,T=0,L=E;L;L=ye(L))T++;L=0;for(var ge=x;ge;ge=ye(ge))L++;for(;0<T-L;)E=ye(E),T--;for(;0<L-T;)x=ye(x),L--;for(;T--;){if(E===x||x!==null&&E===x.alternate){ye=E;break t}E=ye(E),x=ye(x)}ye=null}else ye=null;z!==null&&sf(Y,O,z,ye,!1),se!==null&&Pe!==null&&sf(Y,Pe,se,ye,!0)}}e:{if(O=A?Ut(A):window,z=O.nodeName&&O.nodeName.toLowerCase(),z==="select"||z==="input"&&O.type==="file")var Le=wu;else if(bu(O))if(Su)Le=tp;else{Le=Ih;var ue=Ph}else z=O.nodeName,!z||z.toLowerCase()!=="input"||O.type!=="checkbox"&&O.type!=="radio"?A&&C(A.elementType)&&(Le=wu):Le=ep;if(Le&&(Le=Le(e,A))){ju(Y,Le,a,H);break e}ue&&ue(e,O,A),e==="focusout"&&A&&O.type==="number"&&A.memoizedProps.value!=null&&Ya(O,"number",O.value)}switch(ue=A?Ut(A):window,e){case"focusin":(bu(ue)||ue.contentEditable==="true")&&(qn=ue,Zi=A,ys=null);break;case"focusout":ys=Zi=qn=null;break;case"mousedown":Ki=!0;break;case"contextmenu":case"mouseup":case"dragend":Ki=!1,Au(Y,a,H);break;case"selectionchange":if(rp)break;case"keydown":case"keyup":Au(Y,a,H)}var Ee;if(Gi)e:{switch(e){case"compositionstart":var ze="onCompositionStart";break e;case"compositionend":ze="onCompositionEnd";break e;case"compositionupdate":ze="onCompositionUpdate";break e}ze=void 0}else Cn?yu(e,a)&&(ze="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(ze="onCompositionStart");ze&&(pu&&a.locale!=="ko"&&(Cn||ze!=="onCompositionStart"?ze==="onCompositionEnd"&&Cn&&(Ee=uu()):(yr=H,Ui="value"in yr?yr.value:yr.textContent,Cn=!0)),ue=si(A,ze),0<ue.length&&(ze=new fu(ze,e,null,a,H),Y.push({event:ze,listeners:ue}),Ee?ze.data=Ee:(Ee=vu(a),Ee!==null&&(ze.data=Ee)))),(Ee=Kh?Jh(e,a):Fh(e,a))&&(ze=si(A,"onBeforeInput"),0<ze.length&&(ue=new fu("onBeforeInput","beforeinput",null,a,H),Y.push({event:ue,listeners:ze}),ue.data=Ee)),Bp(Y,e,A,a,H)}rf(Y,t)})}function Qs(e,t,a){return{instance:e,listener:t,currentTarget:a}}function si(e,t){for(var a=t+"Capture",r=[];e!==null;){var c=e,u=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||u===null||(c=us(e,a),c!=null&&r.unshift(Qs(e,c,u)),c=us(e,t),c!=null&&r.push(Qs(e,c,u))),e.tag===3)return r;e=e.return}return[]}function Xp(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function sf(e,t,a,r,c){for(var u=t._reactName,f=[];a!==null&&a!==r;){var _=a,j=_.alternate,A=_.stateNode;if(_=_.tag,j!==null&&j===r)break;_!==5&&_!==26&&_!==27||A===null||(j=A,c?(A=us(a,u),A!=null&&f.unshift(Qs(a,A,j))):c||(A=us(a,u),A!=null&&f.push(Qs(a,A,j)))),a=a.return}f.length!==0&&e.push({event:t,listeners:f})}var Vp=/\r\n?/g,Zp=/\u0000|\uFFFD/g;function lf(e){return(typeof e=="string"?e:""+e).replace(Vp,`
`).replace(Zp,"")}function of(e,t){return t=lf(t),lf(e)===t}function We(e,t,a,r,c,u){switch(a){case"children":typeof r=="string"?t==="body"||t==="textarea"&&r===""||Ga(e,r):(typeof r=="number"||typeof r=="bigint")&&t!=="body"&&Ga(e,""+r);break;case"className":Fr(e,"class",r);break;case"tabIndex":Fr(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":Fr(e,a,r);break;case"style":w(e,r,u);break;case"data":if(t!=="object"){Fr(e,"data",r);break}case"src":case"href":if(r===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(r==null||typeof r=="function"||typeof r=="symbol"||typeof r=="boolean"){e.removeAttribute(a);break}r=$(""+r),e.setAttribute(a,r);break;case"action":case"formAction":if(typeof r=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof u=="function"&&(a==="formAction"?(t!=="input"&&We(e,t,"name",c.name,c,null),We(e,t,"formEncType",c.formEncType,c,null),We(e,t,"formMethod",c.formMethod,c,null),We(e,t,"formTarget",c.formTarget,c,null)):(We(e,t,"encType",c.encType,c,null),We(e,t,"method",c.method,c,null),We(e,t,"target",c.target,c,null)));if(r==null||typeof r=="symbol"||typeof r=="boolean"){e.removeAttribute(a);break}r=$(""+r),e.setAttribute(a,r);break;case"onClick":r!=null&&(e.onclick=oe);break;case"onScroll":r!=null&&Oe("scroll",e);break;case"onScrollEnd":r!=null&&Oe("scrollend",e);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(o(61));if(a=r.__html,a!=null){if(c.children!=null)throw Error(o(60));e.innerHTML=a}}break;case"multiple":e.multiple=r&&typeof r!="function"&&typeof r!="symbol";break;case"muted":e.muted=r&&typeof r!="function"&&typeof r!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(r==null||typeof r=="function"||typeof r=="boolean"||typeof r=="symbol"){e.removeAttribute("xlink:href");break}a=$(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":r!=null&&typeof r!="function"&&typeof r!="symbol"?e.setAttribute(a,""+r):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&typeof r!="function"&&typeof r!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":r===!0?e.setAttribute(a,""):r!==!1&&r!=null&&typeof r!="function"&&typeof r!="symbol"?e.setAttribute(a,r):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":r!=null&&typeof r!="function"&&typeof r!="symbol"&&!isNaN(r)&&1<=r?e.setAttribute(a,r):e.removeAttribute(a);break;case"rowSpan":case"start":r==null||typeof r=="function"||typeof r=="symbol"||isNaN(r)?e.removeAttribute(a):e.setAttribute(a,r);break;case"popover":Oe("beforetoggle",e),Oe("toggle",e),$t(e,"popover",r);break;case"xlinkActuate":ba(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":ba(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":ba(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":ba(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":ba(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":ba(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":ba(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":ba(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":ba(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":$t(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=q.get(a)||a,$t(e,a,r))}}function vc(e,t,a,r,c,u){switch(a){case"style":w(e,r,u);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(o(61));if(a=r.__html,a!=null){if(c.children!=null)throw Error(o(60));e.innerHTML=a}}break;case"children":typeof r=="string"?Ga(e,r):(typeof r=="number"||typeof r=="bigint")&&Ga(e,""+r);break;case"onScroll":r!=null&&Oe("scroll",e);break;case"onScrollEnd":r!=null&&Oe("scrollend",e);break;case"onClick":r!=null&&(e.onclick=oe);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Jr.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(c=a.endsWith("Capture"),t=a.slice(2,c?a.length-7:void 0),u=e[Rt]||null,u=u!=null?u[a]:null,typeof u=="function"&&e.removeEventListener(t,u,c),typeof r=="function")){typeof u!="function"&&u!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,r,c);break e}a in e?e[a]=r:r===!0?e.setAttribute(a,""):$t(e,a,r)}}}function zt(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Oe("error",e),Oe("load",e);var r=!1,c=!1,u;for(u in a)if(a.hasOwnProperty(u)){var f=a[u];if(f!=null)switch(u){case"src":r=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:We(e,t,u,f,a,null)}}c&&We(e,t,"srcSet",a.srcSet,a,null),r&&We(e,t,"src",a.src,a,null);return;case"input":Oe("invalid",e);var _=u=f=c=null,j=null,A=null;for(r in a)if(a.hasOwnProperty(r)){var H=a[r];if(H!=null)switch(r){case"name":c=H;break;case"type":f=H;break;case"checked":j=H;break;case"defaultChecked":A=H;break;case"value":u=H;break;case"defaultValue":_=H;break;case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(o(137,t));break;default:We(e,t,r,H,a,null)}}dl(e,u,_,j,A,f,c,!1);return;case"select":Oe("invalid",e),r=f=u=null;for(c in a)if(a.hasOwnProperty(c)&&(_=a[c],_!=null))switch(c){case"value":u=_;break;case"defaultValue":f=_;break;case"multiple":r=_;default:We(e,t,c,_,a,null)}t=u,a=f,e.multiple=!!r,t!=null?Wr(e,!!r,t,!1):a!=null&&Wr(e,!!r,a,!0);return;case"textarea":Oe("invalid",e),u=c=r=null;for(f in a)if(a.hasOwnProperty(f)&&(_=a[f],_!=null))switch(f){case"value":r=_;break;case"defaultValue":c=_;break;case"children":u=_;break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(o(91));break;default:We(e,t,f,_,a,null)}Pr(e,r,c,u);return;case"option":for(j in a)if(a.hasOwnProperty(j)&&(r=a[j],r!=null))switch(j){case"selected":e.selected=r&&typeof r!="function"&&typeof r!="symbol";break;default:We(e,t,j,r,a,null)}return;case"dialog":Oe("beforetoggle",e),Oe("toggle",e),Oe("cancel",e),Oe("close",e);break;case"iframe":case"object":Oe("load",e);break;case"video":case"audio":for(r=0;r<Gs.length;r++)Oe(Gs[r],e);break;case"image":Oe("error",e),Oe("load",e);break;case"details":Oe("toggle",e);break;case"embed":case"source":case"link":Oe("error",e),Oe("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(A in a)if(a.hasOwnProperty(A)&&(r=a[A],r!=null))switch(A){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:We(e,t,A,r,a,null)}return;default:if(C(t)){for(H in a)a.hasOwnProperty(H)&&(r=a[H],r!==void 0&&vc(e,t,H,r,a,void 0));return}}for(_ in a)a.hasOwnProperty(_)&&(r=a[_],r!=null&&We(e,t,_,r,a,null))}function Kp(e,t,a,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,u=null,f=null,_=null,j=null,A=null,H=null;for(z in a){var Y=a[z];if(a.hasOwnProperty(z)&&Y!=null)switch(z){case"checked":break;case"value":break;case"defaultValue":j=Y;default:r.hasOwnProperty(z)||We(e,t,z,null,r,Y)}}for(var O in r){var z=r[O];if(Y=a[O],r.hasOwnProperty(O)&&(z!=null||Y!=null))switch(O){case"type":u=z;break;case"name":c=z;break;case"checked":A=z;break;case"defaultChecked":H=z;break;case"value":f=z;break;case"defaultValue":_=z;break;case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(o(137,t));break;default:z!==Y&&We(e,t,O,z,r,Y)}}_r(e,f,_,j,A,H,u,c);return;case"select":z=f=_=O=null;for(u in a)if(j=a[u],a.hasOwnProperty(u)&&j!=null)switch(u){case"value":break;case"multiple":z=j;default:r.hasOwnProperty(u)||We(e,t,u,null,r,j)}for(c in r)if(u=r[c],j=a[c],r.hasOwnProperty(c)&&(u!=null||j!=null))switch(c){case"value":O=u;break;case"defaultValue":_=u;break;case"multiple":f=u;default:u!==j&&We(e,t,c,u,r,j)}t=_,a=f,r=z,O!=null?Wr(e,!!a,O,!1):!!r!=!!a&&(t!=null?Wr(e,!!a,t,!0):Wr(e,!!a,a?[]:"",!1));return;case"textarea":z=O=null;for(_ in a)if(c=a[_],a.hasOwnProperty(_)&&c!=null&&!r.hasOwnProperty(_))switch(_){case"value":break;case"children":break;default:We(e,t,_,null,r,c)}for(f in r)if(c=r[f],u=a[f],r.hasOwnProperty(f)&&(c!=null||u!=null))switch(f){case"value":O=c;break;case"defaultValue":z=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(o(91));break;default:c!==u&&We(e,t,f,c,r,u)}cs(e,O,z);return;case"option":for(var se in a)if(O=a[se],a.hasOwnProperty(se)&&O!=null&&!r.hasOwnProperty(se))switch(se){case"selected":e.selected=!1;break;default:We(e,t,se,null,r,O)}for(j in r)if(O=r[j],z=a[j],r.hasOwnProperty(j)&&O!==z&&(O!=null||z!=null))switch(j){case"selected":e.selected=O&&typeof O!="function"&&typeof O!="symbol";break;default:We(e,t,j,O,r,z)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ye in a)O=a[ye],a.hasOwnProperty(ye)&&O!=null&&!r.hasOwnProperty(ye)&&We(e,t,ye,null,r,O);for(A in r)if(O=r[A],z=a[A],r.hasOwnProperty(A)&&O!==z&&(O!=null||z!=null))switch(A){case"children":case"dangerouslySetInnerHTML":if(O!=null)throw Error(o(137,t));break;default:We(e,t,A,O,r,z)}return;default:if(C(t)){for(var Pe in a)O=a[Pe],a.hasOwnProperty(Pe)&&O!==void 0&&!r.hasOwnProperty(Pe)&&vc(e,t,Pe,void 0,r,O);for(H in r)O=r[H],z=a[H],!r.hasOwnProperty(H)||O===z||O===void 0&&z===void 0||vc(e,t,H,O,r,z);return}}for(var E in a)O=a[E],a.hasOwnProperty(E)&&O!=null&&!r.hasOwnProperty(E)&&We(e,t,E,null,r,O);for(Y in r)O=r[Y],z=a[Y],!r.hasOwnProperty(Y)||O===z||O==null&&z==null||We(e,t,Y,O,r,z)}function cf(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Jp(){if(typeof performance.getEntriesByType=="function"){for(var e=0,t=0,a=performance.getEntriesByType("resource"),r=0;r<a.length;r++){var c=a[r],u=c.transferSize,f=c.initiatorType,_=c.duration;if(u&&_&&cf(f)){for(f=0,_=c.responseEnd,r+=1;r<a.length;r++){var j=a[r],A=j.startTime;if(A>_)break;var H=j.transferSize,Y=j.initiatorType;H&&cf(Y)&&(j=j.responseEnd,f+=H*(j<_?1:(_-A)/(j-A)))}if(--r,t+=8*(u+f)/(c.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var bc=null,jc=null;function li(e){return e.nodeType===9?e:e.ownerDocument}function uf(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function df(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function wc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Sc=null;function Fp(){var e=window.event;return e&&e.type==="popstate"?e===Sc?!1:(Sc=e,!0):(Sc=null,!1)}var mf=typeof setTimeout=="function"?setTimeout:void 0,$p=typeof clearTimeout=="function"?clearTimeout:void 0,ff=typeof Promise=="function"?Promise:void 0,Wp=typeof queueMicrotask=="function"?queueMicrotask:typeof ff<"u"?function(e){return ff.resolve(null).then(e).catch(Pp)}:mf;function Pp(e){setTimeout(function(){throw e})}function Mr(e){return e==="head"}function hf(e,t){var a=t,r=0;do{var c=a.nextSibling;if(e.removeChild(a),c&&c.nodeType===8)if(a=c.data,a==="/$"||a==="/&"){if(r===0){e.removeChild(c),ts(t);return}r--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")r++;else if(a==="html")Xs(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,Xs(a);for(var u=a.firstChild;u;){var f=u.nextSibling,_=u.nodeName;u[Kr]||_==="SCRIPT"||_==="STYLE"||_==="LINK"&&u.rel.toLowerCase()==="stylesheet"||a.removeChild(u),u=f}}else a==="body"&&Xs(e.ownerDocument.body);a=c}while(a);ts(t)}function pf(e,t){var a=e;e=0;do{var r=a.nextSibling;if(a.nodeType===1?t?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(t?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),r&&r.nodeType===8)if(a=r.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=r}while(a)}function xc(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":xc(a),Ea(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Ip(e,t,a,r){for(;e.nodeType===1;){var c=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(r){if(!e[Kr])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(u=e.getAttribute("rel"),u==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(u!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(u=e.getAttribute("src"),(u!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&u&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var u=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===u)return e}else return e;if(e=ha(e.nextSibling),e===null)break}return null}function eg(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=ha(e.nextSibling),e===null))return null;return e}function gf(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!t||(e=ha(e.nextSibling),e===null))return null;return e}function Nc(e){return e.data==="$?"||e.data==="$~"}function Ec(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function tg(e,t){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=t;else if(e.data!=="$?"||a.readyState!=="loading")t();else{var r=function(){t(),a.removeEventListener("DOMContentLoaded",r)};a.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}function ha(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="$~"||t==="&"||t==="F!"||t==="F")break;if(t==="/$"||t==="/&")return null}}return e}var Cc=null;function _f(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(t===0)return ha(e.nextSibling);t--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||t++}e=e.nextSibling}return null}function yf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(t===0)return e;t--}else a!=="/$"&&a!=="/&"||t++}e=e.previousSibling}return null}function vf(e,t,a){switch(t=li(a),e){case"html":if(e=t.documentElement,!e)throw Error(o(452));return e;case"head":if(e=t.head,!e)throw Error(o(453));return e;case"body":if(e=t.body,!e)throw Error(o(454));return e;default:throw Error(o(451))}}function Xs(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ea(e)}var pa=new Map,bf=new Set;function ii(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var nr=Q.d;Q.d={f:ag,r:rg,D:ng,C:sg,L:lg,m:ig,X:cg,S:og,M:ug};function ag(){var e=nr.f(),t=Pl();return e||t}function rg(e){var t=Ha(e);t!==null&&t.tag===5&&t.type==="form"?Rd(t):nr.r(e)}var Pn=typeof document>"u"?null:document;function jf(e,t,a){var r=Pn;if(r&&typeof t=="string"&&t){var c=qt(t);c='link[rel="'+e+'"][href="'+c+'"]',typeof a=="string"&&(c+='[crossorigin="'+a+'"]'),bf.has(c)||(bf.add(c),e={rel:e,crossOrigin:a,href:t},r.querySelector(c)===null&&(t=r.createElement("link"),zt(t,"link",e),ht(t),r.head.appendChild(t)))}}function ng(e){nr.D(e),jf("dns-prefetch",e,null)}function sg(e,t){nr.C(e,t),jf("preconnect",e,t)}function lg(e,t,a){nr.L(e,t,a);var r=Pn;if(r&&e&&t){var c='link[rel="preload"][as="'+qt(t)+'"]';t==="image"&&a&&a.imageSrcSet?(c+='[imagesrcset="'+qt(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(c+='[imagesizes="'+qt(a.imageSizes)+'"]')):c+='[href="'+qt(e)+'"]';var u=c;switch(t){case"style":u=In(e);break;case"script":u=es(e)}pa.has(u)||(e=S({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),pa.set(u,e),r.querySelector(c)!==null||t==="style"&&r.querySelector(Vs(u))||t==="script"&&r.querySelector(Zs(u))||(t=r.createElement("link"),zt(t,"link",e),ht(t),r.head.appendChild(t)))}}function ig(e,t){nr.m(e,t);var a=Pn;if(a&&e){var r=t&&typeof t.as=="string"?t.as:"script",c='link[rel="modulepreload"][as="'+qt(r)+'"][href="'+qt(e)+'"]',u=c;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":u=es(e)}if(!pa.has(u)&&(e=S({rel:"modulepreload",href:e},t),pa.set(u,e),a.querySelector(c)===null)){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Zs(u)))return}r=a.createElement("link"),zt(r,"link",e),ht(r),a.head.appendChild(r)}}}function og(e,t,a){nr.S(e,t,a);var r=Pn;if(r&&e){var c=La(r).hoistableStyles,u=In(e);t=t||"default";var f=c.get(u);if(!f){var _={loading:0,preload:null};if(f=r.querySelector(Vs(u)))_.loading=5;else{e=S({rel:"stylesheet",href:e,"data-precedence":t},a),(a=pa.get(u))&&qc(e,a);var j=f=r.createElement("link");ht(j),zt(j,"link",e),j._p=new Promise(function(A,H){j.onload=A,j.onerror=H}),j.addEventListener("load",function(){_.loading|=1}),j.addEventListener("error",function(){_.loading|=2}),_.loading|=4,oi(f,t,r)}f={type:"stylesheet",instance:f,count:1,state:_},c.set(u,f)}}}function cg(e,t){nr.X(e,t);var a=Pn;if(a&&e){var r=La(a).hoistableScripts,c=es(e),u=r.get(c);u||(u=a.querySelector(Zs(c)),u||(e=S({src:e,async:!0},t),(t=pa.get(c))&&Dc(e,t),u=a.createElement("script"),ht(u),zt(u,"link",e),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},r.set(c,u))}}function ug(e,t){nr.M(e,t);var a=Pn;if(a&&e){var r=La(a).hoistableScripts,c=es(e),u=r.get(c);u||(u=a.querySelector(Zs(c)),u||(e=S({src:e,async:!0,type:"module"},t),(t=pa.get(c))&&Dc(e,t),u=a.createElement("script"),ht(u),zt(u,"link",e),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},r.set(c,u))}}function wf(e,t,a,r){var c=(c=qe.current)?ii(c):null;if(!c)throw Error(o(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=In(a.href),a=La(c).hoistableStyles,r=a.get(t),r||(r={type:"style",instance:null,count:0,state:null},a.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=In(a.href);var u=La(c).hoistableStyles,f=u.get(e);if(f||(c=c.ownerDocument||c,f={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,f),(u=c.querySelector(Vs(e)))&&!u._p&&(f.instance=u,f.state.loading=5),pa.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},pa.set(e,a),u||dg(c,e,a,f.state))),t&&r===null)throw Error(o(528,""));return f}if(t&&r!==null)throw Error(o(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=es(a),a=La(c).hoistableScripts,r=a.get(t),r||(r={type:"script",instance:null,count:0,state:null},a.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,e))}}function In(e){return'href="'+qt(e)+'"'}function Vs(e){return'link[rel="stylesheet"]['+e+"]"}function Sf(e){return S({},e,{"data-precedence":e.precedence,precedence:null})}function dg(e,t,a,r){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?r.loading=1:(t=e.createElement("link"),r.preload=t,t.addEventListener("load",function(){return r.loading|=1}),t.addEventListener("error",function(){return r.loading|=2}),zt(t,"link",a),ht(t),e.head.appendChild(t))}function es(e){return'[src="'+qt(e)+'"]'}function Zs(e){return"script[async]"+e}function xf(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+qt(a.href)+'"]');if(r)return t.instance=r,ht(r),r;var c=S({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return r=(e.ownerDocument||e).createElement("style"),ht(r),zt(r,"style",c),oi(r,a.precedence,e),t.instance=r;case"stylesheet":c=In(a.href);var u=e.querySelector(Vs(c));if(u)return t.state.loading|=4,t.instance=u,ht(u),u;r=Sf(a),(c=pa.get(c))&&qc(r,c),u=(e.ownerDocument||e).createElement("link"),ht(u);var f=u;return f._p=new Promise(function(_,j){f.onload=_,f.onerror=j}),zt(u,"link",r),t.state.loading|=4,oi(u,a.precedence,e),t.instance=u;case"script":return u=es(a.src),(c=e.querySelector(Zs(u)))?(t.instance=c,ht(c),c):(r=a,(c=pa.get(u))&&(r=S({},a),Dc(r,c)),e=e.ownerDocument||e,c=e.createElement("script"),ht(c),zt(c,"link",r),e.head.appendChild(c),t.instance=c);case"void":return null;default:throw Error(o(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(r=t.instance,t.state.loading|=4,oi(r,a.precedence,e));return t.instance}function oi(e,t,a){for(var r=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=r.length?r[r.length-1]:null,u=c,f=0;f<r.length;f++){var _=r[f];if(_.dataset.precedence===t)u=_;else if(u!==c)break}u?u.parentNode.insertBefore(e,u.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function qc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Dc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var ci=null;function Nf(e,t,a){if(ci===null){var r=new Map,c=ci=new Map;c.set(a,r)}else c=ci,r=c.get(a),r||(r=new Map,c.set(a,r));if(r.has(e))return r;for(r.set(e,null),a=a.getElementsByTagName(e),c=0;c<a.length;c++){var u=a[c];if(!(u[Kr]||u[wt]||e==="link"&&u.getAttribute("rel")==="stylesheet")&&u.namespaceURI!=="http://www.w3.org/2000/svg"){var f=u.getAttribute(t)||"";f=e+f;var _=r.get(f);_?_.push(u):r.set(f,[u])}}return r}function Ef(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function mg(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function Cf(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function fg(e,t,a,r){if(a.type==="stylesheet"&&(typeof r.media!="string"||matchMedia(r.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var c=In(r.href),u=t.querySelector(Vs(c));if(u){t=u._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(e.count++,e=ui.bind(e),t.then(e,e)),a.state.loading|=4,a.instance=u,ht(u);return}u=t.ownerDocument||t,r=Sf(r),(c=pa.get(c))&&qc(r,c),u=u.createElement("link"),ht(u);var f=u;f._p=new Promise(function(_,j){f.onload=_,f.onerror=j}),zt(u,"link",r),a.instance=u}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,t),(t=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=ui.bind(e),t.addEventListener("load",a),t.addEventListener("error",a))}}var Tc=0;function hg(e,t){return e.stylesheets&&e.count===0&&mi(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var r=setTimeout(function(){if(e.stylesheets&&mi(e,e.stylesheets),e.unsuspend){var u=e.unsuspend;e.unsuspend=null,u()}},6e4+t);0<e.imgBytes&&Tc===0&&(Tc=62500*Jp());var c=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&mi(e,e.stylesheets),e.unsuspend)){var u=e.unsuspend;e.unsuspend=null,u()}},(e.imgBytes>Tc?50:800)+t);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(r),clearTimeout(c)}}:null}function ui(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)mi(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var di=null;function mi(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,di=new Map,t.forEach(pg,e),di=null,ui.call(e))}function pg(e,t){if(!(t.state.loading&4)){var a=di.get(e);if(a)var r=a.get(null);else{a=new Map,di.set(e,a);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),u=0;u<c.length;u++){var f=c[u];(f.nodeName==="LINK"||f.getAttribute("media")!=="not all")&&(a.set(f.dataset.precedence,f),r=f)}r&&a.set(null,r)}c=t.instance,f=c.getAttribute("data-precedence"),u=a.get(f)||r,u===r&&a.set(null,c),a.set(f,c),this.count++,r=ui.bind(this),c.addEventListener("load",r),c.addEventListener("error",r),u?u.parentNode.insertBefore(c,u.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),t.state.loading|=4}}var Ks={$$typeof:ie,Provider:null,Consumer:null,_currentValue:I,_currentValue2:I,_threadCount:0};function gg(e,t,a,r,c,u,f,_,j){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ie(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ie(0),this.hiddenUpdates=Ie(null),this.identifierPrefix=r,this.onUncaughtError=c,this.onCaughtError=u,this.onRecoverableError=f,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function qf(e,t,a,r,c,u,f,_,j,A,H,Y){return e=new gg(e,t,a,f,j,A,H,Y,_),t=1,u===!0&&(t|=24),u=Pt(3,null,null,t),e.current=u,u.stateNode=e,t=oo(),t.refCount++,e.pooledCache=t,t.refCount++,u.memoizedState={element:r,isDehydrated:a,cache:t},fo(u),e}function Df(e){return e?(e=An,e):An}function Tf(e,t,a,r,c,u){c=Df(c),r.context===null?r.context=c:r.pendingContext=c,r=xr(t),r.payload={element:a},u=u===void 0?null:u,u!==null&&(r.callback=u),a=Nr(e,r,t),a!==null&&(Jt(a,e,t),Ns(a,e,t))}function Af(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function Ac(e,t){Af(e,t),(e=e.alternate)&&Af(e,t)}function Of(e){if(e.tag===13||e.tag===31){var t=an(e,67108864);t!==null&&Jt(t,e,67108864),Ac(e,67108864)}}function kf(e){if(e.tag===13||e.tag===31){var t=ra();t=Zr(t);var a=an(e,t);a!==null&&Jt(a,e,t),Ac(e,t)}}var fi=!0;function _g(e,t,a,r){var c=D.T;D.T=null;var u=Q.p;try{Q.p=2,Oc(e,t,a,r)}finally{Q.p=u,D.T=c}}function yg(e,t,a,r){var c=D.T;D.T=null;var u=Q.p;try{Q.p=8,Oc(e,t,a,r)}finally{Q.p=u,D.T=c}}function Oc(e,t,a,r){if(fi){var c=kc(r);if(c===null)yc(e,t,r,hi,a),Mf(e,r);else if(bg(c,e,t,a,r))r.stopPropagation();else if(Mf(e,r),t&4&&-1<vg.indexOf(e)){for(;c!==null;){var u=Ha(c);if(u!==null)switch(u.tag){case 3:if(u=u.stateNode,u.current.memoizedState.isDehydrated){var f=lt(u.pendingLanes);if(f!==0){var _=u;for(_.pendingLanes|=2,_.entangledLanes|=2;f;){var j=1<<31-Tt(f);_.entanglements[1]|=j,f&=~j}Oa(u),(Xe&6)===0&&($l=bt()+500,Ys(0))}}break;case 31:case 13:_=an(u,2),_!==null&&Jt(_,u,2),Pl(),Ac(u,2)}if(u=kc(r),u===null&&yc(e,t,r,hi,a),u===c)break;c=u}c!==null&&r.stopPropagation()}else yc(e,t,r,null,a)}}function kc(e){return e=pe(e),zc(e)}var hi=null;function zc(e){if(hi=null,e=fr(e),e!==null){var t=m(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=h(t),e!==null)return e;e=null}else if(a===31){if(e=g(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return hi=e,null}function zf(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(za()){case Gr:return 2;case Qr:return 8;case la:case Ma:return 32;case jt:return 268435456;default:return 32}default:return 32}}var Mc=!1,Rr=null,Ur=null,Hr=null,Js=new Map,Fs=new Map,Lr=[],vg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Mf(e,t){switch(e){case"focusin":case"focusout":Rr=null;break;case"dragenter":case"dragleave":Ur=null;break;case"mouseover":case"mouseout":Hr=null;break;case"pointerover":case"pointerout":Js.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fs.delete(t.pointerId)}}function $s(e,t,a,r,c,u){return e===null||e.nativeEvent!==u?(e={blockedOn:t,domEventName:a,eventSystemFlags:r,nativeEvent:u,targetContainers:[c]},t!==null&&(t=Ha(t),t!==null&&Of(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function bg(e,t,a,r,c){switch(t){case"focusin":return Rr=$s(Rr,e,t,a,r,c),!0;case"dragenter":return Ur=$s(Ur,e,t,a,r,c),!0;case"mouseover":return Hr=$s(Hr,e,t,a,r,c),!0;case"pointerover":var u=c.pointerId;return Js.set(u,$s(Js.get(u)||null,e,t,a,r,c)),!0;case"gotpointercapture":return u=c.pointerId,Fs.set(u,$s(Fs.get(u)||null,e,t,a,r,c)),!0}return!1}function Rf(e){var t=fr(e.target);if(t!==null){var a=m(t);if(a!==null){if(t=a.tag,t===13){if(t=h(a),t!==null){e.blockedOn=t,ol(e.priority,function(){kf(a)});return}}else if(t===31){if(t=g(a),t!==null){e.blockedOn=t,ol(e.priority,function(){kf(a)});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function pi(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=kc(e.nativeEvent);if(a===null){a=e.nativeEvent;var r=new a.constructor(a.type,a);he=r,a.target.dispatchEvent(r),he=null}else return t=Ha(a),t!==null&&Of(t),e.blockedOn=a,!1;t.shift()}return!0}function Uf(e,t,a){pi(e)&&a.delete(t)}function jg(){Mc=!1,Rr!==null&&pi(Rr)&&(Rr=null),Ur!==null&&pi(Ur)&&(Ur=null),Hr!==null&&pi(Hr)&&(Hr=null),Js.forEach(Uf),Fs.forEach(Uf)}function gi(e,t){e.blockedOn===t&&(e.blockedOn=null,Mc||(Mc=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,jg)))}var _i=null;function Hf(e){_i!==e&&(_i=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){_i===e&&(_i=null);for(var t=0;t<e.length;t+=3){var a=e[t],r=e[t+1],c=e[t+2];if(typeof r!="function"){if(zc(r||a)===null)continue;break}var u=Ha(a);u!==null&&(e.splice(t,3),t-=3,ko(u,{pending:!0,data:c,method:a.method,action:r},r,c))}}))}function ts(e){function t(j){return gi(j,e)}Rr!==null&&gi(Rr,e),Ur!==null&&gi(Ur,e),Hr!==null&&gi(Hr,e),Js.forEach(t),Fs.forEach(t);for(var a=0;a<Lr.length;a++){var r=Lr[a];r.blockedOn===e&&(r.blockedOn=null)}for(;0<Lr.length&&(a=Lr[0],a.blockedOn===null);)Rf(a),a.blockedOn===null&&Lr.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(r=0;r<a.length;r+=3){var c=a[r],u=a[r+1],f=c[Rt]||null;if(typeof u=="function")f||Hf(a);else if(f){var _=null;if(u&&u.hasAttribute("formAction")){if(c=u,f=u[Rt]||null)_=f.formAction;else if(zc(c)!==null)continue}else _=f.action;typeof _=="function"?a[r+1]=_:(a.splice(r,3),r-=3),Hf(a)}}}function Lf(){function e(u){u.canIntercept&&u.info==="react-transition"&&u.intercept({handler:function(){return new Promise(function(f){return c=f})},focusReset:"manual",scroll:"manual"})}function t(){c!==null&&(c(),c=null),r||setTimeout(a,20)}function a(){if(!r&&!navigation.transition){var u=navigation.currentEntry;u&&u.url!=null&&navigation.navigate(u.url,{state:u.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var r=!1,c=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(a,100),function(){r=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),c!==null&&(c(),c=null)}}}function Rc(e){this._internalRoot=e}yi.prototype.render=Rc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(o(409));var a=t.current,r=ra();Tf(a,r,e,t,null,null)},yi.prototype.unmount=Rc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Tf(e.current,2,null,e,null,null),Pl(),t[Ht]=null}};function yi(e){this._internalRoot=e}yi.prototype.unstable_scheduleHydration=function(e){if(e){var t=il();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Lr.length&&t!==0&&t<Lr[a].priority;a++);Lr.splice(a,0,e),a===0&&Rf(e)}};var Bf=l.version;if(Bf!=="19.2.0")throw Error(o(527,Bf,"19.2.0"));Q.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(o(188)):(e=Object.keys(e).join(","),Error(o(268,e)));return e=k(t),e=e!==null?B(e):null,e=e===null?null:e.stateNode,e};var wg={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vi.isDisabled&&vi.supportsFiber)try{ya=vi.inject(wg),Et=vi}catch{}}return Ps.createRoot=function(e,t){if(!d(e))throw Error(o(299));var a=!1,r="",c=Zd,u=Kd,f=Jd;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onUncaughtError!==void 0&&(c=t.onUncaughtError),t.onCaughtError!==void 0&&(u=t.onCaughtError),t.onRecoverableError!==void 0&&(f=t.onRecoverableError)),t=qf(e,1,!1,null,null,a,r,null,c,u,f,Lf),e[Ht]=t.current,_c(e),new Rc(t)},Ps.hydrateRoot=function(e,t,a){if(!d(e))throw Error(o(299));var r=!1,c="",u=Zd,f=Kd,_=Jd,j=null;return a!=null&&(a.unstable_strictMode===!0&&(r=!0),a.identifierPrefix!==void 0&&(c=a.identifierPrefix),a.onUncaughtError!==void 0&&(u=a.onUncaughtError),a.onCaughtError!==void 0&&(f=a.onCaughtError),a.onRecoverableError!==void 0&&(_=a.onRecoverableError),a.formState!==void 0&&(j=a.formState)),t=qf(e,1,!0,t,a??null,r,c,j,u,f,_,Lf),t.context=Df(null),a=t.current,r=ra(),r=Zr(r),c=xr(r),c.callback=null,Nr(a,c,r),a=r,t.current.lanes=a,Gt(t,a),Oa(t),e[Ht]=t.current,_c(e),new yi(t)},Ps.version="19.2.0",Ps}var Ff;function r_(){if(Ff)return Yc.exports;Ff=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(l){console.error(l)}}return n(),Yc.exports=a_(),Yc.exports}var n_=r_();const s_=Wg(n_),l_="fieldsync-offline",i_=2,Ye={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",TM_TICKETS:"tm_tickets",DAILY_REPORTS:"daily_reports",MESSAGES:"messages",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let vn=null;const ir=()=>new Promise((n,l)=>{if(vn){n(vn);return}const i=indexedDB.open(l_,i_);i.onerror=()=>{console.error("Failed to open offline database"),l(i.error)},i.onsuccess=()=>{vn=i.result,n(vn)},i.onupgradeneeded=o=>{const d=o.target.result;if(d.objectStoreNames.contains(Ye.PROJECTS)||d.createObjectStore(Ye.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),d.objectStoreNames.contains(Ye.AREAS)||d.createObjectStore(Ye.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ye.CREW_CHECKINS)||d.createObjectStore(Ye.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ye.TM_TICKETS)||d.createObjectStore(Ye.TM_TICKETS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ye.DAILY_REPORTS)||d.createObjectStore(Ye.DAILY_REPORTS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ye.MESSAGES)||d.createObjectStore(Ye.MESSAGES,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!d.objectStoreNames.contains(Ye.PENDING_ACTIONS)){const m=d.createObjectStore(Ye.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});m.createIndex("type","type",{unique:!1}),m.createIndex("created_at","created_at",{unique:!1})}d.objectStoreNames.contains(Ye.CACHED_DATA)||d.createObjectStore(Ye.CACHED_DATA,{keyPath:"key"})}}),jn=(n,l="readonly")=>{if(!vn)throw new Error("Database not initialized");return vn.transaction(n,l).objectStore(n)},nl=async(n,l)=>(await ir(),new Promise((i,o)=>{const m=jn(n,"readwrite").put(l);m.onsuccess=()=>i(m.result),m.onerror=()=>o(m.error)})),hh=async(n,l)=>(await ir(),new Promise((i,o)=>{const d=vn.transaction(n,"readwrite"),m=d.objectStore(n);l.forEach(h=>m.put(h)),d.oncomplete=()=>i(),d.onerror=()=>o(d.error)})),o_=async(n,l)=>(await ir(),new Promise((i,o)=>{const m=jn(n).get(l);m.onsuccess=()=>i(m.result),m.onerror=()=>o(m.error)})),ph=async n=>(await ir(),new Promise((l,i)=>{const d=jn(n).getAll();d.onsuccess=()=>l(d.result||[]),d.onerror=()=>i(d.error)})),nu=async(n,l,i)=>(await ir(),new Promise((o,d)=>{const g=jn(n).index(l).getAll(i);g.onsuccess=()=>o(g.result||[]),g.onerror=()=>d(g.error)})),c_=async(n,l)=>(await ir(),new Promise((i,o)=>{const m=jn(n,"readwrite").delete(l);m.onsuccess=()=>i(),m.onerror=()=>o(m.error)})),xt={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},na=async(n,l,i={})=>{await ir();const o={type:n,payload:l,metadata:i,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((d,m)=>{const g=jn(Ye.PENDING_ACTIONS,"readwrite").add(o);g.onsuccess=()=>{d(g.result)},g.onerror=()=>m(g.error)})},gh=async()=>ph(Ye.PENDING_ACTIONS),Ni=async()=>(await gh()).length,u_=async n=>c_(Ye.PENDING_ACTIONS,n),d_=async(n,l)=>(await ir(),new Promise((i,o)=>{const d=jn(Ye.PENDING_ACTIONS,"readwrite"),m=d.get(n);m.onsuccess=()=>{const h=m.result;if(h){const g={...h,...l},b=d.put(g);b.onsuccess=()=>i(g),b.onerror=()=>o(b.error)}else o(new Error("Action not found"))},m.onerror=()=>o(m.error)})),m_=async n=>hh(Ye.PROJECTS,n),$f=async n=>n?nu(Ye.PROJECTS,"company_id",n):ph(Ye.PROJECTS),f_=async n=>hh(Ye.AREAS,n),Wf=async n=>nu(Ye.AREAS,"project_id",n),Xc=async(n,l)=>{const i=await o_(Ye.AREAS,n);return i&&(i.status=l,i.updated_at=new Date().toISOString(),await nl(Ye.AREAS,i)),i},bi=async n=>nl(Ye.CREW_CHECKINS,n),Pf=async n=>nl(Ye.TM_TICKETS,n),Ft=()=>{const n=new Uint8Array(6);crypto.getRandomValues(n);const l=Array.from(n,i=>i.toString(36)).join("");return`temp_${Date.now()}_${l}`},as=async n=>nl(Ye.DAILY_REPORTS,n),h_=async(n,l)=>(await nu(Ye.DAILY_REPORTS,"project_id",n)).find(o=>o.report_date===l)||null,If=async n=>nl(Ye.MESSAGES,n);let su=typeof navigator<"u"?navigator.onLine:!0;const Wc=new Set,lu=n=>(Wc.add(n),()=>Wc.delete(n)),ga=()=>su,eh=n=>{su=n,Wc.forEach(l=>l(n))};typeof window<"u"&&(window.addEventListener("online",()=>{eh(!0)}),window.addEventListener("offline",()=>{eh(!1)}));let Vc=!1;const _h=async n=>{if(Vc||!su)return{synced:0,failed:0};Vc=!0;const l={synced:0,failed:0};try{const i=await gh();for(const o of i)try{await p_(o,n),await u_(o.id),l.synced++}catch(d){console.error(`Failed to sync action ${o.type}:`,d),l.failed++,await d_(o.id,{attempts:(o.attempts||0)+1,last_error:d.message,last_attempt:new Date().toISOString()})}}finally{Vc=!1}return l},p_=async(n,l)=>{const{type:i,payload:o}=n;switch(i){case xt.UPDATE_AREA_STATUS:return l.updateAreaStatus(o.areaId,o.status);case xt.CREATE_TM_TICKET:const d=await l.createTMTicket(o.ticket);return o.workers?.length>0&&await l.addTMWorkers(d.id,o.workers),o.items?.length>0&&await l.addTMItems(d.id,o.items),d;case xt.SAVE_CREW_CHECKIN:return l.saveCrewCheckin(o.projectId,o.workers,o.checkInDate);case xt.SUBMIT_DAILY_REPORT:return await l.saveDailyReport(o.projectId,o.reportData),l.submitDailyReport(o.projectId,o.submittedBy);case xt.SEND_MESSAGE:return l.sendMessage(o.projectId,o.senderType,o.senderName,o.content);case xt.CREATE_MATERIAL_REQUEST:return l.createMaterialRequest(o.projectId,o.items,o.requestedBy,o.neededBy,o.priority,o.notes);default:throw new Error(`Unknown action type: ${i}`)}},yh="https://cegifnrcwdilromcyouq.supabase.co",iu="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlZ2lmbnJjd2RpbHJvbWN5b3VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTQ5OTAsImV4cCI6MjA4MDIzMDk5MH0.qAiBG5XaB0C1E0U2tQbQkrhpm1iUhM6A2MXngEHhX4A",v=!!iu,y=v?fh(yh,iu):null,ji={slowQueryThreshold:200,enableSupabase:v},Ce={query(n,l){const i={type:"query",operation:n,duration_ms:l.duration,rows_returned:l.rows,company_id:l.company_id||null,project_id:l.project_id||null,user_id:l.user_id||null,timestamp:new Date().toISOString()};ji.enableSupabase&&l.duration>=ji.slowQueryThreshold&&Zc("query",i)},error(n,l){const i={type:"error",category:n,severity:l.severity||"error",error_code:l.code||null,message:l.message,company_id:l.company_id||null,user_id:l.user_id||null,project_id:l.project_id||null,operation:l.operation||null,context:l.extra||{},timestamp:new Date().toISOString()};ji.enableSupabase&&Zc("error",i)},storage(n,l){const i={type:"storage",operation:n,company_id:l.company_id||null,project_id:l.project_id||null,file_size_bytes:l.size||0,duration_ms:l.duration||0,success:l.success!==!1,error_message:l.error||null,timestamp:new Date().toISOString()};ji.enableSupabase&&(!i.success||i.duration_ms>5e3)&&Zc("storage",i)},activity(n,l){}};async function Zc(n,l){if(y)try{n==="error"?await y.rpc("log_error",{p_severity:l.severity,p_category:l.category,p_message:l.message,p_company_id:l.company_id,p_user_id:l.user_id,p_project_id:l.project_id,p_operation:l.operation,p_error_code:l.error_code,p_context:l.context||{}}):n==="query"&&await y.rpc("log_query_metric",{p_operation:l.operation,p_duration_ms:l.duration_ms,p_rows_returned:l.rows_returned,p_company_id:l.company_id,p_project_id:l.project_id,p_user_id:l.user_id,p_context:{}})}catch{}}Ce.wrapQuery=function(n,l){return async function(...i){const o=performance.now();try{const d=await l.apply(this,i),h={duration:Math.round(performance.now()-o),rows:Array.isArray(d)?d.length:void 0};return Ce.query(n,h),d}catch(d){const m=Math.round(performance.now()-o);throw Ce.error("database",{message:d.message,operation:n,severity:"error",extra:{duration:m}}),d}}};Ce.time=async function(n,l){const i=performance.now();try{const o=await l(),d=Math.round(performance.now()-i);return Ce.query(n,{duration:d}),o}catch(o){throw Ce.error("general",{message:o.message,operation:n}),o}};typeof window<"u"&&ir().catch(n=>console.error("Failed to init offline DB:",n));const Pc="fieldsync_field_session";let tl=null;const Ti=()=>{if(tl)return tl;try{const n=sessionStorage.getItem(Pc);if(n)return tl=JSON.parse(n),tl}catch{}return null},Ic=n=>{tl=n,n?sessionStorage.setItem(Pc,JSON.stringify(n)):sessionStorage.removeItem(Pc)},eu=async()=>{const n=Ti();if(n?.token&&v)try{await y.rpc("invalidate_field_session",{p_session_token:n.token})}catch{}Ic(null)};let Is=null;const vh=()=>{const n=Ti();return!n?.token||!v?y:((!Is||Is._sessionToken!==n.token)&&(Is=fh(yh,iu,{global:{headers:{"x-field-session":n.token}}}),Is._sessionToken=n.token),Is)},le=()=>v?Ti()?.token?vh():y:null,tu=()=>{const n=Ti();return!!(n?.token&&n?.projectId)},au="fieldsync_data",qi="fieldsync_user",g_=()=>{const n="fieldsync_device_id";let l=localStorage.getItem(n);return l||(l=crypto.randomUUID(),localStorage.setItem(n,l)),l},th={projects:[],areas:[],users:[],assignments:[]},ae=()=>{try{const n=localStorage.getItem(au);return n?JSON.parse(n):th}catch{return localStorage.removeItem(au),th}},De=n=>{localStorage.setItem(au,JSON.stringify(n))},wi=()=>{try{const n=localStorage.getItem(qi);return n?JSON.parse(n):null}catch{return localStorage.removeItem(qi),null}},Si=n=>{n?localStorage.setItem(qi,JSON.stringify(n)):localStorage.removeItem(qi)},ru={async signUp(n,l,i,o){if(v){const{data:d,error:m}=await y.auth.signUp({email:n,password:l,options:{data:{name:i,role:o}}});if(m)throw m;return d}else{const d=ae(),m={id:crypto.randomUUID(),email:n,name:i,role:o,created_at:new Date().toISOString()};return d.users.push(m),De(d),Si(m),{user:m}}},async signIn(n,l){if(v){const{data:i,error:o}=await y.auth.signInWithPassword({email:n,password:l});if(o)throw o;return i}else{const o=ae().users.find(d=>d.email===n);if(!o)throw new Error("User not found");return Si(o),{user:o}}},async signOut(){if(v){const{error:n}=await y.auth.signOut();if(n)throw n}else Si(null)},async getUser(){if(v){const{data:{user:n}}=await y.auth.getUser();return n}else return wi()},async getProfile(){if(v){const{data:{user:n}}=await y.auth.getUser();if(!n)return null;const{data:l,error:i}=await y.from("users").select("*").eq("id",n.id).single();return i?{id:n.id,email:n.email,name:n.user_metadata?.name||"",role:n.user_metadata?.role||"foreman"}:l}else return wi()},async updateRole(n,l){if(v){const{data:i,error:o}=await y.from("users").update({role:l}).eq("id",n).select().single();if(o)throw o;return i}else{const i=ae(),o=i.users.find(d=>d.id===n);return o&&(o.role=l,De(i),wi()?.id===n&&Si(o)),o}},onAuthStateChange(n){if(v)return y.auth.onAuthStateChange(n);{const l=wi();return n(l?"SIGNED_IN":"SIGNED_OUT",{user:l}),{data:{subscription:{unsubscribe:()=>{}}}}}}},_e={async getProjects(n=null,l=!1){if(v){if(!ga()){const o=await $f(n);return l?o:o.filter(d=>d.status!=="archived")}const i=performance.now();try{let o=y.from("projects").select("*").order("created_at",{ascending:!1});n&&(o=o.eq("company_id",n)),l||(o=o.eq("status","active"));const{data:d,error:m}=await o,h=Math.round(performance.now()-i);if(Ce.query("getProjects",{duration:h,rows:d?.length,company_id:n}),m){Ce.error("database",{message:m.message,operation:"getProjects",company_id:n});const g=await $f(n);if(g.length>0)return g;throw m}return d?.length>0&&m_(d).catch(g=>console.error("Failed to cache projects:",g)),d}catch(o){throw Ce.error("database",{message:o.message,operation:"getProjects",company_id:n}),o}}else{const i=ae().projects;return l?i:i.filter(o=>o.status!=="archived")}},async getProjectsPaginated(n,{page:l=0,limit:i=25,status:o="active"}={}){if(v){const h=performance.now();try{let g=y.from("projects").select("*",{count:"exact"}).eq("company_id",n).order("created_at",{ascending:!1}).range(l*i,(l+1)*i-1);o!=="all"&&(g=g.eq("status",o));const{data:b,error:k,count:B}=await g,S=Math.round(performance.now()-h);if(Ce.query("getProjectsPaginated",{duration:S,rows:b?.length,page:l,company_id:n}),k)throw k;return{projects:b||[],totalCount:B||0,hasMore:(l+1)*i<(B||0),page:l,limit:i}}catch(g){throw Ce.error("database",{message:g.message,operation:"getProjectsPaginated",company_id:n}),g}}const d=ae().projects.filter(h=>h.company_id===n&&(o==="all"||h.status===o)),m=l*i;return{projects:d.slice(m,m+i),totalCount:d.length,hasMore:m+i<d.length,page:l,limit:i}},async getProjectsWithSummary(n){if(v){const l=performance.now();try{const{data:i,error:o}=await y.from("projects").select(`
            *,
            areas:areas(count),
            tickets:t_and_m_tickets(count),
            pending_tickets:t_and_m_tickets(count),
            daily_reports:daily_reports(count)
          `).eq("company_id",n).eq("status","active").eq("pending_tickets.status","pending").order("created_at",{ascending:!1}),d=Math.round(performance.now()-l);if(Ce.query("getProjectsWithSummary",{duration:d,rows:i?.length,company_id:n}),o)throw o;return(i||[]).map(m=>({...m,areaCount:m.areas?.[0]?.count||0,ticketCount:m.tickets?.[0]?.count||0,pendingTicketCount:m.pending_tickets?.[0]?.count||0,reportCount:m.daily_reports?.[0]?.count||0,areas:void 0,tickets:void 0,pending_tickets:void 0,daily_reports:void 0}))}catch(i){return Ce.error("database",{message:i.message,operation:"getProjectsWithSummary",company_id:n}),this.getProjects(n)}}return ae().projects.filter(l=>l.company_id===n&&l.status==="active")},async getProjectDashboardSummary(n){if(v){const l=performance.now();try{const{data:i,error:o}=await y.rpc("get_project_dashboard_summary",{p_company_id:n}),d=Math.round(performance.now()-l);if(Ce.query("getProjectDashboardSummary",{duration:d,rows:i?.length,company_id:n}),o){if(o.message?.includes("function")||o.code==="42883")return this.getProjectsWithSummary(n);throw o}return(i||[]).map(m=>({id:m.project_id,name:m.project_name,status:m.project_status,job_number:m.project_number,address:m.project_address,pin:m.project_pin,created_at:m.created_at,start_date:m.start_date,end_date:m.end_date,contract_value:Number(m.contract_value)||0,work_type:m.work_type||"demolition",job_type:m.job_type||"standard",general_contractor:m.general_contractor||"",areaCount:Number(m.total_areas)||0,completedAreas:Number(m.completed_areas)||0,inProgressAreas:Number(m.in_progress_areas)||0,pendingAreas:Number(m.pending_areas)||0,ticketCount:Number(m.total_tickets)||0,pendingTicketCount:Number(m.pending_tickets)||0,submittedTicketCount:Number(m.submitted_tickets)||0,approvedTicketCount:Number(m.approved_tickets)||0,totalLaborHours:Number(m.total_labor_hours)||0,todayLaborHours:Number(m.today_labor_hours)||0,todayWorkerCount:Number(m.today_worker_count)||0,lastActivityAt:m.last_activity_at,dailyReportsThisWeek:Number(m.daily_reports_this_week)||0,corCount:Number(m.cor_count)||0,pendingCorCount:Number(m.pending_cor_count)||0,disposalLoadsToday:Number(m.disposal_loads_today)||0}))}catch(i){return Ce.error("database",{message:i.message,operation:"getProjectDashboardSummary",company_id:n}),this.getProjectsWithSummary(n)}}return ae().projects.filter(l=>l.company_id===n&&l.status==="active")},async getArchivedProjects(n){if(v){const{data:l,error:i}=await y.from("projects").select("*").eq("company_id",n).eq("status","archived").order("archived_at",{ascending:!1});if(i)throw i;return l}else return ae().projects.filter(l=>l.status==="archived")},async getProjectCount(n){if(v){const{count:l,error:i}=await y.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",n).in("status",["active","archived"]);if(i)throw i;return l||0}else return ae().projects.filter(i=>i.company_id===n&&i.status!=="deleted").length},async archiveProject(n){if(v){const{data:l,error:i}=await y.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",n).select().single();if(i)throw i;return l}else{const l=ae(),i=l.projects.find(o=>o.id===n);return i&&(i.status="archived",i.archived_at=new Date().toISOString(),De(l)),i}},async getProjectStorageStats(n){if(!v)return{photoCount:0,estimatedMB:0};const{data:l,error:i}=await y.from("t_and_m_tickets").select("photos").eq("project_id",n);if(i)throw i;let o=0;const d=[];l?.forEach(h=>{h.photos&&Array.isArray(h.photos)&&(o+=h.photos.length,d.push(...h.photos))});const m=o*1.5;return{photoCount:o,estimatedMB:m,photoUrls:d}},async archiveProjectDeep(n,l){if(!v)return null;const{photoUrls:i}=await this.getProjectStorageStats(n);if(i.length>0){const m=i.map(h=>{try{const b=new URL(h).pathname.match(/\/tm-photos\/(.+)$/);return b?b[1]:null}catch{return null}}).filter(Boolean);if(m.length>0)for(let h=0;h<m.length;h+=100){const g=m.slice(h,h+100);await y.storage.from("tm-photos").remove(g)}}await y.from("t_and_m_tickets").update({photos:[]}).eq("project_id",n);const{data:o,error:d}=await y.from("projects").update({status:"archived",archived_at:new Date().toISOString(),photos:[],storage_cleaned:!0}).eq("id",n).select().single();if(d)throw d;return{...o,photosDeleted:i.length}},async restoreProject(n){if(v){const{data:l,error:i}=await y.from("projects").update({status:"active",archived_at:null}).eq("id",n).select().single();if(i)throw i;return l}else{const l=ae(),i=l.projects.find(o=>o.id===n);return i&&(i.status="active",i.archived_at=null,De(l)),i}},async getProject(n){if(v){const{data:l,error:i}=await y.from("projects").select("*").eq("id",n).single();if(i)throw i;return l}else return ae().projects.find(l=>l.id===n)},async createProject(n){if(v){const{data:l,error:i}=await y.from("projects").insert({...n,status:"active"}).select().single();if(i)throw console.error("Supabase createProject error:",i.message,i.details,i.hint),i;return l}else{const l=ae(),i={...n,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return l.projects.push(i),De(l),i}},async getProjectByPin(n){if(v){const{data:l,error:i}=await y.from("projects").select("*").eq("pin",n).eq("status","active").single();return i?null:l}else return ae().projects.find(i=>i.pin===n&&i.status==="active")||null},async getProjectByPinAndCompany(n,l){if(v){const{data:i,error:o}=await y.from("projects").select("*").eq("pin",n).eq("company_id",l).eq("status","active").single();return o?null:i}else return ae().projects.find(o=>o.pin===n&&o.company_id===l&&o.status==="active")||null},async getProjectByPinSecure(n,l){if(v){const i=`pin_attempts_${l}`,o=`pin_lockout_${l}`,d=5,m=300*1e3,h=localStorage.getItem(o);if(h&&Date.now()<parseInt(h)){const Z=parseInt(h)-Date.now(),U=Math.ceil(Z/6e4);return{success:!1,rateLimited:!0,project:null,error:`Too many attempts. Please try again in ${U} minute${U>1?"s":""}.`}}let g=parseInt(localStorage.getItem(i)||"0");if(g++,localStorage.setItem(i,g.toString()),g>d)return localStorage.setItem(o,(Date.now()+m).toString()),{success:!1,rateLimited:!0,project:null,error:"Too many failed attempts. Please try again in 5 minutes."};const b=g_(),{data:k,error:B}=await y.rpc("validate_pin_and_create_session",{p_pin:n,p_company_code:l,p_device_id:b,p_ip_address:null});if(B)return console.error("[PIN Auth] RPC error"),{success:!1,rateLimited:!1,project:null,error:B.message};if(!k||k.length===0)return{success:!1,rateLimited:!1,project:null};const S=k[0];if(S.error_code==="RATE_LIMITED")return{success:!1,rateLimited:!0,project:null};if(S.error_code==="INVALID_COMPANY"||S.error_code==="INVALID_PIN")return{success:!1,rateLimited:!1,project:null};if(!S.success||!S.project_id)return{success:!1,rateLimited:!1,project:null};localStorage.removeItem(`pin_attempts_${l}`),localStorage.removeItem(`pin_lockout_${l}`),Ic({token:S.session_token,projectId:S.project_id,companyId:S.company_id,projectName:S.project_name,companyName:S.company_name,createdAt:new Date().toISOString()});const X=vh(),{data:te,error:F}=await X.from("projects").select("*").eq("id",S.project_id).single();return{success:!0,rateLimited:!1,sessionToken:S.session_token,project:te||{id:S.project_id,name:S.project_name,company_id:S.company_id,status:"active"}}}else{const i=ae(),d=(i.companies||[]).find(h=>h.code===l);if(!d)return{success:!1,rateLimited:!1,project:null};const m=i.projects.find(h=>h.pin===n&&h.company_id===d.id&&h.status==="active");if(m){const h=`demo_${Date.now()}_${Math.random().toString(36).slice(2)}`;Ic({token:h,projectId:m.id,companyId:d.id,projectName:m.name,companyName:d.name,createdAt:new Date().toISOString()})}return{success:!!m,rateLimited:!1,project:m||null}}},async isPinAvailable(n,l=null){if(v){let i=y.from("projects").select("id").eq("pin",n);l&&(i=i.neq("id",l));const{data:o,error:d}=await i;if(d)throw d;return o.length===0}else return!ae().projects.some(o=>o.pin===n&&o.id!==l)},async updateProjectPin(n,l){if(v){const{data:i,error:o}=await y.from("projects").update({pin:l}).eq("id",n).select().single();if(o)throw o;return i}else{const i=ae(),o=i.projects.find(d=>d.id===n);return o&&(o.pin=l,De(i)),o}},async updateProject(n,l,i=null){if(v){if(!i)throw console.error("[Security] updateProject called without companyId - this is a security risk"),new Error("Company ID is required for security verification");const{data:o,error:d}=await y.from("projects").update(l).eq("id",n).eq("company_id",i).select().single();if(d)throw console.error("Error updating project"),d;return o}else{const o=ae(),d=o.projects.find(m=>m.id===n);return d&&(Object.assign(d,l),De(o)),d}},async deleteProject(n,l=null){if(v){let i=y.from("projects").delete().eq("id",n);l&&(i=i.eq("company_id",l));const{error:o}=await i;if(o)throw o}else{const i=ae();i.projects=i.projects.filter(o=>o.id!==n),i.areas=i.areas.filter(o=>o.project_id!==n),De(i)}},async getAreas(n){if(v){if(!ga())return Wf(n);const l=le(),{data:i,error:o}=await l.from("areas").select("*").eq("project_id",n).order("sort_order",{ascending:!0});if(o){const d=await Wf(n);if(d.length>0)return d;throw o}return i?.length>0&&f_(i).catch(d=>console.error("Failed to cache areas:",d)),i}else return ae().areas.filter(l=>l.project_id===n)},async createArea(n){if(v){const l=le(),{data:i,error:o}=await l.from("areas").insert(n).select().single();if(o)throw o;return i}else{const l=ae(),i={...n,id:crypto.randomUUID(),created_at:new Date().toISOString()};return l.areas.push(i),De(l),i}},async updateAreaStatus(n,l,i=null){if(v){if(!ga()){const g=await Xc(n,l);return await na(xt.UPDATE_AREA_STATUS,{areaId:n,status:l}),g}let d=le().from("areas").update({status:l}).eq("id",n);i&&(d=d.eq("project_id",i));const{data:m,error:h}=await d.select().single();if(h){if(h.message?.includes("fetch")||h.message?.includes("network")){const g=await Xc(n,l);return await na(xt.UPDATE_AREA_STATUS,{areaId:n,status:l}),g}throw h}return m&&Xc(n,l).catch(()=>{}),m}else{const o=ae(),d=o.areas.find(m=>m.id===n);return d&&(d.status=l,d.updated_at=new Date().toISOString()),De(o),d}},async updateArea(n,l,i=null){if(v){let o=y.from("areas").update(l).eq("id",n);i&&(o=o.eq("project_id",i));const{data:d,error:m}=await o.select().single();if(m)throw m;return d}else{const o=ae(),d=o.areas.find(m=>m.id===n);return d&&(Object.assign(d,l),d.updated_at=new Date().toISOString()),De(o),d}},async deleteArea(n,l=null){if(v){let i=y.from("areas").delete().eq("id",n);l&&(i=i.eq("project_id",l));const{error:o}=await i;if(o)throw o}else{const i=ae();i.areas=i.areas.filter(o=>o.id!==n),De(i)}},subscribeToAreas(n,l){return v?y.channel(`areas:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToMessages(n,l){return v?y.channel(`messages:${n}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToMaterialRequests(n,l){return v?y.channel(`material_requests:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToDailyReports(n,l){return v?y.channel(`daily_reports:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToCrewCheckins(n,l){return v?y.channel(`crew_checkins:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToInjuryReports(n,l){return v?y.channel(`injury_reports:${n}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${n}`},l).subscribe():null},subscribeToTMTickets(n,l){return v?y.channel(`tm_tickets:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToCompanyActivity(n,l,i){if(!v||!l||l.length===0)return null;const o=y.channel(`company_activity:${n}`);return l.forEach(d=>{o.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${d}`},m=>i.onMessage?.(m)),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"material_requests",filter:`project_id=eq.${d}`},m=>i.onMaterialRequest?.(m)),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${d}`},m=>i.onTMTicket?.(m)),o.on("postgres_changes",{event:"UPDATE",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${d}`},m=>i.onTMTicket?.(m)),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"crew_checkins",filter:`project_id=eq.${d}`},m=>i.onCrewCheckin?.(m)),o.on("postgres_changes",{event:"UPDATE",schema:"public",table:"crew_checkins",filter:`project_id=eq.${d}`},m=>i.onCrewCheckin?.(m)),o.on("postgres_changes",{event:"UPDATE",schema:"public",table:"areas",filter:`project_id=eq.${d}`},m=>i.onAreaUpdate?.(m)),o.on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${d}`},m=>i.onCORChange?.(m))}),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${n}`},d=>i.onInjuryReport?.(d)),o.subscribe()},unsubscribe(n){n&&v&&y.removeChannel(n)},async getAssignedProjects(n){if(v){const{data:l,error:i}=await y.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",n);if(i)throw i;return l.map(o=>o.projects)}else{const l=ae();return(l.assignments?.filter(o=>o.user_id===n)||[]).map(o=>l.projects.find(d=>d.id===o.project_id)).filter(Boolean)}},async assignUserToProject(n,l,i){if(v){const{data:o,error:d}=await y.from("project_assignments").insert({project_id:n,user_id:l,assigned_by:i}).select().single();if(d)throw d;return o}else{const o=ae();o.assignments||(o.assignments=[]);const d={id:crypto.randomUUID(),project_id:n,user_id:l,assigned_by:i,assigned_at:new Date().toISOString()};return o.assignments.push(d),De(o),d}},async removeUserFromProject(n,l){if(v){const{error:i}=await y.from("project_assignments").delete().eq("project_id",n).eq("user_id",l);if(i)throw i}else{const i=ae();i.assignments=i.assignments?.filter(o=>!(o.project_id===n&&o.user_id===l))||[],De(i)}},async getProjectAssignments(n){if(v){const{data:l,error:i}=await y.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",n);if(i)throw i;return l.map(o=>o.users)}else{const l=ae();return(l.assignments?.filter(o=>o.project_id===n)||[]).map(o=>l.users.find(d=>d.id===o.user_id)).filter(Boolean)}},async getAllUsers(){if(v){const{data:n,error:l}=await y.from("users").select("*").order("name");if(l)throw l;return n}else return ae().users||[]},async getForemen(){if(v){const{data:n,error:l}=await y.from("users").select("*").eq("role","foreman").order("name");if(l)throw l;return n}else return(ae().users||[]).filter(n=>n.role==="foreman")},async logActivity(n,l,i,o,d,m){if(v){const{error:h}=await y.from("activity_log").insert({user_id:n,project_id:l,area_id:i,action:o,old_value:d,new_value:m});h&&console.error("Error logging activity:",h)}},async getProjectActivity(n,l=50){if(v){const{data:i,error:o}=await y.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",n).order("created_at",{ascending:!1}).limit(l);if(o)throw o;return i}return[]},async getMaterialsEquipment(n){if(v){const{data:l,error:i}=await y.from("materials_equipment").select("*").eq("company_id",n).eq("active",!0).order("category").order("name");if(i)throw i;return l}return[]},async getMaterialsEquipmentByCategory(n,l){if(v){const i=le();if(!i)return[];const{data:o,error:d}=await i.from("materials_equipment").select("*").eq("company_id",n).eq("category",l).eq("active",!0).order("name");if(d)throw d;return o}return[]},async getAllMaterialsEquipment(n){if(v){const l=le();if(!l)return[];const{data:i,error:o}=await l.from("materials_equipment").select("*").eq("company_id",n).order("category").order("name");if(o)throw o;return i}return[]},async createMaterialEquipment(n){if(v){const{data:l,error:i}=await y.from("materials_equipment").insert(n).select().single();if(i)throw i;return l}return null},async updateMaterialEquipment(n,l){if(v){const{data:i,error:o}=await y.from("materials_equipment").update(l).eq("id",n).select().single();if(o)throw o;return i}return null},async deleteMaterialEquipment(n){if(v){const{error:l}=await y.from("materials_equipment").update({active:!1}).eq("id",n);if(l)throw l}},async getLaborCategories(n){if(v){const{data:l,error:i}=await y.from("labor_categories").select("*").eq("company_id",n).eq("active",!0).order("sort_order").order("name");if(i)throw i;return l||[]}return[]},async createLaborCategory(n,l,i=0){if(v){const{data:o,error:d}=await y.from("labor_categories").insert({company_id:n,name:l,sort_order:i}).select().single();if(d)throw d;return o}return null},async updateLaborCategory(n,l){if(v){const{data:i,error:o}=await y.from("labor_categories").update(l).eq("id",n).select().single();if(o)throw o;return i}return null},async deleteLaborCategory(n){if(v){const{error:l}=await y.from("labor_categories").update({active:!1}).eq("id",n);if(l)throw l}},async getLaborClasses(n){if(v){const{data:l,error:i}=await y.from("labor_classes").select(`
          *,
          labor_categories (id, name)
        `).eq("company_id",n).eq("active",!0).order("sort_order").order("name");if(i)throw i;return l||[]}return[]},async getLaborClassesWithCategories(n){if(v){const[l,i]=await Promise.all([y.from("labor_categories").select("*").eq("company_id",n).eq("active",!0).order("sort_order").order("name"),y.from("labor_classes").select("*").eq("company_id",n).eq("active",!0).order("sort_order").order("name")]);if(l.error)throw l.error;if(i.error)throw i.error;return{categories:l.data||[],classes:i.data||[]}}return{categories:[],classes:[]}},async getLaborClassesForField(n){if(v){const l=le();if(!l)return{categories:[],classes:[]};const{data:i,error:o}=await l.rpc("get_labor_classes_for_field",{p_company_id:n});if(o){console.error("Error loading field labor classes:",o);const[h,g]=await Promise.all([l.from("labor_categories").select("id, name").eq("company_id",n).eq("active",!0).order("name"),l.from("labor_classes").select("id, name, category_id").eq("company_id",n).eq("active",!0).order("name")]);return{categories:h.data||[],classes:g.data||[]}}const d=new Map,m=[];for(const h of i||[])h.category_id&&h.category_name&&!d.has(h.category_id)&&d.set(h.category_id,{id:h.category_id,name:h.category_name}),m.push({id:h.id,name:h.name,category_id:h.category_id});return{categories:Array.from(d.values()),classes:m}}return{categories:[],classes:[]}},async createLaborClass(n,l,i,o=0){if(v){const{data:d,error:m}=await y.from("labor_classes").insert({company_id:n,category_id:l,name:i,sort_order:o}).select().single();if(m)throw m;return d}return null},async updateLaborClass(n,l){if(v){const{data:i,error:o}=await y.from("labor_classes").update(l).eq("id",n).select().single();if(o)throw o;return i}return null},async deleteLaborClass(n){if(v){const{error:l}=await y.from("labor_classes").update({active:!1}).eq("id",n);if(l)throw l}},async getLaborClassRates(n){if(v){const{data:l,error:i}=await y.from("labor_class_rates").select("*").eq("labor_class_id",n);if(i)throw i;return l||[]}return[]},async getAllLaborClassRates(n){if(v){const{data:l,error:i}=await y.from("labor_classes").select(`
          id,
          name,
          labor_class_rates (*)
        `).eq("company_id",n).eq("active",!0);if(i)throw i;return l||[]}return[]},async saveLaborClassRates(n,l){if(v){const i=l.map(d=>({...d,labor_class_id:n})),{error:o}=await y.from("labor_class_rates").upsert(i,{onConflict:"labor_class_id,work_type,job_type"});if(o)throw o}},async getLaborClassRate(n,l,i){if(v){const{data:o,error:d}=await y.from("labor_class_rates").select("regular_rate, overtime_rate").eq("labor_class_id",n).eq("work_type",l).eq("job_type",i).single();if(d&&d.code!=="PGRST116")throw d;return o||null}return null},async getTMTickets(n){if(v){const l=performance.now(),i=le(),d=tu()?"materials_equipment (name, unit, category)":"materials_equipment (name, unit, cost_per_unit, category)";try{const{data:m,error:h}=await i.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              ${d}
            )
          `).eq("project_id",n).order("created_at",{ascending:!1}),g=Math.round(performance.now()-l);if(Ce.query("getTMTickets",{duration:g,rows:m?.length,project_id:n}),h)throw h;return m}catch(m){throw Ce.error("database",{message:m.message,operation:"getTMTickets",project_id:n}),m}}return[]},async getTMTicketsPaginated(n,{page:l=0,limit:i=25,status:o=null}={}){if(v){const d=performance.now(),m=le(),g=tu()?"materials_equipment (name, unit, category)":"materials_equipment (name, unit, cost_per_unit, category)";try{let b=m.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              ${g}
            )
          `,{count:"exact"}).eq("project_id",n).order("created_at",{ascending:!1}).range(l*i,(l+1)*i-1);o&&(b=b.eq("status",o));const{data:k,error:B,count:S}=await b,X=Math.round(performance.now()-d);if(Ce.query("getTMTicketsPaginated",{duration:X,rows:k?.length,page:l,project_id:n}),B)throw B;return{tickets:k||[],totalCount:S||0,hasMore:(l+1)*i<(S||0),page:l,limit:i}}catch(b){throw Ce.error("database",{message:b.message,operation:"getTMTicketsPaginated",project_id:n}),b}}return{tickets:[],totalCount:0,hasMore:!1,page:0,limit:25}},async getChangeOrderTotals(n){if(v){const{data:l,error:i}=await y.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",n).not("ce_pco_number","is",null).neq("ce_pco_number","");if(i)throw i;const o={};let d=0,m=0;return l?.forEach(h=>{const g=h.ce_pco_number;if(o[g]||(o[g]={approved:0,pending:0,count:0}),o[g].count++,h.status==="approved"||h.status==="billed"){const b=parseFloat(h.change_order_value)||0;o[g].approved+=b,d+=b}else h.status==="pending"&&m++}),{changeOrders:o,totalApprovedValue:d,pendingCount:m}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(n,l){if(v){const{data:i,error:o}=await y.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",n).eq("status",l).order("created_at",{ascending:!1});if(o)throw o;return i}return[]},async getCORTickets(n){if(v){const{data:l,error:i}=await y.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",n).order("work_date",{ascending:!0});if(i)throw i;return l||[]}return[]},async createTMTicket(n){if(v){if(!ga()){const d={id:Ft(),project_id:n.project_id,work_date:n.work_date,ce_pco_number:n.ce_pco_number||null,assigned_cor_id:n.assigned_cor_id||null,notes:n.notes,photos:n.photos||[],status:"pending_sync",created_by_name:n.created_by_name||"Field User",created_at:new Date().toISOString(),_offline:!0};return await Pf(d),await na(xt.CREATE_TM_TICKET,{ticket:d,workers:n._workers||[],items:n._items||[]}),d}const l=le();if(!l)throw new Error("Database client not available");const{data:i,error:o}=await l.from("t_and_m_tickets").insert({project_id:n.project_id,work_date:n.work_date,ce_pco_number:n.ce_pco_number||null,assigned_cor_id:n.assigned_cor_id||null,notes:n.notes,photos:n.photos||[],status:"pending",created_by_name:n.created_by_name||"Field User"}).select().single();if(o){if(o.message?.includes("fetch")||o.message?.includes("network")){const d={id:Ft(),...n,status:"pending_sync",_offline:!0};return await Pf(d),await na(xt.CREATE_TM_TICKET,{ticket:d,workers:n._workers||[],items:n._items||[]}),d}throw o}return i}return null},async addTMWorkers(n,l){if(v){const i=l.map(m=>({ticket_id:n,name:m.name,hours:m.hours,overtime_hours:m.overtime_hours||0,time_started:m.time_started||null,time_ended:m.time_ended||null,role:m.role||"Laborer"})),o=le();if(!o)throw new Error("Database client not available");const{error:d}=await o.from("t_and_m_workers").insert(i);if(d)throw d}},async addTMItems(n,l){if(v){const i=l.map(m=>({ticket_id:n,material_equipment_id:m.material_equipment_id||null,custom_name:m.custom_name||null,custom_category:m.custom_category||null,quantity:m.quantity})),o=le();if(!o)throw new Error("Database client not available");const{error:d}=await o.from("t_and_m_items").insert(i);if(d)throw d}},async getPreviousTicketCrew(n,l){if(!v)return null;const i=le();if(!i)return null;const{data:o,error:d}=await i.from("t_and_m_tickets").select(`
        id,
        work_date,
        t_and_m_workers (*)
      `).eq("project_id",n).lt("work_date",l).order("work_date",{ascending:!1}).limit(1).maybeSingle();if(d||!o)return null;const m=o.t_and_m_workers||[],h=m.some(S=>S.labor_class_id),g={};h&&m.forEach(S=>{S.labor_class_id&&(g[S.labor_class_id]||(g[S.labor_class_id]=[]),g[S.labor_class_id].push({name:S.name,hours:S.hours?.toString()||"",overtimeHours:S.overtime_hours?.toString()||"",timeStarted:S.time_started||"",timeEnded:S.time_ended||""}))});const b=m.filter(S=>["Foreman","General Foreman","Superintendent"].includes(S.role)).map(S=>({name:S.name,hours:S.hours?.toString()||"",overtimeHours:S.overtime_hours?.toString()||"",timeStarted:S.time_started||"",timeEnded:S.time_ended||"",role:S.role})),k=m.filter(S=>S.role==="Operator").map(S=>({name:S.name,hours:S.hours?.toString()||"",overtimeHours:S.overtime_hours?.toString()||"",timeStarted:S.time_started||"",timeEnded:S.time_ended||""})),B=m.filter(S=>S.role==="Laborer").map(S=>({name:S.name,hours:S.hours?.toString()||"",overtimeHours:S.overtime_hours?.toString()||"",timeStarted:S.time_started||"",timeEnded:S.time_ended||""}));return{workDate:o.work_date,supervision:b.length>0?b:null,operators:k.length>0?k:null,laborers:B.length>0?B:null,dynamicWorkers:Object.keys(g).length>0?g:null,totalWorkers:m.length}},async updateTMTicketStatus(n,l){if(v){const{data:i,error:o}=await y.from("t_and_m_tickets").update({status:l}).eq("id",n).select().single();if(o)throw o;return i}return null},async approveTMTicket(n,l,i,o=null){if(v){const d={status:"approved",approved_by_user_id:l,approved_by_name:i,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};o!==null&&(d.change_order_value=parseFloat(o)||0);const{data:m,error:h}=await y.from("t_and_m_tickets").update(d).eq("id",n).select().single();if(h)throw h;return m}return null},async rejectTMTicket(n,l,i,o=""){if(v){const{data:d,error:m}=await y.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:l,rejected_by_name:i,rejected_at:new Date().toISOString(),rejection_reason:o,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",n).select().single();if(m)throw m;return d}return null},canApproveTickets(n){return["owner","admin","manager"].includes(n)},async updateTMTicketPhotos(n,l){if(v){const i=le();if(!i)throw new Error("Database client not available");const{data:o,error:d}=await i.from("t_and_m_tickets").update({photos:l}).eq("id",n).select().single();if(d)throw d;return o}return null},async saveTMClientSignature(n,l){if(v){const i=le();if(!i)throw new Error("Database client not available");const{data:o,error:d}=await i.from("t_and_m_tickets").update({client_signature_data:l.signature,client_signature_name:l.signerName,client_signature_title:l.signerTitle,client_signature_company:l.signerCompany,client_signature_date:l.signedAt,client_signature_ip:null,status:"client_signed"}).eq("id",n).select().single();if(d)throw d;return o}return null},async deleteTMTicket(n){if(v){const{error:l}=await y.from("t_and_m_tickets").delete().eq("id",n);if(l)throw l}},async isTicketEditable(n){if(!n?.assigned_cor_id)return{editable:!0};if(v)try{const{data:l,error:i}=await y.from("change_orders").select("id, status, cor_number").eq("id",n.assigned_cor_id).single();if(i||!l)return{editable:!0};const d=["draft","pending_approval"].includes(l.status);return{editable:d,lockedBy:d?null:l,reason:d?null:`This ticket is linked to ${l.cor_number} which has been ${l.status==="approved"?"approved":l.status}`}}catch(l){return console.error("Error checking ticket editability:",l),{editable:!0}}return{editable:!0}},async getCompanyByCode(n){if(v){const{data:l,error:i}=await y.from("companies").select("*").eq("code",n).single();return i?null:l}return null},async getCompany(n){if(v){const{data:l,error:i}=await y.from("companies").select("*").eq("id",n).single();if(i)throw i;return l}return null},async getUserCompanies(n){if(v){const{data:l,error:i}=await y.from("user_companies").select(`
          id,
          access_level,
          company_id,
          status,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",n).eq("status","active").order("created_at",{ascending:!0});return i?(console.error("Error fetching user companies:",i),[]):l.map(o=>({id:o.companies.id,name:o.companies.name,code:o.companies.code,access_level:o.access_level}))}return[]},async getUserPendingMemberships(n){if(v){const{count:l,error:i}=await y.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",n).eq("status","pending");return i?(console.error("Error fetching pending memberships:",i),0):l||0}return 0},async getCompanyMemberships(n){if(v){const{data:l,error:i}=await y.from("user_companies").select(`
          id,
          access_level,
          company_role,
          status,
          created_at,
          approved_at,
          approved_by,
          removed_at,
          removed_by,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",n).order("created_at",{ascending:!1});return i?(console.error("Error fetching company memberships:",i),[]):l||[]}return[]},async approveMembership(n,l){if(v){const{error:i}=await y.from("user_companies").update({status:"active",approved_at:new Date().toISOString(),approved_by:l}).eq("id",n);if(i)throw i}},async approveMembershipWithRole(n,l,i="member"){if(v){const{error:o}=await y.rpc("approve_membership_with_role",{membership_id:n,approved_by_user:l,new_access_level:i});if(o)throw o}},async rejectMembership(n){if(v){const{error:l}=await y.from("user_companies").delete().eq("id",n);if(l)throw l}},async removeMember(n,l){if(v){const{error:i}=await y.from("user_companies").update({status:"removed",removed_at:new Date().toISOString(),removed_by:l}).eq("id",n);if(i)throw i}},async getProjectTeam(n){if(v){const{data:l,error:i}=await y.from("project_users").select(`
          id,
          project_role,
          assigned_at,
          notes,
          users!project_users_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("project_id",n).order("assigned_at",{ascending:!0});return i?(console.error("Error fetching project team:",i),[]):l||[]}return[]},async getCompanyMembers(n){if(v){const{data:l,error:i}=await y.from("user_companies").select(`
          id,
          access_level,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",n).eq("status","active").order("created_at",{ascending:!0});return i?(console.error("Error fetching company members:",i),[]):l||[]}return[]},async addProjectMember(n,l,i,o){if(v){const{data:d,error:m}=await y.from("project_users").insert({project_id:n,user_id:l,project_role:i,assigned_by:o}).select().single();if(m)throw m;return d}return null},async updateProjectMemberRole(n,l,i){if(v){const{error:o}=await y.from("project_users").update({project_role:i}).eq("project_id",n).eq("user_id",l);if(o)throw o}},async removeProjectMember(n,l){if(v){const{error:i}=await y.from("project_users").delete().eq("project_id",n).eq("user_id",l);if(i)throw i}},async updateMemberAccessLevel(n,l){if(v){const{error:i}=await y.from("user_companies").update({access_level:l}).eq("id",n);if(i)throw i}},async updateMemberCompanyRole(n,l){if(v){const{error:i}=await y.from("user_companies").update({company_role:l}).eq("id",n);if(i)throw i}},async repairLegacyUser(n,l,i="member"){if(!v||!n||!l)return!1;try{const{data:o,error:d}=await y.rpc("repair_legacy_user",{p_user_id:n,p_company_id:l,p_role:i});return d?(console.error("RPC repair_legacy_user failed:",d),!1):o===!0}catch(o){return console.error("Error repairing legacy user:",o),!1}},async isLegacyUser(n){if(!v)return!1;try{const{data:l}=await y.from("users").select("company_id, role").eq("id",n).single();if(!l?.company_id)return!1;const{count:i}=await y.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",n);return i===0}catch(l){return console.error("Error checking legacy user:",l),!1}},DISPOSAL_LOAD_TYPES:[{value:"concrete",label:"Concrete"},{value:"trash",label:"Trash"},{value:"metals",label:"Metals"},{value:"hazardous_waste",label:"Hazardous Waste"}],async getDisposalLoads(n,l){if(!v)return[];const i=performance.now();try{const{data:o,error:d}=await y.from("disposal_loads").select("*").eq("project_id",n).eq("work_date",l).order("created_at",{ascending:!1}),m=Math.round(performance.now()-i);if(Ce.query("getDisposalLoads",{duration:m,rows:o?.length,project_id:n}),d)throw d;return o||[]}catch(o){throw Ce.error("database",{message:o.message,operation:"getDisposalLoads",project_id:n}),o}},async getDisposalLoadsHistory(n,l=14){if(!v)return[];const i=performance.now();try{const o=new Date,d=new Date;d.setDate(d.getDate()-l);const{data:m,error:h}=await y.from("disposal_loads").select("*").eq("project_id",n).gte("work_date",d.toISOString().split("T")[0]).lte("work_date",o.toISOString().split("T")[0]).order("work_date",{ascending:!1}),g=Math.round(performance.now()-i);if(Ce.query("getDisposalLoadsHistory",{duration:g,rows:m?.length,project_id:n}),h)throw h;return(m||[]).map(b=>({...b,load_date:b.work_date}))}catch(o){throw Ce.error("database",{message:o.message,operation:"getDisposalLoadsHistory",project_id:n}),o}},async addDisposalLoad(n,l,i,o,d,m=null){if(!v)return null;const{data:h,error:g}=await y.from("disposal_loads").insert({project_id:n,user_id:l,work_date:i,load_type:o,load_count:d,notes:m}).select().single();if(g)throw Ce.error("database",{message:g.message,operation:"addDisposalLoad",project_id:n}),g;return h},async updateDisposalLoad(n,l,i,o=null){if(!v)return null;const{data:d,error:m}=await y.from("disposal_loads").update({load_type:l,load_count:i,notes:o}).eq("id",n).select().single();if(m)throw Ce.error("database",{message:m.message,operation:"updateDisposalLoad"}),m;return d},async deleteDisposalLoad(n){if(!v)return!1;const{error:l}=await y.from("disposal_loads").delete().eq("id",n);if(l)throw Ce.error("database",{message:l.message,operation:"deleteDisposalLoad"}),l;return!0},async getDisposalSummary(n,l=null,i=null){if(!v)return[];const o=performance.now();try{const{data:d,error:m}=await y.rpc("get_disposal_summary",{p_project_id:n,p_start_date:l,p_end_date:i}),h=Math.round(performance.now()-o);if(Ce.query("getDisposalSummary",{duration:h,rows:d?.length,project_id:n}),m)throw m;return d||[]}catch(d){return Ce.error("database",{message:d.message,operation:"getDisposalSummary",project_id:n}),this.getDisposalSummaryFallback(n,l,i)}},async getDisposalSummaryFallback(n,l,i){let o=y.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",n);l&&(o=o.gte("work_date",l)),i&&(o=o.lte("work_date",i));const{data:d,error:m}=await o;if(m)throw m;const h={};return d?.forEach(g=>{h[g.load_type]||(h[g.load_type]={load_type:g.load_type,total_loads:0,days:new Set}),h[g.load_type].total_loads+=g.load_count,h[g.load_type].days.add(g.work_date)}),Object.values(h).map(g=>({load_type:g.load_type,total_loads:g.total_loads,days_with_activity:g.days.size}))},async getWeeklyDisposalSummary(n,l=4){if(!v)return[];const i=new Date,o=new Date;o.setDate(o.getDate()-l*7);const{data:d,error:m}=await y.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",n).gte("work_date",o.toISOString().split("T")[0]).lte("work_date",i.toISOString().split("T")[0]).order("work_date",{ascending:!0});if(m)throw m;const h={};return d?.forEach(g=>{const b=new Date(g.work_date),k=new Date(b);k.setDate(b.getDate()-b.getDay());const B=k.toISOString().split("T")[0];h[B]||(h[B]={week:B,concrete:0,trash:0,metals:0,hazardous_waste:0}),h[B][g.load_type]+=g.load_count}),Object.values(h).sort((g,b)=>g.week.localeCompare(b.week))},async uploadPhoto(n,l,i,o){if(!v)return null;const d=le();if(!d)throw new Error("Database client not available");const m=performance.now(),h=o.size||0,g=Date.now(),b=new Uint8Array(6);crypto.getRandomValues(b);const k=Array.from(b,te=>te.toString(36)).join(""),B=o.name?.split(".").pop()||"jpg",S=`${g}-${k}.${B}`,X=`${n}/${l}/${i}/${S}`;try{const{data:te,error:F}=await d.storage.from("tm-photos").upload(X,o,{cacheControl:"3600",upsert:!1}),Z=Math.round(performance.now()-m);if(Ce.storage("upload",{company_id:n,project_id:l,size:h,duration:Z,success:!F}),F)throw F;const{data:U}=d.storage.from("tm-photos").getPublicUrl(X);return U.publicUrl}catch(te){throw Ce.error("storage",{message:te.message,operation:"uploadPhoto",company_id:n,project_id:l}),te}},async uploadPhotoBase64(n,l,i,o,d="photo.jpg"){if(!v)return null;const m=le();if(!m)throw new Error("Database client not available");const g=await(await fetch(o)).blob(),b=Date.now(),k=new Uint8Array(6);crypto.getRandomValues(k);const B=Array.from(k,K=>K.toString(36)).join(""),S=d.split(".").pop()||"jpg",X=`${b}-${B}.${S}`,te=`${n}/${l}/${i}/${X}`,{data:F,error:Z}=await m.storage.from("tm-photos").upload(te,g,{cacheControl:"3600",upsert:!1,contentType:g.type});if(Z)throw Z;const{data:U}=m.storage.from("tm-photos").getPublicUrl(te);return U.publicUrl},async deletePhoto(n){if(!v)return;const i=new URL(n).pathname.match(/\/tm-photos\/(.+)$/);if(!i)return;const o=i[1],{error:d}=await y.storage.from("tm-photos").remove([o]);if(d)throw d},async verifyPhotoAccessible(n){if(!v||!n)return{accessible:!1,error:"Invalid URL"};try{const l=await fetch(n,{method:"HEAD"});return{accessible:l.ok,status:l.status,error:l.ok?null:`HTTP ${l.status}`}}catch(l){return{accessible:!1,error:l.message||"Network error"}}},async verifyTicketPhotos(n){if(!v)return{verified:!1,issues:[]};try{const{data:l,error:i}=await y.from("t_and_m_tickets").select("photos").eq("id",n).single();if(i)throw i;if(!l?.photos||l.photos.length===0)return await y.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:"empty",photos_issue_count:0}).eq("id",n),{verified:!0,status:"empty",issues:[]};const o=[];for(const m of l.photos){const h=await this.verifyPhotoAccessible(m);h.accessible||o.push({url:m,error:h.error})}const d=o.length===0?"verified":"issues";return await y.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:d,photos_issue_count:o.length}).eq("id",n),{verified:o.length===0,status:d,totalPhotos:l.photos.length,issues:o}}catch(l){return console.error("Error verifying ticket photos:",l),{verified:!1,error:l.message,issues:[]}}},async queuePhotoUpload(n,l,i,o){if(!v)return null;const{data:d,error:m}=await y.from("photo_upload_queue").insert({ticket_id:n,temp_id:l,file_name:i,file_size_bytes:o,status:"pending"}).select().single();return m?(console.error("Error queueing photo upload:",m),null):d},async confirmQueuedUpload(n,l,i){if(!v)return!1;const{data:o,error:d}=await y.rpc("confirm_photo_upload",{p_queue_id:n,p_uploaded_url:l,p_storage_path:i});return d?(console.error("Error confirming photo upload:",d),!1):o===!0},async markQueuedUploadFailed(n,l){if(!v)return!1;const{data:i,error:o}=await y.rpc("mark_photo_upload_failed",{p_queue_id:n,p_error:l});return o?(console.error("Error marking photo upload failed:",o),!1):i===!0},async getPendingPhotoUploads(n){if(!v)return[];const{data:l,error:i}=await y.rpc("get_pending_photo_uploads",{p_ticket_id:n});return i?(console.error("Error getting pending photo uploads:",i),[]):l||[]},async logPhotoOperation(n,l,i={}){if(v)try{await y.from("photo_audit_log").insert({ticket_id:n,cor_id:i.corId||null,operation:l,photo_url:i.photoUrl||null,storage_path:i.storagePath||null,details:i.metadata?i.metadata:null,error_message:i.error||null,triggered_by:i.triggeredBy||"system"})}catch(o){console.error("Error logging photo operation:",o)}},async saveExportSnapshot(n,l,i={}){if(!v)return null;const{exportType:o="pdf",exportReason:d=null,clientEmail:m=null,clientName:h=null}=i;try{const{data:g,error:b}=await y.from("cor_export_snapshots").insert({cor_id:n,export_type:o,export_reason:d,cor_data:l.cor_data,tickets_data:l.tickets_data,photos_manifest:l.photos_manifest,totals_snapshot:l.totals_snapshot,checksum:l.checksum,client_email:m,client_name:h}).select().single();if(b)throw b;return g}catch(g){return console.error("Error saving export snapshot:",g),null}},async getExportSnapshots(n){if(!v)return[];const{data:l,error:i}=await y.from("cor_export_snapshots").select("id, exported_at, export_type, export_reason, client_name, client_email, checksum").eq("cor_id",n).order("exported_at",{ascending:!1});return i?(console.error("Error fetching export snapshots:",i),[]):l||[]},async getExportSnapshot(n){if(!v)return null;const{data:l,error:i}=await y.from("cor_export_snapshots").select("*").eq("id",n).single();return i?(console.error("Error fetching export snapshot:",i),null):l},async requestCORExport(n,l,i={}){if(!v)return null;try{const o=await y.auth.getUser(),{data:d,error:m}=await y.rpc("request_cor_export",{p_cor_id:n,p_idempotency_key:l,p_options:i,p_requested_by:o?.data?.user?.id||null});if(m)throw m;return d?.[0]||null}catch(o){throw Ce.error("database",{message:o.message,operation:"requestCORExport",extra:{corId:n}}),o}},async getExportJob(n){if(!v)return null;const{data:l,error:i}=await y.from("cor_export_jobs").select("*").eq("id",n).single();return i?(console.error("Error fetching export job:",i),null):l},async getExportJobs(n,l=10){if(!v)return[];const{data:i,error:o}=await y.from("cor_export_jobs").select("*").eq("cor_id",n).order("created_at",{ascending:!1}).limit(l);return o?(console.error("Error fetching export jobs:",o),[]):i||[]},async updateExportJobStatus(n,l,i={}){if(!v)return null;try{const{data:o,error:d}=await y.rpc("update_export_job_status",{p_job_id:n,p_status:l,p_snapshot_id:i.snapshotId||null,p_pdf_url:i.pdfUrl||null,p_error:i.error||null,p_error_details:i.errorDetails||null,p_metrics:i.metrics||null});if(d)throw d;return o}catch(o){throw Ce.error("database",{message:o.message,operation:"updateExportJobStatus",extra:{jobId:n,status:l}}),o}},async getCurrentCORSnapshot(n){if(!v)return null;const{data:l}=await y.from("change_orders").select("version, last_snapshot_version").eq("id",n).single();if(!l||l.version!==l.last_snapshot_version)return null;const{data:i}=await y.from("cor_export_snapshots").select("*").eq("cor_id",n).eq("is_current",!0).single();return i||null},async saveCORSnapshot(n,l){if(!v)return null;try{await y.from("cor_export_snapshots").update({is_current:!1}).eq("cor_id",n.corId);const i=await y.auth.getUser(),{data:o,error:d}=await y.from("cor_export_snapshots").insert({id:n.snapshotId,cor_id:n.corId,job_id:l,cor_version:n.corVersion,cor_data:n.corData,tickets_data:n.ticketsData,photos_manifest:n.photoManifest,totals_snapshot:n.totals,checksum:n.checksum,is_current:!0,exported_by:i?.data?.user?.id||null}).select().single();if(d)throw d;return await y.from("change_orders").update({last_snapshot_version:n.corVersion}).eq("id",n.corId),o}catch(i){throw Ce.error("database",{message:i.message,operation:"saveCORSnapshot",extra:{corId:n.corId}}),i}},async updateCORAggregatedStats(n){if(v)try{await y.rpc("update_cor_aggregated_stats",{p_cor_id:n})}catch(l){console.error("Error updating COR aggregated stats:",l)}},async getCrewCheckin(n,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],o=le(),{data:d,error:m}=await o.from("crew_checkins").select("*").eq("project_id",n).eq("check_in_date",i).maybeSingle();return m&&console.error("Error fetching crew checkin:",m),d},async saveCrewCheckin(n,l,i=null,o=null){if(!v)return null;const d=o||new Date().toISOString().split("T")[0];if(!ga()){const b={id:Ft(),project_id:n,check_in_date:d,workers:l,created_by:i,updated_at:new Date().toISOString(),_offline:!0};return await bi(b),await na(xt.SAVE_CREW_CHECKIN,{projectId:n,workers:l,checkInDate:d}),b}const m=le();if(!m){const b={id:Ft(),project_id:n,check_in_date:d,workers:l,created_by:i,updated_at:new Date().toISOString(),_offline:!0};return await bi(b),await na(xt.SAVE_CREW_CHECKIN,{projectId:n,workers:l,checkInDate:d}),b}const{data:h,error:g}=await m.from("crew_checkins").upsert({project_id:n,check_in_date:d,workers:l,created_by:i,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(g){if(g.message?.includes("fetch")||g.message?.includes("network")){const b={id:Ft(),project_id:n,check_in_date:d,workers:l,_offline:!0};return await bi(b),await na(xt.SAVE_CREW_CHECKIN,{projectId:n,workers:l,checkInDate:d}),b}throw console.error("Error saving crew checkin:",g),g}return h&&bi(h).catch(b=>console.error("Failed to cache checkin:",b)),h},async addCrewMember(n,l,i=null){if(!v)return null;const o=await this.getCrewCheckin(n),d=o?.workers||[];return d.find(m=>m.name.toLowerCase()===l.name.toLowerCase())?o:(d.push(l),await this.saveCrewCheckin(n,d,i))},async removeCrewMember(n,l){if(!v)return null;const i=await this.getCrewCheckin(n);if(!i)return null;const o=i.workers.filter(d=>d.name.toLowerCase()!==l.toLowerCase());return await this.saveCrewCheckin(n,o,i.created_by)},async getCrewCheckinHistory(n,l=30){if(!v)return[];const{data:i,error:o}=await y.from("crew_checkins").select("*").eq("project_id",n).order("check_in_date",{ascending:!1}).limit(l);return o?(console.error("Error fetching crew history:",o),[]):i||[]},async getLaborRates(n,l=null,i=null){if(!v)return[];let o=y.from("labor_rates").select("*").eq("company_id",n);l&&(o=o.eq("work_type",l)),i&&(o=o.eq("job_type",i));const{data:d,error:m}=await o;return m?(console.error("Error fetching labor rates:",m),[]):d||[]},async calculateManDayCosts(n,l,i,o){if(!v)return{totalCost:0,totalManDays:0,breakdown:[]};const d=await this.getCrewCheckinHistory(n,365),m=await this.getLaborRates(l,i,o),h={};m.forEach(S=>{h[S.role.toLowerCase()]=parseFloat(S.regular_rate)||0});let g=0,b=0;const k={},B=[];return d.forEach(S=>{const X=S.workers||[];let te=0;const F={};X.forEach(Z=>{const U=(Z.role||"laborer").toLowerCase(),K=h[U]||0;F[U]||(F[U]={count:0,cost:0}),F[U].count++,F[U].cost+=K,te+=K,k[U]||(k[U]={count:0,cost:0,rate:K}),k[U].count++,k[U].cost+=K}),g+=te,b+=X.length,B.push({date:S.check_in_date,workers:X.length,cost:te,breakdown:F})}),{totalCost:g,totalManDays:b,byRole:k,byDate:B,daysWorked:d.length}},async getDailyReport(n,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],o=le(),{data:d,error:m}=await o.from("daily_reports").select("*").eq("project_id",n).eq("report_date",i).maybeSingle();return m&&console.error("Error fetching daily report:",m),d},async compileDailyReport(n,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],o=le(),[d,m,h]=await Promise.all([this.getCrewCheckin(n,i),o.from("areas").select("*").eq("project_id",n),o.from("t_and_m_tickets").select("*").eq("project_id",n).eq("work_date",i)]),g=m?.data||[],b=h?.data||[],k=g.filter(S=>S.status==="done"&&S.completed_at?.startsWith(i)),B=b.reduce((S,X)=>S+(X.photos?.length||0),0);return{crew_count:d?.workers?.length||0,crew_list:d?.workers||[],tasks_completed:k.length,tasks_total:g.length,completed_tasks:k.map(S=>({name:S.name,group:S.group_name})),tm_tickets_count:b.length,photos_count:B}},async saveDailyReport(n,l,i=null){if(!v)return null;const o=i||new Date().toISOString().split("T")[0];if(!ga()){const g={id:Ft(),project_id:n,report_date:o,...l,updated_at:new Date().toISOString(),_offline:!0};return await as(g),g}const d=le(),{data:m,error:h}=await d.from("daily_reports").upsert({project_id:n,report_date:o,...l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(h){if(h.message?.includes("fetch")||h.message?.includes("network")){const g={id:Ft(),project_id:n,report_date:o,...l,_offline:!0};return await as(g),g}throw console.error("Error saving daily report:",h),h}return m&&as(m).catch(g=>console.error("Failed to cache report:",g)),m},async submitDailyReport(n,l,i=null){if(!v)return null;const o=i||new Date().toISOString().split("T")[0];if(!ga()){const g=await h_(n,o),b={id:Ft(),project_id:n,report_date:o,...g||{},status:"pending_sync",submitted_by:l,submitted_at:new Date().toISOString(),_offline:!0};return await as(b),await na(xt.SUBMIT_DAILY_REPORT,{projectId:n,reportData:g||{},submittedBy:l}),b}const d=await this.compileDailyReport(n,o),{data:m,error:h}=await y.from("daily_reports").upsert({project_id:n,report_date:o,...d,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(h){if(h.message?.includes("fetch")||h.message?.includes("network")){const g={id:Ft(),project_id:n,report_date:o,...d,status:"pending_sync",submitted_by:l,_offline:!0};return await as(g),await na(xt.SUBMIT_DAILY_REPORT,{projectId:n,reportData:d,submittedBy:l}),g}throw console.error("Error submitting daily report:",h),h}return m&&as(m).catch(g=>console.error("Failed to cache report:",g)),m},async getDailyReports(n,l=30){if(!v)return[];const{data:i,error:o}=await y.from("daily_reports").select("*").eq("project_id",n).order("report_date",{ascending:!1}).limit(l);return o?(console.error("Error fetching daily reports:",o),[]):i||[]},async sendMessage(n,l,i,o,d=null,m=null,h="general",g=null){if(!v)return null;if(!ga()){const B={id:Ft(),project_id:n,sender_type:i,sender_name:o,sender_user_id:d,message:l,photo_url:m,message_type:h,parent_message_id:g,created_at:new Date().toISOString(),_offline:!0};return await If(B),await na(xt.SEND_MESSAGE,{projectId:n,senderType:i,senderName:o,content:l}),B}const{data:b,error:k}=await y.from("messages").insert({project_id:n,sender_type:i,sender_name:o,sender_user_id:d,message:l,photo_url:m,message_type:h,parent_message_id:g}).select().single();if(k){if(k.message?.includes("fetch")||k.message?.includes("network")){const B={id:Ft(),project_id:n,sender_type:i,sender_name:o,message:l,created_at:new Date().toISOString(),_offline:!0};return await If(B),await na(xt.SEND_MESSAGE,{projectId:n,senderType:i,senderName:o,content:l}),B}throw console.error("Error sending message:",k),k}return b},async getMessages(n,l=50){if(!v)return[];const i=le(),{data:o,error:d}=await i.from("messages").select("*").eq("project_id",n).order("created_at",{ascending:!1}).limit(l);return d?[]:o||[]},async getUnreadCount(n,l){if(!v)return 0;const i=le(),o=l==="field"?"office":"field",{count:d,error:m}=await i.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",n).eq("sender_type",o).eq("is_read",!1);return m?0:d||0},async markMessagesRead(n,l){if(!v)return;const i=le(),o=l==="field"?"office":"field";await i.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",n).eq("sender_type",o).eq("is_read",!1)},async createMaterialRequest(n,l,i,o=null,d="normal",m=null){if(!v)return null;if(!ga()){const b={id:Ft(),project_id:n,items:l,requested_by:i,needed_by:o,priority:d,notes:m,status:"pending_sync",created_at:new Date().toISOString(),_offline:!0};return await na(xt.CREATE_MATERIAL_REQUEST,{projectId:n,items:l,requestedBy:i,neededBy:o,priority:d,notes:m}),b}const{data:h,error:g}=await y.from("material_requests").insert({project_id:n,items:l,requested_by:i,needed_by:o,priority:d,notes:m}).select().single();if(g){if(g.message?.includes("fetch")||g.message?.includes("network")){const b={id:Ft(),project_id:n,items:l,requested_by:i,status:"pending_sync",_offline:!0};return await na(xt.CREATE_MATERIAL_REQUEST,{projectId:n,items:l,requestedBy:i,neededBy:o,priority:d,notes:m}),b}throw console.error("Error creating material request:",g),g}return h},async getMaterialRequests(n,l=null){if(!v)return[];let i=y.from("material_requests").select("*").eq("project_id",n).order("created_at",{ascending:!1});l&&(i=i.eq("status",l));const{data:o,error:d}=await i;return d?(console.error("Error fetching material requests:",d),[]):o||[]},async getPendingRequestsCount(n){if(!v)return 0;const{count:l,error:i}=await y.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",n).eq("status","pending");return i?0:l||0},async updateMaterialRequest(n,l,i,o=null,d=null){if(!v)return null;const m={status:l,responded_by:i,responded_at:new Date().toISOString(),response_notes:o,updated_at:new Date().toISOString()};d&&(m.expected_delivery=d),l==="delivered"&&(m.delivered_at=new Date().toISOString());const{data:h,error:g}=await y.from("material_requests").update(m).eq("id",n).select().single();if(g)throw console.error("Error updating material request:",g),g;return h},generateShareToken(){const n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",l=new Uint8Array(12);return crypto.getRandomValues(l),Array.from(l,i=>n[i%n.length]).join("")},async createProjectShare(n,l,i,o=null){if(!v){const b=ae();b.projectShares||(b.projectShares=[]);const k={id:crypto.randomUUID(),project_id:n,share_token:this.generateShareToken(),created_by:l,expires_at:o,is_active:!0,permissions:i,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return b.projectShares.push(k),De(b),k}const{data:d,error:m}=await y.rpc("generate_share_token");if(m)throw console.error("Error generating share token:",m),m;const{data:h,error:g}=await y.from("project_shares").insert({project_id:n,share_token:d,created_by:l,expires_at:o,permissions:i}).select().single();if(g)throw console.error("Error creating project share:",g),g;return h},async getShareByToken(n){if(!v){const o=ae();if(!o.projectShares)return null;const d=o.projectShares.find(m=>m.share_token===n&&m.is_active&&(!m.expires_at||new Date(m.expires_at)>new Date));return d&&(d.view_count++,d.last_viewed_at=new Date().toISOString(),De(o)),d}const{data:l,error:i}=await y.from("project_shares").select("*, projects(*)").eq("share_token",n).eq("is_active",!0).single();return i?(console.error("Error fetching share by token:",i),null):l.expires_at&&new Date(l.expires_at)<new Date?null:(await y.rpc("increment_share_view_count",{token:n}),l)},async getProjectShares(n){if(!v){const o=ae();return o.projectShares?o.projectShares.filter(d=>d.project_id===n):[]}const{data:l,error:i}=await y.from("project_shares").select("*, users(name, email)").eq("project_id",n).order("created_at",{ascending:!1});return i?(console.error("Error fetching project shares:",i),[]):l||[]},async updateProjectShare(n,l){if(!v){const d=ae();if(!d.projectShares)return null;const m=d.projectShares.findIndex(h=>h.id===n);return m===-1?null:(d.projectShares[m]={...d.projectShares[m],...l,updated_at:new Date().toISOString()},De(d),d.projectShares[m])}const{data:i,error:o}=await y.from("project_shares").update(l).eq("id",n).select().single();if(o)throw console.error("Error updating project share:",o),o;return i},async revokeProjectShare(n){return this.updateProjectShare(n,{is_active:!1})},async deleteProjectShare(n){if(!v){const i=ae();if(!i.projectShares)return;i.projectShares=i.projectShares.filter(o=>o.id!==n),De(i);return}const{error:l}=await y.from("project_shares").delete().eq("id",n);if(l)throw console.error("Error deleting project share:",l),l},async getPublicProjectData(n){const l=await this.getShareByToken(n);if(!l)return null;const i=l.project_id||l.projects?.id;if(!v){const m=ae(),h=m.projects.find(S=>S.id===i);if(!h)return null;const g=m.areas.filter(S=>S.project_id===i),b=g.reduce((S,X)=>S+parseFloat(X.weight||0),0),k=g.filter(S=>S.status==="done").reduce((S,X)=>S+parseFloat(X.weight||0),0),B=b>0?Math.round(k/b*100):0;return{share:l,project:h,progress:B,areas:l.permissions.progress?g:[],photos:[],dailyReports:[],tmTickets:[]}}const o=l.projects||await this.getProject(i);if(!o)return null;const d={share:l,project:o,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(l.permissions.progress){d.areas=await this.getAreas(i);const m=d.areas.reduce((g,b)=>g+parseFloat(b.weight||0),0),h=d.areas.filter(g=>g.status==="done").reduce((g,b)=>g+parseFloat(b.weight||0),0);d.progress=m>0?Math.round(h/m*100):0}if(l.permissions.photos){const{data:m}=await y.from("t_and_m_tickets").select("photos, work_date").eq("project_id",i).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);d.photos=m?.flatMap(h=>(h.photos||[]).map(g=>({url:g,date:h.work_date})))||[]}if(l.permissions.daily_reports){const{data:m}=await y.from("daily_reports").select("*").eq("project_id",i).order("report_date",{ascending:!1}).limit(10);d.dailyReports=m||[]}return l.permissions.tm_tickets&&(d.tmTickets=await this.getTMTickets(i)),d},async createInjuryReport(n){if(!v){const o=ae();o.injuryReports||(o.injuryReports=[]);const d={id:crypto.randomUUID(),...n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return o.injuryReports.push(d),De(o),d}const{data:l,error:i}=await y.from("injury_reports").insert(n).select().single();if(i)throw console.error("Error creating injury report:",i),i;return l},async getInjuryReports(n){if(!v){const o=ae();return o.injuryReports?o.injuryReports.filter(d=>d.project_id===n).sort((d,m)=>new Date(m.incident_date)-new Date(d.incident_date)):[]}const{data:l,error:i}=await y.from("injury_reports").select("*").eq("project_id",n).order("incident_date",{ascending:!1});return i?(console.error("Error fetching injury reports:",i),[]):l||[]},async getCompanyInjuryReports(n,l=null){if(!v){const m=ae();if(!m.injuryReports)return[];let h=m.injuryReports.filter(g=>g.company_id===n);return l&&(h=h.filter(g=>g.status===l)),h.sort((g,b)=>new Date(b.incident_date)-new Date(g.incident_date))}let i=y.from("injury_reports").select("*, projects(name)").eq("company_id",n).order("incident_date",{ascending:!1});l&&(i=i.eq("status",l));const{data:o,error:d}=await i;return d?(console.error("Error fetching company injury reports:",d),[]):o||[]},async getInjuryReport(n){if(!v){const o=ae();return o.injuryReports?o.injuryReports.find(d=>d.id===n):null}const{data:l,error:i}=await y.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",n).single();return i?(console.error("Error fetching injury report:",i),null):l},async updateInjuryReport(n,l){if(!v){const d=ae();if(!d.injuryReports)return null;const m=d.injuryReports.findIndex(h=>h.id===n);return m===-1?null:(d.injuryReports[m]={...d.injuryReports[m],...l,updated_at:new Date().toISOString()},De(d),d.injuryReports[m])}const{data:i,error:o}=await y.from("injury_reports").update(l).eq("id",n).select().single();if(o)throw console.error("Error updating injury report:",o),o;return i},async closeInjuryReport(n,l){return this.updateInjuryReport(n,{status:"closed",closed_at:new Date().toISOString(),closed_by:l})},async deleteInjuryReport(n){if(!v){const i=ae();if(!i.injuryReports)return;i.injuryReports=i.injuryReports.filter(o=>o.id!==n),De(i);return}const{error:l}=await y.from("injury_reports").delete().eq("id",n);if(l)throw console.error("Error deleting injury report:",l),l},async getInjuryStatistics(n,l=null,i=null){if(!v){const m=ae();if(!m.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let h=m.injuryReports.filter(g=>g.company_id===n);return l&&(h=h.filter(g=>new Date(g.incident_date)>=new Date(l))),i&&(h=h.filter(g=>new Date(g.incident_date)<=new Date(i))),{total_incidents:h.length,minor_injuries:h.filter(g=>g.injury_type==="minor").length,serious_injuries:h.filter(g=>g.injury_type==="serious").length,critical_injuries:h.filter(g=>g.injury_type==="critical").length,near_misses:h.filter(g=>g.injury_type==="near_miss").length,osha_recordable:h.filter(g=>g.osha_recordable).length,total_days_away:h.reduce((g,b)=>g+(b.days_away_from_work||0),0),total_restricted_days:h.reduce((g,b)=>g+(b.restricted_work_days||0),0)}}const{data:o,error:d}=await y.rpc("get_injury_statistics",{comp_id:n,start_date:l,end_date:i});return d?(console.error("Error fetching injury statistics:",d),null):o[0]||null},async addWitness(n,l){if(!v){const d=ae();if(!d.injuryReports)return null;const m=d.injuryReports.findIndex(b=>b.id===n);if(m===-1)return null;const h=d.injuryReports[m],g=h.witnesses||[];return g.push(l),d.injuryReports[m]={...h,witnesses:g,updated_at:new Date().toISOString()},De(d),d.injuryReports[m]}const i=await this.getInjuryReport(n);if(!i)return null;const o=i.witnesses||[];return o.push(l),this.updateInjuryReport(n,{witnesses:o})},async removeWitness(n,l){if(!v){const d=ae();if(!d.injuryReports)return null;const m=d.injuryReports.findIndex(b=>b.id===n);if(m===-1)return null;const h=d.injuryReports[m],g=h.witnesses||[];return g.splice(l,1),d.injuryReports[m]={...h,witnesses:g,updated_at:new Date().toISOString()},De(d),d.injuryReports[m]}const i=await this.getInjuryReport(n);if(!i)return null;const o=i.witnesses||[];return o.splice(l,1),this.updateInjuryReport(n,{witnesses:o})},async getCompanyUsers(n){if(v){const{data:l,error:i}=await y.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",n);return i?(console.error("Error fetching company users:",i),[]):l?.map(o=>({id:o.user_id,name:o.users?.name||o.users?.email,email:o.users?.email,role:o.role}))||[]}return[]},async getProjectNotificationPreferences(n){if(v){const{data:i,error:o}=await y.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",n);return o?(console.error("Error fetching notification preferences:",o),[]):i||[]}const l=ae();return l.notificationPreferences?l.notificationPreferences.filter(i=>i.project_id===n):[]},async getUserNotificationPreferences(n){if(v){const{data:i,error:o}=await y.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",n);return o?(console.error("Error fetching user notification preferences:",o),[]):i||[]}const l=ae();return l.notificationPreferences?l.notificationPreferences.filter(i=>i.user_id===n):[]},async setNotificationPreference(n,l,i){if(v){const{data:h,error:g}=await y.from("notification_preferences").upsert({project_id:n,user_id:l,notification_types:i,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(g)throw console.error("Error setting notification preference:",g),g;return h}const o=ae();o.notificationPreferences||(o.notificationPreferences=[]);const d=o.notificationPreferences.findIndex(h=>h.project_id===n&&h.user_id===l),m={id:d>=0?o.notificationPreferences[d].id:crypto.randomUUID(),project_id:n,user_id:l,notification_types:i,created_at:d>=0?o.notificationPreferences[d].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return d>=0?o.notificationPreferences[d]=m:o.notificationPreferences.push(m),De(o),m},async removeNotificationPreference(n,l){if(v){const{error:o}=await y.from("notification_preferences").delete().eq("project_id",n).eq("user_id",l);if(o)throw console.error("Error removing notification preference:",o),o;return!0}const i=ae();return i.notificationPreferences&&(i.notificationPreferences=i.notificationPreferences.filter(o=>!(o.project_id===n&&o.user_id===l)),De(i)),!0},async setProjectNotificationPreferences(n,l){const i=[];for(const o of l)if(o.notificationTypes&&o.notificationTypes.length>0){const d=await this.setNotificationPreference(n,o.userId,o.notificationTypes);i.push(d)}else await this.removeNotificationPreference(n,o.userId);return i},async getNotificationPresets(n){if(v){const{data:i,error:o}=await y.from("notification_presets").select("*").eq("company_id",n).order("name");return o?(console.error("Error fetching notification presets:",o),[]):i||[]}const l=ae();return l.notificationPresets?l.notificationPresets.filter(i=>i.company_id===n):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:n},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:n},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:n},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:n}]},async createNotificationPreset(n,l,i){if(v){const{data:m,error:h}=await y.from("notification_presets").insert({company_id:n,name:l,notification_types:i}).select().single();if(h)throw console.error("Error creating notification preset:",h),h;return m}const o=ae();o.notificationPresets||(o.notificationPresets=[]);const d={id:crypto.randomUUID(),company_id:n,name:l,notification_types:i,created_at:new Date().toISOString()};return o.notificationPresets.push(d),De(o),d},async updateNotificationPreset(n,l,i){if(v){const{data:m,error:h}=await y.from("notification_presets").update({name:l,notification_types:i,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(h)throw console.error("Error updating notification preset:",h),h;return m}const o=ae();if(!o.notificationPresets)return null;const d=o.notificationPresets.findIndex(m=>m.id===n);return d===-1?null:(o.notificationPresets[d]={...o.notificationPresets[d],name:l,notification_types:i,updated_at:new Date().toISOString()},De(o),o.notificationPresets[d])},async deleteNotificationPreset(n){if(v){const{error:i}=await y.from("notification_presets").delete().eq("id",n);if(i)throw console.error("Error deleting notification preset:",i),i;return!0}const l=ae();return l.notificationPresets&&(l.notificationPresets=l.notificationPresets.filter(i=>i.id!==n),De(l)),!0},async getDumpSites(n){if(v){const{data:i,error:o}=await y.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",n).eq("active",!0).order("name");return o?(console.error("Error fetching dump sites:",o),[]):i||[]}return(ae().dumpSites||[]).filter(i=>i.company_id===n&&i.active)},async createDumpSite(n,l,i="",o=""){if(v){const{data:h,error:g}=await y.from("dump_sites").insert({company_id:n,name:l,address:i,notes:o,active:!0}).select().single();if(g)throw console.error("Error creating dump site:",g),g;return h}const d=ae();d.dumpSites||(d.dumpSites=[]);const m={id:crypto.randomUUID(),company_id:n,name:l,address:i,notes:o,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return d.dumpSites.push(m),De(d),m},async updateDumpSite(n,l){if(v){const{data:d,error:m}=await y.from("dump_sites").update({...l,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(m)throw console.error("Error updating dump site:",m),m;return d}const i=ae();if(!i.dumpSites)return null;const o=i.dumpSites.findIndex(d=>d.id===n);return o===-1?null:(i.dumpSites[o]={...i.dumpSites[o],...l},De(i),i.dumpSites[o])},async deleteDumpSite(n){return this.updateDumpSite(n,{active:!1})},async setDumpSiteRate(n,l,i,o="load"){if(v){const{data:g}=await y.from("dump_site_rates").select("id").eq("dump_site_id",n).eq("waste_type",l).maybeSingle();if(g){const{data:b,error:k}=await y.from("dump_site_rates").update({estimated_cost_per_load:i,unit:o}).eq("id",g.id).select().single();if(k)throw console.error("Error updating dump site rate:",k),k;return b}else{const{data:b,error:k}=await y.from("dump_site_rates").insert({dump_site_id:n,waste_type:l,estimated_cost_per_load:i,unit:o}).select().single();if(k)throw console.error("Error inserting dump site rate:",k),k;return b}}const d=ae();d.dumpSiteRates||(d.dumpSiteRates=[]);const m=d.dumpSiteRates.findIndex(g=>g.dump_site_id===n&&g.waste_type===l),h={id:m>=0?d.dumpSiteRates[m].id:crypto.randomUUID(),dump_site_id:n,waste_type:l,estimated_cost_per_load:i,unit:o,created_at:new Date().toISOString()};return m>=0?d.dumpSiteRates[m]=h:d.dumpSiteRates.push(h),De(d),h},async getDumpSiteRates(n){if(v){const{data:i,error:o}=await y.from("dump_site_rates").select("*").eq("dump_site_id",n);return o?(console.error("Error fetching dump site rates:",o),[]):i||[]}return(ae().dumpSiteRates||[]).filter(i=>i.dump_site_id===n)},async getHaulOffs(n){if(v){const{data:i,error:o}=await y.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",n).order("work_date",{ascending:!1});return o?(console.error("Error fetching haul-offs:",o),[]):i||[]}return(ae().haulOffs||[]).filter(i=>i.project_id===n).sort((i,o)=>new Date(o.work_date)-new Date(i.work_date))},async createHaulOff(n,l){const i={project_id:n,dump_site_id:l.dumpSiteId,waste_type:l.wasteType,loads:l.loads,hauling_company:l.haulingCompany||"",work_date:l.workDate,notes:l.notes||"",estimated_cost:l.estimatedCost||0,created_by:l.createdBy||""};if(v){const{data:m,error:h}=await y.from("haul_offs").insert(i).select().single();if(h)throw console.error("Error creating haul-off:",h),h;return m}const o=ae();o.haulOffs||(o.haulOffs=[]);const d={...i,id:crypto.randomUUID(),created_at:new Date().toISOString()};return o.haulOffs.push(d),De(o),d},async calculateHaulOffCosts(n){const l=await this.getHaulOffs(n);let i=0,o=0;const d={},m=[],h={};l.forEach(b=>{const k=parseFloat(b.estimated_cost)||0,B=parseInt(b.loads)||0;i+=k,o+=B,d[b.waste_type]||(d[b.waste_type]={loads:0,cost:0}),d[b.waste_type].loads+=B,d[b.waste_type].cost+=k,h[b.work_date]||(h[b.work_date]={date:b.work_date,loads:0,cost:0}),h[b.work_date].loads+=B,h[b.work_date].cost+=k}),Object.values(h).sort((b,k)=>new Date(k.date)-new Date(b.date)).forEach(b=>m.push(b));const g=m.length;return{totalCost:i,totalLoads:o,byWasteType:d,byDate:m,daysWithHaulOff:g,avgDailyHaulOffCost:g>0?i/g:0}},subscribeToHaulOffs(n,l){return v?y.channel(`haul_offs:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${n}`},l).subscribe():null},async createCOR(n,l=0){if(v){let i=n.cor_number;l>0&&(i=await this.getNextCORNumber(n.project_id));const{data:o,error:d}=await y.from("change_orders").insert({company_id:n.company_id,project_id:n.project_id,area_id:n.area_id||null,cor_number:i,title:n.title,description:n.description||"",scope_of_work:n.scope_of_work,period_start:n.period_start,period_end:n.period_end,status:"draft",labor_markup_percent:n.labor_markup_percent??1500,materials_markup_percent:n.materials_markup_percent??1500,equipment_markup_percent:n.equipment_markup_percent??1500,subcontractors_markup_percent:n.subcontractors_markup_percent??500,liability_insurance_percent:n.liability_insurance_percent??144,bond_percent:n.bond_percent??100,license_fee_percent:n.license_fee_percent??10,created_by:n.created_by||null}).select().single();if((d?.code==="23505"||d?.code==="PGRST116"||d?.status===409||d?.message?.includes("duplicate")||d?.message?.includes("unique_cor_number"))&&l<3)return console.warn(`COR number conflict, retrying with fresh number (attempt ${l+1})`),this.createCOR(n,l+1);if(d)throw d;return o}return null},async updateCOR(n,l){if(v){const{data:i,error:o}=await y.from("change_orders").update({...l,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(o)throw o;return i}return null},async deleteCOR(n){if(v){const{error:l}=await y.from("change_orders").delete().eq("id",n);if(l)throw l}},async bulkUpdateCORGroup(n,l){if(v){const{error:i}=await y.from("change_orders").update({group_name:l,updated_at:new Date().toISOString()}).in("id",n);if(i)throw i.message?.includes("group_name")||i.code==="PGRST204"?new Error("COR grouping requires a database migration. Please run database/migration_cor_enhancements.sql in Supabase SQL Editor."):i}},async getCORs(n,l={}){if(v){let i=y.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",n);l.status&&(i=i.eq("status",l.status)),l.area_id&&(i=i.eq("area_id",l.area_id)),l.date_start&&(i=i.gte("period_start",l.date_start)),l.date_end&&(i=i.lte("period_end",l.date_end)),i=i.order("created_at",{ascending:!1});const{data:o,error:d}=await i;if(d)throw d;return o}return[]},async getCORById(n){if(v){const{data:l,error:i}=await y.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              *,
              t_and_m_workers (*),
              t_and_m_items (
                *,
                materials_equipment (name, unit, cost_per_unit, category)
              )
            )
          )
        `).eq("id",n).single();if(i)throw i;return l}return null},async getCORsByArea(n,l){if(v){const{data:i,error:o}=await y.from("change_orders").select("*").eq("project_id",n).eq("area_id",l).order("created_at",{ascending:!1});if(o)throw o;return i}return[]},async getAssignableCORs(n){if(v){const l=le();if(!l)return[];const{data:i,error:o}=await l.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",n).in("status",["draft","pending_approval","approved"]).order("cor_number",{ascending:!0});if(o)throw o;return i||[]}return[]},async getNextCORNumber(n){if(v){const{data:l,error:i}=await y.from("change_orders").select("cor_number").eq("project_id",n);if(i)throw i;if(l&&l.length>0){let o=0;for(const d of l){const m=d.cor_number?.match(/COR #(\d+)/);if(m){const h=parseInt(m[1]);h>o&&(o=h)}}return`COR #${o+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(n,l){if(v){const i=Math.round(l.regular_hours*l.regular_rate),o=Math.round(l.overtime_hours*l.overtime_rate),d=i+o,{data:m,error:h}=await y.from("change_order_labor").insert({change_order_id:n,labor_class:l.labor_class,wage_type:l.wage_type||"standard",regular_hours:l.regular_hours||0,overtime_hours:l.overtime_hours||0,regular_rate:l.regular_rate||0,overtime_rate:l.overtime_rate||0,regular_total:i,overtime_total:o,total:d,sort_order:l.sort_order||0,source_ticket_id:l.source_ticket_id||null}).select().single();if(h)throw h;return m}return null},async updateCORLaborItem(n,l){if(v){let i={...l};if(l.regular_hours!==void 0||l.regular_rate!==void 0||l.overtime_hours!==void 0||l.overtime_rate!==void 0){const{data:m}=await y.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",n).single(),h=l.regular_hours??m?.regular_hours??0,g=l.overtime_hours??m?.overtime_hours??0,b=l.regular_rate??m?.regular_rate??0,k=l.overtime_rate??m?.overtime_rate??0;i.regular_total=Math.round(h*b),i.overtime_total=Math.round(g*k),i.total=i.regular_total+i.overtime_total}const{data:o,error:d}=await y.from("change_order_labor").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async deleteCORLaborItem(n){if(v){const{error:l}=await y.from("change_order_labor").delete().eq("id",n);if(l)throw l}},async addCORMaterialItem(n,l){if(v){const o=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",d=Math.round(Number(l.unit_cost)||0),m=Number(l.quantity)||1,h=Math.round(m*d),{data:g,error:b}=await y.from("change_order_materials").insert({change_order_id:n,description:l.description||"",quantity:m,unit:l.unit||"each",unit_cost:d,total:h,source_type:o,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(b)throw b;return g}return null},async updateCORMaterialItem(n,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await y.from("change_order_materials").select("quantity, unit_cost").eq("id",n).single(),h=l.quantity??m?.quantity??1,g=l.unit_cost??m?.unit_cost??0;i.total=Math.round(h*g)}const{data:o,error:d}=await y.from("change_order_materials").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async deleteCORMaterialItem(n){if(v){const{error:l}=await y.from("change_order_materials").delete().eq("id",n);if(l)throw l}},async addCOREquipmentItem(n,l){if(v){const o=["backup_sheet","invoice","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",d=Math.round(Number(l.unit_cost)||0),m=Number(l.quantity)||1,h=Math.round(m*d),{data:g,error:b}=await y.from("change_order_equipment").insert({change_order_id:n,description:l.description||"",quantity:m,unit:l.unit||"day",unit_cost:d,total:h,source_type:o,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(b)throw b;return g}return null},async updateCOREquipmentItem(n,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await y.from("change_order_equipment").select("quantity, unit_cost").eq("id",n).single(),h=l.quantity??m?.quantity??1,g=l.unit_cost??m?.unit_cost??0;i.total=Math.round(h*g)}const{data:o,error:d}=await y.from("change_order_equipment").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async deleteCOREquipmentItem(n){if(v){const{error:l}=await y.from("change_order_equipment").delete().eq("id",n);if(l)throw l}},async addCORSubcontractorItem(n,l){if(v){const i=Math.round(l.quantity*l.unit_cost),{data:o,error:d}=await y.from("change_order_subcontractors").insert({change_order_id:n,description:l.description,quantity:l.quantity||1,unit:l.unit||"lump sum",unit_cost:l.unit_cost||0,total:i,source_type:l.source_type||"custom",source_reference:l.source_reference||null,sort_order:l.sort_order||0}).select().single();if(d)throw d;return o}return null},async updateCORSubcontractorItem(n,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await y.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",n).single(),h=l.quantity??m?.quantity??1,g=l.unit_cost??m?.unit_cost??0;i.total=Math.round(h*g)}const{data:o,error:d}=await y.from("change_order_subcontractors").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async deleteCORSubcontractorItem(n){if(v){const{error:l}=await y.from("change_order_subcontractors").delete().eq("id",n);if(l)throw l}},async addBulkLaborItems(n,l){if(v&&l.length>0){const i=le();if(!i)throw new Error("Database client not available");const o=l.map((h,g)=>{const b=Math.round(h.regular_hours*h.regular_rate),k=Math.round(h.overtime_hours*h.overtime_rate);return{change_order_id:n,labor_class:h.labor_class,wage_type:h.wage_type||"standard",regular_hours:h.regular_hours||0,overtime_hours:h.overtime_hours||0,regular_rate:h.regular_rate||0,overtime_rate:h.overtime_rate||0,regular_total:b,overtime_total:k,total:b+k,sort_order:h.sort_order??g,source_ticket_id:h.source_ticket_id||null}}),{data:d,error:m}=await i.from("change_order_labor").insert(o).select();if(m)throw m;return d}return[]},async addBulkMaterialItems(n,l){if(v&&l.length>0){const i=le();if(!i)throw new Error("Database client not available");const o=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"],d=l.map((g,b)=>{const k=o.includes(g.source_type)?g.source_type:"custom",B=Math.round(Number(g.unit_cost)||0),S=Number(g.quantity)||1;return{change_order_id:n,description:g.description||"",quantity:S,unit:g.unit||"each",unit_cost:B,total:Math.round(S*B),source_type:k,source_reference:g.source_reference||null,source_ticket_id:g.source_ticket_id||null,sort_order:g.sort_order??b}}),{data:m,error:h}=await i.from("change_order_materials").insert(d).select();if(h)throw h;return m}return[]},async addBulkEquipmentItems(n,l){if(v&&l.length>0){const i=le();if(!i)throw new Error("Database client not available");const o=["backup_sheet","invoice","custom","field_ticket","rental"],d=l.map((g,b)=>{const k=o.includes(g.source_type)?g.source_type:"custom",B=Math.round(Number(g.unit_cost)||0),S=Number(g.quantity)||1;return{change_order_id:n,description:g.description||"",quantity:S,unit:g.unit||"day",unit_cost:B,total:Math.round(S*B),source_type:k,source_reference:g.source_reference||null,source_ticket_id:g.source_ticket_id||null,sort_order:g.sort_order??b}}),{data:m,error:h}=await i.from("change_order_equipment").insert(d).select();if(h)throw h;return m}return[]},async addBulkSubcontractorItems(n,l){if(v&&l.length>0){const i=le();if(!i)throw new Error("Database client not available");const o=l.map((h,g)=>({change_order_id:n,company_name:h.company_name||"",description:h.description||"",quantity:h.quantity||1,unit:h.unit||"lump sum",unit_cost:h.unit_cost||h.total||h.amount||0,total:h.total||h.amount||0,source_type:h.source_type||"invoice",source_reference:h.source_reference||null,sort_order:h.sort_order??g})),{data:d,error:m}=await i.from("change_order_subcontractors").insert(o).select();if(m)throw m;return d}return[]},async clearCORLineItems(n){if(!v)return;const l=le();if(!l)throw new Error("Database client not available");try{const i=await Promise.all([l.from("change_order_labor").delete().eq("change_order_id",n),l.from("change_order_materials").delete().eq("change_order_id",n),l.from("change_order_equipment").delete().eq("change_order_id",n),l.from("change_order_subcontractors").delete().eq("change_order_id",n)]);for(const o of i)if(o.error)throw o.error}catch(i){throw console.error("Error clearing COR line items:",i),i}},async saveCORLineItems(n,{laborItems:l,materialItems:i,equipmentItems:o,subcontractorItems:d}){if(v){await this.clearCORLineItems(n);const m=await Promise.all([l?.length>0?this.addBulkLaborItems(n,l):[],i?.length>0?this.addBulkMaterialItems(n,i):[],o?.length>0?this.addBulkEquipmentItems(n,o):[],d?.length>0?this.addBulkSubcontractorItems(n,d):[]]);return{labor:m[0],materials:m[1],equipment:m[2],subcontractors:m[3]}}return null},async assignTicketToCOR(n,l){if(v){const{error:i}=await y.rpc("assign_ticket_to_cor",{p_ticket_id:n,p_cor_id:l});if(i)throw Ce.error("database",{message:i.message,operation:"assignTicketToCOR",extra:{ticketId:n,corId:l}}),i;return{ticket_id:n,change_order_id:l}}return null},async unassignTicketFromCOR(n,l){if(v){const{error:i}=await y.rpc("unassign_ticket_from_cor",{p_ticket_id:n,p_cor_id:l});if(i)throw Ce.error("database",{message:i.message,operation:"unassignTicketFromCOR",extra:{ticketId:n,corId:l}}),i}},async checkTicketCORIntegrity(){if(v){const{data:n,error:l}=await y.rpc("check_ticket_cor_integrity");if(l)throw l;return n||[]}return[]},async fixTicketCORIntegrity(){if(v){const{data:n,error:l}=await y.rpc("fix_ticket_cor_integrity");if(l)throw l;return n}return 0},async getTicketsForCOR(n){if(v){const{data:l,error:i}=await y.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",n);if(i)throw i;return l}return[]},async getUnassignedTickets(n){if(v){const{data:l,error:i}=await y.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",n).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(i)throw i;return l}return[]},async importTicketDataToCOR(n,l,i,o,d){if(v){const m=le();if(!m)throw new Error("Database client not available");const{data:h,error:g}=await m.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",n).single();if(g)throw g;const{data:b,error:k}=await m.from("labor_rates").select("*").eq("company_id",i).eq("work_type",o||"demolition").eq("job_type",d||"standard");if(k)throw k;const B={};b?.forEach(U=>{B[U.role.toLowerCase()]=U});const S={};h.t_and_m_workers?.forEach(U=>{const K=(U.role||"laborer").toLowerCase();S[K]||(S[K]={regular_hours:0,overtime_hours:0}),S[K].regular_hours+=parseFloat(U.hours)||0,S[K].overtime_hours+=parseFloat(U.overtime_hours)||0});const X=Object.entries(S).map(([U,K])=>{const ne=B[U]||{regular_rate:0,overtime_rate:0},ie=Math.round((parseFloat(ne.regular_rate)||0)*100),me=Math.round((parseFloat(ne.overtime_rate)||0)*100);return{labor_class:U.charAt(0).toUpperCase()+U.slice(1),wage_type:d||"standard",regular_hours:K.regular_hours,overtime_hours:K.overtime_hours,regular_rate:ie,overtime_rate:me,source_ticket_id:n}});X.length>0&&await this.addBulkLaborItems(l,X);const te=[],F=[];h.t_and_m_items?.forEach(U=>{const K=U.custom_name||U.materials_equipment?.name||"Unknown Item",ne=U.custom_category||U.materials_equipment?.category||"Other",ie=U.materials_equipment?.unit||"each",me=Math.round((parseFloat(U.materials_equipment?.cost_per_unit)||0)*100),be={description:K,quantity:U.quantity||1,unit:ie,unit_cost:me,source_type:"backup_sheet",source_ticket_id:n};ne==="Equipment"?F.push(be):te.push(be)}),te.length>0&&await this.addBulkMaterialItems(l,te),F.length>0&&await this.addBulkEquipmentItems(l,F);const{error:Z}=await m.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString(),import_status:"completed",import_failed_at:null,import_error:null}).eq("change_order_id",l).eq("ticket_id",n);if(Z)throw Z;return Ce.activity("cor_import_success",{ticket_id:n,cor_id:l,labor_count:X.length,material_count:te.length,equipment_count:F.length}),{laborItems:X,materialItems:te,equipmentItems:F}}return null},async reimportTicketDataToCOR(n,l,i,o,d){if(v){const m=le();if(!m)throw new Error("Database client not available");return await m.from("change_order_labor").delete().eq("change_order_id",l).eq("source_ticket_id",n),await m.from("change_order_materials").delete().eq("change_order_id",l).eq("source_ticket_id",n),await m.from("change_order_equipment").delete().eq("change_order_id",l).eq("source_ticket_id",n),this.importTicketDataToCOR(n,l,i,o,d)}return null},async markImportFailed(n,l,i="Import failed"){if(v){const o=le();if(!o)throw new Error("Database client not available");const{error:d}=await o.from("change_order_ticket_associations").update({import_status:"failed",import_failed_at:new Date().toISOString(),import_error:i}).eq("change_order_id",l).eq("ticket_id",n);if(d)throw Ce.error("database",{message:d.message,operation:"markImportFailed",extra:{ticketId:n,corId:l}}),d;Ce.error("cor_import_failed",{ticket_id:n,cor_id:l,error:i})}},async getTicketsNeedingImport(n){if(v){const{data:l,error:i}=await y.from("t_and_m_tickets").select(`
          id,
          work_date,
          ce_pco_number,
          assigned_cor_id,
          change_order_ticket_associations!inner (
            change_order_id,
            import_status,
            import_failed_at,
            import_error
          )
        `).eq("project_id",n).eq("change_order_ticket_associations.import_status","failed");if(i)throw i;return l||[]}return[]},async getTicketImportStatus(n,l){if(v){const{data:i,error:o}=await y.from("change_order_ticket_associations").select("import_status, import_failed_at, import_error, data_imported").eq("ticket_id",n).eq("change_order_id",l).single();if(o&&o.code!=="PGRST116")throw o;return i}return null},async recalculateCOR(n){if(v){const{error:l}=await y.rpc("recalculate_cor_totals",{cor_id:n});if(l)throw l;return this.getCORById(n)}return null},async updateCORMarkupPercentages(n,l){if(v){const i={};l.labor!==void 0&&(i.labor_markup_percent=l.labor),l.materials!==void 0&&(i.materials_markup_percent=l.materials),l.equipment!==void 0&&(i.equipment_markup_percent=l.equipment),l.subcontractors!==void 0&&(i.subcontractors_markup_percent=l.subcontractors);const{data:o,error:d}=await y.from("change_orders").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async updateCORFeePercentages(n,l){if(v){const i={};l.liabilityInsurance!==void 0&&(i.liability_insurance_percent=l.liabilityInsurance),l.bond!==void 0&&(i.bond_percent=l.bond),l.licenseFee!==void 0&&(i.license_fee_percent=l.licenseFee);const{data:o,error:d}=await y.from("change_orders").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async submitCORForApproval(n){if(v){const{data:l,error:i}=await y.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",n).select().single();if(i)throw i;return l}return null},async approveCOR(n,l){if(v){const{data:i,error:o}=await y.from("change_orders").update({status:"approved",approved_by:l,approved_at:new Date().toISOString()}).eq("id",n).select().single();if(o)throw o;return i}return null},async rejectCOR(n,l=null){if(v){const{data:i,error:o}=await y.from("change_orders").update({status:"rejected",rejection_reason:l}).eq("id",n).select().single();if(o)throw o;return i}return null},async markCORAsBilled(n){if(v){const{data:l,error:i}=await y.from("change_orders").update({status:"billed"}).eq("id",n).select().single();if(i)throw i;return l}return null},async closeCOR(n){if(v){const{data:l,error:i}=await y.from("change_orders").update({status:"closed"}).eq("id",n).select().single();if(i)throw i;return l}return null},async saveCORSignature(n,l,i){if(v){const{data:o,error:d}=await y.from("change_orders").update({gc_signature_data:l,gc_signature_name:i,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",n).select().single();if(d)throw d;return o}return null},async getCORStats(n){if(v){const{data:l,error:i}=await y.from("change_orders").select("status, cor_total").eq("project_id",n);if(i)throw i;const o={total_cors:l.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return l.forEach(d=>{switch(d.status){case"draft":o.draft_count++;break;case"pending_approval":o.pending_count++,o.total_pending_value+=d.cor_total||0;break;case"approved":o.approved_count++,o.total_approved_value+=d.cor_total||0;break;case"rejected":o.rejected_count++;break;case"billed":case"closed":o.billed_count++,o.total_billed_value+=d.cor_total||0;break}}),o}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(n,l){return v?y.channel(`change_orders:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToCorTickets(n,l){return v?y.channel(`cor-tickets:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${n}`},l).subscribe():null},async getCORLog(n){if(v){const{data:l,error:i}=await y.from("cor_log_entries").select(`
          id,
          log_number,
          date_sent_to_client,
          ce_number,
          comments,
          created_at,
          updated_at,
          change_order:change_orders (
            id,
            cor_number,
            title,
            cor_total,
            status,
            created_at,
            approved_at,
            approved_by
          )
        `).eq("project_id",n).order("log_number",{ascending:!0});if(i)throw console.error("Error fetching COR log:",i),i;return(l||[]).map(o=>({id:o.id,logNumber:o.log_number,dateSentToClient:o.date_sent_to_client,ceNumber:o.ce_number,comments:o.comments,createdAt:o.created_at,updatedAt:o.updated_at,changeOrder:{id:o.change_order?.id,corNumber:o.change_order?.cor_number,title:o.change_order?.title,corTotal:o.change_order?.cor_total,status:o.change_order?.status,createdAt:o.change_order?.created_at,approvedAt:o.change_order?.approved_at,approvedBy:o.change_order?.approved_by}}))}return[]},async updateCORLogEntry(n,l){if(v){const i={updated_at:new Date().toISOString()};l.dateSentToClient!==void 0&&(i.date_sent_to_client=l.dateSentToClient||null),l.ceNumber!==void 0&&(i.ce_number=l.ceNumber||null),l.comments!==void 0&&(i.comments=l.comments||null);const{data:o,error:d}=await y.from("cor_log_entries").update(i).eq("id",n).select().single();if(d)throw console.error("Error updating COR log entry:",d),d;return o}return null},async updateChangeOrderStatus(n,l){if(v){const{data:i,error:o}=await y.from("change_orders").update({status:l,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(o)throw console.error("Error updating change order status:",o),o;return i}return null},subscribeToCORLog(n,l){return v?y.channel(`cor-log:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"cor_log_entries",filter:`project_id=eq.${n}`},l).subscribe():null},async createSignatureRequest(n,l,i,o,d=null,m=null){if(v){const h=le();if(!h)throw new Error("Database client not available");const{data:g,error:b}=await h.rpc("generate_signature_token");if(b)throw b;const{data:k,error:B}=await h.from("signature_requests").insert({document_type:n,document_id:l,company_id:i,project_id:o,signature_token:g,expires_at:m,created_by:d}).select().single();if(B)throw B;return k}return null},async getSignatureRequestByToken(n){if(v){const l=le();if(!l)throw new Error("Database client not available");await l.rpc("increment_signature_view_count",{token:n});const{data:i,error:o}=await l.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",n).single();if(o)throw o;return i}return null},async getSignatureRequestsForDocument(n,l){if(v){const i=le();if(!i)throw new Error("Database client not available");const{data:o,error:d}=await i.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",n).eq("document_id",l).order("created_at",{ascending:!1});if(d)throw d;return o||[]}return[]},async addSignature(n,l,i){if(v){const o=le();if(!o)throw new Error("Database client not available");const{data:d,error:m}=await o.from("signatures").insert({signature_request_id:n,signature_slot:l,signature_image:i.signature,signer_name:i.signerName,signer_title:i.signerTitle||null,signer_company:i.signerCompany||null,signed_at:i.signedAt||new Date().toISOString(),ip_address:i.ipAddress||null,user_agent:i.userAgent||null}).select().single();if(m)throw m;return d}return null},async syncSignatureToDocument(n,l){if(!v)return null;const i=le();if(!i)throw new Error("Database client not available");const{document_type:o,document_id:d}=l,m=n.signature_slot,h={};m===1?(h.gc_signature_data=n.signature_image,h.gc_signature_name=n.signer_name,h.gc_signature_title=n.signer_title,h.gc_signature_company=n.signer_company,h.gc_signature_date=n.signed_at,h.gc_signature_ip=n.ip_address):m===2&&(h.client_signature_data=n.signature_image,h.client_signature_name=n.signer_name,h.client_signature_title=n.signer_title,h.client_signature_company=n.signer_company,h.client_signature_date=n.signed_at,h.client_signature_ip=n.ip_address);const g=o==="cor"?"change_orders":"t_and_m_tickets",{data:b,error:k}=await i.from(g).update(h).eq("id",d).select().single();if(k)throw k;return b},async revokeSignatureRequest(n){if(v){const l=le();if(!l)throw new Error("Database client not available");const{data:i,error:o}=await l.from("signature_requests").update({status:"revoked"}).eq("id",n).select().single();if(o)throw o;return i}return null},async getDocumentForSigning(n,l){if(!v)return null;const i=le();if(!i)throw new Error("Database client not available");if(n==="cor"){const{data:o,error:d}=await i.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",l).single();if(d)throw d;return o}else if(n==="tm_ticket"){const{data:o,error:d}=await i.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (
              id,
              name,
              unit,
              cost_per_unit,
              category
            )
          )
        `).eq("id",l).single();if(d)throw d;return o}return null},async getProjectCosts(n){if(v){const{data:i,error:o}=await y.from("project_costs").select("*").eq("project_id",n).order("cost_date",{ascending:!1});return o?(console.error("Error fetching project costs:",o),[]):i||[]}return(ae().projectCosts||[]).filter(i=>i.project_id===n).sort((i,o)=>new Date(o.cost_date)-new Date(i.cost_date))},async addProjectCost(n,l,i){const o={project_id:n,company_id:l,category:i.category,description:i.description,amount:parseFloat(i.amount),cost_date:i.cost_date||new Date().toISOString().split("T")[0],notes:i.notes||null,created_by:i.created_by||null};if(v){const{data:h,error:g}=await y.from("project_costs").insert(o).select().single();if(g)throw console.error("Error adding project cost:",g),g;return h}const d=ae();d.projectCosts||(d.projectCosts=[]);const m={...o,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return d.projectCosts.push(m),De(d),m},async updateProjectCost(n,l){const i={category:l.category,description:l.description,amount:parseFloat(l.amount),cost_date:l.cost_date,notes:l.notes||null,updated_at:new Date().toISOString()};if(v){const{data:m,error:h}=await y.from("project_costs").update(i).eq("id",n).select().single();if(h)throw console.error("Error updating project cost:",h),h;return m}const o=ae();if(!o.projectCosts)return null;const d=o.projectCosts.findIndex(m=>m.id===n);return d===-1?null:(o.projectCosts[d]={...o.projectCosts[d],...i},De(o),o.projectCosts[d])},async deleteProjectCost(n){if(v){const{error:i}=await y.from("project_costs").delete().eq("id",n);if(i)throw console.error("Error deleting project cost:",i),i;return!0}const l=ae();return l.projectCosts&&(l.projectCosts=l.projectCosts.filter(i=>i.id!==n),De(l)),!0},async getProjectCostsSummary(n){const l=await this.getProjectCosts(n),i={};let o=0;return l.forEach(d=>{const m=parseFloat(d.amount)||0;o+=m,i[d.category]||(i[d.category]={category:d.category,total:0,count:0,items:[]}),i[d.category].total+=m,i[d.category].count++,i[d.category].items.push(d)}),Object.values(i).forEach(d=>{d.percentage=o>0?d.total/o*100:0}),{totalCost:o,byCategory:i,itemCount:l.length}},async getNextInvoiceNumber(n){if(v){const{data:l,error:i}=await y.rpc("get_next_invoice_number",{p_company_id:n});return i?(console.error("Error getting next invoice number:",i),this._generateLocalInvoiceNumber(n)):l}return this._generateLocalInvoiceNumber(n)},async _generateLocalInvoiceNumber(n){const i=(await this.getCompanyInvoices(n)).reduce((o,d)=>{const m=d.invoice_number?.match(/^INV-(\d+)$/);if(m){const h=parseInt(m[1],10);return h>o?h:o}return o},0);return`INV-${String(i+1).padStart(4,"0")}`},async getBillableItems(n){if(v){const{data:l,error:i}=await y.from("change_orders").select("id, cor_number, title, cor_total, status, approved_at").eq("project_id",n).eq("status","approved").order("cor_number",{ascending:!0});i&&console.error("Error fetching billable CORs:",i);const{data:o,error:d}=await y.from("t_and_m_tickets").select("id, work_date, ce_pco_number, change_order_value, status, client_signature_date").eq("project_id",n).eq("status","approved").not("client_signature_data","is",null).order("work_date",{ascending:!0});return d&&console.error("Error fetching billable T&M tickets:",d),{cors:l||[],tickets:o||[]}}return{cors:[],tickets:[]}},async getProjectInvoices(n){if(v){const{data:i,error:o}=await y.from("invoices").select(`
          *,
          invoice_items (*)
        `).eq("project_id",n).order("invoice_date",{ascending:!1});if(o)throw console.error("Error fetching project invoices:",o),o;return i||[]}return(ae().invoices||[]).filter(i=>i.project_id===n)},async getCompanyInvoices(n){if(v){const{data:i,error:o}=await y.from("invoices").select("*").eq("company_id",n).order("invoice_date",{ascending:!1});if(o)throw console.error("Error fetching company invoices:",o),o;return i||[]}return(ae().invoices||[]).filter(i=>i.company_id===n)},async createInvoice(n,l){if(v){const{data:d,error:m}=await y.from("invoices").insert({project_id:n.project_id,company_id:n.company_id,invoice_number:n.invoice_number,invoice_date:n.invoice_date,due_date:n.due_date,status:n.status||"draft",retention_percent:n.retention_percent||0,bill_to_name:n.bill_to_name,bill_to_address:n.bill_to_address,bill_to_contact:n.bill_to_contact,notes:n.notes,terms:n.terms||"Net 30",created_by:n.created_by}).select().single();if(m)throw console.error("Error creating invoice:",m),m;if(l&&l.length>0){const h=l.map((b,k)=>({invoice_id:d.id,item_type:b.item_type,reference_id:b.reference_id,reference_number:b.reference_number,description:b.description,amount:b.amount,sort_order:k})),{error:g}=await y.from("invoice_items").insert(h);if(g)throw console.error("Error creating invoice items:",g),await y.from("invoices").delete().eq("id",d.id),g}return this.getInvoice(d.id)}const i=ae();i.invoices||(i.invoices=[]);const o={...n,id:Ft(),created_at:new Date().toISOString(),invoice_items:l||[]};return i.invoices.push(o),De(i),o},async getInvoice(n){if(v){const{data:i,error:o}=await y.from("invoices").select(`
          *,
          invoice_items (*)
        `).eq("id",n).single();if(o)throw console.error("Error fetching invoice:",o),o;return i}return(ae().invoices||[]).find(i=>i.id===n)},async updateInvoice(n,l){if(v){const{data:d,error:m}=await y.from("invoices").update(l).eq("id",n).select().single();if(m)throw console.error("Error updating invoice:",m),m;return d}const i=ae(),o=(i.invoices||[]).findIndex(d=>d.id===n);return o>=0?(i.invoices[o]={...i.invoices[o],...l},De(i),i.invoices[o]):null},async markInvoiceSent(n){return this.updateInvoice(n,{status:"sent",sent_at:new Date().toISOString()})},async recordInvoicePayment(n,l){const i=await this.getInvoice(n);if(!i)throw new Error("Invoice not found");const o=(i.amount_paid||0)+l,d=o>=i.total;return this.updateInvoice(n,{amount_paid:o,status:d?"paid":"partial",paid_at:d?new Date().toISOString():null})},async deleteInvoice(n){if(v){const{error:i}=await y.from("invoices").delete().eq("id",n).eq("status","draft");if(i)throw console.error("Error deleting invoice:",i),i;return!0}const l=ae();return l.invoices=(l.invoices||[]).filter(i=>i.id!==n),De(l),!0},async markItemsBilled(n=[],l=[]){if(v){if(n.length>0){const{error:i}=await y.from("change_orders").update({status:"billed"}).in("id",n);i&&console.error("Error marking CORs as billed:",i)}if(l.length>0){const{error:i}=await y.from("t_and_m_tickets").update({status:"billed"}).in("id",l);i&&console.error("Error marking T&M tickets as billed:",i)}}},async createFolder(n,l,i){const o=le(),{data:d,error:m}=await o.from("document_folders").insert({company_id:n,project_id:l,name:i.name,description:i.description||null,icon:i.icon||"folder",color:i.color||"blue",sort_order:i.sort_order||0,created_by:(await o.auth.getUser()).data.user?.id}).select().single();if(m)throw m;return d},async getProjectFolders(n){const l=le(),{data:i,error:o}=await l.from("document_folders").select("*").eq("project_id",n).order("sort_order",{ascending:!0}).order("name",{ascending:!0});if(o)throw o;const d=i.map(m=>m.id);if(d.length>0){const{data:m,error:h}=await l.from("documents").select("folder_id").in("folder_id",d).is("archived_at",null);if(!h&&m){const g={};m.forEach(b=>{g[b.folder_id]=(g[b.folder_id]||0)+1}),i.forEach(b=>{b.document_count=g[b.id]||0})}}return i},async updateFolder(n,l){const i=le(),{data:o,error:d}=await i.from("document_folders").update({...l,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(d)throw d;return o},async deleteFolder(n){const l=le();await l.from("documents").update({folder_id:null}).eq("folder_id",n);const{error:i}=await l.from("document_folders").delete().eq("id",n);if(i)throw i;return!0},async reorderFolders(n,l){const i=le(),o=l.map(({id:d,sort_order:m})=>i.from("document_folders").update({sort_order:m,updated_at:new Date().toISOString()}).eq("id",d).eq("project_id",n));return await Promise.all(o),!0},async getFolderDocuments(n,l={}){const i=le(),{page:o=0,limit:d=25}=l;let m=i.from("documents").select("*",{count:"exact"}).eq("folder_id",n).is("archived_at",null).eq("is_current",!0).order("uploaded_at",{ascending:!1}).range(o*d,(o+1)*d-1);const{data:h,error:g,count:b}=await m;if(g)throw g;return{documents:h||[],totalCount:b||0,hasMore:(b||0)>(o+1)*d}},async moveDocumentToFolder(n,l){const i=le(),{data:o,error:d}=await i.from("documents").update({folder_id:l}).eq("id",n).select().single();if(d)throw d;return o},async getUnfiledDocuments(n,l={}){const i=le(),{page:o=0,limit:d=25}=l,{data:m,error:h,count:g}=await i.from("documents").select("*",{count:"exact"}).eq("project_id",n).is("folder_id",null).is("archived_at",null).eq("is_current",!0).order("uploaded_at",{ascending:!1}).range(o*d,(o+1)*d-1);if(h)throw h;return{documents:m||[],totalCount:g||0,hasMore:(g||0)>(o+1)*d}},async uploadDocument(n,l,i,o={}){const d=le(),m=Date.now(),h=250*1024*1024,{data:g}=await d.from("documents").select("file_size_bytes").eq("project_id",l).is("archived_at",null),b=g?.reduce((Z,U)=>Z+(U.file_size_bytes||0),0)||0;if(b+i.size>h){const Z=Math.round(b/1024/1024),U=Math.round(h/1024/1024);throw new Error(`Project storage limit reached (${Z}/${U} MB). Contact support to upgrade.`)}const k=Date.now(),B=new Uint8Array(6);crypto.getRandomValues(B);const S=Array.from(B,Z=>Z.toString(36)).join(""),X=i.name.split(".").pop()?.toLowerCase()||"bin",te=`${k}-${S}.${X}`,F=`${n}/${l}/documents/${te}`;try{const{data:Z,error:U}=await d.storage.from("project-documents").upload(F,i,{cacheControl:"3600",upsert:!1});if(U)throw U;const{data:K}=d.storage.from("project-documents").getPublicUrl(F),ne=K.publicUrl,ie=o.category==="contracts"?"pending":"approved",{data:me,error:be}=await d.from("documents").insert({company_id:n,project_id:l,name:o.name||i.name.replace(/\.[^/.]+$/,""),description:o.description||null,file_name:i.name,file_size_bytes:i.size,mime_type:i.type,storage_path:F,folder_id:o.folderId||null,category:o.category||"general",tags:o.tags||[],visibility:o.visibility||"all",approval_status:ie,resource_type:o.resourceType||null,resource_id:o.resourceId||null,uploaded_by:(await d.auth.getUser()).data?.user?.id}).select().single();if(be)throw be;const we=Date.now()-m;return Ce.storage("document_upload",{company_id:n,project_id:l,file_size:i.size,mime_type:i.type,duration:we,success:!0}),{...me,url:ne}}catch(Z){throw Ce.error("storage",{message:Z.message,operation:"uploadDocument",company_id:n,project_id:l}),Z}},async getProjectDocuments(n,{category:l=null,page:i=0,limit:o=25,includeArchived:d=!1}={}){let h=le().from("documents").select("*",{count:"exact"}).eq("project_id",n).eq("is_current",!0).order("uploaded_at",{ascending:!1}).range(i*o,(i+1)*o-1);d||(h=h.is("archived_at",null)),l&&l!=="all"&&(h=h.eq("category",l));const{data:g,error:b,count:k}=await h;if(b)throw b;return{documents:g||[],totalCount:k||0,hasMore:(i+1)*o<(k||0),page:i,limit:o}},async getDocument(n){const l=le(),{data:i,error:o}=await l.from("documents").select("*").eq("id",n).single();if(o)throw o;return i},async getDocumentVersions(n){const l=le(),{data:i,error:o}=await l.from("documents").select("id, parent_document_id").eq("id",n).single();if(o)throw o;const d=i.parent_document_id||n,{data:m,error:h}=await l.from("documents").select("*").or(`id.eq.${d},parent_document_id.eq.${d}`).order("version",{ascending:!1});if(h)throw h;return m||[]},async uploadDocumentVersion(n,l,i,o,d={}){const m=le(),{data:h,error:g}=await m.from("documents").select("*").eq("id",n).single();if(g)throw g;const{data:b}=await m.from("documents").select("version").or(`id.eq.${n},parent_document_id.eq.${n}`).order("version",{ascending:!1}).limit(1),k=(b?.[0]?.version||1)+1;await m.from("documents").update({is_current:!1}).or(`id.eq.${n},parent_document_id.eq.${n}`);const B=await this.uploadDocument(l,i,o,{name:d.name||h.name,description:d.description||h.description,category:h.category,visibility:h.visibility,tags:h.tags,resourceType:h.resource_type,resourceId:h.resource_id}),{data:S,error:X}=await m.from("documents").update({version:k,is_current:!0,parent_document_id:n}).eq("id",B.id).select().single();if(X)throw X;return await m.from("document_audit_log").insert({document_id:B.id,project_id:i,company_id:l,operation:"version_created",details:{version:k,parent_id:n},triggered_by:"user",user_id:(await m.auth.getUser()).data?.user?.id}),{...B,...S}},async updateDocument(n,l){const i=le(),{data:o,error:d}=await i.from("documents").update({name:l.name,description:l.description,category:l.category,visibility:l.visibility,tags:l.tags}).eq("id",n).select().single();if(d)throw d;return o},async archiveDocument(n){const l=le(),i=(await l.auth.getUser()).data?.user?.id,{data:o,error:d}=await l.from("documents").update({archived_at:new Date().toISOString(),archived_by:i}).eq("id",n).select().single();if(d)throw d;return await l.from("document_audit_log").insert({document_id:n,project_id:o.project_id,company_id:o.company_id,operation:"deleted",triggered_by:"user",user_id:i}),o},async restoreDocument(n){const l=le(),i=(await l.auth.getUser()).data?.user?.id,{data:o,error:d}=await l.from("documents").update({archived_at:null,archived_by:null}).eq("id",n).select().single();if(d)throw d;return await l.from("document_audit_log").insert({document_id:n,project_id:o.project_id,company_id:o.company_id,operation:"restored",triggered_by:"user",user_id:i}),o},async deleteDocumentPermanently(n){const l=le(),{data:i,error:o}=await l.from("documents").select("storage_path, company_id, project_id").eq("id",n).single();if(o)throw o;i.storage_path&&await l.storage.from("project-documents").remove([i.storage_path]);const{error:d}=await l.from("documents").delete().eq("id",n);if(d)throw d;return!0},async linkDocumentToResource(n,l,i){const o=le(),{data:d,error:m}=await o.from("documents").update({resource_type:l,resource_id:i}).eq("id",n).select().single();if(m)throw m;return await o.from("document_audit_log").insert({document_id:n,project_id:d.project_id,company_id:d.company_id,operation:"linked",details:{resource_type:l,resource_id:i},triggered_by:"user",user_id:(await o.auth.getUser()).data?.user?.id}),d},async unlinkDocumentFromResource(n){const l=le(),{data:i}=await l.from("documents").select("resource_type, resource_id, project_id, company_id").eq("id",n).single(),{data:o,error:d}=await l.from("documents").update({resource_type:null,resource_id:null}).eq("id",n).select().single();if(d)throw d;return await l.from("document_audit_log").insert({document_id:n,project_id:i.project_id,company_id:i.company_id,operation:"unlinked",details:{resource_type:i.resource_type,resource_id:i.resource_id},triggered_by:"user",user_id:(await l.auth.getUser()).data?.user?.id}),o},async getResourceDocuments(n,l){const i=le(),{data:o,error:d}=await i.from("documents").select("*").eq("resource_type",n).eq("resource_id",l).is("archived_at",null).order("uploaded_at",{ascending:!1});if(d)throw d;return o||[]},async approveDocument(n){const l=le(),{data:i,error:o}=await l.rpc("approve_document",{p_document_id:n});if(o)throw o;return i},async rejectDocument(n,l){const i=le(),{data:o,error:d}=await i.rpc("reject_document",{p_document_id:n,p_reason:l});if(d)throw d;return o},async getPendingDocuments(n){const l=le(),{data:i,error:o}=await l.from("documents").select("*, project:projects(name)").eq("company_id",n).eq("approval_status","pending").is("archived_at",null).order("uploaded_at",{ascending:!1});if(o)throw o;return i||[]},async searchDocuments(n,l){const i=le(),{data:o,error:d}=await i.from("documents").select("*").eq("project_id",n).eq("is_current",!0).is("archived_at",null).or(`name.ilike.%${l}%,description.ilike.%${l}%`).order("uploaded_at",{ascending:!1}).limit(20);if(d)throw d;return o||[]},async logDocumentAccess(n,l="downloaded"){const i=le(),{data:o}=await i.from("documents").select("project_id, company_id").eq("id",n).single();o&&await i.from("document_audit_log").insert({document_id:n,project_id:o.project_id,company_id:o.company_id,operation:l,triggered_by:"user",user_id:(await i.auth.getUser()).data?.user?.id})}},__={async getCompanyEquipment(n,l=!0){if(!v)return console.warn("Supabase not configured"),[];let i=y.from("equipment").select("*").eq("company_id",n).order("name");l&&(i=i.eq("is_active",!0));const{data:o,error:d}=await i;return d?(console.error("Error fetching company equipment:",d),[]):o||[]},async createEquipment(n){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await y.from("equipment").insert(n).select().single();if(i)throw console.error("Error creating equipment:",i),i;return l},async updateEquipment(n,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await y.from("equipment").update(l).eq("id",n).select().single();if(o)throw console.error("Error updating equipment:",o),o;return i},async deactivateEquipment(n){return this.updateEquipment(n,{is_active:!1})},async getProjectEquipment(n){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await y.from("project_equipment").select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).eq("project_id",n).order("start_date",{ascending:!1});return i?(console.error("Error fetching project equipment:",i),[]):l||[]},async getActiveProjectEquipment(n){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await y.from("project_equipment").select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).eq("project_id",n).is("end_date",null).order("start_date",{ascending:!1});return i?(console.error("Error fetching active project equipment:",i),[]):l||[]},async addEquipmentToProject(n){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await y.from("project_equipment").insert(n).select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).single();if(i)throw console.error("Error adding equipment to project:",i),i;return l},async updateProjectEquipment(n,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await y.from("project_equipment").update(l).eq("id",n).select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).single();if(o)throw console.error("Error updating project equipment:",o),o;return i},async markEquipmentReturned(n,l=null){return this.updateProjectEquipment(n,{end_date:l||new Date().toISOString().split("T")[0]})},async removeEquipmentFromProject(n){if(!v)return console.warn("Supabase not configured"),!1;const{error:l}=await y.from("project_equipment").delete().eq("id",n);if(l)throw console.error("Error removing project equipment:",l),l;return!0},calculateProjectEquipmentCost(n){const l=new Date;return l.setHours(0,0,0,0),n.reduce((i,o)=>{const d=new Date(o.start_date);d.setHours(0,0,0,0);let m;o.end_date?(m=new Date(o.end_date),m.setHours(0,0,0,0)):m=l;const h=Math.max(1,Math.floor((m-d)/(1e3*60*60*24))+1);return i+o.daily_rate*h},0)},calculateDaysOnSite(n,l=null){const i=new Date(n);i.setHours(0,0,0,0);let o;return l?o=new Date(l):o=new Date,o.setHours(0,0,0,0),Math.max(1,Math.floor((o-i)/(1e3*60*60*24))+1)}},y_={async getNextDrawNumber(n){if(!v)return console.warn("Supabase not configured"),1;const{data:l,error:i}=await y.from("draw_requests").select("draw_number").eq("project_id",n).order("draw_number",{ascending:!1}).limit(1).single();return i&&i.code!=="PGRST116"&&console.error("Error getting next draw number:",i),(l?.draw_number||0)+1},async getPreviousBillingTotals(n){if(!v)return console.warn("Supabase not configured"),{totalBilled:0,totalRetention:0};const{data:l,error:i}=await y.from("draw_requests").select("current_billing, retention_held").eq("project_id",n).in("status",["submitted","approved","paid"]);if(i)return console.error("Error getting previous billing totals:",i),{totalBilled:0,totalRetention:0};const o=(l||[]).reduce((m,h)=>m+(h.current_billing||0),0),d=l?.length>0?Math.max(...l.map(m=>m.retention_held||0)):0;return{totalBilled:o,totalRetention:d}},async getProjectDrawRequests(n){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await y.from("draw_requests").select("*").eq("project_id",n).order("draw_number",{ascending:!1});return i?(console.error("Error fetching draw requests:",i),[]):l||[]},async getDrawRequest(n){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await y.from("draw_requests").select(`
        *,
        draw_request_items (
          *
        )
      `).eq("id",n).single();return i?(console.error("Error fetching draw request:",i),null):l},async createDrawRequest(n,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await y.from("draw_requests").insert(n).select().single();if(o)throw console.error("Error creating draw request:",o),o;if(l&&l.length>0){const d=l.map((h,g)=>({...h,draw_request_id:i.id,sort_order:g})),{error:m}=await y.from("draw_request_items").insert(d);m&&console.error("Error creating draw request items:",m)}return this.getDrawRequest(i.id)},async updateDrawRequest(n,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await y.from("draw_requests").update(l).eq("id",n).select().single();if(o)throw console.error("Error updating draw request:",o),o;return i},async updateDrawRequestStatus(n,l){const i={status:l};return l==="submitted"?i.submitted_at=new Date().toISOString():l==="approved"?i.approved_at=new Date().toISOString():l==="paid"&&(i.paid_at=new Date().toISOString()),this.updateDrawRequest(n,i)},async updateDrawRequestItems(n,l){if(!v)return console.warn("Supabase not configured"),!1;const{error:i}=await y.from("draw_request_items").delete().eq("draw_request_id",n);if(i)throw console.error("Error deleting old draw request items:",i),i;if(l&&l.length>0){const o=l.map((m,h)=>({...m,draw_request_id:n,sort_order:h})),{error:d}=await y.from("draw_request_items").insert(o);if(d)throw console.error("Error inserting draw request items:",d),d}return!0},async deleteDrawRequest(n){if(!v)return console.warn("Supabase not configured"),!1;const{error:l}=await y.from("draw_requests").delete().eq("id",n);if(l)throw console.error("Error deleting draw request:",l),l;return!0},async getScheduleOfValues(n){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await y.from("areas").select("id, name, square_footage, price_per_sqft").eq("project_id",n).order("created_at");return i?(console.error("Error fetching schedule of values:",i),[]):(l||[]).map((o,d)=>({area_id:o.id,item_number:String(d+1),description:o.name,scheduled_value:Math.round((o.square_footage||0)*(o.price_per_sqft||0)*100)}))},async getPreviousDrawItems(n){if(!v)return console.warn("Supabase not configured"),{};const{data:l,error:i}=await y.from("draw_requests").select("id").eq("project_id",n).in("status",["submitted","approved","paid"]).order("draw_number",{ascending:!1}).limit(1).single();if(i&&i.code!=="PGRST116")return console.error("Error fetching latest draw:",i),{};if(!l)return{};const{data:o,error:d}=await y.from("draw_request_items").select("area_id, total_percent, total_amount").eq("draw_request_id",l.id);return d?(console.error("Error fetching previous draw items:",d),{}):(o||[]).reduce((m,h)=>(h.area_id&&(m[h.area_id]={previous_percent:h.total_percent||0,previous_amount:h.total_amount||0}),m),{})},calculatePercentFromAmount(n,l){return!l||l===0?0:Math.round(n/l*1e4)},calculateAmountFromPercent(n,l){return Math.round(n/1e4*l)}};lu(async n=>{if(n&&v)try{await _h(_e)}catch(l){console.error("Error syncing pending actions:",l)}});const $_=Object.freeze(Object.defineProperty({__proto__:null,auth:ru,clearFieldSession:eu,db:_e,drawRequestOps:y_,equipmentOps:__,getConnectionStatus:ga,getPendingActionCount:Ni,isFieldMode:tu,isSupabaseConfigured:v,onConnectionChange:lu,supabase:y,syncPendingActions:_h},Symbol.toStringTag,{value:"Module"})),bh=N.createContext(),sa={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function gn({children:n,companyId:l}){const[i,o]=N.useState(sa),[d,m]=N.useState(!0);N.useEffect(()=>{l?h(l):g()},[l]),N.useEffect(()=>{B(i)},[i]);const h=async F=>{try{if(m(!0),!v){o(sa),m(!1);return}const{data:Z,error:U}=await y.from("company_branding").select("*").eq("company_id",F).single();U?(U.code==="PGRST116"?await b(F):console.error("Error loading branding:",U),o(sa)):o({...sa,...Z})}catch(Z){console.error("Error in loadBranding:",Z),o(sa)}finally{m(!1)}},g=async()=>{try{m(!0);const F=window.location.hostname;if(F==="localhost"||F==="127.0.0.1"){o(sa),m(!1);return}if(!v){o(sa),m(!1);return}const{data:Z,error:U}=await y.rpc("get_branding_by_domain",{domain_name:F});U||!Z||Z.length===0?o(sa):o({...sa,...Z[0]})}catch(F){console.error("Error loading branding by domain:",F),o(sa)}finally{m(!1)}},b=async F=>{try{const{data:Z,error:U}=await y.from("company_branding").insert({company_id:F,...sa}).select().single();U&&console.error("Error creating default branding:",U)}catch(Z){console.error("Error in createDefaultBranding:",Z)}},k=async F=>{try{if(!v)return o(be=>({...be,...F})),{success:!0};if(!l)return{success:!1,error:"No company ID"};const Z={},U=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const be of U)F[be]!==void 0&&(Z[be]=F[be]);const{data:K,error:ne}=await y.from("company_branding").select("id").eq("company_id",l).single();if(ne&&ne.code==="PGRST116"){const{data:be,error:we}=await y.from("company_branding").insert({company_id:l,...Z}).select().single();return we?(console.error("Error creating branding:",we),{success:!1,error:we.message}):(o({...sa,...be}),{success:!0,data:be})}const{data:ie,error:me}=await y.from("company_branding").update(Z).eq("company_id",l).select().single();return me?(console.error("Error updating branding:",me),{success:!1,error:me.message}):(o({...sa,...ie}),{success:!0,data:ie})}catch(Z){return console.error("Error in updateBranding:",Z),{success:!1,error:Z.message}}},B=F=>{const Z=document.documentElement;if(Z.style.setProperty("--primary-color",F.primary_color),Z.style.setProperty("--secondary-color",F.secondary_color),F.favicon_url){let U=document.querySelector("link[rel*='icon']");U||(U=document.createElement("link"),U.rel="icon",document.head.appendChild(U)),U.href=F.favicon_url}document.title=F.custom_app_name||"FieldSync"},S=async(F,Z)=>{try{if(!v)return{success:!0,url:URL.createObjectURL(F)};const U=F.name.split(".").pop(),ne=`branding/${`${l}/${Z}-${Date.now()}.${U}`}`,{data:ie,error:me}=await y.storage.from("public").upload(ne,F,{cacheControl:"3600",upsert:!0});if(me)return console.error("Error uploading image:",me),{success:!1,error:me.message};const{data:{publicUrl:be}}=y.storage.from("public").getPublicUrl(ne);return{success:!0,url:be}}catch(U){return console.error("Error in uploadBrandingImage:",U),{success:!1,error:U.message}}},X=N.useCallback(()=>{l?h(l):g()},[l]),te=N.useMemo(()=>({branding:i,loading:d,updateBranding:k,uploadBrandingImage:S,refreshBranding:X}),[i,d,X]);return s.jsx(bh.Provider,{value:te,children:n})}function v_(){const n=N.useContext(bh);if(!n)throw new Error("useBranding must be used within a BrandingProvider");return n}const jh=N.createContext();function _n({children:n}){const[l,i]=N.useState(()=>{const m=localStorage.getItem("fieldsync-theme");return m==="light"||m==="dark"?m:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"});N.useEffect(()=>{document.documentElement.setAttribute("data-theme",l),localStorage.setItem("fieldsync-theme",l)},[l]),N.useEffect(()=>{const m=window.matchMedia("(prefers-color-scheme: light)"),h=g=>{localStorage.getItem("fieldsync-theme")||i(g.matches?"light":"dark")};return m.addEventListener("change",h),()=>m.removeEventListener("change",h)},[]);const o=N.useCallback(()=>{i(m=>m==="dark"?"light":"dark")},[]),d=N.useMemo(()=>({theme:l,setTheme:i,toggleTheme:o}),[l,o]);return s.jsx(jh.Provider,{value:d,children:n})}function b_(){const n=N.useContext(jh);if(!n)throw new Error("useTheme must be used within a ThemeProvider");return n}function _a({className:n="",showPoweredBy:l=!1}){const{branding:i}=v_();return s.jsxs("div",{className:`app-logo ${n}`,children:[i.logo_url?s.jsx("img",{src:i.logo_url,alt:i.custom_app_name||"Logo",className:"custom-logo"}):s.jsxs("div",{className:"logo",children:[i.custom_app_name||"Field",s.jsx("span",{children:"Sync"})]}),l&&!i.hide_fieldsync_branding&&s.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function j_({onForemanAccess:n,onOfficeLogin:l,onShowToast:i}){const[o,d]=N.useState(null),[m,h]=N.useState(""),[g,b]=N.useState(null),[k,B]=N.useState(""),[S,X]=N.useState(!1),[te,F]=N.useState(""),Z=N.useRef(null),U=N.useRef(null);N.useEffect(()=>()=>{Z.current&&clearTimeout(Z.current),U.current&&clearTimeout(U.current)},[]);const[K,ne]=N.useState(""),[ie,me]=N.useState(""),[be,we]=N.useState(1),[Re,Ve]=N.useState(null),[Te,nt]=N.useState(""),[Fe,R]=N.useState(""),[G,de]=N.useState(""),[re,D]=N.useState(""),Q=J=>{const W=J.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);h(W)},I=async()=>{if(m.length<2){i("Enter company code","error");return}X(!0);try{const J=await _e.getCompanyByCode(m);J?b(J):(i("Invalid company code","error"),h(""))}catch{i("Error checking code","error")}finally{X(!1)}},Se=async J=>{if(J.length===4){X(!0),F("");try{const W=await _e.getProjectByPinSecure(J,g.code);if(W.rateLimited){F("error"),i("Too many attempts. Please wait 15 minutes.","error"),Z.current&&clearTimeout(Z.current),Z.current=setTimeout(()=>{B(""),F("")},800);return}if(W.success&&W.project){n(W.project);return}if(W.error){const ve=await _e.getProjectByPinAndCompany(J,g.id);if(ve){n(ve);return}}i("Invalid PIN","error"),B("")}catch{try{const ve=await _e.getProjectByPinAndCompany(J,g.id);if(ve){n(ve);return}}catch{}i("Error checking PIN","error"),B("")}finally{X(!1)}}},ce=J=>{if(k.length<4&&!S){const W=k+J;B(W),F(""),W.length===4&&(U.current&&clearTimeout(U.current),U.current=setTimeout(()=>Se(W),150))}},He=()=>{S||(B(J=>J.slice(0,-1)),F(""))},fe=()=>{b(null),B(""),F("")},je=()=>{if(!K.trim()||!ie.trim()){i("Enter email and password","error");return}l(K,ie)},Ue=async()=>{if(m.length<2){i("Enter company code","error");return}X(!0);try{const J=await _e.getCompanyByCode(m);J?(Ve(J),we(2)):(i("Invalid company code","error"),h(""))}catch{i("Error checking code","error")}finally{X(!1)}},vt=async()=>{if(!Te.trim()){i("Enter office code","error");return}X(!0);try{const{data:J,error:W}=await y.rpc("verify_office_code",{company_id:Re.id,code:Te.trim()});if(W)throw W;J===!0?we(3):(i("Invalid office code","error"),nt(""))}catch{i("Error verifying code","error")}finally{X(!1)}},qe=async()=>{if(!Fe.trim()){i("Enter your name","error");return}if(!G.trim()||!G.includes("@")){i("Enter valid email","error");return}if(re.length<6){i("Password must be 6+ characters","error");return}X(!0);try{const J=G.toLowerCase().trim(),{data:W,error:ve}=await y.auth.signUp({email:J,password:re});let Ge;if(ve?.message?.includes("already registered")||W?.user&&W.user.identities?.length===0){const{data:tt,error:ft}=await y.auth.signInWithPassword({email:J,password:re});if(ft){i("Account exists with different password. Use your existing password.","error"),X(!1);return}Ge=tt.user.id;const{data:Qe}=await y.from("user_companies").select("id, status").eq("user_id",Ge).eq("company_id",Re.id).maybeSingle();if(Qe){Qe.status==="active"?(i("You already belong to this company. Logging you in...","success"),setTimeout(()=>window.location.reload(),1e3)):Qe.status==="pending"?(i("Your request is still pending approval.","error"),await y.auth.signOut()):(i("Your membership was removed. Contact the company admin.","error"),await y.auth.signOut());return}const{error:Yt}=await y.from("user_companies").insert({user_id:Ge,company_id:Re.id,role:"member",status:"pending"});if(Yt)throw console.error("Error adding to user_companies:",Yt),await y.auth.signOut(),new Error("Failed to submit join request");await y.auth.signOut(),i("Request to join submitted! Awaiting admin approval.","success")}else{if(ve)throw ve;{if(Ge=W.user?.id,!Ge)throw new Error("Failed to create user");const{error:tt}=await y.from("users").insert({id:Ge,email:J,password_hash:"managed_by_supabase_auth",name:Fe.trim(),company_id:Re.id,role:"member",is_active:!0});if(tt)throw tt;const{error:ft}=await y.from("user_companies").insert({user_id:Ge,company_id:Re.id,role:"member",status:"pending"});if(ft)throw console.error("Error adding to user_companies:",ft),new Error("Failed to submit join request");await y.auth.signOut(),i("Account created! Awaiting admin approval.","success")}}}catch(J){console.error("Join error:",J),i(J.message||"Error creating account","error")}finally{X(!1)}};if(o===null)return s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),s.jsxs("div",{className:"entry-buttons",children:[s.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>d("foreman"),children:[s.jsx("span",{className:"entry-mode-icon",children:s.jsx(bn,{size:32})}),s.jsx("span",{className:"entry-mode-title",children:"Foreman"}),s.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),s.jsxs("button",{className:"entry-mode-btn office",onClick:()=>d("office"),children:[s.jsx("span",{className:"entry-mode-icon",children:s.jsx(xg,{size:32})}),s.jsx("span",{className:"entry-mode-title",children:"Office"}),s.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(o==="foreman")return g?s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:fe,children:""}),s.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),s.jsx("div",{className:"entry-company-badge",children:g.name}),s.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),s.jsx("div",{className:`pin-display ${te==="error"?"shake":""}`,children:[0,1,2,3].map(J=>s.jsx("div",{className:`pin-dot ${k.length>J?"filled":""} ${te}`,children:k.length>J?"":""},J))}),s.jsxs("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map(J=>s.jsx("button",{className:"num-btn",onClick:()=>ce(J.toString()),disabled:S,children:J},J)),s.jsx("button",{className:"num-btn empty",disabled:!0}),s.jsx("button",{className:"num-btn",onClick:()=>ce("0"),disabled:S,children:"0"}),s.jsx("button",{className:"num-btn backspace",onClick:He,disabled:S||k.length===0,children:""})]}),S&&s.jsx("div",{className:"entry-loading",children:s.jsx("div",{className:"spinner"})})]})}):s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>d(null),children:""}),s.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),s.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),s.jsxs("div",{className:"entry-input-group",children:[s.jsx("input",{type:"text",value:m,onChange:J=>Q(J.target.value),placeholder:"Company Code",disabled:S,autoFocus:!0,onKeyDown:J=>{J.key==="Enter"&&I()}}),s.jsx("button",{className:"entry-submit-btn",onClick:I,disabled:S||m.length<2,children:S?"...":""})]})]})});if(o==="office")return s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>d(null),children:""}),s.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),s.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),s.jsxs("div",{className:"entry-form",children:[s.jsx("input",{type:"email",value:K,onChange:J=>ne(J.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:J=>{J.key==="Enter"&&je()}}),s.jsx("input",{type:"password",value:ie,onChange:J=>me(J.target.value),placeholder:"Password",onKeyDown:J=>{J.key==="Enter"&&je()}}),s.jsx("button",{className:"entry-login-btn",onClick:je,children:"Sign In"})]}),s.jsxs("div",{className:"entry-signup-hint",children:[s.jsx("p",{children:"New employee?"}),s.jsx("button",{className:"entry-join-link",onClick:()=>d("join"),children:"Join your company"})]})]})});if(o==="join")return be===1?s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>d("office"),children:""}),s.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),s.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),s.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),s.jsxs("div",{className:"entry-input-group",children:[s.jsx("input",{type:"text",value:m,onChange:J=>Q(J.target.value),placeholder:"Company Code",disabled:S,autoFocus:!0,onKeyDown:J=>{J.key==="Enter"&&Ue()}}),s.jsx("button",{className:"entry-submit-btn",onClick:Ue,disabled:S||m.length<2,children:S?"...":""})]})]})}):be===2?s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>{we(1),Ve(null),nt("")},children:""}),s.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),s.jsx("div",{className:"entry-company-badge",children:Re?.name}),s.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),s.jsx("p",{className:"entry-hint",children:"This code is only for office staff"}),s.jsxs("div",{className:"entry-input-group",children:[s.jsx("input",{type:"password",value:Te,onChange:J=>nt(J.target.value),placeholder:"Office Code",disabled:S,autoFocus:!0,onKeyDown:J=>{J.key==="Enter"&&vt()}}),s.jsx("button",{className:"entry-submit-btn",onClick:vt,disabled:S||!Te.trim(),children:S?"...":""})]})]})}):s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>{we(2),nt("")},children:""}),s.jsx(_a,{className:"entry-logo",showPoweredBy:!1}),s.jsx("div",{className:"entry-company-badge",children:Re?.name}),s.jsx("p",{className:"entry-subtitle",children:"Create your account"}),s.jsxs("div",{className:"entry-form",children:[s.jsx("input",{type:"text",value:Fe,onChange:J=>R(J.target.value),placeholder:"Your Name",autoFocus:!0}),s.jsx("input",{type:"email",value:G,onChange:J=>de(J.target.value),placeholder:"Email"}),s.jsx("input",{type:"password",value:re,onChange:J=>D(J.target.value),placeholder:"Password (6+ characters)",onKeyDown:J=>{J.key==="Enter"&&qe()}}),s.jsx("button",{className:"entry-login-btn",onClick:qe,disabled:S,children:S?"Creating...":"Join Company"})]}),s.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})})}function yn({message:n,type:l="",onClose:i}){return N.useEffect(()=>{const o=setTimeout(i,3e3);return()=>clearTimeout(o)},[i]),s.jsx("div",{className:"toast-container",children:s.jsx("div",{className:`toast ${l}`,children:n})})}function ah({compact:n=!1}){const{theme:l,toggleTheme:i}=b_();return s.jsx("button",{className:`theme-toggle ${n?"theme-toggle-compact":""}`,onClick:i,title:`Switch to ${l==="dark"?"light":"dark"} mode`,"aria-label":`Switch to ${l==="dark"?"light":"dark"} mode`,children:l==="dark"?s.jsxs(s.Fragment,{children:[s.jsx(ih,{size:n?18:16}),!n&&s.jsx("span",{children:"Light"})]}):s.jsxs(s.Fragment,{children:[s.jsx(oh,{size:n?18:16}),!n&&s.jsx("span",{children:"Dark"})]})})}class rs extends N.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0}}componentDidCatch(l,i){this.setState({error:l,errorInfo:i}),console.error("ErrorBoundary caught an error:",l,i),(l?.message?.includes("Failed to fetch dynamically imported module")||l?.message?.includes("Loading chunk")||l?.message?.includes("Loading CSS chunk"))&&(console.warn("[ErrorBoundary] Chunk load failure detected, clearing cache and reloading..."),"caches"in window?caches.keys().then(d=>{Promise.all(d.map(m=>caches.delete(m))).then(()=>{window.location.reload()})}).catch(()=>{window.location.reload()}):window.location.reload())}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?s.jsx("div",{className:"error-boundary",children:s.jsxs("div",{className:"error-boundary-content",children:[s.jsx("div",{className:"error-icon",children:s.jsx(Di,{size:48})}),s.jsx("h2",{children:"Something went wrong"}),s.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),s.jsxs("div",{className:"error-actions",children:[s.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),s.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function rh(){const[n,l]=N.useState(ga()),[i,o]=N.useState(0),[d,m]=N.useState(!1),h=N.useRef(!1),g=N.useRef(null);return N.useEffect(()=>{const b=lu(async B=>{l(B),B&&h.current&&(m(!0),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>m(!1),3e3),h.current=!1),B||(h.current=!0);const S=await Ni();o(S)});Ni().then(o);const k=setInterval(async()=>{if(!ga()){const B=await Ni();o(B)}},5e3);return()=>{b(),clearInterval(k),g.current&&clearTimeout(g.current)}},[]),n&&i===0&&!d?null:s.jsxs("div",{className:`offline-indicator ${n?"online":"offline"} ${d?"synced":""}`,children:[s.jsx("div",{className:"offline-indicator-content",children:n?d?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"online-icon",children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):i>0?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"syncing-icon",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"23 4 23 10 17 10"}),s.jsx("polyline",{points:"1 20 1 14 7 14"}),s.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),s.jsxs("span",{className:"offline-text",children:["Syncing ",i,"..."]})]}):null:s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"offline-icon",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),s.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),s.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),s.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),s.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),s.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),s.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),s.jsxs("span",{className:"offline-text",children:["Offline",i>0&&s.jsxs("span",{className:"pending-badge",children:[i," pending"]})]})]})}),s.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function W_(n){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(n)}function w_(n){if(!n||n.length===0)return 0;let l=0;return n.forEach(i=>{i.status==="done"&&(l+=i.weight||0)}),Math.round(l)}function P_(n){if(!n||n.length===0)return{progress:0,earnedValue:0,totalValue:0,isValueBased:!1};if(n.some(o=>o.scheduled_value>0)){const o=n.reduce((h,g)=>h+(g.scheduled_value||0),0),d=n.filter(h=>h.status==="done").reduce((h,g)=>h+(g.scheduled_value||0),0);return{progress:o>0?Math.round(d/o*100):0,earnedValue:d,totalValue:o,isValueBased:!0}}const i=n.filter(o=>o.status==="done").reduce((o,d)=>o+(d.weight||0),0);return{progress:Math.round(i),earnedValue:0,totalValue:0,isValueBased:!1}}function S_(n){if(!n||n.length===0)return"not_started";const l=n.some(d=>d.status==="working"),i=n.some(d=>d.status==="done");return n.every(d=>d.status==="done")?"done":l||i?"working":"not_started"}function I_(n){const l=S_(n);return l==="done"?"Complete":l==="working"?"In Progress":"Not Started"}function ey(n,l=0){const i=new Date;i.setHours(0,0,0,0);const o={scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1};if(n.start_date&&n.end_date){const d=new Date(n.start_date),m=new Date(n.end_date);d.setHours(0,0,0,0),m.setHours(0,0,0,0);const h=Math.max(1,Math.ceil((m-d)/(1e3*60*60*24))),g=Math.max(0,Math.ceil((i-d)/(1e3*60*60*24))),b=Math.min(100,g/h*100),B=(n.progress||0)-b;o.scheduleVariance=Math.round(B),o.hasScheduleData=!0,B>5?(o.scheduleStatus="ahead",o.scheduleLabel=`Ahead of Schedule (+${o.scheduleVariance}%)`):B<-5?(o.scheduleStatus="behind",o.scheduleLabel=`Behind Schedule (${o.scheduleVariance}%)`):(o.scheduleStatus="on_track",o.scheduleLabel="On Track")}if(n.planned_man_days&&n.planned_man_days>0){const m=(n.progress||0)/100*n.planned_man_days;if(m>0&&l>0){const h=(l-m)/m*100;o.laborVariance=Math.round(h),o.hasLaborData=!0,h>10?(o.laborStatus="over",o.laborLabel=`Over Planned (+${o.laborVariance}% man-days)`):h<-10?(o.laborStatus="under",o.laborLabel=`Under Planned (${o.laborVariance}% man-days)`):(o.laborStatus="on_track",o.laborLabel="Labor On Track")}else l>0&&(o.hasLaborData=!0,o.laborLabel=`${l} man-days used`)}return o}function ty(n,l=30){if(n.status==="archived"||n.progress<100)return!1;const i=n.areas||[];if(i.length===0||!i.every(h=>h.status==="done"))return!1;const d=i.reduce((h,g)=>{const b=new Date(g.updated_at);return b>h?b:h},new Date(0));return d.getTime()===0?!1:Math.floor((Date.now()-d.getTime())/(1e3*60*60*24))>=l}const ay=n=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[59,130,246]},x_=(n,l=5e3,i=.85)=>new Promise(o=>{if(!n){o(null);return}const d=new Image;d.crossOrigin="anonymous";const m=setTimeout(()=>{d.src="",o(null)},l);d.onload=()=>{clearTimeout(m);try{const h=document.createElement("canvas");h.width=d.width,h.height=d.height,h.getContext("2d").drawImage(d,0,0);const b=h.toDataURL("image/jpeg",i);o(b)}catch{o(null)}},d.onerror=()=>{clearTimeout(m),o(null)},d.src=n}),ry=async(n,l=5e3,i=.85)=>!n||n.length===0?[]:await Promise.all(n.map(d=>x_(d,l,i)));async function nh(n,l=1920,i=.8){return!n.type.startsWith("image/")||n.size<500*1024?n:new Promise(o=>{const d=document.createElement("canvas"),m=d.getContext("2d"),h=new Image;h.onload=()=>{let{width:g,height:b}=h;g>l&&(b=Math.round(b*l/g),g=l);const k=1920;b>k&&(g=Math.round(g*k/b),b=k),d.width=g,d.height=b,m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high",m.drawImage(h,0,0,g,b),d.toBlob(B=>{if(B){const S=n.name.replace(/\.[^/.]+$/,""),X=new File([B],`${S}.jpg`,{type:"image/jpeg",lastModified:Date.now()});o(X)}else console.warn("Image compression failed, using original"),o(n)},"image/jpeg",i),URL.revokeObjectURL(h.src)},h.onerror=()=>{console.warn("Failed to load image for compression, using original"),URL.revokeObjectURL(h.src),o(n)},h.src=URL.createObjectURL(n)})}const N_=N.lazy(()=>lr(()=>import("./SignatureLinkGenerator-Di9J-Bwj.js"),__vite__mapDeps([0,1,2,3,4]))),E_=N.lazy(()=>lr(()=>import("./TMClientSignature-CXFJD4Sz.js"),__vite__mapDeps([5,1,2,3,4]))),sh=()=>{const n=new Uint8Array(6);return crypto.getRandomValues(n),Array.from(n,l=>l.toString(36)).join("")},Kc=["Containment","PPE","Disposal","Equipment"],C_={en:{workInfo:"Work Details",crewHours:"Crew & Hours",materialsEquipment:"Materials",evidence:"Evidence",review:"Review",quickActions:"Quick Actions",sameAsYesterday:"Same as Yesterday",setCrewHours:"Set Crew Hours",loading:"Loading...",supervision:"Supervision",operators:"Operators",laborers:"Laborers",addSupervision:"+ Add Supervision",addOperator:"+ Add Operator",addLaborer:"+ Add Laborer",foreman:"Foreman",superintendent:"Superintendent",firstLastName:"First & Last Name",start:"Start",end:"End",regHrs:"Reg Hrs",otHrs:"OT Hrs",selectCategory:"Select a category:",addCustomItem:"+ Add Custom Item",customItem:"Custom Item",itemName:"Item Name",category:"Category",quantity:"Quantity",addItem:"Add Item",cancel:"Cancel",noItemsCategory:"No items in this category yet",workDate:"Work Date",ceNumber:"CE/PCO #",optional:"optional",linkedCOR:"Link to Change Order",selectCOR:"Select COR (optional)",noCORs:"No pending CORs",laborSummary:"Labor Summary",worker:"worker",workers_plural:"workers",totalHours:"Total Hours",regular:"Regular",overtime:"Overtime",materials:"Materials",item:"item",items_plural:"items",noMaterials:"No materials added",notes:"Notes",addNotes:"Add notes about the work performed...",photos:"Photos",addPhotos:"Add Photos",maxPhotos:"max",noPhotos:"No photos added",certification:"Certification",certifyStatement:"I certify that this T&M ticket accurately reflects the work performed.",foremanSignature:"Foreman's Name (Signature)",yourName:"Your name",describeWork:"Describe the work performed",descriptionRequired:"Description is required",whatWorkPerformed:"What work was performed today?",searchMaterials:"Search materials & equipment...",noSearchResults:"No items found",orBrowse:"Or browse by category:",back:"Back",next:"Next",nextCrew:"Next: Crew",nextMaterials:"Next: Materials",reviewItems:"Review",skipNoMaterials:"Skip (no materials)",submitTM:"Submit T&M",submitting:"Submitting...",applySameHours:"Apply Same Hours",batchDescription:"Set start/end time and hours for all workers with names entered.",timeStarted:"Time Started",timeEnded:"Time Ended",regularHours:"Regular Hours",overtimeHours:"Overtime Hours",willApplyTo:"Will apply to",applyToAll:"Apply to All",preset8hr:"8hr Day",preset10hr:"10hr Day",preset4hr:"4hr Day",loadedWorkers:"Loaded {count} workers from {date}",noPreviousCrew:"No previous crew found for this project",appliedHours:"Applied hours to {count} worker(s)",assignedToCOR:"Assigned to COR"},es:{workInfo:"Info del Trabajo",crewHours:"Cuadrilla y Horas",materialsEquipment:"Materiales",evidence:"Evidencia",review:"Revisar",quickActions:"Acciones Rapidas",sameAsYesterday:"Igual que Ayer",setCrewHours:"Poner Horas",loading:"Cargando...",supervision:"Supervision",operators:"Operadores",laborers:"Trabajadores",addSupervision:"+ Agregar Supervision",addOperator:"+ Agregar Operador",addLaborer:"+ Agregar Trabajador",foreman:"Capataz",superintendent:"Superintendente",firstLastName:"Nombre y Apellido",start:"Inicio",end:"Fin",regHrs:"Hrs Reg",otHrs:"Hrs Extra",selectCategory:"Seleccione una categoria:",addCustomItem:"+ Agregar Articulo",customItem:"Articulo Personalizado",itemName:"Nombre del Articulo",category:"Categoria",quantity:"Cantidad",addItem:"Agregar",cancel:"Cancelar",noItemsCategory:"No hay articulos en esta categoria",workDate:"Fecha de Trabajo",ceNumber:"CE/PCO #",optional:"opcional",linkedCOR:"Vincular a Orden de Cambio",selectCOR:"Seleccionar COR (opcional)",noCORs:"No hay CORs pendientes",laborSummary:"Resumen de Mano de Obra",worker:"trabajador",workers_plural:"trabajadores",totalHours:"Horas Totales",regular:"Regular",overtime:"Extra",materials:"Materiales",item:"articulo",items_plural:"articulos",noMaterials:"No se agregaron materiales",notes:"Notas",addNotes:"Agregar notas sobre el trabajo realizado...",photos:"Fotos",addPhotos:"Agregar Fotos",maxPhotos:"max",noPhotos:"No se agregaron fotos",certification:"Certificacion",certifyStatement:"Certifico que este ticket T&M refleja con precision el trabajo realizado.",foremanSignature:"Nombre del Capataz (Firma)",yourName:"Su nombre",describeWork:"Describir el trabajo realizado",descriptionRequired:"Descripcion es requerida",whatWorkPerformed:"Que trabajo se realizo hoy?",searchMaterials:"Buscar materiales y equipo...",noSearchResults:"No se encontraron articulos",orBrowse:"O navegar por categoria:",back:"Atras",next:"Siguiente",nextCrew:"Siguiente: Cuadrilla",nextMaterials:"Siguiente: Materiales",reviewItems:"Revisar",skipNoMaterials:"Saltar (sin materiales)",submitTM:"Enviar T&M",submitting:"Enviando...",applySameHours:"Aplicar Mismas Horas",batchDescription:"Establezca hora de inicio/fin y horas para todos los trabajadores.",timeStarted:"Hora de Inicio",timeEnded:"Hora de Fin",regularHours:"Horas Regulares",overtimeHours:"Horas Extra",willApplyTo:"Se aplicara a",applyToAll:"Aplicar a Todos",preset8hr:"Dia 8hr",preset10hr:"Dia 10hr",preset4hr:"Dia 4hr",loadedWorkers:"Se cargaron {count} trabajadores del {date}",noPreviousCrew:"No se encontro equipo anterior para este proyecto",appliedHours:"Horas aplicadas a {count} trabajador(es)",assignedToCOR:"Asignado a COR"}};function q_({project:n,companyId:l,maxPhotos:i=10,onSubmit:o,onCancel:d,onShowToast:m}){const[h,g]=N.useState(1),[b,k]=N.useState(new Date().toISOString().split("T")[0]),[B,S]=N.useState(null),[X,te]=N.useState(!1),[F,Z]=N.useState(!1),[U,K]=N.useState(!1),[ne,ie]=N.useState(""),[me,be]=N.useState(""),[we,Re]=N.useState(""),[Ve,Te]=N.useState([]),[nt,Fe]=N.useState(!1),[R,G]=N.useState(!1),[de,re]=N.useState({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),[D,Q]=N.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}]),[I,Se]=N.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[ce,He]=N.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[fe,je]=N.useState([]),[Ue,vt]=N.useState(""),[qe,J]=N.useState([]),[W,ve]=N.useState(!1),[Ge,Ze]=N.useState(""),[tt,ft]=N.useState([]),[Qe,Yt]=N.useState(!1),[ct,Nt]=N.useState(null),[wn,or]=N.useState([]),[Yr,ka]=N.useState(!1),[cr,ur]=N.useState(""),[bt,za]=N.useState([]),[Gr,Qr]=N.useState([]),[la,Ma]=N.useState(!1),[jt,Ra]=N.useState({name:"",category:"",quantity:""}),Xr=N.useRef(null),[ya,Et]=N.useState(!1),[ee,Tt]=N.useState("en"),P=p=>C_[ee][p]||p,[Sn,xn]=N.useState([]),[Mt,dr]=N.useState([]),[Ct,lt]=N.useState({}),[ia,xa]=N.useState(!0),[Ua,V]=N.useState(new Set),Ie=Mt.length>0,Gt=(p,w)=>{if(!p||!w)return null;const[C,q]=p.split(":").map(Number),[M,$]=w.split(":").map(Number);let oe=M*60+$-(C*60+q);oe<0&&(oe+=1440);const he=oe/60,pe=Math.min(he,8),Ne=Math.max(0,he-8);return{hours:pe.toFixed(1),overtimeHours:Ne>0?Ne.toFixed(1):""}},Vr=p=>{if(!p)return"empty";const w=p.name&&p.name.trim()!=="",C=parseFloat(p.hours)>0||parseFloat(p.overtimeHours)>0;return w?C?"complete":"incomplete":"empty"},Nn=p=>{let w,C,q,M;switch(p){case"full":w="07:00",C="15:30",q="8",M="";break;case"10hr":w="06:00",C="16:30",q="8",M="2";break;case"half":w="07:00",C="11:00",q="4",M="";break;default:return}re({timeStarted:w,timeEnded:C,hours:q,overtimeHours:M})};N.useEffect(()=>{ls(),sl()},[n.id]),N.useEffect(()=>{(async()=>{if(!l){xa(!1);return}try{const w=await _e.getLaborClassesForField(l);xn(w.categories||[]),dr(w.classes||[])}catch(w){console.error("Error loading labor classes:",w)}finally{xa(!1)}})()},[l]),N.useEffect(()=>{if(ia||Mt.length===0)return;const p=new Set;tt.forEach(q=>{q.labor_class_id&&p.add(q.labor_class_id)});const w={},C=new Set;p.forEach(q=>{Mt.some(M=>M.id===q)&&(w[q]=[{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}],C.add(q))}),lt(q=>Object.keys(q).length===0?w:q),V(q=>q.size===0?C:q)},[Mt,tt,ia]);const sl=async()=>{Fe(!0);try{const p=await _e.getAssignableCORs(n.id);Te(p||[])}catch(p){console.error("Error loading assignable CORs:",p)}finally{Fe(!1)}},ll=()=>{const{timeStarted:p,timeEnded:w,hours:C,overtimeHours:q}=de;let M=0;if(Ie){const $={};Object.entries(Ct).forEach(([oe,he])=>{$[oe]=he.map(pe=>pe&&pe.name&&pe.name.trim()?(M++,{...pe,timeStarted:p,timeEnded:w,hours:C,overtimeHours:q}):pe)}),lt($)}else Q(D.map($=>$&&$.name&&$.name.trim()?(M++,{...$,timeStarted:p,timeEnded:w,hours:C,overtimeHours:q}):$)),Se(I.map($=>$&&$.name&&$.name.trim()?(M++,{...$,timeStarted:p,timeEnded:w,hours:C,overtimeHours:q}):$)),He(ce.map($=>$&&$.name&&$.name.trim()?(M++,{...$,timeStarted:p,timeEnded:w,hours:C,overtimeHours:q}):$));G(!1),re({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),M>0?m(P("appliedHours").replace("{count}",M),"success"):m(ee==="en"?"Add workers first":"Agregue trabajadores primero","info")},Zr=p=>{let w,C,q,M;switch(p){case"8hr":w="07:00",C="15:30",q="8",M="";break;case"10hr":w="06:00",C="16:30",q="8",M="2";break;case"4hr":w="07:00",C="11:00",q="4",M="";break;default:return}let $=0;if(Ie){const oe={};Object.entries(Ct).forEach(([he,pe])=>{oe[he]=pe.map(Ne=>Ne&&Ne.name&&Ne.name.trim()?($++,{...Ne,timeStarted:w,timeEnded:C,hours:q,overtimeHours:M}):Ne)}),lt(oe)}else Q(oe=>oe.map(he=>he&&he.name&&he.name.trim()?($++,{...he,timeStarted:w,timeEnded:C,hours:q,overtimeHours:M}):he)),Se(oe=>oe.map(he=>he&&he.name&&he.name.trim()?($++,{...he,timeStarted:w,timeEnded:C,hours:q,overtimeHours:M}):he)),He(oe=>oe.map(he=>he&&he.name&&he.name.trim()?($++,{...he,timeStarted:w,timeEnded:C,hours:q,overtimeHours:M}):he));$>0?m(P("appliedHours").replace("{count}",$),"success"):m(ee==="en"?"Add workers first":"Agregue trabajadores primero","info")},ls=async()=>{try{const p=await _e.getCrewCheckin(n.id);p?.workers&&ft(p.workers)}catch(p){console.error("Error loading crew:",p)}};N.useEffect(()=>{ct&&l&&il(ct)},[ct,l]),N.useEffect(()=>{h===3&&Xr.current&&!ct&&setTimeout(()=>{Xr.current?.focus()},100)},[h,ct]);const il=async p=>{ka(!0);try{const w=await _e.getMaterialsEquipmentByCategory(l,p);or(w)}catch(w){console.error("Error loading items:",w),m("Error loading items","error")}finally{ka(!1)}},ol=async()=>{if(!(Gr.length>0))try{const p=[];for(const w of Kc){const C=await _e.getMaterialsEquipmentByCategory(l,w);p.push(...C.map(q=>({...q,category:w})))}Qr(p)}catch(p){console.error("Error loading all materials:",p)}},Na=p=>{if(ur(p),!p.trim()){za([]);return}const w=p.toLowerCase(),C=Gr.filter(q=>q.name.toLowerCase().includes(w)||q.category.toLowerCase().includes(w));za(C.slice(0,10))},wt=async()=>{Et(!0);try{const p=await _e.getPreviousTicketCrew(n.id,b);if(!p||p.totalWorkers===0){m(P("noPreviousCrew"),"info");return}Ie&&p.dynamicWorkers?lt(p.dynamicWorkers):(p.supervision&&Q(p.supervision),p.operators&&Se(p.operators),p.laborers&&He(p.laborers));const w=new Date(p.workDate).toLocaleDateString();m(P("loadedWorkers").replace("{count}",p.totalWorkers).replace("{date}",w),"success")}catch(p){console.error("Error loading previous crew:",p),m(ee==="en"?"Error loading previous crew":"Error cargando equipo anterior","error")}finally{Et(!1)}},Rt=()=>{Q([...D,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},Ht=(p,w,C)=>{Q(D.map((q,M)=>{if(M!==p)return q;const $={...q,[w]:C};if(w==="timeStarted"||w==="timeEnded"){const oe=w==="timeStarted"?C:q.timeStarted,he=w==="timeEnded"?C:q.timeEnded,pe=Gt(oe,he);pe&&($.hours=pe.hours,$.overtimeHours=pe.overtimeHours)}return $}))},is=p=>{D.length>1?Q(D.filter((w,C)=>C!==p)):Q([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},Ai=()=>{He([...ce,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},mr=(p,w,C)=>{He(ce.map((q,M)=>{if(M!==p)return q;const $={...q,[w]:C};if(w==="timeStarted"||w==="timeEnded"){const oe=w==="timeStarted"?C:q.timeStarted,he=w==="timeEnded"?C:q.timeEnded,pe=Gt(oe,he);pe&&($.hours=pe.hours,$.overtimeHours=pe.overtimeHours)}return $}))},cl=p=>{ce.length>1?He(ce.filter((w,C)=>C!==p)):He([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Kr=()=>{Se([...I,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Ea=(p,w,C)=>{Se(I.map((q,M)=>{if(M!==p)return q;const $={...q,[w]:C};if(w==="timeStarted"||w==="timeEnded"){const oe=w==="timeStarted"?C:q.timeStarted,he=w==="timeEnded"?C:q.timeEnded,pe=Gt(oe,he);pe&&($.hours=pe.hours,$.overtimeHours=pe.overtimeHours)}return $}))},fr=p=>{I.length>1?Se(I.filter((w,C)=>C!==p)):Se([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Ha=p=>{lt(w=>({...w,[p]:[...w[p]||[],{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}))},Ut=(p,w,C,q)=>{lt(M=>({...M,[p]:(M[p]||[]).map(($,oe)=>{if(oe!==w)return $;const he={...$,[C]:q};if(C==="timeStarted"||C==="timeEnded"){const pe=C==="timeStarted"?q:$.timeStarted,Ne=C==="timeEnded"?q:$.timeEnded,ut=Gt(pe,Ne);ut&&(he.hours=ut.hours,he.overtimeHours=ut.overtimeHours)}return he})}))},La=(p,w)=>{lt(C=>{const q=C[p]||[];return q.length>1?{...C,[p]:q.filter((M,$)=>$!==w)}:{...C,[p]:[{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}})},ht=p=>{p&&(V(w=>new Set([...w,p])),lt(w=>!w[p]||w[p].length===0?{...w,[p]:[{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}:w))},os=p=>{V(w=>{const C=new Set(w);return C.delete(p),C}),lt(w=>{const C={...w};return delete C[p],C})},Jr=()=>Mt.filter(p=>!Ua.has(p.id)),va=()=>{if(!Ct||typeof Ct!="object")return[];const p=[];return Object.entries(Ct).forEach(([w,C])=>{if(!Array.isArray(C))return;const q=Mt.find(M=>M.id===w);C.forEach(M=>{M&&M.name&&M.name.trim()&&(parseFloat(M.hours)>0||parseFloat(M.overtimeHours)>0)&&p.push({name:M.name.trim(),hours:parseFloat(M.hours)||0,overtime_hours:parseFloat(M.overtimeHours)||0,time_started:M.timeStarted||null,time_ended:M.timeEnded||null,role:q?.name||"Worker",labor_class_id:w})})}),p},hr=p=>{const w=fe.findIndex(C=>C.material_equipment_id===p.id);w>=0?je(fe.map((C,q)=>q===w?{...C,quantity:C.quantity+1}:C)):je([...fe,{material_equipment_id:p.id,name:p.name,unit:p.unit,category:p.category,quantity:1,isCustom:!1}]),m(`Added ${p.name}`,"success")},Oi=()=>{if(!jt.name||!jt.category||!jt.quantity){m("Fill in all fields","error");return}je([...fe,{material_equipment_id:null,custom_name:jt.name,custom_category:jt.category,name:jt.name,category:jt.category,quantity:parseFloat(jt.quantity),unit:"each",isCustom:!0}]),Ra({name:"",category:"",quantity:""}),Ma(!1),Nt(null),m("Custom item added","success")},En=(p,w)=>{const C=parseFloat(w)||0;C<=0?ul(p):je(fe.map((q,M)=>M===p?{...q,quantity:C}:q))},ul=p=>{je(fe.filter((w,C)=>C!==p))},ki=p=>{const w=Array.from(p.target.files);if(w.length===0)return;const C=i===-1?1/0:i-qe.length;if(C<=0){m(`Photo limit reached (${i} max)`,"error"),p.target.value="";return}const q=w.slice(0,C);q.length<w.length&&m(`Only ${q.length} photo(s) added (${i} max)`,"error");const M=10*1024*1024;q.forEach($=>{if(!$.type.startsWith("image/")){m("Please select an image file","error");return}if($.size>M){m(`Photo too large: ${$.name} (max 10MB)`,"error");return}const oe=URL.createObjectURL($),he=`photo-${Date.now()}-${sh()}`;J(pe=>[...pe,{id:`${Date.now()}-${sh()}`,tempId:he,file:$,previewUrl:oe,name:$.name,status:"pending",attempts:0,error:null,uploadedUrl:null}])}),p.target.value=""},$t=(p,w)=>{J(C=>C.map(q=>q.id===p?{...q,...w}:q))},Fr=async(p,w)=>{const C=qe.find(q=>q.id===p);if(!(!C||C.status!=="failed")){$t(p,{status:"compressing",error:null});try{let q=C.file;try{q=await nh(C.file)}catch($){console.warn("Compression failed, using original:",$)}$t(p,{status:"uploading"});const M=await _e.uploadPhoto(l,n.id,w,q);$t(p,{status:"confirmed",uploadedUrl:M,attempts:C.attempts+1}),await _e.updateTMTicketPhotos(w,[...qe.filter($=>$.uploadedUrl).map($=>$.uploadedUrl),M]),m("Photo uploaded successfully","success")}catch(q){console.error("Retry failed:",q),$t(p,{status:"failed",error:q.message||"Upload failed",attempts:C.attempts+1}),m("Photo retry failed","error")}}},ba=p=>{const w=qe.find(C=>C.id===p);w?.previewUrl&&URL.revokeObjectURL(w.previewUrl),J(qe.filter(C=>C.id!==p))},Lt=()=>{if(h===1)return Ue.trim().length>0;if(h===2){if(Ie)return va().length>0;{const p=D.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0)),w=I.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0)),C=ce.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0));return p||w||C}}return!0},Ba=D.filter(p=>p&&p.name&&p.name.trim()&&(parseFloat(p.hours)>0||parseFloat(p.overtimeHours)>0)),pr=I.filter(p=>p&&p.name&&p.name.trim()&&(parseFloat(p.hours)>0||parseFloat(p.overtimeHours)>0)),Ca=ce.filter(p=>p&&p.name&&p.name.trim()&&(parseFloat(p.hours)>0||parseFloat(p.overtimeHours)>0)),gr=va(),qa=Ie?gr.length:Ba.length+pr.length+Ca.length,$r=Ie?gr.reduce((p,w)=>p+(w.hours||0),0):[...Ba,...pr,...Ca].reduce((p,w)=>p+parseFloat(w.hours||0),0),qt=Ie?gr.reduce((p,w)=>p+(w.overtime_hours||0),0):[...Ba,...pr,...Ca].reduce((p,w)=>p+parseFloat(w.overtimeHours||0),0);fe.reduce((p,w)=>p+w.quantity,0);const _r=Ie?Object.values(Ct||{}).flat().filter(p=>p&&p.name&&p.name.trim()):[...D.filter(p=>p&&p.name&&p.name.trim()),...I.filter(p=>p&&p.name&&p.name.trim()),...ce.filter(p=>p&&p.name&&p.name.trim())],dl=qa,Ya=_r.length-dl,cs=(()=>{const p=[];return h===1&&(Ue.trim()||p.push(ee==="en"?"Description recommended":"Descripcin recomendada")),h===2&&Ya>0&&p.push(ee==="en"?`${Ya} worker(s) have no hours entered`:`${Ya} trabajador(es) sin horas`),h===4&&(me.trim()||p.push(ee==="en"?"Name required to submit":"Nombre requerido")),p})(),Pr=()=>{h<4&&g(h+1)},Ga=()=>{ct?(Nt(null),Ma(!1)):la?Ma(!1):h>1?g(h-1):d()},zi=async()=>{if(!me.trim()){m("Enter your name to submit","error");return}let p=[];if(Ie){if(p=va(),p.length===0){m("Add at least one worker","error");return}}else{const w=D.filter(M=>M&&M.name&&M.name.trim()&&(parseFloat(M.hours)>0||parseFloat(M.overtimeHours)>0)),C=I.filter(M=>M&&M.name&&M.name.trim()&&(parseFloat(M.hours)>0||parseFloat(M.overtimeHours)>0)),q=ce.filter(M=>M&&M.name&&M.name.trim()&&(parseFloat(M.hours)>0||parseFloat(M.overtimeHours)>0));if(w.length===0&&C.length===0&&q.length===0){m("Add at least one worker","error");return}p=[...w.map(M=>({name:M.name.trim(),hours:parseFloat(M.hours)||0,overtime_hours:parseFloat(M.overtimeHours)||0,time_started:M.timeStarted||null,time_ended:M.timeEnded||null,role:M.role})),...C.map(M=>({name:M.name.trim(),hours:parseFloat(M.hours)||0,overtime_hours:parseFloat(M.overtimeHours)||0,time_started:M.timeStarted||null,time_ended:M.timeEnded||null,role:"Operator"})),...q.map(M=>({name:M.name.trim(),hours:parseFloat(M.hours)||0,overtime_hours:parseFloat(M.overtimeHours)||0,time_started:M.timeStarted||null,time_ended:M.timeEnded||null,role:"Laborer"}))]}ve(!0),Ze("Creating ticket...");try{const w=await _e.createTMTicket({project_id:n.id,work_date:b,ce_pco_number:ne.trim()||null,assigned_cor_id:we||null,notes:Ue.trim()||null,photos:[],created_by_name:me.trim()});if(!w||!w.id)throw new Error("Failed to create ticket - no ticket ID returned");let C=[];const q=qe.filter(M=>M.status==="pending");if(q.length>0){Ze(`Compressing ${q.length} photo${q.length>1?"s":""}...`),q.forEach(Ne=>$t(Ne.id,{status:"compressing"}));const M=await Promise.all(q.map(async Ne=>{try{const ut=await nh(Ne.file);return{...Ne,file:ut}}catch(ut){return console.warn(`Failed to compress photo ${Ne.name}, using original:`,ut),Ne}}));Ze(`Uploading ${q.length} photo${q.length>1?"s":""}...`),q.forEach(Ne=>$t(Ne.id,{status:"uploading"}));let $=0,oe=0;const he=M.map(async Ne=>{try{const ut=await _e.uploadPhoto(l,n.id,w.id,Ne.file);return $++,Ze(`Uploading ${$}/${q.length} photos...`),$t(Ne.id,{status:"confirmed",uploadedUrl:ut,attempts:(Ne.attempts||0)+1}),{id:Ne.id,url:ut}}catch(ut){return console.error(`Photo ${Ne.name} upload failed:`,ut),oe++,$t(Ne.id,{status:"failed",error:ut.message||"Upload failed",attempts:(Ne.attempts||0)+1}),{id:Ne.id,url:null,error:ut.message}}});C=(await Promise.all(he)).filter(Ne=>Ne.url!==null).map(Ne=>Ne.url),oe>0&&C.length>0?m(`${C.length}/${q.length} photos uploaded. ${oe} failed - can retry later.`,"warning"):oe>0&&C.length===0&&m(`All ${oe} photos failed to upload - can retry after submission.`,"error")}if(C.length>0&&(Ze("Saving photos..."),await _e.updateTMTicketPhotos(w.id,C)),Ze("Saving workers..."),await _e.addTMWorkers(w.id,p),fe.length>0&&(Ze("Saving materials..."),await _e.addTMItems(w.id,fe.map(M=>({material_equipment_id:M.material_equipment_id,custom_name:M.custom_name||null,custom_category:M.custom_category||null,quantity:M.quantity})))),we){Ze("Importing to COR...");try{await _e.importTicketDataToCOR(w.id,we,l,n.work_type||"demolition",n.job_type||"standard")}catch(M){console.error("Error importing to COR:",M);try{await _e.markImportFailed(w.id,we,M?.message||"Import failed")}catch($){console.error("Error marking import failed:",$)}m("T&M saved. COR data sync failed - retry from ticket list.","warning")}}qe.forEach(M=>{M.previewUrl&&URL.revokeObjectURL(M.previewUrl)}),S(w),m("T&M submitted!","success"),g(5)}catch(w){console.error("Error submitting T&M:",w),m("Error submitting T&M","error")}finally{ve(!1),Ze("")}};return h===3&&(ct||la)?s.jsxs("div",{className:"tm-wizard",children:[s.jsxs("div",{className:"tm-wizard-header",children:[s.jsx("button",{className:"tm-back-btn",onClick:Ga,children:""}),s.jsx("h2",{children:la?"Add Custom Item":ct}),s.jsxs("div",{className:"tm-item-count",children:[fe.length," items"]})]}),la?s.jsxs("div",{className:"tm-custom-form",children:[s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:"Item Name"}),s.jsx("input",{type:"text",placeholder:"What did you use?",value:jt.name,onChange:p=>Ra({...jt,name:p.target.value}),autoFocus:!0})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:"Category"}),s.jsx("div",{className:"tm-category-select",children:Kc.map(p=>s.jsx("button",{className:`tm-cat-chip ${jt.category===p?"active":""}`,onClick:()=>Ra({...jt,category:p}),children:p},p))})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:"Quantity"}),s.jsx("input",{type:"number",placeholder:"How many?",value:jt.quantity,onChange:p=>Ra({...jt,quantity:p.target.value})})]}),s.jsx("button",{className:"tm-big-btn primary",onClick:Oi,children:"Add Custom Item"})]}):s.jsx("div",{className:"tm-item-grid",children:Yr?s.jsx("div",{className:"tm-loading",children:"Loading..."}):s.jsxs(s.Fragment,{children:[wn.map(p=>{const w=fe.find(C=>C.material_equipment_id===p.id);return s.jsxs("button",{className:`tm-item-card ${w?"added":""}`,onClick:()=>hr(p),children:[s.jsx("span",{className:"tm-item-name",children:p.name}),s.jsx("span",{className:"tm-item-unit",children:p.unit}),w&&s.jsx("span",{className:"tm-item-badge",children:w.quantity})]},p.id)}),s.jsxs("button",{className:"tm-item-card custom",onClick:()=>Ma(!0),children:[s.jsx("span",{className:"tm-item-name",children:"+ Add Other"}),s.jsx("span",{className:"tm-item-unit",children:"Not on list"})]})]})}),!la&&fe.length>0&&s.jsx("div",{className:"tm-wizard-footer",children:s.jsxs("button",{className:"tm-big-btn primary",onClick:()=>Nt(null),children:["Done Adding (",fe.length," items)"]})})]}):s.jsxs("div",{className:"tm-wizard",children:[s.jsxs("div",{className:"tm-wizard-header",children:[h<5?s.jsx("button",{className:"tm-back-btn",onClick:Ga,children:""}):s.jsx("div",{className:"tm-success-check",children:s.jsx(al,{size:24})}),s.jsxs("h2",{children:[h===1&&P("workInfo"),h===2&&P("crewHours"),h===3&&P("materialsEquipment"),h===4&&P("review"),h===5&&(ee==="en"?"Submitted":"Enviado")]}),s.jsxs("div",{className:"tm-header-right",children:[h<4&&s.jsxs("button",{className:"tm-lang-toggle",onClick:()=>Tt(ee==="en"?"es":"en"),title:ee==="en"?"Cambiar a Espaol":"Switch to English",children:[s.jsx(Ng,{size:16}),ee==="en"?"ES":"EN"]}),h<5&&s.jsxs("div",{className:"tm-step-dots",children:[s.jsx("span",{className:`tm-dot ${h>=1?"active":""}`}),s.jsx("span",{className:`tm-dot ${h>=2?"active":""}`}),s.jsx("span",{className:`tm-dot ${h>=3?"active":""}`}),s.jsx("span",{className:`tm-dot ${h>=4?"active":""}`})]})]})]}),h===1&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:"tm-project-info",children:[n.job_number&&s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"Job #"}),s.jsx("span",{className:"tm-project-value",children:n.job_number})]}),s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"Project"}),s.jsx("span",{className:"tm-project-value",children:n.name})]}),n.address&&s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"Address"}),s.jsx("span",{className:"tm-project-value",children:n.address})]}),n.general_contractor&&s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"GC"}),s.jsx("span",{className:"tm-project-value",children:n.general_contractor})]})]}),s.jsxs("div",{className:"tm-field-row",children:[s.jsxs("div",{className:"tm-field tm-field-half",children:[s.jsx("label",{children:"Date"}),s.jsx("input",{type:"date",value:b,onChange:p=>k(p.target.value),className:"tm-date"})]}),s.jsxs("div",{className:"tm-field tm-field-half",children:[s.jsx("label",{children:"CE / PCO #"}),s.jsx("input",{type:"text",placeholder:"Change Event / PCO",value:ne,onChange:p=>ie(p.target.value),className:"tm-input"})]})]}),s.jsxs("div",{className:"tm-field tm-description-field",children:[s.jsxs("label",{children:[s.jsx(ss,{size:16,className:"inline-icon"}),P("describeWork")," ",s.jsx("span",{className:"tm-required",children:"*"})]}),s.jsx("textarea",{placeholder:P("whatWorkPerformed"),value:Ue,onChange:p=>vt(p.target.value),rows:4,className:`tm-description ${Ue.trim()?"":"tm-field-required"}`})]})]}),h===2&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:"tm-crew-summary-bar",children:[s.jsxs("div",{className:"tm-summary-left",children:[s.jsx("span",{className:"tm-summary-count",children:_r.length}),s.jsx("span",{className:"tm-summary-label",children:_r.length===1?P("worker"):P("workers_plural")})]}),s.jsxs("div",{className:"tm-summary-middle",children:[s.jsxs("span",{className:"tm-summary-hours",children:[$r+qt,"h"]}),s.jsx("span",{className:"tm-summary-label",children:"total"})]}),Ya>0&&s.jsxs("div",{className:"tm-summary-warning",children:[s.jsx(Uc,{size:14}),s.jsxs("span",{children:[Ya," ",ee==="en"?"need hours":"sin horas"]})]})]}),s.jsxs("div",{className:"tm-quick-actions-row",children:[s.jsxs("button",{className:"tm-quick-action",onClick:wt,disabled:ya,children:[s.jsx(Eg,{size:16}),s.jsx("span",{children:ya?ee==="en"?"Loading...":"Cargando...":P("sameAsYesterday")})]}),_r.length>0&&s.jsxs("div",{className:"tm-time-presets-inline",children:[s.jsx("button",{className:"tm-preset-chip",onClick:()=>Zr("8hr"),children:"8h"}),s.jsx("button",{className:"tm-preset-chip",onClick:()=>Zr("10hr"),children:"10h"}),s.jsx("button",{className:"tm-preset-chip",onClick:()=>Zr("4hr"),children:"4h"}),s.jsx("button",{className:"tm-preset-chip more",onClick:()=>G(!0),title:ee==="en"?"Custom hours":"Horas personalizadas",children:s.jsx(Ci,{size:14})})]})]}),tt.length>0&&s.jsxs("div",{className:"tm-crew-select-section",children:[s.jsxs("div",{className:"tm-section-header",children:[s.jsxs("h4",{children:[s.jsx(bn,{size:16})," ",ee==="en"?"Select T&M Workers":"Seleccionar Trabajadores T&M"]}),s.jsx("span",{className:"tm-section-hint",children:ee==="en"?"Tap to add":"Toca para agregar"})]}),s.jsx("div",{className:"tm-crew-grid",children:tt.map((p,w)=>{const C=D.some($=>$.name.toLowerCase()===p.name.toLowerCase())||I.some($=>$.name.toLowerCase()===p.name.toLowerCase())||ce.some($=>$.name.toLowerCase()===p.name.toLowerCase()),q=Object.values(Ct).some($=>$.some(oe=>oe.name.toLowerCase()===p.name.toLowerCase())),M=C||q;return s.jsxs("button",{className:`tm-crew-item ${M?"added":""}`,onClick:()=>{if(M)return;if(p.labor_class_id&&Ie&&Mt.some(oe=>oe.id===p.labor_class_id)){Ua.has(p.labor_class_id)||V(pe=>new Set([...pe,p.labor_class_id]));const oe=Ct[p.labor_class_id]||[],he=oe.findIndex(pe=>!pe||!pe.name||!pe.name.trim());if(he>=0){const pe=[...oe];pe[he]={...pe[he],name:p.name},lt(Ne=>({...Ne,[p.labor_class_id]:pe}))}else lt(pe=>({...pe,[p.labor_class_id]:[...pe[p.labor_class_id]||[],{name:p.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}))}else{const oe=(p.role||"").toLowerCase();if(oe.includes("foreman")||oe.includes("supervisor")||oe.includes("superintendent")){const he=D.findIndex(pe=>!pe||!pe.name||!pe.name.trim());he>=0?(Ht(he,"name",p.name),Ht(he,"role",oe.includes("superintendent")?"Superintendent":"Foreman")):Q([...D,{name:p.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:oe.includes("superintendent")?"Superintendent":"Foreman"}])}else if(oe.includes("operator")){const he=I.findIndex(pe=>!pe||!pe.name||!pe.name.trim());he>=0?Ea(he,"name",p.name):Se([...I,{name:p.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}else{const he=ce.findIndex(pe=>!pe||!pe.name||!pe.name.trim());he>=0?mr(he,"name",p.name):He([...ce,{name:p.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}}m(`Added ${p.name}`,"success")},disabled:M,children:[s.jsx("span",{className:"tm-crew-item-name",children:p.name}),s.jsx("span",{className:`tm-crew-item-role ${(p.role||"laborer").toLowerCase()}`,children:p.role||"Laborer"}),M&&s.jsx("span",{className:"tm-crew-item-check",children:""})]},w)})})]}),Ie&&!ia&&s.jsxs(s.Fragment,{children:[Sn.map(p=>{const w=Mt.filter(C=>C.category_id===p.id&&Ua.has(C.id));return w.length===0?null:s.jsxs("div",{className:"tm-labor-category-section",children:[s.jsx("div",{className:"tm-category-header",children:p.name}),w.map(C=>s.jsxs("div",{className:"tm-field",children:[s.jsxs("div",{className:"tm-field-header",children:[s.jsx("label",{children:C.name}),s.jsx("button",{type:"button",className:"tm-remove-class-btn",onClick:()=>os(C.id),title:ee==="en"?"Remove this labor class":"Eliminar esta clase",children:""})]}),s.jsx("div",{className:"tm-workers-list",children:(Ct[C.id]||[]).map((q,M)=>{const $=Vr(q);return s.jsxs("div",{className:`tm-worker-card-expanded ${$!=="empty"?`worker-${$}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[$==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(sr,{size:14})}),s.jsx("input",{type:"text",placeholder:P("firstLastName"),value:q.name,onChange:oe=>Ut(C.id,M,"name",oe.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>La(C.id,M),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("start")}),s.jsx("input",{type:"time",value:q.timeStarted,onChange:oe=>Ut(C.id,M,"timeStarted",oe.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("end")}),s.jsx("input",{type:"time",value:q.timeEnded,onChange:oe=>Ut(C.id,M,"timeEnded",oe.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:q.hours,onChange:oe=>Ut(C.id,M,"hours",oe.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:q.overtimeHours,onChange:oe=>Ut(C.id,M,"overtimeHours",oe.target.value)})]})]})]},M)})}),s.jsxs("button",{className:"tm-add-btn",onClick:()=>Ha(C.id),children:["+ ",ee==="en"?"Add":"Agregar"," ",C.name]})]},C.id))]},p.id)}),Mt.filter(p=>!p.category_id&&Ua.has(p.id)).map(p=>s.jsxs("div",{className:"tm-field",children:[s.jsxs("div",{className:"tm-field-header",children:[s.jsx("label",{children:p.name}),s.jsx("button",{type:"button",className:"tm-remove-class-btn",onClick:()=>os(p.id),title:ee==="en"?"Remove this labor class":"Eliminar esta clase",children:""})]}),s.jsx("div",{className:"tm-workers-list",children:(Ct[p.id]||[]).map((w,C)=>{const q=Vr(w);return s.jsxs("div",{className:`tm-worker-card-expanded ${q!=="empty"?`worker-${q}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[q==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(sr,{size:14})}),s.jsx("input",{type:"text",placeholder:P("firstLastName"),value:w.name,onChange:M=>Ut(p.id,C,"name",M.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>La(p.id,C),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("start")}),s.jsx("input",{type:"time",value:w.timeStarted,onChange:M=>Ut(p.id,C,"timeStarted",M.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("end")}),s.jsx("input",{type:"time",value:w.timeEnded,onChange:M=>Ut(p.id,C,"timeEnded",M.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:w.hours,onChange:M=>Ut(p.id,C,"hours",M.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:w.overtimeHours,onChange:M=>Ut(p.id,C,"overtimeHours",M.target.value)})]})]})]},C)})}),s.jsxs("button",{className:"tm-add-btn",onClick:()=>Ha(p.id),children:["+ ",ee==="en"?"Add":"Agregar"," ",p.name]})]},p.id)),Jr().length>0&&s.jsx("div",{className:"tm-add-labor-class-section",children:s.jsxs("select",{className:"tm-add-labor-class-select",value:"",onChange:p=>{p.target.value&&ht(p.target.value)},children:[s.jsxs("option",{value:"",children:["+ ",ee==="en"?"Add Labor Class...":"Agregar Clase de Trabajo..."]}),Sn.map(p=>{const w=Jr().filter(C=>C.category_id===p.id);return w.length===0?null:s.jsx("optgroup",{label:p.name,children:w.map(C=>s.jsx("option",{value:C.id,children:C.name},C.id))},p.id)}),Jr().filter(p=>!p.category_id).length>0&&s.jsx("optgroup",{label:ee==="en"?"Other":"Otros",children:Jr().filter(p=>!p.category_id).map(p=>s.jsx("option",{value:p.id,children:p.name},p.id))})]})}),Ua.size===0&&s.jsx("div",{className:"tm-no-labor-classes",children:s.jsx("p",{children:ee==="en"?"No labor classes added yet. Select from crew check-in above or add manually:":"No hay clases de trabajo agregadas. Seleccione del check-in o agregue manualmente:"})})]}),ia&&s.jsxs("div",{className:"tm-loading-labor-classes",children:[s.jsx(rl,{size:20,className:"tm-spinner"}),s.jsx("span",{children:ee==="en"?"Loading labor classes...":"Cargando clases de trabajo..."})]}),!Ie&&!ia&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:P("supervision")}),s.jsx("div",{className:"tm-workers-list",children:D.map((p,w)=>{const C=Vr(p);return s.jsxs("div",{className:`tm-worker-card-expanded ${C!=="empty"?`worker-${C}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[C==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(sr,{size:14})}),s.jsx("div",{className:"tm-role-select",children:s.jsxs("select",{value:p.role,onChange:q=>Ht(w,"role",q.target.value),children:[s.jsx("option",{value:"Foreman",children:P("foreman")}),s.jsx("option",{value:"Superintendent",children:P("superintendent")})]})}),s.jsx("input",{type:"text",placeholder:P("firstLastName"),value:p.name,onChange:q=>Ht(w,"name",q.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>is(w),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("start")}),s.jsx("input",{type:"time",value:p.timeStarted,onChange:q=>Ht(w,"timeStarted",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("end")}),s.jsx("input",{type:"time",value:p.timeEnded,onChange:q=>Ht(w,"timeEnded",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.hours,onChange:q=>Ht(w,"hours",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.overtimeHours,onChange:q=>Ht(w,"overtimeHours",q.target.value)})]})]})]},w)})}),s.jsx("button",{className:"tm-add-btn",onClick:Rt,children:P("addSupervision")})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:P("operators")}),s.jsx("div",{className:"tm-workers-list",children:I.map((p,w)=>{const C=Vr(p);return s.jsxs("div",{className:`tm-worker-card-expanded ${C!=="empty"?`worker-${C}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[C==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(sr,{size:14})}),s.jsx("input",{type:"text",placeholder:P("firstLastName"),value:p.name,onChange:q=>Ea(w,"name",q.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>fr(w),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("start")}),s.jsx("input",{type:"time",value:p.timeStarted,onChange:q=>Ea(w,"timeStarted",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("end")}),s.jsx("input",{type:"time",value:p.timeEnded,onChange:q=>Ea(w,"timeEnded",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.hours,onChange:q=>Ea(w,"hours",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.overtimeHours,onChange:q=>Ea(w,"overtimeHours",q.target.value)})]})]})]},w)})}),s.jsx("button",{className:"tm-add-btn",onClick:Kr,children:P("addOperator")})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:P("laborers")}),s.jsx("div",{className:"tm-workers-list",children:ce.map((p,w)=>{const C=Vr(p);return s.jsxs("div",{className:`tm-worker-card-expanded ${C!=="empty"?`worker-${C}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[C==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(sr,{size:14})}),s.jsx("input",{type:"text",placeholder:P("firstLastName"),value:p.name,onChange:q=>mr(w,"name",q.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>cl(w),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("start")}),s.jsx("input",{type:"time",value:p.timeStarted,onChange:q=>mr(w,"timeStarted",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("end")}),s.jsx("input",{type:"time",value:p.timeEnded,onChange:q=>mr(w,"timeEnded",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.hours,onChange:q=>mr(w,"hours",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:P("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.overtimeHours,onChange:q=>mr(w,"overtimeHours",q.target.value)})]})]})]},w)})}),s.jsx("button",{className:"tm-add-btn",onClick:Ai,children:P("addLaborer")})]})]})]}),h===3&&!ct&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:"tm-field tm-search-field",children:[s.jsxs("div",{className:"tm-search-input-wrapper",children:[s.jsx(Cg,{size:18,className:"tm-search-icon"}),s.jsx("input",{ref:Xr,type:"text",placeholder:P("searchMaterials"),value:cr,onChange:p=>Na(p.target.value),onFocus:()=>ol(),className:"tm-search-input"}),cr&&s.jsx("button",{className:"tm-search-clear",onClick:()=>{ur(""),za([])},children:""})]}),cr&&bt.length>0&&s.jsx("div",{className:"tm-search-results",children:bt.map((p,w)=>{const C=fe.find(q=>q.id===p.id);return s.jsxs("button",{className:`tm-search-result-item ${C?"added":""}`,onClick:()=>{C?En(fe.indexOf(C),C.quantity+1):je([...fe,{...p,quantity:1,isCustom:!1}]),ur(""),za([])},children:[s.jsx("span",{className:"tm-search-result-name",children:p.name}),s.jsx("span",{className:"tm-search-result-category",children:p.category}),C&&s.jsxs("span",{className:"tm-search-result-qty",children:["",C.quantity]})]},w)})}),cr&&bt.length===0&&s.jsx("div",{className:"tm-search-no-results",children:P("noSearchResults")})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:P("orBrowse")}),s.jsx("div",{className:"tm-category-grid",children:Kc.map(p=>{const w=fe.filter(C=>C.category===p);return s.jsxs("button",{className:"tm-category-card",onClick:()=>Nt(p),children:[s.jsx("span",{className:"tm-cat-name",children:p}),w.length>0&&s.jsx("span",{className:"tm-cat-count",children:w.length})]},p)})})]}),fe.length>0&&s.jsxs("div",{className:"tm-field",children:[s.jsxs("label",{children:["Added Items (",fe.length,")"]}),s.jsx("div",{className:"tm-added-list",children:fe.map((p,w)=>s.jsxs("div",{className:"tm-added-item",children:[s.jsxs("div",{className:"tm-added-info",children:[p.isCustom&&s.jsx("span",{className:"tm-custom-badge",children:"Custom"}),s.jsx("span",{className:"tm-added-name",children:p.name})]}),s.jsxs("div",{className:"tm-added-qty",children:[s.jsx("button",{onClick:()=>En(w,p.quantity-1),children:""}),s.jsx("span",{children:p.quantity}),s.jsx("button",{onClick:()=>En(w,p.quantity+1),children:"+"})]})]},w))})]})]}),h===4&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:`tm-action-card-prominent ${qe.length>0?"has-content":"needs-action"}`,children:[s.jsxs("div",{className:"tm-action-card-header",children:[s.jsx("div",{className:"tm-action-card-icon",children:s.jsx(Fc,{size:24})}),s.jsxs("div",{className:"tm-action-card-title",children:[s.jsx("h4",{children:ee==="en"?"Photo Evidence":"Evidencia Fotogrfica"}),s.jsx("span",{className:"tm-action-card-status",children:qe.length>0?`${qe.length} ${ee==="en"?"photo(s) added":"foto(s) agregada(s)"}`:ee==="en"?"Recommended for billing":"Recomendado para facturacin"})]})]}),qe.length>0&&s.jsx("div",{className:"tm-photo-preview-row",children:qe.map(p=>s.jsxs("div",{className:"tm-photo-preview-thumb",children:[s.jsx("img",{src:p.previewUrl,alt:p.name}),s.jsx("button",{className:"tm-photo-remove-x",onClick:()=>ba(p.id),children:""})]},p.id))}),s.jsxs("label",{className:`tm-action-card-btn ${qe.length===0?"primary":""}`,children:[s.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:ki,style:{display:"none"}}),s.jsx(Fc,{size:18}),s.jsx("span",{children:qe.length>0?ee==="en"?"Add More Photos":"Agregar Ms Fotos":ee==="en"?"Add Photos":"Agregar Fotos"})]})]}),s.jsxs("div",{className:`tm-action-card-prominent ${we?"has-content":""}`,children:[s.jsxs("div",{className:"tm-action-card-header",children:[s.jsx("div",{className:"tm-action-card-icon cor",children:s.jsx(qg,{size:24})}),s.jsxs("div",{className:"tm-action-card-title",children:[s.jsx("h4",{children:ee==="en"?"Link to Change Order":"Vincular a Orden de Cambio"}),s.jsx("span",{className:"tm-action-card-status",children:we?`${ee==="en"?"Linked to":"Vinculado a"}: ${Ve.find(p=>p.id===we)?.cor_number||""}`:ee==="en"?"Optional - Link this T&M to a COR":"Opcional - Vincular este T&M a un COR"})]})]}),s.jsxs("select",{value:we,onChange:p=>Re(p.target.value),className:"tm-cor-select-prominent",children:[s.jsx("option",{value:"",children:ee==="en"?"-- Select a COR (optional) --":"-- Seleccionar COR (opcional) --"}),Ve.map(p=>s.jsxs("option",{value:p.id,children:[p.cor_number,": ",p.title||"Untitled"," (",p.status,")"]},p.id))]}),Ve.length===0&&s.jsx("p",{className:"tm-cor-hint",children:ee==="en"?"No active CORs available for this project":"No hay CORs activos para este proyecto"})]}),s.jsx("div",{className:"tm-review-divider",children:s.jsx("span",{children:ee==="en"?"Ticket Summary":"Resumen del Ticket"})}),s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[" ",P("workDate")]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(1),children:ee==="en"?"Edit":"Editar"})]}),s.jsxs("div",{className:"tm-review-row",children:[s.jsx("span",{children:new Date(b).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),ne&&s.jsxs("span",{children:["CE/PCO: ",ne]})]})]}),Ue&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(ss,{size:16,className:"inline-icon"})," ",P("notes")]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(1),children:ee==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-notes",children:Ue})]}),Ie&&gr.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(bn,{size:16,className:"inline-icon"})," ",ee==="en"?"Workers":"Trabajadores"," (",$r+qt," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(2),children:ee==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:gr.map((p,w)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsxs("div",{className:"tm-review-worker-name",children:[s.jsx("span",{className:"tm-role-badge",children:p.role})," ",p.name]}),s.jsxs("div",{className:"tm-review-worker-details",children:[p.time_started&&p.time_ended&&s.jsxs("span",{className:"tm-review-time",children:[p.time_started," - ",p.time_ended]}),s.jsxs("span",{className:"tm-review-hours",children:[p.hours||0," reg",p.overtime_hours>0?` + ${p.overtime_hours} OT`:""]})]})]},w))})]}),!Ie&&Ba.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(Dg,{size:16,className:"inline-icon"})," Supervision (",Ba.reduce((p,w)=>p+parseFloat(w.hours||0)+parseFloat(w.overtimeHours||0),0)," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(2),children:ee==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:Ba.map((p,w)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsxs("div",{className:"tm-review-worker-name",children:[s.jsx("span",{className:"tm-role-badge",children:p.role})," ",p.name]}),s.jsxs("div",{className:"tm-review-worker-details",children:[p.timeStarted&&p.timeEnded&&s.jsxs("span",{className:"tm-review-time",children:[p.timeStarted," - ",p.timeEnded]}),s.jsxs("span",{className:"tm-review-hours",children:[p.hours||0," reg",parseFloat(p.overtimeHours)>0?` + ${p.overtimeHours} OT`:""]})]})]},w))})]}),!Ie&&pr.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[" Operators (",pr.reduce((p,w)=>p+parseFloat(w.hours||0)+parseFloat(w.overtimeHours||0),0)," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(2),children:ee==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:pr.map((p,w)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsx("div",{className:"tm-review-worker-name",children:p.name}),s.jsxs("div",{className:"tm-review-worker-details",children:[p.timeStarted&&p.timeEnded&&s.jsxs("span",{className:"tm-review-time",children:[p.timeStarted," - ",p.timeEnded]}),s.jsxs("span",{className:"tm-review-hours",children:[p.hours||0," reg",parseFloat(p.overtimeHours)>0?` + ${p.overtimeHours} OT`:""]})]})]},w))})]}),!Ie&&Ca.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(bn,{size:16,className:"inline-icon"})," Laborers (",Ca.reduce((p,w)=>p+parseFloat(w.hours||0)+parseFloat(w.overtimeHours||0),0)," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(2),children:ee==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:Ca.map((p,w)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsx("div",{className:"tm-review-worker-name",children:p.name}),s.jsxs("div",{className:"tm-review-worker-details",children:[p.timeStarted&&p.timeEnded&&s.jsxs("span",{className:"tm-review-time",children:[p.timeStarted," - ",p.timeEnded]}),s.jsxs("span",{className:"tm-review-hours",children:[p.hours||0," reg",parseFloat(p.overtimeHours)>0?` + ${p.overtimeHours} OT`:""]})]})]},w))})]}),fe.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(Tg,{size:16,className:"inline-icon"})," Materials & Equipment (",fe.length," items)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(3),children:ee==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:fe.map((p,w)=>s.jsxs("div",{className:"tm-review-row",children:[s.jsxs("span",{children:[p.isCustom&&s.jsxs(s.Fragment,{children:[s.jsx(Ag,{size:14,className:"inline-icon"})," "]}),p.name]}),s.jsxs("span",{children:[p.quantity," ",p.unit]})]},w))})]}),s.jsxs("div",{className:"tm-review-section tm-certification",children:[s.jsx("div",{className:"tm-review-header",children:s.jsxs("span",{children:[s.jsx(Hc,{size:16,className:"inline-icon"})," Submitted By"]})}),s.jsx("input",{type:"text",className:"tm-certification-input",placeholder:"Enter your name",value:me,onChange:p=>be(p.target.value)}),s.jsx("p",{className:"tm-certification-note",children:"By submitting, you certify this T&M is accurate."})]})]}),h===5&&B&&s.jsxs("div",{className:"tm-step-content tm-success-step",children:[s.jsxs("div",{className:"tm-success-header",children:[s.jsx("div",{className:"tm-success-icon",children:s.jsx(al,{size:48})}),s.jsx("h2",{children:ee==="en"?"T&M Ticket Submitted!":"Ticket T&M Enviado!"}),s.jsx("p",{className:"tm-success-subtitle",children:ee==="en"?"Your ticket has been saved and is ready for client signature.":"Su ticket ha sido guardado y est listo para la firma del cliente."})]}),s.jsxs("div",{className:"tm-success-summary",children:[s.jsxs("div",{className:"tm-success-stat",children:[s.jsx("span",{className:"tm-success-stat-value",children:qa}),s.jsx("span",{className:"tm-success-stat-label",children:ee==="en"?"Workers":"Trabajadores"})]}),s.jsxs("div",{className:"tm-success-stat",children:[s.jsx("span",{className:"tm-success-stat-value",children:$r+qt}),s.jsx("span",{className:"tm-success-stat-label",children:ee==="en"?"Total Hours":"Horas Total"})]}),s.jsxs("div",{className:"tm-success-stat",children:[s.jsx("span",{className:"tm-success-stat-value",children:new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),s.jsx("span",{className:"tm-success-stat-label",children:ee==="en"?"Work Date":"Fecha"})]})]}),qe.some(p=>p.status==="failed")&&s.jsxs("div",{className:"tm-failed-photos-section",children:[s.jsxs("div",{className:"tm-failed-photos-header",children:[s.jsx(Uc,{size:18}),s.jsx("span",{children:ee==="en"?`${qe.filter(p=>p.status==="failed").length} photo(s) failed to upload`:`${qe.filter(p=>p.status==="failed").length} foto(s) no se subieron`})]}),s.jsx("div",{className:"tm-failed-photos-grid",children:qe.filter(p=>p.status==="failed").map(p=>s.jsxs("div",{className:"tm-failed-photo-item",children:[s.jsx("img",{src:p.previewUrl,alt:p.name}),s.jsx("div",{className:"tm-failed-photo-overlay",children:s.jsx("button",{className:"tm-retry-photo-btn",onClick:()=>Fr(p.id,B.id),disabled:p.status==="uploading"||p.status==="compressing",children:p.status==="uploading"||p.status==="compressing"?s.jsx(rl,{size:16,className:"tm-spinner"}):s.jsxs(s.Fragment,{children:[s.jsx(Yf,{size:16}),s.jsx("span",{children:ee==="en"?"Retry":"Reintentar"})]})})}),p.error&&s.jsxs("div",{className:"tm-failed-photo-error",title:p.error,children:[p.error.substring(0,20),p.error.length>20?"...":""]})]},p.id))}),s.jsxs("button",{className:"tm-retry-all-btn",onClick:async()=>{const p=qe.filter(w=>w.status==="failed");for(const w of p)await Fr(w.id,B.id)},children:[s.jsx(Yf,{size:16}),ee==="en"?"Retry All Failed Photos":"Reintentar Todas las Fotos"]})]}),qe.length>0&&qe.every(p=>p.status==="confirmed")&&s.jsxs("div",{className:"tm-photos-success",children:[s.jsx(sr,{size:16}),s.jsx("span",{children:ee==="en"?`All ${qe.length} photo(s) uploaded successfully`:`${qe.length} foto(s) subidas exitosamente`})]}),s.jsxs("div",{className:"tm-signature-options",children:[s.jsx("h3",{children:ee==="en"?"Get Client Signature":"Obtener Firma del Cliente"}),s.jsx("p",{className:"tm-signature-description",children:ee==="en"?"Have the client sign this T&M ticket to verify the work performed.":"Haga que el cliente firme este ticket T&M para verificar el trabajo realizado."}),U?s.jsxs("div",{className:"tm-signed-confirmation",children:[s.jsx(al,{size:32,className:"tm-signed-icon"}),s.jsx("span",{children:ee==="en"?"Client signature collected!":"Firma del cliente recopilada!"})]}):s.jsxs("div",{className:"tm-signature-buttons",children:[s.jsxs("button",{className:"tm-signature-option-btn primary",onClick:()=>Z(!0),children:[s.jsx("div",{className:"tm-signature-option-icon",children:s.jsx(Hc,{size:24})}),s.jsxs("div",{className:"tm-signature-option-text",children:[s.jsx("span",{className:"tm-signature-option-title",children:ee==="en"?"Sign Now (On-Site)":"Firmar Ahora"}),s.jsx("span",{className:"tm-signature-option-desc",children:ee==="en"?"Client signs on this device":"Cliente firma en este dispositivo"})]})]}),s.jsxs("button",{className:"tm-signature-option-btn",onClick:()=>te(!0),children:[s.jsx("div",{className:"tm-signature-option-icon",children:s.jsx(ch,{size:24})}),s.jsxs("div",{className:"tm-signature-option-text",children:[s.jsx("span",{className:"tm-signature-option-title",children:ee==="en"?"Send Signature Link":"Enviar Enlace"}),s.jsx("span",{className:"tm-signature-option-desc",children:ee==="en"?"Client signs later via link":"Cliente firma despus va enlace"})]})]})]})]})]}),X&&B&&s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"loading",children:"Loading..."}),children:s.jsx(N_,{documentType:"tm_ticket",documentId:B.id,companyId:l,projectId:n.id,documentTitle:`T&M - ${new Date(b).toLocaleDateString()}`,onClose:()=>te(!1),onShowToast:m})}),F&&B&&s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"loading",children:"Loading..."}),children:s.jsx(E_,{ticketId:B.id,ticketSummary:{workDate:b,workerCount:qa,totalHours:$r+qt},lang:ee,onSave:()=>{Z(!1),K(!0)},onClose:()=>Z(!1),onShowToast:m})}),h<5&&s.jsxs("div",{className:"tm-wizard-footer",children:[cs.length>0&&s.jsxs("div",{className:"tm-validation-summary",children:[s.jsx(Uc,{size:16}),s.jsx("span",{children:cs[0]})]}),h===1&&s.jsx("button",{className:"tm-big-btn primary",onClick:Pr,disabled:!Lt(),children:P("nextCrew")}),h===2&&s.jsx(s.Fragment,{children:s.jsxs("button",{className:"tm-big-btn primary",onClick:Pr,disabled:!Lt(),children:[P("nextMaterials")," (",qa," ",P(qa===1?"worker":"workers_plural"),", ",$r+qt," hrs)"]})}),h===3&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{className:"tm-big-btn primary",onClick:Pr,children:[ee==="en"?"Review & Submit":"Revisar y Enviar"," (",fe.length," ",fe.length===1?P("item"):P("items_plural"),")"]}),s.jsx("button",{className:"tm-skip-btn",onClick:Pr,children:P("skipNoMaterials")})]}),h===4&&s.jsx("button",{className:`tm-big-btn submit ${W?"submitting":""} ${me.trim()?"ready":"needs-name"}`,onClick:zi,disabled:W||!me.trim(),children:W?s.jsxs(s.Fragment,{children:[s.jsx(rl,{size:20,className:"tm-spinner"}),s.jsx("span",{className:"tm-submit-text",children:Ge||P("submitting")})]}):me.trim()?s.jsxs(s.Fragment,{children:[s.jsx(sr,{size:20}),s.jsx("span",{children:P("submitTM")})]}):s.jsxs(s.Fragment,{children:[s.jsx(Hc,{size:18}),s.jsx("span",{children:ee==="en"?"Enter name to submit":"Ingrese nombre"})]})})]}),h===5&&s.jsxs("div",{className:"tm-wizard-footer",children:[s.jsxs("button",{className:"tm-big-btn primary",onClick:o,children:[s.jsx(sr,{size:20}),s.jsx("span",{children:ee==="en"?"Done":"Listo"})]}),s.jsx("button",{className:"tm-skip-btn",onClick:o,children:ee==="en"?"Skip signature for now":"Saltar firma por ahora"})]}),R&&s.jsx("div",{className:"tm-modal-overlay",onClick:()=>G(!1),children:s.jsxs("div",{className:"tm-batch-modal",onClick:p=>p.stopPropagation(),children:[s.jsxs("h3",{children:[s.jsx(Ci,{size:18})," ",P("applySameHours")]}),s.jsx("p",{className:"tm-batch-description",children:P("batchDescription")}),s.jsxs("div",{className:"tm-time-presets",children:[s.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>Nn("full"),children:P("preset8hr")}),s.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>Nn("10hr"),children:P("preset10hr")}),s.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>Nn("half"),children:P("preset4hr")})]}),s.jsxs("div",{className:"tm-batch-form",children:[s.jsxs("div",{className:"tm-batch-row",children:[s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:P("timeStarted")}),s.jsx("input",{type:"time",value:de.timeStarted,onChange:p=>{const w=p.target.value,C=Gt(w,de.timeEnded);re({...de,timeStarted:w,...C||{}})}})]}),s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:P("timeEnded")}),s.jsx("input",{type:"time",value:de.timeEnded,onChange:p=>{const w=p.target.value,C=Gt(de.timeStarted,w);re({...de,timeEnded:w,...C||{}})}})]})]}),s.jsxs("div",{className:"tm-batch-row",children:[s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:P("regularHours")}),s.jsx("input",{type:"number",placeholder:"8",value:de.hours,onChange:p=>re({...de,hours:p.target.value})})]}),s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:P("overtimeHours")}),s.jsx("input",{type:"number",placeholder:"0",value:de.overtimeHours,onChange:p=>re({...de,overtimeHours:p.target.value})})]})]})]}),s.jsxs("div",{className:"tm-batch-preview",children:[s.jsxs("strong",{children:[P("willApplyTo"),":"]}),s.jsxs("span",{children:[Ie?Object.values(Ct||{}).flat().filter(p=>p&&p.name&&p.name.trim()).length:[...D.filter(p=>p&&p.name&&p.name.trim()),...I.filter(p=>p&&p.name&&p.name.trim()),...ce.filter(p=>p&&p.name&&p.name.trim())].length," ",P("workers_plural")]})]}),s.jsxs("div",{className:"tm-batch-actions",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>G(!1),children:P("cancel")}),s.jsx("button",{type:"button",className:"btn btn-primary",onClick:ll,disabled:!de.hours&&!de.overtimeHours,children:P("applyToAll")})]})]})})]})}function D_({project:n,companyId:l,onShowToast:i}){const[o,d]=N.useState([]),[m,h]=N.useState(!0),[g,b]=N.useState(!1),[k,B]=N.useState(!1),[S,X]=N.useState({name:"",role:"",labor_class_id:null}),[te,F]=N.useState([]),[Z,U]=N.useState([]),[K,ne]=N.useState(!0),ie=["Foreman","Laborer","Supervisor","Operator"];N.useEffect(()=>{n?.id&&(be(),l?me():ne(!1))},[n?.id,l]);const me=async()=>{try{const R=await _e.getLaborClassesForField(l);F(R.categories||[]),U(R.classes||[]),R.classes&&R.classes.length>0&&X(G=>({...G,role:R.classes[0].name,labor_class_id:R.classes[0].id}))}catch(R){console.error("Error loading labor classes:",R),i?.("Using default roles - custom labor classes unavailable","info")}finally{ne(!1)}},be=async()=>{try{const R=await _e.getCrewCheckin(n.id);R?.workers&&d(R.workers)}catch(R){console.error("Error loading crew:",R)}finally{h(!1)}},we=R=>{const G=Z.find(de=>de.id===R);X(G?{...S,role:G.name,labor_class_id:G.id}:{...S,role:R,labor_class_id:null})},Re=async()=>{if(!S.name.trim()){i("Enter worker name","error");return}if(!S.role){i("Select a role","error");return}if(o.find(R=>R.name.toLowerCase()===S.name.trim().toLowerCase())){i("Worker already added","error");return}b(!0);try{const R=[...o,{name:S.name.trim(),role:S.role,labor_class_id:S.labor_class_id}];await _e.saveCrewCheckin(n.id,R),d(R),X({...S,name:""}),B(!1),i("Crew member added","success")}catch(R){console.error("Error adding worker:",R),i("Error adding crew member","error")}finally{b(!1)}},Ve=async R=>{b(!0);try{const G=o.filter(de=>de.name.toLowerCase()!==R.toLowerCase());await _e.saveCrewCheckin(n.id,G),d(G),i("Crew member removed","success")}catch(G){console.error("Error removing worker:",G),i("Error removing crew member","error")}finally{b(!1)}},Te=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}),nt=()=>{const R={};te.forEach(de=>{R[de.id]={name:de.name,classes:Z.filter(re=>re.category_id===de.id)}});const G=Z.filter(de=>!de.category_id);return G.length>0&&(R.uncategorized={name:"Other",classes:G}),R},Fe=Z.length>0;return m||K?s.jsxs("div",{className:"crew-checkin",children:[s.jsxs("div",{className:"crew-header",children:[s.jsxs("h3",{children:[s.jsx(bn,{size:18,className:"inline-icon"})," Today's Crew"]}),s.jsx("span",{className:"crew-date",children:Te})]}),s.jsx("div",{className:"crew-loading",children:"Loading..."})]}):s.jsxs("div",{className:"crew-checkin",children:[s.jsxs("div",{className:"crew-header",children:[s.jsxs("h3",{children:[s.jsx(bn,{size:18,className:"inline-icon"})," Today's Crew"]}),s.jsx("span",{className:"crew-date",children:Te})]}),o.length===0?s.jsxs("div",{className:"crew-empty",children:[s.jsx("p",{children:"No crew checked in yet"}),s.jsx("p",{className:"crew-empty-hint",children:"Add your crew for the day"})]}):s.jsx("div",{className:"crew-list",children:o.map(R=>s.jsxs("div",{className:"crew-member",children:[s.jsxs("div",{className:"crew-member-info",children:[s.jsx("span",{className:"crew-member-name",children:R.name}),s.jsx("span",{className:`crew-member-role ${(R.role||"laborer").toLowerCase().replace(/\s+/g,"-")}`,children:R.role})]}),s.jsx("button",{className:"crew-remove-btn",onClick:()=>Ve(R.name),disabled:g,children:""})]},R.name))}),k?s.jsxs("div",{className:"crew-add-form",children:[s.jsx("input",{type:"text",value:S.name,onChange:R=>X({...S,name:R.target.value}),placeholder:"Name",autoFocus:!0}),s.jsx("select",{value:S.labor_class_id||S.role,onChange:R=>we(R.target.value),children:Fe?Object.entries(nt()).map(([R,G])=>s.jsx("optgroup",{label:G.name,children:G.classes.map(de=>s.jsx("option",{value:de.id,children:de.name},de.id))},R)):ie.map(R=>s.jsx("option",{value:R,children:R},R))}),s.jsxs("div",{className:"crew-add-buttons",children:[s.jsx("button",{className:"crew-add-confirm",onClick:Re,disabled:g,children:g?"...":"Add"}),s.jsx("button",{className:"crew-add-cancel",onClick:()=>{B(!1),X({name:"",role:Z[0]?.name||"Laborer",labor_class_id:Z[0]?.id||null})},children:"Cancel"})]})]}):s.jsx("button",{className:"crew-add-btn",onClick:()=>B(!0),children:"+ Add Crew Member"}),s.jsxs("div",{className:"crew-count",children:[o.length," ",o.length===1?"person":"people"," on site"]})]})}function T_({project:n,onShowToast:l,onClose:i}){const[o,d]=N.useState(!0),[m,h]=N.useState(!1),[g,b]=N.useState(null),[k,B]=N.useState(""),[S,X]=N.useState("");N.useEffect(()=>{n?.id&&te()},[n?.id]);const te=async()=>{try{const K=await _e.getDailyReport(n.id);if(K)b(K),B(K.field_notes||""),X(K.issues||"");else{const ne=await _e.compileDailyReport(n.id);b({...ne,status:"draft"})}}catch(K){console.error("Error loading report:",K),l("Error loading report","error")}finally{d(!1)}},F=async()=>{if(!v){l("Demo Mode: Report saved locally only - won't reach office","info"),i();return}h(!0);try{await _e.saveDailyReport(n.id,{field_notes:k,issues:S}),await _e.submitDailyReport(n.id,"Field")?(l("Daily report submitted!","success"),i()):l("Report not sent - check connection","error")}catch(K){console.error("Error submitting report:",K),l("Error submitting report","error")}finally{h(!1)}},Z=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});if(o)return s.jsxs("div",{className:"daily-report",children:[s.jsxs("div",{className:"daily-report-header",children:[s.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),s.jsx("h2",{children:"Daily Report"})]}),s.jsx("div",{className:"daily-report-loading",children:"Compiling report..."})]});if(!g)return s.jsxs("div",{className:"daily-report",children:[s.jsxs("div",{className:"daily-report-header",children:[s.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),s.jsx("h2",{children:"Daily Report"})]}),s.jsxs("div",{className:"daily-report-error",children:[s.jsx("p",{children:"Unable to load report data."}),s.jsx("button",{className:"btn btn-secondary",onClick:te,children:"Retry"})]})]});const U=g.status==="submitted";return s.jsxs("div",{className:"daily-report",children:[s.jsxs("div",{className:"daily-report-header",children:[s.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),s.jsxs("div",{children:[s.jsx("h2",{children:"Daily Report"}),s.jsx("p",{className:"daily-report-date",children:Z})]})]}),U&&s.jsxs("div",{className:"daily-report-submitted-banner",children:[" Submitted ",new Date(g.submitted_at).toLocaleTimeString()]}),s.jsxs("div",{className:"daily-report-content",children:[s.jsxs("div",{className:"daily-report-summary",children:[s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:g.crew_count||0}),s.jsx("div",{className:"daily-report-card-label",children:"Crew on Site"})]}),s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:g.tasks_completed||0}),s.jsx("div",{className:"daily-report-card-label",children:"Tasks Done"})]}),s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:g.tm_tickets_count||0}),s.jsx("div",{className:"daily-report-card-label",children:"T&M Tickets"})]}),s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:g.photos_count||0}),s.jsx("div",{className:"daily-report-card-label",children:"Photos"})]})]}),g.crew_list?.length>0&&s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(bn,{size:18,className:"inline-icon"})," Crew"]}),s.jsx("div",{className:"daily-report-crew",children:g.crew_list.map((K,ne)=>s.jsxs("div",{className:"daily-report-crew-item",children:[s.jsx("span",{children:K.name}),s.jsx("span",{className:"daily-report-crew-role",children:K.role})]},ne))})]}),g.completed_tasks?.length>0&&s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(Og,{size:18,className:"inline-icon"})," Completed Today"]}),s.jsx("ul",{className:"daily-report-tasks",children:g.completed_tasks.map((K,ne)=>s.jsxs("li",{children:[K.name,K.group&&s.jsx("span",{className:"daily-report-task-group",children:K.group})]},ne))})]}),s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(ss,{size:18,className:"inline-icon"})," Notes"]}),s.jsx("textarea",{value:k,onChange:K=>B(K.target.value),placeholder:"Any notes about today's work...",rows:3,disabled:U})]}),s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(Di,{size:18,className:"inline-icon"})," Issues / Concerns"]}),s.jsx("textarea",{value:S,onChange:K=>X(K.target.value),placeholder:"Any problems, delays, or concerns...",rows:3,disabled:U})]})]}),!U&&s.jsxs("div",{className:"daily-report-footer",children:[s.jsx("button",{className:"btn btn-primary daily-report-submit",onClick:F,disabled:m,children:m?"Submitting...":s.jsxs(s.Fragment,{children:[s.jsx(kg,{size:16,className:"inline-icon"})," Submit Report"]})}),s.jsx("p",{className:"daily-report-hint",children:"This will be sent to the office"})]})]})}function A_({project:n,companyId:l,user:i,onClose:o,onReportCreated:d}){const[m,h]=N.useState(!1),[g,b]=N.useState(null),[k,B]=N.useState(1),[S,X]=N.useState(new Date().toISOString().split("T")[0]),[te,F]=N.useState(new Date().toTimeString().split(" ")[0].substring(0,5)),[Z,U]=N.useState(""),[K,ne]=N.useState(""),[ie,me]=N.useState("minor"),[be,we]=N.useState(""),[Re,Ve]=N.useState(""),[Te,nt]=N.useState(""),[Fe,R]=N.useState(""),[G,de]=N.useState(""),[re,D]=N.useState(""),[Q,I]=N.useState(""),[Se,ce]=N.useState(i?.name||""),[He,fe]=N.useState(""),[je,Ue]=N.useState(""),[vt,qe]=N.useState(i?.email||""),[J,W]=N.useState([]),[ve,Ge]=N.useState(""),[Ze,tt]=N.useState(""),[ft,Qe]=N.useState(""),[Yt,ct]=N.useState(""),[Nt,wn]=N.useState(!1),[or,Yr]=N.useState(""),[ka,cr]=N.useState(""),[ur,bt]=N.useState(!1),[za,Gr]=N.useState(""),[Qr,la]=N.useState(""),[Ma,jt]=N.useState(""),[Ra,Xr]=N.useState(""),[ya,Et]=N.useState(!1),[ee,Tt]=N.useState(!1),[P,Sn]=N.useState(0),[xn,Mt]=N.useState(0),dr=()=>{if(!ve.trim()){b({type:"error",message:"Please enter witness name"});return}const V={name:ve,phone:Ze,email:ft,testimony:Yt};W([...J,V]),Ge(""),tt(""),Qe(""),ct(""),b({type:"success",message:"Witness added"})},Ct=V=>{W(J.filter((Ie,Gt)=>Gt!==V))},lt=V=>{switch(V){case 1:if(!Z.trim()||!K.trim())return b({type:"error",message:"Please fill in all incident details"}),!1;break;case 2:if(!Re.trim()||!re.trim())return b({type:"error",message:"Please fill in employee name and job title"}),!1;break;case 3:if(!Se.trim()||!He.trim())return b({type:"error",message:"Please fill in supervisor name and title"}),!1;break}return!0},ia=()=>{lt(k)&&B(k+1)},xa=()=>{B(k-1)},Ua=async()=>{if(lt(k)){if(!v){b({type:"info",message:"Demo Mode: Report saved locally only - won't reach office"}),setTimeout(()=>{o()},1500);return}h(!0);try{const V={project_id:n.id,company_id:l,incident_date:S,incident_time:te,incident_location:Z,incident_description:K,injury_type:ie,body_part_affected:be||null,employee_name:Re,employee_phone:Te||null,employee_email:Fe||null,employee_address:G||null,employee_job_title:re,employee_hire_date:Q||null,medical_treatment_required:Nt,medical_facility_name:or||null,medical_facility_address:ka||null,hospitalized:ur,reported_by_name:Se,reported_by_title:He,reported_by_phone:je||null,reported_by_email:vt||null,witnesses:J,immediate_actions_taken:za||null,corrective_actions_planned:Qr||null,safety_equipment_used:Ma||null,safety_equipment_failed:Ra||null,osha_recordable:ya,workers_comp_claim:ee,days_away_from_work:parseInt(P)||0,restricted_work_days:parseInt(xn)||0,status:"reported",created_by:i?.id},Ie=await _e.createInjuryReport(V);b({type:"success",message:"Injury report submitted successfully"}),d&&d(Ie),setTimeout(()=>{o()},1500)}catch(V){console.error("Error submitting injury report:",V),b({type:"error",message:"Failed to submit injury report"})}finally{h(!1)}}};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"modal-overlay",onClick:o,children:s.jsxs("div",{className:"modal-content injury-report-modal",onClick:V=>V.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h2",{children:"Workplace Injury/Incident Report"}),s.jsx("button",{className:"close-btn",onClick:o,children:""})]}),s.jsxs("div",{className:"progress-steps",children:[s.jsx("div",{className:`step ${k>=1?"active":""}`,children:"1. Incident"}),s.jsx("div",{className:`step ${k>=2?"active":""}`,children:"2. Employee"}),s.jsx("div",{className:`step ${k>=3?"active":""}`,children:"3. Supervisor"}),s.jsx("div",{className:`step ${k>=4?"active":""}`,children:"4. Witnesses"}),s.jsx("div",{className:`step ${k>=5?"active":""}`,children:"5. Medical & Safety"})]}),s.jsxs("div",{className:"modal-body",children:[k===1&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Incident Details"}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Date of Incident *"}),s.jsx("input",{type:"date",value:S,onChange:V=>X(V.target.value),max:new Date().toISOString().split("T")[0]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Time of Incident *"}),s.jsx("input",{type:"time",value:te,onChange:V=>F(V.target.value)})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Location on Site *"}),s.jsx("input",{type:"text",value:Z,onChange:V=>U(V.target.value),placeholder:"e.g., Floor 2, near elevator shaft"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Incident Description *"}),s.jsx("textarea",{value:K,onChange:V=>ne(V.target.value),rows:4,placeholder:"Describe what happened in detail..."})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Injury Type *"}),s.jsxs("select",{value:ie,onChange:V=>me(V.target.value),children:[s.jsx("option",{value:"minor",children:"Minor Injury"}),s.jsx("option",{value:"serious",children:"Serious Injury"}),s.jsx("option",{value:"critical",children:"Critical Injury"}),s.jsx("option",{value:"near_miss",children:"Near Miss (No Injury)"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Body Part Affected"}),s.jsx("input",{type:"text",value:be,onChange:V=>we(V.target.value),placeholder:"e.g., Left hand, lower back"})]})]})]}),k===2&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Injured Employee Information"}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Full Name *"}),s.jsx("input",{type:"text",value:Re,onChange:V=>Ve(V.target.value),placeholder:"First and last name"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Phone Number"}),s.jsx("input",{type:"tel",value:Te,onChange:V=>nt(V.target.value),placeholder:"(555) 123-4567"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Email Address"}),s.jsx("input",{type:"email",value:Fe,onChange:V=>R(V.target.value),placeholder:"email@example.com"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Home Address"}),s.jsx("input",{type:"text",value:G,onChange:V=>de(V.target.value),placeholder:"Street address, city, state, zip"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Job Title *"}),s.jsx("input",{type:"text",value:re,onChange:V=>D(V.target.value),placeholder:"e.g., Carpenter, Electrician"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Hire Date"}),s.jsx("input",{type:"date",value:Q,onChange:V=>I(V.target.value)})]})]})]}),k===3&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Foreman/Supervisor Making Report"}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Name *"}),s.jsx("input",{type:"text",value:Se,onChange:V=>ce(V.target.value),placeholder:"Full name"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Title *"}),s.jsx("input",{type:"text",value:He,onChange:V=>fe(V.target.value),placeholder:"e.g., Site Foreman, Project Manager"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Phone Number"}),s.jsx("input",{type:"tel",value:je,onChange:V=>Ue(V.target.value),placeholder:"(555) 123-4567"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Email Address"}),s.jsx("input",{type:"email",value:vt,onChange:V=>qe(V.target.value),placeholder:"email@example.com"})]})]}),k===4&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Witness Testimonies (Optional)"}),J.length>0&&s.jsx("div",{className:"witnesses-list",children:J.map((V,Ie)=>s.jsxs("div",{className:"witness-item",children:[s.jsxs("div",{className:"witness-info",children:[s.jsx("strong",{children:V.name}),V.phone&&s.jsxs("span",{children:["  ",V.phone]}),V.testimony&&s.jsxs("p",{className:"witness-testimony",children:['"',V.testimony,'"']})]}),s.jsx("button",{className:"btn-danger btn-small",onClick:()=>Ct(Ie),children:"Remove"})]},Ie))}),s.jsxs("div",{className:"add-witness-form",children:[s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Witness Name"}),s.jsx("input",{type:"text",value:ve,onChange:V=>Ge(V.target.value),placeholder:"Full name"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Phone Number"}),s.jsx("input",{type:"tel",value:Ze,onChange:V=>tt(V.target.value),placeholder:"(555) 123-4567"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Email Address"}),s.jsx("input",{type:"email",value:ft,onChange:V=>Qe(V.target.value),placeholder:"email@example.com"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Witness Testimony"}),s.jsx("textarea",{value:Yt,onChange:V=>ct(V.target.value),rows:3,placeholder:"What did the witness see or hear?"})]}),s.jsx("button",{className:"btn-secondary",onClick:dr,children:"+ Add Witness"})]})]}),k===5&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Medical Treatment & Safety"}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:Nt,onChange:V=>wn(V.target.checked)}),"Medical treatment required"]})}),Nt&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Medical Facility Name"}),s.jsx("input",{type:"text",value:or,onChange:V=>Yr(V.target.value),placeholder:"Hospital or clinic name"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Medical Facility Address"}),s.jsx("input",{type:"text",value:ka,onChange:V=>cr(V.target.value),placeholder:"Street address"})]}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:ur,onChange:V=>bt(V.target.checked)}),"Employee was hospitalized"]})})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Immediate Actions Taken"}),s.jsx("textarea",{value:za,onChange:V=>Gr(V.target.value),rows:2,placeholder:"What was done immediately after the incident?"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Corrective Actions Planned"}),s.jsx("textarea",{value:Qr,onChange:V=>la(V.target.value),rows:2,placeholder:"What will be done to prevent this in the future?"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Safety Equipment Used"}),s.jsx("input",{type:"text",value:Ma,onChange:V=>jt(V.target.value),placeholder:"e.g., Hard hat, gloves, harness"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Safety Equipment Failed"}),s.jsx("input",{type:"text",value:Ra,onChange:V=>Xr(V.target.value),placeholder:"Equipment that failed, if any"})]})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Days Away From Work"}),s.jsx("input",{type:"number",min:"0",value:P,onChange:V=>Sn(V.target.value)})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Restricted Work Days"}),s.jsx("input",{type:"number",min:"0",value:xn,onChange:V=>Mt(V.target.value)})]})]}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:ya,onChange:V=>Et(V.target.checked)}),"OSHA Recordable Incident"]})}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:ee,onChange:V=>Tt(V.target.checked)}),"Workers' Compensation Claim Filed"]})})]})]}),s.jsx("div",{className:"modal-footer",children:s.jsxs("div",{className:"form-actions",children:[k>1&&s.jsx("button",{className:"btn-secondary",onClick:xa,children:" Back"}),s.jsx("button",{className:"btn-secondary",onClick:o,children:"Cancel"}),k<5?s.jsx("button",{className:"btn-primary",onClick:ia,children:"Next "}):s.jsx("button",{className:"btn-primary",onClick:Ua,disabled:m,children:m?"Submitting...":"Submit Report"})]})})]})}),g&&s.jsx(yn,{message:g.message,type:g.type,onClose:()=>b(null)}),s.jsx("style",{children:`
        .injury-report-modal {
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid var(--border-color);
          background-color: var(--bg-elevated);
          overflow-x: auto;
        }

        .progress-steps .step {
          font-size: 0.875rem;
          color: var(--text-muted);
          font-weight: 500;
          white-space: nowrap;
          padding: 0.5rem;
        }

        .progress-steps .step.active {
          color: var(--accent-primary);
          font-weight: 600;
        }

        .form-step h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          color: var(--text-primary);
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 1rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-group textarea {
          resize: vertical;
        }

        .checkbox-group label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: normal;
          cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
          width: auto;
          margin: 0;
        }

        .witnesses-list {
          margin-bottom: 1.5rem;
        }

        .witness-item {
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .witness-info {
          flex: 1;
          color: var(--text-primary);
        }

        .witness-testimony {
          margin-top: 0.5rem;
          color: var(--text-secondary);
          font-style: italic;
          font-size: 0.875rem;
        }

        .add-witness-form {
          border: 2px dashed var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          background-color: var(--bg-elevated);
        }

        .modal-footer {
          border-top: 1px solid var(--border-color);
          padding: 1rem 1.5rem;
        }

        .form-actions {
          display: flex;
          justify-content: space-between;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
        }

        @media (max-width: 768px) {
          .injury-report-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }

          .form-row {
            grid-template-columns: 1fr;
          }

          .progress-steps .step {
            font-size: 0.75rem;
            padding: 0.25rem;
          }
        }
      `})]})}const Ei=[{value:"concrete",label:"Concrete",icon:""},{value:"trash",label:"Trash",icon:""},{value:"metals",label:"Metals",icon:""},{value:"hazardous_waste",label:"Hazardous",icon:""}],O_=n=>Ei.find(l=>l.value===n)||{label:n,icon:""};function k_({project:n,user:l=null,date:i,onShowToast:o}){const[d,m]=N.useState([]),[h,g]=N.useState([]),[b,k]=N.useState(!0),[B,S]=N.useState(!1),[X,te]=N.useState(!1),[F,Z]=N.useState(!1),[U,K]=N.useState({type:"concrete",count:1}),ne=new Date(i).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});N.useEffect(()=>{ie(),me()},[n.id,i]);const ie=async()=>{try{k(!0);const R=await _e.getDisposalLoads(n.id,i);m(R||[])}catch(R){console.error("Error loading disposal loads:",R)}finally{k(!1)}},me=async()=>{try{const G=(await _e.getDisposalLoadsHistory(n.id,14)||[]).filter(re=>re.load_date!==i).reduce((re,D)=>(re[D.load_date]||(re[D.load_date]=[]),re[D.load_date].push(D),re),{}),de=Object.entries(G).map(([re,D])=>({date:re,loads:D,totalLoads:D.reduce((Q,I)=>Q+I.load_count,0)})).sort((re,D)=>new Date(D.date)-new Date(re.date));g(de)}catch(R){console.error("Error loading disposal history:",R)}},be=async()=>{if(!(U.count<1)){S(!0);try{await _e.addDisposalLoad(n.id,l?.id||null,i,U.type,U.count),await ie(),K({type:"concrete",count:1}),te(!1),o?.("Disposal load added","success")}catch(R){console.error("Error adding disposal load:",R),o?.("Error adding load","error")}finally{S(!1)}}},we=async R=>{S(!0);try{await _e.deleteDisposalLoad(R),await ie(),o?.("Load removed","success")}catch(G){console.error("Error deleting disposal load:",G),o?.("Error removing load","error")}finally{S(!1)}},Re=async R=>{S(!0);try{await _e.addDisposalLoad(n.id,l?.id||null,i,R,1),await ie(),o?.("Load added","success")}catch(G){console.error("Error adding disposal load:",G),o?.("Error adding load","error")}finally{S(!1)}},Ve=async R=>{S(!0);try{await _e.updateDisposalLoad(R.id,R.load_type,R.load_count+1),await ie()}catch(G){console.error("Error updating load:",G),o?.("Error updating load","error")}finally{S(!1)}},Te=async R=>{if(R.load_count<=1){await we(R.id);return}S(!0);try{await _e.updateDisposalLoad(R.id,R.load_type,R.load_count-1),await ie()}catch(G){console.error("Error updating load:",G),o?.("Error updating load","error")}finally{S(!1)}},nt=d.reduce((R,G)=>(R[G.load_type]||(R[G.load_type]={items:[],total:0}),R[G.load_type].items.push(G),R[G.load_type].total+=G.load_count,R),{}),Fe=d.reduce((R,G)=>R+G.load_count,0);return b?s.jsxs("div",{className:"disposal-load-input",children:[s.jsxs("div",{className:"disposal-header",children:[s.jsx($c,{size:20}),s.jsx("span",{children:"Disposal Loads"})]}),s.jsx("div",{className:"disposal-loading",children:"Loading..."})]}):s.jsxs("div",{className:"disposal-load-input",children:[s.jsxs("div",{className:"disposal-header",children:[s.jsxs("div",{className:"disposal-title",children:[s.jsx($c,{size:20}),s.jsx("span",{children:"Disposal Loads"}),Fe>0&&s.jsx("span",{className:"disposal-badge",children:Fe})]}),s.jsx("span",{className:"disposal-date",children:ne})]}),s.jsx("div",{className:"disposal-quick-add",children:Ei.map(R=>s.jsxs("button",{className:"quick-add-btn",onClick:()=>Re(R.value),disabled:B,children:[s.jsx("span",{className:"quick-add-icon",children:R.icon}),s.jsxs("span",{className:"quick-add-label",children:["+ ",R.label]})]},R.value))}),Object.keys(nt).length>0?s.jsx("div",{className:"disposal-loads-list",children:Ei.map(R=>{const G=nt[R.value];return G?s.jsxs("div",{className:"disposal-load-row",children:[s.jsxs("div",{className:"load-info",children:[s.jsx("span",{className:"load-icon",children:R.icon}),s.jsx("span",{className:"load-label",children:R.label})]}),s.jsxs("div",{className:"load-controls",children:[s.jsx("button",{className:"load-btn decrement",onClick:()=>Te(G.items[0]),disabled:B,children:s.jsx(Gf,{size:16})}),s.jsx("span",{className:"load-count",children:G.total}),s.jsx("button",{className:"load-btn increment",onClick:()=>Ve(G.items[0]),disabled:B,children:s.jsx(Lc,{size:16})})]})]},R.value):null})}):s.jsxs("div",{className:"disposal-empty",children:[s.jsxs("p",{children:["No disposal loads recorded for ",ne]}),s.jsx("p",{className:"disposal-hint",children:"Tap a button above to add loads"})]}),X&&s.jsxs("div",{className:"disposal-add-form",children:[s.jsxs("div",{className:"add-form-row",children:[s.jsx("select",{value:U.type,onChange:R=>K({...U,type:R.target.value}),className:"load-type-select",children:Ei.map(R=>s.jsxs("option",{value:R.value,children:[R.icon," ",R.label]},R.value))}),s.jsxs("div",{className:"count-input-group",children:[s.jsx("button",{className:"count-btn",onClick:()=>K({...U,count:Math.max(1,U.count-1)}),children:s.jsx(Gf,{size:16})}),s.jsx("input",{type:"number",min:"1",value:U.count,onChange:R=>K({...U,count:parseInt(R.target.value)||1}),className:"count-input"}),s.jsx("button",{className:"count-btn",onClick:()=>K({...U,count:U.count+1}),children:s.jsx(Lc,{size:16})})]})]}),s.jsxs("div",{className:"add-form-actions",children:[s.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>te(!1),children:[s.jsx(zg,{size:16})," Cancel"]}),s.jsxs("button",{className:"btn btn-primary btn-small",onClick:be,disabled:B,children:[s.jsx(sr,{size:16})," Add"]})]})]}),!X&&s.jsxs("button",{className:"disposal-add-custom",onClick:()=>te(!0),children:[s.jsx(Lc,{size:16}),"Add multiple loads"]}),Fe>0&&s.jsxs("div",{className:"disposal-summary",children:[s.jsx("strong",{children:Fe})," total load",Fe!==1?"s":""," today"]}),h.length>0&&s.jsxs("div",{className:"disposal-history-section",children:[s.jsxs("button",{className:"disposal-history-toggle",onClick:()=>Z(!F),children:[s.jsx(Mg,{size:16}),s.jsxs("span",{children:["View History (",h.length," days)"]}),F?s.jsx(Rg,{size:16}):s.jsx(uh,{size:16})]}),F&&s.jsx("div",{className:"disposal-history-list",children:h.map(R=>{const G=new Date(R.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),de=R.loads.reduce((re,D)=>(re[D.load_type]||(re[D.load_type]=0),re[D.load_type]+=D.load_count,re),{});return s.jsxs("div",{className:"disposal-history-day",children:[s.jsxs("div",{className:"disposal-history-header",children:[s.jsx("span",{className:"disposal-history-date",children:G}),s.jsxs("span",{className:"disposal-history-total",children:[R.totalLoads," load",R.totalLoads!==1?"s":""]})]}),s.jsx("div",{className:"disposal-history-types",children:Object.entries(de).map(([re,D])=>{const Q=O_(re);return s.jsxs("span",{className:"disposal-history-type",children:[Q.icon," ",D," ",Q.label]},re)})})]},R.date)})})]})]})}const lh={folder:el,plans:Bg,specs:ss,permits:Lg,contracts:Hg,submittals:ch,rfis:Ug,photos:Fc,reports:dh,safety:Di},xi={blue:"#3b82f6",green:"#10b981",yellow:"#f59e0b",red:"#ef4444",purple:"#8b5cf6",pink:"#ec4899",gray:"#6b7280",orange:"#f97316"},z_=n=>n?.startsWith("image/")?Gg:n?.includes("spreadsheet")||n?.includes("excel")?Qg:n?.includes("pdf")?ss:Xg,M_=n=>{if(!n)return"0 B";const l=["B","KB","MB","GB"];let i=n,o=0;for(;i>=1024&&o<l.length-1;)i/=1024,o++;return`${i.toFixed(i<10?1:0)} ${l[o]}`};function R_({projectId:n,onShowToast:l}){const[i,o]=N.useState([]),[d,m]=N.useState(!0),[h,g]=N.useState(null),[b,k]=N.useState([]),[B,S]=N.useState(!1);N.useEffect(()=>{X()},[n]);const X=async()=>{m(!0);try{const U=await _e.getProjectFolders(n);o(U)}catch(U){console.error("Error loading folders:",U),l?.("Failed to load folders","error")}finally{m(!1)}},te=async U=>{g(U),S(!0);try{const K=await _e.getFolderDocuments(U.id);k(K.documents)}catch(K){console.error("Error loading documents:",K),l?.("Failed to load documents","error")}finally{S(!1)}},F=async U=>{try{await _e.logDocumentAccess(U.id,"downloaded");const K=U.url||`https://cegifnrcwdilromcyouq.supabase.co/storage/v1/object/public/project-documents/${U.storage_path}`;window.open(K,"_blank")}catch(K){console.error("Download error:",K)}},Z=()=>{g(null),k([])};if(d)return s.jsx("div",{className:"field-docs",children:s.jsxs("div",{className:"field-docs-loading",children:[s.jsx(rl,{size:24,className:"spinner"}),s.jsx("span",{children:"Loading..."})]})});if(h){const U=lh[h.icon]||el,K=xi[h.color]||xi.blue;return s.jsxs("div",{className:"field-docs",children:[s.jsxs("div",{className:"field-docs-header",children:[s.jsx("button",{className:"field-docs-back",onClick:Z,children:s.jsx(ns,{size:20})}),s.jsxs("div",{className:"field-docs-title",children:[s.jsx("div",{className:"field-docs-title-icon",style:{backgroundColor:`${K}15`},children:s.jsx(U,{size:20,style:{color:K}})}),s.jsxs("div",{className:"field-docs-title-text",children:[s.jsx("h2",{children:h.name}),s.jsxs("span",{children:[b.length," files"]})]})]})]}),s.jsx("div",{className:"field-docs-list",children:B?s.jsxs("div",{className:"field-docs-loading",children:[s.jsx(rl,{size:24,className:"spinner"}),s.jsx("span",{children:"Loading..."})]}):b.length===0?s.jsxs("div",{className:"field-docs-empty",children:[s.jsx(el,{size:48,style:{color:K,opacity:.3}}),s.jsx("p",{children:"No documents yet"})]}):b.map(ne=>{const ie=z_(ne.mime_type);return s.jsxs("button",{className:"field-doc-item",onClick:()=>F(ne),children:[s.jsx("div",{className:"field-doc-icon",children:s.jsx(ie,{size:22})}),s.jsxs("div",{className:"field-doc-info",children:[s.jsx("span",{className:"field-doc-name",children:ne.name}),s.jsx("span",{className:"field-doc-size",children:M_(ne.file_size_bytes)})]}),s.jsx(Yg,{size:20,className:"field-doc-download"})]},ne.id)})})]})}return s.jsx("div",{className:"field-docs",children:s.jsx("div",{className:"field-docs-grid",children:i.length===0?s.jsxs("div",{className:"field-docs-empty",children:[s.jsx(el,{size:56}),s.jsx("h3",{children:"No documents"}),s.jsx("p",{children:"Documents will appear here when added"})]}):i.map(U=>{const K=lh[U.icon]||el,ne=xi[U.color]||xi.blue,ie=U.document_count||0;return s.jsxs("button",{className:"field-folder-card",onClick:()=>te(U),children:[s.jsx("div",{className:"field-folder-icon",style:{backgroundColor:`${ne}12`},children:s.jsx(K,{size:28,style:{color:ne}})}),s.jsxs("div",{className:"field-folder-info",children:[s.jsx("span",{className:"field-folder-name",children:U.name}),s.jsxs("span",{className:"field-folder-count",children:[ie," ",ie===1?"file":"files"]})]}),s.jsx(mh,{size:20,className:"field-folder-arrow"})]},U.id)})})})}function U_({project:n,companyId:l,onShowToast:i,onExit:o}){const[d,m]=N.useState([]),[h,g]=N.useState(!0),[b,k]=N.useState(null),[B,S]=N.useState({}),[X,te]=N.useState("home"),[F,Z]=N.useState(!1),[U,K]=N.useState(()=>typeof window<"u"?document.documentElement.getAttribute("data-theme")==="dark":!1);N.useEffect(()=>{n?.id&&ne()},[n?.id]);const ne=async()=>{try{const G=await _e.getAreas(n.id);m(G);const de=[...new Set(G.map(D=>D.group_name||"General"))],re={};de.forEach(D=>re[D]=!1),S(re)}catch(G){console.error("Error loading areas:",G),i?.("Error loading areas","error")}finally{g(!1)}},ie=async(G,de)=>{const re=d.find(Q=>Q.id===G);if(!re)return;const D=re.status===de?"not_started":de;k(G);try{await _e.updateAreaStatus(G,D),m(Q=>Q.map(I=>I.id===G?{...I,status:D}:I))}catch(Q){console.error("Error updating status:",Q),i?.("Error updating","error")}finally{k(null)}},me=G=>{S(de=>({...de,[G]:!de[G]}))},be=()=>{const G=U?"light":"dark";document.documentElement.setAttribute("data-theme",G),localStorage.setItem("theme",G),K(!U)},we=w_(d),Re=d.filter(G=>G.status==="done").length,Ve=d.filter(G=>G.status==="working").length,Te=d.length-Re,nt=d.reduce((G,de)=>{const re=de.group_name||"General";return G[re]||(G[re]=[]),G[re].push(de),G},{}),Fe=Object.keys(nt).length>1||Object.keys(nt).length===1&&!nt.General,R=G=>`${G.filter(re=>re.status==="done").length}/${G.length}`;return X==="tm"?s.jsx("div",{className:"fm-view",children:s.jsx(q_,{project:n,companyId:l,onSubmit:()=>te("home"),onCancel:()=>te("home"),onShowToast:i})}):X==="report"?s.jsx(T_,{project:n,onShowToast:i,onClose:()=>te("home")}):X==="injury"?s.jsx("div",{className:"fm-view",children:s.jsx(A_,{project:n,companyId:l,onClose:()=>te("home"),onReportCreated:()=>{te("home"),i?.("Injury report submitted","success")}})}):X==="crew"?s.jsxs("div",{className:"fm-view",children:[s.jsxs("div",{className:"fm-subheader",children:[s.jsx("button",{className:"fm-back",onClick:()=>te("home"),children:s.jsx(ns,{size:20})}),s.jsx("h2",{children:"Crew Check-in"})]}),s.jsx(D_,{project:n,companyId:l,onShowToast:i})]}):X==="disposal"?s.jsxs("div",{className:"fm-view",children:[s.jsxs("div",{className:"fm-subheader",children:[s.jsx("button",{className:"fm-back",onClick:()=>te("home"),children:s.jsx(ns,{size:20})}),s.jsx("h2",{children:"Disposal Loads"})]}),s.jsx(k_,{project:n,date:new Date().toISOString().split("T")[0],onShowToast:i})]}):X==="docs"?s.jsxs("div",{className:"fm-view",children:[s.jsxs("div",{className:"fm-subheader",children:[s.jsx("button",{className:"fm-back",onClick:()=>te("home"),children:s.jsx(ns,{size:20})}),s.jsx("h2",{children:"Documents"})]}),s.jsx(R_,{projectId:n.id,onShowToast:i})]}):X==="progress"?s.jsxs("div",{className:"fm-view",children:[s.jsxs("div",{className:"fm-subheader",children:[s.jsx("button",{className:"fm-back",onClick:()=>te("home"),children:s.jsx(ns,{size:20})}),s.jsx("h2",{children:"Progress"}),s.jsxs("span",{className:"fm-subheader-badge",children:[we,"%"]})]}),s.jsx("div",{className:"fm-progress-content",children:h?s.jsxs("div",{className:"fm-loading",children:[s.jsx("div",{className:"spinner"}),s.jsx("span",{children:"Loading..."})]}):d.length===0?s.jsxs("div",{className:"fm-empty",children:[s.jsx(Qf,{size:48}),s.jsx("h3",{children:"No tasks yet"}),s.jsx("p",{children:"Office will add tasks to this project"})]}):Fe?Object.entries(nt).map(([G,de])=>s.jsxs("div",{className:"fm-group",children:[s.jsxs("button",{className:"fm-group-header",onClick:()=>me(G),children:[s.jsxs("div",{className:"fm-group-left",children:[B[G]?s.jsx(uh,{size:18}):s.jsx(mh,{size:18}),s.jsx("span",{children:G})]}),s.jsx("span",{className:"fm-group-count",children:R(de)})]}),B[G]&&s.jsx("div",{className:"fm-group-items",children:de.map(re=>s.jsxs("div",{className:`fm-task ${re.status}`,children:[s.jsx("span",{className:"fm-task-name",children:re.name}),s.jsxs("div",{className:"fm-task-btns",children:[s.jsx("button",{className:`fm-status-btn working ${re.status==="working"?"active":""}`,onClick:()=>ie(re.id,"working"),disabled:b===re.id,children:s.jsx(Ci,{size:14})}),s.jsx("button",{className:`fm-status-btn done ${re.status==="done"?"active":""}`,onClick:()=>ie(re.id,"done"),disabled:b===re.id,children:s.jsx(al,{size:14})})]})]},re.id))})]},G)):s.jsx("div",{className:"fm-task-list",children:d.map(G=>s.jsxs("div",{className:`fm-task ${G.status}`,children:[s.jsx("span",{className:"fm-task-name",children:G.name}),s.jsxs("div",{className:"fm-task-btns",children:[s.jsx("button",{className:`fm-status-btn working ${G.status==="working"?"active":""}`,onClick:()=>ie(G.id,"working"),disabled:b===G.id,children:s.jsx(Ci,{size:14})}),s.jsx("button",{className:`fm-status-btn done ${G.status==="done"?"active":""}`,onClick:()=>ie(G.id,"done"),disabled:b===G.id,children:s.jsx(al,{size:14})})]})]},G.id))})})]}):s.jsxs("div",{className:"fm-view",children:[s.jsxs("div",{className:"fm-header",children:[s.jsx("button",{className:"fm-exit",onClick:o,children:s.jsx(ns,{size:20})}),s.jsxs("div",{className:"fm-header-center",children:[s.jsx("h1",{className:"fm-project-name",children:n.name}),s.jsx("button",{className:"fm-info-toggle",onClick:()=>Z(!F),children:s.jsx(Vg,{size:16})})]}),s.jsx("button",{className:"fm-theme",onClick:be,children:U?s.jsx(ih,{size:20}):s.jsx(oh,{size:20})})]}),F&&s.jsxs("div",{className:"fm-project-info",children:[n.job_number&&s.jsxs("div",{className:"fm-info-item",children:[s.jsx("span",{children:"Job #"}),s.jsx("span",{children:n.job_number})]}),n.address&&s.jsxs("div",{className:"fm-info-item",children:[s.jsx("span",{children:"Address"}),s.jsx("span",{children:n.address})]}),n.general_contractor&&s.jsxs("div",{className:"fm-info-item",children:[s.jsx("span",{children:"GC"}),s.jsx("span",{children:n.general_contractor})]}),n.client_phone&&s.jsxs("div",{className:"fm-info-item",children:[s.jsx("span",{children:"Phone"}),s.jsx("a",{href:`tel:${n.client_phone}`,children:n.client_phone})]})]}),s.jsxs("div",{className:"fm-progress-bar",children:[s.jsx("div",{className:"fm-progress-fill",style:{width:`${we}%`}}),s.jsxs("span",{className:"fm-progress-text",children:[we,"% Complete"]})]}),s.jsxs("div",{className:"fm-stats",children:[s.jsxs("div",{className:"fm-stat",children:[s.jsx("span",{className:"fm-stat-num working",children:Ve}),s.jsx("span",{className:"fm-stat-label",children:"Working"})]}),s.jsxs("div",{className:"fm-stat",children:[s.jsx("span",{className:"fm-stat-num done",children:Re}),s.jsx("span",{className:"fm-stat-label",children:"Done"})]}),s.jsxs("div",{className:"fm-stat",children:[s.jsx("span",{className:"fm-stat-num",children:Te}),s.jsx("span",{className:"fm-stat-label",children:"Left"})]})]}),s.jsxs("div",{className:"fm-section",children:[s.jsx("h3",{className:"fm-section-title",children:"Quick Actions"}),s.jsxs("div",{className:"fm-primary-actions",children:[s.jsxs("button",{className:"fm-action-card primary",onClick:()=>te("crew"),children:[s.jsx("div",{className:"fm-action-icon",children:s.jsx(Zg,{size:28})}),s.jsx("span",{className:"fm-action-label",children:"Crew Check-in"})]}),s.jsxs("button",{className:"fm-action-card primary",onClick:()=>te("tm"),children:[s.jsx("div",{className:"fm-action-icon",children:s.jsx(ss,{size:28})}),s.jsx("span",{className:"fm-action-label",children:"T&M Ticket"})]})]})]}),s.jsx("div",{className:"fm-section",children:s.jsxs("div",{className:"fm-secondary-actions",children:[s.jsxs("button",{className:"fm-action-row",onClick:()=>te("progress"),children:[s.jsx(Qf,{size:20}),s.jsx("span",{children:"Update Progress"}),s.jsxs("span",{className:"fm-action-badge",children:[Te," left"]})]}),s.jsxs("button",{className:"fm-action-row",onClick:()=>te("disposal"),children:[s.jsx($c,{size:20}),s.jsx("span",{children:"Disposal Loads"})]}),s.jsxs("button",{className:"fm-action-row",onClick:()=>te("docs"),children:[s.jsx(Kg,{size:20}),s.jsx("span",{children:"Documents"})]}),s.jsxs("button",{className:"fm-action-row",onClick:()=>te("report"),children:[s.jsx(dh,{size:20}),s.jsx("span",{children:"Daily Report"})]})]})}),s.jsx("div",{className:"fm-section",children:s.jsxs("button",{className:"fm-action-row danger",onClick:()=>te("injury"),children:[s.jsx(Di,{size:20}),s.jsx("span",{children:"Report Injury"})]})})]})}const H_=N.lazy(()=>lr(()=>import("./Dashboard-BtKwdqNr.js").then(n=>n.ao),__vite__mapDeps([6,3,1,2,7]))),L_=N.lazy(()=>lr(()=>import("./Setup-XUaAzQ2L.js"),__vite__mapDeps([8,3,1,2,4]))),B_=N.lazy(()=>lr(()=>import("./BrandingSettings-C3vyziFw.js"),__vite__mapDeps([9,1,2,3,4]))),Y_=N.lazy(()=>lr(()=>import("./PricingManager-CujZuyuS.js"),__vite__mapDeps([10,1,2,3,4]))),G_=N.lazy(()=>lr(()=>import("./PublicView-BSrYvido.js"),__vite__mapDeps([11,1,2,3,4]))),Q_=N.lazy(()=>lr(()=>import("./SignaturePage-GSE1HtXS.js"),__vite__mapDeps([12,1,2,7,3,4]))),X_=N.lazy(()=>lr(()=>import("./MembershipManager-BnqY4UXX.js"),__vite__mapDeps([13,1,2,3,4])));function Jc(){return s.jsxs("div",{className:"page-loader",children:[s.jsx(_a,{className:"loading-logo"}),s.jsx("div",{className:"spinner"})]})}function V_(){const[n,l]=N.useState("entry"),[i,o]=N.useState(null),[d,m]=N.useState(null),[h,g]=N.useState([]),[b,k]=N.useState([]),[B,S]=N.useState(null),[X,te]=N.useState(null),[F,Z]=N.useState(null),[U,K]=N.useState(!0),[ne,ie]=N.useState("dashboard"),[me,be]=N.useState(null),[we,Re]=N.useState(!1),[Ve,Te]=N.useState(!1),[nt,Fe]=N.useState(null),[R,G]=N.useState(0);N.useEffect(()=>{const W=window.location.pathname,ve=W.match(/^\/view\/([a-zA-Z0-9_-]+)$/),Ge=W.match(/^\/sign\/([a-zA-Z0-9_-]+)$/);ve?(te(ve[1]),l("public"),K(!1)):Ge?(Z(Ge[1]),l("signature"),K(!1)):de()},[]),N.useEffect(()=>{if(!v)return;const{data:{subscription:W}}=y.auth.onAuthStateChange(async(ve,Ge)=>{ve==="SIGNED_OUT"||ve==="USER_DELETED"?(o(null),m(null),g([]),l("entry")):ve==="TOKEN_REFRESHED"||ve==="SIGNED_IN"&&!i&&de()});return()=>{W?.unsubscribe()}},[i]);const de=async()=>{try{if(!v){K(!1);return}const{data:{user:W}}=await y.auth.getUser();if(!W){K(!1);return}const{data:ve,error:Ge}=await y.from("users").select("*").eq("id",W.id).single();if(ve){o(ve);let Ze=await _e.getUserCompanies(W.id);if(Ze.length===0&&ve.company_id&&await _e.repairLegacyUser(W.id,ve.company_id,ve.role||"member")&&(Ze=await _e.getUserCompanies(W.id)),g(Ze),Ze.length===0){if(await _e.getUserPendingMemberships(W.id)>0){l("pending");return}ce("No company access. Join a company to continue.","error"),await ru.signOut();return}const tt=localStorage.getItem("selectedCompanyId");let ft=null;if(tt&&Ze.find(Qe=>Qe.id===tt)?ft=Ze.find(Qe=>Qe.id===tt):Ze.length>0&&(ft=Ze[0]),ft){const{data:Qe}=await y.from("companies").select("*").eq("id",ft.id).single();m(Qe),l("office")}}}catch(W){console.error("Auth check error:",W)}finally{K(!1)}},re=W=>{S(W),l("foreman")},D=async(W,ve)=>{try{await eu();const{data:Ge,error:Ze}=await y.auth.signInWithPassword({email:W,password:ve});if(Ze){ce(Ze.message||"Invalid credentials","error");return}const{data:tt,error:ft}=await y.from("users").select("*").eq("id",Ge.user.id).single();if(ft){console.error("User fetch error:",ft),ce("Error loading profile","error");return}if(tt){o(tt);let Qe=await _e.getUserCompanies(Ge.user.id);Qe.length===0&&tt.company_id&&await _e.repairLegacyUser(Ge.user.id,tt.company_id,tt.role||"member")&&(Qe=await _e.getUserCompanies(Ge.user.id)),g(Qe);const Yt=localStorage.getItem("selectedCompanyId");let ct=null;if(Yt&&Qe.find(Nt=>Nt.id===Yt)?ct=Qe.find(Nt=>Nt.id===Yt):Qe.length>0&&(ct=Qe[0]),ct){const{data:Nt}=await y.from("companies").select("*").eq("id",ct.id).single();m(Nt),l("office")}else await _e.getUserPendingMemberships(Ge.user.id)>0?l("pending"):ce("No company access. Please contact admin.","error")}else ce("Profile not found. Please contact admin.","error")}catch(Ge){console.error("Login error:",Ge),ce("Login failed","error")}},Q=async W=>{try{const{data:ve}=await y.from("companies").select("*").eq("id",W).single();ve&&(m(ve),localStorage.setItem("selectedCompanyId",W),Re(!1),ie("dashboard"),ce(`Switched to ${ve.name}`,"success"))}catch(ve){console.error("Switch company error:",ve),ce("Error switching company","error")}},I=async()=>{try{await ru.signOut(),o(null),m(null),g([]),l("entry"),ie("dashboard"),localStorage.removeItem("selectedCompanyId")}catch(W){console.error("Logout error:",W),ce("Error signing out","error")}},Se=async()=>{await eu(),S(null),l("entry")},ce=N.useCallback((W,ve="")=>{be({message:W,type:ve})},[]),He=()=>{ie("dashboard"),d?.id&&fe()},fe=async()=>{if(d?.id)try{const W=await _e.getProjects(d.id);k(W)}catch(W){console.error("Error loading projects:",W)}};N.useEffect(()=>{d?.id&&n==="office"&&(fe(),je())},[d?.id,n]);const je=async()=>{if(d?.id)try{const ve=(await _e.getCompanyMemberships(d.id)).filter(Ge=>Ge.status==="pending").length;G(ve)}catch(W){console.error("Error loading pending count:",W)}},Ue=N.useCallback(()=>{Fe(null)},[]);if(U)return s.jsx(_n,{children:s.jsx(gn,{companyId:d?.id,children:s.jsxs("div",{className:"loading-screen",children:[s.jsx(_a,{className:"loading-logo"}),s.jsx("div",{className:"spinner"})]})})});if(n==="entry")return s.jsx(_n,{children:s.jsxs(gn,{children:[s.jsx(rs,{children:s.jsx(j_,{onForemanAccess:re,onOfficeLogin:D,onShowToast:ce})}),me&&s.jsx(yn,{message:me.message,type:me.type,onClose:()=>be(null)})]})});if(n==="public"&&X)return s.jsx(_n,{children:s.jsxs(gn,{children:[s.jsx(rs,{children:s.jsx(N.Suspense,{fallback:s.jsx(Jc,{}),children:s.jsx(G_,{shareToken:X})})}),me&&s.jsx(yn,{message:me.message,type:me.type,onClose:()=>be(null)})]})});if(n==="signature"&&F)return s.jsx(_n,{children:s.jsxs(gn,{children:[s.jsx(rs,{children:s.jsx(N.Suspense,{fallback:s.jsx(Jc,{}),children:s.jsx(Q_,{signatureToken:F})})}),me&&s.jsx(yn,{message:me.message,type:me.type,onClose:()=>be(null)})]})});if(n==="pending")return s.jsx(_n,{children:s.jsxs(gn,{children:[s.jsx(rs,{children:s.jsxs("div",{className:"pending-approval-screen",children:[s.jsx(_a,{className:"pending-logo"}),s.jsx("h2",{children:"Awaiting Approval"}),s.jsx("p",{children:"Your membership request has been submitted."}),s.jsx("p",{children:"A company admin will review your request."}),s.jsxs("div",{className:"pending-actions",children:[s.jsx("button",{className:"btn btn-secondary",onClick:I,children:"Sign Out"}),s.jsx("button",{className:"btn btn-primary",onClick:de,children:"Check Status"})]})]})}),me&&s.jsx(yn,{message:me.message,type:me.type,onClose:()=>be(null)})]})});if(n==="foreman"&&B)return s.jsx(_n,{children:s.jsxs(gn,{companyId:B.company_id,children:[s.jsx(rs,{children:s.jsx(U_,{project:B,companyId:B.company_id,onShowToast:ce,onExit:Se})}),s.jsx(rh,{}),me&&s.jsx(yn,{message:me.message,type:me.type,onClose:()=>be(null)})]})});const J=h.find(W=>W.id===d?.id)?.access_level==="administrator"||d?.owner_user_id===i?.id;return s.jsx(_n,{children:s.jsx(gn,{companyId:d?.id,children:s.jsxs("div",{children:[!v&&s.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),s.jsx("nav",{className:"nav",children:s.jsxs("div",{className:"nav-content",children:[s.jsx(_a,{}),s.jsxs("div",{className:"nav-tabs nav-tabs-desktop",children:[s.jsx("button",{className:`nav-tab ${ne==="dashboard"?"active":""}`,onClick:()=>ie("dashboard"),children:"Dashboard"}),s.jsx("button",{className:`nav-tab ${ne==="setup"?"active":""}`,onClick:()=>ie("setup"),children:"+ New Project"}),s.jsx("button",{className:`nav-tab ${ne==="pricing"?"active":""}`,onClick:()=>ie("pricing"),children:"Pricing"}),J&&s.jsx("button",{className:`nav-tab ${ne==="branding"?"active":""}`,onClick:()=>ie("branding"),children:"Branding"}),J&&s.jsxs("button",{className:`nav-tab ${ne==="team"?"active":""}`,onClick:()=>ie("team"),children:["Team",R>0&&s.jsx("span",{className:"nav-tab-badge",children:R})]})]}),s.jsxs("div",{className:"nav-user nav-user-desktop",children:[s.jsx(ah,{compact:!0}),s.jsxs("div",{className:"mobile-menu",children:[s.jsx("button",{className:"mobile-menu-btn",onClick:()=>Te(!Ve),"aria-label":"User menu",children:""}),Ve&&s.jsxs("div",{className:"mobile-menu-dropdown",children:[s.jsxs("div",{className:"mobile-menu-info",children:[s.jsx("div",{className:"mobile-menu-user",children:i?.name||i?.email}),d&&s.jsx("div",{className:"mobile-menu-company",children:d.name})]}),s.jsx("button",{className:"mobile-menu-logout",onClick:()=>{Te(!1),I()},children:"Sign Out"})]})]}),h.length>1&&s.jsxs("div",{className:"company-switcher",children:[s.jsxs("button",{className:"company-switcher-btn",onClick:()=>Re(!we),children:[d?.name||"Select Company",s.jsx("span",{className:"switcher-arrow",children:""})]}),we&&s.jsx("div",{className:"company-dropdown",children:h.map(W=>s.jsxs("button",{className:`company-option ${W.id===d?.id?"active":""}`,onClick:()=>Q(W.id),children:[W.name,W.id===d?.id&&s.jsx("span",{className:"check",children:""})]},W.id))})]}),h.length<=1&&d&&s.jsx("span",{className:"nav-company-name",children:d.name}),s.jsx("span",{className:"nav-user-name",children:i?.name||i?.email}),s.jsx("button",{className:"nav-logout",onClick:I,children:"Sign Out"})]}),s.jsx("button",{className:"mobile-menu-btn",onClick:()=>Te(!0),"aria-label":"Open menu",children:s.jsxs("span",{className:"hamburger-icon",children:[s.jsx("span",{}),s.jsx("span",{}),s.jsx("span",{})]})})]})}),Ve&&s.jsx("div",{className:"mobile-drawer-overlay",onClick:()=>Te(!1),children:s.jsxs("div",{className:"mobile-drawer",onClick:W=>W.stopPropagation(),children:[s.jsxs("div",{className:"mobile-drawer-header",children:[s.jsx(_a,{}),s.jsx("button",{className:"mobile-drawer-close",onClick:()=>Te(!1),"aria-label":"Close menu",children:""})]}),s.jsxs("div",{className:"mobile-drawer-user",children:[s.jsx("div",{className:"mobile-user-avatar",children:(i?.name||i?.email||"U")[0].toUpperCase()}),s.jsxs("div",{className:"mobile-user-info",children:[s.jsx("span",{className:"mobile-user-name",children:i?.name||i?.email}),s.jsx("span",{className:"mobile-user-company",children:d?.name})]})]}),h.length>1&&s.jsxs("div",{className:"mobile-drawer-section",children:[s.jsx("div",{className:"mobile-section-title",children:"Switch Company"}),s.jsx("div",{className:"mobile-company-list",children:h.map(W=>s.jsxs("button",{className:`mobile-company-option ${W.id===d?.id?"active":""}`,onClick:()=>{Q(W.id),Te(!1)},children:[s.jsx("span",{className:"mobile-company-name",children:W.name}),W.id===d?.id&&s.jsx("span",{className:"mobile-company-check",children:""})]},W.id))})]}),s.jsxs("div",{className:"mobile-drawer-section",children:[s.jsx("div",{className:"mobile-section-title",children:"Navigation"}),s.jsxs("div",{className:"mobile-nav-list",children:[s.jsx("button",{className:`mobile-nav-item ${ne==="dashboard"?"active":""}`,onClick:()=>{ie("dashboard"),Te(!1)},children:"Dashboard"}),s.jsx("button",{className:`mobile-nav-item ${ne==="setup"?"active":""}`,onClick:()=>{ie("setup"),Te(!1)},children:"+ New Project"}),s.jsx("button",{className:`mobile-nav-item ${ne==="pricing"?"active":""}`,onClick:()=>{ie("pricing"),Te(!1)},children:"Pricing"}),J&&s.jsx("button",{className:`mobile-nav-item ${ne==="branding"?"active":""}`,onClick:()=>{ie("branding"),Te(!1)},children:"Branding"}),J&&s.jsxs("button",{className:`mobile-nav-item ${ne==="team"?"active":""}`,onClick:()=>{ie("team"),Te(!1)},children:["Team",R>0&&s.jsx("span",{className:"mobile-nav-badge",children:R})]})]})]}),s.jsxs("div",{className:"mobile-drawer-section",children:[s.jsx("div",{className:"mobile-section-title",children:"Appearance"}),s.jsx("div",{className:"mobile-theme-toggle",children:s.jsx(ah,{})})]}),s.jsx("div",{className:"mobile-drawer-footer",children:s.jsx("button",{className:"mobile-logout-btn",onClick:()=>{I(),Te(!1)},children:"Sign Out"})})]})}),s.jsx(rs,{children:s.jsx(N.Suspense,{fallback:s.jsx(Jc,{}),children:s.jsxs("div",{className:"container",children:[ne==="dashboard"&&s.jsx(H_,{company:d,user:i,isAdmin:J,onShowToast:ce,navigateToProjectId:nt,onProjectNavigated:Ue}),ne==="setup"&&s.jsx(L_,{company:d,user:i,onProjectCreated:He,onShowToast:ce}),ne==="pricing"&&s.jsx(Y_,{company:d,onShowToast:ce}),ne==="branding"&&s.jsx(B_,{company:d,onShowToast:ce}),ne==="team"&&J&&s.jsx(X_,{company:d,user:i,onShowToast:ce})]},d?.id)})}),s.jsx(rh,{}),me&&s.jsx(yn,{message:me.message,type:me.type,onClose:()=>be(null)})]})})})}s_.createRoot(document.getElementById("root")).render(s.jsx(Jg.StrictMode,{children:s.jsx(V_,{})}));"serviceWorker"in navigator&&(window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(n=>{setInterval(()=>{n.update().catch(()=>{})},3e5)}).catch(()=>{})}),navigator.serviceWorker.addEventListener("message",n=>{n.data?.type==="SW_UPDATED"&&(console.log("[App] Service worker updated, reloading for fresh assets..."),window.location.reload()),n.data?.type==="ASSET_NOT_FOUND"&&(console.warn("[App] Asset not found:",n.data.url,"- reloading..."),"caches"in window?caches.keys().then(l=>{l.forEach(i=>caches.delete(i))}).finally(()=>{window.location.reload()}):window.location.reload())}));export{R_ as F,A_ as I,_a as L,yn as T,y_ as a,I_ as b,P_ as c,_e as d,__ as e,W_ as f,S_ as g,ey as h,y as i,s as j,ay as k,x_ as l,ry as m,$_ as n,Ce as o,ty as s,v_ as u};
//# sourceMappingURL=index-DqPazBpc.js.map
