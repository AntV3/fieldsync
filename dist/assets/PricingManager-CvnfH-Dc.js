import{r as i,d as x,j as e,H as ie}from"./index-DVhyve4j.js";import{P as U,T as H,W as ne}from"./wrench-D2Ix-vtW.js";import{a as ce,P as Y,X as G,C as oe}from"./x-CaETQx95.js";import{C as de}from"./chevron-down-DQ6oZuvH.js";import{C as me}from"./chevron-right-BsNc0Ewj.js";import{D as T,P as ue}from"./pencil-cywukJuG.js";import"./react-DXGY7bZi.js";import"./pdf-ChZ1zkDw.js";import"./supabase-VuevzHjS.js";const J=[{id:"standard",label:"Standard Rate"},{id:"prevailing",label:"Prevailing Wage"}];function he({company:o,onShowToast:t}){const[c,E]=i.useState([]),[g,L]=i.useState([]),[d,_]=i.useState(!0),[F,k]=i.useState({}),[B,y]=i.useState(!1),[p,b]=i.useState(!1),[C,M]=i.useState(!1),[f,D]=i.useState(null),[v,$]=i.useState(null),[A,q]=i.useState(null),[I,S]=i.useState(""),[R,z]=i.useState(""),[w,a]=i.useState(""),[l,m]=i.useState({}),[N,n]=i.useState(!1);i.useEffect(()=>{o?.id&&j()},[o?.id]);const j=async()=>{try{_(!0);const s=await x.getLaborClassesWithCategories(o.id);E(s.categories||[]),L(s.classes||[]);const r={};s.categories.forEach(u=>{r[u.id]=!0}),k(r)}catch(s){console.error("Error loading labor classes:",s),t?.("Error loading labor classes","error")}finally{_(!1)}},se=s=>{k(r=>({...r,[s]:!r[s]}))},X=(s=null)=>{D(s),S(s?.name||""),y(!0)},ae=async()=>{if(!I.trim()){t?.("Please enter a category name","error");return}n(!0);try{if(f)await x.updateLaborCategory(f.id,{name:I.trim()}),t?.("Category updated","success");else{const s=await x.createLaborCategory(o.id,I.trim(),c.length);s&&k(r=>({...r,[s.id]:!0})),t?.("Category created","success")}y(!1),S(""),D(null),await j()}catch(s){console.error("Error saving category:",s),s.message?.includes("duplicate")?t?.("A category with this name already exists","error"):t?.("Error saving category","error")}finally{n(!1)}},te=async s=>{if(g.filter(u=>u.category_id===s.id).length>0){t?.("Remove all classes from this category first","error");return}if(confirm(`Delete category "${s.name}"?`))try{await x.deleteLaborCategory(s.id),t?.("Category deleted","success"),await j()}catch(u){console.error("Error deleting category:",u),t?.("Error deleting category","error")}},P=(s=null,r=null)=>{$(s),z(s?.name||""),a(s?.category_id||r||c[0]?.id||""),b(!0)},re=async()=>{if(!R.trim()){t?.("Please enter a class name","error");return}n(!0);try{if(v)await x.updateLaborClass(v.id,{name:R.trim(),category_id:w||null}),t?.("Labor class updated","success");else{const s=g.filter(r=>r.category_id===w);await x.createLaborClass(o.id,w||null,R.trim(),s.length),t?.("Labor class created","success")}b(!1),z(""),$(null),a(""),await j()}catch(s){console.error("Error saving class:",s),s.message?.includes("duplicate")?t?.("A class with this name already exists","error"):t?.("Error saving class","error")}finally{n(!1)}},K=async s=>{if(confirm(`Delete labor class "${s.name}"? This will also delete all associated rates.`))try{await x.deleteLaborClass(s.id),t?.("Labor class deleted","success"),await j()}catch(r){console.error("Error deleting class:",r),t?.("Error deleting class","error")}},Q=async s=>{q(s);const r={};J.forEach(u=>{r[u.id]={regular_rate:"",overtime_rate:""}});try{(await x.getLaborClassRates(s.id)).forEach(h=>{const Z=h.job_type==="pla"?"prevailing":h.job_type;r[Z]&&(r[Z]={regular_rate:h.regular_rate||"",overtime_rate:h.overtime_rate||""})})}catch(u){console.error("Error loading rates:",u)}m(r),M(!0)},V=(s,r,u)=>{m(h=>({...h,[s]:{...h[s],[r]:u.replace(/[^0-9.]/g,"")}}))},le=async()=>{if(A){n(!0);try{const s=J.map(r=>({work_type:"labor",job_type:r.id,regular_rate:parseFloat(l[r.id]?.regular_rate)||0,overtime_rate:parseFloat(l[r.id]?.overtime_rate)||0}));await x.saveLaborClassRates(A.id,s),t?.("Rates saved","success"),M(!1),q(null)}catch(s){console.error("Error saving rates:",s),t?.("Error saving rates","error")}finally{n(!1)}}};if(d)return e.jsx("div",{className:"loading",children:"Loading labor setup..."});const O=g.filter(s=>!s.category_id);return e.jsxs("div",{className:"pricing-section labor-setup-section",children:[e.jsxs("div",{className:"pricing-section-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Labor Setup"}),e.jsx("p",{className:"section-desc",children:"Create custom labor categories and classes with rates per work type"})]}),e.jsxs("div",{className:"labor-setup-actions",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:()=>X(),children:[e.jsx(U,{size:16})," Add Category"]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>P(),disabled:c.length===0,children:[e.jsx(U,{size:16})," Add Class"]})]})]}),c.length===0&&g.length===0?e.jsxs("div",{className:"labor-setup-empty",children:[e.jsx(ce,{size:40}),e.jsx("h3",{children:"No Labor Classes Configured"}),e.jsx("p",{children:'Create categories to organize your labor classes (e.g., "Supervision", "Operators", "Labor"), then add classes within each category.'}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>X(),children:[e.jsx(U,{size:16})," Create First Category"]})]}):e.jsxs("div",{className:"labor-categories-list",children:[c.map(s=>{const r=g.filter(h=>h.category_id===s.id),u=F[s.id];return e.jsxs("div",{className:"labor-category-card",children:[e.jsxs("div",{className:"labor-category-header",onClick:()=>se(s.id),children:[e.jsx("div",{className:"category-expand-icon",children:u?e.jsx(de,{size:18}):e.jsx(me,{size:18})}),e.jsx("span",{className:"category-name",children:s.name}),e.jsxs("span",{className:"category-count",children:[r.length," class",r.length!==1?"es":""]}),e.jsxs("div",{className:"category-actions",onClick:h=>h.stopPropagation(),children:[e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>P(null,s.id),title:"Add class to this category",children:e.jsx(U,{size:14})}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>X(s),title:"Edit category",children:e.jsx(Y,{size:14})}),e.jsx("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>te(s),title:"Delete category",children:e.jsx(H,{size:14})})]})]}),u&&e.jsx("div",{className:"labor-classes-list",children:r.length===0?e.jsxs("div",{className:"no-classes-message",children:["No classes in this category.",e.jsx("button",{className:"link-btn",onClick:()=>P(null,s.id),children:"Add one"})]}):r.map(h=>e.jsxs("div",{className:"labor-class-row",children:[e.jsx("span",{className:"class-name",children:h.name}),e.jsxs("div",{className:"class-actions",children:[e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>Q(h),children:[e.jsx(T,{size:14})," Set Rates"]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>P(h),title:"Edit class",children:e.jsx(Y,{size:14})}),e.jsx("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>K(h),title:"Delete class",children:e.jsx(H,{size:14})})]})]},h.id))})]},s.id)}),O.length>0&&e.jsxs("div",{className:"labor-category-card uncategorized",children:[e.jsxs("div",{className:"labor-category-header",children:[e.jsx("span",{className:"category-name",children:"Uncategorized"}),e.jsxs("span",{className:"category-count",children:[O.length," class",O.length!==1?"es":""]})]}),e.jsx("div",{className:"labor-classes-list",children:O.map(s=>e.jsxs("div",{className:"labor-class-row",children:[e.jsx("span",{className:"class-name",children:s.name}),e.jsxs("div",{className:"class-actions",children:[e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>Q(s),children:[e.jsx(T,{size:14})," Set Rates"]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>P(s),children:e.jsx(Y,{size:14})}),e.jsx("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>K(s),children:e.jsx(H,{size:14})})]})]},s.id))})]})]}),B&&e.jsx("div",{className:"modal-overlay",onClick:()=>y(!1),children:e.jsxs("div",{className:"modal-content labor-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:f?"Edit Category":"Add Category"}),e.jsx("button",{className:"close-btn",onClick:()=>y(!1),children:e.jsx(G,{size:20})})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category Name"}),e.jsx("input",{type:"text",value:I,onChange:s=>S(s.target.value),placeholder:"e.g., Supervision, Operators, Labor",autoFocus:!0})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>y(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:ae,disabled:N,children:N?"Saving...":f?"Update":"Create"})]})]})}),p&&e.jsx("div",{className:"modal-overlay",onClick:()=>b(!1),children:e.jsxs("div",{className:"modal-content labor-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:v?"Edit Labor Class":"Add Labor Class"}),e.jsx("button",{className:"close-btn",onClick:()=>b(!1),children:e.jsx(G,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Class Name"}),e.jsx("input",{type:"text",value:R,onChange:s=>z(s.target.value),placeholder:"e.g., Foreman, Operator, Laborer",autoFocus:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsxs("select",{value:w,onChange:s=>a(s.target.value),children:[e.jsx("option",{value:"",children:"-- No Category --"}),c.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>b(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:re,disabled:N,children:N?"Saving...":v?"Update":"Create"})]})]})}),C&&A&&e.jsx("div",{className:"modal-overlay",onClick:()=>M(!1),children:e.jsxs("div",{className:"modal-content labor-modal rates-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Set Rates: ",A.name]}),e.jsx("button",{className:"close-btn",onClick:()=>M(!1),children:e.jsx(G,{size:20})})]}),e.jsx("div",{className:"modal-body",children:e.jsx("div",{className:"rates-simple-grid",children:J.map(s=>{const r=l[s.id]||{};return e.jsxs("div",{className:"rate-row-simple",children:[e.jsx("span",{className:"rate-type-label",children:s.label}),e.jsxs("div",{className:"rate-inputs",children:[e.jsxs("div",{className:"rate-input-group",children:[e.jsx("label",{children:"Regular"}),e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",value:r.regular_rate||"",onChange:u=>V(s.id,"regular_rate",u.target.value),placeholder:"0.00"}),e.jsx("span",{children:"/hr"})]})]}),e.jsxs("div",{className:"rate-input-group",children:[e.jsx("label",{children:"Overtime"}),e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",value:r.overtime_rate||"",onChange:u=>V(s.id,"overtime_rate",u.target.value),placeholder:"0.00"}),e.jsx("span",{children:"/hr"})]})]})]})]},s.id)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>M(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:le,disabled:N,children:[e.jsx(oe,{size:16})," ",N?"Saving...":"Save Rates"]})]})]})})]})}const W=["Containment","PPE","Disposal","Equipment"];function ge({company:o,onShowToast:t}){const[c,E]=i.useState([]),[g,L]=i.useState(!0),[d,_]=i.useState("all"),[F,k]=i.useState(null),[B,y]=i.useState(!1),[p,b]=i.useState({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),[C,M]=i.useState([]),[f,D]=i.useState(!1);i.useEffect(()=>{o?.id&&v()},[o?.id]);const v=async()=>{L(!0);try{const a=await x.getAllMaterialsEquipment(o.id);E(a||[]),$(a||[])}catch(a){console.error("Error loading items:",a),t("Error loading materials","error")}finally{L(!1)}},$=a=>{const l={},m=[];a.filter(n=>n.active!==!1).forEach(n=>{const j=n.name.toLowerCase().trim();l[j]||(l[j]=[]),l[j].push(n)}),Object.entries(l).forEach(([n,j])=>{j.length>1&&m.push({name:n,items:j})}),M(m)},A=async a=>{try{const l=a.items.filter(n=>n.cost_per_unit>0),m=l.length>0?l[0]:a.items[0],N=a.items.filter(n=>n.id!==m.id);for(const n of N)await x.deleteMaterialEquipment(n.id);t(`Merged ${a.items.length} items into one`,"success"),v()}catch(l){console.error("Error merging duplicates:",l),t("Error merging duplicates","error")}},q=async()=>{if(confirm(`Merge all ${C.length} duplicate groups?`))try{for(const a of C){const l=a.items.filter(n=>n.cost_per_unit>0),m=l.length>0?l[0]:a.items[0],N=a.items.filter(n=>n.id!==m.id);for(const n of N)await x.deleteMaterialEquipment(n.id)}t("All duplicates merged!","success"),v(),D(!1)}catch(a){console.error("Error merging all duplicates:",a),t("Error merging duplicates","error")}},I=async()=>{if(!p.name.trim()){t("Enter item name","error");return}try{await x.createMaterialEquipment({company_id:o.id,name:p.name.trim(),category:p.category,unit:p.unit||"each",cost_per_unit:parseFloat(p.cost_per_unit)||0,active:!0}),t("Item added","success"),b({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),y(!1),v()}catch(a){console.error("Error adding item:",a),t("Error adding item","error")}},S=async a=>{try{await x.updateMaterialEquipment(a.id,{name:a.name,category:a.category,unit:a.unit,cost_per_unit:parseFloat(a.cost_per_unit)||0}),t("Item updated","success"),k(null),v()}catch(l){console.error("Error updating item:",l),t("Error updating item","error")}},R=async a=>{if(confirm("Delete this item?"))try{await x.deleteMaterialEquipment(a),t("Item deleted","success"),v()}catch(l){console.error("Error deleting item:",l),t("Error deleting item","error")}},z=d==="all"?c.filter(a=>a.active!==!1):c.filter(a=>a.category===d&&a.active!==!1),w=z.reduce((a,l)=>{const m=l.category||"Other";return a[m]||(a[m]=[]),a[m].push(l),a},{});return g?e.jsx("div",{className:"loading",children:"Loading materials..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"materials-header",children:[e.jsxs("div",{className:"materials-title",children:[e.jsx("h2",{children:"Materials & Equipment"}),e.jsxs("span",{className:"materials-count",children:[c.filter(a=>a.active!==!1).length," items"]})]}),e.jsxs("div",{className:"materials-actions",children:[C.length>0&&e.jsxs("button",{className:`btn btn-warning ${f?"active":""}`,onClick:()=>D(!f),children:[C.length," Duplicates"]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>y(!0),children:"+ Add Item"})]})]}),f&&C.length>0&&e.jsxs("div",{className:"duplicates-panel",children:[e.jsxs("div",{className:"duplicates-header",children:[e.jsx("h3",{children:"Duplicate Items Found"}),e.jsxs("button",{className:"btn btn-success btn-small",onClick:q,children:["Merge All (",C.length,")"]})]}),e.jsx("div",{className:"duplicates-list",children:C.map((a,l)=>e.jsxs("div",{className:"duplicate-group",children:[e.jsxs("div",{className:"duplicate-name",children:['"',a.name,'" x ',a.items.length]}),e.jsx("div",{className:"duplicate-items",children:a.items.map(m=>e.jsxs("span",{className:"duplicate-item",children:[m.category," - $",m.cost_per_unit||0]},m.id))}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>A(a),children:"Merge"})]},l))})]}),B&&e.jsxs("div",{className:"add-item-form",children:[e.jsx("h3",{children:"Add New Item"}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Item Name",value:p.name,onChange:a=>b({...p,name:a.target.value}),autoFocus:!0}),e.jsx("select",{value:p.category,onChange:a=>b({...p,category:a.target.value}),children:W.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Unit (e.g., each, day, hour)",value:p.unit,onChange:a=>b({...p,unit:a.target.value})}),e.jsxs("div",{className:"dollar-input-wrapper",children:[e.jsx("span",{className:"dollar-prefix",children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",className:"dollar-input",placeholder:"Cost per unit",value:p.cost_per_unit,onChange:a=>{const l=a.target.value.replace(/[^0-9.]/g,"");b({...p,cost_per_unit:l})}})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>y(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:I,children:"Add Item"})]})]}),e.jsxs("div",{className:"materials-filter",children:[e.jsx("button",{className:`filter-tab ${d==="all"?"active":""}`,onClick:()=>_("all"),children:"All"}),W.map(a=>e.jsxs("button",{className:`filter-tab ${d===a?"active":""}`,onClick:()=>_(a),children:[a,e.jsx("span",{className:"filter-count",children:c.filter(l=>l.category===a&&l.active!==!1).length})]},a))]}),e.jsxs("div",{className:"materials-list",children:[d==="all"?Object.entries(w).map(([a,l])=>e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:a}),e.jsx("div",{className:"category-items",children:l.map(m=>e.jsx(ee,{item:m,editingItem:F,setEditingItem:k,handleUpdateItem:S,handleDeleteItem:R,categories:W},m.id))})]},a)):e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:d}),e.jsx("div",{className:"category-items",children:z.map(a=>e.jsx(ee,{item:a,editingItem:F,setEditingItem:k,handleUpdateItem:S,handleDeleteItem:R,categories:W},a.id))})]}),z.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No items in this category"})})]})]})}function ee({item:o,editingItem:t,setEditingItem:c,handleUpdateItem:E,handleDeleteItem:g,categories:L}){return t?.id===o.id?e.jsx("div",{className:"material-item",children:e.jsxs("div",{className:"item-edit-form",children:[e.jsx("input",{type:"text",value:t.name,onChange:d=>c({...t,name:d.target.value})}),e.jsx("select",{value:t.category,onChange:d=>c({...t,category:d.target.value}),children:L.map(d=>e.jsx("option",{value:d,children:d},d))}),e.jsx("input",{type:"text",value:t.unit,onChange:d=>c({...t,unit:d.target.value}),placeholder:"Unit"}),e.jsxs("div",{className:"dollar-input-wrapper compact",children:[e.jsx("span",{className:"dollar-prefix",children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",className:"dollar-input",value:t.cost_per_unit,onChange:d=>{const _=d.target.value.replace(/[^0-9.]/g,"");c({...t,cost_per_unit:_})},placeholder:"Cost"})]}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>E(t),children:"Save"}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>c(null),children:"Cancel"})]})]})}):e.jsxs("div",{className:"material-item",children:[e.jsxs("div",{className:"item-info",children:[e.jsx("span",{className:"item-name",children:o.name}),e.jsx("span",{className:"item-unit",children:o.unit||"each"})]}),e.jsxs("div",{className:"item-cost",children:["$",(o.cost_per_unit||0).toFixed(2)]}),e.jsxs("div",{className:"item-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>c({...o}),title:"Edit",children:e.jsx(ue,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:()=>g(o.id),title:"Delete",children:e.jsx(H,{size:16})})]})]})}const pe=[{id:"labor",label:"Labor Rates",Icon:ie},{id:"materials",label:"Materials & Equipment",Icon:ne}];function _e({company:o,onShowToast:t}){const[c,E]=i.useState("labor");return e.jsxs("div",{className:"pricing-manager",children:[e.jsxs("div",{className:"pricing-header",children:[e.jsx("h1",{children:"Pricing Configuration"}),e.jsx("p",{className:"pricing-subtitle",children:"Set up labor rates, materials pricing, and disposal costs"})]}),e.jsx("div",{className:"pricing-tabs",children:pe.map(g=>e.jsxs("button",{className:`pricing-tab ${c===g.id?"active":""}`,onClick:()=>E(g.id),children:[e.jsx(g.Icon,{size:18,className:"pricing-tab-icon"}),e.jsx("span",{className:"pricing-tab-label",children:g.label})]},g.id))}),e.jsxs("div",{className:"pricing-content",children:[c==="labor"&&e.jsx(he,{company:o,onShowToast:t}),c==="materials"&&e.jsx(ge,{company:o,onShowToast:t})]})]})}export{_e as default};
