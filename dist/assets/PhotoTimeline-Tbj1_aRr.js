import{aW as R,aK as z,as as e}from"./index-Bq3IVWxB.js";import{r as i,f,aR as T,O as E,p as q,q as U,aS as $,aq as _,X as O,a7 as B,y as F}from"./icons-D1pGYcxw.js";import"./react-DXGY7bZi.js";import"./pdf-aQqpMATS.js";import"./supabase-VuevzHjS.js";function J({projectId:d,areas:m=[],onShowToast:K}){const[u,w]=i.useState([]),[A,v]=i.useState(!0),[h,D]=i.useState("all"),[n,g]=i.useState(null),[p,N]=i.useState(0),[b,y]=i.useState(new Set),C=i.useCallback(async()=>{if(!d||!R){v(!1);return}try{const[s,o]=await Promise.all([z.from("t_and_m_tickets").select("id, work_date, description, photos, area_id").eq("project_id",d).not("photos","is",null).order("work_date",{ascending:!1}),z.from("daily_reports").select("id, report_date, notes, photos").eq("project_id",d).not("photos","is",null).order("report_date",{ascending:!1})]),t=[];if(s.data)for(const a of s.data){const j=Array.isArray(a.photos)?a.photos:[];for(const c of j)c&&t.push({id:`tm-${a.id}-${t.length}`,url:c,date:a.work_date,source:"T&M Ticket",description:a.description,areaId:a.area_id})}if(o.data)for(const a of o.data){const j=Array.isArray(a.photos)?a.photos:[];for(const c of j)c&&t.push({id:`dr-${a.id}-${t.length}`,url:c,date:a.report_date,source:"Daily Report",description:a.notes,areaId:null})}w(t),t.length>0&&y(new Set([t[0].date]))}catch(s){console.error("Error loading photos:",s)}finally{v(!1)}},[d]);i.useEffect(()=>{C()},[C]);const r=i.useMemo(()=>h==="all"?u:u.filter(s=>s.areaId===h),[u,h]),L=i.useMemo(()=>{const s={};for(const o of r)s[o.date]||(s[o.date]=[]),s[o.date].push(o);return Object.entries(s).sort(([o],[t])=>t.localeCompare(o))},[r]),l=i.useMemo(()=>r,[r]),I=s=>{y(o=>{const t=new Set(o);return t.has(s)?t.delete(s):t.add(s),t})},M=s=>{const o=l.findIndex(t=>t.id===s.id);N(o>=0?o:0),g(s)},k=()=>g(null),P=s=>{const o=p+s;o>=0&&o<l.length&&(N(o),g(l[o]))},S=s=>new Date(s+"T00:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),x=s=>s&&m.find(t=>t.id===s)?.name||null;return A?e.jsxs("div",{className:"photo-timeline-card",children:[e.jsxs("div",{className:"photo-timeline-header",children:[e.jsx(f,{size:18}),e.jsx("h3",{children:"Progress Photos"})]}),e.jsx("div",{className:"photo-timeline-loading",children:"Loading photos..."})]}):e.jsxs("div",{className:"photo-timeline-card",children:[e.jsxs("div",{className:"photo-timeline-header",children:[e.jsxs("div",{className:"photo-timeline-title",children:[e.jsx(f,{size:18}),e.jsx("h3",{children:"Progress Photos"}),e.jsx("span",{className:"photo-count-badge",children:r.length})]}),m.length>0&&e.jsxs("div",{className:"photo-area-filter",children:[e.jsx(T,{size:14}),e.jsxs("select",{value:h,onChange:s=>D(s.target.value),className:"photo-area-select",children:[e.jsx("option",{value:"all",children:"All Areas"}),m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),r.length===0?e.jsxs("div",{className:"photo-timeline-empty",children:[e.jsx(f,{size:32,style:{opacity:.3}}),e.jsx("p",{children:"No photos yet"}),e.jsx("span",{children:"Photos from T&M tickets and daily reports will appear here"})]}):e.jsx("div",{className:"photo-timeline-dates",children:L.map(([s,o])=>e.jsxs("div",{className:"photo-date-group",children:[e.jsxs("button",{className:"photo-date-header",onClick:()=>I(s),children:[e.jsxs("div",{className:"photo-date-info",children:[e.jsx(E,{size:14}),e.jsx("span",{className:"photo-date-label",children:S(s)}),e.jsxs("span",{className:"photo-date-count",children:[o.length," photo",o.length!==1?"s":""]})]}),b.has(s)?e.jsx(q,{size:16}):e.jsx(U,{size:16})]}),b.has(s)&&e.jsx("div",{className:"photo-grid",children:o.map(t=>e.jsxs("div",{className:"photo-grid-item",onClick:()=>M(t),children:[e.jsx("img",{src:t.url,alt:t.description||"Project photo",loading:"lazy"}),e.jsx("div",{className:"photo-grid-overlay",children:e.jsx($,{size:16})}),e.jsxs("div",{className:"photo-grid-meta",children:[e.jsx("span",{className:"photo-source-badge",children:t.source}),x(t.areaId)&&e.jsxs("span",{className:"photo-area-badge",children:[e.jsx(_,{size:10}),x(t.areaId)]})]})]},t.id))})]},s))}),n&&e.jsx("div",{className:"photo-lightbox",onClick:k,children:e.jsxs("div",{className:"photo-lightbox-content",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"photo-lightbox-close",onClick:k,children:e.jsx(O,{size:24})}),p>0&&e.jsx("button",{className:"photo-lightbox-nav prev",onClick:()=>P(-1),children:e.jsx(B,{size:24})}),e.jsx("img",{src:n.url,alt:n.description||"Project photo"}),p<l.length-1&&e.jsx("button",{className:"photo-lightbox-nav next",onClick:()=>P(1),children:e.jsx(F,{size:24})}),e.jsxs("div",{className:"photo-lightbox-info",children:[e.jsx("div",{className:"photo-lightbox-date",children:S(n.date)}),e.jsx("div",{className:"photo-lightbox-source",children:n.source}),x(n.areaId)&&e.jsxs("div",{className:"photo-lightbox-area",children:[e.jsx(_,{size:12}),x(n.areaId)]}),n.description&&e.jsx("div",{className:"photo-lightbox-desc",children:n.description}),e.jsxs("div",{className:"photo-lightbox-counter",children:[p+1," / ",l.length]})]})]})})]})}export{J as default};
//# sourceMappingURL=PhotoTimeline-Tbj1_aRr.js.map
