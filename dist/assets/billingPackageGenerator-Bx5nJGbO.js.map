{"version":3,"mappings":"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","names":["formatTime","timeStr","hours","minutes","h","ampm","generateBillingPackage","cors","tickets","invoice","project","company","branding","billTo","jsPDF","__vitePreload","n","autoTable","doc","pageWidth","pageHeight","margin","yPos","primaryColor","hexToRgb","logoData","loadImageAsBase64","contactY","col1","col2","boxY","totalCORValue","sum","c","totalTicketValue","t","formatCurrency","totalPhotos","verifiedTickets","btName","btAddress","btContact","genDate","docId","cor","formatDateRange","scopeLines","item","formatDate","workers","totalHrs","s","w","ticket","hasVerification","statusColor","notesLines","photoImages","loadImagesAsBase64","xPos","photoWidth","photoHeight","photoGap","i","imgData","signerInfo","totalPages","footerY","dateSuffix","fileName"],"ignoreList":[],"sources":["../../src/lib/billingPackageGenerator.js"],"sourcesContent":["/**\n * Certified Billing Package Generator\n *\n * Generates a complete, consolidated billing package PDF containing:\n * 1. Cover sheet with project summary\n * 2. Invoice summary\n * 3. COR breakdowns with line items\n * 4. T&M ticket backup with worker hours, materials, and photos\n * 5. Signature verification chain\n *\n * Designed to produce the documentation GCs require for payment approval.\n * Uses snapshot-based approach for determinism.\n */\n\nimport { formatCurrency, formatDate, formatDateRange } from './corCalculations'\nimport { hexToRgb, loadImageAsBase64, loadImagesAsBase64 } from './imageUtils'\n\nconst formatTime = (timeStr) => {\n  if (!timeStr) return ''\n  const [hours, minutes] = timeStr.split(':')\n  const h = parseInt(hours)\n  const ampm = h >= 12 ? 'pm' : 'am'\n  const h12 = h % 12 || 12\n  return `${h12}:${minutes}${ampm}`\n}\n\n/**\n * Generate a complete certified billing package PDF.\n *\n * @param {Object} params\n * @param {Object[]} params.cors - Approved CORs with line items\n * @param {Object[]} params.tickets - Signed T&M tickets with workers/items/photos\n * @param {Object} params.invoice - Optional invoice data\n * @param {Object} params.project - Project data\n * @param {Object} params.company - Company data\n * @param {Object} params.branding - Company branding (logo, colors)\n * @param {Object} params.billTo - GC/client billing info\n * @returns {Promise<Object>} { success, fileName, pageCount }\n */\nexport async function generateBillingPackage({\n  cors = [],\n  tickets = [],\n  invoice = null,\n  project,\n  company,\n  branding = {},\n  billTo = {}\n}) {\n  const { default: jsPDF } = await import('jspdf')\n  const { default: autoTable } = await import('jspdf-autotable')\n\n  const doc = new jsPDF()\n  const pageWidth = doc.internal.pageSize.getWidth()\n  const pageHeight = doc.internal.pageSize.getHeight()\n  const margin = 20\n  let yPos = margin\n\n  const primaryColor = branding.primaryColor\n    ? hexToRgb(branding.primaryColor)\n    : [30, 58, 95]\n\n  // ============================================\n  // PAGE 1: COVER SHEET\n  // ============================================\n\n  // Company header\n  if (branding.logoUrl) {\n    try {\n      const logoData = await loadImageAsBase64(branding.logoUrl)\n      if (logoData) {\n        doc.addImage(logoData, 'PNG', margin, yPos, 45, 17)\n      }\n    } catch (_e) {\n      if (company?.name) {\n        doc.setFontSize(16)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(...primaryColor)\n        doc.text(company.name, margin, yPos + 10)\n      }\n    }\n  } else if (company?.name) {\n    doc.setFontSize(16)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(...primaryColor)\n    doc.text(company.name, margin, yPos + 10)\n  }\n\n  // Company contact info\n  doc.setFontSize(8)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(120, 120, 120)\n  let contactY = yPos\n  if (company?.phone) {\n    doc.text(company.phone, pageWidth - margin, contactY, { align: 'right' })\n    contactY += 4\n  }\n  if (company?.email) {\n    doc.text(company.email, pageWidth - margin, contactY, { align: 'right' })\n    contactY += 4\n  }\n\n  yPos += 25\n\n  // Decorative lines\n  doc.setDrawColor(...primaryColor)\n  doc.setLineWidth(1)\n  doc.line(margin, yPos, pageWidth - margin, yPos)\n  yPos += 2\n  doc.setLineWidth(0.3)\n  doc.line(margin, yPos, pageWidth - margin, yPos)\n  yPos += 20\n\n  // Title\n  doc.setFontSize(24)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(30, 41, 59)\n  doc.text('CERTIFIED BILLING PACKAGE', pageWidth / 2, yPos, { align: 'center' })\n  yPos += 12\n\n  // Project name\n  doc.setFontSize(14)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(71, 85, 105)\n  doc.text(project?.name || 'Project', pageWidth / 2, yPos, { align: 'center' })\n  yPos += 6\n  if (project?.job_number) {\n    doc.setFontSize(11)\n    doc.text(`Job #${project.job_number}`, pageWidth / 2, yPos, { align: 'center' })\n  }\n  yPos += 20\n\n  // Summary box\n  doc.setFillColor(248, 250, 252)\n  doc.setDrawColor(226, 232, 240)\n  doc.roundedRect(margin, yPos, pageWidth - margin * 2, 65, 3, 3, 'FD')\n\n  const col1 = margin + 10\n  const col2 = pageWidth / 2 + 10\n  let boxY = yPos + 12\n\n  doc.setFontSize(10)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(30, 41, 59)\n  doc.text('PACKAGE CONTENTS', col1, boxY)\n  doc.setDrawColor(200, 210, 220)\n  doc.line(col1, boxY + 3, pageWidth - margin - 10, boxY + 3)\n  boxY += 12\n\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(71, 85, 105)\n  doc.setFontSize(9)\n\n  doc.text(`Change Orders:`, col1, boxY)\n  doc.setFont('helvetica', 'bold')\n  doc.text(`${cors.length}`, col1 + 40, boxY)\n  doc.setFont('helvetica', 'normal')\n\n  doc.text(`T&M Tickets:`, col2, boxY)\n  doc.setFont('helvetica', 'bold')\n  doc.text(`${tickets.length}`, col2 + 40, boxY)\n  doc.setFont('helvetica', 'normal')\n  boxY += 7\n\n  const totalCORValue = cors.reduce((sum, c) => sum + (c.cor_total || 0), 0)\n  const totalTicketValue = tickets.reduce((sum, t) => sum + ((parseFloat(t.change_order_value) || 0) * 100), 0)\n\n  doc.text(`COR Value:`, col1, boxY)\n  doc.setFont('helvetica', 'bold')\n  doc.text(formatCurrency(totalCORValue), col1 + 40, boxY)\n  doc.setFont('helvetica', 'normal')\n\n  const totalPhotos = tickets.reduce((sum, t) => sum + (t.photos?.length || 0), 0)\n  doc.text(`Photos:`, col2, boxY)\n  doc.setFont('helvetica', 'bold')\n  doc.text(`${totalPhotos}`, col2 + 40, boxY)\n  doc.setFont('helvetica', 'normal')\n  boxY += 7\n\n  const verifiedTickets = tickets.filter(t => t.client_signature_data)\n  doc.text(`Client Verified:`, col1, boxY)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(verifiedTickets.length > 0 ? 16 : 71, verifiedTickets.length > 0 ? 185 : 85, verifiedTickets.length > 0 ? 129 : 105)\n  doc.text(`${verifiedTickets.length} of ${tickets.length} tickets`, col1 + 40, boxY)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(71, 85, 105)\n  boxY += 7\n\n  if (invoice) {\n    doc.text(`Invoice:`, col1, boxY)\n    doc.setFont('helvetica', 'bold')\n    doc.text(`${invoice.invoice_number} — ${formatCurrency(invoice.total || 0)}`, col1 + 40, boxY)\n    doc.setFont('helvetica', 'normal')\n  }\n\n  yPos += 80\n\n  // Bill To info\n  if (billTo.name || invoice?.bill_to_name) {\n    const btName = billTo.name || invoice?.bill_to_name\n    const btAddress = billTo.address || invoice?.bill_to_address\n    const btContact = billTo.contact || invoice?.bill_to_contact\n\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(120, 120, 120)\n    doc.text('SUBMITTED TO:', margin, yPos)\n    yPos += 6\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(30, 41, 59)\n    if (btName) { doc.text(btName, margin, yPos); yPos += 5 }\n    if (btAddress) { doc.text(btAddress, margin, yPos); yPos += 5 }\n    if (btContact) { doc.text(btContact, margin, yPos); yPos += 5 }\n  }\n\n  // Generation date and document ID\n  yPos = pageHeight - 40\n  doc.setFontSize(9)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(120, 120, 120)\n  const genDate = new Date()\n  doc.text(`Generated: ${genDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })} at ${genDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}`, margin, yPos)\n  yPos += 5\n  const docId = crypto.randomUUID().substring(0, 16).toUpperCase()\n  doc.text(`Document ID: ${docId}`, margin, yPos)\n\n  // ============================================\n  // COR DETAIL PAGES\n  // ============================================\n\n  for (const cor of cors) {\n    doc.addPage()\n    yPos = margin\n\n    // COR header\n    doc.setFillColor(...primaryColor)\n    doc.rect(margin, yPos, pageWidth - margin * 2, 14, 'F')\n    doc.setFontSize(12)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(255, 255, 255)\n    doc.text(`${cor.cor_number || 'COR'} — ${cor.title || 'Untitled'}`, margin + 5, yPos + 9)\n    yPos += 20\n\n    // COR meta\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(71, 85, 105)\n    if (cor.period_start || cor.period_end) {\n      doc.text(`Period: ${formatDateRange(cor.period_start, cor.period_end)}`, margin, yPos)\n      yPos += 5\n    }\n    if (cor.scope_of_work) {\n      doc.setFont('helvetica', 'bold')\n      doc.text('Scope:', margin, yPos)\n      doc.setFont('helvetica', 'normal')\n      const scopeLines = doc.splitTextToSize(cor.scope_of_work, pageWidth - margin * 2 - 15)\n      doc.text(scopeLines, margin + 15, yPos)\n      yPos += scopeLines.length * 4 + 5\n    }\n\n    // Labor table\n    if (cor.change_order_labor?.length > 0) {\n      doc.setFontSize(10)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(30, 41, 59)\n      doc.text('Labor', margin, yPos)\n      yPos += 4\n\n      autoTable(doc, {\n        startY: yPos,\n        head: [['Class', 'Wage Type', 'Reg Hrs', 'Reg Rate', 'OT Hrs', 'OT Rate', 'Total']],\n        body: cor.change_order_labor.map(item => [\n          item.labor_class || item.description,\n          item.wage_type || 'Standard',\n          item.regular_hours?.toString() || '0',\n          formatCurrency(item.regular_rate),\n          item.overtime_hours?.toString() || '0',\n          formatCurrency(item.overtime_rate),\n          formatCurrency(item.total)\n        ]),\n        margin: { left: margin, right: margin },\n        headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 7, cellPadding: 2 },\n        bodyStyles: { fontSize: 7, cellPadding: 2 },\n        theme: 'grid'\n      })\n      yPos = doc.lastAutoTable.finalY + 8\n    }\n\n    // Materials table\n    if (cor.change_order_materials?.length > 0) {\n      if (yPos > pageHeight - 50) { doc.addPage(); yPos = margin }\n      doc.setFontSize(10)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(30, 41, 59)\n      doc.text('Materials', margin, yPos)\n      yPos += 4\n\n      autoTable(doc, {\n        startY: yPos,\n        head: [['Description', 'Source', 'Qty', 'Unit Cost', 'Total']],\n        body: cor.change_order_materials.map(item => [\n          item.description,\n          item.source_reference || '-',\n          item.quantity?.toString() || '1',\n          formatCurrency(item.unit_cost),\n          formatCurrency(item.total)\n        ]),\n        margin: { left: margin, right: margin },\n        headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 7, cellPadding: 2 },\n        bodyStyles: { fontSize: 7, cellPadding: 2 },\n        theme: 'grid'\n      })\n      yPos = doc.lastAutoTable.finalY + 8\n    }\n\n    // Equipment table\n    if (cor.change_order_equipment?.length > 0) {\n      if (yPos > pageHeight - 50) { doc.addPage(); yPos = margin }\n      doc.setFontSize(10)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(30, 41, 59)\n      doc.text('Equipment', margin, yPos)\n      yPos += 4\n\n      autoTable(doc, {\n        startY: yPos,\n        head: [['Description', 'Qty', 'Unit Cost', 'Total']],\n        body: cor.change_order_equipment.map(item => [\n          item.description,\n          item.quantity?.toString() || '1',\n          formatCurrency(item.unit_cost),\n          formatCurrency(item.total)\n        ]),\n        margin: { left: margin, right: margin },\n        headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 7, cellPadding: 2 },\n        bodyStyles: { fontSize: 7, cellPadding: 2 },\n        theme: 'grid'\n      })\n      yPos = doc.lastAutoTable.finalY + 8\n    }\n\n    // Subcontractors table\n    if (cor.change_order_subcontractors?.length > 0) {\n      if (yPos > pageHeight - 50) { doc.addPage(); yPos = margin }\n      doc.setFontSize(10)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(30, 41, 59)\n      doc.text('Subcontractors', margin, yPos)\n      yPos += 4\n\n      autoTable(doc, {\n        startY: yPos,\n        head: [['Company', 'Description', 'Total']],\n        body: cor.change_order_subcontractors.map(item => [\n          item.company_name || '-',\n          item.description,\n          formatCurrency(item.total)\n        ]),\n        margin: { left: margin, right: margin },\n        headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 7, cellPadding: 2 },\n        bodyStyles: { fontSize: 7, cellPadding: 2 },\n        theme: 'grid'\n      })\n      yPos = doc.lastAutoTable.finalY + 8\n    }\n\n    // COR Total bar\n    if (yPos > pageHeight - 30) { doc.addPage(); yPos = margin }\n    doc.setFillColor(...primaryColor)\n    doc.rect(margin, yPos, pageWidth - margin * 2, 10, 'F')\n    doc.setFontSize(11)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(255, 255, 255)\n    doc.text('COR TOTAL:', margin + 5, yPos + 7)\n    doc.text(formatCurrency(cor.cor_total), pageWidth - margin - 5, yPos + 7, { align: 'right' })\n    yPos += 15\n\n    // Signature verification\n    if (cor.gc_signature_data || cor.client_signature_data) {\n      if (yPos > pageHeight - 30) { doc.addPage(); yPos = margin }\n\n      doc.setFontSize(9)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(16, 185, 129)\n      doc.text('SIGNATURES', margin, yPos)\n      yPos += 5\n\n      doc.setFont('helvetica', 'normal')\n      doc.setFontSize(8)\n      doc.setTextColor(71, 85, 105)\n      if (cor.gc_signature_name) {\n        doc.text(`GC: ${cor.gc_signature_name} — ${formatDate(cor.gc_signature_date)}`, margin, yPos)\n        yPos += 4\n      }\n      if (cor.client_signature_name) {\n        doc.text(`Client: ${cor.client_signature_name} — ${formatDate(cor.client_signature_date)}`, margin, yPos)\n        yPos += 4\n      }\n    }\n  }\n\n  // ============================================\n  // T&M TICKET BACKUP PAGES\n  // ============================================\n\n  if (tickets.length > 0) {\n    doc.addPage()\n    yPos = margin\n\n    // Section title page\n    doc.setDrawColor(...primaryColor)\n    doc.setLineWidth(0.8)\n    doc.line(margin, yPos, pageWidth - margin, yPos)\n    yPos += 15\n\n    doc.setFontSize(18)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(30, 41, 59)\n    doc.text('T&M TICKET BACKUP', pageWidth / 2, yPos, { align: 'center' })\n    yPos += 8\n\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(71, 85, 105)\n    doc.text(`${tickets.length} tickets | ${totalPhotos} photos | ${verifiedTickets.length} client verified`, pageWidth / 2, yPos, { align: 'center' })\n    yPos += 15\n\n    // Summary table of all tickets\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Date', 'CE/PCO', 'Workers', 'Hours', 'Photos', 'Verified']],\n      body: tickets.map(t => {\n        const workers = t.t_and_m_workers || []\n        const totalHrs = workers.reduce((s, w) => s + (parseFloat(w.hours) || 0) + (parseFloat(w.overtime_hours) || 0), 0)\n        return [\n          formatDate(t.work_date || t.ticket_date),\n          t.ce_pco_number || '-',\n          workers.length.toString(),\n          totalHrs.toFixed(1),\n          (t.photos?.length || 0).toString(),\n          t.client_signature_data ? 'Yes' : 'No'\n        ]\n      }),\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 8 },\n      bodyStyles: { fontSize: 8 },\n      theme: 'grid'\n    })\n\n    // Individual ticket detail pages\n    for (const ticket of tickets) {\n      doc.addPage()\n      yPos = margin\n\n      const hasVerification = !!ticket.client_signature_data\n      const statusColor = hasVerification ? [16, 185, 129] : [245, 158, 11]\n\n      // Ticket header\n      doc.setFillColor(...statusColor)\n      doc.rect(margin, yPos, 4, 18, 'F')\n      doc.setFillColor(248, 250, 252)\n      doc.rect(margin + 4, yPos, pageWidth - margin * 2 - 4, 18, 'F')\n\n      doc.setFontSize(11)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(30, 41, 59)\n      doc.text(`T&M TICKET — ${formatDate(ticket.work_date || ticket.ticket_date)}`, margin + 10, yPos + 7)\n\n      if (ticket.ce_pco_number) {\n        doc.setFontSize(8)\n        doc.setFont('helvetica', 'normal')\n        doc.setTextColor(59, 130, 246)\n        doc.text(`CE/PCO: ${ticket.ce_pco_number}`, margin + 10, yPos + 14)\n      }\n\n      if (hasVerification) {\n        doc.setFontSize(8)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(16, 185, 129)\n        doc.text('CLIENT VERIFIED', pageWidth - margin - 30, yPos + 10)\n      }\n\n      yPos += 24\n\n      // Description\n      if (ticket.notes) {\n        doc.setFontSize(9)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text('DESCRIPTION', margin, yPos)\n        yPos += 5\n        doc.setFont('helvetica', 'normal')\n        doc.setTextColor(51, 65, 85)\n        const notesLines = doc.splitTextToSize(ticket.notes, pageWidth - margin * 2)\n        doc.text(notesLines, margin, yPos)\n        yPos += notesLines.length * 4 + 6\n      }\n\n      // Workers table\n      if (ticket.t_and_m_workers?.length > 0) {\n        doc.setFontSize(9)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text('LABOR', margin, yPos)\n        yPos += 4\n\n        autoTable(doc, {\n          startY: yPos,\n          head: [['Worker', 'Class', 'Reg Hrs', 'OT Hrs', 'Time In', 'Time Out']],\n          body: ticket.t_and_m_workers.map(w => [\n            w.name,\n            w.role || w.labor_class || 'Laborer',\n            w.hours?.toString() || '0',\n            w.overtime_hours?.toString() || '-',\n            formatTime(w.time_started),\n            formatTime(w.time_ended)\n          ]),\n          margin: { left: margin, right: margin },\n          headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 7, cellPadding: 2 },\n          bodyStyles: { fontSize: 7, cellPadding: 2 },\n          alternateRowStyles: { fillColor: [248, 250, 252] },\n          theme: 'grid'\n        })\n        yPos = doc.lastAutoTable.finalY + 8\n      }\n\n      // Materials/Equipment\n      if (ticket.t_and_m_items?.length > 0) {\n        if (yPos > pageHeight - 50) { doc.addPage(); yPos = margin }\n        doc.setFontSize(9)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text('MATERIALS / EQUIPMENT', margin, yPos)\n        yPos += 4\n\n        autoTable(doc, {\n          startY: yPos,\n          head: [['Item', 'Qty', 'Unit']],\n          body: ticket.t_and_m_items.map(item => [\n            item.custom_name || item.materials_equipment?.name || item.description || 'Item',\n            item.quantity?.toString() || '1',\n            item.materials_equipment?.unit || item.unit || 'ea'\n          ]),\n          margin: { left: margin, right: margin },\n          headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 7, cellPadding: 2 },\n          bodyStyles: { fontSize: 7, cellPadding: 2 },\n          theme: 'grid'\n        })\n        yPos = doc.lastAutoTable.finalY + 8\n      }\n\n      // Photos\n      if (ticket.photos?.length > 0) {\n        if (yPos > pageHeight - 70) { doc.addPage(); yPos = margin }\n\n        doc.setFontSize(9)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text(`PHOTO EVIDENCE (${ticket.photos.length})`, margin, yPos)\n        yPos += 6\n\n        const photoImages = await loadImagesAsBase64(ticket.photos)\n        let xPos = margin\n        const photoWidth = 55\n        const photoHeight = 45\n        const photoGap = 5\n\n        for (let i = 0; i < ticket.photos.length; i++) {\n          if (i > 0 && i % 3 === 0) {\n            xPos = margin\n            yPos += photoHeight + photoGap + 2\n          }\n          if (yPos + photoHeight > pageHeight - 15) {\n            doc.addPage()\n            yPos = margin\n            xPos = margin\n          }\n\n          const imgData = photoImages[i]\n          if (imgData) {\n            doc.setDrawColor(200, 200, 200)\n            doc.rect(xPos - 0.5, yPos - 0.5, photoWidth + 1, photoHeight + 1, 'S')\n            doc.addImage(imgData, 'JPEG', xPos, yPos, photoWidth, photoHeight)\n          } else {\n            doc.setFillColor(245, 245, 245)\n            doc.rect(xPos, yPos, photoWidth, photoHeight, 'F')\n            doc.setFontSize(7)\n            doc.setTextColor(150, 150, 150)\n            doc.text('Photo unavailable', xPos + 8, yPos + photoHeight / 2)\n          }\n          xPos += photoWidth + photoGap\n        }\n        yPos += photoHeight + 10\n      }\n\n      // Signature verification block\n      if (ticket.client_signature_data) {\n        if (yPos > pageHeight - 35) { doc.addPage(); yPos = margin }\n\n        doc.setFillColor(240, 253, 244)\n        doc.roundedRect(margin, yPos, pageWidth - margin * 2, 25, 3, 3, 'F')\n        doc.setFillColor(16, 185, 129)\n        doc.rect(margin, yPos, 4, 25, 'F')\n\n        doc.setFontSize(8)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(16, 185, 129)\n        doc.text('CLIENT VERIFIED', margin + 10, yPos + 8)\n\n        doc.setFont('helvetica', 'normal')\n        doc.setFontSize(8)\n        doc.setTextColor(71, 85, 105)\n        const signerInfo = [\n          ticket.client_signature_name,\n          ticket.client_signature_title,\n          ticket.client_signature_company\n        ].filter(Boolean).join(', ')\n        doc.text(signerInfo, margin + 10, yPos + 15)\n        if (ticket.client_signature_date) {\n          doc.text(`Signed: ${formatDate(ticket.client_signature_date)}`, margin + 10, yPos + 21)\n        }\n\n        try {\n          doc.addImage(ticket.client_signature_data, 'PNG', pageWidth - margin - 55, yPos + 3, 50, 19)\n        } catch (_e) {\n          // Signature image failed to load - text info is sufficient\n        }\n      }\n    }\n  }\n\n  // ============================================\n  // FOOTER ON ALL PAGES\n  // ============================================\n\n  const totalPages = doc.internal.getNumberOfPages()\n  for (let i = 1; i <= totalPages; i++) {\n    doc.setPage(i)\n    const footerY = pageHeight - 8\n    doc.setFontSize(7)\n    doc.setTextColor(150, 150, 150)\n    doc.text(`${project?.name || 'Project'} — Billing Package`, margin, footerY)\n    doc.setTextColor(180, 180, 180)\n    doc.text('Generated with FieldSync', pageWidth / 2, footerY, { align: 'center' })\n    doc.setTextColor(150, 150, 150)\n    doc.text(`Page ${i} of ${totalPages}`, pageWidth - margin, footerY, { align: 'right' })\n  }\n\n  // ============================================\n  // SAVE\n  // ============================================\n\n  const dateSuffix = new Date().toISOString().split('T')[0]\n  const fileName = `Billing_Package_${project?.job_number || project?.name?.replace(/\\s+/g, '_') || 'export'}_${dateSuffix}.pdf`\n  doc.save(fileName)\n\n  return {\n    success: true,\n    fileName,\n    pageCount: totalPages,\n    documentId: docId,\n    summary: {\n      corCount: cors.length,\n      ticketCount: tickets.length,\n      photoCount: totalPhotos,\n      verifiedCount: verifiedTickets.length,\n      totalCORValue: totalCORValue,\n      totalTicketValue: totalTicketValue\n    }\n  }\n}\n\nexport default { generateBillingPackage }\n"],"file":"billingPackageGenerator-Bx5nJGbO.js"}