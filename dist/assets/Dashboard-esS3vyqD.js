const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TMList-H_lglCqO.js","assets/pdf-aQqpMATS.js","assets/index-BF21JbQ5.js","assets/icons-Cj6BUtO0.js","assets/react-DXGY7bZi.js","assets/supabase-VuevzHjS.js","assets/index-Ct9GPi7W.css","assets/SignatureLinkGenerator-ByjFy9uV.js","assets/corCalculations-D9qkkIbo.js","assets/ShareModal-DSRr6ovi.js","assets/InjuryReportsList-DY_krQaj.js","assets/NotificationSettings-Wqk4dhS4.js","assets/DailyReportsList-DmXJO6D3.js","assets/CORList-rdInhuC9.js","assets/CORLog-d3L986sM.js","assets/CORForm-CO21cKs8.js","assets/CORDetail-BENK_qEv.js","assets/SignatureCanvas-Cs4T6kcB.js","assets/CORLogPreview-CNHN3V3m.js","assets/BillingCenter-_lfi3V-g.js","assets/DrawRequestModal-DE1lx3WT.js","assets/EquipmentModal-0RYeaDXY.js","assets/AddCostModal-DfwfPXyO.js","assets/DocumentsTab-BGE3_21H.js"])))=>i.map(i=>d[i]);
import{_ as ne}from"./pdf-aQqpMATS.js";import{r as rs,c as ca,a as Nr,S as wr,b as Cr,u as Fe,s as kr,d as Dr,e as Sr,f as _r,g as Er,h as Pr,i as Or,j as Re,k as oa,l as Rr,m as nt,n as Ar,o as Mr,p as Tr,D as Ot,q as da,t as Fr,v as Ir,w as $r,x as rt,y as Lr,z as zr,A as Rt,Z as At,L as ts,C as qr,B as Vr,E as ye,F as it,G as ua,H as Br,I as Ts,J as ma,K as Mt,M as Tt,N as Wr,O as Hr,P as ha,Q as pa,R as Ur,T as Kr,U as Ft,V as lt,W as Gr,X as Yr,Y as Xr,_ as Jr,$ as Qr,a0 as Zr,a1 as It,a2 as ei,a3 as si,a4 as ai,a5 as ti,a6 as ni,a7 as ri,a8 as ii,a9 as li,aa as ct,ab as ot,ac as dt,ad as ci,ae as oi,af as di,ag as Me,ah as ui,ai as mi,aj as hi,ak as $t,al as Qs,am as pi,an as xi,ao as vi,ap as fi,aq as ji,ar as z,as as e,at as gi,au as Te,av as xa,aw as Lt,ax as zt,ay as qt,az as va,aA as bi,aB as yi,aC as Ni,aD as Je,aE as wi,aF as ut,aG as mt,aH as ae,aI as Ci,aJ as ki,aK as Di,aL as Si}from"./index-BF21JbQ5.js";import{r as l,f as Vt,X as Be,a4 as _i,Y as na,y as ze,F as $e,t as he,N as xe,a2 as Os,T as qe,a5 as Ei,a6 as Pi,H as Ee,z as Oi,o as ns,m as Pe,q as Fs,s as is,O as Bt,R as Ri,a7 as Ai,a8 as Wt,a9 as Mi,aa as ls,n as fa,K as cs,ab as Ti,ac as Ps,W as ra,k as Fi,b as os,j as Ii,ad as $i,ae as Zs,af as Li,d as ht,e as Ht,Q as Ze,ag as Ut,ah as zi,ai as ea,a as ia,L as pt,aj as xt,c as qi,ak as Vi,al as Kt,am as Bi,D as es,an as vt,ao as Wi,C as Hi,g as Ui,ap as Ki,aq as Gi,ar as Yi}from"./icons-Cj6BUtO0.js";import{f as oe}from"./corCalculations-D9qkkIbo.js";function Rs(){return Rs=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var t in r)({}).hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},Rs.apply(null,arguments)}function ft(s,a){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,t)}return r}function Xi(s){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?ft(Object(r),!0).forEach(function(t){Ji(s,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):ft(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}function Ji(s,a,r){return(a=Qi(a))in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function Qi(s){var a=Zi(s,"string");return typeof a=="symbol"?a:a+""}function Zi(s,a){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var t=r.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}var ce=32,el={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function sl(s){var{data:a,iconType:r,inactiveColor:t}=s,n=ce/2,i=ce/6,c=ce/3,o=a.inactive?t:a.color,h=r??a.type;if(h==="none")return null;if(h==="plainline"){var u;return l.createElement("line",{strokeWidth:4,fill:"none",stroke:o,strokeDasharray:(u=a.payload)===null||u===void 0?void 0:u.strokeDasharray,x1:0,y1:n,x2:ce,y2:n,className:"recharts-legend-icon"})}if(h==="line")return l.createElement("path",{strokeWidth:4,fill:"none",stroke:o,d:"M0,".concat(n,"h").concat(c,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(2*c,",").concat(n,`
            H`).concat(ce,"M").concat(2*c,",").concat(n,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(c,",").concat(n),className:"recharts-legend-icon"});if(h==="rect")return l.createElement("path",{stroke:"none",fill:o,d:"M0,".concat(ce/8,"h").concat(ce,"v").concat(ce*3/4,"h").concat(-ce,"z"),className:"recharts-legend-icon"});if(l.isValidElement(a.legendIcon)){var d=Xi({},a);return delete d.legendIcon,l.cloneElement(a.legendIcon,d)}return l.createElement(Cr,{fill:o,cx:n,cy:n,size:ce,sizeType:"diameter",type:h})}function al(s){var{payload:a,iconSize:r,layout:t,formatter:n,inactiveColor:i,iconType:c}=s,o={x:0,y:0,width:ce,height:ce},h={display:t==="horizontal"?"inline-block":"block",marginRight:10},u={display:"inline-block",verticalAlign:"middle",marginRight:4};return a.map((d,x)=>{var j=d.formatter||n,y=ca({"recharts-legend-item":!0,["legend-item-".concat(x)]:!0,inactive:d.inactive});if(d.type==="none")return null;var m=d.inactive?i:d.color,p=j?j(d.value,d,x):d.value;return l.createElement("li",Rs({className:y,style:h,key:"legend-item-".concat(x)},Nr(s,d,x)),l.createElement(wr,{width:r,height:r,viewBox:o,style:u,"aria-label":"".concat(p," legend icon")},l.createElement(sl,{data:d,iconType:c,inactiveColor:i})),l.createElement("span",{className:"recharts-legend-item-text",style:{color:m}},p))})}var tl=s=>{var a=rs(s,el),{payload:r,layout:t,align:n}=a;if(!r||!r.length)return null;var i={padding:0,margin:0,textAlign:t==="horizontal"?n:"left"};return l.createElement("ul",{className:"recharts-default-legend",style:i},l.createElement(al,Rs({},a,{payload:r})))};function nl(){return Fe(kr)}var rl=["contextPayload"];function la(){return la=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var t in r)({}).hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},la.apply(null,arguments)}function jt(s,a){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,t)}return r}function Ve(s){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?jt(Object(r),!0).forEach(function(t){il(s,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):jt(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}function il(s,a,r){return(a=ll(a))in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function ll(s){var a=cl(s,"string");return typeof a=="symbol"?a:a+""}function cl(s,a){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var t=r.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function ol(s,a){if(s==null)return{};var r,t,n=dl(s,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(t=0;t<i.length;t++)r=i[t],a.indexOf(r)===-1&&{}.propertyIsEnumerable.call(s,r)&&(n[r]=s[r])}return n}function dl(s,a){if(s==null)return{};var r={};for(var t in s)if({}.hasOwnProperty.call(s,t)){if(a.indexOf(t)!==-1)continue;r[t]=s[t]}return r}function ul(s){return s.value}function ml(s){var{contextPayload:a}=s,r=ol(s,rl),t=Ar(a,s.payloadUniqBy,ul),n=Ve(Ve({},r),{},{payload:t});return l.isValidElement(s.content)?l.cloneElement(s.content,n):typeof s.content=="function"?l.createElement(s.content,n):l.createElement(tl,n)}function hl(s,a,r,t,n,i){var{layout:c,align:o,verticalAlign:h}=a,u,d;return(!s||(s.left===void 0||s.left===null)&&(s.right===void 0||s.right===null))&&(o==="center"&&c==="vertical"?u={left:((t||0)-i.width)/2}:u=o==="right"?{right:r&&r.right||0}:{left:r&&r.left||0}),(!s||(s.top===void 0||s.top===null)&&(s.bottom===void 0||s.bottom===null))&&(h==="middle"?d={top:((n||0)-i.height)/2}:d=h==="bottom"?{bottom:r&&r.bottom||0}:{top:r&&r.top||0}),Ve(Ve({},u),d)}function pl(s){var a=oa();return l.useEffect(()=>{a(Rr(s))},[a,s]),null}function xl(s){var a=oa();return l.useEffect(()=>(a(nt(s)),()=>{a(nt({width:0,height:0}))}),[a,s]),null}function vl(s,a,r,t){return s==="vertical"&&Re(a)?{height:a}:s==="horizontal"?{width:r||t}:null}var fl={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function Is(s){var a=rs(s,fl),r=nl(),t=Dr(),n=Sr(),{width:i,height:c,wrapperStyle:o,portal:h}=a,[u,d]=_r([r]),x=Er(),j=Pr();if(x==null||j==null)return null;var y=x-(n?.left||0)-(n?.right||0),m=vl(a.layout,c,i,y),p=h?o:Ve(Ve({position:"absolute",width:m?.width||i||"auto",height:m?.height||c||"auto"},hl(o,a,n,x,j,u)),o),k=h??t;if(k==null||r==null)return null;var E=l.createElement("div",{className:"recharts-legend-wrapper",style:p,ref:d},l.createElement(pl,{layout:a.layout,align:a.align,verticalAlign:a.verticalAlign,itemSorter:a.itemSorter}),!h&&l.createElement(xl,{width:u.width,height:u.height}),l.createElement(ml,la({},a,m,{margin:n,chartWidth:x,chartHeight:j,contextPayload:r})));return Or.createPortal(E,k)}Is.displayName="Legend";function gt(s,a){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,t)}return r}function bt(s){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?gt(Object(r),!0).forEach(function(t){jl(s,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):gt(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}function jl(s,a,r){return(a=gl(a))in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function gl(s){var a=bl(s,"string");return typeof a=="symbol"?a:a+""}function bl(s,a){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var t=r.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function As(){return As=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var t in r)({}).hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},As.apply(null,arguments)}var yl=(s,a)=>{var r;if(l.isValidElement(s))r=l.cloneElement(s,a);else if(typeof s=="function")r=s(a);else{if(!ye(a.x1)||!ye(a.y1)||!ye(a.x2)||!ye(a.y2))return null;r=l.createElement("line",As({},a,{className:"recharts-reference-line-line"}))}return r},Nl=(s,a,r,t,n,i)=>{var{x:c,width:o}=i,h=n.y.apply(s,{position:r});if(ua(h)||a==="discard"&&!n.y.isInRange(h))return null;var u=[{x:c+o,y:h},{x:c,y:h}];return t==="left"?u.reverse():u},wl=(s,a,r,t,n,i)=>{var{y:c,height:o}=i,h=n.x.apply(s,{position:r});if(ua(h)||a==="discard"&&!n.x.isInRange(h))return null;var u=[{x:h,y:c+o},{x:h,y:c}];return t==="top"?u.reverse():u},Cl=(s,a,r,t)=>{var n=s.map(i=>t.apply(i,{position:r}));return a==="discard"&&n.some(i=>!t.isInRange(i))?null:n},kl=(s,a,r,t,n,i)=>{var{x:c,y:o,segment:h,ifOverflow:u}=i,d=it(c),x=it(o);return x?Nl(o,u,r,n,s,a):d?wl(c,u,r,t,s,a):h!=null&&h.length===2?Cl(h,u,r,s):null};function Dl(s){var a=oa();return l.useEffect(()=>(a(Mr(s)),()=>{a(Tr(s))})),null}function Sl(s){var{xAxisId:a,yAxisId:r,shape:t,className:n,ifOverflow:i}=s,c=da(),o=Fr(),h=Fe(I=>Ir(I,a)),u=Fe(I=>$r(I,r)),d=Fe(I=>rt(I,"xAxis",a,c)),x=Fe(I=>rt(I,"yAxis",r,c)),j=Lr();if(!o||!j||h==null||u==null||d==null||x==null)return null;var y=zr({x:d,y:x}),m=kl(y,j,s.position,h.orientation,u.orientation,s);if(!m)return null;var[{x:p,y:k},{x:E,y:v}]=m,P=i==="hidden"?"url(#".concat(o,")"):void 0,g=bt(bt({clipPath:P},Rt(s)),{},{x1:p,y1:k,x2:E,y2:v}),N=Br({x1:p,y1:k,x2:E,y2:v});return l.createElement(At,{zIndex:s.zIndex},l.createElement(ts,{className:ca("recharts-reference-line",n)},yl(t,g),l.createElement(qr,As({},N,{lowerWidth:N.width,upperWidth:N.width}),l.createElement(Vr,{label:s.label}),s.children)))}var _l={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:Ot.line};function Gt(s){var a=rs(s,_l);return l.createElement(l.Fragment,null,l.createElement(Dl,{yAxisId:a.yAxisId,xAxisId:a.xAxisId,ifOverflow:a.ifOverflow,x:a.x,y:a.y,segment:a.segment}),l.createElement(Sl,a))}Gt.displayName="ReferenceLine";var Yt=(s,a,r)=>Mt(s,"xAxis",ha(s,a),r),Xt=(s,a,r)=>Tt(s,"xAxis",ha(s,a),r),Jt=(s,a,r)=>Mt(s,"yAxis",pa(s,a),r),Qt=(s,a,r)=>Tt(s,"yAxis",pa(s,a),r),El=Ts([ma,Yt,Jt,Xt,Qt],(s,a,r,t,n)=>Ft(s,"xAxis")?lt(a,t,!1):lt(r,n,!1)),Pl=(s,a)=>a,Zt=Ts([Gr,Pl],(s,a)=>s.filter(r=>r.type==="area").find(r=>r.id===a)),en=s=>{var a=ma(s),r=Ft(a,"xAxis");return r?"yAxis":"xAxis"},Ol=(s,a)=>{var r=en(s);return r==="yAxis"?pa(s,a):ha(s,a)},Rl=(s,a,r)=>Ur(s,en(s),Ol(s,a),r),Al=Ts([Zt,Rl],(s,a)=>{var r;if(!(s==null||a==null)){var{stackId:t}=s,n=Kr(s);if(!(t==null||n==null)){var i=(r=a[t])===null||r===void 0?void 0:r.stackedData,c=i?.find(o=>o.key===n);if(c!=null)return c.map(o=>[o[0],o[1]])}}}),Ml=Ts([ma,Yt,Jt,Xt,Qt,Al,Wr,El,Zt,Hr],(s,a,r,t,n,i,c,o,h,u)=>{var{chartData:d,dataStartIndex:x,dataEndIndex:j}=c;if(!(h==null||s!=="horizontal"&&s!=="vertical"||a==null||r==null||t==null||n==null||t.length===0||n.length===0||o==null)){var{data:y}=h,m;if(y&&y.length>0?m=y:m=d?.slice(x,j+1),m!=null)return Zl({layout:s,xAxis:a,yAxis:r,xAxisTicks:t,yAxisTicks:n,dataStartIndex:x,areaSettings:h,stackedData:i,displayedData:m,chartBaseValue:u,bandSize:o})}}),Tl=["id"],Fl=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function Oe(){return Oe=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var t in r)({}).hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},Oe.apply(null,arguments)}function sn(s,a){if(s==null)return{};var r,t,n=Il(s,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(t=0;t<i.length;t++)r=i[t],a.indexOf(r)===-1&&{}.propertyIsEnumerable.call(s,r)&&(n[r]=s[r])}return n}function Il(s,a){if(s==null)return{};var r={};for(var t in s)if({}.hasOwnProperty.call(s,t)){if(a.indexOf(t)!==-1)continue;r[t]=s[t]}return r}function yt(s,a){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,t)}return r}function Ie(s){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?yt(Object(r),!0).forEach(function(t){$l(s,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):yt(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}function $l(s,a,r){return(a=Ll(a))in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function Ll(s){var a=zl(s,"string");return typeof a=="symbol"?a:a+""}function zl(s,a){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var t=r.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function Ms(s,a){return s&&s!=="none"?s:a}var ql=s=>{var{dataKey:a,name:r,stroke:t,fill:n,legendType:i,hide:c}=s;return[{inactive:c,dataKey:a,type:i,color:Ms(t,n),value:It(r,a),payload:s}]},Vl=l.memo(s=>{var{dataKey:a,data:r,stroke:t,strokeWidth:n,fill:i,name:c,hide:o,unit:h,tooltipType:u,id:d}=s,x={dataDefinedOnItem:r,positions:void 0,settings:{stroke:t,strokeWidth:n,fill:i,dataKey:a,nameKey:void 0,name:It(c,a),hide:o,type:u,color:Ms(t,i),unit:h,graphicalItemId:d}};return l.createElement(ei,{tooltipEntrySettings:x})});function Bl(s){var{clipPathId:a,points:r,props:t}=s,{needClip:n,dot:i,dataKey:c}=t,o=$t(t);return l.createElement(pi,{points:r,dot:i,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:c,baseProps:o,needClip:n,clipPathId:a})}function Wl(s){var{showLabels:a,children:r,points:t}=s,n=t.map(i=>{var c,o,h={x:(c=i.x)!==null&&c!==void 0?c:0,y:(o=i.y)!==null&&o!==void 0?o:0,width:0,lowerWidth:0,upperWidth:0,height:0};return Ie(Ie({},h),{},{value:i.value,payload:i.payload,parentViewBox:void 0,viewBox:h,fill:void 0})});return l.createElement(hi,{value:a?n:void 0},r)}function Nt(s){var{points:a,baseLine:r,needClip:t,clipPathId:n,props:i}=s,{layout:c,type:o,stroke:h,connectNulls:u,isRange:d}=i,{id:x}=i,j=sn(i,Tl),y=$t(j),m=Rt(j);return l.createElement(l.Fragment,null,a?.length>1&&l.createElement(ts,{clipPath:t?"url(#clipPath-".concat(n,")"):void 0},l.createElement(Qs,Oe({},m,{id:x,points:a,connectNulls:u,type:o,baseLine:r,layout:c,stroke:"none",className:"recharts-area-area"})),h!=="none"&&l.createElement(Qs,Oe({},y,{className:"recharts-area-curve",layout:c,type:o,connectNulls:u,fill:"none",points:a})),h!=="none"&&d&&l.createElement(Qs,Oe({},y,{className:"recharts-area-curve",layout:c,type:o,connectNulls:u,fill:"none",points:r}))),l.createElement(Bl,{points:a,props:j,clipPathId:n}))}function Hl(s){var a,r,{alpha:t,baseLine:n,points:i,strokeWidth:c}=s,o=(a=i[0])===null||a===void 0?void 0:a.y,h=(r=i[i.length-1])===null||r===void 0?void 0:r.y;if(!ye(o)||!ye(h))return null;var u=t*Math.abs(o-h),d=Math.max(...i.map(x=>x.x||0));return Re(n)?d=Math.max(n,d):n&&Array.isArray(n)&&n.length&&(d=Math.max(...n.map(x=>x.x||0),d)),Re(d)?l.createElement("rect",{x:0,y:o<h?o:o-u,width:d+(c?parseInt("".concat(c),10):1),height:Math.floor(u)}):null}function Ul(s){var a,r,{alpha:t,baseLine:n,points:i,strokeWidth:c}=s,o=(a=i[0])===null||a===void 0?void 0:a.x,h=(r=i[i.length-1])===null||r===void 0?void 0:r.x;if(!ye(o)||!ye(h))return null;var u=t*Math.abs(o-h),d=Math.max(...i.map(x=>x.y||0));return Re(n)?d=Math.max(n,d):n&&Array.isArray(n)&&n.length&&(d=Math.max(...n.map(x=>x.y||0),d)),Re(d)?l.createElement("rect",{x:o<h?o:o-u,y:0,width:u,height:Math.floor(d+(c?parseInt("".concat(c),10):1))}):null}function Kl(s){var{alpha:a,layout:r,points:t,baseLine:n,strokeWidth:i}=s;return r==="vertical"?l.createElement(Hl,{alpha:a,points:t,baseLine:n,strokeWidth:i}):l.createElement(Ul,{alpha:a,points:t,baseLine:n,strokeWidth:i})}function Gl(s){var{needClip:a,clipPathId:r,props:t,previousPointsRef:n,previousBaselineRef:i}=s,{points:c,baseLine:o,isAnimationActive:h,animationBegin:u,animationDuration:d,animationEasing:x,onAnimationStart:j,onAnimationEnd:y}=t,m=l.useMemo(()=>({points:c,baseLine:o}),[c,o]),p=ci(m,"recharts-area-"),k=oi(),[E,v]=l.useState(!1),P=!E,g=l.useCallback(()=>{typeof y=="function"&&y(),v(!1)},[y]),N=l.useCallback(()=>{typeof j=="function"&&j(),v(!0)},[j]);if(k==null)return null;var I=n.current,U=i.current;return l.createElement(Wl,{showLabels:P,points:c},t.children,l.createElement(di,{animationId:p,begin:u,duration:d,isActive:h,easing:x,onAnimationEnd:g,onAnimationStart:N,key:p},_=>{if(I){var C=I.length/c.length,A=_===1?c:c.map((R,L)=>{var D=Math.floor(L*C);if(I[D]){var Q=I[D];return Ie(Ie({},R),{},{x:Me(Q.x,R.x,_),y:Me(Q.y,R.y,_)})}return R}),F;return Re(o)?F=Me(U,o,_):ui(o)||ua(o)?F=Me(U,0,_):F=o.map((R,L)=>{var D=Math.floor(L*C);if(Array.isArray(U)&&U[D]){var Q=U[D];return Ie(Ie({},R),{},{x:Me(Q.x,R.x,_),y:Me(Q.y,R.y,_)})}return R}),_>0&&(n.current=A,i.current=F),l.createElement(Nt,{points:A,baseLine:F,needClip:a,clipPathId:r,props:t})}return _>0&&(n.current=c,i.current=o),l.createElement(ts,null,h&&l.createElement("defs",null,l.createElement("clipPath",{id:"animationClipPath-".concat(r)},l.createElement(Kl,{alpha:_,points:c,baseLine:o,layout:k,strokeWidth:t.strokeWidth}))),l.createElement(ts,{clipPath:"url(#animationClipPath-".concat(r,")")},l.createElement(Nt,{points:c,baseLine:o,needClip:a,clipPathId:r,props:t})))}),l.createElement(mi,{label:t.label}))}function Yl(s){var{needClip:a,clipPathId:r,props:t}=s,n=l.useRef(null),i=l.useRef();return l.createElement(Gl,{needClip:a,clipPathId:r,props:t,previousPointsRef:n,previousBaselineRef:i})}class Xl extends l.PureComponent{render(){var{hide:a,dot:r,points:t,className:n,top:i,left:c,needClip:o,xAxisId:h,yAxisId:u,width:d,height:x,id:j,baseLine:y,zIndex:m}=this.props;if(a)return null;var p=ca("recharts-area",n),k=j,{r:E,strokeWidth:v}=ri(r),P=ii(r),g=E*2+v,N=o?"url(#clipPath-".concat(P?"":"dots-").concat(k,")"):void 0;return l.createElement(At,{zIndex:m},l.createElement(ts,{className:p},o&&l.createElement("defs",null,l.createElement(li,{clipPathId:k,xAxisId:h,yAxisId:u}),!P&&l.createElement("clipPath",{id:"clipPath-dots-".concat(k)},l.createElement("rect",{x:c-g/2,y:i-g/2,width:d+g,height:x+g}))),l.createElement(Yl,{needClip:o,clipPathId:k,props:this.props})),l.createElement(ct,{points:t,mainColor:Ms(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:N}),this.props.isRange&&Array.isArray(y)&&l.createElement(ct,{points:y,mainColor:Ms(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:N}))}}var an={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:Ot.area};function Jl(s){var a,r=rs(s,an),{activeDot:t,animationBegin:n,animationDuration:i,animationEasing:c,connectNulls:o,dot:h,fill:u,fillOpacity:d,hide:x,isAnimationActive:j,legendType:y,stroke:m,xAxisId:p,yAxisId:k}=r,E=sn(r,Fl),v=si(),P=ai(),{needClip:g}=ti(p,k),N=da(),{points:I,isRange:U,baseLine:_}=(a=Fe(D=>Ml(D,s.id,N)))!==null&&a!==void 0?a:{},C=ni();if(v!=="horizontal"&&v!=="vertical"||C==null||P!=="AreaChart"&&P!=="ComposedChart")return null;var{height:A,width:F,x:R,y:L}=C;return!I||!I.length?null:l.createElement(Xl,Oe({},E,{activeDot:t,animationBegin:n,animationDuration:i,animationEasing:c,baseLine:_,connectNulls:o,dot:h,fill:u,fillOpacity:d,height:A,hide:x,layout:v,isAnimationActive:j==="auto"?!xi.isSsr:j,isRange:U,legendType:y,needClip:g,points:I,stroke:m,width:F,left:R,top:L,xAxisId:p,yAxisId:k}))}var Ql=(s,a,r,t,n)=>{var i=r??a;if(Re(i))return i;var c=s==="horizontal"?n:t,o=c.scale.domain();if(c.type==="number"){var h=Math.max(o[0],o[1]),u=Math.min(o[0],o[1]);return i==="dataMin"?u:i==="dataMax"||h<0?h:Math.max(Math.min(o[0],o[1]),0)}return i==="dataMin"?o[0]:i==="dataMax"?o[1]:o[0]};function Zl(s){var{areaSettings:{connectNulls:a,baseValue:r,dataKey:t},stackedData:n,layout:i,chartBaseValue:c,xAxis:o,yAxis:h,displayedData:u,dataStartIndex:d,xAxisTicks:x,yAxisTicks:j,bandSize:y}=s,m=n&&n.length,p=Ql(i,c,r,o,h),k=i==="horizontal",E=!1,v=u.map((g,N)=>{var I,U,_;if(m)_=n[d+N];else{var C=ot(g,t);Array.isArray(C)?(_=C,E=!0):_=[p,C]}var A=(I=(U=_)===null||U===void 0?void 0:U[1])!==null&&I!==void 0?I:null,F=A==null||m&&!a&&ot(g,t)==null;return k?{x:dt({axis:o,ticks:x,bandSize:y,entry:g,index:N}),y:F?null:h.scale(A),value:_,payload:g}:{x:F?null:o.scale(A),y:dt({axis:h,ticks:j,bandSize:y,entry:g,index:N}),value:_,payload:g}}),P;return m||E?P=v.map(g=>{var N=Array.isArray(g.value)?g.value[0]:null;return k?{x:g.x,y:N!=null&&g.y!=null?h.scale(N):null,payload:g.payload}:{x:N!=null?o.scale(N):null,y:g.y,payload:g.payload}}):P=k?h.scale(p):o.scale(p),{points:v,baseLine:P,isRange:E}}function ec(s){var a=rs(s,an),r=da();return l.createElement(Xr,{id:a.id,type:"area"},t=>l.createElement(l.Fragment,null,l.createElement(Jr,{legendPayload:ql(a)}),l.createElement(Vl,{dataKey:a.dataKey,data:a.data,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,name:a.name,hide:a.hide,unit:a.unit,tooltipType:a.tooltipType,id:t}),l.createElement(Qr,{type:"area",id:t,data:a.data,dataKey:a.dataKey,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,stackId:Zr(a.stackId),hide:a.hide,barSize:void 0,baseValue:a.baseValue,isPanorama:r,connectNulls:a.connectNulls}),l.createElement(Jl,Oe({},a,{id:t}))))}var ss=l.memo(ec,Yr);ss.displayName="Area";var sc=["axis"],ac=l.forwardRef((s,a)=>l.createElement(vi,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:sc,tooltipPayloadSearcher:fi,categoricalChartProps:s,ref:a}));const wt={WARNING:"warning",ERROR:"error"},de={DATABASE:"database",NETWORK:"network",AUTH:"auth",VALIDATION:"validation",STORAGE:"storage",SYNC:"sync",GENERAL:"general"};function tc(s){const a=s?.message?.toLowerCase()||"",r=s?.code?.toLowerCase()||"";return a.includes("fetch")||a.includes("network")||a.includes("offline")?de.NETWORK:a.includes("auth")||a.includes("unauthorized")||r.includes("auth")?de.AUTH:a.includes("storage")||a.includes("bucket")||a.includes("upload")?de.STORAGE:a.includes("validation")||a.includes("invalid")||a.includes("required")?de.VALIDATION:a.includes("sync")||a.includes("conflict")?de.SYNC:s?.code||a.includes("database")||a.includes("supabase")?de.DATABASE:de.GENERAL}function nc(s,a,r){return r?.userMessage?r.userMessage:a===de.NETWORK?"Network connection issue. Your changes will sync when back online.":a===de.AUTH?"Session expired. Please sign in again.":a===de.STORAGE?"Failed to upload file. Please try again.":a===de.VALIDATION?s?.message||"Please check your input and try again.":a===de.SYNC?"Sync conflict detected. Please refresh and try again.":r?.operation?`Failed to ${r.operation.replace(/([A-Z])/g," $1").toLowerCase().trim()}. Please try again.`:"Something went wrong. Please try again."}function rc(s,a={}){const{operation:r="unknown",category:t=tc(s),severity:n=wt.ERROR,showToast:i,userMessage:c,companyId:o,projectId:h,userId:u,silent:d=!1,rethrow:x=!1}=a;if(ji.error(t,{message:s?.message||"Unknown error",code:s?.code,severity:n,operation:r,company_id:o,project_id:h,user_id:u,extra:{stack:s?.stack,name:s?.name}}),!d&&i){const j=nc(s,t,{operation:r,userMessage:c}),y=n===wt.WARNING?"warning":"error";i(j,y)}if(x)throw s;return null}async function le(s,a={}){const{fallback:r=null,context:t={},showToast:n,silent:i=!0}=a;try{return await s()}catch(c){return rc(c,{...t,showToast:n,silent:i}),r}}const We={budget:{healthy:.6,warning:.75,critical:.85},schedule:{healthy:.05,warning:.15,critical:.25},corExposure:{healthy:.05,warning:.15,critical:.25},activity:{healthy:1,warning:3,critical:5},safety:{healthy:0,warning:1,critical:2}},ic={budget:.3,schedule:.25,corExposure:.2,activity:.15,safety:.1};function ds(s,a){if(s<=a.healthy)return 0;if(s>=a.critical)return 100;const r=a.critical-a.healthy;return(s-a.healthy)/r*100}function us(s){return s<=25?"healthy":s<=60?"warning":"critical"}function lc(s,a,r=We.budget){if(!a||a<=0)return{score:0,status:"healthy",ratio:0,label:"No revenue yet"};const t=s/a,n=ds(t,r),i=us(n);let c;return t<r.healthy?c=`Costs at ${(t*100).toFixed(0)}% of revenue`:t<r.warning?c=`Costs at ${(t*100).toFixed(0)}% - monitor closely`:c=`Costs at ${(t*100).toFixed(0)}% - review immediately`,{score:n,status:i,ratio:t,label:c}}function cc(s,a,r=We.schedule){if(!a||a<=0)return{score:0,status:"healthy",variance:0,label:"No schedule baseline"};const t=(a-s)/a,n=Math.max(0,t),i=ds(n,r),c=us(i);let o;return t<=0?o=s>=100?"Complete":"On or ahead of schedule":t<r.warning?o=`${(t*100).toFixed(0)}% behind schedule`:o=`${(t*100).toFixed(0)}% behind - needs attention`,{score:i,status:c,variance:t,label:o}}function oc(s,a,r=We.corExposure){if(!a||a<=0)return{score:0,status:"healthy",exposure:0,label:"No contract value"};const t=s/a,n=ds(t,r),i=us(n);let c;return t<r.healthy?c=s>0?`$${sa(s)} pending`:"No pending CORs":t<r.warning?c=`$${sa(s)} pending (${(t*100).toFixed(0)}% of contract)`:c=`High exposure: $${sa(s)} (${(t*100).toFixed(0)}%)`,{score:n,status:i,exposure:t,label:c}}function dc(s,a=We.activity){if(!s)return{score:100,status:"critical",daysSince:null,label:"No reports filed"};const r=new Date(s),n=Math.floor((new Date-r)/(1e3*60*60*24)),i=ds(n,a),c=us(i);let o;return n===0?o="Report filed today":n===1?o="Report filed yesterday":n<=a.warning?o=`Last report ${n} days ago`:o=`No report in ${n} days - may be stalled`,{score:i,status:c,daysSince:n,label:o}}function uc(s,a=We.safety){const r=s||0,t=ds(r,a),n=us(t);let i;return r===0?i="No incidents":r===1?i="1 incident in last 30 days":i=`${r} incidents - safety review needed`,{score:t,status:n,count:r,label:i}}function mc(s,a={}){const r={...We,...a.thresholds},t={...ic,...a.weights},n=lc(s.totalCosts,s.earnedRevenue,r.budget),i=cc(s.actualProgress,s.expectedProgress,r.schedule),c=oc(s.pendingCORValue,s.contractValue,r.corExposure),o=dc(s.lastReportDate,r.activity),h=uc(s.recentInjuryCount,r.safety),u=Math.round(n.score*t.budget+i.score*t.schedule+c.score*t.corExposure+o.score*t.activity+h.score*t.safety);let d;u<=25?d="healthy":u<=60?d="warning":d="critical";let x;return d==="healthy"?x="Project is on track":d==="warning"?x="Some factors need attention":x="Immediate review recommended",{score:u,status:d,label:x,factors:{budget:{...n,weight:t.budget},schedule:{...i,weight:t.schedule},corExposure:{...c,weight:t.corExposure},activity:{...o,weight:t.activity},safety:{...h,weight:t.safety}}}}function hc(s,a){const r=[],{factors:t}=s;t.budget.status==="critical"&&r.push({type:"critical",title:"Budget Alert",description:t.budget.label,action:"Review costs immediately",actionTarget:"financials",projectId:a.id}),t.activity.status==="critical"&&r.push({type:"critical",title:"Activity Alert",description:t.activity.label,action:"Check project status",actionTarget:"overview",projectId:a.id}),t.safety.status==="critical"&&r.push({type:"critical",title:"Safety Alert",description:t.safety.label,action:"Review safety reports",actionTarget:"reports",projectId:a.id}),t.budget.status==="warning"&&r.push({type:"warning",title:"Budget Watch",description:t.budget.label,action:"Monitor costs",actionTarget:"financials",projectId:a.id}),(t.schedule.status==="critical"||t.schedule.status==="warning")&&r.push({type:t.schedule.status==="critical"?"critical":"warning",title:"Schedule Alert",description:t.schedule.label,action:"Review progress",actionTarget:"overview",projectId:a.id}),(t.corExposure.status==="warning"||t.corExposure.status==="critical")&&r.push({type:t.corExposure.status==="critical"?"critical":"warning",title:"COR Exposure",description:t.corExposure.label,action:"Review pending CORs",actionTarget:"cors",projectId:a.id}),t.activity.status==="warning"&&r.push({type:"info",title:"Activity Notice",description:t.activity.label,action:"File daily report",actionTarget:"reports",projectId:a.id});const n={critical:0,warning:1,info:2};return r.sort((i,c)=>n[i.type]-n[c.type]),r}function pc(s){const{actualProgress:a,totalCosts:r,earnedRevenue:t,contractValue:n}=s;if(!a||a<=0)return{estimatedCompletionCost:null,estimatedFinalMargin:null,estimatedCompletionDate:null};const i=r/a,c=Math.round(i*100),o=n>0?(n-c)/n*100:0;let h=null;if(s.startDate&&a>0&&a<100){const u=new Date(s.startDate),d=new Date,x=Math.max(1,(d-u)/(1e3*60*60*24)),j=a/x,m=(100-a)/j;h=new Date(d.getTime()+m*24*60*60*1e3)}return{estimatedCompletionCost:c,estimatedFinalMargin:o,estimatedCompletionDate:h,costPerPercent:i}}function sa(s){return s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toFixed(0)}const $s=()=>ne(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),Z=210,$=14,pe=Z-$*2,Le=s=>s?new Date(s+(s.includes("T")?"":"T12:00:00")).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"—",ve=(s,a,r=30)=>a+r>s.internal.pageSize.height-20?(s.addPage(),20):a;async function xc(s,a){const t=(await $s()).default,n=new t;let i=20;n.setFontSize(18),n.setFont(void 0,"bold"),n.text("Daily Reports",Z/2,i,{align:"center"}),i+=8,n.setFontSize(11),n.setFont(void 0,"normal"),n.text(`Project: ${a.name}`,Z/2,i,{align:"center"}),i+=6,n.text(`${s.length} report${s.length!==1?"s":""}`,Z/2,i,{align:"center"}),i+=12,s.forEach((o,h)=>{i=ve(n,i,60),n.setDrawColor(200,200,200),n.setFillColor(245,247,250),n.roundedRect($,i-2,pe,10,2,2,"F"),n.setFontSize(11),n.setFont(void 0,"bold"),n.setTextColor(30,30,30),n.text(`${Le(o.report_date)}`,$+4,i+5);const u=o.status==="submitted"?"Submitted":"Draft";n.setFontSize(9),n.setFont(void 0,"normal"),n.text(u,Z-$-4,i+5,{align:"right"}),i+=14,n.setTextColor(0,0,0),n.setFontSize(9);const d=[`Crew: ${o.crew_count||0}`,`Tasks: ${o.tasks_completed||0}/${o.tasks_total||0}`,`T&M Tickets: ${o.tm_tickets_count||0}`,`Photos: ${o.photos_count||0}`];if(n.text(d.join("    |    "),$+4,i),i+=7,o.crew_list?.length>0){n.setFont(void 0,"bold"),n.text("Crew:",$+4,i),n.setFont(void 0,"normal");const x=o.crew_list.map(y=>`${y.name} (${y.role||"Laborer"})`).join(", "),j=n.splitTextToSize(x,pe-8);i+=4,n.text(j,$+4,i),i+=j.length*4+2}if(o.field_notes){i=ve(n,i,15),n.setFont(void 0,"bold"),n.text("Field Notes:",$+4,i),n.setFont(void 0,"normal"),i+=4;const x=n.splitTextToSize(o.field_notes,pe-8);n.text(x,$+4,i),i+=x.length*4+2}if(o.issues){i=ve(n,i,15),n.setFont(void 0,"bold"),n.text("Issues:",$+4,i),n.setFont(void 0,"normal"),i+=4;const x=n.splitTextToSize(o.issues,pe-8);n.text(x,$+4,i),i+=x.length*4+2}i+=8,h<s.length-1&&(n.setDrawColor(220,220,220),n.line($,i,Z-$,i),i+=6)});const c=`${a.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;n.save(c)}async function vc(s,a){const t=(await $s()).default,n=new t;let i=20;n.setFontSize(18),n.setFont(void 0,"bold"),n.text("Incident / Injury Reports",Z/2,i,{align:"center"}),i+=8,n.setFontSize(11),n.setFont(void 0,"normal"),n.text(`Project: ${a.name}`,Z/2,i,{align:"center"}),i+=6,n.text(`${s.length} report${s.length!==1?"s":""}`,Z/2,i,{align:"center"}),i+=12,s.forEach((o,h)=>{i=ve(n,i,50);const d={minor:[34,197,94],serious:[245,158,11],critical:[239,68,68],near_miss:[59,130,246]}[o.injury_type]||[128,128,128];n.setFillColor(...d),n.roundedRect($,i-2,3,14,1,1,"F"),n.setFontSize(11),n.setFont(void 0,"bold"),n.setTextColor(30,30,30),n.text(`${Le(o.incident_date)}`,$+8,i+4),n.setFontSize(9);const x=(o.injury_type||"").replace("_"," ").toUpperCase();if(n.text(x,$+8,i+10),n.setFont(void 0,"normal"),n.text(o.status==="open"?"OPEN":"CLOSED",Z-$-4,i+4,{align:"right"}),i+=16,n.setTextColor(0,0,0),o.description){n.setFontSize(9),n.setFont(void 0,"bold"),n.text("Description:",$+4,i),n.setFont(void 0,"normal"),i+=4;const j=n.splitTextToSize(o.description,pe-8);n.text(j,$+4,i),i+=j.length*4+2}o.location&&(n.setFont(void 0,"bold"),n.text("Location: ",$+4,i),n.setFont(void 0,"normal"),n.text(o.location,$+30,i),i+=6),i+=6,h<s.length-1&&(n.setDrawColor(220,220,220),n.line($,i,Z-$,i),i+=6)});const c=`${a.name}_Incident_Reports_${new Date().toISOString().split("T")[0]}.pdf`;n.save(c)}async function fc(s,a){const t=(await $s()).default,n=new t;let i=20;n.setFontSize(18),n.setFont(void 0,"bold"),n.text("Crew Check-In History",Z/2,i,{align:"center"}),i+=8,n.setFontSize(11),n.setFont(void 0,"normal"),n.text(`Project: ${a.name}`,Z/2,i,{align:"center"}),i+=6,n.text(`${s.length} check-in${s.length!==1?"s":""}`,Z/2,i,{align:"center"}),i+=12,s.forEach((o,h)=>{i=ve(n,i,30);const u=o.workers||[];n.setFillColor(245,247,250),n.roundedRect($,i-2,pe,9,2,2,"F"),n.setFontSize(10),n.setFont(void 0,"bold"),n.setTextColor(30,30,30),n.text(Le(o.check_in_date),$+4,i+4),n.setFont(void 0,"normal"),n.text(`${u.length} workers`,Z-$-4,i+4,{align:"right"}),i+=12,n.setTextColor(0,0,0),n.setFontSize(9),u.length>0&&(n.setFont(void 0,"bold"),n.text("Name",$+4,i),n.text("Role",110,i),i+=5,n.setFont(void 0,"normal"),u.forEach(d=>{i=ve(n,i,6),n.text(d.name||"—",$+4,i),n.text(d.role||"Laborer",110,i),i+=4.5})),i+=6,h<s.length-1&&(n.setDrawColor(220,220,220),n.line($,i,Z-$,i),i+=5)});const c=`${a.name}_Crew_Checkins_${new Date().toISOString().split("T")[0]}.pdf`;n.save(c)}async function jc({dailyReports:s=[],incidentReports:a=[],crewCheckins:r=[],project:t}){const i=(await $s()).default,c=new i;let o=20;c.setFontSize(22),c.setFont(void 0,"bold"),c.text("Field Documents Report",Z/2,o,{align:"center"}),o+=10,c.setFontSize(13),c.setFont(void 0,"normal"),c.text(`Project: ${t.name}`,Z/2,o,{align:"center"}),o+=8,c.setFontSize(10),c.text(`Generated: ${new Date().toLocaleDateString()}`,Z/2,o,{align:"center"}),o+=16,c.setFontSize(11),c.setFont(void 0,"bold"),c.text("Document Summary",$,o),o+=8,c.setFontSize(10),c.setFont(void 0,"normal"),[["Daily Reports",`${s.length}`],["Incident Reports",`${a.length}`],["Crew Check-Ins",`${r.length}`]].forEach(([d,x])=>{c.text(d,$+4,o),c.text(x,100,o),o+=6}),s.length>0&&(c.addPage(),o=20,c.setFontSize(16),c.setFont(void 0,"bold"),c.text("Daily Reports",$,o),o+=10,s.forEach((d,x)=>{if(o=ve(c,o,40),c.setFontSize(10),c.setFont(void 0,"bold"),c.setTextColor(30,30,30),c.text(Le(d.report_date),$+2,o),c.setFont(void 0,"normal"),c.setFontSize(8),c.text(`Crew: ${d.crew_count||0} | Tasks: ${d.tasks_completed||0}/${d.tasks_total||0} | T&M: ${d.tm_tickets_count||0}`,$+60,o),o+=6,c.setTextColor(0,0,0),c.setFontSize(9),d.field_notes){const j=c.splitTextToSize(d.field_notes,pe-4);c.text(j,$+2,o),o+=j.length*4+2}if(d.issues){c.setFont(void 0,"bold"),c.text("Issues: ",$+2,o),c.setFont(void 0,"normal");const j=c.splitTextToSize(d.issues,pe-20);c.text(j,$+20,o),o+=j.length*4+2}o+=4,x<s.length-1&&(c.setDrawColor(220,220,220),c.line($,o,Z-$,o),o+=4)})),a.length>0&&(c.addPage(),o=20,c.setFontSize(16),c.setFont(void 0,"bold"),c.text("Incident / Injury Reports",$,o),o+=10,a.forEach((d,x)=>{o=ve(c,o,35),c.setFontSize(10),c.setFont(void 0,"bold"),c.setTextColor(30,30,30),c.text(Le(d.incident_date),$+2,o),c.setFontSize(8),c.setFont(void 0,"normal");const j=(d.injury_type||"").replace("_"," ").toUpperCase();if(c.text(`${j} — ${d.status?.toUpperCase()||""}`,$+60,o),o+=6,c.setTextColor(0,0,0),c.setFontSize(9),d.description){const y=c.splitTextToSize(d.description,pe-4);c.text(y,$+2,o),o+=y.length*4+2}d.location&&(c.text(`Location: ${d.location}`,$+2,o),o+=5),o+=4,x<a.length-1&&(c.setDrawColor(220,220,220),c.line($,o,Z-$,o),o+=4)})),r.length>0&&(c.addPage(),o=20,c.setFontSize(16),c.setFont(void 0,"bold"),c.text("Crew Check-In History",$,o),o+=10,r.forEach((d,x)=>{o=ve(c,o,20);const j=d.workers||[];if(c.setFontSize(10),c.setFont(void 0,"bold"),c.setTextColor(30,30,30),c.text(Le(d.check_in_date),$+2,o),c.setFont(void 0,"normal"),c.setFontSize(8),c.text(`${j.length} workers`,$+60,o),o+=6,c.setTextColor(0,0,0),c.setFontSize(8),j.length>0){const y=j.map(p=>`${p.name} (${p.role||"Laborer"})`).join(", "),m=c.splitTextToSize(y,pe-4);c.text(m,$+2,o),o+=m.length*3.5+3}x<r.length-1&&(c.setDrawColor(230,230,230),c.line($,o,Z-$,o),o+=3)}));const u=`${t.name}_Field_Documents_${new Date().toISOString().split("T")[0]}.pdf`;c.save(u)}function gc({isOpen:s,onClose:a,companyId:r,onSelectProject:t,onSelectTicket:n,onSelectCOR:i,onShowToast:c}){const[o,h]=l.useState(""),[u,d]=l.useState({projects:[],tickets:[],cors:[],workers:[]}),[x,j]=l.useState(!1),[y,m]=l.useState(0),p=l.useRef(null),k=l.useRef(null),E=l.useRef(null);l.useEffect(()=>()=>{k.current&&clearTimeout(k.current),E.current&&clearTimeout(E.current)},[]),l.useEffect(()=>{s&&(h(""),d({projects:[],tickets:[],cors:[],workers:[]}),m(0),E.current=setTimeout(()=>p.current?.focus(),50))},[s]);const v=l.useCallback(async C=>{if(!C.trim()||C.length<2){d({projects:[],tickets:[],cors:[],workers:[]});return}j(!0);try{const A=await z.universalSearch(r,C.trim());d(A),m(0)}catch(A){console.error("Search error:",A),c?.("Search failed","error")}finally{j(!1)}},[r,c]),P=C=>{const A=C.target.value;h(A),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{v(A)},200)},N=(()=>{const C=[];return u.projects.forEach(A=>C.push({type:"project",data:A})),u.tickets.forEach(A=>C.push({type:"ticket",data:A})),u.cors.forEach(A=>C.push({type:"cor",data:A})),u.workers.forEach(A=>C.push({type:"worker",data:A})),C})(),I=N.length>0,U=C=>{C.key==="Escape"?a():C.key==="ArrowDown"?(C.preventDefault(),m(A=>Math.min(A+1,N.length-1))):C.key==="ArrowUp"?(C.preventDefault(),m(A=>Math.max(A-1,0))):C.key==="Enter"&&I&&(C.preventDefault(),_(N[y]))},_=C=>{if(C){switch(C.type){case"project":t?.(C.data);break;case"ticket":n?.(C.data);break;case"cor":i?.(C.data);break;case"worker":C.data.lastProject&&t?.(C.data.lastProject);break}a()}};return s?e.jsx("div",{className:"universal-search-overlay",onClick:a,children:e.jsxs("div",{className:"universal-search-modal",onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"universal-search-input-wrapper",children:[e.jsx(Vt,{size:20,className:"universal-search-icon"}),e.jsx("input",{ref:p,type:"text",value:o,onChange:P,onKeyDown:U,placeholder:"Search projects, tickets, CORs, workers...",className:"universal-search-input",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),o&&e.jsx("button",{className:"universal-search-clear",onClick:()=>h(""),children:e.jsx(Be,{size:16})}),e.jsx("div",{className:"universal-search-shortcut",children:e.jsx("span",{children:"esc"})})]}),e.jsx("div",{className:"universal-search-results",children:x?e.jsxs("div",{className:"universal-search-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Searching..."})]}):o.trim()?I?e.jsxs(e.Fragment,{children:[u.projects.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(na,{size:14}),e.jsx("span",{children:"Projects"})]}),u.projects.map((C,A)=>{const F=A;return e.jsxs("button",{className:`universal-search-item ${y===F?"selected":""}`,onClick:()=>_({type:"project",data:C}),onMouseEnter:()=>m(F),children:[e.jsx(na,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:C.name}),C.job_number&&e.jsxs("span",{className:"universal-search-item-meta",children:["#",C.job_number]})]}),e.jsx(ze,{size:16,className:"universal-search-item-arrow"})]},C.id)})]}),u.tickets.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx($e,{size:14}),e.jsx("span",{children:"T&M Tickets"})]}),u.tickets.map((C,A)=>{const F=u.projects.length+A;return e.jsxs("button",{className:`universal-search-item ${y===F?"selected":""}`,onClick:()=>_({type:"ticket",data:C}),onMouseEnter:()=>m(F),children:[e.jsx($e,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[C.description?.substring(0,50)||"T&M Ticket",C.description?.length>50&&"..."]}),e.jsxs("span",{className:"universal-search-item-meta",children:[C.projectName," • ",C.work_date]})]}),e.jsx("span",{className:`universal-search-item-badge ${C.status}`,children:C.status})]},C.id)})]}),u.cors.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(he,{size:14}),e.jsx("span",{children:"Change Orders"})]}),u.cors.map((C,A)=>{const F=u.projects.length+u.tickets.length+A;return e.jsxs("button",{className:`universal-search-item ${y===F?"selected":""}`,onClick:()=>_({type:"cor",data:C}),onMouseEnter:()=>m(F),children:[e.jsx(he,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[C.cor_number?`COR #${C.cor_number}: `:"",C.title]}),e.jsx("span",{className:"universal-search-item-meta",children:C.projectName})]}),e.jsx("span",{className:`universal-search-item-badge ${C.status}`,children:C.status})]},C.id)})]}),u.workers.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(xe,{size:14}),e.jsx("span",{children:"Workers"})]}),u.workers.map((C,A)=>{const F=u.projects.length+u.tickets.length+u.cors.length+A;return e.jsxs("button",{className:`universal-search-item ${y===F?"selected":""}`,onClick:()=>_({type:"worker",data:C}),onMouseEnter:()=>m(F),children:[e.jsx(xe,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:C.name}),e.jsxs("span",{className:"universal-search-item-meta",children:[C.role," • ",C.projectName]})]}),e.jsx(ze,{size:16,className:"universal-search-item-arrow"})]},`${C.name}-${A}`)})]})]}):e.jsx("div",{className:"universal-search-no-results",children:e.jsxs("span",{children:['No results for "',o,'"']})}):e.jsxs("div",{className:"universal-search-empty",children:[e.jsxs("div",{className:"universal-search-tip",children:[e.jsx(_i,{size:14}),e.jsx("span",{children:"Type to search across all data"})]}),e.jsxs("div",{className:"universal-search-hints",children:[e.jsx("span",{children:"Projects"}),e.jsx("span",{children:"T&M Tickets"}),e.jsx("span",{children:"Change Orders"}),e.jsx("span",{children:"Workers"})]})]})}),e.jsxs("div",{className:"universal-search-footer",children:[e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↑↓"})," navigate"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↵"})," select"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"esc"})," close"]})]})]})}):null}function bc(){const[s,a]=l.useState(!1);return l.useEffect(()=>{const r=t=>{(t.metaKey||t.ctrlKey)&&t.key==="k"&&(t.preventDefault(),a(n=>!n))};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]),{isOpen:s,setIsOpen:a,open:()=>a(!0),close:()=>a(!1)}}function yc({alerts:s=[],onAction:a,onDismiss:r,maxVisible:t=3,className:n=""}){const[i,c]=l.useState(new Set),o=s.filter(u=>!i.has(u.id||`${u.projectId}-${u.type}-${u.title}`)).slice(0,t),h=l.useCallback(u=>{const d=u.id||`${u.projectId}-${u.type}-${u.title}`;c(x=>new Set([...x,d])),r?.(u)},[r]);return o.length===0?null:e.jsxs("div",{className:`smart-alerts ${n}`,role:"region","aria-label":"Project alerts","aria-live":"polite",children:[o.map((u,d)=>e.jsx(Nc,{alert:u,onAction:a,onDismiss:()=>h(u)},u.id||`${u.projectId}-${u.type}-${d}`)),s.length>t&&e.jsx("div",{className:"smart-alerts__overflow",children:e.jsxs("span",{className:"smart-alerts__overflow-text",children:["+",s.length-t," more alerts"]})})]})}function Nc({alert:s,onAction:a,onDismiss:r}){const{type:t="info",title:n,description:i,action:c,actionTarget:o,projectId:h,projectName:u}=s,x={critical:Ei,warning:qe,info:Os}[t]||Os,j=()=>{a?.({target:o,projectId:h,alert:s})};return e.jsxs("div",{className:`smart-alert smart-alert--${t}`,role:"alert","aria-live":t==="critical"?"assertive":"polite",children:[e.jsx(x,{className:"smart-alert__icon","aria-hidden":"true"}),e.jsxs("div",{className:"smart-alert__content",children:[e.jsxs("div",{className:"smart-alert__title",children:[u&&e.jsxs("span",{className:"smart-alert__project",children:[u,": "]}),n]}),i&&e.jsx("div",{className:"smart-alert__description",children:i}),c&&e.jsx("div",{className:"smart-alert__action",children:e.jsxs("button",{type:"button",className:"smart-alert__action-btn",onClick:j,children:[c,e.jsx(Pi,{size:14,"aria-hidden":"true"})]})})]}),r&&e.jsx("button",{type:"button",className:"smart-alert__dismiss",onClick:r,"aria-label":"Dismiss alert",children:e.jsx(Be,{size:18,"aria-hidden":"true"})})]})}function wc({project:s,company:a,onShowToast:r}){const[t,n]=l.useState(null),[i,c]=l.useState(!0),[o,h]=l.useState(!1);l.useEffect(()=>{if(s?.id&&a?.id){u();const m=z.subscribeToCrewCheckins?.(s.id,()=>{u()});return()=>{m&&z.unsubscribe?.(m)}}},[s?.id,a?.id]);const u=async()=>{try{const m=await z.calculateManDayCosts(s.id,a.id,s.work_type||"demolition",s.job_type||"standard");n(m)}catch(m){console.error("Error loading man day costs:",m)}finally{c(!1)}},d=m=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),x=m=>new Date(m).toLocaleDateString("en-US",{month:"short",day:"numeric"}),j=m=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[m]||m.charAt(0).toUpperCase()+m.slice(1);if(i)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!t||t.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Ee,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const y=Object.entries(t.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>h(!o),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:d(t.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:o?"▼ Collapse":"▶ Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:d(t.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.daysWorked>0?d(t.totalCost/t.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),o&&e.jsxs("div",{className:"man-day-details",children:[y.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:y.map(([m,p])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:j(m)}),e.jsxs("span",{className:"role-rate",children:[d(p.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[p.count," days"]}),e.jsx("span",{className:"role-cost",children:d(p.cost)})]})]},m))})]}),t.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:t.byDate.slice(0,7).map((m,p)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:x(m.date)}),e.jsxs("span",{className:"date-workers",children:[m.workers," crew"]}),e.jsx("span",{className:"date-cost",children:d(m.cost)})]},p))}),t.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",t.byDate.length-7," more days"]})]})]})]})}const Cc=l.memo(function({project:a,areas:r=[],corStats:t={},onCreateDraw:n,onViewDraw:i,onShowToast:c}){const[o,h]=l.useState([]),[u,d]=l.useState(!0),x=l.useMemo(()=>r.reduce((g,N)=>{const I=(N.square_footage||0)*(N.price_per_sqft||0);return g+Math.round(I*100)},0),[r]),j=l.useMemo(()=>t?.approvedTotal||0,[t?.approvedTotal]),y=x+j,m=l.useCallback(async()=>{if(a?.id)try{d(!0);const g=await gi.getProjectDrawRequests(a.id);h(g||[])}catch(g){console.error("Error loading draw requests:",g)}finally{d(!1)}},[a?.id]);l.useEffect(()=>{m()},[m]);const p=l.useMemo(()=>{const g=o.filter(_=>["submitted","approved","paid"].includes(_.status)),N=g.reduce((_,C)=>_+(C.previous_billings||0)+(C.current_billing||0),0),U=g[0]?.retention_held||0;return{billedToDate:N,retentionHeld:U}},[o]),k=y>0?Math.round(p.billedToDate/y*100):0,E=o.length>0?Math.max(...o.map(g=>g.draw_number))+1:1,v=g=>g?new Date(g).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",P=g=>{switch(g){case"draft":return e.jsx("span",{className:"badge badge-muted",children:"Draft"});case"submitted":return e.jsx("span",{className:"badge badge-warning",children:"Submitted"});case"approved":return e.jsx("span",{className:"badge badge-success",children:"Approved"});case"paid":return e.jsx("span",{className:"badge badge-info",children:"Paid"});case"rejected":return e.jsx("span",{className:"badge badge-danger",children:"Rejected"});default:return null}};return e.jsxs("div",{className:"progress-billing-card",children:[e.jsxs("div",{className:"progress-billing-header",children:[e.jsxs("div",{className:"progress-billing-title",children:[e.jsx(Oi,{size:18}),e.jsx("h3",{children:"Progress Billing"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>n?.(),disabled:x===0,title:x===0?"Add areas with contract values first":`Create Draw #${E}`,children:[e.jsx(ns,{size:14}),e.jsxs("span",{children:["Draw #",E]})]})]}),e.jsxs("div",{className:"progress-billing-contract",children:[e.jsxs("div",{className:"contract-row",children:[e.jsx("span",{className:"contract-label",children:"Original Contract"}),e.jsx("span",{className:"contract-value",children:oe(x)})]}),j>0&&e.jsxs("div",{className:"contract-row co",children:[e.jsx("span",{className:"contract-label",children:"Approved COs"}),e.jsxs("span",{className:"contract-value positive",children:["+",oe(j)]})]}),e.jsxs("div",{className:"contract-row revised",children:[e.jsx("span",{className:"contract-label",children:"Revised Contract"}),e.jsx("span",{className:"contract-value",children:oe(y)})]})]}),e.jsxs("div",{className:"progress-billing-status",children:[e.jsx("div",{className:"billing-progress-bar",children:e.jsx("div",{className:"billing-progress-fill",style:{width:`${Math.min(k,100)}%`}})}),e.jsxs("div",{className:"billing-stats",children:[e.jsxs("div",{className:"billing-stat",children:[e.jsx("span",{className:"billing-stat-value",children:oe(p.billedToDate)}),e.jsxs("span",{className:"billing-stat-label",children:["Billed to Date (",k,"%)"]})]}),p.retentionHeld>0&&e.jsxs("div",{className:"billing-stat retention",children:[e.jsxs("span",{className:"billing-stat-value",children:["-",oe(p.retentionHeld)]}),e.jsx("span",{className:"billing-stat-label",children:"Retention Held"})]}),e.jsxs("div",{className:"billing-stat remaining",children:[e.jsx("span",{className:"billing-stat-value",children:oe(y-p.billedToDate)}),e.jsx("span",{className:"billing-stat-label",children:"Balance to Finish"})]})]})]}),u?e.jsx("div",{className:"progress-billing-loading",children:e.jsx("div",{className:"loading-spinner small"})}):o.length===0?e.jsxs("div",{className:"progress-billing-empty",children:[e.jsx("p",{children:"No draw requests yet"}),x>0&&e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>n?.(),children:[e.jsx(ns,{size:14}),"Create First Draw Request"]})]}):e.jsxs("div",{className:"progress-billing-draws",children:[e.jsx("div",{className:"draws-header",children:e.jsx("span",{children:"Recent Draws"})}),e.jsx("div",{className:"draws-list",children:o.slice(0,3).map(g=>e.jsxs("button",{className:"draw-item",onClick:()=>i?.(g),children:[e.jsxs("div",{className:"draw-item-info",children:[e.jsxs("span",{className:"draw-number",children:["Draw #",g.draw_number]}),e.jsx("span",{className:"draw-date",children:v(g.period_end||g.created_at)})]}),e.jsx("div",{className:"draw-item-amount",children:oe(g.current_billing||0)}),P(g.status),e.jsx(ze,{size:16,className:"draw-item-arrow"})]},g.id))}),o.length>3&&e.jsxs("button",{className:"btn btn-sm btn-ghost view-all-draws",children:["View all ",o.length," draws"]})]})]})}),aa=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",kc=l.memo(function({project:a,onAddEquipment:r,onEditEquipment:t,onShowToast:n}){const[i,c]=l.useState([]),[o,h]=l.useState(!0),[u,d]=l.useState(!0),[x,j]=l.useState(0),y=l.useCallback(async()=>{if(a?.id)try{h(!0);const v=await Te.getProjectEquipment(a.id);c(v||[]);const P=Te.calculateProjectEquipmentCost(v||[]);j(P)}catch(v){console.error("Error loading equipment:",v),n?.("Failed to load equipment","error")}finally{h(!1)}},[a?.id]);l.useEffect(()=>{y()},[y]);const m=l.useCallback(async v=>{try{await Te.markEquipmentReturned(v.id),n?.(`${v.equipment_name} marked as returned`,"success"),y()}catch(P){console.error("Error marking equipment returned:",P),n?.("Failed to update equipment","error")}},[y]),p=l.useCallback(async v=>{if(confirm(`Remove ${v.equipment_name} from this project?`))try{await Te.removeEquipmentFromProject(v.id),n?.("Equipment removed","success"),y()}catch(P){console.error("Error removing equipment:",P),n?.("Failed to remove equipment","error")}},[y]),k=l.useMemo(()=>i.filter(v=>!v.end_date),[i]),E=l.useMemo(()=>i.filter(v=>v.end_date),[i]);return e.jsxs("div",{className:"project-equipment-card",children:[e.jsxs("div",{className:"project-equipment-header",children:[e.jsxs("div",{className:"project-equipment-title",children:[e.jsx(Pe,{size:18}),e.jsx("h3",{children:"Equipment on Site"}),i.length>0&&e.jsxs("span",{className:"equipment-count",children:[k.length," active"]})]}),e.jsxs("div",{className:"project-equipment-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>r?.(),title:"Add equipment",children:[e.jsx(ns,{size:14}),e.jsx("span",{children:"Add"})]}),i.length>0&&e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>d(!u),children:u?e.jsx(Fs,{size:16}):e.jsx(is,{size:16})})]})]}),o?e.jsx("div",{className:"equipment-loading",children:e.jsx("div",{className:"loading-spinner small"})}):i.length===0?e.jsxs("div",{className:"equipment-empty",children:[e.jsx("p",{children:"No equipment tracked on this project"}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>r?.(),children:[e.jsx(ns,{size:14}),"Track Equipment"]})]}):u?e.jsxs(e.Fragment,{children:[k.length>0&&e.jsx("div",{className:"equipment-list",children:k.map(v=>{const P=Te.calculateDaysOnSite(v.start_date,v.end_date),g=v.daily_rate*P;return e.jsxs("div",{className:"equipment-item active",children:[e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:v.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[e.jsx(Bt,{size:12}),"On-site since ",aa(v.start_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-rate",children:[oe(v.daily_rate),"/day"]}),e.jsxs("span",{className:"equipment-days",children:[P," days"]}),e.jsx("span",{className:"equipment-total",children:oe(g)})]})]}),e.jsxs("div",{className:"equipment-item-actions",children:[e.jsxs("button",{className:"btn btn-xs btn-outline",onClick:()=>m(v),title:"Mark as returned",children:[e.jsx(Ri,{size:12}),"Returned"]}),e.jsx("button",{className:"btn btn-xs btn-ghost",onClick:()=>t?.(v),title:"Edit",children:e.jsx(Ai,{size:12})}),e.jsx("button",{className:"btn btn-xs btn-ghost text-danger",onClick:()=>p(v),title:"Remove",children:e.jsx(Wt,{size:12})})]})]},v.id)})}),E.length>0&&e.jsxs("details",{className:"equipment-returned-section",children:[e.jsx("summary",{className:"equipment-returned-toggle",children:e.jsxs("span",{children:["Returned Equipment (",E.length,")"]})}),e.jsx("div",{className:"equipment-list returned",children:E.map(v=>{const P=Te.calculateDaysOnSite(v.start_date,v.end_date),g=v.daily_rate*P;return e.jsx("div",{className:"equipment-item returned",children:e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:v.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[aa(v.start_date)," - ",aa(v.end_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-days",children:[P," days"]}),e.jsx("span",{className:"equipment-total",children:oe(g)})]})]})},v.id)})})]}),e.jsxs("div",{className:"equipment-total-row",children:[e.jsx("span",{children:"Total Equipment Cost"}),e.jsx("span",{className:"equipment-grand-total",children:oe(x)})]})]}):e.jsxs("div",{className:"equipment-summary-collapsed",children:[e.jsxs("span",{children:[k.length," active, ",E.length," returned"]}),e.jsx("span",{className:"equipment-grand-total",children:oe(x)})]})]})}),be=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Dc=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"});function Sc({dailyBurn:s,totalBurn:a,daysWorked:r,laborCost:t,materialsEquipmentCost:n=0,progress:i,contractValue:c,laborByDate:o=[],materialsEquipmentByDate:h=[]}){const[u,d]=l.useState(!1),x=c*(i/100)*.6,j=a<=x?"on-budget":a<=x*1.2?"warning":"over-budget",y={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[j],m=j==="on-budget"?ls:j==="warning"?fa:cs,k=i>0?a/(i/100):0,E=[],v={};o.forEach(g=>{v[g.date]||(v[g.date]={date:g.date,labor:0,materialsEquipment:0,total:0}),v[g.date].labor=g.cost||0,v[g.date].total+=g.cost||0}),h.forEach(g=>{v[g.date]||(v[g.date]={date:g.date,labor:0,materialsEquipment:0,total:0}),v[g.date].materialsEquipment=g.cost||0,v[g.date].total+=g.cost||0}),Object.values(v).sort((g,N)=>new Date(N.date)-new Date(g.date)).slice(0,10).forEach(g=>E.push(g));const P=Math.max(...E.map(g=>g.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(Mi,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${j}`,children:[e.jsx(m,{size:14}),e.jsx("span",{children:y})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:be(s)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),r>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",r," work day",r!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:be(a)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:be(t)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Materials"}),e.jsx("span",{className:"burn-summary-value",children:be(n)})]})]}),i>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${k>c*.7?"warning":""}`,children:be(k)})]}),E.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>d(!u),children:[u?e.jsx(Fs,{size:16}):e.jsx(is,{size:16}),e.jsxs("span",{children:[u?"Hide":"View"," Daily Breakdown"]})]}),u&&E.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Materials"}),e.jsx("span",{children:"Total"})]}),E.map(g=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:Dc(g.date)}),e.jsx("span",{className:"burn-labor",children:g.labor>0?be(g.labor):"-"}),e.jsx("span",{className:"burn-materials",children:g.materialsEquipment>0?be(g.materialsEquipment):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${g.total/P*100}%`}}),e.jsx("span",{className:"burn-amount",children:be(g.total)})]})]},g.date))]})]})}const W={contract:"#3b82f6",revenue:"#10b981",costs:"#f59e0b",profit:"#22c55e",loss:"#ef4444",tmValue:"#8b5cf6",corValue:"#14b8a6",labor:"#6366f1",disposal:"#14b8a6",equipment:"#f97316",materials:"#a855f7",subcontractor:"#ec4899",other:"#6b7280"},as={duration:800},Ct={contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"12px 16px"},labelStyle:{color:"var(--text-primary)",fontWeight:600,marginBottom:"8px"}},kt={labor:{label:"Labor",color:W.labor,icon:"HardHat"},disposal:{label:"Disposal",color:W.disposal,icon:"Trash2"},equipment:{label:"Equipment",color:W.equipment,icon:"Truck"},materials:{label:"Materials",color:W.materials,icon:"Package"},subcontractor:{label:"Subcontractor",color:W.subcontractor,icon:"Users"},other:{label:"Other",color:W.other,icon:"MoreHorizontal"}},Dt=[{id:"7d",label:"7D",days:7},{id:"30d",label:"30D",days:30},{id:"90d",label:"90D",days:90},{id:"all",label:"All",days:null}],_e=s=>s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(0)}K`:`$${s.toFixed(0)}`,ja=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}),_c={revenue:{id:"revenueGradient",color:W.revenue,startOpacity:.3,endOpacity:0},costs:{id:"costsGradient",color:W.costs,startOpacity:.3,endOpacity:0},tmValue:{id:"tmValueGradient",color:W.tmValue,startOpacity:.2,endOpacity:0}};function Ec(s,a,r=[],t=null,n=[]){const i=a?.contract_value||0,c=s?.laborByDate||[],o=s?.haulOffByDate||[],h=s?.materialsEquipmentByDate||[],u=s?.customCosts||[],d=new Set;c.forEach(N=>d.add(N.date)),o.forEach(N=>d.add(N.date)),h.forEach(N=>d.add(N.date)),u.forEach(N=>{N.cost_date&&d.add(N.cost_date)}),r.forEach(N=>{N.work_date&&d.add(N.work_date),N.ticket_date&&d.add(N.ticket_date),N.created_at&&d.add(N.created_at.split("T")[0])}),n.forEach(N=>{N.status==="done"&&N.updated_at&&d.add(N.updated_at.split("T")[0])});const x=[...d].sort((N,I)=>new Date(N)-new Date(I));if(x.length===0)return[];const j={},y=n.reduce((N,I)=>N+(parseFloat(I.weight)||0),0);n.forEach(N=>{if(N.status==="done"&&N.updated_at){const I=N.updated_at.split("T")[0],U=parseFloat(N.weight)||0,_=N.scheduled_value?parseFloat(N.scheduled_value):y>0?U/y*i:0;j[I]||(j[I]=0),j[I]+=_}});let m=0,p=0;const k={};r.forEach(N=>{const I=N.work_date||N.ticket_date||N.created_at?.split("T")[0];if(!I)return;let U=0;const _=N.t_and_m_workers||N.workers||[];Array.isArray(_)&&_.forEach(A=>{const F=parseFloat(A.hours)||parseFloat(A.regular_hours)||0,R=parseFloat(A.overtime_hours)||0,L=parseFloat(A.regular_rate)||parseFloat(A.rate)||65,D=parseFloat(A.overtime_rate)||L*1.5;U+=F*L+R*D});const C=N.t_and_m_items||N.items||[];Array.isArray(C)&&C.forEach(A=>{const F=parseFloat(A.quantity)||1,R=parseFloat(A.unit_cost)||parseFloat(A.materials_equipment?.cost_per_unit)||0;U+=F*R}),k[I]||(k[I]=0),k[I]+=U});const E={};u.forEach(N=>{const I=N.cost_date;I&&(E[I]||(E[I]=0),E[I]+=parseFloat(N.amount)||0)});const v={};h.forEach(N=>{N.date&&(v[N.date]=N.cost||0)});let P=0;return x.map(N=>{const U=c.find(re=>re.date===N)?.cost||0,C=o.find(re=>re.date===N)?.cost||0,A=v[N]||0,F=E[N]||0,R=U+A+C+F;m+=R;const L=k[N]||0;p+=L;const D=j[N]||0;P+=D;const M=Object.keys(j).length>0?P:s?.billable||0;return{date:N,contract:i,revenue:Math.round(M),costs:Math.round(m),tmValue:Math.round(p),corValue:Math.round(t?.total_approved_value||0),profit:Math.round(M-m),dailyLabor:Math.round(U),dailyRevenue:Math.round(D),dailyMaterials:Math.round(A),dailyHaulOff:Math.round(C),dailyCustom:Math.round(F),dailyTM:Math.round(L),dailyTotal:Math.round(R)}})}function Pc(s,a){if(!a||!s.length)return s;const r=new Date,t=new Date;return t.setDate(r.getDate()-a),s.filter(n=>new Date(n.date)>=t)}function Oc(s=0,a=0,r=[]){const t=[];s>0&&t.push({name:"Labor",value:s,color:W.labor,category:"labor"}),a>0&&t.push({name:"Disposal",value:a,color:W.disposal,category:"disposal"});const n={};r.forEach(c=>{const o=c.category||"other";n[o]||(n[o]={items:[],total:0}),n[o].items.push(c),n[o].total+=parseFloat(c.amount)||0}),Object.entries(n).forEach(([c,o])=>{if(o.total>0){const h=kt[c]||kt.other;t.push({name:h.label,value:o.total,color:h.color,category:c,items:o.items})}});const i=t.reduce((c,o)=>c+o.value,0);return t.forEach(c=>{c.percentage=i>0?Math.round(c.value/i*100):0}),t.sort((c,o)=>o.value-c.value),t}function St(s,a){if(!s||s.length<2)return{direction:"flat",percentage:0};const r=s.slice(-7);if(r.length<2)return{direction:"flat",percentage:0};const t=r[0][a]||0,n=r[r.length-1][a]||0;if(t===0)return{direction:n>0?"up":"flat",percentage:0};const i=(n-t)/t*100;return{direction:i>5?"up":i<-5?"down":"flat",percentage:Math.abs(Math.round(i))}}function Rc({active:s,payload:a,label:r}){if(!s||!a||!a.length)return null;const t=i=>i>=1e6?`$${(i/1e6).toFixed(2)}M`:i>=1e3?`$${(i/1e3).toFixed(1)}K`:`$${i.toFixed(0)}`,n=a[0]?.payload||{};return e.jsxs("div",{className:"chart-tooltip",children:[e.jsx("div",{className:"chart-tooltip-date",children:ja(r)}),e.jsxs("div",{className:"chart-tooltip-rows",children:[n.contract!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:W.contract}}),"Contract"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(n.contract)})]}),n.revenue!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:W.revenue}}),"Revenue"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(n.revenue)})]}),n.costs!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:W.costs}}),"Costs"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(n.costs)})]}),n.tmValue!==void 0&&n.tmValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:W.tmValue}}),"T&M Value"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(n.tmValue)})]}),n.corValue!==void 0&&n.corValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:W.corValue}}),"COR Approved"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(n.corValue)})]}),n.profit!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:n.profit>=0?W.profit:W.loss}}),n.profit>=0?"Profit":"Loss"]}),e.jsx("span",{className:"chart-tooltip-value",style:{color:n.profit>=0?W.profit:W.loss},children:t(Math.abs(n.profit))})]})]}),(n.dailyRevenue>0||n.dailyLabor>0||n.dailyMaterials>0||n.dailyHaulOff>0||n.dailyTM>0)&&e.jsxs("div",{className:"chart-tooltip-daily",children:[e.jsx("div",{className:"chart-tooltip-daily-label",children:"Today's Activity"}),n.dailyRevenue>0&&e.jsx("div",{className:"chart-tooltip-daily-row earned",children:e.jsxs("span",{style:{color:W.revenue},children:["Areas Completed: ",t(n.dailyRevenue)]})}),n.dailyLabor>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Labor: ",t(n.dailyLabor)]}),n.dailyMaterials>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Materials: ",t(n.dailyMaterials)]}),n.dailyHaulOff>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Disposal: ",t(n.dailyHaulOff)]}),n.dailyTM>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["T&M Added: ",t(n.dailyTM)]}),n.dailyTotal>0&&e.jsx("div",{className:"chart-tooltip-daily-row total",children:e.jsxs("strong",{children:["Day Costs: ",t(n.dailyTotal)]})})]}),e.jsx("div",{className:"chart-tooltip-hint",children:"Click to see details"})]})}function Ac({projectData:s,project:a,tmTickets:r=[],corStats:t=null,areas:n=[],onDrillDown:i}){const[c,o]=l.useState("30d"),[h,u]=l.useState(null),d=l.useMemo(()=>{const p=Ec(s,a,r,t,n),k=Dt.find(E=>E.id===c);return Pc(p,k?.days)},[s,a,r,t,n,c]),x=l.useMemo(()=>St(d,"costs"),[d]),j=l.useMemo(()=>St(d,"revenue"),[d]),y=p=>{if(p?.activePayload?.[0]){const k=p.activePayload[0].payload;i?.(k.date,k)}},m=({trend:p})=>p.direction==="up"?e.jsx(cs,{size:14,className:"trend-icon up"}):p.direction==="down"?e.jsx(ls,{size:14,className:"trend-icon down"}):e.jsx(fa,{size:14,className:"trend-icon flat"});return d.length?e.jsxs("div",{className:"financial-trend-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[e.jsx("h3",{children:"Financial Trend"}),e.jsxs("div",{className:"chart-trend-indicators",children:[e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:W.revenue},children:"Revenue"}),e.jsx(m,{trend:j}),j.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[j.percentage,"%"]})]}),e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:W.costs},children:"Costs"}),e.jsx(m,{trend:x}),x.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[x.percentage,"%"]})]})]})]}),e.jsx("div",{className:"time-range-selector",children:Dt.map(p=>e.jsx("button",{className:c===p.id?"active":"",onClick:()=>o(p.id),children:p.label},p.id))})]}),e.jsx("div",{className:"chart-container",children:e.jsx(xa,{width:"100%",height:300,children:e.jsxs(ac,{data:d,onClick:y,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:Object.values(_c).map(p=>e.jsxs("linearGradient",{id:p.id,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:p.color,stopOpacity:p.startOpacity}),e.jsx("stop",{offset:"95%",stopColor:p.color,stopOpacity:p.endOpacity})]},p.id))}),e.jsx(Lt,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(zt,{dataKey:"date",tickFormatter:ja,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(qt,{tickFormatter:_e,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:!1,width:60}),e.jsx(va,{content:e.jsx(Rc,{})}),e.jsx(Is,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,formatter:p=>e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:p})}),d[0]?.contract>0&&e.jsx(Gt,{y:d[0].contract,stroke:W.contract,strokeDasharray:"5 5",strokeWidth:2,label:{value:"Contract",position:"right",fill:W.contract,fontSize:11}}),e.jsx(ss,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:W.revenue,strokeWidth:2,fill:"url(#revenueGradient)",animationDuration:as.duration,onMouseEnter:()=>u("revenue"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="revenue"?.3:1}}),e.jsx(ss,{type:"monotone",dataKey:"costs",name:"Costs",stroke:W.costs,strokeWidth:2,fill:"url(#costsGradient)",animationDuration:as.duration,onMouseEnter:()=>u("costs"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="costs"?.3:1}}),d.some(p=>p.tmValue>0)&&e.jsx(ss,{type:"monotone",dataKey:"tmValue",name:"T&M Value",stroke:W.tmValue,strokeWidth:2,fill:"url(#tmValueGradient)",animationDuration:as.duration,onMouseEnter:()=>u("tmValue"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="tmValue"?.3:1}}),d.some(p=>p.corValue>0)&&e.jsx(ss,{type:"monotone",dataKey:"corValue",name:"COR Approved",stroke:W.corValue,strokeWidth:2,strokeDasharray:"4 2",fill:"transparent",animationDuration:as.duration,onMouseEnter:()=>u("corValue"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="corValue"?.3:1}})]})})}),e.jsxs("div",{className:"chart-quick-stats",children:[e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Current Revenue"}),e.jsx("span",{className:"stat-value",style:{color:W.revenue},children:_e(d[d.length-1]?.revenue||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Total Costs"}),e.jsx("span",{className:"stat-value",style:{color:W.costs},children:_e(d[d.length-1]?.costs||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Margin"}),e.jsx("span",{className:"stat-value",style:{color:(d[d.length-1]?.profit||0)>=0?W.profit:W.loss},children:(()=>{const p=d[d.length-1];return!p||!p.revenue?"0%":`${((p.revenue-p.costs)/p.revenue*100).toFixed(1)}%`})()})]}),d[d.length-1]?.tmValue>0&&e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"T&M Pending"}),e.jsx("span",{className:"stat-value",style:{color:W.tmValue},children:_e(d[d.length-1]?.tmValue||0)})]})]})]}):e.jsx("div",{className:"financial-trend-chart empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No financial data available yet."}),e.jsx("span",{children:"Start tracking labor and costs to see trends."})]})})}function Mc({laborCost:s=0,haulOffCost:a=0,customCosts:r=[],onSegmentClick:t}){const[n,i]=l.useState(null),c=l.useMemo(()=>Oc(s,a,r),[s,a,r]),o=l.useMemo(()=>c.reduce((y,m)=>y+m.value,0),[c]),h=(y,m)=>{i(m)},u=()=>{i(null)},d=(y,m)=>{t&&t(c[m])},x=({active:y,payload:m})=>{if(!y||!m||!m.length)return null;const p=m[0].payload;return e.jsxs("div",{className:"chart-tooltip donut-tooltip",children:[e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:p.color}}),p.name]}),e.jsx("span",{className:"chart-tooltip-value",children:_e(p.value)})]}),e.jsxs("div",{className:"donut-tooltip-pct",children:[p.percentage,"% of total costs"]}),p.items&&p.items.length>0&&e.jsx("div",{className:"donut-tooltip-items",children:e.jsxs("div",{className:"donut-tooltip-items-label",children:[p.items.length," item",p.items.length>1?"s":""]})}),t&&e.jsx("div",{className:"chart-tooltip-hint",children:"Click to view details"})]})},j=y=>{const{payload:m}=y;return e.jsx("div",{className:"donut-legend",children:m.map((p,k)=>e.jsxs("div",{className:`donut-legend-item ${n===k?"active":""}`,onMouseEnter:()=>i(k),onMouseLeave:()=>i(null),onClick:()=>d(null,k),children:[e.jsx("span",{className:"donut-legend-color",style:{backgroundColor:p.payload.color}}),e.jsx("span",{className:"donut-legend-name",children:p.value}),e.jsx("span",{className:"donut-legend-value",children:_e(p.payload.value)})]},`legend-${k}`))})};return!c.length||o===0?e.jsx("div",{className:"cost-donut empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No cost data available."}),e.jsx("span",{children:"Add labor, disposal, or custom costs to see breakdown."})]})}):e.jsx("div",{className:"cost-donut",children:e.jsxs("div",{className:"donut-chart-container",children:[e.jsx(xa,{width:"100%",height:200,children:e.jsxs(bi,{children:[e.jsx(yi,{data:c,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",onMouseEnter:h,onMouseLeave:u,onClick:d,animationDuration:as.duration,animationEasing:"ease-out",children:c.map((y,m)=>e.jsx(Ni,{fill:y.color,stroke:"var(--card-bg)",strokeWidth:2,style:{filter:n===m?"brightness(1.1)":"none",cursor:t?"pointer":"default",transform:n===m?"scale(1.05)":"scale(1)",transformOrigin:"center",transition:"all 0.2s ease"}},`cell-${m}`))}),e.jsx(va,{content:e.jsx(x,{})}),e.jsx(Is,{content:j})]})}),e.jsxs("div",{className:"donut-center-label",children:[e.jsx("span",{className:"donut-center-value",children:_e(o)}),e.jsx("span",{className:"donut-center-text",children:"Total"})]})]})})}const ta=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Ss={labor:{label:"Labor",Icon:Ee,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Pe,color:"#10b981"},equipment:{label:"Equipment",Icon:ra,color:"#f59e0b"},materials:{label:"Materials",Icon:Ps,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:xe,color:"#ec4899"},other:{label:"Other",Icon:Ti,color:"#6b7280"}};function Tc({laborCost:s=0,haulOffCost:a=0,customCosts:r=[],onAddCost:t,onDeleteCost:n}){const[i,c]=l.useState(!0),[o,h]=l.useState(null),u=[];s>0&&u.push({category:"labor",label:"Labor",amount:s,source:"auto",description:"From crew check-ins"}),a>0&&u.push({category:"disposal",label:"Disposal",amount:a,source:"auto",description:"From haul-off logs"});const d={};r.forEach(m=>{d[m.category]||(d[m.category]={category:m.category,items:[],total:0}),d[m.category].items.push(m),d[m.category].total+=parseFloat(m.amount)||0}),Object.values(d).forEach(m=>{const p=Ss[m.category]||Ss.other;u.push({category:m.category,label:p.label,amount:m.total,source:"manual",items:m.items})});const x=u.reduce((m,p)=>m+p.amount,0);u.forEach(m=>{m.percentage=x>0?m.amount/x*100:0}),u.sort((m,p)=>p.amount-m.amount);const j=m=>{h(o===m?null:m)},y=m=>{m.items&&m.items.length>0&&(c(!1),h(m.category))};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsxs("div",{className:"cost-contributors-title",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:ta(x)})]}),u.length>0&&e.jsxs("div",{className:"cost-view-toggle",children:[e.jsx("button",{className:i?"active":"",onClick:()=>c(!0),children:"Chart"}),e.jsx("button",{className:i?"":"active",onClick:()=>c(!1),children:"List"})]})]}),u.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):i?e.jsx(Mc,{laborCost:s,haulOffCost:a,customCosts:r,onSegmentClick:y}):e.jsx("div",{className:"cost-breakdown",children:u.map(m=>{const p=Ss[m.category]||Ss.other,k=p.Icon,E=m.items&&m.items.length>0,v=o===m.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${E?"expandable":""}`,onClick:()=>E&&j(m.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(m.percentage,2)}%`,backgroundColor:p.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(k,{size:14,style:{color:p.color}}),e.jsx("span",{children:m.label}),m.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),E&&(v?e.jsx(Fs,{size:14}):e.jsx(is,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:ta(m.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(m.percentage),"%"]})]})]})]}),v&&E&&e.jsx("div",{className:"cost-category-items",children:m.items.map(P=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:P.description}),e.jsx("span",{className:"cost-item-date",children:new Date(P.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:ta(P.amount)}),n&&e.jsx("button",{className:"cost-item-delete",onClick:g=>{g.stopPropagation(),confirm("Delete this cost entry?")&&n(P.id)},children:e.jsx(Wt,{size:14})})]})]},P.id))})]},m.category)})}),t&&e.jsxs("button",{className:"cost-add-btn",onClick:t,children:[e.jsx(ns,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const De=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0);function Fc({revenue:s,totalCosts:a,contractValue:r,progress:t}){const n=s-a,i=s>0?n/s*100:0,c=r,o=t>0?a/(t/100):a,h=c-o,u=c>0?h/c*100:0,d=i>=20,x=i>=0&&i<20,j=i<0,y=d?"healthy":x?"warning":"loss",m=d?"On Track":x?"Watch Margin":"Over Cost",p=d?Fi:x?os:ls;return e.jsxs("div",{className:`profitability-card ${y}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${y}`,children:[e.jsx(p,{size:14}),e.jsx("span",{children:m})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${i<0?"negative":""}`,children:[Math.round(i),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${i<0?"negative":i<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(i),100)}%`}})})]}),t>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${u<0?"negative":""}`,children:[Math.round(u),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${u<0?"negative":u<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(u),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:De(s)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",De(a)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${n<0?"negative":"positive"}`,children:[n>=0?"":"-",De(Math.abs(n))]})]})]}),t>10&&e.jsxs("div",{className:"profitability-insight",children:[d&&e.jsxs("p",{children:["At ",Math.round(t),"% complete, you're at ",De(n)," profit.",h>0&&` Projected final profit: ${De(h)}`]}),x&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",h<0&&` Trending toward ${De(h)} loss.`]}),j&&e.jsxs("p",{children:["Currently over cost by ",De(Math.abs(n)),". Immediate review recommended."]})]})]})}const tn=[{value:"concrete",label:"Concrete",icon:"🧱"},{value:"trash",label:"Trash",icon:"🗑️"},{value:"metals",label:"Metals",icon:"🔩"},{value:"hazardous_waste",label:"Hazardous",icon:"☣️"}],Ic=s=>tn.find(a=>a.value===s)||{label:s,icon:"📦"};function $c({project:s,period:a="week"}){const[r,t]=l.useState([]),[n,i]=l.useState(!0),[c,o]=l.useState(!1);l.useEffect(()=>{s?.id&&h()},[s?.id,a]);const h=async()=>{try{i(!0);const m=a==="week"?7:a==="month"?30:14,p=await z.getDisposalLoadsHistory(s.id,m);t(p||[])}catch(m){console.error("Error loading disposal summary:",m)}finally{i(!1)}},u=r.reduce((m,p)=>{const k=p.load_type;return m[k]||(m[k]=0),m[k]+=p.load_count,m},{}),d=r.reduce((m,p)=>{const k=p.load_date||p.work_date;return m[k]||(m[k]={date:k,loads:[],total:0}),m[k].loads.push(p),m[k].total+=p.load_count,m},{}),x=Object.values(d).sort((m,p)=>new Date(p.date)-new Date(m.date)).slice(0,7),j=r.reduce((m,p)=>m+p.load_count,0),y=j>0;return n?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Pe,{size:18}),e.jsx("span",{children:"Disposal Loads"})]})}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Pe,{size:18}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("span",{className:"period-badge",children:a==="week"?"Last 7 days":a==="month"?"Last 30 days":"Last 14 days"})]}),y?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"disposal-total-value",children:j}),e.jsx("span",{className:"disposal-total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:tn.map(m=>{const p=u[m.value]||0;if(p===0)return null;const k=Math.round(p/j*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"disposal-type-info",children:[e.jsx("span",{className:"disposal-type-icon",children:m.icon}),e.jsx("span",{className:"disposal-type-label",children:m.label})]}),e.jsxs("div",{className:"disposal-type-stats",children:[e.jsx("span",{className:"disposal-type-count",children:p}),e.jsx("div",{className:"disposal-type-bar",children:e.jsx("div",{className:"disposal-type-bar-fill",style:{width:`${k}%`}})})]})]},m.value)})}),x.length>0&&e.jsxs("button",{className:"disposal-expand-btn",onClick:()=>o(!c),children:[c?e.jsx(Fs,{size:16}):e.jsx(is,{size:16}),e.jsxs("span",{children:[c?"Hide":"View"," Daily Breakdown"]})]}),c&&x.length>0&&e.jsx("div",{className:"disposal-daily-breakdown",children:x.map(m=>{const p=new Date(m.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),k=m.loads.reduce((E,v)=>(E[v.load_type]||(E[v.load_type]=0),E[v.load_type]+=v.load_count,E),{});return e.jsxs("div",{className:"disposal-daily-row",children:[e.jsxs("div",{className:"disposal-daily-header",children:[e.jsx("span",{className:"disposal-daily-date",children:p}),e.jsxs("span",{className:"disposal-daily-total",children:[m.total," loads"]})]}),e.jsx("div",{className:"disposal-daily-types",children:Object.entries(k).map(([E,v])=>{const P=Ic(E);return e.jsxs("span",{className:"disposal-daily-type",children:[P.icon," ",v]},E)})})]},m.date)})})]}):e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx(Pe,{size:32}),e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("span",{className:"text-muted",children:"Loads will appear here when logged by field crews"})]})]})}const _t=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function Lc({project:s,company:a,user:r,isAdmin:t,onShowToast:n}){const[i,c]=l.useState([]),[o,h]=l.useState([]),[u,d]=l.useState(!0),[x,j]=l.useState(!1),[y,m]=l.useState(""),[p,k]=l.useState("Team Member"),[E,v]=l.useState(null);l.useEffect(()=>{s?.id&&P()},[s?.id]),l.useEffect(()=>{x&&a?.id&&g()},[x,a?.id]);const P=async()=>{try{d(!0);const _=await z.getProjectTeam(s.id);c(_)}catch(_){console.error("Error loading project team:",_)}finally{d(!1)}},g=async()=>{try{const _=await z.getCompanyMembers(a.id),C=i.map(F=>F.users?.id),A=_.filter(F=>!C.includes(F.users?.id));h(A)}catch(_){console.error("Error loading company members:",_)}},N=async()=>{if(!y){n("Select a team member","error");return}try{v("add"),await z.addProjectMember(s.id,y,p,r.id),n("Team member added","success"),j(!1),m(""),k("Team Member"),P()}catch(_){console.error("Error adding team member:",_),n("Error adding team member","error")}finally{v(null)}},I=async(_,C)=>{try{v(_.id),await z.updateProjectMemberRole(s.id,_.users?.id,C),n("Role updated","success"),P()}catch(A){console.error("Error updating role:",A),n("Error updating role","error")}finally{v(null)}},U=async _=>{try{v(_.id),await z.removeProjectMember(s.id,_.users?.id),n("Team member removed","success"),P()}catch(C){console.error("Error removing team member:",C),n("Error removing team member","error")}finally{v(null)}};return u?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Project Team"]}),t&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>j(!0),children:[e.jsx(Ii,{size:14})," Add"]})]}),i.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",t&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:i.map(_=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:_.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:_.users?.email})]}),e.jsx("div",{className:"team-member-role",children:t?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:_.project_role,onChange:C=>I(_,C.target.value),disabled:E===_.id,className:"role-select",children:_t.map(C=>e.jsx("option",{value:C,children:C},C))}),e.jsx(is,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:_.project_role})}),t&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>U(_),disabled:E===_.id,title:"Remove from project",children:e.jsx($i,{size:14})})]},_.id))}),x&&e.jsx("div",{className:"modal-overlay",onClick:()=>j(!1),children:e.jsxs("div",{className:"modal-content small",onClick:_=>_.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>j(!1),children:e.jsx(Be,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:y,onChange:_=>m(_.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),o.map(_=>e.jsx("option",{value:_.users?.id,children:_.users?.name||_.users?.email},_.users?.id))]}),o.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:p,onChange:_=>k(_.target.value),className:"form-select",children:_t.map(_=>e.jsx("option",{value:_,children:_},_))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>j(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:N,disabled:!y||E==="add",children:E==="add"?"Adding...":"Add to Project"})]})]})})]})}const Y=l.memo(function({width:a,height:r,borderRadius:t="8px",className:n="",variant:i="default"}){const o=(()=>{switch(i){case"text":return{height:"1em",borderRadius:"4px"};case"circular":return{borderRadius:"50%"};case"rectangular":return{borderRadius:"0"};default:return{borderRadius:t}}})();return e.jsx("div",{className:`skeleton ${n}`,style:{width:a||"100%",height:r||o.height||"1rem",borderRadius:o.borderRadius},"aria-hidden":"true"})});l.memo(function({showProgress:a=!1}){return e.jsxs("div",{className:"metric-skeleton",children:[e.jsx(Y,{width:"60%",height:"0.75rem",className:"skeleton-label"}),e.jsx(Y,{width:"80%",height:"1.75rem",className:"skeleton-value"}),a&&e.jsx(Y,{width:"100%",height:"6px",className:"skeleton-progress"})]})});const go=l.memo(function({lines:a=3,showHeader:r=!0,showAction:t=!1}){return e.jsxs("div",{className:"card-skeleton","aria-busy":"true","aria-label":"Loading content",children:[r&&e.jsxs("div",{className:"card-skeleton-header",children:[e.jsx(Y,{width:"40%",height:"1.25rem"}),t&&e.jsx(Y,{width:"80px",height:"32px"})]}),e.jsx("div",{className:"card-skeleton-body",children:Array.from({length:a}).map((n,i)=>e.jsx(Y,{width:`${100-i*15}%`,height:"1rem",className:"skeleton-line"},i))})]})});l.memo(function({count:a=3,showAvatar:r=!1,showAction:t=!1}){return e.jsx("div",{className:"list-skeleton","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:a}).map((n,i)=>e.jsxs("div",{className:"list-item-skeleton",children:[r&&e.jsx(Y,{width:"40px",height:"40px",variant:"circular"}),e.jsxs("div",{className:"list-item-skeleton-content",children:[e.jsx(Y,{width:"60%",height:"1rem"}),e.jsx(Y,{width:"40%",height:"0.75rem"})]}),t&&e.jsx(Y,{width:"60px",height:"28px"})]},i))})});l.memo(function(){return e.jsx("div",{className:"financial-row-skeleton","aria-busy":"true","aria-label":"Loading financial data",children:[1,2,3].map(a=>e.jsxs("div",{className:"financial-card-skeleton",children:[e.jsxs("div",{className:"financial-card-skeleton-header",children:[e.jsx(Y,{width:"24px",height:"24px",variant:"circular"}),e.jsx(Y,{width:"60%",height:"1rem"})]}),e.jsx(Y,{width:"50%",height:"2rem",className:"skeleton-hero-value"}),e.jsxs("div",{className:"financial-card-skeleton-details",children:[e.jsx(Y,{width:"100%",height:"0.875rem"}),e.jsx(Y,{width:"80%",height:"0.875rem"})]})]},a))})});l.memo(function({height:a="200px"}){return e.jsxs("div",{className:"chart-skeleton",style:{height:a},"aria-busy":"true","aria-label":"Loading chart",children:[e.jsx("div",{className:"chart-skeleton-bars",children:[40,65,45,80,55,70,50,75,60,85].map((r,t)=>e.jsx("div",{className:"chart-skeleton-bar",style:{height:`${r}%`}},t))}),e.jsx(Y,{width:"100%",height:"1px",className:"chart-skeleton-axis"})]})});const Se=l.memo(function({count:a=3}){return e.jsx("div",{className:"ticket-skeleton-list","aria-busy":"true","aria-label":"Loading tickets",children:Array.from({length:a}).map((r,t)=>e.jsxs("div",{className:"ticket-skeleton-item",children:[e.jsxs("div",{className:"ticket-skeleton-header",children:[e.jsx(Y,{width:"100px",height:"0.875rem"}),e.jsx(Y,{width:"80px",height:"24px",borderRadius:"12px"})]}),e.jsx(Y,{width:"90%",height:"1rem"}),e.jsxs("div",{className:"ticket-skeleton-footer",children:[e.jsx(Y,{width:"60px",height:"0.75rem"}),e.jsx(Y,{width:"60px",height:"0.75rem"}),e.jsx(Y,{width:"60px",height:"0.75rem"})]})]},t))})}),zc=l.memo(function(){return e.jsx("div",{className:"hero-metrics-skeleton","aria-busy":"true","aria-label":"Loading metrics",children:[1,2,3,4].map(a=>e.jsxs("div",{className:"hero-metric-skeleton",children:[e.jsx(Y,{width:"80px",height:"0.75rem",className:"skeleton-label"}),e.jsx(Y,{width:"120px",height:"1.75rem",className:"skeleton-value"}),e.jsx(Y,{width:"100%",height:"4px",className:"skeleton-bar"})]},a))})}),bo=l.memo(function({title:a="Unable to load data",message:r="Something went wrong. Please try again.",error:t=null,onRetry:n=null,retryLabel:i="Try Again",variant:c="default",icon:o=null}){const u=o||(t?.message?.includes("network")||t?.message?.includes("offline")?Li:qe);return c==="compact"?e.jsxs("div",{className:"error-state error-state-compact",role:"alert",children:[e.jsx(u,{size:16,className:"error-state-icon","aria-hidden":"true"}),e.jsx("span",{className:"error-state-message",children:r}),n&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:n,"aria-label":i,children:e.jsx(Zs,{size:14})})]}):c==="inline"?e.jsxs("div",{className:"error-state error-state-inline",role:"alert",children:[e.jsxs("div",{className:"error-state-content",children:[e.jsx(u,{size:20,className:"error-state-icon","aria-hidden":"true"}),e.jsxs("div",{className:"error-state-text",children:[e.jsx("span",{className:"error-state-title",children:a}),e.jsx("span",{className:"error-state-message",children:r})]})]}),n&&e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:n,children:[e.jsx(Zs,{size:14})," ",i]})]}):e.jsxs("div",{className:"error-state",role:"alert","aria-live":"polite",children:[e.jsx("div",{className:"error-state-icon-wrapper",children:e.jsx(u,{size:32,className:"error-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"error-state-title",children:a}),e.jsx("p",{className:"error-state-message",children:r}),!1,n&&e.jsxs("button",{className:"btn btn-primary",onClick:n,children:[e.jsx(Zs,{size:16})," ",i]})]})}),yo=l.memo(function({title:a="No data yet",message:r="Items will appear here once added.",icon:t=null,action:n=null,actionLabel:i="Get Started",onAction:c=null}){return e.jsxs("div",{className:"empty-state",role:"status",children:[t&&e.jsx("div",{className:"empty-state-icon-wrapper",children:e.jsx(t,{size:32,className:"empty-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"empty-state-title",children:a}),e.jsx("p",{className:"empty-state-message",children:r}),c&&e.jsx("button",{className:"btn btn-primary btn-small",onClick:c,children:i}),n&&!c&&n]})});l.memo(function({label:a,error:r,required:t=!1,hint:n,children:i,className:c=""}){return e.jsxs("div",{className:`form-field ${r?"has-error":""} ${c}`,children:[a&&e.jsxs("label",{className:"form-field-label",children:[a,t&&e.jsx("span",{className:"form-field-required",children:"*"})]}),e.jsx("div",{className:"form-field-input",children:i}),r&&e.jsxs("div",{className:"form-field-error",role:"alert",children:[e.jsx(os,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:r})]}),n&&!r&&e.jsx("div",{className:"form-field-hint",children:n})]})});l.memo(function({type:a="text",value:r,onChange:t,onBlur:n,error:i,placeholder:c,disabled:o,min:h,max:u,step:d,pattern:x,required:j,autoComplete:y,name:m,id:p,className:k="","aria-label":E,"aria-describedby":v}){const P=p||m,g=i?`${P}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:a,id:P,name:m,value:r,onChange:t,onBlur:n,placeholder:c,disabled:o,min:h,max:u,step:d,pattern:x,required:j,autoComplete:y,className:`validated-input ${i?"has-error":""} ${k}`,"aria-label":E,"aria-invalid":!!i,"aria-describedby":i?g:v}),i&&e.jsxs("div",{id:g,className:"input-error-inline",role:"alert",children:[e.jsx(os,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:i})]})]})});l.memo(function({value:a,onChange:r,onBlur:t,error:n,disabled:i,required:c,name:o,id:h,className:u="",children:d,"aria-label":x}){const j=h||o,y=n?`${j}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("select",{id:j,name:o,value:a,onChange:r,onBlur:t,disabled:i,required:c,className:`validated-select ${n?"has-error":""} ${u}`,"aria-label":x,"aria-invalid":!!n,"aria-describedby":n?y:void 0,children:d}),n&&e.jsxs("div",{id:y,className:"input-error-inline",role:"alert",children:[e.jsx(os,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:n})]})]})});l.memo(function({value:a,onChange:r,onBlur:t,error:n,placeholder:i,disabled:c,required:o,rows:h=3,maxLength:u,name:d,id:x,className:j="","aria-label":y}){const m=x||d,p=n?`${m}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("textarea",{id:m,name:d,value:a,onChange:r,onBlur:t,placeholder:i,disabled:c,required:o,rows:h,maxLength:u,className:`validated-textarea ${n?"has-error":""} ${j}`,"aria-label":y,"aria-invalid":!!n,"aria-describedby":n?p:void 0}),u&&e.jsxs("div",{className:"textarea-counter",children:[a?.length||0," / ",u]}),n&&e.jsxs("div",{id:p,className:"input-error-inline",role:"alert",children:[e.jsx(os,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:n})]})]})});const qc=l.memo(function({count:a,label:r,variant:t="default",size:n="medium",pulse:i=!1,icon:c}){const[o,h]=l.useState(a),[u,d]=l.useState(!1);return l.useEffect(()=>{if(a!==o){d(!0);const x=setTimeout(()=>{d(!1),h(a)},400);return()=>clearTimeout(x)}},[a,o]),e.jsxs("span",{className:`count-badge count-badge-${t} count-badge-${n} ${i?"badge-new":""} ${u?"animate-count-up":""}`,title:r,children:[c&&e.jsx(c,{size:n==="small"?12:n==="large"?18:14}),e.jsx("span",{className:"count-badge-value",children:a}),r&&e.jsx("span",{className:"count-badge-label",children:r})]})}),Vc=l.memo(function({value:a,max:r=100,showLabel:t=!1,size:n="medium",variant:i="default",animated:c=!0}){const o=Math.min(100,Math.max(0,a/r*100)),h=n==="small"?"4px":n==="large"?"8px":"6px",u=i==="default"?o>=80?"danger":o>=60?"warning":"success":i;return e.jsxs("div",{className:`mini-progress mini-progress-${n}`,children:[e.jsx("div",{className:"mini-progress-track",style:{height:h},children:e.jsx("div",{className:`mini-progress-fill mini-progress-${u} ${c?"progress-animate":""}`,style:{width:`${o}%`}})}),t&&e.jsxs("span",{className:"mini-progress-label",children:[Math.round(o),"%"]})]})}),Bc=l.memo(function({value:a,previousValue:r,format:t="percent",inverted:n=!1,showValue:i=!0}){const c=a-r,o=r!==0?c/r*100:0;let h=c===0?"neutral":c>0?"up":"down",u="neutral";c!==0&&(n?u=c>0?"negative":"positive":u=c>0?"positive":"negative");const d=h==="up"?cs:h==="down"?ls:fa,x=()=>{const j=Math.abs(c);switch(t){case"percent":return`${Math.abs(o).toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(j);default:return j.toLocaleString()}};return e.jsxs("span",{className:`trend-indicator trend-${u}`,children:[e.jsx(d,{size:14}),i&&e.jsx("span",{className:"trend-value",children:x()})]})});l.memo(function({status:a="default",label:r,size:t="medium",pulse:n=!1}){return e.jsxs("span",{className:`status-dot-container status-dot-${t}`,children:[e.jsx("span",{className:`status-dot status-dot-${a} ${n?"status-dot-pulse":""}`}),r&&e.jsx("span",{className:"status-dot-label",children:r})]})});l.memo(function({data:a=[],width:r=80,height:t=24,strokeWidth:n=2,color:i="var(--accent-blue)",showArea:c=!0}){if(!a.length)return null;const o=Math.max(...a),h=Math.min(...a),u=o-h||1,d=a.map((j,y)=>{const m=y/(a.length-1)*r,p=t-(j-h)/u*(t-n*2)-n;return`${m},${p}`}).join(" "),x=`0,${t} ${d} ${r},${t}`;return e.jsxs("svg",{width:r,height:t,className:"sparkline",viewBox:`0 0 ${r} ${t}`,children:[c&&e.jsx("polygon",{points:x,fill:i,fillOpacity:"0.15"}),e.jsx("polyline",{points:d,fill:"none",stroke:i,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"})]})});l.memo(function({items:a=[]}){return e.jsx("div",{className:"quick-stats",children:a.map((r,t)=>e.jsxs("span",{className:"quick-stat-item",children:[r.icon&&e.jsx(r.icon,{size:12}),e.jsx("span",{className:"quick-stat-value",children:r.value}),r.label&&e.jsx("span",{className:"quick-stat-label",children:r.label})]},t))})});l.memo(function({status:a,label:r,size:t="medium"}){const n={success:Ht,warning:qe,danger:qe,info:ht,pending:ht},i=n[a]||n.info;return e.jsxs("span",{className:`status-indicator status-indicator-${a} status-indicator-${t}`,children:[e.jsx(i,{size:t==="small"?12:t==="large"?18:14}),r&&e.jsx("span",{className:"status-indicator-label",children:r})]})});l.memo(function({current:a,previous:r,format:t="number",label:n,inverted:i=!1}){const c=a-r,o=i?c<0:c>0,h=i?c>0:c<0,u=d=>{switch(t){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(Math.abs(d));case"percent":return`${Math.abs(d).toFixed(1)}%`;default:return Math.abs(d).toLocaleString()}};return e.jsxs("div",{className:`metric-delta ${o?"positive":h?"negative":"neutral"}`,children:[e.jsx("span",{className:"metric-delta-arrow",children:c>0?"↑":c<0?"↓":"→"}),e.jsx("span",{className:"metric-delta-value",children:u(c)}),n&&e.jsx("span",{className:"metric-delta-label",children:n})]})});l.memo(function({value:a,max:r=100,size:t=40,strokeWidth:n=4,showValue:i=!0,color:c="var(--accent-blue)"}){const o=Math.min(100,Math.max(0,a/r*100)),h=(t-n)/2,u=h*2*Math.PI,d=u-o/100*u;return e.jsxs("div",{className:"circular-progress",style:{width:t,height:t},children:[e.jsxs("svg",{width:t,height:t,viewBox:`0 0 ${t} ${t}`,children:[e.jsx("circle",{className:"circular-progress-track",cx:t/2,cy:t/2,r:h,fill:"none",strokeWidth:n}),e.jsx("circle",{className:"circular-progress-fill",cx:t/2,cy:t/2,r:h,fill:"none",stroke:c,strokeWidth:n,strokeDasharray:u,strokeDashoffset:d,strokeLinecap:"round",transform:`rotate(-90 ${t/2} ${t/2})`,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),i&&e.jsxs("span",{className:"circular-progress-value",children:[Math.round(o),"%"]})]})});l.memo(function({isOpen:a,onClose:r,title:t,children:n,size:i="medium",className:c="",showCloseButton:o=!0,closeOnOverlayClick:h=!0,closeOnEscape:u=!0,footer:d,ariaDescribedBy:x}){const j=l.useRef(null),y=l.useRef(null),m=l.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`);l.useEffect(()=>{if(a){y.current=document.activeElement;const v=setTimeout(()=>{j.current?.focus()},10);return()=>clearTimeout(v)}},[a]),l.useEffect(()=>{!a&&y.current&&y.current.focus()},[a]),l.useEffect(()=>{if(!a||!u)return;const v=P=>{P.key==="Escape"&&(P.preventDefault(),r())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[a,u,r]),l.useEffect(()=>{if(a){const v=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=v}}},[a]);const p=l.useCallback(v=>{if(v.key!=="Tab")return;const P=j.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!P||P.length===0)return;const g=P[0],N=P[P.length-1];v.shiftKey?document.activeElement===g&&(v.preventDefault(),N.focus()):document.activeElement===N&&(v.preventDefault(),g.focus())},[]),k=v=>{h&&v.target===v.currentTarget&&r()};if(!a)return null;const E={small:"modal-small",medium:"modal-medium",large:"modal-large",full:"modal-full"};return e.jsx("div",{className:"modal-overlay",onClick:k,role:"presentation",children:e.jsxs("div",{ref:j,className:`modal-content ${E[i]||""} ${c}`,role:"dialog","aria-modal":"true","aria-labelledby":t?m.current:void 0,"aria-describedby":x,tabIndex:-1,onKeyDown:p,onClick:v=>v.stopPropagation(),children:[t&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:m.current,children:t}),o&&e.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close modal",type:"button",children:e.jsx(Be,{size:20})})]}),e.jsx("div",{className:"modal-body",children:n}),d&&e.jsx("div",{className:"modal-footer",children:d})]})})});const Qe=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),_s=l.memo(function({icon:a,label:r,value:t,formattedValue:n,subLabel:i,progress:c,progressLabel:o,variant:h="default",trend:u,previousValue:d}){const x={default:"var(--accent-blue)",success:"var(--accent-green)",warning:"var(--accent-amber)",danger:"var(--accent-red)"};return e.jsxs("div",{className:"hero-metric-card hover-lift animate-fade-in-up",children:[e.jsxs("div",{className:"hero-metric-header",children:[e.jsx("div",{className:"hero-metric-icon",style:{color:x[h]},children:e.jsx(a,{size:18})}),e.jsx("span",{className:"hero-metric-label",children:r})]}),e.jsxs("div",{className:"hero-metric-value-row",children:[e.jsx("span",{className:`hero-metric-value hero-metric-${h}`,children:n}),u!==void 0&&d!==void 0&&e.jsx(Bc,{value:t,previousValue:d,format:"currency",inverted:r.toLowerCase().includes("cost")})]}),i&&e.jsx("span",{className:"hero-metric-sublabel",children:i}),c!==void 0&&e.jsxs("div",{className:"hero-metric-progress",children:[e.jsx(Vc,{value:c,max:100,size:"small",variant:h,showLabel:!0}),o&&e.jsx("span",{className:"hero-metric-progress-label",children:o})]})]})}),Wc=l.memo(function({contractValue:a=0,earnedRevenue:r=0,totalCosts:t=0,profit:n=0,progress:i=0,corApprovedValue:c=0,loading:o=!1,previousData:h}){const u=a+c,d=r>0?n/r*100:0,x=r>0?t/r*100:0,j=u>0?r/u*100:0,y=u>0?t/u*100:0,m=l.useMemo(()=>d>=20?"success":d>=10?"warning":d<0?"danger":"default",[d]),p=l.useMemo(()=>x<=60?"success":x<=80?"warning":"danger",[x]);return o?e.jsx(zc,{}):e.jsxs("div",{className:"hero-metrics stagger-children",children:[e.jsx(_s,{icon:Ze,label:"Contract Value",value:u,formattedValue:Qe(u),subLabel:c>0?`+${Qe(c)} CORs`:null,variant:"default"}),e.jsx(_s,{icon:cs,label:"Earned Revenue",value:r,formattedValue:Qe(r),progress:j,progressLabel:`${Math.round(j)}% of contract`,variant:"success",previousValue:h?.earnedRevenue,trend:h?r:void 0}),e.jsx(_s,{icon:Ut,label:"Total Costs",value:t,formattedValue:Qe(t),progress:y,progressLabel:`${Math.round(x)}% of revenue`,variant:p,previousValue:h?.totalCosts,trend:h?t:void 0}),e.jsx(_s,{icon:zi,label:"Profit",value:n,formattedValue:Qe(n),subLabel:`${d>=0?"+":""}${d.toFixed(1)}% margin`,variant:m,previousValue:h?.profit,trend:h?n:void 0})]})});function Hc({onShowToast:s,onClose:a}){const[r,t]=l.useState("loading"),[n,i]=l.useState([]),[c,o]=l.useState(null),[h,u]=l.useState(null),[d,x]=l.useState(null),[j,y]=l.useState(""),[m,p]=l.useState(!1),[k,E]=l.useState(!1),[v,P]=l.useState(null);l.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:A,error:F}=await Je.auth.mfa.listFactors();if(F)throw F;const R=(A?.totp||[]).filter(L=>L.status==="verified");i(R),t("overview")}catch{t("overview")}},N=async()=>{P(null);try{const{data:A,error:F}=await Je.auth.mfa.enroll({factorType:"totp",friendlyName:"FieldSync Authenticator"});if(F)throw F;o(A.totp.qr_code),u(A.totp.secret),x(A.id),t("enroll")}catch(A){P(A.message),s?.("Failed to start MFA enrollment","error")}},I=async()=>{if(j.length===6){p(!0),P(null);try{const{data:A,error:F}=await Je.auth.mfa.challenge({factorId:d});if(F)throw F;const{error:R}=await Je.auth.mfa.verify({factorId:d,challengeId:A.id,code:j});if(R)throw R;t("success"),s?.("MFA enabled successfully!","success"),await g()}catch{P("Invalid code. Please try again."),y("")}finally{p(!1)}}},U=async A=>{try{const{error:F}=await Je.auth.mfa.unenroll({factorId:A});if(F)throw F;s?.("MFA disabled","success"),await g()}catch{s?.("Failed to disable MFA","error")}},_=()=>{navigator.clipboard.writeText(h),E(!0),setTimeout(()=>E(!1),2e3)},C=n.length>0;return e.jsxs("div",{className:"mfa-setup",children:[e.jsxs("div",{className:"mfa-header",children:[e.jsxs("div",{className:"mfa-title",children:[C?e.jsx(ea,{size:20,className:"text-success"}):e.jsx(ia,{size:20}),e.jsx("h3",{children:"Two-Factor Authentication"})]}),a&&e.jsx("button",{className:"close-btn",onClick:a,"aria-label":"Close",children:e.jsx(Be,{size:20})})]}),r==="loading"&&e.jsxs("div",{className:"mfa-loading",children:[e.jsx(pt,{size:24,className:"spinner"})," Loading..."]}),r==="overview"&&e.jsxs("div",{className:"mfa-overview",children:[e.jsx("p",{className:"mfa-description",children:"Add an extra layer of security to your account. When enabled, you will need to enter a code from your authenticator app each time you sign in."}),C?e.jsxs("div",{className:"mfa-status mfa-status-enabled",children:[e.jsx(ea,{size:18}),e.jsx("span",{children:"MFA is enabled"}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>U(n[0].id),children:[e.jsx(xt,{size:14})," Disable"]})]}):e.jsxs("div",{className:"mfa-status mfa-status-disabled",children:[e.jsx(xt,{size:18}),e.jsx("span",{children:"MFA is not enabled"}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:N,children:[e.jsx(ia,{size:14})," Enable MFA"]})]})]}),r==="enroll"&&e.jsxs("div",{className:"mfa-enroll",children:[e.jsx("p",{children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):"}),c&&e.jsx("div",{className:"mfa-qr-container",children:e.jsx("img",{src:c,alt:"MFA QR Code",className:"mfa-qr"})}),e.jsxs("div",{className:"mfa-secret",children:[e.jsx("span",{className:"mfa-secret-label",children:"Or enter this key manually:"}),e.jsxs("div",{className:"mfa-secret-value",children:[e.jsx("code",{children:h}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:_,"aria-label":"Copy secret key",children:k?e.jsx(Ht,{size:14}):e.jsx(qi,{size:14})})]})]}),e.jsxs("div",{className:"mfa-verify-section",children:[e.jsx("label",{htmlFor:"mfa-verify-code",children:"Enter the 6-digit code from your app:"}),e.jsxs("div",{className:"mfa-code-input",children:[e.jsx("input",{id:"mfa-verify-code",type:"text",value:j,onChange:A=>y(A.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,autoFocus:!0,inputMode:"numeric",pattern:"[0-9]*"}),e.jsx("button",{className:"btn btn-primary",onClick:I,disabled:j.length!==6||m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(pt,{size:14,className:"spinner"})," Verifying..."]}):"Verify & Enable"})]}),v&&e.jsx("p",{className:"mfa-error",children:v})]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>t("overview"),children:"Cancel"})]}),r==="success"&&e.jsxs("div",{className:"mfa-success",children:[e.jsx(ea,{size:48,className:"text-success"}),e.jsx("h4",{children:"MFA Enabled"}),e.jsx("p",{children:"Your account is now protected with two-factor authentication."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>t("overview"),children:"Done"})]})]})}const Et=[{id:"overview",label:"Overview",shortLabel:"Overview",icon:Bi,description:"Metrics & trends",step:null},{id:"cors",label:"Change Orders",shortLabel:"CORs",icon:$e,description:"CORs & approvals",step:1},{id:"tickets",label:"T&M Tickets",shortLabel:"Tickets",icon:he,description:"Field data",step:2},{id:"billing",label:"Billing",shortLabel:"Billing",icon:Ut,description:"Invoices & billing",step:3}],Uc=l.memo(function({activeSection:a="overview",onSectionChange:r,collapsed:t=!1,onToggleCollapse:n,onMobileClose:i,stats:c={}}){const{corCount:o=0,ticketCount:h=0,corPending:u=0,ticketPending:d=0,billableCount:x=0,invoiceCount:j=0}=c,y=m=>m==="cors"&&o>0?{count:o,variant:u>0?"warning":"default",pending:u}:m==="tickets"&&h>0?{count:h,variant:d>0?"warning":"default",pending:d}:m==="billing"&&x>0?{count:x,variant:"success",pending:x}:null;return e.jsxs("nav",{className:`financials-nav ${t?"collapsed":""}`,"aria-label":"Financials sections",children:[i&&e.jsxs("div",{className:"financials-nav-mobile-header",children:[e.jsx("span",{className:"financials-nav-mobile-title",children:"Financials"}),e.jsx("button",{className:"financials-nav-mobile-close",onClick:i,"aria-label":"Close menu",children:e.jsx(Be,{size:20})})]}),e.jsxs("button",{className:"financials-nav-toggle",onClick:n,"aria-label":t?"Expand sidebar":"Collapse sidebar",title:t?"Expand sidebar":"Collapse sidebar",children:[t?e.jsx(Vi,{size:18}):e.jsx(Kt,{size:18}),!t&&e.jsx("span",{children:"Collapse"})]}),e.jsx("div",{className:"financials-nav-items",children:Et.map((m,p)=>{const k=a===m.id,E=m.icon,v=y(m.id),P=p<Et.length-1&&m.step!==null;return e.jsxs("div",{className:"financials-nav-item-wrapper",children:[e.jsxs("button",{className:`financials-nav-item ${k?"active":""}`,onClick:()=>r?.(m.id),"aria-current":k?"page":void 0,title:`${m.label}${v?` (${v.count})`:""}`,children:[m.step&&!t&&e.jsx("span",{className:"financials-nav-step",children:m.step}),e.jsxs("div",{className:"financials-nav-icon",children:[e.jsx(E,{size:t?22:20}),v&&v.pending>0&&e.jsx("span",{className:"financials-nav-dot"})]}),t&&e.jsx("span",{className:"financials-nav-short-label",children:m.shortLabel}),!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"financials-nav-content",children:[e.jsx("span",{className:"financials-nav-label",children:m.label}),e.jsx("span",{className:"financials-nav-desc",children:m.description})]}),v&&e.jsx(qc,{count:v.count,size:"small",variant:v.variant}),e.jsx(ze,{size:16,className:"financials-nav-arrow"})]})]}),P&&!t&&e.jsx("div",{className:"financials-nav-connector",children:e.jsx("div",{className:"connector-line"})})]},m.id)})}),t&&e.jsxs("button",{className:"financials-nav-expand-btn",onClick:n,"aria-label":"Expand sidebar",children:[e.jsx(ze,{size:14}),e.jsx("span",{children:"Expand"})]})]})}),Kc=l.memo(function({progress:a=0,areasComplete:r=0,totalAreas:t=0,areasWorking:n=0,size:i=110,strokeWidth:c=9}){const[o,h]=l.useState(0),u=l.useRef(null);l.useEffect(()=>{const m=o,p=Math.min(100,Math.max(0,a)),k=800,E=performance.now(),v=P=>{const g=P-E,N=Math.min(g/k,1),I=1-Math.pow(1-N,3),U=m+(p-m)*I;h(U),N<1&&(u.current=requestAnimationFrame(v))};return u.current=requestAnimationFrame(v),()=>{u.current&&cancelAnimationFrame(u.current)}},[a]);const d=(i-c)/2,x=d*2*Math.PI,j=x-o/100*x,y=()=>o>=80?"var(--accent-green)":o>=50||o>=25?"var(--accent-blue)":"var(--text-muted)";return e.jsxs("div",{className:"overview-progress-gauge",children:[e.jsxs("div",{className:"progress-gauge-circle",style:{width:i,height:i},children:[e.jsxs("svg",{width:i,height:i,viewBox:`0 0 ${i} ${i}`,children:[e.jsx("circle",{className:"gauge-track",cx:i/2,cy:i/2,r:d,fill:"none",strokeWidth:c,stroke:"var(--bg-tertiary)"}),e.jsx("circle",{className:"gauge-fill",cx:i/2,cy:i/2,r:d,fill:"none",stroke:y(),strokeWidth:c,strokeDasharray:x,strokeDashoffset:j,strokeLinecap:"round",transform:`rotate(-90 ${i/2} ${i/2})`,style:{transition:"stroke 0.3s ease"}})]}),e.jsxs("div",{className:"gauge-center",children:[e.jsxs("span",{className:"gauge-value",children:[Math.round(o),"%"]}),e.jsx("span",{className:"gauge-label",children:"Complete"})]})]}),e.jsxs("div",{className:"gauge-areas-status",children:[e.jsxs("span",{className:"areas-count",children:[e.jsx("strong",{children:r}),"/",t," Areas Done"]}),n>0&&e.jsxs("span",{className:"areas-active",children:[n," active"]})]})]})}),Gc=l.memo(function({earnedRevenue:a=0,totalCosts:r=0,laborCost:t=0,disposalCost:n=0,equipmentCost:i=0,materialsCost:c=0,otherCost:o=0,contractValue:h=0}){const u=a-r,d=a>0?u/a*100:0,x=u>=0,j=p=>p>=1e6?`$${(p/1e6).toFixed(1)}M`:p>=1e3?`$${(p/1e3).toFixed(1)}K`:`$${p.toFixed(0)}`,y=[{key:"labor",value:t,color:W.labor,label:"Labor"},{key:"disposal",value:n,color:W.disposal,label:"Disposal"},{key:"equipment",value:i,color:W.equipment,label:"Equipment"},{key:"materials",value:c,color:W.materials,label:"Materials"},{key:"other",value:o,color:W.other,label:"Other"}].filter(p=>p.value>0),m=y.length>0&&r>0;return e.jsxs("div",{className:"overview-financial-card animate-fade-in-up",children:[e.jsxs("div",{className:"financial-metrics-row",children:[e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value green",children:j(a)}),e.jsx("span",{className:"financial-metric-label",children:"Earned"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value amber",children:j(r)}),e.jsx("span",{className:"financial-metric-label",children:"Costs"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsxs("span",{className:`financial-metric-value ${x?"green":"red"}`,children:[x?"":"-",j(Math.abs(u))]}),e.jsxs("span",{className:"financial-metric-label",children:["Profit",e.jsxs("span",{className:`margin-badge ${x?"positive":"negative"}`,children:[d>=0?"+":"",d.toFixed(0),"%"]})]})]})]}),m&&e.jsxs("div",{className:"cost-breakdown-section",children:[e.jsx("div",{className:"cost-breakdown-bar",children:y.map((p,k)=>{const E=p.value/r*100;return e.jsx("div",{className:"cost-segment",style:{width:`${E}%`,backgroundColor:p.color,animationDelay:`${k*100}ms`},title:`${p.label}: ${j(p.value)} (${E.toFixed(0)}%)`},p.key)})}),e.jsx("div",{className:"cost-breakdown-legend",children:y.slice(0,4).map(p=>e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot",style:{backgroundColor:p.color}}),e.jsx("span",{className:"legend-label",children:p.label})]},p.key))})]})]})}),Yc=()=>ne(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),Es={contract:W.contract,tm:W.costs},Pt=[{id:"7d",label:"7D",days:7},{id:"14d",label:"14D",days:14},{id:"30d",label:"30D",days:30}],Xc=l.memo(function({project:a,onShowToast:r}){const[t,n]=l.useState([]),[i,c]=l.useState([]),[o,h]=l.useState(new Date().toISOString().split("T")[0]),[u,d]=l.useState("14d"),[x,j]=l.useState(!0),[y,m]=l.useState(!1);l.useEffect(()=>{a?.id&&p()},[a?.id]);const p=async()=>{j(!0);try{const[R,L]=await Promise.all([z.getCrewCheckinHistory(a.id,365),z.getTMTickets(a.id)]);n(R||[]),c(L||[])}catch(R){console.error("Error loading crew metrics:",R)}finally{j(!1)}},k=l.useMemo(()=>{const R={};return i.forEach(L=>{const D=L.work_date;D&&(R[D]||(R[D]=new Set),(L.t_and_m_workers||[]).forEach(Q=>{R[D].add(Q.name.toLowerCase().trim())}))}),R},[i]),E=l.useMemo(()=>{const R={};return t.forEach(L=>{R[L.check_in_date]=L.workers||[]}),R},[t]),v=E[o]||[],P=k[o]||new Set,g=l.useMemo(()=>{const R=[],L=[];return v.forEach(D=>{P.has(D.name.toLowerCase().trim())?L.push(D):R.push(D)}),{total:v.length,contract:R,tm:L}},[v,P]),N=l.useMemo(()=>{const R=Pt.find(Q=>Q.id===u)?.days||14,L=[],D=new Date;for(let Q=R-1;Q>=0;Q--){const M=new Date(D);M.setDate(M.getDate()-Q);const re=M.toISOString().split("T")[0],Ne=E[re]||[],ie=k[re]||new Set;let ms=0,we=0;Ne.forEach(He=>{ie.has(He.name.toLowerCase().trim())?we++:ms++}),L.push({date:re,displayDate:ja(re),contract:ms,tm:we,total:Ne.length})}return L},[E,k,u]),I=l.useCallback(R=>{const L=new Date(o+"T12:00:00");L.setDate(L.getDate()+R),h(L.toISOString().split("T")[0])},[o]),U=o===new Date().toISOString().split("T")[0],_=R=>new Date(R+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),C=l.useCallback(R=>{R?.date&&h(R.date)},[]),A=({active:R,payload:L,label:D})=>{if(!R||!L?.length)return null;const Q=(L[0]?.value||0)+(L[1]?.value||0);return e.jsxs("div",{style:{...Ct.contentStyle,fontSize:"0.8rem"},children:[e.jsx("p",{style:{...Ct.labelStyle,fontSize:"0.85rem",marginBottom:6},children:D}),e.jsxs("p",{style:{margin:"3px 0",color:Es.contract},children:["Contract: ",e.jsx("strong",{children:L[0]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:Es.tm},children:["T&M: ",e.jsx("strong",{children:L[1]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:"var(--text-primary)",borderTop:"1px solid var(--border-color)",paddingTop:4},children:["Total: ",e.jsx("strong",{children:Q})]})]})},F=l.useCallback(async()=>{m(!0),r?.("Generating crew report PDF...","info");try{const L=(await Yc()).default,D=new L,Q=D.internal.pageSize.width;let M=20;D.setFontSize(18),D.setFont(void 0,"bold"),D.text("Crew On-Site Report",Q/2,M,{align:"center"}),M+=8,D.setFontSize(11),D.setFont(void 0,"normal"),D.text(`Project: ${a.name}`,Q/2,M,{align:"center"}),M+=6,D.text(`Date: ${_(o)}`,Q/2,M,{align:"center"}),M+=12,D.setFontSize(12),D.setFont(void 0,"bold"),D.text("Selected Day Summary",14,M),M+=7,D.setFontSize(10),D.setFont(void 0,"normal"),D.text(`Total Crew On-Site: ${g.total}`,14,M),M+=5,D.text(`Contract Workers: ${g.contract.length}`,14,M),M+=5,D.text(`T&M Workers: ${g.tm.length}`,14,M),M+=10,g.contract.length>0&&(D.setFontSize(12),D.setFont(void 0,"bold"),D.text("Contract Workers",14,M),M+=7,D.setFontSize(9),D.setFont(void 0,"bold"),D.text("Name",14,M),D.text("Role",100,M),M+=5,D.setFont(void 0,"normal"),g.contract.forEach(ie=>{M>270&&(D.addPage(),M=20),D.text(ie.name,14,M),D.text(ie.role||"—",100,M),M+=5}),M+=8),g.tm.length>0&&(M>240&&(D.addPage(),M=20),D.setFontSize(12),D.setFont(void 0,"bold"),D.text("T&M Workers (Extra Work)",14,M),M+=7,D.setFontSize(9),D.setFont(void 0,"bold"),D.text("Name",14,M),D.text("Role",100,M),M+=5,D.setFont(void 0,"normal"),g.tm.forEach(ie=>{M>270&&(D.addPage(),M=20),D.text(ie.name,14,M),D.text(ie.role||"—",100,M),M+=5}),M+=8),M>200&&(D.addPage(),M=20),D.setFontSize(12),D.setFont(void 0,"bold"),D.text("Daily Timeline",14,M),M+=7,D.setFontSize(8),D.setFont(void 0,"bold"),D.text("Date",14,M),D.text("Total",70,M),D.text("Contract",95,M),D.text("T&M",125,M),M+=5,D.setFont(void 0,"normal"),N.forEach(ie=>{M>275&&(D.addPage(),M=20),D.text(ie.displayDate,14,M),D.text(String(ie.total),70,M),D.text(String(ie.contract),95,M),D.text(String(ie.tm),125,M),M+=4.5});const re=D.internal.pageSize.height-10;D.setFontSize(8),D.setTextColor(128,128,128),D.text(`Generated ${new Date().toLocaleString()} — FieldSync`,Q/2,re,{align:"center"});const Ne=`${a.name}_Crew_Report_${o}.pdf`;D.save(Ne),r?.("PDF exported!","success")}catch(R){console.error("Error exporting crew PDF:",R),r?.("Error generating PDF","error")}finally{m(!1)}},[a,o,g,N,r]);return x?e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsx("div",{className:"crew-metrics-header",children:e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Crew On-Site"]})}),e.jsxs("div",{className:"crew-metrics-loading",children:[e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"})]})]}):e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsxs("div",{className:"crew-metrics-header",children:[e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Crew On-Site"]}),e.jsx("div",{className:"crew-metrics-actions",children:e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:F,disabled:y,title:"Export crew report as PDF",children:[e.jsx(es,{size:14})," ",y?"Exporting...":"PDF"]})})]}),e.jsxs("div",{className:"crew-date-nav",children:[e.jsx("button",{className:"crew-date-btn",onClick:()=>I(-1),children:e.jsx(Kt,{size:16})}),e.jsxs("span",{className:"crew-date-label",children:[e.jsx(Bt,{size:14}),U?"Today":_(o)]}),e.jsx("button",{className:"crew-date-btn",onClick:()=>I(1),disabled:U,children:e.jsx(ze,{size:16})})]}),e.jsxs("div",{className:"crew-stats-row",children:[e.jsxs("div",{className:"crew-stat total",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(xe,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.total}),e.jsx("span",{className:"crew-stat-label",children:"Total On-Site"})]})]}),e.jsxs("div",{className:"crew-stat contract",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(Ee,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.contract.length}),e.jsx("span",{className:"crew-stat-label",children:"Contract"})]})]}),e.jsxs("div",{className:"crew-stat tm",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(ra,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.tm.length}),e.jsx("span",{className:"crew-stat-label",children:"T&M"})]})]})]}),g.total>0&&e.jsxs("div",{className:"crew-breakdown-bar",children:[e.jsx("div",{className:"crew-bar-segment contract",style:{width:`${g.contract.length/g.total*100}%`},title:`${g.contract.length} Contract`}),e.jsx("div",{className:"crew-bar-segment tm",style:{width:`${g.tm.length/g.total*100}%`},title:`${g.tm.length} T&M`})]}),g.total>0&&e.jsxs("div",{className:"crew-name-lists",children:[g.contract.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header contract",children:[e.jsx(Ee,{size:13}),e.jsxs("span",{children:["Contract (",g.contract.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:g.contract.map((R,L)=>e.jsxs("span",{className:"crew-name-tag contract",children:[R.name,R.role&&R.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:R.role})]},L))})]}),g.tm.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header tm",children:[e.jsx(ra,{size:13}),e.jsxs("span",{children:["T&M (",g.tm.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:g.tm.map((R,L)=>e.jsxs("span",{className:"crew-name-tag tm",children:[R.name,R.role&&R.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:R.role})]},L))})]})]}),e.jsxs("div",{className:"crew-timeline-section",children:[e.jsxs("div",{className:"crew-timeline-header",children:[e.jsx("span",{className:"crew-timeline-title",children:"Daily Breakdown"}),e.jsx("div",{className:"crew-time-range-pills",children:Pt.map(R=>e.jsx("button",{className:`crew-range-pill ${u===R.id?"active":""}`,onClick:()=>d(R.id),children:R.label},R.id))})]}),e.jsx("div",{className:"crew-chart-container",children:e.jsx(xa,{width:"100%",height:140,children:e.jsxs(wi,{data:N,onClick:R=>R?.activePayload?.[0]&&C(R.activePayload[0].payload),style:{cursor:"pointer"},children:[e.jsx(Lt,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(zt,{dataKey:"displayDate",tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:{stroke:"var(--border-color)"},tickLine:!1,interval:u==="30d"?4:u==="14d"?1:0}),e.jsx(qt,{tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:!1,tickLine:!1,allowDecimals:!1,width:30}),e.jsx(va,{content:e.jsx(A,{})}),e.jsx(Is,{wrapperStyle:{fontSize:"0.75rem",paddingTop:4},iconType:"circle",iconSize:8}),e.jsx(ut,{dataKey:"contract",name:"Contract",stackId:"crew",fill:Es.contract,radius:[0,0,0,0]}),e.jsx(ut,{dataKey:"tm",name:"T&M (Extra Work)",stackId:"crew",fill:Es.tm,radius:[3,3,0,0]})]})})})]}),g.total===0&&e.jsx("div",{className:"crew-empty",children:e.jsx("p",{children:"No crew checked in for this date"})})]})}),Jc=l.lazy(()=>ne(()=>import("./TMList-H_lglCqO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Qc=l.lazy(()=>ne(()=>import("./ShareModal-DSRr6ovi.js"),__vite__mapDeps([9,2,3,4,1,5,6]))),Zc=l.lazy(()=>ne(()=>import("./InjuryReportsList-DY_krQaj.js"),__vite__mapDeps([10,1,2,3,4,5,6,8]))),eo=l.lazy(()=>ne(()=>import("./NotificationSettings-Wqk4dhS4.js"),__vite__mapDeps([11,2,3,4,1,5,6]))),so=l.lazy(()=>ne(()=>import("./DailyReportsList-DmXJO6D3.js"),__vite__mapDeps([12,1,2,3,4,5,6,8]))),ao=l.lazy(()=>ne(()=>import("./CORList-rdInhuC9.js"),__vite__mapDeps([13,1,2,3,4,5,6,8,14]))),to=l.lazy(()=>ne(()=>import("./CORForm-CO21cKs8.js"),__vite__mapDeps([15,2,3,4,1,5,6,8]))),no=l.lazy(()=>ne(()=>import("./CORDetail-BENK_qEv.js"),__vite__mapDeps([16,2,3,4,1,5,6,8,17,7]))),ro=l.lazy(()=>ne(()=>import("./CORLogPreview-CNHN3V3m.js"),__vite__mapDeps([18,2,3,4,1,5,6,8]))),io=l.lazy(()=>ne(()=>import("./CORLog-d3L986sM.js").then(s=>s.a),__vite__mapDeps([14,1,2,3,4,5,6,8]))),lo=l.lazy(()=>ne(()=>import("./BillingCenter-_lfi3V-g.js"),__vite__mapDeps([19,2,3,4,1,5,6,8]))),co=l.lazy(()=>ne(()=>import("./DrawRequestModal-DE1lx3WT.js"),__vite__mapDeps([20,2,3,4,1,5,6,8]))),oo=l.lazy(()=>ne(()=>import("./EquipmentModal-0RYeaDXY.js"),__vite__mapDeps([21,2,3,4,1,5,6]))),uo=l.lazy(()=>ne(()=>import("./AddCostModal-DfwfPXyO.js"),__vite__mapDeps([22,2,3,4,1,5,6]))),mo=l.lazy(()=>ne(()=>import("./DocumentsTab-BGE3_21H.js"),__vite__mapDeps([23,2,3,4,1,5,6])));function ho({company:s,user:a,isAdmin:r,onShowToast:t,navigateToProjectId:n,onProjectNavigated:i}){const[c,o]=l.useState([]),[h,u]=l.useState([]),[d,x]=l.useState(null),[j,y]=l.useState([]),[m,p]=l.useState(!0),[k,E]=l.useState(!1),[v,P]=l.useState(null),[g,N]=l.useState(!1),[I,U]=l.useState(!1),[_,C]=l.useState(!1),[A,F]=l.useState("overview"),[R,L]=l.useState("overview"),[D,Q]=l.useState(!0),[M,re]=l.useState(!1),[Ne,ie]=l.useState(!1),[ms,we]=l.useState("list"),[He,Ls]=l.useState("preview"),[ga,nn]=l.useState([]),[rn,Ue]=l.useState(!1),[ln,Ke]=l.useState(null),[cn,hs]=l.useState(!1),[ba,ps]=l.useState(null),[on,ya]=l.useState(0),[dn,zs]=l.useState(!1),[un,Na]=l.useState(!1),[mn,xs]=l.useState(!1),[wa,vs]=l.useState(null),[hn,pn]=l.useState(0),[xn,fs]=l.useState(!1),[Ca,js]=l.useState(null),[vn,fn]=l.useState(0),{isOpen:jn,setIsOpen:gn,close:bn}=bc(),Ge=l.useRef(null),gs=l.useRef(!1),qs=l.useRef(!1),Vs=l.useRef(new Map),ka=300*1e3,te=l.useCallback((f={})=>{const{refreshAreas:O=!1,refreshCOR:S=!1,projectId:T=null}=f;O&&T&&(gs.current=T),S&&(qs.current=!0),Ge.current&&clearTimeout(Ge.current),Ge.current=setTimeout(async()=>{gs.current&&(await Bs(gs.current),gs.current=!1),qs.current&&(ya(B=>B+1),qs.current=!1),await Ye()},150)},[]);l.useEffect(()=>()=>{Ge.current&&clearTimeout(Ge.current)},[]),l.useEffect(()=>{s?.id&&(Ye(),wn())},[s?.id]);const yn=l.useRef([]),Nn=c.map(f=>f.id).sort().join(",");l.useEffect(()=>{if(!s?.id||c.length===0)return;const f=c.map(S=>S.id).sort();yn.current=f;const O=z.subscribeToCompanyActivity?.(s.id,f,{onMessage:()=>te(),onMaterialRequest:()=>te(),onTMTicket:()=>te(),onCrewCheckin:()=>te(),onAreaUpdate:()=>te(),onCORChange:()=>te({refreshCOR:!0}),onInjuryReport:()=>te(),onProjectChange:()=>te(),onMaterialsEquipmentChange:()=>te(),onLaborRateChange:()=>te()});return()=>{O&&z.unsubscribe?.(O)}},[s?.id,Nn,te]),l.useEffect(()=>(M?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[M]);const wn=async()=>{try{const f=await z.getDumpSites(s.id);nn(f||[])}catch(f){console.error("Error loading dump sites:",f)}},Da=l.useRef(null);l.useEffect(()=>{if(n&&n!==Da.current&&c.length>0){const f=c.find(O=>O.id===n);f&&(Da.current=n,x(f),i?.())}},[n,c,i]),l.useEffect(()=>{if(d){Bs(d.id);const f=[],O=d.id,S=z.subscribeToAreas?.(O,()=>{te({refreshAreas:!0,projectId:O})});S&&f.push(S);const T=z.subscribeToDailyReports?.(O,()=>{te()});T&&f.push(T);const B=z.subscribeToCrewCheckins?.(O,()=>{te()});B&&f.push(B);const K=z.subscribeToHaulOffs?.(O,()=>{te()});K&&f.push(K);const H=z.subscribeToCORs?.(O,()=>{te({refreshCOR:!0})});return H&&f.push(H),()=>{f.forEach(X=>z.unsubscribe?.(X))}}},[d,te]),l.useEffect(()=>{R==="tickets"&&Ls("full")},[R]);const Cn=async(f,O=!1)=>{const S=f.id,T=Vs.current.get(S);if(T&&!O&&Date.now()-T.timestamp<ka)return T.data;try{const[B,K,H,X,J,ee,Ce,Ns,w,V,se,fe]=await Promise.all([le(()=>z.getAreas(f.id),{fallback:[],context:{operation:"getAreas",projectId:f.id}}),le(()=>z.getTMTickets(f.id),{fallback:[],context:{operation:"getTMTickets",projectId:f.id}}),le(()=>z.getChangeOrderTotals(f.id),{fallback:null,context:{operation:"getChangeOrderTotals",projectId:f.id}}),le(()=>z.getDailyReports(f.id,100),{fallback:[],context:{operation:"getDailyReports",projectId:f.id}}),le(()=>z.getInjuryReports(f.id),{fallback:[],context:{operation:"getInjuryReports",projectId:f.id}}),le(()=>z.calculateManDayCosts(f.id,s?.id,f.work_type||"demolition",f.job_type||"standard"),{fallback:null,context:{operation:"calculateManDayCosts",projectId:f.id}}),le(()=>z.calculateHaulOffCosts(f.id),{fallback:null,context:{operation:"calculateHaulOffCosts",projectId:f.id}}),le(()=>z.getProjectCosts(f.id),{fallback:[],context:{operation:"getProjectCosts",projectId:f.id}}),le(()=>z.getCORStats(f.id),{fallback:null,context:{operation:"getCORStats",projectId:f.id}}),le(()=>z.getCrewCheckinHistory(f.id,60),{fallback:[],context:{operation:"getCrewCheckinHistory",projectId:f.id}}),le(()=>z.getMaterialRequests(f.id),{fallback:[],context:{operation:"getMaterialRequests",projectId:f.id}}),le(()=>z.getWeeklyDisposalSummary(f.id,4),{fallback:[],context:{operation:"getWeeklyDisposalSummary",projectId:f.id}})]),me=mt(B),Ws=me.progress,Ua=H?.totalApprovedValue||0,Ka=f.contract_value+Ua,ws=me.isValueBased?me.earnedValue:Ws/100*Ka,tr=K.filter(q=>q.status==="pending").length,Hs=new Date;Hs.setDate(Hs.getDate()-7);const nr=X.filter(q=>new Date(q.report_date)>=Hs).length,Ga=Ns.reduce((q,G)=>{const Ae=parseFloat(G.amount);return q+(isNaN(Ae)?0:Ae)},0);let Cs=0;const ks={};K.forEach(q=>{const G=q.work_date||q.ticket_date||q.created_at?.split("T")[0],Ae=q.t_and_m_items||q.items||[];let Ds=0;Ae.forEach(Js=>{const br=parseFloat(Js.quantity)||1,yr=parseFloat(Js.unit_cost)||parseFloat(Js.materials_equipment?.cost_per_unit)||0;Ds+=br*yr}),Ds>0&&G&&(Cs+=Ds,ks[G]||(ks[G]={date:G,cost:0}),ks[G].cost+=Ds)});const Ya=Object.values(ks).sort((q,G)=>new Date(G.date)-new Date(q.date)),Us=ee?.totalCost||0,rr=Ce?.totalCost||0,Xa=Us+Cs+Ga,Ja=ws-Xa,ir=ws>0?Ja/ws*100:0,Qa=ee?.byDate?.length||0,lr=Ya.length,Ks=Math.max(Qa,lr),Za=Us+Cs,cr=Ks>0?Za/Ks:0,je=Si({...f,progress:Ws},ee?.totalManDays||0),ke={},et=new Set;(V||[]).forEach(q=>{const G=q.workers||[];ke[q.check_in_date]=G.length,G.forEach(Ae=>et.add(Ae.name?.toLowerCase()))});const ge=Object.keys(ke).sort(),or=ge.length>0?Math.round(ge.reduce((q,G)=>q+ke[G],0)/ge.length*10)/10:0,dr=ge.length>0?Math.max(...ge.map(q=>ke[q])):0,Gs=ge.slice(-7),Ys=ge.slice(-14,-7),st=Gs.length>0?Gs.reduce((q,G)=>q+ke[G],0)/Gs.length:0,Xs=Ys.length>0?Ys.reduce((q,G)=>q+ke[G],0)/Ys.length:0,ur=(se||[]).filter(q=>q.status==="pending").length,mr=(se||[]).filter(q=>q.status==="ordered").length,hr=(se||[]).filter(q=>q.status==="delivered").length,pr=(se||[]).filter(q=>q.priority==="urgent"&&q.status==="pending").length,xr=X.filter(q=>q.issues&&q.issues.trim().length>0).length,vr=K.reduce((q,G)=>q+(G.photos?.length||0),0),fr=(fe||[]).reduce((q,G)=>q+(G.concrete||0)+(G.trash||0)+(G.metals||0)+(G.hazardous_waste||0),0),at=J.length>0?new Date(J[0]?.incident_date||J[0]?.created_at):null,jr=at?Math.floor((new Date-at)/(1e3*60*60*24)):null,gr=B.filter(q=>q.status==="done"),tt={...f,areas:B,progress:Ws,billable:ws,changeOrderValue:Ua,revisedContractValue:Ka,changeOrderPending:H?.pendingCount||0,totalTickets:K.length,pendingTickets:tr,approvedTickets:K.filter(q=>q.status==="approved").length,tmTickets:K,dailyReportsCount:X.length,recentDailyReports:nr,injuryReportsCount:J.length,lastDailyReport:X[0]?.report_date||null,isValueBased:me.isValueBased,earnedValue:me.earnedValue,totalSOVValue:me.totalValue,laborCost:Us,laborDaysWorked:Qa,laborManDays:ee?.totalManDays||0,laborByDate:ee?.byDate||[],dailyBurn:cr,materialsEquipmentCost:Cs,materialsEquipmentByDate:Ya,haulOffCost:rr,haulOffLoads:Ce?.totalLoads||0,haulOffDays:Ce?.daysWithHaulOff||0,haulOffByType:Ce?.byWasteType||{},haulOffByDate:Ce?.byDate||[],customCosts:Ns,customCostTotal:Ga,totalBurn:Za,totalBurnDays:Ks,allCostsTotal:Xa,currentProfit:Ja,profitMargin:ir,corPendingValue:w?.total_pending_value||0,corPendingCount:w?.pending_count||0,corApprovedValue:w?.total_approved_value||0,corBilledValue:w?.total_billed_value||0,corTotalCount:w?.total_cors||0,corStats:w,scheduleStatus:je.scheduleStatus,scheduleVariance:je.scheduleVariance,scheduleLabel:je.scheduleLabel,laborStatus:je.laborStatus,laborVariance:je.laborVariance,laborLabel:je.laborLabel,hasScheduleData:je.hasScheduleData,hasLaborData:je.hasLaborData,actualManDays:ee?.totalManDays||0,crewHistory:V||[],crewByDate:ke,uniqueWorkerCount:et.size,avgCrewSize:or,peakCrewSize:dr,crewDaysTracked:ge.length,crewTrend:Xs>0?(st-Xs)/Xs*100:0,recentCrewAvg:st,materialRequests:se||[],pendingMaterialRequests:ur,orderedMaterialRequests:mr,deliveredMaterialRequests:hr,urgentMaterialRequests:pr,totalMaterialRequests:(se||[]).length,reportsWithIssues:xr,totalPhotosFromTickets:vr,dailyReports:X,weeklyDisposal:fe||[],disposalTotalLoads:fr,daysSinceLastInjury:jr,injuryReports:J,oshaRecordable:J.filter(q=>q.osha_recordable).length,completedAreasCount:gr.length,hasError:!1,_detailsLoaded:!0};return Vs.current.set(S,{data:tt,timestamp:Date.now()}),tt}catch(B){return console.error(`Error loading details for project ${f.id}:`,B),{...f,hasError:!0,_detailsLoaded:!1}}},Ye=async()=>{try{const f=await z.getProjectDashboardSummary(s?.id);o(f);const O=f.map(S=>{const T=Vs.current.get(S.id);if(T&&Date.now()-T.timestamp<ka)return T.data;const B=S.areaCount||0,K=S.completedAreas||0,H=B>0?Math.round(K/B*100):0;return{...S,progress:H,areas:[],totalTickets:S.ticketCount||0,pendingTickets:S.pendingTicketCount||0,approvedTickets:S.approvedTicketCount||0,dailyReportsCount:S.dailyReportsThisWeek||0,recentDailyReports:S.dailyReportsThisWeek||0,corTotalCount:S.corCount||0,billable:0,changeOrderValue:0,revisedContractValue:S.contract_value||0,changeOrderPending:0,tmTickets:[],injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,materialsEquipmentCost:0,materialsEquipmentByDate:[],haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corStats:null,scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1,actualManDays:0,hasError:!1,_detailsLoaded:!1}});u(O)}catch(f){console.error("Error loading projects:",f),t("Error loading projects","error")}finally{p(!1)}},Bs=async f=>{try{const O=await z.getAreas(f);y(O)}catch(O){console.error("Error loading areas:",O)}},bs=async f=>{if(x(f),!f._detailsLoaded){const O=await Cn(f);u(S=>S.map(T=>T.id===f.id?O:T)),x(O)}},Sa=()=>{x(null),y([]),E(!1),P(null),F("overview"),Ye()},_a=()=>{P({name:d.name,job_number:d.job_number||"",address:d.address||"",general_contractor:d.general_contractor||"",client_contact:d.client_contact||"",client_phone:d.client_phone||"",contract_value:d.contract_value,work_type:d.work_type||"demolition",job_type:d.job_type||"standard",pin:d.pin||"",default_dump_site_id:d.default_dump_site_id||"",areas:j.map(f=>({id:f.id,name:f.name,weight:f.weight,isNew:!1}))}),E(!0)},kn=()=>{E(!1),P(null)},ue=(f,O)=>{P(S=>({...S,[f]:O}))},Ea=(f,O,S)=>{P(T=>({...T,areas:T.areas.map((B,K)=>K===f?{...B,[O]:S}:B)}))},Dn=()=>{P(f=>({...f,areas:[...f.areas,{id:null,name:"",weight:"",isNew:!0}]}))},Sn=f=>{v.areas.length>1&&P(O=>({...O,areas:O.areas.filter((S,T)=>T!==f)}))},_n=async()=>{if(!v.name.trim()){t("Please enter a project name","error");return}const f=parseFloat(v.contract_value);if(!f||f<=0){t("Please enter a valid contract value","error");return}if(v.pin&&v.pin.length!==4){t("PIN must be 4 digits","error");return}if(v.pin&&v.pin!==d.pin&&!await z.isPinAvailable(v.pin,d.id)){t("This PIN is already in use","error");return}const O=v.areas.filter(T=>T.name.trim()&&parseFloat(T.weight)>0);if(O.length===0){t("Please add at least one area","error");return}if(O.reduce((T,B)=>T+parseFloat(B.weight),0)!==100){t("Area weights must total 100%","error");return}N(!0);try{await z.updateProject(d.id,{name:v.name.trim(),job_number:v.job_number?.trim()||null,address:v.address?.trim()||null,general_contractor:v.general_contractor?.trim()||null,client_contact:v.client_contact?.trim()||null,client_phone:v.client_phone?.trim()||null,contract_value:f,work_type:v.work_type||"demolition",job_type:v.job_type||"standard",pin:v.pin||null,default_dump_site_id:v.default_dump_site_id||null},s?.id);const T=j.map(H=>H.id),B=v.areas.filter(H=>H.id).map(H=>H.id);for(const H of T)B.includes(H)||await z.deleteArea(H);for(let H=0;H<O.length;H++){const X=O[H];X.id?await z.updateArea(X.id,{name:X.name.trim(),weight:parseFloat(X.weight),sort_order:H}):await z.createArea({project_id:d.id,name:X.name.trim(),weight:parseFloat(X.weight),status:"not_started",sort_order:H})}const K=await z.getProject(d.id);x(K),await Bs(d.id),E(!1),P(null),t("Project updated!","success")}catch(T){console.error("Error saving project:",T?.message||T),t(T?.message||"Error saving changes","error")}finally{N(!1)}},En=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await z.deleteProject(d.id),t("Project deleted","success"),Sa()}catch(f){console.error("Error deleting project:",f),t("Error deleting project","error")}},b=l.useMemo(()=>d?h.find(f=>f.id===d.id):null,[d,h]),Pn=l.useMemo(()=>{if(!d)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const f=mt(j),O=f.progress,S=b?.changeOrderValue||0,T=d.contract_value+S,B=f.isValueBased?f.earnedValue:O/100*T;return{progress:O,billable:B,changeOrderValue:S,revisedContractValue:T,isValueBased:f.isValueBased,earnedValue:f.earnedValue,totalSOVValue:f.totalValue}},[d,j,b]),On=l.useMemo(()=>{const f=h.reduce((J,ee)=>J+(ee.contract_value||0),0),O=h.reduce((J,ee)=>J+(ee.changeOrderValue||0),0),S=f+O,T=h.reduce((J,ee)=>J+(ee.billable||0),0),B=S-T,K=S>0?Math.round(T/S*100):0,H=h.reduce((J,ee)=>J+(ee.corPendingValue||0),0),X=h.reduce((J,ee)=>J+(ee.corPendingCount||0),0);return{totalOriginalContract:f,totalChangeOrders:O,totalPortfolioValue:S,totalEarned:T,totalRemaining:B,weightedCompletion:K,totalPendingCORValue:H,totalPendingCORCount:X}},[h]),Rn=l.useMemo(()=>{let f=0,O=0,S=0,T=0,B=0;for(const K of h){const H=K.revisedContractValue||K.contract_value;K.progress>=100&&f++,K.progress<100&&K.billable<=H*(K.progress/100)*1.1&&O++,K.billable>H*.9&&K.progress<90&&S++,K.billable>H&&T++,(K.changeOrderValue||0)>0&&B++}return{projectsComplete:f,projectsOnTrack:O,projectsAtRisk:S,projectsOverBudget:T,projectsWithChangeOrders:B}},[h]),An=l.useMemo(()=>{let f=0,O=0,S=0,T=0,B=0,K=0;for(const H of h)H.hasScheduleData&&(H.scheduleStatus==="ahead"?f++:H.scheduleStatus==="behind"?S++:O++),H.hasLaborData&&(H.laborStatus==="over"?T++:H.laborStatus==="under"?B++:K++);return{scheduleAhead:f,scheduleOnTrack:O,scheduleBehind:S,laborOver:T,laborUnder:B,laborOnTrack:K,hasAnyScheduleData:f+O+S>0,hasAnyLaborData:T+B+K>0}},[h]),Xe=l.useMemo(()=>{const f=h.map(S=>{const T={id:S.id,name:S.name,totalCosts:S.totalCosts||0,earnedRevenue:S.billable||0,actualProgress:S.progress||0,expectedProgress:S.expectedProgress||S.progress,pendingCORValue:S.corPendingValue||0,contractValue:S.revisedContractValue||S.contract_value||0,lastReportDate:S.lastDailyReport,recentInjuryCount:S.recentInjuryCount||0,startDate:S.start_date},B=mc(T),K=hc(B,{...T,name:S.name}),H=pc(T),X=K.map(J=>({...J,projectName:S.name,projectId:S.id}));return{projectId:S.id,projectName:S.name,riskScore:B.score,riskStatus:B.status,riskLabel:B.label,factors:B.factors,alerts:X,projections:H}}),O=f.flatMap(S=>S.alerts).sort((S,T)=>{const B={critical:0,warning:1,info:2};return B[S.type]-B[T.type]});return{projectRisks:f,allAlerts:O,criticalCount:O.filter(S=>S.type==="critical").length,warningCount:O.filter(S=>S.type==="warning").length}},[h]),Mn=l.useCallback(({target:f,projectId:O,alert:S})=>{const T=c.find(B=>B.id===O);T&&(x(T),f==="financials"?F("financials"):f==="reports"?F("reports"):f==="cors"?(F("financials"),L("cors")):F("overview"))},[c]);l.useEffect(()=>{const f=async()=>{for(const O of h)if(Ci(O,30))try{await z.archiveProject(O.id),t(`Project "${O.name}" has been auto-archived after 30 days of completion`,"info")}catch(S){console.error("Failed to auto-archive project:",S)}};h.length>0&&f()},[]);const Tn=l.useCallback(()=>{vs(null),xs(!0)},[]),Fn=l.useCallback(f=>{vs(f),xs(!0)},[]),In=l.useCallback(()=>{js(null),fs(!0)},[]),$n=l.useCallback(f=>{js(f),fs(!0)},[]),Ln=l.useCallback(()=>{Ls("full")},[]),zn=l.useCallback(()=>{Q(f=>!f)},[]),qn=l.useCallback(()=>{re(f=>!f)},[]),Pa=l.useCallback(()=>{re(!1)},[]),Oa=l.useCallback(()=>{ie(f=>!f)},[]),ys=l.useCallback(async(f="all")=>{if(d){t("Gathering field data...","info");try{const[O,S,T]=await Promise.all([z.getDailyReports(d.id,365),z.getInjuryReports(d.id),z.getCrewCheckinHistory(d.id,365)]);f==="daily"?await xc(O||[],d):f==="incidents"?await vc(S||[],d):f==="crew"?await fc(T||[],d):await jc({dailyReports:O||[],incidentReports:S||[],crewCheckins:T||[],project:d}),t("PDF exported!","success")}catch(O){console.error("Error exporting field documents:",O),t("Error generating PDF","error")}}},[d,t]),Vn=l.useCallback(()=>{Ls("preview")},[]),Bn=l.useCallback(()=>{we("log")},[]),Ra=l.useCallback(()=>{Ke(null),Ue(!0)},[]),Wn=l.useCallback(f=>{ps(f),hs(!0)},[]),Hn=l.useCallback(f=>{Ke(f),Ue(!0)},[]),Un=l.useCallback(()=>{zs(!0)},[]),Kn=l.useCallback(async f=>{try{await z.deleteProjectCost(f),Ye(),t?.("Cost deleted","success")}catch{t?.("Error deleting cost","error")}},[]),Gn=l.useMemo(()=>({corCount:b?.corStats?.total||0,ticketCount:b?.totalTickets||0,corPending:b?.corStats?.pending||0,ticketPending:b?.pendingTickets||0}),[b?.corStats?.total,b?.totalTickets,b?.corStats?.pending,b?.pendingTickets]),{totalOriginalContract:Yn,totalChangeOrders:Aa,totalPortfolioValue:Xn,totalEarned:Jn,totalRemaining:Qn,weightedCompletion:Zn,totalPendingCORValue:er,totalPendingCORCount:Ma}=On,{projectsComplete:Ta,projectsOnTrack:Fa,projectsAtRisk:Ia,projectsOverBudget:$a,projectsWithChangeOrders:La}=Rn,{scheduleAhead:za,scheduleOnTrack:qa,scheduleBehind:Va,laborOver:Ba,laborUnder:Wa,laborOnTrack:Ha,hasAnyScheduleData:sr,hasAnyLaborData:ar}=An;if(m)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(d){const{progress:f,billable:O,changeOrderValue:S,revisedContractValue:T,isValueBased:B,earnedValue:K,totalSOVValue:H}=Pn;if(k&&v){const w=v.areas.reduce((V,se)=>V+(parseFloat(se.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:kn,style:{marginBottom:"1.5rem"},children:"← Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:v.name,onChange:V=>ue("name",V.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:v.job_number,onChange:V=>ue("job_number",V.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:v.address,onChange:V=>ue("address",V.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:v.general_contractor,onChange:V=>ue("general_contractor",V.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:v.client_contact,onChange:V=>ue("client_contact",V.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:v.client_phone,onChange:V=>ue("client_phone",V.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:v.contract_value,onChange:V=>ue("contract_value",V.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:v.pin,onChange:V=>ue("pin",V.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:v.work_type,onChange:V=>ue("work_type",V.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:v.job_type,onChange:V=>ue("job_type",V.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:v.default_dump_site_id,onChange:V=>ue("default_dump_site_id",V.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),ga.map(V=>e.jsx("option",{value:V.id,children:V.name},V.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),v.areas.map((V,se)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:V.name,onChange:fe=>Ea(se,"name",fe.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:V.weight,onChange:fe=>Ea(se,"weight",fe.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>Sn(se),children:"×"})]},se)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${w===100?"valid":"invalid"}`,children:[w,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:Dn,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:_n,disabled:g,style:{flex:1},children:g?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:En,children:"Delete Project"})]})}const X=j.filter(w=>w.status==="done").length,J=j.filter(w=>w.status==="working").length,ee=j.filter(w=>w.status==="not_started").length,Ce=(b?.pendingTickets||0)+(b?.changeOrderPending||0),Ns=[{id:"overview",label:"Overview",Icon:vt},{id:"financials",label:"Financials",Icon:Ze,badge:Ce},{id:"reports",label:"Reports",Icon:he},{id:"documents",label:"Documents",Icon:na},{id:"info",label:"Info",Icon:Os}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:Sa,children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>U(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>C(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:_a,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:d.name}),(d.job_number||d.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[d.job_number&&`Job #${d.job_number}`,d.job_number&&d.work_type&&" • ",d.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[f,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:ae(O)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:ae(T-O)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:Ns.map(w=>e.jsxs("button",{className:`pv-tab ${A===w.id?"active":""} ${w.badge>0?"has-badge":""}`,onClick:()=>F(w.id),children:[e.jsx(w.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:w.label}),w.badge>0&&e.jsx("span",{className:"pv-tab-badge",children:w.badge})]},w.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[A==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab animate-fade-in",children:[e.jsxs("div",{className:"overview-hero-split",children:[e.jsx(Kc,{progress:f,areasComplete:X,totalAreas:j.length,areasWorking:J}),e.jsx(Gc,{earnedRevenue:O,totalCosts:b?.allCostsTotal||0,laborCost:b?.laborCost||0,disposalCost:b?.haulOffCost||0,equipmentCost:b?.materialsEquipmentCost||0,materialsCost:0,otherCost:b?.customCostTotal||0,contractValue:T})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(Xc,{project:d,onShowToast:t}),e.jsxs("div",{className:"overview-section-card overview-work-areas-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[X>0&&e.jsxs("span",{className:"section-badge done",children:[X," Done"]}),J>0&&e.jsxs("span",{className:"section-badge working",children:[J," Active"]}),ee>0&&e.jsxs("span",{className:"section-badge pending",children:[ee," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list work-areas-scroll stagger-areas",children:j.map(w=>e.jsxs("div",{className:`work-area-item ${w.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[w.status==="done"&&e.jsx("span",{className:"status-icon done",children:"✓"}),w.status==="working"&&e.jsx("span",{className:"status-icon working",children:"●"}),w.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:"○"})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:w.name}),e.jsx("span",{className:"work-area-weight",children:w.scheduled_value?ae(w.scheduled_value):`${w.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${w.status}`,style:{width:w.status==="done"?"100%":w.status==="working"?"50%":"0%"}})})]},w.id))})]})]}),e.jsxs("div",{className:"overview-bottom-strip",children:[(b?.pendingTickets>0||b?.changeOrderPending>0||b?.pendingMaterialRequests>0||b?.urgentMaterialRequests>0)&&e.jsxs("div",{className:"overview-attention-inline",children:[b?.urgentMaterialRequests>0&&e.jsxs("div",{className:"attention-chip warning",onClick:()=>F("reports"),children:[e.jsx(qe,{size:14}),e.jsxs("span",{children:[b.urgentMaterialRequests," urgent material request",b.urgentMaterialRequests!==1?"s":""]})]}),b?.pendingMaterialRequests>0&&!b?.urgentMaterialRequests&&e.jsxs("div",{className:"attention-chip info",onClick:()=>F("reports"),children:[e.jsx(Ps,{size:14}),e.jsxs("span",{children:[b.pendingMaterialRequests," material request",b.pendingMaterialRequests!==1?"s":""," pending"]})]}),b?.pendingTickets>0&&e.jsxs("div",{className:"attention-chip warning",onClick:()=>F("financials"),children:[e.jsx(he,{size:14}),e.jsxs("span",{children:[b.pendingTickets," T&M pending"]})]}),b?.changeOrderPending>0&&e.jsxs("div",{className:"attention-chip info",onClick:()=>F("financials"),children:[e.jsx($e,{size:14}),e.jsxs("span",{children:[b.changeOrderPending," CO pending"]})]})]}),e.jsxs("div",{className:"overview-quick-actions",children:[e.jsxs("button",{className:"overview-action-btn",onClick:()=>F("reports"),children:[e.jsx(he,{size:15}),e.jsxs("span",{children:[b?.dailyReportsCount||0," Reports"]})]}),e.jsxs("button",{className:"overview-action-btn",onClick:()=>F("financials"),children:[e.jsx(Ze,{size:15}),e.jsxs("span",{children:[b?.totalTickets||0," T&M Tickets"]})]}),e.jsx("span",{className:"overview-action-divider"}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ys("all"),children:[e.jsx(es,{size:15}),e.jsx("span",{children:"Export All Docs"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ys("daily"),children:[e.jsx(es,{size:14}),e.jsx("span",{children:"Daily"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ys("incidents"),children:[e.jsx(es,{size:14}),e.jsx("span",{children:"Incidents"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ys("crew"),children:[e.jsx(es,{size:14}),e.jsx("span",{children:"Crew"})]})]})]})]}),A==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsx(Wc,{contractValue:d?.contract_value||0,earnedRevenue:O,totalCosts:b?.allCostsTotal||0,profit:b?.currentProfit||0,progress:f,corApprovedValue:S,loading:!b}),e.jsxs("div",{className:`financials-layout ${D?"sidebar-collapsed":""}`,children:[e.jsxs("button",{className:"financials-mobile-menu-toggle",onClick:qn,"aria-label":"Open navigation menu",title:"Open navigation menu",children:[e.jsx(Wi,{size:20}),e.jsx("span",{children:"Menu"})]}),M&&e.jsx("div",{className:"financials-sidebar-overlay",onClick:Pa,"aria-hidden":"true"}),e.jsx("div",{className:`financials-sidebar ${D?"collapsed":""} ${M?"mobile-open":""}`,children:e.jsx(Uc,{activeSection:R,onSectionChange:w=>{L(w),re(!1)},collapsed:D,onToggleCollapse:zn,onMobileClose:Pa,stats:Gn})}),e.jsxs("div",{className:"financials-main",children:[R==="overview"&&e.jsxs("div",{className:"financials-overview animate-fade-in",children:[e.jsx(Ac,{projectData:b,project:d,tmTickets:b?.tmTickets||[],corStats:b?.corStats,areas:j}),e.jsxs("div",{className:"financials-analysis-row stagger-children",children:[e.jsx(Sc,{dailyBurn:b?.dailyBurn||0,totalBurn:b?.totalBurn||0,daysWorked:b?.totalBurnDays||0,laborCost:b?.laborCost||0,materialsEquipmentCost:b?.materialsEquipmentCost||0,progress:f,contractValue:T,laborByDate:b?.laborByDate||[],materialsEquipmentByDate:b?.materialsEquipmentByDate||[]}),e.jsx(Fc,{revenue:O,totalCosts:b?.allCostsTotal||0,contractValue:T,progress:f})]}),e.jsxs("div",{className:"cost-disposal-row",children:[e.jsx(Tc,{laborCost:b?.laborCost||0,haulOffCost:b?.haulOffCost||0,customCosts:b?.customCosts||[],onAddCost:Un,onDeleteCost:Kn}),e.jsx($c,{project:d,period:"week"})]}),e.jsx(kc,{project:d,onAddEquipment:Tn,onEditEquipment:Fn,onShowToast:t},hn),e.jsx(Cc,{project:d,areas:j,corStats:b?.corStats,onCreateDraw:In,onViewDraw:$n,onShowToast:t},vn),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(Ee,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:ae(b?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(wc,{project:d,company:s,onShowToast:t})})]})]}),R==="cors"&&e.jsxs("div",{className:"financials-cors animate-fade-in",children:[e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(l.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(ro,{project:d,onShowToast:t,onToggleList:Oa,showingList:Ne,onViewFullLog:Bn,onCreateCOR:Ra})})}),Ne&&e.jsx("div",{className:"financials-section cor-section-list animate-fade-in",style:{marginTop:"1rem"},children:e.jsx(l.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(ao,{project:d,company:s,areas:j,refreshKey:on,onShowToast:t,previewMode:!1,onViewAll:Oa,onDisplayModeChange:we,onCreateCOR:Ra,onViewCOR:Wn,onEditCOR:Hn})})})]}),R==="tickets"&&e.jsx("div",{className:"financials-tickets animate-fade-in",children:e.jsxs("div",{className:"financials-section tm-section",children:[He==="full"&&e.jsx("button",{className:"section-back-btn",onClick:Vn,children:"← Back to summary"}),e.jsx(l.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(Jc,{project:d,company:s,onShowToast:t,compact:He==="preview",previewMode:He==="preview",onViewAll:Ln})})]})}),R==="billing"&&e.jsx("div",{className:"financials-billing animate-fade-in",children:e.jsx(l.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(lo,{project:d,company:s,user:a,onShowToast:t})})})]})]})]}),A==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(he,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:b?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:b?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((b?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:b?.totalTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"T&M Tickets"}),(b?.pendingTickets||0)>0&&e.jsxs("div",{className:"reports-metric-status",style:{background:"#fef3c7",color:"#92400e"},children:[b.pendingTickets," pending"]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:b?.totalPhotosFromTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"Photos Captured"})]})]})}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsx("div",{className:"reports-insight-header",children:e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(xe,{size:18}),e.jsx("h3",{children:"Crew Analytics"})]})}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.uniqueWorkerCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Workers"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.avgCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Avg Crew / Day"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.peakCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Peak Crew Size"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.crewDaysTracked||0}),e.jsx("span",{className:"reports-stat-label",children:"Days Tracked"})]})]}),(b?.crewTrend||0)!==0&&e.jsxs("div",{className:`reports-trend-badge ${b.crewTrend>0?"up":"down"}`,children:[b.crewTrend>0?e.jsx(cs,{size:14}):e.jsx(ls,{size:14}),e.jsxs("span",{children:[Math.abs(Math.round(b.crewTrend)),"% ",b.crewTrend>0?"increase":"decrease"," vs prior week"]})]}),b?.crewByDate&&Object.keys(b.crewByDate).length>0&&e.jsxs("div",{className:"reports-mini-chart",children:[e.jsx("div",{className:"reports-mini-chart-label",children:"Recent Crew Size"}),e.jsx("div",{className:"reports-mini-bars",children:Object.keys(b.crewByDate).sort().slice(-14).map(w=>{const V=b.crewByDate[w],se=b.peakCrewSize||1;return e.jsx("div",{className:"reports-mini-bar-wrap",title:`${new Date(w+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}: ${V} workers`,children:e.jsx("div",{className:"reports-mini-bar",style:{height:`${V/se*100}%`}})},w)})})]})]})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(ia,{size:18}),e.jsx("h3",{children:"Safety Dashboard"})]}),e.jsx("span",{className:`reports-section-badge ${(b?.injuryReportsCount||0)>0?"warning":"success"}`,children:(b?.injuryReportsCount||0)>0?`${b.injuryReportsCount} incident${b.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsx("div",{className:"reports-safety-hero",children:e.jsxs("div",{className:`reports-safety-days ${b?.daysSinceLastInjury===null||b?.daysSinceLastInjury>30?"excellent":b?.daysSinceLastInjury>7?"good":"caution"}`,children:[e.jsx("span",{className:"reports-safety-days-value",children:b?.daysSinceLastInjury!==null?b.daysSinceLastInjury:"--"}),e.jsx("span",{className:"reports-safety-days-label",children:b?.daysSinceLastInjury!==null?"Days Since Last Incident":"No Incidents Recorded"})]})}),e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.injuryReportsCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Incidents"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.oshaRecordable||0}),e.jsx("span",{className:"reports-stat-label",children:"OSHA Recordable"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.reportsWithIssues||0}),e.jsx("span",{className:"reports-stat-label",children:"Reports w/ Issues"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.laborManDays||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Man-Days"})]})]})]})]})]}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Ps,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("span",{className:"reports-section-count",children:[b?.totalMaterialRequests||0," total"]})]}),e.jsx("div",{className:"reports-insight-body",children:(b?.totalMaterialRequests||0)===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Ps,{size:32}),e.jsx("p",{children:"No material requests yet"}),e.jsx("span",{children:"Requests from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-material-pipeline",children:[b?.urgentMaterialRequests>0&&e.jsxs("div",{className:"reports-material-status urgent",children:[e.jsx(qe,{size:14}),e.jsxs("span",{children:[b.urgentMaterialRequests," Urgent"]})]}),e.jsxs("div",{className:"reports-material-status pending",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[b?.pendingMaterialRequests||0," Pending"]})]}),e.jsxs("div",{className:"reports-material-status ordered",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[b?.orderedMaterialRequests||0," Ordered"]})]}),e.jsxs("div",{className:"reports-material-status delivered",children:[e.jsx(Hi,{size:14}),e.jsxs("span",{children:[b?.deliveredMaterialRequests||0," Delivered"]})]})]}),e.jsx("div",{className:"reports-recent-list",children:(b?.materialRequests||[]).slice(0,3).map(w=>e.jsxs("div",{className:`reports-recent-item ${w.status}`,children:[e.jsxs("div",{className:"reports-recent-item-main",children:[e.jsx("span",{className:`reports-recent-item-status ${w.status}`,children:w.status}),e.jsx("span",{className:"reports-recent-item-date",children:new Date(w.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"reports-recent-item-detail",children:[(w.items||[]).slice(0,2).map((V,se)=>e.jsxs("span",{children:[V.name,V.quantity?` (${V.quantity})`:""]},se)),(w.items||[]).length>2&&e.jsxs("span",{className:"reports-recent-more",children:["+",(w.items||[]).length-2," more"]})]}),w.priority==="urgent"&&e.jsx("span",{className:"reports-urgent-tag",children:"URGENT"})]},w.id))})]})})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Pe,{size:18}),e.jsx("h3",{children:"Disposal Trends"})]}),e.jsxs("span",{className:"reports-section-count",children:[b?.disposalTotalLoads||0," loads"]})]}),e.jsx("div",{className:"reports-insight-body",children:(b?.weeklyDisposal||[]).length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Pe,{size:32}),e.jsx("p",{children:"No disposal data yet"}),e.jsx("span",{children:"Disposal loads from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-disposal-chart",children:[e.jsx("div",{className:"reports-disposal-bars",children:(b?.weeklyDisposal||[]).map((w,V)=>{const se=(w.concrete||0)+(w.trash||0)+(w.metals||0)+(w.hazardous_waste||0),fe=Math.max(...(b?.weeklyDisposal||[]).map(me=>(me.concrete||0)+(me.trash||0)+(me.metals||0)+(me.hazardous_waste||0)))||1;return e.jsxs("div",{className:"reports-disposal-bar-col",children:[e.jsxs("div",{className:"reports-disposal-bar-stack",style:{height:`${se/fe*100}%`},children:[w.concrete>0&&e.jsx("div",{className:"reports-disposal-seg concrete",style:{flex:w.concrete},title:`Concrete: ${w.concrete}`}),w.trash>0&&e.jsx("div",{className:"reports-disposal-seg trash",style:{flex:w.trash},title:`Trash: ${w.trash}`}),w.metals>0&&e.jsx("div",{className:"reports-disposal-seg metals",style:{flex:w.metals},title:`Metals: ${w.metals}`}),w.hazardous_waste>0&&e.jsx("div",{className:"reports-disposal-seg hazardous",style:{flex:w.hazardous_waste},title:`Hazardous: ${w.hazardous_waste}`})]}),e.jsx("span",{className:"reports-disposal-bar-label",children:new Date(w.week+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},V)})}),e.jsxs("div",{className:"reports-disposal-legend",children:[e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot concrete"}),"Concrete"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot trash"}),"Trash"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot metals"}),"Metals"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot hazardous"}),"Hazardous"]})]})]}),(b?.haulOffCost||0)>0&&e.jsxs("div",{className:"reports-disposal-cost",children:[e.jsx("span",{children:"Total Disposal Cost"}),e.jsx("strong",{children:ae(b.haulOffCost)})]})]})})]})]}),e.jsxs("div",{className:"reports-insight-card reports-activity-summary",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(he,{size:18}),e.jsx("h3",{children:"Field Activity Summary"})]}),e.jsx("div",{className:"reports-activity-badges",children:b?.lastDailyReport&&e.jsxs("span",{className:"reports-last-filed",children:["Last report: ",new Date(b.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ","(",Math.floor((new Date-new Date(b.lastDailyReport))/(1e3*60*60*24)),"d ago)"]})})]}),e.jsx("div",{className:"reports-insight-body",children:e.jsxs("div",{className:"reports-activity-grid",children:[e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(he,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:b?.dailyReportsCount||0}),e.jsx("span",{children:"Daily Reports Filed"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx($e,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:b?.totalTickets||0}),e.jsx("span",{children:"T&M Tickets Created"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Ui,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:b?.totalPhotosFromTickets||0}),e.jsx("span",{children:"Photos Documented"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Ee,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsxs("strong",{children:[b?.completedAreasCount||0,"/",j.length]}),e.jsx("span",{children:"Work Areas Complete"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Ze,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:ae(b?.allCostsTotal||0)}),e.jsx("span",{children:"Total Costs Tracked"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(xe,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:b?.laborManDays||0}),e.jsx("span",{children:"Total Man-Days"})]})]})]})})]}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(he,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[b?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(l.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(so,{project:d,company:s,onShowToast:t})})})]}),e.jsxs("div",{className:`reports-section-card ${(b?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(b?.injuryReportsCount||0)>0?"warning":"success"}`,children:(b?.injuryReportsCount||0)>0?"⚠":"✓"}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(b?.injuryReportsCount||0)>0?"warning":"success"}`,children:(b?.injuryReportsCount||0)>0?`${b.injuryReportsCount} incident${b.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(l.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(Zc,{project:d,companyId:s?.id||d?.company_id,company:s,user:a,onShowToast:t})})})]})]}),A==="documents"&&e.jsx("div",{className:"pv-tab-panel documents-tab",children:e.jsx(l.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(mo,{project:d,companyId:s?.id||d?.company_id,onShowToast:t,userRole:a?.access_level||"office"})})}),A==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:d.name}),d.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",d.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:_a,children:e.jsx("span",{children:"Edit Project"})})]}),d.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(Ki,{size:14}),e.jsx("span",{children:d.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Ee,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:d.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx($e,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:d.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Ze,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:ae(T)}),e.jsx("span",{className:"info-quick-label",children:S>0?`Incl. +${ae(S)} COs`:"Contract Value"})]})]}),d.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:d.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Gi,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[d.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:d.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),d.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:d.client_contact})]}),d.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(Yi,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${d.client_phone}`,className:"info-detail-value link",children:d.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(vt,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[X>0&&e.jsxs("span",{className:"info-badge done",children:[X," Done"]}),J>0&&e.jsxs("span",{className:"info-badge working",children:[J," Active"]}),ee>0&&e.jsxs("span",{className:"info-badge pending",children:[ee," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:j.map(w=>e.jsxs("div",{className:`info-area-item ${w.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[w.status==="done"&&e.jsx("span",{className:"status-dot done",children:"✓"}),w.status==="working"&&e.jsx("span",{className:"status-dot working",children:"●"}),w.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:"○"})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:w.name}),e.jsx("span",{className:`info-area-status-label ${w.status}`,children:w.status==="done"?"Complete":w.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[w.weight,"%"]})]},w.id))})]}),e.jsx(Lc,{project:d,company:s,user:a,isAdmin:r,onShowToast:t}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(Os,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:ae(d.contract_value)})]}),S>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",ae(S)]})]}),d.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:ga.find(w=>w.id===d.default_dump_site_id)?.name||"Unknown"})]})]})]}),e.jsx("div",{className:"info-section-card",children:e.jsx(Hc,{onShowToast:t})})]})]}),I&&e.jsx(l.Suspense,{fallback:null,children:e.jsx(Qc,{project:d,user:a,onClose:()=>U(!1),onShareCreated:w=>{t("Share link created successfully!","success")}})}),_&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(l.Suspense,{fallback:null,children:e.jsx(eo,{project:d,company:s,onShowToast:t,onClose:()=>C(!1)})})}),rn&&e.jsx(l.Suspense,{fallback:null,children:e.jsx(to,{project:d,company:s,areas:j,existingCOR:ln,onClose:()=>{Ue(!1),Ke(null)},onSaved:()=>{Ue(!1),Ke(null),ya(w=>w+1)},onShowToast:t})}),cn&&ba&&e.jsx(l.Suspense,{fallback:null,children:e.jsx(no,{cor:ba,project:d,company:s,areas:j,onClose:()=>{hs(!1),ps(null)},onEdit:w=>{hs(!1),ps(null),Ke(w),Ue(!0)},onShowToast:t,onStatusChange:()=>{}})}),ms==="log"&&d&&e.jsx("div",{className:"cor-log-modal-overlay",onClick:()=>we("list"),children:e.jsxs("div",{className:"cor-log-modal",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"cor-log-modal-header",children:[e.jsx("h2",{children:"Change Order Log"}),e.jsx("button",{className:"cor-log-modal-close",onClick:()=>we("list"),title:"Close",children:"✕"})]}),e.jsx("div",{className:"cor-log-modal-content",children:e.jsx(l.Suspense,{fallback:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:e.jsx(io,{project:d,company:s,onShowToast:t})})})]})}),dn&&e.jsx(l.Suspense,{fallback:null,children:e.jsx(uo,{onClose:()=>zs(!1),saving:un,onSave:async w=>{try{Na(!0),await z.addProjectCost(d.id,s.id,w),zs(!1),Ye(),t("Cost added successfully","success")}catch(V){console.error("Error adding cost:",V),t("Error adding cost","error")}finally{Na(!1)}}})}),mn&&e.jsx(l.Suspense,{fallback:null,children:e.jsx(oo,{project:d,company:s,user:a,editItem:wa,onSave:()=>{xs(!1),vs(null),pn(w=>w+1),t(wa?"Equipment updated":"Equipment added","success")},onClose:()=>{xs(!1),vs(null)}})}),xn&&e.jsx(l.Suspense,{fallback:null,children:e.jsx(co,{project:d,company:s,areas:j,corStats:h.find(w=>w.id===d?.id)?.corStats,editDrawRequest:Ca,onSave:()=>{fs(!1),js(null),fn(w=>w+1),t(Ca?"Draw request updated":"Draw request created","success")},onClose:()=>{fs(!1),js(null)}})})]})}return c.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(he,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("button",{className:"search-trigger-btn",onClick:()=>gn(!0),children:[e.jsx(Vt,{size:16}),e.jsx("span",{children:"Search"}),e.jsx("span",{className:"shortcut",children:"⌘K"})]}),e.jsxs("div",{className:"bo-project-count",children:[c.length," Active Project",c.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(Zn,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:ae(Jn)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:ae(Xn)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:ae(Qn)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Aa>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:ae(Yn)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",La," project",La!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",ae(Aa)]})]})]}),Ma>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:ae(er)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",Ma," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[Ta>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:Ta}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),Fa>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Fa}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Ia>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:Ia}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),$a>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:$a}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),sr&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[za>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:za}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),qa>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:qa}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Va>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:Va}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),ar&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),Wa>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[Wa," under"]}),Ha>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[Ha," on track"]}),Ba>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[Ba," over"]})]})]})]}),Xe.allAlerts.length>0&&e.jsxs("div",{className:"smart-alerts-section",style:{marginBottom:"var(--space-lg, 1.5rem)"},children:[e.jsx("div",{className:"smart-alerts-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"var(--space-sm, 0.5rem)"},children:e.jsxs("h3",{style:{fontSize:"var(--font-size-md, 1rem)",fontWeight:"var(--font-weight-semibold, 600)",color:"var(--text-primary)",margin:0},children:["Needs Attention",Xe.criticalCount>0&&e.jsxs("span",{style:{marginLeft:"0.5rem",padding:"2px 8px",fontSize:"0.75rem",fontWeight:600,borderRadius:"9999px",background:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"},children:[Xe.criticalCount," critical"]})]})}),e.jsx(yc,{alerts:Xe.allAlerts,onAction:Mn,maxVisible:3})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[c.length," active"]})]}),e.jsx("div",{className:"project-list",children:h.map(f=>{const O=Xe.projectRisks.find(S=>S.projectId===f.id);return e.jsx(po,{project:f,riskScore:O?.riskScore,riskStatus:O?.riskStatus,onClick:()=>bs(f)},f.id)})}),e.jsx(gc,{isOpen:jn,onClose:bn,companyId:s?.id,onSelectProject:f=>{bs(f)},onSelectTicket:f=>{const O=c.find(S=>S.id===f.project_id);O&&(bs(O),F("financials"),L("tickets"))},onSelectCOR:f=>{const O=c.find(S=>S.id===f.project_id);O&&(bs(O),F("financials"),L("cors"),ps(f),hs(!0))},onShowToast:t})]})}function po({project:s,riskScore:a,riskStatus:r,onClick:t}){const n=ki(s.areas||[]),i=Di(s.areas||[]),c=s.contract_value-s.billable,o=s.billable>s.contract_value*.9&&s.progress<90,h={healthy:{bg:"var(--status-success-bg, #064e3b)",color:"var(--status-success, #059669)"},warning:{bg:"var(--status-warning-bg, #78350f)",color:"var(--status-warning, #d97706)"},critical:{bg:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"}},u=h[r]||h.healthy;return e.jsxs("div",{className:`project-card enhanced ${o?"at-risk":""}`,onClick:t,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[typeof a=="number"&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,background:u.bg,color:u.color},title:`Risk Score: ${a}`,"aria-label":`Risk score ${a}, ${r}`,children:a}),e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:s.name}),e.jsx("div",{className:"project-card-value",children:ae(s.contract_value)})]})]}),e.jsx("span",{className:`status-badge ${n}`,children:i})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[s.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:ae(s.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${c<0?"negative":""}`,children:ae(Math.abs(c))}),e.jsx("span",{className:"stat-label",children:c>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${s.progress}%`}})}),(s.pendingTickets>0||s.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[s.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[s.pendingTickets," Pending T&M"]}),s.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[s.approvedTickets," Approved T&M"]})]}),s.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${s.scheduleStatus}`,children:s.scheduleLabel}),s.hasLaborData&&s.laborLabel&&e.jsx("span",{className:`labor-indicator ${s.laborStatus}`,children:s.laborLabel})]})]})}const No=Object.freeze(Object.defineProperty({__proto__:null,default:ho},Symbol.toStringTag,{value:"Module"}));export{ac as A,qc as C,No as D,bo as E,Se as T,ss as a,yo as b,go as c};
//# sourceMappingURL=Dashboard-esS3vyqD.js.map
