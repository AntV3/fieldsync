import{r as Ip,a as Zp,b as Ex}from"./react-DXGY7bZi.js";import{c as Dx}from"./supabase-VuevzHjS.js";import{u as on,w as Mx,r as Tx}from"./xlsx-BTp1RmNK.js";import{E as Bi,a as un}from"./pdf-C0G31WKZ.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))i(m);new MutationObserver(m=>{for(const u of m)if(u.type==="childList")for(const g of u.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function c(m){const u={};return m.integrity&&(u.integrity=m.integrity),m.referrerPolicy&&(u.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?u.credentials="include":m.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(m){if(m.ep)return;m.ep=!0;const u=c(m);fetch(m.href,u)}})();var Jo={exports:{}},hl={};var gp;function Ax(){if(gp)return hl;gp=1;var r=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function c(i,m,u){var g=null;if(u!==void 0&&(g=""+u),m.key!==void 0&&(g=""+m.key),"key"in m){u={};for(var f in m)f!=="key"&&(u[f]=m[f])}else u=m;return m=u.ref,{$$typeof:r,type:i,key:g,ref:m!==void 0?m:null,props:u}}return hl.Fragment=l,hl.jsx=c,hl.jsxs=c,hl}var xp;function Rx(){return xp||(xp=1,Jo.exports=Ax()),Jo.exports}var e=Rx(),p=Ip();const zx=Zp(p);var Wo={exports:{}},pl={},Ko={exports:{}},ed={};var jp;function qx(){return jp||(jp=1,(function(r){function l(k,ie){var M=k.length;k.push(ie);e:for(;0<M;){var G=M-1>>>1,L=k[G];if(0<m(L,ie))k[G]=ie,k[M]=L,M=G;else break e}}function c(k){return k.length===0?null:k[0]}function i(k){if(k.length===0)return null;var ie=k[0],M=k.pop();if(M!==ie){k[0]=M;e:for(var G=0,L=k.length,P=L>>>1;G<P;){var $=2*(G+1)-1,E=k[$],ue=$+1,Me=k[ue];if(0>m(E,M))ue<L&&0>m(Me,E)?(k[G]=Me,k[ue]=M,G=ue):(k[G]=E,k[$]=M,G=$);else if(ue<L&&0>m(Me,M))k[G]=Me,k[ue]=M,G=ue;else break e}}return ie}function m(k,ie){var M=k.sortIndex-ie.sortIndex;return M!==0?M:k.id-ie.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;r.unstable_now=function(){return u.now()}}else{var g=Date,f=g.now();r.unstable_now=function(){return g.now()-f}}var j=[],v=[],x=1,R=null,A=3,q=!1,F=!1,B=!1,I=!1,re=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function C(k){for(var ie=c(v);ie!==null;){if(ie.callback===null)i(v);else if(ie.startTime<=k)i(v),ie.sortIndex=ie.expirationTime,l(j,ie);else break;ie=c(v)}}function W(k){if(B=!1,C(k),!F)if(c(j)!==null)F=!0,le||(le=!0,_());else{var ie=c(v);ie!==null&&K(W,ie.startTime-k)}}var le=!1,O=-1,U=5,Y=-1;function J(){return I?!0:!(r.unstable_now()-Y<U)}function D(){if(I=!1,le){var k=r.unstable_now();Y=k;var ie=!0;try{e:{F=!1,B&&(B=!1,w(O),O=-1),q=!0;var M=A;try{t:{for(C(k),R=c(j);R!==null&&!(R.expirationTime>k&&J());){var G=R.callback;if(typeof G=="function"){R.callback=null,A=R.priorityLevel;var L=G(R.expirationTime<=k);if(k=r.unstable_now(),typeof L=="function"){R.callback=L,C(k),ie=!0;break t}R===c(j)&&i(j),C(k)}else i(j);R=c(j)}if(R!==null)ie=!0;else{var P=c(v);P!==null&&K(W,P.startTime-k),ie=!1}}break e}finally{R=null,A=M,q=!1}ie=void 0}}finally{ie?_():le=!1}}}var _;if(typeof T=="function")_=function(){T(D)};else if(typeof MessageChannel<"u"){var y=new MessageChannel,S=y.port2;y.port1.onmessage=D,_=function(){S.postMessage(null)}}else _=function(){re(D,0)};function K(k,ie){O=re(function(){k(r.unstable_now())},ie)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(k){k.callback=null},r.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<k?Math.floor(1e3/k):5},r.unstable_getCurrentPriorityLevel=function(){return A},r.unstable_next=function(k){switch(A){case 1:case 2:case 3:var ie=3;break;default:ie=A}var M=A;A=ie;try{return k()}finally{A=M}},r.unstable_requestPaint=function(){I=!0},r.unstable_runWithPriority=function(k,ie){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var M=A;A=k;try{return ie()}finally{A=M}},r.unstable_scheduleCallback=function(k,ie,M){var G=r.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?G+M:G):M=G,k){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=M+L,k={id:x++,callback:ie,priorityLevel:k,startTime:M,expirationTime:L,sortIndex:-1},M>G?(k.sortIndex=M,l(v,k),c(j)===null&&k===c(v)&&(B?(w(O),O=-1):B=!0,K(W,M-G))):(k.sortIndex=L,l(j,k),F||q||(F=!0,le||(le=!0,_()))),k},r.unstable_shouldYield=J,r.unstable_wrapCallback=function(k){var ie=A;return function(){var M=A;A=ie;try{return k.apply(this,arguments)}finally{A=M}}}})(ed)),ed}var vp;function Ox(){return vp||(vp=1,Ko.exports=qx()),Ko.exports}var yp;function Lx(){if(yp)return pl;yp=1;var r=Ox(),l=Ip(),c=Ex();function i(t){var a="https://react.dev/errors/"+t;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)a+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function m(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function u(t){var a=t,s=t;if(t.alternate)for(;a.return;)a=a.return;else{t=a;do a=t,(a.flags&4098)!==0&&(s=a.return),t=a.return;while(t)}return a.tag===3?s:null}function g(t){if(t.tag===13){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function f(t){if(t.tag===31){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function j(t){if(u(t)!==t)throw Error(i(188))}function v(t){var a=t.alternate;if(!a){if(a=u(t),a===null)throw Error(i(188));return a!==t?null:t}for(var s=t,n=a;;){var o=s.return;if(o===null)break;var d=o.alternate;if(d===null){if(n=o.return,n!==null){s=n;continue}break}if(o.child===d.child){for(d=o.child;d;){if(d===s)return j(o),t;if(d===n)return j(o),a;d=d.sibling}throw Error(i(188))}if(s.return!==n.return)s=o,n=d;else{for(var h=!1,b=o.child;b;){if(b===s){h=!0,s=o,n=d;break}if(b===n){h=!0,n=o,s=d;break}b=b.sibling}if(!h){for(b=d.child;b;){if(b===s){h=!0,s=d,n=o;break}if(b===n){h=!0,n=d,s=o;break}b=b.sibling}if(!h)throw Error(i(189))}}if(s.alternate!==n)throw Error(i(190))}if(s.tag!==3)throw Error(i(188));return s.stateNode.current===s?t:a}function x(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t;for(t=t.child;t!==null;){if(a=x(t),a!==null)return a;t=t.sibling}return null}var R=Object.assign,A=Symbol.for("react.element"),q=Symbol.for("react.transitional.element"),F=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),re=Symbol.for("react.profiler"),w=Symbol.for("react.consumer"),T=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),le=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),Y=Symbol.for("react.activity"),J=Symbol.for("react.memo_cache_sentinel"),D=Symbol.iterator;function _(t){return t===null||typeof t!="object"?null:(t=D&&t[D]||t["@@iterator"],typeof t=="function"?t:null)}var y=Symbol.for("react.client.reference");function S(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===y?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case B:return"Fragment";case re:return"Profiler";case I:return"StrictMode";case W:return"Suspense";case le:return"SuspenseList";case Y:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case F:return"Portal";case T:return t.displayName||"Context";case w:return(t._context.displayName||"Context")+".Consumer";case C:var a=t.render;return t=t.displayName,t||(t=a.displayName||a.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case O:return a=t.displayName||null,a!==null?a:S(t.type)||"Memo";case U:a=t._payload,t=t._init;try{return S(t(a))}catch{}}return null}var K=Array.isArray,k=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ie=c.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M={pending:!1,data:null,method:null,action:null},G=[],L=-1;function P(t){return{current:t}}function $(t){0>L||(t.current=G[L],G[L]=null,L--)}function E(t,a){L++,G[L]=t.current,t.current=a}var ue=P(null),Me=P(null),Te=P(null),te=P(null);function ze(t,a){switch(E(Te,a),E(Me,t),E(ue,null),a.nodeType){case 9:case 11:t=(t=a.documentElement)&&(t=t.namespaceURI)?Hh(t):0;break;default:if(t=a.tagName,a=a.namespaceURI)a=Hh(a),t=Bh(a,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}$(ue),E(ue,t)}function Re(){$(ue),$(Me),$(Te)}function qe(t){t.memoizedState!==null&&E(te,t);var a=ue.current,s=Bh(a,t.type);a!==s&&(E(Me,t),E(ue,s))}function Ie(t){Me.current===t&&($(ue),$(Me)),te.current===t&&($(te),ol._currentValue=M)}var Ct,nt;function jt(t){if(Ct===void 0)try{throw Error()}catch(s){var a=s.stack.trim().match(/\n( *(at )?)/);Ct=a&&a[1]||"",nt=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ct+t+nt}var Ht=!1;function pt(t,a){if(!t||Ht)return"";Ht=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(a){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(he){var de=he}Reflect.construct(t,[],ve)}else{try{ve.call()}catch(he){de=he}t.call(ve.prototype)}}else{try{throw Error()}catch(he){de=he}(ve=t())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(he){if(he&&de&&typeof he.stack=="string")return[he.stack,de.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=n.DetermineComponentFrameRoot(),h=d[0],b=d[1];if(h&&b){var V=h.split(`
`),oe=b.split(`
`);for(o=n=0;n<V.length&&!V[n].includes("DetermineComponentFrameRoot");)n++;for(;o<oe.length&&!oe[o].includes("DetermineComponentFrameRoot");)o++;if(n===V.length||o===oe.length)for(n=V.length-1,o=oe.length-1;1<=n&&0<=o&&V[n]!==oe[o];)o--;for(;1<=n&&0<=o;n--,o--)if(V[n]!==oe[o]){if(n!==1||o!==1)do if(n--,o--,0>o||V[n]!==oe[o]){var fe=`
`+V[n].replace(" at new "," at ");return t.displayName&&fe.includes("<anonymous>")&&(fe=fe.replace("<anonymous>",t.displayName)),fe}while(1<=n&&0<=o);break}}}finally{Ht=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?jt(s):""}function at(t,a){switch(t.tag){case 26:case 27:case 5:return jt(t.type);case 16:return jt("Lazy");case 13:return t.child!==a&&a!==null?jt("Suspense Fallback"):jt("Suspense");case 19:return jt("SuspenseList");case 0:case 15:return pt(t.type,!1);case 11:return pt(t.type.render,!1);case 1:return pt(t.type,!0);case 31:return jt("Activity");default:return""}}function va(t){try{var a="",s=null;do a+=at(t,s),s=t,t=t.return;while(t);return a}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var _e=Object.prototype.hasOwnProperty,Ze=r.unstable_scheduleCallback,Ge=r.unstable_cancelCallback,Le=r.unstable_shouldYield,Ve=r.unstable_requestPaint,Ye=r.unstable_now,je=r.unstable_getCurrentPriorityLevel,dt=r.unstable_ImmediatePriority,vt=r.unstable_UserBlockingPriority,ct=r.unstable_NormalPriority,Pt=r.unstable_LowPriority,De=r.unstable_IdlePriority,Z=r.log,H=r.unstable_setDisableYieldValue,Ee=null,Se=null;function Ne(t){if(typeof Z=="function"&&H(t),Se&&typeof Se.setStrictMode=="function")try{Se.setStrictMode(Ee,t)}catch{}}var ke=Math.clz32?Math.clz32:pe,se=Math.log,ye=Math.LN2;function pe(t){return t>>>=0,t===0?32:31-(se(t)/ye|0)|0}var et=256,mt=262144,Xt=4194304;function At(t){var a=t&42;if(a!==0)return a;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function $t(t,a,s){var n=t.pendingLanes;if(n===0)return 0;var o=0,d=t.suspendedLanes,h=t.pingedLanes;t=t.warmLanes;var b=n&134217727;return b!==0?(n=b&~d,n!==0?o=At(n):(h&=b,h!==0?o=At(h):s||(s=b&~t,s!==0&&(o=At(s))))):(b=n&~d,b!==0?o=At(b):h!==0?o=At(h):s||(s=n&~t,s!==0&&(o=At(s)))),o===0?0:a!==0&&a!==o&&(a&d)===0&&(d=o&-o,s=a&-a,d>=s||d===32&&(s&4194048)!==0)?a:o}function sa(t,a){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&a)===0}function Kt(t,a){switch(t){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function be(){var t=Xt;return Xt<<=1,(Xt&62914560)===0&&(Xt=4194304),t}function Dt(t){for(var a=[],s=0;31>s;s++)a.push(t);return a}function St(t,a){t.pendingLanes|=a,a!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function ts(t,a,s,n,o,d){var h=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var b=t.entanglements,V=t.expirationTimes,oe=t.hiddenUpdates;for(s=h&~s;0<s;){var fe=31-ke(s),ve=1<<fe;b[fe]=0,V[fe]=-1;var de=oe[fe];if(de!==null)for(oe[fe]=null,fe=0;fe<de.length;fe++){var he=de[fe];he!==null&&(he.lane&=-536870913)}s&=~ve}n!==0&&we(t,n,0),d!==0&&o===0&&t.tag!==0&&(t.suspendedLanes|=d&~(h&~a))}function we(t,a,s){t.pendingLanes|=a,t.suspendedLanes&=~a;var n=31-ke(a);t.entangledLanes|=a,t.entanglements[n]=t.entanglements[n]|1073741824|s&261930}function He(t,a){var s=t.entangledLanes|=a;for(t=t.entanglements;s;){var n=31-ke(s),o=1<<n;o&a|t[n]&a&&(t[n]|=a),s&=~o}}function Fe(t,a){var s=a&-a;return s=(s&42)!==0?1:Xe(s),(s&(t.suspendedLanes|a))!==0?0:s}function Xe(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function ht(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function ft(){var t=ie.p;return t!==0?t:(t=window.event,t===void 0?32:op(t.type))}function it(t,a){var s=ie.p;try{return ie.p=t,a()}finally{ie.p=s}}var wt=Math.random().toString(36).slice(2),Ke="__reactFiber$"+wt,rt="__reactProps$"+wt,Vt="__reactContainer$"+wt,da="__reactEvents$"+wt,ba="__reactListeners$"+wt,Ae="__reactHandles$"+wt,lt="__reactResources$"+wt,na="__reactMarker$"+wt;function _a(t){delete t[Ke],delete t[rt],delete t[da],delete t[ba],delete t[Ae]}function N(t){var a=t[Ke];if(a)return a;for(var s=t.parentNode;s;){if(a=s[Vt]||s[Ke]){if(s=a.alternate,a.child!==null||s!==null&&s.child!==null)for(t=Qh(t);t!==null;){if(s=t[Ke])return s;t=Qh(t)}return a}t=s,s=t.parentNode}return null}function ae(t){if(t=t[Ke]||t[Vt]){var a=t.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return t}return null}function xe(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t.stateNode;throw Error(i(33))}function me(t){var a=t[lt];return a||(a=t[lt]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Oe(t){t[na]=!0}var Je=new Set,Be={};function st(t,a){Mt(t,a),Mt(t+"Capture",a)}function Mt(t,a){for(Be[t]=a,t=0;t<a.length;t++)Je.add(a[t])}var fn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ra={},as={};function Sa(t){return _e.call(as,t)?!0:_e.call(Ra,t)?!1:fn.test(t)?as[t]=!0:(Ra[t]=!0,!1)}function gn(t,a,s){if(Sa(a))if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(a);return;case"boolean":var n=a.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){t.removeAttribute(a);return}}t.setAttribute(a,""+s)}}function $n(t,a,s){if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(a);return}t.setAttribute(a,""+s)}}function ma(t,a,s,n){if(n===null)t.removeAttribute(s);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(a,s,""+n)}}function It(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function bl(t){var a=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function _l(t,a,s){var n=Object.getOwnPropertyDescriptor(t.constructor.prototype,a);if(!t.hasOwnProperty(a)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,d=n.set;return Object.defineProperty(t,a,{configurable:!0,get:function(){return o.call(this)},set:function(h){s=""+h,d.call(this,h)}}),Object.defineProperty(t,a,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(h){s=""+h},stopTracking:function(){t._valueTracker=null,delete t[a]}}}}function Vi(t){if(!t._valueTracker){var a=bl(t)?"checked":"value";t._valueTracker=_l(t,a,""+t[a])}}function Ad(t){if(!t)return!1;var a=t._valueTracker;if(!a)return!0;var s=a.getValue(),n="";return t&&(n=bl(t)?t.checked?"true":"false":t.value),t=n,t!==s?(a.setValue(t),!0):!1}function Nl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var _f=/[\n"\\]/g;function $a(t){return t.replace(_f,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Yi(t,a,s,n,o,d,h,b){t.name="",h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"?t.type=h:t.removeAttribute("type"),a!=null?h==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+It(a)):t.value!==""+It(a)&&(t.value=""+It(a)):h!=="submit"&&h!=="reset"||t.removeAttribute("value"),a!=null?Gi(t,h,It(a)):s!=null?Gi(t,h,It(s)):n!=null&&t.removeAttribute("value"),o==null&&d!=null&&(t.defaultChecked=!!d),o!=null&&(t.checked=o&&typeof o!="function"&&typeof o!="symbol"),b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?t.name=""+It(b):t.removeAttribute("name")}function Rd(t,a,s,n,o,d,h,b){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(t.type=d),a!=null||s!=null){if(!(d!=="submit"&&d!=="reset"||a!=null)){Vi(t);return}s=s!=null?""+It(s):"",a=a!=null?""+It(a):s,b||a===t.value||(t.value=a),t.defaultValue=a}n=n??o,n=typeof n!="function"&&typeof n!="symbol"&&!!n,t.checked=b?t.checked:!!n,t.defaultChecked=!!n,h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(t.name=h),Vi(t)}function Gi(t,a,s){a==="number"&&Nl(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function Vn(t,a,s,n){if(t=t.options,a){a={};for(var o=0;o<s.length;o++)a["$"+s[o]]=!0;for(s=0;s<t.length;s++)o=a.hasOwnProperty("$"+t[s].value),t[s].selected!==o&&(t[s].selected=o),o&&n&&(t[s].defaultSelected=!0)}else{for(s=""+It(s),a=null,o=0;o<t.length;o++){if(t[o].value===s){t[o].selected=!0,n&&(t[o].defaultSelected=!0);return}a!==null||t[o].disabled||(a=t[o])}a!==null&&(a.selected=!0)}}function zd(t,a,s){if(a!=null&&(a=""+It(a),a!==t.value&&(t.value=a),s==null)){t.defaultValue!==a&&(t.defaultValue=a);return}t.defaultValue=s!=null?""+It(s):""}function qd(t,a,s,n){if(a==null){if(n!=null){if(s!=null)throw Error(i(92));if(K(n)){if(1<n.length)throw Error(i(93));n=n[0]}s=n}s==null&&(s=""),a=s}s=It(a),t.defaultValue=s,n=t.textContent,n===s&&n!==""&&n!==null&&(t.value=n),Vi(t)}function Yn(t,a){if(a){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=a;return}}t.textContent=a}var Nf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Od(t,a,s){var n=a.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?n?t.setProperty(a,""):a==="float"?t.cssFloat="":t[a]="":n?t.setProperty(a,s):typeof s!="number"||s===0||Nf.has(a)?a==="float"?t.cssFloat=s:t[a]=(""+s).trim():t[a]=s+"px"}function Ld(t,a,s){if(a!=null&&typeof a!="object")throw Error(i(62));if(t=t.style,s!=null){for(var n in s)!s.hasOwnProperty(n)||a!=null&&a.hasOwnProperty(n)||(n.indexOf("--")===0?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="");for(var o in a)n=a[o],a.hasOwnProperty(o)&&s[o]!==n&&Od(t,o,n)}else for(var d in a)a.hasOwnProperty(d)&&Od(t,d,a[d])}function Pi(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sf=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),wf=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Sl(t){return wf.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function fs(){}var Qi=null;function Xi(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Gn=null,Pn=null;function Ud(t){var a=ae(t);if(a&&(t=a.stateNode)){var s=t[rt]||null;e:switch(t=a.stateNode,a.type){case"input":if(Yi(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),a=s.name,s.type==="radio"&&a!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+$a(""+a)+'"][type="radio"]'),a=0;a<s.length;a++){var n=s[a];if(n!==t&&n.form===t.form){var o=n[rt]||null;if(!o)throw Error(i(90));Yi(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(a=0;a<s.length;a++)n=s[a],n.form===t.form&&Ad(n)}break e;case"textarea":zd(t,s.value,s.defaultValue);break e;case"select":a=s.value,a!=null&&Vn(t,!!s.multiple,a,!1)}}}var Ii=!1;function Hd(t,a,s){if(Ii)return t(a,s);Ii=!0;try{var n=t(a);return n}finally{if(Ii=!1,(Gn!==null||Pn!==null)&&(ui(),Gn&&(a=Gn,t=Pn,Pn=Gn=null,Ud(a),t)))for(a=0;a<t.length;a++)Ud(t[a])}}function Cr(t,a){var s=t.stateNode;if(s===null)return null;var n=s[rt]||null;if(n===null)return null;s=n[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(i(231,a,typeof s));return s}var gs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zi=!1;if(gs)try{var kr={};Object.defineProperty(kr,"passive",{get:function(){Zi=!0}}),window.addEventListener("test",kr,kr),window.removeEventListener("test",kr,kr)}catch{Zi=!1}var Us=null,Ji=null,wl=null;function Bd(){if(wl)return wl;var t,a=Ji,s=a.length,n,o="value"in Us?Us.value:Us.textContent,d=o.length;for(t=0;t<s&&a[t]===o[t];t++);var h=s-t;for(n=1;n<=h&&a[s-n]===o[d-n];n++);return wl=o.slice(t,1<n?1-n:void 0)}function Cl(t){var a=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&a===13&&(t=13)):t=a,t===10&&(t=13),32<=t||t===13?t:0}function kl(){return!0}function Fd(){return!1}function wa(t){function a(s,n,o,d,h){this._reactName=s,this._targetInst=o,this.type=n,this.nativeEvent=d,this.target=h,this.currentTarget=null;for(var b in t)t.hasOwnProperty(b)&&(s=t[b],this[b]=s?s(d):d[b]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?kl:Fd,this.isPropagationStopped=Fd,this}return R(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=kl)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=kl)},persist:function(){},isPersistent:kl}),a}var xn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},El=wa(xn),Er=R({},xn,{view:0,detail:0}),Cf=wa(Er),Wi,Ki,Dr,Dl=R({},Er,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:tc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Dr&&(Dr&&t.type==="mousemove"?(Wi=t.screenX-Dr.screenX,Ki=t.screenY-Dr.screenY):Ki=Wi=0,Dr=t),Wi)},movementY:function(t){return"movementY"in t?t.movementY:Ki}}),$d=wa(Dl),kf=R({},Dl,{dataTransfer:0}),Ef=wa(kf),Df=R({},Er,{relatedTarget:0}),ec=wa(Df),Mf=R({},xn,{animationName:0,elapsedTime:0,pseudoElement:0}),Tf=wa(Mf),Af=R({},xn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Rf=wa(Af),zf=R({},xn,{data:0}),Vd=wa(zf),qf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Of={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Lf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Uf(t){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(t):(t=Lf[t])?!!a[t]:!1}function tc(){return Uf}var Hf=R({},Er,{key:function(t){if(t.key){var a=qf[t.key]||t.key;if(a!=="Unidentified")return a}return t.type==="keypress"?(t=Cl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Of[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:tc,charCode:function(t){return t.type==="keypress"?Cl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Cl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Bf=wa(Hf),Ff=R({},Dl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Yd=wa(Ff),$f=R({},Er,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:tc}),Vf=wa($f),Yf=R({},xn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gf=wa(Yf),Pf=R({},Dl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Qf=wa(Pf),Xf=R({},xn,{newState:0,oldState:0}),If=wa(Xf),Zf=[9,13,27,32],ac=gs&&"CompositionEvent"in window,Mr=null;gs&&"documentMode"in document&&(Mr=document.documentMode);var Jf=gs&&"TextEvent"in window&&!Mr,Gd=gs&&(!ac||Mr&&8<Mr&&11>=Mr),Pd=" ",Qd=!1;function Xd(t,a){switch(t){case"keyup":return Zf.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Id(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Qn=!1;function Wf(t,a){switch(t){case"compositionend":return Id(a);case"keypress":return a.which!==32?null:(Qd=!0,Pd);case"textInput":return t=a.data,t===Pd&&Qd?null:t;default:return null}}function Kf(t,a){if(Qn)return t==="compositionend"||!ac&&Xd(t,a)?(t=Bd(),wl=Ji=Us=null,Qn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Gd&&a.locale!=="ko"?null:a.data;default:return null}}var eg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zd(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a==="input"?!!eg[t.type]:a==="textarea"}function Jd(t,a,s,n){Gn?Pn?Pn.push(n):Pn=[n]:Gn=n,a=ji(a,"onChange"),0<a.length&&(s=new El("onChange","change",null,s,n),t.push({event:s,listeners:a}))}var Tr=null,Ar=null;function tg(t){Rh(t,0)}function Ml(t){var a=xe(t);if(Ad(a))return t}function Wd(t,a){if(t==="change")return a}var Kd=!1;if(gs){var sc;if(gs){var nc="oninput"in document;if(!nc){var eu=document.createElement("div");eu.setAttribute("oninput","return;"),nc=typeof eu.oninput=="function"}sc=nc}else sc=!1;Kd=sc&&(!document.documentMode||9<document.documentMode)}function tu(){Tr&&(Tr.detachEvent("onpropertychange",au),Ar=Tr=null)}function au(t){if(t.propertyName==="value"&&Ml(Ar)){var a=[];Jd(a,Ar,t,Xi(t)),Hd(tg,a)}}function ag(t,a,s){t==="focusin"?(tu(),Tr=a,Ar=s,Tr.attachEvent("onpropertychange",au)):t==="focusout"&&tu()}function sg(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ml(Ar)}function ng(t,a){if(t==="click")return Ml(a)}function rg(t,a){if(t==="input"||t==="change")return Ml(a)}function lg(t,a){return t===a&&(t!==0||1/t===1/a)||t!==t&&a!==a}var za=typeof Object.is=="function"?Object.is:lg;function Rr(t,a){if(za(t,a))return!0;if(typeof t!="object"||t===null||typeof a!="object"||a===null)return!1;var s=Object.keys(t),n=Object.keys(a);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var o=s[n];if(!_e.call(a,o)||!za(t[o],a[o]))return!1}return!0}function su(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function nu(t,a){var s=su(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=a&&n>=a)return{node:s,offset:a-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=su(s)}}function ru(t,a){return t&&a?t===a?!0:t&&t.nodeType===3?!1:a&&a.nodeType===3?ru(t,a.parentNode):"contains"in t?t.contains(a):t.compareDocumentPosition?!!(t.compareDocumentPosition(a)&16):!1:!1}function lu(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var a=Nl(t.document);a instanceof t.HTMLIFrameElement;){try{var s=typeof a.contentWindow.location.href=="string"}catch{s=!1}if(s)t=a.contentWindow;else break;a=Nl(t.document)}return a}function rc(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a&&(a==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||a==="textarea"||t.contentEditable==="true")}var ig=gs&&"documentMode"in document&&11>=document.documentMode,Xn=null,lc=null,zr=null,ic=!1;function iu(t,a,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;ic||Xn==null||Xn!==Nl(n)||(n=Xn,"selectionStart"in n&&rc(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),zr&&Rr(zr,n)||(zr=n,n=ji(lc,"onSelect"),0<n.length&&(a=new El("onSelect","select",null,a,s),t.push({event:a,listeners:n}),a.target=Xn)))}function jn(t,a){var s={};return s[t.toLowerCase()]=a.toLowerCase(),s["Webkit"+t]="webkit"+a,s["Moz"+t]="moz"+a,s}var In={animationend:jn("Animation","AnimationEnd"),animationiteration:jn("Animation","AnimationIteration"),animationstart:jn("Animation","AnimationStart"),transitionrun:jn("Transition","TransitionRun"),transitionstart:jn("Transition","TransitionStart"),transitioncancel:jn("Transition","TransitionCancel"),transitionend:jn("Transition","TransitionEnd")},cc={},cu={};gs&&(cu=document.createElement("div").style,"AnimationEvent"in window||(delete In.animationend.animation,delete In.animationiteration.animation,delete In.animationstart.animation),"TransitionEvent"in window||delete In.transitionend.transition);function vn(t){if(cc[t])return cc[t];if(!In[t])return t;var a=In[t],s;for(s in a)if(a.hasOwnProperty(s)&&s in cu)return cc[t]=a[s];return t}var ou=vn("animationend"),du=vn("animationiteration"),uu=vn("animationstart"),cg=vn("transitionrun"),og=vn("transitionstart"),dg=vn("transitioncancel"),mu=vn("transitionend"),hu=new Map,oc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");oc.push("scrollEnd");function ss(t,a){hu.set(t,a),st(a,[t])}var Tl=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},Va=[],Zn=0,dc=0;function Al(){for(var t=Zn,a=dc=Zn=0;a<t;){var s=Va[a];Va[a++]=null;var n=Va[a];Va[a++]=null;var o=Va[a];Va[a++]=null;var d=Va[a];if(Va[a++]=null,n!==null&&o!==null){var h=n.pending;h===null?o.next=o:(o.next=h.next,h.next=o),n.pending=o}d!==0&&pu(s,o,d)}}function Rl(t,a,s,n){Va[Zn++]=t,Va[Zn++]=a,Va[Zn++]=s,Va[Zn++]=n,dc|=n,t.lanes|=n,t=t.alternate,t!==null&&(t.lanes|=n)}function uc(t,a,s,n){return Rl(t,a,s,n),zl(t)}function yn(t,a){return Rl(t,null,null,a),zl(t)}function pu(t,a,s){t.lanes|=s;var n=t.alternate;n!==null&&(n.lanes|=s);for(var o=!1,d=t.return;d!==null;)d.childLanes|=s,n=d.alternate,n!==null&&(n.childLanes|=s),d.tag===22&&(t=d.stateNode,t===null||t._visibility&1||(o=!0)),t=d,d=d.return;return t.tag===3?(d=t.stateNode,o&&a!==null&&(o=31-ke(s),t=d.hiddenUpdates,n=t[o],n===null?t[o]=[a]:n.push(a),a.lane=s|536870912),d):null}function zl(t){if(50<al)throw al=0,bo=null,Error(i(185));for(var a=t.return;a!==null;)t=a,a=t.return;return t.tag===3?t.stateNode:null}var Jn={};function ug(t,a,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qa(t,a,s,n){return new ug(t,a,s,n)}function mc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function xs(t,a){var s=t.alternate;return s===null?(s=qa(t.tag,a,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=a,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,a=t.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function fu(t,a){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=a,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,a=s.dependencies,t.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),t}function ql(t,a,s,n,o,d){var h=0;if(n=t,typeof t=="function")mc(t)&&(h=1);else if(typeof t=="string")h=gx(t,s,ue.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case Y:return t=qa(31,s,a,o),t.elementType=Y,t.lanes=d,t;case B:return bn(s.children,o,d,a);case I:h=8,o|=24;break;case re:return t=qa(12,s,a,o|2),t.elementType=re,t.lanes=d,t;case W:return t=qa(13,s,a,o),t.elementType=W,t.lanes=d,t;case le:return t=qa(19,s,a,o),t.elementType=le,t.lanes=d,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case T:h=10;break e;case w:h=9;break e;case C:h=11;break e;case O:h=14;break e;case U:h=16,n=null;break e}h=29,s=Error(i(130,t===null?"null":typeof t,"")),n=null}return a=qa(h,s,a,o),a.elementType=t,a.type=n,a.lanes=d,a}function bn(t,a,s,n){return t=qa(7,t,n,a),t.lanes=s,t}function hc(t,a,s){return t=qa(6,t,null,a),t.lanes=s,t}function gu(t){var a=qa(18,null,null,0);return a.stateNode=t,a}function pc(t,a,s){return a=qa(4,t.children!==null?t.children:[],t.key,a),a.lanes=s,a.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},a}var xu=new WeakMap;function Ya(t,a){if(typeof t=="object"&&t!==null){var s=xu.get(t);return s!==void 0?s:(a={value:t,source:a,stack:va(a)},xu.set(t,a),a)}return{value:t,source:a,stack:va(a)}}var Wn=[],Kn=0,Ol=null,qr=0,Ga=[],Pa=0,Hs=null,cs=1,os="";function js(t,a){Wn[Kn++]=qr,Wn[Kn++]=Ol,Ol=t,qr=a}function ju(t,a,s){Ga[Pa++]=cs,Ga[Pa++]=os,Ga[Pa++]=Hs,Hs=t;var n=cs;t=os;var o=32-ke(n)-1;n&=~(1<<o),s+=1;var d=32-ke(a)+o;if(30<d){var h=o-o%5;d=(n&(1<<h)-1).toString(32),n>>=h,o-=h,cs=1<<32-ke(a)+o|s<<o|n,os=d+t}else cs=1<<d|s<<o|n,os=t}function fc(t){t.return!==null&&(js(t,1),ju(t,1,0))}function gc(t){for(;t===Ol;)Ol=Wn[--Kn],Wn[Kn]=null,qr=Wn[--Kn],Wn[Kn]=null;for(;t===Hs;)Hs=Ga[--Pa],Ga[Pa]=null,os=Ga[--Pa],Ga[Pa]=null,cs=Ga[--Pa],Ga[Pa]=null}function vu(t,a){Ga[Pa++]=cs,Ga[Pa++]=os,Ga[Pa++]=Hs,cs=a.id,os=a.overflow,Hs=t}var pa=null,Yt=null,_t=!1,Bs=null,Qa=!1,xc=Error(i(519));function Fs(t){var a=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Or(Ya(a,t)),xc}function yu(t){var a=t.stateNode,s=t.type,n=t.memoizedProps;switch(a[Ke]=t,a[rt]=n,s){case"dialog":xt("cancel",a),xt("close",a);break;case"iframe":case"object":case"embed":xt("load",a);break;case"video":case"audio":for(s=0;s<nl.length;s++)xt(nl[s],a);break;case"source":xt("error",a);break;case"img":case"image":case"link":xt("error",a),xt("load",a);break;case"details":xt("toggle",a);break;case"input":xt("invalid",a),Rd(a,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":xt("invalid",a);break;case"textarea":xt("invalid",a),qd(a,n.value,n.defaultValue,n.children)}s=n.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||a.textContent===""+s||n.suppressHydrationWarning===!0||Lh(a.textContent,s)?(n.popover!=null&&(xt("beforetoggle",a),xt("toggle",a)),n.onScroll!=null&&xt("scroll",a),n.onScrollEnd!=null&&xt("scrollend",a),n.onClick!=null&&(a.onclick=fs),a=!0):a=!1,a||Fs(t,!0)}function bu(t){for(pa=t.return;pa;)switch(pa.tag){case 5:case 31:case 13:Qa=!1;return;case 27:case 3:Qa=!0;return;default:pa=pa.return}}function er(t){if(t!==pa)return!1;if(!_t)return bu(t),_t=!0,!1;var a=t.tag,s;if((s=a!==3&&a!==27)&&((s=a===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||Oo(t.type,t.memoizedProps)),s=!s),s&&Yt&&Fs(t),bu(t),a===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(317));Yt=Ph(t)}else if(a===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(317));Yt=Ph(t)}else a===27?(a=Yt,tn(t.type)?(t=Fo,Fo=null,Yt=t):Yt=a):Yt=pa?Ia(t.stateNode.nextSibling):null;return!0}function _n(){Yt=pa=null,_t=!1}function jc(){var t=Bs;return t!==null&&(Da===null?Da=t:Da.push.apply(Da,t),Bs=null),t}function Or(t){Bs===null?Bs=[t]:Bs.push(t)}var vc=P(null),Nn=null,vs=null;function $s(t,a,s){E(vc,a._currentValue),a._currentValue=s}function ys(t){t._currentValue=vc.current,$(vc)}function yc(t,a,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&a)!==a?(t.childLanes|=a,n!==null&&(n.childLanes|=a)):n!==null&&(n.childLanes&a)!==a&&(n.childLanes|=a),t===s)break;t=t.return}}function bc(t,a,s,n){var o=t.child;for(o!==null&&(o.return=t);o!==null;){var d=o.dependencies;if(d!==null){var h=o.child;d=d.firstContext;e:for(;d!==null;){var b=d;d=o;for(var V=0;V<a.length;V++)if(b.context===a[V]){d.lanes|=s,b=d.alternate,b!==null&&(b.lanes|=s),yc(d.return,s,t),n||(h=null);break e}d=b.next}}else if(o.tag===18){if(h=o.return,h===null)throw Error(i(341));h.lanes|=s,d=h.alternate,d!==null&&(d.lanes|=s),yc(h,s,t),h=null}else h=o.child;if(h!==null)h.return=o;else for(h=o;h!==null;){if(h===t){h=null;break}if(o=h.sibling,o!==null){o.return=h.return,h=o;break}h=h.return}o=h}}function tr(t,a,s,n){t=null;for(var o=a,d=!1;o!==null;){if(!d){if((o.flags&524288)!==0)d=!0;else if((o.flags&262144)!==0)break}if(o.tag===10){var h=o.alternate;if(h===null)throw Error(i(387));if(h=h.memoizedProps,h!==null){var b=o.type;za(o.pendingProps.value,h.value)||(t!==null?t.push(b):t=[b])}}else if(o===te.current){if(h=o.alternate,h===null)throw Error(i(387));h.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(t!==null?t.push(ol):t=[ol])}o=o.return}t!==null&&bc(a,t,s,n),a.flags|=262144}function Ll(t){for(t=t.firstContext;t!==null;){if(!za(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Sn(t){Nn=t,vs=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function fa(t){return _u(Nn,t)}function Ul(t,a){return Nn===null&&Sn(t),_u(t,a)}function _u(t,a){var s=a._currentValue;if(a={context:a,memoizedValue:s,next:null},vs===null){if(t===null)throw Error(i(308));vs=a,t.dependencies={lanes:0,firstContext:a},t.flags|=524288}else vs=vs.next=a;return s}var mg=typeof AbortController<"u"?AbortController:function(){var t=[],a=this.signal={aborted:!1,addEventListener:function(s,n){t.push(n)}};this.abort=function(){a.aborted=!0,t.forEach(function(s){return s()})}},hg=r.unstable_scheduleCallback,pg=r.unstable_NormalPriority,ra={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function _c(){return{controller:new mg,data:new Map,refCount:0}}function Lr(t){t.refCount--,t.refCount===0&&hg(pg,function(){t.controller.abort()})}var Ur=null,Nc=0,ar=0,sr=null;function fg(t,a){if(Ur===null){var s=Ur=[];Nc=0,ar=ko(),sr={status:"pending",value:void 0,then:function(n){s.push(n)}}}return Nc++,a.then(Nu,Nu),a}function Nu(){if(--Nc===0&&Ur!==null){sr!==null&&(sr.status="fulfilled");var t=Ur;Ur=null,ar=0,sr=null;for(var a=0;a<t.length;a++)(0,t[a])()}}function gg(t,a){var s=[],n={status:"pending",value:null,reason:null,then:function(o){s.push(o)}};return t.then(function(){n.status="fulfilled",n.value=a;for(var o=0;o<s.length;o++)(0,s[o])(a)},function(o){for(n.status="rejected",n.reason=o,o=0;o<s.length;o++)(0,s[o])(void 0)}),n}var Su=k.S;k.S=function(t,a){ih=Ye(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&fg(t,a),Su!==null&&Su(t,a)};var wn=P(null);function Sc(){var t=wn.current;return t!==null?t:Bt.pooledCache}function Hl(t,a){a===null?E(wn,wn.current):E(wn,a.pool)}function wu(){var t=Sc();return t===null?null:{parent:ra._currentValue,pool:t}}var nr=Error(i(460)),wc=Error(i(474)),Bl=Error(i(542)),Fl={then:function(){}};function Cu(t){return t=t.status,t==="fulfilled"||t==="rejected"}function ku(t,a,s){switch(s=t[s],s===void 0?t.push(a):s!==a&&(a.then(fs,fs),a=s),a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,Du(t),t;default:if(typeof a.status=="string")a.then(fs,fs);else{if(t=Bt,t!==null&&100<t.shellSuspendCounter)throw Error(i(482));t=a,t.status="pending",t.then(function(n){if(a.status==="pending"){var o=a;o.status="fulfilled",o.value=n}},function(n){if(a.status==="pending"){var o=a;o.status="rejected",o.reason=n}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,Du(t),t}throw kn=a,nr}}function Cn(t){try{var a=t._init;return a(t._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(kn=s,nr):s}}var kn=null;function Eu(){if(kn===null)throw Error(i(459));var t=kn;return kn=null,t}function Du(t){if(t===nr||t===Bl)throw Error(i(483))}var rr=null,Hr=0;function $l(t){var a=Hr;return Hr+=1,rr===null&&(rr=[]),ku(rr,t,a)}function Br(t,a){a=a.props.ref,t.ref=a!==void 0?a:null}function Vl(t,a){throw a.$$typeof===A?Error(i(525)):(t=Object.prototype.toString.call(a),Error(i(31,t==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":t)))}function Mu(t){function a(ne,X){if(t){var ce=ne.deletions;ce===null?(ne.deletions=[X],ne.flags|=16):ce.push(X)}}function s(ne,X){if(!t)return null;for(;X!==null;)a(ne,X),X=X.sibling;return null}function n(ne){for(var X=new Map;ne!==null;)ne.key!==null?X.set(ne.key,ne):X.set(ne.index,ne),ne=ne.sibling;return X}function o(ne,X){return ne=xs(ne,X),ne.index=0,ne.sibling=null,ne}function d(ne,X,ce){return ne.index=ce,t?(ce=ne.alternate,ce!==null?(ce=ce.index,ce<X?(ne.flags|=67108866,X):ce):(ne.flags|=67108866,X)):(ne.flags|=1048576,X)}function h(ne){return t&&ne.alternate===null&&(ne.flags|=67108866),ne}function b(ne,X,ce,ge){return X===null||X.tag!==6?(X=hc(ce,ne.mode,ge),X.return=ne,X):(X=o(X,ce),X.return=ne,X)}function V(ne,X,ce,ge){var We=ce.type;return We===B?fe(ne,X,ce.props.children,ge,ce.key):X!==null&&(X.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===U&&Cn(We)===X.type)?(X=o(X,ce.props),Br(X,ce),X.return=ne,X):(X=ql(ce.type,ce.key,ce.props,null,ne.mode,ge),Br(X,ce),X.return=ne,X)}function oe(ne,X,ce,ge){return X===null||X.tag!==4||X.stateNode.containerInfo!==ce.containerInfo||X.stateNode.implementation!==ce.implementation?(X=pc(ce,ne.mode,ge),X.return=ne,X):(X=o(X,ce.children||[]),X.return=ne,X)}function fe(ne,X,ce,ge,We){return X===null||X.tag!==7?(X=bn(ce,ne.mode,ge,We),X.return=ne,X):(X=o(X,ce),X.return=ne,X)}function ve(ne,X,ce){if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return X=hc(""+X,ne.mode,ce),X.return=ne,X;if(typeof X=="object"&&X!==null){switch(X.$$typeof){case q:return ce=ql(X.type,X.key,X.props,null,ne.mode,ce),Br(ce,X),ce.return=ne,ce;case F:return X=pc(X,ne.mode,ce),X.return=ne,X;case U:return X=Cn(X),ve(ne,X,ce)}if(K(X)||_(X))return X=bn(X,ne.mode,ce,null),X.return=ne,X;if(typeof X.then=="function")return ve(ne,$l(X),ce);if(X.$$typeof===T)return ve(ne,Ul(ne,X),ce);Vl(ne,X)}return null}function de(ne,X,ce,ge){var We=X!==null?X.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return We!==null?null:b(ne,X,""+ce,ge);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case q:return ce.key===We?V(ne,X,ce,ge):null;case F:return ce.key===We?oe(ne,X,ce,ge):null;case U:return ce=Cn(ce),de(ne,X,ce,ge)}if(K(ce)||_(ce))return We!==null?null:fe(ne,X,ce,ge,null);if(typeof ce.then=="function")return de(ne,X,$l(ce),ge);if(ce.$$typeof===T)return de(ne,X,Ul(ne,ce),ge);Vl(ne,ce)}return null}function he(ne,X,ce,ge,We){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return ne=ne.get(ce)||null,b(X,ne,""+ge,We);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case q:return ne=ne.get(ge.key===null?ce:ge.key)||null,V(X,ne,ge,We);case F:return ne=ne.get(ge.key===null?ce:ge.key)||null,oe(X,ne,ge,We);case U:return ge=Cn(ge),he(ne,X,ce,ge,We)}if(K(ge)||_(ge))return ne=ne.get(ce)||null,fe(X,ne,ge,We,null);if(typeof ge.then=="function")return he(ne,X,ce,$l(ge),We);if(ge.$$typeof===T)return he(ne,X,ce,Ul(X,ge),We);Vl(X,ge)}return null}function $e(ne,X,ce,ge){for(var We=null,kt=null,Pe=X,ut=X=0,bt=null;Pe!==null&&ut<ce.length;ut++){Pe.index>ut?(bt=Pe,Pe=null):bt=Pe.sibling;var Et=de(ne,Pe,ce[ut],ge);if(Et===null){Pe===null&&(Pe=bt);break}t&&Pe&&Et.alternate===null&&a(ne,Pe),X=d(Et,X,ut),kt===null?We=Et:kt.sibling=Et,kt=Et,Pe=bt}if(ut===ce.length)return s(ne,Pe),_t&&js(ne,ut),We;if(Pe===null){for(;ut<ce.length;ut++)Pe=ve(ne,ce[ut],ge),Pe!==null&&(X=d(Pe,X,ut),kt===null?We=Pe:kt.sibling=Pe,kt=Pe);return _t&&js(ne,ut),We}for(Pe=n(Pe);ut<ce.length;ut++)bt=he(Pe,ne,ut,ce[ut],ge),bt!==null&&(t&&bt.alternate!==null&&Pe.delete(bt.key===null?ut:bt.key),X=d(bt,X,ut),kt===null?We=bt:kt.sibling=bt,kt=bt);return t&&Pe.forEach(function(ln){return a(ne,ln)}),_t&&js(ne,ut),We}function tt(ne,X,ce,ge){if(ce==null)throw Error(i(151));for(var We=null,kt=null,Pe=X,ut=X=0,bt=null,Et=ce.next();Pe!==null&&!Et.done;ut++,Et=ce.next()){Pe.index>ut?(bt=Pe,Pe=null):bt=Pe.sibling;var ln=de(ne,Pe,Et.value,ge);if(ln===null){Pe===null&&(Pe=bt);break}t&&Pe&&ln.alternate===null&&a(ne,Pe),X=d(ln,X,ut),kt===null?We=ln:kt.sibling=ln,kt=ln,Pe=bt}if(Et.done)return s(ne,Pe),_t&&js(ne,ut),We;if(Pe===null){for(;!Et.done;ut++,Et=ce.next())Et=ve(ne,Et.value,ge),Et!==null&&(X=d(Et,X,ut),kt===null?We=Et:kt.sibling=Et,kt=Et);return _t&&js(ne,ut),We}for(Pe=n(Pe);!Et.done;ut++,Et=ce.next())Et=he(Pe,ne,ut,Et.value,ge),Et!==null&&(t&&Et.alternate!==null&&Pe.delete(Et.key===null?ut:Et.key),X=d(Et,X,ut),kt===null?We=Et:kt.sibling=Et,kt=Et);return t&&Pe.forEach(function(kx){return a(ne,kx)}),_t&&js(ne,ut),We}function Lt(ne,X,ce,ge){if(typeof ce=="object"&&ce!==null&&ce.type===B&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case q:e:{for(var We=ce.key;X!==null;){if(X.key===We){if(We=ce.type,We===B){if(X.tag===7){s(ne,X.sibling),ge=o(X,ce.props.children),ge.return=ne,ne=ge;break e}}else if(X.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===U&&Cn(We)===X.type){s(ne,X.sibling),ge=o(X,ce.props),Br(ge,ce),ge.return=ne,ne=ge;break e}s(ne,X);break}else a(ne,X);X=X.sibling}ce.type===B?(ge=bn(ce.props.children,ne.mode,ge,ce.key),ge.return=ne,ne=ge):(ge=ql(ce.type,ce.key,ce.props,null,ne.mode,ge),Br(ge,ce),ge.return=ne,ne=ge)}return h(ne);case F:e:{for(We=ce.key;X!==null;){if(X.key===We)if(X.tag===4&&X.stateNode.containerInfo===ce.containerInfo&&X.stateNode.implementation===ce.implementation){s(ne,X.sibling),ge=o(X,ce.children||[]),ge.return=ne,ne=ge;break e}else{s(ne,X);break}else a(ne,X);X=X.sibling}ge=pc(ce,ne.mode,ge),ge.return=ne,ne=ge}return h(ne);case U:return ce=Cn(ce),Lt(ne,X,ce,ge)}if(K(ce))return $e(ne,X,ce,ge);if(_(ce)){if(We=_(ce),typeof We!="function")throw Error(i(150));return ce=We.call(ce),tt(ne,X,ce,ge)}if(typeof ce.then=="function")return Lt(ne,X,$l(ce),ge);if(ce.$$typeof===T)return Lt(ne,X,Ul(ne,ce),ge);Vl(ne,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint"?(ce=""+ce,X!==null&&X.tag===6?(s(ne,X.sibling),ge=o(X,ce),ge.return=ne,ne=ge):(s(ne,X),ge=hc(ce,ne.mode,ge),ge.return=ne,ne=ge),h(ne)):s(ne,X)}return function(ne,X,ce,ge){try{Hr=0;var We=Lt(ne,X,ce,ge);return rr=null,We}catch(Pe){if(Pe===nr||Pe===Bl)throw Pe;var kt=qa(29,Pe,null,ne.mode);return kt.lanes=ge,kt.return=ne,kt}finally{}}}var En=Mu(!0),Tu=Mu(!1),Vs=!1;function Cc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function kc(t,a){t=t.updateQueue,a.updateQueue===t&&(a.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Ys(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Gs(t,a,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(Tt&2)!==0){var o=n.pending;return o===null?a.next=a:(a.next=o.next,o.next=a),n.pending=a,a=zl(t),pu(t,null,s),a}return Rl(t,n,a,s),zl(t)}function Fr(t,a,s){if(a=a.updateQueue,a!==null&&(a=a.shared,(s&4194048)!==0)){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,He(t,s)}}function Ec(t,a){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var o=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var h={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};d===null?o=d=h:d=d.next=h,s=s.next}while(s!==null);d===null?o=d=a:d=d.next=a}else o=d=a;s={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:d,shared:n.shared,callbacks:n.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=a:t.next=a,s.lastBaseUpdate=a}var Dc=!1;function $r(){if(Dc){var t=sr;if(t!==null)throw t}}function Vr(t,a,s,n){Dc=!1;var o=t.updateQueue;Vs=!1;var d=o.firstBaseUpdate,h=o.lastBaseUpdate,b=o.shared.pending;if(b!==null){o.shared.pending=null;var V=b,oe=V.next;V.next=null,h===null?d=oe:h.next=oe,h=V;var fe=t.alternate;fe!==null&&(fe=fe.updateQueue,b=fe.lastBaseUpdate,b!==h&&(b===null?fe.firstBaseUpdate=oe:b.next=oe,fe.lastBaseUpdate=V))}if(d!==null){var ve=o.baseState;h=0,fe=oe=V=null,b=d;do{var de=b.lane&-536870913,he=de!==b.lane;if(he?(yt&de)===de:(n&de)===de){de!==0&&de===ar&&(Dc=!0),fe!==null&&(fe=fe.next={lane:0,tag:b.tag,payload:b.payload,callback:null,next:null});e:{var $e=t,tt=b;de=a;var Lt=s;switch(tt.tag){case 1:if($e=tt.payload,typeof $e=="function"){ve=$e.call(Lt,ve,de);break e}ve=$e;break e;case 3:$e.flags=$e.flags&-65537|128;case 0:if($e=tt.payload,de=typeof $e=="function"?$e.call(Lt,ve,de):$e,de==null)break e;ve=R({},ve,de);break e;case 2:Vs=!0}}de=b.callback,de!==null&&(t.flags|=64,he&&(t.flags|=8192),he=o.callbacks,he===null?o.callbacks=[de]:he.push(de))}else he={lane:de,tag:b.tag,payload:b.payload,callback:b.callback,next:null},fe===null?(oe=fe=he,V=ve):fe=fe.next=he,h|=de;if(b=b.next,b===null){if(b=o.shared.pending,b===null)break;he=b,b=he.next,he.next=null,o.lastBaseUpdate=he,o.shared.pending=null}}while(!0);fe===null&&(V=ve),o.baseState=V,o.firstBaseUpdate=oe,o.lastBaseUpdate=fe,d===null&&(o.shared.lanes=0),Zs|=h,t.lanes=h,t.memoizedState=ve}}function Au(t,a){if(typeof t!="function")throw Error(i(191,t));t.call(a)}function Ru(t,a){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)Au(s[t],a)}var lr=P(null),Yl=P(0);function zu(t,a){t=Ds,E(Yl,t),E(lr,a),Ds=t|a.baseLanes}function Mc(){E(Yl,Ds),E(lr,lr.current)}function Tc(){Ds=Yl.current,$(lr),$(Yl)}var Oa=P(null),Xa=null;function Ps(t){var a=t.alternate;E(ea,ea.current&1),E(Oa,t),Xa===null&&(a===null||lr.current!==null||a.memoizedState!==null)&&(Xa=t)}function Ac(t){E(ea,ea.current),E(Oa,t),Xa===null&&(Xa=t)}function qu(t){t.tag===22?(E(ea,ea.current),E(Oa,t),Xa===null&&(Xa=t)):Qs()}function Qs(){E(ea,ea.current),E(Oa,Oa.current)}function La(t){$(Oa),Xa===t&&(Xa=null),$(ea)}var ea=P(0);function Gl(t){for(var a=t;a!==null;){if(a.tag===13){var s=a.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||Ho(s)||Bo(s)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var bs=0,ot=null,qt=null,la=null,Pl=!1,ir=!1,Dn=!1,Ql=0,Yr=0,cr=null,xg=0;function Zt(){throw Error(i(321))}function Rc(t,a){if(a===null)return!1;for(var s=0;s<a.length&&s<t.length;s++)if(!za(t[s],a[s]))return!1;return!0}function zc(t,a,s,n,o,d){return bs=d,ot=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,k.H=t===null||t.memoizedState===null?jm:Ic,Dn=!1,d=s(n,o),Dn=!1,ir&&(d=Lu(a,s,n,o)),Ou(t),d}function Ou(t){k.H=Qr;var a=qt!==null&&qt.next!==null;if(bs=0,la=qt=ot=null,Pl=!1,Yr=0,cr=null,a)throw Error(i(300));t===null||ia||(t=t.dependencies,t!==null&&Ll(t)&&(ia=!0))}function Lu(t,a,s,n){ot=t;var o=0;do{if(ir&&(cr=null),Yr=0,ir=!1,25<=o)throw Error(i(301));if(o+=1,la=qt=null,t.updateQueue!=null){var d=t.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}k.H=vm,d=a(s,n)}while(ir);return d}function jg(){var t=k.H,a=t.useState()[0];return a=typeof a.then=="function"?Gr(a):a,t=t.useState()[0],(qt!==null?qt.memoizedState:null)!==t&&(ot.flags|=1024),a}function qc(){var t=Ql!==0;return Ql=0,t}function Oc(t,a,s){a.updateQueue=t.updateQueue,a.flags&=-2053,t.lanes&=~s}function Lc(t){if(Pl){for(t=t.memoizedState;t!==null;){var a=t.queue;a!==null&&(a.pending=null),t=t.next}Pl=!1}bs=0,la=qt=ot=null,ir=!1,Yr=Ql=0,cr=null}function Na(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return la===null?ot.memoizedState=la=t:la=la.next=t,la}function ta(){if(qt===null){var t=ot.alternate;t=t!==null?t.memoizedState:null}else t=qt.next;var a=la===null?ot.memoizedState:la.next;if(a!==null)la=a,qt=t;else{if(t===null)throw ot.alternate===null?Error(i(467)):Error(i(310));qt=t,t={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},la===null?ot.memoizedState=la=t:la=la.next=t}return la}function Xl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Gr(t){var a=Yr;return Yr+=1,cr===null&&(cr=[]),t=ku(cr,t,a),a=ot,(la===null?a.memoizedState:la.next)===null&&(a=a.alternate,k.H=a===null||a.memoizedState===null?jm:Ic),t}function Il(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Gr(t);if(t.$$typeof===T)return fa(t)}throw Error(i(438,String(t)))}function Uc(t){var a=null,s=ot.updateQueue;if(s!==null&&(a=s.memoCache),a==null){var n=ot.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(a={data:n.data.map(function(o){return o.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),s===null&&(s=Xl(),ot.updateQueue=s),s.memoCache=a,s=a.data[a.index],s===void 0)for(s=a.data[a.index]=Array(t),n=0;n<t;n++)s[n]=J;return a.index++,s}function _s(t,a){return typeof a=="function"?a(t):a}function Zl(t){var a=ta();return Hc(a,qt,t)}function Hc(t,a,s){var n=t.queue;if(n===null)throw Error(i(311));n.lastRenderedReducer=s;var o=t.baseQueue,d=n.pending;if(d!==null){if(o!==null){var h=o.next;o.next=d.next,d.next=h}a.baseQueue=o=d,n.pending=null}if(d=t.baseState,o===null)t.memoizedState=d;else{a=o.next;var b=h=null,V=null,oe=a,fe=!1;do{var ve=oe.lane&-536870913;if(ve!==oe.lane?(yt&ve)===ve:(bs&ve)===ve){var de=oe.revertLane;if(de===0)V!==null&&(V=V.next={lane:0,revertLane:0,gesture:null,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null}),ve===ar&&(fe=!0);else if((bs&de)===de){oe=oe.next,de===ar&&(fe=!0);continue}else ve={lane:0,revertLane:oe.revertLane,gesture:null,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null},V===null?(b=V=ve,h=d):V=V.next=ve,ot.lanes|=de,Zs|=de;ve=oe.action,Dn&&s(d,ve),d=oe.hasEagerState?oe.eagerState:s(d,ve)}else de={lane:ve,revertLane:oe.revertLane,gesture:oe.gesture,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null},V===null?(b=V=de,h=d):V=V.next=de,ot.lanes|=ve,Zs|=ve;oe=oe.next}while(oe!==null&&oe!==a);if(V===null?h=d:V.next=b,!za(d,t.memoizedState)&&(ia=!0,fe&&(s=sr,s!==null)))throw s;t.memoizedState=d,t.baseState=h,t.baseQueue=V,n.lastRenderedState=d}return o===null&&(n.lanes=0),[t.memoizedState,n.dispatch]}function Bc(t){var a=ta(),s=a.queue;if(s===null)throw Error(i(311));s.lastRenderedReducer=t;var n=s.dispatch,o=s.pending,d=a.memoizedState;if(o!==null){s.pending=null;var h=o=o.next;do d=t(d,h.action),h=h.next;while(h!==o);za(d,a.memoizedState)||(ia=!0),a.memoizedState=d,a.baseQueue===null&&(a.baseState=d),s.lastRenderedState=d}return[d,n]}function Uu(t,a,s){var n=ot,o=ta(),d=_t;if(d){if(s===void 0)throw Error(i(407));s=s()}else s=a();var h=!za((qt||o).memoizedState,s);if(h&&(o.memoizedState=s,ia=!0),o=o.queue,Vc(Fu.bind(null,n,o,t),[t]),o.getSnapshot!==a||h||la!==null&&la.memoizedState.tag&1){if(n.flags|=2048,or(9,{destroy:void 0},Bu.bind(null,n,o,s,a),null),Bt===null)throw Error(i(349));d||(bs&127)!==0||Hu(n,a,s)}return s}function Hu(t,a,s){t.flags|=16384,t={getSnapshot:a,value:s},a=ot.updateQueue,a===null?(a=Xl(),ot.updateQueue=a,a.stores=[t]):(s=a.stores,s===null?a.stores=[t]:s.push(t))}function Bu(t,a,s,n){a.value=s,a.getSnapshot=n,$u(a)&&Vu(t)}function Fu(t,a,s){return s(function(){$u(a)&&Vu(t)})}function $u(t){var a=t.getSnapshot;t=t.value;try{var s=a();return!za(t,s)}catch{return!0}}function Vu(t){var a=yn(t,2);a!==null&&Ma(a,t,2)}function Fc(t){var a=Na();if(typeof t=="function"){var s=t;if(t=s(),Dn){Ne(!0);try{s()}finally{Ne(!1)}}}return a.memoizedState=a.baseState=t,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_s,lastRenderedState:t},a}function Yu(t,a,s,n){return t.baseState=s,Hc(t,qt,typeof n=="function"?n:_s)}function vg(t,a,s,n,o){if(Kl(t))throw Error(i(485));if(t=a.action,t!==null){var d={payload:o,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(h){d.listeners.push(h)}};k.T!==null?s(!0):d.isTransition=!1,n(d),s=a.pending,s===null?(d.next=a.pending=d,Gu(a,d)):(d.next=s.next,a.pending=s.next=d)}}function Gu(t,a){var s=a.action,n=a.payload,o=t.state;if(a.isTransition){var d=k.T,h={};k.T=h;try{var b=s(o,n),V=k.S;V!==null&&V(h,b),Pu(t,a,b)}catch(oe){$c(t,a,oe)}finally{d!==null&&h.types!==null&&(d.types=h.types),k.T=d}}else try{d=s(o,n),Pu(t,a,d)}catch(oe){$c(t,a,oe)}}function Pu(t,a,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(n){Qu(t,a,n)},function(n){return $c(t,a,n)}):Qu(t,a,s)}function Qu(t,a,s){a.status="fulfilled",a.value=s,Xu(a),t.state=s,a=t.pending,a!==null&&(s=a.next,s===a?t.pending=null:(s=s.next,a.next=s,Gu(t,s)))}function $c(t,a,s){var n=t.pending;if(t.pending=null,n!==null){n=n.next;do a.status="rejected",a.reason=s,Xu(a),a=a.next;while(a!==n)}t.action=null}function Xu(t){t=t.listeners;for(var a=0;a<t.length;a++)(0,t[a])()}function Iu(t,a){return a}function Zu(t,a){if(_t){var s=Bt.formState;if(s!==null){e:{var n=ot;if(_t){if(Yt){t:{for(var o=Yt,d=Qa;o.nodeType!==8;){if(!d){o=null;break t}if(o=Ia(o.nextSibling),o===null){o=null;break t}}d=o.data,o=d==="F!"||d==="F"?o:null}if(o){Yt=Ia(o.nextSibling),n=o.data==="F!";break e}}Fs(n)}n=!1}n&&(a=s[0])}}return s=Na(),s.memoizedState=s.baseState=a,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Iu,lastRenderedState:a},s.queue=n,s=fm.bind(null,ot,n),n.dispatch=s,n=Fc(!1),d=Xc.bind(null,ot,!1,n.queue),n=Na(),o={state:a,dispatch:null,action:t,pending:null},n.queue=o,s=vg.bind(null,ot,o,d,s),o.dispatch=s,n.memoizedState=t,[a,s,!1]}function Ju(t){var a=ta();return Wu(a,qt,t)}function Wu(t,a,s){if(a=Hc(t,a,Iu)[0],t=Zl(_s)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var n=Gr(a)}catch(h){throw h===nr?Bl:h}else n=a;a=ta();var o=a.queue,d=o.dispatch;return s!==a.memoizedState&&(ot.flags|=2048,or(9,{destroy:void 0},yg.bind(null,o,s),null)),[n,d,t]}function yg(t,a){t.action=a}function Ku(t){var a=ta(),s=qt;if(s!==null)return Wu(a,s,t);ta(),a=a.memoizedState,s=ta();var n=s.queue.dispatch;return s.memoizedState=t,[a,n,!1]}function or(t,a,s,n){return t={tag:t,create:s,deps:n,inst:a,next:null},a=ot.updateQueue,a===null&&(a=Xl(),ot.updateQueue=a),s=a.lastEffect,s===null?a.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,a.lastEffect=t),t}function em(){return ta().memoizedState}function Jl(t,a,s,n){var o=Na();ot.flags|=t,o.memoizedState=or(1|a,{destroy:void 0},s,n===void 0?null:n)}function Wl(t,a,s,n){var o=ta();n=n===void 0?null:n;var d=o.memoizedState.inst;qt!==null&&n!==null&&Rc(n,qt.memoizedState.deps)?o.memoizedState=or(a,d,s,n):(ot.flags|=t,o.memoizedState=or(1|a,d,s,n))}function tm(t,a){Jl(8390656,8,t,a)}function Vc(t,a){Wl(2048,8,t,a)}function bg(t){ot.flags|=4;var a=ot.updateQueue;if(a===null)a=Xl(),ot.updateQueue=a,a.events=[t];else{var s=a.events;s===null?a.events=[t]:s.push(t)}}function am(t){var a=ta().memoizedState;return bg({ref:a,nextImpl:t}),function(){if((Tt&2)!==0)throw Error(i(440));return a.impl.apply(void 0,arguments)}}function sm(t,a){return Wl(4,2,t,a)}function nm(t,a){return Wl(4,4,t,a)}function rm(t,a){if(typeof a=="function"){t=t();var s=a(t);return function(){typeof s=="function"?s():a(null)}}if(a!=null)return t=t(),a.current=t,function(){a.current=null}}function lm(t,a,s){s=s!=null?s.concat([t]):null,Wl(4,4,rm.bind(null,a,t),s)}function Yc(){}function im(t,a){var s=ta();a=a===void 0?null:a;var n=s.memoizedState;return a!==null&&Rc(a,n[1])?n[0]:(s.memoizedState=[t,a],t)}function cm(t,a){var s=ta();a=a===void 0?null:a;var n=s.memoizedState;if(a!==null&&Rc(a,n[1]))return n[0];if(n=t(),Dn){Ne(!0);try{t()}finally{Ne(!1)}}return s.memoizedState=[n,a],n}function Gc(t,a,s){return s===void 0||(bs&1073741824)!==0&&(yt&261930)===0?t.memoizedState=a:(t.memoizedState=s,t=oh(),ot.lanes|=t,Zs|=t,s)}function om(t,a,s,n){return za(s,a)?s:lr.current!==null?(t=Gc(t,s,n),za(t,a)||(ia=!0),t):(bs&42)===0||(bs&1073741824)!==0&&(yt&261930)===0?(ia=!0,t.memoizedState=s):(t=oh(),ot.lanes|=t,Zs|=t,a)}function dm(t,a,s,n,o){var d=ie.p;ie.p=d!==0&&8>d?d:8;var h=k.T,b={};k.T=b,Xc(t,!1,a,s);try{var V=o(),oe=k.S;if(oe!==null&&oe(b,V),V!==null&&typeof V=="object"&&typeof V.then=="function"){var fe=gg(V,n);Pr(t,a,fe,Ba(t))}else Pr(t,a,n,Ba(t))}catch(ve){Pr(t,a,{then:function(){},status:"rejected",reason:ve},Ba())}finally{ie.p=d,h!==null&&b.types!==null&&(h.types=b.types),k.T=h}}function _g(){}function Pc(t,a,s,n){if(t.tag!==5)throw Error(i(476));var o=um(t).queue;dm(t,o,a,M,s===null?_g:function(){return mm(t),s(n)})}function um(t){var a=t.memoizedState;if(a!==null)return a;a={memoizedState:M,baseState:M,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_s,lastRenderedState:M},next:null};var s={};return a.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_s,lastRenderedState:s},next:null},t.memoizedState=a,t=t.alternate,t!==null&&(t.memoizedState=a),a}function mm(t){var a=um(t);a.next===null&&(a=t.alternate.memoizedState),Pr(t,a.next.queue,{},Ba())}function Qc(){return fa(ol)}function hm(){return ta().memoizedState}function pm(){return ta().memoizedState}function Ng(t){for(var a=t.return;a!==null;){switch(a.tag){case 24:case 3:var s=Ba();t=Ys(s);var n=Gs(a,t,s);n!==null&&(Ma(n,a,s),Fr(n,a,s)),a={cache:_c()},t.payload=a;return}a=a.return}}function Sg(t,a,s){var n=Ba();s={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},Kl(t)?gm(a,s):(s=uc(t,a,s,n),s!==null&&(Ma(s,t,n),xm(s,a,n)))}function fm(t,a,s){var n=Ba();Pr(t,a,s,n)}function Pr(t,a,s,n){var o={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(Kl(t))gm(a,o);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=a.lastRenderedReducer,d!==null))try{var h=a.lastRenderedState,b=d(h,s);if(o.hasEagerState=!0,o.eagerState=b,za(b,h))return Rl(t,a,o,0),Bt===null&&Al(),!1}catch{}finally{}if(s=uc(t,a,o,n),s!==null)return Ma(s,t,n),xm(s,a,n),!0}return!1}function Xc(t,a,s,n){if(n={lane:2,revertLane:ko(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Kl(t)){if(a)throw Error(i(479))}else a=uc(t,s,n,2),a!==null&&Ma(a,t,2)}function Kl(t){var a=t.alternate;return t===ot||a!==null&&a===ot}function gm(t,a){ir=Pl=!0;var s=t.pending;s===null?a.next=a:(a.next=s.next,s.next=a),t.pending=a}function xm(t,a,s){if((s&4194048)!==0){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,He(t,s)}}var Qr={readContext:fa,use:Il,useCallback:Zt,useContext:Zt,useEffect:Zt,useImperativeHandle:Zt,useLayoutEffect:Zt,useInsertionEffect:Zt,useMemo:Zt,useReducer:Zt,useRef:Zt,useState:Zt,useDebugValue:Zt,useDeferredValue:Zt,useTransition:Zt,useSyncExternalStore:Zt,useId:Zt,useHostTransitionStatus:Zt,useFormState:Zt,useActionState:Zt,useOptimistic:Zt,useMemoCache:Zt,useCacheRefresh:Zt};Qr.useEffectEvent=Zt;var jm={readContext:fa,use:Il,useCallback:function(t,a){return Na().memoizedState=[t,a===void 0?null:a],t},useContext:fa,useEffect:tm,useImperativeHandle:function(t,a,s){s=s!=null?s.concat([t]):null,Jl(4194308,4,rm.bind(null,a,t),s)},useLayoutEffect:function(t,a){return Jl(4194308,4,t,a)},useInsertionEffect:function(t,a){Jl(4,2,t,a)},useMemo:function(t,a){var s=Na();a=a===void 0?null:a;var n=t();if(Dn){Ne(!0);try{t()}finally{Ne(!1)}}return s.memoizedState=[n,a],n},useReducer:function(t,a,s){var n=Na();if(s!==void 0){var o=s(a);if(Dn){Ne(!0);try{s(a)}finally{Ne(!1)}}}else o=a;return n.memoizedState=n.baseState=o,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:o},n.queue=t,t=t.dispatch=Sg.bind(null,ot,t),[n.memoizedState,t]},useRef:function(t){var a=Na();return t={current:t},a.memoizedState=t},useState:function(t){t=Fc(t);var a=t.queue,s=fm.bind(null,ot,a);return a.dispatch=s,[t.memoizedState,s]},useDebugValue:Yc,useDeferredValue:function(t,a){var s=Na();return Gc(s,t,a)},useTransition:function(){var t=Fc(!1);return t=dm.bind(null,ot,t.queue,!0,!1),Na().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,a,s){var n=ot,o=Na();if(_t){if(s===void 0)throw Error(i(407));s=s()}else{if(s=a(),Bt===null)throw Error(i(349));(yt&127)!==0||Hu(n,a,s)}o.memoizedState=s;var d={value:s,getSnapshot:a};return o.queue=d,tm(Fu.bind(null,n,d,t),[t]),n.flags|=2048,or(9,{destroy:void 0},Bu.bind(null,n,d,s,a),null),s},useId:function(){var t=Na(),a=Bt.identifierPrefix;if(_t){var s=os,n=cs;s=(n&~(1<<32-ke(n)-1)).toString(32)+s,a="_"+a+"R_"+s,s=Ql++,0<s&&(a+="H"+s.toString(32)),a+="_"}else s=xg++,a="_"+a+"r_"+s.toString(32)+"_";return t.memoizedState=a},useHostTransitionStatus:Qc,useFormState:Zu,useActionState:Zu,useOptimistic:function(t){var a=Na();a.memoizedState=a.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=s,a=Xc.bind(null,ot,!0,s),s.dispatch=a,[t,a]},useMemoCache:Uc,useCacheRefresh:function(){return Na().memoizedState=Ng.bind(null,ot)},useEffectEvent:function(t){var a=Na(),s={impl:t};return a.memoizedState=s,function(){if((Tt&2)!==0)throw Error(i(440));return s.impl.apply(void 0,arguments)}}},Ic={readContext:fa,use:Il,useCallback:im,useContext:fa,useEffect:Vc,useImperativeHandle:lm,useInsertionEffect:sm,useLayoutEffect:nm,useMemo:cm,useReducer:Zl,useRef:em,useState:function(){return Zl(_s)},useDebugValue:Yc,useDeferredValue:function(t,a){var s=ta();return om(s,qt.memoizedState,t,a)},useTransition:function(){var t=Zl(_s)[0],a=ta().memoizedState;return[typeof t=="boolean"?t:Gr(t),a]},useSyncExternalStore:Uu,useId:hm,useHostTransitionStatus:Qc,useFormState:Ju,useActionState:Ju,useOptimistic:function(t,a){var s=ta();return Yu(s,qt,t,a)},useMemoCache:Uc,useCacheRefresh:pm};Ic.useEffectEvent=am;var vm={readContext:fa,use:Il,useCallback:im,useContext:fa,useEffect:Vc,useImperativeHandle:lm,useInsertionEffect:sm,useLayoutEffect:nm,useMemo:cm,useReducer:Bc,useRef:em,useState:function(){return Bc(_s)},useDebugValue:Yc,useDeferredValue:function(t,a){var s=ta();return qt===null?Gc(s,t,a):om(s,qt.memoizedState,t,a)},useTransition:function(){var t=Bc(_s)[0],a=ta().memoizedState;return[typeof t=="boolean"?t:Gr(t),a]},useSyncExternalStore:Uu,useId:hm,useHostTransitionStatus:Qc,useFormState:Ku,useActionState:Ku,useOptimistic:function(t,a){var s=ta();return qt!==null?Yu(s,qt,t,a):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:Uc,useCacheRefresh:pm};vm.useEffectEvent=am;function Zc(t,a,s,n){a=t.memoizedState,s=s(n,a),s=s==null?a:R({},a,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var Jc={enqueueSetState:function(t,a,s){t=t._reactInternals;var n=Ba(),o=Ys(n);o.payload=a,s!=null&&(o.callback=s),a=Gs(t,o,n),a!==null&&(Ma(a,t,n),Fr(a,t,n))},enqueueReplaceState:function(t,a,s){t=t._reactInternals;var n=Ba(),o=Ys(n);o.tag=1,o.payload=a,s!=null&&(o.callback=s),a=Gs(t,o,n),a!==null&&(Ma(a,t,n),Fr(a,t,n))},enqueueForceUpdate:function(t,a){t=t._reactInternals;var s=Ba(),n=Ys(s);n.tag=2,a!=null&&(n.callback=a),a=Gs(t,n,s),a!==null&&(Ma(a,t,s),Fr(a,t,s))}};function ym(t,a,s,n,o,d,h){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,d,h):a.prototype&&a.prototype.isPureReactComponent?!Rr(s,n)||!Rr(o,d):!0}function bm(t,a,s,n){t=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(s,n),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(s,n),a.state!==t&&Jc.enqueueReplaceState(a,a.state,null)}function Mn(t,a){var s=a;if("ref"in a){s={};for(var n in a)n!=="ref"&&(s[n]=a[n])}if(t=t.defaultProps){s===a&&(s=R({},s));for(var o in t)s[o]===void 0&&(s[o]=t[o])}return s}function _m(t){Tl(t)}function Nm(t){console.error(t)}function Sm(t){Tl(t)}function ei(t,a){try{var s=t.onUncaughtError;s(a.value,{componentStack:a.stack})}catch(n){setTimeout(function(){throw n})}}function wm(t,a,s){try{var n=t.onCaughtError;n(s.value,{componentStack:s.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(o){setTimeout(function(){throw o})}}function Wc(t,a,s){return s=Ys(s),s.tag=3,s.payload={element:null},s.callback=function(){ei(t,a)},s}function Cm(t){return t=Ys(t),t.tag=3,t}function km(t,a,s,n){var o=s.type.getDerivedStateFromError;if(typeof o=="function"){var d=n.value;t.payload=function(){return o(d)},t.callback=function(){wm(a,s,n)}}var h=s.stateNode;h!==null&&typeof h.componentDidCatch=="function"&&(t.callback=function(){wm(a,s,n),typeof o!="function"&&(Js===null?Js=new Set([this]):Js.add(this));var b=n.stack;this.componentDidCatch(n.value,{componentStack:b!==null?b:""})})}function wg(t,a,s,n,o){if(s.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(a=s.alternate,a!==null&&tr(a,s,o,!0),s=Oa.current,s!==null){switch(s.tag){case 31:case 13:return Xa===null?mi():s.alternate===null&&Jt===0&&(Jt=3),s.flags&=-257,s.flags|=65536,s.lanes=o,n===Fl?s.flags|=16384:(a=s.updateQueue,a===null?s.updateQueue=new Set([n]):a.add(n),So(t,n,o)),!1;case 22:return s.flags|=65536,n===Fl?s.flags|=16384:(a=s.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([n])},s.updateQueue=a):(s=a.retryQueue,s===null?a.retryQueue=new Set([n]):s.add(n)),So(t,n,o)),!1}throw Error(i(435,s.tag))}return So(t,n,o),mi(),!1}if(_t)return a=Oa.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=o,n!==xc&&(t=Error(i(422),{cause:n}),Or(Ya(t,s)))):(n!==xc&&(a=Error(i(423),{cause:n}),Or(Ya(a,s))),t=t.current.alternate,t.flags|=65536,o&=-o,t.lanes|=o,n=Ya(n,s),o=Wc(t.stateNode,n,o),Ec(t,o),Jt!==4&&(Jt=2)),!1;var d=Error(i(520),{cause:n});if(d=Ya(d,s),tl===null?tl=[d]:tl.push(d),Jt!==4&&(Jt=2),a===null)return!0;n=Ya(n,s),s=a;do{switch(s.tag){case 3:return s.flags|=65536,t=o&-o,s.lanes|=t,t=Wc(s.stateNode,n,t),Ec(s,t),!1;case 1:if(a=s.type,d=s.stateNode,(s.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(Js===null||!Js.has(d))))return s.flags|=65536,o&=-o,s.lanes|=o,o=Cm(o),km(o,t,s,n),Ec(s,o),!1}s=s.return}while(s!==null);return!1}var Kc=Error(i(461)),ia=!1;function ga(t,a,s,n){a.child=t===null?Tu(a,null,s,n):En(a,t.child,s,n)}function Em(t,a,s,n,o){s=s.render;var d=a.ref;if("ref"in n){var h={};for(var b in n)b!=="ref"&&(h[b]=n[b])}else h=n;return Sn(a),n=zc(t,a,s,h,d,o),b=qc(),t!==null&&!ia?(Oc(t,a,o),Ns(t,a,o)):(_t&&b&&fc(a),a.flags|=1,ga(t,a,n,o),a.child)}function Dm(t,a,s,n,o){if(t===null){var d=s.type;return typeof d=="function"&&!mc(d)&&d.defaultProps===void 0&&s.compare===null?(a.tag=15,a.type=d,Mm(t,a,d,n,o)):(t=ql(s.type,null,n,a,a.mode,o),t.ref=a.ref,t.return=a,a.child=t)}if(d=t.child,!io(t,o)){var h=d.memoizedProps;if(s=s.compare,s=s!==null?s:Rr,s(h,n)&&t.ref===a.ref)return Ns(t,a,o)}return a.flags|=1,t=xs(d,n),t.ref=a.ref,t.return=a,a.child=t}function Mm(t,a,s,n,o){if(t!==null){var d=t.memoizedProps;if(Rr(d,n)&&t.ref===a.ref)if(ia=!1,a.pendingProps=n=d,io(t,o))(t.flags&131072)!==0&&(ia=!0);else return a.lanes=t.lanes,Ns(t,a,o)}return eo(t,a,s,n,o)}function Tm(t,a,s,n){var o=n.children,d=t!==null?t.memoizedState:null;if(t===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((a.flags&128)!==0){if(d=d!==null?d.baseLanes|s:s,t!==null){for(n=a.child=t.child,o=0;n!==null;)o=o|n.lanes|n.childLanes,n=n.sibling;n=o&~d}else n=0,a.child=null;return Am(t,a,d,s,n)}if((s&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},t!==null&&Hl(a,d!==null?d.cachePool:null),d!==null?zu(a,d):Mc(),qu(a);else return n=a.lanes=536870912,Am(t,a,d!==null?d.baseLanes|s:s,s,n)}else d!==null?(Hl(a,d.cachePool),zu(a,d),Qs(),a.memoizedState=null):(t!==null&&Hl(a,null),Mc(),Qs());return ga(t,a,o,s),a.child}function Xr(t,a){return t!==null&&t.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Am(t,a,s,n,o){var d=Sc();return d=d===null?null:{parent:ra._currentValue,pool:d},a.memoizedState={baseLanes:s,cachePool:d},t!==null&&Hl(a,null),Mc(),qu(a),t!==null&&tr(t,a,n,!0),a.childLanes=o,null}function ti(t,a){return a=si({mode:a.mode,children:a.children},t.mode),a.ref=t.ref,t.child=a,a.return=t,a}function Rm(t,a,s){return En(a,t.child,null,s),t=ti(a,a.pendingProps),t.flags|=2,La(a),a.memoizedState=null,t}function Cg(t,a,s){var n=a.pendingProps,o=(a.flags&128)!==0;if(a.flags&=-129,t===null){if(_t){if(n.mode==="hidden")return t=ti(a,n),a.lanes=536870912,Xr(null,t);if(Ac(a),(t=Yt)?(t=Gh(t,Qa),t=t!==null&&t.data==="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:Hs!==null?{id:cs,overflow:os}:null,retryLane:536870912,hydrationErrors:null},s=gu(t),s.return=a,a.child=s,pa=a,Yt=null)):t=null,t===null)throw Fs(a);return a.lanes=536870912,null}return ti(a,n)}var d=t.memoizedState;if(d!==null){var h=d.dehydrated;if(Ac(a),o)if(a.flags&256)a.flags&=-257,a=Rm(t,a,s);else if(a.memoizedState!==null)a.child=t.child,a.flags|=128,a=null;else throw Error(i(558));else if(ia||tr(t,a,s,!1),o=(s&t.childLanes)!==0,ia||o){if(n=Bt,n!==null&&(h=Fe(n,s),h!==0&&h!==d.retryLane))throw d.retryLane=h,yn(t,h),Ma(n,t,h),Kc;mi(),a=Rm(t,a,s)}else t=d.treeContext,Yt=Ia(h.nextSibling),pa=a,_t=!0,Bs=null,Qa=!1,t!==null&&vu(a,t),a=ti(a,n),a.flags|=4096;return a}return t=xs(t.child,{mode:n.mode,children:n.children}),t.ref=a.ref,a.child=t,t.return=a,t}function ai(t,a){var s=a.ref;if(s===null)t!==null&&t.ref!==null&&(a.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(i(284));(t===null||t.ref!==s)&&(a.flags|=4194816)}}function eo(t,a,s,n,o){return Sn(a),s=zc(t,a,s,n,void 0,o),n=qc(),t!==null&&!ia?(Oc(t,a,o),Ns(t,a,o)):(_t&&n&&fc(a),a.flags|=1,ga(t,a,s,o),a.child)}function zm(t,a,s,n,o,d){return Sn(a),a.updateQueue=null,s=Lu(a,n,s,o),Ou(t),n=qc(),t!==null&&!ia?(Oc(t,a,d),Ns(t,a,d)):(_t&&n&&fc(a),a.flags|=1,ga(t,a,s,d),a.child)}function qm(t,a,s,n,o){if(Sn(a),a.stateNode===null){var d=Jn,h=s.contextType;typeof h=="object"&&h!==null&&(d=fa(h)),d=new s(n,d),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Jc,a.stateNode=d,d._reactInternals=a,d=a.stateNode,d.props=n,d.state=a.memoizedState,d.refs={},Cc(a),h=s.contextType,d.context=typeof h=="object"&&h!==null?fa(h):Jn,d.state=a.memoizedState,h=s.getDerivedStateFromProps,typeof h=="function"&&(Zc(a,s,h,n),d.state=a.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(h=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),h!==d.state&&Jc.enqueueReplaceState(d,d.state,null),Vr(a,n,d,o),$r(),d.state=a.memoizedState),typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!0}else if(t===null){d=a.stateNode;var b=a.memoizedProps,V=Mn(s,b);d.props=V;var oe=d.context,fe=s.contextType;h=Jn,typeof fe=="object"&&fe!==null&&(h=fa(fe));var ve=s.getDerivedStateFromProps;fe=typeof ve=="function"||typeof d.getSnapshotBeforeUpdate=="function",b=a.pendingProps!==b,fe||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(b||oe!==h)&&bm(a,d,n,h),Vs=!1;var de=a.memoizedState;d.state=de,Vr(a,n,d,o),$r(),oe=a.memoizedState,b||de!==oe||Vs?(typeof ve=="function"&&(Zc(a,s,ve,n),oe=a.memoizedState),(V=Vs||ym(a,s,V,n,de,oe,h))?(fe||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(a.flags|=4194308)):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=n,a.memoizedState=oe),d.props=n,d.state=oe,d.context=h,n=V):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!1)}else{d=a.stateNode,kc(t,a),h=a.memoizedProps,fe=Mn(s,h),d.props=fe,ve=a.pendingProps,de=d.context,oe=s.contextType,V=Jn,typeof oe=="object"&&oe!==null&&(V=fa(oe)),b=s.getDerivedStateFromProps,(oe=typeof b=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==ve||de!==V)&&bm(a,d,n,V),Vs=!1,de=a.memoizedState,d.state=de,Vr(a,n,d,o),$r();var he=a.memoizedState;h!==ve||de!==he||Vs||t!==null&&t.dependencies!==null&&Ll(t.dependencies)?(typeof b=="function"&&(Zc(a,s,b,n),he=a.memoizedState),(fe=Vs||ym(a,s,fe,n,de,he,V)||t!==null&&t.dependencies!==null&&Ll(t.dependencies))?(oe||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,he,V),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,he,V)),typeof d.componentDidUpdate=="function"&&(a.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&de===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&de===t.memoizedState||(a.flags|=1024),a.memoizedProps=n,a.memoizedState=he),d.props=n,d.state=he,d.context=V,n=fe):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&de===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&de===t.memoizedState||(a.flags|=1024),n=!1)}return d=n,ai(t,a),n=(a.flags&128)!==0,d||n?(d=a.stateNode,s=n&&typeof s.getDerivedStateFromError!="function"?null:d.render(),a.flags|=1,t!==null&&n?(a.child=En(a,t.child,null,o),a.child=En(a,null,s,o)):ga(t,a,s,o),a.memoizedState=d.state,t=a.child):t=Ns(t,a,o),t}function Om(t,a,s,n){return _n(),a.flags|=256,ga(t,a,s,n),a.child}var to={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ao(t){return{baseLanes:t,cachePool:wu()}}function so(t,a,s){return t=t!==null?t.childLanes&~s:0,a&&(t|=Ha),t}function Lm(t,a,s){var n=a.pendingProps,o=!1,d=(a.flags&128)!==0,h;if((h=d)||(h=t!==null&&t.memoizedState===null?!1:(ea.current&2)!==0),h&&(o=!0,a.flags&=-129),h=(a.flags&32)!==0,a.flags&=-33,t===null){if(_t){if(o?Ps(a):Qs(),(t=Yt)?(t=Gh(t,Qa),t=t!==null&&t.data!=="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:Hs!==null?{id:cs,overflow:os}:null,retryLane:536870912,hydrationErrors:null},s=gu(t),s.return=a,a.child=s,pa=a,Yt=null)):t=null,t===null)throw Fs(a);return Bo(t)?a.lanes=32:a.lanes=536870912,null}var b=n.children;return n=n.fallback,o?(Qs(),o=a.mode,b=si({mode:"hidden",children:b},o),n=bn(n,o,s,null),b.return=a,n.return=a,b.sibling=n,a.child=b,n=a.child,n.memoizedState=ao(s),n.childLanes=so(t,h,s),a.memoizedState=to,Xr(null,n)):(Ps(a),no(a,b))}var V=t.memoizedState;if(V!==null&&(b=V.dehydrated,b!==null)){if(d)a.flags&256?(Ps(a),a.flags&=-257,a=ro(t,a,s)):a.memoizedState!==null?(Qs(),a.child=t.child,a.flags|=128,a=null):(Qs(),b=n.fallback,o=a.mode,n=si({mode:"visible",children:n.children},o),b=bn(b,o,s,null),b.flags|=2,n.return=a,b.return=a,n.sibling=b,a.child=n,En(a,t.child,null,s),n=a.child,n.memoizedState=ao(s),n.childLanes=so(t,h,s),a.memoizedState=to,a=Xr(null,n));else if(Ps(a),Bo(b)){if(h=b.nextSibling&&b.nextSibling.dataset,h)var oe=h.dgst;h=oe,n=Error(i(419)),n.stack="",n.digest=h,Or({value:n,source:null,stack:null}),a=ro(t,a,s)}else if(ia||tr(t,a,s,!1),h=(s&t.childLanes)!==0,ia||h){if(h=Bt,h!==null&&(n=Fe(h,s),n!==0&&n!==V.retryLane))throw V.retryLane=n,yn(t,n),Ma(h,t,n),Kc;Ho(b)||mi(),a=ro(t,a,s)}else Ho(b)?(a.flags|=192,a.child=t.child,a=null):(t=V.treeContext,Yt=Ia(b.nextSibling),pa=a,_t=!0,Bs=null,Qa=!1,t!==null&&vu(a,t),a=no(a,n.children),a.flags|=4096);return a}return o?(Qs(),b=n.fallback,o=a.mode,V=t.child,oe=V.sibling,n=xs(V,{mode:"hidden",children:n.children}),n.subtreeFlags=V.subtreeFlags&65011712,oe!==null?b=xs(oe,b):(b=bn(b,o,s,null),b.flags|=2),b.return=a,n.return=a,n.sibling=b,a.child=n,Xr(null,n),n=a.child,b=t.child.memoizedState,b===null?b=ao(s):(o=b.cachePool,o!==null?(V=ra._currentValue,o=o.parent!==V?{parent:V,pool:V}:o):o=wu(),b={baseLanes:b.baseLanes|s,cachePool:o}),n.memoizedState=b,n.childLanes=so(t,h,s),a.memoizedState=to,Xr(t.child,n)):(Ps(a),s=t.child,t=s.sibling,s=xs(s,{mode:"visible",children:n.children}),s.return=a,s.sibling=null,t!==null&&(h=a.deletions,h===null?(a.deletions=[t],a.flags|=16):h.push(t)),a.child=s,a.memoizedState=null,s)}function no(t,a){return a=si({mode:"visible",children:a},t.mode),a.return=t,t.child=a}function si(t,a){return t=qa(22,t,null,a),t.lanes=0,t}function ro(t,a,s){return En(a,t.child,null,s),t=no(a,a.pendingProps.children),t.flags|=2,a.memoizedState=null,t}function Um(t,a,s){t.lanes|=a;var n=t.alternate;n!==null&&(n.lanes|=a),yc(t.return,a,s)}function lo(t,a,s,n,o,d){var h=t.memoizedState;h===null?t.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:o,treeForkCount:d}:(h.isBackwards=a,h.rendering=null,h.renderingStartTime=0,h.last=n,h.tail=s,h.tailMode=o,h.treeForkCount=d)}function Hm(t,a,s){var n=a.pendingProps,o=n.revealOrder,d=n.tail;n=n.children;var h=ea.current,b=(h&2)!==0;if(b?(h=h&1|2,a.flags|=128):h&=1,E(ea,h),ga(t,a,n,s),n=_t?qr:0,!b&&t!==null&&(t.flags&128)!==0)e:for(t=a.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Um(t,s,a);else if(t.tag===19)Um(t,s,a);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===a)break e;for(;t.sibling===null;){if(t.return===null||t.return===a)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(o){case"forwards":for(s=a.child,o=null;s!==null;)t=s.alternate,t!==null&&Gl(t)===null&&(o=s),s=s.sibling;s=o,s===null?(o=a.child,a.child=null):(o=s.sibling,s.sibling=null),lo(a,!1,o,s,d,n);break;case"backwards":case"unstable_legacy-backwards":for(s=null,o=a.child,a.child=null;o!==null;){if(t=o.alternate,t!==null&&Gl(t)===null){a.child=o;break}t=o.sibling,o.sibling=s,s=o,o=t}lo(a,!0,s,null,d,n);break;case"together":lo(a,!1,null,null,void 0,n);break;default:a.memoizedState=null}return a.child}function Ns(t,a,s){if(t!==null&&(a.dependencies=t.dependencies),Zs|=a.lanes,(s&a.childLanes)===0)if(t!==null){if(tr(t,a,s,!1),(s&a.childLanes)===0)return null}else return null;if(t!==null&&a.child!==t.child)throw Error(i(153));if(a.child!==null){for(t=a.child,s=xs(t,t.pendingProps),a.child=s,s.return=a;t.sibling!==null;)t=t.sibling,s=s.sibling=xs(t,t.pendingProps),s.return=a;s.sibling=null}return a.child}function io(t,a){return(t.lanes&a)!==0?!0:(t=t.dependencies,!!(t!==null&&Ll(t)))}function kg(t,a,s){switch(a.tag){case 3:ze(a,a.stateNode.containerInfo),$s(a,ra,t.memoizedState.cache),_n();break;case 27:case 5:qe(a);break;case 4:ze(a,a.stateNode.containerInfo);break;case 10:$s(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,Ac(a),null;break;case 13:var n=a.memoizedState;if(n!==null)return n.dehydrated!==null?(Ps(a),a.flags|=128,null):(s&a.child.childLanes)!==0?Lm(t,a,s):(Ps(a),t=Ns(t,a,s),t!==null?t.sibling:null);Ps(a);break;case 19:var o=(t.flags&128)!==0;if(n=(s&a.childLanes)!==0,n||(tr(t,a,s,!1),n=(s&a.childLanes)!==0),o){if(n)return Hm(t,a,s);a.flags|=128}if(o=a.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),E(ea,ea.current),n)break;return null;case 22:return a.lanes=0,Tm(t,a,s,a.pendingProps);case 24:$s(a,ra,t.memoizedState.cache)}return Ns(t,a,s)}function Bm(t,a,s){if(t!==null)if(t.memoizedProps!==a.pendingProps)ia=!0;else{if(!io(t,s)&&(a.flags&128)===0)return ia=!1,kg(t,a,s);ia=(t.flags&131072)!==0}else ia=!1,_t&&(a.flags&1048576)!==0&&ju(a,qr,a.index);switch(a.lanes=0,a.tag){case 16:e:{var n=a.pendingProps;if(t=Cn(a.elementType),a.type=t,typeof t=="function")mc(t)?(n=Mn(t,n),a.tag=1,a=qm(null,a,t,n,s)):(a.tag=0,a=eo(null,a,t,n,s));else{if(t!=null){var o=t.$$typeof;if(o===C){a.tag=11,a=Em(null,a,t,n,s);break e}else if(o===O){a.tag=14,a=Dm(null,a,t,n,s);break e}}throw a=S(t)||t,Error(i(306,a,""))}}return a;case 0:return eo(t,a,a.type,a.pendingProps,s);case 1:return n=a.type,o=Mn(n,a.pendingProps),qm(t,a,n,o,s);case 3:e:{if(ze(a,a.stateNode.containerInfo),t===null)throw Error(i(387));n=a.pendingProps;var d=a.memoizedState;o=d.element,kc(t,a),Vr(a,n,null,s);var h=a.memoizedState;if(n=h.cache,$s(a,ra,n),n!==d.cache&&bc(a,[ra],s,!0),$r(),n=h.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:h.cache},a.updateQueue.baseState=d,a.memoizedState=d,a.flags&256){a=Om(t,a,n,s);break e}else if(n!==o){o=Ya(Error(i(424)),a),Or(o),a=Om(t,a,n,s);break e}else{switch(t=a.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Yt=Ia(t.firstChild),pa=a,_t=!0,Bs=null,Qa=!0,s=Tu(a,null,n,s),a.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(_n(),n===o){a=Ns(t,a,s);break e}ga(t,a,n,s)}a=a.child}return a;case 26:return ai(t,a),t===null?(s=Jh(a.type,null,a.pendingProps,null))?a.memoizedState=s:_t||(s=a.type,t=a.pendingProps,n=vi(Te.current).createElement(s),n[Ke]=a,n[rt]=t,xa(n,s,t),Oe(n),a.stateNode=n):a.memoizedState=Jh(a.type,t.memoizedProps,a.pendingProps,t.memoizedState),null;case 27:return qe(a),t===null&&_t&&(n=a.stateNode=Xh(a.type,a.pendingProps,Te.current),pa=a,Qa=!0,o=Yt,tn(a.type)?(Fo=o,Yt=Ia(n.firstChild)):Yt=o),ga(t,a,a.pendingProps.children,s),ai(t,a),t===null&&(a.flags|=4194304),a.child;case 5:return t===null&&_t&&((o=n=Yt)&&(n=sx(n,a.type,a.pendingProps,Qa),n!==null?(a.stateNode=n,pa=a,Yt=Ia(n.firstChild),Qa=!1,o=!0):o=!1),o||Fs(a)),qe(a),o=a.type,d=a.pendingProps,h=t!==null?t.memoizedProps:null,n=d.children,Oo(o,d)?n=null:h!==null&&Oo(o,h)&&(a.flags|=32),a.memoizedState!==null&&(o=zc(t,a,jg,null,null,s),ol._currentValue=o),ai(t,a),ga(t,a,n,s),a.child;case 6:return t===null&&_t&&((t=s=Yt)&&(s=nx(s,a.pendingProps,Qa),s!==null?(a.stateNode=s,pa=a,Yt=null,t=!0):t=!1),t||Fs(a)),null;case 13:return Lm(t,a,s);case 4:return ze(a,a.stateNode.containerInfo),n=a.pendingProps,t===null?a.child=En(a,null,n,s):ga(t,a,n,s),a.child;case 11:return Em(t,a,a.type,a.pendingProps,s);case 7:return ga(t,a,a.pendingProps,s),a.child;case 8:return ga(t,a,a.pendingProps.children,s),a.child;case 12:return ga(t,a,a.pendingProps.children,s),a.child;case 10:return n=a.pendingProps,$s(a,a.type,n.value),ga(t,a,n.children,s),a.child;case 9:return o=a.type._context,n=a.pendingProps.children,Sn(a),o=fa(o),n=n(o),a.flags|=1,ga(t,a,n,s),a.child;case 14:return Dm(t,a,a.type,a.pendingProps,s);case 15:return Mm(t,a,a.type,a.pendingProps,s);case 19:return Hm(t,a,s);case 31:return Cg(t,a,s);case 22:return Tm(t,a,s,a.pendingProps);case 24:return Sn(a),n=fa(ra),t===null?(o=Sc(),o===null&&(o=Bt,d=_c(),o.pooledCache=d,d.refCount++,d!==null&&(o.pooledCacheLanes|=s),o=d),a.memoizedState={parent:n,cache:o},Cc(a),$s(a,ra,o)):((t.lanes&s)!==0&&(kc(t,a),Vr(a,null,null,s),$r()),o=t.memoizedState,d=a.memoizedState,o.parent!==n?(o={parent:n,cache:n},a.memoizedState=o,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=o),$s(a,ra,n)):(n=d.cache,$s(a,ra,n),n!==o.cache&&bc(a,[ra],s,!0))),ga(t,a,a.pendingProps.children,s),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function Ss(t){t.flags|=4}function co(t,a,s,n,o){if((a=(t.mode&32)!==0)&&(a=!1),a){if(t.flags|=16777216,(o&335544128)===o)if(t.stateNode.complete)t.flags|=8192;else if(hh())t.flags|=8192;else throw kn=Fl,wc}else t.flags&=-16777217}function Fm(t,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!ap(a))if(hh())t.flags|=8192;else throw kn=Fl,wc}function ni(t,a){a!==null&&(t.flags|=4),t.flags&16384&&(a=t.tag!==22?be():536870912,t.lanes|=a,hr|=a)}function Ir(t,a){if(!_t)switch(t.tailMode){case"hidden":a=t.tail;for(var s=null;a!==null;)a.alternate!==null&&(s=a),a=a.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?a||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Gt(t){var a=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(a)for(var o=t.child;o!==null;)s|=o.lanes|o.childLanes,n|=o.subtreeFlags&65011712,n|=o.flags&65011712,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)s|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=n,t.childLanes=s,a}function Eg(t,a,s){var n=a.pendingProps;switch(gc(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gt(a),null;case 1:return Gt(a),null;case 3:return s=a.stateNode,n=null,t!==null&&(n=t.memoizedState.cache),a.memoizedState.cache!==n&&(a.flags|=2048),ys(ra),Re(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(er(a)?Ss(a):t===null||t.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,jc())),Gt(a),null;case 26:var o=a.type,d=a.memoizedState;return t===null?(Ss(a),d!==null?(Gt(a),Fm(a,d)):(Gt(a),co(a,o,null,n,s))):d?d!==t.memoizedState?(Ss(a),Gt(a),Fm(a,d)):(Gt(a),a.flags&=-16777217):(t=t.memoizedProps,t!==n&&Ss(a),Gt(a),co(a,o,t,n,s)),null;case 27:if(Ie(a),s=Te.current,o=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&Ss(a);else{if(!n){if(a.stateNode===null)throw Error(i(166));return Gt(a),null}t=ue.current,er(a)?yu(a):(t=Xh(o,n,s),a.stateNode=t,Ss(a))}return Gt(a),null;case 5:if(Ie(a),o=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&Ss(a);else{if(!n){if(a.stateNode===null)throw Error(i(166));return Gt(a),null}if(d=ue.current,er(a))yu(a);else{var h=vi(Te.current);switch(d){case 1:d=h.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:d=h.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":d=h.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":d=h.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":d=h.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof n.is=="string"?h.createElement("select",{is:n.is}):h.createElement("select"),n.multiple?d.multiple=!0:n.size&&(d.size=n.size);break;default:d=typeof n.is=="string"?h.createElement(o,{is:n.is}):h.createElement(o)}}d[Ke]=a,d[rt]=n;e:for(h=a.child;h!==null;){if(h.tag===5||h.tag===6)d.appendChild(h.stateNode);else if(h.tag!==4&&h.tag!==27&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break e;for(;h.sibling===null;){if(h.return===null||h.return===a)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}a.stateNode=d;e:switch(xa(d,o,n),o){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&Ss(a)}}return Gt(a),co(a,a.type,t===null?null:t.memoizedProps,a.pendingProps,s),null;case 6:if(t&&a.stateNode!=null)t.memoizedProps!==n&&Ss(a);else{if(typeof n!="string"&&a.stateNode===null)throw Error(i(166));if(t=Te.current,er(a)){if(t=a.stateNode,s=a.memoizedProps,n=null,o=pa,o!==null)switch(o.tag){case 27:case 5:n=o.memoizedProps}t[Ke]=a,t=!!(t.nodeValue===s||n!==null&&n.suppressHydrationWarning===!0||Lh(t.nodeValue,s)),t||Fs(a,!0)}else t=vi(t).createTextNode(n),t[Ke]=a,a.stateNode=t}return Gt(a),null;case 31:if(s=a.memoizedState,t===null||t.memoizedState!==null){if(n=er(a),s!==null){if(t===null){if(!n)throw Error(i(318));if(t=a.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(557));t[Ke]=a}else _n(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Gt(a),t=!1}else s=jc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),t=!0;if(!t)return a.flags&256?(La(a),a):(La(a),null);if((a.flags&128)!==0)throw Error(i(558))}return Gt(a),null;case 13:if(n=a.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(o=er(a),n!==null&&n.dehydrated!==null){if(t===null){if(!o)throw Error(i(318));if(o=a.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(i(317));o[Ke]=a}else _n(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Gt(a),o=!1}else o=jc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=o),o=!0;if(!o)return a.flags&256?(La(a),a):(La(a),null)}return La(a),(a.flags&128)!==0?(a.lanes=s,a):(s=n!==null,t=t!==null&&t.memoizedState!==null,s&&(n=a.child,o=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(o=n.alternate.memoizedState.cachePool.pool),d=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(d=n.memoizedState.cachePool.pool),d!==o&&(n.flags|=2048)),s!==t&&s&&(a.child.flags|=8192),ni(a,a.updateQueue),Gt(a),null);case 4:return Re(),t===null&&To(a.stateNode.containerInfo),Gt(a),null;case 10:return ys(a.type),Gt(a),null;case 19:if($(ea),n=a.memoizedState,n===null)return Gt(a),null;if(o=(a.flags&128)!==0,d=n.rendering,d===null)if(o)Ir(n,!1);else{if(Jt!==0||t!==null&&(t.flags&128)!==0)for(t=a.child;t!==null;){if(d=Gl(t),d!==null){for(a.flags|=128,Ir(n,!1),t=d.updateQueue,a.updateQueue=t,ni(a,t),a.subtreeFlags=0,t=s,s=a.child;s!==null;)fu(s,t),s=s.sibling;return E(ea,ea.current&1|2),_t&&js(a,n.treeForkCount),a.child}t=t.sibling}n.tail!==null&&Ye()>oi&&(a.flags|=128,o=!0,Ir(n,!1),a.lanes=4194304)}else{if(!o)if(t=Gl(d),t!==null){if(a.flags|=128,o=!0,t=t.updateQueue,a.updateQueue=t,ni(a,t),Ir(n,!0),n.tail===null&&n.tailMode==="hidden"&&!d.alternate&&!_t)return Gt(a),null}else 2*Ye()-n.renderingStartTime>oi&&s!==536870912&&(a.flags|=128,o=!0,Ir(n,!1),a.lanes=4194304);n.isBackwards?(d.sibling=a.child,a.child=d):(t=n.last,t!==null?t.sibling=d:a.child=d,n.last=d)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=Ye(),t.sibling=null,s=ea.current,E(ea,o?s&1|2:s&1),_t&&js(a,n.treeForkCount),t):(Gt(a),null);case 22:case 23:return La(a),Tc(),n=a.memoizedState!==null,t!==null?t.memoizedState!==null!==n&&(a.flags|=8192):n&&(a.flags|=8192),n?(s&536870912)!==0&&(a.flags&128)===0&&(Gt(a),a.subtreeFlags&6&&(a.flags|=8192)):Gt(a),s=a.updateQueue,s!==null&&ni(a,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),n=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(n=a.memoizedState.cachePool.pool),n!==s&&(a.flags|=2048),t!==null&&$(wn),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),a.memoizedState.cache!==s&&(a.flags|=2048),ys(ra),Gt(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function Dg(t,a){switch(gc(a),a.tag){case 1:return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 3:return ys(ra),Re(),t=a.flags,(t&65536)!==0&&(t&128)===0?(a.flags=t&-65537|128,a):null;case 26:case 27:case 5:return Ie(a),null;case 31:if(a.memoizedState!==null){if(La(a),a.alternate===null)throw Error(i(340));_n()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 13:if(La(a),t=a.memoizedState,t!==null&&t.dehydrated!==null){if(a.alternate===null)throw Error(i(340));_n()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 19:return $(ea),null;case 4:return Re(),null;case 10:return ys(a.type),null;case 22:case 23:return La(a),Tc(),t!==null&&$(wn),t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 24:return ys(ra),null;case 25:return null;default:return null}}function $m(t,a){switch(gc(a),a.tag){case 3:ys(ra),Re();break;case 26:case 27:case 5:Ie(a);break;case 4:Re();break;case 31:a.memoizedState!==null&&La(a);break;case 13:La(a);break;case 19:$(ea);break;case 10:ys(a.type);break;case 22:case 23:La(a),Tc(),t!==null&&$(wn);break;case 24:ys(ra)}}function Zr(t,a){try{var s=a.updateQueue,n=s!==null?s.lastEffect:null;if(n!==null){var o=n.next;s=o;do{if((s.tag&t)===t){n=void 0;var d=s.create,h=s.inst;n=d(),h.destroy=n}s=s.next}while(s!==o)}}catch(b){zt(a,a.return,b)}}function Xs(t,a,s){try{var n=a.updateQueue,o=n!==null?n.lastEffect:null;if(o!==null){var d=o.next;n=d;do{if((n.tag&t)===t){var h=n.inst,b=h.destroy;if(b!==void 0){h.destroy=void 0,o=a;var V=s,oe=b;try{oe()}catch(fe){zt(o,V,fe)}}}n=n.next}while(n!==d)}}catch(fe){zt(a,a.return,fe)}}function Vm(t){var a=t.updateQueue;if(a!==null){var s=t.stateNode;try{Ru(a,s)}catch(n){zt(t,t.return,n)}}}function Ym(t,a,s){s.props=Mn(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(n){zt(t,a,n)}}function Jr(t,a){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var n=t.stateNode;break;case 30:n=t.stateNode;break;default:n=t.stateNode}typeof s=="function"?t.refCleanup=s(n):s.current=n}}catch(o){zt(t,a,o)}}function ds(t,a){var s=t.ref,n=t.refCleanup;if(s!==null)if(typeof n=="function")try{n()}catch(o){zt(t,a,o)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(o){zt(t,a,o)}else s.current=null}function Gm(t){var a=t.type,s=t.memoizedProps,n=t.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break e;case"img":s.src?n.src=s.src:s.srcSet&&(n.srcset=s.srcSet)}}catch(o){zt(t,t.return,o)}}function oo(t,a,s){try{var n=t.stateNode;Jg(n,t.type,s,a),n[rt]=a}catch(o){zt(t,t.return,o)}}function Pm(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&tn(t.type)||t.tag===4}function uo(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Pm(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&tn(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function mo(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,a):(a=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,a.appendChild(t),s=s._reactRootContainer,s!=null||a.onclick!==null||(a.onclick=fs));else if(n!==4&&(n===27&&tn(t.type)&&(s=t.stateNode,a=null),t=t.child,t!==null))for(mo(t,a,s),t=t.sibling;t!==null;)mo(t,a,s),t=t.sibling}function ri(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?s.insertBefore(t,a):s.appendChild(t);else if(n!==4&&(n===27&&tn(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(ri(t,a,s),t=t.sibling;t!==null;)ri(t,a,s),t=t.sibling}function Qm(t){var a=t.stateNode,s=t.memoizedProps;try{for(var n=t.type,o=a.attributes;o.length;)a.removeAttributeNode(o[0]);xa(a,n,s),a[Ke]=t,a[rt]=s}catch(d){zt(t,t.return,d)}}var ws=!1,ca=!1,ho=!1,Xm=typeof WeakSet=="function"?WeakSet:Set,ha=null;function Mg(t,a){if(t=t.containerInfo,zo=Ci,t=lu(t),rc(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var o=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var h=0,b=-1,V=-1,oe=0,fe=0,ve=t,de=null;t:for(;;){for(var he;ve!==s||o!==0&&ve.nodeType!==3||(b=h+o),ve!==d||n!==0&&ve.nodeType!==3||(V=h+n),ve.nodeType===3&&(h+=ve.nodeValue.length),(he=ve.firstChild)!==null;)de=ve,ve=he;for(;;){if(ve===t)break t;if(de===s&&++oe===o&&(b=h),de===d&&++fe===n&&(V=h),(he=ve.nextSibling)!==null)break;ve=de,de=ve.parentNode}ve=he}s=b===-1||V===-1?null:{start:b,end:V}}else s=null}s=s||{start:0,end:0}}else s=null;for(qo={focusedElem:t,selectionRange:s},Ci=!1,ha=a;ha!==null;)if(a=ha,t=a.child,(a.subtreeFlags&1028)!==0&&t!==null)t.return=a,ha=t;else for(;ha!==null;){switch(a=ha,d=a.alternate,t=a.flags,a.tag){case 0:if((t&4)!==0&&(t=a.updateQueue,t=t!==null?t.events:null,t!==null))for(s=0;s<t.length;s++)o=t[s],o.ref.impl=o.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&d!==null){t=void 0,s=a,o=d.memoizedProps,d=d.memoizedState,n=s.stateNode;try{var $e=Mn(s.type,o);t=n.getSnapshotBeforeUpdate($e,d),n.__reactInternalSnapshotBeforeUpdate=t}catch(tt){zt(s,s.return,tt)}}break;case 3:if((t&1024)!==0){if(t=a.stateNode.containerInfo,s=t.nodeType,s===9)Uo(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Uo(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(i(163))}if(t=a.sibling,t!==null){t.return=a.return,ha=t;break}ha=a.return}}function Im(t,a,s){var n=s.flags;switch(s.tag){case 0:case 11:case 15:ks(t,s),n&4&&Zr(5,s);break;case 1:if(ks(t,s),n&4)if(t=s.stateNode,a===null)try{t.componentDidMount()}catch(h){zt(s,s.return,h)}else{var o=Mn(s.type,a.memoizedProps);a=a.memoizedState;try{t.componentDidUpdate(o,a,t.__reactInternalSnapshotBeforeUpdate)}catch(h){zt(s,s.return,h)}}n&64&&Vm(s),n&512&&Jr(s,s.return);break;case 3:if(ks(t,s),n&64&&(t=s.updateQueue,t!==null)){if(a=null,s.child!==null)switch(s.child.tag){case 27:case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}try{Ru(t,a)}catch(h){zt(s,s.return,h)}}break;case 27:a===null&&n&4&&Qm(s);case 26:case 5:ks(t,s),a===null&&n&4&&Gm(s),n&512&&Jr(s,s.return);break;case 12:ks(t,s);break;case 31:ks(t,s),n&4&&Wm(t,s);break;case 13:ks(t,s),n&4&&Km(t,s),n&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=Hg.bind(null,s),rx(t,s))));break;case 22:if(n=s.memoizedState!==null||ws,!n){a=a!==null&&a.memoizedState!==null||ca,o=ws;var d=ca;ws=n,(ca=a)&&!d?Es(t,s,(s.subtreeFlags&8772)!==0):ks(t,s),ws=o,ca=d}break;case 30:break;default:ks(t,s)}}function Zm(t){var a=t.alternate;a!==null&&(t.alternate=null,Zm(a)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(a=t.stateNode,a!==null&&_a(a)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Qt=null,Ca=!1;function Cs(t,a,s){for(s=s.child;s!==null;)Jm(t,a,s),s=s.sibling}function Jm(t,a,s){if(Se&&typeof Se.onCommitFiberUnmount=="function")try{Se.onCommitFiberUnmount(Ee,s)}catch{}switch(s.tag){case 26:ca||ds(s,a),Cs(t,a,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:ca||ds(s,a);var n=Qt,o=Ca;tn(s.type)&&(Qt=s.stateNode,Ca=!1),Cs(t,a,s),ll(s.stateNode),Qt=n,Ca=o;break;case 5:ca||ds(s,a);case 6:if(n=Qt,o=Ca,Qt=null,Cs(t,a,s),Qt=n,Ca=o,Qt!==null)if(Ca)try{(Qt.nodeType===9?Qt.body:Qt.nodeName==="HTML"?Qt.ownerDocument.body:Qt).removeChild(s.stateNode)}catch(d){zt(s,a,d)}else try{Qt.removeChild(s.stateNode)}catch(d){zt(s,a,d)}break;case 18:Qt!==null&&(Ca?(t=Qt,Vh(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),br(t)):Vh(Qt,s.stateNode));break;case 4:n=Qt,o=Ca,Qt=s.stateNode.containerInfo,Ca=!0,Cs(t,a,s),Qt=n,Ca=o;break;case 0:case 11:case 14:case 15:Xs(2,s,a),ca||Xs(4,s,a),Cs(t,a,s);break;case 1:ca||(ds(s,a),n=s.stateNode,typeof n.componentWillUnmount=="function"&&Ym(s,a,n)),Cs(t,a,s);break;case 21:Cs(t,a,s);break;case 22:ca=(n=ca)||s.memoizedState!==null,Cs(t,a,s),ca=n;break;default:Cs(t,a,s)}}function Wm(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{br(t)}catch(s){zt(a,a.return,s)}}}function Km(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{br(t)}catch(s){zt(a,a.return,s)}}function Tg(t){switch(t.tag){case 31:case 13:case 19:var a=t.stateNode;return a===null&&(a=t.stateNode=new Xm),a;case 22:return t=t.stateNode,a=t._retryCache,a===null&&(a=t._retryCache=new Xm),a;default:throw Error(i(435,t.tag))}}function li(t,a){var s=Tg(t);a.forEach(function(n){if(!s.has(n)){s.add(n);var o=Bg.bind(null,t,n);n.then(o,o)}})}function ka(t,a){var s=a.deletions;if(s!==null)for(var n=0;n<s.length;n++){var o=s[n],d=t,h=a,b=h;e:for(;b!==null;){switch(b.tag){case 27:if(tn(b.type)){Qt=b.stateNode,Ca=!1;break e}break;case 5:Qt=b.stateNode,Ca=!1;break e;case 3:case 4:Qt=b.stateNode.containerInfo,Ca=!0;break e}b=b.return}if(Qt===null)throw Error(i(160));Jm(d,h,o),Qt=null,Ca=!1,d=o.alternate,d!==null&&(d.return=null),o.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)eh(a,t),a=a.sibling}var ns=null;function eh(t,a){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:ka(a,t),Ea(t),n&4&&(Xs(3,t,t.return),Zr(3,t),Xs(5,t,t.return));break;case 1:ka(a,t),Ea(t),n&512&&(ca||s===null||ds(s,s.return)),n&64&&ws&&(t=t.updateQueue,t!==null&&(n=t.callbacks,n!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?n:s.concat(n))));break;case 26:var o=ns;if(ka(a,t),Ea(t),n&512&&(ca||s===null||ds(s,s.return)),n&4){var d=s!==null?s.memoizedState:null;if(n=t.memoizedState,s===null)if(n===null)if(t.stateNode===null){e:{n=t.type,s=t.memoizedProps,o=o.ownerDocument||o;t:switch(n){case"title":d=o.getElementsByTagName("title")[0],(!d||d[na]||d[Ke]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=o.createElement(n),o.head.insertBefore(d,o.querySelector("head > title"))),xa(d,n,s),d[Ke]=t,Oe(d),n=d;break e;case"link":var h=ep("link","href",o).get(n+(s.href||""));if(h){for(var b=0;b<h.length;b++)if(d=h[b],d.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&d.getAttribute("rel")===(s.rel==null?null:s.rel)&&d.getAttribute("title")===(s.title==null?null:s.title)&&d.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){h.splice(b,1);break t}}d=o.createElement(n),xa(d,n,s),o.head.appendChild(d);break;case"meta":if(h=ep("meta","content",o).get(n+(s.content||""))){for(b=0;b<h.length;b++)if(d=h[b],d.getAttribute("content")===(s.content==null?null:""+s.content)&&d.getAttribute("name")===(s.name==null?null:s.name)&&d.getAttribute("property")===(s.property==null?null:s.property)&&d.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&d.getAttribute("charset")===(s.charSet==null?null:s.charSet)){h.splice(b,1);break t}}d=o.createElement(n),xa(d,n,s),o.head.appendChild(d);break;default:throw Error(i(468,n))}d[Ke]=t,Oe(d),n=d}t.stateNode=n}else tp(o,t.type,t.stateNode);else t.stateNode=Kh(o,n,t.memoizedProps);else d!==n?(d===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):d.count--,n===null?tp(o,t.type,t.stateNode):Kh(o,n,t.memoizedProps)):n===null&&t.stateNode!==null&&oo(t,t.memoizedProps,s.memoizedProps)}break;case 27:ka(a,t),Ea(t),n&512&&(ca||s===null||ds(s,s.return)),s!==null&&n&4&&oo(t,t.memoizedProps,s.memoizedProps);break;case 5:if(ka(a,t),Ea(t),n&512&&(ca||s===null||ds(s,s.return)),t.flags&32){o=t.stateNode;try{Yn(o,"")}catch($e){zt(t,t.return,$e)}}n&4&&t.stateNode!=null&&(o=t.memoizedProps,oo(t,o,s!==null?s.memoizedProps:o)),n&1024&&(ho=!0);break;case 6:if(ka(a,t),Ea(t),n&4){if(t.stateNode===null)throw Error(i(162));n=t.memoizedProps,s=t.stateNode;try{s.nodeValue=n}catch($e){zt(t,t.return,$e)}}break;case 3:if(_i=null,o=ns,ns=yi(a.containerInfo),ka(a,t),ns=o,Ea(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{br(a.containerInfo)}catch($e){zt(t,t.return,$e)}ho&&(ho=!1,th(t));break;case 4:n=ns,ns=yi(t.stateNode.containerInfo),ka(a,t),Ea(t),ns=n;break;case 12:ka(a,t),Ea(t);break;case 31:ka(a,t),Ea(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,li(t,n)));break;case 13:ka(a,t),Ea(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(ci=Ye()),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,li(t,n)));break;case 22:o=t.memoizedState!==null;var V=s!==null&&s.memoizedState!==null,oe=ws,fe=ca;if(ws=oe||o,ca=fe||V,ka(a,t),ca=fe,ws=oe,Ea(t),n&8192)e:for(a=t.stateNode,a._visibility=o?a._visibility&-2:a._visibility|1,o&&(s===null||V||ws||ca||Tn(t)),s=null,a=t;;){if(a.tag===5||a.tag===26){if(s===null){V=s=a;try{if(d=V.stateNode,o)h=d.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none";else{b=V.stateNode;var ve=V.memoizedProps.style,de=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;b.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch($e){zt(V,V.return,$e)}}}else if(a.tag===6){if(s===null){V=a;try{V.stateNode.nodeValue=o?"":V.memoizedProps}catch($e){zt(V,V.return,$e)}}}else if(a.tag===18){if(s===null){V=a;try{var he=V.stateNode;o?Yh(he,!0):Yh(V.stateNode,!1)}catch($e){zt(V,V.return,$e)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===t)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break e;for(;a.sibling===null;){if(a.return===null||a.return===t)break e;s===a&&(s=null),a=a.return}s===a&&(s=null),a.sibling.return=a.return,a=a.sibling}n&4&&(n=t.updateQueue,n!==null&&(s=n.retryQueue,s!==null&&(n.retryQueue=null,li(t,s))));break;case 19:ka(a,t),Ea(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,li(t,n)));break;case 30:break;case 21:break;default:ka(a,t),Ea(t)}}function Ea(t){var a=t.flags;if(a&2){try{for(var s,n=t.return;n!==null;){if(Pm(n)){s=n;break}n=n.return}if(s==null)throw Error(i(160));switch(s.tag){case 27:var o=s.stateNode,d=uo(t);ri(t,d,o);break;case 5:var h=s.stateNode;s.flags&32&&(Yn(h,""),s.flags&=-33);var b=uo(t);ri(t,b,h);break;case 3:case 4:var V=s.stateNode.containerInfo,oe=uo(t);mo(t,oe,V);break;default:throw Error(i(161))}}catch(fe){zt(t,t.return,fe)}t.flags&=-3}a&4096&&(t.flags&=-4097)}function th(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var a=t;th(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),t=t.sibling}}function ks(t,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Im(t,a.alternate,a),a=a.sibling}function Tn(t){for(t=t.child;t!==null;){var a=t;switch(a.tag){case 0:case 11:case 14:case 15:Xs(4,a,a.return),Tn(a);break;case 1:ds(a,a.return);var s=a.stateNode;typeof s.componentWillUnmount=="function"&&Ym(a,a.return,s),Tn(a);break;case 27:ll(a.stateNode);case 26:case 5:ds(a,a.return),Tn(a);break;case 22:a.memoizedState===null&&Tn(a);break;case 30:Tn(a);break;default:Tn(a)}t=t.sibling}}function Es(t,a,s){for(s=s&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var n=a.alternate,o=t,d=a,h=d.flags;switch(d.tag){case 0:case 11:case 15:Es(o,d,s),Zr(4,d);break;case 1:if(Es(o,d,s),n=d,o=n.stateNode,typeof o.componentDidMount=="function")try{o.componentDidMount()}catch(oe){zt(n,n.return,oe)}if(n=d,o=n.updateQueue,o!==null){var b=n.stateNode;try{var V=o.shared.hiddenCallbacks;if(V!==null)for(o.shared.hiddenCallbacks=null,o=0;o<V.length;o++)Au(V[o],b)}catch(oe){zt(n,n.return,oe)}}s&&h&64&&Vm(d),Jr(d,d.return);break;case 27:Qm(d);case 26:case 5:Es(o,d,s),s&&n===null&&h&4&&Gm(d),Jr(d,d.return);break;case 12:Es(o,d,s);break;case 31:Es(o,d,s),s&&h&4&&Wm(o,d);break;case 13:Es(o,d,s),s&&h&4&&Km(o,d);break;case 22:d.memoizedState===null&&Es(o,d,s),Jr(d,d.return);break;case 30:break;default:Es(o,d,s)}a=a.sibling}}function po(t,a){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(t=a.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&Lr(s))}function fo(t,a){t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&Lr(t))}function rs(t,a,s,n){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)ah(t,a,s,n),a=a.sibling}function ah(t,a,s,n){var o=a.flags;switch(a.tag){case 0:case 11:case 15:rs(t,a,s,n),o&2048&&Zr(9,a);break;case 1:rs(t,a,s,n);break;case 3:rs(t,a,s,n),o&2048&&(t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&Lr(t)));break;case 12:if(o&2048){rs(t,a,s,n),t=a.stateNode;try{var d=a.memoizedProps,h=d.id,b=d.onPostCommit;typeof b=="function"&&b(h,a.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(V){zt(a,a.return,V)}}else rs(t,a,s,n);break;case 31:rs(t,a,s,n);break;case 13:rs(t,a,s,n);break;case 23:break;case 22:d=a.stateNode,h=a.alternate,a.memoizedState!==null?d._visibility&2?rs(t,a,s,n):Wr(t,a):d._visibility&2?rs(t,a,s,n):(d._visibility|=2,dr(t,a,s,n,(a.subtreeFlags&10256)!==0||!1)),o&2048&&po(h,a);break;case 24:rs(t,a,s,n),o&2048&&fo(a.alternate,a);break;default:rs(t,a,s,n)}}function dr(t,a,s,n,o){for(o=o&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var d=t,h=a,b=s,V=n,oe=h.flags;switch(h.tag){case 0:case 11:case 15:dr(d,h,b,V,o),Zr(8,h);break;case 23:break;case 22:var fe=h.stateNode;h.memoizedState!==null?fe._visibility&2?dr(d,h,b,V,o):Wr(d,h):(fe._visibility|=2,dr(d,h,b,V,o)),o&&oe&2048&&po(h.alternate,h);break;case 24:dr(d,h,b,V,o),o&&oe&2048&&fo(h.alternate,h);break;default:dr(d,h,b,V,o)}a=a.sibling}}function Wr(t,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var s=t,n=a,o=n.flags;switch(n.tag){case 22:Wr(s,n),o&2048&&po(n.alternate,n);break;case 24:Wr(s,n),o&2048&&fo(n.alternate,n);break;default:Wr(s,n)}a=a.sibling}}var Kr=8192;function ur(t,a,s){if(t.subtreeFlags&Kr)for(t=t.child;t!==null;)sh(t,a,s),t=t.sibling}function sh(t,a,s){switch(t.tag){case 26:ur(t,a,s),t.flags&Kr&&t.memoizedState!==null&&xx(s,ns,t.memoizedState,t.memoizedProps);break;case 5:ur(t,a,s);break;case 3:case 4:var n=ns;ns=yi(t.stateNode.containerInfo),ur(t,a,s),ns=n;break;case 22:t.memoizedState===null&&(n=t.alternate,n!==null&&n.memoizedState!==null?(n=Kr,Kr=16777216,ur(t,a,s),Kr=n):ur(t,a,s));break;default:ur(t,a,s)}}function nh(t){var a=t.alternate;if(a!==null&&(t=a.child,t!==null)){a.child=null;do a=t.sibling,t.sibling=null,t=a;while(t!==null)}}function el(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];ha=n,lh(n,t)}nh(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)rh(t),t=t.sibling}function rh(t){switch(t.tag){case 0:case 11:case 15:el(t),t.flags&2048&&Xs(9,t,t.return);break;case 3:el(t);break;case 12:el(t);break;case 22:var a=t.stateNode;t.memoizedState!==null&&a._visibility&2&&(t.return===null||t.return.tag!==13)?(a._visibility&=-3,ii(t)):el(t);break;default:el(t)}}function ii(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];ha=n,lh(n,t)}nh(t)}for(t=t.child;t!==null;){switch(a=t,a.tag){case 0:case 11:case 15:Xs(8,a,a.return),ii(a);break;case 22:s=a.stateNode,s._visibility&2&&(s._visibility&=-3,ii(a));break;default:ii(a)}t=t.sibling}}function lh(t,a){for(;ha!==null;){var s=ha;switch(s.tag){case 0:case 11:case 15:Xs(8,s,a);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var n=s.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:Lr(s.memoizedState.cache)}if(n=s.child,n!==null)n.return=s,ha=n;else e:for(s=t;ha!==null;){n=ha;var o=n.sibling,d=n.return;if(Zm(n),n===s){ha=null;break e}if(o!==null){o.return=d,ha=o;break e}ha=d}}}var Ag={getCacheForType:function(t){var a=fa(ra),s=a.data.get(t);return s===void 0&&(s=t(),a.data.set(t,s)),s},cacheSignal:function(){return fa(ra).controller.signal}},Rg=typeof WeakMap=="function"?WeakMap:Map,Tt=0,Bt=null,gt=null,yt=0,Rt=0,Ua=null,Is=!1,mr=!1,go=!1,Ds=0,Jt=0,Zs=0,An=0,xo=0,Ha=0,hr=0,tl=null,Da=null,jo=!1,ci=0,ih=0,oi=1/0,di=null,Js=null,ua=0,Ws=null,pr=null,Ms=0,vo=0,yo=null,ch=null,al=0,bo=null;function Ba(){return(Tt&2)!==0&&yt!==0?yt&-yt:k.T!==null?ko():ft()}function oh(){if(Ha===0)if((yt&536870912)===0||_t){var t=mt;mt<<=1,(mt&3932160)===0&&(mt=262144),Ha=t}else Ha=536870912;return t=Oa.current,t!==null&&(t.flags|=32),Ha}function Ma(t,a,s){(t===Bt&&(Rt===2||Rt===9)||t.cancelPendingCommit!==null)&&(fr(t,0),Ks(t,yt,Ha,!1)),St(t,s),((Tt&2)===0||t!==Bt)&&(t===Bt&&((Tt&2)===0&&(An|=s),Jt===4&&Ks(t,yt,Ha,!1)),us(t))}function dh(t,a,s){if((Tt&6)!==0)throw Error(i(327));var n=!s&&(a&127)===0&&(a&t.expiredLanes)===0||sa(t,a),o=n?Og(t,a):No(t,a,!0),d=n;do{if(o===0){mr&&!n&&Ks(t,a,0,!1);break}else{if(s=t.current.alternate,d&&!zg(s)){o=No(t,a,!1),d=!1;continue}if(o===2){if(d=a,t.errorRecoveryDisabledLanes&d)var h=0;else h=t.pendingLanes&-536870913,h=h!==0?h:h&536870912?536870912:0;if(h!==0){a=h;e:{var b=t;o=tl;var V=b.current.memoizedState.isDehydrated;if(V&&(fr(b,h).flags|=256),h=No(b,h,!1),h!==2){if(go&&!V){b.errorRecoveryDisabledLanes|=d,An|=d,o=4;break e}d=Da,Da=o,d!==null&&(Da===null?Da=d:Da.push.apply(Da,d))}o=h}if(d=!1,o!==2)continue}}if(o===1){fr(t,0),Ks(t,a,0,!0);break}e:{switch(n=t,d=o,d){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:Ks(n,a,Ha,!Is);break e;case 2:Da=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(o=ci+300-Ye(),10<o)){if(Ks(n,a,Ha,!Is),$t(n,0,!0)!==0)break e;Ms=a,n.timeoutHandle=Fh(uh.bind(null,n,s,Da,di,jo,a,Ha,An,hr,Is,d,"Throttled",-0,0),o);break e}uh(n,s,Da,di,jo,a,Ha,An,hr,Is,d,null,-0,0)}}break}while(!0);us(t)}function uh(t,a,s,n,o,d,h,b,V,oe,fe,ve,de,he){if(t.timeoutHandle=-1,ve=a.subtreeFlags,ve&8192||(ve&16785408)===16785408){ve={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:fs},sh(a,d,ve);var $e=(d&62914560)===d?ci-Ye():(d&4194048)===d?ih-Ye():0;if($e=jx(ve,$e),$e!==null){Ms=d,t.cancelPendingCommit=$e(vh.bind(null,t,a,d,s,n,o,h,b,V,fe,ve,null,de,he)),Ks(t,d,h,!oe);return}}vh(t,a,d,s,n,o,h,b,V)}function zg(t){for(var a=t;;){var s=a.tag;if((s===0||s===11||s===15)&&a.flags&16384&&(s=a.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var n=0;n<s.length;n++){var o=s[n],d=o.getSnapshot;o=o.value;try{if(!za(d(),o))return!1}catch{return!1}}if(s=a.child,a.subtreeFlags&16384&&s!==null)s.return=a,a=s;else{if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Ks(t,a,s,n){a&=~xo,a&=~An,t.suspendedLanes|=a,t.pingedLanes&=~a,n&&(t.warmLanes|=a),n=t.expirationTimes;for(var o=a;0<o;){var d=31-ke(o),h=1<<d;n[d]=-1,o&=~h}s!==0&&we(t,s,a)}function ui(){return(Tt&6)===0?(sl(0),!1):!0}function _o(){if(gt!==null){if(Rt===0)var t=gt.return;else t=gt,vs=Nn=null,Lc(t),rr=null,Hr=0,t=gt;for(;t!==null;)$m(t.alternate,t),t=t.return;gt=null}}function fr(t,a){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,ex(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),Ms=0,_o(),Bt=t,gt=s=xs(t.current,null),yt=a,Rt=0,Ua=null,Is=!1,mr=sa(t,a),go=!1,hr=Ha=xo=An=Zs=Jt=0,Da=tl=null,jo=!1,(a&8)!==0&&(a|=a&32);var n=t.entangledLanes;if(n!==0)for(t=t.entanglements,n&=a;0<n;){var o=31-ke(n),d=1<<o;a|=t[o],n&=~d}return Ds=a,Al(),s}function mh(t,a){ot=null,k.H=Qr,a===nr||a===Bl?(a=Eu(),Rt=3):a===wc?(a=Eu(),Rt=4):Rt=a===Kc?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Ua=a,gt===null&&(Jt=1,ei(t,Ya(a,t.current)))}function hh(){var t=Oa.current;return t===null?!0:(yt&4194048)===yt?Xa===null:(yt&62914560)===yt||(yt&536870912)!==0?t===Xa:!1}function ph(){var t=k.H;return k.H=Qr,t===null?Qr:t}function fh(){var t=k.A;return k.A=Ag,t}function mi(){Jt=4,Is||(yt&4194048)!==yt&&Oa.current!==null||(mr=!0),(Zs&134217727)===0&&(An&134217727)===0||Bt===null||Ks(Bt,yt,Ha,!1)}function No(t,a,s){var n=Tt;Tt|=2;var o=ph(),d=fh();(Bt!==t||yt!==a)&&(di=null,fr(t,a)),a=!1;var h=Jt;e:do try{if(Rt!==0&&gt!==null){var b=gt,V=Ua;switch(Rt){case 8:_o(),h=6;break e;case 3:case 2:case 9:case 6:Oa.current===null&&(a=!0);var oe=Rt;if(Rt=0,Ua=null,gr(t,b,V,oe),s&&mr){h=0;break e}break;default:oe=Rt,Rt=0,Ua=null,gr(t,b,V,oe)}}qg(),h=Jt;break}catch(fe){mh(t,fe)}while(!0);return a&&t.shellSuspendCounter++,vs=Nn=null,Tt=n,k.H=o,k.A=d,gt===null&&(Bt=null,yt=0,Al()),h}function qg(){for(;gt!==null;)gh(gt)}function Og(t,a){var s=Tt;Tt|=2;var n=ph(),o=fh();Bt!==t||yt!==a?(di=null,oi=Ye()+500,fr(t,a)):mr=sa(t,a);e:do try{if(Rt!==0&&gt!==null){a=gt;var d=Ua;t:switch(Rt){case 1:Rt=0,Ua=null,gr(t,a,d,1);break;case 2:case 9:if(Cu(d)){Rt=0,Ua=null,xh(a);break}a=function(){Rt!==2&&Rt!==9||Bt!==t||(Rt=7),us(t)},d.then(a,a);break e;case 3:Rt=7;break e;case 4:Rt=5;break e;case 7:Cu(d)?(Rt=0,Ua=null,xh(a)):(Rt=0,Ua=null,gr(t,a,d,7));break;case 5:var h=null;switch(gt.tag){case 26:h=gt.memoizedState;case 5:case 27:var b=gt;if(h?ap(h):b.stateNode.complete){Rt=0,Ua=null;var V=b.sibling;if(V!==null)gt=V;else{var oe=b.return;oe!==null?(gt=oe,hi(oe)):gt=null}break t}}Rt=0,Ua=null,gr(t,a,d,5);break;case 6:Rt=0,Ua=null,gr(t,a,d,6);break;case 8:_o(),Jt=6;break e;default:throw Error(i(462))}}Lg();break}catch(fe){mh(t,fe)}while(!0);return vs=Nn=null,k.H=n,k.A=o,Tt=s,gt!==null?0:(Bt=null,yt=0,Al(),Jt)}function Lg(){for(;gt!==null&&!Le();)gh(gt)}function gh(t){var a=Bm(t.alternate,t,Ds);t.memoizedProps=t.pendingProps,a===null?hi(t):gt=a}function xh(t){var a=t,s=a.alternate;switch(a.tag){case 15:case 0:a=zm(s,a,a.pendingProps,a.type,void 0,yt);break;case 11:a=zm(s,a,a.pendingProps,a.type.render,a.ref,yt);break;case 5:Lc(a);default:$m(s,a),a=gt=fu(a,Ds),a=Bm(s,a,Ds)}t.memoizedProps=t.pendingProps,a===null?hi(t):gt=a}function gr(t,a,s,n){vs=Nn=null,Lc(a),rr=null,Hr=0;var o=a.return;try{if(wg(t,o,a,s,yt)){Jt=1,ei(t,Ya(s,t.current)),gt=null;return}}catch(d){if(o!==null)throw gt=o,d;Jt=1,ei(t,Ya(s,t.current)),gt=null;return}a.flags&32768?(_t||n===1?t=!0:mr||(yt&536870912)!==0?t=!1:(Is=t=!0,(n===2||n===9||n===3||n===6)&&(n=Oa.current,n!==null&&n.tag===13&&(n.flags|=16384))),jh(a,t)):hi(a)}function hi(t){var a=t;do{if((a.flags&32768)!==0){jh(a,Is);return}t=a.return;var s=Eg(a.alternate,a,Ds);if(s!==null){gt=s;return}if(a=a.sibling,a!==null){gt=a;return}gt=a=t}while(a!==null);Jt===0&&(Jt=5)}function jh(t,a){do{var s=Dg(t.alternate,t);if(s!==null){s.flags&=32767,gt=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!a&&(t=t.sibling,t!==null)){gt=t;return}gt=t=s}while(t!==null);Jt=6,gt=null}function vh(t,a,s,n,o,d,h,b,V){t.cancelPendingCommit=null;do pi();while(ua!==0);if((Tt&6)!==0)throw Error(i(327));if(a!==null){if(a===t.current)throw Error(i(177));if(d=a.lanes|a.childLanes,d|=dc,ts(t,s,d,h,b,V),t===Bt&&(gt=Bt=null,yt=0),pr=a,Ws=t,Ms=s,vo=d,yo=o,ch=n,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,Fg(ct,function(){return Sh(),null})):(t.callbackNode=null,t.callbackPriority=0),n=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||n){n=k.T,k.T=null,o=ie.p,ie.p=2,h=Tt,Tt|=4;try{Mg(t,a,s)}finally{Tt=h,ie.p=o,k.T=n}}ua=1,yh(),bh(),_h()}}function yh(){if(ua===1){ua=0;var t=Ws,a=pr,s=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||s){s=k.T,k.T=null;var n=ie.p;ie.p=2;var o=Tt;Tt|=4;try{eh(a,t);var d=qo,h=lu(t.containerInfo),b=d.focusedElem,V=d.selectionRange;if(h!==b&&b&&b.ownerDocument&&ru(b.ownerDocument.documentElement,b)){if(V!==null&&rc(b)){var oe=V.start,fe=V.end;if(fe===void 0&&(fe=oe),"selectionStart"in b)b.selectionStart=oe,b.selectionEnd=Math.min(fe,b.value.length);else{var ve=b.ownerDocument||document,de=ve&&ve.defaultView||window;if(de.getSelection){var he=de.getSelection(),$e=b.textContent.length,tt=Math.min(V.start,$e),Lt=V.end===void 0?tt:Math.min(V.end,$e);!he.extend&&tt>Lt&&(h=Lt,Lt=tt,tt=h);var ne=nu(b,tt),X=nu(b,Lt);if(ne&&X&&(he.rangeCount!==1||he.anchorNode!==ne.node||he.anchorOffset!==ne.offset||he.focusNode!==X.node||he.focusOffset!==X.offset)){var ce=ve.createRange();ce.setStart(ne.node,ne.offset),he.removeAllRanges(),tt>Lt?(he.addRange(ce),he.extend(X.node,X.offset)):(ce.setEnd(X.node,X.offset),he.addRange(ce))}}}}for(ve=[],he=b;he=he.parentNode;)he.nodeType===1&&ve.push({element:he,left:he.scrollLeft,top:he.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<ve.length;b++){var ge=ve[b];ge.element.scrollLeft=ge.left,ge.element.scrollTop=ge.top}}Ci=!!zo,qo=zo=null}finally{Tt=o,ie.p=n,k.T=s}}t.current=a,ua=2}}function bh(){if(ua===2){ua=0;var t=Ws,a=pr,s=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||s){s=k.T,k.T=null;var n=ie.p;ie.p=2;var o=Tt;Tt|=4;try{Im(t,a.alternate,a)}finally{Tt=o,ie.p=n,k.T=s}}ua=3}}function _h(){if(ua===4||ua===3){ua=0,Ve();var t=Ws,a=pr,s=Ms,n=ch;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?ua=5:(ua=0,pr=Ws=null,Nh(t,t.pendingLanes));var o=t.pendingLanes;if(o===0&&(Js=null),ht(s),a=a.stateNode,Se&&typeof Se.onCommitFiberRoot=="function")try{Se.onCommitFiberRoot(Ee,a,void 0,(a.current.flags&128)===128)}catch{}if(n!==null){a=k.T,o=ie.p,ie.p=2,k.T=null;try{for(var d=t.onRecoverableError,h=0;h<n.length;h++){var b=n[h];d(b.value,{componentStack:b.stack})}}finally{k.T=a,ie.p=o}}(Ms&3)!==0&&pi(),us(t),o=t.pendingLanes,(s&261930)!==0&&(o&42)!==0?t===bo?al++:(al=0,bo=t):al=0,sl(0)}}function Nh(t,a){(t.pooledCacheLanes&=a)===0&&(a=t.pooledCache,a!=null&&(t.pooledCache=null,Lr(a)))}function pi(){return yh(),bh(),_h(),Sh()}function Sh(){if(ua!==5)return!1;var t=Ws,a=vo;vo=0;var s=ht(Ms),n=k.T,o=ie.p;try{ie.p=32>s?32:s,k.T=null,s=yo,yo=null;var d=Ws,h=Ms;if(ua=0,pr=Ws=null,Ms=0,(Tt&6)!==0)throw Error(i(331));var b=Tt;if(Tt|=4,rh(d.current),ah(d,d.current,h,s),Tt=b,sl(0,!1),Se&&typeof Se.onPostCommitFiberRoot=="function")try{Se.onPostCommitFiberRoot(Ee,d)}catch{}return!0}finally{ie.p=o,k.T=n,Nh(t,a)}}function wh(t,a,s){a=Ya(s,a),a=Wc(t.stateNode,a,2),t=Gs(t,a,2),t!==null&&(St(t,2),us(t))}function zt(t,a,s){if(t.tag===3)wh(t,t,s);else for(;a!==null;){if(a.tag===3){wh(a,t,s);break}else if(a.tag===1){var n=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Js===null||!Js.has(n))){t=Ya(s,t),s=Cm(2),n=Gs(a,s,2),n!==null&&(km(s,n,a,t),St(n,2),us(n));break}}a=a.return}}function So(t,a,s){var n=t.pingCache;if(n===null){n=t.pingCache=new Rg;var o=new Set;n.set(a,o)}else o=n.get(a),o===void 0&&(o=new Set,n.set(a,o));o.has(s)||(go=!0,o.add(s),t=Ug.bind(null,t,a,s),a.then(t,t))}function Ug(t,a,s){var n=t.pingCache;n!==null&&n.delete(a),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,Bt===t&&(yt&s)===s&&(Jt===4||Jt===3&&(yt&62914560)===yt&&300>Ye()-ci?(Tt&2)===0&&fr(t,0):xo|=s,hr===yt&&(hr=0)),us(t)}function Ch(t,a){a===0&&(a=be()),t=yn(t,a),t!==null&&(St(t,a),us(t))}function Hg(t){var a=t.memoizedState,s=0;a!==null&&(s=a.retryLane),Ch(t,s)}function Bg(t,a){var s=0;switch(t.tag){case 31:case 13:var n=t.stateNode,o=t.memoizedState;o!==null&&(s=o.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(i(314))}n!==null&&n.delete(a),Ch(t,s)}function Fg(t,a){return Ze(t,a)}var fi=null,xr=null,wo=!1,gi=!1,Co=!1,en=0;function us(t){t!==xr&&t.next===null&&(xr===null?fi=xr=t:xr=xr.next=t),gi=!0,wo||(wo=!0,Vg())}function sl(t,a){if(!Co&&gi){Co=!0;do for(var s=!1,n=fi;n!==null;){if(t!==0){var o=n.pendingLanes;if(o===0)var d=0;else{var h=n.suspendedLanes,b=n.pingedLanes;d=(1<<31-ke(42|t)+1)-1,d&=o&~(h&~b),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(s=!0,Mh(n,d))}else d=yt,d=$t(n,n===Bt?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(d&3)===0||sa(n,d)||(s=!0,Mh(n,d));n=n.next}while(s);Co=!1}}function $g(){kh()}function kh(){gi=wo=!1;var t=0;en!==0&&Kg()&&(t=en);for(var a=Ye(),s=null,n=fi;n!==null;){var o=n.next,d=Eh(n,a);d===0?(n.next=null,s===null?fi=o:s.next=o,o===null&&(xr=s)):(s=n,(t!==0||(d&3)!==0)&&(gi=!0)),n=o}ua!==0&&ua!==5||sl(t),en!==0&&(en=0)}function Eh(t,a){for(var s=t.suspendedLanes,n=t.pingedLanes,o=t.expirationTimes,d=t.pendingLanes&-62914561;0<d;){var h=31-ke(d),b=1<<h,V=o[h];V===-1?((b&s)===0||(b&n)!==0)&&(o[h]=Kt(b,a)):V<=a&&(t.expiredLanes|=b),d&=~b}if(a=Bt,s=yt,s=$t(t,t===a?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n=t.callbackNode,s===0||t===a&&(Rt===2||Rt===9)||t.cancelPendingCommit!==null)return n!==null&&n!==null&&Ge(n),t.callbackNode=null,t.callbackPriority=0;if((s&3)===0||sa(t,s)){if(a=s&-s,a===t.callbackPriority)return a;switch(n!==null&&Ge(n),ht(s)){case 2:case 8:s=vt;break;case 32:s=ct;break;case 268435456:s=De;break;default:s=ct}return n=Dh.bind(null,t),s=Ze(s,n),t.callbackPriority=a,t.callbackNode=s,a}return n!==null&&n!==null&&Ge(n),t.callbackPriority=2,t.callbackNode=null,2}function Dh(t,a){if(ua!==0&&ua!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(pi()&&t.callbackNode!==s)return null;var n=yt;return n=$t(t,t===Bt?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n===0?null:(dh(t,n,a),Eh(t,Ye()),t.callbackNode!=null&&t.callbackNode===s?Dh.bind(null,t):null)}function Mh(t,a){if(pi())return null;dh(t,a,!0)}function Vg(){tx(function(){(Tt&6)!==0?Ze(dt,$g):kh()})}function ko(){if(en===0){var t=ar;t===0&&(t=et,et<<=1,(et&261888)===0&&(et=256)),en=t}return en}function Th(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Sl(""+t)}function Ah(t,a){var s=a.ownerDocument.createElement("input");return s.name=a.name,s.value=a.value,t.id&&s.setAttribute("form",t.id),a.parentNode.insertBefore(s,a),t=new FormData(t),s.parentNode.removeChild(s),t}function Yg(t,a,s,n,o){if(a==="submit"&&s&&s.stateNode===o){var d=Th((o[rt]||null).action),h=n.submitter;h&&(a=(a=h[rt]||null)?Th(a.formAction):h.getAttribute("formAction"),a!==null&&(d=a,h=null));var b=new El("action","action",null,n,o);t.push({event:b,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(en!==0){var V=h?Ah(o,h):new FormData(o);Pc(s,{pending:!0,data:V,method:o.method,action:d},null,V)}}else typeof d=="function"&&(b.preventDefault(),V=h?Ah(o,h):new FormData(o),Pc(s,{pending:!0,data:V,method:o.method,action:d},d,V))},currentTarget:o}]})}}for(var Eo=0;Eo<oc.length;Eo++){var Do=oc[Eo],Gg=Do.toLowerCase(),Pg=Do[0].toUpperCase()+Do.slice(1);ss(Gg,"on"+Pg)}ss(ou,"onAnimationEnd"),ss(du,"onAnimationIteration"),ss(uu,"onAnimationStart"),ss("dblclick","onDoubleClick"),ss("focusin","onFocus"),ss("focusout","onBlur"),ss(cg,"onTransitionRun"),ss(og,"onTransitionStart"),ss(dg,"onTransitionCancel"),ss(mu,"onTransitionEnd"),Mt("onMouseEnter",["mouseout","mouseover"]),Mt("onMouseLeave",["mouseout","mouseover"]),Mt("onPointerEnter",["pointerout","pointerover"]),Mt("onPointerLeave",["pointerout","pointerover"]),st("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),st("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),st("onBeforeInput",["compositionend","keypress","textInput","paste"]),st("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),st("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),st("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var nl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(nl));function Rh(t,a){a=(a&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],o=n.event;n=n.listeners;e:{var d=void 0;if(a)for(var h=n.length-1;0<=h;h--){var b=n[h],V=b.instance,oe=b.currentTarget;if(b=b.listener,V!==d&&o.isPropagationStopped())break e;d=b,o.currentTarget=oe;try{d(o)}catch(fe){Tl(fe)}o.currentTarget=null,d=V}else for(h=0;h<n.length;h++){if(b=n[h],V=b.instance,oe=b.currentTarget,b=b.listener,V!==d&&o.isPropagationStopped())break e;d=b,o.currentTarget=oe;try{d(o)}catch(fe){Tl(fe)}o.currentTarget=null,d=V}}}}function xt(t,a){var s=a[da];s===void 0&&(s=a[da]=new Set);var n=t+"__bubble";s.has(n)||(zh(a,t,2,!1),s.add(n))}function Mo(t,a,s){var n=0;a&&(n|=4),zh(s,t,n,a)}var xi="_reactListening"+Math.random().toString(36).slice(2);function To(t){if(!t[xi]){t[xi]=!0,Je.forEach(function(s){s!=="selectionchange"&&(Qg.has(s)||Mo(s,!1,t),Mo(s,!0,t))});var a=t.nodeType===9?t:t.ownerDocument;a===null||a[xi]||(a[xi]=!0,Mo("selectionchange",!1,a))}}function zh(t,a,s,n){switch(op(a)){case 2:var o=bx;break;case 8:o=_x;break;default:o=Po}s=o.bind(null,a,s,t),o=void 0,!Zi||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(o=!0),n?o!==void 0?t.addEventListener(a,s,{capture:!0,passive:o}):t.addEventListener(a,s,!0):o!==void 0?t.addEventListener(a,s,{passive:o}):t.addEventListener(a,s,!1)}function Ao(t,a,s,n,o){var d=n;if((a&1)===0&&(a&2)===0&&n!==null)e:for(;;){if(n===null)return;var h=n.tag;if(h===3||h===4){var b=n.stateNode.containerInfo;if(b===o)break;if(h===4)for(h=n.return;h!==null;){var V=h.tag;if((V===3||V===4)&&h.stateNode.containerInfo===o)return;h=h.return}for(;b!==null;){if(h=N(b),h===null)return;if(V=h.tag,V===5||V===6||V===26||V===27){n=d=h;continue e}b=b.parentNode}}n=n.return}Hd(function(){var oe=d,fe=Xi(s),ve=[];e:{var de=hu.get(t);if(de!==void 0){var he=El,$e=t;switch(t){case"keypress":if(Cl(s)===0)break e;case"keydown":case"keyup":he=Bf;break;case"focusin":$e="focus",he=ec;break;case"focusout":$e="blur",he=ec;break;case"beforeblur":case"afterblur":he=ec;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":he=$d;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":he=Ef;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":he=Vf;break;case ou:case du:case uu:he=Tf;break;case mu:he=Gf;break;case"scroll":case"scrollend":he=Cf;break;case"wheel":he=Qf;break;case"copy":case"cut":case"paste":he=Rf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":he=Yd;break;case"toggle":case"beforetoggle":he=If}var tt=(a&4)!==0,Lt=!tt&&(t==="scroll"||t==="scrollend"),ne=tt?de!==null?de+"Capture":null:de;tt=[];for(var X=oe,ce;X!==null;){var ge=X;if(ce=ge.stateNode,ge=ge.tag,ge!==5&&ge!==26&&ge!==27||ce===null||ne===null||(ge=Cr(X,ne),ge!=null&&tt.push(rl(X,ge,ce))),Lt)break;X=X.return}0<tt.length&&(de=new he(de,$e,null,s,fe),ve.push({event:de,listeners:tt}))}}if((a&7)===0){e:{if(de=t==="mouseover"||t==="pointerover",he=t==="mouseout"||t==="pointerout",de&&s!==Qi&&($e=s.relatedTarget||s.fromElement)&&(N($e)||$e[Vt]))break e;if((he||de)&&(de=fe.window===fe?fe:(de=fe.ownerDocument)?de.defaultView||de.parentWindow:window,he?($e=s.relatedTarget||s.toElement,he=oe,$e=$e?N($e):null,$e!==null&&(Lt=u($e),tt=$e.tag,$e!==Lt||tt!==5&&tt!==27&&tt!==6)&&($e=null)):(he=null,$e=oe),he!==$e)){if(tt=$d,ge="onMouseLeave",ne="onMouseEnter",X="mouse",(t==="pointerout"||t==="pointerover")&&(tt=Yd,ge="onPointerLeave",ne="onPointerEnter",X="pointer"),Lt=he==null?de:xe(he),ce=$e==null?de:xe($e),de=new tt(ge,X+"leave",he,s,fe),de.target=Lt,de.relatedTarget=ce,ge=null,N(fe)===oe&&(tt=new tt(ne,X+"enter",$e,s,fe),tt.target=ce,tt.relatedTarget=Lt,ge=tt),Lt=ge,he&&$e)t:{for(tt=Xg,ne=he,X=$e,ce=0,ge=ne;ge;ge=tt(ge))ce++;ge=0;for(var We=X;We;We=tt(We))ge++;for(;0<ce-ge;)ne=tt(ne),ce--;for(;0<ge-ce;)X=tt(X),ge--;for(;ce--;){if(ne===X||X!==null&&ne===X.alternate){tt=ne;break t}ne=tt(ne),X=tt(X)}tt=null}else tt=null;he!==null&&qh(ve,de,he,tt,!1),$e!==null&&Lt!==null&&qh(ve,Lt,$e,tt,!0)}}e:{if(de=oe?xe(oe):window,he=de.nodeName&&de.nodeName.toLowerCase(),he==="select"||he==="input"&&de.type==="file")var kt=Wd;else if(Zd(de))if(Kd)kt=rg;else{kt=sg;var Pe=ag}else he=de.nodeName,!he||he.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?oe&&Pi(oe.elementType)&&(kt=Wd):kt=ng;if(kt&&(kt=kt(t,oe))){Jd(ve,kt,s,fe);break e}Pe&&Pe(t,de,oe),t==="focusout"&&oe&&de.type==="number"&&oe.memoizedProps.value!=null&&Gi(de,"number",de.value)}switch(Pe=oe?xe(oe):window,t){case"focusin":(Zd(Pe)||Pe.contentEditable==="true")&&(Xn=Pe,lc=oe,zr=null);break;case"focusout":zr=lc=Xn=null;break;case"mousedown":ic=!0;break;case"contextmenu":case"mouseup":case"dragend":ic=!1,iu(ve,s,fe);break;case"selectionchange":if(ig)break;case"keydown":case"keyup":iu(ve,s,fe)}var ut;if(ac)e:{switch(t){case"compositionstart":var bt="onCompositionStart";break e;case"compositionend":bt="onCompositionEnd";break e;case"compositionupdate":bt="onCompositionUpdate";break e}bt=void 0}else Qn?Xd(t,s)&&(bt="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(bt="onCompositionStart");bt&&(Gd&&s.locale!=="ko"&&(Qn||bt!=="onCompositionStart"?bt==="onCompositionEnd"&&Qn&&(ut=Bd()):(Us=fe,Ji="value"in Us?Us.value:Us.textContent,Qn=!0)),Pe=ji(oe,bt),0<Pe.length&&(bt=new Vd(bt,t,null,s,fe),ve.push({event:bt,listeners:Pe}),ut?bt.data=ut:(ut=Id(s),ut!==null&&(bt.data=ut)))),(ut=Jf?Wf(t,s):Kf(t,s))&&(bt=ji(oe,"onBeforeInput"),0<bt.length&&(Pe=new Vd("onBeforeInput","beforeinput",null,s,fe),ve.push({event:Pe,listeners:bt}),Pe.data=ut)),Yg(ve,t,oe,s,fe)}Rh(ve,a)})}function rl(t,a,s){return{instance:t,listener:a,currentTarget:s}}function ji(t,a){for(var s=a+"Capture",n=[];t!==null;){var o=t,d=o.stateNode;if(o=o.tag,o!==5&&o!==26&&o!==27||d===null||(o=Cr(t,s),o!=null&&n.unshift(rl(t,o,d)),o=Cr(t,a),o!=null&&n.push(rl(t,o,d))),t.tag===3)return n;t=t.return}return[]}function Xg(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function qh(t,a,s,n,o){for(var d=a._reactName,h=[];s!==null&&s!==n;){var b=s,V=b.alternate,oe=b.stateNode;if(b=b.tag,V!==null&&V===n)break;b!==5&&b!==26&&b!==27||oe===null||(V=oe,o?(oe=Cr(s,d),oe!=null&&h.unshift(rl(s,oe,V))):o||(oe=Cr(s,d),oe!=null&&h.push(rl(s,oe,V)))),s=s.return}h.length!==0&&t.push({event:a,listeners:h})}var Ig=/\r\n?/g,Zg=/\u0000|\uFFFD/g;function Oh(t){return(typeof t=="string"?t:""+t).replace(Ig,`
`).replace(Zg,"")}function Lh(t,a){return a=Oh(a),Oh(t)===a}function Ot(t,a,s,n,o,d){switch(s){case"children":typeof n=="string"?a==="body"||a==="textarea"&&n===""||Yn(t,n):(typeof n=="number"||typeof n=="bigint")&&a!=="body"&&Yn(t,""+n);break;case"className":$n(t,"class",n);break;case"tabIndex":$n(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":$n(t,s,n);break;case"style":Ld(t,n,d);break;case"data":if(a!=="object"){$n(t,"data",n);break}case"src":case"href":if(n===""&&(a!=="a"||s!=="href")){t.removeAttribute(s);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=Sl(""+n),t.setAttribute(s,n);break;case"action":case"formAction":if(typeof n=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(s==="formAction"?(a!=="input"&&Ot(t,a,"name",o.name,o,null),Ot(t,a,"formEncType",o.formEncType,o,null),Ot(t,a,"formMethod",o.formMethod,o,null),Ot(t,a,"formTarget",o.formTarget,o,null)):(Ot(t,a,"encType",o.encType,o,null),Ot(t,a,"method",o.method,o,null),Ot(t,a,"target",o.target,o,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=Sl(""+n),t.setAttribute(s,n);break;case"onClick":n!=null&&(t.onclick=fs);break;case"onScroll":n!=null&&xt("scroll",t);break;case"onScrollEnd":n!=null&&xt("scrollend",t);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(s=n.__html,s!=null){if(o.children!=null)throw Error(i(60));t.innerHTML=s}}break;case"multiple":t.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":t.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){t.removeAttribute("xlink:href");break}s=Sl(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""+n):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":n===!0?t.setAttribute(s,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,n):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?t.setAttribute(s,n):t.removeAttribute(s);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?t.removeAttribute(s):t.setAttribute(s,n);break;case"popover":xt("beforetoggle",t),xt("toggle",t),gn(t,"popover",n);break;case"xlinkActuate":ma(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":ma(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":ma(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":ma(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":ma(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":ma(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":ma(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":ma(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":ma(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":gn(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=Sf.get(s)||s,gn(t,s,n))}}function Ro(t,a,s,n,o,d){switch(s){case"style":Ld(t,n,d);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(s=n.__html,s!=null){if(o.children!=null)throw Error(i(60));t.innerHTML=s}}break;case"children":typeof n=="string"?Yn(t,n):(typeof n=="number"||typeof n=="bigint")&&Yn(t,""+n);break;case"onScroll":n!=null&&xt("scroll",t);break;case"onScrollEnd":n!=null&&xt("scrollend",t);break;case"onClick":n!=null&&(t.onclick=fs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Be.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(o=s.endsWith("Capture"),a=s.slice(2,o?s.length-7:void 0),d=t[rt]||null,d=d!=null?d[s]:null,typeof d=="function"&&t.removeEventListener(a,d,o),typeof n=="function")){typeof d!="function"&&d!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(a,n,o);break e}s in t?t[s]=n:n===!0?t.setAttribute(s,""):gn(t,s,n)}}}function xa(t,a,s){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":xt("error",t),xt("load",t);var n=!1,o=!1,d;for(d in s)if(s.hasOwnProperty(d)){var h=s[d];if(h!=null)switch(d){case"src":n=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Ot(t,a,d,h,s,null)}}o&&Ot(t,a,"srcSet",s.srcSet,s,null),n&&Ot(t,a,"src",s.src,s,null);return;case"input":xt("invalid",t);var b=d=h=o=null,V=null,oe=null;for(n in s)if(s.hasOwnProperty(n)){var fe=s[n];if(fe!=null)switch(n){case"name":o=fe;break;case"type":h=fe;break;case"checked":V=fe;break;case"defaultChecked":oe=fe;break;case"value":d=fe;break;case"defaultValue":b=fe;break;case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(i(137,a));break;default:Ot(t,a,n,fe,s,null)}}Rd(t,d,b,V,oe,h,o,!1);return;case"select":xt("invalid",t),n=h=d=null;for(o in s)if(s.hasOwnProperty(o)&&(b=s[o],b!=null))switch(o){case"value":d=b;break;case"defaultValue":h=b;break;case"multiple":n=b;default:Ot(t,a,o,b,s,null)}a=d,s=h,t.multiple=!!n,a!=null?Vn(t,!!n,a,!1):s!=null&&Vn(t,!!n,s,!0);return;case"textarea":xt("invalid",t),d=o=n=null;for(h in s)if(s.hasOwnProperty(h)&&(b=s[h],b!=null))switch(h){case"value":n=b;break;case"defaultValue":o=b;break;case"children":d=b;break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(i(91));break;default:Ot(t,a,h,b,s,null)}qd(t,n,o,d);return;case"option":for(V in s)if(s.hasOwnProperty(V)&&(n=s[V],n!=null))switch(V){case"selected":t.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:Ot(t,a,V,n,s,null)}return;case"dialog":xt("beforetoggle",t),xt("toggle",t),xt("cancel",t),xt("close",t);break;case"iframe":case"object":xt("load",t);break;case"video":case"audio":for(n=0;n<nl.length;n++)xt(nl[n],t);break;case"image":xt("error",t),xt("load",t);break;case"details":xt("toggle",t);break;case"embed":case"source":case"link":xt("error",t),xt("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(oe in s)if(s.hasOwnProperty(oe)&&(n=s[oe],n!=null))switch(oe){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Ot(t,a,oe,n,s,null)}return;default:if(Pi(a)){for(fe in s)s.hasOwnProperty(fe)&&(n=s[fe],n!==void 0&&Ro(t,a,fe,n,s,void 0));return}}for(b in s)s.hasOwnProperty(b)&&(n=s[b],n!=null&&Ot(t,a,b,n,s,null))}function Jg(t,a,s,n){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,d=null,h=null,b=null,V=null,oe=null,fe=null;for(he in s){var ve=s[he];if(s.hasOwnProperty(he)&&ve!=null)switch(he){case"checked":break;case"value":break;case"defaultValue":V=ve;default:n.hasOwnProperty(he)||Ot(t,a,he,null,n,ve)}}for(var de in n){var he=n[de];if(ve=s[de],n.hasOwnProperty(de)&&(he!=null||ve!=null))switch(de){case"type":d=he;break;case"name":o=he;break;case"checked":oe=he;break;case"defaultChecked":fe=he;break;case"value":h=he;break;case"defaultValue":b=he;break;case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(i(137,a));break;default:he!==ve&&Ot(t,a,de,he,n,ve)}}Yi(t,h,b,V,oe,fe,d,o);return;case"select":he=h=b=de=null;for(d in s)if(V=s[d],s.hasOwnProperty(d)&&V!=null)switch(d){case"value":break;case"multiple":he=V;default:n.hasOwnProperty(d)||Ot(t,a,d,null,n,V)}for(o in n)if(d=n[o],V=s[o],n.hasOwnProperty(o)&&(d!=null||V!=null))switch(o){case"value":de=d;break;case"defaultValue":b=d;break;case"multiple":h=d;default:d!==V&&Ot(t,a,o,d,n,V)}a=b,s=h,n=he,de!=null?Vn(t,!!s,de,!1):!!n!=!!s&&(a!=null?Vn(t,!!s,a,!0):Vn(t,!!s,s?[]:"",!1));return;case"textarea":he=de=null;for(b in s)if(o=s[b],s.hasOwnProperty(b)&&o!=null&&!n.hasOwnProperty(b))switch(b){case"value":break;case"children":break;default:Ot(t,a,b,null,n,o)}for(h in n)if(o=n[h],d=s[h],n.hasOwnProperty(h)&&(o!=null||d!=null))switch(h){case"value":de=o;break;case"defaultValue":he=o;break;case"children":break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(i(91));break;default:o!==d&&Ot(t,a,h,o,n,d)}zd(t,de,he);return;case"option":for(var $e in s)if(de=s[$e],s.hasOwnProperty($e)&&de!=null&&!n.hasOwnProperty($e))switch($e){case"selected":t.selected=!1;break;default:Ot(t,a,$e,null,n,de)}for(V in n)if(de=n[V],he=s[V],n.hasOwnProperty(V)&&de!==he&&(de!=null||he!=null))switch(V){case"selected":t.selected=de&&typeof de!="function"&&typeof de!="symbol";break;default:Ot(t,a,V,de,n,he)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var tt in s)de=s[tt],s.hasOwnProperty(tt)&&de!=null&&!n.hasOwnProperty(tt)&&Ot(t,a,tt,null,n,de);for(oe in n)if(de=n[oe],he=s[oe],n.hasOwnProperty(oe)&&de!==he&&(de!=null||he!=null))switch(oe){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(i(137,a));break;default:Ot(t,a,oe,de,n,he)}return;default:if(Pi(a)){for(var Lt in s)de=s[Lt],s.hasOwnProperty(Lt)&&de!==void 0&&!n.hasOwnProperty(Lt)&&Ro(t,a,Lt,void 0,n,de);for(fe in n)de=n[fe],he=s[fe],!n.hasOwnProperty(fe)||de===he||de===void 0&&he===void 0||Ro(t,a,fe,de,n,he);return}}for(var ne in s)de=s[ne],s.hasOwnProperty(ne)&&de!=null&&!n.hasOwnProperty(ne)&&Ot(t,a,ne,null,n,de);for(ve in n)de=n[ve],he=s[ve],!n.hasOwnProperty(ve)||de===he||de==null&&he==null||Ot(t,a,ve,de,n,he)}function Uh(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Wg(){if(typeof performance.getEntriesByType=="function"){for(var t=0,a=0,s=performance.getEntriesByType("resource"),n=0;n<s.length;n++){var o=s[n],d=o.transferSize,h=o.initiatorType,b=o.duration;if(d&&b&&Uh(h)){for(h=0,b=o.responseEnd,n+=1;n<s.length;n++){var V=s[n],oe=V.startTime;if(oe>b)break;var fe=V.transferSize,ve=V.initiatorType;fe&&Uh(ve)&&(V=V.responseEnd,h+=fe*(V<b?1:(b-oe)/(V-oe)))}if(--n,a+=8*(d+h)/(o.duration/1e3),t++,10<t)break}}if(0<t)return a/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var zo=null,qo=null;function vi(t){return t.nodeType===9?t:t.ownerDocument}function Hh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Bh(t,a){if(t===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&a==="foreignObject"?0:t}function Oo(t,a){return t==="textarea"||t==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Lo=null;function Kg(){var t=window.event;return t&&t.type==="popstate"?t===Lo?!1:(Lo=t,!0):(Lo=null,!1)}var Fh=typeof setTimeout=="function"?setTimeout:void 0,ex=typeof clearTimeout=="function"?clearTimeout:void 0,$h=typeof Promise=="function"?Promise:void 0,tx=typeof queueMicrotask=="function"?queueMicrotask:typeof $h<"u"?function(t){return $h.resolve(null).then(t).catch(ax)}:Fh;function ax(t){setTimeout(function(){throw t})}function tn(t){return t==="head"}function Vh(t,a){var s=a,n=0;do{var o=s.nextSibling;if(t.removeChild(s),o&&o.nodeType===8)if(s=o.data,s==="/$"||s==="/&"){if(n===0){t.removeChild(o),br(a);return}n--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")n++;else if(s==="html")ll(t.ownerDocument.documentElement);else if(s==="head"){s=t.ownerDocument.head,ll(s);for(var d=s.firstChild;d;){var h=d.nextSibling,b=d.nodeName;d[na]||b==="SCRIPT"||b==="STYLE"||b==="LINK"&&d.rel.toLowerCase()==="stylesheet"||s.removeChild(d),d=h}}else s==="body"&&ll(t.ownerDocument.body);s=o}while(s);br(a)}function Yh(t,a){var s=t;t=0;do{var n=s.nextSibling;if(s.nodeType===1?a?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(a?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),n&&n.nodeType===8)if(s=n.data,s==="/$"){if(t===0)break;t--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||t++;s=n}while(s)}function Uo(t){var a=t.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var s=a;switch(a=a.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":Uo(s),_a(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function sx(t,a,s,n){for(;t.nodeType===1;){var o=s;if(t.nodeName.toLowerCase()!==a.toLowerCase()){if(!n&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(n){if(!t[na])switch(a){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(d=t.getAttribute("rel"),d==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(d!==o.rel||t.getAttribute("href")!==(o.href==null||o.href===""?null:o.href)||t.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin)||t.getAttribute("title")!==(o.title==null?null:o.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(d=t.getAttribute("src"),(d!==(o.src==null?null:o.src)||t.getAttribute("type")!==(o.type==null?null:o.type)||t.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin))&&d&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(a==="input"&&t.type==="hidden"){var d=o.name==null?null:""+o.name;if(o.type==="hidden"&&t.getAttribute("name")===d)return t}else return t;if(t=Ia(t.nextSibling),t===null)break}return null}function nx(t,a,s){if(a==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=Ia(t.nextSibling),t===null))return null;return t}function Gh(t,a){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!a||(t=Ia(t.nextSibling),t===null))return null;return t}function Ho(t){return t.data==="$?"||t.data==="$~"}function Bo(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function rx(t,a){var s=t.ownerDocument;if(t.data==="$~")t._reactRetry=a;else if(t.data!=="$?"||s.readyState!=="loading")a();else{var n=function(){a(),s.removeEventListener("DOMContentLoaded",n)};s.addEventListener("DOMContentLoaded",n),t._reactRetry=n}}function Ia(t){for(;t!=null;t=t.nextSibling){var a=t.nodeType;if(a===1||a===3)break;if(a===8){if(a=t.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return t}var Fo=null;function Ph(t){t=t.nextSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"||s==="/&"){if(a===0)return Ia(t.nextSibling);a--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||a++}t=t.nextSibling}return null}function Qh(t){t=t.previousSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(a===0)return t;a--}else s!=="/$"&&s!=="/&"||a++}t=t.previousSibling}return null}function Xh(t,a,s){switch(a=vi(s),t){case"html":if(t=a.documentElement,!t)throw Error(i(452));return t;case"head":if(t=a.head,!t)throw Error(i(453));return t;case"body":if(t=a.body,!t)throw Error(i(454));return t;default:throw Error(i(451))}}function ll(t){for(var a=t.attributes;a.length;)t.removeAttributeNode(a[0]);_a(t)}var Za=new Map,Ih=new Set;function yi(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Ts=ie.d;ie.d={f:lx,r:ix,D:cx,C:ox,L:dx,m:ux,X:hx,S:mx,M:px};function lx(){var t=Ts.f(),a=ui();return t||a}function ix(t){var a=ae(t);a!==null&&a.tag===5&&a.type==="form"?mm(a):Ts.r(t)}var jr=typeof document>"u"?null:document;function Zh(t,a,s){var n=jr;if(n&&typeof a=="string"&&a){var o=$a(a);o='link[rel="'+t+'"][href="'+o+'"]',typeof s=="string"&&(o+='[crossorigin="'+s+'"]'),Ih.has(o)||(Ih.add(o),t={rel:t,crossOrigin:s,href:a},n.querySelector(o)===null&&(a=n.createElement("link"),xa(a,"link",t),Oe(a),n.head.appendChild(a)))}}function cx(t){Ts.D(t),Zh("dns-prefetch",t,null)}function ox(t,a){Ts.C(t,a),Zh("preconnect",t,a)}function dx(t,a,s){Ts.L(t,a,s);var n=jr;if(n&&t&&a){var o='link[rel="preload"][as="'+$a(a)+'"]';a==="image"&&s&&s.imageSrcSet?(o+='[imagesrcset="'+$a(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(o+='[imagesizes="'+$a(s.imageSizes)+'"]')):o+='[href="'+$a(t)+'"]';var d=o;switch(a){case"style":d=vr(t);break;case"script":d=yr(t)}Za.has(d)||(t=R({rel:"preload",href:a==="image"&&s&&s.imageSrcSet?void 0:t,as:a},s),Za.set(d,t),n.querySelector(o)!==null||a==="style"&&n.querySelector(il(d))||a==="script"&&n.querySelector(cl(d))||(a=n.createElement("link"),xa(a,"link",t),Oe(a),n.head.appendChild(a)))}}function ux(t,a){Ts.m(t,a);var s=jr;if(s&&t){var n=a&&typeof a.as=="string"?a.as:"script",o='link[rel="modulepreload"][as="'+$a(n)+'"][href="'+$a(t)+'"]',d=o;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=yr(t)}if(!Za.has(d)&&(t=R({rel:"modulepreload",href:t},a),Za.set(d,t),s.querySelector(o)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(cl(d)))return}n=s.createElement("link"),xa(n,"link",t),Oe(n),s.head.appendChild(n)}}}function mx(t,a,s){Ts.S(t,a,s);var n=jr;if(n&&t){var o=me(n).hoistableStyles,d=vr(t);a=a||"default";var h=o.get(d);if(!h){var b={loading:0,preload:null};if(h=n.querySelector(il(d)))b.loading=5;else{t=R({rel:"stylesheet",href:t,"data-precedence":a},s),(s=Za.get(d))&&$o(t,s);var V=h=n.createElement("link");Oe(V),xa(V,"link",t),V._p=new Promise(function(oe,fe){V.onload=oe,V.onerror=fe}),V.addEventListener("load",function(){b.loading|=1}),V.addEventListener("error",function(){b.loading|=2}),b.loading|=4,bi(h,a,n)}h={type:"stylesheet",instance:h,count:1,state:b},o.set(d,h)}}}function hx(t,a){Ts.X(t,a);var s=jr;if(s&&t){var n=me(s).hoistableScripts,o=yr(t),d=n.get(o);d||(d=s.querySelector(cl(o)),d||(t=R({src:t,async:!0},a),(a=Za.get(o))&&Vo(t,a),d=s.createElement("script"),Oe(d),xa(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(o,d))}}function px(t,a){Ts.M(t,a);var s=jr;if(s&&t){var n=me(s).hoistableScripts,o=yr(t),d=n.get(o);d||(d=s.querySelector(cl(o)),d||(t=R({src:t,async:!0,type:"module"},a),(a=Za.get(o))&&Vo(t,a),d=s.createElement("script"),Oe(d),xa(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(o,d))}}function Jh(t,a,s,n){var o=(o=Te.current)?yi(o):null;if(!o)throw Error(i(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(a=vr(s.href),s=me(o).hoistableStyles,n=s.get(a),n||(n={type:"style",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=vr(s.href);var d=me(o).hoistableStyles,h=d.get(t);if(h||(o=o.ownerDocument||o,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(t,h),(d=o.querySelector(il(t)))&&!d._p&&(h.instance=d,h.state.loading=5),Za.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},Za.set(t,s),d||fx(o,t,s,h.state))),a&&n===null)throw Error(i(528,""));return h}if(a&&n!==null)throw Error(i(529,""));return null;case"script":return a=s.async,s=s.src,typeof s=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=yr(s),s=me(o).hoistableScripts,n=s.get(a),n||(n={type:"script",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,t))}}function vr(t){return'href="'+$a(t)+'"'}function il(t){return'link[rel="stylesheet"]['+t+"]"}function Wh(t){return R({},t,{"data-precedence":t.precedence,precedence:null})}function fx(t,a,s,n){t.querySelector('link[rel="preload"][as="style"]['+a+"]")?n.loading=1:(a=t.createElement("link"),n.preload=a,a.addEventListener("load",function(){return n.loading|=1}),a.addEventListener("error",function(){return n.loading|=2}),xa(a,"link",s),Oe(a),t.head.appendChild(a))}function yr(t){return'[src="'+$a(t)+'"]'}function cl(t){return"script[async]"+t}function Kh(t,a,s){if(a.count++,a.instance===null)switch(a.type){case"style":var n=t.querySelector('style[data-href~="'+$a(s.href)+'"]');if(n)return a.instance=n,Oe(n),n;var o=R({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return n=(t.ownerDocument||t).createElement("style"),Oe(n),xa(n,"style",o),bi(n,s.precedence,t),a.instance=n;case"stylesheet":o=vr(s.href);var d=t.querySelector(il(o));if(d)return a.state.loading|=4,a.instance=d,Oe(d),d;n=Wh(s),(o=Za.get(o))&&$o(n,o),d=(t.ownerDocument||t).createElement("link"),Oe(d);var h=d;return h._p=new Promise(function(b,V){h.onload=b,h.onerror=V}),xa(d,"link",n),a.state.loading|=4,bi(d,s.precedence,t),a.instance=d;case"script":return d=yr(s.src),(o=t.querySelector(cl(d)))?(a.instance=o,Oe(o),o):(n=s,(o=Za.get(d))&&(n=R({},s),Vo(n,o)),t=t.ownerDocument||t,o=t.createElement("script"),Oe(o),xa(o,"link",n),t.head.appendChild(o),a.instance=o);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(n=a.instance,a.state.loading|=4,bi(n,s.precedence,t));return a.instance}function bi(t,a,s){for(var n=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=n.length?n[n.length-1]:null,d=o,h=0;h<n.length;h++){var b=n[h];if(b.dataset.precedence===a)d=b;else if(d!==o)break}d?d.parentNode.insertBefore(t,d.nextSibling):(a=s.nodeType===9?s.head:s,a.insertBefore(t,a.firstChild))}function $o(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.title==null&&(t.title=a.title)}function Vo(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.integrity==null&&(t.integrity=a.integrity)}var _i=null;function ep(t,a,s){if(_i===null){var n=new Map,o=_i=new Map;o.set(s,n)}else o=_i,n=o.get(s),n||(n=new Map,o.set(s,n));if(n.has(t))return n;for(n.set(t,null),s=s.getElementsByTagName(t),o=0;o<s.length;o++){var d=s[o];if(!(d[na]||d[Ke]||t==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var h=d.getAttribute(a)||"";h=t+h;var b=n.get(h);b?b.push(d):n.set(h,[d])}}return n}function tp(t,a,s){t=t.ownerDocument||t,t.head.insertBefore(s,a==="title"?t.querySelector("head > title"):null)}function gx(t,a,s){if(s===1||a.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return t=a.disabled,typeof a.precedence=="string"&&t==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function ap(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function xx(t,a,s,n){if(s.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var o=vr(n.href),d=a.querySelector(il(o));if(d){a=d._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(t.count++,t=Ni.bind(t),a.then(t,t)),s.state.loading|=4,s.instance=d,Oe(d);return}d=a.ownerDocument||a,n=Wh(n),(o=Za.get(o))&&$o(n,o),d=d.createElement("link"),Oe(d);var h=d;h._p=new Promise(function(b,V){h.onload=b,h.onerror=V}),xa(d,"link",n),s.instance=d}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(s,a),(a=s.state.preload)&&(s.state.loading&3)===0&&(t.count++,s=Ni.bind(t),a.addEventListener("load",s),a.addEventListener("error",s))}}var Yo=0;function jx(t,a){return t.stylesheets&&t.count===0&&wi(t,t.stylesheets),0<t.count||0<t.imgCount?function(s){var n=setTimeout(function(){if(t.stylesheets&&wi(t,t.stylesheets),t.unsuspend){var d=t.unsuspend;t.unsuspend=null,d()}},6e4+a);0<t.imgBytes&&Yo===0&&(Yo=62500*Wg());var o=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&wi(t,t.stylesheets),t.unsuspend)){var d=t.unsuspend;t.unsuspend=null,d()}},(t.imgBytes>Yo?50:800)+a);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(n),clearTimeout(o)}}:null}function Ni(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)wi(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Si=null;function wi(t,a){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Si=new Map,a.forEach(vx,t),Si=null,Ni.call(t))}function vx(t,a){if(!(a.state.loading&4)){var s=Si.get(t);if(s)var n=s.get(null);else{s=new Map,Si.set(t,s);for(var o=t.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<o.length;d++){var h=o[d];(h.nodeName==="LINK"||h.getAttribute("media")!=="not all")&&(s.set(h.dataset.precedence,h),n=h)}n&&s.set(null,n)}o=a.instance,h=o.getAttribute("data-precedence"),d=s.get(h)||n,d===n&&s.set(null,o),s.set(h,o),this.count++,n=Ni.bind(this),o.addEventListener("load",n),o.addEventListener("error",n),d?d.parentNode.insertBefore(o,d.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(o,t.firstChild)),a.state.loading|=4}}var ol={$$typeof:T,Provider:null,Consumer:null,_currentValue:M,_currentValue2:M,_threadCount:0};function yx(t,a,s,n,o,d,h,b,V){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Dt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dt(0),this.hiddenUpdates=Dt(null),this.identifierPrefix=n,this.onUncaughtError=o,this.onCaughtError=d,this.onRecoverableError=h,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=V,this.incompleteTransitions=new Map}function sp(t,a,s,n,o,d,h,b,V,oe,fe,ve){return t=new yx(t,a,s,h,V,oe,fe,ve,b),a=1,d===!0&&(a|=24),d=qa(3,null,null,a),t.current=d,d.stateNode=t,a=_c(),a.refCount++,t.pooledCache=a,a.refCount++,d.memoizedState={element:n,isDehydrated:s,cache:a},Cc(d),t}function np(t){return t?(t=Jn,t):Jn}function rp(t,a,s,n,o,d){o=np(o),n.context===null?n.context=o:n.pendingContext=o,n=Ys(a),n.payload={element:s},d=d===void 0?null:d,d!==null&&(n.callback=d),s=Gs(t,n,a),s!==null&&(Ma(s,t,a),Fr(s,t,a))}function lp(t,a){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<a?s:a}}function Go(t,a){lp(t,a),(t=t.alternate)&&lp(t,a)}function ip(t){if(t.tag===13||t.tag===31){var a=yn(t,67108864);a!==null&&Ma(a,t,67108864),Go(t,67108864)}}function cp(t){if(t.tag===13||t.tag===31){var a=Ba();a=Xe(a);var s=yn(t,a);s!==null&&Ma(s,t,a),Go(t,a)}}var Ci=!0;function bx(t,a,s,n){var o=k.T;k.T=null;var d=ie.p;try{ie.p=2,Po(t,a,s,n)}finally{ie.p=d,k.T=o}}function _x(t,a,s,n){var o=k.T;k.T=null;var d=ie.p;try{ie.p=8,Po(t,a,s,n)}finally{ie.p=d,k.T=o}}function Po(t,a,s,n){if(Ci){var o=Qo(n);if(o===null)Ao(t,a,n,ki,s),dp(t,n);else if(Sx(o,t,a,s,n))n.stopPropagation();else if(dp(t,n),a&4&&-1<Nx.indexOf(t)){for(;o!==null;){var d=ae(o);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var h=At(d.pendingLanes);if(h!==0){var b=d;for(b.pendingLanes|=2,b.entangledLanes|=2;h;){var V=1<<31-ke(h);b.entanglements[1]|=V,h&=~V}us(d),(Tt&6)===0&&(oi=Ye()+500,sl(0))}}break;case 31:case 13:b=yn(d,2),b!==null&&Ma(b,d,2),ui(),Go(d,2)}if(d=Qo(n),d===null&&Ao(t,a,n,ki,s),d===o)break;o=d}o!==null&&n.stopPropagation()}else Ao(t,a,n,null,s)}}function Qo(t){return t=Xi(t),Xo(t)}var ki=null;function Xo(t){if(ki=null,t=N(t),t!==null){var a=u(t);if(a===null)t=null;else{var s=a.tag;if(s===13){if(t=g(a),t!==null)return t;t=null}else if(s===31){if(t=f(a),t!==null)return t;t=null}else if(s===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;t=null}else a!==t&&(t=null)}}return ki=t,null}function op(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(je()){case dt:return 2;case vt:return 8;case ct:case Pt:return 32;case De:return 268435456;default:return 32}default:return 32}}var Io=!1,an=null,sn=null,nn=null,dl=new Map,ul=new Map,rn=[],Nx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function dp(t,a){switch(t){case"focusin":case"focusout":an=null;break;case"dragenter":case"dragleave":sn=null;break;case"mouseover":case"mouseout":nn=null;break;case"pointerover":case"pointerout":dl.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":ul.delete(a.pointerId)}}function ml(t,a,s,n,o,d){return t===null||t.nativeEvent!==d?(t={blockedOn:a,domEventName:s,eventSystemFlags:n,nativeEvent:d,targetContainers:[o]},a!==null&&(a=ae(a),a!==null&&ip(a)),t):(t.eventSystemFlags|=n,a=t.targetContainers,o!==null&&a.indexOf(o)===-1&&a.push(o),t)}function Sx(t,a,s,n,o){switch(a){case"focusin":return an=ml(an,t,a,s,n,o),!0;case"dragenter":return sn=ml(sn,t,a,s,n,o),!0;case"mouseover":return nn=ml(nn,t,a,s,n,o),!0;case"pointerover":var d=o.pointerId;return dl.set(d,ml(dl.get(d)||null,t,a,s,n,o)),!0;case"gotpointercapture":return d=o.pointerId,ul.set(d,ml(ul.get(d)||null,t,a,s,n,o)),!0}return!1}function up(t){var a=N(t.target);if(a!==null){var s=u(a);if(s!==null){if(a=s.tag,a===13){if(a=g(s),a!==null){t.blockedOn=a,it(t.priority,function(){cp(s)});return}}else if(a===31){if(a=f(s),a!==null){t.blockedOn=a,it(t.priority,function(){cp(s)});return}}else if(a===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ei(t){if(t.blockedOn!==null)return!1;for(var a=t.targetContainers;0<a.length;){var s=Qo(t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);Qi=n,s.target.dispatchEvent(n),Qi=null}else return a=ae(s),a!==null&&ip(a),t.blockedOn=s,!1;a.shift()}return!0}function mp(t,a,s){Ei(t)&&s.delete(a)}function wx(){Io=!1,an!==null&&Ei(an)&&(an=null),sn!==null&&Ei(sn)&&(sn=null),nn!==null&&Ei(nn)&&(nn=null),dl.forEach(mp),ul.forEach(mp)}function Di(t,a){t.blockedOn===a&&(t.blockedOn=null,Io||(Io=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,wx)))}var Mi=null;function hp(t){Mi!==t&&(Mi=t,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Mi===t&&(Mi=null);for(var a=0;a<t.length;a+=3){var s=t[a],n=t[a+1],o=t[a+2];if(typeof n!="function"){if(Xo(n||s)===null)continue;break}var d=ae(s);d!==null&&(t.splice(a,3),a-=3,Pc(d,{pending:!0,data:o,method:s.method,action:n},n,o))}}))}function br(t){function a(V){return Di(V,t)}an!==null&&Di(an,t),sn!==null&&Di(sn,t),nn!==null&&Di(nn,t),dl.forEach(a),ul.forEach(a);for(var s=0;s<rn.length;s++){var n=rn[s];n.blockedOn===t&&(n.blockedOn=null)}for(;0<rn.length&&(s=rn[0],s.blockedOn===null);)up(s),s.blockedOn===null&&rn.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(n=0;n<s.length;n+=3){var o=s[n],d=s[n+1],h=o[rt]||null;if(typeof d=="function")h||hp(s);else if(h){var b=null;if(d&&d.hasAttribute("formAction")){if(o=d,h=d[rt]||null)b=h.formAction;else if(Xo(o)!==null)continue}else b=h.action;typeof b=="function"?s[n+1]=b:(s.splice(n,3),n-=3),hp(s)}}}function pp(){function t(d){d.canIntercept&&d.info==="react-transition"&&d.intercept({handler:function(){return new Promise(function(h){return o=h})},focusReset:"manual",scroll:"manual"})}function a(){o!==null&&(o(),o=null),n||setTimeout(s,20)}function s(){if(!n&&!navigation.transition){var d=navigation.currentEntry;d&&d.url!=null&&navigation.navigate(d.url,{state:d.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,o=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(s,100),function(){n=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),o!==null&&(o(),o=null)}}}function Zo(t){this._internalRoot=t}Ti.prototype.render=Zo.prototype.render=function(t){var a=this._internalRoot;if(a===null)throw Error(i(409));var s=a.current,n=Ba();rp(s,n,t,a,null,null)},Ti.prototype.unmount=Zo.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var a=t.containerInfo;rp(t.current,2,null,t,null,null),ui(),a[Vt]=null}};function Ti(t){this._internalRoot=t}Ti.prototype.unstable_scheduleHydration=function(t){if(t){var a=ft();t={blockedOn:null,target:t,priority:a};for(var s=0;s<rn.length&&a!==0&&a<rn[s].priority;s++);rn.splice(s,0,t),s===0&&up(t)}};var fp=l.version;if(fp!=="19.2.0")throw Error(i(527,fp,"19.2.0"));ie.findDOMNode=function(t){var a=t._reactInternals;if(a===void 0)throw typeof t.render=="function"?Error(i(188)):(t=Object.keys(t).join(","),Error(i(268,t)));return t=v(a),t=t!==null?x(t):null,t=t===null?null:t.stateNode,t};var Cx={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ai=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ai.isDisabled&&Ai.supportsFiber)try{Ee=Ai.inject(Cx),Se=Ai}catch{}}return pl.createRoot=function(t,a){if(!m(t))throw Error(i(299));var s=!1,n="",o=_m,d=Nm,h=Sm;return a!=null&&(a.unstable_strictMode===!0&&(s=!0),a.identifierPrefix!==void 0&&(n=a.identifierPrefix),a.onUncaughtError!==void 0&&(o=a.onUncaughtError),a.onCaughtError!==void 0&&(d=a.onCaughtError),a.onRecoverableError!==void 0&&(h=a.onRecoverableError)),a=sp(t,1,!1,null,null,s,n,null,o,d,h,pp),t[Vt]=a.current,To(t),new Zo(a)},pl.hydrateRoot=function(t,a,s){if(!m(t))throw Error(i(299));var n=!1,o="",d=_m,h=Nm,b=Sm,V=null;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(o=s.identifierPrefix),s.onUncaughtError!==void 0&&(d=s.onUncaughtError),s.onCaughtError!==void 0&&(h=s.onCaughtError),s.onRecoverableError!==void 0&&(b=s.onRecoverableError),s.formState!==void 0&&(V=s.formState)),a=sp(t,1,!0,a,s??null,n,o,V,d,h,b,pp),a.context=np(null),s=a.current,n=Ba(),n=Xe(n),o=Ys(n),o.callback=null,Gs(s,o,n),s=n,a.current.lanes=s,St(a,s),us(a),t[Vt]=a.current,To(t),new Ti(a)},pl.version="19.2.0",pl}var bp;function Ux(){if(bp)return Wo.exports;bp=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(l){console.error(l)}}return r(),Wo.exports=Lx(),Wo.exports}var Hx=Ux();const Bx=Zp(Hx),Fx="fieldsync-offline",$x=1,aa={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let Un=null;const Ls=()=>new Promise((r,l)=>{if(Un){r(Un);return}const c=indexedDB.open(Fx,$x);c.onerror=()=>{console.error("Failed to open offline database"),l(c.error)},c.onsuccess=()=>{Un=c.result,console.log("Offline database initialized"),r(Un)},c.onupgradeneeded=i=>{const m=i.target.result;if(m.objectStoreNames.contains(aa.PROJECTS)||m.createObjectStore(aa.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),m.objectStoreNames.contains(aa.AREAS)||m.createObjectStore(aa.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),m.objectStoreNames.contains(aa.CREW_CHECKINS)||m.createObjectStore(aa.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!m.objectStoreNames.contains(aa.PENDING_ACTIONS)){const u=m.createObjectStore(aa.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});u.createIndex("type","type",{unique:!1}),u.createIndex("created_at","created_at",{unique:!1})}m.objectStoreNames.contains(aa.CACHED_DATA)||m.createObjectStore(aa.CACHED_DATA,{keyPath:"key"})}}),Bn=(r,l="readonly")=>{if(!Un)throw new Error("Database not initialized");return Un.transaction(r,l).objectStore(r)},Vx=async(r,l)=>(await Ls(),new Promise((c,i)=>{const u=Bn(r,"readwrite").put(l);u.onsuccess=()=>c(u.result),u.onerror=()=>i(u.error)})),Jp=async(r,l)=>(await Ls(),new Promise((c,i)=>{const m=Un.transaction(r,"readwrite"),u=m.objectStore(r);l.forEach(g=>u.put(g)),m.oncomplete=()=>c(),m.onerror=()=>i(m.error)})),Yx=async(r,l)=>(await Ls(),new Promise((c,i)=>{const u=Bn(r).get(l);u.onsuccess=()=>c(u.result),u.onerror=()=>i(u.error)})),Wp=async r=>(await Ls(),new Promise((l,c)=>{const m=Bn(r).getAll();m.onsuccess=()=>l(m.result||[]),m.onerror=()=>c(m.error)})),Kp=async(r,l,c)=>(await Ls(),new Promise((i,m)=>{const f=Bn(r).index(l).getAll(c);f.onsuccess=()=>i(f.result||[]),f.onerror=()=>m(f.error)})),Gx=async(r,l)=>(await Ls(),new Promise((c,i)=>{const u=Bn(r,"readwrite").delete(l);u.onsuccess=()=>c(),u.onerror=()=>i(u.error)})),mn={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},_p=async(r,l,c={})=>{await Ls();const i={type:r,payload:l,metadata:c,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((m,u)=>{const f=Bn(aa.PENDING_ACTIONS,"readwrite").add(i);f.onsuccess=()=>{console.log(`Queued offline action: ${r}`),m(f.result)},f.onerror=()=>u(f.error)})},ef=async()=>Wp(aa.PENDING_ACTIONS),td=async()=>(await ef()).length,Px=async r=>Gx(aa.PENDING_ACTIONS,r),Qx=async(r,l)=>(await Ls(),new Promise((c,i)=>{const m=Bn(aa.PENDING_ACTIONS,"readwrite"),u=m.get(r);u.onsuccess=()=>{const g=u.result;if(g){const f={...g,...l},j=m.put(f);j.onsuccess=()=>c(f),j.onerror=()=>i(j.error)}else i(new Error("Action not found"))},u.onerror=()=>i(u.error)})),Xx=async r=>Jp(aa.PROJECTS,r),Np=async r=>r?Kp(aa.PROJECTS,"company_id",r):Wp(aa.PROJECTS),Ix=async r=>Jp(aa.AREAS,r),Sp=async r=>Kp(aa.AREAS,"project_id",r),ad=async(r,l)=>{const c=await Yx(aa.AREAS,r);return c&&(c.status=l,c.updated_at=new Date().toISOString(),await Vx(aa.AREAS,c)),c};let wd=navigator.onLine;const vd=new Set,tf=r=>(vd.add(r),()=>vd.delete(r)),fl=()=>wd,wp=r=>{wd=r,vd.forEach(l=>l(r))};typeof window<"u"&&(window.addEventListener("online",()=>{console.log("Connection restored"),wp(!0)}),window.addEventListener("offline",()=>{console.log("Connection lost"),wp(!1)}));let sd=!1;const Zx=async r=>{if(sd||!wd)return{synced:0,failed:0};sd=!0;const l={synced:0,failed:0};try{const c=await ef();console.log(`Syncing ${c.length} pending actions...`);for(const i of c)try{await Jx(i,r),await Px(i.id),l.synced++,console.log(`Synced action: ${i.type}`)}catch(m){console.error(`Failed to sync action ${i.type}:`,m),l.failed++,await Qx(i.id,{attempts:(i.attempts||0)+1,last_error:m.message,last_attempt:new Date().toISOString()})}}finally{sd=!1}return l},Jx=async(r,l)=>{const{type:c,payload:i}=r;switch(c){case mn.UPDATE_AREA_STATUS:return l.updateAreaStatus(i.areaId,i.status);case mn.CREATE_TM_TICKET:const m=await l.createTMTicket(i.ticket);return i.workers?.length>0&&await l.addTMWorkers(m.id,i.workers),i.items?.length>0&&await l.addTMItems(m.id,i.items),m;case mn.SAVE_CREW_CHECKIN:return l.saveCrewCheckin(i.projectId,i.workers,i.checkInDate);case mn.SUBMIT_DAILY_REPORT:return await l.saveDailyReport(i.projectId,i.reportData),l.submitDailyReport(i.projectId,i.submittedBy);case mn.SEND_MESSAGE:return l.sendMessage(i.projectId,i.senderType,i.senderName,i.content);case mn.CREATE_MATERIAL_REQUEST:return l.createMaterialRequest(i.projectId,i.items,i.requestedBy,i.neededBy,i.priority,i.notes);default:throw new Error(`Unknown action type: ${c}`)}},Wx={slowQueryThreshold:200},Wt={query(r,l){const c={type:"query",operation:r,duration_ms:l.duration,rows_returned:l.rows,company_id:l.company_id||null,project_id:l.project_id||null,user_id:l.user_id||null,timestamp:new Date().toISOString()};l.duration>=Wx.slowQueryThreshold&&nd("query",c)},error(r,l){const c={type:"error",category:r,severity:l.severity||"error",error_code:l.code||null,message:l.message,company_id:l.company_id||null,user_id:l.user_id||null,project_id:l.project_id||null,operation:l.operation||null,context:l.extra||{},timestamp:new Date().toISOString()};nd("error",c)},storage(r,l){const c={type:"storage",operation:r,company_id:l.company_id||null,project_id:l.project_id||null,file_size_bytes:l.size||0,duration_ms:l.duration||0,success:l.success!==!1,error_message:l.error||null,timestamp:new Date().toISOString()};(!c.success||c.duration_ms>5e3)&&nd("storage",c)},activity(r,l){}};async function nd(r,l){try{r==="error"?await z.rpc("log_error",{p_severity:l.severity,p_category:l.category,p_message:l.message,p_company_id:l.company_id,p_user_id:l.user_id,p_project_id:l.project_id,p_operation:l.operation,p_error_code:l.error_code,p_context:l.context||{}}):r==="query"&&await z.rpc("log_query_metric",{p_operation:l.operation,p_duration_ms:l.duration_ms,p_rows_returned:l.rows_returned,p_company_id:l.company_id,p_project_id:l.project_id,p_user_id:l.user_id,p_context:{}})}catch{}}Wt.wrapQuery=function(r,l){return async function(...c){const i=performance.now();try{const m=await l.apply(this,c),g={duration:Math.round(performance.now()-i),rows:Array.isArray(m)?m.length:void 0};return Wt.query(r,g),m}catch(m){const u=Math.round(performance.now()-i);throw Wt.error("database",{message:m.message,operation:r,severity:"error",extra:{duration:u}}),m}}};Wt.time=async function(r,l){const c=performance.now();try{const i=await l(),m=Math.round(performance.now()-c);return Wt.query(r,{duration:m}),i}catch(i){throw Wt.error("general",{message:i.message,operation:r}),i}};const Kx="https://cegifnrcwdilromcyouq.supabase.co",af="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlZ2lmbnJjd2RpbHJvbWN5b3VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTQ5OTAsImV4cCI6MjA4MDIzMDk5MH0.qAiBG5XaB0C1E0U2tQbQkrhpm1iUhM6A2MXngEHhX4A",Q=!!af;Ls().catch(r=>console.error("Failed to init offline DB:",r));const z=Q?Dx(Kx,af):null,sf="fieldsync_data",yd="fieldsync_user",Qe=()=>{const r=localStorage.getItem(sf);return r?JSON.parse(r):{projects:[],areas:[],users:[],assignments:[]}},Nt=r=>{localStorage.setItem(sf,JSON.stringify(r))},Ri=()=>{const r=localStorage.getItem(yd);return r?JSON.parse(r):null},zi=r=>{r?localStorage.setItem(yd,JSON.stringify(r)):localStorage.removeItem(yd)},Cp={async signUp(r,l,c,i){if(Q){const{data:m,error:u}=await z.auth.signUp({email:r,password:l,options:{data:{name:c,role:i}}});if(u)throw u;return m}else{const m=Qe(),u={id:crypto.randomUUID(),email:r,name:c,role:i,created_at:new Date().toISOString()};return m.users.push(u),Nt(m),zi(u),{user:u}}},async signIn(r,l){if(Q){const{data:c,error:i}=await z.auth.signInWithPassword({email:r,password:l});if(i)throw i;return c}else{const i=Qe().users.find(m=>m.email===r);if(!i)throw new Error("User not found");return zi(i),{user:i}}},async signOut(){if(Q){const{error:r}=await z.auth.signOut();if(r)throw r}else zi(null)},async getUser(){if(Q){const{data:{user:r}}=await z.auth.getUser();return r}else return Ri()},async getProfile(){if(Q){const{data:{user:r}}=await z.auth.getUser();if(!r)return null;const{data:l,error:c}=await z.from("users").select("*").eq("id",r.id).single();return c?{id:r.id,email:r.email,name:r.user_metadata?.name||"",role:r.user_metadata?.role||"foreman"}:l}else return Ri()},async updateRole(r,l){if(Q){const{data:c,error:i}=await z.from("users").update({role:l}).eq("id",r).select().single();if(i)throw i;return c}else{const c=Qe(),i=c.users.find(m=>m.id===r);return i&&(i.role=l,Nt(c),Ri()?.id===r&&zi(i)),i}},onAuthStateChange(r){if(Q)return z.auth.onAuthStateChange(r);{const l=Ri();return r(l?"SIGNED_IN":"SIGNED_OUT",{user:l}),{data:{subscription:{unsubscribe:()=>{}}}}}}},ee={async getProjects(r=null,l=!1){if(Q){if(!fl()){console.log("Offline: returning cached projects");const i=await Np(r);return l?i:i.filter(m=>m.status!=="archived")}const c=performance.now();try{let i=z.from("projects").select("*").order("created_at",{ascending:!1});r&&(i=i.eq("company_id",r)),l||(i=i.eq("status","active"));const{data:m,error:u}=await i,g=Math.round(performance.now()-c);if(Wt.query("getProjects",{duration:g,rows:m?.length,company_id:r}),u){Wt.error("database",{message:u.message,operation:"getProjects",company_id:r}),console.log("Error fetching projects, trying cache:",u.message);const f=await Np(r);if(f.length>0)return f;throw u}return m?.length>0&&Xx(m).catch(f=>console.error("Failed to cache projects:",f)),m}catch(i){throw Wt.error("database",{message:i.message,operation:"getProjects",company_id:r}),i}}else{const c=Qe().projects;return l?c:c.filter(i=>i.status!=="archived")}},async getArchivedProjects(r){if(Q){const{data:l,error:c}=await z.from("projects").select("*").eq("company_id",r).eq("status","archived").order("archived_at",{ascending:!1});if(c)throw c;return l}else return Qe().projects.filter(l=>l.status==="archived")},async getProjectCount(r){if(Q){const{count:l,error:c}=await z.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",r).in("status",["active","archived"]);if(c)throw c;return l||0}else return Qe().projects.filter(c=>c.company_id===r&&c.status!=="deleted").length},async archiveProject(r){if(Q){const{data:l,error:c}=await z.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw c;return l}else{const l=Qe(),c=l.projects.find(i=>i.id===r);return c&&(c.status="archived",c.archived_at=new Date().toISOString(),Nt(l)),c}},async getProjectStorageStats(r){if(!Q)return{photoCount:0,estimatedMB:0};const{data:l,error:c}=await z.from("t_and_m_tickets").select("photos").eq("project_id",r);if(c)throw c;let i=0;const m=[];l?.forEach(g=>{g.photos&&Array.isArray(g.photos)&&(i+=g.photos.length,m.push(...g.photos))});const u=i*1.5;return{photoCount:i,estimatedMB:u,photoUrls:m}},async archiveProjectDeep(r,l){if(!Q)return null;const{photoUrls:c}=await this.getProjectStorageStats(r);if(c.length>0){const u=c.map(g=>{try{const j=new URL(g).pathname.match(/\/tm-photos\/(.+)$/);return j?j[1]:null}catch{return null}}).filter(Boolean);if(u.length>0)for(let g=0;g<u.length;g+=100){const f=u.slice(g,g+100);await z.storage.from("tm-photos").remove(f)}}await z.from("t_and_m_tickets").update({photos:[]}).eq("project_id",r);const{data:i,error:m}=await z.from("projects").update({status:"archived",archived_at:new Date().toISOString(),photos:[],storage_cleaned:!0}).eq("id",r).select().single();if(m)throw m;return{...i,photosDeleted:c.length}},async restoreProject(r){if(Q){const{data:l,error:c}=await z.from("projects").update({status:"active",archived_at:null}).eq("id",r).select().single();if(c)throw c;return l}else{const l=Qe(),c=l.projects.find(i=>i.id===r);return c&&(c.status="active",c.archived_at=null,Nt(l)),c}},async getProject(r){if(Q){const{data:l,error:c}=await z.from("projects").select("*").eq("id",r).single();if(c)throw c;return l}else return Qe().projects.find(l=>l.id===r)},async createProject(r){if(Q){console.log("Creating project with data:",r);const{data:l,error:c}=await z.from("projects").insert({...r,status:"active"}).select().single();if(c)throw console.error("Supabase createProject error:",c.message,c.details,c.hint),c;return l}else{const l=Qe(),c={...r,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return l.projects.push(c),Nt(l),c}},async getProjectByPin(r){if(Q){const{data:l,error:c}=await z.from("projects").select("*").eq("pin",r).eq("status","active").single();return c?null:l}else return Qe().projects.find(c=>c.pin===r&&c.status==="active")||null},async getProjectByPinAndCompany(r,l){if(Q){const{data:c,error:i}=await z.from("projects").select("*").eq("pin",r).eq("company_id",l).eq("status","active").single();return i?null:c}else return Qe().projects.find(i=>i.pin===r&&i.company_id===l&&i.status==="active")||null},async isPinAvailable(r,l=null){if(Q){let c=z.from("projects").select("id").eq("pin",r);l&&(c=c.neq("id",l));const{data:i,error:m}=await c;if(m)throw m;return i.length===0}else return!Qe().projects.some(i=>i.pin===r&&i.id!==l)},async updateProjectPin(r,l){if(Q){const{data:c,error:i}=await z.from("projects").update({pin:l}).eq("id",r).select().single();if(i)throw i;return c}else{const c=Qe(),i=c.projects.find(m=>m.id===r);return i&&(i.pin=l,Nt(c)),i}},async updateProject(r,l){if(Q){const{data:c,error:i}=await z.from("projects").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating project:",i),i;return c}else{const c=Qe(),i=c.projects.find(m=>m.id===r);return i&&(Object.assign(i,l),Nt(c)),i}},async deleteProject(r){if(Q){const{error:l}=await z.from("projects").delete().eq("id",r);if(l)throw l}else{const l=Qe();l.projects=l.projects.filter(c=>c.id!==r),l.areas=l.areas.filter(c=>c.project_id!==r),Nt(l)}},async getAreas(r){if(Q){if(!fl())return console.log("Offline: returning cached areas"),Sp(r);const{data:l,error:c}=await z.from("areas").select("*").eq("project_id",r).order("sort_order",{ascending:!0});if(c){console.log("Error fetching areas, trying cache:",c.message);const i=await Sp(r);if(i.length>0)return i;throw c}return l?.length>0&&Ix(l).catch(i=>console.error("Failed to cache areas:",i)),l}else return Qe().areas.filter(l=>l.project_id===r)},async createArea(r){if(Q){const{data:l,error:c}=await z.from("areas").insert(r).select().single();if(c)throw c;return l}else{const l=Qe(),c={...r,id:crypto.randomUUID(),created_at:new Date().toISOString()};return l.areas.push(c),Nt(l),c}},async updateAreaStatus(r,l){if(Q){if(!fl()){console.log("Offline: queuing area status update");const m=await ad(r,l);return await _p(mn.UPDATE_AREA_STATUS,{areaId:r,status:l}),m}const{data:c,error:i}=await z.from("areas").update({status:l}).eq("id",r).select().single();if(i){if(i.message?.includes("fetch")||i.message?.includes("network")){console.log("Network error: queuing area status update");const m=await ad(r,l);return await _p(mn.UPDATE_AREA_STATUS,{areaId:r,status:l}),m}throw i}return c&&ad(r,l).catch(m=>console.error("Failed to update cached area:",m)),c}else{const c=Qe(),i=c.areas.find(m=>m.id===r);return i&&(i.status=l,i.updated_at=new Date().toISOString()),Nt(c),i}},async updateArea(r,l){if(Q){const{data:c,error:i}=await z.from("areas").update(l).eq("id",r).select().single();if(i)throw i;return c}else{const c=Qe(),i=c.areas.find(m=>m.id===r);return i&&(Object.assign(i,l),i.updated_at=new Date().toISOString()),Nt(c),i}},async deleteArea(r){if(Q){const{error:l}=await z.from("areas").delete().eq("id",r);if(l)throw l}else{const l=Qe();l.areas=l.areas.filter(c=>c.id!==r),Nt(l)}},subscribeToAreas(r,l){return Q?z.channel(`areas:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMessages(r,l){return Q?z.channel(`messages:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMaterialRequests(r,l){return Q?z.channel(`material_requests:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToDailyReports(r,l){return Q?z.channel(`daily_reports:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCrewCheckins(r,l){return Q?z.channel(`crew_checkins:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToInjuryReports(r,l){return Q?z.channel(`injury_reports:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},l).subscribe():null},subscribeToTMTickets(r,l){return Q?z.channel(`tm_tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCompanyActivity(r,l,c){if(!Q||!l||l.length===0)return null;const i=z.channel(`company_activity:${r}`);return l.forEach(m=>{i.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${m}`},u=>c.onMessage?.(u)),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"material_requests",filter:`project_id=eq.${m}`},u=>c.onMaterialRequest?.(u)),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${m}`},u=>c.onTMTicket?.(u))}),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},m=>c.onInjuryReport?.(m)),i.subscribe()},unsubscribe(r){r&&Q&&z.removeChannel(r)},async getAssignedProjects(r){if(Q){const{data:l,error:c}=await z.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",r);if(c)throw c;return l.map(i=>i.projects)}else{const l=Qe();return(l.assignments?.filter(i=>i.user_id===r)||[]).map(i=>l.projects.find(m=>m.id===i.project_id)).filter(Boolean)}},async assignUserToProject(r,l,c){if(Q){const{data:i,error:m}=await z.from("project_assignments").insert({project_id:r,user_id:l,assigned_by:c}).select().single();if(m)throw m;return i}else{const i=Qe();i.assignments||(i.assignments=[]);const m={id:crypto.randomUUID(),project_id:r,user_id:l,assigned_by:c,assigned_at:new Date().toISOString()};return i.assignments.push(m),Nt(i),m}},async removeUserFromProject(r,l){if(Q){const{error:c}=await z.from("project_assignments").delete().eq("project_id",r).eq("user_id",l);if(c)throw c}else{const c=Qe();c.assignments=c.assignments?.filter(i=>!(i.project_id===r&&i.user_id===l))||[],Nt(c)}},async getProjectAssignments(r){if(Q){const{data:l,error:c}=await z.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",r);if(c)throw c;return l.map(i=>i.users)}else{const l=Qe();return(l.assignments?.filter(i=>i.project_id===r)||[]).map(i=>l.users.find(m=>m.id===i.user_id)).filter(Boolean)}},async getAllUsers(){if(Q){const{data:r,error:l}=await z.from("users").select("*").order("name");if(l)throw l;return r}else return Qe().users||[]},async getForemen(){if(Q){const{data:r,error:l}=await z.from("users").select("*").eq("role","foreman").order("name");if(l)throw l;return r}else return(Qe().users||[]).filter(r=>r.role==="foreman")},async logActivity(r,l,c,i,m,u){if(Q){const{error:g}=await z.from("activity_log").insert({user_id:r,project_id:l,area_id:c,action:i,old_value:m,new_value:u});g&&console.error("Error logging activity:",g)}},async getProjectActivity(r,l=50){if(Q){const{data:c,error:i}=await z.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",r).order("created_at",{ascending:!1}).limit(l);if(i)throw i;return c}return[]},async getMaterialsEquipment(r){if(Q){const{data:l,error:c}=await z.from("materials_equipment").select("*").eq("company_id",r).eq("active",!0).order("category").order("name");if(c)throw c;return l}return[]},async getMaterialsEquipmentByCategory(r,l){if(Q){const{data:c,error:i}=await z.from("materials_equipment").select("*").eq("company_id",r).eq("category",l).eq("active",!0).order("name");if(i)throw i;return c}return[]},async getAllMaterialsEquipment(r){if(Q){const{data:l,error:c}=await z.from("materials_equipment").select("*").eq("company_id",r).order("category").order("name");if(c)throw c;return l}return[]},async createMaterialEquipment(r){if(Q){const{data:l,error:c}=await z.from("materials_equipment").insert(r).select().single();if(c)throw c;return l}return null},async updateMaterialEquipment(r,l){if(Q){const{data:c,error:i}=await z.from("materials_equipment").update(l).eq("id",r).select().single();if(i)throw i;return c}return null},async deleteMaterialEquipment(r){if(Q){const{error:l}=await z.from("materials_equipment").update({active:!1}).eq("id",r);if(l)throw l}},async getTMTickets(r){if(Q){const l=performance.now();try{const{data:c,error:i}=await z.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          `).eq("project_id",r).order("created_at",{ascending:!1}),m=Math.round(performance.now()-l);if(Wt.query("getTMTickets",{duration:m,rows:c?.length,project_id:r}),i)throw i;return c}catch(c){throw Wt.error("database",{message:c.message,operation:"getTMTickets",project_id:r}),c}}return[]},async getChangeOrderTotals(r){if(Q){const{data:l,error:c}=await z.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",r).not("ce_pco_number","is",null).neq("ce_pco_number","");if(c)throw c;const i={};let m=0,u=0;return l?.forEach(g=>{const f=g.ce_pco_number;if(i[f]||(i[f]={approved:0,pending:0,count:0}),i[f].count++,g.status==="approved"||g.status==="billed"){const j=parseFloat(g.change_order_value)||0;i[f].approved+=j,m+=j}else g.status==="pending"&&u++}),{changeOrders:i,totalApprovedValue:m,pendingCount:u}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(r,l){if(Q){const{data:c,error:i}=await z.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).eq("status",l).order("created_at",{ascending:!1});if(i)throw i;return c}return[]},async getCORTickets(r){if(Q){const{data:l,error:c}=await z.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",r).order("work_date",{ascending:!0});if(c)throw c;return l||[]}return[]},async createTMTicket(r){if(Q){const{data:l,error:c}=await z.from("t_and_m_tickets").insert({project_id:r.project_id,work_date:r.work_date,ce_pco_number:r.ce_pco_number||null,assigned_cor_id:r.assigned_cor_id||null,notes:r.notes,photos:r.photos||[],status:"pending",created_by_name:r.created_by_name||"Field User"}).select().single();if(c)throw c;return l}return null},async addTMWorkers(r,l){if(Q){const c=l.map(m=>({ticket_id:r,name:m.name,hours:m.hours,overtime_hours:m.overtime_hours||0,time_started:m.time_started||null,time_ended:m.time_ended||null,role:m.role||"Laborer"})),{error:i}=await z.from("t_and_m_workers").insert(c);if(i)throw i}},async addTMItems(r,l){if(Q){const c=l.map(m=>({ticket_id:r,material_equipment_id:m.material_equipment_id||null,custom_name:m.custom_name||null,custom_category:m.custom_category||null,quantity:m.quantity})),{error:i}=await z.from("t_and_m_items").insert(c);if(i)throw i}},async getPreviousTicketCrew(r,l){if(!Q)return null;const{data:c,error:i}=await z.from("t_and_m_tickets").select(`
        id,
        work_date,
        t_and_m_workers (*)
      `).eq("project_id",r).lt("work_date",l).order("work_date",{ascending:!1}).limit(1).single();if(i||!c)return null;const m=c.t_and_m_workers||[],u=m.filter(j=>["Foreman","General Foreman","Superintendent"].includes(j.role)).map(j=>({name:j.name,hours:j.hours?.toString()||"",overtimeHours:j.overtime_hours?.toString()||"",timeStarted:j.time_started||"",timeEnded:j.time_ended||"",role:j.role})),g=m.filter(j=>j.role==="Operator").map(j=>({name:j.name,hours:j.hours?.toString()||"",overtimeHours:j.overtime_hours?.toString()||"",timeStarted:j.time_started||"",timeEnded:j.time_ended||""})),f=m.filter(j=>j.role==="Laborer").map(j=>({name:j.name,hours:j.hours?.toString()||"",overtimeHours:j.overtime_hours?.toString()||"",timeStarted:j.time_started||"",timeEnded:j.time_ended||""}));return{workDate:c.work_date,supervision:u.length>0?u:null,operators:g.length>0?g:null,laborers:f.length>0?f:null,totalWorkers:m.length}},async updateTMTicketStatus(r,l){if(Q){const{data:c,error:i}=await z.from("t_and_m_tickets").update({status:l}).eq("id",r).select().single();if(i)throw i;return c}return null},async approveTMTicket(r,l,c,i=null){if(Q){const m={status:"approved",approved_by_user_id:l,approved_by_name:c,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};i!==null&&(m.change_order_value=parseFloat(i)||0);const{data:u,error:g}=await z.from("t_and_m_tickets").update(m).eq("id",r).select().single();if(g)throw g;return u}return null},async rejectTMTicket(r,l,c,i=""){if(Q){const{data:m,error:u}=await z.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:l,rejected_by_name:c,rejected_at:new Date().toISOString(),rejection_reason:i,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",r).select().single();if(u)throw u;return m}return null},canApproveTickets(r){return["owner","admin","manager"].includes(r)},async updateTMTicketPhotos(r,l){if(Q){const{data:c,error:i}=await z.from("t_and_m_tickets").update({photos:l}).eq("id",r).select().single();if(i)throw i;return c}return null},async saveTMClientSignature(r,l){if(Q){const{data:c,error:i}=await z.from("t_and_m_tickets").update({client_signature_data:l.signature,client_signature_name:l.signerName,client_signature_title:l.signerTitle,client_signature_company:l.signerCompany,client_signature_date:l.signedAt,client_signature_ip:null,status:"client_signed"}).eq("id",r).select().single();if(i)throw i;return c}return null},async deleteTMTicket(r){if(Q){const{error:l}=await z.from("t_and_m_tickets").delete().eq("id",r);if(l)throw l}},async isTicketEditable(r){if(!r?.assigned_cor_id)return{editable:!0};if(Q)try{const{data:l,error:c}=await z.from("change_orders").select("id, status, cor_number").eq("id",r.assigned_cor_id).single();if(c||!l)return{editable:!0};const m=["draft","pending_approval"].includes(l.status);return{editable:m,lockedBy:m?null:l,reason:m?null:`This ticket is linked to ${l.cor_number} which has been ${l.status==="approved"?"approved":l.status}`}}catch(l){return console.error("Error checking ticket editability:",l),{editable:!0}}return{editable:!0}},async getCompanyByCode(r){if(Q){const{data:l,error:c}=await z.from("companies").select("*").eq("code",r).single();return c?null:l}return null},async getCompany(r){if(Q){const{data:l,error:c}=await z.from("companies").select("*").eq("id",r).single();if(c)throw c;return l}return null},async getUserCompanies(r){if(Q){const{data:l,error:c}=await z.from("user_companies").select(`
          id,
          access_level,
          company_id,
          status,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",r).eq("status","active").order("created_at",{ascending:!0});return c?(console.error("Error fetching user companies:",c),[]):l.map(i=>({id:i.companies.id,name:i.companies.name,code:i.companies.code,access_level:i.access_level}))}return[]},async getUserPendingMemberships(r){if(Q){const{count:l,error:c}=await z.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r).eq("status","pending");return c?(console.error("Error fetching pending memberships:",c),0):l||0}return 0},async getCompanyMemberships(r){if(Q){const{data:l,error:c}=await z.from("user_companies").select(`
          id,
          access_level,
          company_role,
          status,
          created_at,
          approved_at,
          approved_by,
          removed_at,
          removed_by,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).order("created_at",{ascending:!1});return c?(console.error("Error fetching company memberships:",c),[]):l||[]}return[]},async approveMembership(r,l){if(Q){const{error:c}=await z.from("user_companies").update({status:"active",approved_at:new Date().toISOString(),approved_by:l}).eq("id",r);if(c)throw c}},async approveMembershipWithRole(r,l,c="member"){if(Q){const{error:i}=await z.rpc("approve_membership_with_role",{membership_id:r,approved_by_user:l,new_access_level:c});if(i)throw i}},async rejectMembership(r){if(Q){const{error:l}=await z.from("user_companies").delete().eq("id",r);if(l)throw l}},async removeMember(r,l){if(Q){const{error:c}=await z.from("user_companies").update({status:"removed",removed_at:new Date().toISOString(),removed_by:l}).eq("id",r);if(c)throw c}},async getProjectTeam(r){if(Q){const{data:l,error:c}=await z.from("project_users").select(`
          id,
          project_role,
          assigned_at,
          notes,
          users!project_users_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("project_id",r).order("assigned_at",{ascending:!0});return c?(console.error("Error fetching project team:",c),[]):l||[]}return[]},async getCompanyMembers(r){if(Q){const{data:l,error:c}=await z.from("user_companies").select(`
          id,
          access_level,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).eq("status","active").order("created_at",{ascending:!0});return c?(console.error("Error fetching company members:",c),[]):l||[]}return[]},async addProjectMember(r,l,c,i){if(Q){const{data:m,error:u}=await z.from("project_users").insert({project_id:r,user_id:l,project_role:c,assigned_by:i}).select().single();if(u)throw u;return m}return null},async updateProjectMemberRole(r,l,c){if(Q){const{error:i}=await z.from("project_users").update({project_role:c}).eq("project_id",r).eq("user_id",l);if(i)throw i}},async removeProjectMember(r,l){if(Q){const{error:c}=await z.from("project_users").delete().eq("project_id",r).eq("user_id",l);if(c)throw c}},async updateMemberAccessLevel(r,l){if(Q){const{error:c}=await z.from("user_companies").update({access_level:l}).eq("id",r);if(c)throw c}},async updateMemberCompanyRole(r,l){if(Q){const{error:c}=await z.from("user_companies").update({company_role:l}).eq("id",r);if(c)throw c}},async repairLegacyUser(r,l,c="member"){if(!Q||!r||!l)return!1;try{const{data:i,error:m}=await z.rpc("repair_legacy_user",{p_user_id:r,p_company_id:l,p_role:c});return m?(console.error("RPC repair_legacy_user failed:",m),!1):(console.log("Legacy user repaired via RPC:",i),i===!0)}catch(i){return console.error("Error repairing legacy user:",i),!1}},async isLegacyUser(r){if(!Q)return!1;try{const{data:l}=await z.from("users").select("company_id, role").eq("id",r).single();if(!l?.company_id)return!1;const{count:c}=await z.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r);return c===0}catch(l){return console.error("Error checking legacy user:",l),!1}},DISPOSAL_LOAD_TYPES:[{value:"concrete",label:"Concrete"},{value:"trash",label:"Trash"},{value:"metals",label:"Metals"},{value:"hazardous_waste",label:"Hazardous Waste"}],async getDisposalLoads(r,l){if(!Q)return[];const c=performance.now();try{const{data:i,error:m}=await z.from("disposal_loads").select("*").eq("project_id",r).eq("work_date",l).order("created_at",{ascending:!1}),u=Math.round(performance.now()-c);if(Wt.query("getDisposalLoads",{duration:u,rows:i?.length,project_id:r}),m)throw m;return i||[]}catch(i){throw Wt.error("database",{message:i.message,operation:"getDisposalLoads",project_id:r}),i}},async addDisposalLoad(r,l,c,i,m,u=null){if(!Q)return null;const{data:g,error:f}=await z.from("disposal_loads").insert({project_id:r,user_id:l,work_date:c,load_type:i,load_count:m,notes:u}).select().single();if(f)throw Wt.error("database",{message:f.message,operation:"addDisposalLoad",project_id:r}),f;return g},async updateDisposalLoad(r,l,c,i=null){if(!Q)return null;const{data:m,error:u}=await z.from("disposal_loads").update({load_type:l,load_count:c,notes:i}).eq("id",r).select().single();if(u)throw Wt.error("database",{message:u.message,operation:"updateDisposalLoad"}),u;return m},async deleteDisposalLoad(r){if(!Q)return!1;const{error:l}=await z.from("disposal_loads").delete().eq("id",r);if(l)throw Wt.error("database",{message:l.message,operation:"deleteDisposalLoad"}),l;return!0},async getDisposalSummary(r,l=null,c=null){if(!Q)return[];const i=performance.now();try{const{data:m,error:u}=await z.rpc("get_disposal_summary",{p_project_id:r,p_start_date:l,p_end_date:c}),g=Math.round(performance.now()-i);if(Wt.query("getDisposalSummary",{duration:g,rows:m?.length,project_id:r}),u)throw u;return m||[]}catch(m){return Wt.error("database",{message:m.message,operation:"getDisposalSummary",project_id:r}),this.getDisposalSummaryFallback(r,l,c)}},async getDisposalSummaryFallback(r,l,c){let i=z.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r);l&&(i=i.gte("work_date",l)),c&&(i=i.lte("work_date",c));const{data:m,error:u}=await i;if(u)throw u;const g={};return m?.forEach(f=>{g[f.load_type]||(g[f.load_type]={load_type:f.load_type,total_loads:0,days:new Set}),g[f.load_type].total_loads+=f.load_count,g[f.load_type].days.add(f.work_date)}),Object.values(g).map(f=>({load_type:f.load_type,total_loads:f.total_loads,days_with_activity:f.days.size}))},async getWeeklyDisposalSummary(r,l=4){if(!Q)return[];const c=new Date,i=new Date;i.setDate(i.getDate()-l*7);const{data:m,error:u}=await z.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r).gte("work_date",i.toISOString().split("T")[0]).lte("work_date",c.toISOString().split("T")[0]).order("work_date",{ascending:!0});if(u)throw u;const g={};return m?.forEach(f=>{const j=new Date(f.work_date),v=new Date(j);v.setDate(j.getDate()-j.getDay());const x=v.toISOString().split("T")[0];g[x]||(g[x]={week:x,concrete:0,trash:0,metals:0,hazardous_waste:0}),g[x][f.load_type]+=f.load_count}),Object.values(g).sort((f,j)=>f.week.localeCompare(j.week))},async uploadPhoto(r,l,c,i){if(!Q)return null;const m=performance.now(),u=i.size||0,g=Date.now(),f=Math.random().toString(36).substring(7),j=i.name?.split(".").pop()||"jpg",v=`${g}-${f}.${j}`,x=`${r}/${l}/${c}/${v}`;try{const{data:R,error:A}=await z.storage.from("tm-photos").upload(x,i,{cacheControl:"3600",upsert:!1}),q=Math.round(performance.now()-m);if(Wt.storage("upload",{company_id:r,project_id:l,size:u,duration:q,success:!A}),A)throw A;const{data:F}=z.storage.from("tm-photos").getPublicUrl(x);return F.publicUrl}catch(R){throw Wt.error("storage",{message:R.message,operation:"uploadPhoto",company_id:r,project_id:l}),R}},async uploadPhotoBase64(r,l,c,i,m="photo.jpg"){if(!Q)return null;const g=await(await fetch(i)).blob(),f=Date.now(),j=Math.random().toString(36).substring(7),v=m.split(".").pop()||"jpg",x=`${f}-${j}.${v}`,R=`${r}/${l}/${c}/${x}`,{data:A,error:q}=await z.storage.from("tm-photos").upload(R,g,{cacheControl:"3600",upsert:!1,contentType:g.type});if(q)throw q;const{data:F}=z.storage.from("tm-photos").getPublicUrl(R);return F.publicUrl},async deletePhoto(r){if(!Q)return;const c=new URL(r).pathname.match(/\/tm-photos\/(.+)$/);if(!c)return;const i=c[1],{error:m}=await z.storage.from("tm-photos").remove([i]);if(m)throw m},async getCrewCheckin(r,l=null){if(!Q)return null;const c=l||new Date().toISOString().split("T")[0],{data:i,error:m}=await z.from("crew_checkins").select("*").eq("project_id",r).eq("check_in_date",c).single();return m&&m.code!=="PGRST116"&&console.error("Error fetching crew checkin:",m),i},async saveCrewCheckin(r,l,c=null,i=null){if(!Q)return null;const m=i||new Date().toISOString().split("T")[0],{data:u,error:g}=await z.from("crew_checkins").upsert({project_id:r,check_in_date:m,workers:l,created_by:c,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(g)throw console.error("Error saving crew checkin:",g),g;return u},async addCrewMember(r,l,c=null){if(!Q)return null;const i=await this.getCrewCheckin(r),m=i?.workers||[];return m.find(u=>u.name.toLowerCase()===l.name.toLowerCase())?i:(m.push(l),await this.saveCrewCheckin(r,m,c))},async removeCrewMember(r,l){if(!Q)return null;const c=await this.getCrewCheckin(r);if(!c)return null;const i=c.workers.filter(m=>m.name.toLowerCase()!==l.toLowerCase());return await this.saveCrewCheckin(r,i,c.created_by)},async getCrewCheckinHistory(r,l=30){if(!Q)return[];const{data:c,error:i}=await z.from("crew_checkins").select("*").eq("project_id",r).order("check_in_date",{ascending:!1}).limit(l);return i?(console.error("Error fetching crew history:",i),[]):c||[]},async getLaborRates(r,l=null,c=null){if(!Q)return[];let i=z.from("labor_rates").select("*").eq("company_id",r);l&&(i=i.eq("work_type",l)),c&&(i=i.eq("job_type",c));const{data:m,error:u}=await i;return u?(console.error("Error fetching labor rates:",u),[]):m||[]},async calculateManDayCosts(r,l,c,i){if(!Q)return{totalCost:0,totalManDays:0,breakdown:[]};const m=await this.getCrewCheckinHistory(r,365),u=await this.getLaborRates(l,c,i),g={};u.forEach(R=>{g[R.role.toLowerCase()]=parseFloat(R.regular_rate)||0});let f=0,j=0;const v={},x=[];return m.forEach(R=>{const A=R.workers||[];let q=0;const F={};A.forEach(B=>{const I=(B.role||"laborer").toLowerCase(),re=g[I]||0;F[I]||(F[I]={count:0,cost:0}),F[I].count++,F[I].cost+=re,q+=re,v[I]||(v[I]={count:0,cost:0,rate:re}),v[I].count++,v[I].cost+=re}),f+=q,j+=A.length,x.push({date:R.check_in_date,workers:A.length,cost:q,breakdown:F})}),{totalCost:f,totalManDays:j,byRole:v,byDate:x,daysWorked:m.length}},async getDailyReport(r,l=null){if(!Q)return null;const c=l||new Date().toISOString().split("T")[0],{data:i,error:m}=await z.from("daily_reports").select("*").eq("project_id",r).eq("report_date",c).single();return m&&m.code!=="PGRST116"&&console.error("Error fetching daily report:",m),i},async compileDailyReport(r,l=null){if(!Q)return null;const c=l||new Date().toISOString().split("T")[0],i=await this.getCrewCheckin(r,c),{data:m}=await z.from("areas").select("*").eq("project_id",r),u=m?.filter(j=>j.status==="done"&&j.completed_at?.startsWith(c))||[],{data:g}=await z.from("t_and_m_tickets").select("*").eq("project_id",r).eq("work_date",c),f=g?.reduce((j,v)=>j+(v.photos?.length||0),0)||0;return{crew_count:i?.workers?.length||0,crew_list:i?.workers||[],tasks_completed:u.length,tasks_total:m?.length||0,completed_tasks:u.map(j=>({name:j.name,group:j.group_name})),tm_tickets_count:g?.length||0,photos_count:f}},async saveDailyReport(r,l,c=null){if(!Q)return null;const i=c||new Date().toISOString().split("T")[0],{data:m,error:u}=await z.from("daily_reports").upsert({project_id:r,report_date:i,...l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(u)throw console.error("Error saving daily report:",u),u;return m},async submitDailyReport(r,l,c=null){if(!Q)return null;const i=c||new Date().toISOString().split("T")[0],m=await this.compileDailyReport(r,i),{data:u,error:g}=await z.from("daily_reports").upsert({project_id:r,report_date:i,...m,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(g)throw console.error("Error submitting daily report:",g),g;return u},async getDailyReports(r,l=30){if(!Q)return[];const{data:c,error:i}=await z.from("daily_reports").select("*").eq("project_id",r).order("report_date",{ascending:!1}).limit(l);return i?(console.error("Error fetching daily reports:",i),[]):c||[]},async sendMessage(r,l,c,i,m=null,u=null,g="general",f=null){if(!Q)return null;const{data:j,error:v}=await z.from("messages").insert({project_id:r,sender_type:c,sender_name:i,sender_user_id:m,message:l,photo_url:u,message_type:g,parent_message_id:f}).select().single();if(v)throw console.error("Error sending message:",v),v;return j},async getMessages(r,l=50){if(!Q)return[];const{data:c,error:i}=await z.from("messages").select("*").eq("project_id",r).order("created_at",{ascending:!1}).limit(l);return i?(console.error("Error fetching messages:",i),[]):c||[]},async getUnreadCount(r,l){if(!Q)return 0;const c=l==="field"?"office":"field",{count:i,error:m}=await z.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("sender_type",c).eq("is_read",!1);return m?(console.error("Error getting unread count:",m),0):i||0},async markMessagesRead(r,l){if(!Q)return;const c=l==="field"?"office":"field",{error:i}=await z.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",r).eq("sender_type",c).eq("is_read",!1);i&&console.error("Error marking messages read:",i)},async createMaterialRequest(r,l,c,i=null,m="normal",u=null){if(!Q)return null;const{data:g,error:f}=await z.from("material_requests").insert({project_id:r,items:l,requested_by:c,needed_by:i,priority:m,notes:u}).select().single();if(f)throw console.error("Error creating material request:",f),f;return g},async getMaterialRequests(r,l=null){if(!Q)return[];let c=z.from("material_requests").select("*").eq("project_id",r).order("created_at",{ascending:!1});l&&(c=c.eq("status",l));const{data:i,error:m}=await c;return m?(console.error("Error fetching material requests:",m),[]):i||[]},async getPendingRequestsCount(r){if(!Q)return 0;const{count:l,error:c}=await z.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("status","pending");return c?0:l||0},async updateMaterialRequest(r,l,c,i=null,m=null){if(!Q)return null;const u={status:l,responded_by:c,responded_at:new Date().toISOString(),response_notes:i,updated_at:new Date().toISOString()};m&&(u.expected_delivery=m),l==="delivered"&&(u.delivered_at=new Date().toISOString());const{data:g,error:f}=await z.from("material_requests").update(u).eq("id",r).select().single();if(f)throw console.error("Error updating material request:",f),f;return g},generateShareToken(){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let l="";for(let c=0;c<12;c++)l+=r.charAt(Math.floor(Math.random()*r.length));return l},async createProjectShare(r,l,c,i=null){if(!Q){const j=Qe();j.projectShares||(j.projectShares=[]);const v={id:crypto.randomUUID(),project_id:r,share_token:this.generateShareToken(),created_by:l,expires_at:i,is_active:!0,permissions:c,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return j.projectShares.push(v),Nt(j),v}const{data:m,error:u}=await z.rpc("generate_share_token");if(u)throw console.error("Error generating share token:",u),u;const{data:g,error:f}=await z.from("project_shares").insert({project_id:r,share_token:m,created_by:l,expires_at:i,permissions:c}).select().single();if(f)throw console.error("Error creating project share:",f),f;return g},async getShareByToken(r){if(!Q){const i=Qe();if(!i.projectShares)return null;const m=i.projectShares.find(u=>u.share_token===r&&u.is_active&&(!u.expires_at||new Date(u.expires_at)>new Date));return m&&(m.view_count++,m.last_viewed_at=new Date().toISOString(),Nt(i)),m}const{data:l,error:c}=await z.from("project_shares").select("*, projects(*)").eq("share_token",r).eq("is_active",!0).single();return c?(console.error("Error fetching share by token:",c),null):l.expires_at&&new Date(l.expires_at)<new Date?null:(await z.rpc("increment_share_view_count",{token:r}),l)},async getProjectShares(r){if(!Q){const i=Qe();return i.projectShares?i.projectShares.filter(m=>m.project_id===r):[]}const{data:l,error:c}=await z.from("project_shares").select("*, users(name, email)").eq("project_id",r).order("created_at",{ascending:!1});return c?(console.error("Error fetching project shares:",c),[]):l||[]},async updateProjectShare(r,l){if(!Q){const m=Qe();if(!m.projectShares)return null;const u=m.projectShares.findIndex(g=>g.id===r);return u===-1?null:(m.projectShares[u]={...m.projectShares[u],...l,updated_at:new Date().toISOString()},Nt(m),m.projectShares[u])}const{data:c,error:i}=await z.from("project_shares").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating project share:",i),i;return c},async revokeProjectShare(r){return this.updateProjectShare(r,{is_active:!1})},async deleteProjectShare(r){if(!Q){const c=Qe();if(!c.projectShares)return;c.projectShares=c.projectShares.filter(i=>i.id!==r),Nt(c);return}const{error:l}=await z.from("project_shares").delete().eq("id",r);if(l)throw console.error("Error deleting project share:",l),l},async getPublicProjectData(r){const l=await this.getShareByToken(r);if(!l)return null;const c=l.project_id||l.projects?.id;if(!Q){const u=Qe(),g=u.projects.find(R=>R.id===c);if(!g)return null;const f=u.areas.filter(R=>R.project_id===c),j=f.reduce((R,A)=>R+parseFloat(A.weight||0),0),v=f.filter(R=>R.status==="done").reduce((R,A)=>R+parseFloat(A.weight||0),0),x=j>0?Math.round(v/j*100):0;return{share:l,project:g,progress:x,areas:l.permissions.progress?f:[],photos:[],dailyReports:[],tmTickets:[]}}const i=l.projects||await this.getProject(c);if(!i)return null;const m={share:l,project:i,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(l.permissions.progress){m.areas=await this.getAreas(c);const u=m.areas.reduce((f,j)=>f+parseFloat(j.weight||0),0),g=m.areas.filter(f=>f.status==="done").reduce((f,j)=>f+parseFloat(j.weight||0),0);m.progress=u>0?Math.round(g/u*100):0}if(l.permissions.photos){const{data:u}=await z.from("t_and_m_tickets").select("photos, work_date").eq("project_id",c).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);m.photos=u?.flatMap(g=>(g.photos||[]).map(f=>({url:f,date:g.work_date})))||[]}if(l.permissions.daily_reports){const{data:u}=await z.from("daily_reports").select("*").eq("project_id",c).order("report_date",{ascending:!1}).limit(10);m.dailyReports=u||[]}return l.permissions.tm_tickets&&(m.tmTickets=await this.getTMTickets(c)),m},async createInjuryReport(r){if(!Q){const i=Qe();i.injuryReports||(i.injuryReports=[]);const m={id:crypto.randomUUID(),...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return i.injuryReports.push(m),Nt(i),m}const{data:l,error:c}=await z.from("injury_reports").insert(r).select().single();if(c)throw console.error("Error creating injury report:",c),c;return l},async getInjuryReports(r){if(!Q){const i=Qe();return i.injuryReports?i.injuryReports.filter(m=>m.project_id===r).sort((m,u)=>new Date(u.incident_date)-new Date(m.incident_date)):[]}const{data:l,error:c}=await z.from("injury_reports").select("*").eq("project_id",r).order("incident_date",{ascending:!1});return c?(console.error("Error fetching injury reports:",c),[]):l||[]},async getCompanyInjuryReports(r,l=null){if(!Q){const u=Qe();if(!u.injuryReports)return[];let g=u.injuryReports.filter(f=>f.company_id===r);return l&&(g=g.filter(f=>f.status===l)),g.sort((f,j)=>new Date(j.incident_date)-new Date(f.incident_date))}let c=z.from("injury_reports").select("*, projects(name)").eq("company_id",r).order("incident_date",{ascending:!1});l&&(c=c.eq("status",l));const{data:i,error:m}=await c;return m?(console.error("Error fetching company injury reports:",m),[]):i||[]},async getInjuryReport(r){if(!Q){const i=Qe();return i.injuryReports?i.injuryReports.find(m=>m.id===r):null}const{data:l,error:c}=await z.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",r).single();return c?(console.error("Error fetching injury report:",c),null):l},async updateInjuryReport(r,l){if(!Q){const m=Qe();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(g=>g.id===r);return u===-1?null:(m.injuryReports[u]={...m.injuryReports[u],...l,updated_at:new Date().toISOString()},Nt(m),m.injuryReports[u])}const{data:c,error:i}=await z.from("injury_reports").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating injury report:",i),i;return c},async closeInjuryReport(r,l){return this.updateInjuryReport(r,{status:"closed",closed_at:new Date().toISOString(),closed_by:l})},async deleteInjuryReport(r){if(!Q){const c=Qe();if(!c.injuryReports)return;c.injuryReports=c.injuryReports.filter(i=>i.id!==r),Nt(c);return}const{error:l}=await z.from("injury_reports").delete().eq("id",r);if(l)throw console.error("Error deleting injury report:",l),l},async getInjuryStatistics(r,l=null,c=null){if(!Q){const u=Qe();if(!u.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let g=u.injuryReports.filter(f=>f.company_id===r);return l&&(g=g.filter(f=>new Date(f.incident_date)>=new Date(l))),c&&(g=g.filter(f=>new Date(f.incident_date)<=new Date(c))),{total_incidents:g.length,minor_injuries:g.filter(f=>f.injury_type==="minor").length,serious_injuries:g.filter(f=>f.injury_type==="serious").length,critical_injuries:g.filter(f=>f.injury_type==="critical").length,near_misses:g.filter(f=>f.injury_type==="near_miss").length,osha_recordable:g.filter(f=>f.osha_recordable).length,total_days_away:g.reduce((f,j)=>f+(j.days_away_from_work||0),0),total_restricted_days:g.reduce((f,j)=>f+(j.restricted_work_days||0),0)}}const{data:i,error:m}=await z.rpc("get_injury_statistics",{comp_id:r,start_date:l,end_date:c});return m?(console.error("Error fetching injury statistics:",m),null):i[0]||null},async addWitness(r,l){if(!Q){const m=Qe();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(j=>j.id===r);if(u===-1)return null;const g=m.injuryReports[u],f=g.witnesses||[];return f.push(l),m.injuryReports[u]={...g,witnesses:f,updated_at:new Date().toISOString()},Nt(m),m.injuryReports[u]}const c=await this.getInjuryReport(r);if(!c)return null;const i=c.witnesses||[];return i.push(l),this.updateInjuryReport(r,{witnesses:i})},async removeWitness(r,l){if(!Q){const m=Qe();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(j=>j.id===r);if(u===-1)return null;const g=m.injuryReports[u],f=g.witnesses||[];return f.splice(l,1),m.injuryReports[u]={...g,witnesses:f,updated_at:new Date().toISOString()},Nt(m),m.injuryReports[u]}const c=await this.getInjuryReport(r);if(!c)return null;const i=c.witnesses||[];return i.splice(l,1),this.updateInjuryReport(r,{witnesses:i})},async getCompanyUsers(r){if(Q){const{data:l,error:c}=await z.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",r);return c?(console.error("Error fetching company users:",c),[]):l?.map(i=>({id:i.user_id,name:i.users?.name||i.users?.email,email:i.users?.email,role:i.role}))||[]}return[]},async getProjectNotificationPreferences(r){if(Q){const{data:c,error:i}=await z.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",r);return i?(console.error("Error fetching notification preferences:",i),[]):c||[]}const l=Qe();return l.notificationPreferences?l.notificationPreferences.filter(c=>c.project_id===r):[]},async getUserNotificationPreferences(r){if(Q){const{data:c,error:i}=await z.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",r);return i?(console.error("Error fetching user notification preferences:",i),[]):c||[]}const l=Qe();return l.notificationPreferences?l.notificationPreferences.filter(c=>c.user_id===r):[]},async setNotificationPreference(r,l,c){if(Q){const{data:g,error:f}=await z.from("notification_preferences").upsert({project_id:r,user_id:l,notification_types:c,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(f)throw console.error("Error setting notification preference:",f),f;return g}const i=Qe();i.notificationPreferences||(i.notificationPreferences=[]);const m=i.notificationPreferences.findIndex(g=>g.project_id===r&&g.user_id===l),u={id:m>=0?i.notificationPreferences[m].id:crypto.randomUUID(),project_id:r,user_id:l,notification_types:c,created_at:m>=0?i.notificationPreferences[m].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return m>=0?i.notificationPreferences[m]=u:i.notificationPreferences.push(u),Nt(i),u},async removeNotificationPreference(r,l){if(Q){const{error:i}=await z.from("notification_preferences").delete().eq("project_id",r).eq("user_id",l);if(i)throw console.error("Error removing notification preference:",i),i;return!0}const c=Qe();return c.notificationPreferences&&(c.notificationPreferences=c.notificationPreferences.filter(i=>!(i.project_id===r&&i.user_id===l)),Nt(c)),!0},async setProjectNotificationPreferences(r,l){const c=[];for(const i of l)if(i.notificationTypes&&i.notificationTypes.length>0){const m=await this.setNotificationPreference(r,i.userId,i.notificationTypes);c.push(m)}else await this.removeNotificationPreference(r,i.userId);return c},async getNotificationPresets(r){if(Q){const{data:c,error:i}=await z.from("notification_presets").select("*").eq("company_id",r).order("name");return i?(console.error("Error fetching notification presets:",i),[]):c||[]}const l=Qe();return l.notificationPresets?l.notificationPresets.filter(c=>c.company_id===r):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:r},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:r},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:r},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:r}]},async createNotificationPreset(r,l,c){if(Q){const{data:u,error:g}=await z.from("notification_presets").insert({company_id:r,name:l,notification_types:c}).select().single();if(g)throw console.error("Error creating notification preset:",g),g;return u}const i=Qe();i.notificationPresets||(i.notificationPresets=[]);const m={id:crypto.randomUUID(),company_id:r,name:l,notification_types:c,created_at:new Date().toISOString()};return i.notificationPresets.push(m),Nt(i),m},async updateNotificationPreset(r,l,c){if(Q){const{data:u,error:g}=await z.from("notification_presets").update({name:l,notification_types:c,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(g)throw console.error("Error updating notification preset:",g),g;return u}const i=Qe();if(!i.notificationPresets)return null;const m=i.notificationPresets.findIndex(u=>u.id===r);return m===-1?null:(i.notificationPresets[m]={...i.notificationPresets[m],name:l,notification_types:c,updated_at:new Date().toISOString()},Nt(i),i.notificationPresets[m])},async deleteNotificationPreset(r){if(Q){const{error:c}=await z.from("notification_presets").delete().eq("id",r);if(c)throw console.error("Error deleting notification preset:",c),c;return!0}const l=Qe();return l.notificationPresets&&(l.notificationPresets=l.notificationPresets.filter(c=>c.id!==r),Nt(l)),!0},async getDumpSites(r){if(Q){const{data:c,error:i}=await z.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",r).eq("active",!0).order("name");return i?(console.error("Error fetching dump sites:",i),[]):c||[]}return(Qe().dumpSites||[]).filter(c=>c.company_id===r&&c.active)},async createDumpSite(r,l,c="",i=""){if(Q){const{data:g,error:f}=await z.from("dump_sites").insert({company_id:r,name:l,address:c,notes:i,active:!0}).select().single();if(f)throw console.error("Error creating dump site:",f),f;return g}const m=Qe();m.dumpSites||(m.dumpSites=[]);const u={id:crypto.randomUUID(),company_id:r,name:l,address:c,notes:i,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return m.dumpSites.push(u),Nt(m),u},async updateDumpSite(r,l){if(Q){const{data:m,error:u}=await z.from("dump_sites").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(u)throw console.error("Error updating dump site:",u),u;return m}const c=Qe();if(!c.dumpSites)return null;const i=c.dumpSites.findIndex(m=>m.id===r);return i===-1?null:(c.dumpSites[i]={...c.dumpSites[i],...l},Nt(c),c.dumpSites[i])},async deleteDumpSite(r){return this.updateDumpSite(r,{active:!1})},async setDumpSiteRate(r,l,c,i="load"){if(Q){const{data:f}=await z.from("dump_site_rates").select("id").eq("dump_site_id",r).eq("waste_type",l).maybeSingle();if(f){const{data:j,error:v}=await z.from("dump_site_rates").update({estimated_cost_per_load:c,unit:i}).eq("id",f.id).select().single();if(v)throw console.error("Error updating dump site rate:",v),v;return j}else{const{data:j,error:v}=await z.from("dump_site_rates").insert({dump_site_id:r,waste_type:l,estimated_cost_per_load:c,unit:i}).select().single();if(v)throw console.error("Error inserting dump site rate:",v),v;return j}}const m=Qe();m.dumpSiteRates||(m.dumpSiteRates=[]);const u=m.dumpSiteRates.findIndex(f=>f.dump_site_id===r&&f.waste_type===l),g={id:u>=0?m.dumpSiteRates[u].id:crypto.randomUUID(),dump_site_id:r,waste_type:l,estimated_cost_per_load:c,unit:i,created_at:new Date().toISOString()};return u>=0?m.dumpSiteRates[u]=g:m.dumpSiteRates.push(g),Nt(m),g},async getDumpSiteRates(r){if(Q){const{data:c,error:i}=await z.from("dump_site_rates").select("*").eq("dump_site_id",r);return i?(console.error("Error fetching dump site rates:",i),[]):c||[]}return(Qe().dumpSiteRates||[]).filter(c=>c.dump_site_id===r)},async getHaulOffs(r){if(Q){const{data:c,error:i}=await z.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",r).order("work_date",{ascending:!1});return i?(console.error("Error fetching haul-offs:",i),[]):c||[]}return(Qe().haulOffs||[]).filter(c=>c.project_id===r).sort((c,i)=>new Date(i.work_date)-new Date(c.work_date))},async createHaulOff(r,l){const c={project_id:r,dump_site_id:l.dumpSiteId,waste_type:l.wasteType,loads:l.loads,hauling_company:l.haulingCompany||"",work_date:l.workDate,notes:l.notes||"",estimated_cost:l.estimatedCost||0,created_by:l.createdBy||""};if(Q){const{data:u,error:g}=await z.from("haul_offs").insert(c).select().single();if(g)throw console.error("Error creating haul-off:",g),g;return u}const i=Qe();i.haulOffs||(i.haulOffs=[]);const m={...c,id:crypto.randomUUID(),created_at:new Date().toISOString()};return i.haulOffs.push(m),Nt(i),m},async calculateHaulOffCosts(r){const l=await this.getHaulOffs(r);let c=0,i=0;const m={},u=[],g={};l.forEach(j=>{const v=parseFloat(j.estimated_cost)||0,x=parseInt(j.loads)||0;c+=v,i+=x,m[j.waste_type]||(m[j.waste_type]={loads:0,cost:0}),m[j.waste_type].loads+=x,m[j.waste_type].cost+=v,g[j.work_date]||(g[j.work_date]={date:j.work_date,loads:0,cost:0}),g[j.work_date].loads+=x,g[j.work_date].cost+=v}),Object.values(g).sort((j,v)=>new Date(v.date)-new Date(j.date)).forEach(j=>u.push(j));const f=u.length;return{totalCost:c,totalLoads:i,byWasteType:m,byDate:u,daysWithHaulOff:f,avgDailyHaulOffCost:f>0?c/f:0}},subscribeToHaulOffs(r,l){return Q?z.channel(`haul_offs:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${r}`},l).subscribe():null},async createCOR(r,l=0){if(Q){let c=r.cor_number;l>0&&(c=await this.getNextCORNumber(r.project_id));const{data:i,error:m}=await z.from("change_orders").insert({company_id:r.company_id,project_id:r.project_id,area_id:r.area_id||null,cor_number:c,title:r.title,description:r.description||"",scope_of_work:r.scope_of_work,period_start:r.period_start,period_end:r.period_end,status:"draft",labor_markup_percent:r.labor_markup_percent??1500,materials_markup_percent:r.materials_markup_percent??1500,equipment_markup_percent:r.equipment_markup_percent??1500,subcontractors_markup_percent:r.subcontractors_markup_percent??500,liability_insurance_percent:r.liability_insurance_percent??144,bond_percent:r.bond_percent??100,license_fee_percent:r.license_fee_percent??10,created_by:r.created_by||null}).select().single();if((m?.code==="23505"||m?.code==="PGRST116"||m?.status===409||m?.message?.includes("duplicate")||m?.message?.includes("unique_cor_number"))&&l<3)return console.warn(`COR number conflict, retrying with fresh number (attempt ${l+1})`),this.createCOR(r,l+1);if(m)throw m;return i}return null},async updateCOR(r,l){if(Q){const{data:c,error:i}=await z.from("change_orders").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return c}return null},async deleteCOR(r){if(Q){const{error:l}=await z.from("change_orders").delete().eq("id",r);if(l)throw l}},async getCORs(r,l={}){if(Q){let c=z.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",r);l.status&&(c=c.eq("status",l.status)),l.area_id&&(c=c.eq("area_id",l.area_id)),l.date_start&&(c=c.gte("period_start",l.date_start)),l.date_end&&(c=c.lte("period_end",l.date_end)),c=c.order("created_at",{ascending:!1});const{data:i,error:m}=await c;if(m)throw m;return i}return[]},async getCORById(r){if(Q){const{data:l,error:c}=await z.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              *,
              t_and_m_workers (*),
              t_and_m_items (
                *,
                materials_equipment (name, unit, cost_per_unit, category)
              )
            )
          )
        `).eq("id",r).single();if(c)throw c;return l}return null},async getCORsByArea(r,l){if(Q){const{data:c,error:i}=await z.from("change_orders").select("*").eq("project_id",r).eq("area_id",l).order("created_at",{ascending:!1});if(i)throw i;return c}return[]},async getAssignableCORs(r){if(Q){const{data:l,error:c}=await z.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",r).in("status",["draft","pending_approval","approved"]).order("cor_number",{ascending:!0});if(c)throw c;return l||[]}return[]},async getNextCORNumber(r){if(Q){const{data:l,error:c}=await z.from("change_orders").select("cor_number").eq("project_id",r);if(c)throw c;if(l&&l.length>0){let i=0;for(const m of l){const u=m.cor_number?.match(/COR #(\d+)/);if(u){const g=parseInt(u[1]);g>i&&(i=g)}}return`COR #${i+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(r,l){if(Q){const c=Math.round(l.regular_hours*l.regular_rate),i=Math.round(l.overtime_hours*l.overtime_rate),m=c+i,{data:u,error:g}=await z.from("change_order_labor").insert({change_order_id:r,labor_class:l.labor_class,wage_type:l.wage_type||"standard",regular_hours:l.regular_hours||0,overtime_hours:l.overtime_hours||0,regular_rate:l.regular_rate||0,overtime_rate:l.overtime_rate||0,regular_total:c,overtime_total:i,total:m,sort_order:l.sort_order||0,source_ticket_id:l.source_ticket_id||null}).select().single();if(g)throw g;return u}return null},async updateCORLaborItem(r,l){if(Q){let c={...l};if(l.regular_hours!==void 0||l.regular_rate!==void 0||l.overtime_hours!==void 0||l.overtime_rate!==void 0){const{data:u}=await z.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",r).single(),g=l.regular_hours??u?.regular_hours??0,f=l.overtime_hours??u?.overtime_hours??0,j=l.regular_rate??u?.regular_rate??0,v=l.overtime_rate??u?.overtime_rate??0;c.regular_total=Math.round(g*j),c.overtime_total=Math.round(f*v),c.total=c.regular_total+c.overtime_total}const{data:i,error:m}=await z.from("change_order_labor").update(c).eq("id",r).select().single();if(m)throw m;return i}return null},async deleteCORLaborItem(r){if(Q){const{error:l}=await z.from("change_order_labor").delete().eq("id",r);if(l)throw l}},async addCORMaterialItem(r,l){if(Q){const c=Math.round(l.quantity*l.unit_cost),{data:i,error:m}=await z.from("change_order_materials").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"each",unit_cost:l.unit_cost||0,total:c,source_type:l.source_type||"custom",source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(m)throw m;return i}return null},async updateCORMaterialItem(r,l){if(Q){let c={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:u}=await z.from("change_order_materials").select("quantity, unit_cost").eq("id",r).single(),g=l.quantity??u?.quantity??1,f=l.unit_cost??u?.unit_cost??0;c.total=Math.round(g*f)}const{data:i,error:m}=await z.from("change_order_materials").update(c).eq("id",r).select().single();if(m)throw m;return i}return null},async deleteCORMaterialItem(r){if(Q){const{error:l}=await z.from("change_order_materials").delete().eq("id",r);if(l)throw l}},async addCOREquipmentItem(r,l){if(Q){const c=Math.round(l.quantity*l.unit_cost),{data:i,error:m}=await z.from("change_order_equipment").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"day",unit_cost:l.unit_cost||0,total:c,source_type:l.source_type||"custom",source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(m)throw m;return i}return null},async updateCOREquipmentItem(r,l){if(Q){let c={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:u}=await z.from("change_order_equipment").select("quantity, unit_cost").eq("id",r).single(),g=l.quantity??u?.quantity??1,f=l.unit_cost??u?.unit_cost??0;c.total=Math.round(g*f)}const{data:i,error:m}=await z.from("change_order_equipment").update(c).eq("id",r).select().single();if(m)throw m;return i}return null},async deleteCOREquipmentItem(r){if(Q){const{error:l}=await z.from("change_order_equipment").delete().eq("id",r);if(l)throw l}},async addCORSubcontractorItem(r,l){if(Q){const c=Math.round(l.quantity*l.unit_cost),{data:i,error:m}=await z.from("change_order_subcontractors").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"lump sum",unit_cost:l.unit_cost||0,total:c,source_type:l.source_type||"custom",source_reference:l.source_reference||null,sort_order:l.sort_order||0}).select().single();if(m)throw m;return i}return null},async updateCORSubcontractorItem(r,l){if(Q){let c={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:u}=await z.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",r).single(),g=l.quantity??u?.quantity??1,f=l.unit_cost??u?.unit_cost??0;c.total=Math.round(g*f)}const{data:i,error:m}=await z.from("change_order_subcontractors").update(c).eq("id",r).select().single();if(m)throw m;return i}return null},async deleteCORSubcontractorItem(r){if(Q){const{error:l}=await z.from("change_order_subcontractors").delete().eq("id",r);if(l)throw l}},async addBulkLaborItems(r,l){if(Q&&l.length>0){const c=l.map((u,g)=>{const f=Math.round(u.regular_hours*u.regular_rate),j=Math.round(u.overtime_hours*u.overtime_rate);return{change_order_id:r,labor_class:u.labor_class,wage_type:u.wage_type||"standard",regular_hours:u.regular_hours||0,overtime_hours:u.overtime_hours||0,regular_rate:u.regular_rate||0,overtime_rate:u.overtime_rate||0,regular_total:f,overtime_total:j,total:f+j,sort_order:u.sort_order??g,source_ticket_id:u.source_ticket_id||null}}),{data:i,error:m}=await z.from("change_order_labor").insert(c).select();if(m)throw m;return i}return[]},async addBulkMaterialItems(r,l){if(Q&&l.length>0){const c=l.map((u,g)=>({change_order_id:r,description:u.description,quantity:u.quantity||1,unit:u.unit||"each",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,source_ticket_id:u.source_ticket_id||null,sort_order:u.sort_order??g})),{data:i,error:m}=await z.from("change_order_materials").insert(c).select();if(m)throw m;return i}return[]},async addBulkEquipmentItems(r,l){if(Q&&l.length>0){const c=l.map((u,g)=>({change_order_id:r,description:u.description,quantity:u.quantity||1,unit:u.unit||"day",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,source_ticket_id:u.source_ticket_id||null,sort_order:u.sort_order??g})),{data:i,error:m}=await z.from("change_order_equipment").insert(c).select();if(m)throw m;return i}return[]},async addBulkSubcontractorItems(r,l){if(Q&&l.length>0){const c=l.map((u,g)=>({change_order_id:r,description:u.description,quantity:u.quantity||1,unit:u.unit||"lump sum",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,sort_order:u.sort_order??g})),{data:i,error:m}=await z.from("change_order_subcontractors").insert(c).select();if(m)throw m;return i}return[]},async clearCORLineItems(r){Q&&(await z.from("change_order_labor").delete().eq("change_order_id",r),await z.from("change_order_materials").delete().eq("change_order_id",r),await z.from("change_order_equipment").delete().eq("change_order_id",r),await z.from("change_order_subcontractors").delete().eq("change_order_id",r))},async saveCORLineItems(r,{laborItems:l,materialItems:c,equipmentItems:i,subcontractorItems:m}){if(Q){await this.clearCORLineItems(r);const u=await Promise.all([l?.length>0?this.addBulkLaborItems(r,l):[],c?.length>0?this.addBulkMaterialItems(r,c):[],i?.length>0?this.addBulkEquipmentItems(r,i):[],m?.length>0?this.addBulkSubcontractorItems(r,m):[]]);return{labor:u[0],materials:u[1],equipment:u[2],subcontractors:u[3]}}return null},async assignTicketToCOR(r,l){if(Q){const{error:c}=await z.rpc("assign_ticket_to_cor",{p_ticket_id:r,p_cor_id:l});if(c)throw Wt.error("database",{message:c.message,operation:"assignTicketToCOR",extra:{ticketId:r,corId:l}}),c;return{ticket_id:r,change_order_id:l}}return null},async unassignTicketFromCOR(r,l){if(Q){const{error:c}=await z.rpc("unassign_ticket_from_cor",{p_ticket_id:r,p_cor_id:l});if(c)throw Wt.error("database",{message:c.message,operation:"unassignTicketFromCOR",extra:{ticketId:r,corId:l}}),c}},async checkTicketCORIntegrity(){if(Q){const{data:r,error:l}=await z.rpc("check_ticket_cor_integrity");if(l)throw l;return r||[]}return[]},async fixTicketCORIntegrity(){if(Q){const{data:r,error:l}=await z.rpc("fix_ticket_cor_integrity");if(l)throw l;return r}return 0},async getTicketsForCOR(r){if(Q){const{data:l,error:c}=await z.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",r);if(c)throw c;return l}return[]},async getUnassignedTickets(r){if(Q){const{data:l,error:c}=await z.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(c)throw c;return l}return[]},async importTicketDataToCOR(r,l,c,i,m){if(Q){const{data:u,error:g}=await z.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",r).single();if(g)throw g;const{data:f,error:j}=await z.from("labor_rates").select("*").eq("company_id",c).eq("work_type",i||"demolition").eq("job_type",m||"standard");if(j)throw j;const v={};f?.forEach(B=>{v[B.role.toLowerCase()]=B});const x={};u.t_and_m_workers?.forEach(B=>{const I=(B.role||"laborer").toLowerCase();x[I]||(x[I]={regular_hours:0,overtime_hours:0}),x[I].regular_hours+=parseFloat(B.hours)||0,x[I].overtime_hours+=parseFloat(B.overtime_hours)||0});const R=Object.entries(x).map(([B,I])=>{const re=v[B]||{regular_rate:0,overtime_rate:0},w=Math.round((parseFloat(re.regular_rate)||0)*100),T=Math.round((parseFloat(re.overtime_rate)||0)*100);return{labor_class:B.charAt(0).toUpperCase()+B.slice(1),wage_type:m||"standard",regular_hours:I.regular_hours,overtime_hours:I.overtime_hours,regular_rate:w,overtime_rate:T,source_ticket_id:r}});R.length>0&&await this.addBulkLaborItems(l,R);const A=[],q=[];u.t_and_m_items?.forEach(B=>{const I=B.custom_name||B.materials_equipment?.name||"Unknown Item",re=B.custom_category||B.materials_equipment?.category||"Other",w=B.materials_equipment?.unit||"each",T=Math.round((parseFloat(B.materials_equipment?.cost_per_unit)||0)*100),C={description:I,quantity:B.quantity||1,unit:w,unit_cost:T,source_type:"backup_sheet",source_ticket_id:r};re==="Equipment"?q.push(C):A.push(C)}),A.length>0&&await this.addBulkMaterialItems(l,A),q.length>0&&await this.addBulkEquipmentItems(l,q);const{error:F}=await z.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString()}).eq("change_order_id",l).eq("ticket_id",r);if(F)throw F;return{laborItems:R,materialItems:A,equipmentItems:q}}return null},async reimportTicketDataToCOR(r,l,c,i,m){return Q?(await z.from("change_order_labor").delete().eq("change_order_id",l).eq("source_ticket_id",r),await z.from("change_order_materials").delete().eq("change_order_id",l).eq("source_ticket_id",r),await z.from("change_order_equipment").delete().eq("change_order_id",l).eq("source_ticket_id",r),this.importTicketDataToCOR(r,l,c,i,m)):null},async recalculateCOR(r){if(Q){const{error:l}=await z.rpc("recalculate_cor_totals",{cor_id:r});if(l)throw l;return this.getCORById(r)}return null},async updateCORMarkupPercentages(r,l){if(Q){const c={};l.labor!==void 0&&(c.labor_markup_percent=l.labor),l.materials!==void 0&&(c.materials_markup_percent=l.materials),l.equipment!==void 0&&(c.equipment_markup_percent=l.equipment),l.subcontractors!==void 0&&(c.subcontractors_markup_percent=l.subcontractors);const{data:i,error:m}=await z.from("change_orders").update(c).eq("id",r).select().single();if(m)throw m;return i}return null},async updateCORFeePercentages(r,l){if(Q){const c={};l.liabilityInsurance!==void 0&&(c.liability_insurance_percent=l.liabilityInsurance),l.bond!==void 0&&(c.bond_percent=l.bond),l.licenseFee!==void 0&&(c.license_fee_percent=l.licenseFee);const{data:i,error:m}=await z.from("change_orders").update(c).eq("id",r).select().single();if(m)throw m;return i}return null},async submitCORForApproval(r){if(Q){const{data:l,error:c}=await z.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw c;return l}return null},async approveCOR(r,l){if(Q){const{data:c,error:i}=await z.from("change_orders").update({status:"approved",approved_by:l,approved_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return c}return null},async rejectCOR(r,l=null){if(Q){const{data:c,error:i}=await z.from("change_orders").update({status:"rejected",rejection_reason:l}).eq("id",r).select().single();if(i)throw i;return c}return null},async markCORAsBilled(r){if(Q){const{data:l,error:c}=await z.from("change_orders").update({status:"billed"}).eq("id",r).select().single();if(c)throw c;return l}return null},async closeCOR(r){if(Q){const{data:l,error:c}=await z.from("change_orders").update({status:"closed"}).eq("id",r).select().single();if(c)throw c;return l}return null},async saveCORSignature(r,l,c){if(Q){const{data:i,error:m}=await z.from("change_orders").update({gc_signature_data:l,gc_signature_name:c,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",r).select().single();if(m)throw m;return i}return null},async getCORStats(r){if(Q){const{data:l,error:c}=await z.from("change_orders").select("status, cor_total").eq("project_id",r);if(c)throw c;const i={total_cors:l.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return l.forEach(m=>{switch(m.status){case"draft":i.draft_count++;break;case"pending_approval":i.pending_count++,i.total_pending_value+=m.cor_total||0;break;case"approved":i.approved_count++,i.total_approved_value+=m.cor_total||0;break;case"rejected":i.rejected_count++;break;case"billed":case"closed":i.billed_count++,i.total_billed_value+=m.cor_total||0;break}}),i}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(r,l){return Q?z.channel(`change_orders:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCorTickets(r,l){return Q?z.channel(`cor-tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${r}`},l).subscribe():null},async createSignatureRequest(r,l,c,i,m=null,u=null){if(Q){const{data:g,error:f}=await z.rpc("generate_signature_token");if(f)throw f;const{data:j,error:v}=await z.from("signature_requests").insert({document_type:r,document_id:l,company_id:c,project_id:i,signature_token:g,expires_at:u,created_by:m}).select().single();if(v)throw v;return j}return null},async getSignatureRequestByToken(r){if(Q){await z.rpc("increment_signature_view_count",{token:r});const{data:l,error:c}=await z.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",r).single();if(c)throw c;return l}return null},async getSignatureRequestsForDocument(r,l){if(Q){const{data:c,error:i}=await z.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",r).eq("document_id",l).order("created_at",{ascending:!1});if(i)throw i;return c||[]}return[]},async addSignature(r,l,c){if(Q){const{data:i,error:m}=await z.from("signatures").insert({signature_request_id:r,signature_slot:l,signature_image:c.signature,signer_name:c.signerName,signer_title:c.signerTitle||null,signer_company:c.signerCompany||null,signed_at:c.signedAt||new Date().toISOString(),ip_address:c.ipAddress||null,user_agent:c.userAgent||null}).select().single();if(m)throw m;return i}return null},async syncSignatureToDocument(r,l){if(!Q)return null;const{document_type:c,document_id:i}=l,m=r.signature_slot,u={};m===1?(u.gc_signature_data=r.signature_image,u.gc_signature_name=r.signer_name,u.gc_signature_title=r.signer_title,u.gc_signature_company=r.signer_company,u.gc_signature_date=r.signed_at,u.gc_signature_ip=r.ip_address):m===2&&(u.client_signature_data=r.signature_image,u.client_signature_name=r.signer_name,u.client_signature_title=r.signer_title,u.client_signature_company=r.signer_company,u.client_signature_date=r.signed_at,u.client_signature_ip=r.ip_address);const g=c==="cor"?"change_orders":"t_and_m_tickets",{data:f,error:j}=await z.from(g).update(u).eq("id",i).select().single();if(j)throw j;return f},async revokeSignatureRequest(r){if(Q){const{data:l,error:c}=await z.from("signature_requests").update({status:"revoked"}).eq("id",r).select().single();if(c)throw c;return l}return null},async getDocumentForSigning(r,l){if(!Q)return null;if(r==="cor"){const{data:c,error:i}=await z.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",l).single();if(i)throw i;return c}else if(r==="tm_ticket"){const{data:c,error:i}=await z.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (*)
        `).eq("id",l).single();if(i)throw i;return c}return null},async getProjectCosts(r){if(Q){const{data:c,error:i}=await z.from("project_costs").select("*").eq("project_id",r).order("cost_date",{ascending:!1});return i?(console.error("Error fetching project costs:",i),[]):c||[]}return(Qe().projectCosts||[]).filter(c=>c.project_id===r).sort((c,i)=>new Date(i.cost_date)-new Date(c.cost_date))},async addProjectCost(r,l,c){const i={project_id:r,company_id:l,category:c.category,description:c.description,amount:parseFloat(c.amount),cost_date:c.cost_date||new Date().toISOString().split("T")[0],notes:c.notes||null,created_by:c.created_by||null};if(Q){const{data:g,error:f}=await z.from("project_costs").insert(i).select().single();if(f)throw console.error("Error adding project cost:",f),f;return g}const m=Qe();m.projectCosts||(m.projectCosts=[]);const u={...i,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return m.projectCosts.push(u),Nt(m),u},async updateProjectCost(r,l){const c={category:l.category,description:l.description,amount:parseFloat(l.amount),cost_date:l.cost_date,notes:l.notes||null,updated_at:new Date().toISOString()};if(Q){const{data:u,error:g}=await z.from("project_costs").update(c).eq("id",r).select().single();if(g)throw console.error("Error updating project cost:",g),g;return u}const i=Qe();if(!i.projectCosts)return null;const m=i.projectCosts.findIndex(u=>u.id===r);return m===-1?null:(i.projectCosts[m]={...i.projectCosts[m],...c},Nt(i),i.projectCosts[m])},async deleteProjectCost(r){if(Q){const{error:c}=await z.from("project_costs").delete().eq("id",r);if(c)throw console.error("Error deleting project cost:",c),c;return!0}const l=Qe();return l.projectCosts&&(l.projectCosts=l.projectCosts.filter(c=>c.id!==r),Nt(l)),!0},async getProjectCostsSummary(r){const l=await this.getProjectCosts(r),c={};let i=0;return l.forEach(m=>{const u=parseFloat(m.amount)||0;i+=u,c[m.category]||(c[m.category]={category:m.category,total:0,count:0,items:[]}),c[m.category].total+=u,c[m.category].count++,c[m.category].items.push(m)}),Object.values(c).forEach(m=>{m.percentage=i>0?m.total/i*100:0}),{totalCost:i,byCategory:c,itemCount:l.length}}};tf(async r=>{if(r&&Q){console.log("Back online - syncing pending actions...");try{const l=await Zx(ee);l.synced>0&&console.log(`Synced ${l.synced} pending actions`),l.failed>0&&console.warn(`Failed to sync ${l.failed} actions`)}catch(l){console.error("Error syncing pending actions:",l)}}});const nf=p.createContext(),Fa={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function Rn({children:r,companyId:l}){const[c,i]=p.useState(Fa),[m,u]=p.useState(!0);p.useEffect(()=>{l?g(l):f()},[l]),p.useEffect(()=>{x(c)},[c]);const g=async q=>{try{if(u(!0),!Q){i(Fa),u(!1);return}const{data:F,error:B}=await z.from("company_branding").select("*").eq("company_id",q).single();B?(B.code==="PGRST116"?await j(q):console.error("Error loading branding:",B),i(Fa)):i({...Fa,...F})}catch(F){console.error("Error in loadBranding:",F),i(Fa)}finally{u(!1)}},f=async()=>{try{u(!0);const q=window.location.hostname;if(q==="localhost"||q==="127.0.0.1"){i(Fa),u(!1);return}if(!Q){i(Fa),u(!1);return}const{data:F,error:B}=await z.rpc("get_branding_by_domain",{domain_name:q});B||!F||F.length===0?i(Fa):i({...Fa,...F[0]})}catch(q){console.error("Error loading branding by domain:",q),i(Fa)}finally{u(!1)}},j=async q=>{try{const{data:F,error:B}=await z.from("company_branding").insert({company_id:q,...Fa}).select().single();B&&console.error("Error creating default branding:",B)}catch(F){console.error("Error in createDefaultBranding:",F)}},v=async q=>{try{if(!Q)return i(C=>({...C,...q})),{success:!0};if(!l)return{success:!1,error:"No company ID"};const F={},B=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const C of B)q[C]!==void 0&&(F[C]=q[C]);const{data:I,error:re}=await z.from("company_branding").select("id").eq("company_id",l).single();if(re&&re.code==="PGRST116"){const{data:C,error:W}=await z.from("company_branding").insert({company_id:l,...F}).select().single();return W?(console.error("Error creating branding:",W),{success:!1,error:W.message}):(i({...Fa,...C}),{success:!0,data:C})}const{data:w,error:T}=await z.from("company_branding").update(F).eq("company_id",l).select().single();return T?(console.error("Error updating branding:",T),{success:!1,error:T.message}):(i({...Fa,...w}),{success:!0,data:w})}catch(F){return console.error("Error in updateBranding:",F),{success:!1,error:F.message}}},x=q=>{const F=document.documentElement;if(F.style.setProperty("--primary-color",q.primary_color),F.style.setProperty("--secondary-color",q.secondary_color),q.favicon_url){let B=document.querySelector("link[rel*='icon']");B||(B=document.createElement("link"),B.rel="icon",document.head.appendChild(B)),B.href=q.favicon_url}document.title=q.custom_app_name||"FieldSync"},A={branding:c,loading:m,updateBranding:v,uploadBrandingImage:async(q,F)=>{try{if(!Q)return{success:!0,url:URL.createObjectURL(q)};const B=q.name.split(".").pop(),re=`branding/${`${l}/${F}-${Date.now()}.${B}`}`,{data:w,error:T}=await z.storage.from("public").upload(re,q,{cacheControl:"3600",upsert:!0});if(T)return console.error("Error uploading image:",T),{success:!1,error:T.message};const{data:{publicUrl:C}}=z.storage.from("public").getPublicUrl(re);return{success:!0,url:C}}catch(B){return console.error("Error in uploadBrandingImage:",B),{success:!1,error:B.message}}},refreshBranding:()=>l?g(l):f()};return e.jsx(nf.Provider,{value:A,children:r})}function wr(){const r=p.useContext(nf);if(!r)throw new Error("useBranding must be used within a BrandingProvider");return r}const rf=p.createContext();function zn({children:r}){const[l,c]=p.useState(()=>{const m=localStorage.getItem("fieldsync-theme");return m==="light"||m==="dark"?m:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"});p.useEffect(()=>{document.documentElement.setAttribute("data-theme",l),localStorage.setItem("fieldsync-theme",l)},[l]),p.useEffect(()=>{const m=window.matchMedia("(prefers-color-scheme: light)"),u=g=>{localStorage.getItem("fieldsync-theme")||c(g.matches?"light":"dark")};return m.addEventListener("change",u),()=>m.removeEventListener("change",u)},[]);const i=()=>{c(m=>m==="dark"?"light":"dark")};return e.jsx(rf.Provider,{value:{theme:l,setTheme:c,toggleTheme:i},children:r})}function ej(){const r=p.useContext(rf);if(!r)throw new Error("useTheme must be used within a ThemeProvider");return r}const tj=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),aj=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(l,c,i)=>i?i.toUpperCase():c.toLowerCase()),kp=r=>{const l=aj(r);return l.charAt(0).toUpperCase()+l.slice(1)},lf=(...r)=>r.filter((l,c,i)=>!!l&&l.trim()!==""&&i.indexOf(l)===c).join(" ").trim(),sj=r=>{for(const l in r)if(l.startsWith("aria-")||l==="role"||l==="title")return!0};var nj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const rj=p.forwardRef(({color:r="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:i,className:m="",children:u,iconNode:g,...f},j)=>p.createElement("svg",{ref:j,...nj,width:l,height:l,stroke:r,strokeWidth:i?Number(c)*24/Number(l):c,className:lf("lucide",m),...!u&&!sj(f)&&{"aria-hidden":"true"},...f},[...g.map(([v,x])=>p.createElement(v,x)),...Array.isArray(u)?u:[u]]));const Ue=(r,l)=>{const c=p.forwardRef(({className:i,...m},u)=>p.createElement(rj,{ref:u,iconNode:l,className:lf(`lucide-${tj(kp(r))}`,`lucide-${r}`,i),...m}));return c.displayName=kp(r),c};const lj=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],ij=Ue("bell",lj);const cj=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],pn=Ue("briefcase",cj);const oj=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Hi=Ue("building-2",oj);const dj=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],uj=Ue("building",dj);const mj=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Fn=Ue("calendar",mj);const hj=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],xl=Ue("camera",hj);const pj=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Wa=Ue("check",pj);const fj=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ya=Ue("chevron-down",fj);const gj=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],xj=Ue("chevron-left",gj);const jj=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],hs=Ue("chevron-right",jj);const vj=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],cf=Ue("chevron-up",vj);const yj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Hn=Ue("circle-alert",yj);const bj=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ms=Ue("circle-check-big",bj);const _j=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],rd=Ue("circle-check",_j);const Nj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ep=Ue("circle-x",Nj);const Sj=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],Ja=Ue("clipboard-list",Sj);const wj=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],hn=Ue("clock",wj);const Cj=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],bd=Ue("copy",Cj);const kj=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Sr=Ue("dollar-sign",kj);const Ej=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],of=Ue("download",Ej);const Dj=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],df=Ue("ellipsis",Dj);const Mj=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Dp=Ue("external-link",Mj);const Tj=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Aj=Ue("eye",Tj);const Rj=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Aa=Ue("file-text",Rj);const zj=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],qj=Ue("flame",zj);const Oj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Lj=Ue("globe",Oj);const Uj=[["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["rect",{x:"2",y:"15",width:"20",height:"4",rx:"1",key:"g3x8cw"}]],oa=Ue("hard-hat",Uj);const Hj=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Bj=Ue("image",Hj);const Fj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],_d=Ue("info",Fj);const $j=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Mp=Ue("layout-grid",$j);const Vj=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Yj=Ue("link-2",Vj);const Gj=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Cd=Ue("link",Gj);const Pj=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Qj=Ue("loader-circle",Pj);const Xj=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Tp=Ue("lock",Xj);const Ij=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Zj=Ue("map-pin",Ij);const Jj=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Rs=Ue("message-square",Jj);const Wj=[["path",{d:"M5 12h14",key:"1ays0h"}]],Nd=Ue("minus",Wj);const Kj=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],ev=Ue("moon",Kj);const tv=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],ps=Ue("package",tv);const av=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],gl=Ue("pen-line",av);const sv=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],nv=Ue("pen-tool",sv);const rv=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],kd=Ue("pen",rv);const lv=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],uf=Ue("pencil",lv);const iv=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],cv=Ue("percent",iv);const ov=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],dv=Ue("phone",ov);const uv=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ta=Ue("plus",uv);const mv=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],hv=Ue("refresh-cw",mv);const pv=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ed=Ue("rotate-ccw",pv);const fv=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Ap=Ue("save",fv);const gv=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],xv=Ue("search",gv);const jv=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Dd=Ue("send",jv);const vv=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Fi=Ue("shield",vv);const yv=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],bv=Ue("square-check-big",yv);const _v=[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]],Nv=Ue("stamp",_v);const Sv=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],wv=Ue("sun",Sv);const Cv=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],qs=Ue("trash-2",Cv);const kv=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],mf=Ue("trending-down",kv);const Ev=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],hf=Ue("trending-up",Ev);const Dv=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],jl=Ue("triangle-alert",Dv);const Mv=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],Ka=Ue("truck",Mv);const Tv=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Av=Ue("upload",Tv);const Rv=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],pf=Ue("user-check",Rv);const zv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],ff=Ue("user-minus",zv);const qv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Ov=Ue("user-plus",qv);const Lv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Uv=Ue("user-x",Lv);const Hv=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Md=Ue("user",Hv);const Bv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Os=Ue("users",Bv);const Fv=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],vl=Ue("wrench",Fv);const $v=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],es=Ue("x",$v);const Vv=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Sd=Ue("zap",Vv);function ls({className:r="",showPoweredBy:l=!1}){const{branding:c}=wr();return e.jsxs("div",{className:`app-logo ${r}`,children:[c.logo_url?e.jsx("img",{src:c.logo_url,alt:c.custom_app_name||"Logo",className:"custom-logo"}):e.jsxs("div",{className:"logo",children:[c.custom_app_name||"Field",e.jsx("span",{children:"Sync"})]}),l&&!c.hide_fieldsync_branding&&e.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function Yv({onForemanAccess:r,onOfficeLogin:l,onShowToast:c}){const[i,m]=p.useState(null),[u,g]=p.useState(""),[f,j]=p.useState(null),[v,x]=p.useState(""),[R,A]=p.useState(!1),[q,F]=p.useState(""),[B,I]=p.useState(""),[re,w]=p.useState(1),[T,C]=p.useState(null),[W,le]=p.useState(""),[O,U]=p.useState(""),[Y,J]=p.useState(""),[D,_]=p.useState(""),y=E=>{const ue=E.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);g(ue)},S=async()=>{if(u.length<2){c("Enter company code","error");return}A(!0);try{const E=await ee.getCompanyByCode(u);E?j(E):(c("Invalid company code","error"),g(""))}catch{c("Error checking code","error")}finally{A(!1)}},K=async E=>{if(E.length===4){A(!0);try{const ue=await ee.getProjectByPinAndCompany(E,f.id);ue?r(ue):(c("Invalid PIN","error"),x(""))}catch{c("Error checking PIN","error")}finally{A(!1)}}},k=E=>{if(v.length<4){const ue=v+E;x(ue),ue.length===4&&setTimeout(()=>K(ue),200)}},ie=()=>{x(E=>E.slice(0,-1))},M=()=>{j(null),x("")},G=()=>{if(!q.trim()||!B.trim()){c("Enter email and password","error");return}l(q,B)},L=async()=>{if(u.length<2){c("Enter company code","error");return}A(!0);try{const E=await ee.getCompanyByCode(u);E?(C(E),w(2)):(c("Invalid company code","error"),g(""))}catch{c("Error checking code","error")}finally{A(!1)}},P=async()=>{if(!W.trim()){c("Enter office code","error");return}A(!0);try{const{data:E,error:ue}=await z.rpc("verify_office_code",{company_id:T.id,code:W.trim()});if(ue)throw ue;E===!0?w(3):(c("Invalid office code","error"),le(""))}catch{c("Error verifying code","error")}finally{A(!1)}},$=async()=>{if(!O.trim()){c("Enter your name","error");return}if(!Y.trim()||!Y.includes("@")){c("Enter valid email","error");return}if(D.length<6){c("Password must be 6+ characters","error");return}A(!0);try{const E=Y.toLowerCase().trim(),{data:ue,error:Me}=await z.auth.signUp({email:E,password:D});let Te;if(Me?.message?.includes("already registered")||ue?.user&&ue.user.identities?.length===0){const{data:ze,error:Re}=await z.auth.signInWithPassword({email:E,password:D});if(Re){c("Account exists with different password. Use your existing password.","error"),A(!1);return}Te=ze.user.id;const{data:qe}=await z.from("user_companies").select("id, status").eq("user_id",Te).eq("company_id",T.id).maybeSingle();if(qe){qe.status==="active"?(c("You already belong to this company. Logging you in...","success"),setTimeout(()=>window.location.reload(),1e3)):qe.status==="pending"?(c("Your request is still pending approval.","error"),await z.auth.signOut()):(c("Your membership was removed. Contact the company admin.","error"),await z.auth.signOut());return}const{error:Ie}=await z.from("user_companies").insert({user_id:Te,company_id:T.id,role:"member",status:"pending"});if(Ie)throw console.error("Error adding to user_companies:",Ie),await z.auth.signOut(),new Error("Failed to submit join request");await z.auth.signOut(),c("Request to join submitted! Awaiting admin approval.","success")}else{if(Me)throw Me;{if(Te=ue.user?.id,!Te)throw new Error("Failed to create user");const{error:ze}=await z.from("users").insert({id:Te,email:E,password_hash:"managed_by_supabase_auth",name:O.trim(),company_id:T.id,role:"member",is_active:!0});if(ze)throw ze;const{error:Re}=await z.from("user_companies").insert({user_id:Te,company_id:T.id,role:"member",status:"pending"});if(Re)throw console.error("Error adding to user_companies:",Re),new Error("Failed to submit join request");await z.auth.signOut(),c("Account created! Awaiting admin approval.","success")}}}catch(E){console.error("Join error:",E),c(E.message||"Error creating account","error")}finally{A(!1)}};if(i===null)return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx(ls,{className:"entry-logo",showPoweredBy:!1}),e.jsxs("div",{className:"entry-buttons",children:[e.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>m("foreman"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(oa,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Foreman"}),e.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),e.jsxs("button",{className:"entry-mode-btn office",onClick:()=>m("office"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(pn,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Office"}),e.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(i==="foreman")return f?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:M,children:""}),e.jsx(ls,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:f.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),e.jsx("div",{className:"pin-display",children:[0,1,2,3].map(E=>e.jsx("div",{className:`pin-dot ${v.length>E?"filled":""}`,children:v.length>E?"":""},E))}),e.jsxs("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map(E=>e.jsx("button",{className:"num-btn",onClick:()=>k(E.toString()),disabled:R,children:E},E)),e.jsx("button",{className:"num-btn empty",disabled:!0}),e.jsx("button",{className:"num-btn",onClick:()=>k("0"),disabled:R,children:"0"}),e.jsx("button",{className:"num-btn backspace",onClick:ie,disabled:R||v.length===0,children:""})]}),R&&e.jsx("div",{className:"entry-loading",children:e.jsx("div",{className:"spinner"})})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m(null),children:""}),e.jsx(ls,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:u,onChange:E=>y(E.target.value),placeholder:"Company Code",disabled:R,autoFocus:!0,onKeyDown:E=>{E.key==="Enter"&&S()}}),e.jsx("button",{className:"entry-submit-btn",onClick:S,disabled:R||u.length<2,children:R?"...":""})]})]})});if(i==="office")return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m(null),children:""}),e.jsx(ls,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"email",value:q,onChange:E=>F(E.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:E=>{E.key==="Enter"&&G()}}),e.jsx("input",{type:"password",value:B,onChange:E=>I(E.target.value),placeholder:"Password",onKeyDown:E=>{E.key==="Enter"&&G()}}),e.jsx("button",{className:"entry-login-btn",onClick:G,children:"Sign In"})]}),e.jsxs("div",{className:"entry-signup-hint",children:[e.jsx("p",{children:"New employee?"}),e.jsx("button",{className:"entry-join-link",onClick:()=>m("join"),children:"Join your company"})]})]})});if(i==="join")return re===1?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m("office"),children:""}),e.jsx(ls,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),e.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:u,onChange:E=>y(E.target.value),placeholder:"Company Code",disabled:R,autoFocus:!0,onKeyDown:E=>{E.key==="Enter"&&L()}}),e.jsx("button",{className:"entry-submit-btn",onClick:L,disabled:R||u.length<2,children:R?"...":""})]})]})}):re===2?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{w(1),C(null),le("")},children:""}),e.jsx(ls,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:T?.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),e.jsx("p",{className:"entry-hint",children:"This code is only for office staff"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"password",value:W,onChange:E=>le(E.target.value),placeholder:"Office Code",disabled:R,autoFocus:!0,onKeyDown:E=>{E.key==="Enter"&&P()}}),e.jsx("button",{className:"entry-submit-btn",onClick:P,disabled:R||!W.trim(),children:R?"...":""})]})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{w(2),le("")},children:""}),e.jsx(ls,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:T?.name}),e.jsx("p",{className:"entry-subtitle",children:"Create your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"text",value:O,onChange:E=>U(E.target.value),placeholder:"Your Name",autoFocus:!0}),e.jsx("input",{type:"email",value:Y,onChange:E=>J(E.target.value),placeholder:"Email"}),e.jsx("input",{type:"password",value:D,onChange:E=>_(E.target.value),placeholder:"Password (6+ characters)",onKeyDown:E=>{E.key==="Enter"&&$()}}),e.jsx("button",{className:"entry-login-btn",onClick:$,disabled:R,children:R?"Creating...":"Join Company"})]}),e.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})})}function Ft(r){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}function Gv(r){if(!r||r.length===0)return 0;let l=0;return r.forEach(c=>{c.status==="done"&&(l+=c.weight)}),Math.round(l)}function Rp(r){if(!r||r.length===0)return{progress:0,earnedValue:0,totalValue:0,isValueBased:!1};if(r.some(i=>i.scheduled_value>0)){const i=r.reduce((g,f)=>g+(f.scheduled_value||0),0),m=r.filter(g=>g.status==="done").reduce((g,f)=>g+(f.scheduled_value||0),0);return{progress:i>0?Math.round(m/i*100):0,earnedValue:m,totalValue:i,isValueBased:!0}}const c=r.filter(i=>i.status==="done").reduce((i,m)=>i+(m.weight||0),0);return{progress:Math.round(c),earnedValue:0,totalValue:0,isValueBased:!1}}function gf(r){if(!r||r.length===0)return"not_started";const l=r.some(m=>m.status==="working"),c=r.some(m=>m.status==="done");return r.every(m=>m.status==="done")?"done":l||c?"working":"not_started"}function Pv(r){const l=gf(r);return l==="done"?"Complete":l==="working"?"In Progress":"Not Started"}function Qv(r,l=0){const c=new Date;c.setHours(0,0,0,0);const i={scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1};if(r.start_date&&r.end_date){const m=new Date(r.start_date),u=new Date(r.end_date);m.setHours(0,0,0,0),u.setHours(0,0,0,0);const g=Math.max(1,Math.ceil((u-m)/(1e3*60*60*24))),f=Math.max(0,Math.ceil((c-m)/(1e3*60*60*24))),j=Math.min(100,f/g*100),x=(r.progress||0)-j;i.scheduleVariance=Math.round(x),i.hasScheduleData=!0,x>5?(i.scheduleStatus="ahead",i.scheduleLabel=`Ahead of Schedule (+${i.scheduleVariance}%)`):x<-5?(i.scheduleStatus="behind",i.scheduleLabel=`Behind Schedule (${i.scheduleVariance}%)`):(i.scheduleStatus="on_track",i.scheduleLabel="On Track")}if(r.planned_man_days&&r.planned_man_days>0){const u=(r.progress||0)/100*r.planned_man_days;if(u>0&&l>0){const g=(l-u)/u*100;i.laborVariance=Math.round(g),i.hasLaborData=!0,g>10?(i.laborStatus="over",i.laborLabel=`Over Planned (+${i.laborVariance}% man-days)`):g<-10?(i.laborStatus="under",i.laborLabel=`Under Planned (${i.laborVariance}% man-days)`):(i.laborStatus="on_track",i.laborLabel="Labor On Track")}else l>0&&(i.hasLaborData=!0,i.laborLabel=`${l} man-days used`)}return i}function Xv(r,l=30){if(r.status==="archived"||r.progress<100)return!1;const c=r.areas||[];if(c.length===0||!c.every(g=>g.status==="done"))return!1;const m=c.reduce((g,f)=>{const j=new Date(f.updated_at);return j>g?j:g},new Date(0));return m.getTime()===0?!1:Math.floor((Date.now()-m.getTime())/(1e3*60*60*24))>=l}async function Iv(r,l=1920,c=.8){return!r.type.startsWith("image/")||r.size<500*1024?r:new Promise(i=>{const m=document.createElement("canvas"),u=m.getContext("2d"),g=new Image;g.onload=()=>{let{width:f,height:j}=g;f>l&&(j=Math.round(j*l/f),f=l);const v=1920;j>v&&(f=Math.round(f*v/j),j=v),m.width=f,m.height=j,u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.drawImage(g,0,0,f,j),m.toBlob(x=>{if(x){const R=r.name.replace(/\.[^/.]+$/,""),A=new File([x],`${R}.jpg`,{type:"image/jpeg",lastModified:Date.now()}),q=((1-x.size/r.size)*100).toFixed(1);console.log(`Image compressed: ${r.name} - ${(r.size/1024).toFixed(0)}KB  ${(x.size/1024).toFixed(0)}KB (${q}% smaller)`),i(A)}else console.warn("Image compression failed, using original"),i(r)},"image/jpeg",c),URL.revokeObjectURL(g.src)},g.onerror=()=>{console.warn("Failed to load image for compression, using original"),URL.revokeObjectURL(g.src),i(r)},g.src=URL.createObjectURL(r)})}const zp=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";function Td({documentType:r,documentId:l,companyId:c,projectId:i,documentTitle:m="",onClose:u,onShowToast:g}){const[f,j]=p.useState(!0),[v,x]=p.useState(!1),[R,A]=p.useState([]),[q,F]=p.useState(null),[B,I]=p.useState(!1),[re,w]=p.useState("never");p.useEffect(()=>{T()},[r,l]);const T=async()=>{try{j(!0);const Y=await ee.getSignatureRequestsForDocument(r,l);A(Y||[])}catch(Y){console.error("Error loading signature requests:",Y)}finally{j(!1)}},C=async()=>{try{x(!0);let Y=null;if(re!=="never"){const D=parseInt(re);Y=new Date,Y.setDate(Y.getDate()+D),Y=Y.toISOString()}const J=await ee.createSignatureRequest(r,l,c,i,null,Y);if(J){const D=`${window.location.origin}/sign/${J.signature_token}`;F(D),await T(),g?.("Signature link created","success")}}catch(Y){console.error("Error generating signature link:",Y),g?.("Failed to create signature link","error")}finally{x(!1)}},W=async Y=>{try{await navigator.clipboard.writeText(Y),I(!0),g?.("Link copied to clipboard","success"),setTimeout(()=>I(!1),2e3)}catch(J){console.error("Error copying to clipboard:",J)}},le=async Y=>{if(confirm("Are you sure you want to revoke this signature link? It will no longer be usable."))try{await ee.revokeSignatureRequest(Y),await T(),g?.("Signature link revoked","success")}catch(J){console.error("Error revoking signature request:",J),g?.("Failed to revoke link","error")}},O=Y=>{switch(Y){case"pending":return{label:"Awaiting Signatures",color:"#f59e0b",bg:"#fef3c7"};case"partially_signed":return{label:"1 of 2 Signed",color:"#3b82f6",bg:"#dbeafe"};case"completed":return{label:"Fully Signed",color:"#10b981",bg:"#d1fae5"};case"revoked":return{label:"Revoked",color:"#ef4444",bg:"#fee2e2"};case"expired":return{label:"Expired",color:"#6b7280",bg:"#f3f4f6"};default:return{label:Y,color:"#6b7280",bg:"#f3f4f6"}}},U=r==="cor"?"Change Order":"T&M Ticket";return e.jsx("div",{className:"modal-overlay",onClick:u,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content signature-link-modal",onClick:Y=>Y.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Get Signature Link"}),m&&e.jsx("span",{className:"modal-subtitle",children:m})]}),e.jsx("button",{className:"close-btn",onClick:u,"aria-label":"Close",children:e.jsx(es,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(Cd,{size:16}),"Create New Signature Link"]}),e.jsxs("p",{className:"section-description",children:["Generate a secure link that allows GC/Client to sign this ",U," without logging in."]}),e.jsxs("div",{className:"link-options",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("select",{value:re,onChange:Y=>w(Y.target.value),disabled:v,children:[e.jsx("option",{value:"never",children:"Never expires"}),e.jsx("option",{value:"7",children:"7 days"}),e.jsx("option",{value:"30",children:"30 days"}),e.jsx("option",{value:"90",children:"90 days"})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:C,disabled:v,children:v?"Generating...":"Generate Link"})]}),q&&e.jsxs("div",{className:"new-link-box",children:[e.jsxs("div",{className:"link-display",children:[e.jsx("input",{type:"text",value:q,readOnly:!0,className:"link-input"}),e.jsxs("button",{className:"btn btn-secondary copy-btn",onClick:()=>W(q),children:[B?e.jsx(Wa,{size:16}):e.jsx(bd,{size:16}),B?"Copied!":"Copy"]})]}),e.jsxs("a",{href:q,target:"_blank",rel:"noopener noreferrer",className:"preview-link",children:[e.jsx(Dp,{size:14}),"Preview link"]})]})]}),e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(hn,{size:16}),"Existing Signature Links"]}),f?e.jsx("div",{className:"loading-inline",children:"Loading..."}):R.length===0?e.jsxs("p",{className:"empty-state",children:["No signature links have been created for this ",U,"."]}):e.jsx("div",{className:"existing-links-list",children:R.map(Y=>{const J=O(Y.status),D=`${window.location.origin}/sign/${Y.signature_token}`,_=Y.signatures?.length||0;return e.jsxs("div",{className:"existing-link-card",children:[e.jsxs("div",{className:"link-card-header",children:[e.jsx("span",{className:"status-badge",style:{color:J.color,backgroundColor:J.bg},children:J.label}),e.jsxs("span",{className:"link-created",children:["Created ",zp(Y.created_at)]})]}),e.jsxs("div",{className:"link-card-body",children:[e.jsxs("div",{className:"link-info",children:[e.jsxs("span",{className:"link-token",children:["...",Y.signature_token.slice(-8)]}),Y.expires_at&&e.jsxs("span",{className:"link-expires",children:["Expires ",zp(Y.expires_at)]}),e.jsxs("span",{className:"link-views",children:[Y.view_count," view",Y.view_count!==1?"s":""]})]}),_>0&&e.jsx("div",{className:"signatures-summary",children:Y.signatures.map(y=>e.jsxs("div",{className:"sig-item",children:[e.jsx(Wa,{size:12}),e.jsxs("span",{children:["Slot ",y.signature_slot,": ",y.signer_name,y.signer_company&&` (${y.signer_company})`]})]},y.id))})]}),e.jsxs("div",{className:"link-card-actions",children:[Y.status!=="revoked"&&Y.status!=="expired"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>W(D),children:[e.jsx(bd,{size:14})," Copy"]}),e.jsxs("a",{href:D,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-small",children:[e.jsx(Dp,{size:14})," Open"]})]}),Y.status!=="completed"&&Y.status!=="revoked"&&e.jsxs("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>le(Y.id),children:[e.jsx(qs,{size:14})," Revoke"]})]})]},Y.id)})})]}),e.jsxs("div",{className:"signature-info-box",children:[e.jsx(Hn,{size:16}),e.jsxs("div",{children:[e.jsx("strong",{children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Share the link with your GC or Client"}),e.jsx("li",{children:"They can view the document and sign without logging in"}),e.jsx("li",{children:"Supports 2 signatures (GC + Client)"}),e.jsx("li",{children:"Signatures are recorded with name, title, company, date, and IP"})]})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:u,children:"Close"})})]})})}function Zv({ticketId:r,ticketSummary:l,lang:c="en",onSave:i,onClose:m,onShowToast:u}){const g=p.useRef(null),[f,j]=p.useState(""),[v,x]=p.useState(""),[R,A]=p.useState(""),[q,F]=p.useState(!1),[B,I]=p.useState(!1),[re,w]=p.useState(!1),T={en:{title:"Client Signature",subtitle:"Sign to verify the work performed",signerName:"Your Name",signerNamePlaceholder:"Full name",signerTitle:"Title",signerTitlePlaceholder:"e.g. Project Manager",signerCompany:"Company",signerCompanyPlaceholder:"Company name",signBelow:"Sign below",signHere:"Sign here",clear:"Clear",cancel:"Cancel",saveSignature:"Submit Signature",saving:"Saving...",workDate:"Work Date",workers:"Workers",hours:"Total Hours",certification:"By signing, I acknowledge that the work described in this T&M ticket was performed as documented.",nameRequired:"Please enter your name",signatureRequired:"Please sign above",signatureSaved:"Signature saved successfully",signatureError:"Error saving signature"},es:{title:"Firma del Cliente",subtitle:"Firme para verificar el trabajo realizado",signerName:"Su Nombre",signerNamePlaceholder:"Nombre completo",signerTitle:"Titulo",signerTitlePlaceholder:"ej. Gerente de Proyecto",signerCompany:"Empresa",signerCompanyPlaceholder:"Nombre de la empresa",signBelow:"Firme abajo",signHere:"Firme aqui",clear:"Borrar",cancel:"Cancelar",saveSignature:"Enviar Firma",saving:"Guardando...",workDate:"Fecha",workers:"Trabajadores",hours:"Horas Total",certification:"Al firmar, reconozco que el trabajo descrito en este ticket T&M fue realizado como se documenta.",nameRequired:"Por favor ingrese su nombre",signatureRequired:"Por favor firme arriba",signatureSaved:"Firma guardada exitosamente",signatureError:"Error al guardar la firma"}},C=T[c]||T.en,W=()=>{const y=g.current;return y?y.getContext("2d"):null},le=y=>{const S=g.current;if(!S)return{x:0,y:0};const K=S.getBoundingClientRect(),k=S.width/K.width,ie=S.height/K.height,M=y.touches?y.touches[0].clientX:y.clientX,G=y.touches?y.touches[0].clientY:y.clientY;return{x:(M-K.left)*k,y:(G-K.top)*ie}},O=y=>{y.preventDefault();const S=W();if(!S)return;const{x:K,y:k}=le(y);S.beginPath(),S.moveTo(K,k),I(!0),F(!0)},U=y=>{if(!B)return;y.preventDefault();const S=W();if(!S)return;const{x:K,y:k}=le(y);S.lineTo(K,k),S.stroke()},Y=()=>{I(!1)},J=()=>{const y=g.current,S=W();!y||!S||(S.clearRect(0,0,y.width,y.height),F(!1))},D=y=>{if(!y)return;g.current=y;const S=y.getContext("2d");S.strokeStyle="#1e293b",S.lineWidth=2,S.lineCap="round",S.lineJoin="round"},_=async()=>{if(!f.trim()){u?.(C.nameRequired,"error");return}if(!q){u?.(C.signatureRequired,"error");return}const y=g.current;if(y){w(!0);try{const S=y.toDataURL("image/png");await ee.saveTMClientSignature(r,{signature:S,signerName:f.trim(),signerTitle:v.trim()||null,signerCompany:R.trim()||null,signedAt:new Date().toISOString()}),u?.(C.signatureSaved,"success"),i?.({signerName:f.trim(),signerTitle:v.trim(),signerCompany:R.trim()})}catch(S){console.error("Error saving signature:",S),u?.(C.signatureError,"error")}finally{w(!1)}}};return e.jsx("div",{className:"tm-modal-overlay",onClick:m,children:e.jsxs("div",{className:"tm-client-signature-modal",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"tm-sig-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:C.title}),e.jsx("p",{className:"tm-sig-subtitle",children:C.subtitle})]}),e.jsx("button",{className:"tm-sig-close",onClick:m,children:e.jsx(es,{size:20})})]}),e.jsxs("div",{className:"tm-sig-body",children:[l&&e.jsxs("div",{className:"tm-sig-summary",children:[e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:C.workDate}),e.jsx("span",{className:"tm-sig-summary-value",children:new Date(l.workDate).toLocaleDateString()})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:C.workers}),e.jsx("span",{className:"tm-sig-summary-value",children:l.workerCount})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:C.hours}),e.jsx("span",{className:"tm-sig-summary-value",children:l.totalHours})]})]}),e.jsxs("div",{className:"tm-sig-fields",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(Md,{size:14}),C.signerName," *"]}),e.jsx("input",{type:"text",value:f,onChange:y=>j(y.target.value),placeholder:C.signerNamePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field-row",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(pn,{size:14}),C.signerTitle]}),e.jsx("input",{type:"text",value:v,onChange:y=>x(y.target.value),placeholder:C.signerTitlePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(uj,{size:14}),C.signerCompany]}),e.jsx("input",{type:"text",value:R,onChange:y=>A(y.target.value),placeholder:C.signerCompanyPlaceholder})]})]})]}),e.jsxs("div",{className:"tm-sig-area",children:[e.jsxs("div",{className:"tm-sig-label",children:[e.jsx(kd,{size:14}),e.jsx("span",{children:C.signBelow})]}),e.jsxs("div",{className:"tm-sig-canvas-container",children:[e.jsx("canvas",{ref:D,width:500,height:180,className:"tm-sig-canvas",onMouseDown:O,onMouseMove:U,onMouseUp:Y,onMouseLeave:Y,onTouchStart:O,onTouchMove:U,onTouchEnd:Y}),!q&&e.jsx("div",{className:"tm-sig-placeholder",children:C.signHere})]}),e.jsxs("button",{className:"tm-sig-clear",onClick:J,disabled:!q,children:[e.jsx(Ed,{size:14})," ",C.clear]})]}),e.jsx("p",{className:"tm-sig-certification",children:C.certification})]}),e.jsxs("div",{className:"tm-sig-footer",children:[e.jsx("button",{className:"tm-sig-btn secondary",onClick:m,disabled:re,children:C.cancel}),e.jsx("button",{className:"tm-sig-btn primary",onClick:_,disabled:!q||!f.trim()||re,children:re?C.saving:e.jsxs(e.Fragment,{children:[e.jsx(Wa,{size:16})," ",C.saveSignature]})})]})]})})}const qp=["Containment","PPE","Disposal","Equipment"],Jv={en:{workers:"Workers",materialsEquipment:"Materials & Equipment",review:"Review",quickActions:"Quick Actions",sameAsYesterday:"Same as Yesterday",setCrewHours:"Set Crew Hours",loading:"Loading...",supervision:"Supervision",operators:"Operators",laborers:"Laborers",addSupervision:"+ Add Supervision",addOperator:"+ Add Operator",addLaborer:"+ Add Laborer",foreman:"Foreman",superintendent:"Superintendent",firstLastName:"First & Last Name",start:"Start",end:"End",regHrs:"Reg Hrs",otHrs:"OT Hrs",selectCategory:"Select a category:",addCustomItem:"+ Add Custom Item",customItem:"Custom Item",itemName:"Item Name",category:"Category",quantity:"Quantity",addItem:"Add Item",cancel:"Cancel",noItemsCategory:"No items in this category yet",workDate:"Work Date",ceNumber:"CE/PCO #",optional:"optional",linkedCOR:"Link to Change Order",selectCOR:"Select COR (optional)",noCORs:"No pending CORs",laborSummary:"Labor Summary",worker:"worker",workers_plural:"workers",totalHours:"Total Hours",regular:"Regular",overtime:"Overtime",materials:"Materials",item:"item",items_plural:"items",noMaterials:"No materials added",notes:"Notes",addNotes:"Add notes about the work performed...",photos:"Photos",addPhotos:"Add Photos",maxPhotos:"max",noPhotos:"No photos added",certification:"Certification",certifyStatement:"I certify that this T&M ticket accurately reflects the work performed.",foremanSignature:"Foreman's Name (Signature)",yourName:"Your name",back:"Back",next:"Next",nextMaterials:"Next: Materials",reviewItems:"Review",skipNoMaterials:"Skip (no materials)",submitTM:"Submit T&M",submitting:"Submitting...",applySameHours:"Apply Same Hours",batchDescription:"Set start/end time and hours for all workers with names entered.",timeStarted:"Time Started",timeEnded:"Time Ended",regularHours:"Regular Hours",overtimeHours:"Overtime Hours",willApplyTo:"Will apply to",applyToAll:"Apply to All",preset8hr:"8hr Day",preset10hr:"10hr Day",preset4hr:"4hr Day",loadedWorkers:"Loaded {count} workers from {date}",noPreviousCrew:"No previous crew found for this project",appliedHours:"Applied hours to {count} worker(s)",assignedToCOR:"Assigned to COR"},es:{workers:"Trabajadores",materialsEquipment:"Materiales y Equipo",review:"Revisar",quickActions:"Acciones Rapidas",sameAsYesterday:"Igual que Ayer",setCrewHours:"Poner Horas",loading:"Cargando...",supervision:"Supervision",operators:"Operadores",laborers:"Trabajadores",addSupervision:"+ Agregar Supervision",addOperator:"+ Agregar Operador",addLaborer:"+ Agregar Trabajador",foreman:"Capataz",superintendent:"Superintendente",firstLastName:"Nombre y Apellido",start:"Inicio",end:"Fin",regHrs:"Hrs Reg",otHrs:"Hrs Extra",selectCategory:"Seleccione una categoria:",addCustomItem:"+ Agregar Articulo",customItem:"Articulo Personalizado",itemName:"Nombre del Articulo",category:"Categoria",quantity:"Cantidad",addItem:"Agregar",cancel:"Cancelar",noItemsCategory:"No hay articulos en esta categoria",workDate:"Fecha de Trabajo",ceNumber:"CE/PCO #",optional:"opcional",linkedCOR:"Vincular a Orden de Cambio",selectCOR:"Seleccionar COR (opcional)",noCORs:"No hay CORs pendientes",laborSummary:"Resumen de Mano de Obra",worker:"trabajador",workers_plural:"trabajadores",totalHours:"Horas Totales",regular:"Regular",overtime:"Extra",materials:"Materiales",item:"articulo",items_plural:"articulos",noMaterials:"No se agregaron materiales",notes:"Notas",addNotes:"Agregar notas sobre el trabajo realizado...",photos:"Fotos",addPhotos:"Agregar Fotos",maxPhotos:"max",noPhotos:"No se agregaron fotos",certification:"Certificacion",certifyStatement:"Certifico que este ticket T&M refleja con precision el trabajo realizado.",foremanSignature:"Nombre del Capataz (Firma)",yourName:"Su nombre",back:"Atras",next:"Siguiente",nextMaterials:"Siguiente: Materiales",reviewItems:"Revisar",skipNoMaterials:"Saltar (sin materiales)",submitTM:"Enviar T&M",submitting:"Enviando...",applySameHours:"Aplicar Mismas Horas",batchDescription:"Establezca hora de inicio/fin y horas para todos los trabajadores.",timeStarted:"Hora de Inicio",timeEnded:"Hora de Fin",regularHours:"Horas Regulares",overtimeHours:"Horas Extra",willApplyTo:"Se aplicara a",applyToAll:"Aplicar a Todos",preset8hr:"Dia 8hr",preset10hr:"Dia 10hr",preset4hr:"Dia 4hr",loadedWorkers:"Se cargaron {count} trabajadores del {date}",noPreviousCrew:"No se encontro equipo anterior para este proyecto",appliedHours:"Horas aplicadas a {count} trabajador(es)",assignedToCOR:"Asignado a COR"}};function Wv({project:r,companyId:l,maxPhotos:c=10,onSubmit:i,onCancel:m,onShowToast:u}){const[g,f]=p.useState(1),[j,v]=p.useState(new Date().toISOString().split("T")[0]),[x,R]=p.useState(null),[A,q]=p.useState(!1),[F,B]=p.useState(!1),[I,re]=p.useState(!1),[w,T]=p.useState(""),[C,W]=p.useState(""),[le,O]=p.useState(""),[U,Y]=p.useState([]),[J,D]=p.useState(!1),[_,y]=p.useState(!1),[S,K]=p.useState({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),[k,ie]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}]),[M,G]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[L,P]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[$,E]=p.useState([]),[ue,Me]=p.useState(""),[Te,te]=p.useState([]),[ze,Re]=p.useState(!1),[qe,Ie]=p.useState(""),[Ct,nt]=p.useState([]),[jt,Ht]=p.useState(!1),[pt,at]=p.useState(null),[va,_e]=p.useState([]),[Ze,Ge]=p.useState(!1),[Le,Ve]=p.useState(!1),[Ye,je]=p.useState({name:"",category:"",quantity:""}),[dt,vt]=p.useState(!1),[ct,Pt]=p.useState("en"),De=N=>Jv[ct][N]||N,Z=(N,ae)=>{if(!N||!ae)return null;const[xe,me]=N.split(":").map(Number),[Oe,Je]=ae.split(":").map(Number);let Be=Oe*60+Je-(xe*60+me);Be<0&&(Be+=1440);const st=Be/60,Mt=Math.min(st,8),fn=Math.max(0,st-8);return{hours:Mt.toFixed(1),overtimeHours:fn>0?fn.toFixed(1):""}},H=N=>{const ae=N.name.trim()!=="",xe=parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0;return ae?xe?"complete":"incomplete":"empty"},Ee=N=>{let ae,xe,me,Oe;switch(N){case"full":ae="07:00",xe="15:30",me="8",Oe="";break;case"10hr":ae="06:00",xe="16:30",me="8",Oe="2";break;case"half":ae="07:00",xe="11:00",me="4",Oe="";break;default:return}K({timeStarted:ae,timeEnded:xe,hours:me,overtimeHours:Oe})};p.useEffect(()=>{se(),Se()},[r.id]);const Se=async()=>{D(!0);try{const N=await ee.getAssignableCORs(r.id);Y(N||[])}catch(N){console.error("Error loading assignable CORs:",N)}finally{D(!1)}},Ne=()=>{const{timeStarted:N,timeEnded:ae,hours:xe,overtimeHours:me}=S;ie(k.map(Je=>Je.name.trim()?{...Je,timeStarted:N,timeEnded:ae,hours:xe,overtimeHours:me}:Je)),G(M.map(Je=>Je.name.trim()?{...Je,timeStarted:N,timeEnded:ae,hours:xe,overtimeHours:me}:Je)),P(L.map(Je=>Je.name.trim()?{...Je,timeStarted:N,timeEnded:ae,hours:xe,overtimeHours:me}:Je));const Oe=[...k.filter(Je=>Je.name.trim()),...M.filter(Je=>Je.name.trim()),...L.filter(Je=>Je.name.trim())].length;y(!1),K({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),u(`Applied hours to ${Oe} worker${Oe!==1?"s":""}`,"success")},ke=N=>{let ae,xe,me,Oe;switch(N){case"8hr":ae="07:00",xe="15:30",me="8",Oe="";break;case"10hr":ae="06:00",xe="16:30",me="8",Oe="2";break;case"4hr":ae="07:00",xe="11:00",me="4",Oe="";break;default:return}ie(Be=>Be.map(st=>st.name.trim()?{...st,timeStarted:ae,timeEnded:xe,hours:me,overtimeHours:Oe}:st)),G(Be=>Be.map(st=>st.name.trim()?{...st,timeStarted:ae,timeEnded:xe,hours:me,overtimeHours:Oe}:st)),P(Be=>Be.map(st=>st.name.trim()?{...st,timeStarted:ae,timeEnded:xe,hours:me,overtimeHours:Oe}:st));const Je=[...k.filter(Be=>Be.name.trim()),...M.filter(Be=>Be.name.trim()),...L.filter(Be=>Be.name.trim())].length;Je>0?u(De("appliedHours").replace("{count}",Je),"success"):u(ct==="en"?"Add workers first":"Agregue trabajadores primero","info")},se=async()=>{try{const N=await ee.getCrewCheckin(r.id);N?.workers&&nt(N.workers)}catch(N){console.error("Error loading crew:",N)}};p.useEffect(()=>{pt&&l&&ye(pt)},[pt,l]);const ye=async N=>{Ge(!0);try{const ae=await ee.getMaterialsEquipmentByCategory(l,N);_e(ae)}catch(ae){console.error("Error loading items:",ae),u("Error loading items","error")}finally{Ge(!1)}},pe=async()=>{vt(!0);try{const N=await ee.getPreviousTicketCrew(r.id,j);if(!N||N.totalWorkers===0){u("No previous crew found for this project","info");return}N.supervision&&ie(N.supervision),N.operators&&G(N.operators),N.laborers&&P(N.laborers);const ae=new Date(N.workDate).toLocaleDateString();u(`Loaded ${N.totalWorkers} workers from ${ae}`,"success")}catch(N){console.error("Error loading previous crew:",N),u("Error loading previous crew","error")}finally{vt(!1)}},et=()=>{ie([...k,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},mt=(N,ae,xe)=>{ie(k.map((me,Oe)=>{if(Oe!==N)return me;const Je={...me,[ae]:xe};if(ae==="timeStarted"||ae==="timeEnded"){const Be=ae==="timeStarted"?xe:me.timeStarted,st=ae==="timeEnded"?xe:me.timeEnded,Mt=Z(Be,st);Mt&&(Je.hours=Mt.hours,Je.overtimeHours=Mt.overtimeHours)}return Je}))},Xt=N=>{k.length>1?ie(k.filter((ae,xe)=>xe!==N)):ie([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},At=()=>{P([...L,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},$t=(N,ae,xe)=>{P(L.map((me,Oe)=>{if(Oe!==N)return me;const Je={...me,[ae]:xe};if(ae==="timeStarted"||ae==="timeEnded"){const Be=ae==="timeStarted"?xe:me.timeStarted,st=ae==="timeEnded"?xe:me.timeEnded,Mt=Z(Be,st);Mt&&(Je.hours=Mt.hours,Je.overtimeHours=Mt.overtimeHours)}return Je}))},sa=N=>{L.length>1?P(L.filter((ae,xe)=>xe!==N)):P([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Kt=()=>{G([...M,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},be=(N,ae,xe)=>{G(M.map((me,Oe)=>{if(Oe!==N)return me;const Je={...me,[ae]:xe};if(ae==="timeStarted"||ae==="timeEnded"){const Be=ae==="timeStarted"?xe:me.timeStarted,st=ae==="timeEnded"?xe:me.timeEnded,Mt=Z(Be,st);Mt&&(Je.hours=Mt.hours,Je.overtimeHours=Mt.overtimeHours)}return Je}))},Dt=N=>{M.length>1?G(M.filter((ae,xe)=>xe!==N)):G([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},St=N=>{const ae=$.findIndex(xe=>xe.material_equipment_id===N.id);ae>=0?E($.map((xe,me)=>me===ae?{...xe,quantity:xe.quantity+1}:xe)):E([...$,{material_equipment_id:N.id,name:N.name,unit:N.unit,category:N.category,quantity:1,isCustom:!1}]),u(`Added ${N.name}`,"success")},ts=()=>{if(!Ye.name||!Ye.category||!Ye.quantity){u("Fill in all fields","error");return}E([...$,{material_equipment_id:null,custom_name:Ye.name,custom_category:Ye.category,name:Ye.name,category:Ye.category,quantity:parseFloat(Ye.quantity),unit:"each",isCustom:!0}]),je({name:"",category:"",quantity:""}),Ve(!1),at(null),u("Custom item added","success")},we=(N,ae)=>{const xe=parseFloat(ae)||0;xe<=0?He(N):E($.map((me,Oe)=>Oe===N?{...me,quantity:xe}:me))},He=N=>{E($.filter((ae,xe)=>xe!==N))},Fe=N=>{const ae=Array.from(N.target.files);if(ae.length===0)return;const xe=c===-1?1/0:c-Te.length;if(xe<=0){u(`Photo limit reached (${c} max)`,"error"),N.target.value="";return}const me=ae.slice(0,xe);me.length<ae.length&&u(`Only ${me.length} photo(s) added (${c} max)`,"error"),me.forEach(Oe=>{if(!Oe.type.startsWith("image/")){u("Please select an image file","error");return}const Je=URL.createObjectURL(Oe);te(Be=>[...Be,{id:Date.now()+Math.random(),file:Oe,previewUrl:Je,name:Oe.name}])}),N.target.value=""},Xe=N=>{const ae=Te.find(xe=>xe.id===N);ae?.previewUrl&&URL.revokeObjectURL(ae.previewUrl),te(Te.filter(xe=>xe.id!==N))},ht=()=>{if(g===1){const N=k.some(me=>me.name.trim()&&(parseFloat(me.hours)>0||parseFloat(me.overtimeHours)>0)),ae=M.some(me=>me.name.trim()&&(parseFloat(me.hours)>0||parseFloat(me.overtimeHours)>0)),xe=L.some(me=>me.name.trim()&&(parseFloat(me.hours)>0||parseFloat(me.overtimeHours)>0));return N||ae||xe}return!0},ft=()=>{g<3&&f(g+1)},it=()=>{pt?(at(null),Ve(!1)):Le?Ve(!1):g>1?f(g-1):m()},wt=async()=>{if(!C.trim()){u("Enter your name to submit","error");return}const N=k.filter(me=>me.name.trim()&&(parseFloat(me.hours)>0||parseFloat(me.overtimeHours)>0)),ae=M.filter(me=>me.name.trim()&&(parseFloat(me.hours)>0||parseFloat(me.overtimeHours)>0)),xe=L.filter(me=>me.name.trim()&&(parseFloat(me.hours)>0||parseFloat(me.overtimeHours)>0));if(N.length===0&&ae.length===0&&xe.length===0){u("Add at least one worker","error");return}Re(!0),Ie("Creating ticket...");try{const me=await ee.createTMTicket({project_id:r.id,work_date:j,ce_pco_number:w.trim()||null,assigned_cor_id:le||null,notes:ue.trim()||null,photos:[],created_by_name:C.trim()});let Oe=[];if(Te.length>0){Ie(`Compressing ${Te.length} photo${Te.length>1?"s":""}...`);const Be=await Promise.all(Te.map(async(Ra,as)=>{try{const Sa=await Iv(Ra.file);return{...Ra,file:Sa}}catch(Sa){return console.warn(`Failed to compress photo ${as+1}, using original:`,Sa),Ra}}));Ie(`Uploading ${Te.length} photo${Te.length>1?"s":""}...`);let st=0;const Mt=Be.map(async(Ra,as)=>{try{const Sa=await ee.uploadPhoto(l,r.id,me.id,Ra.file);return st++,Ie(`Uploading ${st}/${Te.length} photos...`),console.log(`Photo ${as+1} uploaded successfully:`,Sa),Sa}catch(Sa){return console.error(`Photo ${as+1} upload failed:`,Sa),u(`Photo ${as+1} failed to upload`,"error"),null}});Oe=(await Promise.all(Mt)).filter(Ra=>Ra!==null),Oe.length<Te.length&&Oe.length>0&&u(`${Oe.length}/${Te.length} photos uploaded`,"warning")}Oe.length>0&&(Ie("Saving photos..."),await ee.updateTMTicketPhotos(me.id,Oe));const Je=[...N.map(Be=>({name:Be.name.trim(),hours:parseFloat(Be.hours)||0,overtime_hours:parseFloat(Be.overtimeHours)||0,time_started:Be.timeStarted||null,time_ended:Be.timeEnded||null,role:Be.role})),...ae.map(Be=>({name:Be.name.trim(),hours:parseFloat(Be.hours)||0,overtime_hours:parseFloat(Be.overtimeHours)||0,time_started:Be.timeStarted||null,time_ended:Be.timeEnded||null,role:"Operator"})),...xe.map(Be=>({name:Be.name.trim(),hours:parseFloat(Be.hours)||0,overtime_hours:parseFloat(Be.overtimeHours)||0,time_started:Be.timeStarted||null,time_ended:Be.timeEnded||null,role:"Laborer"}))];if(Ie("Saving workers..."),await ee.addTMWorkers(me.id,Je),$.length>0&&(Ie("Saving materials..."),await ee.addTMItems(me.id,$.map(Be=>({material_equipment_id:Be.material_equipment_id,custom_name:Be.custom_name||null,custom_category:Be.custom_category||null,quantity:Be.quantity})))),le){Ie("Importing to COR...");try{await ee.importTicketDataToCOR(me.id,le,l,r.work_type||"demolition",r.job_type||"standard")}catch(Be){console.error("Error importing to COR:",Be),u("T&M saved, but COR import failed","warning")}}Te.forEach(Be=>{Be.previewUrl&&URL.revokeObjectURL(Be.previewUrl)}),R(me),u("T&M submitted!","success"),f(4)}catch(me){console.error("Error submitting T&M:",me),u("Error submitting T&M","error")}finally{Re(!1),Ie("")}},Ke=k.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),rt=M.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),Vt=L.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),da=Ke.length+rt.length+Vt.length,ba=[...Ke,...rt,...Vt].reduce((N,ae)=>N+parseFloat(ae.hours||0),0),Ae=[...Ke,...rt,...Vt].reduce((N,ae)=>N+parseFloat(ae.overtimeHours||0),0);$.reduce((N,ae)=>N+ae.quantity,0);const lt=[...k.filter(N=>N.name.trim()),...M.filter(N=>N.name.trim()),...L.filter(N=>N.name.trim())],na=da,_a=lt.length-na;return g===2&&(pt||Le)?e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[e.jsx("button",{className:"tm-back-btn",onClick:it,children:""}),e.jsx("h2",{children:Le?"Add Custom Item":pt}),e.jsxs("div",{className:"tm-item-count",children:[$.length," items"]})]}),Le?e.jsxs("div",{className:"tm-custom-form",children:[e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Item Name"}),e.jsx("input",{type:"text",placeholder:"What did you use?",value:Ye.name,onChange:N=>je({...Ye,name:N.target.value}),autoFocus:!0})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Category"}),e.jsx("div",{className:"tm-category-select",children:qp.map(N=>e.jsx("button",{className:`tm-cat-chip ${Ye.category===N?"active":""}`,onClick:()=>je({...Ye,category:N}),children:N},N))})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",placeholder:"How many?",value:Ye.quantity,onChange:N=>je({...Ye,quantity:N.target.value})})]}),e.jsx("button",{className:"tm-big-btn primary",onClick:ts,children:"Add Custom Item"})]}):e.jsx("div",{className:"tm-item-grid",children:Ze?e.jsx("div",{className:"tm-loading",children:"Loading..."}):e.jsxs(e.Fragment,{children:[va.map(N=>{const ae=$.find(xe=>xe.material_equipment_id===N.id);return e.jsxs("button",{className:`tm-item-card ${ae?"added":""}`,onClick:()=>St(N),children:[e.jsx("span",{className:"tm-item-name",children:N.name}),e.jsx("span",{className:"tm-item-unit",children:N.unit}),ae&&e.jsx("span",{className:"tm-item-badge",children:ae.quantity})]},N.id)}),e.jsxs("button",{className:"tm-item-card custom",onClick:()=>Ve(!0),children:[e.jsx("span",{className:"tm-item-name",children:"+ Add Other"}),e.jsx("span",{className:"tm-item-unit",children:"Not on list"})]})]})}),!Le&&$.length>0&&e.jsx("div",{className:"tm-wizard-footer",children:e.jsxs("button",{className:"tm-big-btn primary",onClick:()=>at(null),children:["Done Adding (",$.length," items)"]})})]}):e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[g<4?e.jsx("button",{className:"tm-back-btn",onClick:it,children:""}):e.jsx("div",{className:"tm-success-check",children:e.jsx(rd,{size:24})}),e.jsxs("h2",{children:[g===1&&De("workers"),g===2&&De("materialsEquipment"),g===3&&De("review"),g===4&&(ct==="en"?"Submitted":"Enviado")]}),e.jsxs("div",{className:"tm-header-right",children:[g<4&&e.jsxs("button",{className:"tm-lang-toggle",onClick:()=>Pt(ct==="en"?"es":"en"),title:ct==="en"?"Cambiar a Espaol":"Switch to English",children:[e.jsx(Lj,{size:16}),ct==="en"?"ES":"EN"]}),g<4&&e.jsxs("div",{className:"tm-step-dots",children:[e.jsx("span",{className:`tm-dot ${g>=1?"active":""}`}),e.jsx("span",{className:`tm-dot ${g>=2?"active":""}`}),e.jsx("span",{className:`tm-dot ${g>=3?"active":""}`})]})]})]}),g===1&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-project-info",children:[r.job_number&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Job #"}),e.jsx("span",{className:"tm-project-value",children:r.job_number})]}),e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Project"}),e.jsx("span",{className:"tm-project-value",children:r.name})]}),r.address&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Address"}),e.jsx("span",{className:"tm-project-value",children:r.address})]}),r.general_contractor&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"GC"}),e.jsx("span",{className:"tm-project-value",children:r.general_contractor})]})]}),e.jsxs("div",{className:"tm-field-row",children:[e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:j,onChange:N=>v(N.target.value),className:"tm-date"})]}),e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"CE / PCO #"}),e.jsx("input",{type:"text",placeholder:"Change Event / PCO",value:w,onChange:N=>T(N.target.value),className:"tm-input"})]})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Link to Change Order Request (Optional)"}),e.jsxs("div",{className:"tm-cor-row",children:[e.jsxs("select",{value:le,onChange:N=>O(N.target.value),className:"tm-input tm-select",children:[e.jsx("option",{value:"",children:"-- No COR --"}),U.map(N=>e.jsxs("option",{value:N.id,children:[N.cor_number,": ",N.title||"Untitled"," (",N.status,")"]},N.id))]}),e.jsx("button",{type:"button",className:"tm-refresh-btn",onClick:Se,disabled:J,title:"Refresh COR list",children:e.jsx(hv,{size:16,className:J?"spinning":""})})]}),e.jsx("span",{className:"tm-field-hint",children:"T&M data will be imported into the selected COR"})]}),Ct.length>0&&e.jsxs("div",{className:"tm-crew-picker",children:[e.jsxs("button",{className:"tm-crew-picker-btn",onClick:()=>Ht(!jt),children:[e.jsx(oa,{size:16})," ",jt?"Hide":"Select from"," Today's Crew (",Ct.length,")"]}),jt&&e.jsx("div",{className:"tm-crew-list",children:Ct.map((N,ae)=>{const xe=k.some(me=>me.name.toLowerCase()===N.name.toLowerCase())||M.some(me=>me.name.toLowerCase()===N.name.toLowerCase())||L.some(me=>me.name.toLowerCase()===N.name.toLowerCase());return e.jsxs("button",{className:`tm-crew-item ${xe?"added":""}`,onClick:()=>{if(!xe){if(N.role==="Foreman"||N.role==="Supervisor"){const me=k.findIndex(Oe=>!Oe.name.trim());me>=0?mt(me,"name",N.name):ie([...k,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:N.role==="Supervisor"?"Superintendent":"Foreman"}])}else if(N.role==="Operator"){const me=M.findIndex(Oe=>!Oe.name.trim());me>=0?be(me,"name",N.name):G([...M,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}else{const me=L.findIndex(Oe=>!Oe.name.trim());me>=0?$t(me,"name",N.name):P([...L,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}u(`Added ${N.name}`,"success")}},disabled:xe,children:[e.jsx("span",{className:"tm-crew-item-name",children:N.name}),e.jsx("span",{className:`tm-crew-item-role ${(N.role||"laborer").toLowerCase()}`,children:N.role||"Laborer"}),xe&&e.jsx("span",{className:"tm-crew-item-check",children:""})]},ae)})})]}),e.jsxs("div",{className:"tm-quick-actions-panel",children:[e.jsxs("div",{className:"tm-batch-hours-header",children:[e.jsx(Sd,{size:18}),e.jsx("span",{children:De("quickActions")})]}),e.jsxs("div",{className:"tm-quick-actions-buttons",children:[e.jsxs("button",{type:"button",className:"tm-quick-action-btn primary",onClick:pe,disabled:dt,children:[e.jsx(bd,{size:16}),De(dt?"loading":"sameAsYesterday")]}),e.jsxs("button",{type:"button",className:"tm-quick-action-btn",onClick:()=>y(!0),children:[e.jsx(hn,{size:16}),De("setCrewHours")]})]})]}),e.jsxs("div",{className:"tm-inline-presets",children:[e.jsx("span",{className:"tm-inline-presets-label",children:ct==="en"?"Apply to all:":"Aplicar a todos:"}),e.jsxs("div",{className:"tm-inline-presets-buttons",children:[e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>ke("8hr"),children:De("preset8hr")}),e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>ke("10hr"),children:De("preset10hr")}),e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>ke("4hr"),children:De("preset4hr")})]})]}),e.jsxs("div",{className:`tm-running-total ${da>0?"has-data":""}`,children:[e.jsxs("div",{className:"tm-running-total-workers",children:[e.jsx(oa,{size:18}),e.jsx("span",{className:"tm-running-total-count",children:lt.length}),e.jsx("span",{className:"tm-running-total-label",children:lt.length===1?De("worker"):De("workers_plural")}),_a>0&&e.jsxs("span",{className:"tm-running-total-warning",children:["(",_a," ",ct==="en"?"need hours":"sin horas",")"]})]}),e.jsxs("div",{className:"tm-running-total-hours",children:[e.jsx(hn,{size:18}),e.jsx("span",{className:"tm-running-total-count",children:ba+Ae}),e.jsx("span",{className:"tm-running-total-label",children:ct==="en"?"total hrs":"hrs total"}),Ae>0&&e.jsxs("span",{className:"tm-running-total-ot",children:["(",Ae," OT)"]})]})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:De("supervision")}),e.jsx("div",{className:"tm-workers-list",children:k.map((N,ae)=>{const xe=H(N);return e.jsxs("div",{className:`tm-worker-card-expanded ${xe!=="empty"?`worker-${xe}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[xe==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Wa,{size:14})}),e.jsx("div",{className:"tm-role-select",children:e.jsxs("select",{value:N.role,onChange:me=>mt(ae,"role",me.target.value),children:[e.jsx("option",{value:"Foreman",children:De("foreman")}),e.jsx("option",{value:"Superintendent",children:De("superintendent")})]})}),e.jsx("input",{type:"text",placeholder:De("firstLastName"),value:N.name,onChange:me=>mt(ae,"name",me.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>Xt(ae),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("start")}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:me=>mt(ae,"timeStarted",me.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("end")}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:me=>mt(ae,"timeEnded",me.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:me=>mt(ae,"hours",me.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:me=>mt(ae,"overtimeHours",me.target.value)})]})]})]},ae)})}),e.jsx("button",{className:"tm-add-btn",onClick:et,children:De("addSupervision")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:De("operators")}),e.jsx("div",{className:"tm-workers-list",children:M.map((N,ae)=>{const xe=H(N);return e.jsxs("div",{className:`tm-worker-card-expanded ${xe!=="empty"?`worker-${xe}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[xe==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Wa,{size:14})}),e.jsx("input",{type:"text",placeholder:De("firstLastName"),value:N.name,onChange:me=>be(ae,"name",me.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>Dt(ae),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("start")}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:me=>be(ae,"timeStarted",me.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("end")}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:me=>be(ae,"timeEnded",me.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:me=>be(ae,"hours",me.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:me=>be(ae,"overtimeHours",me.target.value)})]})]})]},ae)})}),e.jsx("button",{className:"tm-add-btn",onClick:Kt,children:De("addOperator")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:De("laborers")}),e.jsx("div",{className:"tm-workers-list",children:L.map((N,ae)=>{const xe=H(N);return e.jsxs("div",{className:`tm-worker-card-expanded ${xe!=="empty"?`worker-${xe}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[xe==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Wa,{size:14})}),e.jsx("input",{type:"text",placeholder:De("firstLastName"),value:N.name,onChange:me=>$t(ae,"name",me.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>sa(ae),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("start")}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:me=>$t(ae,"timeStarted",me.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("end")}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:me=>$t(ae,"timeEnded",me.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:me=>$t(ae,"hours",me.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:me=>$t(ae,"overtimeHours",me.target.value)})]})]})]},ae)})}),e.jsx("button",{className:"tm-add-btn",onClick:At,children:De("addLaborer")})]})]}),g===2&&!pt&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"What was used?"}),e.jsx("div",{className:"tm-category-grid",children:qp.map(N=>{const ae=$.filter(xe=>xe.category===N);return e.jsxs("button",{className:"tm-category-card",onClick:()=>at(N),children:[e.jsx("span",{className:"tm-cat-name",children:N}),ae.length>0&&e.jsx("span",{className:"tm-cat-count",children:ae.length})]},N)})})]}),$.length>0&&e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:["Added Items (",$.length,")"]}),e.jsx("div",{className:"tm-added-list",children:$.map((N,ae)=>e.jsxs("div",{className:"tm-added-item",children:[e.jsxs("div",{className:"tm-added-info",children:[N.isCustom&&e.jsx("span",{className:"tm-custom-badge",children:"Custom"}),e.jsx("span",{className:"tm-added-name",children:N.name})]}),e.jsxs("div",{className:"tm-added-qty",children:[e.jsx("button",{onClick:()=>we(ae,N.quantity-1),children:""}),e.jsx("span",{children:N.quantity}),e.jsx("button",{onClick:()=>we(ae,N.quantity+1),children:"+"})]})]},ae))})]})]}),g===3&&e.jsxs("div",{className:"tm-step-content",children:[e.jsx("div",{className:"tm-review-section",children:e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Date"}),e.jsx("span",{children:new Date(j).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]})}),e.jsxs("div",{className:"tm-review-section tm-notes-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(Aa,{size:16,className:"inline-icon"})," ",De("notes")]}),e.jsxs("span",{className:"tm-optional",children:["(",De("optional"),")"]})]}),e.jsx("textarea",{placeholder:De("addNotes"),value:ue,onChange:N=>Me(N.target.value),rows:3,className:"tm-review-textarea"})]}),e.jsxs("div",{className:"tm-review-section tm-photos-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(xl,{size:16,className:"inline-icon"})," ",De("photos")]}),c!==-1&&Te.length>0&&e.jsxs("span",{className:"tm-photo-count",children:[Te.length,"/",c]})]}),Te.length>0&&e.jsx("div",{className:"tm-photo-grid",children:Te.map(N=>e.jsxs("div",{className:"tm-photo-item",children:[e.jsx("img",{src:N.previewUrl,alt:N.name}),e.jsx("button",{className:"tm-photo-remove",onClick:()=>Xe(N.id),children:""})]},N.id))}),(c===-1||Te.length<c)&&e.jsxs("label",{className:"tm-photo-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:Fe,style:{display:"none"}}),e.jsx(xl,{size:16,className:"inline-icon"})," ",Te.length>0?ct==="en"?"Add More":"Ms":De("addPhotos")]})]}),Ke.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(pf,{size:16,className:"inline-icon"})," Supervision"]}),e.jsxs("span",{children:[Ke.reduce((N,ae)=>N+parseFloat(ae.hours||0)+parseFloat(ae.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:Ke.map((N,ae)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsxs("div",{className:"tm-review-worker-name",children:[e.jsx("span",{className:"tm-role-badge",children:N.role})," ",N.name]}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},ae))})]}),rt.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Operators"}),e.jsxs("span",{children:[rt.reduce((N,ae)=>N+parseFloat(ae.hours||0)+parseFloat(ae.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:rt.map((N,ae)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:N.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},ae))})]}),Vt.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(oa,{size:16,className:"inline-icon"})," Laborers"]}),e.jsxs("span",{children:[Vt.reduce((N,ae)=>N+parseFloat(ae.hours||0)+parseFloat(ae.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:Vt.map((N,ae)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:N.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},ae))})]}),$.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(vl,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsxs("span",{children:[$.length," items"]})]}),e.jsx("div",{className:"tm-review-list",children:$.map((N,ae)=>e.jsxs("div",{className:"tm-review-row",children:[e.jsxs("span",{children:[N.isCustom&&e.jsxs(e.Fragment,{children:[e.jsx(Sd,{size:14,className:"inline-icon"})," "]}),N.name]}),e.jsxs("span",{children:[N.quantity," ",N.unit]})]},ae))})]}),e.jsxs("div",{className:"tm-review-section tm-certification",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(gl,{size:16,className:"inline-icon"})," Submitted By"]})}),e.jsx("input",{type:"text",className:"tm-certification-input",placeholder:"Enter your name",value:C,onChange:N=>W(N.target.value)}),e.jsx("p",{className:"tm-certification-note",children:"By submitting, you certify this T&M is accurate."})]})]}),g===4&&x&&e.jsxs("div",{className:"tm-step-content tm-success-step",children:[e.jsxs("div",{className:"tm-success-header",children:[e.jsx("div",{className:"tm-success-icon",children:e.jsx(rd,{size:48})}),e.jsx("h2",{children:ct==="en"?"T&M Ticket Submitted!":"Ticket T&M Enviado!"}),e.jsx("p",{className:"tm-success-subtitle",children:ct==="en"?"Your ticket has been saved and is ready for client signature.":"Su ticket ha sido guardado y est listo para la firma del cliente."})]}),e.jsxs("div",{className:"tm-success-summary",children:[e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:da}),e.jsx("span",{className:"tm-success-stat-label",children:ct==="en"?"Workers":"Trabajadores"})]}),e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:ba+Ae}),e.jsx("span",{className:"tm-success-stat-label",children:ct==="en"?"Total Hours":"Horas Total"})]}),e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:new Date(j).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx("span",{className:"tm-success-stat-label",children:ct==="en"?"Work Date":"Fecha"})]})]}),e.jsxs("div",{className:"tm-signature-options",children:[e.jsx("h3",{children:ct==="en"?"Get Client Signature":"Obtener Firma del Cliente"}),e.jsx("p",{className:"tm-signature-description",children:ct==="en"?"Have the client sign this T&M ticket to verify the work performed.":"Haga que el cliente firme este ticket T&M para verificar el trabajo realizado."}),I?e.jsxs("div",{className:"tm-signed-confirmation",children:[e.jsx(rd,{size:32,className:"tm-signed-icon"}),e.jsx("span",{children:ct==="en"?"Client signature collected!":"Firma del cliente recopilada!"})]}):e.jsxs("div",{className:"tm-signature-buttons",children:[e.jsxs("button",{className:"tm-signature-option-btn primary",onClick:()=>B(!0),children:[e.jsx("div",{className:"tm-signature-option-icon",children:e.jsx(gl,{size:24})}),e.jsxs("div",{className:"tm-signature-option-text",children:[e.jsx("span",{className:"tm-signature-option-title",children:ct==="en"?"Sign Now (On-Site)":"Firmar Ahora"}),e.jsx("span",{className:"tm-signature-option-desc",children:ct==="en"?"Client signs on this device":"Cliente firma en este dispositivo"})]})]}),e.jsxs("button",{className:"tm-signature-option-btn",onClick:()=>q(!0),children:[e.jsx("div",{className:"tm-signature-option-icon",children:e.jsx(Dd,{size:24})}),e.jsxs("div",{className:"tm-signature-option-text",children:[e.jsx("span",{className:"tm-signature-option-title",children:ct==="en"?"Send Signature Link":"Enviar Enlace"}),e.jsx("span",{className:"tm-signature-option-desc",children:ct==="en"?"Client signs later via link":"Cliente firma despus va enlace"})]})]})]})]})]}),A&&x&&e.jsx(Td,{documentType:"tm_ticket",documentId:x.id,companyId:l,projectId:r.id,documentTitle:`T&M - ${new Date(j).toLocaleDateString()}`,onClose:()=>q(!1),onShowToast:u}),F&&x&&e.jsx(Zv,{ticketId:x.id,ticketSummary:{workDate:j,workerCount:da,totalHours:ba+Ae},lang:ct,onSave:()=>{B(!1),re(!0)},onClose:()=>B(!1),onShowToast:u}),e.jsxs("div",{className:"tm-wizard-footer",children:[g<3?e.jsx("button",{className:"tm-big-btn primary",onClick:ft,disabled:g===1&&!ht(),children:g===1?`${De("nextMaterials")} (${da} ${De(da===1?"worker":"workers_plural")}, ${ba+Ae} hrs)`:g===2?`${De("reviewItems")} (${$.length} ${$.length===1?De("item"):De("items_plural")})`:De("next")}):g===3?e.jsx("button",{className:`tm-big-btn submit ${ze?"submitting":""} ${C.trim()?"ready":"needs-name"}`,onClick:wt,disabled:ze||!C.trim(),children:ze?e.jsxs(e.Fragment,{children:[e.jsx(Qj,{size:20,className:"tm-spinner"}),e.jsx("span",{className:"tm-submit-text",children:qe||De("submitting")})]}):C.trim()?e.jsxs(e.Fragment,{children:[e.jsx(Wa,{size:20}),e.jsx("span",{children:De("submitTM")})]}):e.jsxs(e.Fragment,{children:[e.jsx(gl,{size:18}),e.jsx("span",{children:ct==="en"?"Enter name to submit":"Ingrese nombre"})]})}):e.jsxs("button",{className:"tm-big-btn primary",onClick:i,children:[e.jsx(Wa,{size:20}),e.jsx("span",{children:ct==="en"?"Done":"Listo"})]}),g===2&&e.jsx("button",{className:"tm-skip-btn",onClick:ft,children:De("skipNoMaterials")}),g===4&&e.jsx("button",{className:"tm-skip-btn",onClick:i,children:ct==="en"?"Skip signature for now":"Saltar firma por ahora"})]}),_&&e.jsx("div",{className:"tm-modal-overlay",onClick:()=>y(!1),children:e.jsxs("div",{className:"tm-batch-modal",onClick:N=>N.stopPropagation(),children:[e.jsxs("h3",{children:[e.jsx(hn,{size:18})," ",De("applySameHours")]}),e.jsx("p",{className:"tm-batch-description",children:De("batchDescription")}),e.jsxs("div",{className:"tm-time-presets",children:[e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>Ee("full"),children:De("preset8hr")}),e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>Ee("10hr"),children:De("preset10hr")}),e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>Ee("half"),children:De("preset4hr")})]}),e.jsxs("div",{className:"tm-batch-form",children:[e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:De("timeStarted")}),e.jsx("input",{type:"time",value:S.timeStarted,onChange:N=>{const ae=N.target.value,xe=Z(ae,S.timeEnded);K({...S,timeStarted:ae,...xe||{}})}})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:De("timeEnded")}),e.jsx("input",{type:"time",value:S.timeEnded,onChange:N=>{const ae=N.target.value,xe=Z(S.timeStarted,ae);K({...S,timeEnded:ae,...xe||{}})}})]})]}),e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:De("regularHours")}),e.jsx("input",{type:"number",placeholder:"8",value:S.hours,onChange:N=>K({...S,hours:N.target.value})})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:De("overtimeHours")}),e.jsx("input",{type:"number",placeholder:"0",value:S.overtimeHours,onChange:N=>K({...S,overtimeHours:N.target.value})})]})]})]}),e.jsxs("div",{className:"tm-batch-preview",children:[e.jsxs("strong",{children:[De("willApplyTo"),":"]}),e.jsxs("span",{children:[[...k.filter(N=>N.name.trim()),...M.filter(N=>N.name.trim()),...L.filter(N=>N.name.trim())].length," ",De("workers_plural")]})]}),e.jsxs("div",{className:"tm-batch-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>y(!1),children:De("cancel")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:Ne,disabled:!S.hours&&!S.overtimeHours,children:De("applyToAll")})]})]})})]})}function Kv({project:r,onShowToast:l}){const[c,i]=p.useState([]),[m,u]=p.useState(!0),[g,f]=p.useState(!1),[j,v]=p.useState(!1),[x,R]=p.useState({name:"",role:"Laborer"});p.useEffect(()=>{A()},[r.id]);const A=async()=>{try{const I=await ee.getCrewCheckin(r.id);I?.workers&&i(I.workers)}catch(I){console.error("Error loading crew:",I)}finally{u(!1)}},q=async()=>{if(!x.name.trim()){l("Enter worker name","error");return}if(c.find(I=>I.name.toLowerCase()===x.name.trim().toLowerCase())){l("Worker already added","error");return}f(!0);try{const I=[...c,{name:x.name.trim(),role:x.role}];await ee.saveCrewCheckin(r.id,I),i(I),R({name:"",role:"Laborer"}),v(!1),l("Crew member added","success")}catch(I){console.error("Error adding worker:",I),l("Error adding crew member","error")}finally{f(!1)}},F=async I=>{f(!0);try{const re=c.filter(w=>w.name.toLowerCase()!==I.toLowerCase());await ee.saveCrewCheckin(r.id,re),i(re),l("Crew member removed","success")}catch(re){console.error("Error removing worker:",re),l("Error removing crew member","error")}finally{f(!1)}},B=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"});return m?e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(oa,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:B})]}),e.jsx("div",{className:"crew-loading",children:"Loading..."})]}):e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(oa,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:B})]}),c.length===0?e.jsxs("div",{className:"crew-empty",children:[e.jsx("p",{children:"No crew checked in yet"}),e.jsx("p",{className:"crew-empty-hint",children:"Add your crew for the day"})]}):e.jsx("div",{className:"crew-list",children:c.map(I=>e.jsxs("div",{className:"crew-member",children:[e.jsxs("div",{className:"crew-member-info",children:[e.jsx("span",{className:"crew-member-name",children:I.name}),e.jsx("span",{className:`crew-member-role ${I.role.toLowerCase()}`,children:I.role})]}),e.jsx("button",{className:"crew-remove-btn",onClick:()=>F(I.name),disabled:g,children:""})]},I.name))}),j?e.jsxs("div",{className:"crew-add-form",children:[e.jsx("input",{type:"text",value:x.name,onChange:I=>R({...x,name:I.target.value}),placeholder:"Name",autoFocus:!0}),e.jsxs("select",{value:x.role,onChange:I=>R({...x,role:I.target.value}),children:[e.jsx("option",{value:"Foreman",children:"Foreman"}),e.jsx("option",{value:"Laborer",children:"Laborer"}),e.jsx("option",{value:"Supervisor",children:"Supervisor"}),e.jsx("option",{value:"Operator",children:"Operator"})]}),e.jsxs("div",{className:"crew-add-buttons",children:[e.jsx("button",{className:"crew-add-confirm",onClick:q,disabled:g,children:g?"...":"Add"}),e.jsx("button",{className:"crew-add-cancel",onClick:()=>{v(!1),R({name:"",role:"Laborer"})},children:"Cancel"})]})]}):e.jsx("button",{className:"crew-add-btn",onClick:()=>v(!0),children:"+ Add Crew Member"}),e.jsxs("div",{className:"crew-count",children:[c.length," ",c.length===1?"person":"people"," on site"]})]})}function ey({project:r,onShowToast:l,onClose:c}){const[i,m]=p.useState(!0),[u,g]=p.useState(!1),[f,j]=p.useState(null),[v,x]=p.useState(""),[R,A]=p.useState("");p.useEffect(()=>{q()},[r.id]);const q=async()=>{try{const re=await ee.getDailyReport(r.id);if(re)j(re),x(re.field_notes||""),A(re.issues||"");else{const w=await ee.compileDailyReport(r.id);j({...w,status:"draft"})}}catch(re){console.error("Error loading report:",re),l("Error loading report","error")}finally{m(!1)}},F=async()=>{if(!Q){l("Demo Mode: Report saved locally only - won't reach office","info"),c();return}g(!0);try{await ee.saveDailyReport(r.id,{field_notes:v,issues:R}),await ee.submitDailyReport(r.id,"Field")?(l("Daily report submitted!","success"),c()):l("Report not sent - check connection","error")}catch(re){console.error("Error submitting report:",re),l("Error submitting report","error")}finally{g(!1)}},B=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});if(i)return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsx("h2",{children:"Daily Report"})]}),e.jsx("div",{className:"daily-report-loading",children:"Compiling report..."})]});const I=f?.status==="submitted";return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsxs("div",{children:[e.jsx("h2",{children:"Daily Report"}),e.jsx("p",{className:"daily-report-date",children:B})]})]}),I&&e.jsxs("div",{className:"daily-report-submitted-banner",children:[" Submitted ",new Date(f.submitted_at).toLocaleTimeString()]}),e.jsxs("div",{className:"daily-report-content",children:[e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:f.crew_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:f.tasks_completed||0}),e.jsx("div",{className:"daily-report-card-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:f.tm_tickets_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:f.photos_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Photos"})]})]}),f.crew_list?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(oa,{size:18,className:"inline-icon"})," Crew"]}),e.jsx("div",{className:"daily-report-crew",children:f.crew_list.map((re,w)=>e.jsxs("div",{className:"daily-report-crew-item",children:[e.jsx("span",{children:re.name}),e.jsx("span",{className:"daily-report-crew-role",children:re.role})]},w))})]}),f.completed_tasks?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(ms,{size:18,className:"inline-icon"})," Completed Today"]}),e.jsx("ul",{className:"daily-report-tasks",children:f.completed_tasks.map((re,w)=>e.jsxs("li",{children:[re.name,re.group&&e.jsx("span",{className:"daily-report-task-group",children:re.group})]},w))})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Aa,{size:18,className:"inline-icon"})," Notes"]}),e.jsx("textarea",{value:v,onChange:re=>x(re.target.value),placeholder:"Any notes about today's work...",rows:3,disabled:I})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(jl,{size:18,className:"inline-icon"})," Issues / Concerns"]}),e.jsx("textarea",{value:R,onChange:re=>A(re.target.value),placeholder:"Any problems, delays, or concerns...",rows:3,disabled:I})]})]}),!I&&e.jsxs("div",{className:"daily-report-footer",children:[e.jsx("button",{className:"btn btn-primary daily-report-submit",onClick:F,disabled:u,children:u?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(Av,{size:16,className:"inline-icon"})," Submit Report"]})}),e.jsx("p",{className:"daily-report-hint",children:"This will be sent to the office"})]})]})}function ty({project:r,viewerType:l,viewerName:c,onShowToast:i,onClose:m}){const[u,g]=p.useState([]),[f,j]=p.useState(!0),[v,x]=p.useState(!1),[R,A]=p.useState(""),q=p.useRef(null);p.useEffect(()=>{F(),ee.markMessagesRead(r.id,l)},[r.id]),p.useEffect(()=>{q.current?.scrollIntoView({behavior:"smooth"})},[u]);const F=async()=>{try{const w=await ee.getMessages(r.id);g(w.reverse())}catch(w){console.error("Error loading messages:",w)}finally{j(!1)}},B=async()=>{if(R.trim()){if(!Q){i("Demo Mode: Messages won't sync to other users","info");const w={id:Date.now(),project_id:r.id,message:R.trim(),sender_type:l,sender_name:c,created_at:new Date().toISOString()};g([...u,w]),A("");return}x(!0);try{const w=await ee.sendMessage(r.id,R.trim(),l,c);w?(g([...u,w]),A("")):i("Message not sent - check connection","error")}catch(w){console.error("Error sending message:",w),i("Error sending message","error")}finally{x(!1)}}},I=w=>{w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),B())},re=w=>{const T=new Date(w),C=new Date;return T.toDateString()===C.toDateString()?T.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):T.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})};return e.jsxs("div",{className:"messages-container",children:[e.jsxs("div",{className:"messages-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:m,children:""}),e.jsxs("div",{children:[e.jsx("h2",{children:"Messages"}),e.jsx("p",{className:"messages-project",children:r.name})]})]}),e.jsxs("div",{className:"messages-list",children:[f?e.jsx("div",{className:"messages-loading",children:"Loading..."}):u.length===0?e.jsxs("div",{className:"messages-empty",children:[e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"messages-empty-hint",children:l==="field"?"Messages from the office will appear here":"Send a message to the field crew"})]}):u.map(w=>e.jsx("div",{className:`message ${w.sender_type===l?"sent":"received"}`,children:e.jsxs("div",{className:"message-bubble",children:[e.jsxs("div",{className:"message-sender",children:[w.sender_type==="office"?e.jsx(pn,{size:14,className:"inline-icon"}):e.jsx(oa,{size:14,className:"inline-icon"})," ",w.sender_name]}),e.jsx("div",{className:"message-text",children:w.message}),w.photo_url&&e.jsx("img",{src:w.photo_url,alt:"Attached",className:"message-photo"}),e.jsx("div",{className:"message-time",children:re(w.created_at)})]})},w.id)),e.jsx("div",{ref:q})]}),e.jsxs("div",{className:"messages-input-container",children:[e.jsx("textarea",{value:R,onChange:w=>A(w.target.value),onKeyDown:I,placeholder:"Type a message...",rows:1,disabled:v}),e.jsx("button",{className:"messages-send-btn",onClick:B,disabled:v||!R.trim(),children:v?"...":""})]})]})}function ay({project:r,requestedBy:l,onShowToast:c,onClose:i}){const[m,u]=p.useState([{name:"",quantity:"",unit:"each"}]),[g,f]=p.useState(""),[j,v]=p.useState("normal"),[x,R]=p.useState(""),[A,q]=p.useState(!1),F=()=>{u([...m,{name:"",quantity:"",unit:"each"}])},B=(w,T,C)=>{u(m.map((W,le)=>le===w?{...W,[T]:C}:W))},I=w=>{m.length>1&&u(m.filter((T,C)=>C!==w))},re=async()=>{const w=m.filter(T=>T.name.trim()&&parseFloat(T.quantity)>0);if(w.length===0){c("Add at least one item with quantity","error");return}if(!Q){c("Demo Mode: Request saved locally only - won't reach office","info"),i();return}q(!0);try{await ee.createMaterialRequest(r.id,w,l,g||null,j,x||null)?(c("Request submitted!","success"),i()):c("Request not sent - check connection","error")}catch(T){console.error("Error submitting request:",T),c("Error submitting request","error")}finally{q(!1)}};return e.jsxs("div",{className:"material-request",children:[e.jsxs("div",{className:"material-request-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),e.jsx("h2",{children:"Request Materials"})]}),e.jsxs("div",{className:"material-request-content",children:[e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"What do you need?"}),m.map((w,T)=>e.jsxs("div",{className:"material-request-item",children:[e.jsx("input",{type:"text",placeholder:"Item name",value:w.name,onChange:C=>B(T,"name",C.target.value),className:"material-request-name"}),e.jsx("input",{type:"number",placeholder:"Qty",value:w.quantity,onChange:C=>B(T,"quantity",C.target.value),className:"material-request-qty"}),e.jsxs("select",{value:w.unit,onChange:C=>B(T,"unit",C.target.value),className:"material-request-unit",children:[e.jsx("option",{value:"each",children:"each"}),e.jsx("option",{value:"rolls",children:"rolls"}),e.jsx("option",{value:"boxes",children:"boxes"}),e.jsx("option",{value:"bags",children:"bags"}),e.jsx("option",{value:"sheets",children:"sheets"}),e.jsx("option",{value:"gallons",children:"gal"}),e.jsx("option",{value:"feet",children:"ft"}),e.jsx("option",{value:"lbs",children:"lbs"})]}),e.jsx("button",{className:"material-request-remove",onClick:()=>I(T),children:""})]},T)),e.jsx("button",{className:"material-request-add",onClick:F,children:"+ Add Another Item"})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Priority"}),e.jsx("div",{className:"material-request-priority",children:["low","normal","urgent"].map(w=>e.jsxs("button",{className:`priority-btn ${j===w?"active":""} ${w}`,onClick:()=>v(w),children:[w==="urgent"&&" ",w==="normal"&&" ",w==="low"&&" ",w.charAt(0).toUpperCase()+w.slice(1)]},w))})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Needed By (optional)"}),e.jsx("input",{type:"date",value:g,onChange:w=>f(w.target.value),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Notes (optional)"}),e.jsx("textarea",{value:x,onChange:w=>R(w.target.value),placeholder:"Any additional details...",rows:2})]})]}),e.jsx("div",{className:"material-request-footer",children:e.jsx("button",{className:"btn btn-primary",onClick:re,disabled:A,children:A?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(ps,{size:16,className:"inline-icon"})," Submit Request"]})})})]})}const sy=p.createContext({}),xf=()=>p.useContext(sy);function As({message:r,type:l="",onClose:c}){return p.useEffect(()=>{const i=setTimeout(c,3e3);return()=>clearTimeout(i)},[c]),e.jsx("div",{className:"toast-container",children:e.jsx("div",{className:`toast ${l}`,children:r})})}function jf({project:r,companyId:l,onClose:c,onReportCreated:i}){const{user:m}=xf(),[u,g]=p.useState(!1),[f,j]=p.useState(null),[v,x]=p.useState(1),[R,A]=p.useState(new Date().toISOString().split("T")[0]),[q,F]=p.useState(new Date().toTimeString().split(" ")[0].substring(0,5)),[B,I]=p.useState(""),[re,w]=p.useState(""),[T,C]=p.useState("minor"),[W,le]=p.useState(""),[O,U]=p.useState(""),[Y,J]=p.useState(""),[D,_]=p.useState(""),[y,S]=p.useState(""),[K,k]=p.useState(""),[ie,M]=p.useState(""),[G,L]=p.useState(m?.name||""),[P,$]=p.useState(""),[E,ue]=p.useState(""),[Me,Te]=p.useState(m?.email||""),[te,ze]=p.useState([]),[Re,qe]=p.useState(""),[Ie,Ct]=p.useState(""),[nt,jt]=p.useState(""),[Ht,pt]=p.useState(""),[at,va]=p.useState(!1),[_e,Ze]=p.useState(""),[Ge,Le]=p.useState(""),[Ve,Ye]=p.useState(!1),[je,dt]=p.useState(""),[vt,ct]=p.useState(""),[Pt,De]=p.useState(""),[Z,H]=p.useState(""),[Ee,Se]=p.useState(!1),[Ne,ke]=p.useState(!1),[se,ye]=p.useState(0),[pe,et]=p.useState(0),mt=()=>{if(!Re.trim()){j({type:"error",message:"Please enter witness name"});return}const be={name:Re,phone:Ie,email:nt,testimony:Ht};ze([...te,be]),qe(""),Ct(""),jt(""),pt(""),j({type:"success",message:"Witness added"})},Xt=be=>{ze(te.filter((Dt,St)=>St!==be))},At=be=>{switch(be){case 1:if(!B.trim()||!re.trim())return j({type:"error",message:"Please fill in all incident details"}),!1;break;case 2:if(!O.trim()||!K.trim())return j({type:"error",message:"Please fill in employee name and job title"}),!1;break;case 3:if(!G.trim()||!P.trim())return j({type:"error",message:"Please fill in supervisor name and title"}),!1;break}return!0},$t=()=>{At(v)&&x(v+1)},sa=()=>{x(v-1)},Kt=async()=>{if(At(v)){if(!Q){j({type:"info",message:"Demo Mode: Report saved locally only - won't reach office"}),setTimeout(()=>{c()},1500);return}g(!0);try{const be={project_id:r.id,company_id:l,incident_date:R,incident_time:q,incident_location:B,incident_description:re,injury_type:T,body_part_affected:W||null,employee_name:O,employee_phone:Y||null,employee_email:D||null,employee_address:y||null,employee_job_title:K,employee_hire_date:ie||null,medical_treatment_required:at,medical_facility_name:_e||null,medical_facility_address:Ge||null,hospitalized:Ve,reported_by_name:G,reported_by_title:P,reported_by_phone:E||null,reported_by_email:Me||null,witnesses:te,immediate_actions_taken:je||null,corrective_actions_planned:vt||null,safety_equipment_used:Pt||null,safety_equipment_failed:Z||null,osha_recordable:Ee,workers_comp_claim:Ne,days_away_from_work:parseInt(se)||0,restricted_work_days:parseInt(pe)||0,status:"reported",created_by:m?.id},Dt=await ee.createInjuryReport(be);j({type:"success",message:"Injury report submitted successfully"}),i&&i(Dt),setTimeout(()=>{c()},1500)}catch(be){console.error("Error submitting injury report:",be),j({type:"error",message:"Failed to submit injury report"})}finally{g(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:c,children:e.jsxs("div",{className:"modal-content injury-report-modal",onClick:be=>be.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Workplace Injury/Incident Report"}),e.jsx("button",{className:"close-btn",onClick:c,children:""})]}),e.jsxs("div",{className:"progress-steps",children:[e.jsx("div",{className:`step ${v>=1?"active":""}`,children:"1. Incident"}),e.jsx("div",{className:`step ${v>=2?"active":""}`,children:"2. Employee"}),e.jsx("div",{className:`step ${v>=3?"active":""}`,children:"3. Supervisor"}),e.jsx("div",{className:`step ${v>=4?"active":""}`,children:"4. Witnesses"}),e.jsx("div",{className:`step ${v>=5?"active":""}`,children:"5. Medical & Safety"})]}),e.jsxs("div",{className:"modal-body",children:[v===1&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Incident Details"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date of Incident *"}),e.jsx("input",{type:"date",value:R,onChange:be=>A(be.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Time of Incident *"}),e.jsx("input",{type:"time",value:q,onChange:be=>F(be.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Location on Site *"}),e.jsx("input",{type:"text",value:B,onChange:be=>I(be.target.value),placeholder:"e.g., Floor 2, near elevator shaft"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Incident Description *"}),e.jsx("textarea",{value:re,onChange:be=>w(be.target.value),rows:4,placeholder:"Describe what happened in detail..."})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Injury Type *"}),e.jsxs("select",{value:T,onChange:be=>C(be.target.value),children:[e.jsx("option",{value:"minor",children:"Minor Injury"}),e.jsx("option",{value:"serious",children:"Serious Injury"}),e.jsx("option",{value:"critical",children:"Critical Injury"}),e.jsx("option",{value:"near_miss",children:"Near Miss (No Injury)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("input",{type:"text",value:W,onChange:be=>le(be.target.value),placeholder:"e.g., Left hand, lower back"})]})]})]}),v===2&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Injured Employee Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:O,onChange:be=>U(be.target.value),placeholder:"First and last name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:Y,onChange:be=>J(be.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:D,onChange:be=>_(be.target.value),placeholder:"email@example.com"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Home Address"}),e.jsx("input",{type:"text",value:y,onChange:be=>S(be.target.value),placeholder:"Street address, city, state, zip"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Title *"}),e.jsx("input",{type:"text",value:K,onChange:be=>k(be.target.value),placeholder:"e.g., Carpenter, Electrician"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Hire Date"}),e.jsx("input",{type:"date",value:ie,onChange:be=>M(be.target.value)})]})]})]}),v===3&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Foreman/Supervisor Making Report"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Name *"}),e.jsx("input",{type:"text",value:G,onChange:be=>L(be.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Title *"}),e.jsx("input",{type:"text",value:P,onChange:be=>$(be.target.value),placeholder:"e.g., Site Foreman, Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Phone Number"}),e.jsx("input",{type:"tel",value:E,onChange:be=>ue(be.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Email Address"}),e.jsx("input",{type:"email",value:Me,onChange:be=>Te(be.target.value),placeholder:"email@example.com"})]})]}),v===4&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Witness Testimonies (Optional)"}),te.length>0&&e.jsx("div",{className:"witnesses-list",children:te.map((be,Dt)=>e.jsxs("div",{className:"witness-item",children:[e.jsxs("div",{className:"witness-info",children:[e.jsx("strong",{children:be.name}),be.phone&&e.jsxs("span",{children:["  ",be.phone]}),be.testimony&&e.jsxs("p",{className:"witness-testimony",children:['"',be.testimony,'"']})]}),e.jsx("button",{className:"btn-danger btn-small",onClick:()=>Xt(Dt),children:"Remove"})]},Dt))}),e.jsxs("div",{className:"add-witness-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Name"}),e.jsx("input",{type:"text",value:Re,onChange:be=>qe(be.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:Ie,onChange:be=>Ct(be.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:nt,onChange:be=>jt(be.target.value),placeholder:"email@example.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Testimony"}),e.jsx("textarea",{value:Ht,onChange:be=>pt(be.target.value),rows:3,placeholder:"What did the witness see or hear?"})]}),e.jsx("button",{className:"btn-secondary",onClick:mt,children:"+ Add Witness"})]})]}),v===5&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Medical Treatment & Safety"}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:at,onChange:be=>va(be.target.checked)}),"Medical treatment required"]})}),at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Name"}),e.jsx("input",{type:"text",value:_e,onChange:be=>Ze(be.target.value),placeholder:"Hospital or clinic name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Address"}),e.jsx("input",{type:"text",value:Ge,onChange:be=>Le(be.target.value),placeholder:"Street address"})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Ve,onChange:be=>Ye(be.target.checked)}),"Employee was hospitalized"]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("textarea",{value:je,onChange:be=>dt(be.target.value),rows:2,placeholder:"What was done immediately after the incident?"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("textarea",{value:vt,onChange:be=>ct(be.target.value),rows:2,placeholder:"What will be done to prevent this in the future?"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("input",{type:"text",value:Pt,onChange:be=>De(be.target.value),placeholder:"e.g., Hard hat, gloves, harness"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("input",{type:"text",value:Z,onChange:be=>H(be.target.value),placeholder:"Equipment that failed, if any"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("input",{type:"number",min:"0",value:se,onChange:be=>ye(be.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("input",{type:"number",min:"0",value:pe,onChange:be=>et(be.target.value)})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Ee,onChange:be=>Se(be.target.checked)}),"OSHA Recordable Incident"]})}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Ne,onChange:be=>ke(be.target.checked)}),"Workers' Compensation Claim Filed"]})})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"form-actions",children:[v>1&&e.jsx("button",{className:"btn-secondary",onClick:sa,children:" Back"}),e.jsx("button",{className:"btn-secondary",onClick:c,children:"Cancel"}),v<5?e.jsx("button",{className:"btn-primary",onClick:$t,children:"Next "}):e.jsx("button",{className:"btn-primary",onClick:Kt,disabled:u,children:u?"Submitting...":"Submit Report"})]})})]})}),f&&e.jsx(As,{message:f.message,type:f.type,onClose:()=>j(null)}),e.jsx("style",{children:`
        .injury-report-modal {
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid var(--border-color);
          background-color: var(--bg-elevated);
          overflow-x: auto;
        }

        .progress-steps .step {
          font-size: 0.875rem;
          color: var(--text-muted);
          font-weight: 500;
          white-space: nowrap;
          padding: 0.5rem;
        }

        .progress-steps .step.active {
          color: var(--accent-primary);
          font-weight: 600;
        }

        .form-step h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          color: var(--text-primary);
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 1rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-group textarea {
          resize: vertical;
        }

        .checkbox-group label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: normal;
          cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
          width: auto;
          margin: 0;
        }

        .witnesses-list {
          margin-bottom: 1.5rem;
        }

        .witness-item {
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .witness-info {
          flex: 1;
          color: var(--text-primary);
        }

        .witness-testimony {
          margin-top: 0.5rem;
          color: var(--text-secondary);
          font-style: italic;
          font-size: 0.875rem;
        }

        .add-witness-form {
          border: 2px dashed var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          background-color: var(--bg-elevated);
        }

        .modal-footer {
          border-top: 1px solid var(--border-color);
          padding: 1rem 1.5rem;
        }

        .form-actions {
          display: flex;
          justify-content: space-between;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
        }

        @media (max-width: 768px) {
          .injury-report-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }

          .form-row {
            grid-template-columns: 1fr;
          }

          .progress-steps .step {
            font-size: 0.75rem;
            padding: 0.25rem;
          }
        }
      `})]})}function vf({compact:r=!1}){const{theme:l,toggleTheme:c}=ej();return e.jsx("button",{className:`theme-toggle ${r?"theme-toggle-compact":""}`,onClick:c,title:`Switch to ${l==="dark"?"light":"dark"} mode`,"aria-label":`Switch to ${l==="dark"?"light":"dark"} mode`,children:l==="dark"?e.jsxs(e.Fragment,{children:[e.jsx(wv,{size:r?18:16}),!r&&e.jsx("span",{children:"Light"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ev,{size:r?18:16}),!r&&e.jsx("span",{children:"Dark"})]})})}const ld=[{value:"concrete",label:"Concrete",icon:""},{value:"trash",label:"Trash",icon:""},{value:"metals",label:"Metals",icon:""},{value:"hazardous_waste",label:"Hazardous",icon:""}];function ny({project:r,user:l=null,date:c,onShowToast:i}){const[m,u]=p.useState([]),[g,f]=p.useState(!0),[j,v]=p.useState(!1),[x,R]=p.useState(!1),[A,q]=p.useState({type:"concrete",count:1}),F=new Date(c).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});p.useEffect(()=>{B()},[r.id,c]);const B=async()=>{try{f(!0);const O=await ee.getDisposalLoads(r.id,c);u(O||[])}catch(O){console.error("Error loading disposal loads:",O)}finally{f(!1)}},I=async()=>{if(!(A.count<1)){v(!0);try{await ee.addDisposalLoad(r.id,l?.id||null,c,A.type,A.count),await B(),q({type:"concrete",count:1}),R(!1),i?.("Disposal load added","success")}catch(O){console.error("Error adding disposal load:",O),i?.("Error adding load","error")}finally{v(!1)}}},re=async O=>{v(!0);try{await ee.deleteDisposalLoad(O),await B(),i?.("Load removed","success")}catch(U){console.error("Error deleting disposal load:",U),i?.("Error removing load","error")}finally{v(!1)}},w=async O=>{v(!0);try{await ee.addDisposalLoad(r.id,l?.id||null,c,O,1),await B(),i?.("Load added","success")}catch(U){console.error("Error adding disposal load:",U),i?.("Error adding load","error")}finally{v(!1)}},T=async O=>{v(!0);try{await ee.updateDisposalLoad(O.id,O.load_type,O.load_count+1),await B()}catch(U){console.error("Error updating load:",U),i?.("Error updating load","error")}finally{v(!1)}},C=async O=>{if(O.load_count<=1){await re(O.id);return}v(!0);try{await ee.updateDisposalLoad(O.id,O.load_type,O.load_count-1),await B()}catch(U){console.error("Error updating load:",U),i?.("Error updating load","error")}finally{v(!1)}},W=m.reduce((O,U)=>(O[U.load_type]||(O[U.load_type]={items:[],total:0}),O[U.load_type].items.push(U),O[U.load_type].total+=U.load_count,O),{}),le=m.reduce((O,U)=>O+U.load_count,0);return g?e.jsxs("div",{className:"disposal-load-input",children:[e.jsxs("div",{className:"disposal-header",children:[e.jsx(Ka,{size:20}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("div",{className:"disposal-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-load-input",children:[e.jsxs("div",{className:"disposal-header",children:[e.jsxs("div",{className:"disposal-title",children:[e.jsx(Ka,{size:20}),e.jsx("span",{children:"Disposal Loads"}),le>0&&e.jsx("span",{className:"disposal-badge",children:le})]}),e.jsx("span",{className:"disposal-date",children:F})]}),e.jsx("div",{className:"disposal-quick-add",children:ld.map(O=>e.jsxs("button",{className:"quick-add-btn",onClick:()=>w(O.value),disabled:j,children:[e.jsx("span",{className:"quick-add-icon",children:O.icon}),e.jsxs("span",{className:"quick-add-label",children:["+ ",O.label]})]},O.value))}),Object.keys(W).length>0?e.jsx("div",{className:"disposal-loads-list",children:ld.map(O=>{const U=W[O.value];return U?e.jsxs("div",{className:"disposal-load-row",children:[e.jsxs("div",{className:"load-info",children:[e.jsx("span",{className:"load-icon",children:O.icon}),e.jsx("span",{className:"load-label",children:O.label})]}),e.jsxs("div",{className:"load-controls",children:[e.jsx("button",{className:"load-btn decrement",onClick:()=>C(U.items[0]),disabled:j,children:e.jsx(Nd,{size:16})}),e.jsx("span",{className:"load-count",children:U.total}),e.jsx("button",{className:"load-btn increment",onClick:()=>T(U.items[0]),disabled:j,children:e.jsx(Ta,{size:16})})]})]},O.value):null})}):e.jsxs("div",{className:"disposal-empty",children:[e.jsxs("p",{children:["No disposal loads recorded for ",F]}),e.jsx("p",{className:"disposal-hint",children:"Tap a button above to add loads"})]}),x&&e.jsxs("div",{className:"disposal-add-form",children:[e.jsxs("div",{className:"add-form-row",children:[e.jsx("select",{value:A.type,onChange:O=>q({...A,type:O.target.value}),className:"load-type-select",children:ld.map(O=>e.jsxs("option",{value:O.value,children:[O.icon," ",O.label]},O.value))}),e.jsxs("div",{className:"count-input-group",children:[e.jsx("button",{className:"count-btn",onClick:()=>q({...A,count:Math.max(1,A.count-1)}),children:e.jsx(Nd,{size:16})}),e.jsx("input",{type:"number",min:"1",value:A.count,onChange:O=>q({...A,count:parseInt(O.target.value)||1}),className:"count-input"}),e.jsx("button",{className:"count-btn",onClick:()=>q({...A,count:A.count+1}),children:e.jsx(Ta,{size:16})})]})]}),e.jsxs("div",{className:"add-form-actions",children:[e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>R(!1),children:[e.jsx(es,{size:16})," Cancel"]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:I,disabled:j,children:[e.jsx(Wa,{size:16})," Add"]})]})]}),!x&&e.jsxs("button",{className:"disposal-add-custom",onClick:()=>R(!0),children:[e.jsx(Ta,{size:16}),"Add multiple loads"]}),le>0&&e.jsxs("div",{className:"disposal-summary",children:[e.jsx("strong",{children:le})," total load",le!==1?"s":""," today"]})]})}function ry({project:r,companyId:l,onShowToast:c,onExit:i}){const[m,u]=p.useState([]),[g,f]=p.useState(!0),[j,v]=p.useState(null),[x,R]=p.useState({}),[A,q]=p.useState(!1),[F,B]=p.useState(!1),[I,re]=p.useState(!1),[w,T]=p.useState(!1),[C,W]=p.useState(!1),[le,O]=p.useState(!1),[U,Y]=p.useState(!1),[J,D]=p.useState(!1),[_,y]=p.useState(0),[S,K]=p.useState("actions");p.useEffect(()=>{k(),ie()},[r.id]);const k=async()=>{try{const te=await ee.getAreas(r.id);u(te);const ze=[...new Set(te.map(qe=>qe.group_name||"General"))],Re={};ze.forEach(qe=>Re[qe]=!1),R(Re)}catch(te){console.error("Error loading areas:",te),c("Error loading areas","error")}finally{f(!1)}},ie=async()=>{const te=await ee.getUnreadCount(r.id,"field");y(te)},M=async(te,ze)=>{const Re=m.find(Ie=>Ie.id===te);if(!Re)return;const qe=Re.status===ze?"not_started":ze;v(te);try{await ee.updateAreaStatus(te,qe),u(Ie=>Ie.map(Ct=>Ct.id===te?{...Ct,status:qe}:Ct)),c("Updated","success")}catch(Ie){console.error("Error updating status:",Ie),c("Error updating","error")}finally{v(null)}},G=te=>{R(ze=>({...ze,[te]:!ze[te]}))};if(g)return e.jsx("div",{className:"foreman-container",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading..."]})});if(A)return e.jsx("div",{className:"foreman-container",children:e.jsx(Wv,{project:r,companyId:l,onSubmit:()=>q(!1),onCancel:()=>q(!1),onShowToast:c})});if(w)return e.jsx(ey,{project:r,onShowToast:c,onClose:()=>T(!1)});if(C)return e.jsx(ty,{project:r,viewerType:"field",viewerName:"Field",onShowToast:c,onClose:()=>{W(!1),ie()}});if(le)return e.jsx(ay,{project:r,requestedBy:"Field",onShowToast:c,onClose:()=>O(!1)});if(U)return e.jsx("div",{className:"foreman-container",children:e.jsx(jf,{project:r,companyId:l,onClose:()=>Y(!1),onReportCreated:()=>{Y(!1),c("Injury report submitted","success")}})});if(F)return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-view-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:()=>B(!1),children:""}),e.jsx("h2",{children:"Crew Check-in"})]}),e.jsx(Kv,{project:r,onShowToast:c})]});if(I)return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-view-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:()=>re(!1),children:""}),e.jsx("h2",{children:"Disposal Loads"})]}),e.jsx(ny,{project:r,date:new Date().toISOString().split("T")[0],onShowToast:c})]});const L=Gv(m),P=m.reduce((te,ze)=>{const Re=ze.group_name||"General";return te[Re]||(te[Re]=[]),te[Re].push(ze),te},{}),$=Object.keys(P).length>1||Object.keys(P).length===1&&!P.General,E=te=>`${te.filter(Re=>Re.status==="done").length}/${te.length}`,ue=m.filter(te=>te.status==="done").length,Me=m.filter(te=>te.status==="working").length,Te=m.length-ue;return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),e.jsxs("div",{className:"foreman-header-info",children:[e.jsx("div",{className:"foreman-project-name",children:r.name}),e.jsxs("div",{className:"foreman-progress",children:[L,"% Complete"]})]}),e.jsxs("div",{className:"foreman-header-actions",children:[e.jsx(vf,{compact:!0}),e.jsx("button",{className:"foreman-info-btn",onClick:()=>D(!J),children:e.jsx(_d,{size:20})})]})]}),J&&e.jsxs("div",{className:"foreman-project-info",children:[r.job_number&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Job #"}),e.jsx("span",{className:"foreman-info-value",children:r.job_number})]}),r.address&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Address"}),e.jsx("span",{className:"foreman-info-value",children:r.address})]}),r.general_contractor&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"GC / Client"}),e.jsx("span",{className:"foreman-info-value",children:r.general_contractor})]}),r.client_contact&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Contact"}),e.jsx("span",{className:"foreman-info-value",children:r.client_contact})]}),r.client_phone&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Phone"}),e.jsx("a",{href:`tel:${r.client_phone}`,className:"foreman-info-value foreman-info-link",children:r.client_phone})]})]}),e.jsxs("div",{className:"foreman-stats",children:[e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value working",children:Me}),e.jsx("div",{className:"foreman-stat-label",children:"Working"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value done",children:ue}),e.jsx("div",{className:"foreman-stat-label",children:"Done"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value remaining",children:Te}),e.jsx("div",{className:"foreman-stat-label",children:"Remaining"})]})]}),e.jsxs("div",{className:"foreman-tabs",children:[e.jsxs("button",{className:`foreman-tab ${S==="actions"?"active":""}`,onClick:()=>K("actions"),children:[e.jsx(Sd,{size:18}),"Actions"]}),e.jsxs("button",{className:`foreman-tab ${S==="progress"?"active":""}`,onClick:()=>K("progress"),children:[e.jsx(bv,{size:18}),"Progress"]})]}),S==="actions"&&e.jsxs("div",{className:"field-actions",children:[e.jsxs("button",{className:"field-action-btn",onClick:()=>q(!0),children:[e.jsx(Aa,{size:22}),"T&M Ticket"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>B(!0),children:[e.jsx(oa,{size:22}),"Crew Check-in"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>re(!0),children:[e.jsx(Ka,{size:22}),"Disposal Loads"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>O(!0),children:[e.jsx(ps,{size:22}),"Materials"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>W(!0),children:[e.jsx(Rs,{size:22}),"Messages",_>0&&e.jsx("span",{className:"badge",children:_})]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>T(!0),children:[e.jsx(Ja,{size:22}),"Daily Report"]}),e.jsxs("button",{className:"field-action-btn danger",onClick:()=>Y(!0),children:[e.jsx(jl,{size:22}),"Report Injury"]})]}),S==="progress"&&e.jsxs("div",{className:"foreman-areas",children:[$?Object.entries(P).map(([te,ze])=>e.jsxs("div",{className:"foreman-group",children:[e.jsxs("div",{className:"foreman-group-header",onClick:()=>G(te),children:[e.jsxs("div",{className:"foreman-group-title",children:[e.jsx("span",{className:"foreman-group-arrow",children:x[te]?"":""}),e.jsx("span",{className:"foreman-group-name",children:te})]}),e.jsx("span",{className:"foreman-group-progress",children:E(ze)})]}),x[te]&&e.jsx("div",{className:"foreman-group-tasks",children:ze.map(Re=>e.jsxs("div",{className:`foreman-area-card ${Re.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:Re.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${Re.status==="working"?"active":""}`,onClick:()=>M(Re.id,"working"),disabled:j===Re.id,children:j===Re.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${Re.status==="done"?"active":""}`,onClick:()=>M(Re.id,"done"),disabled:j===Re.id,children:j===Re.id?"...":"Done"})]})]},Re.id))})]},te)):m.map(te=>e.jsxs("div",{className:`foreman-area-card ${te.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:te.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${te.status==="working"?"active":""}`,onClick:()=>M(te.id,"working"),disabled:j===te.id,children:j===te.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${te.status==="done"?"active":""}`,onClick:()=>M(te.id,"done"),disabled:j===te.id,children:j===te.id?"...":"Done"})]})]},te.id)),m.length===0&&e.jsxs("div",{className:"foreman-empty",children:[e.jsx(Ja,{size:48,className:"foreman-empty-icon"}),e.jsx("div",{className:"foreman-empty-text",children:"No areas yet"}),e.jsx("div",{className:"foreman-empty-subtext",children:"Office needs to add areas to this project"})]})]})]})}const Op=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},ly=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});function iy({project:r,company:l,onShowToast:c}){const{branding:i}=wr(),[m,u]=p.useState([]),[g,f]=p.useState(!0),[j,v]=p.useState("all"),[x,R]=p.useState(null),[A,q]=p.useState(new Set),[F,B]=p.useState("recent"),[I,re]=p.useState(new Set),[w,T]=p.useState({start:"",end:""}),[C,W]=p.useState(!1),[le,O]=p.useState(null),[U,Y]=p.useState(""),[J,D]=p.useState(!1),[_,y]=p.useState(null),[S,K]=p.useState(!1),[k,ie]=p.useState(null),[M,G]=p.useState([]),[L,P]=p.useState(""),[$,E]=p.useState(!1),[ue,Me]=p.useState({});p.useEffect(()=>{Te();const Z=ee.subscribeToTMTickets?.(r.id,()=>{Te()});return()=>{Z&&ee.unsubscribe?.(Z)}},[r.id]);const Te=async()=>{try{const Z=await ee.getTMTickets(r.id);u(Z);const H=Z.filter(Ee=>Ee.assigned_cor_id);if(H.length>0){const Ee={};await Promise.all(H.map(async Se=>{const Ne=await ee.isTicketEditable(Se);Ne.editable||(Ee[Se.id]=Ne)})),Me(Ee)}}catch(Z){console.error("Error loading tickets:",Z),c("Error loading T&M tickets","error")}finally{f(!1)}},te=async(Z,H)=>{if(ue[Z]){c(ue[Z].reason||"This ticket is locked (COR approved)","error");return}try{await ee.updateTMTicketStatus(Z,H),u(m.map(Ee=>Ee.id===Z?{...Ee,status:H}:Ee)),c(`Ticket ${H}`,"success")}catch(Ee){console.error("Error updating status:",Ee),c("Error updating status","error")}},ze=Z=>{if(ue[Z.id]){c(ue[Z.id].reason||"This ticket is locked (COR approved)","error");return}te(Z.id,"approved")},Re=async()=>{if(le)try{const Z=parseFloat(U)||0;await ee.approveTMTicket(le.id,null,null,Z),u(m.map(H=>H.id===le.id?{...H,status:"approved",change_order_value:Z}:H)),c(`Ticket approved with $${Z.toLocaleString()} change order`,"success"),W(!1),O(null),Y("")}catch(Z){console.error("Error approving ticket:",Z),c("Error approving ticket","error")}},qe=async Z=>{if(ue[Z]){c(ue[Z].reason||"This ticket is locked (COR approved)","error");return}if(confirm("Delete this T&M ticket?"))try{await ee.deleteTMTicket(Z),u(m.filter(H=>H.id!==Z)),c("Ticket deleted","success")}catch(H){console.error("Error deleting ticket:",H),c("Error deleting ticket","error")}},Ie=async Z=>{ie(Z),P(Z.assigned_cor_id||""),K(!0),E(!0);try{const H=await ee.getAssignableCORs(r.id);G(H||[])}catch(H){console.error("Error loading CORs:",H),c("Error loading change orders","error")}finally{E(!1)}},Ct=async()=>{if(k)try{if(L){await ee.assignTicketToCOR(k.id,L);const Z=M.find(H=>H.id===L);c(`Ticket linked to ${Z?.cor_number||"COR"}`,"success")}else k.assigned_cor_id&&(await ee.unassignTicketFromCOR(k.id,k.assigned_cor_id),c("Ticket unlinked from COR","success"));Te(),K(!1),ie(null),P("")}catch(Z){console.error("Error updating COR association:",Z),c("Error updating COR link","error")}},nt=Z=>{let H=0;return Z.t_and_m_items&&Z.t_and_m_items.forEach(Ee=>{Ee.materials_equipment?.cost_per_unit&&(H+=Ee.quantity*Ee.materials_equipment.cost_per_unit)}),H},jt=Z=>Z.t_and_m_workers?Z.t_and_m_workers.reduce((H,Ee)=>{const Se=parseFloat(Ee.hours)||0,Ne=parseFloat(Ee.overtime_hours)||0;return H+Se+Ne},0):0,Ht=Z=>new Date(Z).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),pt=(Z,H)=>{H.stopPropagation(),q(Ee=>{const Se=new Set(Ee);return Se.has(Z)?Se.delete(Z):Se.add(Z),Se})},at=()=>{const Z=j==="all"?m:m.filter(Ee=>Ee.status===j),H=Z.every(Ee=>A.has(Ee.id));q(H?new Set:new Set(Z.map(Ee=>Ee.id)))},va=()=>{q(new Set)},_e=()=>{const Z=j==="all"?m:m.filter(H=>H.status===j);return A.size>0?Z.filter(H=>A.has(H.id)):Z},Ze=()=>{const Z=_e();if(Z.length===0){c("No tickets to export","error");return}const H=[],Ee=[],Se=[];Z.forEach(ye=>{const pe=Ht(ye.work_date),et=ye.status;ye.t_and_m_workers&&ye.t_and_m_workers.forEach(mt=>{const Xt=parseFloat(mt.hours)||0,At=parseFloat(mt.overtime_hours)||0;H.push({Date:pe,Status:et,"Worker Name":mt.name,Role:mt.role||"Laborer","Regular Hours":Xt,"OT Hours":At,"Total Hours":Xt+At})}),ye.t_and_m_items&&ye.t_and_m_items.forEach(mt=>{const Xt=mt.custom_name||mt.materials_equipment?.name||"Unknown",At=mt.custom_category||mt.materials_equipment?.category||"Unknown",$t=mt.materials_equipment?.unit||"each",sa=mt.materials_equipment?.cost_per_unit||0,Kt=mt.quantity*sa;Ee.push({Date:pe,Status:et,Category:At,Item:Xt,Quantity:mt.quantity,Unit:$t,"Cost/Unit":sa,Total:Kt})}),Se.push({Date:pe,Status:et,Workers:ye.t_and_m_workers?.length||0,"Total Hours":jt(ye),Items:ye.t_and_m_items?.length||0,"Materials Cost":nt(ye),Notes:ye.notes||""})});const Ne=on.book_new(),ke=on.json_to_sheet(Se);if(on.book_append_sheet(Ne,ke,"Summary"),H.length>0){const ye=on.json_to_sheet(H);on.book_append_sheet(Ne,ye,"Workers")}if(Ee.length>0){const ye=on.json_to_sheet(Ee);on.book_append_sheet(Ne,ye,"Materials & Equipment")}const se=`${r.name}_TM_${new Date().toISOString().split("T")[0]}.xlsx`;Mx(Ne,se),c("Export downloaded!","success")},Ge=async()=>{const Z=_e();if(Z.length===0){c("No tickets to export","error");return}c("Generating PDF...","info");const H=new Bi,Ee=H.internal.pageSize.getWidth(),Se=H.internal.pageSize.getHeight(),Ne=20;let ke=Ne;const se=Op(i?.primary_color||"#3B82F6"),ye=Op(i?.secondary_color||"#1E40AF");H.setFillColor(...se),H.rect(0,0,Ee,45,"F"),H.setFillColor(...ye),H.rect(0,42,Ee,3,"F");let pe=Ne;if(i?.logo_url)try{const N=await ly(i.logo_url);N&&(H.addImage(N,"PNG",Ne,7,30,30),pe=Ne+30+10)}catch(N){console.error("Error adding logo:",N)}H.setTextColor(255,255,255),H.setFontSize(22),H.setFont("helvetica","bold"),H.text(l?.name||"Company Name",pe,20),H.setFontSize(10),H.setFont("helvetica","normal"),H.text("TIME & MATERIALS REPORT",pe,30),H.setFontSize(9),H.text(`Report Date: ${new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,Ee-Ne,18,{align:"right"}),r.job_number&&H.text(`Job #: ${r.job_number}`,Ee-Ne,26,{align:"right"}),H.text(`Status: ${j.charAt(0).toUpperCase()+j.slice(1)}`,Ee-Ne,34,{align:"right"}),ke=55,H.setFillColor(248,250,252),H.rect(Ne,ke-5,Ee-Ne*2,30,"F"),H.setDrawColor(...se),H.setLineWidth(.5),H.rect(Ne,ke-5,Ee-Ne*2,30,"S"),H.setTextColor(...se),H.setFontSize(14),H.setFont("helvetica","bold"),H.text(`Project: ${r.name}`,Ne+5,ke+7),H.setFontSize(10),H.setFont("helvetica","normal"),H.setTextColor(51,65,85);const et=Z.map(N=>new Date(N.work_date)).sort((N,ae)=>N-ae),mt=et[0]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Xt=et[et.length-1]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});H.text(`Date Range: ${mt} - ${Xt}`,Ne+5,ke+17),H.text(`Total Tickets: ${Z.length}`,Ee-Ne-5,ke+7,{align:"right"}),ke+=40;const At=Z.reduce((N,ae)=>N+jt(ae),0),$t=Z.reduce((N,ae)=>N+nt(ae),0),sa=new Set(Z.flatMap(N=>N.t_and_m_workers?.map(ae=>ae.name)||[])).size;H.setTextColor(...se),H.setFontSize(12),H.setFont("helvetica","bold"),H.text("SUMMARY",Ne,ke),ke+=8;const Kt=(Ee-Ne*2-20)/3,be=[{label:"Total Labor Hours",value:At.toFixed(1)},{label:"Unique Workers",value:sa.toString()},{label:"Materials Cost",value:`$${$t.toFixed(2)}`}],Dt=se.map(N=>Math.min(255,N+180));be.forEach((N,ae)=>{const xe=Ne+ae*(Kt+10);H.setFillColor(...Dt),H.rect(xe,ke,Kt,25,"F"),H.setDrawColor(...se),H.setLineWidth(.5),H.rect(xe,ke,Kt,25,"S"),H.setTextColor(...se),H.setFontSize(16),H.setFont("helvetica","bold"),H.text(N.value,xe+Kt/2,ke+12,{align:"center"}),H.setTextColor(100,116,139),H.setFontSize(8),H.setFont("helvetica","normal"),H.text(N.label,xe+Kt/2,ke+20,{align:"center"})}),ke+=35;const St=[],ts=[],we=[];let He=0,Fe=0,Xe=0,ht=0,ft=0,it=0;Z.forEach(N=>{N.t_and_m_workers&&N.t_and_m_workers.forEach(ae=>{const xe=parseFloat(ae.hours)||0,me=parseFloat(ae.overtime_hours)||0,Oe=ae.role||"Laborer",Je=[Ht(N.work_date),ae.name,xe.toString(),me>0?me.toString():"-",(xe+me).toString()];Oe==="Foreman"||Oe==="Superintendent"?(St.push(Je),He+=xe,Fe+=me):Oe==="Operator"?(ts.push(Je),Xe+=xe,ht+=me):(we.push(Je),ft+=xe,it+=me)})});const wt=(N,ae,xe,me)=>{ae.length!==0&&(ke>Se-80&&(H.addPage(),ke=Ne),H.setTextColor(...se),H.setFontSize(11),H.setFont("helvetica","bold"),H.text(N,Ne,ke),ke+=5,un(H,{startY:ke,head:[["Date","Name","Reg Hrs","OT Hrs","Total"]],body:ae,margin:{left:Ne,right:Ne},headStyles:{fillColor:se,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:30},2:{halign:"center",cellWidth:22},3:{halign:"center",cellWidth:22},4:{halign:"center",cellWidth:22}},foot:[["","SUBTOTAL:",xe.toString(),me>0?me.toString():"-",(xe+me).toString()]],footStyles:{fillColor:ye,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),ke=H.lastAutoTable.finalY+10)};if(St.length>0||ts.length>0||we.length>0){H.setTextColor(...se),H.setFontSize(12),H.setFont("helvetica","bold"),H.text("LABOR",Ne,ke),ke+=8,wt("SUPERVISION",St,He,Fe),wt("OPERATORS",ts,Xe,ht),wt("LABORERS",we,ft,it);const N=He+Xe+ft,ae=Fe+ht+it;H.setFillColor(...se),H.rect(Ne,ke,Ee-Ne*2,12,"F"),H.setTextColor(255,255,255),H.setFontSize(10),H.setFont("helvetica","bold"),H.text("LABOR TOTAL:",Ne+5,ke+8),H.text(`${N} Reg + ${ae} OT = ${N+ae} Hours`,Ee-Ne-5,ke+8,{align:"right"}),ke+=20}ke>Se-100&&(H.addPage(),ke=Ne);const Ke={},rt={},Vt=["Containment","PPE","Disposal","Equipment","Other"];Z.forEach(N=>{N.t_and_m_items&&N.t_and_m_items.forEach(ae=>{const xe=ae.custom_name||ae.materials_equipment?.name||"Unknown",me=ae.custom_category||ae.materials_equipment?.category||"Other",Oe=ae.materials_equipment?.unit||"each",Je=ae.materials_equipment?.cost_per_unit||0,Be=ae.quantity*Je;Ke[me]||(Ke[me]=[],rt[me]=0),Ke[me].push([Ht(N.work_date),xe,ae.quantity.toString(),Oe,`$${Je.toFixed(2)}`,`$${Be.toFixed(2)}`]),rt[me]+=Be})});const da=(N,ae,xe)=>{!ae||ae.length===0||(ke>Se-80&&(H.addPage(),ke=Ne),H.setTextColor(...se),H.setFontSize(11),H.setFont("helvetica","bold"),H.text(N.toUpperCase(),Ne,ke),ke+=5,un(H,{startY:ke,head:[["Date","Item","Qty","Unit","Rate","Total"]],body:ae,margin:{left:Ne,right:Ne},headStyles:{fillColor:se,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{2:{halign:"center",cellWidth:20},3:{halign:"center",cellWidth:25},4:{halign:"right",cellWidth:25},5:{halign:"right",cellWidth:30}},foot:[["","","","","Subtotal:",`$${xe.toFixed(2)}`]],footStyles:{fillColor:ye,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),ke=H.lastAutoTable.finalY+10)};Object.keys(Ke).length>0&&(H.setTextColor(...se),H.setFontSize(12),H.setFont("helvetica","bold"),H.text("MATERIALS & EQUIPMENT",Ne,ke),ke+=8,Vt.forEach(N=>{Ke[N]&&da(N,Ke[N],rt[N])}),Object.keys(Ke).forEach(N=>{Vt.includes(N)||da(N,Ke[N],rt[N])}),H.setFillColor(...se),H.rect(Ne,ke,Ee-Ne*2,12,"F"),H.setTextColor(255,255,255),H.setFontSize(10),H.setFont("helvetica","bold"),H.text("MATERIALS TOTAL:",Ne+5,ke+8),H.text(`$${$t.toFixed(2)}`,Ee-Ne-5,ke+8,{align:"right"}),ke+=20),ke>Se-80&&(H.addPage(),ke=Ne),ke+=10,H.setDrawColor(...se),H.setLineWidth(1),H.line(Ne,ke,Ee-Ne,ke),ke+=15,H.setTextColor(...se),H.setFontSize(12),H.setFont("helvetica","bold"),H.text("AUTHORIZATION",Ne,ke),ke+=10,H.setFontSize(10),H.setFont("helvetica","normal"),H.setTextColor(71,85,105),H.text("I hereby authorize the above time and materials charges as accurate and approved for billing.",Ne,ke),ke+=20;const Ae=ticketsToExport[0]||{},lt=(N,ae,xe,me,Oe,Je,Be)=>{H.setFont("helvetica","bold"),H.setFontSize(8),H.setTextColor(...se),H.text(ae,Ne,N),H.setFont("helvetica","normal"),H.setFontSize(9),H.setTextColor(100,116,139);const st=N+18;if(H.setDrawColor(...ye),H.setLineWidth(.5),H.line(Ne,st,Ne+70,st),H.text("Signature",Ne,st+8),H.line(Ne+85,st,Ne+145,st),H.text("Title / Company",Ne+85,st+8),H.line(Ee-Ne-40,st,Ee-Ne,st),H.text("Date",Ee-Ne-40,st+8),xe)try{if(H.addImage(xe,"PNG",Ne,st-16,60,16),me&&(H.setFontSize(8),H.text(me,Ne,st+15)),Oe||Je){const Mt=[Oe,Je].filter(Boolean).join(" - ");H.text(Mt,Ne+85,st-5)}if(Be){const Mt=new Date(Be).toLocaleDateString();H.text(Mt,Ee-Ne-40,st-5)}}catch(Mt){console.error("Error adding signature to PDF:",Mt)}return st+25};ke=lt(ke,"GC AUTHORIZATION",Ae.gc_signature_data,Ae.gc_signature_name,Ae.gc_signature_title,Ae.gc_signature_company,Ae.gc_signature_date),ke+=8,ke=lt(ke,"CLIENT AUTHORIZATION",Ae.client_signature_data,Ae.client_signature_name,Ae.client_signature_title,Ae.client_signature_company,Ae.client_signature_date);const na=H.internal.getNumberOfPages();for(let N=1;N<=na;N++){H.setPage(N);const ae=Se-15;H.setFontSize(8),H.setTextColor(148,163,184),H.text(`${l?.name||"Company"} - T&M Report - ${r.name}`,Ne,ae),H.text(`Page ${N} of ${na}`,Ee-Ne,ae,{align:"right"})}const _a=`${r.name}_TM_Report_${new Date().toISOString().split("T")[0]}.pdf`;H.save(_a),c("PDF exported!","success")},Le=p.useMemo(()=>{let Z=j==="all"?[...m]:m.filter(H=>H.status===j);if(w.start){const H=new Date(w.start);H.setHours(0,0,0,0),Z=Z.filter(Ee=>new Date(Ee.work_date)>=H)}if(w.end){const H=new Date(w.end);H.setHours(23,59,59,999),Z=Z.filter(Ee=>new Date(Ee.work_date)<=H)}if(F==="recent"){const H=new Date;H.setDate(H.getDate()-7),H.setHours(0,0,0,0),Z=Z.filter(Ee=>new Date(Ee.work_date)>=H)}return Z},[m,j,F,w]),Ve=p.useMemo(()=>{if(F!=="all")return null;const Z={};return Le.forEach(H=>{const Ee=new Date(H.work_date),Se=`${Ee.getFullYear()}-${String(Ee.getMonth()+1).padStart(2,"0")}`,Ne=Ee.toLocaleDateString("en-US",{month:"long",year:"numeric"});Z[Se]||(Z[Se]={label:Ne,tickets:[],hours:0,cost:0}),Z[Se].tickets.push(H),Z[Se].hours+=jt(H),Z[Se].cost+=nt(H)}),Object.entries(Z).sort((H,Ee)=>Ee[0].localeCompare(H[0]))},[Le,F]);p.useEffect(()=>{if(Ve&&Ve.length>0){const Z=Ve[0][0];re(new Set([Z]))}},[Ve]);const Ye=Z=>{const H=new Set(I);H.has(Z)?H.delete(Z):H.add(Z),re(H)},je=Le.reduce((Z,H)=>Z+jt(H),0),dt=Le.reduce((Z,H)=>Z+nt(H),0),vt=j==="all"?m.length:m.filter(Z=>Z.status===j).length;if(g)return e.jsx("div",{className:"loading",children:"Loading T&M tickets..."});const ct=Le.length>0&&Le.every(Z=>A.has(Z.id)),Pt=A.size>0,De=Z=>{const H=!!ue[Z.id],Ee=ue[Z.id];return e.jsxs("div",{className:`tm-ticket-card ${Z.status} ${A.has(Z.id)?"selected":""} ${H?"locked":""}`,children:[e.jsxs("div",{className:"tm-ticket-header",onClick:()=>R(x===Z.id?null:Z.id),children:[e.jsx("input",{type:"checkbox",checked:A.has(Z.id),onChange:Se=>pt(Z.id,Se),onClick:Se=>Se.stopPropagation(),className:"tm-checkbox"}),e.jsxs("div",{className:"tm-ticket-info",children:[e.jsx("span",{className:"tm-ticket-date",children:Ht(Z.work_date)}),Z.ce_pco_number&&e.jsx("span",{className:"tm-ce-badge",children:Z.ce_pco_number}),Z.assigned_cor_id&&Ee?.lockedBy&&e.jsxs("span",{className:`tm-cor-badge ${H?"locked":""}`,title:Ee.reason,children:[H&&e.jsx(Tp,{size:10}),Ee.lockedBy.cor_number]}),Z.photos?.length>0&&e.jsxs("span",{className:"tm-photo-badge",title:`${Z.photos.length} photo${Z.photos.length>1?"s":""}`,children:[e.jsx(xl,{size:12})," ",Z.photos.length]}),e.jsx("span",{className:`tm-ticket-status ${Z.status}`,children:Z.status})]}),e.jsxs("div",{className:"tm-ticket-summary",children:[e.jsxs("span",{className:"tm-ticket-hours",children:[jt(Z)," hrs"]}),e.jsxs("span",{className:"tm-ticket-total",children:["$",nt(Z).toFixed(2)]}),e.jsx("span",{className:"tm-expand-arrow",children:x===Z.id?"":""})]})]}),x===Z.id&&e.jsxs("div",{className:"tm-ticket-details",children:[Z.t_and_m_workers?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(oa,{size:16,className:"inline-icon"})," Workers"]}),e.jsx("div",{className:"tm-detail-list",children:Z.t_and_m_workers.map(Se=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsxs("span",{children:[Se.role&&Se.role!=="Laborer"&&e.jsx("span",{className:"tm-role-badge",children:Se.role}),Se.name]}),e.jsxs("span",{children:[Se.hours," hrs",parseFloat(Se.overtime_hours)>0&&e.jsxs("span",{className:"tm-ot-badge",children:[" +",Se.overtime_hours," OT"]})]})]},Se.id))})]}),Z.t_and_m_items?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(vl,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsx("div",{className:"tm-detail-list",children:Z.t_and_m_items.map(Se=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsx("span",{children:Se.custom_name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"tm-custom-badge",children:"Custom"})," ",Se.custom_name]}):Se.materials_equipment?.name}),e.jsxs("span",{className:"tm-detail-qty",children:[Se.quantity," ",Se.materials_equipment?.unit||"each",Se.materials_equipment?.cost_per_unit>0&&e.jsxs("span",{className:"tm-item-cost",children:["$",(Se.quantity*Se.materials_equipment.cost_per_unit).toFixed(2)]})]})]},Se.id))})]}),Z.notes&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Aa,{size:16,className:"inline-icon"})," Description"]}),e.jsx("p",{className:"tm-notes-text",children:Z.notes})]}),Z.photos&&Z.photos.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(xl,{size:16,className:"inline-icon"})," Photos (",Z.photos.length,")"]}),e.jsx("div",{className:"tm-photos-grid",children:Z.photos.map((Se,Ne)=>e.jsx("a",{href:Se,target:"_blank",rel:"noopener noreferrer",className:"tm-photo-thumb",children:e.jsx("img",{src:Se,alt:`Photo ${Ne+1}`,onError:ke=>{ke.target.onerror=null,ke.target.classList.add("photo-error"),ke.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg==",console.error("Failed to load photo:",Se)}})},Ne))})]}),Z.ce_pco_number&&Z.change_order_value>0&&e.jsxs("div",{className:"tm-change-order-value",children:[e.jsx("span",{className:"tm-co-label",children:"Change Order Value:"}),e.jsxs("span",{className:"tm-co-amount",children:["$",Z.change_order_value.toLocaleString()]})]}),H&&e.jsxs("div",{className:"tm-lock-notice",children:[e.jsx(Tp,{size:14}),e.jsx("span",{children:Ee?.reason||"This ticket is locked (COR approved)"})]}),e.jsxs("div",{className:"tm-ticket-actions",children:[Z.status==="pending"&&!H&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:Se=>{Se.stopPropagation(),ze(Z)},children:"Approve"}),e.jsx("button",{className:"btn btn-warning btn-small",onClick:Se=>{Se.stopPropagation(),te(Z.id,"rejected")},children:"Reject"})]}),Z.status==="approved"&&!H&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary btn-small",onClick:Se=>{Se.stopPropagation(),te(Z.id,"billed")},children:"Mark Billed"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:Se=>{Se.stopPropagation(),y(Z),D(!0)},children:[e.jsx(Cd,{size:14})," Signature Link"]})]}),Z.status==="rejected"&&!H&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Se=>{Se.stopPropagation(),te(Z.id,"pending")},children:"Restore"}),!H&&e.jsxs("button",{className:`btn btn-small ${Z.assigned_cor_id?"btn-ghost":"btn-secondary"}`,onClick:Se=>{Se.stopPropagation(),Ie(Z)},title:Z.assigned_cor_id?"Change COR link":"Link to Change Order",children:[e.jsx(Yj,{size:14})," ",Z.assigned_cor_id?"COR":"Link COR"]}),!H&&e.jsx("button",{className:"btn btn-danger btn-small",onClick:Se=>{Se.stopPropagation(),qe(Z.id)},children:"Delete"})]})]})]},Z.id)};return e.jsxs("div",{className:"tm-list",children:[e.jsxs("div",{className:"tm-list-header",children:[e.jsxs("div",{className:"tm-list-title",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("div",{className:"tm-export-buttons",children:[Pt&&e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:va,children:["Clear (",A.size,")"]}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:Ze,children:["Excel ",Pt?`(${A.size})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:Ge,children:["PDF ",Pt?`(${A.size})`:""]})]})]}),e.jsx("div",{className:"tm-filter-tabs",children:["all","pending","approved","billed","rejected"].map(Z=>e.jsxs("button",{className:`tm-filter-tab ${j===Z?"active":""}`,onClick:()=>{v(Z),va()},children:[Z.charAt(0).toUpperCase()+Z.slice(1),e.jsx("span",{className:"tm-filter-count",children:Z==="all"?m.length:m.filter(H=>H.status===Z).length})]},Z))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${F==="recent"?"active":""}`,onClick:()=>{B("recent"),T({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${F==="all"?"active":""}`,onClick:()=>B("all"),children:["All (",vt,")"]})]}),F==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Fn,{size:16}),e.jsx("input",{type:"date",value:w.start,onChange:Z=>T(H=>({...H,start:Z.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:w.end,onChange:Z=>T(H=>({...H,end:Z.target.value})),placeholder:"End date"}),(w.start||w.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>T({start:"",end:""}),children:"Clear"})]})]})]}),Le.length>0&&e.jsxs("div",{className:"tm-summary-bar",children:[e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Tickets"}),e.jsx("span",{className:"tm-summary-value",children:Le.length})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Total Hours"}),e.jsx("span",{className:"tm-summary-value",children:je.toFixed(1)})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Materials Cost"}),e.jsxs("span",{className:"tm-summary-value",children:["$",dt.toFixed(2)]})]})]}),Le.length===0?e.jsxs("div",{className:"tm-empty-state",children:[e.jsxs("p",{children:["No ",j==="all"?"":j," T&M tickets",F==="recent"?" in the last 7 days":""]}),F==="recent"&&vt>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>B("all"),children:"View All Tickets"})]}):e.jsxs("div",{className:"tm-tickets",children:[e.jsx("div",{className:"tm-select-all-row",children:e.jsxs("label",{className:"tm-checkbox-label",onClick:at,children:[e.jsx("input",{type:"checkbox",checked:ct,onChange:at,className:"tm-checkbox"}),e.jsxs("span",{children:["Select All (",Le.length,")"]})]})}),F==="all"&&Ve?Ve.map(([Z,H])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>Ye(Z),children:[e.jsxs("div",{className:"month-header-left",children:[I.has(Z)?e.jsx(ya,{size:18}):e.jsx(hs,{size:18}),e.jsx("span",{className:"month-label",children:H.label}),e.jsxs("span",{className:"month-count",children:[H.tickets.length," tickets"]})]}),e.jsxs("div",{className:"month-header-right",children:[e.jsxs("span",{className:"month-stat",children:[H.hours.toFixed(1)," hrs"]}),e.jsxs("span",{className:"month-stat",children:["$",H.cost.toFixed(2)]})]})]}),I.has(Z)&&e.jsx("div",{className:"month-tickets",children:H.tickets.map(Ee=>De(Ee))})]},Z)):Le.map(Z=>De(Z))]}),C&&le&&e.jsx("div",{className:"modal-overlay",onClick:()=>W(!1),children:e.jsxs("div",{className:"modal change-order-modal",onClick:Z=>Z.stopPropagation(),children:[e.jsx("h3",{children:"Approve Change Order Work"}),e.jsxs("p",{className:"modal-subtitle",children:["This T&M ticket is associated with ",e.jsx("strong",{children:le.ce_pco_number})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Change Order Value ($)"}),e.jsx("input",{type:"number",value:U,onChange:Z=>Y(Z.target.value),placeholder:"Enter the change order amount",autoFocus:!0}),e.jsx("p",{className:"form-help",children:"This amount will be added to the project's total contract value."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>W(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:Re,children:["Approve with $",parseFloat(U||0).toLocaleString()]})]})]})}),J&&_&&e.jsx(Td,{documentType:"tm_ticket",documentId:_.id,companyId:l?.id,projectId:r?.id,documentTitle:`T&M Ticket - ${new Date(_.work_date).toLocaleDateString()}${_.ce_pco_number?` (${_.ce_pco_number})`:""}`,onClose:()=>{D(!1),y(null)},onShowToast:c}),S&&k&&e.jsx("div",{className:"modal-overlay",onClick:()=>K(!1),children:e.jsxs("div",{className:"modal cor-assign-modal",onClick:Z=>Z.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Link Ticket to Change Order"}),e.jsx("button",{className:"close-btn",onClick:()=>K(!1),children:e.jsx(es,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{className:"modal-subtitle",children:["Ticket: ",e.jsx("strong",{children:new Date(k.work_date).toLocaleDateString()}),k.ce_pco_number&&` (${k.ce_pco_number})`]}),$?e.jsx("div",{className:"loading",children:"Loading change orders..."}):M.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No change orders found for this project."}),e.jsx("p",{className:"text-muted",children:"Create a COR first, then link tickets to it."})]}):e.jsxs("div",{className:"cor-select-wrapper",children:[e.jsx("label",{children:"Select Change Order:"}),e.jsxs("select",{value:L,onChange:Z=>P(Z.target.value),className:"cor-select",children:[e.jsx("option",{value:"",children:"-- No COR (unlink) --"}),M.map(Z=>e.jsxs("option",{value:Z.id,children:[Z.cor_number," - ",Z.title||"Untitled"," (",Z.status,")"]},Z.id))]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>K(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:Ct,disabled:$||M.length===0,children:k.assigned_cor_id&&!L?"Unlink from COR":"Link to COR"})]})]})})]})}function cy({project:r,onClose:l,onShareCreated:c}){const{user:i}=xf(),[m,u]=p.useState(!1),[g,f]=p.useState(null),[j,v]=p.useState([]),[x,R]=p.useState(!1),[A,q]=p.useState({progress:!0,photos:!0,daily_reports:!0,tm_tickets:!1,crew_info:!1}),[F,B]=p.useState("never"),[I,re]=p.useState("");p.useEffect(()=>{w()},[r.id]);const w=async()=>{try{const _=await ee.getProjectShares(r.id);v(_)}catch(_){console.error("Error loading shares:",_)}},T=_=>{q(y=>({...y,[_]:!y[_]}))},C=()=>{if(F==="never")return null;const _=new Date;if(F==="30days")_.setDate(_.getDate()+30);else if(F==="90days")_.setDate(_.getDate()+90);else if(F==="custom"&&I)return new Date(I).toISOString();return _.toISOString()},W=async()=>{u(!0);try{const _=C(),y=await ee.createProjectShare(r.id,i.id,A,_);f({type:"success",message:"Share link created!"}),R(!1),w(),c&&c(y)}catch(_){console.error("Error creating share:",_),f({type:"error",message:"Failed to create share link"})}finally{u(!1)}},le=_=>{const y=`${window.location.origin}/view/${_}`;navigator.clipboard.writeText(y),f({type:"success",message:"Link copied to clipboard!"})},O=async _=>{if(confirm("Are you sure you want to revoke this share link?"))try{await ee.revokeProjectShare(_),f({type:"success",message:"Share link revoked"}),w()}catch(y){console.error("Error revoking share:",y),f({type:"error",message:"Failed to revoke share link"})}},U=async _=>{if(confirm("Are you sure you want to permanently delete this share link?"))try{await ee.deleteProjectShare(_),f({type:"success",message:"Share link deleted"}),w()}catch(y){console.error("Error deleting share:",y),f({type:"error",message:"Failed to delete share link"})}},Y=_=>_?new Date(_).toLocaleDateString():"Never",J=_=>_?new Date(_)<new Date:!1,D=_=>{const y=[];return _.progress&&y.push("Progress"),_.photos&&y.push("Photos"),_.daily_reports&&y.push("Reports"),_.tm_tickets&&y.push("T&M"),_.crew_info&&y.push("Crew"),y.join(", ")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:l,children:e.jsxs("div",{className:"modal-content share-modal",onClick:_=>_.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Share Project: ",r.name]}),e.jsx("button",{className:"close-btn",onClick:l,children:""})]}),e.jsxs("div",{className:"modal-body",children:[j.length>0&&e.jsxs("div",{className:"existing-shares",children:[e.jsx("h3",{children:"Active Share Links"}),e.jsx("div",{className:"shares-list",children:j.map(_=>e.jsxs("div",{className:`share-item ${!_.is_active||J(_.expires_at)?"inactive":""}`,children:[e.jsxs("div",{className:"share-info",children:[e.jsxs("div",{className:"share-token",children:[e.jsxs("code",{children:[window.location.origin,"/view/",_.share_token]}),e.jsx("button",{className:"btn-small",onClick:()=>le(_.share_token),disabled:!_.is_active||J(_.expires_at),children:"Copy"})]}),e.jsxs("div",{className:"share-meta",children:[e.jsx("span",{className:"permissions",children:D(_.permissions)}),e.jsxs("span",{className:"expiry",children:["Expires: ",Y(_.expires_at)]}),e.jsxs("span",{className:"views",children:["Views: ",_.view_count||0,_.last_viewed_at&&` (Last: ${Y(_.last_viewed_at)})`]})]}),!_.is_active&&e.jsx("div",{className:"status-badge revoked",children:"Revoked"}),J(_.expires_at)&&_.is_active&&e.jsx("div",{className:"status-badge expired",children:"Expired"})]}),e.jsxs("div",{className:"share-actions",children:[_.is_active&&!J(_.expires_at)&&e.jsx("button",{className:"btn-secondary",onClick:()=>O(_.id),children:"Revoke"}),e.jsx("button",{className:"btn-danger",onClick:()=>U(_.id),children:"Delete"})]})]},_.id))})]}),!x&&e.jsx("button",{className:"btn-primary",onClick:()=>R(!0),children:"+ Create New Share Link"}),x&&e.jsxs("div",{className:"new-share-form",children:[e.jsx("h3",{children:"Create New Share Link"}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Permissions"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:A.progress,onChange:()=>T("progress")}),"Progress/completion status"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:A.photos,onChange:()=>T("photos")}),"Photos feed"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:A.daily_reports,onChange:()=>T("daily_reports")}),"Daily reports"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:A.tm_tickets,onChange:()=>T("tm_tickets")}),"T&M tickets"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:A.crew_info,onChange:()=>T("crew_info")}),"Crew information"]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"never",checked:F==="never",onChange:_=>B(_.target.value)}),"Never expires"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"30days",checked:F==="30days",onChange:_=>B(_.target.value)}),"30 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"90days",checked:F==="90days",onChange:_=>B(_.target.value)}),"90 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"custom",checked:F==="custom",onChange:_=>B(_.target.value)}),"Custom date"]})]}),F==="custom"&&e.jsx("input",{type:"date",value:I,onChange:_=>re(_.target.value),min:new Date().toISOString().split("T")[0],className:"date-input"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>R(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:W,disabled:m,children:m?"Generating...":"Generate Share Link"})]})]})]})]})}),g&&e.jsx(As,{message:g.message,type:g.type,onClose:()=>f(null)}),e.jsx("style",{children:`
        .share-modal {
          max-width: 700px;
          max-height: 80vh;
          overflow-y: auto;
        }

        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1.5rem;
          border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .close-btn {
          background: none;
          border: none;
          font-size: 2rem;
          cursor: pointer;
          color: var(--text-secondary);
          padding: 0;
          width: 2rem;
          height: 2rem;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .close-btn:hover {
          color: var(--text-primary);
        }

        .modal-body {
          padding: 1.5rem;
        }

        .existing-shares {
          margin-bottom: 2rem;
        }

        .existing-shares h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .shares-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .share-item {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          gap: 1rem;
          background: var(--bg-card);
        }

        .share-item.inactive {
          opacity: 0.6;
          background-color: var(--bg-elevated);
        }

        .share-info {
          flex: 1;
        }

        .share-token {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-bottom: 0.5rem;
        }

        .share-token code {
          background-color: var(--bg-elevated);
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.875rem;
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          color: var(--text-primary);
        }

        .share-meta {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .status-badge {
          display: inline-block;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 500;
          margin-top: 0.5rem;
        }

        .status-badge.revoked {
          background-color: #fee2e2;
          color: #991b1b;
        }

        .status-badge.expired {
          background-color: #fef3c7;
          color: #92400e;
        }

        .share-actions {
          display: flex;
          gap: 0.5rem;
          flex-shrink: 0;
        }

        .new-share-form {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          background-color: var(--bg-elevated);
        }

        .new-share-form h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .form-section {
          margin-bottom: 1.5rem;
        }

        .form-section label {
          display: block;
          font-weight: 500;
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .checkbox-group,
        .radio-group {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .checkbox-group label,
        .radio-group label {
          font-weight: normal;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .checkbox-group input[type="checkbox"],
        .radio-group input[type="radio"] {
          margin: 0;
        }

        .date-input {
          margin-top: 0.5rem;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          width: 100%;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-actions {
          display: flex;
          justify-content: flex-end;
          gap: 0.5rem;
          margin-top: 1.5rem;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
          border: 1px solid var(--border-color);
          background-color: var(--bg-card);
          color: var(--text-primary);
          border-radius: 4px;
          cursor: pointer;
        }

        .btn-small:hover:not(:disabled) {
          background-color: var(--bg-elevated);
        }

        .btn-small:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }
      `})]})}const id=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},oy=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});function dy({project:r,companyId:l,company:c,onShowToast:i}){const{branding:m}=wr(),[u,g]=p.useState([]),[f,j]=p.useState(null),[v,x]=p.useState(!1),[R,A]=p.useState(!0),[q,F]=p.useState(null),[B,I]=p.useState("recent"),[re,w]=p.useState(new Set),[T,C]=p.useState({start:"",end:""});p.useEffect(()=>{W();const M=l||r?.company_id,G=M?ee.subscribeToInjuryReports?.(M,()=>{W()}):null;return()=>{G&&ee.unsubscribe?.(G)}},[r?.id,l]);const W=async()=>{A(!0);try{const M=r?await ee.getInjuryReports(r.id):await ee.getCompanyInjuryReports(l);g(M)}catch(M){console.error("Error loading injury reports:",M),F({type:"error",message:"Failed to load injury reports"})}finally{A(!1)}},le=()=>{W(),x(!1),F({type:"success",message:"Injury report created successfully"})},O=M=>{j(M)},U=()=>{j(null)},Y=M=>M?new Date(M).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",J=M=>M?new Date(`2000-01-01T${M}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",D=M=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[M]||M,_=M=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[M]||"#9ca3af",y=M=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[M]||"#9ca3af",S=p.useMemo(()=>{let M=[...u];if(T.start){const G=new Date(T.start);G.setHours(0,0,0,0),M=M.filter(L=>new Date(L.incident_date)>=G)}if(T.end){const G=new Date(T.end);G.setHours(23,59,59,999),M=M.filter(L=>new Date(L.incident_date)<=G)}if(B==="recent"){const G=new Date;G.setDate(G.getDate()-7),G.setHours(0,0,0,0),M=M.filter(L=>new Date(L.incident_date)>=G)}return M},[u,B,T]),K=p.useMemo(()=>{if(B!=="all")return null;const M={};return S.forEach(G=>{const L=new Date(G.incident_date),P=`${L.getFullYear()}-${String(L.getMonth()+1).padStart(2,"0")}`,$=L.toLocaleDateString("en-US",{month:"long",year:"numeric"});M[P]||(M[P]={label:$,reports:[]}),M[P].reports.push(G)}),Object.entries(M).sort((G,L)=>L[0].localeCompare(G[0]))},[S,B]);p.useEffect(()=>{if(K&&K.length>0){const M=K[0][0];w(new Set([M]))}},[K]);const k=M=>{const G=new Set(re);G.has(M)?G.delete(M):G.add(M),w(G)},ie=async()=>{if(u.length===0){F({type:"error",message:"No reports to export"});return}F({type:"info",message:"Generating PDF..."});const M=new Bi,G=M.internal.pageSize.getWidth(),L=20;let P=L;const $=id(m?.primary_color||"#3B82F6"),E=id(m?.secondary_color||"#1E40AF");M.setFillColor(...$),M.rect(0,0,G,45,"F"),M.setFillColor(...E),M.rect(0,42,G,3,"F");let ue=L;if(m?.logo_url)try{const te=await oy(m.logo_url);te&&(M.addImage(te,"PNG",L,7,30,30),ue=L+40)}catch(te){console.error("Error adding logo:",te)}M.setTextColor(255,255,255),M.setFontSize(22),M.setFont("helvetica","bold"),M.text(c?.name||"Company",ue,20),M.setFontSize(10),M.setFont("helvetica","normal"),M.text("INJURY & INCIDENT REPORTS",ue,30),M.setFontSize(9),M.text(`Generated: ${new Date().toLocaleDateString()}`,G-L,20,{align:"right"}),M.text(`Total Reports: ${u.length}`,G-L,28,{align:"right"}),P=55,r&&(M.setFillColor(248,250,252),M.rect(L,P-5,G-L*2,15,"F"),M.setTextColor(...$),M.setFontSize(12),M.setFont("helvetica","bold"),M.text(`Project: ${r.name}`,L+5,P+5),P+=20),u.forEach(te=>{P>200&&(M.addPage(),P=L);const ze=id(y(te.injury_type));M.setFillColor(...ze),M.rect(L,P,G-L*2,12,"F"),M.setTextColor(255,255,255),M.setFontSize(11),M.setFont("helvetica","bold"),M.text(`${te.employee_name} - ${D(te.injury_type)}`,L+5,P+8),M.text(Y(te.incident_date),G-L-5,P+8,{align:"right"}),P+=17,M.setTextColor(50,50,50),M.setFontSize(9),M.setFont("helvetica","normal"),M.text(`Location: ${te.incident_location}`,L+5,P),te.incident_time&&M.text(`Time: ${J(te.incident_time)}`,L+100,P),P+=6,M.setFont("helvetica","bold"),M.text("Description:",L+5,P),M.setFont("helvetica","normal"),P+=5;const Re=M.splitTextToSize(te.incident_description,G-L*2-10);M.text(Re,L+5,P),P+=Re.length*4+3;const qe=[];te.body_part_affected&&qe.push(`Body Part: ${te.body_part_affected}`),te.osha_recordable&&qe.push("OSHA Recordable"),te.workers_comp_claim&&qe.push("Workers' Comp Filed"),te.medical_treatment_required&&qe.push("Medical Treatment Required"),qe.length>0&&(M.setFontSize(8),M.setTextColor(100,100,100),M.text(qe.join("  |  "),L+5,P),P+=5),M.setFontSize(8),M.text(`Reported by: ${te.reported_by_name} (${te.reported_by_title})`,L+5,P),P+=12});const Me=M.internal.getNumberOfPages();for(let te=1;te<=Me;te++)M.setPage(te),M.setFontSize(8),M.setTextColor(150,150,150),M.text(`Page ${te} of ${Me}`,G/2,M.internal.pageSize.getHeight()-10,{align:"center"}),M.text("CONFIDENTIAL - Injury Report",L,M.internal.pageSize.getHeight()-10);const Te=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;M.save(Te),F({type:"success",message:"PDF exported!"})};return R?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[u.length>0&&e.jsx("button",{className:"btn-secondary",onClick:ie,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>x(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${B==="recent"?"active":""}`,onClick:()=>{I("recent"),C({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${B==="all"?"active":""}`,onClick:()=>I("all"),children:["All (",u.length,")"]})]}),B==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Fn,{size:16}),e.jsx("input",{type:"date",value:T.start,onChange:M=>C(G=>({...G,start:M.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:T.end,onChange:M=>C(G=>({...G,end:M.target.value})),placeholder:"End date"}),(T.start||T.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>C({start:"",end:""}),children:"Clear"})]})]}),S.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:""}),e.jsxs("h4",{children:["No Injury Reports",B==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),B==="recent"&&u.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>I("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:B==="all"&&K?K.map(([M,G])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>k(M),children:e.jsxs("div",{className:"month-header-left",children:[re.has(M)?e.jsx(ya,{size:18}):e.jsx(hs,{size:18}),e.jsx("span",{className:"month-label",children:G.label}),e.jsxs("span",{className:"month-count",children:[G.reports.length," reports"]})]})}),re.has(M)&&e.jsx("div",{className:"month-reports",children:G.reports.map(L=>e.jsxs("div",{className:"report-card",onClick:()=>O(L),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[Y(L.incident_date)," at ",J(L.incident_time)]}),e.jsx("div",{className:"employee-name",children:L.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:y(L.injury_type)},children:D(L.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:_(L.status)},children:L.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",L.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",L.reported_by_name," (",L.reported_by_title,")"]}),L.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",L.body_part_affected]}),L.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[L.incident_description.substring(0,150),L.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},L.id))})]},M)):S.map(M=>e.jsxs("div",{className:"report-card",onClick:()=>O(M),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[Y(M.incident_date)," at ",J(M.incident_time)]}),e.jsx("div",{className:"employee-name",children:M.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:y(M.injury_type)},children:D(M.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:_(M.status)},children:M.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",M.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",M.reported_by_name," (",M.reported_by_title,")"]}),M.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",M.body_part_affected]}),M.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[M.incident_description.substring(0,150),M.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},M.id))}),f&&e.jsx("div",{className:"modal-overlay",onClick:U,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:U,children:""})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[Y(f.incident_date)," at ",J(f.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:f.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:y(f.injury_type)},children:D(f.injury_type)})})]}),f.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:f.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:f.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:f.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:f.employee_job_title})]}),f.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:f.employee_phone})]}),f.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:f.employee_email})]}),f.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:f.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:f.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:f.reported_by_title})]}),f.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:f.reported_by_phone})]}),f.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:f.reported_by_email})]})]})]}),f.witnesses&&f.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),f.witnesses.map((M,G)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:M.name}),M.phone&&e.jsxs("span",{children:["  ",M.phone]}),M.email&&e.jsxs("span",{children:["  ",M.email]})]}),M.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',M.testimony,'"']})})]},G))]}),f.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[f.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:f.medical_facility_name})]}),f.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:f.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:f.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),f.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:f.immediate_actions_taken})]}),f.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:f.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[f.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:f.safety_equipment_used})]}),f.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:f.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:f.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:f.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:f.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:f.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",Y(f.created_at)]})]})]})}),v&&e.jsx(jf,{project:r,companyId:l,onClose:()=>x(!1),onReportCreated:le}),q&&e.jsx(As,{message:q.message,type:q.type,onClose:()=>F(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const cd=[{id:"message",label:"Messages",Icon:Rs,description:"Chat messages from field"},{id:"material_request",label:"Material Requests",Icon:ps,description:"Equipment and material requests"},{id:"injury_report",label:"Safety Reports",Icon:Hn,description:"Injury and safety incident reports"},{id:"tm_ticket",label:"T&M Tickets",Icon:Ja,description:"Time and materials tickets"}];function uy({project:r,company:l,onShowToast:c,onClose:i}){const[m,u]=p.useState([]),[g,f]=p.useState({}),[j,v]=p.useState([]),[x,R]=p.useState(!0),[A,q]=p.useState(!1);p.useEffect(()=>{F()},[r?.id,l?.id]);const F=async()=>{if(!(!r?.id||!l?.id))try{R(!0);const T=await ee.getCompanyUsers(l.id);u(T);const C=await ee.getProjectNotificationPreferences(r.id),W={};C.forEach(O=>{W[O.user_id]={types:O.notification_types||[],presetId:null}}),f(W);const le=await ee.getNotificationPresets(l.id);v(le)}catch(T){console.error("Error loading notification settings:",T),c?.("Error loading notification settings","error")}finally{R(!1)}},B=(T,C)=>{f(W=>{const le=W[T]||{types:[]},O=le.types.includes(C)?le.types.filter(U=>U!==C):[...le.types,C];return{...W,[T]:{types:O,presetId:null}}})},I=(T,C)=>{const W=j.find(le=>le.id===C);W&&f(le=>({...le,[T]:{types:[...W.notification_types],presetId:C}}))},re=(T,C)=>{f(W=>({...W,[T]:{types:C?cd.map(le=>le.id):[],presetId:null}}))},w=async()=>{try{q(!0);const T=Object.entries(g).map(([C,W])=>({userId:C,notificationTypes:W.types}));await ee.setProjectNotificationPreferences(r.id,T),c?.("Notification settings saved","success"),i?.()}catch(T){console.error("Error saving notification settings:",T),c?.("Error saving notification settings","error")}finally{q(!1)}};return x?e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsx("button",{className:"close-btn",onClick:i,children:""})]}),e.jsx("div",{className:"loading-message",children:"Loading..."})]}):e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsxs("h3",{children:["Notification Settings for ",r?.name]}),e.jsx("button",{className:"close-btn",onClick:i,children:""})]}),e.jsx("p",{className:"settings-description",children:"Choose who receives notifications when field workers send messages, request materials, submit safety reports, or create T&M tickets for this project."}),m.length===0?e.jsxs("div",{className:"no-users-message",children:[e.jsx("p",{children:"No users found in this company."}),e.jsx("small",{children:"Users need to be added to the company to receive notifications."})]}):e.jsx("div",{className:"notification-users-list",children:m.map(T=>{const C=g[T.id]||{types:[],presetId:null},W=C.types.length===cd.length,le=C.types.length>0&&!W;return e.jsxs("div",{className:"notification-user-row",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:T.name?.charAt(0).toUpperCase()||T.email?.charAt(0).toUpperCase()}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:T.name||T.email}),T.role&&e.jsx("span",{className:"user-role",children:T.role})]})]}),e.jsxs("div",{className:"notification-controls",children:[e.jsxs("select",{className:"preset-select",value:C.presetId||"",onChange:O=>O.target.value&&I(T.id,O.target.value),children:[e.jsx("option",{value:"",children:"Apply preset..."}),j.map(O=>e.jsx("option",{value:O.id,children:O.name},O.id))]}),e.jsx("button",{className:`toggle-all-btn ${W?"all-on":le?"some-on":""}`,onClick:()=>re(T.id,!W),title:W?"Disable all":"Enable all",children:W?"All On":le?"Some":"None"})]}),e.jsx("div",{className:"notification-types",children:cd.map(O=>e.jsxs("label",{className:`notification-type-toggle ${C.types.includes(O.id)?"active":""}`,title:O.description,children:[e.jsx("input",{type:"checkbox",checked:C.types.includes(O.id),onChange:()=>B(T.id,O.id)}),e.jsx("span",{className:"type-icon",children:e.jsx(O.Icon,{size:16})}),e.jsx("span",{className:"type-label",children:O.label})]},O.id))})]},T.id)})}),e.jsxs("div",{className:"notification-settings-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:i,children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:w,disabled:A,children:A?"Saving...":"Save Settings"})]})]})}function my({project:r,company:l,onShowToast:c}){const[i,m]=p.useState([]),[u,g]=p.useState(!0),[f,j]=p.useState("all"),[v,x]=p.useState(null),[R,A]=p.useState("recent"),[q,F]=p.useState(new Set),[B,I]=p.useState({start:"",end:""});p.useEffect(()=>{re();const y=ee.subscribeToMaterialRequests?.(r.id,()=>{re()});return()=>{y&&ee.unsubscribe?.(y)}},[r.id]);const re=async()=>{try{const y=await ee.getMaterialRequests(r.id);m(y||[])}catch(y){console.error("Error loading material requests:",y),c?.("Error loading material requests","error")}finally{g(!1)}},w=async(y,S)=>{try{await ee.updateMaterialRequest(y,S,"Office"),m(i.map(K=>K.id===y?{...K,status:S}:K)),c?.(`Request ${S}`,"success")}catch(K){console.error("Error updating status:",K),c?.("Error updating status","error")}},T=y=>new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),C=y=>new Date(y).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),W=y=>{switch(y){case"urgent":return"priority-urgent";case"low":return"priority-low";default:return"priority-normal"}},le=y=>{switch(y){case"urgent":return"";case"low":return"";default:return""}},O=p.useMemo(()=>{let y=f==="all"?[...i]:i.filter(S=>S.status===f);if(B.start){const S=new Date(B.start);S.setHours(0,0,0,0),y=y.filter(K=>new Date(K.created_at)>=S)}if(B.end){const S=new Date(B.end);S.setHours(23,59,59,999),y=y.filter(K=>new Date(K.created_at)<=S)}if(R==="recent"){const S=new Date;S.setDate(S.getDate()-7),S.setHours(0,0,0,0),y=y.filter(K=>new Date(K.created_at)>=S)}return y},[i,f,R,B]),U=p.useMemo(()=>{if(R!=="all")return null;const y={};return O.forEach(S=>{const K=new Date(S.created_at),k=`${K.getFullYear()}-${String(K.getMonth()+1).padStart(2,"0")}`,ie=K.toLocaleDateString("en-US",{month:"long",year:"numeric"});y[k]||(y[k]={label:ie,requests:[],itemCount:0}),y[k].requests.push(S),y[k].itemCount+=S.items?.length||0}),Object.entries(y).sort((S,K)=>K[0].localeCompare(S[0]))},[O,R]);p.useEffect(()=>{if(U&&U.length>0){const y=U[0][0];F(new Set([y]))}},[U]);const Y=y=>{const S=new Set(q);S.has(y)?S.delete(y):S.add(y),F(S)},J={all:i.length,pending:i.filter(y=>y.status==="pending").length,ordered:i.filter(y=>y.status==="ordered").length,delivered:i.filter(y=>y.status==="delivered").length,cancelled:i.filter(y=>y.status==="cancelled").length},D=f==="all"?i.length:i.filter(y=>y.status===f).length;if(u)return e.jsx("div",{className:"loading",children:"Loading material requests..."});const _=y=>e.jsxs("div",{className:`material-request-card ${y.status} ${y.priority==="urgent"?"urgent":""}`,children:[e.jsxs("div",{className:"material-request-header-row",onClick:()=>x(v===y.id?null:y.id),children:[e.jsxs("div",{className:"material-request-info",children:[e.jsxs("span",{className:`material-priority-badge ${W(y.priority)}`,children:[le(y.priority)," ",y.priority]}),e.jsx("span",{className:"material-request-date",children:T(y.created_at)}),e.jsx("span",{className:"material-request-time",children:C(y.created_at)})]}),e.jsxs("div",{className:"material-request-summary",children:[e.jsxs("span",{className:"material-items-count",children:[y.items?.length||0," item",(y.items?.length||0)!==1?"s":""]}),e.jsx("span",{className:`material-status ${y.status}`,children:y.status}),e.jsx("span",{className:"material-expand-arrow",children:v===y.id?"":""})]})]}),v===y.id&&e.jsxs("div",{className:"material-request-details",children:[e.jsxs("div",{className:"material-detail-section",children:[e.jsxs("div",{className:"material-requester",children:[e.jsx("span",{className:"requester-label",children:"Requested by:"}),e.jsx("span",{className:"requester-name",children:y.requested_by||"Field"})]}),y.needed_by&&e.jsxs("div",{className:"material-needed-by",children:[e.jsx("span",{className:"needed-label",children:"Needed by:"}),e.jsx("span",{className:"needed-date",children:T(y.needed_by)})]})]}),y.items?.length>0&&e.jsxs("div",{className:"material-detail-section",children:[e.jsx("h4",{children:"Items Requested"}),e.jsx("div",{className:"material-items-list",children:y.items.map((S,K)=>e.jsxs("div",{className:"material-item-row",children:[e.jsx("span",{className:"item-name",children:S.name}),e.jsxs("span",{className:"item-quantity",children:[S.quantity," ",S.unit]})]},K))})]}),y.notes&&e.jsxs("div",{className:"material-detail-section",children:[e.jsx("h4",{children:"Notes"}),e.jsx("p",{className:"material-notes",children:y.notes})]}),e.jsxs("div",{className:"material-request-actions",children:[y.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:S=>{S.stopPropagation(),w(y.id,"ordered")},children:"Mark Ordered"}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:S=>{S.stopPropagation(),w(y.id,"cancelled")},children:"Cancel"})]}),y.status==="ordered"&&e.jsx("button",{className:"btn btn-success btn-small",onClick:S=>{S.stopPropagation(),w(y.id,"delivered")},children:"Mark Delivered"}),y.status==="cancelled"&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:S=>{S.stopPropagation(),w(y.id,"pending")},children:"Restore"})]})]})]},y.id);return e.jsxs("div",{className:"material-requests-list card",children:[e.jsxs("div",{className:"material-requests-header",children:[e.jsxs("div",{className:"material-requests-title",children:[e.jsx("h3",{children:"Material Requests"}),J.pending>0&&e.jsxs("span",{className:"pending-badge",children:[J.pending," pending"]})]}),e.jsx("div",{className:"material-filter-tabs",children:["all","pending","ordered","delivered","cancelled"].map(y=>e.jsxs("button",{className:`material-filter-tab ${f===y?"active":""}`,onClick:()=>j(y),children:[y.charAt(0).toUpperCase()+y.slice(1),e.jsx("span",{className:"material-filter-count",children:J[y]})]},y))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${R==="recent"?"active":""}`,onClick:()=>{A("recent"),I({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${R==="all"?"active":""}`,onClick:()=>A("all"),children:["All (",D,")"]})]}),R==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Fn,{size:16}),e.jsx("input",{type:"date",value:B.start,onChange:y=>I(S=>({...S,start:y.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:B.end,onChange:y=>I(S=>({...S,end:y.target.value})),placeholder:"End date"}),(B.start||B.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>I({start:"",end:""}),children:"Clear"})]})]})]}),O.length===0?e.jsxs("div",{className:"material-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(ps,{size:32})}),e.jsxs("p",{children:["No ",f==="all"?"":f," material requests",R==="recent"?" in the last 7 days":""]}),R==="recent"&&D>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>A("all"),children:"View All Requests"})]}):e.jsx("div",{className:"material-requests",children:R==="all"&&U?U.map(([y,S])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>Y(y),children:[e.jsxs("div",{className:"month-header-left",children:[q.has(y)?e.jsx(ya,{size:18}):e.jsx(hs,{size:18}),e.jsx("span",{className:"month-label",children:S.label}),e.jsxs("span",{className:"month-count",children:[S.requests.length," requests"]})]}),e.jsx("div",{className:"month-header-right",children:e.jsxs("span",{className:"month-stat",children:[S.itemCount," items"]})})]}),q.has(y)&&e.jsx("div",{className:"month-requests",children:S.requests.map(K=>_(K))})]},y)):O.map(y=>_(y))})]})}const Lp=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},hy=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});function py({project:r,company:l,onShowToast:c}){const{branding:i}=wr(),[m,u]=p.useState([]),[g,f]=p.useState(!0),[j,v]=p.useState(null),[x,R]=p.useState(new Set),[A,q]=p.useState(!1),[F,B]=p.useState("recent"),[I,re]=p.useState(new Set),[w,T]=p.useState({start:"",end:""});p.useEffect(()=>{C();const L=ee.subscribeToDailyReports?.(r.id,()=>{C()});return()=>{L&&ee.unsubscribe?.(L)}},[r.id]);const C=async()=>{try{const L=await ee.getDailyReports(r.id,365);u(L||[])}catch(L){console.error("Error loading daily reports:",L),c?.("Error loading daily reports","error")}finally{f(!1)}},W=p.useMemo(()=>{let L=[...m];if(w.start){const P=new Date(w.start);P.setHours(0,0,0,0),L=L.filter($=>new Date($.report_date||$.created_at)>=P)}if(w.end){const P=new Date(w.end);P.setHours(23,59,59,999),L=L.filter($=>new Date($.report_date||$.created_at)<=P)}if(F==="recent"){const P=new Date;P.setDate(P.getDate()-7),P.setHours(0,0,0,0),L=L.filter($=>new Date($.report_date||$.created_at)>=P)}return L},[m,F,w]),le=p.useMemo(()=>{if(F!=="all")return null;const L={};return W.forEach(P=>{const $=new Date(P.report_date||P.created_at),E=`${$.getFullYear()}-${String($.getMonth()+1).padStart(2,"0")}`,ue=$.toLocaleDateString("en-US",{month:"long",year:"numeric"});L[E]||(L[E]={label:ue,reports:[]}),L[E].reports.push(P)}),Object.entries(L).sort((P,$)=>$[0].localeCompare(P[0]))},[W,F]);p.useEffect(()=>{if(le&&le.length>0){const L=le[0][0];re(new Set([L]))}},[le]);const O=()=>{q(!A),A&&R(new Set)},U=L=>{const P=new Set(x);P.has(L)?P.delete(L):P.add(L),R(P)},Y=()=>{x.size===W.length?R(new Set):R(new Set(W.map(L=>L.id)))},J=L=>{const P=new Set(I);P.has(L)?P.delete(L):P.add(L),re(P)},D=()=>x.size>0?W.filter(L=>x.has(L.id)):W,_=L=>new Date(L).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),y=L=>new Date(L).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),S=L=>{switch(L){case"submitted":return"";case"reviewed":return"";case"draft":return"";default:return""}},K=L=>{switch(L){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return L}},k=async()=>{const L=D();if(L.length===0){c?.("No reports to export","error");return}c?.("Generating PDF...","info");const P=new Bi,$=P.internal.pageSize.getWidth(),E=20;let ue=E;const Me=Lp(i?.primary_color||"#3B82F6"),Te=Lp(i?.secondary_color||"#1E40AF");P.setFillColor(...Me),P.rect(0,0,$,45,"F"),P.setFillColor(...Te),P.rect(0,42,$,3,"F");let te=E;if(i?.logo_url)try{const qe=await hy(i.logo_url);qe&&(P.addImage(qe,"PNG",E,7,30,30),te=E+40)}catch(qe){console.error("Error adding logo:",qe)}P.setTextColor(255,255,255),P.setFontSize(22),P.setFont("helvetica","bold"),P.text(l?.name||"Company Name",te,20),P.setFontSize(10),P.setFont("helvetica","normal"),P.text("DAILY REPORTS SUMMARY",te,30),P.setFontSize(9),P.text(`Generated: ${new Date().toLocaleDateString()}`,$-E,20,{align:"right"}),r.job_number&&P.text(`Job #: ${r.job_number}`,$-E,28,{align:"right"}),ue=55,P.setFillColor(248,250,252),P.rect(E,ue-5,$-E*2,20,"F"),P.setTextColor(...Me),P.setFontSize(14),P.setFont("helvetica","bold"),P.text(`Project: ${r.name}`,E+5,ue+7),P.setFontSize(10),P.setTextColor(100,100,100),P.text(`${L.length} Report${L.length!==1?"s":""}`,$-E-5,ue+7,{align:"right"}),ue+=25,L.forEach((qe,Ie)=>{ue>250&&(P.addPage(),ue=E),P.setFillColor(...Me),P.setTextColor(255,255,255),P.rect(E,ue,$-E*2,10,"F"),P.setFontSize(11),P.setFont("helvetica","bold"),P.text(_(qe.report_date||qe.created_at),E+5,ue+7),P.text(K(qe.status),$-E-5,ue+7,{align:"right"}),ue+=15,P.setTextColor(50,50,50),P.setFontSize(10),P.setFont("helvetica","normal");const Ct=`Crew: ${qe.crew_count||0}  |  Tasks: ${qe.tasks_completed||0}  |  T&M: ${qe.tm_tickets_count||0}  |  Photos: ${qe.photos_count||0}`;if(P.text(Ct,E+5,ue),ue+=8,qe.crew_list?.length>0){P.setFont("helvetica","bold"),P.text("Crew:",E+5,ue),P.setFont("helvetica","normal");const nt=qe.crew_list.map(Ht=>`${Ht.name} (${Ht.role})`).join(", "),jt=P.splitTextToSize(nt,$-E*2-30);P.text(jt,E+25,ue),ue+=jt.length*5+3}if(qe.field_notes){P.setFont("helvetica","bold"),P.text("Notes:",E+5,ue),P.setFont("helvetica","normal");const nt=P.splitTextToSize(qe.field_notes,$-E*2-30);P.text(nt,E+25,ue),ue+=nt.length*5+3}if(qe.issues){P.setTextColor(180,50,50),P.setFont("helvetica","bold"),P.text("Issues:",E+5,ue),P.setFont("helvetica","normal");const nt=P.splitTextToSize(qe.issues,$-E*2-30);P.text(nt,E+25,ue),P.setTextColor(50,50,50),ue+=nt.length*5+3}ue+=10});const ze=P.internal.getNumberOfPages();for(let qe=1;qe<=ze;qe++)P.setPage(qe),P.setFontSize(8),P.setTextColor(150,150,150),P.text(`Page ${qe} of ${ze}`,$/2,P.internal.pageSize.getHeight()-10,{align:"center"});const Re=`${r.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;P.save(Re),c?.("PDF exported!","success")},ie=L=>e.jsxs("div",{className:`daily-report-card ${L.status} ${x.has(L.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>v(j===L.id?null:L.id),children:[A&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:x.has(L.id),onChange:P=>{P.stopPropagation(),U(L.id)},onClick:P=>P.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:_(L.report_date||L.created_at)}),e.jsxs("span",{className:`report-status ${L.status}`,children:[S(L.status)," ",K(L.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[L.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[L.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:j===L.id?"":""})]})]}),j===L.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:L.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:L.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:L.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:L.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),L.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:L.crew_list.map((P,$)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:P.name}),e.jsx("span",{className:"crew-role",children:P.role})]},$))})]}),L.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:L.completed_tasks.map((P,$)=>e.jsxs("li",{children:[P.name,P.group&&e.jsx("span",{className:"task-group",children:P.group})]},$))})]}),L.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:L.field_notes})]}),L.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:L.issues})]}),L.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",L.submitted_by||"Field"," at ",y(L.submitted_at)]})})]})]},L.id);if(g)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});const M=m.length,G=W.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${A?"btn-primary":"btn-secondary"}`,onClick:O,children:A?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:k,children:["PDF",x.size>0?` (${x.size})`:""]})]})})]}),m.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${F==="recent"?"active":""}`,onClick:()=>B("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${F==="all"?"active":""}`,onClick:()=>B("all"),children:["All (",M,")"]})]}),F==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Fn,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:w.start,onChange:L=>T(P=>({...P,start:L.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:w.end,onChange:L=>T(P=>({...P,end:L.target.value})),className:"date-input"}),(w.start||w.end)&&e.jsx("button",{className:"date-clear",onClick:()=>T({start:"",end:""}),children:"Clear"})]})]}),A&&W.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:x.size===W.length&&W.length>0,onChange:Y}),"Select All (",W.length,")"]}),x.size>0&&e.jsxs("span",{className:"selected-count",children:[x.size," selected"]})]}),m.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Ja,{size:32})}),e.jsx("p",{children:"No daily reports yet"}),e.jsx("small",{children:"Reports from the field will appear here"})]}):W.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Ja,{size:32})}),e.jsx("p",{children:"No reports in this time period"}),e.jsx("small",{children:F==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"})]}):F==="recent"?e.jsxs("div",{className:"daily-reports",children:[W.map(L=>ie(L)),M>G&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>B("all"),children:["View All ",M," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:le?.map(([L,{label:P,reports:$}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>J(L),children:[I.has(L)?e.jsx(ya,{size:18,className:"month-chevron"}):e.jsx(hs,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:P}),e.jsxs("span",{className:"month-count",children:[$.length," report",$.length!==1?"s":""]})]}),I.has(L)&&e.jsx("div",{className:"month-reports",children:$.map(E=>ie(E))})]},L))})]})}function fy({project:r,company:l,userName:c,onShowToast:i}){const[m,u]=p.useState([]),[g,f]=p.useState(!0),[j,v]=p.useState(!1),[x,R]=p.useState(""),[A,q]=p.useState(0),[F,B]=p.useState(!1),I=p.useRef(null);p.useEffect(()=>{re();const le=ee.subscribeToMessages?.(r.id,O=>{O.new&&(u(U=>[...U,O.new]),O.new.sender_type==="field"&&q(U=>U+1))});return()=>{le&&ee.unsubscribe?.(le)}},[r.id]),p.useEffect(()=>{F&&(I.current?.scrollIntoView({behavior:"smooth"}),ee.markMessagesRead?.(r.id,"office"),q(0))},[m,F]);const re=async()=>{try{const O=(await ee.getMessages(r.id,50)||[]).sort((Y,J)=>new Date(Y.created_at)-new Date(J.created_at));u(O);const U=O.filter(Y=>Y.sender_type==="field"&&!Y.is_read).length;q(U)}catch(le){console.error("Error loading messages:",le)}finally{f(!1)}},w=async()=>{if(x.trim()){v(!0);try{const le=await ee.sendMessage(r.id,x.trim(),"office",c||"Office");u(O=>[...O,le]),R("")}catch(le){console.error("Error sending message:",le),i?.("Error sending message","error")}finally{v(!1)}}},T=le=>{le.key==="Enter"&&!le.shiftKey&&(le.preventDefault(),w())},C=le=>{const O=new Date(le),U=new Date;return O.toDateString()===U.toDateString()?O.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):O.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})},W=m.slice(-3);return g?e.jsxs("div",{className:"project-messages card",children:[e.jsx("div",{className:"project-messages-header",children:e.jsx("h3",{children:"Messages"})}),e.jsx("div",{className:"loading",children:"Loading messages..."})]}):e.jsxs("div",{className:`project-messages card ${F?"expanded":""}`,children:[e.jsxs("div",{className:"project-messages-header",onClick:()=>B(!F),children:[e.jsxs("div",{className:"messages-title-row",children:[e.jsx("h3",{children:"Messages"}),A>0&&e.jsxs("span",{className:"messages-unread-badge",children:[A," new"]})]}),e.jsx("button",{className:"messages-toggle-btn",children:F?" Collapse":" Expand"})]}),!F&&m.length>0&&e.jsxs("div",{className:"messages-preview",children:[W.map(le=>e.jsxs("div",{className:`preview-message ${le.sender_type}`,children:[e.jsxs("span",{className:"preview-sender",children:[le.sender_type==="office"?e.jsx(pn,{size:12,className:"inline-icon"}):e.jsx(oa,{size:12,className:"inline-icon"})," ",le.sender_name,":"]}),e.jsxs("span",{className:"preview-text",children:[le.message?.slice(0,50),le.message?.length>50?"...":""]})]},le.id)),m.length===0&&e.jsx("p",{className:"no-messages-hint",children:"No messages yet. Click to start chatting."})]}),F&&e.jsxs("div",{className:"messages-full",children:[e.jsxs("div",{className:"messages-list-container",children:[m.length===0?e.jsxs("div",{className:"messages-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Rs,{size:32})}),e.jsx("p",{children:"No messages yet"}),e.jsx("small",{children:"Send a message to the field crew"})]}):m.map(le=>e.jsxs("div",{className:`message-bubble ${le.sender_type==="office"?"sent":"received"}`,children:[e.jsxs("div",{className:"message-sender",children:[le.sender_type==="office"?e.jsx(pn,{size:14,className:"inline-icon"}):e.jsx(oa,{size:14,className:"inline-icon"})," ",le.sender_name]}),e.jsx("div",{className:"message-text",children:le.message}),le.photo_url&&e.jsx("img",{src:le.photo_url,alt:"Attached",className:"message-photo"}),e.jsx("div",{className:"message-time",children:C(le.created_at)})]},le.id)),e.jsx("div",{ref:I})]}),e.jsxs("div",{className:"messages-input-row",children:[e.jsx("textarea",{value:x,onChange:le=>R(le.target.value),onKeyDown:T,placeholder:"Type a message...",rows:1,disabled:j}),e.jsx("button",{className:"btn btn-primary send-btn",onClick:w,disabled:j||!x.trim(),children:j?"...":"Send"})]})]})]})}function gy({project:r,company:l,onShowToast:c}){const[i,m]=p.useState(null),[u,g]=p.useState(!0),[f,j]=p.useState(!1);p.useEffect(()=>{if(r?.id&&l?.id){v();const F=ee.subscribeToCrewCheckins?.(r.id,()=>{v()});return()=>{F&&ee.unsubscribe?.(F)}}},[r?.id,l?.id]);const v=async()=>{try{const F=await ee.calculateManDayCosts(r.id,l.id,r.work_type||"demolition",r.job_type||"standard");m(F)}catch(F){console.error("Error loading man day costs:",F)}finally{g(!1)}},x=F=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(F),R=F=>new Date(F).toLocaleDateString("en-US",{month:"short",day:"numeric"}),A=F=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[F]||F.charAt(0).toUpperCase()+F.slice(1);if(u)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!i||i.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(oa,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const q=Object.entries(i.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>j(!f),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:x(i.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:f?" Collapse":" Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:x(i.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.daysWorked>0?x(i.totalCost/i.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),f&&e.jsxs("div",{className:"man-day-details",children:[q.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:q.map(([F,B])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:A(F)}),e.jsxs("span",{className:"role-rate",children:[x(B.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[B.count," days"]}),e.jsx("span",{className:"role-cost",children:x(B.cost)})]})]},F))})]}),i.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:i.byDate.slice(0,7).map((F,B)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:R(F.date)}),e.jsxs("span",{className:"date-workers",children:[F.workers," crew"]}),e.jsx("span",{className:"date-cost",children:x(F.cost)})]},B))}),i.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",i.byDate.length-7," more days"]})]})]})]})}const ja=r=>((r||0)/100).toFixed(2),Ce=r=>{const l=(r||0)/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(l)},zs=r=>Math.round((parseFloat(r)||0)*100),dn=r=>((r||0)/100).toFixed(2),Ut=r=>`${dn(r)}%`,qn=r=>Math.round((parseFloat(r)||0)*100),xy=(r,l,c,i)=>{const m=parseFloat(r)||0,u=parseFloat(l)||0,g=parseInt(c)||0,f=parseInt(i)||0,j=Math.round(m*g),v=Math.round(u*f),x=j+v;return{regularTotal:j,overtimeTotal:v,total:x}},Up=(r,l)=>{const c=parseFloat(r)||0,i=parseInt(l)||0;return Math.round(c*i)},qi=(r,l)=>{const c=parseInt(r)||0,i=parseInt(l)||0;return Math.round(c*i/1e4)},od=(r,l)=>{const c=parseInt(r)||0,i=parseInt(l)||0;return Math.round(c*i/1e4)},yl=r=>{const l=(r.change_order_labor||[]).reduce((B,I)=>B+(parseInt(I.total)||0),0),c=(r.change_order_materials||[]).reduce((B,I)=>B+(parseInt(I.total)||0),0),i=(r.change_order_equipment||[]).reduce((B,I)=>B+(parseInt(I.total)||0),0),m=(r.change_order_subcontractors||[]).reduce((B,I)=>B+(parseInt(I.total)||0),0),u=qi(l,r.labor_markup_percent||1500),g=qi(c,r.materials_markup_percent||1500),f=qi(i,r.equipment_markup_percent||1500),j=qi(m,r.subcontractors_markup_percent||500),v=l+c+i+m+u+g+f+j,x=od(v,r.liability_insurance_percent||144),R=od(v,r.bond_percent||100),A=od(v,r.license_fee_percent||10),q=x+R+A,F=v+q;return{labor_subtotal:l,materials_subtotal:c,equipment_subtotal:i,subcontractors_subtotal:m,labor_markup_amount:u,materials_markup_amount:g,equipment_markup_amount:f,subcontractors_markup_amount:j,liability_insurance_amount:x,bond_amount:R,license_fee_amount:A,additional_fees_total:q,cor_subtotal:v,cor_total:F}},dd=r=>{const l=[];if(r.title?.trim()||l.push("Title is required"),r.scope_of_work?.trim()||l.push("Scope of work is required"),r.period_start||l.push("Start date is required"),r.period_end||l.push("End date is required"),r.period_start&&r.period_end){const j=new Date(r.period_start);new Date(r.period_end)<j&&l.push("End date must be after start date")}const c=(r.change_order_labor||[]).length>0,i=(r.change_order_materials||[]).length>0,m=(r.change_order_equipment||[]).length>0,u=(r.change_order_subcontractors||[]).length>0;!c&&!i&&!m&&!u&&l.push("At least one line item (labor, materials, equipment, or subcontractor) is required"),yl(r).cor_total<=0&&l.push("COR total must be greater than zero");const f=5e3;return r.labor_markup_percent>f&&l.push("Labor markup percentage seems too high (>50%)"),r.materials_markup_percent>f&&l.push("Materials markup percentage seems too high (>50%)"),r.equipment_markup_percent>f&&l.push("Equipment markup percentage seems too high (>50%)"),r.subcontractors_markup_percent>f&&l.push("Subcontractors markup percentage seems too high (>50%)"),{valid:l.length===0,errors:l}},yf=r=>{const l={draft:{label:"Draft",color:"#6b7280",bgColor:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bgColor:"#fef3c7"},approved:{label:"Approved",color:"#059669",bgColor:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bgColor:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bgColor:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bgColor:"#e5e7eb"}};return l[r]||l.draft},is=r=>r?new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",$i=(r,l)=>{const c=is(r),i=is(l);return c&&i?`${c} - ${i}`:c||i||""},On={labor_markup:1500,materials_markup:1500,equipment_markup:1500,subcontractors_markup:500,liability_insurance:144,bond:100,license_fee:10},Hp=["Foreman","Superintendent","Operator","Laborer"],jy=[{value:"standard",label:"Standard"},{value:"pla",label:"PLA (Project Labor Agreement)"},{value:"prevailing",label:"Prevailing Wage"}],ud={materials:[{value:"backup_sheet",label:"Backup Sheet"},{value:"invoice",label:"Invoice"},{value:"mobilization",label:"Mobilization"},{value:"custom",label:"Custom Entry"}],equipment:[{value:"backup_sheet",label:"Backup Sheet"},{value:"invoice",label:"Invoice"},{value:"custom",label:"Custom Entry"}],subcontractors:[{value:"invoice",label:"Invoice"},{value:"quote",label:"Quote"},{value:"custom",label:"Custom Entry"}]},Bp=["each","day","week","month","hour","sqft","lf","gallon","pound","ton","cy","lump sum"];function vy({project:r,company:l,areas:c,refreshKey:i,onShowToast:m,onCreateCOR:u,onViewCOR:g,onEditCOR:f}){const[j,v]=p.useState([]),[x,R]=p.useState(!0),[A,q]=p.useState("all"),[F,B]=p.useState("all"),[I,re]=p.useState(null),[w,T]=p.useState(new Set),[C,W]=p.useState("recent"),[le,O]=p.useState(new Set),[U,Y]=p.useState({start:"",end:""}),[J,D]=p.useState(null);p.useEffect(()=>{_(),y();const $=ee.subscribeToCORs?.(r.id,()=>{_(),y()});return()=>{$&&ee.unsubscribe?.($)}},[r.id,i]);const _=async()=>{try{const $=await ee.getCORs(r.id);v($||[])}catch($){console.error("Error loading CORs:",$),m?.("Error loading change order requests","error")}finally{R(!1)}},y=async()=>{try{const $=await ee.getCORStats?.(r.id);D($)}catch($){console.error("Error loading COR stats:",$)}},S=async($,E)=>{if(E?.stopPropagation(),!!confirm("Are you sure you want to delete this COR? This action cannot be undone."))try{await ee.deleteCOR($),v(j.filter(ue=>ue.id!==$)),m?.("COR deleted","success"),y()}catch(ue){console.error("Error deleting COR:",ue),m?.("Error deleting COR","error")}},K=async($,E)=>{E?.stopPropagation();try{await ee.submitCORForApproval($),await _(),m?.("COR submitted for approval","success"),y()}catch(ue){console.error("Error submitting COR:",ue?.message||ue),m?.(ue?.message||"Error submitting COR","error")}},k=p.useMemo(()=>{let $=[...j];if(A!=="all"&&($=$.filter(E=>E.status===A)),F!=="all"&&($=$.filter(E=>E.area_id===F)),U.start){const E=new Date(U.start);E.setHours(0,0,0,0),$=$.filter(ue=>new Date(ue.created_at)>=E)}if(U.end){const E=new Date(U.end);E.setHours(23,59,59,999),$=$.filter(ue=>new Date(ue.created_at)<=E)}if(C==="recent"){const E=new Date;E.setDate(E.getDate()-7),E.setHours(0,0,0,0),$=$.filter(ue=>new Date(ue.created_at)>=E)}return $.sort((E,ue)=>new Date(ue.created_at)-new Date(E.created_at)),$},[j,A,F,C,U]),ie=p.useMemo(()=>{if(C!=="all")return null;const $={};return k.forEach(E=>{const ue=new Date(E.created_at),Me=`${ue.getFullYear()}-${String(ue.getMonth()+1).padStart(2,"0")}`,Te=ue.toLocaleDateString("en-US",{month:"long",year:"numeric"});$[Me]||($[Me]={label:Te,cors:[],totalAmount:0}),$[Me].cors.push(E),$[Me].totalAmount+=E.cor_total||0}),Object.entries($).sort((E,ue)=>ue[0].localeCompare(E[0]))},[k,C]);p.useEffect(()=>{if(ie&&ie.length>0){const $=ie[0][0];O(new Set([$]))}},[ie]);const M=$=>{const E=new Set(le);E.has($)?E.delete($):E.add($),O(E)},G=p.useMemo(()=>({all:j.length,draft:j.filter($=>$.status==="draft").length,pending_approval:j.filter($=>$.status==="pending_approval").length,approved:j.filter($=>$.status==="approved").length,rejected:j.filter($=>$.status==="rejected").length,billed:j.filter($=>$.status==="billed").length,closed:j.filter($=>$.status==="closed").length}),[j]);A==="all"?j.length:j.filter($=>$.status===A).length;const L=$=>c?.find(ue=>ue.id===$)?.name||"No Area",P=$=>{const E=yf($.status);$.id;const ue=$.status==="draft",Me=["draft","pending_approval","rejected"].includes($.status),Te=$.status==="draft";return e.jsxs("div",{className:`cor-card ${$.status}`,onClick:()=>g?.($),onKeyDown:te=>{(te.key==="Enter"||te.key===" ")&&(te.preventDefault(),g?.($))},tabIndex:0,role:"button","aria-label":`View COR ${$.cor_number}: ${$.title||"Untitled"}, ${E.label}, ${Ce($.cor_total||0)}`,children:[e.jsxs("div",{className:"cor-card-header",children:[e.jsxs("div",{className:"cor-card-left",children:[e.jsx("span",{className:"cor-number",children:$.cor_number}),e.jsx("span",{className:"cor-status-badge",style:{backgroundColor:E.bgColor,color:E.color},children:E.label})]}),e.jsx("div",{className:"cor-card-right",children:e.jsx("span",{className:"cor-total",children:Ce($.cor_total||0)})})]}),e.jsxs("div",{className:"cor-card-body",children:[e.jsx("h4",{className:"cor-title",children:$.title||"Untitled COR"}),e.jsxs("div",{className:"cor-meta",children:[$.area_id&&e.jsx("span",{className:"cor-area",children:L($.area_id)}),e.jsx("span",{className:"cor-period",children:$i($.period_start,$.period_end)})]})]}),e.jsxs("div",{className:"cor-card-footer",children:[e.jsx("span",{className:"cor-created",children:is($.created_at)}),e.jsxs("div",{className:"cor-actions",onClick:te=>te.stopPropagation(),children:[Te&&e.jsx("button",{className:"cor-action-btn submit",onClick:te=>K($.id,te),title:"Submit for Approval","aria-label":`Submit COR ${$.cor_number} for approval`,children:e.jsx(Dd,{size:14,"aria-hidden":"true"})}),ue&&e.jsx("button",{className:"cor-action-btn edit",onClick:te=>{te.stopPropagation(),f?.($)},title:"Edit","aria-label":`Edit COR ${$.cor_number}`,children:e.jsx(gl,{size:14,"aria-hidden":"true"})}),e.jsx("button",{className:"cor-action-btn view",onClick:te=>{te.stopPropagation(),g?.($)},title:"View Details","aria-label":`View COR ${$.cor_number} details`,children:e.jsx(Aj,{size:14,"aria-hidden":"true"})}),Me&&e.jsx("button",{className:"cor-action-btn delete",onClick:te=>S($.id,te),title:"Delete","aria-label":`Delete COR ${$.cor_number}`,children:e.jsx(qs,{size:14,"aria-hidden":"true"})})]})]})]},$.id)};return x?e.jsx("div",{className:"loading",children:"Loading change order requests..."}):e.jsxs("div",{className:"cor-list",children:[e.jsxs("div",{className:"cor-list-header",children:[e.jsxs("div",{className:"cor-list-info",children:[e.jsx("h3",{children:"Change Orders"}),e.jsxs("div",{className:"cor-stats-inline",children:[e.jsxs("span",{className:"cor-stat-item",children:[G.all," total"]}),G.pending_approval>0&&e.jsxs("span",{className:"cor-stat-item pending",children:[G.pending_approval," pending"]}),J?.totalApproved>0&&e.jsx("span",{className:"cor-stat-item approved",children:Ce(J.totalApproved)})]})]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:u,children:[e.jsx(Ta,{size:14})," New COR"]})]}),e.jsxs("div",{className:"cor-controls",children:[e.jsx("div",{className:"cor-filter-pills",role:"tablist",children:[{id:"all",label:"All"},{id:"draft",label:"Draft"},{id:"pending_approval",label:"Pending"},{id:"approved",label:"Approved"}].map($=>e.jsxs("button",{role:"tab","aria-selected":A===$.id,className:`cor-pill ${A===$.id?"active":""}`,onClick:()=>q($.id),children:[$.label,G[$.id]>0&&e.jsx("span",{className:"cor-pill-count",children:G[$.id]})]},$.id))}),e.jsxs("div",{className:"cor-view-toggle",children:[e.jsx("button",{className:`cor-toggle-btn ${C==="recent"?"active":""}`,onClick:()=>{W("recent"),Y({start:"",end:""})},children:"Recent"}),e.jsx("button",{className:`cor-toggle-btn ${C==="all"?"active":""}`,onClick:()=>W("all"),children:"All"})]})]}),C==="all"&&e.jsxs("div",{className:"cor-date-filter",children:[e.jsx(Fn,{size:14}),e.jsx("input",{type:"date",value:U.start,onChange:$=>Y(E=>({...E,start:$.target.value}))}),e.jsx("span",{className:"cor-date-sep",children:"to"}),e.jsx("input",{type:"date",value:U.end,onChange:$=>Y(E=>({...E,end:$.target.value}))}),(U.start||U.end)&&e.jsx("button",{className:"cor-clear-btn",onClick:()=>Y({start:"",end:""}),children:"Clear"})]}),k.length===0?e.jsxs("div",{className:"cor-empty",children:[e.jsx(Aa,{size:24,className:"cor-empty-icon"}),e.jsxs("p",{children:["No change orders ",A!=="all"?`(${A.replace("_"," ")})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:u,children:[e.jsx(Ta,{size:14})," Create COR"]})]}):e.jsx("div",{className:"cor-cards",children:C==="all"&&ie?ie.map(([$,E])=>e.jsxs("div",{className:"cor-month-group",children:[e.jsxs("button",{className:"cor-month-header",onClick:()=>M($),children:[e.jsxs("div",{className:"cor-month-left",children:[le.has($)?e.jsx(ya,{size:16}):e.jsx(hs,{size:16}),e.jsx("span",{children:E.label}),e.jsx("span",{className:"cor-month-count",children:E.cors.length})]}),e.jsx("span",{className:"cor-month-total",children:Ce(E.totalAmount)})]}),le.has($)&&e.jsx("div",{className:"cor-month-items",children:E.cors.map(ue=>P(ue))})]},$)):k.map($=>P($))})]})}function yy({projectId:r,corId:l,onImport:c,onClose:i,onShowToast:m}){const[u,g]=p.useState([]),[f,j]=p.useState(!0),[v,x]=p.useState(new Set),[R,A]=p.useState(null),[q,F]=p.useState(""),[B,I]=p.useState("unassigned");p.useEffect(()=>{re()},[r]);const re=async()=>{try{const U=await ee.getTMTickets(r);g(U||[])}catch(U){console.error("Error loading tickets:",U),m?.("Error loading tickets","error")}finally{j(!1)}},w=p.useMemo(()=>{let U=[...u];if(B==="unassigned"?U=U.filter(Y=>!Y.assigned_cor_id):B==="approved"&&(U=U.filter(Y=>Y.status==="approved")),q){const Y=q.toLowerCase();U=U.filter(J=>J.work_description?.toLowerCase().includes(Y)||J.ce_pco_number?.toLowerCase().includes(Y)||J.ticket_date?.includes(Y))}return U.sort((Y,J)=>new Date(J.ticket_date)-new Date(Y.ticket_date)),U},[u,B,q]),T=U=>{const Y=new Set(v);Y.has(U)?Y.delete(U):Y.add(U),x(Y)},C=()=>{v.size===w.length?x(new Set):x(new Set(w.map(U=>U.id)))},W=U=>new Date(U).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),le=U=>{const Y=U.workers?.length||0,J=U.items?.length||0,D=U.materials_equipment?.filter(y=>y.type==="equipment")?.length||0;let _=0;return U.workers?.forEach(y=>{_+=(parseFloat(y.regular_hours)||0)+(parseFloat(y.overtime_hours)||0)}),{workerCount:Y,itemCount:J,equipmentCount:D,laborHours:_}},O=()=>{if(v.size===0){m?.("Please select at least one ticket","error");return}const U=u.filter(_=>v.has(_.id)),Y=[],J=[],D=[];U.forEach(_=>{_.workers?.forEach(y=>{Y.push({id:`import-${_.id}-${y.id||Date.now()}`,labor_class:y.role||"Laborer",wage_type:"standard",regular_hours:parseFloat(y.regular_hours)||0,overtime_hours:parseFloat(y.overtime_hours)||0,regular_rate:0,overtime_rate:0,total:0,source_ticket_id:_.id,source_ticket_date:_.ticket_date})}),_.items?.forEach(y=>{J.push({id:`import-${_.id}-${y.id||Date.now()}`,description:y.description||y.name,source_type:"backup_sheet",source_reference:`Ticket ${W(_.ticket_date)}`,quantity:parseFloat(y.quantity)||1,unit:y.unit||"each",unit_cost:zs(y.unit_cost||0),total:zs((y.quantity||1)*(y.unit_cost||0)),source_ticket_id:_.id})}),_.materials_equipment?.filter(y=>y.type==="equipment").forEach(y=>{D.push({id:`import-${_.id}-${y.id||Date.now()}`,description:y.description||y.name,source_type:"backup_sheet",source_reference:`Ticket ${W(_.ticket_date)}`,quantity:parseFloat(y.quantity)||1,unit:y.unit||"day",unit_cost:zs(y.unit_cost||y.cost||0),total:zs((y.quantity||1)*(y.unit_cost||y.cost||0)),source_ticket_id:_.id})})}),c?.({ticketIds:Array.from(v),laborItems:Y,materialsItems:J,equipmentItems:D}),i?.()};return f?e.jsx("div",{className:"modal-overlay",onClick:i,role:"dialog","aria-modal":"true","aria-label":"Loading tickets",children:e.jsx("div",{className:"modal-content ticket-selector-modal",onClick:U=>U.stopPropagation(),children:e.jsx("div",{className:"loading",role:"status","aria-live":"polite",children:"Loading tickets..."})})}):e.jsx("div",{className:"modal-overlay",onClick:i,role:"dialog","aria-modal":"true","aria-labelledby":"ticket-selector-title",children:e.jsxs("div",{className:"modal-content ticket-selector-modal",onClick:U=>U.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"ticket-selector-title",children:"Import from T&M Tickets"}),e.jsx("button",{className:"close-btn",onClick:i,"aria-label":"Close ticket selector",children:e.jsx(es,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"ticket-selector-controls",children:[e.jsxs("div",{className:"ticket-search",children:[e.jsx(xv,{size:16,"aria-hidden":"true"}),e.jsx("input",{type:"text",placeholder:"Search tickets...",value:q,onChange:U=>F(U.target.value),"aria-label":"Search tickets"})]}),e.jsxs("div",{className:"ticket-filters",role:"group","aria-label":"Filter tickets by status",children:[e.jsx("button",{className:`filter-btn ${B==="unassigned"?"active":""}`,onClick:()=>I("unassigned"),"aria-pressed":B==="unassigned",children:"Unassigned"}),e.jsx("button",{className:`filter-btn ${B==="approved"?"active":""}`,onClick:()=>I("approved"),"aria-pressed":B==="approved",children:"Approved"}),e.jsx("button",{className:`filter-btn ${B==="all"?"active":""}`,onClick:()=>I("all"),"aria-pressed":B==="all",children:"All"})]})]}),e.jsxs("div",{className:"ticket-selector-header",children:[e.jsxs("label",{className:"select-all",children:[e.jsx("input",{type:"checkbox",checked:v.size===w.length&&w.length>0,onChange:C,"aria-label":`Select all ${w.length} tickets`}),e.jsxs("span",{children:["Select All (",w.length,")"]})]}),e.jsxs("span",{className:"selected-count",children:[v.size," selected"]})]}),e.jsx("div",{className:"modal-body ticket-selector-body",children:w.length===0?e.jsxs("div",{className:"ticket-empty",children:[e.jsx(Aa,{size:32}),e.jsx("p",{children:"No tickets found"}),B==="unassigned"&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>I("all"),children:"Show all tickets"})]}):e.jsx("div",{className:"ticket-list",children:w.map(U=>{const Y=le(U),J=v.has(U.id),D=R===U.id;return e.jsxs("div",{className:`ticket-item ${J?"selected":""} ${U.assigned_cor_id?"assigned":""}`,children:[e.jsxs("div",{className:"ticket-item-main",children:[e.jsx("label",{className:"ticket-checkbox",children:e.jsx("input",{type:"checkbox",checked:J,onChange:()=>T(U.id),disabled:U.assigned_cor_id&&U.assigned_cor_id!==l})}),e.jsxs("div",{className:"ticket-item-info",onClick:()=>A(D?null:U.id),children:[e.jsxs("div",{className:"ticket-item-header",children:[e.jsx("span",{className:"ticket-date",children:W(U.ticket_date)}),e.jsx("span",{className:`ticket-status ${U.status}`,children:U.status}),U.ce_pco_number&&e.jsxs("span",{className:"ticket-pco",children:["CE/PCO: ",U.ce_pco_number]})]}),e.jsx("div",{className:"ticket-item-desc",children:U.work_description||"No description"}),e.jsxs("div",{className:"ticket-item-summary",children:[Y.workerCount>0&&e.jsxs("span",{children:[e.jsx(Os,{size:12})," ",Y.workerCount," workers"]}),Y.itemCount>0&&e.jsxs("span",{children:[e.jsx(ps,{size:12})," ",Y.itemCount," items"]}),Y.equipmentCount>0&&e.jsxs("span",{children:[e.jsx(Ka,{size:12})," ",Y.equipmentCount," equipment"]}),Y.laborHours>0&&e.jsxs("span",{children:[Y.laborHours," hrs"]})]})]}),e.jsx("button",{className:"ticket-expand-btn",onClick:()=>A(D?null:U.id),children:D?e.jsx(ya,{size:16}):e.jsx(hs,{size:16})})]}),D&&e.jsxs("div",{className:"ticket-item-details",children:[U.workers?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Workers"}),e.jsx("ul",{children:U.workers.map((_,y)=>e.jsxs("li",{children:[_.name||_.role," - ",_.regular_hours||0," reg hrs",_.overtime_hours>0&&`, ${_.overtime_hours} OT hrs`]},y))})]}),U.items?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Materials"}),e.jsx("ul",{children:U.items.map((_,y)=>e.jsxs("li",{children:[_.description||_.name," - ",_.quantity," ",_.unit]},y))})]}),U.materials_equipment?.filter(_=>_.type==="equipment").length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Equipment"}),e.jsx("ul",{children:U.materials_equipment.filter(_=>_.type==="equipment").map((_,y)=>e.jsx("li",{children:_.description||_.name},y))})]})]})]},U.id)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:i,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:O,disabled:v.size===0,children:[e.jsx(Wa,{size:16})," Import ",v.size," Ticket",v.size!==1?"s":""]})]})]})})}const Oi=[{id:1,label:"Title & Info",shortLabel:"Info"},{id:2,label:"Period",shortLabel:"Period"},{id:3,label:"Labor",shortLabel:"Labor"},{id:4,label:"Materials",shortLabel:"Materials"},{id:5,label:"Equipment",shortLabel:"Equipment"},{id:6,label:"Subcontractors",shortLabel:"Subs"},{id:7,label:"Markups & Fees",shortLabel:"Markups"},{id:8,label:"Summary",shortLabel:"Summary"},{id:9,label:"Submit",shortLabel:"Submit"}];function by({project:r,company:l,areas:c,existingCOR:i,onClose:m,onSaved:u,onShowToast:g}){const[f,j]=p.useState(1),[v,x]=p.useState(!1),[R,A]=p.useState([]),[q,F]=p.useState(!1),[B,I]=p.useState(i?.title||""),[re,w]=p.useState(i?.scope_of_work||""),[T,C]=p.useState(i?.area_id||""),[W,le]=p.useState(i?.cor_number||""),[O,U]=p.useState(i?.period_start||""),[Y,J]=p.useState(i?.period_end||""),[D,_]=p.useState(i?.change_order_labor||[]),[y,S]=p.useState(i?.change_order_materials||[]),[K,k]=p.useState(i?.change_order_equipment||[]),[ie,M]=p.useState(i?.change_order_subcontractors||[]),[G,L]=p.useState(i?.labor_markup_percent??On.labor_markup),[P,$]=p.useState(i?.materials_markup_percent??On.materials_markup),[E,ue]=p.useState(i?.equipment_markup_percent??On.equipment_markup),[Me,Te]=p.useState(i?.subcontractors_markup_percent??On.subcontractors_markup),[te,ze]=p.useState(i?.liability_insurance_percent??On.liability_insurance),[Re,qe]=p.useState(i?.bond_percent??On.bond),[Ie,Ct]=p.useState(i?.license_fee_percent??On.license_fee);p.useEffect(()=>{nt(),i||Ht()},[]);const nt=async()=>{try{const se=await ee.getLaborRates?.(l?.id,r?.work_type,r?.job_type);A(se||[])}catch(se){console.error("Error loading labor rates:",se)}},jt=se=>{const ye=se?.toLowerCase()||"";return R.find(pe=>pe.role?.toLowerCase()===ye)||null},Ht=async()=>{try{const se=await ee.getNextCORNumber?.(r.id);le(se||`COR-${Date.now()}`)}catch(se){console.error("Error generating COR number:",se),le(`COR-${Date.now()}`)}},pt=p.useMemo(()=>({title:B,scope_of_work:re,area_id:T||null,cor_number:W,period_start:O,period_end:Y,change_order_labor:D,change_order_materials:y,change_order_equipment:K,change_order_subcontractors:ie,labor_markup_percent:G,materials_markup_percent:P,equipment_markup_percent:E,subcontractors_markup_percent:Me,liability_insurance_percent:te,bond_percent:Re,license_fee_percent:Ie}),[B,re,T,W,O,Y,D,y,K,ie,G,P,E,Me,te,Re,Ie]),at=p.useMemo(()=>yl(pt),[pt]),va=se=>{switch(se){case 1:return B.trim()?re.trim()?!0:(g?.("Scope of work is required","error"),!1):(g?.("Title is required","error"),!1);case 2:return O?Y?new Date(Y)<new Date(O)?(g?.("End date must be after start date","error"),!1):!0:(g?.("End date is required","error"),!1):(g?.("Start date is required","error"),!1);default:return!0}},_e=()=>{va(f)&&j(Math.min(f+1,Oi.length))},Ze=()=>{j(Math.max(f-1,1))},Ge=se=>{if(se<f)j(se);else if(se>f){for(let ye=f;ye<se;ye++)if(!va(ye))return;j(se)}},Le=()=>{const se=Hp[0],ye=jt(se);_([...D,{id:`temp-${Date.now()}`,labor_class:se,wage_type:"standard",regular_hours:0,overtime_hours:0,regular_rate:ye?Math.round((parseFloat(ye.regular_rate)||0)*100):0,overtime_rate:ye?Math.round((parseFloat(ye.overtime_rate)||0)*100):0,total:0}])},Ve=(se,ye,pe)=>{const et=[...D];if(et[se]={...et[se],[ye]:pe},ye==="labor_class"){const Xt=jt(pe);Xt&&(et[se].regular_rate=Math.round((parseFloat(Xt.regular_rate)||0)*100),et[se].overtime_rate=Math.round((parseFloat(Xt.overtime_rate)||0)*100))}const{total:mt}=xy(et[se].regular_hours,et[se].overtime_hours,et[se].regular_rate,et[se].overtime_rate);et[se].total=mt,_(et)},Ye=se=>{_(D.filter((ye,pe)=>pe!==se))},je=()=>{S([...y,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"each",unit_cost:0,total:0}])},dt=(se,ye,pe)=>{const et=[...y];et[se]={...et[se],[ye]:pe},et[se].total=Up(et[se].quantity,et[se].unit_cost),S(et)},vt=se=>{S(y.filter((ye,pe)=>pe!==se))},ct=()=>{k([...K,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"day",unit_cost:0,total:0}])},Pt=(se,ye,pe)=>{const et=[...K];et[se]={...et[se],[ye]:pe},et[se].total=Up(et[se].quantity,et[se].unit_cost),k(et)},De=se=>{k(K.filter((ye,pe)=>pe!==se))},Z=()=>{M([...ie,{id:`temp-${Date.now()}`,company_name:"",description:"",source_type:"invoice",source_reference:"",amount:0,total:0}])},H=(se,ye,pe)=>{const et=[...ie];et[se]={...et[se],[ye]:pe},ye==="amount"&&(et[se].total=parseInt(pe)||0),M(et)},Ee=se=>{M(ie.filter((ye,pe)=>pe!==se))},Se=se=>{se.laborItems?.length>0&&_([...D,...se.laborItems]),se.materialsItems?.length>0&&S([...y,...se.materialsItems]),se.equipmentItems?.length>0&&k([...K,...se.equipmentItems]),g?.(`Imported data from ${se.ticketIds.length} ticket(s)`,"success")},Ne=async()=>{x(!0);try{const se={company_id:l.id,project_id:r.id,...pt,...at,status:"draft"};let ye;i?.id?ye=await ee.updateCOR(i.id,se):ye=await ee.createCOR(se),ye?.id&&await ee.saveCORLineItems(ye.id,{laborItems:D,materialItems:y,equipmentItems:K,subcontractorItems:ie}),g?.("COR saved as draft","success"),u?.(ye),m?.()}catch(se){console.error("Error saving COR:",se),g?.("Error saving COR","error")}finally{x(!1)}},ke=async()=>{const se=dd(pt);if(!se.valid){g?.(se.errors[0],"error");return}x(!0);try{const ye={company_id:l.id,project_id:r.id,...pt,...at,status:"pending_approval"};let pe;i?.id?(pe=await ee.updateCOR(i.id,{...ye,status:"draft"}),await ee.saveCORLineItems(i.id,{laborItems:D,materialItems:y,equipmentItems:K,subcontractorItems:ie}),await ee.submitCORForApproval(i.id)):(pe=await ee.createCOR({...ye,status:"draft"}),pe?.id&&(await ee.saveCORLineItems(pe.id,{laborItems:D,materialItems:y,equipmentItems:K,subcontractorItems:ie}),await ee.submitCORForApproval(pe.id))),g?.("COR submitted for approval","success"),u?.(pe),m?.()}catch(ye){console.error("Error submitting COR:",ye),g?.("Error submitting COR","error")}finally{x(!1)}};return e.jsxs("div",{className:"modal-overlay",onClick:m,children:[e.jsxs("div",{className:"modal-content cor-form-modal",onClick:se=>se.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:i?"Edit Change Order Request":"New Change Order Request"}),e.jsx("button",{className:"close-btn",onClick:m,children:e.jsx(es,{size:20})})]}),e.jsx("div",{className:"cor-progress-steps",children:Oi.map(se=>e.jsxs("div",{className:`cor-step ${f>=se.id?"active":""} ${f===se.id?"current":""}`,onClick:()=>Ge(se.id),children:[e.jsx("span",{className:"cor-step-number",children:se.id}),e.jsx("span",{className:"cor-step-label",children:se.shortLabel})]},se.id))}),e.jsxs("div",{className:"modal-body cor-form-body",children:[f===1&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Basic Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"COR Number"}),e.jsx("input",{type:"text",value:W,onChange:se=>le(se.target.value),placeholder:"Auto-generated",className:"input-readonly",readOnly:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title *"}),e.jsx("input",{type:"text",value:B,onChange:se=>I(se.target.value),placeholder:"e.g., Additional Demolition Work - Building A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Scope of Work *"}),e.jsx("textarea",{value:re,onChange:se=>w(se.target.value),rows:4,placeholder:"Describe the scope of work covered by this change order..."})]}),c&&c.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Area (Optional)"}),e.jsxs("select",{value:T,onChange:se=>C(se.target.value),children:[e.jsx("option",{value:"",children:"No specific area"}),c.map(se=>e.jsx("option",{value:se.id,children:se.name},se.id))]})]})]}),f===2&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Work Period"}),e.jsx("p",{className:"step-description",children:"Specify the date range for this change order work."}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Start Date *"}),e.jsx("input",{type:"date",value:O,onChange:se=>U(se.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"End Date *"}),e.jsx("input",{type:"date",value:Y,onChange:se=>J(se.target.value),min:O})]})]})]}),f===3&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Labor"}),e.jsx("p",{className:"step-description",children:"Add labor costs for this change order."})]}),e.jsxs("div",{className:"step-header-actions",children:[e.jsxs("button",{className:"btn btn-ghost",onClick:()=>F(!0),children:[e.jsx(Aa,{size:16})," Import from Tickets"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:Le,children:[e.jsx(Ta,{size:16})," Add Labor"]})]})]}),D.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No labor items added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:Le,children:[e.jsx(Ta,{size:16})," Add First Labor Item"]})]}):e.jsx("div",{className:"line-items-list",children:D.map((se,ye)=>e.jsxs("div",{className:"line-item labor-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",ye+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>Ye(ye),children:e.jsx(qs,{size:14})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Labor Class"}),e.jsx("select",{value:se.labor_class,onChange:pe=>Ve(ye,"labor_class",pe.target.value),children:Hp.map(pe=>e.jsx("option",{value:pe,children:pe},pe))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Wage Type"}),e.jsx("select",{value:se.wage_type,onChange:pe=>Ve(ye,"wage_type",pe.target.value),children:jy.map(pe=>e.jsx("option",{value:pe.value,children:pe.label},pe.value))})]})]}),e.jsxs("div",{className:"form-row four-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reg Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:se.regular_hours,onChange:pe=>Ve(ye,"regular_hours",pe.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reg Rate ($/hr)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ja(se.regular_rate),onChange:pe=>Ve(ye,"regular_rate",zs(pe.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"OT Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:se.overtime_hours,onChange:pe=>Ve(ye,"overtime_hours",pe.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"OT Rate ($/hr)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ja(se.overtime_rate),onChange:pe=>Ve(ye,"overtime_rate",zs(pe.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:Ce(se.total)})]})]},se.id||ye))}),e.jsxs("div",{className:"section-subtotal",children:["Labor Subtotal: ",e.jsx("strong",{children:Ce(at.labor_subtotal)})]})]}),f===4&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Materials"}),e.jsx("p",{className:"step-description",children:"Add material costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:je,children:[e.jsx(Ta,{size:16})," Add Material"]})]}),y.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No materials added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:je,children:[e.jsx(Ta,{size:16})," Add First Material"]})]}):e.jsx("div",{className:"line-items-list",children:y.map((se,ye)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",ye+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>vt(ye),children:e.jsx(qs,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{type:"text",value:se.description,onChange:pe=>dt(ye,"description",pe.target.value),placeholder:"Material description"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:se.source_type,onChange:pe=>dt(ye,"source_type",pe.target.value),children:ud.materials.map(pe=>e.jsx("option",{value:pe.value,children:pe.label},pe.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:se.source_reference,onChange:pe=>dt(ye,"source_reference",pe.target.value),placeholder:"Ticket #, Invoice #"})]})]}),e.jsxs("div",{className:"form-row three-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:se.quantity,onChange:pe=>dt(ye,"quantity",pe.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit"}),e.jsx("select",{value:se.unit,onChange:pe=>dt(ye,"unit",pe.target.value),children:Bp.map(pe=>e.jsx("option",{value:pe,children:pe},pe))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit Cost ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ja(se.unit_cost),onChange:pe=>dt(ye,"unit_cost",zs(pe.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:Ce(se.total)})]})]},se.id||ye))}),e.jsxs("div",{className:"section-subtotal",children:["Materials Subtotal: ",e.jsx("strong",{children:Ce(at.materials_subtotal)})]})]}),f===5&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Equipment"}),e.jsx("p",{className:"step-description",children:"Add equipment rental costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:ct,children:[e.jsx(Ta,{size:16})," Add Equipment"]})]}),K.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No equipment added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:ct,children:[e.jsx(Ta,{size:16})," Add First Equipment"]})]}):e.jsx("div",{className:"line-items-list",children:K.map((se,ye)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",ye+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>De(ye),children:e.jsx(qs,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{type:"text",value:se.description,onChange:pe=>Pt(ye,"description",pe.target.value),placeholder:"Equipment description"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:se.source_type,onChange:pe=>Pt(ye,"source_type",pe.target.value),children:ud.equipment.map(pe=>e.jsx("option",{value:pe.value,children:pe.label},pe.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:se.source_reference,onChange:pe=>Pt(ye,"source_reference",pe.target.value),placeholder:"Ticket #, Invoice #"})]})]}),e.jsxs("div",{className:"form-row three-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:se.quantity,onChange:pe=>Pt(ye,"quantity",pe.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit"}),e.jsx("select",{value:se.unit,onChange:pe=>Pt(ye,"unit",pe.target.value),children:Bp.map(pe=>e.jsx("option",{value:pe,children:pe},pe))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit Cost ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ja(se.unit_cost),onChange:pe=>Pt(ye,"unit_cost",zs(pe.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:Ce(se.total)})]})]},se.id||ye))}),e.jsxs("div",{className:"section-subtotal",children:["Equipment Subtotal: ",e.jsx("strong",{children:Ce(at.equipment_subtotal)})]})]}),f===6&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Subcontractors"}),e.jsx("p",{className:"step-description",children:"Add subcontractor costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:Z,children:[e.jsx(Ta,{size:16})," Add Subcontractor"]})]}),ie.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No subcontractors added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:Z,children:[e.jsx(Ta,{size:16})," Add First Subcontractor"]})]}):e.jsx("div",{className:"line-items-list",children:ie.map((se,ye)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",ye+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>Ee(ye),children:e.jsx(qs,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Company Name"}),e.jsx("input",{type:"text",value:se.company_name,onChange:pe=>H(ye,"company_name",pe.target.value),placeholder:"Subcontractor company name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description of Work"}),e.jsx("input",{type:"text",value:se.description,onChange:pe=>H(ye,"description",pe.target.value),placeholder:"Work performed"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:se.source_type,onChange:pe=>H(ye,"source_type",pe.target.value),children:ud.subcontractors.map(pe=>e.jsx("option",{value:pe.value,children:pe.label},pe.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:se.source_reference,onChange:pe=>H(ye,"source_reference",pe.target.value),placeholder:"Invoice #, Quote #"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Amount ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ja(se.amount),onChange:pe=>H(ye,"amount",zs(pe.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:Ce(se.total)})]})]},se.id||ye))}),e.jsxs("div",{className:"section-subtotal",children:["Subcontractors Subtotal: ",e.jsx("strong",{children:Ce(at.subcontractors_subtotal)})]})]}),f===7&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Markups & Fees"}),e.jsx("p",{className:"step-description",children:"Configure markup percentages and additional fees."}),e.jsxs("div",{className:"markups-section",children:[e.jsx("h4",{children:"Markups"}),e.jsxs("div",{className:"markups-grid",children:[e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Labor Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:dn(G),onChange:se=>L(qn(se.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",Ce(at.labor_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Materials Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:dn(P),onChange:se=>$(qn(se.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",Ce(at.materials_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Equipment Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:dn(E),onChange:se=>ue(qn(se.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",Ce(at.equipment_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Subcontractors Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:dn(Me),onChange:se=>Te(qn(se.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",Ce(at.subcontractors_markup_amount)]})]})]})]}),e.jsxs("div",{className:"fees-section",children:[e.jsx("h4",{children:"Additional Fees"}),e.jsxs("div",{className:"fees-grid",children:[e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"Liability Insurance"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:dn(te),onChange:se=>ze(qn(se.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",Ce(at.liability_insurance_amount)]})]}),e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"Bond"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:dn(Re),onChange:se=>qe(qn(se.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",Ce(at.bond_amount)]})]}),e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"City License Fee"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.001",min:"0",max:"100",value:dn(Ie),onChange:se=>Ct(qn(se.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",Ce(at.license_fee_amount)]})]})]})]})]}),f===8&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Summary"}),e.jsxs("div",{className:"cor-summary",children:[e.jsxs("div",{className:"summary-header",children:[e.jsx("div",{className:"summary-title",children:B||"Untitled COR"}),e.jsx("div",{className:"summary-number",children:W})]}),e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"Costs Breakdown"}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Labor (",D.length," items)"]}),e.jsx("span",{children:Ce(at.labor_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",Ut(G),")"]}),e.jsx("span",{children:Ce(at.labor_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Materials (",y.length," items)"]}),e.jsx("span",{children:Ce(at.materials_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",Ut(P),")"]}),e.jsx("span",{children:Ce(at.materials_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Equipment (",K.length," items)"]}),e.jsx("span",{children:Ce(at.equipment_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",Ut(E),")"]}),e.jsx("span",{children:Ce(at.equipment_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Subcontractors (",ie.length," items)"]}),e.jsx("span",{children:Ce(at.subcontractors_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",Ut(Me),")"]}),e.jsx("span",{children:Ce(at.subcontractors_markup_amount)})]})]}),e.jsxs("div",{className:"summary-subtotal",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Ce(at.cor_subtotal)})]}),e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"Additional Fees"}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Liability Insurance (",Ut(te),")"]}),e.jsx("span",{children:Ce(at.liability_insurance_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Bond (",Ut(Re),")"]}),e.jsx("span",{children:Ce(at.bond_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["City License Fee (",Ut(Ie),")"]}),e.jsx("span",{children:Ce(at.license_fee_amount)})]})]}),e.jsxs("div",{className:"summary-total",children:[e.jsx("span",{children:"COR Total"}),e.jsx("span",{children:Ce(at.cor_total)})]})]})]}),f===9&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Submit Change Order Request"}),e.jsxs("div",{className:"submit-preview",children:[e.jsxs("div",{className:"preview-card",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx("span",{className:"preview-number",children:W}),e.jsx("span",{className:"preview-total",children:Ce(at.cor_total)})]}),e.jsx("div",{className:"preview-title",children:B}),e.jsx("div",{className:"preview-scope",children:re})]}),(()=>{const se=dd(pt);return se.valid?e.jsx("div",{className:"validation-success",children:"Ready to submit for approval!"}):e.jsxs("div",{className:"validation-errors",children:[e.jsx(Hn,{size:20}),e.jsxs("div",{children:[e.jsx("strong",{children:"Please fix the following issues:"}),e.jsx("ul",{children:se.errors.map((ye,pe)=>e.jsx("li",{children:ye},pe))})]})]})})(),e.jsxs("div",{className:"submit-actions",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:Ne,disabled:v,children:[e.jsx(Ap,{size:16})," Save as Draft"]}),e.jsxs("button",{className:"btn btn-primary",onClick:ke,disabled:v||!dd(pt).valid,children:[e.jsx(Dd,{size:16})," Submit for Approval"]})]})]})]})]}),e.jsxs("div",{className:"modal-footer cor-form-footer",children:[e.jsx("div",{className:"footer-left",children:f>1&&e.jsxs("button",{className:"btn btn-secondary",onClick:Ze,disabled:v,children:[e.jsx(xj,{size:16})," Back"]})}),e.jsx("div",{className:"footer-center",children:e.jsxs("span",{className:"step-indicator",children:["Step ",f," of ",Oi.length]})}),e.jsxs("div",{className:"footer-right",children:[f<Oi.length&&e.jsxs("button",{className:"btn btn-primary",onClick:_e,disabled:v,children:["Next ",e.jsx(hs,{size:16})]}),f>1&&f<9&&e.jsxs("button",{className:"btn btn-ghost",onClick:Ne,disabled:v,children:[e.jsx(Ap,{size:14})," Save Draft"]})]})]})]}),q&&e.jsx(yy,{projectId:r.id,corId:i?.id,onImport:Se,onClose:()=>F(!1),onShowToast:g})]})}const _y=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},Fp=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});async function bf(r,l,c,i={},m=null){const u=new Bi,g=u.internal.pageSize.getWidth(),f=u.internal.pageSize.getHeight(),j=20;let v=j;const x=yl(r),R=i.primaryColor?_y(i.primaryColor):[30,58,138],A=[241,245,249];let q=null;if(i.logoUrl)try{q=await Fp(i.logoUrl)}catch(O){console.error("Error loading logo:",O)}if(q)try{u.addImage(q,"PNG",j,v,40,15),v+=20}catch{u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...R),u.text(c?.name||"Company Name",j,v+10),v+=20}else u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...R),u.text(c?.name||"Company Name",j,v+10),v+=20;u.setFontSize(20),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("CHANGE ORDER REQUEST",j,v),v+=10,u.setFontSize(12),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(r.cor_number||"COR-XXXX",j,v);const F=r.status?.replace("_"," ").toUpperCase()||"DRAFT";u.setTextColor(...R),u.text(F,g-j-u.getTextWidth(F),v),v+=12,u.setDrawColor(...R),u.setLineWidth(.5),u.line(j,v,g-j,v),v+=10,u.setFontSize(10),u.setTextColor(0,0,0);const B=j,I=g/2;u.setFont("helvetica","bold"),u.text("Project:",B,v),u.setFont("helvetica","normal"),u.text(l?.name||"Project Name",B+25,v),u.setFont("helvetica","bold"),u.text("Job #:",I,v),u.setFont("helvetica","normal"),u.text(l?.job_number||"N/A",I+25,v),v+=6,u.setFont("helvetica","bold"),u.text("Period:",B,v),u.setFont("helvetica","normal"),u.text($i(r.period_start,r.period_end),B+25,v),u.setFont("helvetica","bold"),u.text("Date:",I,v),u.setFont("helvetica","normal"),u.text(is(r.created_at),I+25,v),v+=10,u.setFont("helvetica","bold"),u.setFontSize(12),u.text(r.title||"Untitled Change Order",j,v),v+=8,u.setFont("helvetica","normal"),u.setFontSize(10),u.setTextColor(80,80,80);const re=u.splitTextToSize(r.scope_of_work||"No scope of work provided.",g-j*2);u.text(re,j,v),v+=re.length*5+10,r.change_order_labor?.length>0&&(u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("LABOR",j,v),v+=6,un(u,{startY:v,head:[["Class","Type","Reg Hrs","Reg Rate","OT Hrs","OT Rate","Total"]],body:r.change_order_labor.map(O=>[O.labor_class,O.wage_type,O.regular_hours.toString(),`$${ja(O.regular_rate)}/hr`,O.overtime_hours?.toString()||"-",O.overtime_hours?`$${ja(O.overtime_rate)}/hr`:"-",Ce(O.total)]),foot:[[{content:`Subtotal: ${Ce(x.labor_subtotal)}`,colSpan:5,styles:{halign:"right",fontStyle:"bold"}},{content:`+${Ut(r.labor_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ce(x.labor_subtotal+x.labor_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:j,right:j},headStyles:{fillColor:R,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:A,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),r.change_order_materials?.length>0&&(v>f-80&&(u.addPage(),v=j),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("MATERIALS",j,v),v+=6,un(u,{startY:v,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:r.change_order_materials.map(O=>[O.description,O.source_reference||O.source_type,O.quantity.toString(),O.unit,`$${ja(O.unit_cost)}`,Ce(O.total)]),foot:[[{content:`Subtotal: ${Ce(x.materials_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${Ut(r.materials_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ce(x.materials_subtotal+x.materials_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:j,right:j},headStyles:{fillColor:R,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:A,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),r.change_order_equipment?.length>0&&(v>f-80&&(u.addPage(),v=j),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("EQUIPMENT",j,v),v+=6,un(u,{startY:v,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:r.change_order_equipment.map(O=>[O.description,O.source_reference||O.source_type,O.quantity.toString(),O.unit,`$${ja(O.unit_cost)}`,Ce(O.total)]),foot:[[{content:`Subtotal: ${Ce(x.equipment_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${Ut(r.equipment_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ce(x.equipment_subtotal+x.equipment_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:j,right:j},headStyles:{fillColor:R,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:A,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),r.change_order_subcontractors?.length>0&&(v>f-80&&(u.addPage(),v=j),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("SUBCONTRACTORS",j,v),v+=6,un(u,{startY:v,head:[["Company","Description","Source","Amount"]],body:r.change_order_subcontractors.map(O=>[O.company_name,O.description,O.source_reference||O.source_type,Ce(O.total)]),foot:[[{content:`Subtotal: ${Ce(x.subcontractors_subtotal)}`,colSpan:2,styles:{halign:"right",fontStyle:"bold"}},{content:`+${Ut(r.subcontractors_markup_percent||500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ce(x.subcontractors_subtotal+x.subcontractors_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:j,right:j},headStyles:{fillColor:R,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:A,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),v>f-100&&(u.addPage(),v=j),u.setFillColor(...A),u.roundedRect(j,v,g-j*2,70,3,3,"F"),v+=10,u.setFontSize(10),u.setFont("helvetica","normal"),u.setTextColor(0,0,0);const w=j+10,T=g-j-60;u.text("COR Subtotal:",w,v),u.setFont("helvetica","bold"),u.text(Ce(x.cor_subtotal),T,v,{align:"right"}),v+=8,u.setFont("helvetica","normal"),u.setFontSize(9),u.text(`Liability Insurance (${Ut(r.liability_insurance_percent||144)}):`,w,v),u.text(Ce(x.liability_insurance_amount),T,v,{align:"right"}),v+=6,u.text(`Bond (${Ut(r.bond_percent||100)}):`,w,v),u.text(Ce(x.bond_amount),T,v,{align:"right"}),v+=6,u.text(`City License Fee (${Ut(r.license_fee_percent||10)}):`,w,v),u.text(Ce(x.license_fee_amount),T,v,{align:"right"}),v+=10,u.setFillColor(...R),u.roundedRect(w-5,v-3,g-j*2-10,16,2,2,"F"),u.setTextColor(255,255,255),u.setFontSize(12),u.setFont("helvetica","bold"),u.text("COR TOTAL:",w,v+8),u.text(Ce(x.cor_total),T,v+8,{align:"right"}),v+=25,v>f-120&&(u.addPage(),v=j),v+=10,u.setTextColor(0,0,0),u.setFontSize(10),u.setFont("helvetica","bold"),u.text("AUTHORIZATION",j,v),v+=15,u.setFont("helvetica","normal"),u.setFontSize(9),u.setDrawColor(0,0,0);const C=(O,U,Y,J,D,_,y)=>{u.setFont("helvetica","bold"),u.setFontSize(8),u.text(U,j,O),u.setFont("helvetica","normal"),u.setFontSize(9);const S=O+20;if(u.line(j,S,j+70,S),u.text("Signature",j,S+8),u.line(j+85,S,j+145,S),u.text("Title / Company",j+85,S+8),u.line(g-j-40,S,g-j,S),u.text("Date",g-j-40,S+8),Y)try{if(u.addImage(Y,"PNG",j,S-18,60,18),J&&(u.setFontSize(8),u.text(J,j,S+15)),D||_){const K=[D,_].filter(Boolean).join(" - ");u.text(K,j+85,S-5)}y&&u.text(is(y),g-j-40,S-5)}catch(K){console.error("Error adding signature:",K)}else u.setFont("helvetica","italic"),u.setFontSize(9),u.setTextColor(150,150,150),u.text("Awaiting Signature",j+5,S-5),u.setTextColor(0,0,0),u.setFont("helvetica","normal");return S+25};if(v=C(v,"GC AUTHORIZATION",r.gc_signature_data||r.gc_signature,r.gc_signature_name||r.gc_signer_name,r.gc_signature_title,r.gc_signature_company,r.gc_signature_date||r.signed_at),v+=10,v=C(v,"CLIENT AUTHORIZATION",r.client_signature_data,r.client_signature_name,r.client_signature_title,r.client_signature_company,r.client_signature_date),m&&m.length>0){u.addPage(),v=j,u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...R),u.text("T&M BACKUP DOCUMENTATION",j,v),v+=8,u.setFontSize(10),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(`${m.length} T&M ticket${m.length>1?"s":""} associated with this COR`,j,v),v+=12,u.setDrawColor(...R),u.setLineWidth(.5),u.line(j,v,g-j,v),v+=10;for(const O of m){v>f-100&&(u.addPage(),v=j),u.setFillColor(245,247,250),u.roundedRect(j,v,g-j*2,18,2,2,"F"),u.setFontSize(11),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text(`T&M Ticket  ${is(O.work_date)}`,j+5,v+7),O.ce_pco_number&&(u.setFontSize(9),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(`CE/PCO: ${O.ce_pco_number}`,j+5,v+14));const Y={pending:[217,119,6],approved:[5,150,105],billed:[37,99,235]}[O.status]||[100,100,100];if(u.setFontSize(8),u.setTextColor(...Y),u.text(O.status?.toUpperCase()||"PENDING",g-j-30,v+10),v+=24,O.notes){u.setFontSize(9),u.setFont("helvetica","italic"),u.setTextColor(80,80,80);const J=u.splitTextToSize(O.notes,g-j*2-10);u.text(J,j+5,v),v+=J.length*4+6}if(O.t_and_m_workers?.length>0&&(u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("Labor:",j+5,v),v+=4,un(u,{startY:v,head:[["Worker","Class","Hours","Rate","OT Hrs","OT Rate"]],body:O.t_and_m_workers.map(J=>[J.name,J.labor_class||"-",J.hours?.toString()||"0",J.rate?`$${J.rate}/hr`:"-",J.overtime_hours?.toString()||"-",J.overtime_rate?`$${J.overtime_rate}/hr`:"-"]),margin:{left:j+5,right:j},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),v=u.lastAutoTable.finalY+8),O.t_and_m_items?.length>0&&(v>f-60&&(u.addPage(),v=j),u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("Materials/Equipment:",j+5,v),v+=4,un(u,{startY:v,head:[["Item","Qty","Unit","Unit Cost","Total"]],body:O.t_and_m_items.map(J=>[J.materials_equipment?.name||J.description||"Item",J.quantity?.toString()||"1",J.materials_equipment?.unit||"ea",J.materials_equipment?.cost_per_unit?`$${J.materials_equipment.cost_per_unit}`:"-",J.materials_equipment?.cost_per_unit&&J.quantity?`$${(J.quantity*J.materials_equipment.cost_per_unit).toFixed(2)}`:"-"]),margin:{left:j+5,right:j},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),v=u.lastAutoTable.finalY+8),O.photos?.length>0){v>f-80&&(u.addPage(),v=j),u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text(`Photos (${O.photos.length}):`,j+5,v),v+=6;let J=j+5;const D=45,_=35,y=3;for(let S=0;S<O.photos.length;S++){S>0&&S%y===0&&(J=j+5,v+=_+5),v+_>f-20&&(u.addPage(),v=j,J=j+5);try{const K=await Fp(O.photos[S]);K?u.addImage(K,"JPEG",J,v,D,_):(u.setFillColor(240,240,240),u.rect(J,v,D,_,"F"),u.setFontSize(7),u.setTextColor(150,150,150),u.text("Photo unavailable",J+5,v+_/2))}catch{u.setFillColor(240,240,240),u.rect(J,v,D,_,"F"),u.setFontSize(7),u.setTextColor(150,150,150),u.text("Photo unavailable",J+5,v+_/2)}J+=D+5}v+=_+10}v+=5,u.setDrawColor(200,200,200),u.setLineWidth(.2),u.line(j,v,g-j,v),v+=10}}const W=u.internal.getNumberOfPages();for(let O=1;O<=W;O++){u.setPage(O);const U=f-10;u.setFontSize(8),u.setTextColor(150,150,150),u.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,j,U),u.text(`Page ${O} of ${W}`,g-j,U,{align:"right"})}const le=`${r.cor_number||"COR"}_${l?.job_number||"export"}${m?.length?"_with_backup":""}.pdf`;u.save(le)}function Ny({onSave:r,onClose:l,signerName:c=""}){const i=p.useRef(null),[m,u]=p.useState(c),[g,f]=p.useState(!1),[j,v]=p.useState(!1),x=()=>{const w=i.current;return w?w.getContext("2d"):null},R=w=>{const T=i.current;if(!T)return{x:0,y:0};const C=T.getBoundingClientRect(),W=T.width/C.width,le=T.height/C.height,O=w.touches?w.touches[0].clientX:w.clientX,U=w.touches?w.touches[0].clientY:w.clientY;return{x:(O-C.left)*W,y:(U-C.top)*le}},A=w=>{w.preventDefault();const T=x();if(!T)return;const{x:C,y:W}=R(w);T.beginPath(),T.moveTo(C,W),v(!0),f(!0)},q=w=>{if(!j)return;w.preventDefault();const T=x();if(!T)return;const{x:C,y:W}=R(w);T.lineTo(C,W),T.stroke()},F=()=>{v(!1)},B=()=>{const w=i.current,T=x();!w||!T||(T.clearRect(0,0,w.width,w.height),f(!1))},I=w=>{if(!w)return;i.current=w;const T=w.getContext("2d");T.strokeStyle="#1e293b",T.lineWidth=2,T.lineCap="round",T.lineJoin="round"},re=()=>{if(!g||!m.trim())return;const w=i.current;if(!w)return;const T=w.toDataURL("image/png");r({signature:T,signerName:m.trim(),signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"signature-title",children:"GC Signature"}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close signature modal",children:e.jsx(es,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Signer Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:m,onChange:w=>u(w.target.value),placeholder:"Enter full name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(kd,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Sign below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:I,width:500,height:200,className:"signature-canvas",onMouseDown:A,onMouseMove:q,onMouseUp:F,onMouseLeave:F,onTouchStart:A,onTouchMove:q,onTouchEnd:F,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!g&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:B,disabled:!g,"aria-label":"Clear signature",children:[e.jsx(Ed,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("p",{className:"signature-legal",role:"note",children:"By signing above, I acknowledge that I have reviewed and approve this Change Order Request."})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:re,disabled:!g||!m.trim(),"aria-label":"Save signature",children:[e.jsx(Wa,{size:16,"aria-hidden":"true"})," Save Signature"]})]})]})})}function Sy({cor:r,project:l,company:c,areas:i,onClose:m,onEdit:u,onShowToast:g,onStatusChange:f}){const[j,v]=p.useState(!0),[x,R]=p.useState(r),[A,q]=p.useState(!1),[F,B]=p.useState(!1),[I,re]=p.useState(new Set),[w,T]=p.useState(null),C=p.useCallback(async()=>{try{const G=await ee.getCORById(r.id);G&&R(G)}catch(G){console.error("Error fetching COR details:",G),g?.("Error loading COR details","error")}finally{v(!1)}},[r.id,g]);p.useEffect(()=>{C()},[C]),p.useEffect(()=>{const G=ee.subscribeToCorTickets?.(r.id,()=>{C()});return()=>{G&&ee.unsubscribe?.(G)}},[r.id,C]);const W=p.useMemo(()=>yl(x),[x]),le=yf(x.status),O=x.status==="pending_approval",U=x.status==="draft",Y=G=>i?.find(P=>P.id===G)?.name||null,J=async()=>{if(confirm("Approve this change order request?")){v(!0);try{await ee.approveCOR(x.id),R({...x,status:"approved",approved_at:new Date().toISOString()}),g?.("COR approved","success"),f?.()}catch(G){console.error("Error approving COR:",G),g?.("Error approving COR","error")}finally{v(!1)}}},D=async()=>{const G=prompt("Enter rejection reason (optional):");if(G!==null){v(!0);try{await ee.rejectCOR(x.id,G),R({...x,status:"rejected",rejection_reason:G}),g?.("COR rejected","success"),f?.()}catch(L){console.error("Error rejecting COR:",L),g?.("Error rejecting COR","error")}finally{v(!1)}}},_=async()=>{if(confirm("Mark this COR as billed?")){v(!0);try{await ee.markCORAsBilled(x.id),R({...x,status:"billed"}),g?.("COR marked as billed","success"),f?.()}catch(G){console.error("Error marking COR as billed:",G),g?.("Error updating status","error")}finally{v(!1)}}},y=async G=>{v(!0);try{await ee.saveCORSignature?.(x.id,{gc_signature:G.signature,gc_signer_name:G.signerName,signed_at:G.signedAt}),R({...x,gc_signature:G.signature,gc_signer_name:G.signerName,signed_at:G.signedAt}),q(!1),g?.("Signature saved","success"),f?.()}catch(L){console.error("Error saving signature:",L),g?.("Error saving signature","error")}finally{v(!1)}},S=x.status==="approved"&&!x.gc_signature,K=G=>{re(L=>{const P=new Set(L);return P.has(G)?P.delete(G):P.add(G),P})},k=p.useMemo(()=>x.change_order_ticket_associations?.map(G=>G.t_and_m_tickets).filter(Boolean)||[],[x.change_order_ticket_associations]),ie=G=>{const L=G.t_and_m_workers||[],P=L.reduce((E,ue)=>E+(parseFloat(ue.hours)||0),0),$=L.reduce((E,ue)=>E+(parseFloat(ue.overtime_hours)||0),0);return{regular:P,overtime:$,total:P+$}},M=async()=>{try{g?.("Generating PDF with backup...","info"),await bf(x,l,c,{},k),g?.("PDF downloaded","success")}catch(G){console.error("Error exporting PDF:",G),g?.("Error generating PDF","error")}};return j?e.jsx("div",{className:"modal-overlay",onClick:m,children:e.jsx("div",{className:"modal-content cor-detail-modal",onClick:G=>G.stopPropagation(),children:e.jsx("div",{className:"cor-detail-loading",children:"Loading COR details..."})})}):e.jsxs("div",{className:"modal-overlay",onClick:m,role:"dialog","aria-modal":"true","aria-labelledby":"cor-detail-title",children:[e.jsxs("div",{className:"modal-content cor-detail-modal",onClick:G=>G.stopPropagation(),children:[e.jsxs("div",{className:"modal-header cor-detail-header",children:[e.jsxs("div",{className:"cor-detail-title-row",children:[e.jsxs("div",{children:[e.jsx("div",{className:"cor-detail-number",children:x.cor_number}),e.jsx("h2",{id:"cor-detail-title",children:x.title||"Untitled COR"})]}),e.jsx("button",{className:"close-btn",onClick:m,"aria-label":"Close COR details",children:e.jsx(es,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"cor-detail-meta",children:[e.jsx("span",{className:"cor-detail-status",style:{backgroundColor:le.bgColor,color:le.color},children:le.label}),Y(x.area_id)&&e.jsx("span",{className:"cor-detail-area",children:Y(x.area_id)}),e.jsxs("span",{className:"cor-detail-period",children:[e.jsx(hn,{size:14})," ",$i(x.period_start,x.period_end)]})]})]}),e.jsxs("div",{className:"modal-body cor-detail-body",children:[e.jsxs("div",{className:"cor-detail-section",children:[e.jsxs("h3",{children:[e.jsx(Aa,{size:18})," Scope of Work"]}),e.jsx("p",{className:"cor-scope-text",children:x.scope_of_work||"No scope of work provided."})]}),e.jsxs("div",{className:"cor-detail-section pricing-breakdown",children:[e.jsxs("h3",{children:[e.jsx(Sr,{size:18})," Pricing Breakdown"]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Os,{size:16}),e.jsx("span",{children:"Labor"})]}),e.jsx("span",{className:"category-subtotal",children:Ce(W.labor_subtotal)})]}),x.change_order_labor?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"Reg Rate"}),e.jsx("th",{children:"OT Hrs"}),e.jsx("th",{children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:x.change_order_labor.map((G,L)=>e.jsxs("tr",{children:[e.jsx("td",{children:G.labor_class}),e.jsx("td",{children:G.wage_type}),e.jsx("td",{children:G.regular_hours}),e.jsxs("td",{children:["$",ja(G.regular_rate),"/hr"]}),e.jsx("td",{children:G.overtime_hours||"-"}),e.jsx("td",{children:G.overtime_hours?`$${ja(G.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:Ce(G.total)})]},L))})]})}):e.jsx("div",{className:"category-empty",children:"No labor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",Ut(x.labor_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Ce(W.labor_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(ps,{size:16}),e.jsx("span",{children:"Materials"})]}),e.jsx("span",{className:"category-subtotal",children:Ce(W.materials_subtotal)})]}),x.change_order_materials?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:x.change_order_materials.map((G,L)=>e.jsxs("tr",{children:[e.jsx("td",{children:G.description}),e.jsx("td",{children:G.source_reference||G.source_type}),e.jsx("td",{children:G.quantity}),e.jsx("td",{children:G.unit}),e.jsxs("td",{children:["$",ja(G.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ce(G.total)})]},L))})]})}):e.jsx("div",{className:"category-empty",children:"No material items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",Ut(x.materials_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Ce(W.materials_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Ka,{size:16}),e.jsx("span",{children:"Equipment"})]}),e.jsx("span",{className:"category-subtotal",children:Ce(W.equipment_subtotal)})]}),x.change_order_equipment?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:x.change_order_equipment.map((G,L)=>e.jsxs("tr",{children:[e.jsx("td",{children:G.description}),e.jsx("td",{children:G.source_reference||G.source_type}),e.jsx("td",{children:G.quantity}),e.jsx("td",{children:G.unit}),e.jsxs("td",{children:["$",ja(G.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ce(G.total)})]},L))})]})}):e.jsx("div",{className:"category-empty",children:"No equipment items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",Ut(x.equipment_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Ce(W.equipment_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(pn,{size:16}),e.jsx("span",{children:"Subcontractors"})]}),e.jsx("span",{className:"category-subtotal",children:Ce(W.subcontractors_subtotal)})]}),x.change_order_subcontractors?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:x.change_order_subcontractors.map((G,L)=>e.jsxs("tr",{children:[e.jsx("td",{children:G.company_name}),e.jsx("td",{children:G.description}),e.jsx("td",{children:G.source_reference||G.source_type}),e.jsx("td",{className:"text-right",children:Ce(G.total)})]},L))})]})}):e.jsx("div",{className:"category-empty",children:"No subcontractor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",Ut(x.subcontractors_markup_percent||500),")"]}),e.jsxs("span",{children:["+",Ce(W.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"cor-subtotal-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Ce(W.cor_subtotal)})]}),e.jsxs("div",{className:"pricing-category fees-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(cv,{size:16}),e.jsx("span",{children:"Additional Fees"})]}),e.jsx("span",{className:"category-subtotal",children:Ce(W.additional_fees_total)})]}),e.jsxs("div",{className:"fees-list",children:[e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Fi,{size:14}),e.jsxs("span",{children:["Liability Insurance (",Ut(x.liability_insurance_percent||144),")"]})]}),e.jsx("span",{className:"fee-amount",children:Ce(W.liability_insurance_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Aa,{size:14}),e.jsxs("span",{children:["Bond (",Ut(x.bond_percent||100),")"]})]}),e.jsx("span",{className:"fee-amount",children:Ce(W.bond_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Hi,{size:14}),e.jsxs("span",{children:["City License Fee (",Ut(x.license_fee_percent||10),")"]})]}),e.jsx("span",{className:"fee-amount",children:Ce(W.license_fee_amount)})]})]})]}),e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:Ce(W.cor_total)})]})]}),k.length>0&&e.jsxs("div",{className:"cor-detail-section backup-section",children:[e.jsxs("h3",{children:[e.jsx(Aa,{size:18})," Backup Documentation"]}),e.jsxs("p",{className:"backup-summary",children:[k.length," T&M ticket",k.length!==1?"s":""," associated with this COR"]}),e.jsx("div",{className:"backup-tickets-list",children:k.map(G=>{const L=I.has(G.id),P=ie(G),$=G.t_and_m_workers?.length||0,E=G.t_and_m_items?.length||0,ue=G.photos?.length||0;return e.jsxs("div",{className:"backup-ticket-card",children:[e.jsxs("div",{className:"backup-ticket-header",onClick:()=>K(G.id),children:[e.jsx("div",{className:"backup-ticket-toggle",children:L?e.jsx(ya,{size:18}):e.jsx(hs,{size:18})}),e.jsxs("div",{className:"backup-ticket-info",children:[e.jsxs("div",{className:"backup-ticket-date",children:[e.jsx(Fn,{size:14}),e.jsx("span",{children:is(G.work_date)})]}),G.ce_pco_number&&e.jsxs("span",{className:"backup-ticket-pco",children:["CE/PCO: ",G.ce_pco_number]})]}),e.jsxs("div",{className:"backup-ticket-stats",children:[e.jsxs("span",{className:"backup-stat",children:[e.jsx(Os,{size:14})," ",$]}),e.jsxs("span",{className:"backup-stat",children:[P.total.toFixed(1)," hrs"]}),ue>0&&e.jsxs("span",{className:"backup-stat",children:[e.jsx(Bj,{size:14})," ",ue]})]}),e.jsx("span",{className:`backup-ticket-status status-${G.status}`,children:G.status})]}),L&&e.jsxs("div",{className:"backup-ticket-details",children:[G.notes&&e.jsxs("div",{className:"backup-ticket-notes",children:[e.jsx("strong",{children:"Notes:"})," ",G.notes]}),G.t_and_m_workers?.length>0&&e.jsxs("div",{className:"backup-workers",children:[e.jsxs("h4",{children:["Labor (",$," workers)"]}),e.jsxs("table",{className:"backup-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"OT Hrs"})]})}),e.jsx("tbody",{children:G.t_and_m_workers.map((Me,Te)=>e.jsxs("tr",{children:[e.jsx("td",{children:Me.name}),e.jsx("td",{children:Me.role||"-"}),e.jsx("td",{children:Me.hours||0}),e.jsx("td",{children:Me.overtime_hours||"-"})]},Te))})]})]}),G.t_and_m_items?.length>0&&e.jsxs("div",{className:"backup-items",children:[e.jsxs("h4",{children:["Materials & Equipment (",E," items)"]}),e.jsxs("table",{className:"backup-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Qty"})]})}),e.jsx("tbody",{children:G.t_and_m_items.map((Me,Te)=>e.jsxs("tr",{children:[e.jsx("td",{children:Me.materials_equipment?.name||Me.custom_name||"Item"}),e.jsx("td",{children:Me.materials_equipment?.category||Me.custom_category||"-"}),e.jsx("td",{children:Me.quantity})]},Te))})]})]}),G.photos?.length>0&&e.jsxs("div",{className:"backup-photos",children:[e.jsxs("h4",{children:["Photos (",ue,")"]}),e.jsx("div",{className:"backup-photos-grid",children:G.photos.map((Me,Te)=>e.jsx("div",{className:"backup-photo-thumb",onClick:()=>T(Me),children:e.jsx("img",{src:Me,alt:`Photo ${Te+1}`})},Te))})]})]})]},G.id)})})]}),(x.gc_signature_data||x.gc_signature||x.client_signature_data)&&e.jsxs("div",{className:"cor-detail-section signature-section",children:[e.jsxs("h3",{children:[e.jsx(Nv,{size:18})," Signatures"]}),e.jsxs("div",{className:"dual-signatures",children:[(x.gc_signature_data||x.gc_signature)&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"GC Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:x.gc_signature_data||x.gc_signature,alt:"GC Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:x.gc_signature_name||x.gc_signer_name}),(x.gc_signature_title||x.gc_signature_company)&&e.jsxs("span",{className:"signer-org",children:[x.gc_signature_title,x.gc_signature_title&&x.gc_signature_company&&" - ",x.gc_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",is(x.gc_signature_date||x.signed_at)]})]})]})]}),x.client_signature_data&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"Client Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:x.client_signature_data,alt:"Client Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:x.client_signature_name}),(x.client_signature_title||x.client_signature_company)&&e.jsxs("span",{className:"signer-org",children:[x.client_signature_title,x.client_signature_title&&x.client_signature_company&&" - ",x.client_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",is(x.client_signature_date)]})]})]})]})]})]}),x.status==="rejected"&&x.rejection_reason&&e.jsxs("div",{className:"cor-detail-section rejection-section",children:[e.jsxs("h3",{children:[e.jsx(Ep,{size:18})," Rejection Reason"]}),e.jsx("p",{className:"rejection-text",children:x.rejection_reason})]})]}),e.jsxs("div",{className:"modal-footer cor-detail-footer",children:[e.jsxs("div",{className:"footer-info",children:[e.jsxs("span",{children:["Created: ",is(x.created_at)]}),x.approved_at&&e.jsxs("span",{children:["Approved: ",is(x.approved_at)]})]}),e.jsxs("div",{className:"footer-actions",role:"group","aria-label":"COR actions",children:[U&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>u?.(x),disabled:j,"aria-label":"Edit this COR",children:[e.jsx(gl,{size:16,"aria-hidden":"true"})," Edit"]}),O&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-danger",onClick:D,disabled:j,"aria-label":"Reject this COR",children:[e.jsx(Ep,{size:16,"aria-hidden":"true"})," Reject"]}),e.jsxs("button",{className:"btn btn-success",onClick:J,disabled:j,"aria-label":"Approve this COR",children:[e.jsx(ms,{size:16,"aria-hidden":"true"})," Approve"]})]}),S&&e.jsxs("button",{className:"btn btn-success",onClick:()=>q(!0),disabled:j,"aria-label":"Get GC signature for this COR",children:[e.jsx(nv,{size:16,"aria-hidden":"true"})," Get GC Signature"]}),(x.status==="approved"||x.status==="pending_approval")&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>B(!0),disabled:j,"aria-label":"Get shareable signature link",children:[e.jsx(Cd,{size:16,"aria-hidden":"true"})," Get Signature Link"]}),x.status==="approved"&&e.jsxs("button",{className:"btn btn-primary",onClick:_,disabled:j,"aria-label":"Mark this COR as billed",children:[e.jsx(Sr,{size:16,"aria-hidden":"true"})," Mark Billed"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:M,"aria-label":"Export COR to PDF",children:[e.jsx(of,{size:16,"aria-hidden":"true"})," Export PDF"]})]})]})]}),A&&e.jsx(Ny,{onSave:y,onClose:()=>q(!1),signerName:""}),F&&e.jsx(Td,{documentType:"cor",documentId:x.id,companyId:c?.id,projectId:l?.id,documentTitle:`COR ${x.cor_number}: ${x.title||"Untitled"}`,onClose:()=>B(!1),onShowToast:g}),w&&e.jsxs("div",{className:"photo-lightbox",onClick:()=>T(null),children:[e.jsx("button",{className:"lightbox-close",onClick:()=>T(null),children:e.jsx(es,{size:24})}),e.jsx("img",{src:w,alt:"Full size photo",onClick:G=>G.stopPropagation()})]})]})}const cn=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),wy=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric"});function Cy({dailyBurn:r,totalBurn:l,daysWorked:c,laborCost:i,haulOffCost:m,progress:u,contractValue:g,laborByDate:f=[],haulOffByDate:j=[]}){const[v,x]=p.useState(!1),R=g*(u/100)*.6,A=l<=R?"on-budget":l<=R*1.2?"warning":"over-budget",q={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[A],F=A==="on-budget"?mf:A==="warning"?Nd:hf,I=u>0?l/(u/100):0,re=[],w={};f.forEach(C=>{w[C.date]||(w[C.date]={date:C.date,labor:0,haulOff:0,total:0}),w[C.date].labor=C.cost||0,w[C.date].total+=C.cost||0}),j.forEach(C=>{w[C.date]||(w[C.date]={date:C.date,labor:0,haulOff:0,total:0}),w[C.date].haulOff=C.cost||0,w[C.date].total+=C.cost||0}),Object.values(w).sort((C,W)=>new Date(W.date)-new Date(C.date)).slice(0,10).forEach(C=>re.push(C));const T=Math.max(...re.map(C=>C.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(qj,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${A}`,children:[e.jsx(F,{size:14}),e.jsx("span",{children:q})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:cn(r)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),c>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",c," work day",c!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:cn(l)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:cn(i)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Disposal"}),e.jsx("span",{className:"burn-summary-value",children:cn(m)})]})]}),u>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${I>g*.7?"warning":""}`,children:cn(I)})]}),re.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>x(!v),children:[v?e.jsx(cf,{size:16}):e.jsx(ya,{size:16}),e.jsxs("span",{children:[v?"Hide":"View"," Daily Breakdown"]})]}),v&&re.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Disposal"}),e.jsx("span",{children:"Total"})]}),re.map(C=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:wy(C.date)}),e.jsx("span",{className:"burn-labor",children:C.labor>0?cn(C.labor):"-"}),e.jsx("span",{className:"burn-hauloff",children:C.haulOff>0?cn(C.haulOff):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${C.total/T*100}%`}}),e.jsx("span",{className:"burn-amount",children:cn(C.total)})]})]},C.date))]})]})}const md=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),Li={labor:{label:"Labor",Icon:oa,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Ka,color:"#10b981"},equipment:{label:"Equipment",Icon:vl,color:"#f59e0b"},materials:{label:"Materials",Icon:ps,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:Os,color:"#ec4899"},other:{label:"Other",Icon:df,color:"#6b7280"}};function ky({laborCost:r=0,haulOffCost:l=0,customCosts:c=[],onAddCost:i,onDeleteCost:m}){const[u,g]=p.useState(!1),[f,j]=p.useState(null),v=[];r>0&&v.push({category:"labor",label:"Labor",amount:r,source:"auto",description:"From crew check-ins"}),l>0&&v.push({category:"disposal",label:"Disposal",amount:l,source:"auto",description:"From haul-off logs"});const x={};c.forEach(q=>{x[q.category]||(x[q.category]={category:q.category,items:[],total:0}),x[q.category].items.push(q),x[q.category].total+=parseFloat(q.amount)||0}),Object.values(x).forEach(q=>{const F=Li[q.category]||Li.other;v.push({category:q.category,label:F.label,amount:q.total,source:"manual",items:q.items})});const R=v.reduce((q,F)=>q+F.amount,0);v.forEach(q=>{q.percentage=R>0?q.amount/R*100:0}),v.sort((q,F)=>F.amount-q.amount);const A=q=>{j(f===q?null:q)};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:md(R)})]}),v.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):e.jsx("div",{className:"cost-breakdown",children:v.map(q=>{const F=Li[q.category]||Li.other,B=F.Icon,I=q.items&&q.items.length>0,re=f===q.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${I?"expandable":""}`,onClick:()=>I&&A(q.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(q.percentage,2)}%`,backgroundColor:F.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(B,{size:14,style:{color:F.color}}),e.jsx("span",{children:q.label}),q.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),I&&(re?e.jsx(cf,{size:14}):e.jsx(ya,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:md(q.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(q.percentage),"%"]})]})]})]}),re&&I&&e.jsx("div",{className:"cost-category-items",children:q.items.map(w=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:w.description}),e.jsx("span",{className:"cost-item-date",children:new Date(w.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:md(w.amount)}),m&&e.jsx("button",{className:"cost-item-delete",onClick:T=>{T.stopPropagation(),confirm("Delete this cost entry?")&&m(w.id)},children:e.jsx(qs,{size:14})})]})]},w.id))})]},q.category)})}),i&&e.jsxs("button",{className:"cost-add-btn",onClick:i,children:[e.jsx(Ta,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const Ln=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0);function Ey({revenue:r,totalCosts:l,contractValue:c,progress:i}){const m=r-l,u=r>0?m/r*100:0,g=c,f=i>0?l/(i/100):l,j=g-f,v=g>0?j/g*100:0,x=u>=20,R=u>=0&&u<20,A=u<0,q=x?"healthy":R?"warning":"loss",F=x?"On Track":R?"Watch Margin":"Over Cost",B=x?ms:R?Hn:mf;return e.jsxs("div",{className:`profitability-card ${q}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${q}`,children:[e.jsx(B,{size:14}),e.jsx("span",{children:F})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${u<0?"negative":""}`,children:[Math.round(u),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${u<0?"negative":u<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(u),100)}%`}})})]}),i>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${v<0?"negative":""}`,children:[Math.round(v),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${v<0?"negative":v<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(v),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:Ln(r)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",Ln(l)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${m<0?"negative":"positive"}`,children:[m>=0?"":"-",Ln(Math.abs(m))]})]})]}),i>10&&e.jsxs("div",{className:"profitability-insight",children:[x&&e.jsxs("p",{children:["At ",Math.round(i),"% complete, you're at ",Ln(m)," profit.",j>0&&` Projected final profit: ${Ln(j)}`]}),R&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",j<0&&` Trending toward ${Ln(j)} loss.`]}),A&&e.jsxs("p",{children:["Currently over cost by ",Ln(Math.abs(m)),". Immediate review recommended."]})]})]})}const Dy={concrete:{label:"Concrete",icon:"",color:"#6b7280"},trash:{label:"Trash",icon:"",color:"#10b981"},metals:{label:"Metals",icon:"",color:"#3b82f6"},hazardous_waste:{label:"Hazardous Waste",icon:"",color:"#f59e0b"}};function My({project:r,period:l="week"}){const[c,i]=p.useState([]),[m,u]=p.useState([]),[g,f]=p.useState(!0),j=()=>{const A=new Date,q=new Date;switch(l){case"week":q.setDate(q.getDate()-7);break;case"month":q.setMonth(q.getMonth()-1);break;case"all":q.setFullYear(2020);break;default:q.setDate(q.getDate()-7)}return{startDate:q.toISOString().split("T")[0],endDate:A.toISOString().split("T")[0]}};p.useEffect(()=>{v()},[r.id,l]);const v=async()=>{try{f(!0);const{startDate:A,endDate:q}=j(),[F,B]=await Promise.all([ee.getDisposalSummary(r.id,A,q),ee.getWeeklyDisposalSummary(r.id,4)]);i(F||[]),u(B||[])}catch(A){console.error("Error loading disposal summary:",A)}finally{f(!1)}},x=c.reduce((A,q)=>A+(q.total_loads||0),0),R={week:"This Week",month:"This Month",all:"All Time"}[l]||"This Week";return g?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(Ka,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):x===0?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(Ka,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("p",{className:"text-muted",children:R})]})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Ka,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsx("span",{className:"period-badge",children:R})]}),e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"total-number",children:x}),e.jsx("span",{className:"total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:c.map(A=>{const q=Dy[A.load_type]||{label:A.load_type,icon:"",color:"#6b7280"},F=Math.round(A.total_loads/x*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"type-info",children:[e.jsx("span",{className:"type-icon",children:q.icon}),e.jsx("span",{className:"type-label",children:q.label})]}),e.jsxs("div",{className:"type-stats",children:[e.jsx("div",{className:"type-bar-container",children:e.jsx("div",{className:"type-bar",style:{width:`${F}%`,backgroundColor:q.color}})}),e.jsx("span",{className:"type-count",children:A.total_loads})]})]},A.load_type)})}),m.length>1&&e.jsxs("div",{className:"disposal-trend",children:[e.jsxs("div",{className:"trend-header",children:[e.jsx(hf,{size:16}),e.jsx("span",{children:"Weekly Trend"})]}),e.jsx("div",{className:"trend-chart",children:m.map((A,q)=>{const F=A.concrete+A.trash+A.metals+A.hazardous_waste,B=Math.max(...m.map(re=>re.concrete+re.trash+re.metals+re.hazardous_waste)),I=B>0?F/B*100:0;return e.jsxs("div",{className:"trend-bar-wrapper",children:[e.jsx("div",{className:"trend-bar",style:{height:`${I}%`},title:`Week of ${A.week}: ${F} loads`}),e.jsxs("span",{className:"trend-label",children:["W",q+1]})]},A.week)})})]}),c.length>0&&c[0].days_with_activity&&e.jsxs("div",{className:"disposal-activity-days",children:[e.jsx(Fn,{size:14}),e.jsxs("span",{children:[c.reduce((A,q)=>Math.max(A,q.days_with_activity||0),0)," days with disposal activity"]})]})]})}const Ty=[{value:"labor",label:"Labor",Icon:oa,description:"Additional labor costs"},{value:"materials",label:"Materials",Icon:ps,description:"Materials and supplies"},{value:"equipment",label:"Equipment",Icon:vl,description:"Equipment rental or purchase"},{value:"subcontractor",label:"Subcontractor",Icon:Os,description:"Subcontractor work"},{value:"disposal",label:"Disposal",Icon:Ka,description:"Additional disposal costs"},{value:"other",label:"Other",Icon:df,description:"Miscellaneous costs"}];function Ay({onClose:r,onSave:l,saving:c=!1}){const[i,m]=p.useState({category:"materials",description:"",amount:"",cost_date:new Date().toISOString().split("T")[0],notes:""}),[u,g]=p.useState({}),f=(x,R)=>{m(A=>({...A,[x]:R})),u[x]&&g(A=>({...A,[x]:null}))},j=()=>{const x={};i.description.trim()||(x.description="Description is required");const R=parseFloat(i.amount);return(isNaN(R)||R<=0)&&(x.amount="Enter a valid amount"),i.cost_date||(x.cost_date="Date is required"),g(x),Object.keys(x).length===0},v=x=>{x.preventDefault(),j()&&l(i)};return e.jsx("div",{className:"modal-overlay",onClick:r,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content add-cost-modal",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(Sr,{size:20}),"Add Cost"]}),e.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close",children:e.jsx(es,{size:20})})]}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category *"}),e.jsx("div",{className:"category-grid",children:Ty.map(x=>{const R=x.Icon,A=i.category===x.value;return e.jsxs("button",{type:"button",className:`category-option ${A?"selected":""}`,onClick:()=>f("category",x.value),children:[e.jsx(R,{size:18}),e.jsx("span",{className:"category-label",children:x.label})]},x.value)})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-description",children:"Description *"}),e.jsx("input",{id:"cost-description",type:"text",value:i.description,onChange:x=>f("description",x.target.value),placeholder:"e.g., Excavator rental - Week 1",className:u.description?"error":""}),u.description&&e.jsx("span",{className:"form-error",children:u.description})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-amount",children:"Amount *"}),e.jsxs("div",{className:"input-with-prefix",children:[e.jsx("span",{className:"input-prefix",children:"$"}),e.jsx("input",{id:"cost-amount",type:"number",step:"0.01",min:"0",value:i.amount,onChange:x=>f("amount",x.target.value),placeholder:"0.00",className:u.amount?"error":""})]}),u.amount&&e.jsx("span",{className:"form-error",children:u.amount})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-date",children:"Date *"}),e.jsx("input",{id:"cost-date",type:"date",value:i.cost_date,onChange:x=>f("cost_date",x.target.value),className:u.cost_date?"error":""}),u.cost_date&&e.jsx("span",{className:"form-error",children:u.cost_date})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-notes",children:"Notes (optional)"}),e.jsx("textarea",{id:"cost-notes",value:i.notes,onChange:x=>f("notes",x.target.value),placeholder:"Additional details...",rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:r,disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:c,children:c?"Saving...":"Add Cost"})]})]})]})})}const $p=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function Ry({project:r,company:l,user:c,isAdmin:i,onShowToast:m}){const[u,g]=p.useState([]),[f,j]=p.useState([]),[v,x]=p.useState(!0),[R,A]=p.useState(!1),[q,F]=p.useState(""),[B,I]=p.useState("Team Member"),[re,w]=p.useState(null);p.useEffect(()=>{r?.id&&T()},[r?.id]),p.useEffect(()=>{R&&l?.id&&C()},[R,l?.id]);const T=async()=>{try{x(!0);const U=await ee.getProjectTeam(r.id);g(U)}catch(U){console.error("Error loading project team:",U)}finally{x(!1)}},C=async()=>{try{const U=await ee.getCompanyMembers(l.id),Y=u.map(D=>D.users?.id),J=U.filter(D=>!Y.includes(D.users?.id));j(J)}catch(U){console.error("Error loading company members:",U)}},W=async()=>{if(!q){m("Select a team member","error");return}try{w("add"),await ee.addProjectMember(r.id,q,B,c.id),m("Team member added","success"),A(!1),F(""),I("Team Member"),T()}catch(U){console.error("Error adding team member:",U),m("Error adding team member","error")}finally{w(null)}},le=async(U,Y)=>{try{w(U.id),await ee.updateProjectMemberRole(r.id,U.users?.id,Y),m("Role updated","success"),T()}catch(J){console.error("Error updating role:",J),m("Error updating role","error")}finally{w(null)}},O=async U=>{try{w(U.id),await ee.removeProjectMember(r.id,U.users?.id),m("Team member removed","success"),T()}catch(Y){console.error("Error removing team member:",Y),m("Error removing team member","error")}finally{w(null)}};return v?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(Os,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(Os,{size:18})," Project Team"]}),i&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>A(!0),children:[e.jsx(Ov,{size:14})," Add"]})]}),u.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",i&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:u.map(U=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:U.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:U.users?.email})]}),e.jsx("div",{className:"team-member-role",children:i?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:U.project_role,onChange:Y=>le(U,Y.target.value),disabled:re===U.id,className:"role-select",children:$p.map(Y=>e.jsx("option",{value:Y,children:Y},Y))}),e.jsx(ya,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:U.project_role})}),i&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>O(U),disabled:re===U.id,title:"Remove from project",children:e.jsx(ff,{size:14})})]},U.id))}),R&&e.jsx("div",{className:"modal-overlay",onClick:()=>A(!1),children:e.jsxs("div",{className:"modal-content small",onClick:U=>U.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>A(!1),children:e.jsx(es,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:q,onChange:U=>F(U.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),f.map(U=>e.jsx("option",{value:U.users?.id,children:U.users?.name||U.users?.email},U.users?.id))]}),f.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:B,onChange:U=>I(U.target.value),className:"form-select",children:$p.map(U=>e.jsx("option",{value:U,children:U},U))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>A(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:W,disabled:!q||re==="add",children:re==="add"?"Adding...":"Add to Project"})]})]})})]})}function zy({company:r,user:l,isAdmin:c,onShowToast:i,navigateToProjectId:m,onProjectNavigated:u}){const[g,f]=p.useState([]),[j,v]=p.useState([]),[x,R]=p.useState(null),[A,q]=p.useState([]),[F,B]=p.useState(!0),[I,re]=p.useState(!1),[w,T]=p.useState(null),[C,W]=p.useState(!1),[le,O]=p.useState(!1),[U,Y]=p.useState(!1),[J,D]=p.useState("overview"),[_,y]=p.useState([]),[S,K]=p.useState(!1),[k,ie]=p.useState(null),[M,G]=p.useState(!1),[L,P]=p.useState(null),[$,E]=p.useState(0),[ue,Me]=p.useState(!1),[Te,te]=p.useState(!1),ze=p.useRef(null),Re=p.useRef(!1),qe=p.useRef(!1),Ie=p.useCallback((we={})=>{const{refreshAreas:He=!1,refreshCOR:Fe=!1,projectId:Xe=null}=we;He&&Xe&&(Re.current=Xe),Fe&&(qe.current=!0),ze.current&&clearTimeout(ze.current),ze.current=setTimeout(async()=>{Re.current&&(await jt(Re.current),Re.current=!1),qe.current&&(E(ht=>ht+1),qe.current=!1),await nt()},150)},[]);p.useEffect(()=>()=>{ze.current&&clearTimeout(ze.current)},[]),p.useEffect(()=>{if(r?.id){nt(),Ct();const we=g.map(Fe=>Fe.id),He=we.length>0?ee.subscribeToCompanyActivity?.(r.id,we,{onMessage:()=>Ie(),onMaterialRequest:()=>Ie(),onTMTicket:()=>Ie(),onInjuryReport:()=>Ie()}):null;return()=>{He&&ee.unsubscribe?.(He)}}},[r?.id,g.length,Ie]);const Ct=async()=>{try{const we=await ee.getDumpSites(r.id);y(we||[])}catch(we){console.error("Error loading dump sites:",we)}};p.useEffect(()=>{if(m&&g.length>0){const we=g.find(He=>He.id===m);we&&(R(we),u?.())}},[m,g]),p.useEffect(()=>{if(x){jt(x.id);const we=[],He=x.id,Fe=ee.subscribeToAreas?.(He,()=>{Ie({refreshAreas:!0,projectId:He})});Fe&&we.push(Fe);const Xe=ee.subscribeToDailyReports?.(He,()=>{Ie()});Xe&&we.push(Xe);const ht=ee.subscribeToCrewCheckins?.(He,()=>{Ie()});ht&&we.push(ht);const ft=ee.subscribeToHaulOffs?.(He,()=>{Ie()});ft&&we.push(ft);const it=ee.subscribeToCORs?.(He,()=>{Ie({refreshCOR:!0})});return it&&we.push(it),()=>{we.forEach(wt=>ee.unsubscribe?.(wt))}}},[x,Ie]);const nt=async()=>{try{const we=await ee.getProjects(r?.id);f(we);const He=await Promise.all(we.map(async Fe=>{try{const[Xe,ht,ft,it,wt,Ke,rt,Vt,da,ba]=await Promise.all([ee.getAreas(Fe.id).catch(()=>[]),ee.getTMTickets(Fe.id).catch(()=>[]),ee.getChangeOrderTotals(Fe.id).catch(()=>null),ee.getDailyReports(Fe.id,100).catch(()=>[]),ee.getInjuryReports(Fe.id).catch(()=>[]),ee.getMaterialRequests(Fe.id).catch(()=>[]),ee.calculateManDayCosts(Fe.id,r?.id,Fe.work_type||"demolition",Fe.job_type||"standard").catch(()=>null),ee.calculateHaulOffCosts(Fe.id).catch(()=>null),ee.getProjectCosts(Fe.id).catch(()=>[]),ee.getCORStats(Fe.id).catch(()=>null)]),Ae=Rp(Xe),lt=Ae.progress,na=ft?.totalApprovedValue||0,_a=Fe.contract_value+na,N=Ae.isValueBased?Ae.earnedValue:lt/100*_a,ae=ht.filter(It=>It.status==="pending").length,xe=new Date;xe.setDate(xe.getDate()-7);const me=it.filter(It=>new Date(It.report_date)>=xe).length,Oe=da.reduce((It,bl)=>{const _l=parseFloat(bl.amount);return It+(isNaN(_l)?0:_l)},0),Je=rt?.totalCost||0,Be=Vt?.totalCost||0,st=Je+Be+Oe,Mt=N-st,fn=N>0?Mt/N*100:0,Ra=rt?.byDate?.length||0,as=Vt?.daysWithHaulOff||0,Sa=Math.max(Ra,as),gn=Je+Be,$n=Sa>0?gn/Sa:0,ma=Qv({...Fe,progress:lt},rt?.totalManDays||0);return{...Fe,areas:Xe,progress:lt,billable:N,changeOrderValue:na,revisedContractValue:_a,changeOrderPending:ft?.pendingCount||0,totalTickets:ht.length,pendingTickets:ae,approvedTickets:ht.filter(It=>It.status==="approved").length,dailyReportsCount:it.length,recentDailyReports:me,injuryReportsCount:wt.length,lastDailyReport:it[0]?.report_date||null,pendingMaterialRequests:Ke.filter(It=>It.status==="pending").length,totalMaterialRequests:Ke.length,isValueBased:Ae.isValueBased,earnedValue:Ae.earnedValue,totalSOVValue:Ae.totalValue,laborCost:Je,laborDaysWorked:Ra,laborManDays:rt?.totalManDays||0,laborByDate:rt?.byDate||[],dailyBurn:$n,haulOffCost:Be,haulOffLoads:Vt?.totalLoads||0,haulOffDays:as,haulOffByType:Vt?.byWasteType||{},haulOffByDate:Vt?.byDate||[],customCosts:da,customCostTotal:Oe,totalBurn:gn,totalBurnDays:Sa,allCostsTotal:st,currentProfit:Mt,profitMargin:fn,corPendingValue:ba?.total_pending_value||0,corPendingCount:ba?.pending_count||0,corApprovedValue:ba?.total_approved_value||0,corBilledValue:ba?.total_billed_value||0,corTotalCount:ba?.total_cors||0,scheduleStatus:ma.scheduleStatus,scheduleVariance:ma.scheduleVariance,scheduleLabel:ma.scheduleLabel,laborStatus:ma.laborStatus,laborVariance:ma.laborVariance,laborLabel:ma.laborLabel,hasScheduleData:ma.hasScheduleData,hasLaborData:ma.hasLaborData,actualManDays:rt?.totalManDays||0,hasError:!1}}catch(Xe){return console.error(`Error loading data for project ${Fe.id}:`,Xe),{...Fe,areas:[],progress:0,billable:0,changeOrderValue:0,revisedContractValue:Fe.contract_value,changeOrderPending:0,totalTickets:0,pendingTickets:0,approvedTickets:0,dailyReportsCount:0,recentDailyReports:0,injuryReportsCount:0,lastDailyReport:null,pendingMaterialRequests:0,totalMaterialRequests:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corTotalCount:0,hasError:!0}}}));v(He)}catch(we){console.error("Error loading projects:",we),i("Error loading projects","error")}finally{B(!1)}},jt=async we=>{try{const He=await ee.getAreas(we);q(He)}catch(He){console.error("Error loading areas:",He)}},Ht=we=>{R(we)},pt=()=>{R(null),q([]),re(!1),T(null),D("overview"),nt()},at=()=>{T({name:x.name,job_number:x.job_number||"",address:x.address||"",general_contractor:x.general_contractor||"",client_contact:x.client_contact||"",client_phone:x.client_phone||"",contract_value:x.contract_value,work_type:x.work_type||"demolition",job_type:x.job_type||"standard",pin:x.pin||"",default_dump_site_id:x.default_dump_site_id||"",areas:A.map(we=>({id:we.id,name:we.name,weight:we.weight,isNew:!1}))}),re(!0)},va=()=>{re(!1),T(null)},_e=(we,He)=>{T(Fe=>({...Fe,[we]:He}))},Ze=(we,He,Fe)=>{T(Xe=>({...Xe,areas:Xe.areas.map((ht,ft)=>ft===we?{...ht,[He]:Fe}:ht)}))},Ge=()=>{T(we=>({...we,areas:[...we.areas,{id:null,name:"",weight:"",isNew:!0}]}))},Le=we=>{w.areas.length>1&&T(He=>({...He,areas:He.areas.filter((Fe,Xe)=>Xe!==we)}))},Ve=async()=>{if(!w.name.trim()){i("Please enter a project name","error");return}const we=parseFloat(w.contract_value);if(!we||we<=0){i("Please enter a valid contract value","error");return}if(w.pin&&w.pin.length!==4){i("PIN must be 4 digits","error");return}if(w.pin&&w.pin!==x.pin&&!await ee.isPinAvailable(w.pin,x.id)){i("This PIN is already in use","error");return}const He=w.areas.filter(Xe=>Xe.name.trim()&&parseFloat(Xe.weight)>0);if(He.length===0){i("Please add at least one area","error");return}if(He.reduce((Xe,ht)=>Xe+parseFloat(ht.weight),0)!==100){i("Area weights must total 100%","error");return}W(!0);try{await ee.updateProject(x.id,{name:w.name.trim(),job_number:w.job_number?.trim()||null,address:w.address?.trim()||null,general_contractor:w.general_contractor?.trim()||null,client_contact:w.client_contact?.trim()||null,client_phone:w.client_phone?.trim()||null,contract_value:we,work_type:w.work_type||"demolition",job_type:w.job_type||"standard",pin:w.pin||null,default_dump_site_id:w.default_dump_site_id||null});const Xe=A.map(it=>it.id),ht=w.areas.filter(it=>it.id).map(it=>it.id);for(const it of Xe)ht.includes(it)||await ee.deleteArea(it);for(let it=0;it<He.length;it++){const wt=He[it];wt.id?await ee.updateArea(wt.id,{name:wt.name.trim(),weight:parseFloat(wt.weight),sort_order:it}):await ee.createArea({project_id:x.id,name:wt.name.trim(),weight:parseFloat(wt.weight),status:"not_started",sort_order:it})}const ft=await ee.getProject(x.id);R(ft),await jt(x.id),re(!1),T(null),i("Project updated!","success")}catch(Xe){console.error("Error saving project:",Xe?.message||Xe),i(Xe?.message||"Error saving changes","error")}finally{W(!1)}},Ye=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await ee.deleteProject(x.id),i("Project deleted","success"),pt()}catch(we){console.error("Error deleting project:",we),i("Error deleting project","error")}},je=p.useMemo(()=>x?j.find(we=>we.id===x.id):null,[x,j]),dt=p.useMemo(()=>{if(!x)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const we=Rp(A),He=we.progress,Fe=je?.changeOrderValue||0,Xe=x.contract_value+Fe,ht=we.isValueBased?we.earnedValue:He/100*Xe;return{progress:He,billable:ht,changeOrderValue:Fe,revisedContractValue:Xe,isValueBased:we.isValueBased,earnedValue:we.earnedValue,totalSOVValue:we.totalValue}},[x,A,je]),vt=p.useMemo(()=>{const we=j.reduce((Ke,rt)=>Ke+(rt.contract_value||0),0),He=j.reduce((Ke,rt)=>Ke+(rt.changeOrderValue||0),0),Fe=we+He,Xe=j.reduce((Ke,rt)=>Ke+(rt.billable||0),0),ht=Fe-Xe,ft=Fe>0?Math.round(Xe/Fe*100):0,it=j.reduce((Ke,rt)=>Ke+(rt.corPendingValue||0),0),wt=j.reduce((Ke,rt)=>Ke+(rt.corPendingCount||0),0);return{totalOriginalContract:we,totalChangeOrders:He,totalPortfolioValue:Fe,totalEarned:Xe,totalRemaining:ht,weightedCompletion:ft,totalPendingCORValue:it,totalPendingCORCount:wt}},[j]),ct=p.useMemo(()=>{let we=0,He=0,Fe=0,Xe=0,ht=0;for(const ft of j){const it=ft.revisedContractValue||ft.contract_value;ft.progress>=100&&we++,ft.progress<100&&ft.billable<=it*(ft.progress/100)*1.1&&He++,ft.billable>it*.9&&ft.progress<90&&Fe++,ft.billable>it&&Xe++,(ft.changeOrderValue||0)>0&&ht++}return{projectsComplete:we,projectsOnTrack:He,projectsAtRisk:Fe,projectsOverBudget:Xe,projectsWithChangeOrders:ht}},[j]),Pt=p.useMemo(()=>{let we=0,He=0,Fe=0,Xe=0,ht=0,ft=0;for(const it of j)it.hasScheduleData&&(it.scheduleStatus==="ahead"?we++:it.scheduleStatus==="behind"?Fe++:He++),it.hasLaborData&&(it.laborStatus==="over"?Xe++:it.laborStatus==="under"?ht++:ft++);return{scheduleAhead:we,scheduleOnTrack:He,scheduleBehind:Fe,laborOver:Xe,laborUnder:ht,laborOnTrack:ft,hasAnyScheduleData:we+He+Fe>0,hasAnyLaborData:Xe+ht+ft>0}},[j]);p.useEffect(()=>{const we=async()=>{for(const He of j)if(Xv(He,30)){console.log(`Auto-archiving completed project: ${He.name}`);try{await ee.archiveProject(He.id),i(`Project "${He.name}" has been auto-archived after 30 days of completion`,"info")}catch(Fe){console.error("Failed to auto-archive project:",Fe)}}};j.length>0&&we()},[]);const{totalOriginalContract:De,totalChangeOrders:Z,totalPortfolioValue:H,totalEarned:Ee,totalRemaining:Se,weightedCompletion:Ne,totalPendingCORValue:ke,totalPendingCORCount:se}=vt,{projectsComplete:ye,projectsOnTrack:pe,projectsAtRisk:et,projectsOverBudget:mt,projectsWithChangeOrders:Xt}=ct,{scheduleAhead:At,scheduleOnTrack:$t,scheduleBehind:sa,laborOver:Kt,laborUnder:be,laborOnTrack:Dt,hasAnyScheduleData:St,hasAnyLaborData:ts}=Pt;if(F)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(x){const{progress:we,billable:He,changeOrderValue:Fe,revisedContractValue:Xe,isValueBased:ht,earnedValue:ft,totalSOVValue:it}=dt;if(I&&w){const Ae=w.areas.reduce((lt,na)=>lt+(parseFloat(na.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:va,style:{marginBottom:"1.5rem"},children:" Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:w.name,onChange:lt=>_e("name",lt.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:w.job_number,onChange:lt=>_e("job_number",lt.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:w.address,onChange:lt=>_e("address",lt.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:w.general_contractor,onChange:lt=>_e("general_contractor",lt.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:w.client_contact,onChange:lt=>_e("client_contact",lt.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:w.client_phone,onChange:lt=>_e("client_phone",lt.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:w.contract_value,onChange:lt=>_e("contract_value",lt.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:w.pin,onChange:lt=>_e("pin",lt.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:w.work_type,onChange:lt=>_e("work_type",lt.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:w.job_type,onChange:lt=>_e("job_type",lt.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:w.default_dump_site_id,onChange:lt=>_e("default_dump_site_id",lt.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),_.map(lt=>e.jsx("option",{value:lt.id,children:lt.name},lt.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),w.areas.map((lt,na)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:lt.name,onChange:_a=>Ze(na,"name",_a.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:lt.weight,onChange:_a=>Ze(na,"weight",_a.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>Le(na),children:""})]},na)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Ae===100?"valid":"invalid"}`,children:[Ae,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:Ge,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:Ve,disabled:C,style:{flex:1},children:C?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:Ye,children:"Delete Project"})]})}const wt=A.filter(Ae=>Ae.status==="done").length,Ke=A.filter(Ae=>Ae.status==="working").length,rt=A.filter(Ae=>Ae.status==="not_started").length,Vt=Xe>0?Math.round(He/Xe*100):0,da=Fe>0,ba=[{id:"overview",label:"Overview",Icon:Mp},{id:"financials",label:"Financials",Icon:Sr},{id:"reports",label:"Reports",Icon:Ja},{id:"activity",label:"Activity",Icon:Rs},{id:"info",label:"Info",Icon:_d}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:pt,children:[e.jsx("span",{children:""}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>O(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>Y(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:at,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:x.name}),(x.job_number||x.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[x.job_number&&`Job #${x.job_number}`,x.job_number&&x.work_type&&"  ",x.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[we,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:Ft(He)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:Ft(Xe-He)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:ba.map(Ae=>e.jsxs("button",{className:`pv-tab ${J===Ae.id?"active":""}`,onClick:()=>D(Ae.id),children:[e.jsx(Ae.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:Ae.label})]},Ae.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[J==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab",children:[e.jsx("div",{className:"overview-hero",children:e.jsxs("div",{className:"overview-hero-grid",children:[e.jsxs("div",{className:"overview-metric primary",children:[e.jsxs("div",{className:"overview-metric-value",children:[we,"%"]}),e.jsx("div",{className:"overview-metric-label",children:"Complete"}),e.jsx("div",{className:"overview-metric-bar",children:e.jsx("div",{className:"overview-metric-fill",style:{width:`${we}%`}})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsxs("div",{className:"overview-metric-value",children:[wt,"/",A.length]}),e.jsx("div",{className:"overview-metric-label",children:"Areas Done"}),e.jsx("div",{className:"overview-metric-detail",children:Ke>0&&e.jsxs("span",{className:"working",children:[Ke," active"]})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value",children:Ft(Xe)}),e.jsx("div",{className:"overview-metric-label",children:"Contract"}),da&&e.jsxs("div",{className:"overview-metric-detail green",children:["+",Ft(Fe)," COs"]})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value green",children:Ft(He)}),e.jsx("div",{className:"overview-metric-label",children:"Earned"}),e.jsx("div",{className:"overview-metric-detail",children:ht?e.jsxs("span",{children:["of ",Ft(it)," SOV"]}):e.jsxs("span",{children:[Vt,"% billed"]})})]})]})}),(je?.pendingTickets>0||je?.pendingMaterialRequests>0||je?.changeOrderPending>0)&&e.jsxs("div",{className:"overview-attention-card",children:[e.jsxs("div",{className:"attention-header",children:[e.jsx("h3",{children:"Needs Attention"}),e.jsxs("span",{className:"attention-count",children:[(je?.pendingTickets||0)+(je?.pendingMaterialRequests||0)+(je?.changeOrderPending||0)," items"]})]}),e.jsxs("div",{className:"attention-items",children:[je?.pendingTickets>0&&e.jsxs("div",{className:"attention-item",onClick:()=>D("financials"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(Ja,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[je.pendingTickets," T&M ticket",je.pendingTickets!==1?"s":""," awaiting approval"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]}),je?.changeOrderPending>0&&e.jsxs("div",{className:"attention-item",onClick:()=>D("financials"),children:[e.jsx("div",{className:"attention-item-icon info",children:e.jsx(Aa,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[je.changeOrderPending," change order",je.changeOrderPending!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]}),je?.pendingMaterialRequests>0&&e.jsxs("div",{className:"attention-item",onClick:()=>D("activity"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(Rs,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[je.pendingMaterialRequests," material request",je.pendingMaterialRequests!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Activity"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]})]})]}),e.jsxs("div",{className:"overview-section-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[wt>0&&e.jsxs("span",{className:"section-badge done",children:[wt," Complete"]}),Ke>0&&e.jsxs("span",{className:"section-badge working",children:[Ke," Active"]}),rt>0&&e.jsxs("span",{className:"section-badge pending",children:[rt," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list",children:A.map(Ae=>e.jsxs("div",{className:`work-area-item ${Ae.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[Ae.status==="done"&&e.jsx("span",{className:"status-icon done",children:""}),Ae.status==="working"&&e.jsx("span",{className:"status-icon working",children:""}),Ae.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:""})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:Ae.name}),e.jsx("span",{className:"work-area-weight",children:Ae.scheduled_value?Ft(Ae.scheduled_value):`${Ae.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${Ae.status}`,style:{width:Ae.status==="done"?"100%":Ae.status==="working"?"50%":"0%"}})})]},Ae.id))})]}),e.jsxs("div",{className:"overview-stats-row",children:[e.jsxs("div",{className:"quick-stat-card",onClick:()=>D("reports"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(Ja,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:je?.dailyReportsCount||0}),e.jsx("span",{className:"quick-stat-label",children:"Daily Reports"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>D("financials"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(Sr,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:je?.totalTickets||0}),e.jsx("span",{className:"quick-stat-label",children:"T&M Tickets"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>D("activity"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(Rs,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:je?.totalMaterialRequests||0}),e.jsx("span",{className:"quick-stat-label",children:"Material Requests"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]})]})]}),J==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsx("div",{className:"financials-hero",children:e.jsxs("div",{className:"financials-hero-grid",children:[e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Contract"}),e.jsx("div",{className:"fin-metric-value",children:Ft(Xe)}),da&&e.jsxs("div",{className:"fin-metric-detail green",children:["+",Ft(Fe)," COs"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Earned"}),e.jsx("div",{className:"fin-metric-value",children:Ft(He)}),e.jsx("div",{className:"fin-metric-bar",children:e.jsx("div",{className:"fin-metric-fill",style:{width:`${Vt}%`}})})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Costs"}),e.jsx("div",{className:"fin-metric-value",children:Ft(je?.allCostsTotal||0)}),He>0&&e.jsxs("div",{className:`fin-metric-detail ${(je?.allCostsTotal||0)/He>.6?"warning":""}`,children:[Math.round((je?.allCostsTotal||0)/He*100),"% of revenue"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Profit"}),e.jsx("div",{className:`fin-metric-value ${(je?.currentProfit||0)<0?"negative":"positive"}`,children:Ft(je?.currentProfit||0)}),e.jsxs("div",{className:`fin-metric-detail ${(je?.profitMargin||0)<20?"warning":""}`,children:[Math.round(je?.profitMargin||0),"% margin"]})]})]})}),e.jsxs("div",{className:"financials-analysis-row",children:[e.jsx(Cy,{dailyBurn:je?.dailyBurn||0,totalBurn:je?.totalBurn||0,daysWorked:je?.totalBurnDays||0,laborCost:je?.laborCost||0,haulOffCost:je?.haulOffCost||0,progress:we,contractValue:Xe,laborByDate:je?.laborByDate||[],haulOffByDate:je?.haulOffByDate||[]}),e.jsx(Ey,{revenue:He,totalCosts:je?.allCostsTotal||0,contractValue:Xe,progress:we}),e.jsx(My,{project:x,period:"week"})]}),e.jsx(ky,{laborCost:je?.laborCost||0,haulOffCost:je?.haulOffCost||0,customCosts:je?.customCosts||[],onAddCost:()=>Me(!0),onDeleteCost:async Ae=>{try{await ee.deleteProjectCost(Ae),nt(),i("Cost deleted","success")}catch{i("Error deleting cost","error")}}}),e.jsxs("div",{className:"financials-pipeline",children:[e.jsxs("div",{className:"pipeline-header",children:[e.jsx("h2",{children:"Extra Work"}),e.jsxs("div",{className:"pipeline-flow",children:[e.jsx("span",{className:"pipeline-step",children:"T&M Tickets"}),e.jsx("span",{className:"pipeline-arrow",children:""}),e.jsx("span",{className:"pipeline-step active",children:"Change Orders"})]})]}),e.jsxs("div",{className:"pipeline-content",children:[e.jsxs("div",{className:"pipeline-section",children:[e.jsxs("div",{className:"pipeline-section-header",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("span",{className:"pipeline-badge",children:[je?.totalTickets||0," total",je?.pendingTickets>0&&`  ${je.pendingTickets} pending`]})]}),e.jsx(iy,{project:x,company:r,onShowToast:i})]}),e.jsx("div",{className:"pipeline-section",children:e.jsx(vy,{project:x,company:r,areas:A,refreshKey:$,onShowToast:i,onCreateCOR:()=>{ie(null),K(!0)},onViewCOR:Ae=>{P(Ae),G(!0)},onEditCOR:Ae=>{ie(Ae),K(!0)}})})]})]}),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(oa,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:Ft(je?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(gy,{project:x,company:r,onShowToast:i})})]})]}),J==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(Ja,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:je?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:je?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((je?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:`reports-metric ${(je?.injuryReportsCount||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"reports-metric-value",children:je?.injuryReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Injuries"}),e.jsx("div",{className:"reports-metric-status",children:(je?.injuryReportsCount||0)===0?"No incidents":"Review required"})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value small",children:je?.lastDailyReport?new Date(je.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"None"}),e.jsx("div",{className:"reports-metric-label",children:"Last Filed"}),je?.lastDailyReport&&e.jsxs("div",{className:"reports-metric-detail",children:[Math.floor((new Date-new Date(je.lastDailyReport))/(1e3*60*60*24))," days ago"]})]})]})}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(Ja,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[je?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(py,{project:x,company:r,onShowToast:i})})]}),e.jsxs("div",{className:`reports-section-card ${(je?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(je?.injuryReportsCount||0)>0?"warning":"success"}`,children:(je?.injuryReportsCount||0)>0?"":""}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(je?.injuryReportsCount||0)>0?"warning":"success"}`,children:(je?.injuryReportsCount||0)>0?`${je.injuryReportsCount} incident${je.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(dy,{project:x,companyId:r?.id||x?.company_id,company:r,onShowToast:i})})]})]}),J==="activity"&&e.jsxs("div",{className:"pv-tab-panel activity-tab",children:[e.jsx("div",{className:"activity-hero",children:e.jsxs("div",{className:"activity-hero-grid",children:[e.jsxs("div",{className:`activity-metric ${(je?.pendingMaterialRequests||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"activity-metric-icon",children:(je?.pendingMaterialRequests||0)>0?"!":""}),e.jsxs("div",{className:"activity-metric-content",children:[e.jsx("div",{className:"activity-metric-value",children:je?.pendingMaterialRequests||0}),e.jsx("div",{className:"activity-metric-label",children:"Pending"})]})]}),e.jsxs("div",{className:"activity-metric",children:[e.jsx("div",{className:"activity-metric-value",children:je?.totalMaterialRequests||0}),e.jsx("div",{className:"activity-metric-label",children:"Total Requests"})]}),e.jsxs("div",{className:"activity-metric",children:[e.jsxs("div",{className:"activity-metric-value",children:[je?.totalMaterialRequests>0?Math.round((je.totalMaterialRequests-(je.pendingMaterialRequests||0))/je.totalMaterialRequests*100):100,"%"]}),e.jsx("div",{className:"activity-metric-label",children:"Fulfilled"}),e.jsx("div",{className:"activity-metric-bar",children:e.jsx("div",{className:"activity-metric-fill",style:{width:`${je?.totalMaterialRequests>0?(je.totalMaterialRequests-(je.pendingMaterialRequests||0))/je.totalMaterialRequests*100:100}%`}})})]}),e.jsxs("div",{className:"activity-metric status",children:[e.jsx("div",{className:"activity-metric-status-icon",children:e.jsx(Rs,{size:20})}),e.jsx("div",{className:"activity-metric-label",children:"Messages Active"})]})]})}),(je?.pendingMaterialRequests||0)>0&&e.jsxs("div",{className:"activity-attention-banner",children:[e.jsx("span",{className:"attention-icon",children:"!"}),e.jsxs("span",{className:"attention-text",children:[je.pendingMaterialRequests," material request",je.pendingMaterialRequests!==1?"s":""," awaiting response"]})]}),e.jsxs("div",{className:`activity-section-card ${(je?.pendingMaterialRequests||0)>0?"has-pending":""}`,children:[e.jsxs("div",{className:"activity-section-header",children:[e.jsxs("div",{className:"activity-section-title",children:[e.jsx(oa,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("div",{className:"activity-section-badges",children:[(je?.pendingMaterialRequests||0)>0&&e.jsxs("span",{className:"activity-badge pending",children:[je.pendingMaterialRequests," pending"]}),e.jsxs("span",{className:"activity-badge total",children:[je?.totalMaterialRequests||0," total"]})]})]}),e.jsx("div",{className:"activity-section-content",children:e.jsx(my,{project:x,company:r,onShowToast:i})})]}),e.jsxs("div",{className:"activity-section-card messages",children:[e.jsx("div",{className:"activity-section-header",children:e.jsxs("div",{className:"activity-section-title",children:[e.jsx(Rs,{size:18}),e.jsx("h3",{children:"Project Messages"})]})}),e.jsx("div",{className:"activity-section-content",children:e.jsx(fy,{project:x,company:r,userName:r?.name||"Office",onShowToast:i})})]})]}),J==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:x.name}),x.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",x.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:at,children:e.jsx("span",{children:"Edit Project"})})]}),x.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(Zj,{size:14}),e.jsx("span",{children:x.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(oa,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:x.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Aa,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:x.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Sr,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:Ft(Xe)}),e.jsx("span",{className:"info-quick-label",children:Fe>0?`Incl. +${Ft(Fe)} COs`:"Contract Value"})]})]}),x.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:x.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Hi,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[x.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:x.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),x.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:x.client_contact})]}),x.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(dv,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${x.client_phone}`,className:"info-detail-value link",children:x.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Mp,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[wt>0&&e.jsxs("span",{className:"info-badge done",children:[wt," Done"]}),Ke>0&&e.jsxs("span",{className:"info-badge working",children:[Ke," Active"]}),rt>0&&e.jsxs("span",{className:"info-badge pending",children:[rt," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:A.map(Ae=>e.jsxs("div",{className:`info-area-item ${Ae.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[Ae.status==="done"&&e.jsx("span",{className:"status-dot done",children:""}),Ae.status==="working"&&e.jsx("span",{className:"status-dot working",children:""}),Ae.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:""})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:Ae.name}),e.jsx("span",{className:`info-area-status-label ${Ae.status}`,children:Ae.status==="done"?"Complete":Ae.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[Ae.weight,"%"]})]},Ae.id))})]}),e.jsx(Ry,{project:x,company:r,user:l,isAdmin:c,onShowToast:i}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(_d,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:Ft(x.contract_value)})]}),Fe>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",Ft(Fe)]})]}),x.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:_.find(Ae=>Ae.id===x.default_dump_site_id)?.name||"Unknown"})]})]})]})]})]}),le&&e.jsx(cy,{project:x,onClose:()=>O(!1),onShareCreated:Ae=>{i("Share link created successfully!","success")}}),U&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(uy,{project:x,company:r,onShowToast:i,onClose:()=>Y(!1)})}),S&&e.jsx(by,{project:x,company:r,areas:A,existingCOR:k,onClose:()=>{K(!1),ie(null)},onSaved:()=>{K(!1),ie(null),E(Ae=>Ae+1)},onShowToast:i}),M&&L&&e.jsx(Sy,{cor:L,project:x,company:r,areas:A,onClose:()=>{G(!1),P(null)},onEdit:Ae=>{G(!1),P(null),ie(Ae),K(!0)},onShowToast:i,onStatusChange:()=>{}}),ue&&e.jsx(Ay,{onClose:()=>Me(!1),saving:Te,onSave:async Ae=>{try{te(!0),await ee.addProjectCost(x.id,r.id,Ae),Me(!1),nt(),i("Cost added successfully","success")}catch(lt){console.error("Error adding cost:",lt),i("Error adding cost","error")}finally{te(!1)}}})]})}return g.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Ja,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("div",{className:"bo-project-count",children:[g.length," Active Project",g.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(Ne,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Ft(Ee)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Ft(H)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:Ft(Se)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Z>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:Ft(De)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",Xt," project",Xt!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",Ft(Z)]})]})]}),se>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:Ft(ke)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",se," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[ye>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:ye}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),pe>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:pe}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),et>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:et}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),mt>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:mt}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),St&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[At>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:At}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),$t>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:$t}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),sa>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:sa}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),ts&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),be>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[be," under"]}),Dt>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[Dt," on track"]}),Kt>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[Kt," over"]})]})]})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[g.length," active"]})]}),e.jsx("div",{className:"project-list",children:j.map(we=>e.jsx(qy,{project:we,onClick:()=>Ht(we)},we.id))})]})}function qy({project:r,onClick:l}){const c=gf(r.areas||[]),i=Pv(r.areas||[]),m=r.contract_value-r.billable,u=r.billable>r.contract_value*.9&&r.progress<90;return e.jsxs("div",{className:`project-card enhanced ${u?"at-risk":""}`,onClick:l,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:r.name}),e.jsx("div",{className:"project-card-value",children:Ft(r.contract_value)})]}),e.jsx("span",{className:`status-badge ${c}`,children:i})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[r.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:Ft(r.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${m<0?"negative":""}`,children:Ft(Math.abs(m))}),e.jsx("span",{className:"stat-label",children:m>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${r.progress}%`}})}),(r.pendingTickets>0||r.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[r.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[r.pendingTickets," Pending T&M"]}),r.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[r.approvedTickets," Approved T&M"]})]}),r.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${r.scheduleStatus}`,children:r.scheduleLabel}),r.hasLaborData&&r.laborLabel&&e.jsx("span",{className:`labor-indicator ${r.laborStatus}`,children:r.laborLabel})]})]})}const hd=r=>{if(r==null||r==="")return"";const l=parseFloat(r);return isNaN(l)?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)},Vp=r=>{if(!r)return null;const l=String(r).replace(/[$,\s]/g,""),c=parseFloat(l);return isNaN(c)?null:c};function Oy({company:r,user:l,onProjectCreated:c,onShowToast:i}){const[m,u]=p.useState(""),[g,f]=p.useState(""),[j,v]=p.useState(""),[x,R]=p.useState(""),[A,q]=p.useState(""),[F,B]=p.useState(""),[I,re]=p.useState("demolition"),[w,T]=p.useState("standard"),[C,W]=p.useState([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),[le,O]=p.useState(!1),[U,Y]=p.useState(!1),[J,D]=p.useState(!1),[_,y]=p.useState([]),[S,K]=p.useState(!1),[k,ie]=p.useState(""),[M,G]=p.useState(""),[L,P]=p.useState(""),$=p.useRef(null),E=C.reduce((_e,Ze)=>_e+(parseFloat(Ze.weight)||0),0),ue=_e=>{const Ze=_e.replace(/\D/g,"").slice(0,4);B(Ze)},Me=()=>{const _e=Math.floor(1e3+Math.random()*9e3).toString();B(_e)},Te=(_e,Ze,Ge)=>{W(Le=>Le.map((Ve,Ye)=>Ye===_e?{...Ve,[Ze]:Ge}:Ve))},te=()=>{W(_e=>[..._e,{name:"",weight:"",group:"",scheduledValue:null}])},ze=_e=>{C.length>1&&W(Ze=>Ze.filter((Ge,Le)=>Le!==_e))},Re=(_e="value")=>{const Ze=C.filter(je=>je.name.trim());if(Ze.length===0){i("Add tasks first","error");return}let Ge=[...C];const Le=C.map((je,dt)=>je.name.trim()?dt:-1).filter(je=>je>=0);if(_e==="value"){const je=Ze.reduce((dt,vt)=>dt+(parseFloat(vt.scheduledValue)||0),0);if(je===0)i("No scheduled values - using equal distribution","info"),_e="equal";else{let dt=0;Le.forEach((vt,ct)=>{const Pt=parseFloat(C[vt].scheduledValue)||0;let De;ct===Le.length-1?De=100-dt:(De=Math.round(Pt/je*1e4)/100,dt+=De),Ge[vt]={...Ge[vt],weight:De.toFixed(2)}}),W(Ge),K(!1),i("Weights calculated by value","success");return}}const Ve=Math.round(100/Le.length*100)/100;let Ye=0;Le.forEach((je,dt)=>{let vt;dt===Le.length-1?vt=100-Ye:(vt=Ve,Ye+=vt),Ge[je]={...Ge[je],weight:vt.toFixed(2)}}),W(Ge),K(!1),i("Weights distributed equally","success")},qe=()=>{u(""),f(""),v(""),R(""),q(""),B(""),re("demolition"),T("standard"),ie(""),G(""),P(""),W([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),D(!1),y([])},Ie=()=>{$.current?.click()},Ct=_e=>new Promise((Ze,Ge)=>{const Le=new FileReader;Le.onload=Ve=>{try{const Ye=new Uint8Array(Ve.target.result),je=Tx(Ye,{type:"array"}),dt=je.SheetNames[0],vt=je.Sheets[dt],ct=on.sheet_to_json(vt,{header:1}),Pt=[];let De="General";const Z=/^\$?\d{1,3}(,\d{3})*(\.\d{2})?$/,H=/^(\d+\.?\d*|[A-Z]\.?\d*)$/i,Ee=/^(SF|LF|EA|LS|Days?|MD|Load|CY|SY|GAL|TON)$/i,Se=/^\d{1,3}(,\d{3})*$|^\d+$/,Ne=/^(Item|#|No\.?|Description|Scheduled|Value|Amount|Quantity|Unit|Total|Application|Balance|Completed|Stored|Retainage)/i;for(const ye of ct){if(!ye||ye.length===0)continue;const pe=ye.map(Dt=>Dt==null?"":String(Dt).trim()).filter(Dt=>Dt.length>0);if(pe.length===0)continue;const et=pe.join(" ");if(Ne.test(pe[0])||pe.length>1&&Ne.test(pe[1])||/^(Total|Subtotal|Grand Total|Base Bid|Contract Sum)/i.test(et))continue;const mt=pe.some(Dt=>Z.test(Dt.replace(/[$,]/g,"")+(Dt.includes(".")?"":".00")));if((!mt&&pe.length<=3&&/^(L\d|Level|Floor|\d+(?:st|nd|rd|th)|Plaza|Street|Basement|Roof|Penthouse|Site|Exterior|Interior|Misc|MEP|ABATEMENT|DEMOLITION|UNIVERSAL|SOFT|TRASH|DEMO|Phase|Division|Section|Area|Building|Wing)/i.test(pe[0])||pe.length===2&&H.test(pe[0])&&!mt&&!/^\d+\.\d+$/.test(pe[0]))&&!mt){De=(pe.find(St=>!H.test(St)&&St.length>1)||pe.join(" ")).replace(/\s*\(\d{1,3}(?:,\d{3})*\s*SF\)\s*$/i,"").replace(/\s*[-:]\s*$/,"").trim();continue}let At="",$t=!1,sa="",Kt=null;const be=[];for(let Dt=0;Dt<pe.length;Dt++){const St=pe[Dt];if(Dt===0&&H.test(St)){sa=St;continue}if(!/^ID-\d+$/i.test(St)&&!/^KN\s*\d+$/i.test(St)){if(Z.test(St.replace(/[$,]/g,"")+(St.includes(".")?"":".00"))||/^\$/.test(St)){const ts=St.replace(/[$,]/g,""),we=parseFloat(ts);!isNaN(we)&&we>100&&(Kt===null||we>Kt)&&(Kt=we),$t=!0;continue}if(Se.test(St.replace(/,/g,""))){$t=!0;continue}Ee.test(St)||/^\d+\.?\d*%$/.test(St)||St.length>1&&!H.test(St)&&be.push(St)}}At=be.join(" ").trim(),At=At.replace(/\s+/g," ").replace(/^[-]\s*/,"").trim(),!(At.length<3)&&(/^(Plan|Page|Total|Base Bid|Payment|Condition|Exclusion|Subtotal)/i.test(At)||$t&&At.length>=3&&Pt.push({name:At,group:De,itemNumber:sa,scheduledValue:Kt,selected:!0}))}const ke=new Set,se=Pt.filter(ye=>{const pe=`${ye.group}:${ye.name}`;return ke.has(pe)?!1:(ke.add(pe),!0)});Ze(se)}catch(Ye){Ge(Ye)}},Le.onerror=()=>Ge(new Error("Failed to read file")),Le.readAsArrayBuffer(_e)}),nt=async _e=>{const Ze=_e.target.files?.[0];if(!Ze)return;const Ge=Ze.name.split(".").pop().toLowerCase();if(!["xlsx","xls","csv"].includes(Ge)){i("Please upload an Excel file (.xlsx, .xls, or .csv)","error");return}Y(!0);try{const Le=await Ct(Ze);if(Le.length===0){i("No tasks found. Check Excel format.","error"),Y(!1);return}y(Le),D(!0),i(`Found ${Le.length} tasks`,"success")}catch(Le){console.error("Excel import error:",Le),i("Error reading Excel file","error")}finally{Y(!1),$.current&&($.current.value="")}},jt=_e=>{y(Ze=>Ze.map((Ge,Le)=>Le===_e?{...Ge,selected:!Ge.selected}:Ge))},Ht=()=>{const _e=_.filter(Ve=>Ve.selected);if(_e.length===0){i("Please select at least one task","error");return}const Ze=_e.reduce((Ve,Ye)=>Ve+(Ye.scheduledValue||0),0),Ge=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});let Le;if(Ze>0){let Ve=0;Le=_e.map((Ye,je)=>{const dt=Ye.scheduledValue||0;let vt;return je===_e.length-1?vt=100-Ve:(vt=Math.round(dt/Ze*1e4)/100,Ve+=vt),{name:Ye.name,weight:vt.toFixed(2),group:Ye.group,scheduledValue:Ye.scheduledValue||null}}),i(`Tasks imported with value-based weights! Total SOV: ${Ge.format(Ze)}`,"success")}else{const Ve=Math.round(100/_e.length*100)/100;Le=_e.map((Ye,je)=>({name:Ye.name,weight:je===_e.length-1?(100-Ve*(_e.length-1)).toFixed(2):Ve.toFixed(2),group:Ye.group,scheduledValue:Ye.scheduledValue||null})),i("Tasks imported with equal weights","success")}W(Le),D(!1)},pt=async()=>{if(!r?.id){i("No company selected. Please log in again.","error");return}if(!m.trim()){i("Please enter a project name","error");return}const _e=parseFloat(A);if(!_e||_e<=0){i("Please enter a valid contract value","error");return}if(F.length!==4){i("Please enter a 4-digit PIN","error");return}if(!await ee.isPinAvailable(F)){i("This PIN is already in use. Try another.","error");return}const Ge=C.filter(Le=>Le.name.trim()&&parseFloat(Le.weight)>0);if(Ge.length===0){i("Please add at least one area","error");return}if(Math.abs(E-100)>.1){i("Area weights must total 100%","error");return}if(!k||!M){i("Start date and end date are required","error");return}if(new Date(M)<new Date(k)){i("End date must be on or after start date","error");return}O(!0);try{const Le=await ee.createProject({name:m.trim(),job_number:g.trim()||null,address:j.trim()||null,general_contractor:x.trim()||null,contract_value:_e,pin:F,work_type:I,job_type:w,company_id:r?.id,created_by:l?.id,start_date:k,end_date:M,planned_man_days:L?parseInt(L):null});for(let Ve=0;Ve<Ge.length;Ve++)await ee.createArea({project_id:Le.id,name:Ge[Ve].name.trim(),weight:parseFloat(Ge[Ve].weight),scheduled_value:Ge[Ve].scheduledValue||null,group_name:Ge[Ve].group||null,status:"not_started",sort_order:Ve});i("Project created!","success"),qe(),c()}catch(Le){console.error("Error creating project:",Le),i("Error creating project","error")}finally{O(!1)}};if(J){const _e=[...new Set(_.map(Ve=>Ve.group))],Ze=_.filter(Ve=>Ve.selected).length,Ge=_.reduce((Ve,Ye)=>Ve+(Ye.scheduledValue||0),0),Le=_.filter(Ve=>Ve.selected).reduce((Ve,Ye)=>Ve+(Ye.scheduledValue||0),0);return e.jsxs("div",{children:[e.jsx("h1",{children:"Review Imported Tasks"}),e.jsx("p",{className:"subtitle",children:"Select the tasks to include in your project"}),e.jsxs("div",{className:"import-summary",children:[e.jsxs("span",{children:[Ze," of ",_.length," tasks selected"]}),Ge>0&&e.jsxs("span",{className:"import-sov-total",children:[" Total SOV: ",new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(Le)]})]}),_e.map(Ve=>{const Ye=_.filter(dt=>dt.group===Ve),je=Ye.filter(dt=>dt.selected).length;return e.jsxs("div",{className:"card import-group",children:[e.jsxs("div",{className:"import-group-header",children:[e.jsx("h3",{children:Ve}),e.jsxs("span",{className:"import-group-count",children:[je,"/",Ye.length]})]}),e.jsx("div",{className:"import-task-list",children:Ye.map(dt=>{const vt=_.indexOf(dt);return e.jsxs("label",{className:"import-task-item",children:[e.jsx("input",{type:"checkbox",checked:dt.selected,onChange:()=>jt(vt)}),e.jsx("span",{className:"import-task-name",children:dt.name}),dt.scheduledValue>0&&e.jsx("span",{className:"import-task-value",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(dt.scheduledValue)})]},vt)})})]},Ve)}),e.jsxs("div",{className:"import-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>D(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:Ht,children:["Use Selected Tasks (",Ze,")"]})]})]})}const at=C.reduce((_e,Ze,Ge)=>{const Le=Ze.group||"General";return _e[Le]||(_e[Le]=[]),_e[Le].push({...Ze,originalIndex:Ge}),_e},{}),va=Object.keys(at).length>1||Object.keys(at).length===1&&!at.General;return e.jsxs("div",{children:[e.jsx("h1",{children:"New Project"}),e.jsx("p",{className:"subtitle",children:"Set up a new project to track"}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Name"}),e.jsx("input",{type:"text",placeholder:"e.g., Sunrise Apartments",value:m,onChange:_e=>u(_e.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",placeholder:"e.g., 4032",value:g,onChange:_e=>f(_e.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($)"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"e.g., 365000",value:A,onChange:_e=>{const Ze=_e.target.value.replace(/[^0-9.]/g,"");q(Ze)},className:"currency-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",placeholder:"e.g., 123 Main St, Los Angeles, CA 90001",value:j,onChange:_e=>v(_e.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",placeholder:"e.g., ABC Construction Inc.",value:x,onChange:_e=>R(_e.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Start Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:k,onChange:_e=>ie(_e.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["End Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:M,onChange:_e=>G(_e.target.value),min:k||void 0,required:!0}),k&&M&&new Date(M)<new Date(k)&&e.jsx("span",{className:"error-text",children:"End date must be after start date"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Planned Man-Days ",e.jsx("span",{className:"optional",children:"(optional)"})]}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Total estimated man-days to complete the project"}),e.jsx("input",{type:"number",inputMode:"numeric",placeholder:"e.g., 120",value:L,onChange:_e=>P(_e.target.value.replace(/\D/g,"")),min:"1"})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${I==="demolition"?"active":""}`,onClick:()=>re("demolition"),children:"Demolition"}),e.jsx("button",{type:"button",className:`toggle-btn ${I==="abatement"?"active":""}`,onClick:()=>re("abatement"),children:"Abatement"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${w==="standard"?"active":""}`,onClick:()=>T("standard"),children:"Standard"}),e.jsx("button",{type:"button",className:`toggle-btn ${w==="pla"?"active":""}`,onClick:()=>T("pla"),children:"PLA"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN (4 digits)"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Foremen will enter this PIN to access this project"}),e.jsxs("div",{className:"pin-input-row",children:[e.jsx("input",{type:"text",placeholder:"e.g., 2847",value:F,onChange:_e=>ue(_e.target.value),maxLength:4,className:"pin-input"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Me,children:"Generate"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"areas-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Areas / Tasks"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginTop:"0.25rem"},children:"Define the areas for this project. Weights must total 100%."})]}),e.jsxs("div",{className:"import-btn-container",children:[e.jsx("input",{ref:$,type:"file",accept:".xlsx,.xls,.csv",onChange:nt,style:{display:"none"}}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Ie,disabled:U,children:U?"Reading...":" Import Excel"})]})]}),va?Object.entries(at).map(([_e,Ze])=>e.jsxs("div",{className:"area-group",children:[e.jsx("div",{className:"area-group-header",children:_e}),Ze.map(Ge=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Task name",value:Ge.name,onChange:Le=>Te(Ge.originalIndex,"name",Le.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:Ge.scheduledValue?hd(Ge.scheduledValue):"",onChange:Le=>Te(Ge.originalIndex,"scheduledValue",Vp(Le.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:Ge.weight,onChange:Le=>Te(Ge.originalIndex,"weight",Le.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>ze(Ge.originalIndex),children:""})]},Ge.originalIndex))]},_e)):C.map((_e,Ze)=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Area name (e.g., Level 1)",value:_e.name,onChange:Ge=>Te(Ze,"name",Ge.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:_e.scheduledValue?hd(_e.scheduledValue):"",onChange:Ge=>Te(Ze,"scheduledValue",Vp(Ge.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:_e.weight,onChange:Ge=>Te(Ze,"weight",Ge.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>ze(Ze),children:""})]},Ze)),e.jsxs("div",{className:"weight-total-row",children:[e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Math.abs(E-100)<.1?"valid":"invalid"}`,children:[E.toFixed(1),"%"]}),C.some(_e=>_e.scheduledValue>0)&&e.jsxs("span",{className:"sov-total",children:[" SOV: ",hd(C.reduce((_e,Ze)=>_e+(parseFloat(Ze.scheduledValue)||0),0))]})]}),e.jsxs("div",{className:"auto-weight-dropdown",children:[e.jsx("button",{type:"button",className:"btn btn-secondary btn-small",onClick:()=>K(!S),children:"Auto-Calculate "}),S&&e.jsxs("div",{className:"weight-dropdown-menu",children:[e.jsxs("button",{onClick:()=>Re("value"),children:["By Value ",e.jsx("span",{className:"dropdown-hint",children:"(Recommended)"})]}),e.jsx("button",{onClick:()=>Re("equal"),children:"Equal Distribution"})]})]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:te,children:"+ Add Area"})]}),e.jsx("button",{className:"btn btn-primary btn-full",onClick:pt,disabled:le,children:le?"Creating...":"Create Project"})]})}function Ly({company:r,onShowToast:l}){const{branding:c,updateBranding:i,uploadBrandingImage:m,loading:u}=wr(),[g,f]=p.useState(!1),[j,v]=p.useState(!1),[x,R]=p.useState(c),[A,q]=p.useState(""),[F,B]=p.useState(!1),I=p.useRef(null),re=p.useRef(null),w=p.useRef(null);p.useEffect(()=>{r?.id&&T()},[r?.id]);const T=async()=>{try{const{data:S,error:K}=await z.from("companies").select("office_code").eq("id",r.id).single();!K&&S?.office_code&&q(S.office_code)}catch(S){console.error("Error loading office code:",S)}},C=async()=>{if(confirm("Regenerate office code? Current code will stop working immediately.")){B(!0);try{const S=Math.random().toString(36).substring(2,8).toUpperCase(),{error:K}=await z.from("companies").update({office_code:S}).eq("id",r.id);if(K)throw K;q(S),l?.("Office code regenerated","success")}catch(S){console.error("Error regenerating code:",S),l?.("Error regenerating code","error")}finally{B(!1)}}},W=()=>{navigator.clipboard.writeText(A),l?.("Office code copied to clipboard","success")},le=r?.subscription_tier||"free",O=["pro","business","enterprise"].includes(le),U=["business","enterprise"].includes(le),Y=le==="enterprise",J=(S,K)=>{R(k=>({...k,[S]:K}))},D=async(S,K)=>{if(S){if(S.size>5*1024*1024){l?.("Image must be smaller than 5MB","error");return}if(!S.type.startsWith("image/")){l?.("Please upload an image file","error");return}try{const k=await m(S,K);k.success?(J(`${K}_url`,k.url),l?.(`${K.charAt(0).toUpperCase()+K.slice(1)} uploaded successfully`,"success")):l?.(k.error||"Failed to upload image","error")}catch(k){console.error("Upload error:",k),l?.("Failed to upload image","error")}}},_=async()=>{try{f(!0);const S=/^#[0-9A-F]{6}$/i;if(!S.test(x.primary_color)){l?.("Primary color must be a valid hex color (e.g., #3B82F6)","error");return}if(!S.test(x.secondary_color)){l?.("Secondary color must be a valid hex color (e.g., #1E40AF)","error");return}const K=await i(x);K.success?l?.("Branding settings saved successfully!","success"):l?.(K.error||"Failed to save branding settings","error")}catch(S){console.error("Save error:",S),l?.("Failed to save branding settings","error")}finally{f(!1)}},y=()=>{j?(document.documentElement.style.setProperty("--primary-color",c.primary_color),document.documentElement.style.setProperty("--secondary-color",c.secondary_color),document.title=c.custom_app_name||"FieldSync"):(document.documentElement.style.setProperty("--primary-color",x.primary_color),document.documentElement.style.setProperty("--secondary-color",x.secondary_color),document.title=x.custom_app_name||"FieldSync"),v(!j)};return u?e.jsxs("div",{className:"settings-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading branding settings..."})]}):e.jsxs("div",{className:"branding-settings",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("h2",{children:" Branding Settings"}),le==="free"&&e.jsx("div",{className:"tier-badge tier-free",children:"Free Plan - Upgrade for branding options"}),le==="pro"&&e.jsx("div",{className:"tier-badge tier-pro",children:"Pro Plan"}),le==="business"&&e.jsx("div",{className:"tier-badge tier-business",children:"Business Plan"}),le==="enterprise"&&e.jsx("div",{className:"tier-badge tier-enterprise",children:"Enterprise Plan"})]}),e.jsxs("div",{className:"settings-section security-section",children:[e.jsx("h3",{children:"Security"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Office Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Share this code with office staff only. Required to create new office accounts."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:A||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:W,disabled:!A,children:"Copy"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:C,disabled:F,children:F?"...":"Regenerate"})]}),e.jsx("p",{className:"help-text",style:{marginTop:"0.5rem",color:"var(--accent-amber)"},children:"Field workers should NOT have this code - they use project PINs only."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Company Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Public code for employees to find your company."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:r?.code||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:()=>{navigator.clipboard.writeText(r?.code||""),l?.("Company code copied","success")},disabled:!r?.code,children:"Copy"})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Visual Identity"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Logo"}),O?e.jsxs(e.Fragment,{children:[x.logo_url&&e.jsx("div",{className:"logo-preview",children:e.jsx("img",{src:x.logo_url,alt:"Logo preview"})}),e.jsx("input",{ref:I,type:"file",accept:"image/*",style:{display:"none"},onChange:S=>D(S.target.files[0],"logo")}),e.jsx("button",{className:"btn-secondary",onClick:()=>I.current?.click(),children:x.logo_url?"Change Logo":"Upload Logo"}),e.jsx("p",{className:"help-text",children:"Recommended: 200x60px, PNG with transparent background"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your logo"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"app-name",children:"App Name"}),O?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"app-name",type:"text",className:"input",value:x.custom_app_name||"",onChange:S=>J("custom_app_name",S.target.value),placeholder:"FieldSync",maxLength:50}),e.jsx("p",{className:"help-text",children:"This name appears in the browser tab and throughout the app"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your app name"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"primary-color",children:"Primary Color"}),O?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"primary-color",type:"color",value:x.primary_color||"#3B82F6",onChange:S=>J("primary_color",S.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:x.primary_color||"#3B82F6",onChange:S=>J("primary_color",S.target.value),placeholder:"#3B82F6",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"secondary-color",children:"Secondary Color"}),O?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"secondary-color",type:"color",value:x.secondary_color||"#1E40AF",onChange:S=>J("secondary_color",S.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:x.secondary_color||"#1E40AF",onChange:S=>J("secondary_color",S.target.value),placeholder:"#1E40AF",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Favicon"}),O?e.jsxs(e.Fragment,{children:[x.favicon_url&&e.jsx("div",{className:"favicon-preview",children:e.jsx("img",{src:x.favicon_url,alt:"Favicon preview"})}),e.jsx("input",{ref:re,type:"file",accept:"image/*",style:{display:"none"},onChange:S=>D(S.target.files[0],"favicon")}),e.jsx("button",{className:"btn-secondary",onClick:()=>re.current?.click(),children:x.favicon_url?"Change Favicon":"Upload Favicon"}),e.jsx("p",{className:"help-text",children:"Recommended: 32x32px or 64x64px, PNG or ICO format"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your favicon"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Login Background"}),U?e.jsxs(e.Fragment,{children:[x.login_background_url&&e.jsx("div",{className:"background-preview",children:e.jsx("img",{src:x.login_background_url,alt:"Background preview"})}),e.jsx("input",{ref:w,type:"file",accept:"image/*",style:{display:"none"},onChange:S=>D(S.target.files[0],"login_background")}),e.jsx("button",{className:"btn-secondary",onClick:()=>w.current?.click(),children:x.login_background_url?"Change Background":"Upload Background"}),e.jsx("p",{className:"help-text",children:"Recommended: 1920x1080px, JPG or PNG"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Business or Enterprise to customize login background"})})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"White-Label Options"}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:x.hide_fieldsync_branding||!1,onChange:S=>J("hide_fieldsync_branding",S.target.checked),disabled:!U}),e.jsx("span",{children:'Hide "Powered by FieldSync"'})]}),!U&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Email Branding"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-name",children:"From Name"}),e.jsx("input",{id:"email-from-name",type:"text",className:"input",value:x.email_from_name||"",onChange:S=>J("email_from_name",S.target.value),placeholder:"Your Company Name",disabled:!U}),!U&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-address",children:"From Email"}),e.jsx("input",{id:"email-from-address",type:"email",className:"input",value:x.email_from_address||"",onChange:S=>J("email_from_address",S.target.value),placeholder:"noreply@yourcompany.com",disabled:!U}),!U&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Custom Domain"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"custom-domain",children:"Domain"}),Y?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"custom-domain",type:"text",className:"input",value:x.custom_domain||"",onChange:S=>J("custom_domain",S.target.value),placeholder:"app.yourcompany.com"}),x.custom_domain&&e.jsx("div",{className:`domain-status ${x.domain_verified?"verified":"pending"}`,children:x.domain_verified?e.jsx(e.Fragment,{children:" Connected"}):e.jsx(e.Fragment,{children:" DNS setup required"})}),e.jsx("p",{className:"help-text",children:"Contact support to configure DNS and SSL certificate for your custom domain"})]}):e.jsxs("div",{className:"upgrade-notice",children:[e.jsx("p",{children:" Enterprise plan required for custom domain support"}),e.jsx("p",{className:"help-text",children:"Custom domains allow you to host the app at your own URL (e.g., app.yourcompany.com)"})]})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:y,children:j?"Exit Preview":"Preview Changes"}),e.jsx("button",{className:"btn-primary",onClick:_,disabled:g||!O,children:g?"Saving...":"Save Changes"})]}),j&&e.jsx("div",{className:"preview-banner",children:"Preview Mode Active - Your changes are not yet saved"})]})}const pd=["foreman","operator","laborer"],fd=["demolition","abatement"],gd=["standard","pla"];function Uy({company:r,onShowToast:l}){const[c,i]=p.useState({}),[m,u]=p.useState(!1),[g,f]=p.useState(!1),[j,v]=p.useState("demolition"),[x,R]=p.useState(!0);p.useEffect(()=>{r?.id&&q()},[r?.id]);const A=()=>{const T={};return fd.forEach(C=>{T[C]={},gd.forEach(W=>{T[C][W]={},pd.forEach(le=>{T[C][W][le]={regular:"",overtime:""}})})}),T},q=async()=>{if(!Q){i(A()),R(!1);return}const T=A();try{const{data:C,error:W}=await z.from("labor_rates").select("*").eq("company_id",r.id);if(W){i(T),R(!1);return}C&&C.length>0&&C.forEach(le=>{T[le.work_type]&&T[le.work_type][le.job_type]&&T[le.work_type][le.job_type][le.role]&&(T[le.work_type][le.job_type][le.role]={regular:le.regular_rate||"",overtime:le.overtime_rate||""})}),i(T)}catch(C){console.error("Error loading labor rates:",C),i(T)}finally{R(!1)}},F=async()=>{if(!Q){l("Labor rates require database connection","error");return}f(!0);try{await z.from("labor_rates").delete().eq("company_id",r.id);const T=[];fd.forEach(W=>{gd.forEach(le=>{pd.forEach(O=>{const U=c[W]?.[le]?.[O]||{regular:0,overtime:0};T.push({company_id:r.id,role:O,work_type:W,job_type:le,regular_rate:parseFloat(U.regular)||0,overtime_rate:parseFloat(U.overtime)||0})})})});const{error:C}=await z.from("labor_rates").insert(T);if(C)throw C;l("Labor rates saved","success"),u(!1)}catch(T){console.error("Error saving labor rates:",T),l("Error saving rates: "+(T.message||"Unknown error"),"error")}finally{f(!1)}},B=(T,C,W,le,O)=>{i(U=>({...U,[T]:{...U[T],[C]:{...U[T]?.[C],[W]:{...U[T]?.[C]?.[W],[le]:O}}}}))},I=T=>T.charAt(0).toUpperCase()+T.slice(1),re=T=>T.charAt(0).toUpperCase()+T.slice(1),w=T=>T==="pla"?"PLA (Prevailing Wage)":"Standard (Private)";return x?e.jsx("div",{className:"loading",children:"Loading labor rates..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"pricing-section-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Labor Rates"}),e.jsx("p",{className:"section-desc",children:"Configure hourly rates by role, work type, and job classification"})]}),m?e.jsxs("div",{className:"rate-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>{u(!1),q()},children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:F,disabled:g,children:g?"Saving...":"Save All Rates"})]}):e.jsx("button",{className:"btn btn-primary",onClick:()=>u(!0),children:"Edit Rates"})]}),e.jsx("div",{className:"work-type-tabs",children:fd.map(T=>e.jsx("button",{className:`work-type-tab ${j===T?"active":""}`,onClick:()=>v(T),children:re(T)},T))}),e.jsx("div",{className:"labor-rates-container",children:gd.map(T=>e.jsxs("div",{className:"job-type-section",children:[e.jsx("h3",{className:"job-type-header",children:w(T)}),e.jsxs("div",{className:"rates-table",children:[e.jsxs("div",{className:"rates-table-header",children:[e.jsx("div",{className:"rate-cell role-cell",children:"Role"}),e.jsx("div",{className:"rate-cell",children:"Regular"}),e.jsx("div",{className:"rate-cell",children:"Overtime"})]}),pd.map(C=>{const W=c[j]?.[T]?.[C]||{regular:"",overtime:""};return e.jsxs("div",{className:"rates-table-row",children:[e.jsx("div",{className:"rate-cell role-cell",children:I(C)}),e.jsx("div",{className:"rate-cell",children:m?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"number",value:W.regular,onChange:le=>B(j,T,C,"regular",le.target.value),placeholder:"0.00",step:"0.01"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value",children:["$",(parseFloat(W.regular)||0).toFixed(2),"/hr"]})}),e.jsx("div",{className:"rate-cell",children:m?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"number",value:W.overtime,onChange:le=>B(j,T,C,"overtime",le.target.value),placeholder:"0.00",step:"0.01"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value ot",children:["$",(parseFloat(W.overtime)||0).toFixed(2),"/hr"]})})]},C)})]})]},T))})]})}const Ui=["Containment","PPE","Disposal","Equipment"];function Hy({company:r,onShowToast:l}){const[c,i]=p.useState([]),[m,u]=p.useState(!0),[g,f]=p.useState("all"),[j,v]=p.useState(null),[x,R]=p.useState(!1),[A,q]=p.useState({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),[F,B]=p.useState([]),[I,re]=p.useState(!1);p.useEffect(()=>{r?.id&&w()},[r?.id]);const w=async()=>{u(!0);try{const D=await ee.getAllMaterialsEquipment(r.id);i(D||[]),T(D||[])}catch(D){console.error("Error loading items:",D),l("Error loading materials","error")}finally{u(!1)}},T=D=>{const _={},y=[];D.filter(K=>K.active!==!1).forEach(K=>{const k=K.name.toLowerCase().trim();_[k]||(_[k]=[]),_[k].push(K)}),Object.entries(_).forEach(([K,k])=>{k.length>1&&y.push({name:K,items:k})}),B(y)},C=async D=>{try{const _=D.items.filter(K=>K.cost_per_unit>0),y=_.length>0?_[0]:D.items[0],S=D.items.filter(K=>K.id!==y.id);for(const K of S)await ee.deleteMaterialEquipment(K.id);l(`Merged ${D.items.length} items into one`,"success"),w()}catch(_){console.error("Error merging duplicates:",_),l("Error merging duplicates","error")}},W=async()=>{if(confirm(`Merge all ${F.length} duplicate groups?`))try{for(const D of F){const _=D.items.filter(K=>K.cost_per_unit>0),y=_.length>0?_[0]:D.items[0],S=D.items.filter(K=>K.id!==y.id);for(const K of S)await ee.deleteMaterialEquipment(K.id)}l("All duplicates merged!","success"),w(),re(!1)}catch(D){console.error("Error merging all duplicates:",D),l("Error merging duplicates","error")}},le=async()=>{if(!A.name.trim()){l("Enter item name","error");return}try{await ee.createMaterialEquipment({company_id:r.id,name:A.name.trim(),category:A.category,unit:A.unit||"each",cost_per_unit:parseFloat(A.cost_per_unit)||0,active:!0}),l("Item added","success"),q({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),R(!1),w()}catch(D){console.error("Error adding item:",D),l("Error adding item","error")}},O=async D=>{try{await ee.updateMaterialEquipment(D.id,{name:D.name,category:D.category,unit:D.unit,cost_per_unit:parseFloat(D.cost_per_unit)||0}),l("Item updated","success"),v(null),w()}catch(_){console.error("Error updating item:",_),l("Error updating item","error")}},U=async D=>{if(confirm("Delete this item?"))try{await ee.deleteMaterialEquipment(D),l("Item deleted","success"),w()}catch(_){console.error("Error deleting item:",_),l("Error deleting item","error")}},Y=g==="all"?c.filter(D=>D.active!==!1):c.filter(D=>D.category===g&&D.active!==!1),J=Y.reduce((D,_)=>{const y=_.category||"Other";return D[y]||(D[y]=[]),D[y].push(_),D},{});return m?e.jsx("div",{className:"loading",children:"Loading materials..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"materials-header",children:[e.jsxs("div",{className:"materials-title",children:[e.jsx("h2",{children:"Materials & Equipment"}),e.jsxs("span",{className:"materials-count",children:[c.filter(D=>D.active!==!1).length," items"]})]}),e.jsxs("div",{className:"materials-actions",children:[F.length>0&&e.jsxs("button",{className:`btn btn-warning ${I?"active":""}`,onClick:()=>re(!I),children:[F.length," Duplicates"]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>R(!0),children:"+ Add Item"})]})]}),I&&F.length>0&&e.jsxs("div",{className:"duplicates-panel",children:[e.jsxs("div",{className:"duplicates-header",children:[e.jsx("h3",{children:"Duplicate Items Found"}),e.jsxs("button",{className:"btn btn-success btn-small",onClick:W,children:["Merge All (",F.length,")"]})]}),e.jsx("div",{className:"duplicates-list",children:F.map((D,_)=>e.jsxs("div",{className:"duplicate-group",children:[e.jsxs("div",{className:"duplicate-name",children:['"',D.name,'" x ',D.items.length]}),e.jsx("div",{className:"duplicate-items",children:D.items.map(y=>e.jsxs("span",{className:"duplicate-item",children:[y.category," - $",y.cost_per_unit||0]},y.id))}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>C(D),children:"Merge"})]},_))})]}),x&&e.jsxs("div",{className:"add-item-form",children:[e.jsx("h3",{children:"Add New Item"}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Item Name",value:A.name,onChange:D=>q({...A,name:D.target.value}),autoFocus:!0}),e.jsx("select",{value:A.category,onChange:D=>q({...A,category:D.target.value}),children:Ui.map(D=>e.jsx("option",{value:D,children:D},D))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Unit (e.g., each, day, hour)",value:A.unit,onChange:D=>q({...A,unit:D.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per unit",value:A.cost_per_unit,onChange:D=>q({...A,cost_per_unit:D.target.value}),step:"0.01"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>R(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:le,children:"Add Item"})]})]}),e.jsxs("div",{className:"materials-filter",children:[e.jsx("button",{className:`filter-tab ${g==="all"?"active":""}`,onClick:()=>f("all"),children:"All"}),Ui.map(D=>e.jsxs("button",{className:`filter-tab ${g===D?"active":""}`,onClick:()=>f(D),children:[D,e.jsx("span",{className:"filter-count",children:c.filter(_=>_.category===D&&_.active!==!1).length})]},D))]}),e.jsxs("div",{className:"materials-list",children:[g==="all"?Object.entries(J).map(([D,_])=>e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:D}),e.jsx("div",{className:"category-items",children:_.map(y=>e.jsx(Yp,{item:y,editingItem:j,setEditingItem:v,handleUpdateItem:O,handleDeleteItem:U,categories:Ui},y.id))})]},D)):e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:g}),e.jsx("div",{className:"category-items",children:Y.map(D=>e.jsx(Yp,{item:D,editingItem:j,setEditingItem:v,handleUpdateItem:O,handleDeleteItem:U,categories:Ui},D.id))})]}),Y.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No items in this category"})})]})]})}function Yp({item:r,editingItem:l,setEditingItem:c,handleUpdateItem:i,handleDeleteItem:m,categories:u}){return l?.id===r.id?e.jsx("div",{className:"material-item",children:e.jsxs("div",{className:"item-edit-form",children:[e.jsx("input",{type:"text",value:l.name,onChange:g=>c({...l,name:g.target.value})}),e.jsx("select",{value:l.category,onChange:g=>c({...l,category:g.target.value}),children:u.map(g=>e.jsx("option",{value:g,children:g},g))}),e.jsx("input",{type:"text",value:l.unit,onChange:g=>c({...l,unit:g.target.value}),placeholder:"Unit"}),e.jsx("input",{type:"number",value:l.cost_per_unit,onChange:g=>c({...l,cost_per_unit:g.target.value}),placeholder:"Cost",step:"0.01"}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>i(l),children:"Save"}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>c(null),children:"Cancel"})]})]})}):e.jsxs("div",{className:"material-item",children:[e.jsxs("div",{className:"item-info",children:[e.jsx("span",{className:"item-name",children:r.name}),e.jsx("span",{className:"item-unit",children:r.unit||"each"})]}),e.jsxs("div",{className:"item-cost",children:["$",(r.cost_per_unit||0).toFixed(2)]}),e.jsxs("div",{className:"item-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>c({...r}),title:"Edit",children:e.jsx(uf,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:()=>m(r.id),title:"Delete",children:e.jsx(qs,{size:16})})]})]})}const By=[{id:"trash",label:"Trash",description:"General debris"},{id:"metal",label:"Metal",description:"Scrap metal (recyclable)"},{id:"copper",label:"Copper",description:"Copper scrap (recyclable)"},{id:"concrete",label:"Concrete",description:"Concrete/masonry"},{id:"hazardous",label:"Hazardous",description:"Hazardous materials"}];function Fy({company:r,onShowToast:l}){const[c,i]=p.useState([]),[m,u]=p.useState(!0),[g,f]=p.useState(!1),[j,v]=p.useState(null),[x,R]=p.useState({name:"",address:"",notes:""}),[A,q]=p.useState(!1),[F,B]=p.useState({}),I=p.useRef({});p.useEffect(()=>{r?.id&&re()},[r?.id]),p.useEffect(()=>()=>{Object.values(I.current).forEach(Y=>clearTimeout(Y))},[]);const re=async()=>{u(!0);try{const Y=await ee.getDumpSites(r.id);i(Y||[])}catch(Y){console.error("Error loading dump sites:",Y),l("Error loading dump sites","error")}finally{u(!1)}},w=async()=>{if(!x.name.trim()){l("Please enter a site name","error");return}q(!0);try{await ee.createDumpSite(r.id,x.name,x.address,x.notes),l("Dump site added","success"),R({name:"",address:"",notes:""}),f(!1),re()}catch(Y){console.error("Error adding dump site:",Y),l("Error adding dump site","error")}finally{q(!1)}},T=async()=>{if(!j?.name.trim()){l("Please enter a site name","error");return}q(!0);try{await ee.updateDumpSite(j.id,{name:j.name,address:j.address,notes:j.notes}),l("Dump site updated","success"),v(null),re()}catch(Y){console.error("Error updating dump site:",Y),l("Error updating dump site","error")}finally{q(!1)}},C=async Y=>{if(confirm("Are you sure you want to delete this dump site?"))try{await ee.deleteDumpSite(Y),l("Dump site deleted","success"),re()}catch(J){console.error("Error deleting dump site:",J),l("Error deleting dump site","error")}},W=p.useCallback(async(Y,J,D)=>{try{await ee.setDumpSiteRate(Y,J,D),i(_=>_.map(y=>{if(y.id===Y){const S=[...y.dump_site_rates||[]],K=S.findIndex(k=>k.waste_type===J);return K>=0?S[K]={...S[K],estimated_cost_per_load:D}:S.push({waste_type:J,estimated_cost_per_load:D}),{...y,dump_site_rates:S}}return y})),B(_=>{const y={..._};return delete y[`${Y}-${J}`],y})}catch(_){console.error("Error saving rate:",_?.message||_),l("Error saving rate","error")}},[l]),le=(Y,J,D)=>{const _=`${Y}-${J}`;B(y=>({...y,[_]:D})),I.current[_]&&clearTimeout(I.current[_]),I.current[_]=setTimeout(()=>{const y=parseFloat(D)||0;W(Y,J,y)},500)},O=(Y,J)=>{const D=`${Y.id}-${J}`;return F[D]!==void 0?F[D]:Y.dump_site_rates?.find(y=>y.waste_type===J)?.estimated_cost_per_load??""},U=Y=>{if(Y===""||Y===null||Y===void 0)return"";const J=parseFloat(Y);return J<0?`-$${Math.abs(J).toFixed(0)}`:`$${J.toFixed(0)}`};return m?e.jsx("div",{className:"loading",children:"Loading dump sites..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"dump-site-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Disposal & Haul-Off"}),e.jsx("p",{className:"section-desc",children:"Configure dump sites and estimated costs per load for each waste type. Use negative values for recyclables (metal, copper) to indicate revenue."})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>f(!0),children:"+ Add Dump Site"})]}),g&&e.jsxs("div",{className:"dump-site-form card",children:[e.jsx("h4",{children:"Add Dump Site"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:x.name,onChange:Y=>R({...x,name:Y.target.value}),placeholder:"e.g., Metro Landfill"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:x.address,onChange:Y=>R({...x,address:Y.target.value}),placeholder:"123 Main St, City"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:x.notes,onChange:Y=>R({...x,notes:Y.target.value}),placeholder:"Operating hours, contact, etc."})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:w,disabled:A,children:A?"Adding...":"Add Site"})]})]}),c.length===0?e.jsxs("div",{className:"dump-site-empty",children:[e.jsx("p",{children:"No dump sites configured yet."}),e.jsx("p",{children:"Add a dump site to start tracking haul-off costs."})]}):e.jsx("div",{className:"dump-sites-list",children:c.map(Y=>e.jsxs("div",{className:"dump-site-card card",children:[j?.id===Y.id?e.jsxs("div",{className:"dump-site-edit",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:j.name,onChange:J=>v({...j,name:J.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:j.address||"",onChange:J=>v({...j,address:J.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:j.notes||"",onChange:J=>v({...j,notes:J.target.value})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>v(null),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:T,disabled:A,children:A?"Saving...":"Save"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dump-site-info",children:[e.jsx("div",{className:"dump-site-name",children:Y.name}),Y.address&&e.jsx("div",{className:"dump-site-address",children:Y.address}),Y.notes&&e.jsx("div",{className:"dump-site-notes",children:Y.notes})]}),e.jsxs("div",{className:"dump-site-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>v({...Y}),title:"Edit",children:e.jsx(uf,{size:16})}),e.jsx("button",{className:"btn-icon",onClick:()=>C(Y.id),title:"Delete",children:e.jsx(qs,{size:16})})]})]}),e.jsxs("div",{className:"dump-site-rates",children:[e.jsx("div",{className:"rates-header",children:"Estimated Cost per Load"}),e.jsx("div",{className:"rates-grid",children:By.map(J=>e.jsxs("div",{className:"rate-item",children:[e.jsxs("label",{children:[e.jsx("span",{className:"rate-label",children:J.label}),e.jsx("span",{className:"rate-desc",children:J.description})]}),e.jsxs("div",{className:"rate-input-wrapper",children:[e.jsx("span",{className:"rate-prefix",children:"$"}),e.jsx("input",{type:"number",className:"rate-input",value:O(Y,J.id),onChange:D=>le(Y.id,J.id,D.target.value),placeholder:"0"})]}),O(Y,J.id)!==""&&e.jsxs("span",{className:`rate-preview ${parseFloat(O(Y,J.id))<0?"revenue":"cost"}`,children:[U(O(Y,J.id)),"/load"]})]},J.id))}),e.jsx("div",{className:"rates-note",children:"Tip: Use negative values for recyclables that generate revenue (e.g., -50 for metal)"})]})]},Y.id))})]})}const $y=[{id:"labor",label:"Labor Rates",Icon:oa},{id:"materials",label:"Materials & Equipment",Icon:vl},{id:"disposal",label:"Disposal & Haul-Off",Icon:Ka}];function Vy({company:r,onShowToast:l}){const[c,i]=p.useState("labor");return e.jsxs("div",{className:"pricing-manager",children:[e.jsxs("div",{className:"pricing-header",children:[e.jsx("h1",{children:"Pricing Configuration"}),e.jsx("p",{className:"pricing-subtitle",children:"Set up labor rates, materials pricing, and disposal costs"})]}),e.jsx("div",{className:"pricing-tabs",children:$y.map(m=>e.jsxs("button",{className:`pricing-tab ${c===m.id?"active":""}`,onClick:()=>i(m.id),children:[e.jsx(m.Icon,{size:18,className:"pricing-tab-icon"}),e.jsx("span",{className:"pricing-tab-label",children:m.label})]},m.id))}),e.jsxs("div",{className:"pricing-content",children:[c==="labor"&&e.jsx(Uy,{company:r,onShowToast:l}),c==="materials"&&e.jsx(Hy,{company:r,onShowToast:l}),c==="disposal"&&e.jsx(Fy,{company:r,onShowToast:l})]})]})}function Yy({shareToken:r}){const[l,c]=p.useState(!0),[i,m]=p.useState(null),[u,g]=p.useState(null),[f,j]=p.useState(0),{branding:v}=wr();p.useEffect(()=>{x()},[r]);const x=async()=>{c(!0),m(null);try{const C=await ee.getPublicProjectData(r);if(!C){m("This share link is invalid or has expired.");return}g(C)}catch(C){console.error("Error loading public data:",C),m("Failed to load project data.")}finally{c(!1)}},R=C=>C?new Date(C).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",A=C=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(C);if(l)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading project..."})]}),e.jsx("style",{children:xd})]});if(i)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx(jl,{size:48})}),e.jsx("h2",{children:i}),e.jsx("p",{children:"Please contact the project owner for a valid link."})]}),e.jsx("style",{children:xd})]});const{share:q,project:F,progress:B,areas:I,photos:re,dailyReports:w,tmTickets:T}=u;return e.jsxs("div",{className:"public-view",children:[e.jsx("header",{className:"public-header",children:e.jsxs("div",{className:"container",children:[e.jsx(ls,{size:"large"}),e.jsx("div",{className:"header-meta",children:e.jsxs("span",{className:"last-updated",children:["Last updated: ",R(F.updated_at||F.created_at)]})})]})}),e.jsx("main",{className:"public-main",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"project-header",children:[e.jsx("h1",{children:F.name}),F.address&&e.jsx("p",{className:"project-address",children:F.address})]}),q.permissions.progress&&e.jsxs("div",{className:"public-card progress-card",children:[e.jsx("h2",{children:"Project Progress"}),e.jsxs("div",{className:"progress-visual",children:[e.jsxs("div",{className:"progress-circle",children:[e.jsxs("svg",{viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"var(--primary-color, #3b82f6)",strokeWidth:"8",strokeDasharray:`${B*2.827} 282.7`,strokeLinecap:"round",transform:"rotate(-90 50 50)"})]}),e.jsxs("div",{className:"progress-percentage",children:[B,"%"]})]}),e.jsxs("div",{className:"progress-details",children:[e.jsx("div",{className:"progress-label",children:"Complete"}),I&&I.length>0&&e.jsxs("div",{className:"areas-summary",children:[I.filter(C=>C.status==="done").length," of ",I.length," areas completed"]})]})]}),I&&I.length>0&&e.jsxs("div",{className:"areas-list",children:[e.jsx("h3",{children:"Work Areas"}),I.map(C=>e.jsxs("div",{className:"area-item",children:[e.jsxs("div",{className:"area-info",children:[e.jsx("span",{className:"area-name",children:C.name}),e.jsxs("span",{className:"area-weight",children:[C.weight,"%"]})]}),e.jsx("div",{className:`area-status status-${C.status}`,children:C.status==="done"?" Complete":C.status==="working"?" In Progress":" Not Started"})]},C.id))]})]}),q.permissions.photos&&re&&re.length>0&&e.jsxs("div",{className:"public-card photos-card",children:[e.jsx("h2",{children:"Recent Photos"}),e.jsxs("div",{className:"photos-carousel",children:[e.jsxs("div",{className:"carousel-main",children:[re[f]&&e.jsx("img",{src:re[f].url,alt:`Project photo from ${R(re[f].date)}`,className:"carousel-image"}),e.jsx("div",{className:"carousel-date",children:R(re[f]?.date)})]}),e.jsx("div",{className:"carousel-thumbnails",children:re.slice(0,10).map((C,W)=>e.jsx("div",{className:`thumbnail ${W===f?"active":""}`,onClick:()=>j(W),children:e.jsx("img",{src:C.url,alt:`Thumbnail ${W+1}`})},W))}),re.length>1&&e.jsxs("div",{className:"carousel-controls",children:[e.jsx("button",{onClick:()=>j(C=>C>0?C-1:re.length-1),className:"carousel-btn",children:""}),e.jsxs("span",{className:"carousel-counter",children:[f+1," / ",re.length]}),e.jsx("button",{onClick:()=>j(C=>C<re.length-1?C+1:0),className:"carousel-btn",children:""})]})]})]}),q.permissions.daily_reports&&w&&w.length>0&&e.jsxs("div",{className:"public-card reports-card",children:[e.jsx("h2",{children:"Daily Reports"}),e.jsx("div",{className:"reports-list",children:w.map((C,W)=>e.jsxs("div",{className:"report-item",children:[e.jsx("div",{className:"report-date",children:R(C.report_date)}),e.jsxs("div",{className:"report-content",children:[C.crew_count&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Crew:"})," ",C.crew_count," workers"]}),C.tasks_completed&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Tasks Completed:"})," ",C.tasks_completed]}),C.weather&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Weather:"})," ",C.weather]}),C.notes&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Notes:"})," ",C.notes]})]})]},W))})]}),q.permissions.tm_tickets&&T&&T.length>0&&e.jsxs("div",{className:"public-card tm-card",children:[e.jsx("h2",{children:"Time & Materials Tickets"}),e.jsx("div",{className:"tm-list",children:T.map((C,W)=>e.jsxs("div",{className:"tm-item",children:[e.jsxs("div",{className:"tm-header",children:[e.jsx("span",{className:"tm-date",children:R(C.work_date)}),e.jsx("span",{className:`tm-status status-${C.status}`,children:C.status})]}),C.description&&e.jsx("div",{className:"tm-description",children:C.description}),C.total_amount&&e.jsxs("div",{className:"tm-amount",children:["Total: ",A(C.total_amount)]})]},W))})]})]})}),e.jsx("footer",{className:"public-footer",children:e.jsx("div",{className:"container",children:!v?.hide_fieldsync_branding&&e.jsx("p",{children:"Powered by FieldSync"})})}),e.jsx("style",{children:xd})]})}const xd=`
  .public-view {
    min-height: 100vh;
    background-color: #f9fafb;
    display: flex;
    flex-direction: column;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 1rem;
    width: 100%;
  }

  /* Header */
  .public-header {
    background-color: white;
    border-bottom: 1px solid #e5e7eb;
    padding: 1.5rem 0;
  }

  .public-header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header-meta {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Main Content */
  .public-main {
    flex: 1;
    padding: 2rem 0;
  }

  .project-header {
    margin-bottom: 2rem;
  }

  .project-header h1 {
    font-size: 2rem;
    margin: 0 0 0.5rem 0;
    color: #111827;
  }

  .project-address {
    font-size: 1rem;
    color: #6b7280;
    margin: 0;
  }

  /* Cards */
  .public-card {
    background-color: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .public-card h2 {
    font-size: 1.5rem;
    margin: 0 0 1.5rem 0;
    color: #111827;
  }

  .public-card h3 {
    font-size: 1.125rem;
    margin: 1.5rem 0 1rem 0;
    color: #374151;
  }

  /* Progress Card */
  .progress-visual {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .progress-circle {
    position: relative;
    width: 150px;
    height: 150px;
    flex-shrink: 0;
  }

  .progress-circle svg {
    width: 100%;
    height: 100%;
  }

  .progress-percentage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary-color, #3b82f6);
  }

  .progress-details {
    flex: 1;
  }

  .progress-label {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.5rem;
  }

  .areas-summary {
    font-size: 1rem;
    color: #6b7280;
  }

  /* Areas List */
  .areas-list {
    border-top: 1px solid #e5e7eb;
    padding-top: 1rem;
  }

  .area-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f3f4f6;
  }

  .area-item:last-child {
    border-bottom: none;
  }

  .area-info {
    flex: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-right: 1rem;
  }

  .area-name {
    font-weight: 500;
    color: #374151;
  }

  .area-weight {
    color: #6b7280;
    font-size: 0.875rem;
  }

  .area-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
  }

  .area-status.status-done {
    background-color: #d1fae5;
    color: #065f46;
  }

  .area-status.status-working {
    background-color: #fef3c7;
    color: #92400e;
  }

  .area-status.status-not_started {
    background-color: #f3f4f6;
    color: #6b7280;
  }

  /* Photos Carousel */
  .photos-carousel {
    position: relative;
  }

  .carousel-main {
    position: relative;
    width: 100%;
    height: 400px;
    background-color: #111827;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .carousel-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .carousel-date {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
    color: white;
    padding: 1rem;
    text-align: center;
  }

  .carousel-thumbnails {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
  }

  .thumbnail {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s;
  }

  .thumbnail:hover {
    border-color: #d1d5db;
  }

  .thumbnail.active {
    border-color: var(--primary-color, #3b82f6);
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .carousel-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
  }

  .carousel-btn {
    background-color: white;
    border: 1px solid #d1d5db;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.25rem;
    transition: background-color 0.2s;
  }

  .carousel-btn:hover {
    background-color: #f3f4f6;
  }

  .carousel-counter {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Daily Reports */
  .reports-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .report-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .report-date {
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.75rem;
    font-size: 1.125rem;
  }

  .report-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .report-field {
    color: #374151;
    line-height: 1.5;
  }

  .report-field strong {
    color: #111827;
  }

  /* T&M Tickets */
  .tm-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .tm-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .tm-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .tm-date {
    font-weight: 600;
    color: #111827;
  }

  .tm-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: capitalize;
  }

  .tm-status.status-approved {
    background-color: #d1fae5;
    color: #065f46;
  }

  .tm-status.status-pending {
    background-color: #fef3c7;
    color: #92400e;
  }

  .tm-status.status-rejected {
    background-color: #fee2e2;
    color: #991b1b;
  }

  .tm-description {
    color: #374151;
    margin-bottom: 0.5rem;
  }

  .tm-amount {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--primary-color, #3b82f6);
  }

  /* Footer */
  .public-footer {
    background-color: white;
    border-top: 1px solid #e5e7eb;
    padding: 2rem 0;
    margin-top: auto;
  }

  .public-footer p {
    text-align: center;
    color: #6b7280;
    margin: 0;
    font-size: 0.875rem;
  }

  /* Loading & Error States */
  .loading-container,
  .error-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 2rem;
  }

  .spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #e5e7eb;
    border-top-color: var(--primary-color, #3b82f6);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .loading-container p {
    margin-top: 1rem;
    color: #6b7280;
  }

  .error-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .error-container h2 {
    color: #111827;
    margin: 0 0 0.5rem 0;
  }

  .error-container p {
    color: #6b7280;
    margin: 0;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .project-header h1 {
      font-size: 1.5rem;
    }

    .public-card {
      padding: 1.5rem;
    }

    .progress-visual {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .progress-circle {
      width: 120px;
      height: 120px;
    }

    .progress-percentage {
      font-size: 1.5rem;
    }

    .carousel-main {
      height: 300px;
    }

    .area-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .area-info {
      width: 100%;
      margin-right: 0;
    }
  }
`;function Gp({onSave:r,onClose:l,slot:c=1,documentType:i="cor",documentTitle:m="",signerName:u="",signerTitle:g="",signerCompany:f=""}){const j=p.useRef(null),[v,x]=p.useState(u),[R,A]=p.useState(g),[q,F]=p.useState(f),[B,I]=p.useState(!1),[re,w]=p.useState(!1),[T,C]=p.useState(!1),W=c===1?"GC Authorization":"Client Authorization",le=i==="cor"?"Change Order Request":"T&M Work Order",O=()=>{const k=j.current;return k?k.getContext("2d"):null},U=k=>{const ie=j.current;if(!ie)return{x:0,y:0};const M=ie.getBoundingClientRect(),G=ie.width/M.width,L=ie.height/M.height,P=k.touches?k.touches[0].clientX:k.clientX,$=k.touches?k.touches[0].clientY:k.clientY;return{x:(P-M.left)*G,y:($-M.top)*L}},Y=k=>{k.preventDefault();const ie=O();if(!ie)return;const{x:M,y:G}=U(k);ie.beginPath(),ie.moveTo(M,G),w(!0),I(!0)},J=k=>{if(!re)return;k.preventDefault();const ie=O();if(!ie)return;const{x:M,y:G}=U(k);ie.lineTo(M,G),ie.stroke()},D=()=>{w(!1)},_=()=>{const k=j.current,ie=O();!k||!ie||(ie.clearRect(0,0,k.width,k.height),I(!1))},y=k=>{if(!k)return;j.current=k;const ie=k.getContext("2d");ie.strokeStyle="#1e293b",ie.lineWidth=2,ie.lineCap="round",ie.lineJoin="round"},S=B&&v.trim()&&T,K=()=>{if(!S)return;const k=j.current;if(!k)return;const ie=k.toDataURL("image/png");r({signature:ie,signerName:v.trim(),signerTitle:R.trim()||null,signerCompany:q.trim()||null,signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal enhanced",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"signature-header-info",children:[e.jsx("h2",{id:"signature-title",children:W}),m&&e.jsx("span",{className:"signature-doc-ref",children:m})]}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close signature modal",children:e.jsx(es,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"signature-slot-badge",children:[e.jsx(Fi,{size:14}),e.jsxs("span",{children:["Signature ",c," of 2"]})]}),e.jsxs("div",{className:"signature-fields",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Print Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:v,onChange:k=>x(k.target.value),placeholder:"Enter your full legal name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-fields-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-title",children:"Title"}),e.jsx("input",{id:"signer-title",type:"text",value:R,onChange:k=>A(k.target.value),placeholder:"e.g., Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-company",children:"Company"}),e.jsx("input",{id:"signer-company",type:"text",value:q,onChange:k=>F(k.target.value),placeholder:"e.g., ABC Construction"})]})]})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(kd,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Draw your signature below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:y,width:500,height:180,className:"signature-canvas",onMouseDown:Y,onMouseMove:J,onMouseUp:D,onMouseLeave:D,onTouchStart:Y,onTouchMove:J,onTouchEnd:D,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!B&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:_,disabled:!B,"aria-label":"Clear signature",children:[e.jsx(Ed,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("div",{className:"signature-acknowledgment",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:k=>C(k.target.checked)}),e.jsxs("span",{children:["I acknowledge that this electronic signature is legally binding and that I have reviewed and approve this ",le,". I understand that my signature, name, and IP address will be recorded for verification purposes."]})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:K,disabled:!S,"aria-label":"Submit signature",children:[e.jsx(Wa,{size:16,"aria-hidden":"true"})," Submit Signature"]})]})]})})}const Nr=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",Gy=({status:r})=>{const l={draft:{label:"Draft",color:"#6b7280",bg:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bg:"#fef3c7"},approved:{label:"Approved",color:"#059669",bg:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bg:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bg:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bg:"#e5e7eb"}},c=l[r]||l.draft;return e.jsx("span",{className:"cor-status-badge",style:{color:c.color,backgroundColor:c.bg},children:c.label})};function Py({signatureToken:r}){const[l,c]=p.useState(!0),[i,m]=p.useState(null),[u,g]=p.useState(null),[f,j]=p.useState(null),[v,x]=p.useState(!1),[R,A]=p.useState(null),[q,F]=p.useState(!1),[B,I]=p.useState(null),[re,w]=p.useState(!1),[T,C]=p.useState([]),[W,le]=p.useState(!1),[O,U]=p.useState(new Set);p.useEffect(()=>{Y()},[r]);const Y=async()=>{try{c(!0),m(null);const E=await ee.getSignatureRequestByToken(r);if(!E){m("This signature link is invalid or has expired.");return}if(E.status==="completed"){m("This document has already been fully signed.");return}if(E.status==="revoked"){m("This signature link has been revoked.");return}if(E.status==="expired"){m("This signature link has expired.");return}g(E);const ue=await ee.getDocumentForSigning(E.document_type,E.document_id);if(!ue){m("The document associated with this link could not be found.");return}if(j(ue),E.document_type==="cor"&&ue?.id)try{const Me=await ee.getCORTickets(ue.id);C(Me||[])}catch(Me){console.warn("Failed to load backup tickets:",Me)}}catch(E){console.error("Error loading signature data:",E),m("Unable to load signature request. Please try again.")}finally{c(!1)}},J=p.useMemo(()=>!f||u?.document_type!=="cor"?null:yl(f),[f,u]),D=()=>{if(!u)return{slot1:null,slot2:null,availableSlots:[]};const E=u.signatures||[],ue=E.find(te=>te.signature_slot===1),Me=E.find(te=>te.signature_slot===2),Te=[];return ue||Te.push(1),Me||Te.push(2),{slot1:ue,slot2:Me,availableSlots:Te}},_=async()=>{try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return null}},y=async E=>{if(!(!u||!R))try{F(!0);const ue=await _(),Me=await ee.addSignature(u.id,R,{...E,ipAddress:ue,userAgent:navigator.userAgent});await ee.syncSignatureToDocument(Me,u),await Y(),x(!1),A(null),I(`Signature ${R} has been recorded successfully.`),setTimeout(()=>I(null),5e3)}catch(ue){console.error("Error submitting signature:",ue),m("Failed to submit signature. Please try again.")}finally{F(!1)}},S=E=>{A(E),x(!0)},K=async()=>{if(!(!f||!u))try{w(!0);let E=null;if(L)try{E=await ee.getCORTickets(f.id)}catch(Me){console.warn("Failed to fetch T&M tickets for backup:",Me)}const ue={logoUrl:P?.logo_url,primaryColor:P?.branding_color};await bf(f,$,P,ue,E),I("PDF downloaded successfully!"),setTimeout(()=>I(null),3e3)}catch(E){console.error("Download failed:",E),m("Failed to generate PDF. Please try again.")}finally{w(!1)}};if(l)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading document..."})]})});if(i)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-error",children:[e.jsx(Hn,{size:48}),e.jsx("h2",{children:"Unable to Load Document"}),e.jsx("p",{children:i})]})});const{slot1:k,slot2:ie,availableSlots:M}=D(),G=M.length===0,L=u?.document_type==="cor",P=f?.projects?.companies,$=f?.projects;if(!L){const E=f.t_and_m_workers?.length||0,ue=f.t_and_m_workers?.reduce((Me,Te)=>Me+(Te.hours||0),0)||0;return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[P?.logo_url?e.jsx("img",{src:P.logo_url,alt:P.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Hi,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:P?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"T&M Ticket Signature"})]})]}),B&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(ms,{size:18}),B]}),e.jsxs("main",{className:"signature-page-content",children:[e.jsxs("div",{className:"signature-document-card",children:[e.jsxs("div",{className:"document-card-header",children:[e.jsx(Aa,{size:20}),e.jsxs("div",{className:"document-card-title",children:[e.jsx("h2",{children:"T&M Ticket"}),e.jsx("span",{className:"document-subtitle",children:f.ce_pco_number?`CE/PCO: ${f.ce_pco_number}`:"Time & Materials"})]})]}),e.jsxs("div",{className:"document-card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Project"}),e.jsx("span",{className:"detail-value",children:$?.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Work Date"}),e.jsx("span",{className:"detail-value",children:Nr(f.work_date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Workers"}),e.jsxs("span",{className:"detail-value",children:[E," (",ue," hrs)"]})]}),f.notes&&e.jsxs("div",{className:"detail-row full-width",children:[e.jsx("span",{className:"detail-label",children:"Description"}),e.jsx("span",{className:"detail-value",children:f.notes})]})]})]}),e.jsxs("div",{className:"signature-status-section",children:[e.jsx("h3",{children:"Signatures Required"}),Pp(1,k,"GC Authorization",S,q),Pp(2,ie,"Client Authorization",S,q),G&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(ms,{size:24}),e.jsx("p",{children:"This document has been fully signed by all parties."})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),v&&R&&e.jsx(Gp,{slot:R,documentType:"tm_ticket",documentTitle:"T&M Ticket",onSave:y,onClose:()=>{x(!1),A(null)}})]})}return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[P?.logo_url?e.jsx("img",{src:P.logo_url,alt:P.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Hi,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:P?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"Change Order Request"})]})]}),B&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(ms,{size:18}),B]}),e.jsxs("main",{className:"signature-page-content cor-full-document",children:[e.jsxs("div",{className:"cor-header-card",children:[e.jsxs("div",{className:"cor-header-top",children:[e.jsxs("div",{className:"cor-title-section",children:[e.jsx("h2",{className:"cor-number",children:f.cor_number}),e.jsx(Gy,{status:f.status})]}),e.jsxs("div",{className:"cor-date",children:["Created ",Nr(f.created_at)]})]}),e.jsx("h3",{className:"cor-title",children:f.title||"Untitled Change Order"}),e.jsxs("div",{className:"cor-info-grid",children:[e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Project"}),e.jsx("span",{className:"cor-info-value",children:$?.name})]}),$?.job_number&&e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Job #"}),e.jsx("span",{className:"cor-info-value",children:$.job_number})]}),e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Period"}),e.jsx("span",{className:"cor-info-value",children:$i(f.period_start,f.period_end)})]})]}),f.scope_of_work&&e.jsxs("div",{className:"cor-scope",children:[e.jsx("h4",{children:"Scope of Work"}),e.jsx("p",{children:f.scope_of_work})]})]}),f.change_order_labor?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Os,{size:18}),e.jsx("h4",{children:"Labor"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{className:"text-right",children:"Reg Hrs"}),e.jsx("th",{className:"text-right",children:"Reg Rate"}),e.jsx("th",{className:"text-right",children:"OT Hrs"}),e.jsx("th",{className:"text-right",children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:f.change_order_labor.map((E,ue)=>e.jsxs("tr",{children:[e.jsx("td",{children:E.labor_class}),e.jsx("td",{children:E.wage_type}),e.jsx("td",{className:"text-right",children:E.regular_hours}),e.jsxs("td",{className:"text-right",children:["$",ja(E.regular_rate),"/hr"]}),e.jsx("td",{className:"text-right",children:E.overtime_hours||"-"}),e.jsx("td",{className:"text-right",children:E.overtime_hours?`$${ja(E.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:Ce(E.total)})]},ue))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ce(J.labor_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"5",className:"text-right",children:["+ ",Ut(f.labor_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ce(J.labor_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"5",className:"text-right",children:e.jsx("strong",{children:"Labor Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ce(J.labor_subtotal+J.labor_markup_amount)})})]})]})]})})]}),f.change_order_materials?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(ps,{size:18}),e.jsx("h4",{children:"Materials"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:f.change_order_materials.map((E,ue)=>e.jsxs("tr",{children:[e.jsx("td",{children:E.description}),e.jsx("td",{children:E.source_reference||E.source_type}),e.jsx("td",{className:"text-right",children:E.quantity}),e.jsx("td",{children:E.unit}),e.jsxs("td",{className:"text-right",children:["$",ja(E.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ce(E.total)})]},ue))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ce(J.materials_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",Ut(f.materials_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ce(J.materials_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Materials Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ce(J.materials_subtotal+J.materials_markup_amount)})})]})]})]})})]}),f.change_order_equipment?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Ka,{size:18}),e.jsx("h4",{children:"Equipment"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:f.change_order_equipment.map((E,ue)=>e.jsxs("tr",{children:[e.jsx("td",{children:E.description}),e.jsx("td",{children:E.source_reference||E.source_type}),e.jsx("td",{className:"text-right",children:E.quantity}),e.jsx("td",{children:E.unit}),e.jsxs("td",{className:"text-right",children:["$",ja(E.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ce(E.total)})]},ue))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ce(J.equipment_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",Ut(f.equipment_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ce(J.equipment_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Equipment Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ce(J.equipment_subtotal+J.equipment_markup_amount)})})]})]})]})})]}),f.change_order_subcontractors?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(pn,{size:18}),e.jsx("h4",{children:"Subcontractors"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:f.change_order_subcontractors.map((E,ue)=>e.jsxs("tr",{children:[e.jsx("td",{children:E.company_name}),e.jsx("td",{children:E.description}),e.jsx("td",{children:E.source_reference||E.source_type}),e.jsx("td",{className:"text-right",children:Ce(E.total)})]},ue))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ce(J.subcontractors_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"2",className:"text-right",children:["+ ",Ut(f.subcontractors_markup_percent||500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ce(J.subcontractors_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"2",className:"text-right",children:e.jsx("strong",{children:"Subcontractors Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ce(J.subcontractors_subtotal+J.subcontractors_markup_amount)})})]})]})]})})]}),T.length>0&&e.jsxs("div",{className:"cor-section cor-backup-section",children:[e.jsxs("div",{className:"cor-section-header cor-backup-header",onClick:()=>le(!W),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"backup-header-left",children:[e.jsx(Aa,{size:18}),e.jsx("h4",{children:"Supporting T&M Documentation"}),e.jsxs("span",{className:"backup-count",children:[T.length," ticket",T.length!==1?"s":""]})]}),e.jsx("div",{className:"backup-header-toggle",children:W?e.jsx(ya,{size:20}):e.jsx(hs,{size:20})})]}),W&&e.jsx("div",{className:"backup-tickets-list",children:T.map((E,ue)=>{const Me=O.has(E.id),Te=E.t_and_m_workers?.reduce((te,ze)=>te+(parseFloat(ze.hours)||0)+(parseFloat(ze.overtime_hours)||0),0)||0;return e.jsxs("div",{className:"backup-ticket",children:[e.jsxs("div",{className:"backup-ticket-header",onClick:()=>{const te=new Set(O);Me?te.delete(E.id):te.add(E.id),U(te)},children:[e.jsxs("div",{className:"backup-ticket-info",children:[e.jsx("span",{className:"backup-ticket-date",children:Nr(E.work_date)}),E.ce_pco_number&&e.jsx("span",{className:"backup-ticket-ce",children:E.ce_pco_number}),e.jsxs("span",{className:"backup-ticket-summary",children:[E.t_and_m_workers?.length||0," workers  ",Te," hrs",E.photos?.length>0&&`  ${E.photos.length} photos`]})]}),e.jsx("div",{className:"backup-ticket-toggle",children:Me?e.jsx(ya,{size:16}):e.jsx(hs,{size:16})})]}),Me&&e.jsxs("div",{className:"backup-ticket-details",children:[E.t_and_m_workers?.length>0&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsxs("div",{className:"backup-detail-label",children:[e.jsx(oa,{size:14})," Workers"]}),e.jsx("div",{className:"backup-workers-list",children:E.t_and_m_workers.map((te,ze)=>e.jsxs("div",{className:"backup-worker",children:[e.jsxs("span",{className:"worker-name",children:[te.role&&te.role!=="Laborer"&&e.jsx("span",{className:"worker-role",children:te.role}),te.name]}),e.jsxs("span",{className:"worker-hours",children:[te.hours||0," hrs",parseFloat(te.overtime_hours)>0&&e.jsxs("span",{className:"worker-ot",children:[" + ",te.overtime_hours," OT"]})]})]},ze))})]}),E.notes&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsx("div",{className:"backup-detail-label",children:"Description"}),e.jsx("p",{className:"backup-notes",children:E.notes})]}),E.photos?.length>0&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsxs("div",{className:"backup-detail-label",children:[e.jsx(xl,{size:14})," Photos (",E.photos.length,")"]}),e.jsx("div",{className:"backup-photos-grid",children:E.photos.map((te,ze)=>e.jsx("a",{href:te,target:"_blank",rel:"noopener noreferrer",className:"backup-photo",children:e.jsx("img",{src:te,alt:`Photo ${ze+1}`,onError:Re=>{Re.target.onerror=null,Re.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiI+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=="}})},ze))})]})]})]},E.id)})}),e.jsxs("div",{className:"backup-note",children:[e.jsx(Hn,{size:14}),e.jsx("span",{children:"This documentation supports the work described in this Change Order Request."})]})]}),e.jsxs("div",{className:"cor-totals-card",children:[e.jsx("h4",{children:"COR Summary"}),e.jsxs("div",{className:"cor-totals-grid",children:[e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Ce(J.cor_subtotal)})]}),e.jsxs("div",{className:"cor-fees-section",children:[e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Liability Insurance (",Ut(f.liability_insurance_percent||144),")"]}),e.jsx("span",{children:Ce(J.liability_insurance_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Bond (",Ut(f.bond_percent||100),")"]}),e.jsx("span",{children:Ce(J.bond_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["City License Fee (",Ut(f.license_fee_percent||10),")"]}),e.jsx("span",{children:Ce(J.license_fee_amount)})]})]}),e.jsxs("div",{className:"cor-grand-total",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:Ce(J.cor_total)})]})]})]}),e.jsxs("div",{className:"cor-signature-section",children:[e.jsx("h4",{children:"Authorization"}),e.jsx("p",{className:"signature-instruction",children:"By signing below, you authorize the above change order request and agree to the terms and costs outlined."}),e.jsxs("div",{className:"signature-slots-grid",children:[e.jsxs("div",{className:`signature-slot-card ${k?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[k?e.jsx(ms,{size:20,className:"status-icon signed"}):e.jsx(hn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Signature 1  GC Authorization"})]}),k?e.jsxs("div",{className:"slot-signed-info",children:[k.signature_data&&e.jsx("img",{src:k.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:k.signer_name}),(k.signer_title||k.signer_company)&&e.jsxs("span",{className:"signer-org",children:[k.signer_title,k.signer_title&&k.signer_company&&"  ",k.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",Nr(k.signed_at)]})]}):e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>S(1),disabled:q,children:"Sign as GC"})]}),e.jsxs("div",{className:`signature-slot-card ${ie?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[ie?e.jsx(ms,{size:20,className:"status-icon signed"}):e.jsx(hn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Signature 2  Client Authorization"})]}),ie?e.jsxs("div",{className:"slot-signed-info",children:[ie.signature_data&&e.jsx("img",{src:ie.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:ie.signer_name}),(ie.signer_title||ie.signer_company)&&e.jsxs("span",{className:"signer-org",children:[ie.signer_title,ie.signer_title&&ie.signer_company&&"  ",ie.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",Nr(ie.signed_at)]})]}):e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>S(2),disabled:q,children:"Sign as Client"})]})]}),G&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(ms,{size:24}),e.jsx("p",{children:"This change order request has been fully signed by all parties."})]}),e.jsxs("div",{className:"cor-download-section",children:[e.jsx("h4",{children:"Download Your Copy"}),e.jsx("p",{className:"download-description",children:G?"Download a PDF copy of this fully signed COR including all T&M backup documentation.":"Download a PDF copy of this COR for your records. Signature status will be included."}),e.jsx("button",{className:"btn btn-primary download-btn",onClick:K,disabled:re,children:re?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"download-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(of,{size:18}),"Download COR + Backup"]})})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),v&&R&&e.jsx(Gp,{slot:R,documentType:u.document_type,documentTitle:`${f.cor_number} - ${f.title}`,onSave:y,onClose:()=>{x(!1),A(null)}})]})}function Pp(r,l,c,i,m){return e.jsxs("div",{className:`signature-slot-card ${l?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[l?e.jsx(ms,{size:20,className:"status-icon signed"}):e.jsx(hn,{size:20,className:"status-icon pending"}),e.jsxs("span",{className:"slot-label",children:["Signature ",r,"  ",c]})]}),l?e.jsxs("div",{className:"slot-signed-info",children:[e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:l.signer_name}),(l.signer_title||l.signer_company)&&e.jsxs("span",{className:"signer-org",children:[l.signer_title,l.signer_title&&l.signer_company&&"  ",l.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",Nr(l.signed_at)]})]}):e.jsxs("button",{className:"btn btn-primary sign-btn",onClick:()=>i(r),disabled:m,children:["Sign as ",r===1?"GC":"Client"]})]})}const jd=[{value:"member",label:"Member",icon:Md,description:"Standard access to projects"},{value:"administrator",label:"Administrator",icon:Fi,description:"Full control, can manage team"}],Qp=[{value:"Project Manager",label:"Project Manager"},{value:"Superintendent",label:"Superintendent"},{value:"Job Costing",label:"Job Costing"},{value:"Accounting",label:"Accounting"}];function Qy({company:r,user:l,onShowToast:c}){const[i,m]=p.useState("pending"),[u,g]=p.useState([]),[f,j]=p.useState(!0),[v,x]=p.useState(null),[R,A]=p.useState({}),[q,F]=p.useState({});p.useEffect(()=>{r?.id&&B()},[r?.id]);const B=async()=>{try{j(!0);const D=await ee.getCompanyMemberships(r.id);g(D)}catch(D){console.error("Error loading members:",D),c("Error loading team members","error")}finally{j(!1)}},I=async D=>{const _=q[D.id];if(!_){c("Please select a role for this member","error");return}try{x(D.id);const y=R[D.id]||"member";await ee.approveMembershipWithRole(D.id,l.id,y),await ee.updateMemberCompanyRole(D.id,_),c(`${D.users?.name||D.users?.email} approved as ${_}`,"success"),A(S=>{const K={...S};return delete K[D.id],K}),F(S=>{const K={...S};return delete K[D.id],K}),B()}catch(y){console.error("Error approving membership:",y),c("Error approving request","error")}finally{x(null)}},re=(D,_)=>{A(y=>({...y,[D]:_}))},w=(D,_)=>{F(y=>({...y,[D]:_}))},T=async(D,_)=>{try{x(D.id),await ee.updateMemberCompanyRole(D.id,_),c(`${D.users?.name||"User"} role updated to ${_}`,"success"),B()}catch(y){console.error("Error updating company role:",y),c("Error updating role","error")}finally{x(null)}},C=async(D,_)=>{if(D.users?.id===l.id&&_!=="administrator"){c("You cannot demote yourself","error");return}try{x(D.id),await ee.updateMemberAccessLevel(D.id,_);const y=jd.find(S=>S.value===_)?.label||_;c(`${D.users?.name||"User"} is now ${y}`,"success"),B()}catch(y){console.error("Error updating access level:",y),c("Error updating access level","error")}finally{x(null)}},W=async D=>{try{x(D.id),await ee.rejectMembership(D.id),c("Request rejected","success"),B()}catch(_){console.error("Error rejecting membership:",_),c("Error rejecting request","error")}finally{x(null)}},le=async D=>{if(D.users?.id===l.id){c("You cannot remove yourself","error");return}try{x(D.id),await ee.removeMember(D.id,l.id),c(`${D.users?.name||D.users?.email} removed`,"success"),B()}catch(_){console.error("Error removing member:",_),c("Error removing member","error")}finally{x(null)}},O=u.filter(D=>i==="all"?!0:D.status===i),U=u.filter(D=>D.status==="pending").length,Y=u.filter(D=>D.status==="active").length,J=u.filter(D=>D.status==="removed").length;return f?e.jsx("div",{className:"membership-manager",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading team members..."]})}):e.jsxs("div",{className:"membership-manager",children:[e.jsxs("div",{className:"membership-header",children:[e.jsxs("h2",{children:[e.jsx(Os,{size:24})," Team Members"]}),e.jsxs("p",{className:"membership-subtitle",children:["Manage who has access to ",r?.name]})]}),U>0&&e.jsxs("div",{className:"pending-alert",children:[e.jsx(jl,{size:20}),e.jsxs("span",{children:[U," pending request",U>1?"s":""," awaiting approval"]})]}),e.jsxs("div",{className:"tm-filter-tabs",children:[e.jsxs("button",{className:`tm-filter-tab ${i==="pending"?"active":""}`,onClick:()=>m("pending"),children:["Pending",e.jsx("span",{className:"tm-filter-count",children:U})]}),e.jsxs("button",{className:`tm-filter-tab ${i==="active"?"active":""}`,onClick:()=>m("active"),children:["Active",e.jsx("span",{className:"tm-filter-count",children:Y})]}),e.jsxs("button",{className:`tm-filter-tab ${i==="removed"?"active":""}`,onClick:()=>m("removed"),children:["Removed",e.jsx("span",{className:"tm-filter-count",children:J})]})]}),e.jsx("div",{className:"member-list",children:O.length===0?e.jsxs("div",{className:"member-empty",children:[i==="pending"&&"No pending requests",i==="active"&&"No active members",i==="removed"&&"No removed members"]}):O.map(D=>e.jsxs("div",{className:`member-card ${D.status}`,children:[e.jsxs("div",{className:"member-info",children:[e.jsxs("div",{className:"member-name",children:[D.users?.name||"Unknown",D.users?.id===l.id&&e.jsx("span",{className:"member-you",children:"(You)"})]}),e.jsx("div",{className:"member-email",children:D.users?.email}),e.jsxs("div",{className:"member-meta",children:[D.status==="pending"&&e.jsxs(e.Fragment,{children:["Requested ",new Date(D.created_at).toLocaleDateString()]}),D.status==="active"&&D.approved_at&&e.jsxs(e.Fragment,{children:["Approved ",new Date(D.approved_at).toLocaleDateString()]}),D.status==="active"&&!D.approved_at&&e.jsxs(e.Fragment,{children:["Member since ",new Date(D.created_at).toLocaleDateString()]}),D.status==="removed"&&D.removed_at&&e.jsxs(e.Fragment,{children:["Removed ",new Date(D.removed_at).toLocaleDateString()]})]}),D.status==="active"&&e.jsxs("div",{className:"member-badges",children:[D.access_level==="administrator"?e.jsxs("span",{className:"access-badge admin",children:[e.jsx(Fi,{size:12})," Administrator"]}):e.jsxs("span",{className:"access-badge member",children:[e.jsx(Md,{size:12})," Member"]}),D.company_role&&e.jsxs("span",{className:"access-badge role",children:[e.jsx(pn,{size:12})," ",D.company_role]})]})]}),e.jsxs("div",{className:"member-actions",children:[D.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"role-selector",children:[e.jsxs("select",{value:q[D.id]||"",onChange:_=>w(D.id,_.target.value),disabled:v===D.id,className:"role-select",children:[e.jsx("option",{value:"",children:"Select Role..."}),Qp.map(_=>e.jsx("option",{value:_.value,children:_.label},_.value))]}),e.jsx(ya,{size:14,className:"role-select-icon"})]}),e.jsxs("div",{className:"role-selector",children:[e.jsx("select",{value:R[D.id]||"member",onChange:_=>re(D.id,_.target.value),disabled:v===D.id,className:"role-select",children:jd.map(_=>e.jsx("option",{value:_.value,children:_.label},_.value))}),e.jsx(ya,{size:14,className:"role-select-icon"})]}),e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>I(D),disabled:v===D.id,children:v===D.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(pf,{size:16})," Approve"]})}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>W(D),disabled:v===D.id,children:v===D.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(Uv,{size:16})," Reject"]})})]}),D.status==="active"&&D.users?.id!==l.id&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"role-selector",children:[e.jsxs("select",{value:D.company_role||"",onChange:_=>T(D,_.target.value),disabled:v===D.id,className:"role-select",children:[e.jsx("option",{value:"",children:"No Role"}),Qp.map(_=>e.jsx("option",{value:_.value,children:_.label},_.value))]}),e.jsx(ya,{size:14,className:"role-select-icon"})]}),e.jsxs("div",{className:"role-selector",children:[e.jsx("select",{value:D.access_level||"member",onChange:_=>C(D,_.target.value),disabled:v===D.id,className:"role-select",children:jd.map(_=>e.jsx("option",{value:_.value,children:_.label},_.value))}),e.jsx(ya,{size:14,className:"role-select-icon"})]}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>le(D),disabled:v===D.id,children:v===D.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(ff,{size:16})," Remove"]})})]})]})]},D.id))})]})}function Xy({company:r,projects:l,userId:c,onNotificationClick:i,onShowToast:m}){const[u,g]=p.useState([]),[f,j]=p.useState(0),[v,x]=p.useState(!1),[R,A]=p.useState(!1),[q,F]=p.useState({}),B=p.useRef(null);p.useRef(null);const I=p.useRef(null);p.useEffect(()=>{c&&re()},[c]);const re=async()=>{try{const _=await ee.getUserNotificationPreferences(c),y={};_.forEach(S=>{y[S.project_id]=S.notification_types||[]}),F(y)}catch(_){console.error("Error loading user preferences:",_)}},w=(_,y)=>q[_]?q[_].length===0?!1:q[_].includes(y):!0;p.useEffect(()=>{if(!r?.id||!l||l.length===0)return;T();const _=C();return()=>{_&&ee.unsubscribe(_)}},[r?.id,l,q]),p.useEffect(()=>()=>{I.current&&(I.current.close().catch(()=>{}),I.current=null)},[]),p.useEffect(()=>{function _(y){B.current&&!B.current.contains(y.target)&&x(!1)}return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[]);const T=async()=>{if(!l||l.length===0)return;const _=[];for(const y of l)try{w(y.id,"message")&&(await ee.getMessages(y.id,20)).filter(k=>k.sender_type==="field"&&!k.is_read).forEach(k=>{_.push({id:`msg-${k.id}`,type:"message",title:"New Message",message:k.message?.slice(0,50)+(k.message?.length>50?"...":""),projectId:y.id,projectName:y.name,senderName:k.sender_name,createdAt:k.created_at,isRead:k.is_read,data:k})}),w(y.id,"material_request")&&(await ee.getMaterialRequests(y.id,"pending")).forEach(K=>{_.push({id:`req-${K.id}`,type:"material_request",title:"Material Request",message:`${K.items?.length||0} items requested`,projectId:y.id,projectName:y.name,senderName:K.requested_by,priority:K.priority,createdAt:K.created_at,isRead:!1,data:K})})}catch(S){console.error("Error loading notifications for project:",y.id,S)}try{(await ee.getCompanyInjuryReports(r.id,"open")).slice(0,5).forEach(S=>{if(w(S.project_id,"injury_report")){const K=l.find(k=>k.id===S.project_id);_.push({id:`injury-${S.id}`,type:"injury_report",title:"Safety Report",message:`${S.injury_type} - ${S.injured_person_name}`,projectId:S.project_id,projectName:K?.name||"Unknown Project",senderName:S.reported_by_name,createdAt:S.created_at,isRead:S.status!=="open",data:S})}})}catch(y){console.error("Error loading injury reports:",y)}_.sort((y,S)=>new Date(S.createdAt)-new Date(y.createdAt)),g(_.slice(0,50)),j(_.filter(y=>!y.isRead).length)},C=()=>{if(!r?.id||!l||l.length===0)return null;const _=l.map(S=>S.id),y=ee.subscribeToCompanyActivity(r.id,_,{onMessage:S=>{if(S.new?.sender_type==="field"){if(!w(S.new.project_id,"message"))return;W({id:`msg-${S.new.id}`,type:"message",title:"New Message",message:S.new.message?.slice(0,50)+(S.new.message?.length>50?"...":""),projectId:S.new.project_id,projectName:l.find(K=>K.id===S.new.project_id)?.name||"Project",senderName:S.new.sender_name,createdAt:S.new.created_at,isRead:!1,data:S.new})}},onMaterialRequest:S=>{w(S.new.project_id,"material_request")&&W({id:`req-${S.new.id}`,type:"material_request",title:"Material Request",message:`${S.new.items?.length||0} items requested`,projectId:S.new.project_id,projectName:l.find(K=>K.id===S.new.project_id)?.name||"Project",senderName:S.new.requested_by,priority:S.new.priority,createdAt:S.new.created_at,isRead:!1,data:S.new})},onTMTicket:S=>{if(S.eventType==="INSERT"){if(!w(S.new.project_id,"tm_ticket"))return;W({id:`tm-${S.new.id}`,type:"tm_ticket",title:"New T&M Ticket",message:`Submitted by ${S.new.created_by_name||"Field"}`,projectId:S.new.project_id,projectName:l.find(K=>K.id===S.new.project_id)?.name||"Project",senderName:S.new.created_by_name,createdAt:S.new.created_at,isRead:!1,data:S.new})}},onInjuryReport:S=>{w(S.new.project_id,"injury_report")&&W({id:`injury-${S.new.id}`,type:"injury_report",title:"Safety Report",message:`${S.new.injury_type} - ${S.new.injured_person_name}`,projectId:S.new.project_id,projectName:l.find(K=>K.id===S.new.project_id)?.name||"Project",senderName:S.new.reported_by_name,createdAt:S.new.created_at,isRead:!1,data:S.new})}});return y&&A(!0),y},W=_=>{g(S=>[_,...S.slice(0,49)]),j(S=>S+1),le();const y=O(_.type);m?.(`${y} ${_.title}: ${_.message}`,"info")},le=()=>{try{(!I.current||I.current.state==="closed")&&(I.current=new(window.AudioContext||window.webkitAudioContext));const _=I.current;_.state==="suspended"&&_.resume();const y=_.createOscillator(),S=_.createGain();y.connect(S),S.connect(_.destination),y.frequency.value=800,y.type="sine",S.gain.value=.3,y.start(),y.stop(_.currentTime+.15),setTimeout(()=>{if(!I.current||I.current.state==="closed")return;const K=I.current.createOscillator(),k=I.current.createGain();K.connect(k),k.connect(I.current.destination),K.frequency.value=1e3,K.type="sine",k.gain.value=.3,K.start(),K.stop(I.current.currentTime+.15)},150)}catch{}},O=_=>{switch(_){case"message":return e.jsx(Rs,{size:16});case"material_request":return e.jsx(ps,{size:16});case"injury_report":return e.jsx(Hn,{size:16});case"tm_ticket":return e.jsx(Ja,{size:16});default:return e.jsx(ij,{size:16})}},U=_=>{switch(_){case"message":return"blue";case"material_request":return"orange";case"injury_report":return"red";case"tm_ticket":return"green";default:return"gray"}},Y=_=>{g(y=>y.map(S=>S.id===_.id?{...S,isRead:!0}:S)),j(y=>Math.max(0,y-1)),x(!1),i?.(_)},J=async()=>{for(const _ of l)try{await ee.markMessagesRead(_.id,"office")}catch{}g(_=>_.map(y=>({...y,isRead:!0}))),j(0)},D=_=>{const y=new Date(_),K=new Date-y,k=Math.floor(K/6e4),ie=Math.floor(K/36e5),M=Math.floor(K/864e5);return k<1?"Just now":k<60?`${k}m ago`:ie<24?`${ie}h ago`:M<7?`${M}d ago`:y.toLocaleDateString()};return e.jsxs("div",{className:"notification-center",ref:B,children:[e.jsxs("button",{className:`notification-bell ${f>0?"has-notifications":""}`,onClick:()=>x(!v),title:`${f} unread notifications`,children:[e.jsx("span",{className:"bell-icon",children:""}),f>0&&e.jsx("span",{className:"notification-badge",children:f>99?"99+":f}),R&&e.jsx("span",{className:"connection-dot"})]}),v&&e.jsxs("div",{className:"notification-dropdown",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h4",{children:"Notifications"}),f>0&&e.jsx("button",{className:"mark-all-read",onClick:J,children:"Mark all read"})]}),e.jsx("div",{className:"notification-list",children:u.length===0?e.jsxs("div",{className:"notification-empty",children:[e.jsx("span",{className:"empty-icon",children:""}),e.jsx("p",{children:"No notifications yet"}),e.jsx("small",{children:"You'll see updates from the field here"})]}):u.map(_=>e.jsxs("div",{className:`notification-item ${_.isRead?"read":"unread"} ${U(_.type)}`,onClick:()=>Y(_),children:[e.jsx("div",{className:"notification-icon",children:O(_.type)}),e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"notification-title",children:[_.title,_.priority==="urgent"&&e.jsx("span",{className:"priority-badge urgent",children:"URGENT"})]}),e.jsx("div",{className:"notification-message",children:_.message}),e.jsxs("div",{className:"notification-meta",children:[e.jsx("span",{className:"notification-project",children:_.projectName}),e.jsx("span",{className:"notification-time",children:D(_.createdAt)})]})]}),!_.isRead&&e.jsx("div",{className:"unread-dot"})]},_.id))}),u.length>0&&e.jsx("div",{className:"notification-footer",children:e.jsx("button",{className:"view-all-btn",onClick:()=>{x(!1),i?.({type:"view_all"})},children:"View All Activity"})})]})]})}class _r extends p.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0}}componentDidCatch(l,c){this.setState({error:l,errorInfo:c}),console.error("ErrorBoundary caught an error:",l,c)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("div",{className:"error-icon",children:e.jsx(jl,{size:48})}),e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),e.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function Xp(){const[r,l]=p.useState(fl()),[c,i]=p.useState(0),[m,u]=p.useState(!1),[g,f]=p.useState(!1);return p.useEffect(()=>{const j=tf(async x=>{l(x),x&&g&&(u(!0),setTimeout(()=>u(!1),3e3)),x||f(!0);const R=await td();i(R)});td().then(i);const v=setInterval(async()=>{if(!fl()){const x=await td();i(x)}},5e3);return()=>{j(),clearInterval(v)}},[g]),r&&c===0&&!m?null:e.jsxs("div",{className:`offline-indicator ${r?"online":"offline"} ${m?"synced":""}`,children:[e.jsx("div",{className:"offline-indicator-content",children:r?m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"online-icon",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):c>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"syncing-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),e.jsxs("span",{className:"offline-text",children:["Syncing ",c,"..."]})]}):null:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"offline-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),e.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),e.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),e.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),e.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),e.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),e.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),e.jsxs("span",{className:"offline-text",children:["Offline",c>0&&e.jsxs("span",{className:"pending-badge",children:[c," pending"]})]})]})}),e.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function Iy(){const[r,l]=p.useState("entry"),[c,i]=p.useState(null),[m,u]=p.useState(null),[g,f]=p.useState([]),[j,v]=p.useState([]),[x,R]=p.useState(null),[A,q]=p.useState(null),[F,B]=p.useState(null),[I,re]=p.useState(!0),[w,T]=p.useState("dashboard"),[C,W]=p.useState(null),[le,O]=p.useState(!1),[U,Y]=p.useState(null),[J,D]=p.useState(0);p.useEffect(()=>{const te=window.location.pathname,ze=te.match(/^\/view\/([a-zA-Z0-9_-]+)$/),Re=te.match(/^\/sign\/([a-zA-Z0-9_-]+)$/);ze?(q(ze[1]),l("public"),re(!1)):Re?(B(Re[1]),l("signature"),re(!1)):_()},[]);const _=async()=>{try{const{data:{user:te}}=await z.auth.getUser();if(!te){re(!1);return}const{data:ze,error:Re}=await z.from("users").select("*").eq("id",te.id).single();if(ze){i(ze);let qe=await ee.getUserCompanies(te.id);if(qe.length===0&&ze.company_id&&(console.log("Legacy user detected, attempting repair..."),await ee.repairLegacyUser(te.id,ze.company_id,ze.role||"member")&&(qe=await ee.getUserCompanies(te.id),console.log("Legacy user repaired, companies:",qe.length))),f(qe),qe.length===0){if(await ee.getUserPendingMemberships(te.id)>0){l("pending");return}M("No company access. Join a company to continue.","error"),await Cp.signOut();return}const Ie=localStorage.getItem("selectedCompanyId");let Ct=null;if(Ie&&qe.find(nt=>nt.id===Ie)?Ct=qe.find(nt=>nt.id===Ie):qe.length>0&&(Ct=qe[0]),Ct){const{data:nt}=await z.from("companies").select("*").eq("id",Ct.id).single();u(nt),l("office")}}}catch(te){console.error("Auth check error:",te)}finally{re(!1)}},y=te=>{R(te),l("foreman")},S=async(te,ze)=>{try{const{data:Re,error:qe}=await z.auth.signInWithPassword({email:te,password:ze});if(qe){M(qe.message||"Invalid credentials","error");return}const{data:Ie,error:Ct}=await z.from("users").select("*").eq("id",Re.user.id).single();if(Ct){console.error("User fetch error:",Ct),M("Error loading profile","error");return}if(Ie){i(Ie);let nt=await ee.getUserCompanies(Re.user.id);nt.length===0&&Ie.company_id&&(console.log("Legacy user detected on login, attempting repair..."),await ee.repairLegacyUser(Re.user.id,Ie.company_id,Ie.role||"member")&&(nt=await ee.getUserCompanies(Re.user.id),console.log("Legacy user repaired on login, companies:",nt.length))),f(nt);const jt=localStorage.getItem("selectedCompanyId");let Ht=null;if(jt&&nt.find(pt=>pt.id===jt)?Ht=nt.find(pt=>pt.id===jt):nt.length>0&&(Ht=nt[0]),Ht){const{data:pt}=await z.from("companies").select("*").eq("id",Ht.id).single();u(pt),l("office")}else await ee.getUserPendingMemberships(Re.user.id)>0?l("pending"):M("No company access. Please contact admin.","error")}else M("Profile not found. Please contact admin.","error")}catch(Re){console.error("Login error:",Re),M("Login failed","error")}},K=async te=>{try{const{data:ze}=await z.from("companies").select("*").eq("id",te).single();ze&&(u(ze),localStorage.setItem("selectedCompanyId",te),O(!1),T("dashboard"),M(`Switched to ${ze.name}`,"success"))}catch(ze){console.error("Switch company error:",ze),M("Error switching company","error")}},k=async()=>{try{await Cp.signOut(),i(null),u(null),f([]),l("entry"),T("dashboard"),localStorage.removeItem("selectedCompanyId")}catch(te){console.error("Logout error:",te),M("Error signing out","error")}},ie=()=>{R(null),l("entry")},M=(te,ze="")=>{W({message:te,type:ze})},G=()=>{T("dashboard"),m?.id&&L()},L=async()=>{if(m?.id)try{const te=await ee.getProjects(m.id);v(te)}catch(te){console.error("Error loading projects:",te)}};p.useEffect(()=>{m?.id&&r==="office"&&(L(),P())},[m?.id,r]);const P=async()=>{if(m?.id)try{const ze=(await ee.getCompanyMemberships(m.id)).filter(Re=>Re.status==="pending").length;D(ze)}catch(te){console.error("Error loading pending count:",te)}},$=te=>{if(te.type==="view_all"){T("dashboard"),Y(null);return}T("dashboard"),te.projectId&&Y(te.projectId)},E=()=>{Y(null)};if(I)return e.jsx(zn,{children:e.jsx(Rn,{companyId:m?.id,children:e.jsxs("div",{className:"loading-screen",children:[e.jsx(ls,{className:"loading-logo"}),e.jsx("div",{className:"spinner"})]})})});if(r==="entry")return e.jsx(zn,{children:e.jsxs(Rn,{children:[e.jsx(_r,{children:e.jsx(Yv,{onForemanAccess:y,onOfficeLogin:S,onShowToast:M})}),C&&e.jsx(As,{message:C.message,type:C.type,onClose:()=>W(null)})]})});if(r==="public"&&A)return e.jsx(zn,{children:e.jsxs(Rn,{children:[e.jsx(_r,{children:e.jsx(Yy,{shareToken:A})}),C&&e.jsx(As,{message:C.message,type:C.type,onClose:()=>W(null)})]})});if(r==="signature"&&F)return e.jsx(zn,{children:e.jsxs(Rn,{children:[e.jsx(_r,{children:e.jsx(Py,{signatureToken:F})}),C&&e.jsx(As,{message:C.message,type:C.type,onClose:()=>W(null)})]})});if(r==="pending")return e.jsx(zn,{children:e.jsxs(Rn,{children:[e.jsx(_r,{children:e.jsxs("div",{className:"pending-approval-screen",children:[e.jsx(ls,{className:"pending-logo"}),e.jsx("h2",{children:"Awaiting Approval"}),e.jsx("p",{children:"Your membership request has been submitted."}),e.jsx("p",{children:"A company admin will review your request."}),e.jsxs("div",{className:"pending-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:k,children:"Sign Out"}),e.jsx("button",{className:"btn btn-primary",onClick:_,children:"Check Status"})]})]})}),C&&e.jsx(As,{message:C.message,type:C.type,onClose:()=>W(null)})]})});if(r==="foreman"&&x)return e.jsx(zn,{children:e.jsxs(Rn,{companyId:x.company_id,children:[e.jsx(_r,{children:e.jsx(ry,{project:x,companyId:x.company_id,onShowToast:M,onExit:ie})}),e.jsx(Xp,{}),C&&e.jsx(As,{message:C.message,type:C.type,onClose:()=>W(null)})]})});const Te=g.find(te=>te.id===m?.id)?.access_level==="administrator"||m?.owner_user_id===c?.id;return e.jsx(zn,{children:e.jsx(Rn,{companyId:m?.id,children:e.jsxs("div",{children:[!Q&&e.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),e.jsx("nav",{className:"nav",children:e.jsxs("div",{className:"nav-content",children:[e.jsx(ls,{}),e.jsxs("div",{className:"nav-tabs",children:[e.jsx("button",{className:`nav-tab ${w==="dashboard"?"active":""}`,onClick:()=>T("dashboard"),children:"Dashboard"}),e.jsx("button",{className:`nav-tab ${w==="setup"?"active":""}`,onClick:()=>T("setup"),children:"+ New Project"}),e.jsx("button",{className:`nav-tab ${w==="pricing"?"active":""}`,onClick:()=>T("pricing"),children:"Pricing"}),Te&&e.jsx("button",{className:`nav-tab ${w==="branding"?"active":""}`,onClick:()=>T("branding"),children:"Branding"}),Te&&e.jsxs("button",{className:`nav-tab ${w==="team"?"active":""}`,onClick:()=>T("team"),children:["Team",J>0&&e.jsx("span",{className:"nav-tab-badge",children:J})]})]}),e.jsxs("div",{className:"nav-user",children:[e.jsx(vf,{compact:!0}),e.jsx(Xy,{company:m,projects:j,userId:c?.id,onNotificationClick:$,onShowToast:M}),g.length>1&&e.jsxs("div",{className:"company-switcher",children:[e.jsxs("button",{className:"company-switcher-btn",onClick:()=>O(!le),children:[m?.name||"Select Company",e.jsx("span",{className:"switcher-arrow",children:""})]}),le&&e.jsx("div",{className:"company-dropdown",children:g.map(te=>e.jsxs("button",{className:`company-option ${te.id===m?.id?"active":""}`,onClick:()=>K(te.id),children:[te.name,te.id===m?.id&&e.jsx("span",{className:"check",children:""})]},te.id))})]}),g.length<=1&&m&&e.jsx("span",{className:"nav-company-name",children:m.name}),e.jsx("span",{className:"nav-user-name",children:c?.name||c?.email}),e.jsx("button",{className:"nav-logout",onClick:k,children:"Sign Out"})]})]})}),e.jsx(_r,{children:e.jsxs("div",{className:"container",children:[w==="dashboard"&&e.jsx(zy,{company:m,user:c,isAdmin:Te,onShowToast:M,navigateToProjectId:U,onProjectNavigated:E}),w==="setup"&&e.jsx(Oy,{company:m,user:c,onProjectCreated:G,onShowToast:M}),w==="pricing"&&e.jsx(Vy,{company:m,onShowToast:M}),w==="branding"&&e.jsx(Ly,{company:m,onShowToast:M}),w==="team"&&Te&&e.jsx(Qy,{company:m,user:c,onShowToast:M})]},m?.id)}),e.jsx(Xp,{}),C&&e.jsx(As,{message:C.message,type:C.type,onClose:()=>W(null)})]})})})}Bx.createRoot(document.getElementById("root")).render(e.jsx(zx.StrictMode,{children:e.jsx(Iy,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(r=>{console.log("SW registered:",r.scope),setInterval(()=>{r.update()},6e4)}).catch(r=>{console.log("SW registration failed:",r)})});
