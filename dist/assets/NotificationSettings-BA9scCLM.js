import{d as m,j as e}from"./index-DqPazBpc.js";import{r,as as T,a5 as A,a as q,q as _}from"./icons-CQuOocZj.js";import"./react-DXGY7bZi.js";import"./pdf-aQqpMATS.js";import"./supabase-VuevzHjS.js";const f=[{id:"message",label:"Messages",Icon:T,description:"Chat messages from field"},{id:"material_request",label:"Material Requests",Icon:A,description:"Equipment and material requests"},{id:"injury_report",label:"Safety Reports",Icon:q,description:"Injury and safety incident reports"},{id:"tm_ticket",label:"T&M Tickets",Icon:_,description:"Time and materials tickets"}];function R({project:c,company:o,onShowToast:p,onClose:l}){const[h,y]=r.useState([]),[g,d]=r.useState({}),[u,v]=r.useState([]),[b,x]=r.useState(!0),[j,N]=r.useState(!1);r.useEffect(()=>{S()},[c?.id,o?.id]);const S=async()=>{if(!(!c?.id||!o?.id))try{x(!0);const s=await m.getCompanyUsers(o.id);y(s);const i=await m.getProjectNotificationPreferences(c.id),n={};i.forEach(t=>{n[t.user_id]={types:t.notification_types||[],presetId:null}}),d(n);const a=await m.getNotificationPresets(o.id);v(a)}catch(s){console.error("Error loading notification settings:",s),p?.("Error loading notification settings","error")}finally{x(!1)}},P=(s,i)=>{d(n=>{const a=n[s]||{types:[]},t=a.types.includes(i)?a.types.filter(I=>I!==i):[...a.types,i];return{...n,[s]:{types:t,presetId:null}}})},k=(s,i)=>{const n=u.find(a=>a.id===i);n&&d(a=>({...a,[s]:{types:[...n.notification_types],presetId:i}}))},C=(s,i)=>{d(n=>({...n,[s]:{types:i?f.map(a=>a.id):[],presetId:null}}))},E=async()=>{try{N(!0);const s=Object.entries(g).map(([i,n])=>({userId:i,notificationTypes:n.types}));await m.setProjectNotificationPreferences(c.id,s),p?.("Notification settings saved","success"),l?.()}catch(s){console.error("Error saving notification settings:",s),p?.("Error saving notification settings","error")}finally{N(!1)}};return b?e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsx("button",{className:"close-btn",onClick:l,children:"×"})]}),e.jsx("div",{className:"loading-message",children:"Loading..."})]}):e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsxs("h3",{children:["Notification Settings for ",c?.name]}),e.jsx("button",{className:"close-btn",onClick:l,children:"×"})]}),e.jsx("p",{className:"settings-description",children:"Choose who receives notifications when field workers send messages, request materials, submit safety reports, or create T&M tickets for this project."}),h.length===0?e.jsxs("div",{className:"no-users-message",children:[e.jsx("p",{children:"No users found in this company."}),e.jsx("small",{children:"Users need to be added to the company to receive notifications."})]}):e.jsx("div",{className:"notification-users-list",children:h.map(s=>{const i=g[s.id]||{types:[],presetId:null},n=i.types.length===f.length,a=i.types.length>0&&!n;return e.jsxs("div",{className:"notification-user-row",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:s.name?.charAt(0).toUpperCase()||s.email?.charAt(0).toUpperCase()}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:s.name||s.email}),s.role&&e.jsx("span",{className:"user-role",children:s.role})]})]}),e.jsxs("div",{className:"notification-controls",children:[e.jsxs("select",{className:"preset-select",value:i.presetId||"",onChange:t=>t.target.value&&k(s.id,t.target.value),children:[e.jsx("option",{value:"",children:"Apply preset..."}),u.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("button",{className:`toggle-all-btn ${n?"all-on":a?"some-on":""}`,onClick:()=>C(s.id,!n),title:n?"Disable all":"Enable all",children:n?"All On":a?"Some":"None"})]}),e.jsx("div",{className:"notification-types",children:f.map(t=>e.jsxs("label",{className:`notification-type-toggle ${i.types.includes(t.id)?"active":""}`,title:t.description,children:[e.jsx("input",{type:"checkbox",checked:i.types.includes(t.id),onChange:()=>P(s.id,t.id)}),e.jsx("span",{className:"type-icon",children:e.jsx(t.Icon,{size:16})}),e.jsx("span",{className:"type-label",children:t.label})]},t.id))})]},s.id)})}),e.jsxs("div",{className:"notification-settings-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:l,children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:E,disabled:j,children:j?"Saving...":"Save Settings"})]})]})}export{R as default};
//# sourceMappingURL=NotificationSettings-BA9scCLM.js.map
