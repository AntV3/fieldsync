import{d as h,j as e}from"./index-DRoKgDCS.js";import{r as c}from"./router-CeQ1XyMZ.js";import{g as E,D,c as ot,L as Ie,W as it,f as j,C as Me,p as R,h as O,v as Ee,i as ut,j as Te}from"./corCalculations-vdJc_BOT.js";import{X as Le,h as fe,F as $e,w as dt,aa as mt,p as pt,u as Pe,C as Fe,b as ht,ab as je,r as be,au as _t,av as jt}from"./icons-CvO0oR7x.js";import"./pdf-rft6H0l9.js";import"./supabase-Ce1s_jZn.js";const Ne=()=>{const k=new Uint8Array(6);return crypto.getRandomValues(k),Array.from(k,L=>L.toString(36)).join("")};function bt({projectId:k,corId:L,onImport:V,onClose:o,onShowToast:S}){const[$,N]=c.useState([]),[X,U]=c.useState(!0),[b,Y]=c.useState(new Set),[ve,J]=c.useState(null),[q,xe]=c.useState(""),[d,I]=c.useState("unassigned");c.useEffect(()=>{T()},[k]);const T=async()=>{try{const r=await h.getTMTickets(k);N(r||[])}catch(r){console.error("Error loading tickets:",r),S?.("Error loading tickets","error")}finally{U(!1)}},y=c.useMemo(()=>{let r=[...$];if(d==="unassigned"?r=r.filter(i=>!i.assigned_cor_id):d==="approved"&&(r=r.filter(i=>i.status==="approved")),q){const i=q.toLowerCase();r=r.filter(m=>m.work_description?.toLowerCase().includes(i)||m.ce_pco_number?.toLowerCase().includes(i)||m.ticket_date?.includes(i))}return r.sort((i,m)=>new Date(m.ticket_date)-new Date(i.ticket_date)),r},[$,d,q]),W=r=>{const i=new Set(b);i.has(r)?i.delete(r):i.add(r),Y(i)},ge=()=>{b.size===y.length?Y(new Set):Y(new Set(y.map(r=>r.id)))},P=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),ye=r=>{const i=r.t_and_m_workers||r.workers||[],m=r.t_and_m_items||r.items||[],_=i.length,l=m.length,v=m.filter(u=>{const M=(u.materials_equipment?.category||u.category||"").toLowerCase();return M==="equipment"||M==="rental"}).length;let F=0;return i.forEach(u=>{F+=(parseFloat(u.regular_hours)||parseFloat(u.hours)||0)+(parseFloat(u.overtime_hours)||0)}),{workerCount:_,itemCount:l,equipmentCount:v,laborHours:F}},B=()=>{if(b.size===0){S?.("Please select at least one ticket","error");return}const r=$.filter(l=>b.has(l.id)),i=[],m=[],_=[];r.forEach(l=>{(l.t_and_m_workers||l.workers||[]).forEach(u=>{i.push({id:`import-${l.id}-${u.id||Date.now()}-${Ne()}`,worker_name:u.name||u.worker_name||"",labor_class:u.role||u.labor_class||"Laborer",wage_type:"standard",regular_hours:parseFloat(u.regular_hours)||parseFloat(u.hours)||0,overtime_hours:parseFloat(u.overtime_hours)||0,regular_rate:parseFloat(u.regular_rate)||0,overtime_rate:parseFloat(u.overtime_rate)||0,total:0,source_ticket_id:l.id,source_ticket_date:l.ticket_date||l.work_date})}),(l.t_and_m_items||l.items||[]).forEach(u=>{const M=u.materials_equipment||{},z=u.custom_name||M.name||u.description||u.name||"Unnamed item",ae=u.unit||M.unit||"each",C=parseFloat(u.unit_cost)||parseFloat(M.cost_per_unit)||0,G=parseFloat(u.quantity)||1,A=(M.category||u.category||"").toLowerCase();A==="equipment"||A==="rental"?_.push({id:`import-${l.id}-${u.id||Date.now()}-${Ne()}`,description:z,source_type:"T&M Ticket",source_reference:`T&M #${l.id?.slice(-6)||""} - ${P(l.ticket_date||l.work_date)}`,quantity:G,unit:ae,unit_cost:E(C),total:E(G*C),source_ticket_id:l.id}):m.push({id:`import-${l.id}-${u.id||Date.now()}-${Ne()}`,description:z,source_type:"T&M Ticket",source_reference:`T&M #${l.id?.slice(-6)||""} - ${P(l.ticket_date||l.work_date)}`,quantity:G,unit:ae,unit_cost:E(C),total:E(G*C),source_ticket_id:l.id})})}),V?.({ticketIds:Array.from(b),laborItems:i,materialsItems:m,equipmentItems:_}),o?.()};return X?e.jsx("div",{className:"modal-overlay",onClick:o,role:"dialog","aria-modal":"true","aria-label":"Loading tickets",children:e.jsx("div",{className:"modal-content ticket-selector-modal",onClick:r=>r.stopPropagation(),children:e.jsx("div",{className:"loading",role:"status","aria-live":"polite",children:"Loading tickets..."})})}):e.jsx("div",{className:"modal-overlay",onClick:o,role:"dialog","aria-modal":"true","aria-labelledby":"ticket-selector-title",children:e.jsxs("div",{className:"modal-content ticket-selector-modal",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"ticket-selector-title",children:"Import from T&M Tickets"}),e.jsx("button",{className:"close-btn",onClick:o,"aria-label":"Close ticket selector",children:e.jsx(Le,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"ticket-selector-controls",children:[e.jsxs("div",{className:"ticket-search",children:[e.jsx(fe,{size:16,"aria-hidden":"true"}),e.jsx("input",{type:"text",placeholder:"Search tickets...",value:q,onChange:r=>xe(r.target.value),"aria-label":"Search tickets"})]}),e.jsxs("div",{className:"ticket-filters",role:"group","aria-label":"Filter tickets by status",children:[e.jsx("button",{className:`filter-btn ${d==="unassigned"?"active":""}`,onClick:()=>I("unassigned"),"aria-pressed":d==="unassigned",children:"Unassigned"}),e.jsx("button",{className:`filter-btn ${d==="approved"?"active":""}`,onClick:()=>I("approved"),"aria-pressed":d==="approved",children:"Approved"}),e.jsx("button",{className:`filter-btn ${d==="all"?"active":""}`,onClick:()=>I("all"),"aria-pressed":d==="all",children:"All"})]})]}),e.jsxs("div",{className:"ticket-selector-header",children:[e.jsxs("label",{className:"select-all",children:[e.jsx("input",{type:"checkbox",checked:b.size===y.length&&y.length>0,onChange:ge,"aria-label":`Select all ${y.length} tickets`}),e.jsxs("span",{children:["Select All (",y.length,")"]})]}),e.jsxs("span",{className:"selected-count",children:[b.size," selected"]})]}),e.jsx("div",{className:"modal-body ticket-selector-body",children:y.length===0?e.jsxs("div",{className:"ticket-empty",children:[e.jsx($e,{size:32}),e.jsx("p",{children:"No tickets found"}),d==="unassigned"&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>I("all"),children:"Show all tickets"})]}):e.jsx("div",{className:"ticket-list",children:y.map(r=>{const i=ye(r),m=b.has(r.id),_=ve===r.id;return e.jsxs("div",{className:`ticket-item ${m?"selected":""} ${r.assigned_cor_id?"assigned":""}`,children:[e.jsxs("div",{className:"ticket-item-main",children:[e.jsx("label",{className:"ticket-checkbox",children:e.jsx("input",{type:"checkbox",checked:m,onChange:()=>W(r.id),disabled:r.assigned_cor_id&&r.assigned_cor_id!==L})}),e.jsxs("div",{className:"ticket-item-info",onClick:()=>J(_?null:r.id),children:[e.jsxs("div",{className:"ticket-item-header",children:[e.jsx("span",{className:"ticket-date",children:P(r.ticket_date)}),e.jsx("span",{className:`ticket-status ${r.status}`,children:r.status}),r.ce_pco_number&&e.jsxs("span",{className:"ticket-pco",children:["CE/PCO: ",r.ce_pco_number]})]}),e.jsx("div",{className:"ticket-item-desc",children:r.work_description||"No description"}),e.jsxs("div",{className:"ticket-item-summary",children:[i.workerCount>0&&e.jsxs("span",{children:[e.jsx(dt,{size:12})," ",i.workerCount," workers"]}),i.itemCount>0&&e.jsxs("span",{children:[e.jsx(mt,{size:12})," ",i.itemCount," items"]}),i.equipmentCount>0&&e.jsxs("span",{children:[e.jsx(pt,{size:12})," ",i.equipmentCount," equipment"]}),i.laborHours>0&&e.jsxs("span",{children:[i.laborHours," hrs"]})]})]}),e.jsx("button",{className:"ticket-expand-btn",onClick:()=>J(_?null:r.id),children:_?e.jsx(Pe,{size:16}):e.jsx(Fe,{size:16})})]}),_&&e.jsxs("div",{className:"ticket-item-details",children:[(r.t_and_m_workers||r.workers)?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Workers"}),e.jsx("ul",{children:(r.t_and_m_workers||r.workers).map((l,v)=>e.jsxs("li",{children:[l.name||l.role," - ",l.regular_hours||0," reg hrs",l.overtime_hours>0&&`, ${l.overtime_hours} OT hrs`]},v))})]}),(r.t_and_m_items||r.items)?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Materials"}),e.jsx("ul",{children:(r.t_and_m_items||r.items).map((l,v)=>e.jsxs("li",{children:[l.description||l.name," - ",l.quantity," ",l.unit]},v))})]}),r.materials_equipment?.filter(l=>l.type==="equipment").length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Equipment"}),e.jsx("ul",{children:r.materials_equipment.filter(l=>l.type==="equipment").map((l,v)=>e.jsx("li",{children:l.description||l.name},v))})]})]})]},r.id)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:o,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:B,disabled:b.size===0,children:[e.jsx(ht,{size:16})," Import ",b.size," Ticket",b.size!==1?"s":""]})]})]})})}function yt({project:k,company:L,areas:V,existingCOR:o,onClose:S,onSaved:$,onShowToast:N}){const[X,U]=c.useState(!1),[b,Y]=c.useState([]),[ve,J]=c.useState(!1),[q,xe]=c.useState([]),[d,I]=c.useState({labor:o?.change_order_labor?.length>0,materials:o?.change_order_materials?.length>0,equipment:o?.change_order_equipment?.length>0,subcontractors:o?.change_order_subcontractors?.length>0,markups:!1}),[T,y]=c.useState([]),[W,ge]=c.useState(""),[P,ye]=c.useState("all"),[B,r]=c.useState(""),[i,m]=c.useState(o?.title||""),[_,l]=c.useState(o?.scope_of_work||""),[v,F]=c.useState(o?.cor_number||""),[u,M]=c.useState(o?.group_name||""),[z,ae]=c.useState(o?.area_id||""),[C,G]=c.useState(o?.period_start||""),[A,Ce]=c.useState(o?.period_end||""),[f,re]=c.useState(o?.change_order_labor||[]),[x,K]=c.useState(o?.change_order_materials||[]),[g,Z]=c.useState(o?.change_order_equipment||[]),[w,ke]=c.useState(o?.change_order_subcontractors||[]),[ne,ze]=c.useState(o?.labor_markup_percent??D.labor_markup),[le,Ae]=c.useState(o?.materials_markup_percent??D.materials_markup),[ce,De]=c.useState(o?.equipment_markup_percent??D.equipment_markup),[oe,Re]=c.useState(o?.subcontractors_markup_percent??D.subcontractors_markup),[ie,Oe]=c.useState(o?.liability_insurance_percent??D.liability_insurance),[ue,Ue]=c.useState(o?.bond_percent??D.bond),[de,We]=c.useState(o?.license_fee_percent??D.license_fee);c.useEffect(()=>{Xe(),Be(),o||Ye()},[]);const Be=async()=>{try{const t=await h.getAllMaterialsEquipment(L?.id);y(t||[])}catch(t){console.error("Error loading company materials:",t)}},Ge=c.useMemo(()=>T.filter(t=>!["Containment","PPE","Disposal"].includes(t.category)||t.active===!1||P!=="all"&&t.category!==P?!1:W?t.name.toLowerCase().includes(W.toLowerCase()):!0),[T,W,P]),He=c.useMemo(()=>T.filter(t=>t.category!=="Equipment"||t.active===!1?!1:B?t.name.toLowerCase().includes(B.toLowerCase()):!0),[T,B]),Qe=t=>{K([...x,{description:t.name,source_type:"field_ticket",source_reference:"",quantity:1,unit:t.unit||"each",unit_cost:t.cost_per_unit||0,total:t.cost_per_unit||0}])},Ve=t=>{Z([...g,{description:t.name,source_type:"rental",source_reference:"",quantity:1,unit:t.unit||"day",unit_cost:t.cost_per_unit||0,total:t.cost_per_unit||0}])},Xe=async()=>{try{const t=await h.getLaborRates?.(L?.id,k?.work_type,k?.job_type);Y(t||[])}catch(t){console.error("Error loading labor rates:",t)}},we=t=>{const a=t?.toLowerCase()||"";return b.find(s=>s.role?.toLowerCase()===a)||null},Ye=async()=>{try{const t=await h.getNextCORNumber?.(k.id);F(t||`COR-${Date.now()}`)}catch(t){console.error("Error generating COR number:",t),F(`COR-${Date.now()}`)}},ee=t=>{I(a=>({...a,[t]:!a[t]}))},me=c.useMemo(()=>({title:i,scope_of_work:_,area_id:z||null,cor_number:v,group_name:u||null,period_start:C||null,period_end:A||null,change_order_labor:f,change_order_materials:x,change_order_equipment:g,change_order_subcontractors:w,labor_markup_percent:ne,materials_markup_percent:le,equipment_markup_percent:ce,subcontractors_markup_percent:oe,liability_insurance_percent:ie,bond_percent:ue,license_fee_percent:de}),[i,_,z,v,u,C,A,f,x,g,w,ne,le,ce,oe,ie,ue,de]),p=c.useMemo(()=>ot(me),[me]),Je=()=>{const t=Ie[0],a=we(t);re([...f,{id:`temp-${Date.now()}`,labor_class:t,wage_type:"standard",regular_hours:0,overtime_hours:0,regular_rate:a?Math.round((parseFloat(a.regular_rate)||0)*100):0,overtime_rate:a?Math.round((parseFloat(a.overtime_rate)||0)*100):0,total:0}]),d.labor||ee("labor")},H=(t,a,s)=>{const n=[...f];if(n[t]={...n[t],[a]:s},a==="labor_class"){const se=we(s);se&&(n[t].regular_rate=Math.round((parseFloat(se.regular_rate)||0)*100),n[t].overtime_rate=Math.round((parseFloat(se.overtime_rate)||0)*100))}const{total:Q}=ut(n[t].regular_hours,n[t].overtime_hours,n[t].regular_rate,n[t].overtime_rate);n[t].total=Q,re(n)},Ke=t=>{re(f.filter((a,s)=>s!==t))},Ze=()=>{K([...x,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"each",unit_cost:0,total:0}]),d.materials||ee("materials")},pe=(t,a,s)=>{const n=[...x];n[t]={...n[t],[a]:s},n[t].total=Te(n[t].quantity,n[t].unit_cost),K(n)},et=t=>{K(x.filter((a,s)=>s!==t))},tt=()=>{Z([...g,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"day",unit_cost:0,total:0}]),d.equipment||ee("equipment")},he=(t,a,s)=>{const n=[...g];n[t]={...n[t],[a]:s},n[t].total=Te(n[t].quantity,n[t].unit_cost),Z(n)},st=t=>{Z(g.filter((a,s)=>s!==t))},at=()=>{ke([...w,{id:`temp-${Date.now()}`,company_name:"",description:"",source_type:"invoice",source_reference:"",amount:0,total:0}]),d.subcontractors||ee("subcontractors")},_e=(t,a,s)=>{const n=[...w];n[t]={...n[t],[a]:s},a==="amount"&&(n[t].total=parseInt(s)||0),ke(n)},rt=t=>{ke(w.filter((a,s)=>s!==t))},nt=t=>{t.ticketIds?.length>0&&xe(s=>[...new Set([...s,...t.ticketIds])]),t.laborItems?.length>0&&(re([...f,...t.laborItems]),I(s=>({...s,labor:!0}))),t.materialsItems?.length>0&&(K([...x,...t.materialsItems]),I(s=>({...s,materials:!0}))),t.equipmentItems?.length>0&&(Z([...g,...t.equipmentItems]),I(s=>({...s,equipment:!0})));const a=(t.laborItems?.length||0)+(t.materialsItems?.length||0)+(t.equipmentItems?.length||0);N?.(`Imported ${a} item(s) from ${t.ticketIds.length} ticket(s)`,"success")},Se=i.trim().length>0,qe=()=>({company_id:L.id,project_id:k.id,title:i,scope_of_work:_||"",area_id:z||null,cor_number:v,group_name:u||null,period_start:C||new Date().toISOString().split("T")[0],period_end:A||new Date().toISOString().split("T")[0],labor_markup_percent:ne,materials_markup_percent:le,equipment_markup_percent:ce,subcontractors_markup_percent:oe,liability_insurance_percent:ie,bond_percent:ue,license_fee_percent:de,...p}),lt=async()=>{if(!Se){N?.("Title is required","error");return}U(!0);try{const t={...qe(),status:"draft"};let a;if(o?.id?a=await h.updateCOR(o.id,t):a=await h.createCOR(t),a?.id&&(await h.saveCORLineItems(a.id,{laborItems:f,materialItems:x,equipmentItems:g,subcontractorItems:w}),q.length>0)){const s=[];for(const n of q)try{await h.assignTicketToCOR(n,a.id)}catch(Q){`${n}`,s.push(n)}if(s.length>0){N?.(`COR saved, but ${s.length} ticket(s) could not be linked. Re-open to retry.`,"warning"),$?.(a),S?.();return}}N?.("COR saved as draft","success"),$?.(a),S?.()}catch(t){console.error("Error saving COR:",t),N?.("Error saving COR","error")}finally{U(!1)}},ct=async()=>{const t=Ee(me);if(!t.valid){N?.(t.errors[0],"error");return}U(!0);try{const a={...qe(),status:"draft"};let s,n;if(o?.id?(s=await h.updateCOR(o.id,a),n=o.id,await h.saveCORLineItems(o.id,{laborItems:f,materialItems:x,equipmentItems:g,subcontractorItems:w}),await h.submitCORForApproval(o.id)):(s=await h.createCOR(a),s?.id&&(n=s.id,await h.saveCORLineItems(s.id,{laborItems:f,materialItems:x,equipmentItems:g,subcontractorItems:w}),await h.submitCORForApproval(s.id))),n&&q.length>0)for(const Q of q)try{await h.assignTicketToCOR(Q,n)}catch(se){`${Q}`}N?.("COR submitted for approval","success"),$?.(s),S?.()}catch(a){console.error("Error submitting COR:",a),N?.("Error submitting COR","error")}finally{U(!1)}},te=({section:t,label:a,count:s,subtotal:n})=>e.jsxs("div",{className:`cor-section-header ${d[t]?"expanded":""}`,onClick:()=>ee(t),children:[e.jsxs("div",{className:"cor-section-title",children:[d[t]?e.jsx(Pe,{size:18}):e.jsx(Fe,{size:18}),e.jsx("span",{children:a}),s>0&&e.jsx("span",{className:"cor-section-count",children:s})]}),n>0&&e.jsx("span",{className:"cor-section-subtotal",children:j(n)})]});return e.jsxs("div",{className:"modal-overlay",onClick:S,children:[e.jsxs("div",{className:"modal-content cor-form-modal cor-form-simplified",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:o?"Edit Change Order Request":"New Change Order Request"}),e.jsx("button",{className:"close-btn",onClick:S,children:e.jsx(Le,{size:20})})]}),e.jsxs("div",{className:"modal-body cor-form-body",children:[e.jsxs("div",{className:"cor-form-required",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group cor-number-field",children:[e.jsx("label",{children:"COR #"}),e.jsx("input",{type:"text",value:v,onChange:t=>F(t.target.value),className:"input-small"})]}),e.jsxs("div",{className:"form-group flex-grow required",children:[e.jsx("label",{children:"Title"}),e.jsx("input",{type:"text",value:i,onChange:t=>m(t.target.value),placeholder:"e.g., Additional Demolition Work - Building A",className:"input-required"})]})]}),e.jsxs("div",{className:"form-group required",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:_,onChange:t=>l(t.target.value),rows:2,placeholder:"Describe the scope of work",className:"input-required"})]}),e.jsxs("div",{className:"form-row form-row-compact",children:[V&&V.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Area"}),e.jsxs("select",{value:z,onChange:t=>ae(t.target.value),children:[e.jsx("option",{value:"",children:"None"}),V.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Group"}),e.jsx("input",{type:"text",value:u,onChange:t=>M(t.target.value),placeholder:"e.g., Phase 1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"date",value:C,onChange:t=>G(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"date",value:A,onChange:t=>Ce(t.target.value),min:C})]})]})]}),e.jsx("div",{className:"cor-import-bar",children:e.jsxs("button",{className:"btn btn-ghost",onClick:()=>J(!0),children:[e.jsx($e,{size:16})," Import from T&M Tickets"]})}),e.jsxs("div",{className:"cor-sections",children:[e.jsxs("div",{className:"cor-section",children:[e.jsx(te,{section:"labor",label:"Labor",count:f.length,subtotal:p.labor_subtotal}),d.labor&&e.jsxs("div",{className:"cor-section-content",children:[f.map((t,a)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("select",{value:t.labor_class,onChange:s=>H(a,"labor_class",s.target.value),children:Ie.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("select",{value:t.wage_type,onChange:s=>H(a,"wage_type",s.target.value),children:it.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Reg hrs",value:t.regular_hours||"",onChange:s=>H(a,"regular_hours",s.target.value),className:"input-small"}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"$/hr",value:t.regular_rate?(t.regular_rate/100).toFixed(2):"",onChange:s=>{const n=s.target.value;H(a,"regular_rate",E(n))},className:"input-small"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"OT hrs",value:t.overtime_hours||"",onChange:s=>H(a,"overtime_hours",s.target.value),className:"input-small"}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"$/hr",value:t.overtime_rate?(t.overtime_rate/100).toFixed(2):"",onChange:s=>{const n=s.target.value;H(a,"overtime_rate",E(n))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:j(t.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>Ke(a),children:e.jsx(je,{size:14})})]})},t.id||a)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:Je,children:[e.jsx(be,{size:14})," Add Labor"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(te,{section:"materials",label:"Materials",count:x.length,subtotal:p.materials_subtotal}),d.materials&&e.jsxs("div",{className:"cor-section-content",children:[T.filter(t=>["Containment","PPE","Disposal"].includes(t.category)&&t.active!==!1).length>0&&e.jsxs("div",{className:"quick-select-compact",children:[e.jsxs("div",{className:"quick-select-search",children:[e.jsx(fe,{size:14}),e.jsx("input",{type:"text",placeholder:"Search materials...",value:W,onChange:t=>ge(t.target.value)})]}),e.jsx("div",{className:"quick-select-items",children:Ge.slice(0,8).map(t=>e.jsx("button",{className:"quick-item",onClick:()=>Qe(t),children:t.name},t.id))})]}),x.map((t,a)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Description",value:t.description,onChange:s=>pe(a,"description",s.target.value),className:"input-wide"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Qty",value:t.quantity||"",onChange:s=>pe(a,"quantity",s.target.value),className:"input-small"}),e.jsx("select",{value:t.unit,onChange:s=>pe(a,"unit",s.target.value),children:Me.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"$/unit",value:t.unit_cost?(t.unit_cost/100).toFixed(2):"",onChange:s=>{const n=s.target.value;pe(a,"unit_cost",E(n))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:j(t.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>et(a),children:e.jsx(je,{size:14})})]})},t.id||a)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:Ze,children:[e.jsx(be,{size:14})," Add Material"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(te,{section:"equipment",label:"Equipment",count:g.length,subtotal:p.equipment_subtotal}),d.equipment&&e.jsxs("div",{className:"cor-section-content",children:[T.filter(t=>t.category==="Equipment"&&t.active!==!1).length>0&&e.jsxs("div",{className:"quick-select-compact",children:[e.jsxs("div",{className:"quick-select-search",children:[e.jsx(fe,{size:14}),e.jsx("input",{type:"text",placeholder:"Search equipment...",value:B,onChange:t=>r(t.target.value)})]}),e.jsx("div",{className:"quick-select-items",children:He.slice(0,8).map(t=>e.jsx("button",{className:"quick-item",onClick:()=>Ve(t),children:t.name},t.id))})]}),g.map((t,a)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Description",value:t.description,onChange:s=>he(a,"description",s.target.value),className:"input-wide"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Qty",value:t.quantity||"",onChange:s=>he(a,"quantity",s.target.value),className:"input-small"}),e.jsx("select",{value:t.unit,onChange:s=>he(a,"unit",s.target.value),children:Me.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"$/unit",value:t.unit_cost?(t.unit_cost/100).toFixed(2):"",onChange:s=>{const n=s.target.value;he(a,"unit_cost",E(n))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:j(t.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>st(a),children:e.jsx(je,{size:14})})]})},t.id||a)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:tt,children:[e.jsx(be,{size:14})," Add Equipment"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(te,{section:"subcontractors",label:"Subcontractors",count:w.length,subtotal:p.subcontractors_subtotal}),d.subcontractors&&e.jsxs("div",{className:"cor-section-content",children:[w.map((t,a)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Company",value:t.company_name,onChange:s=>_e(a,"company_name",s.target.value),className:"input-wide"}),e.jsx("input",{type:"text",placeholder:"Description",value:t.description,onChange:s=>_e(a,"description",s.target.value),className:"input-wide"}),e.jsx("input",{type:"text",placeholder:"Invoice #",value:t.source_reference||"",onChange:s=>_e(a,"source_reference",s.target.value),className:"input-small"}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Amount",value:t.amount?(t.amount/100).toFixed(2):"",onChange:s=>{const n=s.target.value;_e(a,"amount",E(n))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:j(t.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>rt(a),children:e.jsx(je,{size:14})})]})},t.id||a)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:at,children:[e.jsx(be,{size:14})," Add Subcontractor"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(te,{section:"markups",label:"Markups & Fees",count:0,subtotal:p.total_markup_amount+p.total_fees}),d.markups&&e.jsxs("div",{className:"cor-section-content markups-content",children:[e.jsxs("div",{className:"markups-grid-compact",children:[e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Labor Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:O(ne),onChange:t=>ze(R(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",j(p.labor_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Materials Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:O(le),onChange:t=>Ae(R(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",j(p.materials_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Equipment Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:O(ce),onChange:t=>De(R(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",j(p.equipment_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Subcontractors Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:O(oe),onChange:t=>Re(R(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",j(p.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"fees-grid-compact",children:[e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Liability Insurance"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:O(ie),onChange:t=>Oe(R(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",j(p.liability_insurance_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Bond"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:O(ue),onChange:t=>Ue(R(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",j(p.bond_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"City License Fee"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:O(de),onChange:t=>We(R(t.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",j(p.license_fee_amount)]})]})]})]})]})]}),e.jsxs("div",{className:"cor-summary-bar",children:[e.jsxs("div",{className:"cor-summary-item",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:j(p.cor_subtotal)})]}),e.jsxs("div",{className:"cor-summary-item total",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:j(p.cor_total)})]})]})]}),e.jsxs("div",{className:"modal-footer cor-form-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:S,disabled:X,children:"Cancel"}),e.jsxs("div",{className:"footer-actions",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:lt,disabled:X||!Se,children:[e.jsx(_t,{size:16})," Save Draft"]}),e.jsxs("button",{className:"btn btn-primary",onClick:ct,disabled:X||!Ee(me).valid,children:[e.jsx(jt,{size:16})," Submit"]})]})]})]}),ve&&e.jsx(bt,{projectId:k.id,corId:o?.id,onImport:nt,onClose:()=>J(!1),onShowToast:N})]})}export{yt as default};
