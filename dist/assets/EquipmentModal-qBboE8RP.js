import{au as N,as as e}from"./index-DMf5Yfyv.js";import{r as a,l as R,X as L,q as U,Q as $,O as k,aC as Q}from"./icons-B-oSmWeD.js";import"./react-DXGY7bZi.js";import"./pdf-aQqpMATS.js";import"./supabase-VuevzHjS.js";const W=a.memo(function({project:P,company:m,user:z,editItem:s=null,onSave:T,onClose:p}){const[o,A]=a.useState([]),[B,h]=a.useState(!0),[x,q]=a.useState(!1),[y,j]=a.useState(""),[b,d]=a.useState(""),[E,c]=a.useState(""),[u,S]=a.useState(new Date().toISOString().split("T")[0]),[C,_]=a.useState(""),[D,F]=a.useState(""),[f,g]=a.useState(!1),r=!!s,w=a.useCallback(async()=>{if(!m?.id){h(!1);return}try{h(!0);const t=await N.getCompanyEquipment(m.id);A(t||[])}catch(t){console.error("Error loading equipment catalog:",t)}finally{h(!1)}},[m?.id]);a.useEffect(()=>{w()},[w]),a.useEffect(()=>{s&&(d(s.equipment_name||""),c(((s.daily_rate||0)/100).toFixed(2)),S(s.start_date||new Date().toISOString().split("T")[0]),_(s.end_date||""),F(s.notes||""),j(s.equipment_id||""),g(!s.equipment_id))},[s]);const M=t=>{const i=t.target.value;if(i==="custom"){g(!0),j(""),d(""),c("");return}g(!1),j(i);const l=o.find(n=>n.id===i);l&&(d(l.name),c(((l.daily_rate||0)/100).toFixed(2)))},O=async t=>{t.preventDefault();const i=b.trim();if(!i){alert("Please enter equipment name");return}const l=parseFloat(E);if(isNaN(l)||l<0){alert("Please enter a valid daily rate");return}if(!u){alert("Please select a start date");return}try{q(!0);const n={project_id:P.id,equipment_id:f?null:y||null,equipment_name:i,daily_rate:Math.round(l*100),start_date:u,end_date:C||null,notes:D.trim()||null,created_by:z?.id};let v;r?(delete n.project_id,delete n.created_by,v=await N.updateProjectEquipment(s.id,n)):v=await N.addEquipmentToProject(n),T?.(v)}catch(n){console.error("Error saving equipment:",n),alert("Failed to save equipment. Please try again.")}finally{q(!1)}};return e.jsx("div",{className:"modal-backdrop",onClick:p,children:e.jsxs("div",{className:"modal equipment-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(R,{size:20}),r?"Edit Equipment":"Add Equipment to Project"]}),e.jsx("button",{className:"modal-close",onClick:p,children:e.jsx(L,{size:20})})]}),e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"modal-body",children:[!r&&o.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Equipment"}),e.jsxs("div",{className:"select-wrapper",children:[e.jsxs("select",{value:f?"custom":y,onChange:M,className:"form-select",children:[e.jsx("option",{value:"",children:"Choose from catalog..."}),o.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - $",((t.daily_rate||0)/100).toFixed(0),"/day"]},t.id)),e.jsx("option",{value:"custom",children:"+ Add custom equipment"})]}),e.jsx(U,{size:16,className:"select-icon"})]})]}),(f||r||o.length===0)&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"equipment-name",children:"Equipment Name"}),e.jsx("input",{id:"equipment-name",type:"text",value:b,onChange:t=>d(t.target.value),placeholder:"e.g., CAT 320 Excavator",className:"form-input",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"daily-rate",children:[e.jsx($,{size:14}),"Daily Rate"]}),e.jsxs("div",{className:"input-with-prefix",children:[e.jsx("span",{className:"input-prefix",children:"$"}),e.jsx("input",{id:"daily-rate",type:"number",step:"0.01",min:"0",value:E,onChange:t=>c(t.target.value),placeholder:"0.00",className:"form-input",required:!0}),e.jsx("span",{className:"input-suffix",children:"/day"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"start-date",children:[e.jsx(k,{size:14}),"Start Date"]}),e.jsx("input",{id:"start-date",type:"date",value:u,onChange:t=>S(t.target.value),className:"form-input",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"end-date",children:[e.jsx(k,{size:14}),"End Date (optional)"]}),e.jsx("input",{id:"end-date",type:"date",value:C,onChange:t=>_(t.target.value),min:u,className:"form-input",placeholder:"Leave blank if still on site"}),e.jsx("span",{className:"form-help",children:"Leave blank if still on site"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"notes",children:"Notes (optional)"}),e.jsx("textarea",{id:"notes",value:D,onChange:t=>F(t.target.value),placeholder:"Equipment number, rental company, etc.",className:"form-textarea",rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:p,disabled:x,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading-spinner small"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:16}),r?"Update":"Add Equipment"]})})]})]})]})})});export{W as default};
//# sourceMappingURL=EquipmentModal-qBboE8RP.js.map
