import{E as M,a as _}from"./pdf-aQqpMATS.js";import{a as q,f as r,d as x,b as U}from"./corCalculations-vdJc_BOT.js";import{aG as w,aH as G,aU as j}from"./index-B5AOITmC.js";import"./icons-D1pGYcxw.js";import"./react-DXGY7bZi.js";import"./supabase-VuevzHjS.js";const A=c=>{if(!c)return"";const[v,u]=c.split(":"),m=parseInt(v),F=m>=12?"pm":"am";return`${m%12||12}:${u}${F}`},B=c=>c.time_started&&c.time_ended?`${A(c.time_started)} - ${A(c.time_ended)}`:"-";async function tt(c,v={}){const{project:u,company:m,branding:F={}}=v,n=c.corData,T=c.ticketsData||[],t=new M,s=t.internal.pageSize.getWidth(),f=t.internal.pageSize.getHeight(),o=20;let e=o;const h=F.primaryColor?w(F.primaryColor):[30,58,95];if(F.logoUrl)try{const l=await G(F.logoUrl);l&&t.addImage(l,"PNG",o,e,40,15)}catch{m?.name&&(t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(...h),t.text(m.name,o,e+8))}else m?.name&&(t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(...h),t.text(m.name,o,e+8));if(t.setFontSize(18),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("CHANGE ORDER REQUEST",s-o,e+5,{align:"right"}),t.setFontSize(12),t.setTextColor(...h),t.text(n.cor_number||"COR",s-o,e+12,{align:"right"}),e+=25,t.setDrawColor(...h),t.setLineWidth(.5),t.line(o,e,s-o,e),e+=10,t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text(n.title||"Untitled Change Order",o,e),e+=8,t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(71,85,105),u?.name&&(t.text(`Project: ${u.name}`,o,e),e+=5),u?.job_number&&(t.text(`Job #: ${u.job_number}`,o,e),e+=5),(n.period_start||n.period_end)&&(t.text(`Period: ${q(n.period_start,n.period_end)}`,o,e),e+=5),e+=5,n.scope_of_work){t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("Scope of Work:",o,e),e+=5,t.setFont("helvetica","normal"),t.setTextColor(51,65,85);const l=t.splitTextToSize(n.scope_of_work,s-o*2);t.text(l,o,e),e+=l.length*4+8}n.change_order_labor?.length>0&&(t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("Labor",o,e),e+=5,_(t,{startY:e,head:[["Class","Wage Type","Reg Hrs","Reg Rate","OT Hrs","OT Rate","Total"]],body:n.change_order_labor.map(l=>[l.labor_class,l.wage_type||"Standard",l.regular_hours?.toString()||"0",r(l.regular_rate),l.overtime_hours?.toString()||"0",r(l.overtime_rate),r(l.total)]),foot:[[{content:"Labor Subtotal",colSpan:6,styles:{halign:"right",fontStyle:"bold"}},{content:r(n.labor_subtotal),styles:{fontStyle:"bold"}}]],margin:{left:o,right:o},headStyles:{fillColor:h,textColor:[255,255,255],fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:[248,250,252],textColor:[30,41,59],fontSize:8},theme:"grid"}),e=t.lastAutoTable.finalY+10),n.change_order_materials?.length>0&&(e>f-60&&(t.addPage(),e=o),t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("Materials",o,e),e+=5,_(t,{startY:e,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:n.change_order_materials.map(l=>[l.description,l.source_reference||l.source_type||"-",l.quantity?.toString()||"1",l.unit||"ea",r(l.unit_cost),r(l.total)]),foot:[[{content:"Materials Subtotal",colSpan:5,styles:{halign:"right",fontStyle:"bold"}},{content:r(n.materials_subtotal),styles:{fontStyle:"bold"}}]],margin:{left:o,right:o},headStyles:{fillColor:h,textColor:[255,255,255],fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:[248,250,252],textColor:[30,41,59],fontSize:8},theme:"grid"}),e=t.lastAutoTable.finalY+10),n.change_order_equipment?.length>0&&(e>f-60&&(t.addPage(),e=o),t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("Equipment",o,e),e+=5,_(t,{startY:e,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:n.change_order_equipment.map(l=>[l.description,l.source_reference||l.source_type||"-",l.quantity?.toString()||"1",l.unit||"day",r(l.unit_cost),r(l.total)]),foot:[[{content:"Equipment Subtotal",colSpan:5,styles:{halign:"right",fontStyle:"bold"}},{content:r(n.equipment_subtotal),styles:{fontStyle:"bold"}}]],margin:{left:o,right:o},headStyles:{fillColor:h,textColor:[255,255,255],fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:[248,250,252],textColor:[30,41,59],fontSize:8},theme:"grid"}),e=t.lastAutoTable.finalY+10),n.change_order_subcontractors?.length>0&&(e>f-60&&(t.addPage(),e=o),t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("Subcontractors",o,e),e+=5,_(t,{startY:e,head:[["Company Name","Description","Source","Qty","Unit","Unit Cost","Total"]],body:n.change_order_subcontractors.map(l=>[l.company_name||"-",l.description,l.source_reference||l.source_type||"-",l.quantity?.toString()||"1",l.unit||"lump sum",r(l.unit_cost),r(l.total)]),foot:[[{content:"Subcontractors Subtotal",colSpan:6,styles:{halign:"right",fontStyle:"bold"}},{content:r(n.subcontractors_subtotal),styles:{fontStyle:"bold"}}]],margin:{left:o,right:o},headStyles:{fillColor:h,textColor:[255,255,255],fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:[248,250,252],textColor:[30,41,59],fontSize:8},theme:"grid"}),e=t.lastAutoTable.finalY+10),e>f-100&&(t.addPage(),e=o),t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("Cost Summary",o,e),e+=5;const Y=[["Labor Subtotal",r(n.labor_subtotal)],[`  Markup (${x(n.labor_markup_percent)})`,r(n.labor_markup_amount)],["Materials Subtotal",r(n.materials_subtotal)],[`  Markup (${x(n.materials_markup_percent)})`,r(n.materials_markup_amount)],["Equipment Subtotal",r(n.equipment_subtotal)],[`  Markup (${x(n.equipment_markup_percent)})`,r(n.equipment_markup_amount)],["Subcontractors Subtotal",r(n.subcontractors_subtotal)],[`  Markup (${x(n.subcontractors_markup_percent)})`,r(n.subcontractors_markup_amount)]];_(t,{startY:e,body:Y,margin:{left:o,right:o},columnStyles:{0:{cellWidth:120},1:{cellWidth:50,halign:"right"}},bodyStyles:{fontSize:9},theme:"plain"}),e=t.lastAutoTable.finalY+5,t.setFillColor(248,250,252),t.rect(o,e,s-o*2,8,"F"),t.setFont("helvetica","bold"),t.setFontSize(10),t.setTextColor(30,41,59),t.text("COR Subtotal:",o+5,e+5.5),t.text(r(n.cor_subtotal),s-o-5,e+5.5,{align:"right"}),e+=12;const N=[[`Liability Insurance (${x(n.liability_insurance_percent)})`,r(n.liability_insurance_amount)],[`Bond (${x(n.bond_percent)})`,r(n.bond_amount)],[`License Fee (${x(n.license_fee_percent)})`,r(n.license_fee_amount)]];if(_(t,{startY:e,body:N,margin:{left:o,right:o},columnStyles:{0:{cellWidth:120},1:{cellWidth:50,halign:"right"}},bodyStyles:{fontSize:9},theme:"plain"}),e=t.lastAutoTable.finalY+5,t.setFillColor(...h),t.rect(o,e,s-o*2,10,"F"),t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor(255,255,255),t.text("COR TOTAL:",o+5,e+7),t.text(r(n.cor_total),s-o-5,e+7,{align:"right"}),e+=20,T.length>0){t.addPage(),e=o,m?.name&&(t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(...h),t.text(m.name,o,e),e+=15),t.setDrawColor(...h),t.setLineWidth(.8),t.line(o,e,s-o,e),e+=3,t.setLineWidth(.3),t.line(o,e,s-o,e),e+=15,t.setFontSize(20),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("SUPPORTING DOCUMENTATION",s/2,e,{align:"center"}),e+=8,t.setFontSize(12),t.setFont("helvetica","normal"),t.setTextColor(71,85,105),t.text("Change Order Request Backup",s/2,e,{align:"center"}),e+=20,t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text(`COR Reference: ${n.cor_number}`,o,e),e+=6,t.setFont("helvetica","normal"),t.setTextColor(71,85,105),u?.name&&(t.text(`Project: ${u.name}`,o,e),e+=5),u?.job_number&&(t.text(`Job #: ${u.job_number}`,o,e),e+=5),e+=15,t.setFillColor(248,250,252),t.setDrawColor(226,232,240),t.roundedRect(o,e,s-o*2,55,3,3,"FD"),t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("DOCUMENTATION SUMMARY",o+10,e+12),t.setDrawColor(226,232,240),t.line(o+10,e+16,s-o-10,e+16);const l=o+15,S=o+80;let d=e+25;t.setFont("helvetica","normal"),t.setTextColor(71,85,105),t.text("T&M Tickets:",l,d),t.setFont("helvetica","bold"),t.text(String(T.length),S,d),t.setFont("helvetica","normal"),d+=7,t.text("Total Labor:",l,d),t.setFont("helvetica","bold"),t.text(`${c.totals.totalLaborHours.toFixed(1)} hrs`,S,d),t.setFont("helvetica","normal"),d+=7,c.totals.totalOTHours>0&&(t.text("Total OT:",l,d),t.setFont("helvetica","bold"),t.text(`${c.totals.totalOTHours.toFixed(1)} hrs`,S,d),t.setFont("helvetica","normal"),d+=7),t.text("Photo Evidence:",l,d),t.setFont("helvetica","bold"),t.text(`${c.totals.photoCount} photos`,S,d),t.setFont("helvetica","normal"),d+=7,t.text("Client Verified:",l,d),t.setFont("helvetica","bold");const W=c.totals.verifiedTicketCount>0?[16,185,129]:[71,85,105];t.setTextColor(...W),t.text(`${c.totals.verifiedTicketCount} of ${T.length} tickets`,S,d),e+=70,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(100,116,139);const I=new Date(c.createdAt);t.text(`Generated: ${I.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})} at ${I.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`,o,e),e+=6,t.text(`Document ID: ${c.checksum.substring(0,16).toUpperCase()}`,o,e);for(const i of T){t.addPage(),e=o;const E=!!i.client_signature_data,P=22,H=E?[16,185,129]:[245,158,11];if(t.setFillColor(...H),t.rect(o,e,4,P,"F"),t.setFillColor(248,250,252),t.rect(o+4,e,s-o*2-4,P,"F"),t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text(`T&M TICKET — ${U(i.work_date||i.ticket_date)}`,o+10,e+8),i.ce_pco_number&&(t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(59,130,246),t.text(`CE/PCO: ${i.ce_pco_number}`,o+10,e+16)),E&&(t.setFontSize(8),t.setFont("helvetica","bold"),t.setTextColor(16,185,129),t.text("✓ CLIENT VERIFIED",s-o-35,e+12)),e+=P+8,i.notes){t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("DESCRIPTION",o,e),e+=6,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(51,65,85);const a=t.splitTextToSize(i.notes,s-o*2);t.text(a,o,e),e+=a.length*4+10}if(i.t_and_m_workers?.length>0&&(t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("LABOR",o,e),e+=6,_(t,{startY:e,head:[["Worker","Time Period","Class","Reg Hrs","OT Hrs"]],body:i.t_and_m_workers.map(a=>[a.name,B(a),a.role||a.labor_class||"Laborer",a.hours?.toString()||"0",a.overtime_hours?.toString()||"-"]),margin:{left:o,right:o},headStyles:{fillColor:h,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),e=t.lastAutoTable.finalY+10),i.t_and_m_items?.length>0&&(e>f-60&&(t.addPage(),e=o),t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("MATERIALS / EQUIPMENT",o,e),t.setFontSize(7),t.setFont("helvetica","normal"),t.setTextColor(100,116,139),t.text("Source: T&M Ticket",o+55,e),e+=6,_(t,{startY:e,head:[["Item","Qty","Unit"]],body:i.t_and_m_items.map(a=>[a.custom_name||a.materials_equipment?.name||a.description||"Unnamed Item",a.quantity?.toString()||"1",a.materials_equipment?.unit||a.unit||"ea"]),margin:{left:o,right:o},headStyles:{fillColor:h,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),e=t.lastAutoTable.finalY+10),i.photos?.length>0){e>f-80&&(t.addPage(),e=o),t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("PHOTO DOCUMENTATION",o,e),t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(59,130,246),t.text(`${i.photos.length} photo${i.photos.length!==1?"s":""}`,o+50,e),e+=8;let a=o;const b=55,g=45,y=6,D=3,z=await j(i.photos);for(let C=0;C<i.photos.length;C++){C>0&&C%D===0&&(a=o,e+=g+y+4),e+g>f-20&&(t.addPage(),e=o,a=o);const p=z[C];p?(t.setDrawColor(200,200,200),t.setLineWidth(1),t.rect(a-1,e-1,b+2,g+2,"S"),t.setFillColor(230,230,230),t.rect(a+2,e+2,b,g,"F"),t.addImage(p,"JPEG",a,e,b,g)):(t.setFillColor(245,245,245),t.rect(a,e,b,g,"F"),t.setDrawColor(200,200,200),t.rect(a,e,b,g,"S"),t.setFontSize(7),t.setTextColor(150,150,150),t.text("Photo unavailable",a+8,e+g/2)),a+=b+y}e+=g+12}if(i.client_signature_data){e>f-50&&(t.addPage(),e=o);const a=32,b=s-o*2;t.setFillColor(240,253,244),t.roundedRect(o,e,b,a,3,3,"F"),t.setFillColor(16,185,129),t.rect(o,e,4,a,"F"),t.setDrawColor(187,247,208),t.setLineWidth(.5),t.line(o+4,e,o+b,e);const g=o+14,y=e+a/2;t.setFillColor(16,185,129),t.circle(g,y,6,"F"),t.setFontSize(9),t.setTextColor(255,255,255),t.text("✓",g-2.5,y+3),t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(16,185,129),t.text("CLIENT VERIFIED",o+26,e+10);try{t.addImage(i.client_signature_data,"PNG",o+26,e+13,50,16);const C=i.client_signature_name||"Client",p=i.client_signature_title||"",k=i.client_signature_company||"",L=i.client_signature_date?U(i.client_signature_date):"",R=o+85;t.setFont("helvetica","bold"),t.setFontSize(9),t.setTextColor(30,41,59),t.text(C,R,e+12),t.setFont("helvetica","normal"),t.setFontSize(8),t.setTextColor(71,85,105),(p||k)&&t.text(`${p}${p&&k?", ":""}${k}`,R,e+18),L&&(t.setTextColor(100,116,139),t.text(`Verified: ${L}`,R,e+24))}catch{const z=i.client_signature_name||"Client";t.setFont("helvetica","normal"),t.setFontSize(9),t.setTextColor(30,41,59),t.text(`Signed by: ${z}`,o+26,e+20)}}}}const $=t.internal.getNumberOfPages();for(let l=1;l<=$;l++){t.setPage(l);const S=f-10;t.setFontSize(8),t.setTextColor(150,150,150),t.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,o,S),t.setTextColor(180,180,180),t.text("Generated with FieldSync",s/2,S,{align:"center"}),t.setTextColor(150,150,150),t.text(`Page ${l} of ${$}`,s-o,S,{align:"right"})}const O=`${n.cor_number||"COR"}_${u?.job_number||"export"}${T.length?"_with_backup":""}.pdf`;return t.save(O),{success:!0,fileName:O,pageCount:$,sizeBytes:t.output().length}}export{tt as generatePDFFromSnapshot};
//# sourceMappingURL=corPdfGenerator-DXsrS88Q.js.map
