const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TMList-D_k_-ZDR.js","assets/pdf-aQqpMATS.js","assets/index-DRezeUop.js","assets/icons-Cj6BUtO0.js","assets/react-DXGY7bZi.js","assets/supabase-VuevzHjS.js","assets/index-Ct9GPi7W.css","assets/SignatureLinkGenerator-Jz8zByQJ.js","assets/corCalculations-D9qkkIbo.js","assets/ShareModal-wykV9g7D.js","assets/InjuryReportsList-lzqcQ_lB.js","assets/NotificationSettings-CpCD8CpG.js","assets/DailyReportsList-CBkX-0eh.js","assets/CORList-B4CeEbg2.js","assets/CORLog-BpqBPuo0.js","assets/CORForm-DzVaJrep.js","assets/CORDetail-CbZdYlSD.js","assets/SignatureCanvas-DmlbndF_.js","assets/CORLogPreview-Dla2Qg-q.js","assets/BillingCenter-D1htcYyM.js","assets/DrawRequestModal-DZd0Vm5z.js","assets/EquipmentModal-F3yczh2X.js","assets/AddCostModal-BMMBLFDK.js","assets/DocumentsTab-DbaF9QRd.js"])))=>i.map(i=>d[i]);
import{_ as ne}from"./pdf-aQqpMATS.js";import{r as rs,c as oa,a as kr,S as Sr,b as Dr,u as $e,s as _r,d as Er,e as Pr,f as Rr,g as Or,h as Ar,i as Tr,j as Ae,k as da,l as Mr,m as it,n as Fr,o as $r,p as Ir,D as Tt,q as ua,t as Lr,v as zr,w as qr,x as lt,y as Vr,z as Br,A as Mt,Z as Ft,L as ts,C as Wr,B as Ur,E as ye,F as ct,G as ma,H as Hr,I as Ms,J as ha,K as $t,M as It,N as Kr,O as Gr,P as pa,Q as xa,R as Yr,T as Jr,U as Lt,V as ot,W as Xr,X as Qr,Y as Zr,_ as ei,$ as si,a0 as ai,a1 as zt,a2 as ti,a3 as ni,a4 as ri,a5 as ii,a6 as li,a7 as ci,a8 as oi,a9 as di,aa as dt,ab as ut,ac as mt,ad as ui,ae as mi,af as hi,ag as Me,ah as pi,ai as xi,aj as vi,ak as qt,al as Zs,am as fi,an as ji,ao as gi,ap as bi,aq as yi,ar as z,as as e,at as Ni,au as Fe,av as va,aw as Vt,ax as Bt,ay as Wt,az as fa,aA as Ci,aB as wi,aC as ki,aD as Qe,aE as Si,aF as ht,aG as pt,aH as ae,aI as Di,aJ as _i,aK as Ei,aL as Pi}from"./index-DRezeUop.js";import{r as o,f as Ut,X as We,a4 as Ri,Y as ra,y as qe,F as Le,t as he,N as xe,a2 as Rs,T as Ve,a5 as Oi,a6 as Ai,H as Pe,z as Ti,o as ns,m as Re,q as Fs,s as is,O as Ht,R as Mi,a7 as Fi,a8 as Kt,a9 as $i,aa as ls,n as ja,K as cs,ab as Ii,ac as Ps,W as ia,k as Li,b as os,j as zi,ad as qi,ae as ea,af as Vi,d as xt,e as Gt,Q as es,ag as Yt,ah as Bi,ai as sa,a as la,L as vt,aj as ft,c as Wi,ak as Ui,al as Jt,am as Hi,D as _e,an as jt,ao as Ki,C as Gi,g as Yi,ap as Ji,aq as Xi,ar as Qi}from"./icons-Cj6BUtO0.js";import{f as oe}from"./corCalculations-D9qkkIbo.js";function Os(){return Os=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)({}).hasOwnProperty.call(n,t)&&(s[t]=n[t])}return s},Os.apply(null,arguments)}function gt(s,a){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,t)}return n}function Zi(s){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?gt(Object(n),!0).forEach(function(t){el(s,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):gt(Object(n)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(n,t))})}return s}function el(s,a,n){return(a=sl(a))in s?Object.defineProperty(s,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[a]=n,s}function sl(s){var a=al(s,"string");return typeof a=="symbol"?a:a+""}function al(s,a){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var t=n.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}var ce=32,tl={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function nl(s){var{data:a,iconType:n,inactiveColor:t}=s,r=ce/2,i=ce/6,l=ce/3,c=a.inactive?t:a.color,u=n??a.type;if(u==="none")return null;if(u==="plainline"){var m;return o.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:(m=a.payload)===null||m===void 0?void 0:m.strokeDasharray,x1:0,y1:r,x2:ce,y2:r,className:"recharts-legend-icon"})}if(u==="line")return o.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(r,"h").concat(l,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(2*l,",").concat(r,`
            H`).concat(ce,"M").concat(2*l,",").concat(r,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(l,",").concat(r),className:"recharts-legend-icon"});if(u==="rect")return o.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(ce/8,"h").concat(ce,"v").concat(ce*3/4,"h").concat(-ce,"z"),className:"recharts-legend-icon"});if(o.isValidElement(a.legendIcon)){var d=Zi({},a);return delete d.legendIcon,o.cloneElement(a.legendIcon,d)}return o.createElement(Dr,{fill:c,cx:r,cy:r,size:ce,sizeType:"diameter",type:u})}function rl(s){var{payload:a,iconSize:n,layout:t,formatter:r,inactiveColor:i,iconType:l}=s,c={x:0,y:0,width:ce,height:ce},u={display:t==="horizontal"?"inline-block":"block",marginRight:10},m={display:"inline-block",verticalAlign:"middle",marginRight:4};return a.map((d,x)=>{var f=d.formatter||r,y=oa({"recharts-legend-item":!0,["legend-item-".concat(x)]:!0,inactive:d.inactive});if(d.type==="none")return null;var h=d.inactive?i:d.color,p=f?f(d.value,d,x):d.value;return o.createElement("li",Os({className:y,style:u,key:"legend-item-".concat(x)},kr(s,d,x)),o.createElement(Sr,{width:n,height:n,viewBox:c,style:m,"aria-label":"".concat(p," legend icon")},o.createElement(nl,{data:d,iconType:l,inactiveColor:i})),o.createElement("span",{className:"recharts-legend-item-text",style:{color:h}},p))})}var il=s=>{var a=rs(s,tl),{payload:n,layout:t,align:r}=a;if(!n||!n.length)return null;var i={padding:0,margin:0,textAlign:t==="horizontal"?r:"left"};return o.createElement("ul",{className:"recharts-default-legend",style:i},o.createElement(rl,Os({},a,{payload:n})))};function ll(){return $e(_r)}var cl=["contextPayload"];function ca(){return ca=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)({}).hasOwnProperty.call(n,t)&&(s[t]=n[t])}return s},ca.apply(null,arguments)}function bt(s,a){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,t)}return n}function Be(s){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?bt(Object(n),!0).forEach(function(t){ol(s,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(n,t))})}return s}function ol(s,a,n){return(a=dl(a))in s?Object.defineProperty(s,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[a]=n,s}function dl(s){var a=ul(s,"string");return typeof a=="symbol"?a:a+""}function ul(s,a){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var t=n.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function ml(s,a){if(s==null)return{};var n,t,r=hl(s,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)===-1&&{}.propertyIsEnumerable.call(s,n)&&(r[n]=s[n])}return r}function hl(s,a){if(s==null)return{};var n={};for(var t in s)if({}.hasOwnProperty.call(s,t)){if(a.indexOf(t)!==-1)continue;n[t]=s[t]}return n}function pl(s){return s.value}function xl(s){var{contextPayload:a}=s,n=ml(s,cl),t=Fr(a,s.payloadUniqBy,pl),r=Be(Be({},n),{},{payload:t});return o.isValidElement(s.content)?o.cloneElement(s.content,r):typeof s.content=="function"?o.createElement(s.content,r):o.createElement(il,r)}function vl(s,a,n,t,r,i){var{layout:l,align:c,verticalAlign:u}=a,m,d;return(!s||(s.left===void 0||s.left===null)&&(s.right===void 0||s.right===null))&&(c==="center"&&l==="vertical"?m={left:((t||0)-i.width)/2}:m=c==="right"?{right:n&&n.right||0}:{left:n&&n.left||0}),(!s||(s.top===void 0||s.top===null)&&(s.bottom===void 0||s.bottom===null))&&(u==="middle"?d={top:((r||0)-i.height)/2}:d=u==="bottom"?{bottom:n&&n.bottom||0}:{top:n&&n.top||0}),Be(Be({},m),d)}function fl(s){var a=da();return o.useEffect(()=>{a(Mr(s))},[a,s]),null}function jl(s){var a=da();return o.useEffect(()=>(a(it(s)),()=>{a(it({width:0,height:0}))}),[a,s]),null}function gl(s,a,n,t){return s==="vertical"&&Ae(a)?{height:a}:s==="horizontal"?{width:n||t}:null}var bl={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function $s(s){var a=rs(s,bl),n=ll(),t=Er(),r=Pr(),{width:i,height:l,wrapperStyle:c,portal:u}=a,[m,d]=Rr([n]),x=Or(),f=Ar();if(x==null||f==null)return null;var y=x-(r?.left||0)-(r?.right||0),h=gl(a.layout,l,i,y),p=u?c:Be(Be({position:"absolute",width:h?.width||i||"auto",height:h?.height||l||"auto"},vl(c,a,r,x,f,m)),c),k=u??t;if(k==null||n==null)return null;var P=o.createElement("div",{className:"recharts-legend-wrapper",style:p,ref:d},o.createElement(fl,{layout:a.layout,align:a.align,verticalAlign:a.verticalAlign,itemSorter:a.itemSorter}),!u&&o.createElement(jl,{width:m.width,height:m.height}),o.createElement(xl,ca({},a,h,{margin:r,chartWidth:x,chartHeight:f,contextPayload:n})));return Tr.createPortal(P,k)}$s.displayName="Legend";function yt(s,a){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,t)}return n}function Nt(s){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?yt(Object(n),!0).forEach(function(t){yl(s,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(n,t))})}return s}function yl(s,a,n){return(a=Nl(a))in s?Object.defineProperty(s,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[a]=n,s}function Nl(s){var a=Cl(s,"string");return typeof a=="symbol"?a:a+""}function Cl(s,a){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var t=n.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function As(){return As=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)({}).hasOwnProperty.call(n,t)&&(s[t]=n[t])}return s},As.apply(null,arguments)}var wl=(s,a)=>{var n;if(o.isValidElement(s))n=o.cloneElement(s,a);else if(typeof s=="function")n=s(a);else{if(!ye(a.x1)||!ye(a.y1)||!ye(a.x2)||!ye(a.y2))return null;n=o.createElement("line",As({},a,{className:"recharts-reference-line-line"}))}return n},kl=(s,a,n,t,r,i)=>{var{x:l,width:c}=i,u=r.y.apply(s,{position:n});if(ma(u)||a==="discard"&&!r.y.isInRange(u))return null;var m=[{x:l+c,y:u},{x:l,y:u}];return t==="left"?m.reverse():m},Sl=(s,a,n,t,r,i)=>{var{y:l,height:c}=i,u=r.x.apply(s,{position:n});if(ma(u)||a==="discard"&&!r.x.isInRange(u))return null;var m=[{x:u,y:l+c},{x:u,y:l}];return t==="top"?m.reverse():m},Dl=(s,a,n,t)=>{var r=s.map(i=>t.apply(i,{position:n}));return a==="discard"&&r.some(i=>!t.isInRange(i))?null:r},_l=(s,a,n,t,r,i)=>{var{x:l,y:c,segment:u,ifOverflow:m}=i,d=ct(l),x=ct(c);return x?kl(c,m,n,r,s,a):d?Sl(l,m,n,t,s,a):u!=null&&u.length===2?Dl(u,m,n,s):null};function El(s){var a=da();return o.useEffect(()=>(a($r(s)),()=>{a(Ir(s))})),null}function Pl(s){var{xAxisId:a,yAxisId:n,shape:t,className:r,ifOverflow:i}=s,l=ua(),c=Lr(),u=$e($=>zr($,a)),m=$e($=>qr($,n)),d=$e($=>lt($,"xAxis",a,l)),x=$e($=>lt($,"yAxis",n,l)),f=Vr();if(!c||!f||u==null||m==null||d==null||x==null)return null;var y=Br({x:d,y:x}),h=_l(y,f,s.position,u.orientation,m.orientation,s);if(!h)return null;var[{x:p,y:k},{x:P,y:v}]=h,R=i==="hidden"?"url(#".concat(c,")"):void 0,g=Nt(Nt({clipPath:R},Mt(s)),{},{x1:p,y1:k,x2:P,y2:v}),N=Hr({x1:p,y1:k,x2:P,y2:v});return o.createElement(Ft,{zIndex:s.zIndex},o.createElement(ts,{className:oa("recharts-reference-line",r)},wl(t,g),o.createElement(Wr,As({},N,{lowerWidth:N.width,upperWidth:N.width}),o.createElement(Ur,{label:s.label}),s.children)))}var Rl={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:Tt.line};function Xt(s){var a=rs(s,Rl);return o.createElement(o.Fragment,null,o.createElement(El,{yAxisId:a.yAxisId,xAxisId:a.xAxisId,ifOverflow:a.ifOverflow,x:a.x,y:a.y,segment:a.segment}),o.createElement(Pl,a))}Xt.displayName="ReferenceLine";var Qt=(s,a,n)=>$t(s,"xAxis",pa(s,a),n),Zt=(s,a,n)=>It(s,"xAxis",pa(s,a),n),en=(s,a,n)=>$t(s,"yAxis",xa(s,a),n),sn=(s,a,n)=>It(s,"yAxis",xa(s,a),n),Ol=Ms([ha,Qt,en,Zt,sn],(s,a,n,t,r)=>Lt(s,"xAxis")?ot(a,t,!1):ot(n,r,!1)),Al=(s,a)=>a,an=Ms([Xr,Al],(s,a)=>s.filter(n=>n.type==="area").find(n=>n.id===a)),tn=s=>{var a=ha(s),n=Lt(a,"xAxis");return n?"yAxis":"xAxis"},Tl=(s,a)=>{var n=tn(s);return n==="yAxis"?xa(s,a):pa(s,a)},Ml=(s,a,n)=>Yr(s,tn(s),Tl(s,a),n),Fl=Ms([an,Ml],(s,a)=>{var n;if(!(s==null||a==null)){var{stackId:t}=s,r=Jr(s);if(!(t==null||r==null)){var i=(n=a[t])===null||n===void 0?void 0:n.stackedData,l=i?.find(c=>c.key===r);if(l!=null)return l.map(c=>[c[0],c[1]])}}}),$l=Ms([ha,Qt,en,Zt,sn,Fl,Kr,Ol,an,Gr],(s,a,n,t,r,i,l,c,u,m)=>{var{chartData:d,dataStartIndex:x,dataEndIndex:f}=l;if(!(u==null||s!=="horizontal"&&s!=="vertical"||a==null||n==null||t==null||r==null||t.length===0||r.length===0||c==null)){var{data:y}=u,h;if(y&&y.length>0?h=y:h=d?.slice(x,f+1),h!=null)return ac({layout:s,xAxis:a,yAxis:n,xAxisTicks:t,yAxisTicks:r,dataStartIndex:x,areaSettings:u,stackedData:i,displayedData:h,chartBaseValue:m,bandSize:c})}}),Il=["id"],Ll=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function Oe(){return Oe=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)({}).hasOwnProperty.call(n,t)&&(s[t]=n[t])}return s},Oe.apply(null,arguments)}function nn(s,a){if(s==null)return{};var n,t,r=zl(s,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)===-1&&{}.propertyIsEnumerable.call(s,n)&&(r[n]=s[n])}return r}function zl(s,a){if(s==null)return{};var n={};for(var t in s)if({}.hasOwnProperty.call(s,t)){if(a.indexOf(t)!==-1)continue;n[t]=s[t]}return n}function Ct(s,a){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,t)}return n}function Ie(s){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?Ct(Object(n),!0).forEach(function(t){ql(s,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Ct(Object(n)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(n,t))})}return s}function ql(s,a,n){return(a=Vl(a))in s?Object.defineProperty(s,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[a]=n,s}function Vl(s){var a=Bl(s,"string");return typeof a=="symbol"?a:a+""}function Bl(s,a){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var t=n.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function Ts(s,a){return s&&s!=="none"?s:a}var Wl=s=>{var{dataKey:a,name:n,stroke:t,fill:r,legendType:i,hide:l}=s;return[{inactive:l,dataKey:a,type:i,color:Ts(t,r),value:zt(n,a),payload:s}]},Ul=o.memo(s=>{var{dataKey:a,data:n,stroke:t,strokeWidth:r,fill:i,name:l,hide:c,unit:u,tooltipType:m,id:d}=s,x={dataDefinedOnItem:n,positions:void 0,settings:{stroke:t,strokeWidth:r,fill:i,dataKey:a,nameKey:void 0,name:zt(l,a),hide:c,type:m,color:Ts(t,i),unit:u,graphicalItemId:d}};return o.createElement(ti,{tooltipEntrySettings:x})});function Hl(s){var{clipPathId:a,points:n,props:t}=s,{needClip:r,dot:i,dataKey:l}=t,c=qt(t);return o.createElement(fi,{points:n,dot:i,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:l,baseProps:c,needClip:r,clipPathId:a})}function Kl(s){var{showLabels:a,children:n,points:t}=s,r=t.map(i=>{var l,c,u={x:(l=i.x)!==null&&l!==void 0?l:0,y:(c=i.y)!==null&&c!==void 0?c:0,width:0,lowerWidth:0,upperWidth:0,height:0};return Ie(Ie({},u),{},{value:i.value,payload:i.payload,parentViewBox:void 0,viewBox:u,fill:void 0})});return o.createElement(vi,{value:a?r:void 0},n)}function wt(s){var{points:a,baseLine:n,needClip:t,clipPathId:r,props:i}=s,{layout:l,type:c,stroke:u,connectNulls:m,isRange:d}=i,{id:x}=i,f=nn(i,Il),y=qt(f),h=Mt(f);return o.createElement(o.Fragment,null,a?.length>1&&o.createElement(ts,{clipPath:t?"url(#clipPath-".concat(r,")"):void 0},o.createElement(Zs,Oe({},h,{id:x,points:a,connectNulls:m,type:c,baseLine:n,layout:l,stroke:"none",className:"recharts-area-area"})),u!=="none"&&o.createElement(Zs,Oe({},y,{className:"recharts-area-curve",layout:l,type:c,connectNulls:m,fill:"none",points:a})),u!=="none"&&d&&o.createElement(Zs,Oe({},y,{className:"recharts-area-curve",layout:l,type:c,connectNulls:m,fill:"none",points:n}))),o.createElement(Hl,{points:a,props:f,clipPathId:r}))}function Gl(s){var a,n,{alpha:t,baseLine:r,points:i,strokeWidth:l}=s,c=(a=i[0])===null||a===void 0?void 0:a.y,u=(n=i[i.length-1])===null||n===void 0?void 0:n.y;if(!ye(c)||!ye(u))return null;var m=t*Math.abs(c-u),d=Math.max(...i.map(x=>x.x||0));return Ae(r)?d=Math.max(r,d):r&&Array.isArray(r)&&r.length&&(d=Math.max(...r.map(x=>x.x||0),d)),Ae(d)?o.createElement("rect",{x:0,y:c<u?c:c-m,width:d+(l?parseInt("".concat(l),10):1),height:Math.floor(m)}):null}function Yl(s){var a,n,{alpha:t,baseLine:r,points:i,strokeWidth:l}=s,c=(a=i[0])===null||a===void 0?void 0:a.x,u=(n=i[i.length-1])===null||n===void 0?void 0:n.x;if(!ye(c)||!ye(u))return null;var m=t*Math.abs(c-u),d=Math.max(...i.map(x=>x.y||0));return Ae(r)?d=Math.max(r,d):r&&Array.isArray(r)&&r.length&&(d=Math.max(...r.map(x=>x.y||0),d)),Ae(d)?o.createElement("rect",{x:c<u?c:c-m,y:0,width:m,height:Math.floor(d+(l?parseInt("".concat(l),10):1))}):null}function Jl(s){var{alpha:a,layout:n,points:t,baseLine:r,strokeWidth:i}=s;return n==="vertical"?o.createElement(Gl,{alpha:a,points:t,baseLine:r,strokeWidth:i}):o.createElement(Yl,{alpha:a,points:t,baseLine:r,strokeWidth:i})}function Xl(s){var{needClip:a,clipPathId:n,props:t,previousPointsRef:r,previousBaselineRef:i}=s,{points:l,baseLine:c,isAnimationActive:u,animationBegin:m,animationDuration:d,animationEasing:x,onAnimationStart:f,onAnimationEnd:y}=t,h=o.useMemo(()=>({points:l,baseLine:c}),[l,c]),p=ui(h,"recharts-area-"),k=mi(),[P,v]=o.useState(!1),R=!P,g=o.useCallback(()=>{typeof y=="function"&&y(),v(!1)},[y]),N=o.useCallback(()=>{typeof f=="function"&&f(),v(!0)},[f]);if(k==null)return null;var $=r.current,H=i.current;return o.createElement(Kl,{showLabels:R,points:l},t.children,o.createElement(hi,{animationId:p,begin:m,duration:d,isActive:u,easing:x,onAnimationEnd:g,onAnimationStart:N,key:p},_=>{if($){var w=$.length/l.length,A=_===1?l:l.map((O,L)=>{var S=Math.floor(L*w);if($[S]){var Q=$[S];return Ie(Ie({},O),{},{x:Me(Q.x,O.x,_),y:Me(Q.y,O.y,_)})}return O}),F;return Ae(c)?F=Me(H,c,_):pi(c)||ma(c)?F=Me(H,0,_):F=c.map((O,L)=>{var S=Math.floor(L*w);if(Array.isArray(H)&&H[S]){var Q=H[S];return Ie(Ie({},O),{},{x:Me(Q.x,O.x,_),y:Me(Q.y,O.y,_)})}return O}),_>0&&(r.current=A,i.current=F),o.createElement(wt,{points:A,baseLine:F,needClip:a,clipPathId:n,props:t})}return _>0&&(r.current=l,i.current=c),o.createElement(ts,null,u&&o.createElement("defs",null,o.createElement("clipPath",{id:"animationClipPath-".concat(n)},o.createElement(Jl,{alpha:_,points:l,baseLine:c,layout:k,strokeWidth:t.strokeWidth}))),o.createElement(ts,{clipPath:"url(#animationClipPath-".concat(n,")")},o.createElement(wt,{points:l,baseLine:c,needClip:a,clipPathId:n,props:t})))}),o.createElement(xi,{label:t.label}))}function Ql(s){var{needClip:a,clipPathId:n,props:t}=s,r=o.useRef(null),i=o.useRef();return o.createElement(Xl,{needClip:a,clipPathId:n,props:t,previousPointsRef:r,previousBaselineRef:i})}class Zl extends o.PureComponent{render(){var{hide:a,dot:n,points:t,className:r,top:i,left:l,needClip:c,xAxisId:u,yAxisId:m,width:d,height:x,id:f,baseLine:y,zIndex:h}=this.props;if(a)return null;var p=oa("recharts-area",r),k=f,{r:P,strokeWidth:v}=ci(n),R=oi(n),g=P*2+v,N=c?"url(#clipPath-".concat(R?"":"dots-").concat(k,")"):void 0;return o.createElement(Ft,{zIndex:h},o.createElement(ts,{className:p},c&&o.createElement("defs",null,o.createElement(di,{clipPathId:k,xAxisId:u,yAxisId:m}),!R&&o.createElement("clipPath",{id:"clipPath-dots-".concat(k)},o.createElement("rect",{x:l-g/2,y:i-g/2,width:d+g,height:x+g}))),o.createElement(Ql,{needClip:c,clipPathId:k,props:this.props})),o.createElement(dt,{points:t,mainColor:Ts(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:N}),this.props.isRange&&Array.isArray(y)&&o.createElement(dt,{points:y,mainColor:Ts(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:N}))}}var rn={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:Tt.area};function ec(s){var a,n=rs(s,rn),{activeDot:t,animationBegin:r,animationDuration:i,animationEasing:l,connectNulls:c,dot:u,fill:m,fillOpacity:d,hide:x,isAnimationActive:f,legendType:y,stroke:h,xAxisId:p,yAxisId:k}=n,P=nn(n,Ll),v=ni(),R=ri(),{needClip:g}=ii(p,k),N=ua(),{points:$,isRange:H,baseLine:_}=(a=$e(S=>$l(S,s.id,N)))!==null&&a!==void 0?a:{},w=li();if(v!=="horizontal"&&v!=="vertical"||w==null||R!=="AreaChart"&&R!=="ComposedChart")return null;var{height:A,width:F,x:O,y:L}=w;return!$||!$.length?null:o.createElement(Zl,Oe({},P,{activeDot:t,animationBegin:r,animationDuration:i,animationEasing:l,baseLine:_,connectNulls:c,dot:u,fill:m,fillOpacity:d,height:A,hide:x,layout:v,isAnimationActive:f==="auto"?!ji.isSsr:f,isRange:H,legendType:y,needClip:g,points:$,stroke:h,width:F,left:O,top:L,xAxisId:p,yAxisId:k}))}var sc=(s,a,n,t,r)=>{var i=n??a;if(Ae(i))return i;var l=s==="horizontal"?r:t,c=l.scale.domain();if(l.type==="number"){var u=Math.max(c[0],c[1]),m=Math.min(c[0],c[1]);return i==="dataMin"?m:i==="dataMax"||u<0?u:Math.max(Math.min(c[0],c[1]),0)}return i==="dataMin"?c[0]:i==="dataMax"?c[1]:c[0]};function ac(s){var{areaSettings:{connectNulls:a,baseValue:n,dataKey:t},stackedData:r,layout:i,chartBaseValue:l,xAxis:c,yAxis:u,displayedData:m,dataStartIndex:d,xAxisTicks:x,yAxisTicks:f,bandSize:y}=s,h=r&&r.length,p=sc(i,l,n,c,u),k=i==="horizontal",P=!1,v=m.map((g,N)=>{var $,H,_;if(h)_=r[d+N];else{var w=ut(g,t);Array.isArray(w)?(_=w,P=!0):_=[p,w]}var A=($=(H=_)===null||H===void 0?void 0:H[1])!==null&&$!==void 0?$:null,F=A==null||h&&!a&&ut(g,t)==null;return k?{x:mt({axis:c,ticks:x,bandSize:y,entry:g,index:N}),y:F?null:u.scale(A),value:_,payload:g}:{x:F?null:c.scale(A),y:mt({axis:u,ticks:f,bandSize:y,entry:g,index:N}),value:_,payload:g}}),R;return h||P?R=v.map(g=>{var N=Array.isArray(g.value)?g.value[0]:null;return k?{x:g.x,y:N!=null&&g.y!=null?u.scale(N):null,payload:g.payload}:{x:N!=null?c.scale(N):null,y:g.y,payload:g.payload}}):R=k?u.scale(p):c.scale(p),{points:v,baseLine:R,isRange:P}}function tc(s){var a=rs(s,rn),n=ua();return o.createElement(Zr,{id:a.id,type:"area"},t=>o.createElement(o.Fragment,null,o.createElement(ei,{legendPayload:Wl(a)}),o.createElement(Ul,{dataKey:a.dataKey,data:a.data,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,name:a.name,hide:a.hide,unit:a.unit,tooltipType:a.tooltipType,id:t}),o.createElement(si,{type:"area",id:t,data:a.data,dataKey:a.dataKey,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,stackId:ai(a.stackId),hide:a.hide,barSize:void 0,baseValue:a.baseValue,isPanorama:n,connectNulls:a.connectNulls}),o.createElement(ec,Oe({},a,{id:t}))))}var ss=o.memo(tc,Qr);ss.displayName="Area";var nc=["axis"],rc=o.forwardRef((s,a)=>o.createElement(gi,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:nc,tooltipPayloadSearcher:bi,categoricalChartProps:s,ref:a}));const kt={WARNING:"warning",ERROR:"error"},de={DATABASE:"database",NETWORK:"network",AUTH:"auth",VALIDATION:"validation",STORAGE:"storage",SYNC:"sync",GENERAL:"general"};function ic(s){const a=s?.message?.toLowerCase()||"",n=s?.code?.toLowerCase()||"";return a.includes("fetch")||a.includes("network")||a.includes("offline")?de.NETWORK:a.includes("auth")||a.includes("unauthorized")||n.includes("auth")?de.AUTH:a.includes("storage")||a.includes("bucket")||a.includes("upload")?de.STORAGE:a.includes("validation")||a.includes("invalid")||a.includes("required")?de.VALIDATION:a.includes("sync")||a.includes("conflict")?de.SYNC:s?.code||a.includes("database")||a.includes("supabase")?de.DATABASE:de.GENERAL}function lc(s,a,n){return n?.userMessage?n.userMessage:a===de.NETWORK?"Network connection issue. Your changes will sync when back online.":a===de.AUTH?"Session expired. Please sign in again.":a===de.STORAGE?"Failed to upload file. Please try again.":a===de.VALIDATION?s?.message||"Please check your input and try again.":a===de.SYNC?"Sync conflict detected. Please refresh and try again.":n?.operation?`Failed to ${n.operation.replace(/([A-Z])/g," $1").toLowerCase().trim()}. Please try again.`:"Something went wrong. Please try again."}function cc(s,a={}){const{operation:n="unknown",category:t=ic(s),severity:r=kt.ERROR,showToast:i,userMessage:l,companyId:c,projectId:u,userId:m,silent:d=!1,rethrow:x=!1}=a;if(yi.error(t,{message:s?.message||"Unknown error",code:s?.code,severity:r,operation:n,company_id:c,project_id:u,user_id:m,extra:{stack:s?.stack,name:s?.name}}),!d&&i){const f=lc(s,t,{operation:n,userMessage:l}),y=r===kt.WARNING?"warning":"error";i(f,y)}if(x)throw s;return null}async function le(s,a={}){const{fallback:n=null,context:t={},showToast:r,silent:i=!0}=a;try{return await s()}catch(l){return cc(l,{...t,showToast:r,silent:i}),n}}const Ue={budget:{healthy:.6,warning:.75,critical:.85},schedule:{healthy:.05,warning:.15,critical:.25},corExposure:{healthy:.05,warning:.15,critical:.25},activity:{healthy:1,warning:3,critical:5},safety:{healthy:0,warning:1,critical:2}},oc={budget:.3,schedule:.25,corExposure:.2,activity:.15,safety:.1};function ds(s,a){if(s<=a.healthy)return 0;if(s>=a.critical)return 100;const n=a.critical-a.healthy;return(s-a.healthy)/n*100}function us(s){return s<=25?"healthy":s<=60?"warning":"critical"}function dc(s,a,n=Ue.budget){if(!a||a<=0)return{score:0,status:"healthy",ratio:0,label:"No revenue yet"};const t=s/a,r=ds(t,n),i=us(r);let l;return t<n.healthy?l=`Costs at ${(t*100).toFixed(0)}% of revenue`:t<n.warning?l=`Costs at ${(t*100).toFixed(0)}% - monitor closely`:l=`Costs at ${(t*100).toFixed(0)}% - review immediately`,{score:r,status:i,ratio:t,label:l}}function uc(s,a,n=Ue.schedule){if(!a||a<=0)return{score:0,status:"healthy",variance:0,label:"No schedule baseline"};const t=(a-s)/a,r=Math.max(0,t),i=ds(r,n),l=us(i);let c;return t<=0?c=s>=100?"Complete":"On or ahead of schedule":t<n.warning?c=`${(t*100).toFixed(0)}% behind schedule`:c=`${(t*100).toFixed(0)}% behind - needs attention`,{score:i,status:l,variance:t,label:c}}function mc(s,a,n=Ue.corExposure){if(!a||a<=0)return{score:0,status:"healthy",exposure:0,label:"No contract value"};const t=s/a,r=ds(t,n),i=us(r);let l;return t<n.healthy?l=s>0?`$${aa(s)} pending`:"No pending CORs":t<n.warning?l=`$${aa(s)} pending (${(t*100).toFixed(0)}% of contract)`:l=`High exposure: $${aa(s)} (${(t*100).toFixed(0)}%)`,{score:r,status:i,exposure:t,label:l}}function hc(s,a=Ue.activity){if(!s)return{score:100,status:"critical",daysSince:null,label:"No reports filed"};const n=new Date(s),r=Math.floor((new Date-n)/(1e3*60*60*24)),i=ds(r,a),l=us(i);let c;return r===0?c="Report filed today":r===1?c="Report filed yesterday":r<=a.warning?c=`Last report ${r} days ago`:c=`No report in ${r} days - may be stalled`,{score:i,status:l,daysSince:r,label:c}}function pc(s,a=Ue.safety){const n=s||0,t=ds(n,a),r=us(t);let i;return n===0?i="No incidents":n===1?i="1 incident in last 30 days":i=`${n} incidents - safety review needed`,{score:t,status:r,count:n,label:i}}function xc(s,a={}){const n={...Ue,...a.thresholds},t={...oc,...a.weights},r=dc(s.totalCosts,s.earnedRevenue,n.budget),i=uc(s.actualProgress,s.expectedProgress,n.schedule),l=mc(s.pendingCORValue,s.contractValue,n.corExposure),c=hc(s.lastReportDate,n.activity),u=pc(s.recentInjuryCount,n.safety),m=Math.round(r.score*t.budget+i.score*t.schedule+l.score*t.corExposure+c.score*t.activity+u.score*t.safety);let d;m<=25?d="healthy":m<=60?d="warning":d="critical";let x;return d==="healthy"?x="Project is on track":d==="warning"?x="Some factors need attention":x="Immediate review recommended",{score:m,status:d,label:x,factors:{budget:{...r,weight:t.budget},schedule:{...i,weight:t.schedule},corExposure:{...l,weight:t.corExposure},activity:{...c,weight:t.activity},safety:{...u,weight:t.safety}}}}function vc(s,a){const n=[],{factors:t}=s;t.budget.status==="critical"&&n.push({type:"critical",title:"Budget Alert",description:t.budget.label,action:"Review costs immediately",actionTarget:"financials",projectId:a.id}),t.activity.status==="critical"&&n.push({type:"critical",title:"Activity Alert",description:t.activity.label,action:"Check project status",actionTarget:"overview",projectId:a.id}),t.safety.status==="critical"&&n.push({type:"critical",title:"Safety Alert",description:t.safety.label,action:"Review safety reports",actionTarget:"reports",projectId:a.id}),t.budget.status==="warning"&&n.push({type:"warning",title:"Budget Watch",description:t.budget.label,action:"Monitor costs",actionTarget:"financials",projectId:a.id}),(t.schedule.status==="critical"||t.schedule.status==="warning")&&n.push({type:t.schedule.status==="critical"?"critical":"warning",title:"Schedule Alert",description:t.schedule.label,action:"Review progress",actionTarget:"overview",projectId:a.id}),(t.corExposure.status==="warning"||t.corExposure.status==="critical")&&n.push({type:t.corExposure.status==="critical"?"critical":"warning",title:"COR Exposure",description:t.corExposure.label,action:"Review pending CORs",actionTarget:"cors",projectId:a.id}),t.activity.status==="warning"&&n.push({type:"info",title:"Activity Notice",description:t.activity.label,action:"File daily report",actionTarget:"reports",projectId:a.id});const r={critical:0,warning:1,info:2};return n.sort((i,l)=>r[i.type]-r[l.type]),n}function fc(s){const{actualProgress:a,totalCosts:n,earnedRevenue:t,contractValue:r}=s;if(!a||a<=0)return{estimatedCompletionCost:null,estimatedFinalMargin:null,estimatedCompletionDate:null};const i=n/a,l=Math.round(i*100),c=r>0?(r-l)/r*100:0;let u=null;if(s.startDate&&a>0&&a<100){const m=new Date(s.startDate),d=new Date,x=Math.max(1,(d-m)/(1e3*60*60*24)),f=a/x,h=(100-a)/f;u=new Date(d.getTime()+h*24*60*60*1e3)}return{estimatedCompletionCost:l,estimatedFinalMargin:c,estimatedCompletionDate:u,costPerPercent:i}}function aa(s){return s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toFixed(0)}const Is=()=>ne(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),Z=210,I=14,pe=Z-I*2,ze=s=>s?new Date(s+(s.includes("T")?"":"T12:00:00")).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"—",ve=(s,a,n=30)=>a+n>s.internal.pageSize.height-20?(s.addPage(),20):a;async function jc(s,a){const t=(await Is()).default,r=new t;let i=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Daily Reports",Z/2,i,{align:"center"}),i+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${a.name}`,Z/2,i,{align:"center"}),i+=6,r.text(`${s.length} report${s.length!==1?"s":""}`,Z/2,i,{align:"center"}),i+=12,s.forEach((c,u)=>{i=ve(r,i,60),r.setDrawColor(200,200,200),r.setFillColor(245,247,250),r.roundedRect(I,i-2,pe,10,2,2,"F"),r.setFontSize(11),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(`${ze(c.report_date)}`,I+4,i+5);const m=c.status==="submitted"?"Submitted":"Draft";r.setFontSize(9),r.setFont(void 0,"normal"),r.text(m,Z-I-4,i+5,{align:"right"}),i+=14,r.setTextColor(0,0,0),r.setFontSize(9);const d=[`Crew: ${c.crew_count||0}`,`Tasks: ${c.tasks_completed||0}/${c.tasks_total||0}`,`T&M Tickets: ${c.tm_tickets_count||0}`,`Photos: ${c.photos_count||0}`];if(r.text(d.join("    |    "),I+4,i),i+=7,c.crew_list?.length>0){r.setFont(void 0,"bold"),r.text("Crew:",I+4,i),r.setFont(void 0,"normal");const x=c.crew_list.map(y=>`${y.name} (${y.role||"Laborer"})`).join(", "),f=r.splitTextToSize(x,pe-8);i+=4,r.text(f,I+4,i),i+=f.length*4+2}if(c.field_notes){i=ve(r,i,15),r.setFont(void 0,"bold"),r.text("Field Notes:",I+4,i),r.setFont(void 0,"normal"),i+=4;const x=r.splitTextToSize(c.field_notes,pe-8);r.text(x,I+4,i),i+=x.length*4+2}if(c.issues){i=ve(r,i,15),r.setFont(void 0,"bold"),r.text("Issues:",I+4,i),r.setFont(void 0,"normal"),i+=4;const x=r.splitTextToSize(c.issues,pe-8);r.text(x,I+4,i),i+=x.length*4+2}i+=8,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(I,i,Z-I,i),i+=6)});const l=`${a.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;r.save(l)}async function gc(s,a){const t=(await Is()).default,r=new t;let i=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Incident / Injury Reports",Z/2,i,{align:"center"}),i+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${a.name}`,Z/2,i,{align:"center"}),i+=6,r.text(`${s.length} report${s.length!==1?"s":""}`,Z/2,i,{align:"center"}),i+=12,s.forEach((c,u)=>{i=ve(r,i,50);const d={minor:[34,197,94],serious:[245,158,11],critical:[239,68,68],near_miss:[59,130,246]}[c.injury_type]||[128,128,128];r.setFillColor(...d),r.roundedRect(I,i-2,3,14,1,1,"F"),r.setFontSize(11),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(`${ze(c.incident_date)}`,I+8,i+4),r.setFontSize(9);const x=(c.injury_type||"").replace("_"," ").toUpperCase();if(r.text(x,I+8,i+10),r.setFont(void 0,"normal"),r.text(c.status==="open"?"OPEN":"CLOSED",Z-I-4,i+4,{align:"right"}),i+=16,r.setTextColor(0,0,0),c.description){r.setFontSize(9),r.setFont(void 0,"bold"),r.text("Description:",I+4,i),r.setFont(void 0,"normal"),i+=4;const f=r.splitTextToSize(c.description,pe-8);r.text(f,I+4,i),i+=f.length*4+2}c.location&&(r.setFont(void 0,"bold"),r.text("Location: ",I+4,i),r.setFont(void 0,"normal"),r.text(c.location,I+30,i),i+=6),i+=6,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(I,i,Z-I,i),i+=6)});const l=`${a.name}_Incident_Reports_${new Date().toISOString().split("T")[0]}.pdf`;r.save(l)}async function bc(s,a){const t=(await Is()).default,r=new t;let i=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Crew Check-In History",Z/2,i,{align:"center"}),i+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${a.name}`,Z/2,i,{align:"center"}),i+=6,r.text(`${s.length} check-in${s.length!==1?"s":""}`,Z/2,i,{align:"center"}),i+=12,s.forEach((c,u)=>{i=ve(r,i,30);const m=c.workers||[];r.setFillColor(245,247,250),r.roundedRect(I,i-2,pe,9,2,2,"F"),r.setFontSize(10),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(ze(c.check_in_date),I+4,i+4),r.setFont(void 0,"normal"),r.text(`${m.length} workers`,Z-I-4,i+4,{align:"right"}),i+=12,r.setTextColor(0,0,0),r.setFontSize(9),m.length>0&&(r.setFont(void 0,"bold"),r.text("Name",I+4,i),r.text("Role",110,i),i+=5,r.setFont(void 0,"normal"),m.forEach(d=>{i=ve(r,i,6),r.text(d.name||"—",I+4,i),r.text(d.role||"Laborer",110,i),i+=4.5})),i+=6,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(I,i,Z-I,i),i+=5)});const l=`${a.name}_Crew_Checkins_${new Date().toISOString().split("T")[0]}.pdf`;r.save(l)}async function yc({dailyReports:s=[],incidentReports:a=[],crewCheckins:n=[],project:t}){const i=(await Is()).default,l=new i;let c=20;l.setFontSize(22),l.setFont(void 0,"bold"),l.text("Field Documents Report",Z/2,c,{align:"center"}),c+=10,l.setFontSize(13),l.setFont(void 0,"normal"),l.text(`Project: ${t.name}`,Z/2,c,{align:"center"}),c+=8,l.setFontSize(10),l.text(`Generated: ${new Date().toLocaleDateString()}`,Z/2,c,{align:"center"}),c+=16,l.setFontSize(11),l.setFont(void 0,"bold"),l.text("Document Summary",I,c),c+=8,l.setFontSize(10),l.setFont(void 0,"normal"),[["Daily Reports",`${s.length}`],["Incident Reports",`${a.length}`],["Crew Check-Ins",`${n.length}`]].forEach(([d,x])=>{l.text(d,I+4,c),l.text(x,100,c),c+=6}),s.length>0&&(l.addPage(),c=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Daily Reports",I,c),c+=10,s.forEach((d,x)=>{if(c=ve(l,c,40),l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(ze(d.report_date),I+2,c),l.setFont(void 0,"normal"),l.setFontSize(8),l.text(`Crew: ${d.crew_count||0} | Tasks: ${d.tasks_completed||0}/${d.tasks_total||0} | T&M: ${d.tm_tickets_count||0}`,I+60,c),c+=6,l.setTextColor(0,0,0),l.setFontSize(9),d.field_notes){const f=l.splitTextToSize(d.field_notes,pe-4);l.text(f,I+2,c),c+=f.length*4+2}if(d.issues){l.setFont(void 0,"bold"),l.text("Issues: ",I+2,c),l.setFont(void 0,"normal");const f=l.splitTextToSize(d.issues,pe-20);l.text(f,I+20,c),c+=f.length*4+2}c+=4,x<s.length-1&&(l.setDrawColor(220,220,220),l.line(I,c,Z-I,c),c+=4)})),a.length>0&&(l.addPage(),c=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Incident / Injury Reports",I,c),c+=10,a.forEach((d,x)=>{c=ve(l,c,35),l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(ze(d.incident_date),I+2,c),l.setFontSize(8),l.setFont(void 0,"normal");const f=(d.injury_type||"").replace("_"," ").toUpperCase();if(l.text(`${f} — ${d.status?.toUpperCase()||""}`,I+60,c),c+=6,l.setTextColor(0,0,0),l.setFontSize(9),d.description){const y=l.splitTextToSize(d.description,pe-4);l.text(y,I+2,c),c+=y.length*4+2}d.location&&(l.text(`Location: ${d.location}`,I+2,c),c+=5),c+=4,x<a.length-1&&(l.setDrawColor(220,220,220),l.line(I,c,Z-I,c),c+=4)})),n.length>0&&(l.addPage(),c=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Crew Check-In History",I,c),c+=10,n.forEach((d,x)=>{c=ve(l,c,20);const f=d.workers||[];if(l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(ze(d.check_in_date),I+2,c),l.setFont(void 0,"normal"),l.setFontSize(8),l.text(`${f.length} workers`,I+60,c),c+=6,l.setTextColor(0,0,0),l.setFontSize(8),f.length>0){const y=f.map(p=>`${p.name} (${p.role||"Laborer"})`).join(", "),h=l.splitTextToSize(y,pe-4);l.text(h,I+2,c),c+=h.length*3.5+3}x<n.length-1&&(l.setDrawColor(230,230,230),l.line(I,c,Z-I,c),c+=3)}));const m=`${t.name}_Field_Documents_${new Date().toISOString().split("T")[0]}.pdf`;l.save(m)}function Ls(s,a,n="text/csv"){const t=new Blob([s],{type:n}),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}function St(s){if(s==null)return"";const a=String(s);return a.includes(",")||a.includes('"')||a.includes(`
`)?`"${a.replace(/"/g,'""')}"`:a}function ga(s,a){const n=s.map(r=>St(r.label)).join(","),t=a.map(r=>s.map(i=>St(r[i.key])).join(","));return[n,...t].join(`
`)}function Nc(s,a){const n=[{key:"category",label:"Category"},{key:"description",label:"Description"},{key:"amount",label:"Amount"},{key:"date",label:"Date"},{key:"type",label:"Type"}],t=[];t.push({category:"Revenue",description:"Original Contract Value",amount:s.contract_value||0,date:s.start_date||"",type:"Contract"}),a?.earnedRevenue&&t.push({category:"Revenue",description:"Earned Revenue (Progress)",amount:a.earnedRevenue,date:new Date().toISOString().split("T")[0],type:"Earned"}),a?.approvedCORs&&a.approvedCORs.forEach(u=>{t.push({category:"Revenue",description:`COR: ${u.cor_number} - ${u.title}`,amount:(u.cor_total||0)/100,date:u.approved_at?.split("T")[0]||"",type:"Change Order"})}),a?.laborByDate&&a.laborByDate.forEach(u=>{t.push({category:"Cost",description:"Labor",amount:u.cost,date:u.date,type:"Labor"})}),a?.haulOffByDate&&a.haulOffByDate.forEach(u=>{t.push({category:"Cost",description:"Disposal/Haul-off",amount:u.cost,date:u.date,type:"Disposal"})}),a?.customCosts&&a.customCosts.forEach(u=>{t.push({category:"Cost",description:u.description||u.category||"Other",amount:parseFloat(u.amount)||0,date:u.cost_date||"",type:u.category||"Other"})});const r=t.filter(u=>u.category==="Revenue").reduce((u,m)=>u+(parseFloat(m.amount)||0),0),i=t.filter(u=>u.category==="Cost").reduce((u,m)=>u+(parseFloat(m.amount)||0),0);t.push({category:"",description:"",amount:"",date:"",type:""}),t.push({category:"Summary",description:"Total Revenue",amount:r,date:"",type:""}),t.push({category:"Summary",description:"Total Costs",amount:i,date:"",type:""}),t.push({category:"Summary",description:"Gross Profit",amount:r-i,date:"",type:""}),t.push({category:"Summary",description:"Margin %",amount:r>0?((r-i)/r*100).toFixed(1)+"%":"N/A",date:"",type:""});const l=ga(n,t),c=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_Financials_${new Date().toISOString().split("T")[0]}.csv`;Ls(l,c)}function wo(s,a){const n=[],t=[{key:"section",label:"Section"},{key:"description",label:"Description"},{key:"quantity",label:"Quantity"},{key:"unit",label:"Unit"},{key:"rate",label:"Rate"},{key:"total",label:"Total"}];n.push({section:"COR Info",description:`${s.cor_number} - ${s.title}`,quantity:"",unit:"",rate:"",total:""}),n.push({section:"Status",description:s.status,quantity:"",unit:"",rate:"",total:""}),n.push({section:"Period",description:`${s.period_start||""} to ${s.period_end||""}`,quantity:"",unit:"",rate:"",total:""}),n.push({section:"",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor?.length>0&&(n.push({section:"LABOR",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor.forEach(l=>{const c=parseFloat(l.regular_hours)||0,u=parseFloat(l.overtime_hours)||0;n.push({section:"",description:l.description||l.classification,quantity:c+u,unit:"hours",rate:(parseInt(l.regular_rate)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_materials?.length>0&&(n.push({section:"MATERIALS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_materials.forEach(l=>{n.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"each",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_equipment?.length>0&&(n.push({section:"EQUIPMENT",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_equipment.forEach(l=>{n.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"day",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_subcontractors?.length>0&&(n.push({section:"SUBCONTRACTORS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_subcontractors.forEach(l=>{n.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"lump sum",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})}));const r=ga(t,n),i=`COR_${s.cor_number||s.id}_${new Date().toISOString().split("T")[0]}.csv`;Ls(r,i)}function ko(s,a){const n=[{key:"date",label:"Date"},{key:"status",label:"Status"},{key:"workers",label:"Worker Count"},{key:"totalHours",label:"Total Hours"},{key:"otHours",label:"OT Hours"},{key:"materialsCost",label:"Materials Cost"},{key:"corNumber",label:"COR #"},{key:"notes",label:"Notes"}],t=s.map(l=>{const c=l.t_and_m_workers||[],u=l.t_and_m_items||[],m=c.reduce((f,y)=>f+(parseFloat(y.hours)||0),0),d=c.reduce((f,y)=>f+(parseFloat(y.overtime_hours)||0),0),x=u.reduce((f,y)=>f+(parseFloat(y.quantity)||0)*(y.materials_equipment?.cost_per_unit||0),0);return{date:l.work_date,status:l.status,workers:c.length,totalHours:(m+d).toFixed(1),otHours:d.toFixed(1),materialsCost:x.toFixed(2),corNumber:l.assigned_cor_id?"Linked":"",notes:l.notes||""}}),r=ga(n,t),i=`${a.name.replace(/[^a-zA-Z0-9]/g,"_")}_TM_Tickets_${new Date().toISOString().split("T")[0]}.csv`;Ls(r,i)}function Cc(s,a){const n=[],t=new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"});n.push("!TRNS	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),n.push("!SPL	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),n.push("!ENDTRNS");const r=s.contract_value||0;n.push(`TRNS	GENERAL JOURNAL	${t}	Accounts Receivable	${s.name}	${r.toFixed(2)}	FieldSync - Contract Revenue`),n.push(`SPL	GENERAL JOURNAL	${t}	Construction Revenue	${s.name}	${(-r).toFixed(2)}	Contract: ${s.name}`),n.push("ENDTRNS");const i=a?.totalLaborCost||0;i>0&&(n.push(`TRNS	GENERAL JOURNAL	${t}	Direct Labor	${s.name}	${i.toFixed(2)}	Labor costs - ${s.name}`),n.push(`SPL	GENERAL JOURNAL	${t}	Accounts Payable	${s.name}	${(-i).toFixed(2)}	Labor costs`),n.push("ENDTRNS"));const l=a?.totalDisposalCost||0;l>0&&(n.push(`TRNS	GENERAL JOURNAL	${t}	Disposal Expense	${s.name}	${l.toFixed(2)}	Disposal costs - ${s.name}`),n.push(`SPL	GENERAL JOURNAL	${t}	Accounts Payable	${s.name}	${(-l).toFixed(2)}	Disposal costs`),n.push("ENDTRNS"));const c=n.join(`
`),u=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_QB_${new Date().toISOString().split("T")[0]}.iif`;Ls(c,u,"application/x-iif")}function wc({isOpen:s,onClose:a,companyId:n,onSelectProject:t,onSelectTicket:r,onSelectCOR:i,onShowToast:l}){const[c,u]=o.useState(""),[m,d]=o.useState({projects:[],tickets:[],cors:[],workers:[]}),[x,f]=o.useState(!1),[y,h]=o.useState(0),p=o.useRef(null),k=o.useRef(null),P=o.useRef(null);o.useEffect(()=>()=>{k.current&&clearTimeout(k.current),P.current&&clearTimeout(P.current)},[]),o.useEffect(()=>{s&&(u(""),d({projects:[],tickets:[],cors:[],workers:[]}),h(0),P.current=setTimeout(()=>p.current?.focus(),50))},[s]);const v=o.useCallback(async w=>{if(!w.trim()||w.length<2){d({projects:[],tickets:[],cors:[],workers:[]});return}f(!0);try{const A=await z.universalSearch(n,w.trim());d(A),h(0)}catch(A){console.error("Search error:",A),l?.("Search failed","error")}finally{f(!1)}},[n,l]),R=w=>{const A=w.target.value;u(A),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{v(A)},200)},N=(()=>{const w=[];return m.projects.forEach(A=>w.push({type:"project",data:A})),m.tickets.forEach(A=>w.push({type:"ticket",data:A})),m.cors.forEach(A=>w.push({type:"cor",data:A})),m.workers.forEach(A=>w.push({type:"worker",data:A})),w})(),$=N.length>0,H=w=>{w.key==="Escape"?a():w.key==="ArrowDown"?(w.preventDefault(),h(A=>Math.min(A+1,N.length-1))):w.key==="ArrowUp"?(w.preventDefault(),h(A=>Math.max(A-1,0))):w.key==="Enter"&&$&&(w.preventDefault(),_(N[y]))},_=w=>{if(w){switch(w.type){case"project":t?.(w.data);break;case"ticket":r?.(w.data);break;case"cor":i?.(w.data);break;case"worker":w.data.lastProject&&t?.(w.data.lastProject);break}a()}};return s?e.jsx("div",{className:"universal-search-overlay",onClick:a,children:e.jsxs("div",{className:"universal-search-modal",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"universal-search-input-wrapper",children:[e.jsx(Ut,{size:20,className:"universal-search-icon"}),e.jsx("input",{ref:p,type:"text",value:c,onChange:R,onKeyDown:H,placeholder:"Search projects, tickets, CORs, workers...",className:"universal-search-input",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),c&&e.jsx("button",{className:"universal-search-clear",onClick:()=>u(""),children:e.jsx(We,{size:16})}),e.jsx("div",{className:"universal-search-shortcut",children:e.jsx("span",{children:"esc"})})]}),e.jsx("div",{className:"universal-search-results",children:x?e.jsxs("div",{className:"universal-search-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Searching..."})]}):c.trim()?$?e.jsxs(e.Fragment,{children:[m.projects.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(ra,{size:14}),e.jsx("span",{children:"Projects"})]}),m.projects.map((w,A)=>{const F=A;return e.jsxs("button",{className:`universal-search-item ${y===F?"selected":""}`,onClick:()=>_({type:"project",data:w}),onMouseEnter:()=>h(F),children:[e.jsx(ra,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:w.name}),w.job_number&&e.jsxs("span",{className:"universal-search-item-meta",children:["#",w.job_number]})]}),e.jsx(qe,{size:16,className:"universal-search-item-arrow"})]},w.id)})]}),m.tickets.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(Le,{size:14}),e.jsx("span",{children:"T&M Tickets"})]}),m.tickets.map((w,A)=>{const F=m.projects.length+A;return e.jsxs("button",{className:`universal-search-item ${y===F?"selected":""}`,onClick:()=>_({type:"ticket",data:w}),onMouseEnter:()=>h(F),children:[e.jsx(Le,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[w.description?.substring(0,50)||"T&M Ticket",w.description?.length>50&&"..."]}),e.jsxs("span",{className:"universal-search-item-meta",children:[w.projectName," • ",w.work_date]})]}),e.jsx("span",{className:`universal-search-item-badge ${w.status}`,children:w.status})]},w.id)})]}),m.cors.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(he,{size:14}),e.jsx("span",{children:"Change Orders"})]}),m.cors.map((w,A)=>{const F=m.projects.length+m.tickets.length+A;return e.jsxs("button",{className:`universal-search-item ${y===F?"selected":""}`,onClick:()=>_({type:"cor",data:w}),onMouseEnter:()=>h(F),children:[e.jsx(he,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[w.cor_number?`COR #${w.cor_number}: `:"",w.title]}),e.jsx("span",{className:"universal-search-item-meta",children:w.projectName})]}),e.jsx("span",{className:`universal-search-item-badge ${w.status}`,children:w.status})]},w.id)})]}),m.workers.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(xe,{size:14}),e.jsx("span",{children:"Workers"})]}),m.workers.map((w,A)=>{const F=m.projects.length+m.tickets.length+m.cors.length+A;return e.jsxs("button",{className:`universal-search-item ${y===F?"selected":""}`,onClick:()=>_({type:"worker",data:w}),onMouseEnter:()=>h(F),children:[e.jsx(xe,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:w.name}),e.jsxs("span",{className:"universal-search-item-meta",children:[w.role," • ",w.projectName]})]}),e.jsx(qe,{size:16,className:"universal-search-item-arrow"})]},`${w.name}-${A}`)})]})]}):e.jsx("div",{className:"universal-search-no-results",children:e.jsxs("span",{children:['No results for "',c,'"']})}):e.jsxs("div",{className:"universal-search-empty",children:[e.jsxs("div",{className:"universal-search-tip",children:[e.jsx(Ri,{size:14}),e.jsx("span",{children:"Type to search across all data"})]}),e.jsxs("div",{className:"universal-search-hints",children:[e.jsx("span",{children:"Projects"}),e.jsx("span",{children:"T&M Tickets"}),e.jsx("span",{children:"Change Orders"}),e.jsx("span",{children:"Workers"})]})]})}),e.jsxs("div",{className:"universal-search-footer",children:[e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↑↓"})," navigate"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↵"})," select"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"esc"})," close"]})]})]})}):null}function kc(){const[s,a]=o.useState(!1);return o.useEffect(()=>{const n=t=>{(t.metaKey||t.ctrlKey)&&t.key==="k"&&(t.preventDefault(),a(r=>!r))};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]),{isOpen:s,setIsOpen:a,open:()=>a(!0),close:()=>a(!1)}}function Sc({alerts:s=[],onAction:a,onDismiss:n,maxVisible:t=3,className:r=""}){const[i,l]=o.useState(new Set),c=s.filter(m=>!i.has(m.id||`${m.projectId}-${m.type}-${m.title}`)).slice(0,t),u=o.useCallback(m=>{const d=m.id||`${m.projectId}-${m.type}-${m.title}`;l(x=>new Set([...x,d])),n?.(m)},[n]);return c.length===0?null:e.jsxs("div",{className:`smart-alerts ${r}`,role:"region","aria-label":"Project alerts","aria-live":"polite",children:[c.map((m,d)=>e.jsx(Dc,{alert:m,onAction:a,onDismiss:()=>u(m)},m.id||`${m.projectId}-${m.type}-${d}`)),s.length>t&&e.jsx("div",{className:"smart-alerts__overflow",children:e.jsxs("span",{className:"smart-alerts__overflow-text",children:["+",s.length-t," more alerts"]})})]})}function Dc({alert:s,onAction:a,onDismiss:n}){const{type:t="info",title:r,description:i,action:l,actionTarget:c,projectId:u,projectName:m}=s,x={critical:Oi,warning:Ve,info:Rs}[t]||Rs,f=()=>{a?.({target:c,projectId:u,alert:s})};return e.jsxs("div",{className:`smart-alert smart-alert--${t}`,role:"alert","aria-live":t==="critical"?"assertive":"polite",children:[e.jsx(x,{className:"smart-alert__icon","aria-hidden":"true"}),e.jsxs("div",{className:"smart-alert__content",children:[e.jsxs("div",{className:"smart-alert__title",children:[m&&e.jsxs("span",{className:"smart-alert__project",children:[m,": "]}),r]}),i&&e.jsx("div",{className:"smart-alert__description",children:i}),l&&e.jsx("div",{className:"smart-alert__action",children:e.jsxs("button",{type:"button",className:"smart-alert__action-btn",onClick:f,children:[l,e.jsx(Ai,{size:14,"aria-hidden":"true"})]})})]}),n&&e.jsx("button",{type:"button",className:"smart-alert__dismiss",onClick:n,"aria-label":"Dismiss alert",children:e.jsx(We,{size:18,"aria-hidden":"true"})})]})}function _c({project:s,company:a,onShowToast:n}){const[t,r]=o.useState(null),[i,l]=o.useState(!0),[c,u]=o.useState(!1);o.useEffect(()=>{if(s?.id&&a?.id){m();const h=z.subscribeToCrewCheckins?.(s.id,()=>{m()});return()=>{h&&z.unsubscribe?.(h)}}},[s?.id,a?.id]);const m=async()=>{try{const h=await z.calculateManDayCosts(s.id,a.id,s.work_type||"demolition",s.job_type||"standard");r(h)}catch(h){console.error("Error loading man day costs:",h)}finally{l(!1)}},d=h=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(h),x=h=>new Date(h).toLocaleDateString("en-US",{month:"short",day:"numeric"}),f=h=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[h]||h.charAt(0).toUpperCase()+h.slice(1);if(i)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!t||t.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Pe,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const y=Object.entries(t.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>u(!c),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:d(t.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:c?"▼ Collapse":"▶ Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:d(t.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.daysWorked>0?d(t.totalCost/t.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),c&&e.jsxs("div",{className:"man-day-details",children:[y.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:y.map(([h,p])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:f(h)}),e.jsxs("span",{className:"role-rate",children:[d(p.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[p.count," days"]}),e.jsx("span",{className:"role-cost",children:d(p.cost)})]})]},h))})]}),t.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:t.byDate.slice(0,7).map((h,p)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:x(h.date)}),e.jsxs("span",{className:"date-workers",children:[h.workers," crew"]}),e.jsx("span",{className:"date-cost",children:d(h.cost)})]},p))}),t.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",t.byDate.length-7," more days"]})]})]})]})}const Ec=o.memo(function({project:a,areas:n=[],corStats:t={},onCreateDraw:r,onViewDraw:i,onShowToast:l}){const[c,u]=o.useState([]),[m,d]=o.useState(!0),x=o.useMemo(()=>n.reduce((g,N)=>{const $=(N.square_footage||0)*(N.price_per_sqft||0);return g+Math.round($*100)},0),[n]),f=o.useMemo(()=>t?.approvedTotal||0,[t?.approvedTotal]),y=x+f,h=o.useCallback(async()=>{if(a?.id)try{d(!0);const g=await Ni.getProjectDrawRequests(a.id);u(g||[])}catch(g){console.error("Error loading draw requests:",g)}finally{d(!1)}},[a?.id]);o.useEffect(()=>{h()},[h]);const p=o.useMemo(()=>{const g=c.filter(_=>["submitted","approved","paid"].includes(_.status)),N=g.reduce((_,w)=>_+(w.previous_billings||0)+(w.current_billing||0),0),H=g[0]?.retention_held||0;return{billedToDate:N,retentionHeld:H}},[c]),k=y>0?Math.round(p.billedToDate/y*100):0,P=c.length>0?Math.max(...c.map(g=>g.draw_number))+1:1,v=g=>g?new Date(g).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",R=g=>{switch(g){case"draft":return e.jsx("span",{className:"badge badge-muted",children:"Draft"});case"submitted":return e.jsx("span",{className:"badge badge-warning",children:"Submitted"});case"approved":return e.jsx("span",{className:"badge badge-success",children:"Approved"});case"paid":return e.jsx("span",{className:"badge badge-info",children:"Paid"});case"rejected":return e.jsx("span",{className:"badge badge-danger",children:"Rejected"});default:return null}};return e.jsxs("div",{className:"progress-billing-card",children:[e.jsxs("div",{className:"progress-billing-header",children:[e.jsxs("div",{className:"progress-billing-title",children:[e.jsx(Ti,{size:18}),e.jsx("h3",{children:"Progress Billing"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>r?.(),disabled:x===0,title:x===0?"Add areas with contract values first":`Create Draw #${P}`,children:[e.jsx(ns,{size:14}),e.jsxs("span",{children:["Draw #",P]})]})]}),e.jsxs("div",{className:"progress-billing-contract",children:[e.jsxs("div",{className:"contract-row",children:[e.jsx("span",{className:"contract-label",children:"Original Contract"}),e.jsx("span",{className:"contract-value",children:oe(x)})]}),f>0&&e.jsxs("div",{className:"contract-row co",children:[e.jsx("span",{className:"contract-label",children:"Approved COs"}),e.jsxs("span",{className:"contract-value positive",children:["+",oe(f)]})]}),e.jsxs("div",{className:"contract-row revised",children:[e.jsx("span",{className:"contract-label",children:"Revised Contract"}),e.jsx("span",{className:"contract-value",children:oe(y)})]})]}),e.jsxs("div",{className:"progress-billing-status",children:[e.jsx("div",{className:"billing-progress-bar",children:e.jsx("div",{className:"billing-progress-fill",style:{width:`${Math.min(k,100)}%`}})}),e.jsxs("div",{className:"billing-stats",children:[e.jsxs("div",{className:"billing-stat",children:[e.jsx("span",{className:"billing-stat-value",children:oe(p.billedToDate)}),e.jsxs("span",{className:"billing-stat-label",children:["Billed to Date (",k,"%)"]})]}),p.retentionHeld>0&&e.jsxs("div",{className:"billing-stat retention",children:[e.jsxs("span",{className:"billing-stat-value",children:["-",oe(p.retentionHeld)]}),e.jsx("span",{className:"billing-stat-label",children:"Retention Held"})]}),e.jsxs("div",{className:"billing-stat remaining",children:[e.jsx("span",{className:"billing-stat-value",children:oe(y-p.billedToDate)}),e.jsx("span",{className:"billing-stat-label",children:"Balance to Finish"})]})]})]}),m?e.jsx("div",{className:"progress-billing-loading",children:e.jsx("div",{className:"loading-spinner small"})}):c.length===0?e.jsxs("div",{className:"progress-billing-empty",children:[e.jsx("p",{children:"No draw requests yet"}),x>0&&e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>r?.(),children:[e.jsx(ns,{size:14}),"Create First Draw Request"]})]}):e.jsxs("div",{className:"progress-billing-draws",children:[e.jsx("div",{className:"draws-header",children:e.jsx("span",{children:"Recent Draws"})}),e.jsx("div",{className:"draws-list",children:c.slice(0,3).map(g=>e.jsxs("button",{className:"draw-item",onClick:()=>i?.(g),children:[e.jsxs("div",{className:"draw-item-info",children:[e.jsxs("span",{className:"draw-number",children:["Draw #",g.draw_number]}),e.jsx("span",{className:"draw-date",children:v(g.period_end||g.created_at)})]}),e.jsx("div",{className:"draw-item-amount",children:oe(g.current_billing||0)}),R(g.status),e.jsx(qe,{size:16,className:"draw-item-arrow"})]},g.id))}),c.length>3&&e.jsxs("button",{className:"btn btn-sm btn-ghost view-all-draws",children:["View all ",c.length," draws"]})]})]})}),ta=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",Pc=o.memo(function({project:a,onAddEquipment:n,onEditEquipment:t,onShowToast:r}){const[i,l]=o.useState([]),[c,u]=o.useState(!0),[m,d]=o.useState(!0),[x,f]=o.useState(0),y=o.useCallback(async()=>{if(a?.id)try{u(!0);const v=await Fe.getProjectEquipment(a.id);l(v||[]);const R=Fe.calculateProjectEquipmentCost(v||[]);f(R)}catch(v){console.error("Error loading equipment:",v),r?.("Failed to load equipment","error")}finally{u(!1)}},[a?.id]);o.useEffect(()=>{y()},[y]);const h=o.useCallback(async v=>{try{await Fe.markEquipmentReturned(v.id),r?.(`${v.equipment_name} marked as returned`,"success"),y()}catch(R){console.error("Error marking equipment returned:",R),r?.("Failed to update equipment","error")}},[y]),p=o.useCallback(async v=>{if(confirm(`Remove ${v.equipment_name} from this project?`))try{await Fe.removeEquipmentFromProject(v.id),r?.("Equipment removed","success"),y()}catch(R){console.error("Error removing equipment:",R),r?.("Failed to remove equipment","error")}},[y]),k=o.useMemo(()=>i.filter(v=>!v.end_date),[i]),P=o.useMemo(()=>i.filter(v=>v.end_date),[i]);return e.jsxs("div",{className:"project-equipment-card",children:[e.jsxs("div",{className:"project-equipment-header",children:[e.jsxs("div",{className:"project-equipment-title",children:[e.jsx(Re,{size:18}),e.jsx("h3",{children:"Equipment on Site"}),i.length>0&&e.jsxs("span",{className:"equipment-count",children:[k.length," active"]})]}),e.jsxs("div",{className:"project-equipment-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>n?.(),title:"Add equipment",children:[e.jsx(ns,{size:14}),e.jsx("span",{children:"Add"})]}),i.length>0&&e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>d(!m),children:m?e.jsx(Fs,{size:16}):e.jsx(is,{size:16})})]})]}),c?e.jsx("div",{className:"equipment-loading",children:e.jsx("div",{className:"loading-spinner small"})}):i.length===0?e.jsxs("div",{className:"equipment-empty",children:[e.jsx("p",{children:"No equipment tracked on this project"}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>n?.(),children:[e.jsx(ns,{size:14}),"Track Equipment"]})]}):m?e.jsxs(e.Fragment,{children:[k.length>0&&e.jsx("div",{className:"equipment-list",children:k.map(v=>{const R=Fe.calculateDaysOnSite(v.start_date,v.end_date),g=v.daily_rate*R;return e.jsxs("div",{className:"equipment-item active",children:[e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:v.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[e.jsx(Ht,{size:12}),"On-site since ",ta(v.start_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-rate",children:[oe(v.daily_rate),"/day"]}),e.jsxs("span",{className:"equipment-days",children:[R," days"]}),e.jsx("span",{className:"equipment-total",children:oe(g)})]})]}),e.jsxs("div",{className:"equipment-item-actions",children:[e.jsxs("button",{className:"btn btn-xs btn-outline",onClick:()=>h(v),title:"Mark as returned",children:[e.jsx(Mi,{size:12}),"Returned"]}),e.jsx("button",{className:"btn btn-xs btn-ghost",onClick:()=>t?.(v),title:"Edit",children:e.jsx(Fi,{size:12})}),e.jsx("button",{className:"btn btn-xs btn-ghost text-danger",onClick:()=>p(v),title:"Remove",children:e.jsx(Kt,{size:12})})]})]},v.id)})}),P.length>0&&e.jsxs("details",{className:"equipment-returned-section",children:[e.jsx("summary",{className:"equipment-returned-toggle",children:e.jsxs("span",{children:["Returned Equipment (",P.length,")"]})}),e.jsx("div",{className:"equipment-list returned",children:P.map(v=>{const R=Fe.calculateDaysOnSite(v.start_date,v.end_date),g=v.daily_rate*R;return e.jsx("div",{className:"equipment-item returned",children:e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:v.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[ta(v.start_date)," - ",ta(v.end_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-days",children:[R," days"]}),e.jsx("span",{className:"equipment-total",children:oe(g)})]})]})},v.id)})})]}),e.jsxs("div",{className:"equipment-total-row",children:[e.jsx("span",{children:"Total Equipment Cost"}),e.jsx("span",{className:"equipment-grand-total",children:oe(x)})]})]}):e.jsxs("div",{className:"equipment-summary-collapsed",children:[e.jsxs("span",{children:[k.length," active, ",P.length," returned"]}),e.jsx("span",{className:"equipment-grand-total",children:oe(x)})]})]})}),be=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Rc=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"});function Oc({dailyBurn:s,totalBurn:a,daysWorked:n,laborCost:t,materialsEquipmentCost:r=0,progress:i,contractValue:l,laborByDate:c=[],materialsEquipmentByDate:u=[]}){const[m,d]=o.useState(!1),x=l*(i/100)*.6,f=a<=x?"on-budget":a<=x*1.2?"warning":"over-budget",y={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[f],h=f==="on-budget"?ls:f==="warning"?ja:cs,k=i>0?a/(i/100):0,P=[],v={};c.forEach(g=>{v[g.date]||(v[g.date]={date:g.date,labor:0,materialsEquipment:0,total:0}),v[g.date].labor=g.cost||0,v[g.date].total+=g.cost||0}),u.forEach(g=>{v[g.date]||(v[g.date]={date:g.date,labor:0,materialsEquipment:0,total:0}),v[g.date].materialsEquipment=g.cost||0,v[g.date].total+=g.cost||0}),Object.values(v).sort((g,N)=>new Date(N.date)-new Date(g.date)).slice(0,10).forEach(g=>P.push(g));const R=Math.max(...P.map(g=>g.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx($i,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${f}`,children:[e.jsx(h,{size:14}),e.jsx("span",{children:y})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:be(s)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),n>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",n," work day",n!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:be(a)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:be(t)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Materials"}),e.jsx("span",{className:"burn-summary-value",children:be(r)})]})]}),i>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${k>l*.7?"warning":""}`,children:be(k)})]}),P.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>d(!m),children:[m?e.jsx(Fs,{size:16}):e.jsx(is,{size:16}),e.jsxs("span",{children:[m?"Hide":"View"," Daily Breakdown"]})]}),m&&P.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Materials"}),e.jsx("span",{children:"Total"})]}),P.map(g=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:Rc(g.date)}),e.jsx("span",{className:"burn-labor",children:g.labor>0?be(g.labor):"-"}),e.jsx("span",{className:"burn-materials",children:g.materialsEquipment>0?be(g.materialsEquipment):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${g.total/R*100}%`}}),e.jsx("span",{className:"burn-amount",children:be(g.total)})]})]},g.date))]})]})}const W={contract:"#3b82f6",revenue:"#10b981",costs:"#f59e0b",profit:"#22c55e",loss:"#ef4444",tmValue:"#8b5cf6",corValue:"#14b8a6",labor:"#6366f1",disposal:"#14b8a6",equipment:"#f97316",materials:"#a855f7",subcontractor:"#ec4899",other:"#6b7280"},as={duration:800},Dt={contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"12px 16px"},labelStyle:{color:"var(--text-primary)",fontWeight:600,marginBottom:"8px"}},_t={labor:{label:"Labor",color:W.labor,icon:"HardHat"},disposal:{label:"Disposal",color:W.disposal,icon:"Trash2"},equipment:{label:"Equipment",color:W.equipment,icon:"Truck"},materials:{label:"Materials",color:W.materials,icon:"Package"},subcontractor:{label:"Subcontractor",color:W.subcontractor,icon:"Users"},other:{label:"Other",color:W.other,icon:"MoreHorizontal"}},Et=[{id:"7d",label:"7D",days:7},{id:"30d",label:"30D",days:30},{id:"90d",label:"90D",days:90},{id:"all",label:"All",days:null}],Ee=s=>s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(0)}K`:`$${s.toFixed(0)}`,ba=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}),Ac={revenue:{id:"revenueGradient",color:W.revenue,startOpacity:.3,endOpacity:0},costs:{id:"costsGradient",color:W.costs,startOpacity:.3,endOpacity:0},tmValue:{id:"tmValueGradient",color:W.tmValue,startOpacity:.2,endOpacity:0}};function Tc(s,a,n=[],t=null,r=[]){const i=a?.contract_value||0,l=s?.laborByDate||[],c=s?.haulOffByDate||[],u=s?.materialsEquipmentByDate||[],m=s?.customCosts||[],d=new Set;l.forEach(N=>d.add(N.date)),c.forEach(N=>d.add(N.date)),u.forEach(N=>d.add(N.date)),m.forEach(N=>{N.cost_date&&d.add(N.cost_date)}),n.forEach(N=>{N.work_date&&d.add(N.work_date),N.ticket_date&&d.add(N.ticket_date),N.created_at&&d.add(N.created_at.split("T")[0])}),r.forEach(N=>{N.status==="done"&&N.updated_at&&d.add(N.updated_at.split("T")[0])});const x=[...d].sort((N,$)=>new Date(N)-new Date($));if(x.length===0)return[];const f={},y=r.reduce((N,$)=>N+(parseFloat($.weight)||0),0);r.forEach(N=>{if(N.status==="done"&&N.updated_at){const $=N.updated_at.split("T")[0],H=parseFloat(N.weight)||0,_=N.scheduled_value?parseFloat(N.scheduled_value):y>0?H/y*i:0;f[$]||(f[$]=0),f[$]+=_}});let h=0,p=0;const k={};n.forEach(N=>{const $=N.work_date||N.ticket_date||N.created_at?.split("T")[0];if(!$)return;let H=0;const _=N.t_and_m_workers||N.workers||[];Array.isArray(_)&&_.forEach(A=>{const F=parseFloat(A.hours)||parseFloat(A.regular_hours)||0,O=parseFloat(A.overtime_hours)||0,L=parseFloat(A.regular_rate)||parseFloat(A.rate)||65,S=parseFloat(A.overtime_rate)||L*1.5;H+=F*L+O*S});const w=N.t_and_m_items||N.items||[];Array.isArray(w)&&w.forEach(A=>{const F=parseFloat(A.quantity)||1,O=parseFloat(A.unit_cost)||parseFloat(A.materials_equipment?.cost_per_unit)||0;H+=F*O}),k[$]||(k[$]=0),k[$]+=H});const P={};m.forEach(N=>{const $=N.cost_date;$&&(P[$]||(P[$]=0),P[$]+=parseFloat(N.amount)||0)});const v={};u.forEach(N=>{N.date&&(v[N.date]=N.cost||0)});let R=0;return x.map(N=>{const H=l.find(re=>re.date===N)?.cost||0,w=c.find(re=>re.date===N)?.cost||0,A=v[N]||0,F=P[N]||0,O=H+A+w+F;h+=O;const L=k[N]||0;p+=L;const S=f[N]||0;R+=S;const T=Object.keys(f).length>0?R:s?.billable||0;return{date:N,contract:i,revenue:Math.round(T),costs:Math.round(h),tmValue:Math.round(p),corValue:Math.round(t?.total_approved_value||0),profit:Math.round(T-h),dailyLabor:Math.round(H),dailyRevenue:Math.round(S),dailyMaterials:Math.round(A),dailyHaulOff:Math.round(w),dailyCustom:Math.round(F),dailyTM:Math.round(L),dailyTotal:Math.round(O)}})}function Mc(s,a){if(!a||!s.length)return s;const n=new Date,t=new Date;return t.setDate(n.getDate()-a),s.filter(r=>new Date(r.date)>=t)}function Fc(s=0,a=0,n=[]){const t=[];s>0&&t.push({name:"Labor",value:s,color:W.labor,category:"labor"}),a>0&&t.push({name:"Disposal",value:a,color:W.disposal,category:"disposal"});const r={};n.forEach(l=>{const c=l.category||"other";r[c]||(r[c]={items:[],total:0}),r[c].items.push(l),r[c].total+=parseFloat(l.amount)||0}),Object.entries(r).forEach(([l,c])=>{if(c.total>0){const u=_t[l]||_t.other;t.push({name:u.label,value:c.total,color:u.color,category:l,items:c.items})}});const i=t.reduce((l,c)=>l+c.value,0);return t.forEach(l=>{l.percentage=i>0?Math.round(l.value/i*100):0}),t.sort((l,c)=>c.value-l.value),t}function Pt(s,a){if(!s||s.length<2)return{direction:"flat",percentage:0};const n=s.slice(-7);if(n.length<2)return{direction:"flat",percentage:0};const t=n[0][a]||0,r=n[n.length-1][a]||0;if(t===0)return{direction:r>0?"up":"flat",percentage:0};const i=(r-t)/t*100;return{direction:i>5?"up":i<-5?"down":"flat",percentage:Math.abs(Math.round(i))}}function $c({active:s,payload:a,label:n}){if(!s||!a||!a.length)return null;const t=i=>i>=1e6?`$${(i/1e6).toFixed(2)}M`:i>=1e3?`$${(i/1e3).toFixed(1)}K`:`$${i.toFixed(0)}`,r=a[0]?.payload||{};return e.jsxs("div",{className:"chart-tooltip",children:[e.jsx("div",{className:"chart-tooltip-date",children:ba(n)}),e.jsxs("div",{className:"chart-tooltip-rows",children:[r.contract!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:W.contract}}),"Contract"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.contract)})]}),r.revenue!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:W.revenue}}),"Revenue"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.revenue)})]}),r.costs!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:W.costs}}),"Costs"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.costs)})]}),r.tmValue!==void 0&&r.tmValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:W.tmValue}}),"T&M Value"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.tmValue)})]}),r.corValue!==void 0&&r.corValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:W.corValue}}),"COR Approved"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.corValue)})]}),r.profit!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:r.profit>=0?W.profit:W.loss}}),r.profit>=0?"Profit":"Loss"]}),e.jsx("span",{className:"chart-tooltip-value",style:{color:r.profit>=0?W.profit:W.loss},children:t(Math.abs(r.profit))})]})]}),(r.dailyRevenue>0||r.dailyLabor>0||r.dailyMaterials>0||r.dailyHaulOff>0||r.dailyTM>0)&&e.jsxs("div",{className:"chart-tooltip-daily",children:[e.jsx("div",{className:"chart-tooltip-daily-label",children:"Today's Activity"}),r.dailyRevenue>0&&e.jsx("div",{className:"chart-tooltip-daily-row earned",children:e.jsxs("span",{style:{color:W.revenue},children:["Areas Completed: ",t(r.dailyRevenue)]})}),r.dailyLabor>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Labor: ",t(r.dailyLabor)]}),r.dailyMaterials>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Materials: ",t(r.dailyMaterials)]}),r.dailyHaulOff>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Disposal: ",t(r.dailyHaulOff)]}),r.dailyTM>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["T&M Added: ",t(r.dailyTM)]}),r.dailyTotal>0&&e.jsx("div",{className:"chart-tooltip-daily-row total",children:e.jsxs("strong",{children:["Day Costs: ",t(r.dailyTotal)]})})]}),e.jsx("div",{className:"chart-tooltip-hint",children:"Click to see details"})]})}function Ic({projectData:s,project:a,tmTickets:n=[],corStats:t=null,areas:r=[],onDrillDown:i}){const[l,c]=o.useState("30d"),[u,m]=o.useState(null),d=o.useMemo(()=>{const p=Tc(s,a,n,t,r),k=Et.find(P=>P.id===l);return Mc(p,k?.days)},[s,a,n,t,r,l]),x=o.useMemo(()=>Pt(d,"costs"),[d]),f=o.useMemo(()=>Pt(d,"revenue"),[d]),y=p=>{if(p?.activePayload?.[0]){const k=p.activePayload[0].payload;i?.(k.date,k)}},h=({trend:p})=>p.direction==="up"?e.jsx(cs,{size:14,className:"trend-icon up"}):p.direction==="down"?e.jsx(ls,{size:14,className:"trend-icon down"}):e.jsx(ja,{size:14,className:"trend-icon flat"});return d.length?e.jsxs("div",{className:"financial-trend-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[e.jsx("h3",{children:"Financial Trend"}),e.jsxs("div",{className:"chart-trend-indicators",children:[e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:W.revenue},children:"Revenue"}),e.jsx(h,{trend:f}),f.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[f.percentage,"%"]})]}),e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:W.costs},children:"Costs"}),e.jsx(h,{trend:x}),x.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[x.percentage,"%"]})]})]})]}),e.jsx("div",{className:"time-range-selector",children:Et.map(p=>e.jsx("button",{className:l===p.id?"active":"",onClick:()=>c(p.id),children:p.label},p.id))})]}),e.jsx("div",{className:"chart-container",children:e.jsx(va,{width:"100%",height:300,children:e.jsxs(rc,{data:d,onClick:y,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:Object.values(Ac).map(p=>e.jsxs("linearGradient",{id:p.id,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:p.color,stopOpacity:p.startOpacity}),e.jsx("stop",{offset:"95%",stopColor:p.color,stopOpacity:p.endOpacity})]},p.id))}),e.jsx(Vt,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Bt,{dataKey:"date",tickFormatter:ba,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(Wt,{tickFormatter:Ee,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:!1,width:60}),e.jsx(fa,{content:e.jsx($c,{})}),e.jsx($s,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,formatter:p=>e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:p})}),d[0]?.contract>0&&e.jsx(Xt,{y:d[0].contract,stroke:W.contract,strokeDasharray:"5 5",strokeWidth:2,label:{value:"Contract",position:"right",fill:W.contract,fontSize:11}}),e.jsx(ss,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:W.revenue,strokeWidth:2,fill:"url(#revenueGradient)",animationDuration:as.duration,onMouseEnter:()=>m("revenue"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="revenue"?.3:1}}),e.jsx(ss,{type:"monotone",dataKey:"costs",name:"Costs",stroke:W.costs,strokeWidth:2,fill:"url(#costsGradient)",animationDuration:as.duration,onMouseEnter:()=>m("costs"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="costs"?.3:1}}),d.some(p=>p.tmValue>0)&&e.jsx(ss,{type:"monotone",dataKey:"tmValue",name:"T&M Value",stroke:W.tmValue,strokeWidth:2,fill:"url(#tmValueGradient)",animationDuration:as.duration,onMouseEnter:()=>m("tmValue"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="tmValue"?.3:1}}),d.some(p=>p.corValue>0)&&e.jsx(ss,{type:"monotone",dataKey:"corValue",name:"COR Approved",stroke:W.corValue,strokeWidth:2,strokeDasharray:"4 2",fill:"transparent",animationDuration:as.duration,onMouseEnter:()=>m("corValue"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="corValue"?.3:1}})]})})}),e.jsxs("div",{className:"chart-quick-stats",children:[e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Current Revenue"}),e.jsx("span",{className:"stat-value",style:{color:W.revenue},children:Ee(d[d.length-1]?.revenue||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Total Costs"}),e.jsx("span",{className:"stat-value",style:{color:W.costs},children:Ee(d[d.length-1]?.costs||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Margin"}),e.jsx("span",{className:"stat-value",style:{color:(d[d.length-1]?.profit||0)>=0?W.profit:W.loss},children:(()=>{const p=d[d.length-1];return!p||!p.revenue?"0%":`${((p.revenue-p.costs)/p.revenue*100).toFixed(1)}%`})()})]}),d[d.length-1]?.tmValue>0&&e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"T&M Pending"}),e.jsx("span",{className:"stat-value",style:{color:W.tmValue},children:Ee(d[d.length-1]?.tmValue||0)})]})]})]}):e.jsx("div",{className:"financial-trend-chart empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No financial data available yet."}),e.jsx("span",{children:"Start tracking labor and costs to see trends."})]})})}function Lc({laborCost:s=0,haulOffCost:a=0,customCosts:n=[],onSegmentClick:t}){const[r,i]=o.useState(null),l=o.useMemo(()=>Fc(s,a,n),[s,a,n]),c=o.useMemo(()=>l.reduce((y,h)=>y+h.value,0),[l]),u=(y,h)=>{i(h)},m=()=>{i(null)},d=(y,h)=>{t&&t(l[h])},x=({active:y,payload:h})=>{if(!y||!h||!h.length)return null;const p=h[0].payload;return e.jsxs("div",{className:"chart-tooltip donut-tooltip",children:[e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:p.color}}),p.name]}),e.jsx("span",{className:"chart-tooltip-value",children:Ee(p.value)})]}),e.jsxs("div",{className:"donut-tooltip-pct",children:[p.percentage,"% of total costs"]}),p.items&&p.items.length>0&&e.jsx("div",{className:"donut-tooltip-items",children:e.jsxs("div",{className:"donut-tooltip-items-label",children:[p.items.length," item",p.items.length>1?"s":""]})}),t&&e.jsx("div",{className:"chart-tooltip-hint",children:"Click to view details"})]})},f=y=>{const{payload:h}=y;return e.jsx("div",{className:"donut-legend",children:h.map((p,k)=>e.jsxs("div",{className:`donut-legend-item ${r===k?"active":""}`,onMouseEnter:()=>i(k),onMouseLeave:()=>i(null),onClick:()=>d(null,k),children:[e.jsx("span",{className:"donut-legend-color",style:{backgroundColor:p.payload.color}}),e.jsx("span",{className:"donut-legend-name",children:p.value}),e.jsx("span",{className:"donut-legend-value",children:Ee(p.payload.value)})]},`legend-${k}`))})};return!l.length||c===0?e.jsx("div",{className:"cost-donut empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No cost data available."}),e.jsx("span",{children:"Add labor, disposal, or custom costs to see breakdown."})]})}):e.jsx("div",{className:"cost-donut",children:e.jsxs("div",{className:"donut-chart-container",children:[e.jsx(va,{width:"100%",height:200,children:e.jsxs(Ci,{children:[e.jsx(wi,{data:l,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",onMouseEnter:u,onMouseLeave:m,onClick:d,animationDuration:as.duration,animationEasing:"ease-out",children:l.map((y,h)=>e.jsx(ki,{fill:y.color,stroke:"var(--card-bg)",strokeWidth:2,style:{filter:r===h?"brightness(1.1)":"none",cursor:t?"pointer":"default",transform:r===h?"scale(1.05)":"scale(1)",transformOrigin:"center",transition:"all 0.2s ease"}},`cell-${h}`))}),e.jsx(fa,{content:e.jsx(x,{})}),e.jsx($s,{content:f})]})}),e.jsxs("div",{className:"donut-center-label",children:[e.jsx("span",{className:"donut-center-value",children:Ee(c)}),e.jsx("span",{className:"donut-center-text",children:"Total"})]})]})})}const na=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Ds={labor:{label:"Labor",Icon:Pe,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Re,color:"#10b981"},equipment:{label:"Equipment",Icon:ia,color:"#f59e0b"},materials:{label:"Materials",Icon:Ps,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:xe,color:"#ec4899"},other:{label:"Other",Icon:Ii,color:"#6b7280"}};function zc({laborCost:s=0,haulOffCost:a=0,customCosts:n=[],onAddCost:t,onDeleteCost:r}){const[i,l]=o.useState(!0),[c,u]=o.useState(null),m=[];s>0&&m.push({category:"labor",label:"Labor",amount:s,source:"auto",description:"From crew check-ins"}),a>0&&m.push({category:"disposal",label:"Disposal",amount:a,source:"auto",description:"From haul-off logs"});const d={};n.forEach(h=>{d[h.category]||(d[h.category]={category:h.category,items:[],total:0}),d[h.category].items.push(h),d[h.category].total+=parseFloat(h.amount)||0}),Object.values(d).forEach(h=>{const p=Ds[h.category]||Ds.other;m.push({category:h.category,label:p.label,amount:h.total,source:"manual",items:h.items})});const x=m.reduce((h,p)=>h+p.amount,0);m.forEach(h=>{h.percentage=x>0?h.amount/x*100:0}),m.sort((h,p)=>p.amount-h.amount);const f=h=>{u(c===h?null:h)},y=h=>{h.items&&h.items.length>0&&(l(!1),u(h.category))};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsxs("div",{className:"cost-contributors-title",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:na(x)})]}),m.length>0&&e.jsxs("div",{className:"cost-view-toggle",children:[e.jsx("button",{className:i?"active":"",onClick:()=>l(!0),children:"Chart"}),e.jsx("button",{className:i?"":"active",onClick:()=>l(!1),children:"List"})]})]}),m.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):i?e.jsx(Lc,{laborCost:s,haulOffCost:a,customCosts:n,onSegmentClick:y}):e.jsx("div",{className:"cost-breakdown",children:m.map(h=>{const p=Ds[h.category]||Ds.other,k=p.Icon,P=h.items&&h.items.length>0,v=c===h.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${P?"expandable":""}`,onClick:()=>P&&f(h.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(h.percentage,2)}%`,backgroundColor:p.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(k,{size:14,style:{color:p.color}}),e.jsx("span",{children:h.label}),h.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),P&&(v?e.jsx(Fs,{size:14}):e.jsx(is,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:na(h.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(h.percentage),"%"]})]})]})]}),v&&P&&e.jsx("div",{className:"cost-category-items",children:h.items.map(R=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:R.description}),e.jsx("span",{className:"cost-item-date",children:new Date(R.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:na(R.amount)}),r&&e.jsx("button",{className:"cost-item-delete",onClick:g=>{g.stopPropagation(),confirm("Delete this cost entry?")&&r(R.id)},children:e.jsx(Kt,{size:14})})]})]},R.id))})]},h.category)})}),t&&e.jsxs("button",{className:"cost-add-btn",onClick:t,children:[e.jsx(ns,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const Se=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0);function qc({revenue:s,totalCosts:a,contractValue:n,progress:t}){const r=s-a,i=s>0?r/s*100:0,l=n,c=t>0?a/(t/100):a,u=l-c,m=l>0?u/l*100:0,d=i>=20,x=i>=0&&i<20,f=i<0,y=d?"healthy":x?"warning":"loss",h=d?"On Track":x?"Watch Margin":"Over Cost",p=d?Li:x?os:ls;return e.jsxs("div",{className:`profitability-card ${y}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${y}`,children:[e.jsx(p,{size:14}),e.jsx("span",{children:h})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${i<0?"negative":""}`,children:[Math.round(i),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${i<0?"negative":i<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(i),100)}%`}})})]}),t>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${m<0?"negative":""}`,children:[Math.round(m),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${m<0?"negative":m<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(m),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:Se(s)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",Se(a)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${r<0?"negative":"positive"}`,children:[r>=0?"":"-",Se(Math.abs(r))]})]})]}),t>10&&e.jsxs("div",{className:"profitability-insight",children:[d&&e.jsxs("p",{children:["At ",Math.round(t),"% complete, you're at ",Se(r)," profit.",u>0&&` Projected final profit: ${Se(u)}`]}),x&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",u<0&&` Trending toward ${Se(u)} loss.`]}),f&&e.jsxs("p",{children:["Currently over cost by ",Se(Math.abs(r)),". Immediate review recommended."]})]})]})}const ln=[{value:"concrete",label:"Concrete",icon:"🧱"},{value:"trash",label:"Trash",icon:"🗑️"},{value:"metals",label:"Metals",icon:"🔩"},{value:"hazardous_waste",label:"Hazardous",icon:"☣️"}],Vc=s=>ln.find(a=>a.value===s)||{label:s,icon:"📦"};function Bc({project:s,period:a="week"}){const[n,t]=o.useState([]),[r,i]=o.useState(!0),[l,c]=o.useState(!1);o.useEffect(()=>{s?.id&&u()},[s?.id,a]);const u=async()=>{try{i(!0);const h=a==="week"?7:a==="month"?30:14,p=await z.getDisposalLoadsHistory(s.id,h);t(p||[])}catch(h){console.error("Error loading disposal summary:",h)}finally{i(!1)}},m=n.reduce((h,p)=>{const k=p.load_type;return h[k]||(h[k]=0),h[k]+=p.load_count,h},{}),d=n.reduce((h,p)=>{const k=p.load_date||p.work_date;return h[k]||(h[k]={date:k,loads:[],total:0}),h[k].loads.push(p),h[k].total+=p.load_count,h},{}),x=Object.values(d).sort((h,p)=>new Date(p.date)-new Date(h.date)).slice(0,7),f=n.reduce((h,p)=>h+p.load_count,0),y=f>0;return r?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Re,{size:18}),e.jsx("span",{children:"Disposal Loads"})]})}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Re,{size:18}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("span",{className:"period-badge",children:a==="week"?"Last 7 days":a==="month"?"Last 30 days":"Last 14 days"})]}),y?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"disposal-total-value",children:f}),e.jsx("span",{className:"disposal-total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:ln.map(h=>{const p=m[h.value]||0;if(p===0)return null;const k=Math.round(p/f*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"disposal-type-info",children:[e.jsx("span",{className:"disposal-type-icon",children:h.icon}),e.jsx("span",{className:"disposal-type-label",children:h.label})]}),e.jsxs("div",{className:"disposal-type-stats",children:[e.jsx("span",{className:"disposal-type-count",children:p}),e.jsx("div",{className:"disposal-type-bar",children:e.jsx("div",{className:"disposal-type-bar-fill",style:{width:`${k}%`}})})]})]},h.value)})}),x.length>0&&e.jsxs("button",{className:"disposal-expand-btn",onClick:()=>c(!l),children:[l?e.jsx(Fs,{size:16}):e.jsx(is,{size:16}),e.jsxs("span",{children:[l?"Hide":"View"," Daily Breakdown"]})]}),l&&x.length>0&&e.jsx("div",{className:"disposal-daily-breakdown",children:x.map(h=>{const p=new Date(h.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),k=h.loads.reduce((P,v)=>(P[v.load_type]||(P[v.load_type]=0),P[v.load_type]+=v.load_count,P),{});return e.jsxs("div",{className:"disposal-daily-row",children:[e.jsxs("div",{className:"disposal-daily-header",children:[e.jsx("span",{className:"disposal-daily-date",children:p}),e.jsxs("span",{className:"disposal-daily-total",children:[h.total," loads"]})]}),e.jsx("div",{className:"disposal-daily-types",children:Object.entries(k).map(([P,v])=>{const R=Vc(P);return e.jsxs("span",{className:"disposal-daily-type",children:[R.icon," ",v]},P)})})]},h.date)})})]}):e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx(Re,{size:32}),e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("span",{className:"text-muted",children:"Loads will appear here when logged by field crews"})]})]})}const Rt=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function Wc({project:s,company:a,user:n,isAdmin:t,onShowToast:r}){const[i,l]=o.useState([]),[c,u]=o.useState([]),[m,d]=o.useState(!0),[x,f]=o.useState(!1),[y,h]=o.useState(""),[p,k]=o.useState("Team Member"),[P,v]=o.useState(null);o.useEffect(()=>{s?.id&&R()},[s?.id]),o.useEffect(()=>{x&&a?.id&&g()},[x,a?.id]);const R=async()=>{try{d(!0);const _=await z.getProjectTeam(s.id);l(_)}catch(_){console.error("Error loading project team:",_)}finally{d(!1)}},g=async()=>{try{const _=await z.getCompanyMembers(a.id),w=i.map(F=>F.users?.id),A=_.filter(F=>!w.includes(F.users?.id));u(A)}catch(_){console.error("Error loading company members:",_)}},N=async()=>{if(!y){r("Select a team member","error");return}try{v("add"),await z.addProjectMember(s.id,y,p,n.id),r("Team member added","success"),f(!1),h(""),k("Team Member"),R()}catch(_){console.error("Error adding team member:",_),r("Error adding team member","error")}finally{v(null)}},$=async(_,w)=>{try{v(_.id),await z.updateProjectMemberRole(s.id,_.users?.id,w),r("Role updated","success"),R()}catch(A){console.error("Error updating role:",A),r("Error updating role","error")}finally{v(null)}},H=async _=>{try{v(_.id),await z.removeProjectMember(s.id,_.users?.id),r("Team member removed","success"),R()}catch(w){console.error("Error removing team member:",w),r("Error removing team member","error")}finally{v(null)}};return m?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Project Team"]}),t&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>f(!0),children:[e.jsx(zi,{size:14})," Add"]})]}),i.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",t&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:i.map(_=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:_.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:_.users?.email})]}),e.jsx("div",{className:"team-member-role",children:t?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:_.project_role,onChange:w=>$(_,w.target.value),disabled:P===_.id,className:"role-select",children:Rt.map(w=>e.jsx("option",{value:w,children:w},w))}),e.jsx(is,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:_.project_role})}),t&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>H(_),disabled:P===_.id,title:"Remove from project",children:e.jsx(qi,{size:14})})]},_.id))}),x&&e.jsx("div",{className:"modal-overlay",onClick:()=>f(!1),children:e.jsxs("div",{className:"modal-content small",onClick:_=>_.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>f(!1),children:e.jsx(We,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:y,onChange:_=>h(_.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),c.map(_=>e.jsx("option",{value:_.users?.id,children:_.users?.name||_.users?.email},_.users?.id))]}),c.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:p,onChange:_=>k(_.target.value),className:"form-select",children:Rt.map(_=>e.jsx("option",{value:_,children:_},_))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:N,disabled:!y||P==="add",children:P==="add"?"Adding...":"Add to Project"})]})]})})]})}const Y=o.memo(function({width:a,height:n,borderRadius:t="8px",className:r="",variant:i="default"}){const c=(()=>{switch(i){case"text":return{height:"1em",borderRadius:"4px"};case"circular":return{borderRadius:"50%"};case"rectangular":return{borderRadius:"0"};default:return{borderRadius:t}}})();return e.jsx("div",{className:`skeleton ${r}`,style:{width:a||"100%",height:n||c.height||"1rem",borderRadius:c.borderRadius},"aria-hidden":"true"})});o.memo(function({showProgress:a=!1}){return e.jsxs("div",{className:"metric-skeleton",children:[e.jsx(Y,{width:"60%",height:"0.75rem",className:"skeleton-label"}),e.jsx(Y,{width:"80%",height:"1.75rem",className:"skeleton-value"}),a&&e.jsx(Y,{width:"100%",height:"6px",className:"skeleton-progress"})]})});const So=o.memo(function({lines:a=3,showHeader:n=!0,showAction:t=!1}){return e.jsxs("div",{className:"card-skeleton","aria-busy":"true","aria-label":"Loading content",children:[n&&e.jsxs("div",{className:"card-skeleton-header",children:[e.jsx(Y,{width:"40%",height:"1.25rem"}),t&&e.jsx(Y,{width:"80px",height:"32px"})]}),e.jsx("div",{className:"card-skeleton-body",children:Array.from({length:a}).map((r,i)=>e.jsx(Y,{width:`${100-i*15}%`,height:"1rem",className:"skeleton-line"},i))})]})});o.memo(function({count:a=3,showAvatar:n=!1,showAction:t=!1}){return e.jsx("div",{className:"list-skeleton","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:a}).map((r,i)=>e.jsxs("div",{className:"list-item-skeleton",children:[n&&e.jsx(Y,{width:"40px",height:"40px",variant:"circular"}),e.jsxs("div",{className:"list-item-skeleton-content",children:[e.jsx(Y,{width:"60%",height:"1rem"}),e.jsx(Y,{width:"40%",height:"0.75rem"})]}),t&&e.jsx(Y,{width:"60px",height:"28px"})]},i))})});o.memo(function(){return e.jsx("div",{className:"financial-row-skeleton","aria-busy":"true","aria-label":"Loading financial data",children:[1,2,3].map(a=>e.jsxs("div",{className:"financial-card-skeleton",children:[e.jsxs("div",{className:"financial-card-skeleton-header",children:[e.jsx(Y,{width:"24px",height:"24px",variant:"circular"}),e.jsx(Y,{width:"60%",height:"1rem"})]}),e.jsx(Y,{width:"50%",height:"2rem",className:"skeleton-hero-value"}),e.jsxs("div",{className:"financial-card-skeleton-details",children:[e.jsx(Y,{width:"100%",height:"0.875rem"}),e.jsx(Y,{width:"80%",height:"0.875rem"})]})]},a))})});o.memo(function({height:a="200px"}){return e.jsxs("div",{className:"chart-skeleton",style:{height:a},"aria-busy":"true","aria-label":"Loading chart",children:[e.jsx("div",{className:"chart-skeleton-bars",children:[40,65,45,80,55,70,50,75,60,85].map((n,t)=>e.jsx("div",{className:"chart-skeleton-bar",style:{height:`${n}%`}},t))}),e.jsx(Y,{width:"100%",height:"1px",className:"chart-skeleton-axis"})]})});const De=o.memo(function({count:a=3}){return e.jsx("div",{className:"ticket-skeleton-list","aria-busy":"true","aria-label":"Loading tickets",children:Array.from({length:a}).map((n,t)=>e.jsxs("div",{className:"ticket-skeleton-item",children:[e.jsxs("div",{className:"ticket-skeleton-header",children:[e.jsx(Y,{width:"100px",height:"0.875rem"}),e.jsx(Y,{width:"80px",height:"24px",borderRadius:"12px"})]}),e.jsx(Y,{width:"90%",height:"1rem"}),e.jsxs("div",{className:"ticket-skeleton-footer",children:[e.jsx(Y,{width:"60px",height:"0.75rem"}),e.jsx(Y,{width:"60px",height:"0.75rem"}),e.jsx(Y,{width:"60px",height:"0.75rem"})]})]},t))})}),Uc=o.memo(function(){return e.jsx("div",{className:"hero-metrics-skeleton","aria-busy":"true","aria-label":"Loading metrics",children:[1,2,3,4].map(a=>e.jsxs("div",{className:"hero-metric-skeleton",children:[e.jsx(Y,{width:"80px",height:"0.75rem",className:"skeleton-label"}),e.jsx(Y,{width:"120px",height:"1.75rem",className:"skeleton-value"}),e.jsx(Y,{width:"100%",height:"4px",className:"skeleton-bar"})]},a))})}),Do=o.memo(function({title:a="Unable to load data",message:n="Something went wrong. Please try again.",error:t=null,onRetry:r=null,retryLabel:i="Try Again",variant:l="default",icon:c=null}){const m=c||(t?.message?.includes("network")||t?.message?.includes("offline")?Vi:Ve);return l==="compact"?e.jsxs("div",{className:"error-state error-state-compact",role:"alert",children:[e.jsx(m,{size:16,className:"error-state-icon","aria-hidden":"true"}),e.jsx("span",{className:"error-state-message",children:n}),r&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:r,"aria-label":i,children:e.jsx(ea,{size:14})})]}):l==="inline"?e.jsxs("div",{className:"error-state error-state-inline",role:"alert",children:[e.jsxs("div",{className:"error-state-content",children:[e.jsx(m,{size:20,className:"error-state-icon","aria-hidden":"true"}),e.jsxs("div",{className:"error-state-text",children:[e.jsx("span",{className:"error-state-title",children:a}),e.jsx("span",{className:"error-state-message",children:n})]})]}),r&&e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:r,children:[e.jsx(ea,{size:14})," ",i]})]}):e.jsxs("div",{className:"error-state",role:"alert","aria-live":"polite",children:[e.jsx("div",{className:"error-state-icon-wrapper",children:e.jsx(m,{size:32,className:"error-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"error-state-title",children:a}),e.jsx("p",{className:"error-state-message",children:n}),!1,r&&e.jsxs("button",{className:"btn btn-primary",onClick:r,children:[e.jsx(ea,{size:16})," ",i]})]})}),_o=o.memo(function({title:a="No data yet",message:n="Items will appear here once added.",icon:t=null,action:r=null,actionLabel:i="Get Started",onAction:l=null}){return e.jsxs("div",{className:"empty-state",role:"status",children:[t&&e.jsx("div",{className:"empty-state-icon-wrapper",children:e.jsx(t,{size:32,className:"empty-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"empty-state-title",children:a}),e.jsx("p",{className:"empty-state-message",children:n}),l&&e.jsx("button",{className:"btn btn-primary btn-small",onClick:l,children:i}),r&&!l&&r]})});o.memo(function({label:a,error:n,required:t=!1,hint:r,children:i,className:l=""}){return e.jsxs("div",{className:`form-field ${n?"has-error":""} ${l}`,children:[a&&e.jsxs("label",{className:"form-field-label",children:[a,t&&e.jsx("span",{className:"form-field-required",children:"*"})]}),e.jsx("div",{className:"form-field-input",children:i}),n&&e.jsxs("div",{className:"form-field-error",role:"alert",children:[e.jsx(os,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:n})]}),r&&!n&&e.jsx("div",{className:"form-field-hint",children:r})]})});o.memo(function({type:a="text",value:n,onChange:t,onBlur:r,error:i,placeholder:l,disabled:c,min:u,max:m,step:d,pattern:x,required:f,autoComplete:y,name:h,id:p,className:k="","aria-label":P,"aria-describedby":v}){const R=p||h,g=i?`${R}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:a,id:R,name:h,value:n,onChange:t,onBlur:r,placeholder:l,disabled:c,min:u,max:m,step:d,pattern:x,required:f,autoComplete:y,className:`validated-input ${i?"has-error":""} ${k}`,"aria-label":P,"aria-invalid":!!i,"aria-describedby":i?g:v}),i&&e.jsxs("div",{id:g,className:"input-error-inline",role:"alert",children:[e.jsx(os,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:i})]})]})});o.memo(function({value:a,onChange:n,onBlur:t,error:r,disabled:i,required:l,name:c,id:u,className:m="",children:d,"aria-label":x}){const f=u||c,y=r?`${f}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("select",{id:f,name:c,value:a,onChange:n,onBlur:t,disabled:i,required:l,className:`validated-select ${r?"has-error":""} ${m}`,"aria-label":x,"aria-invalid":!!r,"aria-describedby":r?y:void 0,children:d}),r&&e.jsxs("div",{id:y,className:"input-error-inline",role:"alert",children:[e.jsx(os,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});o.memo(function({value:a,onChange:n,onBlur:t,error:r,placeholder:i,disabled:l,required:c,rows:u=3,maxLength:m,name:d,id:x,className:f="","aria-label":y}){const h=x||d,p=r?`${h}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("textarea",{id:h,name:d,value:a,onChange:n,onBlur:t,placeholder:i,disabled:l,required:c,rows:u,maxLength:m,className:`validated-textarea ${r?"has-error":""} ${f}`,"aria-label":y,"aria-invalid":!!r,"aria-describedby":r?p:void 0}),m&&e.jsxs("div",{className:"textarea-counter",children:[a?.length||0," / ",m]}),r&&e.jsxs("div",{id:p,className:"input-error-inline",role:"alert",children:[e.jsx(os,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});const Hc=o.memo(function({count:a,label:n,variant:t="default",size:r="medium",pulse:i=!1,icon:l}){const[c,u]=o.useState(a),[m,d]=o.useState(!1);return o.useEffect(()=>{if(a!==c){d(!0);const x=setTimeout(()=>{d(!1),u(a)},400);return()=>clearTimeout(x)}},[a,c]),e.jsxs("span",{className:`count-badge count-badge-${t} count-badge-${r} ${i?"badge-new":""} ${m?"animate-count-up":""}`,title:n,children:[l&&e.jsx(l,{size:r==="small"?12:r==="large"?18:14}),e.jsx("span",{className:"count-badge-value",children:a}),n&&e.jsx("span",{className:"count-badge-label",children:n})]})}),Kc=o.memo(function({value:a,max:n=100,showLabel:t=!1,size:r="medium",variant:i="default",animated:l=!0}){const c=Math.min(100,Math.max(0,a/n*100)),u=r==="small"?"4px":r==="large"?"8px":"6px",m=i==="default"?c>=80?"danger":c>=60?"warning":"success":i;return e.jsxs("div",{className:`mini-progress mini-progress-${r}`,children:[e.jsx("div",{className:"mini-progress-track",style:{height:u},children:e.jsx("div",{className:`mini-progress-fill mini-progress-${m} ${l?"progress-animate":""}`,style:{width:`${c}%`}})}),t&&e.jsxs("span",{className:"mini-progress-label",children:[Math.round(c),"%"]})]})}),Gc=o.memo(function({value:a,previousValue:n,format:t="percent",inverted:r=!1,showValue:i=!0}){const l=a-n,c=n!==0?l/n*100:0;let u=l===0?"neutral":l>0?"up":"down",m="neutral";l!==0&&(r?m=l>0?"negative":"positive":m=l>0?"positive":"negative");const d=u==="up"?cs:u==="down"?ls:ja,x=()=>{const f=Math.abs(l);switch(t){case"percent":return`${Math.abs(c).toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(f);default:return f.toLocaleString()}};return e.jsxs("span",{className:`trend-indicator trend-${m}`,children:[e.jsx(d,{size:14}),i&&e.jsx("span",{className:"trend-value",children:x()})]})});o.memo(function({status:a="default",label:n,size:t="medium",pulse:r=!1}){return e.jsxs("span",{className:`status-dot-container status-dot-${t}`,children:[e.jsx("span",{className:`status-dot status-dot-${a} ${r?"status-dot-pulse":""}`}),n&&e.jsx("span",{className:"status-dot-label",children:n})]})});o.memo(function({data:a=[],width:n=80,height:t=24,strokeWidth:r=2,color:i="var(--accent-blue)",showArea:l=!0}){if(!a.length)return null;const c=Math.max(...a),u=Math.min(...a),m=c-u||1,d=a.map((f,y)=>{const h=y/(a.length-1)*n,p=t-(f-u)/m*(t-r*2)-r;return`${h},${p}`}).join(" "),x=`0,${t} ${d} ${n},${t}`;return e.jsxs("svg",{width:n,height:t,className:"sparkline",viewBox:`0 0 ${n} ${t}`,children:[l&&e.jsx("polygon",{points:x,fill:i,fillOpacity:"0.15"}),e.jsx("polyline",{points:d,fill:"none",stroke:i,strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]})});o.memo(function({items:a=[]}){return e.jsx("div",{className:"quick-stats",children:a.map((n,t)=>e.jsxs("span",{className:"quick-stat-item",children:[n.icon&&e.jsx(n.icon,{size:12}),e.jsx("span",{className:"quick-stat-value",children:n.value}),n.label&&e.jsx("span",{className:"quick-stat-label",children:n.label})]},t))})});o.memo(function({status:a,label:n,size:t="medium"}){const r={success:Gt,warning:Ve,danger:Ve,info:xt,pending:xt},i=r[a]||r.info;return e.jsxs("span",{className:`status-indicator status-indicator-${a} status-indicator-${t}`,children:[e.jsx(i,{size:t==="small"?12:t==="large"?18:14}),n&&e.jsx("span",{className:"status-indicator-label",children:n})]})});o.memo(function({current:a,previous:n,format:t="number",label:r,inverted:i=!1}){const l=a-n,c=i?l<0:l>0,u=i?l>0:l<0,m=d=>{switch(t){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(Math.abs(d));case"percent":return`${Math.abs(d).toFixed(1)}%`;default:return Math.abs(d).toLocaleString()}};return e.jsxs("div",{className:`metric-delta ${c?"positive":u?"negative":"neutral"}`,children:[e.jsx("span",{className:"metric-delta-arrow",children:l>0?"↑":l<0?"↓":"→"}),e.jsx("span",{className:"metric-delta-value",children:m(l)}),r&&e.jsx("span",{className:"metric-delta-label",children:r})]})});o.memo(function({value:a,max:n=100,size:t=40,strokeWidth:r=4,showValue:i=!0,color:l="var(--accent-blue)"}){const c=Math.min(100,Math.max(0,a/n*100)),u=(t-r)/2,m=u*2*Math.PI,d=m-c/100*m;return e.jsxs("div",{className:"circular-progress",style:{width:t,height:t},children:[e.jsxs("svg",{width:t,height:t,viewBox:`0 0 ${t} ${t}`,children:[e.jsx("circle",{className:"circular-progress-track",cx:t/2,cy:t/2,r:u,fill:"none",strokeWidth:r}),e.jsx("circle",{className:"circular-progress-fill",cx:t/2,cy:t/2,r:u,fill:"none",stroke:l,strokeWidth:r,strokeDasharray:m,strokeDashoffset:d,strokeLinecap:"round",transform:`rotate(-90 ${t/2} ${t/2})`,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),i&&e.jsxs("span",{className:"circular-progress-value",children:[Math.round(c),"%"]})]})});o.memo(function({isOpen:a,onClose:n,title:t,children:r,size:i="medium",className:l="",showCloseButton:c=!0,closeOnOverlayClick:u=!0,closeOnEscape:m=!0,footer:d,ariaDescribedBy:x}){const f=o.useRef(null),y=o.useRef(null),h=o.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`);o.useEffect(()=>{if(a){y.current=document.activeElement;const v=setTimeout(()=>{f.current?.focus()},10);return()=>clearTimeout(v)}},[a]),o.useEffect(()=>{!a&&y.current&&y.current.focus()},[a]),o.useEffect(()=>{if(!a||!m)return;const v=R=>{R.key==="Escape"&&(R.preventDefault(),n())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[a,m,n]),o.useEffect(()=>{if(a){const v=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=v}}},[a]);const p=o.useCallback(v=>{if(v.key!=="Tab")return;const R=f.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!R||R.length===0)return;const g=R[0],N=R[R.length-1];v.shiftKey?document.activeElement===g&&(v.preventDefault(),N.focus()):document.activeElement===N&&(v.preventDefault(),g.focus())},[]),k=v=>{u&&v.target===v.currentTarget&&n()};if(!a)return null;const P={small:"modal-small",medium:"modal-medium",large:"modal-large",full:"modal-full"};return e.jsx("div",{className:"modal-overlay",onClick:k,role:"presentation",children:e.jsxs("div",{ref:f,className:`modal-content ${P[i]||""} ${l}`,role:"dialog","aria-modal":"true","aria-labelledby":t?h.current:void 0,"aria-describedby":x,tabIndex:-1,onKeyDown:p,onClick:v=>v.stopPropagation(),children:[t&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:h.current,children:t}),c&&e.jsx("button",{className:"close-btn",onClick:n,"aria-label":"Close modal",type:"button",children:e.jsx(We,{size:20})})]}),e.jsx("div",{className:"modal-body",children:r}),d&&e.jsx("div",{className:"modal-footer",children:d})]})})});const Ze=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),_s=o.memo(function({icon:a,label:n,value:t,formattedValue:r,subLabel:i,progress:l,progressLabel:c,variant:u="default",trend:m,previousValue:d}){const x={default:"var(--accent-blue)",success:"var(--accent-green)",warning:"var(--accent-amber)",danger:"var(--accent-red)"};return e.jsxs("div",{className:"hero-metric-card hover-lift animate-fade-in-up",children:[e.jsxs("div",{className:"hero-metric-header",children:[e.jsx("div",{className:"hero-metric-icon",style:{color:x[u]},children:e.jsx(a,{size:18})}),e.jsx("span",{className:"hero-metric-label",children:n})]}),e.jsxs("div",{className:"hero-metric-value-row",children:[e.jsx("span",{className:`hero-metric-value hero-metric-${u}`,children:r}),m!==void 0&&d!==void 0&&e.jsx(Gc,{value:t,previousValue:d,format:"currency",inverted:n.toLowerCase().includes("cost")})]}),i&&e.jsx("span",{className:"hero-metric-sublabel",children:i}),l!==void 0&&e.jsxs("div",{className:"hero-metric-progress",children:[e.jsx(Kc,{value:l,max:100,size:"small",variant:u,showLabel:!0}),c&&e.jsx("span",{className:"hero-metric-progress-label",children:c})]})]})}),Yc=o.memo(function({contractValue:a=0,earnedRevenue:n=0,totalCosts:t=0,profit:r=0,progress:i=0,corApprovedValue:l=0,loading:c=!1,previousData:u}){const m=a+l,d=n>0?r/n*100:0,x=n>0?t/n*100:0,f=m>0?n/m*100:0,y=m>0?t/m*100:0,h=o.useMemo(()=>d>=20?"success":d>=10?"warning":d<0?"danger":"default",[d]),p=o.useMemo(()=>x<=60?"success":x<=80?"warning":"danger",[x]);return c?e.jsx(Uc,{}):e.jsxs("div",{className:"hero-metrics stagger-children",children:[e.jsx(_s,{icon:es,label:"Contract Value",value:m,formattedValue:Ze(m),subLabel:l>0?`+${Ze(l)} CORs`:null,variant:"default"}),e.jsx(_s,{icon:cs,label:"Earned Revenue",value:n,formattedValue:Ze(n),progress:f,progressLabel:`${Math.round(f)}% of contract`,variant:"success",previousValue:u?.earnedRevenue,trend:u?n:void 0}),e.jsx(_s,{icon:Yt,label:"Total Costs",value:t,formattedValue:Ze(t),progress:y,progressLabel:`${Math.round(x)}% of revenue`,variant:p,previousValue:u?.totalCosts,trend:u?t:void 0}),e.jsx(_s,{icon:Bi,label:"Profit",value:r,formattedValue:Ze(r),subLabel:`${d>=0?"+":""}${d.toFixed(1)}% margin`,variant:h,previousValue:u?.profit,trend:u?r:void 0})]})});function Jc({onShowToast:s,onClose:a}){const[n,t]=o.useState("loading"),[r,i]=o.useState([]),[l,c]=o.useState(null),[u,m]=o.useState(null),[d,x]=o.useState(null),[f,y]=o.useState(""),[h,p]=o.useState(!1),[k,P]=o.useState(!1),[v,R]=o.useState(null);o.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:A,error:F}=await Qe.auth.mfa.listFactors();if(F)throw F;const O=(A?.totp||[]).filter(L=>L.status==="verified");i(O),t("overview")}catch{t("overview")}},N=async()=>{R(null);try{const{data:A,error:F}=await Qe.auth.mfa.enroll({factorType:"totp",friendlyName:"FieldSync Authenticator"});if(F)throw F;c(A.totp.qr_code),m(A.totp.secret),x(A.id),t("enroll")}catch(A){R(A.message),s?.("Failed to start MFA enrollment","error")}},$=async()=>{if(f.length===6){p(!0),R(null);try{const{data:A,error:F}=await Qe.auth.mfa.challenge({factorId:d});if(F)throw F;const{error:O}=await Qe.auth.mfa.verify({factorId:d,challengeId:A.id,code:f});if(O)throw O;t("success"),s?.("MFA enabled successfully!","success"),await g()}catch{R("Invalid code. Please try again."),y("")}finally{p(!1)}}},H=async A=>{try{const{error:F}=await Qe.auth.mfa.unenroll({factorId:A});if(F)throw F;s?.("MFA disabled","success"),await g()}catch{s?.("Failed to disable MFA","error")}},_=()=>{navigator.clipboard.writeText(u),P(!0),setTimeout(()=>P(!1),2e3)},w=r.length>0;return e.jsxs("div",{className:"mfa-setup",children:[e.jsxs("div",{className:"mfa-header",children:[e.jsxs("div",{className:"mfa-title",children:[w?e.jsx(sa,{size:20,className:"text-success"}):e.jsx(la,{size:20}),e.jsx("h3",{children:"Two-Factor Authentication"})]}),a&&e.jsx("button",{className:"close-btn",onClick:a,"aria-label":"Close",children:e.jsx(We,{size:20})})]}),n==="loading"&&e.jsxs("div",{className:"mfa-loading",children:[e.jsx(vt,{size:24,className:"spinner"})," Loading..."]}),n==="overview"&&e.jsxs("div",{className:"mfa-overview",children:[e.jsx("p",{className:"mfa-description",children:"Add an extra layer of security to your account. When enabled, you will need to enter a code from your authenticator app each time you sign in."}),w?e.jsxs("div",{className:"mfa-status mfa-status-enabled",children:[e.jsx(sa,{size:18}),e.jsx("span",{children:"MFA is enabled"}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>H(r[0].id),children:[e.jsx(ft,{size:14})," Disable"]})]}):e.jsxs("div",{className:"mfa-status mfa-status-disabled",children:[e.jsx(ft,{size:18}),e.jsx("span",{children:"MFA is not enabled"}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:N,children:[e.jsx(la,{size:14})," Enable MFA"]})]})]}),n==="enroll"&&e.jsxs("div",{className:"mfa-enroll",children:[e.jsx("p",{children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):"}),l&&e.jsx("div",{className:"mfa-qr-container",children:e.jsx("img",{src:l,alt:"MFA QR Code",className:"mfa-qr"})}),e.jsxs("div",{className:"mfa-secret",children:[e.jsx("span",{className:"mfa-secret-label",children:"Or enter this key manually:"}),e.jsxs("div",{className:"mfa-secret-value",children:[e.jsx("code",{children:u}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:_,"aria-label":"Copy secret key",children:k?e.jsx(Gt,{size:14}):e.jsx(Wi,{size:14})})]})]}),e.jsxs("div",{className:"mfa-verify-section",children:[e.jsx("label",{htmlFor:"mfa-verify-code",children:"Enter the 6-digit code from your app:"}),e.jsxs("div",{className:"mfa-code-input",children:[e.jsx("input",{id:"mfa-verify-code",type:"text",value:f,onChange:A=>y(A.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,autoFocus:!0,inputMode:"numeric",pattern:"[0-9]*"}),e.jsx("button",{className:"btn btn-primary",onClick:$,disabled:f.length!==6||h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(vt,{size:14,className:"spinner"})," Verifying..."]}):"Verify & Enable"})]}),v&&e.jsx("p",{className:"mfa-error",children:v})]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>t("overview"),children:"Cancel"})]}),n==="success"&&e.jsxs("div",{className:"mfa-success",children:[e.jsx(sa,{size:48,className:"text-success"}),e.jsx("h4",{children:"MFA Enabled"}),e.jsx("p",{children:"Your account is now protected with two-factor authentication."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>t("overview"),children:"Done"})]})]})}const Ot=[{id:"overview",label:"Overview",shortLabel:"Overview",icon:Hi,description:"Metrics & trends",step:null},{id:"cors",label:"Change Orders",shortLabel:"CORs",icon:Le,description:"CORs & approvals",step:1},{id:"tickets",label:"T&M Tickets",shortLabel:"Tickets",icon:he,description:"Field data",step:2},{id:"billing",label:"Billing",shortLabel:"Billing",icon:Yt,description:"Invoices & billing",step:3}],Xc=o.memo(function({activeSection:a="overview",onSectionChange:n,collapsed:t=!1,onToggleCollapse:r,onMobileClose:i,stats:l={}}){const{corCount:c=0,ticketCount:u=0,corPending:m=0,ticketPending:d=0,billableCount:x=0,invoiceCount:f=0}=l,y=h=>h==="cors"&&c>0?{count:c,variant:m>0?"warning":"default",pending:m}:h==="tickets"&&u>0?{count:u,variant:d>0?"warning":"default",pending:d}:h==="billing"&&x>0?{count:x,variant:"success",pending:x}:null;return e.jsxs("nav",{className:`financials-nav ${t?"collapsed":""}`,"aria-label":"Financials sections",children:[i&&e.jsxs("div",{className:"financials-nav-mobile-header",children:[e.jsx("span",{className:"financials-nav-mobile-title",children:"Financials"}),e.jsx("button",{className:"financials-nav-mobile-close",onClick:i,"aria-label":"Close menu",children:e.jsx(We,{size:20})})]}),e.jsxs("button",{className:"financials-nav-toggle",onClick:r,"aria-label":t?"Expand sidebar":"Collapse sidebar",title:t?"Expand sidebar":"Collapse sidebar",children:[t?e.jsx(Ui,{size:18}):e.jsx(Jt,{size:18}),!t&&e.jsx("span",{children:"Collapse"})]}),e.jsx("div",{className:"financials-nav-items",children:Ot.map((h,p)=>{const k=a===h.id,P=h.icon,v=y(h.id),R=p<Ot.length-1&&h.step!==null;return e.jsxs("div",{className:"financials-nav-item-wrapper",children:[e.jsxs("button",{className:`financials-nav-item ${k?"active":""}`,onClick:()=>n?.(h.id),"aria-current":k?"page":void 0,title:`${h.label}${v?` (${v.count})`:""}`,children:[h.step&&!t&&e.jsx("span",{className:"financials-nav-step",children:h.step}),e.jsxs("div",{className:"financials-nav-icon",children:[e.jsx(P,{size:t?22:20}),v&&v.pending>0&&e.jsx("span",{className:"financials-nav-dot"})]}),t&&e.jsx("span",{className:"financials-nav-short-label",children:h.shortLabel}),!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"financials-nav-content",children:[e.jsx("span",{className:"financials-nav-label",children:h.label}),e.jsx("span",{className:"financials-nav-desc",children:h.description})]}),v&&e.jsx(Hc,{count:v.count,size:"small",variant:v.variant}),e.jsx(qe,{size:16,className:"financials-nav-arrow"})]})]}),R&&!t&&e.jsx("div",{className:"financials-nav-connector",children:e.jsx("div",{className:"connector-line"})})]},h.id)})}),t&&e.jsxs("button",{className:"financials-nav-expand-btn",onClick:r,"aria-label":"Expand sidebar",children:[e.jsx(qe,{size:14}),e.jsx("span",{children:"Expand"})]})]})}),Qc=o.memo(function({progress:a=0,areasComplete:n=0,totalAreas:t=0,areasWorking:r=0,size:i=110,strokeWidth:l=9}){const[c,u]=o.useState(0),m=o.useRef(null);o.useEffect(()=>{const h=c,p=Math.min(100,Math.max(0,a)),k=800,P=performance.now(),v=R=>{const g=R-P,N=Math.min(g/k,1),$=1-Math.pow(1-N,3),H=h+(p-h)*$;u(H),N<1&&(m.current=requestAnimationFrame(v))};return m.current=requestAnimationFrame(v),()=>{m.current&&cancelAnimationFrame(m.current)}},[a]);const d=(i-l)/2,x=d*2*Math.PI,f=x-c/100*x,y=()=>c>=80?"var(--accent-green)":c>=50||c>=25?"var(--accent-blue)":"var(--text-muted)";return e.jsxs("div",{className:"overview-progress-gauge",children:[e.jsxs("div",{className:"progress-gauge-circle",style:{width:i,height:i},children:[e.jsxs("svg",{width:i,height:i,viewBox:`0 0 ${i} ${i}`,children:[e.jsx("circle",{className:"gauge-track",cx:i/2,cy:i/2,r:d,fill:"none",strokeWidth:l,stroke:"var(--bg-tertiary)"}),e.jsx("circle",{className:"gauge-fill",cx:i/2,cy:i/2,r:d,fill:"none",stroke:y(),strokeWidth:l,strokeDasharray:x,strokeDashoffset:f,strokeLinecap:"round",transform:`rotate(-90 ${i/2} ${i/2})`,style:{transition:"stroke 0.3s ease"}})]}),e.jsxs("div",{className:"gauge-center",children:[e.jsxs("span",{className:"gauge-value",children:[Math.round(c),"%"]}),e.jsx("span",{className:"gauge-label",children:"Complete"})]})]}),e.jsxs("div",{className:"gauge-areas-status",children:[e.jsxs("span",{className:"areas-count",children:[e.jsx("strong",{children:n}),"/",t," Areas Done"]}),r>0&&e.jsxs("span",{className:"areas-active",children:[r," active"]})]})]})}),Zc=o.memo(function({earnedRevenue:a=0,totalCosts:n=0,laborCost:t=0,disposalCost:r=0,equipmentCost:i=0,materialsCost:l=0,otherCost:c=0,contractValue:u=0}){const m=a-n,d=a>0?m/a*100:0,x=m>=0,f=p=>p>=1e6?`$${(p/1e6).toFixed(1)}M`:p>=1e3?`$${(p/1e3).toFixed(1)}K`:`$${p.toFixed(0)}`,y=[{key:"labor",value:t,color:W.labor,label:"Labor"},{key:"disposal",value:r,color:W.disposal,label:"Disposal"},{key:"equipment",value:i,color:W.equipment,label:"Equipment"},{key:"materials",value:l,color:W.materials,label:"Materials"},{key:"other",value:c,color:W.other,label:"Other"}].filter(p=>p.value>0),h=y.length>0&&n>0;return e.jsxs("div",{className:"overview-financial-card animate-fade-in-up",children:[e.jsxs("div",{className:"financial-metrics-row",children:[e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value green",children:f(a)}),e.jsx("span",{className:"financial-metric-label",children:"Earned"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value amber",children:f(n)}),e.jsx("span",{className:"financial-metric-label",children:"Costs"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsxs("span",{className:`financial-metric-value ${x?"green":"red"}`,children:[x?"":"-",f(Math.abs(m))]}),e.jsxs("span",{className:"financial-metric-label",children:["Profit",e.jsxs("span",{className:`margin-badge ${x?"positive":"negative"}`,children:[d>=0?"+":"",d.toFixed(0),"%"]})]})]})]}),h&&e.jsxs("div",{className:"cost-breakdown-section",children:[e.jsx("div",{className:"cost-breakdown-bar",children:y.map((p,k)=>{const P=p.value/n*100;return e.jsx("div",{className:"cost-segment",style:{width:`${P}%`,backgroundColor:p.color,animationDelay:`${k*100}ms`},title:`${p.label}: ${f(p.value)} (${P.toFixed(0)}%)`},p.key)})}),e.jsx("div",{className:"cost-breakdown-legend",children:y.slice(0,4).map(p=>e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot",style:{backgroundColor:p.color}}),e.jsx("span",{className:"legend-label",children:p.label})]},p.key))})]})]})}),eo=()=>ne(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),Es={contract:W.contract,tm:W.costs},At=[{id:"7d",label:"7D",days:7},{id:"14d",label:"14D",days:14},{id:"30d",label:"30D",days:30}],so=o.memo(function({project:a,onShowToast:n}){const[t,r]=o.useState([]),[i,l]=o.useState([]),[c,u]=o.useState(new Date().toISOString().split("T")[0]),[m,d]=o.useState("14d"),[x,f]=o.useState(!0),[y,h]=o.useState(!1);o.useEffect(()=>{a?.id&&p()},[a?.id]);const p=async()=>{f(!0);try{const[O,L]=await Promise.all([z.getCrewCheckinHistory(a.id,365),z.getTMTickets(a.id)]);r(O||[]),l(L||[])}catch(O){console.error("Error loading crew metrics:",O)}finally{f(!1)}},k=o.useMemo(()=>{const O={};return i.forEach(L=>{const S=L.work_date;S&&(O[S]||(O[S]=new Set),(L.t_and_m_workers||[]).forEach(Q=>{O[S].add(Q.name.toLowerCase().trim())}))}),O},[i]),P=o.useMemo(()=>{const O={};return t.forEach(L=>{O[L.check_in_date]=L.workers||[]}),O},[t]),v=P[c]||[],R=k[c]||new Set,g=o.useMemo(()=>{const O=[],L=[];return v.forEach(S=>{R.has(S.name.toLowerCase().trim())?L.push(S):O.push(S)}),{total:v.length,contract:O,tm:L}},[v,R]),N=o.useMemo(()=>{const O=At.find(Q=>Q.id===m)?.days||14,L=[],S=new Date;for(let Q=O-1;Q>=0;Q--){const T=new Date(S);T.setDate(T.getDate()-Q);const re=T.toISOString().split("T")[0],Ne=P[re]||[],ie=k[re]||new Set;let ms=0,Ce=0;Ne.forEach(He=>{ie.has(He.name.toLowerCase().trim())?Ce++:ms++}),L.push({date:re,displayDate:ba(re),contract:ms,tm:Ce,total:Ne.length})}return L},[P,k,m]),$=o.useCallback(O=>{const L=new Date(c+"T12:00:00");L.setDate(L.getDate()+O),u(L.toISOString().split("T")[0])},[c]),H=c===new Date().toISOString().split("T")[0],_=O=>new Date(O+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),w=o.useCallback(O=>{O?.date&&u(O.date)},[]),A=({active:O,payload:L,label:S})=>{if(!O||!L?.length)return null;const Q=(L[0]?.value||0)+(L[1]?.value||0);return e.jsxs("div",{style:{...Dt.contentStyle,fontSize:"0.8rem"},children:[e.jsx("p",{style:{...Dt.labelStyle,fontSize:"0.85rem",marginBottom:6},children:S}),e.jsxs("p",{style:{margin:"3px 0",color:Es.contract},children:["Contract: ",e.jsx("strong",{children:L[0]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:Es.tm},children:["T&M: ",e.jsx("strong",{children:L[1]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:"var(--text-primary)",borderTop:"1px solid var(--border-color)",paddingTop:4},children:["Total: ",e.jsx("strong",{children:Q})]})]})},F=o.useCallback(async()=>{h(!0),n?.("Generating crew report PDF...","info");try{const L=(await eo()).default,S=new L,Q=S.internal.pageSize.width;let T=20;S.setFontSize(18),S.setFont(void 0,"bold"),S.text("Crew On-Site Report",Q/2,T,{align:"center"}),T+=8,S.setFontSize(11),S.setFont(void 0,"normal"),S.text(`Project: ${a.name}`,Q/2,T,{align:"center"}),T+=6,S.text(`Date: ${_(c)}`,Q/2,T,{align:"center"}),T+=12,S.setFontSize(12),S.setFont(void 0,"bold"),S.text("Selected Day Summary",14,T),T+=7,S.setFontSize(10),S.setFont(void 0,"normal"),S.text(`Total Crew On-Site: ${g.total}`,14,T),T+=5,S.text(`Contract Workers: ${g.contract.length}`,14,T),T+=5,S.text(`T&M Workers: ${g.tm.length}`,14,T),T+=10,g.contract.length>0&&(S.setFontSize(12),S.setFont(void 0,"bold"),S.text("Contract Workers",14,T),T+=7,S.setFontSize(9),S.setFont(void 0,"bold"),S.text("Name",14,T),S.text("Role",100,T),T+=5,S.setFont(void 0,"normal"),g.contract.forEach(ie=>{T>270&&(S.addPage(),T=20),S.text(ie.name,14,T),S.text(ie.role||"—",100,T),T+=5}),T+=8),g.tm.length>0&&(T>240&&(S.addPage(),T=20),S.setFontSize(12),S.setFont(void 0,"bold"),S.text("T&M Workers (Extra Work)",14,T),T+=7,S.setFontSize(9),S.setFont(void 0,"bold"),S.text("Name",14,T),S.text("Role",100,T),T+=5,S.setFont(void 0,"normal"),g.tm.forEach(ie=>{T>270&&(S.addPage(),T=20),S.text(ie.name,14,T),S.text(ie.role||"—",100,T),T+=5}),T+=8),T>200&&(S.addPage(),T=20),S.setFontSize(12),S.setFont(void 0,"bold"),S.text("Daily Timeline",14,T),T+=7,S.setFontSize(8),S.setFont(void 0,"bold"),S.text("Date",14,T),S.text("Total",70,T),S.text("Contract",95,T),S.text("T&M",125,T),T+=5,S.setFont(void 0,"normal"),N.forEach(ie=>{T>275&&(S.addPage(),T=20),S.text(ie.displayDate,14,T),S.text(String(ie.total),70,T),S.text(String(ie.contract),95,T),S.text(String(ie.tm),125,T),T+=4.5});const re=S.internal.pageSize.height-10;S.setFontSize(8),S.setTextColor(128,128,128),S.text(`Generated ${new Date().toLocaleString()} — FieldSync`,Q/2,re,{align:"center"});const Ne=`${a.name}_Crew_Report_${c}.pdf`;S.save(Ne),n?.("PDF exported!","success")}catch(O){console.error("Error exporting crew PDF:",O),n?.("Error generating PDF","error")}finally{h(!1)}},[a,c,g,N,n]);return x?e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsx("div",{className:"crew-metrics-header",children:e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Crew On-Site"]})}),e.jsxs("div",{className:"crew-metrics-loading",children:[e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"})]})]}):e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsxs("div",{className:"crew-metrics-header",children:[e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Crew On-Site"]}),e.jsx("div",{className:"crew-metrics-actions",children:e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:F,disabled:y,title:"Export crew report as PDF",children:[e.jsx(_e,{size:14})," ",y?"Exporting...":"PDF"]})})]}),e.jsxs("div",{className:"crew-date-nav",children:[e.jsx("button",{className:"crew-date-btn",onClick:()=>$(-1),children:e.jsx(Jt,{size:16})}),e.jsxs("span",{className:"crew-date-label",children:[e.jsx(Ht,{size:14}),H?"Today":_(c)]}),e.jsx("button",{className:"crew-date-btn",onClick:()=>$(1),disabled:H,children:e.jsx(qe,{size:16})})]}),e.jsxs("div",{className:"crew-stats-row",children:[e.jsxs("div",{className:"crew-stat total",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(xe,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.total}),e.jsx("span",{className:"crew-stat-label",children:"Total On-Site"})]})]}),e.jsxs("div",{className:"crew-stat contract",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(Pe,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.contract.length}),e.jsx("span",{className:"crew-stat-label",children:"Contract"})]})]}),e.jsxs("div",{className:"crew-stat tm",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(ia,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.tm.length}),e.jsx("span",{className:"crew-stat-label",children:"T&M"})]})]})]}),g.total>0&&e.jsxs("div",{className:"crew-breakdown-bar",children:[e.jsx("div",{className:"crew-bar-segment contract",style:{width:`${g.contract.length/g.total*100}%`},title:`${g.contract.length} Contract`}),e.jsx("div",{className:"crew-bar-segment tm",style:{width:`${g.tm.length/g.total*100}%`},title:`${g.tm.length} T&M`})]}),g.total>0&&e.jsxs("div",{className:"crew-name-lists",children:[g.contract.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header contract",children:[e.jsx(Pe,{size:13}),e.jsxs("span",{children:["Contract (",g.contract.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:g.contract.map((O,L)=>e.jsxs("span",{className:"crew-name-tag contract",children:[O.name,O.role&&O.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:O.role})]},L))})]}),g.tm.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header tm",children:[e.jsx(ia,{size:13}),e.jsxs("span",{children:["T&M (",g.tm.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:g.tm.map((O,L)=>e.jsxs("span",{className:"crew-name-tag tm",children:[O.name,O.role&&O.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:O.role})]},L))})]})]}),e.jsxs("div",{className:"crew-timeline-section",children:[e.jsxs("div",{className:"crew-timeline-header",children:[e.jsx("span",{className:"crew-timeline-title",children:"Daily Breakdown"}),e.jsx("div",{className:"crew-time-range-pills",children:At.map(O=>e.jsx("button",{className:`crew-range-pill ${m===O.id?"active":""}`,onClick:()=>d(O.id),children:O.label},O.id))})]}),e.jsx("div",{className:"crew-chart-container",children:e.jsx(va,{width:"100%",height:140,children:e.jsxs(Si,{data:N,onClick:O=>O?.activePayload?.[0]&&w(O.activePayload[0].payload),style:{cursor:"pointer"},children:[e.jsx(Vt,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Bt,{dataKey:"displayDate",tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:{stroke:"var(--border-color)"},tickLine:!1,interval:m==="30d"?4:m==="14d"?1:0}),e.jsx(Wt,{tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:!1,tickLine:!1,allowDecimals:!1,width:30}),e.jsx(fa,{content:e.jsx(A,{})}),e.jsx($s,{wrapperStyle:{fontSize:"0.75rem",paddingTop:4},iconType:"circle",iconSize:8}),e.jsx(ht,{dataKey:"contract",name:"Contract",stackId:"crew",fill:Es.contract,radius:[0,0,0,0]}),e.jsx(ht,{dataKey:"tm",name:"T&M (Extra Work)",stackId:"crew",fill:Es.tm,radius:[3,3,0,0]})]})})})]}),g.total===0&&e.jsx("div",{className:"crew-empty",children:e.jsx("p",{children:"No crew checked in for this date"})})]})}),ao=o.lazy(()=>ne(()=>import("./TMList-D_k_-ZDR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),to=o.lazy(()=>ne(()=>import("./ShareModal-wykV9g7D.js"),__vite__mapDeps([9,2,3,4,1,5,6]))),no=o.lazy(()=>ne(()=>import("./InjuryReportsList-lzqcQ_lB.js"),__vite__mapDeps([10,1,2,3,4,5,6,8]))),ro=o.lazy(()=>ne(()=>import("./NotificationSettings-CpCD8CpG.js"),__vite__mapDeps([11,2,3,4,1,5,6]))),io=o.lazy(()=>ne(()=>import("./DailyReportsList-CBkX-0eh.js"),__vite__mapDeps([12,1,2,3,4,5,6,8]))),lo=o.lazy(()=>ne(()=>import("./CORList-B4CeEbg2.js"),__vite__mapDeps([13,1,2,3,4,5,6,8,14]))),co=o.lazy(()=>ne(()=>import("./CORForm-DzVaJrep.js"),__vite__mapDeps([15,2,3,4,1,5,6,8]))),oo=o.lazy(()=>ne(()=>import("./CORDetail-CbZdYlSD.js"),__vite__mapDeps([16,2,3,4,1,5,6,8,17,7]))),uo=o.lazy(()=>ne(()=>import("./CORLogPreview-Dla2Qg-q.js"),__vite__mapDeps([18,2,3,4,1,5,6,8]))),mo=o.lazy(()=>ne(()=>import("./CORLog-BpqBPuo0.js").then(s=>s.a),__vite__mapDeps([14,1,2,3,4,5,6,8]))),ho=o.lazy(()=>ne(()=>import("./BillingCenter-D1htcYyM.js"),__vite__mapDeps([19,2,3,4,1,5,6,8]))),po=o.lazy(()=>ne(()=>import("./DrawRequestModal-DZd0Vm5z.js"),__vite__mapDeps([20,2,3,4,1,5,6,8]))),xo=o.lazy(()=>ne(()=>import("./EquipmentModal-F3yczh2X.js"),__vite__mapDeps([21,2,3,4,1,5,6]))),vo=o.lazy(()=>ne(()=>import("./AddCostModal-BMMBLFDK.js"),__vite__mapDeps([22,2,3,4,1,5,6]))),fo=o.lazy(()=>ne(()=>import("./DocumentsTab-DbaF9QRd.js"),__vite__mapDeps([23,2,3,4,1,5,6])));function jo({company:s,user:a,isAdmin:n,onShowToast:t,navigateToProjectId:r,onProjectNavigated:i}){const[l,c]=o.useState([]),[u,m]=o.useState([]),[d,x]=o.useState(null),[f,y]=o.useState([]),[h,p]=o.useState(!0),[k,P]=o.useState(!1),[v,R]=o.useState(null),[g,N]=o.useState(!1),[$,H]=o.useState(!1),[_,w]=o.useState(!1),[A,F]=o.useState("overview"),[O,L]=o.useState("overview"),[S,Q]=o.useState(!0),[T,re]=o.useState(!1),[Ne,ie]=o.useState(!1),[ms,Ce]=o.useState("list"),[He,zs]=o.useState("preview"),[ya,cn]=o.useState([]),[on,Ke]=o.useState(!1),[dn,Ge]=o.useState(null),[un,hs]=o.useState(!1),[Na,ps]=o.useState(null),[mn,Ca]=o.useState(0),[hn,qs]=o.useState(!1),[pn,wa]=o.useState(!1),[xn,xs]=o.useState(!1),[ka,vs]=o.useState(null),[vn,fn]=o.useState(0),[jn,fs]=o.useState(!1),[Sa,js]=o.useState(null),[gn,bn]=o.useState(0),{isOpen:yn,setIsOpen:Nn,close:Cn}=kc(),Ye=o.useRef(null),gs=o.useRef(!1),Vs=o.useRef(!1),Bs=o.useRef(new Map),Da=300*1e3,te=o.useCallback((j={})=>{const{refreshAreas:E=!1,refreshCOR:D=!1,projectId:M=null}=j;E&&M&&(gs.current=M),D&&(Vs.current=!0),Ye.current&&clearTimeout(Ye.current),Ye.current=setTimeout(async()=>{gs.current&&(await Ws(gs.current),gs.current=!1),Vs.current&&(Ca(B=>B+1),Vs.current=!1),await Je()},150)},[]);o.useEffect(()=>()=>{Ye.current&&clearTimeout(Ye.current)},[]),o.useEffect(()=>{s?.id&&(Je(),Sn())},[s?.id]);const wn=o.useRef([]),kn=l.map(j=>j.id).sort().join(",");o.useEffect(()=>{if(!s?.id||l.length===0)return;const j=l.map(D=>D.id).sort();wn.current=j;const E=z.subscribeToCompanyActivity?.(s.id,j,{onMessage:()=>te(),onMaterialRequest:()=>te(),onTMTicket:()=>te(),onCrewCheckin:()=>te(),onAreaUpdate:()=>te(),onCORChange:()=>te({refreshCOR:!0}),onInjuryReport:()=>te(),onProjectChange:()=>te(),onMaterialsEquipmentChange:()=>te(),onLaborRateChange:()=>te()});return()=>{E&&z.unsubscribe?.(E)}},[s?.id,kn,te]),o.useEffect(()=>(T?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[T]);const Sn=async()=>{try{const j=await z.getDumpSites(s.id);cn(j||[])}catch(j){console.error("Error loading dump sites:",j)}},_a=o.useRef(null);o.useEffect(()=>{if(r&&r!==_a.current&&l.length>0){const j=l.find(E=>E.id===r);j&&(_a.current=r,x(j),i?.())}},[r,l,i]),o.useEffect(()=>{if(d){Ws(d.id);const j=[],E=d.id,D=z.subscribeToAreas?.(E,()=>{te({refreshAreas:!0,projectId:E})});D&&j.push(D);const M=z.subscribeToDailyReports?.(E,()=>{te()});M&&j.push(M);const B=z.subscribeToCrewCheckins?.(E,()=>{te()});B&&j.push(B);const K=z.subscribeToHaulOffs?.(E,()=>{te()});K&&j.push(K);const U=z.subscribeToCORs?.(E,()=>{te({refreshCOR:!0})});return U&&j.push(U),()=>{j.forEach(J=>z.unsubscribe?.(J))}}},[d,te]),o.useEffect(()=>{O==="tickets"&&zs("full")},[O]);const Dn=async(j,E=!1)=>{const D=j.id,M=Bs.current.get(D);if(M&&!E&&Date.now()-M.timestamp<Da)return M.data;try{const[B,K,U,J,X,ee,we,Ns,C,V,se,fe]=await Promise.all([le(()=>z.getAreas(j.id),{fallback:[],context:{operation:"getAreas",projectId:j.id}}),le(()=>z.getTMTickets(j.id),{fallback:[],context:{operation:"getTMTickets",projectId:j.id}}),le(()=>z.getChangeOrderTotals(j.id),{fallback:null,context:{operation:"getChangeOrderTotals",projectId:j.id}}),le(()=>z.getDailyReports(j.id,100),{fallback:[],context:{operation:"getDailyReports",projectId:j.id}}),le(()=>z.getInjuryReports(j.id),{fallback:[],context:{operation:"getInjuryReports",projectId:j.id}}),le(()=>z.calculateManDayCosts(j.id,s?.id,j.work_type||"demolition",j.job_type||"standard"),{fallback:null,context:{operation:"calculateManDayCosts",projectId:j.id}}),le(()=>z.calculateHaulOffCosts(j.id),{fallback:null,context:{operation:"calculateHaulOffCosts",projectId:j.id}}),le(()=>z.getProjectCosts(j.id),{fallback:[],context:{operation:"getProjectCosts",projectId:j.id}}),le(()=>z.getCORStats(j.id),{fallback:null,context:{operation:"getCORStats",projectId:j.id}}),le(()=>z.getCrewCheckinHistory(j.id,60),{fallback:[],context:{operation:"getCrewCheckinHistory",projectId:j.id}}),le(()=>z.getMaterialRequests(j.id),{fallback:[],context:{operation:"getMaterialRequests",projectId:j.id}}),le(()=>z.getWeeklyDisposalSummary(j.id,4),{fallback:[],context:{operation:"getWeeklyDisposalSummary",projectId:j.id}})]),me=pt(B),Us=me.progress,Ga=U?.totalApprovedValue||0,Ya=j.contract_value+Ga,Cs=me.isValueBased?me.earnedValue:Us/100*Ya,ir=K.filter(q=>q.status==="pending").length,Hs=new Date;Hs.setDate(Hs.getDate()-7);const lr=J.filter(q=>new Date(q.report_date)>=Hs).length,Ja=Ns.reduce((q,G)=>{const Te=parseFloat(G.amount);return q+(isNaN(Te)?0:Te)},0);let ws=0;const ks={};K.forEach(q=>{const G=q.work_date||q.ticket_date||q.created_at?.split("T")[0],Te=q.t_and_m_items||q.items||[];let Ss=0;Te.forEach(Qs=>{const Cr=parseFloat(Qs.quantity)||1,wr=parseFloat(Qs.unit_cost)||parseFloat(Qs.materials_equipment?.cost_per_unit)||0;Ss+=Cr*wr}),Ss>0&&G&&(ws+=Ss,ks[G]||(ks[G]={date:G,cost:0}),ks[G].cost+=Ss)});const Xa=Object.values(ks).sort((q,G)=>new Date(G.date)-new Date(q.date)),Ks=ee?.totalCost||0,cr=we?.totalCost||0,Qa=Ks+ws+Ja,Za=Cs-Qa,or=Cs>0?Za/Cs*100:0,et=ee?.byDate?.length||0,dr=Xa.length,Gs=Math.max(et,dr),st=Ks+ws,ur=Gs>0?st/Gs:0,je=Pi({...j,progress:Us},ee?.totalManDays||0),ke={},at=new Set;(V||[]).forEach(q=>{const G=q.workers||[];ke[q.check_in_date]=G.length,G.forEach(Te=>at.add(Te.name?.toLowerCase()))});const ge=Object.keys(ke).sort(),mr=ge.length>0?Math.round(ge.reduce((q,G)=>q+ke[G],0)/ge.length*10)/10:0,hr=ge.length>0?Math.max(...ge.map(q=>ke[q])):0,Ys=ge.slice(-7),Js=ge.slice(-14,-7),tt=Ys.length>0?Ys.reduce((q,G)=>q+ke[G],0)/Ys.length:0,Xs=Js.length>0?Js.reduce((q,G)=>q+ke[G],0)/Js.length:0,pr=(se||[]).filter(q=>q.status==="pending").length,xr=(se||[]).filter(q=>q.status==="ordered").length,vr=(se||[]).filter(q=>q.status==="delivered").length,fr=(se||[]).filter(q=>q.priority==="urgent"&&q.status==="pending").length,jr=J.filter(q=>q.issues&&q.issues.trim().length>0).length,gr=K.reduce((q,G)=>q+(G.photos?.length||0),0),br=(fe||[]).reduce((q,G)=>q+(G.concrete||0)+(G.trash||0)+(G.metals||0)+(G.hazardous_waste||0),0),nt=X.length>0?new Date(X[0]?.incident_date||X[0]?.created_at):null,yr=nt?Math.floor((new Date-nt)/(1e3*60*60*24)):null,Nr=B.filter(q=>q.status==="done"),rt={...j,areas:B,progress:Us,billable:Cs,changeOrderValue:Ga,revisedContractValue:Ya,changeOrderPending:U?.pendingCount||0,totalTickets:K.length,pendingTickets:ir,approvedTickets:K.filter(q=>q.status==="approved").length,tmTickets:K,dailyReportsCount:J.length,recentDailyReports:lr,injuryReportsCount:X.length,lastDailyReport:J[0]?.report_date||null,isValueBased:me.isValueBased,earnedValue:me.earnedValue,totalSOVValue:me.totalValue,laborCost:Ks,laborDaysWorked:et,laborManDays:ee?.totalManDays||0,laborByDate:ee?.byDate||[],dailyBurn:ur,materialsEquipmentCost:ws,materialsEquipmentByDate:Xa,haulOffCost:cr,haulOffLoads:we?.totalLoads||0,haulOffDays:we?.daysWithHaulOff||0,haulOffByType:we?.byWasteType||{},haulOffByDate:we?.byDate||[],customCosts:Ns,customCostTotal:Ja,totalBurn:st,totalBurnDays:Gs,allCostsTotal:Qa,currentProfit:Za,profitMargin:or,corPendingValue:C?.total_pending_value||0,corPendingCount:C?.pending_count||0,corApprovedValue:C?.total_approved_value||0,corBilledValue:C?.total_billed_value||0,corTotalCount:C?.total_cors||0,corStats:C,scheduleStatus:je.scheduleStatus,scheduleVariance:je.scheduleVariance,scheduleLabel:je.scheduleLabel,laborStatus:je.laborStatus,laborVariance:je.laborVariance,laborLabel:je.laborLabel,hasScheduleData:je.hasScheduleData,hasLaborData:je.hasLaborData,actualManDays:ee?.totalManDays||0,crewHistory:V||[],crewByDate:ke,uniqueWorkerCount:at.size,avgCrewSize:mr,peakCrewSize:hr,crewDaysTracked:ge.length,crewTrend:Xs>0?(tt-Xs)/Xs*100:0,recentCrewAvg:tt,materialRequests:se||[],pendingMaterialRequests:pr,orderedMaterialRequests:xr,deliveredMaterialRequests:vr,urgentMaterialRequests:fr,totalMaterialRequests:(se||[]).length,reportsWithIssues:jr,totalPhotosFromTickets:gr,dailyReports:J,weeklyDisposal:fe||[],disposalTotalLoads:br,daysSinceLastInjury:yr,injuryReports:X,oshaRecordable:X.filter(q=>q.osha_recordable).length,completedAreasCount:Nr.length,hasError:!1,_detailsLoaded:!0};return Bs.current.set(D,{data:rt,timestamp:Date.now()}),rt}catch(B){return console.error(`Error loading details for project ${j.id}:`,B),{...j,hasError:!0,_detailsLoaded:!1}}},Je=async()=>{try{const j=await z.getProjectDashboardSummary(s?.id);c(j);const E=j.map(D=>{const M=Bs.current.get(D.id);if(M&&Date.now()-M.timestamp<Da)return M.data;const B=D.areaCount||0,K=D.completedAreas||0,U=B>0?Math.round(K/B*100):0;return{...D,progress:U,areas:[],totalTickets:D.ticketCount||0,pendingTickets:D.pendingTicketCount||0,approvedTickets:D.approvedTicketCount||0,dailyReportsCount:D.dailyReportsThisWeek||0,recentDailyReports:D.dailyReportsThisWeek||0,corTotalCount:D.corCount||0,billable:0,changeOrderValue:0,revisedContractValue:D.contract_value||0,changeOrderPending:0,tmTickets:[],injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,materialsEquipmentCost:0,materialsEquipmentByDate:[],haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corStats:null,scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1,actualManDays:0,hasError:!1,_detailsLoaded:!1}});m(E)}catch(j){console.error("Error loading projects:",j),t("Error loading projects","error")}finally{p(!1)}},Ws=async j=>{try{const E=await z.getAreas(j);y(E)}catch(E){console.error("Error loading areas:",E)}},bs=async j=>{if(x(j),!j._detailsLoaded){const E=await Dn(j);m(D=>D.map(M=>M.id===j.id?E:M)),x(E)}},Ea=()=>{x(null),y([]),P(!1),R(null),F("overview"),Je()},Pa=()=>{R({name:d.name,job_number:d.job_number||"",address:d.address||"",general_contractor:d.general_contractor||"",client_contact:d.client_contact||"",client_phone:d.client_phone||"",contract_value:d.contract_value,work_type:d.work_type||"demolition",job_type:d.job_type||"standard",pin:d.pin||"",default_dump_site_id:d.default_dump_site_id||"",areas:f.map(j=>({id:j.id,name:j.name,weight:j.weight,isNew:!1}))}),P(!0)},_n=()=>{P(!1),R(null)},ue=(j,E)=>{R(D=>({...D,[j]:E}))},Ra=(j,E,D)=>{R(M=>({...M,areas:M.areas.map((B,K)=>K===j?{...B,[E]:D}:B)}))},En=()=>{R(j=>({...j,areas:[...j.areas,{id:null,name:"",weight:"",isNew:!0}]}))},Pn=j=>{v.areas.length>1&&R(E=>({...E,areas:E.areas.filter((D,M)=>M!==j)}))},Rn=async()=>{if(!v.name.trim()){t("Please enter a project name","error");return}const j=parseFloat(v.contract_value);if(!j||j<=0){t("Please enter a valid contract value","error");return}if(v.pin&&v.pin.length!==4){t("PIN must be 4 digits","error");return}if(v.pin&&v.pin!==d.pin&&!await z.isPinAvailable(v.pin,d.id)){t("This PIN is already in use","error");return}const E=v.areas.filter(M=>M.name.trim()&&parseFloat(M.weight)>0);if(E.length===0){t("Please add at least one area","error");return}if(E.reduce((M,B)=>M+parseFloat(B.weight),0)!==100){t("Area weights must total 100%","error");return}N(!0);try{await z.updateProject(d.id,{name:v.name.trim(),job_number:v.job_number?.trim()||null,address:v.address?.trim()||null,general_contractor:v.general_contractor?.trim()||null,client_contact:v.client_contact?.trim()||null,client_phone:v.client_phone?.trim()||null,contract_value:j,work_type:v.work_type||"demolition",job_type:v.job_type||"standard",pin:v.pin||null,default_dump_site_id:v.default_dump_site_id||null},s?.id);const M=f.map(U=>U.id),B=v.areas.filter(U=>U.id).map(U=>U.id);for(const U of M)B.includes(U)||await z.deleteArea(U);for(let U=0;U<E.length;U++){const J=E[U];J.id?await z.updateArea(J.id,{name:J.name.trim(),weight:parseFloat(J.weight),sort_order:U}):await z.createArea({project_id:d.id,name:J.name.trim(),weight:parseFloat(J.weight),status:"not_started",sort_order:U})}const K=await z.getProject(d.id);x(K),await Ws(d.id),P(!1),R(null),t("Project updated!","success")}catch(M){console.error("Error saving project:",M?.message||M),t(M?.message||"Error saving changes","error")}finally{N(!1)}},On=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await z.deleteProject(d.id),t("Project deleted","success"),Ea()}catch(j){console.error("Error deleting project:",j),t("Error deleting project","error")}},b=o.useMemo(()=>d?u.find(j=>j.id===d.id):null,[d,u]),An=o.useMemo(()=>{if(!d)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const j=pt(f),E=j.progress,D=b?.changeOrderValue||0,M=d.contract_value+D,B=j.isValueBased?j.earnedValue:E/100*M;return{progress:E,billable:B,changeOrderValue:D,revisedContractValue:M,isValueBased:j.isValueBased,earnedValue:j.earnedValue,totalSOVValue:j.totalValue}},[d,f,b]),Tn=o.useMemo(()=>{const j=u.reduce((X,ee)=>X+(ee.contract_value||0),0),E=u.reduce((X,ee)=>X+(ee.changeOrderValue||0),0),D=j+E,M=u.reduce((X,ee)=>X+(ee.billable||0),0),B=D-M,K=D>0?Math.round(M/D*100):0,U=u.reduce((X,ee)=>X+(ee.corPendingValue||0),0),J=u.reduce((X,ee)=>X+(ee.corPendingCount||0),0);return{totalOriginalContract:j,totalChangeOrders:E,totalPortfolioValue:D,totalEarned:M,totalRemaining:B,weightedCompletion:K,totalPendingCORValue:U,totalPendingCORCount:J}},[u]),Mn=o.useMemo(()=>{let j=0,E=0,D=0,M=0,B=0;for(const K of u){const U=K.revisedContractValue||K.contract_value;K.progress>=100&&j++,K.progress<100&&K.billable<=U*(K.progress/100)*1.1&&E++,K.billable>U*.9&&K.progress<90&&D++,K.billable>U&&M++,(K.changeOrderValue||0)>0&&B++}return{projectsComplete:j,projectsOnTrack:E,projectsAtRisk:D,projectsOverBudget:M,projectsWithChangeOrders:B}},[u]),Fn=o.useMemo(()=>{let j=0,E=0,D=0,M=0,B=0,K=0;for(const U of u)U.hasScheduleData&&(U.scheduleStatus==="ahead"?j++:U.scheduleStatus==="behind"?D++:E++),U.hasLaborData&&(U.laborStatus==="over"?M++:U.laborStatus==="under"?B++:K++);return{scheduleAhead:j,scheduleOnTrack:E,scheduleBehind:D,laborOver:M,laborUnder:B,laborOnTrack:K,hasAnyScheduleData:j+E+D>0,hasAnyLaborData:M+B+K>0}},[u]),Xe=o.useMemo(()=>{const j=u.map(D=>{const M={id:D.id,name:D.name,totalCosts:D.totalCosts||0,earnedRevenue:D.billable||0,actualProgress:D.progress||0,expectedProgress:D.expectedProgress||D.progress,pendingCORValue:D.corPendingValue||0,contractValue:D.revisedContractValue||D.contract_value||0,lastReportDate:D.lastDailyReport,recentInjuryCount:D.recentInjuryCount||0,startDate:D.start_date},B=xc(M),K=vc(B,{...M,name:D.name}),U=fc(M),J=K.map(X=>({...X,projectName:D.name,projectId:D.id}));return{projectId:D.id,projectName:D.name,riskScore:B.score,riskStatus:B.status,riskLabel:B.label,factors:B.factors,alerts:J,projections:U}}),E=j.flatMap(D=>D.alerts).sort((D,M)=>{const B={critical:0,warning:1,info:2};return B[D.type]-B[M.type]});return{projectRisks:j,allAlerts:E,criticalCount:E.filter(D=>D.type==="critical").length,warningCount:E.filter(D=>D.type==="warning").length}},[u]),$n=o.useCallback(({target:j,projectId:E,alert:D})=>{const M=l.find(B=>B.id===E);M&&(x(M),j==="financials"?F("financials"):j==="reports"?F("reports"):j==="cors"?(F("financials"),L("cors")):F("overview"))},[l]);o.useEffect(()=>{const j=async()=>{for(const E of u)if(Di(E,30))try{await z.archiveProject(E.id),t(`Project "${E.name}" has been auto-archived after 30 days of completion`,"info")}catch(D){console.error("Failed to auto-archive project:",D)}};u.length>0&&j()},[]);const In=o.useCallback(()=>{vs(null),xs(!0)},[]),Ln=o.useCallback(j=>{vs(j),xs(!0)},[]),zn=o.useCallback(()=>{js(null),fs(!0)},[]),qn=o.useCallback(j=>{js(j),fs(!0)},[]),Vn=o.useCallback(()=>{zs("full")},[]),Bn=o.useCallback(()=>{Q(j=>!j)},[]),Wn=o.useCallback(()=>{re(j=>!j)},[]),Oa=o.useCallback(()=>{re(!1)},[]),Aa=o.useCallback(()=>{ie(j=>!j)},[]),ys=o.useCallback(async(j="all")=>{if(d){t("Gathering field data...","info");try{const[E,D,M]=await Promise.all([z.getDailyReports(d.id,365),z.getInjuryReports(d.id),z.getCrewCheckinHistory(d.id,365)]);j==="daily"?await jc(E||[],d):j==="incidents"?await gc(D||[],d):j==="crew"?await bc(M||[],d):await yc({dailyReports:E||[],incidentReports:D||[],crewCheckins:M||[],project:d}),t("PDF exported!","success")}catch(E){console.error("Error exporting field documents:",E),t("Error generating PDF","error")}}},[d,t]),Un=o.useCallback(()=>{zs("preview")},[]),Hn=o.useCallback(()=>{Ce("log")},[]),Ta=o.useCallback(()=>{Ge(null),Ke(!0)},[]),Kn=o.useCallback(j=>{ps(j),hs(!0)},[]),Gn=o.useCallback(j=>{Ge(j),Ke(!0)},[]),Yn=o.useCallback(()=>{qs(!0)},[]),Jn=o.useCallback(async j=>{try{await z.deleteProjectCost(j),Je(),t?.("Cost deleted","success")}catch{t?.("Error deleting cost","error")}},[]),Xn=o.useMemo(()=>({corCount:b?.corStats?.total||0,ticketCount:b?.totalTickets||0,corPending:b?.corStats?.pending||0,ticketPending:b?.pendingTickets||0}),[b?.corStats?.total,b?.totalTickets,b?.corStats?.pending,b?.pendingTickets]),{totalOriginalContract:Qn,totalChangeOrders:Ma,totalPortfolioValue:Zn,totalEarned:er,totalRemaining:sr,weightedCompletion:ar,totalPendingCORValue:tr,totalPendingCORCount:Fa}=Tn,{projectsComplete:$a,projectsOnTrack:Ia,projectsAtRisk:La,projectsOverBudget:za,projectsWithChangeOrders:qa}=Mn,{scheduleAhead:Va,scheduleOnTrack:Ba,scheduleBehind:Wa,laborOver:Ua,laborUnder:Ha,laborOnTrack:Ka,hasAnyScheduleData:nr,hasAnyLaborData:rr}=Fn;if(h)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(d){const{progress:j,billable:E,changeOrderValue:D,revisedContractValue:M,isValueBased:B,earnedValue:K,totalSOVValue:U}=An;if(k&&v){const C=v.areas.reduce((V,se)=>V+(parseFloat(se.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:_n,style:{marginBottom:"1.5rem"},children:"← Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:v.name,onChange:V=>ue("name",V.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:v.job_number,onChange:V=>ue("job_number",V.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:v.address,onChange:V=>ue("address",V.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:v.general_contractor,onChange:V=>ue("general_contractor",V.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:v.client_contact,onChange:V=>ue("client_contact",V.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:v.client_phone,onChange:V=>ue("client_phone",V.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:v.contract_value,onChange:V=>ue("contract_value",V.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:v.pin,onChange:V=>ue("pin",V.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:v.work_type,onChange:V=>ue("work_type",V.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:v.job_type,onChange:V=>ue("job_type",V.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:v.default_dump_site_id,onChange:V=>ue("default_dump_site_id",V.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),ya.map(V=>e.jsx("option",{value:V.id,children:V.name},V.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),v.areas.map((V,se)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:V.name,onChange:fe=>Ra(se,"name",fe.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:V.weight,onChange:fe=>Ra(se,"weight",fe.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>Pn(se),children:"×"})]},se)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${C===100?"valid":"invalid"}`,children:[C,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:En,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:Rn,disabled:g,style:{flex:1},children:g?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:On,children:"Delete Project"})]})}const J=f.filter(C=>C.status==="done").length,X=f.filter(C=>C.status==="working").length,ee=f.filter(C=>C.status==="not_started").length,we=(b?.pendingTickets||0)+(b?.changeOrderPending||0),Ns=[{id:"overview",label:"Overview",Icon:jt},{id:"financials",label:"Financials",Icon:es,badge:we},{id:"reports",label:"Reports",Icon:he},{id:"documents",label:"Documents",Icon:ra},{id:"info",label:"Info",Icon:Rs}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:Ea,children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>H(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>w(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:Pa,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:d.name}),(d.job_number||d.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[d.job_number&&`Job #${d.job_number}`,d.job_number&&d.work_type&&" • ",d.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[j,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:ae(E)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:ae(M-E)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:Ns.map(C=>e.jsxs("button",{className:`pv-tab ${A===C.id?"active":""} ${C.badge>0?"has-badge":""}`,onClick:()=>F(C.id),children:[e.jsx(C.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:C.label}),C.badge>0&&e.jsx("span",{className:"pv-tab-badge",children:C.badge})]},C.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[A==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab animate-fade-in",children:[e.jsxs("div",{className:"overview-hero-split",children:[e.jsx(Qc,{progress:j,areasComplete:J,totalAreas:f.length,areasWorking:X}),e.jsx(Zc,{earnedRevenue:E,totalCosts:b?.allCostsTotal||0,laborCost:b?.laborCost||0,disposalCost:b?.haulOffCost||0,equipmentCost:b?.materialsEquipmentCost||0,materialsCost:0,otherCost:b?.customCostTotal||0,contractValue:M})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(so,{project:d,onShowToast:t}),e.jsxs("div",{className:"overview-section-card overview-work-areas-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[J>0&&e.jsxs("span",{className:"section-badge done",children:[J," Done"]}),X>0&&e.jsxs("span",{className:"section-badge working",children:[X," Active"]}),ee>0&&e.jsxs("span",{className:"section-badge pending",children:[ee," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list work-areas-scroll stagger-areas",children:f.map(C=>e.jsxs("div",{className:`work-area-item ${C.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[C.status==="done"&&e.jsx("span",{className:"status-icon done",children:"✓"}),C.status==="working"&&e.jsx("span",{className:"status-icon working",children:"●"}),C.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:"○"})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:C.name}),e.jsx("span",{className:"work-area-weight",children:C.scheduled_value?ae(C.scheduled_value):`${C.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${C.status}`,style:{width:C.status==="done"?"100%":C.status==="working"?"50%":"0%"}})})]},C.id))})]})]}),e.jsxs("div",{className:"overview-bottom-strip",children:[(b?.pendingTickets>0||b?.changeOrderPending>0||b?.pendingMaterialRequests>0||b?.urgentMaterialRequests>0)&&e.jsxs("div",{className:"overview-attention-inline",children:[b?.urgentMaterialRequests>0&&e.jsxs("div",{className:"attention-chip warning",onClick:()=>F("reports"),children:[e.jsx(Ve,{size:14}),e.jsxs("span",{children:[b.urgentMaterialRequests," urgent material request",b.urgentMaterialRequests!==1?"s":""]})]}),b?.pendingMaterialRequests>0&&!b?.urgentMaterialRequests&&e.jsxs("div",{className:"attention-chip info",onClick:()=>F("reports"),children:[e.jsx(Ps,{size:14}),e.jsxs("span",{children:[b.pendingMaterialRequests," material request",b.pendingMaterialRequests!==1?"s":""," pending"]})]}),b?.pendingTickets>0&&e.jsxs("div",{className:"attention-chip warning",onClick:()=>F("financials"),children:[e.jsx(he,{size:14}),e.jsxs("span",{children:[b.pendingTickets," T&M pending"]})]}),b?.changeOrderPending>0&&e.jsxs("div",{className:"attention-chip info",onClick:()=>F("financials"),children:[e.jsx(Le,{size:14}),e.jsxs("span",{children:[b.changeOrderPending," CO pending"]})]})]}),e.jsxs("div",{className:"overview-quick-actions",children:[e.jsxs("button",{className:"overview-action-btn",onClick:()=>F("reports"),children:[e.jsx(he,{size:15}),e.jsxs("span",{children:[b?.dailyReportsCount||0," Reports"]})]}),e.jsxs("button",{className:"overview-action-btn",onClick:()=>F("financials"),children:[e.jsx(es,{size:15}),e.jsxs("span",{children:[b?.totalTickets||0," T&M Tickets"]})]}),e.jsx("span",{className:"overview-action-divider"}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ys("all"),children:[e.jsx(_e,{size:15}),e.jsx("span",{children:"Export All Docs"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ys("daily"),children:[e.jsx(_e,{size:14}),e.jsx("span",{children:"Daily"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ys("incidents"),children:[e.jsx(_e,{size:14}),e.jsx("span",{children:"Incidents"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ys("crew"),children:[e.jsx(_e,{size:14}),e.jsx("span",{children:"Crew"})]})]})]})]}),A==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsxs("div",{className:"export-actions",style:{display:"flex",gap:"8px",marginLeft:"auto",marginBottom:"12px",justifyContent:"flex-end"},children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>Nc(d,{earnedRevenue:E,approvedCORs:b?.cors?.filter(C=>C.status==="approved"),laborByDate:b?.laborByDate,haulOffByDate:b?.haulOffByDate,customCosts:b?.customCosts}),children:[e.jsx(_e,{size:14})," Export CSV"]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>Cc(d,{totalLaborCost:b?.totalLaborCost||0,totalDisposalCost:b?.totalDisposalCost||0}),children:[e.jsx(_e,{size:14})," QuickBooks"]})]}),e.jsx(Yc,{contractValue:d?.contract_value||0,earnedRevenue:E,totalCosts:b?.allCostsTotal||0,profit:b?.currentProfit||0,progress:j,corApprovedValue:D,loading:!b}),e.jsxs("div",{className:`financials-layout ${S?"sidebar-collapsed":""}`,children:[e.jsxs("button",{className:"financials-mobile-menu-toggle",onClick:Wn,"aria-label":"Open navigation menu",title:"Open navigation menu",children:[e.jsx(Ki,{size:20}),e.jsx("span",{children:"Menu"})]}),T&&e.jsx("div",{className:"financials-sidebar-overlay",onClick:Oa,"aria-hidden":"true"}),e.jsx("div",{className:`financials-sidebar ${S?"collapsed":""} ${T?"mobile-open":""}`,children:e.jsx(Xc,{activeSection:O,onSectionChange:C=>{L(C),re(!1)},collapsed:S,onToggleCollapse:Bn,onMobileClose:Oa,stats:Xn})}),e.jsxs("div",{className:"financials-main",children:[O==="overview"&&e.jsxs("div",{className:"financials-overview animate-fade-in",children:[e.jsx(Ic,{projectData:b,project:d,tmTickets:b?.tmTickets||[],corStats:b?.corStats,areas:f}),e.jsxs("div",{className:"financials-analysis-row stagger-children",children:[e.jsx(Oc,{dailyBurn:b?.dailyBurn||0,totalBurn:b?.totalBurn||0,daysWorked:b?.totalBurnDays||0,laborCost:b?.laborCost||0,materialsEquipmentCost:b?.materialsEquipmentCost||0,progress:j,contractValue:M,laborByDate:b?.laborByDate||[],materialsEquipmentByDate:b?.materialsEquipmentByDate||[]}),e.jsx(qc,{revenue:E,totalCosts:b?.allCostsTotal||0,contractValue:M,progress:j})]}),e.jsxs("div",{className:"cost-disposal-row",children:[e.jsx(zc,{laborCost:b?.laborCost||0,haulOffCost:b?.haulOffCost||0,customCosts:b?.customCosts||[],onAddCost:Yn,onDeleteCost:Jn}),e.jsx(Bc,{project:d,period:"week"})]}),e.jsx(Pc,{project:d,onAddEquipment:In,onEditEquipment:Ln,onShowToast:t},vn),e.jsx(Ec,{project:d,areas:f,corStats:b?.corStats,onCreateDraw:zn,onViewDraw:qn,onShowToast:t},gn),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(Pe,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:ae(b?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(_c,{project:d,company:s,onShowToast:t})})]})]}),O==="cors"&&e.jsxs("div",{className:"financials-cors animate-fade-in",children:[e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(o.Suspense,{fallback:e.jsx(De,{}),children:e.jsx(uo,{project:d,onShowToast:t,onToggleList:Aa,showingList:Ne,onViewFullLog:Hn,onCreateCOR:Ta})})}),Ne&&e.jsx("div",{className:"financials-section cor-section-list animate-fade-in",style:{marginTop:"1rem"},children:e.jsx(o.Suspense,{fallback:e.jsx(De,{}),children:e.jsx(lo,{project:d,company:s,areas:f,refreshKey:mn,onShowToast:t,previewMode:!1,onViewAll:Aa,onDisplayModeChange:Ce,onCreateCOR:Ta,onViewCOR:Kn,onEditCOR:Gn})})})]}),O==="tickets"&&e.jsx("div",{className:"financials-tickets animate-fade-in",children:e.jsxs("div",{className:"financials-section tm-section",children:[He==="full"&&e.jsx("button",{className:"section-back-btn",onClick:Un,children:"← Back to summary"}),e.jsx(o.Suspense,{fallback:e.jsx(De,{}),children:e.jsx(ao,{project:d,company:s,onShowToast:t,compact:He==="preview",previewMode:He==="preview",onViewAll:Vn})})]})}),O==="billing"&&e.jsx("div",{className:"financials-billing animate-fade-in",children:e.jsx(o.Suspense,{fallback:e.jsx(De,{}),children:e.jsx(ho,{project:d,company:s,user:a,onShowToast:t})})})]})]})]}),A==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(he,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:b?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:b?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((b?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:b?.totalTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"T&M Tickets"}),(b?.pendingTickets||0)>0&&e.jsxs("div",{className:"reports-metric-status",style:{background:"#fef3c7",color:"#92400e"},children:[b.pendingTickets," pending"]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:b?.totalPhotosFromTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"Photos Captured"})]})]})}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsx("div",{className:"reports-insight-header",children:e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(xe,{size:18}),e.jsx("h3",{children:"Crew Analytics"})]})}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.uniqueWorkerCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Workers"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.avgCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Avg Crew / Day"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.peakCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Peak Crew Size"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.crewDaysTracked||0}),e.jsx("span",{className:"reports-stat-label",children:"Days Tracked"})]})]}),(b?.crewTrend||0)!==0&&e.jsxs("div",{className:`reports-trend-badge ${b.crewTrend>0?"up":"down"}`,children:[b.crewTrend>0?e.jsx(cs,{size:14}):e.jsx(ls,{size:14}),e.jsxs("span",{children:[Math.abs(Math.round(b.crewTrend)),"% ",b.crewTrend>0?"increase":"decrease"," vs prior week"]})]}),b?.crewByDate&&Object.keys(b.crewByDate).length>0&&e.jsxs("div",{className:"reports-mini-chart",children:[e.jsx("div",{className:"reports-mini-chart-label",children:"Recent Crew Size"}),e.jsx("div",{className:"reports-mini-bars",children:Object.keys(b.crewByDate).sort().slice(-14).map(C=>{const V=b.crewByDate[C],se=b.peakCrewSize||1;return e.jsx("div",{className:"reports-mini-bar-wrap",title:`${new Date(C+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}: ${V} workers`,children:e.jsx("div",{className:"reports-mini-bar",style:{height:`${V/se*100}%`}})},C)})})]})]})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(la,{size:18}),e.jsx("h3",{children:"Safety Dashboard"})]}),e.jsx("span",{className:`reports-section-badge ${(b?.injuryReportsCount||0)>0?"warning":"success"}`,children:(b?.injuryReportsCount||0)>0?`${b.injuryReportsCount} incident${b.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsx("div",{className:"reports-safety-hero",children:e.jsxs("div",{className:`reports-safety-days ${b?.daysSinceLastInjury===null||b?.daysSinceLastInjury>30?"excellent":b?.daysSinceLastInjury>7?"good":"caution"}`,children:[e.jsx("span",{className:"reports-safety-days-value",children:b?.daysSinceLastInjury!==null?b.daysSinceLastInjury:"--"}),e.jsx("span",{className:"reports-safety-days-label",children:b?.daysSinceLastInjury!==null?"Days Since Last Incident":"No Incidents Recorded"})]})}),e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.injuryReportsCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Incidents"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.oshaRecordable||0}),e.jsx("span",{className:"reports-stat-label",children:"OSHA Recordable"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.reportsWithIssues||0}),e.jsx("span",{className:"reports-stat-label",children:"Reports w/ Issues"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:b?.laborManDays||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Man-Days"})]})]})]})]})]}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Ps,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("span",{className:"reports-section-count",children:[b?.totalMaterialRequests||0," total"]})]}),e.jsx("div",{className:"reports-insight-body",children:(b?.totalMaterialRequests||0)===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Ps,{size:32}),e.jsx("p",{children:"No material requests yet"}),e.jsx("span",{children:"Requests from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-material-pipeline",children:[b?.urgentMaterialRequests>0&&e.jsxs("div",{className:"reports-material-status urgent",children:[e.jsx(Ve,{size:14}),e.jsxs("span",{children:[b.urgentMaterialRequests," Urgent"]})]}),e.jsxs("div",{className:"reports-material-status pending",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[b?.pendingMaterialRequests||0," Pending"]})]}),e.jsxs("div",{className:"reports-material-status ordered",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[b?.orderedMaterialRequests||0," Ordered"]})]}),e.jsxs("div",{className:"reports-material-status delivered",children:[e.jsx(Gi,{size:14}),e.jsxs("span",{children:[b?.deliveredMaterialRequests||0," Delivered"]})]})]}),e.jsx("div",{className:"reports-recent-list",children:(b?.materialRequests||[]).slice(0,3).map(C=>e.jsxs("div",{className:`reports-recent-item ${C.status}`,children:[e.jsxs("div",{className:"reports-recent-item-main",children:[e.jsx("span",{className:`reports-recent-item-status ${C.status}`,children:C.status}),e.jsx("span",{className:"reports-recent-item-date",children:new Date(C.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"reports-recent-item-detail",children:[(C.items||[]).slice(0,2).map((V,se)=>e.jsxs("span",{children:[V.name,V.quantity?` (${V.quantity})`:""]},se)),(C.items||[]).length>2&&e.jsxs("span",{className:"reports-recent-more",children:["+",(C.items||[]).length-2," more"]})]}),C.priority==="urgent"&&e.jsx("span",{className:"reports-urgent-tag",children:"URGENT"})]},C.id))})]})})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Re,{size:18}),e.jsx("h3",{children:"Disposal Trends"})]}),e.jsxs("span",{className:"reports-section-count",children:[b?.disposalTotalLoads||0," loads"]})]}),e.jsx("div",{className:"reports-insight-body",children:(b?.weeklyDisposal||[]).length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Re,{size:32}),e.jsx("p",{children:"No disposal data yet"}),e.jsx("span",{children:"Disposal loads from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-disposal-chart",children:[e.jsx("div",{className:"reports-disposal-bars",children:(b?.weeklyDisposal||[]).map((C,V)=>{const se=(C.concrete||0)+(C.trash||0)+(C.metals||0)+(C.hazardous_waste||0),fe=Math.max(...(b?.weeklyDisposal||[]).map(me=>(me.concrete||0)+(me.trash||0)+(me.metals||0)+(me.hazardous_waste||0)))||1;return e.jsxs("div",{className:"reports-disposal-bar-col",children:[e.jsxs("div",{className:"reports-disposal-bar-stack",style:{height:`${se/fe*100}%`},children:[C.concrete>0&&e.jsx("div",{className:"reports-disposal-seg concrete",style:{flex:C.concrete},title:`Concrete: ${C.concrete}`}),C.trash>0&&e.jsx("div",{className:"reports-disposal-seg trash",style:{flex:C.trash},title:`Trash: ${C.trash}`}),C.metals>0&&e.jsx("div",{className:"reports-disposal-seg metals",style:{flex:C.metals},title:`Metals: ${C.metals}`}),C.hazardous_waste>0&&e.jsx("div",{className:"reports-disposal-seg hazardous",style:{flex:C.hazardous_waste},title:`Hazardous: ${C.hazardous_waste}`})]}),e.jsx("span",{className:"reports-disposal-bar-label",children:new Date(C.week+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},V)})}),e.jsxs("div",{className:"reports-disposal-legend",children:[e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot concrete"}),"Concrete"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot trash"}),"Trash"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot metals"}),"Metals"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot hazardous"}),"Hazardous"]})]})]}),(b?.haulOffCost||0)>0&&e.jsxs("div",{className:"reports-disposal-cost",children:[e.jsx("span",{children:"Total Disposal Cost"}),e.jsx("strong",{children:ae(b.haulOffCost)})]})]})})]})]}),e.jsxs("div",{className:"reports-insight-card reports-activity-summary",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(he,{size:18}),e.jsx("h3",{children:"Field Activity Summary"})]}),e.jsx("div",{className:"reports-activity-badges",children:b?.lastDailyReport&&e.jsxs("span",{className:"reports-last-filed",children:["Last report: ",new Date(b.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ","(",Math.floor((new Date-new Date(b.lastDailyReport))/(1e3*60*60*24)),"d ago)"]})})]}),e.jsx("div",{className:"reports-insight-body",children:e.jsxs("div",{className:"reports-activity-grid",children:[e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(he,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:b?.dailyReportsCount||0}),e.jsx("span",{children:"Daily Reports Filed"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Le,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:b?.totalTickets||0}),e.jsx("span",{children:"T&M Tickets Created"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Yi,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:b?.totalPhotosFromTickets||0}),e.jsx("span",{children:"Photos Documented"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Pe,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsxs("strong",{children:[b?.completedAreasCount||0,"/",f.length]}),e.jsx("span",{children:"Work Areas Complete"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(es,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:ae(b?.allCostsTotal||0)}),e.jsx("span",{children:"Total Costs Tracked"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(xe,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:b?.laborManDays||0}),e.jsx("span",{children:"Total Man-Days"})]})]})]})})]}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(he,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[b?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(o.Suspense,{fallback:e.jsx(De,{}),children:e.jsx(io,{project:d,company:s,onShowToast:t})})})]}),e.jsxs("div",{className:`reports-section-card ${(b?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(b?.injuryReportsCount||0)>0?"warning":"success"}`,children:(b?.injuryReportsCount||0)>0?"⚠":"✓"}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(b?.injuryReportsCount||0)>0?"warning":"success"}`,children:(b?.injuryReportsCount||0)>0?`${b.injuryReportsCount} incident${b.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(o.Suspense,{fallback:e.jsx(De,{}),children:e.jsx(no,{project:d,companyId:s?.id||d?.company_id,company:s,user:a,onShowToast:t})})})]})]}),A==="documents"&&e.jsx("div",{className:"pv-tab-panel documents-tab",children:e.jsx(o.Suspense,{fallback:e.jsx(De,{}),children:e.jsx(fo,{project:d,companyId:s?.id||d?.company_id,onShowToast:t,userRole:a?.access_level||"office"})})}),A==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:d.name}),d.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",d.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:Pa,children:e.jsx("span",{children:"Edit Project"})})]}),d.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(Ji,{size:14}),e.jsx("span",{children:d.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Pe,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:d.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Le,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:d.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(es,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:ae(M)}),e.jsx("span",{className:"info-quick-label",children:D>0?`Incl. +${ae(D)} COs`:"Contract Value"})]})]}),d.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:d.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Xi,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[d.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:d.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),d.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:d.client_contact})]}),d.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(Qi,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${d.client_phone}`,className:"info-detail-value link",children:d.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(jt,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[J>0&&e.jsxs("span",{className:"info-badge done",children:[J," Done"]}),X>0&&e.jsxs("span",{className:"info-badge working",children:[X," Active"]}),ee>0&&e.jsxs("span",{className:"info-badge pending",children:[ee," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:f.map(C=>e.jsxs("div",{className:`info-area-item ${C.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[C.status==="done"&&e.jsx("span",{className:"status-dot done",children:"✓"}),C.status==="working"&&e.jsx("span",{className:"status-dot working",children:"●"}),C.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:"○"})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:C.name}),e.jsx("span",{className:`info-area-status-label ${C.status}`,children:C.status==="done"?"Complete":C.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[C.weight,"%"]})]},C.id))})]}),e.jsx(Wc,{project:d,company:s,user:a,isAdmin:n,onShowToast:t}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(Rs,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:ae(d.contract_value)})]}),D>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",ae(D)]})]}),d.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:ya.find(C=>C.id===d.default_dump_site_id)?.name||"Unknown"})]})]})]}),e.jsx("div",{className:"info-section-card",children:e.jsx(Jc,{onShowToast:t})})]})]}),$&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(to,{project:d,user:a,onClose:()=>H(!1),onShareCreated:C=>{t("Share link created successfully!","success")}})}),_&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(o.Suspense,{fallback:null,children:e.jsx(ro,{project:d,company:s,onShowToast:t,onClose:()=>w(!1)})})}),on&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(co,{project:d,company:s,areas:f,existingCOR:dn,onClose:()=>{Ke(!1),Ge(null)},onSaved:()=>{Ke(!1),Ge(null),Ca(C=>C+1)},onShowToast:t})}),un&&Na&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(oo,{cor:Na,project:d,company:s,areas:f,onClose:()=>{hs(!1),ps(null)},onEdit:C=>{hs(!1),ps(null),Ge(C),Ke(!0)},onShowToast:t,onStatusChange:()=>{}})}),ms==="log"&&d&&e.jsx("div",{className:"cor-log-modal-overlay",onClick:()=>Ce("list"),children:e.jsxs("div",{className:"cor-log-modal",onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"cor-log-modal-header",children:[e.jsx("h2",{children:"Change Order Log"}),e.jsx("button",{className:"cor-log-modal-close",onClick:()=>Ce("list"),title:"Close",children:"✕"})]}),e.jsx("div",{className:"cor-log-modal-content",children:e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:e.jsx(mo,{project:d,company:s,onShowToast:t})})})]})}),hn&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(vo,{onClose:()=>qs(!1),saving:pn,onSave:async C=>{try{wa(!0),await z.addProjectCost(d.id,s.id,C),qs(!1),Je(),t("Cost added successfully","success")}catch(V){console.error("Error adding cost:",V),t("Error adding cost","error")}finally{wa(!1)}}})}),xn&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(xo,{project:d,company:s,user:a,editItem:ka,onSave:()=>{xs(!1),vs(null),fn(C=>C+1),t(ka?"Equipment updated":"Equipment added","success")},onClose:()=>{xs(!1),vs(null)}})}),jn&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(po,{project:d,company:s,areas:f,corStats:u.find(C=>C.id===d?.id)?.corStats,editDrawRequest:Sa,onSave:()=>{fs(!1),js(null),bn(C=>C+1),t(Sa?"Draw request updated":"Draw request created","success")},onClose:()=>{fs(!1),js(null)}})})]})}return l.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(he,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("button",{className:"search-trigger-btn",onClick:()=>Nn(!0),children:[e.jsx(Ut,{size:16}),e.jsx("span",{children:"Search"}),e.jsx("span",{className:"shortcut",children:"⌘K"})]}),e.jsxs("div",{className:"bo-project-count",children:[l.length," Active Project",l.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(ar,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:ae(er)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:ae(Zn)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:ae(sr)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Ma>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:ae(Qn)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",qa," project",qa!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",ae(Ma)]})]})]}),Fa>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:ae(tr)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",Fa," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[$a>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:$a}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),Ia>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Ia}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),La>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:La}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),za>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:za}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),nr&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[Va>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:Va}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),Ba>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Ba}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Wa>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:Wa}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),rr&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),Ha>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[Ha," under"]}),Ka>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[Ka," on track"]}),Ua>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[Ua," over"]})]})]})]}),Xe.allAlerts.length>0&&e.jsxs("div",{className:"smart-alerts-section",style:{marginBottom:"var(--space-lg, 1.5rem)"},children:[e.jsx("div",{className:"smart-alerts-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"var(--space-sm, 0.5rem)"},children:e.jsxs("h3",{style:{fontSize:"var(--font-size-md, 1rem)",fontWeight:"var(--font-weight-semibold, 600)",color:"var(--text-primary)",margin:0},children:["Needs Attention",Xe.criticalCount>0&&e.jsxs("span",{style:{marginLeft:"0.5rem",padding:"2px 8px",fontSize:"0.75rem",fontWeight:600,borderRadius:"9999px",background:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"},children:[Xe.criticalCount," critical"]})]})}),e.jsx(Sc,{alerts:Xe.allAlerts,onAction:$n,maxVisible:3})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[l.length," active"]})]}),e.jsx("div",{className:"project-list",children:u.map(j=>{const E=Xe.projectRisks.find(D=>D.projectId===j.id);return e.jsx(go,{project:j,riskScore:E?.riskScore,riskStatus:E?.riskStatus,onClick:()=>bs(j)},j.id)})}),e.jsx(wc,{isOpen:yn,onClose:Cn,companyId:s?.id,onSelectProject:j=>{bs(j)},onSelectTicket:j=>{const E=l.find(D=>D.id===j.project_id);E&&(bs(E),F("financials"),L("tickets"))},onSelectCOR:j=>{const E=l.find(D=>D.id===j.project_id);E&&(bs(E),F("financials"),L("cors"),ps(j),hs(!0))},onShowToast:t})]})}function go({project:s,riskScore:a,riskStatus:n,onClick:t}){const r=_i(s.areas||[]),i=Ei(s.areas||[]),l=s.contract_value-s.billable,c=s.billable>s.contract_value*.9&&s.progress<90,u={healthy:{bg:"var(--status-success-bg, #064e3b)",color:"var(--status-success, #059669)"},warning:{bg:"var(--status-warning-bg, #78350f)",color:"var(--status-warning, #d97706)"},critical:{bg:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"}},m=u[n]||u.healthy;return e.jsxs("div",{className:`project-card enhanced ${c?"at-risk":""}`,onClick:t,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[typeof a=="number"&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,background:m.bg,color:m.color},title:`Risk Score: ${a}`,"aria-label":`Risk score ${a}, ${n}`,children:a}),e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:s.name}),e.jsx("div",{className:"project-card-value",children:ae(s.contract_value)})]})]}),e.jsx("span",{className:`status-badge ${r}`,children:i})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[s.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:ae(s.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${l<0?"negative":""}`,children:ae(Math.abs(l))}),e.jsx("span",{className:"stat-label",children:l>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${s.progress}%`}})}),(s.pendingTickets>0||s.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[s.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[s.pendingTickets," Pending T&M"]}),s.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[s.approvedTickets," Approved T&M"]})]}),s.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${s.scheduleStatus}`,children:s.scheduleLabel}),s.hasLaborData&&s.laborLabel&&e.jsx("span",{className:`labor-indicator ${s.laborStatus}`,children:s.laborLabel})]})]})}const Eo=Object.freeze(Object.defineProperty({__proto__:null,default:jo},Symbol.toStringTag,{value:"Module"}));export{rc as A,Hc as C,Eo as D,Do as E,De as T,ss as a,_o as b,So as c,wo as d,ko as e};
//# sourceMappingURL=Dashboard-ChWvrWKf.js.map
