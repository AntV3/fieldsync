import{_ as be}from"./pdf-D2LJUoLv.js";import{as as e,aF as et,ar as O,aG as Ee,aH as tt}from"./index-Dlu2hcxn.js";import{r as i,a4 as ze,aS as at,n as st,y as lt,P as nt,c as rt,ac as ot,D as it,v as ke,F as Fe,O as ct,aR as dt,aQ as ut,s as Ce,X as oe,aT as ht,h as mt,$ as pt,C as Pe}from"./icons-BDU0tZd_.js";import{k as gt,f,a as xt,b as bt}from"./corCalculations-vdJc_BOT.js";import{C as Ct,a as ft}from"./Dashboard-BLe6lJW5.js";import{u as jt,C as _t,P as vt}from"./CORLog-yjqCbpf1.js";import"./react-DXGY7bZi.js";import"./supabase-VuevzHjS.js";const Nt=i.memo(function({cor:r,isSelected:w,selectMode:T,areas:h,onToggleSelect:E,onView:Y,onEdit:ie,onDelete:x,onSubmitForApproval:V}){const k=gt(r.status),ce=["draft","pending_approval","approved"].includes(r.status),F=["draft","pending_approval","rejected"].includes(r.status),o=r.status==="draft",X=c=>h?.find(G=>G.id===c)?.name||"No Area",q=()=>{T?E(r.id):Y?.(r)},de=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),q())};return e.jsxs("div",{className:`cor-card hover-lift animate-fade-in-up ${r.status} ${w?"selected":""}`,onClick:q,onKeyDown:de,tabIndex:0,role:"button","aria-label":`${T?w?"Deselect":"Select":"View"} COR ${r.cor_number}: ${r.title||"Untitled"}, ${k.label}, ${f(r.cor_total||0)}`,children:[e.jsxs("div",{className:"cor-card-header",children:[e.jsxs("div",{className:"cor-card-left",children:[T&&e.jsx("button",{className:"cor-select-checkbox",onClick:c=>{c.stopPropagation(),E(r.id,c)},"aria-label":w?"Deselect":"Select",children:w?e.jsx(ze,{size:18}):e.jsx(at,{size:18})}),e.jsx("span",{className:"cor-number",children:r.cor_number}),e.jsx("span",{className:"cor-status-badge",style:{backgroundColor:k.bgColor,color:k.color},children:k.label}),(r.gc_signature_data||r.client_signature_data)&&e.jsxs("span",{className:"cor-signed-badge",title:`Signed by ${r.gc_signature_name||r.client_signature_name||"Client"}`,children:[e.jsx(st,{size:12})," Signed"]})]}),e.jsx("div",{className:"cor-card-right",children:e.jsx("span",{className:"cor-total",children:f(r.cor_total||0)})})]}),e.jsxs("div",{className:"cor-card-body",children:[e.jsx("h4",{className:"cor-title",children:r.title||"Untitled COR"}),e.jsxs("div",{className:"cor-meta",children:[r.group_name&&e.jsx("span",{className:"cor-group-badge",children:r.group_name}),r.area_id&&e.jsx("span",{className:"cor-area",children:X(r.area_id)}),e.jsx("span",{className:"cor-period",children:xt(r.period_start,r.period_end)})]})]}),e.jsxs("div",{className:"cor-card-footer",children:[e.jsx("span",{className:"cor-created",children:bt(r.created_at)}),e.jsxs("div",{className:"cor-actions",onClick:c=>c.stopPropagation(),children:[o&&e.jsx("button",{className:"cor-action-btn submit",onClick:c=>V(r.id,c),title:"Submit for Approval","aria-label":`Submit COR ${r.cor_number} for approval`,children:e.jsx(lt,{size:14,"aria-hidden":"true"})}),ce&&e.jsx("button",{className:"cor-action-btn edit",onClick:c=>{c.stopPropagation(),ie?.(r)},title:"Edit","aria-label":`Edit COR ${r.cor_number}`,children:e.jsx(nt,{size:14,"aria-hidden":"true"})}),e.jsx("button",{className:"cor-action-btn view",onClick:c=>{c.stopPropagation(),Y?.(r)},title:"View Details","aria-label":`View COR ${r.cor_number} details`,children:e.jsx(rt,{size:14,"aria-hidden":"true"})}),F&&e.jsx("button",{className:"cor-action-btn delete",onClick:c=>x(r.id,c),title:"Delete","aria-label":`Delete COR ${r.cor_number}`,children:e.jsx(ot,{size:14,"aria-hidden":"true"})})]})]})]})}),H={draft:{label:"Draft",color:[107,114,128],bgColor:[243,244,246]},pending_approval:{label:"Pending Approval",color:[217,119,6],bgColor:[254,243,199]},approved:{label:"Approved",color:[5,150,105],bgColor:[209,250,229]},rejected:{label:"Rejected",color:[220,38,38],bgColor:[254,226,226]},billed:{label:"Billed",color:[37,99,235],bgColor:[219,234,254]},closed:{label:"Closed",color:[75,85,99],bgColor:[229,231,235]}};function At({project:u,company:r,areas:w,refreshKey:T,onShowToast:h,onCreateCOR:E,onViewCOR:Y,onEditCOR:ie,previewMode:x=!1,previewLimit:V=5,onViewAll:k,onDisplayModeChange:ce}){const{branding:F}=et(),[o,X]=i.useState([]),[q,de]=i.useState(!0),[c,fe]=i.useState("all"),[G,St]=i.useState("all"),[Q,Ae]=i.useState("all"),[Dt,yt]=i.useState(null),[P,ue]=i.useState(new Set),[I,he]=i.useState(!1),[$e,z]=i.useState(!1),[J,me]=i.useState(""),[K,Z]=i.useState(!1),pe=i.useRef(null);i.useEffect(()=>{const t=s=>{pe.current&&!pe.current.contains(s.target)&&Z(!1)};return K&&document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[K]);const[B,Le]=i.useState("list"),ee=t=>{Le(t),ce?.(t)},[_,je]=i.useState(x?"all":"recent"),[ge,_e]=i.useState(new Set),[j,te]=i.useState({start:"",end:""}),[ve,Te]=i.useState(null),A=i.useCallback(async()=>{try{const t=await O.getCORs(u.id);X(t||[])}catch(t){console.error("Error loading CORs:",t),h?.("Error loading change order requests","error")}finally{de(!1)}},[u.id]),D=i.useCallback(async()=>{try{const t=await O.getCORStats?.(u.id);Te(t)}catch(t){console.error("Error loading COR stats:",t)}},[u.id]);i.useEffect(()=>{A(),D();const t=O.subscribeToCORs?.(u.id,()=>{A(),D()});return()=>{t&&O.unsubscribe?.(t)}},[u.id,T,A,D]);const Ve=async()=>{if(o.length===0){h?.("No CORs to export","error");return}h?.("Generating Excel report...","info");try{const t=await be(()=>import("./xlsx-BvJTHLik.js"),[]),s=o.filter(n=>n.status==="approved"),a=o.filter(n=>["draft","pending_approval"].includes(n.status)),d=o.filter(n=>n.status==="rejected"),L=o.filter(n=>n.status==="billed"),m=o.reduce((n,p)=>n+(p.cor_total||0),0)/100,C=s.reduce((n,p)=>n+(p.cor_total||0),0)/100,M=a.reduce((n,p)=>n+(p.cor_total||0),0)/100,v=t.utils.book_new(),b=[["CHANGE ORDER REQUEST SUMMARY"],[],["Company:",r?.name||""],["Project:",u.name],["Job Number:",u.job_number||"N/A"],["Report Date:",new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})],[],["FINANCIAL OVERVIEW"],[],["Category","Count","Value"],["Total CORs",o.length,m],["Approved",s.length,C],["Pending Approval",a.length,M],["Rejected",d.length,d.reduce((n,p)=>n+(p.cor_total||0),0)/100],["Billed",L.length,L.reduce((n,p)=>n+(p.cor_total||0),0)/100],[],["CONTRACT IMPACT"],[],["Original Contract Value:",u.contract_value||0],["Total Approved CORs:",C],["Revised Contract Value:",(u.contract_value||0)+C],["Pending COR Value:",M],["Potential Total:",(u.contract_value||0)+C+M]],U=t.utils.aoa_to_sheet(b);U["!cols"]=[{wch:25},{wch:15},{wch:18}],t.utils.book_append_sheet(v,U,"Summary");const le=["COR #","Title","Description","Amount","Status","Created Date","Submitted Date","Approved Date","Approved By","Work Period Start","Work Period End","Area"],ne=o.map(n=>[n.cor_number||"",n.title||"Untitled",n.scope_of_work||"",(n.cor_total||0)/100,H[n.status]?.label||n.status,n.created_at?new Date(n.created_at).toLocaleDateString():"",n.submitted_at?new Date(n.submitted_at).toLocaleDateString():"",n.approved_at?new Date(n.approved_at).toLocaleDateString():"",n.approved_by_name||"",n.period_start?new Date(n.period_start).toLocaleDateString():"",n.period_end?new Date(n.period_end).toLocaleDateString():"",n.area?.name||""]),N=t.utils.aoa_to_sheet([le,...ne]);N["!cols"]=[{wch:10},{wch:30},{wch:40},{wch:14},{wch:16},{wch:12},{wch:12},{wch:12},{wch:18},{wch:12},{wch:12},{wch:15}];for(let n=1;n<=ne.length;n++){const p=t.utils.encode_cell({r:n,c:3});N[p]&&(N[p].z="$#,##0.00")}t.utils.book_append_sheet(v,N,"COR Details"),[{name:"Approved CORs",data:s,status:"approved"},{name:"Pending CORs",data:a,status:"pending"}].forEach(({name:n,data:p})=>{if(p.length>0){const R=[["COR #","Title","Amount","Date"],...p.map(l=>[l.cor_number||"",l.title||"Untitled",(l.cor_total||0)/100,l.created_at?new Date(l.created_at).toLocaleDateString():""]),[],["TOTAL","",p.reduce((l,g)=>l+(g.cor_total||0),0)/100,""]],re=t.utils.aoa_to_sheet(R);re["!cols"]=[{wch:12},{wch:40},{wch:14},{wch:12}],t.utils.book_append_sheet(v,re,n)}});const y=`COR_Report_${u.job_number||u.name}_${new Date().toISOString().split("T")[0]}.xlsx`;t.writeFile(v,y),h?.("Excel report exported successfully","success")}catch(t){console.error("Export error:",t),h?.("Export failed","error")}},Ge=async()=>{if(o.length===0){h?.("No CORs to export","error");return}h?.("Generating PDF report...","info");try{const{default:t}=await be(async()=>{const{default:l}=await import("./pdf-D2LJUoLv.js").then(g=>g.j);return{default:l}},[]),{default:s}=await be(async()=>{const{default:l}=await import("./pdf-D2LJUoLv.js").then(g=>g.b);return{default:l}},[]),a=new t("landscape"),d=a.internal.pageSize.width,L=a.internal.pageSize.height,m=15,C=Ee(F?.primary_color||"#3B82F6"),M=Ee(F?.secondary_color||"#1E40AF");a.setFillColor(...C),a.rect(0,0,d,40,"F"),a.setFillColor(...M),a.rect(0,38,d,3,"F");let v=m;if(F?.logo_url)try{const l=await tt(F.logo_url);l&&(a.addImage(l,"PNG",m,6,28,28),v=m+35)}catch(l){console.error("Logo load error:",l)}a.setTextColor(255,255,255),a.setFontSize(20),a.setFont("helvetica","bold"),a.text(r?.name||"Company",v,18),a.setFontSize(11),a.setFont("helvetica","normal"),a.text("CHANGE ORDER REQUEST REPORT",v,28),a.setFontSize(9),a.text(new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}),d-m,15,{align:"right"}),u.job_number&&a.text(`Job #: ${u.job_number}`,d-m,23,{align:"right"}),a.text(`${o.length} Change Orders`,d-m,31,{align:"right"});let b=50;a.setFillColor(248,250,252),a.setDrawColor(...C),a.setLineWidth(.5),a.roundedRect(m,b,d-m*2,25,3,3,"FD"),a.setTextColor(...C),a.setFontSize(14),a.setFont("helvetica","bold"),a.text(u.name,m+8,b+10),a.setTextColor(100,116,139),a.setFontSize(9),a.setFont("helvetica","normal"),u.address&&a.text(u.address,m+8,b+18),b+=35;const U=o.filter(l=>l.status==="approved"),le=o.filter(l=>["draft","pending_approval"].includes(l.status)),ne=o.reduce((l,g)=>l+(g.cor_total||0),0),N=U.reduce((l,g)=>l+(g.cor_total||0),0),we=le.reduce((l,g)=>l+(g.cor_total||0),0),y=(d-m*2-30)/4;[{label:"Total CORs",value:o.length.toString(),subValue:f(ne)},{label:"Approved",value:U.length.toString(),subValue:f(N),color:[5,150,105]},{label:"Pending",value:le.length.toString(),subValue:f(we),color:[217,119,6]},{label:"Revised Contract",value:f((u.contract_value||0)*100+N),subValue:`+${f(N)} from original`,color:C}].forEach((l,g)=>{const S=m+g*(y+10),xe=l.color||C,Ke=xe.map(Ze=>Math.min(255,Ze+200));a.setFillColor(...Ke),a.setDrawColor(...xe),a.roundedRect(S,b,y,32,2,2,"FD"),a.setTextColor(...xe),a.setFontSize(18),a.setFont("helvetica","bold"),a.text(l.value,S+y/2,b+14,{align:"center"}),a.setTextColor(100,116,139),a.setFontSize(8),a.setFont("helvetica","normal"),a.text(l.label,S+y/2,b+22,{align:"center"}),l.subValue&&(a.setFontSize(7),a.text(l.subValue,S+y/2,b+28,{align:"center"}))}),b+=42,a.setTextColor(...C),a.setFontSize(11),a.setFont("helvetica","bold"),a.text("CHANGE ORDER DETAILS",m,b),b+=5;const p=o.map((l,g)=>{const S=H[l.status]||{label:l.status,color:[107,114,128]};return[(g+1).toString(),l.cor_number||"-",l.title||"Untitled",f(l.cor_total||0),S.label,l.created_at?new Date(l.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"}):"-"]});s(a,{startY:b,head:[["#","COR #","Description","Amount","Status","Date"]],body:p,theme:"grid",styles:{fontSize:9,cellPadding:4,lineColor:[226,232,240],lineWidth:.1},headStyles:{fillColor:C,textColor:[255,255,255],fontStyle:"bold",halign:"center"},columnStyles:{0:{cellWidth:12,halign:"center"},1:{cellWidth:25,halign:"center"},2:{cellWidth:"auto"},3:{cellWidth:30,halign:"right",fontStyle:"bold"},4:{cellWidth:28,halign:"center"},5:{cellWidth:28,halign:"center"}},alternateRowStyles:{fillColor:[248,250,252]},didParseCell:l=>{if(l.column.index===4&&l.section==="body"){const g=Object.keys(H).find(S=>H[S].label===l.cell.raw);g&&(l.cell.styles.textColor=H[g].color,l.cell.styles.fontStyle="bold")}}});const R=L-12;a.setDrawColor(226,232,240),a.setLineWidth(.5),a.line(m,R-5,d-m,R-5),a.setTextColor(148,163,184),a.setFontSize(8),a.setFont("helvetica","normal"),a.text(`Generated on ${new Date().toLocaleString()}`,m,R),a.text(`${r?.name||"FieldSync"} â€¢ Confidential`,d/2,R,{align:"center"}),a.text("Page 1 of 1",d-m,R,{align:"right"});const re=`COR_Report_${u.job_number||u.name}_${new Date().toISOString().split("T")[0]}.pdf`;a.save(re),h?.("PDF report exported successfully","success")}catch(t){console.error("Export error:",t),h?.("Export failed","error")}},Ie=i.useCallback(async(t,s)=>{if(s?.stopPropagation(),!!confirm("Are you sure you want to delete this COR? This action cannot be undone."))try{await O.deleteCOR(t),X(a=>a.filter(d=>d.id!==t)),h?.("COR deleted","success"),D()}catch(a){console.error("Error deleting COR:",a),h?.("Error deleting COR","error")}},[D]),Be=i.useCallback(async(t,s)=>{s?.stopPropagation();try{await O.submitCORForApproval(t),await A(),h?.("COR submitted for approval","success"),D()}catch(a){console.error("Error submitting COR:",a?.message||a),h?.(a?.message||"Error submitting COR","error")}},[A,D]),We=i.useCallback((t,s)=>{s?.stopPropagation(),ue(a=>{const d=new Set(a);return d.has(t)?d.delete(t):d.add(t),d})},[]),Me=()=>{he(!1),ue(new Set)},Ne=async()=>{if(!J.trim()){h?.("Please enter a group name","error");return}try{await O.bulkUpdateCORGroup([...P],J.trim()),h?.(`${P.size} CORs grouped as "${J.trim()}"`,"success"),z(!1),me(""),ue(new Set),he(!1),A()}catch(t){console.error("Error grouping CORs:",t),h?.("Error grouping CORs","error")}},ae=i.useMemo(()=>{const t=o.map(s=>s.group_name).filter(Boolean);return[...new Set(t)].sort()},[o]),Se=i.useMemo(()=>{let t=[...o];if(c!=="all"&&(t=t.filter(s=>s.status===c)),G!=="all"&&(t=t.filter(s=>s.area_id===G)),Q!=="all"&&(t=t.filter(s=>s.group_name===Q)),j.start){const s=new Date(j.start);s.setHours(0,0,0,0),t=t.filter(a=>new Date(a.created_at)>=s)}if(j.end){const s=new Date(j.end);s.setHours(23,59,59,999),t=t.filter(a=>new Date(a.created_at)<=s)}if(_==="recent"&&!x){const s=new Date;s.setDate(s.getDate()-7),s.setHours(0,0,0,0),t=t.filter(a=>new Date(a.created_at)>=s)}return t.sort((s,a)=>new Date(a.created_at)-new Date(s.created_at)),x&&(t=t.slice(0,V)),t},[o,c,G,Q,_,j,x,V]),{paginatedItems:Ue,searchTerm:De,setSearchTerm:ye,currentPage:He,totalPages:Re,goToPage:Ye,pageSize:Xe,setPageSize:qe,totalItems:Qe}=jt(Se,{pageSize:25,searchFields:["title","cor_number","scope_of_work","status"]}),se=x?Se:Ue,$=i.useMemo(()=>{if(_!=="all")return null;const t={};return se.forEach(s=>{const a=new Date(s.created_at),d=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,L=a.toLocaleDateString("en-US",{month:"long",year:"numeric"});t[d]||(t[d]={label:L,cors:[],totalAmount:0}),t[d].cors.push(s),t[d].totalAmount+=s.cor_total||0}),Object.entries(t).sort((s,a)=>a[0].localeCompare(s[0]))},[se,_]);i.useEffect(()=>{if($&&$.length>0){const t=$[0][0];_e(new Set([t]))}},[$]);const Je=t=>{const s=new Set(ge);s.has(t)?s.delete(t):s.add(t),_e(s)},W=i.useMemo(()=>({all:o.length,draft:o.filter(t=>t.status==="draft").length,pending_approval:o.filter(t=>t.status==="pending_approval").length,approved:o.filter(t=>t.status==="approved").length,rejected:o.filter(t=>t.status==="rejected").length,billed:o.filter(t=>t.status==="billed").length,closed:o.filter(t=>t.status==="closed").length}),[o]);c==="all"?o.length:o.filter(t=>t.status===c).length;const Oe=t=>e.jsx(Nt,{cor:t,isSelected:P.has(t.id),selectMode:I,areas:w,onToggleSelect:We,onView:Y,onEdit:ie,onDelete:Ie,onSubmitForApproval:Be},t.id);return q?e.jsx("div",{className:"cor-list",children:e.jsx("div",{className:"cor-loading-skeletons",children:[1,2,3].map(t=>e.jsx(Ct,{},t))})}):e.jsxs("div",{className:`cor-list ${x?"cor-list-preview":""}`,children:[e.jsxs("div",{className:"cor-list-header",children:[e.jsxs("div",{className:"cor-list-info",children:[e.jsx("h3",{children:"Change Orders"}),e.jsxs("div",{className:"cor-stats-inline",children:[e.jsxs("span",{className:"cor-stat-item",children:[W.all," total"]}),W.pending_approval>0&&e.jsxs("span",{className:"cor-stat-item pending",children:[W.pending_approval," pending"]}),ve?.totalApproved>0&&e.jsx("span",{className:"cor-stat-item approved",children:f(ve.totalApproved)})]})]}),e.jsxs("div",{className:"cor-header-actions",children:[e.jsxs("div",{className:"cor-export-dropdown",ref:pe,children:[e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>Z(!K),disabled:o.length===0,children:[e.jsx(it,{size:14})," Export ",e.jsx(ke,{size:12})]}),K&&e.jsxs("div",{className:"cor-export-menu",children:[e.jsxs("button",{onClick:()=>{Ge(),Z(!1)},children:[e.jsx(Fe,{size:14})," Export as PDF"]}),e.jsxs("button",{onClick:()=>{Ve(),Z(!1)},children:[e.jsx(ct,{size:14})," Export as Excel"]})]})]}),e.jsxs("div",{className:"cor-display-toggle",children:[e.jsxs("button",{className:`cor-display-btn ${B==="list"?"active":""}`,onClick:()=>ee("list"),title:"List View",children:[e.jsx(dt,{size:14}),e.jsx("span",{children:"List"})]}),e.jsxs("button",{className:`cor-display-btn log-btn ${B==="log"?"active":""}`,onClick:()=>ee("log"),title:"COR Log - Edit & Export for Clients",children:[e.jsx(ut,{size:14}),e.jsx("span",{children:"COR Log"})]})]}),x?e.jsx(e.Fragment,{children:e.jsxs("button",{className:"btn btn-primary btn-small",onClick:E,children:[e.jsx(Ce,{size:14})," New COR"]})}):e.jsxs(e.Fragment,{children:[B==="list"&&e.jsx("button",{className:`btn btn-secondary btn-small ${I?"active":""}`,onClick:()=>I?Me():he(!0),children:I?e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:14})," Cancel"]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{size:14})," Select"]})}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:E,children:[e.jsx(Ce,{size:14})," New COR"]})]})]})]}),B==="log"&&e.jsx("div",{className:"cor-log-modal-overlay",onClick:()=>ee("list"),children:e.jsxs("div",{className:"cor-log-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"cor-log-modal-header",children:[e.jsx("h2",{children:"Change Order Log"}),e.jsx("button",{className:"cor-log-modal-close",onClick:()=>ee("list"),title:"Close",children:e.jsx(oe,{size:24})})]}),e.jsx("div",{className:"cor-log-modal-content",children:e.jsx(_t,{project:u,company:r,onShowToast:h})})]})}),B==="list"&&e.jsxs(e.Fragment,{children:[I&&P.size>0&&e.jsxs("div",{className:"cor-selection-bar",children:[e.jsxs("span",{className:"selection-count",children:[P.size," selected"]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:()=>z(!0),children:[e.jsx(ht,{size:14})," Group Selected"]})]}),!x&&e.jsxs("div",{className:"cor-controls",children:[e.jsx("div",{className:"cor-filter-pills",role:"tablist",children:[{id:"all",label:"All"},{id:"draft",label:"Draft"},{id:"pending_approval",label:"Pending"},{id:"approved",label:"Approved"}].map(t=>e.jsxs("button",{role:"tab","aria-selected":c===t.id,className:`cor-pill ${c===t.id?"active":""}`,onClick:()=>fe(t.id),children:[t.label,W[t.id]>0&&e.jsx("span",{className:"cor-pill-count",children:W[t.id]})]},t.id))}),ae.length>0&&e.jsxs("select",{className:"cor-group-filter",value:Q,onChange:t=>Ae(t.target.value),children:[e.jsx("option",{value:"all",children:"All Groups"}),ae.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("div",{className:"cor-view-toggle",children:[e.jsx("button",{className:`cor-toggle-btn ${_==="recent"?"active":""}`,onClick:()=>{je("recent"),te({start:"",end:""})},children:"Recent"}),e.jsx("button",{className:`cor-toggle-btn ${_==="all"?"active":""}`,onClick:()=>je("all"),children:"All"})]})]}),!x&&e.jsxs("div",{className:"cor-search",children:[e.jsx(mt,{size:14,className:"cor-search-icon"}),e.jsx("input",{type:"text",className:"cor-search-input",placeholder:"Search CORs by title, number, scope, or status...",value:De,onChange:t=>ye(t.target.value)}),De&&e.jsx("button",{className:"cor-search-clear",onClick:()=>ye(""),children:e.jsx(oe,{size:14})})]}),_==="all"&&!x&&e.jsxs("div",{className:"cor-date-filter",children:[e.jsx(pt,{size:14}),e.jsx("input",{type:"date",value:j.start,onChange:t=>te(s=>({...s,start:t.target.value}))}),e.jsx("span",{className:"cor-date-sep",children:"to"}),e.jsx("input",{type:"date",value:j.end,onChange:t=>te(s=>({...s,end:t.target.value}))}),(j.start||j.end)&&e.jsx("button",{className:"cor-clear-btn",onClick:()=>te({start:"",end:""}),children:"Clear"})]}),se.length===0?e.jsxs("div",{className:"cor-empty",children:[e.jsx(Fe,{size:24,className:"cor-empty-icon"}),e.jsxs("p",{children:["No change orders ",c!=="all"?`(${c.replace("_"," ")})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:E,children:[e.jsx(Ce,{size:14})," Create COR"]})]}):e.jsx("div",{className:"cor-cards stagger-children",children:_==="all"&&$?$.map(([t,s])=>e.jsxs("div",{className:"cor-month-group animate-fade-in",children:[e.jsxs("button",{className:"cor-month-header",onClick:()=>Je(t),children:[e.jsxs("div",{className:"cor-month-left",children:[ge.has(t)?e.jsx(ke,{size:16}):e.jsx(Pe,{size:16}),e.jsx("span",{children:s.label}),e.jsx(ft,{count:s.cors.length,size:"small"})]}),e.jsx("span",{className:"cor-month-total",children:f(s.totalAmount)})]}),ge.has(t)&&e.jsx("div",{className:"cor-month-items stagger-children",children:s.cors.map(a=>Oe(a))})]},t)):se.map(t=>Oe(t))}),!x&&Re>1&&e.jsx(vt,{currentPage:He,totalPages:Re,onPageChange:Ye,pageSize:Xe,onPageSizeChange:qe,totalItems:Qe}),x&&o.length>V&&e.jsxs("button",{className:"cor-see-all-btn",onClick:k,children:["See all ",o.length," change orders",e.jsx(Pe,{size:16})]})]}),$e&&e.jsx("div",{className:"modal-overlay",onClick:()=>z(!1),children:e.jsxs("div",{className:"modal-content cor-group-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Group ",P.size," CORs"]}),e.jsx("button",{className:"close-btn",onClick:()=>z(!1),children:e.jsx(oe,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Group Name"}),e.jsx("input",{type:"text",value:J,onChange:t=>me(t.target.value),placeholder:"e.g., Phase 1, Building A, Week 1",autoFocus:!0,onKeyDown:t=>{t.key==="Enter"&&Ne(),t.key==="Escape"&&z(!1)}})]}),ae.length>0&&e.jsxs("div",{className:"existing-groups",children:[e.jsx("label",{children:"Or select existing group:"}),e.jsx("div",{className:"group-chips",children:ae.map(t=>e.jsx("button",{className:"group-chip",onClick:()=>me(t),children:t},t))})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>z(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:Ne,children:"Group CORs"})]})]})})]})}export{At as default};
//# sourceMappingURL=CORList-TO8a6Pcp.js.map
