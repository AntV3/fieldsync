const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ShareModal-_kvfg_0q.js","assets/index-CbEMtBfa.js","assets/icons-CRX8gXS_.js","assets/react-DXGY7bZi.js","assets/pdf-aQqpMATS.js","assets/supabase-VuevzHjS.js","assets/index-DFkHd28B.css","assets/NotificationSettings-Cg8ooaC6.js","assets/CORForm-r1FmPlqC.js","assets/corCalculations-vdJc_BOT.js","assets/CORDetail-C3atAr4n.js","assets/SignatureCanvas-C8iSC8xL.js","assets/SignatureLinkGenerator-CfY-3FBS.js","assets/CORLog-DCLMFojX.js","assets/DrawRequestModal-Ca_XoK7B.js","assets/EquipmentModal-CmbtyiA7.js","assets/AddCostModal-BkftPmxH.js","assets/DocumentsTab-CVWzWn1Y.js","assets/CORLogPreview-D4iOI1Ch.js","assets/CORList-D_Shw_b2.js","assets/TMList-BfrSbPM4.js","assets/BillingCenter-DIWEd05m.js","assets/PhotoTimeline-T-ewDtlp.js"])))=>i.map(i=>d[i]);
import{_ as oe}from"./pdf-aQqpMATS.js";import{r as Ss,c as Dt,a as Fr,S as Ar,b as Mr,u as is,s as Or,d as $r,e as Ir,f as Lr,g as zr,h as qr,i as Vr,j as Ze,k as Et,l as Br,m as ya,n as Wr,o as Ur,p as Hr,D as Ja,q as Rt,t as Kr,v as Gr,w as Yr,x as Na,y as Jr,z as Xr,A as Xa,Z as Qa,L as ks,C as Qr,B as Zr,E as Le,F as wa,G as Pt,H as ei,I as Qs,J as Tt,K as Za,M as en,N as si,O as ti,P as Ft,Q as At,R as ai,T as ni,U as sn,V as Ca,W as ri,X as ii,Y as li,_ as ci,$ as oi,a0 as di,a1 as tn,a2 as ui,a3 as mi,a4 as hi,a5 as pi,a6 as xi,a7 as vi,a8 as ji,a9 as fi,aa as ka,ab as _a,ac as Sa,ad as gi,ae as bi,af as yi,ag as as,ah as Ni,ai as wi,aj as Ci,ak as an,al as vt,am as ki,an as _i,ao as Si,ap as Di,aq as Ei,ar as q,as as e,at as Zs,au as Ri,av as nn,aw as Mt,ax as Ot,ay as et,az as Da,aA as Pi,aB as Ti,aC as Fi,aD as ns,aE as Ai,aF as rn,aG as Cs,aH as ln,aI as Mi,aJ as Oi,aK as gs,aL as ae,aM as $i,aN as jt,aO as Ea,aP as Ii,aQ as Li,aR as zi,aS as qi}from"./index-CbEMtBfa.js";import{r as o,h as cn,X as ms,af as Vi,a2 as wt,C as qe,F as os,x as xe,Y as De,ad as Ks,T as Te,ag as Bi,ah as ys,D as Ye,ai as on,_ as st,H as Je,W as Ct,aj as ft,ak as Wi,f as Ds,V as hs,al as ps,p as $t,e as kt,b as dn,$ as ls,am as un,an as Ui,ao as Hi,ap as Ki,m as Gi,aq as Yi,ar as Hs,o as Xe,t as tt,u as es,ac as mn,q as _s,R as Ji,as as Xi,O as Qi,at as Zi,U as el,au as sl,av as gt,d as _t,L as Ra,aw as Pa,g as tl,ax as Ta,ay as Fa,az as al,k as nl,i as rl,a9 as il,a as ll,aA as cl}from"./icons-CRX8gXS_.js";import{f as be}from"./corCalculations-vdJc_BOT.js";function Gs(){return Gs=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(s[n]=r[n])}return s},Gs.apply(null,arguments)}function Aa(s,t){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(s,a).enumerable})),r.push.apply(r,n)}return r}function ol(s){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Aa(Object(r),!0).forEach(function(n){dl(s,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Aa(Object(r)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(r,n))})}return s}function dl(s,t,r){return(t=ul(t))in s?Object.defineProperty(s,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[t]=r,s}function ul(s){var t=ml(s,"string");return typeof t=="symbol"?t:t+""}function ml(s,t){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var n=r.call(s,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}var ge=32,hl={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function pl(s){var{data:t,iconType:r,inactiveColor:n}=s,a=ge/2,l=ge/6,c=ge/3,i=t.inactive?n:t.color,d=r??t.type;if(d==="none")return null;if(d==="plainline"){var u;return o.createElement("line",{strokeWidth:4,fill:"none",stroke:i,strokeDasharray:(u=t.payload)===null||u===void 0?void 0:u.strokeDasharray,x1:0,y1:a,x2:ge,y2:a,className:"recharts-legend-icon"})}if(d==="line")return o.createElement("path",{strokeWidth:4,fill:"none",stroke:i,d:"M0,".concat(a,"h").concat(c,`
            A`).concat(l,",").concat(l,",0,1,1,").concat(2*c,",").concat(a,`
            H`).concat(ge,"M").concat(2*c,",").concat(a,`
            A`).concat(l,",").concat(l,",0,1,1,").concat(c,",").concat(a),className:"recharts-legend-icon"});if(d==="rect")return o.createElement("path",{stroke:"none",fill:i,d:"M0,".concat(ge/8,"h").concat(ge,"v").concat(ge*3/4,"h").concat(-ge,"z"),className:"recharts-legend-icon"});if(o.isValidElement(t.legendIcon)){var m=ol({},t);return delete m.legendIcon,o.cloneElement(t.legendIcon,m)}return o.createElement(Mr,{fill:i,cx:a,cy:a,size:ge,sizeType:"diameter",type:d})}function xl(s){var{payload:t,iconSize:r,layout:n,formatter:a,inactiveColor:l,iconType:c}=s,i={x:0,y:0,width:ge,height:ge},d={display:n==="horizontal"?"inline-block":"block",marginRight:10},u={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((m,h)=>{var f=m.formatter||a,j=Dt({"recharts-legend-item":!0,["legend-item-".concat(h)]:!0,inactive:m.inactive});if(m.type==="none")return null;var p=m.inactive?l:m.color,x=f?f(m.value,m,h):m.value;return o.createElement("li",Gs({className:j,style:d,key:"legend-item-".concat(h)},Fr(s,m,h)),o.createElement(Ar,{width:r,height:r,viewBox:i,style:u,"aria-label":"".concat(x," legend icon")},o.createElement(pl,{data:m,iconType:c,inactiveColor:l})),o.createElement("span",{className:"recharts-legend-item-text",style:{color:p}},x))})}var vl=s=>{var t=Ss(s,hl),{payload:r,layout:n,align:a}=t;if(!r||!r.length)return null;var l={padding:0,margin:0,textAlign:n==="horizontal"?a:"left"};return o.createElement("ul",{className:"recharts-default-legend",style:l},o.createElement(xl,Gs({},t,{payload:r})))};function jl(){return is(Or)}var fl=["contextPayload"];function St(){return St=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(s[n]=r[n])}return s},St.apply(null,arguments)}function Ma(s,t){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(s,a).enumerable})),r.push.apply(r,n)}return r}function us(s){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ma(Object(r),!0).forEach(function(n){gl(s,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Ma(Object(r)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(r,n))})}return s}function gl(s,t,r){return(t=bl(t))in s?Object.defineProperty(s,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[t]=r,s}function bl(s){var t=yl(s,"string");return typeof t=="symbol"?t:t+""}function yl(s,t){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var n=r.call(s,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Nl(s,t){if(s==null)return{};var r,n,a=wl(s,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(s,r)&&(a[r]=s[r])}return a}function wl(s,t){if(s==null)return{};var r={};for(var n in s)if({}.hasOwnProperty.call(s,n)){if(t.indexOf(n)!==-1)continue;r[n]=s[n]}return r}function Cl(s){return s.value}function kl(s){var{contextPayload:t}=s,r=Nl(s,fl),n=Wr(t,s.payloadUniqBy,Cl),a=us(us({},r),{},{payload:n});return o.isValidElement(s.content)?o.cloneElement(s.content,a):typeof s.content=="function"?o.createElement(s.content,a):o.createElement(vl,a)}function _l(s,t,r,n,a,l){var{layout:c,align:i,verticalAlign:d}=t,u,m;return(!s||(s.left===void 0||s.left===null)&&(s.right===void 0||s.right===null))&&(i==="center"&&c==="vertical"?u={left:((n||0)-l.width)/2}:u=i==="right"?{right:r&&r.right||0}:{left:r&&r.left||0}),(!s||(s.top===void 0||s.top===null)&&(s.bottom===void 0||s.bottom===null))&&(d==="middle"?m={top:((a||0)-l.height)/2}:m=d==="bottom"?{bottom:r&&r.bottom||0}:{top:r&&r.top||0}),us(us({},u),m)}function Sl(s){var t=Et();return o.useEffect(()=>{t(Br(s))},[t,s]),null}function Dl(s){var t=Et();return o.useEffect(()=>(t(ya(s)),()=>{t(ya({width:0,height:0}))}),[t,s]),null}function El(s,t,r,n){return s==="vertical"&&Ze(t)?{height:t}:s==="horizontal"?{width:r||n}:null}var Rl={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function Es(s){var t=Ss(s,Rl),r=jl(),n=$r(),a=Ir(),{width:l,height:c,wrapperStyle:i,portal:d}=t,[u,m]=Lr([r]),h=zr(),f=qr();if(h==null||f==null)return null;var j=h-(a?.left||0)-(a?.right||0),p=El(t.layout,c,l,j),x=d?i:us(us({position:"absolute",width:p?.width||l||"auto",height:p?.height||c||"auto"},_l(i,t,a,h,f,u)),i),k=d??n;if(k==null||r==null)return null;var P=o.createElement("div",{className:"recharts-legend-wrapper",style:x,ref:m},o.createElement(Sl,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),!d&&o.createElement(Dl,{width:u.width,height:u.height}),o.createElement(kl,St({},t,p,{margin:a,chartWidth:h,chartHeight:f,contextPayload:r})));return Vr.createPortal(P,k)}Es.displayName="Legend";function Oa(s,t){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(s,a).enumerable})),r.push.apply(r,n)}return r}function $a(s){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Oa(Object(r),!0).forEach(function(n){Pl(s,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Oa(Object(r)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(r,n))})}return s}function Pl(s,t,r){return(t=Tl(t))in s?Object.defineProperty(s,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[t]=r,s}function Tl(s){var t=Fl(s,"string");return typeof t=="symbol"?t:t+""}function Fl(s,t){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var n=r.call(s,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Ys(){return Ys=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(s[n]=r[n])}return s},Ys.apply(null,arguments)}var Al=(s,t)=>{var r;if(o.isValidElement(s))r=o.cloneElement(s,t);else if(typeof s=="function")r=s(t);else{if(!Le(t.x1)||!Le(t.y1)||!Le(t.x2)||!Le(t.y2))return null;r=o.createElement("line",Ys({},t,{className:"recharts-reference-line-line"}))}return r},Ml=(s,t,r,n,a,l)=>{var{x:c,width:i}=l,d=a.y.apply(s,{position:r});if(Pt(d)||t==="discard"&&!a.y.isInRange(d))return null;var u=[{x:c+i,y:d},{x:c,y:d}];return n==="left"?u.reverse():u},Ol=(s,t,r,n,a,l)=>{var{y:c,height:i}=l,d=a.x.apply(s,{position:r});if(Pt(d)||t==="discard"&&!a.x.isInRange(d))return null;var u=[{x:d,y:c+i},{x:d,y:c}];return n==="top"?u.reverse():u},$l=(s,t,r,n)=>{var a=s.map(l=>n.apply(l,{position:r}));return t==="discard"&&a.some(l=>!n.isInRange(l))?null:a},Il=(s,t,r,n,a,l)=>{var{x:c,y:i,segment:d,ifOverflow:u}=l,m=wa(c),h=wa(i);return h?Ml(i,u,r,a,s,t):m?Ol(c,u,r,n,s,t):d!=null&&d.length===2?$l(d,u,r,s):null};function Ll(s){var t=Et();return o.useEffect(()=>(t(Ur(s)),()=>{t(Hr(s))})),null}function zl(s){var{xAxisId:t,yAxisId:r,shape:n,className:a,ifOverflow:l}=s,c=Rt(),i=Kr(),d=is(F=>Gr(F,t)),u=is(F=>Yr(F,r)),m=is(F=>Na(F,"xAxis",t,c)),h=is(F=>Na(F,"yAxis",r,c)),f=Jr();if(!i||!f||d==null||u==null||m==null||h==null)return null;var j=Xr({x:m,y:h}),p=Il(j,f,s.position,d.orientation,u.orientation,s);if(!p)return null;var[{x,y:k},{x:P,y:g}]=p,A=l==="hidden"?"url(#".concat(i,")"):void 0,v=$a($a({clipPath:A},Xa(s)),{},{x1:x,y1:k,x2:P,y2:g}),N=ei({x1:x,y1:k,x2:P,y2:g});return o.createElement(Qa,{zIndex:s.zIndex},o.createElement(ks,{className:Dt("recharts-reference-line",a)},Al(n,v),o.createElement(Qr,Ys({},N,{lowerWidth:N.width,upperWidth:N.width}),o.createElement(Zr,{label:s.label}),s.children)))}var ql={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:Ja.line};function hn(s){var t=Ss(s,ql);return o.createElement(o.Fragment,null,o.createElement(Ll,{yAxisId:t.yAxisId,xAxisId:t.xAxisId,ifOverflow:t.ifOverflow,x:t.x,y:t.y,segment:t.segment}),o.createElement(zl,t))}hn.displayName="ReferenceLine";var pn=(s,t,r)=>Za(s,"xAxis",Ft(s,t),r),xn=(s,t,r)=>en(s,"xAxis",Ft(s,t),r),vn=(s,t,r)=>Za(s,"yAxis",At(s,t),r),jn=(s,t,r)=>en(s,"yAxis",At(s,t),r),Vl=Qs([Tt,pn,vn,xn,jn],(s,t,r,n,a)=>sn(s,"xAxis")?Ca(t,n,!1):Ca(r,a,!1)),Bl=(s,t)=>t,fn=Qs([ri,Bl],(s,t)=>s.filter(r=>r.type==="area").find(r=>r.id===t)),gn=s=>{var t=Tt(s),r=sn(t,"xAxis");return r?"yAxis":"xAxis"},Wl=(s,t)=>{var r=gn(s);return r==="yAxis"?At(s,t):Ft(s,t)},Ul=(s,t,r)=>ai(s,gn(s),Wl(s,t),r),Hl=Qs([fn,Ul],(s,t)=>{var r;if(!(s==null||t==null)){var{stackId:n}=s,a=ni(s);if(!(n==null||a==null)){var l=(r=t[n])===null||r===void 0?void 0:r.stackedData,c=l?.find(i=>i.key===a);if(c!=null)return c.map(i=>[i[0],i[1]])}}}),Kl=Qs([Tt,pn,vn,xn,jn,Hl,si,Vl,fn,ti],(s,t,r,n,a,l,c,i,d,u)=>{var{chartData:m,dataStartIndex:h,dataEndIndex:f}=c;if(!(d==null||s!=="horizontal"&&s!=="vertical"||t==null||r==null||n==null||a==null||n.length===0||a.length===0||i==null)){var{data:j}=d,p;if(j&&j.length>0?p=j:p=m?.slice(h,f+1),p!=null)return mc({layout:s,xAxis:t,yAxis:r,xAxisTicks:n,yAxisTicks:a,dataStartIndex:h,areaSettings:d,stackedData:l,displayedData:p,chartBaseValue:u,bandSize:i})}}),Gl=["id"],Yl=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function Qe(){return Qe=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(s[n]=r[n])}return s},Qe.apply(null,arguments)}function bn(s,t){if(s==null)return{};var r,n,a=Jl(s,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(s,r)&&(a[r]=s[r])}return a}function Jl(s,t){if(s==null)return{};var r={};for(var n in s)if({}.hasOwnProperty.call(s,n)){if(t.indexOf(n)!==-1)continue;r[n]=s[n]}return r}function Ia(s,t){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(s,a).enumerable})),r.push.apply(r,n)}return r}function cs(s){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ia(Object(r),!0).forEach(function(n){Xl(s,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Ia(Object(r)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(r,n))})}return s}function Xl(s,t,r){return(t=Ql(t))in s?Object.defineProperty(s,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[t]=r,s}function Ql(s){var t=Zl(s,"string");return typeof t=="symbol"?t:t+""}function Zl(s,t){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var n=r.call(s,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Js(s,t){return s&&s!=="none"?s:t}var ec=s=>{var{dataKey:t,name:r,stroke:n,fill:a,legendType:l,hide:c}=s;return[{inactive:c,dataKey:t,type:l,color:Js(n,a),value:tn(r,t),payload:s}]},sc=o.memo(s=>{var{dataKey:t,data:r,stroke:n,strokeWidth:a,fill:l,name:c,hide:i,unit:d,tooltipType:u,id:m}=s,h={dataDefinedOnItem:r,positions:void 0,settings:{stroke:n,strokeWidth:a,fill:l,dataKey:t,nameKey:void 0,name:tn(c,t),hide:i,type:u,color:Js(n,l),unit:d,graphicalItemId:m}};return o.createElement(ui,{tooltipEntrySettings:h})});function tc(s){var{clipPathId:t,points:r,props:n}=s,{needClip:a,dot:l,dataKey:c}=n,i=an(n);return o.createElement(ki,{points:r,dot:l,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:c,baseProps:i,needClip:a,clipPathId:t})}function ac(s){var{showLabels:t,children:r,points:n}=s,a=n.map(l=>{var c,i,d={x:(c=l.x)!==null&&c!==void 0?c:0,y:(i=l.y)!==null&&i!==void 0?i:0,width:0,lowerWidth:0,upperWidth:0,height:0};return cs(cs({},d),{},{value:l.value,payload:l.payload,parentViewBox:void 0,viewBox:d,fill:void 0})});return o.createElement(Ci,{value:t?a:void 0},r)}function La(s){var{points:t,baseLine:r,needClip:n,clipPathId:a,props:l}=s,{layout:c,type:i,stroke:d,connectNulls:u,isRange:m}=l,{id:h}=l,f=bn(l,Gl),j=an(f),p=Xa(f);return o.createElement(o.Fragment,null,t?.length>1&&o.createElement(ks,{clipPath:n?"url(#clipPath-".concat(a,")"):void 0},o.createElement(vt,Qe({},p,{id:h,points:t,connectNulls:u,type:i,baseLine:r,layout:c,stroke:"none",className:"recharts-area-area"})),d!=="none"&&o.createElement(vt,Qe({},j,{className:"recharts-area-curve",layout:c,type:i,connectNulls:u,fill:"none",points:t})),d!=="none"&&m&&o.createElement(vt,Qe({},j,{className:"recharts-area-curve",layout:c,type:i,connectNulls:u,fill:"none",points:r}))),o.createElement(tc,{points:t,props:f,clipPathId:a}))}function nc(s){var t,r,{alpha:n,baseLine:a,points:l,strokeWidth:c}=s,i=(t=l[0])===null||t===void 0?void 0:t.y,d=(r=l[l.length-1])===null||r===void 0?void 0:r.y;if(!Le(i)||!Le(d))return null;var u=n*Math.abs(i-d),m=Math.max(...l.map(h=>h.x||0));return Ze(a)?m=Math.max(a,m):a&&Array.isArray(a)&&a.length&&(m=Math.max(...a.map(h=>h.x||0),m)),Ze(m)?o.createElement("rect",{x:0,y:i<d?i:i-u,width:m+(c?parseInt("".concat(c),10):1),height:Math.floor(u)}):null}function rc(s){var t,r,{alpha:n,baseLine:a,points:l,strokeWidth:c}=s,i=(t=l[0])===null||t===void 0?void 0:t.x,d=(r=l[l.length-1])===null||r===void 0?void 0:r.x;if(!Le(i)||!Le(d))return null;var u=n*Math.abs(i-d),m=Math.max(...l.map(h=>h.y||0));return Ze(a)?m=Math.max(a,m):a&&Array.isArray(a)&&a.length&&(m=Math.max(...a.map(h=>h.y||0),m)),Ze(m)?o.createElement("rect",{x:i<d?i:i-u,y:0,width:u,height:Math.floor(m+(c?parseInt("".concat(c),10):1))}):null}function ic(s){var{alpha:t,layout:r,points:n,baseLine:a,strokeWidth:l}=s;return r==="vertical"?o.createElement(nc,{alpha:t,points:n,baseLine:a,strokeWidth:l}):o.createElement(rc,{alpha:t,points:n,baseLine:a,strokeWidth:l})}function lc(s){var{needClip:t,clipPathId:r,props:n,previousPointsRef:a,previousBaselineRef:l}=s,{points:c,baseLine:i,isAnimationActive:d,animationBegin:u,animationDuration:m,animationEasing:h,onAnimationStart:f,onAnimationEnd:j}=n,p=o.useMemo(()=>({points:c,baseLine:i}),[c,i]),x=gi(p,"recharts-area-"),k=bi(),[P,g]=o.useState(!1),A=!P,v=o.useCallback(()=>{typeof j=="function"&&j(),g(!1)},[j]),N=o.useCallback(()=>{typeof f=="function"&&f(),g(!0)},[f]);if(k==null)return null;var F=a.current,O=l.current;return o.createElement(ac,{showLabels:A,points:c},n.children,o.createElement(yi,{animationId:x,begin:u,duration:m,isActive:d,easing:h,onAnimationEnd:v,onAnimationStart:N,key:x},S=>{if(F){var _=F.length/c.length,T=S===1?c:c.map((M,V)=>{var R=Math.floor(V*_);if(F[R]){var se=F[R];return cs(cs({},M),{},{x:as(se.x,M.x,S),y:as(se.y,M.y,S)})}return M}),L;return Ze(i)?L=as(O,i,S):Ni(i)||Pt(i)?L=as(O,0,S):L=i.map((M,V)=>{var R=Math.floor(V*_);if(Array.isArray(O)&&O[R]){var se=O[R];return cs(cs({},M),{},{x:as(se.x,M.x,S),y:as(se.y,M.y,S)})}return M}),S>0&&(a.current=T,l.current=L),o.createElement(La,{points:T,baseLine:L,needClip:t,clipPathId:r,props:n})}return S>0&&(a.current=c,l.current=i),o.createElement(ks,null,d&&o.createElement("defs",null,o.createElement("clipPath",{id:"animationClipPath-".concat(r)},o.createElement(ic,{alpha:S,points:c,baseLine:i,layout:k,strokeWidth:n.strokeWidth}))),o.createElement(ks,{clipPath:"url(#animationClipPath-".concat(r,")")},o.createElement(La,{points:c,baseLine:i,needClip:t,clipPathId:r,props:n})))}),o.createElement(wi,{label:n.label}))}function cc(s){var{needClip:t,clipPathId:r,props:n}=s,a=o.useRef(null),l=o.useRef();return o.createElement(lc,{needClip:t,clipPathId:r,props:n,previousPointsRef:a,previousBaselineRef:l})}class oc extends o.PureComponent{render(){var{hide:t,dot:r,points:n,className:a,top:l,left:c,needClip:i,xAxisId:d,yAxisId:u,width:m,height:h,id:f,baseLine:j,zIndex:p}=this.props;if(t)return null;var x=Dt("recharts-area",a),k=f,{r:P,strokeWidth:g}=vi(r),A=ji(r),v=P*2+g,N=i?"url(#clipPath-".concat(A?"":"dots-").concat(k,")"):void 0;return o.createElement(Qa,{zIndex:p},o.createElement(ks,{className:x},i&&o.createElement("defs",null,o.createElement(fi,{clipPathId:k,xAxisId:d,yAxisId:u}),!A&&o.createElement("clipPath",{id:"clipPath-dots-".concat(k)},o.createElement("rect",{x:c-v/2,y:l-v/2,width:m+v,height:h+v}))),o.createElement(cc,{needClip:i,clipPathId:k,props:this.props})),o.createElement(ka,{points:n,mainColor:Js(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:N}),this.props.isRange&&Array.isArray(j)&&o.createElement(ka,{points:j,mainColor:Js(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:N}))}}var yn={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:Ja.area};function dc(s){var t,r=Ss(s,yn),{activeDot:n,animationBegin:a,animationDuration:l,animationEasing:c,connectNulls:i,dot:d,fill:u,fillOpacity:m,hide:h,isAnimationActive:f,legendType:j,stroke:p,xAxisId:x,yAxisId:k}=r,P=bn(r,Yl),g=mi(),A=hi(),{needClip:v}=pi(x,k),N=Rt(),{points:F,isRange:O,baseLine:S}=(t=is(R=>Kl(R,s.id,N)))!==null&&t!==void 0?t:{},_=xi();if(g!=="horizontal"&&g!=="vertical"||_==null||A!=="AreaChart"&&A!=="ComposedChart")return null;var{height:T,width:L,x:M,y:V}=_;return!F||!F.length?null:o.createElement(oc,Qe({},P,{activeDot:n,animationBegin:a,animationDuration:l,animationEasing:c,baseLine:S,connectNulls:i,dot:d,fill:u,fillOpacity:m,height:T,hide:h,layout:g,isAnimationActive:f==="auto"?!_i.isSsr:f,isRange:O,legendType:j,needClip:v,points:F,stroke:p,width:L,left:M,top:V,xAxisId:x,yAxisId:k}))}var uc=(s,t,r,n,a)=>{var l=r??t;if(Ze(l))return l;var c=s==="horizontal"?a:n,i=c.scale.domain();if(c.type==="number"){var d=Math.max(i[0],i[1]),u=Math.min(i[0],i[1]);return l==="dataMin"?u:l==="dataMax"||d<0?d:Math.max(Math.min(i[0],i[1]),0)}return l==="dataMin"?i[0]:l==="dataMax"?i[1]:i[0]};function mc(s){var{areaSettings:{connectNulls:t,baseValue:r,dataKey:n},stackedData:a,layout:l,chartBaseValue:c,xAxis:i,yAxis:d,displayedData:u,dataStartIndex:m,xAxisTicks:h,yAxisTicks:f,bandSize:j}=s,p=a&&a.length,x=uc(l,c,r,i,d),k=l==="horizontal",P=!1,g=u.map((v,N)=>{var F,O,S;if(p)S=a[m+N];else{var _=_a(v,n);Array.isArray(_)?(S=_,P=!0):S=[x,_]}var T=(F=(O=S)===null||O===void 0?void 0:O[1])!==null&&F!==void 0?F:null,L=T==null||p&&!t&&_a(v,n)==null;return k?{x:Sa({axis:i,ticks:h,bandSize:j,entry:v,index:N}),y:L?null:d.scale(T),value:S,payload:v}:{x:L?null:i.scale(T),y:Sa({axis:d,ticks:f,bandSize:j,entry:v,index:N}),value:S,payload:v}}),A;return p||P?A=g.map(v=>{var N=Array.isArray(v.value)?v.value[0]:null;return k?{x:v.x,y:N!=null&&v.y!=null?d.scale(N):null,payload:v.payload}:{x:N!=null?i.scale(N):null,y:v.y,payload:v.payload}}):A=k?d.scale(x):i.scale(x),{points:g,baseLine:A,isRange:P}}function hc(s){var t=Ss(s,yn),r=Rt();return o.createElement(li,{id:t.id,type:"area"},n=>o.createElement(o.Fragment,null,o.createElement(ci,{legendPayload:ec(t)}),o.createElement(sc,{dataKey:t.dataKey,data:t.data,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,unit:t.unit,tooltipType:t.tooltipType,id:n}),o.createElement(oi,{type:"area",id:n,data:t.data,dataKey:t.dataKey,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,stackId:di(t.stackId),hide:t.hide,barSize:void 0,baseValue:t.baseValue,isPanorama:r,connectNulls:t.connectNulls}),o.createElement(dc,Qe({},t,{id:n}))))}var Ns=o.memo(hc,ii);Ns.displayName="Area";var pc=["axis"],xc=o.forwardRef((s,t)=>o.createElement(Si,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:pc,tooltipPayloadSearcher:Di,categoricalChartProps:s,ref:t}));const za={WARNING:"warning",ERROR:"error"},ye={DATABASE:"database",NETWORK:"network",AUTH:"auth",VALIDATION:"validation",STORAGE:"storage",SYNC:"sync",GENERAL:"general"};function vc(s){const t=s?.message?.toLowerCase()||"",r=s?.code?.toLowerCase()||"";return t.includes("fetch")||t.includes("network")||t.includes("offline")?ye.NETWORK:t.includes("auth")||t.includes("unauthorized")||r.includes("auth")?ye.AUTH:t.includes("storage")||t.includes("bucket")||t.includes("upload")?ye.STORAGE:t.includes("validation")||t.includes("invalid")||t.includes("required")?ye.VALIDATION:t.includes("sync")||t.includes("conflict")?ye.SYNC:s?.code||t.includes("database")||t.includes("supabase")?ye.DATABASE:ye.GENERAL}function jc(s,t,r){return r?.userMessage?r.userMessage:t===ye.NETWORK?"Network connection issue. Your changes will sync when back online.":t===ye.AUTH?"Session expired. Please sign in again.":t===ye.STORAGE?"Failed to upload file. Please try again.":t===ye.VALIDATION?s?.message||"Please check your input and try again.":t===ye.SYNC?"Sync conflict detected. Please refresh and try again.":r?.operation?`Failed to ${r.operation.replace(/([A-Z])/g," $1").toLowerCase().trim()}. Please try again.`:"Something went wrong. Please try again."}function fc(s,t={}){const{operation:r="unknown",category:n=vc(s),severity:a=za.ERROR,showToast:l,userMessage:c,companyId:i,projectId:d,userId:u,silent:m=!1,rethrow:h=!1}=t;if(Ei.error(n,{message:s?.message||"Unknown error",code:s?.code,severity:a,operation:r,company_id:i,project_id:d,user_id:u,extra:{stack:s?.stack,name:s?.name}}),!m&&l){const f=jc(s,n,{operation:r,userMessage:c}),j=a===za.WARNING?"warning":"error";l(f,j)}if(h)throw s;return null}async function fe(s,t={}){const{fallback:r=null,context:n={},showToast:a,silent:l=!0}=t;try{return await s()}catch(c){return fc(c,{...n,showToast:a,silent:l}),r}}const xs={budget:{healthy:.6,warning:.75,critical:.85},schedule:{healthy:.05,warning:.15,critical:.25},corExposure:{healthy:.05,warning:.15,critical:.25},activity:{healthy:1,warning:3,critical:5},safety:{healthy:0,warning:1,critical:2}},gc={budget:.3,schedule:.25,corExposure:.2,activity:.15,safety:.1};function Rs(s,t){if(s<=t.healthy)return 0;if(s>=t.critical)return 100;const r=t.critical-t.healthy;return(s-t.healthy)/r*100}function Ps(s){return s<=25?"healthy":s<=60?"warning":"critical"}function bc(s,t,r=xs.budget){if(!t||t<=0)return{score:0,status:"healthy",ratio:0,label:"No revenue yet"};const n=s/t,a=Rs(n,r),l=Ps(a);let c;return n<r.healthy?c=`Costs at ${(n*100).toFixed(0)}% of revenue`:n<r.warning?c=`Costs at ${(n*100).toFixed(0)}% - monitor closely`:c=`Costs at ${(n*100).toFixed(0)}% - review immediately`,{score:a,status:l,ratio:n,label:c}}function yc(s,t,r=xs.schedule){if(!t||t<=0)return{score:0,status:"healthy",variance:0,label:"No schedule baseline"};const n=(t-s)/t,a=Math.max(0,n),l=Rs(a,r),c=Ps(l);let i;return n<=0?i=s>=100?"Complete":"On or ahead of schedule":n<r.warning?i=`${(n*100).toFixed(0)}% behind schedule`:i=`${(n*100).toFixed(0)}% behind - needs attention`,{score:l,status:c,variance:n,label:i}}function Nc(s,t,r=xs.corExposure){if(!t||t<=0)return{score:0,status:"healthy",exposure:0,label:"No contract value"};const n=s/t,a=Rs(n,r),l=Ps(a);let c;return n<r.healthy?c=s>0?`$${bt(s)} pending`:"No pending CORs":n<r.warning?c=`$${bt(s)} pending (${(n*100).toFixed(0)}% of contract)`:c=`High exposure: $${bt(s)} (${(n*100).toFixed(0)}%)`,{score:a,status:l,exposure:n,label:c}}function wc(s,t=xs.activity){if(!s)return{score:100,status:"critical",daysSince:null,label:"No reports filed"};const r=new Date(s),a=Math.floor((new Date-r)/(1e3*60*60*24)),l=Rs(a,t),c=Ps(l);let i;return a===0?i="Report filed today":a===1?i="Report filed yesterday":a<=t.warning?i=`Last report ${a} days ago`:i=`No report in ${a} days - may be stalled`,{score:l,status:c,daysSince:a,label:i}}function Cc(s,t=xs.safety){const r=s||0,n=Rs(r,t),a=Ps(n);let l;return r===0?l="No incidents":r===1?l="1 incident in last 30 days":l=`${r} incidents - safety review needed`,{score:n,status:a,count:r,label:l}}function kc(s,t={}){const r={...xs,...t.thresholds},n={...gc,...t.weights},a=bc(s.totalCosts,s.earnedRevenue,r.budget),l=yc(s.actualProgress,s.expectedProgress,r.schedule),c=Nc(s.pendingCORValue,s.contractValue,r.corExposure),i=wc(s.lastReportDate,r.activity),d=Cc(s.recentInjuryCount,r.safety),u=Math.round(a.score*n.budget+l.score*n.schedule+c.score*n.corExposure+i.score*n.activity+d.score*n.safety);let m;u<=25?m="healthy":u<=60?m="warning":m="critical";let h;return m==="healthy"?h="Project is on track":m==="warning"?h="Some factors need attention":h="Immediate review recommended",{score:u,status:m,label:h,factors:{budget:{...a,weight:n.budget},schedule:{...l,weight:n.schedule},corExposure:{...c,weight:n.corExposure},activity:{...i,weight:n.activity},safety:{...d,weight:n.safety}}}}function _c(s,t){const r=[],{factors:n}=s;n.budget.status==="critical"&&r.push({type:"critical",title:"Budget Alert",description:n.budget.label,action:"Review costs immediately",actionTarget:"financials",projectId:t.id}),n.activity.status==="critical"&&r.push({type:"critical",title:"Activity Alert",description:n.activity.label,action:"Check project status",actionTarget:"overview",projectId:t.id}),n.safety.status==="critical"&&r.push({type:"critical",title:"Safety Alert",description:n.safety.label,action:"Review safety reports",actionTarget:"reports",projectId:t.id}),n.budget.status==="warning"&&r.push({type:"warning",title:"Budget Watch",description:n.budget.label,action:"Monitor costs",actionTarget:"financials",projectId:t.id}),(n.schedule.status==="critical"||n.schedule.status==="warning")&&r.push({type:n.schedule.status==="critical"?"critical":"warning",title:"Schedule Alert",description:n.schedule.label,action:"Review progress",actionTarget:"overview",projectId:t.id}),(n.corExposure.status==="warning"||n.corExposure.status==="critical")&&r.push({type:n.corExposure.status==="critical"?"critical":"warning",title:"COR Exposure",description:n.corExposure.label,action:"Review pending CORs",actionTarget:"cors",projectId:t.id}),n.activity.status==="warning"&&r.push({type:"info",title:"Activity Notice",description:n.activity.label,action:"File daily report",actionTarget:"reports",projectId:t.id});const a={critical:0,warning:1,info:2};return r.sort((l,c)=>a[l.type]-a[c.type]),r}function Sc(s){const{actualProgress:t,totalCosts:r,earnedRevenue:n,contractValue:a}=s;if(!t||t<=0)return{estimatedCompletionCost:null,estimatedFinalMargin:null,estimatedCompletionDate:null};const l=r/t,c=Math.round(l*100),i=a>0?(a-c)/a*100:0;let d=null;if(s.startDate&&t>0&&t<100){const u=new Date(s.startDate),m=new Date,h=Math.max(1,(m-u)/(1e3*60*60*24)),f=t/h,p=(100-t)/f;d=new Date(m.getTime()+p*24*60*60*1e3)}return{estimatedCompletionCost:c,estimatedFinalMargin:i,estimatedCompletionDate:d,costPerPercent:l}}function bt(s){return s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toFixed(0)}function Dc(s){const t=o.useMemo(()=>{const l=s.reduce((j,p)=>j+(p.contract_value||0),0),c=s.reduce((j,p)=>j+(p.changeOrderValue||0),0),i=l+c,d=s.reduce((j,p)=>j+(p.billable||0),0),u=i-d,m=i>0?Math.round(d/i*100):0,h=s.reduce((j,p)=>j+(p.corPendingValue||0),0),f=s.reduce((j,p)=>j+(p.corPendingCount||0),0);return{totalOriginalContract:l,totalChangeOrders:c,totalPortfolioValue:i,totalEarned:d,totalRemaining:u,weightedCompletion:m,totalPendingCORValue:h,totalPendingCORCount:f}},[s]),r=o.useMemo(()=>{let l=0,c=0,i=0,d=0,u=0;for(const m of s){const h=m.revisedContractValue||m.contract_value;m.progress>=100&&l++,m.progress<100&&m.billable<=h*(m.progress/100)*1.1&&c++,m.billable>h*.9&&m.progress<90&&i++,m.billable>h&&d++,(m.changeOrderValue||0)>0&&u++}return{projectsComplete:l,projectsOnTrack:c,projectsAtRisk:i,projectsOverBudget:d,projectsWithChangeOrders:u}},[s]),n=o.useMemo(()=>{let l=0,c=0,i=0,d=0,u=0,m=0;for(const h of s)h.hasScheduleData&&(h.scheduleStatus==="ahead"?l++:h.scheduleStatus==="behind"?i++:c++),h.hasLaborData&&(h.laborStatus==="over"?d++:h.laborStatus==="under"?u++:m++);return{scheduleAhead:l,scheduleOnTrack:c,scheduleBehind:i,laborOver:d,laborUnder:u,laborOnTrack:m,hasAnyScheduleData:l+c+i>0,hasAnyLaborData:d+u+m>0}},[s]),a=o.useMemo(()=>{const l=s.map(i=>{const d={id:i.id,name:i.name,totalCosts:i.totalCosts||0,earnedRevenue:i.billable||0,actualProgress:i.progress||0,expectedProgress:i.expectedProgress||i.progress,pendingCORValue:i.corPendingValue||0,contractValue:i.revisedContractValue||i.contract_value||0,lastReportDate:i.lastDailyReport,recentInjuryCount:i.recentInjuryCount||0,startDate:i.start_date},u=kc(d),m=_c(u,{...d,name:i.name}),h=Sc(d),f=m.map(j=>({...j,projectName:i.name,projectId:i.id}));return{projectId:i.id,projectName:i.name,riskScore:u.score,riskStatus:u.status,riskLabel:u.label,factors:u.factors,alerts:f,projections:h}}),c=l.flatMap(i=>i.alerts).sort((i,d)=>{const u={critical:0,warning:1,info:2};return u[i.type]-u[d.type]});return{projectRisks:l,allAlerts:c,criticalCount:c.filter(i=>i.type==="critical").length,warningCount:c.filter(i=>i.type==="warning").length}},[s]);return{portfolioMetrics:t,projectHealth:r,scheduleMetrics:n,riskAnalysis:a}}function Ec({selectedProject:s,areas:t,company:r,onShowToast:n,loadAreas:a,setSelectedProject:l}){const[c,i]=o.useState(!1),[d,u]=o.useState(null),[m,h]=o.useState(!1);return{editMode:c,editData:d,saving:m,handleEditClick:()=>{u({name:s.name,job_number:s.job_number||"",address:s.address||"",general_contractor:s.general_contractor||"",client_contact:s.client_contact||"",client_phone:s.client_phone||"",contract_value:s.contract_value,work_type:s.work_type||"demolition",job_type:s.job_type||"standard",pin:s.pin||"",default_dump_site_id:s.default_dump_site_id||"",areas:t.map(v=>({id:v.id,name:v.name,weight:v.weight,isNew:!1}))}),i(!0)},handleCancelEdit:()=>{i(!1),u(null)},handleEditChange:(v,N)=>{u(F=>({...F,[v]:N}))},handleAreaEditChange:(v,N,F)=>{u(O=>({...O,areas:O.areas.map((S,_)=>_===v?{...S,[N]:F}:S)}))},handleAddArea:()=>{u(v=>({...v,areas:[...v.areas,{id:null,name:"",weight:"",isNew:!0}]}))},handleRemoveArea:v=>{d.areas.length>1&&u(N=>({...N,areas:N.areas.filter((F,O)=>O!==v)}))},handleSaveEdit:async()=>{if(!d.name.trim()){n("Please enter a project name","error");return}const v=parseFloat(d.contract_value);if(!v||v<=0){n("Please enter a valid contract value","error");return}if(d.pin&&d.pin.length!==4){n("PIN must be 4 digits","error");return}if(d.pin&&d.pin!==s.pin&&!await q.isPinAvailable(d.pin,s.id)){n("This PIN is already in use","error");return}const N=d.areas.filter(O=>O.name.trim()&&parseFloat(O.weight)>0);if(N.length===0){n("Please add at least one area","error");return}if(N.reduce((O,S)=>O+parseFloat(S.weight),0)!==100){n("Area weights must total 100%","error");return}h(!0);try{await q.updateProject(s.id,{name:d.name.trim(),job_number:d.job_number?.trim()||null,address:d.address?.trim()||null,general_contractor:d.general_contractor?.trim()||null,client_contact:d.client_contact?.trim()||null,client_phone:d.client_phone?.trim()||null,contract_value:v,work_type:d.work_type||"demolition",job_type:d.job_type||"standard",pin:d.pin||null,default_dump_site_id:d.default_dump_site_id||null},r?.id);const O=t.map(T=>T.id),S=d.areas.filter(T=>T.id).map(T=>T.id);for(const T of O)S.includes(T)||await q.deleteArea(T);for(let T=0;T<N.length;T++){const L=N[T];L.id?await q.updateArea(L.id,{name:L.name.trim(),weight:parseFloat(L.weight),sort_order:T}):await q.createArea({project_id:s.id,name:L.name.trim(),weight:parseFloat(L.weight),status:"not_started",sort_order:T})}const _=await q.getProject(s.id);l(_),await a(s.id),i(!1),u(null),n("Project updated!","success")}catch(O){console.error("Error saving project:",O?.message||O),n(O?.message||"Error saving changes","error")}finally{h(!1)}},handleDeleteProject:async v=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await q.deleteProject(s.id),l(null),n("Project deleted","success"),v()}catch(N){console.error("Error deleting project:",N),n("Error deleting project","error")}}}}const at=()=>oe(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),ie=210,B=14,Se=ie-B*2,ds=s=>s?new Date(s+(s.includes("T")?"":"T12:00:00")).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"—",Fe=(s,t,r=30)=>t+r>s.internal.pageSize.height-20?(s.addPage(),20):t;async function Rc(s,t){const n=(await at()).default,a=new n;let l=20;a.setFontSize(18),a.setFont(void 0,"bold"),a.text("Daily Reports",ie/2,l,{align:"center"}),l+=8,a.setFontSize(11),a.setFont(void 0,"normal"),a.text(`Project: ${t.name}`,ie/2,l,{align:"center"}),l+=6,a.text(`${s.length} report${s.length!==1?"s":""}`,ie/2,l,{align:"center"}),l+=12,s.forEach((i,d)=>{l=Fe(a,l,60),a.setDrawColor(200,200,200),a.setFillColor(245,247,250),a.roundedRect(B,l-2,Se,10,2,2,"F"),a.setFontSize(11),a.setFont(void 0,"bold"),a.setTextColor(30,30,30),a.text(`${ds(i.report_date)}`,B+4,l+5);const u=i.status==="submitted"?"Submitted":"Draft";a.setFontSize(9),a.setFont(void 0,"normal"),a.text(u,ie-B-4,l+5,{align:"right"}),l+=14,a.setTextColor(0,0,0),a.setFontSize(9);const m=[`Crew: ${i.crew_count||0}`,`Tasks: ${i.tasks_completed||0}/${i.tasks_total||0}`,`T&M Tickets: ${i.tm_tickets_count||0}`,`Photos: ${i.photos_count||0}`];if(a.text(m.join("    |    "),B+4,l),l+=7,i.crew_list?.length>0){a.setFont(void 0,"bold"),a.text("Crew:",B+4,l),a.setFont(void 0,"normal");const h=i.crew_list.map(j=>`${j.name} (${j.role||"Laborer"})`).join(", "),f=a.splitTextToSize(h,Se-8);l+=4,a.text(f,B+4,l),l+=f.length*4+2}if(i.field_notes){l=Fe(a,l,15),a.setFont(void 0,"bold"),a.text("Field Notes:",B+4,l),a.setFont(void 0,"normal"),l+=4;const h=a.splitTextToSize(i.field_notes,Se-8);a.text(h,B+4,l),l+=h.length*4+2}if(i.issues){l=Fe(a,l,15),a.setFont(void 0,"bold"),a.text("Issues:",B+4,l),a.setFont(void 0,"normal"),l+=4;const h=a.splitTextToSize(i.issues,Se-8);a.text(h,B+4,l),l+=h.length*4+2}l+=8,d<s.length-1&&(a.setDrawColor(220,220,220),a.line(B,l,ie-B,l),l+=6)});const c=`${t.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;a.save(c)}async function Pc(s,t){const n=(await at()).default,a=new n;let l=20;a.setFontSize(18),a.setFont(void 0,"bold"),a.text("Incident / Injury Reports",ie/2,l,{align:"center"}),l+=8,a.setFontSize(11),a.setFont(void 0,"normal"),a.text(`Project: ${t.name}`,ie/2,l,{align:"center"}),l+=6,a.text(`${s.length} report${s.length!==1?"s":""}`,ie/2,l,{align:"center"}),l+=12,s.forEach((i,d)=>{l=Fe(a,l,50);const m={minor:[34,197,94],serious:[245,158,11],critical:[239,68,68],near_miss:[59,130,246]}[i.injury_type]||[128,128,128];a.setFillColor(...m),a.roundedRect(B,l-2,3,14,1,1,"F"),a.setFontSize(11),a.setFont(void 0,"bold"),a.setTextColor(30,30,30),a.text(`${ds(i.incident_date)}`,B+8,l+4),a.setFontSize(9);const h=(i.injury_type||"").replace("_"," ").toUpperCase();if(a.text(h,B+8,l+10),a.setFont(void 0,"normal"),a.text(i.status==="open"?"OPEN":"CLOSED",ie-B-4,l+4,{align:"right"}),l+=16,a.setTextColor(0,0,0),i.description){a.setFontSize(9),a.setFont(void 0,"bold"),a.text("Description:",B+4,l),a.setFont(void 0,"normal"),l+=4;const f=a.splitTextToSize(i.description,Se-8);a.text(f,B+4,l),l+=f.length*4+2}i.location&&(a.setFont(void 0,"bold"),a.text("Location: ",B+4,l),a.setFont(void 0,"normal"),a.text(i.location,B+30,l),l+=6),l+=6,d<s.length-1&&(a.setDrawColor(220,220,220),a.line(B,l,ie-B,l),l+=6)});const c=`${t.name}_Incident_Reports_${new Date().toISOString().split("T")[0]}.pdf`;a.save(c)}async function Tc(s,t){const n=(await at()).default,a=new n;let l=20;a.setFontSize(18),a.setFont(void 0,"bold"),a.text("Crew Check-In History",ie/2,l,{align:"center"}),l+=8,a.setFontSize(11),a.setFont(void 0,"normal"),a.text(`Project: ${t.name}`,ie/2,l,{align:"center"}),l+=6,a.text(`${s.length} check-in${s.length!==1?"s":""}`,ie/2,l,{align:"center"}),l+=12,s.forEach((i,d)=>{l=Fe(a,l,30);const u=i.workers||[];a.setFillColor(245,247,250),a.roundedRect(B,l-2,Se,9,2,2,"F"),a.setFontSize(10),a.setFont(void 0,"bold"),a.setTextColor(30,30,30),a.text(ds(i.check_in_date),B+4,l+4),a.setFont(void 0,"normal"),a.text(`${u.length} workers`,ie-B-4,l+4,{align:"right"}),l+=12,a.setTextColor(0,0,0),a.setFontSize(9),u.length>0&&(a.setFont(void 0,"bold"),a.text("Name",B+4,l),a.text("Role",110,l),l+=5,a.setFont(void 0,"normal"),u.forEach(m=>{l=Fe(a,l,6),a.text(m.name||"—",B+4,l),a.text(m.role||"Laborer",110,l),l+=4.5})),l+=6,d<s.length-1&&(a.setDrawColor(220,220,220),a.line(B,l,ie-B,l),l+=5)});const c=`${t.name}_Crew_Checkins_${new Date().toISOString().split("T")[0]}.pdf`;a.save(c)}async function Fc({dailyReports:s=[],incidentReports:t=[],crewCheckins:r=[],project:n}){const l=(await at()).default,c=new l;let i=20;c.setFontSize(22),c.setFont(void 0,"bold"),c.text("Field Documents Report",ie/2,i,{align:"center"}),i+=10,c.setFontSize(13),c.setFont(void 0,"normal"),c.text(`Project: ${n.name}`,ie/2,i,{align:"center"}),i+=8,c.setFontSize(10),c.text(`Generated: ${new Date().toLocaleDateString()}`,ie/2,i,{align:"center"}),i+=16,c.setFontSize(11),c.setFont(void 0,"bold"),c.text("Document Summary",B,i),i+=8,c.setFontSize(10),c.setFont(void 0,"normal"),[["Daily Reports",`${s.length}`],["Incident Reports",`${t.length}`],["Crew Check-Ins",`${r.length}`]].forEach(([m,h])=>{c.text(m,B+4,i),c.text(h,100,i),i+=6}),s.length>0&&(c.addPage(),i=20,c.setFontSize(16),c.setFont(void 0,"bold"),c.text("Daily Reports",B,i),i+=10,s.forEach((m,h)=>{if(i=Fe(c,i,40),c.setFontSize(10),c.setFont(void 0,"bold"),c.setTextColor(30,30,30),c.text(ds(m.report_date),B+2,i),c.setFont(void 0,"normal"),c.setFontSize(8),c.text(`Crew: ${m.crew_count||0} | Tasks: ${m.tasks_completed||0}/${m.tasks_total||0} | T&M: ${m.tm_tickets_count||0}`,B+60,i),i+=6,c.setTextColor(0,0,0),c.setFontSize(9),m.field_notes){const f=c.splitTextToSize(m.field_notes,Se-4);c.text(f,B+2,i),i+=f.length*4+2}if(m.issues){c.setFont(void 0,"bold"),c.text("Issues: ",B+2,i),c.setFont(void 0,"normal");const f=c.splitTextToSize(m.issues,Se-20);c.text(f,B+20,i),i+=f.length*4+2}i+=4,h<s.length-1&&(c.setDrawColor(220,220,220),c.line(B,i,ie-B,i),i+=4)})),t.length>0&&(c.addPage(),i=20,c.setFontSize(16),c.setFont(void 0,"bold"),c.text("Incident / Injury Reports",B,i),i+=10,t.forEach((m,h)=>{i=Fe(c,i,35),c.setFontSize(10),c.setFont(void 0,"bold"),c.setTextColor(30,30,30),c.text(ds(m.incident_date),B+2,i),c.setFontSize(8),c.setFont(void 0,"normal");const f=(m.injury_type||"").replace("_"," ").toUpperCase();if(c.text(`${f} — ${m.status?.toUpperCase()||""}`,B+60,i),i+=6,c.setTextColor(0,0,0),c.setFontSize(9),m.description){const j=c.splitTextToSize(m.description,Se-4);c.text(j,B+2,i),i+=j.length*4+2}m.location&&(c.text(`Location: ${m.location}`,B+2,i),i+=5),i+=4,h<t.length-1&&(c.setDrawColor(220,220,220),c.line(B,i,ie-B,i),i+=4)})),r.length>0&&(c.addPage(),i=20,c.setFontSize(16),c.setFont(void 0,"bold"),c.text("Crew Check-In History",B,i),i+=10,r.forEach((m,h)=>{i=Fe(c,i,20);const f=m.workers||[];if(c.setFontSize(10),c.setFont(void 0,"bold"),c.setTextColor(30,30,30),c.text(ds(m.check_in_date),B+2,i),c.setFont(void 0,"normal"),c.setFontSize(8),c.text(`${f.length} workers`,B+60,i),i+=6,c.setTextColor(0,0,0),c.setFontSize(8),f.length>0){const j=f.map(x=>`${x.name} (${x.role||"Laborer"})`).join(", "),p=c.splitTextToSize(j,Se-4);c.text(p,B+2,i),i+=p.length*3.5+3}h<r.length-1&&(c.setDrawColor(230,230,230),c.line(B,i,ie-B,i),i+=3)}));const u=`${n.name}_Field_Documents_${new Date().toISOString().split("T")[0]}.pdf`;c.save(u)}function nt(s,t,r="text/csv"){const n=new Blob([s],{type:r}),a=URL.createObjectURL(n),l=document.createElement("a");l.href=a,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)}function qa(s){if(s==null)return"";const t=String(s);return t.includes(",")||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t}function It(s,t){const r=s.map(a=>qa(a.label)).join(","),n=t.map(a=>s.map(l=>qa(a[l.key])).join(","));return[r,...n].join(`
`)}function Ac(s,t){const r=[{key:"category",label:"Category"},{key:"description",label:"Description"},{key:"amount",label:"Amount"},{key:"date",label:"Date"},{key:"type",label:"Type"}],n=[];n.push({category:"Revenue",description:"Original Contract Value",amount:s.contract_value||0,date:s.start_date||"",type:"Contract"}),t?.earnedRevenue&&n.push({category:"Revenue",description:"Earned Revenue (Progress)",amount:t.earnedRevenue,date:new Date().toISOString().split("T")[0],type:"Earned"}),t?.approvedCORs&&t.approvedCORs.forEach(d=>{n.push({category:"Revenue",description:`COR: ${d.cor_number} - ${d.title}`,amount:(d.cor_total||0)/100,date:d.approved_at?.split("T")[0]||"",type:"Change Order"})}),t?.laborByDate&&t.laborByDate.forEach(d=>{n.push({category:"Cost",description:"Labor",amount:d.cost,date:d.date,type:"Labor"})}),t?.haulOffByDate&&t.haulOffByDate.forEach(d=>{n.push({category:"Cost",description:"Disposal/Haul-off",amount:d.cost,date:d.date,type:"Disposal"})}),t?.customCosts&&t.customCosts.forEach(d=>{n.push({category:"Cost",description:d.description||d.category||"Other",amount:parseFloat(d.amount)||0,date:d.cost_date||"",type:d.category||"Other"})});const a=n.filter(d=>d.category==="Revenue").reduce((d,u)=>d+(parseFloat(u.amount)||0),0),l=n.filter(d=>d.category==="Cost").reduce((d,u)=>d+(parseFloat(u.amount)||0),0);n.push({category:"",description:"",amount:"",date:"",type:""}),n.push({category:"Summary",description:"Total Revenue",amount:a,date:"",type:""}),n.push({category:"Summary",description:"Total Costs",amount:l,date:"",type:""}),n.push({category:"Summary",description:"Gross Profit",amount:a-l,date:"",type:""}),n.push({category:"Summary",description:"Margin %",amount:a>0?((a-l)/a*100).toFixed(1)+"%":"N/A",date:"",type:""});const c=It(r,n),i=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_Financials_${new Date().toISOString().split("T")[0]}.csv`;nt(c,i)}function Yo(s,t){const r=[],n=[{key:"section",label:"Section"},{key:"description",label:"Description"},{key:"quantity",label:"Quantity"},{key:"unit",label:"Unit"},{key:"rate",label:"Rate"},{key:"total",label:"Total"}];r.push({section:"COR Info",description:`${s.cor_number} - ${s.title}`,quantity:"",unit:"",rate:"",total:""}),r.push({section:"Status",description:s.status,quantity:"",unit:"",rate:"",total:""}),r.push({section:"Period",description:`${s.period_start||""} to ${s.period_end||""}`,quantity:"",unit:"",rate:"",total:""}),r.push({section:"",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor?.length>0&&(r.push({section:"LABOR",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor.forEach(c=>{const i=parseFloat(c.regular_hours)||0,d=parseFloat(c.overtime_hours)||0;r.push({section:"",description:c.description||c.classification,quantity:i+d,unit:"hours",rate:(parseInt(c.regular_rate)||0)/100,total:(parseInt(c.total)||0)/100})})),s.change_order_materials?.length>0&&(r.push({section:"MATERIALS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_materials.forEach(c=>{r.push({section:"",description:c.description,quantity:parseFloat(c.quantity)||0,unit:c.unit||"each",rate:(parseInt(c.unit_cost)||0)/100,total:(parseInt(c.total)||0)/100})})),s.change_order_equipment?.length>0&&(r.push({section:"EQUIPMENT",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_equipment.forEach(c=>{r.push({section:"",description:c.description,quantity:parseFloat(c.quantity)||0,unit:c.unit||"day",rate:(parseInt(c.unit_cost)||0)/100,total:(parseInt(c.total)||0)/100})})),s.change_order_subcontractors?.length>0&&(r.push({section:"SUBCONTRACTORS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_subcontractors.forEach(c=>{r.push({section:"",description:c.description,quantity:parseFloat(c.quantity)||0,unit:c.unit||"lump sum",rate:(parseInt(c.unit_cost)||0)/100,total:(parseInt(c.total)||0)/100})}));const a=It(n,r),l=`COR_${s.cor_number||s.id}_${new Date().toISOString().split("T")[0]}.csv`;nt(a,l)}function Jo(s,t){const r=[{key:"date",label:"Date"},{key:"status",label:"Status"},{key:"workers",label:"Worker Count"},{key:"totalHours",label:"Total Hours"},{key:"otHours",label:"OT Hours"},{key:"materialsCost",label:"Materials Cost"},{key:"corNumber",label:"COR #"},{key:"notes",label:"Notes"}],n=s.map(c=>{const i=c.t_and_m_workers||[],d=c.t_and_m_items||[],u=i.reduce((f,j)=>f+(parseFloat(j.hours)||0),0),m=i.reduce((f,j)=>f+(parseFloat(j.overtime_hours)||0),0),h=d.reduce((f,j)=>f+(parseFloat(j.quantity)||0)*(j.materials_equipment?.cost_per_unit||0),0);return{date:c.work_date,status:c.status,workers:i.length,totalHours:(u+m).toFixed(1),otHours:m.toFixed(1),materialsCost:h.toFixed(2),corNumber:c.assigned_cor_id?"Linked":"",notes:c.notes||""}}),a=It(r,n),l=`${t.name.replace(/[^a-zA-Z0-9]/g,"_")}_TM_Tickets_${new Date().toISOString().split("T")[0]}.csv`;nt(a,l)}function Mc(s,t){const r=[],n=new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"});r.push("!TRNS	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),r.push("!SPL	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),r.push("!ENDTRNS");const a=s.contract_value||0;r.push(`TRNS	GENERAL JOURNAL	${n}	Accounts Receivable	${s.name}	${a.toFixed(2)}	FieldSync - Contract Revenue`),r.push(`SPL	GENERAL JOURNAL	${n}	Construction Revenue	${s.name}	${(-a).toFixed(2)}	Contract: ${s.name}`),r.push("ENDTRNS");const l=t?.totalLaborCost||0;l>0&&(r.push(`TRNS	GENERAL JOURNAL	${n}	Direct Labor	${s.name}	${l.toFixed(2)}	Labor costs - ${s.name}`),r.push(`SPL	GENERAL JOURNAL	${n}	Accounts Payable	${s.name}	${(-l).toFixed(2)}	Labor costs`),r.push("ENDTRNS"));const c=t?.totalDisposalCost||0;c>0&&(r.push(`TRNS	GENERAL JOURNAL	${n}	Disposal Expense	${s.name}	${c.toFixed(2)}	Disposal costs - ${s.name}`),r.push(`SPL	GENERAL JOURNAL	${n}	Accounts Payable	${s.name}	${(-c).toFixed(2)}	Disposal costs`),r.push("ENDTRNS"));const i=r.join(`
`),d=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_QB_${new Date().toISOString().split("T")[0]}.iif`;nt(i,d,"application/x-iif")}function Oc({isOpen:s,onClose:t,companyId:r,onSelectProject:n,onSelectTicket:a,onSelectCOR:l,onShowToast:c}){const[i,d]=o.useState(""),[u,m]=o.useState({projects:[],tickets:[],cors:[],workers:[]}),[h,f]=o.useState(!1),[j,p]=o.useState(0),x=o.useRef(null),k=o.useRef(null),P=o.useRef(null);o.useEffect(()=>()=>{k.current&&clearTimeout(k.current),P.current&&clearTimeout(P.current)},[]),o.useEffect(()=>{s&&(d(""),m({projects:[],tickets:[],cors:[],workers:[]}),p(0),P.current=setTimeout(()=>x.current?.focus(),50))},[s]);const g=o.useCallback(async _=>{if(!_.trim()||_.length<2){m({projects:[],tickets:[],cors:[],workers:[]});return}f(!0);try{const T=await q.universalSearch(r,_.trim());m(T),p(0)}catch(T){console.error("Search error:",T),c?.("Search failed","error")}finally{f(!1)}},[r,c]),A=_=>{const T=_.target.value;d(T),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{g(T)},200)},N=(()=>{const _=[];return u.projects.forEach(T=>_.push({type:"project",data:T})),u.tickets.forEach(T=>_.push({type:"ticket",data:T})),u.cors.forEach(T=>_.push({type:"cor",data:T})),u.workers.forEach(T=>_.push({type:"worker",data:T})),_})(),F=N.length>0,O=_=>{_.key==="Escape"?t():_.key==="ArrowDown"?(_.preventDefault(),p(T=>Math.min(T+1,N.length-1))):_.key==="ArrowUp"?(_.preventDefault(),p(T=>Math.max(T-1,0))):_.key==="Enter"&&F&&(_.preventDefault(),S(N[j]))},S=_=>{if(_){switch(_.type){case"project":n?.(_.data);break;case"ticket":a?.(_.data);break;case"cor":l?.(_.data);break;case"worker":_.data.lastProject&&n?.(_.data.lastProject);break}t()}};return s?e.jsx("div",{className:"universal-search-overlay",onClick:t,children:e.jsxs("div",{className:"universal-search-modal",onClick:_=>_.stopPropagation(),children:[e.jsxs("div",{className:"universal-search-input-wrapper",children:[e.jsx(cn,{size:20,className:"universal-search-icon"}),e.jsx("input",{ref:x,type:"text",value:i,onChange:A,onKeyDown:O,placeholder:"Search projects, tickets, CORs, workers...",className:"universal-search-input",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),i&&e.jsx("button",{className:"universal-search-clear",onClick:()=>d(""),children:e.jsx(ms,{size:16})}),e.jsx("div",{className:"universal-search-shortcut",children:e.jsx("span",{children:"esc"})})]}),e.jsx("div",{className:"universal-search-results",children:h?e.jsxs("div",{className:"universal-search-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Searching..."})]}):i.trim()?F?e.jsxs(e.Fragment,{children:[u.projects.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(wt,{size:14}),e.jsx("span",{children:"Projects"})]}),u.projects.map((_,T)=>{const L=T;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>S({type:"project",data:_}),onMouseEnter:()=>p(L),children:[e.jsx(wt,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:_.name}),_.job_number&&e.jsxs("span",{className:"universal-search-item-meta",children:["#",_.job_number]})]}),e.jsx(qe,{size:16,className:"universal-search-item-arrow"})]},_.id)})]}),u.tickets.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(os,{size:14}),e.jsx("span",{children:"T&M Tickets"})]}),u.tickets.map((_,T)=>{const L=u.projects.length+T;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>S({type:"ticket",data:_}),onMouseEnter:()=>p(L),children:[e.jsx(os,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[_.description?.substring(0,50)||"T&M Ticket",_.description?.length>50&&"..."]}),e.jsxs("span",{className:"universal-search-item-meta",children:[_.projectName," • ",_.work_date]})]}),e.jsx("span",{className:`universal-search-item-badge ${_.status}`,children:_.status})]},_.id)})]}),u.cors.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(xe,{size:14}),e.jsx("span",{children:"Change Orders"})]}),u.cors.map((_,T)=>{const L=u.projects.length+u.tickets.length+T;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>S({type:"cor",data:_}),onMouseEnter:()=>p(L),children:[e.jsx(xe,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[_.cor_number?`COR #${_.cor_number}: `:"",_.title]}),e.jsx("span",{className:"universal-search-item-meta",children:_.projectName})]}),e.jsx("span",{className:`universal-search-item-badge ${_.status}`,children:_.status})]},_.id)})]}),u.workers.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(De,{size:14}),e.jsx("span",{children:"Workers"})]}),u.workers.map((_,T)=>{const L=u.projects.length+u.tickets.length+u.cors.length+T;return e.jsxs("button",{className:`universal-search-item ${j===L?"selected":""}`,onClick:()=>S({type:"worker",data:_}),onMouseEnter:()=>p(L),children:[e.jsx(De,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:_.name}),e.jsxs("span",{className:"universal-search-item-meta",children:[_.role," • ",_.projectName]})]}),e.jsx(qe,{size:16,className:"universal-search-item-arrow"})]},`${_.name}-${T}`)})]})]}):e.jsx("div",{className:"universal-search-no-results",children:e.jsxs("span",{children:['No results for "',i,'"']})}):e.jsxs("div",{className:"universal-search-empty",children:[e.jsxs("div",{className:"universal-search-tip",children:[e.jsx(Vi,{size:14}),e.jsx("span",{children:"Type to search across all data"})]}),e.jsxs("div",{className:"universal-search-hints",children:[e.jsx("span",{children:"Projects"}),e.jsx("span",{children:"T&M Tickets"}),e.jsx("span",{children:"Change Orders"}),e.jsx("span",{children:"Workers"})]})]})}),e.jsxs("div",{className:"universal-search-footer",children:[e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↑↓"})," navigate"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↵"})," select"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"esc"})," close"]})]})]})}):null}function $c(){const[s,t]=o.useState(!1);return o.useEffect(()=>{const r=n=>{(n.metaKey||n.ctrlKey)&&n.key==="k"&&(n.preventDefault(),t(a=>!a))};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]),{isOpen:s,setIsOpen:t,open:()=>t(!0),close:()=>t(!1)}}function Ic({alerts:s=[],onAction:t,onDismiss:r,maxVisible:n=3,className:a=""}){const[l,c]=o.useState(new Set),i=s.filter(u=>!l.has(u.id||`${u.projectId}-${u.type}-${u.title}`)).slice(0,n),d=o.useCallback(u=>{const m=u.id||`${u.projectId}-${u.type}-${u.title}`;c(h=>new Set([...h,m])),r?.(u)},[r]);return i.length===0?null:e.jsxs("div",{className:`smart-alerts ${a}`,role:"region","aria-label":"Project alerts","aria-live":"polite",children:[i.map((u,m)=>e.jsx(Lc,{alert:u,onAction:t,onDismiss:()=>d(u)},u.id||`${u.projectId}-${u.type}-${m}`)),s.length>n&&e.jsx("div",{className:"smart-alerts__overflow",children:e.jsxs("span",{className:"smart-alerts__overflow-text",children:["+",s.length-n," more alerts"]})})]})}function Lc({alert:s,onAction:t,onDismiss:r}){const{type:n="info",title:a,description:l,action:c,actionTarget:i,projectId:d,projectName:u}=s,h={critical:Bi,warning:Te,info:Ks}[n]||Ks,f=()=>{t?.({target:i,projectId:d,alert:s})};return e.jsxs("div",{className:`smart-alert smart-alert--${n}`,role:"alert","aria-live":n==="critical"?"assertive":"polite",children:[e.jsx(h,{className:"smart-alert__icon","aria-hidden":"true"}),e.jsxs("div",{className:"smart-alert__content",children:[e.jsxs("div",{className:"smart-alert__title",children:[u&&e.jsxs("span",{className:"smart-alert__project",children:[u,": "]}),a]}),l&&e.jsx("div",{className:"smart-alert__description",children:l}),c&&e.jsx("div",{className:"smart-alert__action",children:e.jsxs("button",{type:"button",className:"smart-alert__action-btn",onClick:f,children:[c,e.jsx(ys,{size:14,"aria-hidden":"true"})]})})]}),r&&e.jsx("button",{type:"button",className:"smart-alert__dismiss",onClick:r,"aria-label":"Dismiss alert",children:e.jsx(ms,{size:18,"aria-hidden":"true"})})]})}const zc=o.memo(function({progress:t=0,areasComplete:r=0,totalAreas:n=0,areasWorking:a=0,size:l=110,strokeWidth:c=9}){const[i,d]=o.useState(0),u=o.useRef(null);o.useEffect(()=>{const p=i,x=Math.min(100,Math.max(0,t)),k=800,P=performance.now(),g=A=>{const v=A-P,N=Math.min(v/k,1),F=1-Math.pow(1-N,3),O=p+(x-p)*F;d(O),N<1&&(u.current=requestAnimationFrame(g))};return u.current=requestAnimationFrame(g),()=>{u.current&&cancelAnimationFrame(u.current)}},[t]);const m=(l-c)/2,h=m*2*Math.PI,f=h-i/100*h,j=()=>i>=80?"var(--accent-green)":i>=50||i>=25?"var(--accent-blue)":"var(--text-muted)";return e.jsxs("div",{className:"overview-progress-gauge",children:[e.jsxs("div",{className:"progress-gauge-circle",style:{width:l,height:l},children:[e.jsxs("svg",{width:l,height:l,viewBox:`0 0 ${l} ${l}`,children:[e.jsx("circle",{className:"gauge-track",cx:l/2,cy:l/2,r:m,fill:"none",strokeWidth:c,stroke:"var(--bg-tertiary)"}),e.jsx("circle",{className:"gauge-fill",cx:l/2,cy:l/2,r:m,fill:"none",stroke:j(),strokeWidth:c,strokeDasharray:h,strokeDashoffset:f,strokeLinecap:"round",transform:`rotate(-90 ${l/2} ${l/2})`,style:{transition:"stroke 0.3s ease"}})]}),e.jsxs("div",{className:"gauge-center",children:[e.jsxs("span",{className:"gauge-value",children:[Math.round(i),"%"]}),e.jsx("span",{className:"gauge-label",children:"Complete"})]})]}),e.jsxs("div",{className:"gauge-areas-status",children:[e.jsxs("span",{className:"areas-count",children:[e.jsx("strong",{children:r}),"/",n," Areas Done"]}),a>0&&e.jsxs("span",{className:"areas-active",children:[a," active"]})]})]})}),G={contract:"#3b82f6",revenue:"#10b981",costs:"#f59e0b",profit:"#22c55e",loss:"#ef4444",tmValue:"#8b5cf6",corValue:"#14b8a6",labor:"#6366f1",disposal:"#14b8a6",equipment:"#f97316",materials:"#a855f7",subcontractor:"#ec4899",other:"#6b7280"},ws={duration:800},Xs={contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"12px 16px"},labelStyle:{color:"var(--text-primary)",fontWeight:600,marginBottom:"8px"}},Va={labor:{label:"Labor",color:G.labor,icon:"HardHat"},disposal:{label:"Disposal",color:G.disposal,icon:"Trash2"},equipment:{label:"Equipment",color:G.equipment,icon:"Truck"},materials:{label:"Materials",color:G.materials,icon:"Package"},subcontractor:{label:"Subcontractor",color:G.subcontractor,icon:"Users"},other:{label:"Other",color:G.other,icon:"MoreHorizontal"}},Ba=[{id:"7d",label:"7D",days:7},{id:"30d",label:"30D",days:30},{id:"90d",label:"90D",days:90},{id:"all",label:"All",days:null}],ze=s=>s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(0)}K`:`$${s.toFixed(0)}`,Lt=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}),qc={revenue:{id:"revenueGradient",color:G.revenue,startOpacity:.3,endOpacity:0},costs:{id:"costsGradient",color:G.costs,startOpacity:.3,endOpacity:0},tmValue:{id:"tmValueGradient",color:G.tmValue,startOpacity:.2,endOpacity:0}},Vc=o.memo(function({earnedRevenue:t=0,totalCosts:r=0,laborCost:n=0,disposalCost:a=0,equipmentCost:l=0,materialsCost:c=0,otherCost:i=0,contractValue:d=0}){const u=t-r,m=t>0?u/t*100:0,h=u>=0,f=x=>x>=1e6?`$${(x/1e6).toFixed(1)}M`:x>=1e3?`$${(x/1e3).toFixed(1)}K`:`$${x.toFixed(0)}`,j=[{key:"labor",value:n,color:G.labor,label:"Labor"},{key:"disposal",value:a,color:G.disposal,label:"Disposal"},{key:"equipment",value:l,color:G.equipment,label:"Equipment"},{key:"materials",value:c,color:G.materials,label:"Materials"},{key:"other",value:i,color:G.other,label:"Other"}].filter(x=>x.value>0),p=j.length>0&&r>0;return e.jsxs("div",{className:"overview-financial-card animate-fade-in-up",children:[e.jsxs("div",{className:"financial-metrics-row",children:[e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value green",children:f(t)}),e.jsx("span",{className:"financial-metric-label",children:"Earned"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value amber",children:f(r)}),e.jsx("span",{className:"financial-metric-label",children:"Costs"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsxs("span",{className:`financial-metric-value ${h?"green":"red"}`,children:[h?"":"-",f(Math.abs(u))]}),e.jsxs("span",{className:"financial-metric-label",children:["Profit",e.jsxs("span",{className:`margin-badge ${h?"positive":"negative"}`,children:[m>=0?"+":"",m.toFixed(0),"%"]})]})]})]}),p&&e.jsxs("div",{className:"cost-breakdown-section",children:[e.jsx("div",{className:"cost-breakdown-bar",children:j.map((x,k)=>{const P=x.value/r*100;return e.jsx("div",{className:"cost-segment",style:{width:`${P}%`,backgroundColor:x.color,animationDelay:`${k*100}ms`},title:`${x.label}: ${f(x.value)} (${P.toFixed(0)}%)`},x.key)})}),e.jsx("div",{className:"cost-breakdown-legend",children:j.slice(0,4).map(x=>e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot",style:{backgroundColor:x.color}}),e.jsx("span",{className:"legend-label",children:x.label})]},x.key))})]})]})}),Bc=()=>oe(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),Bs={contract:G.contract,tm:G.costs},Wa=[{id:"7d",label:"7D",days:7},{id:"14d",label:"14D",days:14},{id:"30d",label:"30D",days:30}],Wc=o.memo(function({project:t,onShowToast:r}){const[n,a]=o.useState([]),[l,c]=o.useState([]),[i,d]=o.useState(new Date().toISOString().split("T")[0]),[u,m]=o.useState("14d"),[h,f]=o.useState(!0),[j,p]=o.useState(!1);o.useEffect(()=>{t?.id&&x()},[t?.id]);const x=async()=>{f(!0);try{const[M,V]=await Promise.all([q.getCrewCheckinHistory(t.id,365),q.getTMTickets(t.id)]);a(M||[]),c(V||[])}catch(M){console.error("Error loading crew metrics:",M)}finally{f(!1)}},k=o.useMemo(()=>{const M={};return l.forEach(V=>{const R=V.work_date;R&&(M[R]||(M[R]=new Set),(V.t_and_m_workers||[]).forEach(se=>{M[R].add(se.name.toLowerCase().trim())}))}),M},[l]),P=o.useMemo(()=>{const M={};return n.forEach(V=>{M[V.check_in_date]=V.workers||[]}),M},[n]),g=P[i]||[],A=k[i]||new Set,v=o.useMemo(()=>{const M=[],V=[];return g.forEach(R=>{A.has(R.name.toLowerCase().trim())?V.push(R):M.push(R)}),{total:g.length,contract:M,tm:V}},[g,A]),N=o.useMemo(()=>{const M=Wa.find(se=>se.id===u)?.days||14,V=[],R=new Date;for(let se=M-1;se>=0;se--){const $=new Date(R);$.setDate($.getDate()-se);const re=$.toISOString().split("T")[0],ue=P[re]||[],le=k[re]||new Set;let ke=0,I=0;ue.forEach(b=>{le.has(b.name.toLowerCase().trim())?I++:ke++}),V.push({date:re,displayDate:Lt(re),contract:ke,tm:I,total:ue.length})}return V},[P,k,u]),F=o.useCallback(M=>{const V=new Date(i+"T12:00:00");V.setDate(V.getDate()+M),d(V.toISOString().split("T")[0])},[i]),O=i===new Date().toISOString().split("T")[0],S=M=>new Date(M+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),_=o.useCallback(M=>{M?.date&&d(M.date)},[]),T=({active:M,payload:V,label:R})=>{if(!M||!V?.length)return null;const se=(V[0]?.value||0)+(V[1]?.value||0);return e.jsxs("div",{style:{...Xs.contentStyle,fontSize:"0.8rem"},children:[e.jsx("p",{style:{...Xs.labelStyle,fontSize:"0.85rem",marginBottom:6},children:R}),e.jsxs("p",{style:{margin:"3px 0",color:Bs.contract},children:["Contract: ",e.jsx("strong",{children:V[0]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:Bs.tm},children:["T&M: ",e.jsx("strong",{children:V[1]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:"var(--text-primary)",borderTop:"1px solid var(--border-color)",paddingTop:4},children:["Total: ",e.jsx("strong",{children:se})]})]})},L=o.useCallback(async()=>{p(!0),r?.("Generating crew report PDF...","info");try{const V=(await Bc()).default,R=new V,se=R.internal.pageSize.width;let $=20;R.setFontSize(18),R.setFont(void 0,"bold"),R.text("Crew On-Site Report",se/2,$,{align:"center"}),$+=8,R.setFontSize(11),R.setFont(void 0,"normal"),R.text(`Project: ${t.name}`,se/2,$,{align:"center"}),$+=6,R.text(`Date: ${S(i)}`,se/2,$,{align:"center"}),$+=12,R.setFontSize(12),R.setFont(void 0,"bold"),R.text("Selected Day Summary",14,$),$+=7,R.setFontSize(10),R.setFont(void 0,"normal"),R.text(`Total Crew On-Site: ${v.total}`,14,$),$+=5,R.text(`Contract Workers: ${v.contract.length}`,14,$),$+=5,R.text(`T&M Workers: ${v.tm.length}`,14,$),$+=10,v.contract.length>0&&(R.setFontSize(12),R.setFont(void 0,"bold"),R.text("Contract Workers",14,$),$+=7,R.setFontSize(9),R.setFont(void 0,"bold"),R.text("Name",14,$),R.text("Role",100,$),$+=5,R.setFont(void 0,"normal"),v.contract.forEach(le=>{$>270&&(R.addPage(),$=20),R.text(le.name,14,$),R.text(le.role||"—",100,$),$+=5}),$+=8),v.tm.length>0&&($>240&&(R.addPage(),$=20),R.setFontSize(12),R.setFont(void 0,"bold"),R.text("T&M Workers (Extra Work)",14,$),$+=7,R.setFontSize(9),R.setFont(void 0,"bold"),R.text("Name",14,$),R.text("Role",100,$),$+=5,R.setFont(void 0,"normal"),v.tm.forEach(le=>{$>270&&(R.addPage(),$=20),R.text(le.name,14,$),R.text(le.role||"—",100,$),$+=5}),$+=8),$>200&&(R.addPage(),$=20),R.setFontSize(12),R.setFont(void 0,"bold"),R.text("Daily Timeline",14,$),$+=7,R.setFontSize(8),R.setFont(void 0,"bold"),R.text("Date",14,$),R.text("Total",70,$),R.text("Contract",95,$),R.text("T&M",125,$),$+=5,R.setFont(void 0,"normal"),N.forEach(le=>{$>275&&(R.addPage(),$=20),R.text(le.displayDate,14,$),R.text(String(le.total),70,$),R.text(String(le.contract),95,$),R.text(String(le.tm),125,$),$+=4.5});const re=R.internal.pageSize.height-10;R.setFontSize(8),R.setTextColor(128,128,128),R.text(`Generated ${new Date().toLocaleString()} — FieldSync`,se/2,re,{align:"center"});const ue=`${t.name}_Crew_Report_${i}.pdf`;R.save(ue),r?.("PDF exported!","success")}catch(M){console.error("Error exporting crew PDF:",M),r?.("Error generating PDF","error")}finally{p(!1)}},[t,i,v,N,r]);return h?e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsx("div",{className:"crew-metrics-header",children:e.jsxs("h3",{children:[e.jsx(De,{size:18})," Crew On-Site"]})}),e.jsxs("div",{className:"crew-metrics-loading",children:[e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"})]})]}):e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsxs("div",{className:"crew-metrics-header",children:[e.jsxs("h3",{children:[e.jsx(De,{size:18})," Crew On-Site"]}),e.jsx("div",{className:"crew-metrics-actions",children:e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:L,disabled:j,title:"Export crew report as PDF",children:[e.jsx(Ye,{size:14})," ",j?"Exporting...":"PDF"]})})]}),e.jsxs("div",{className:"crew-date-nav",children:[e.jsx("button",{className:"crew-date-btn",onClick:()=>F(-1),children:e.jsx(on,{size:16})}),e.jsxs("span",{className:"crew-date-label",children:[e.jsx(st,{size:14}),O?"Today":S(i)]}),e.jsx("button",{className:"crew-date-btn",onClick:()=>F(1),disabled:O,children:e.jsx(qe,{size:16})})]}),e.jsxs("div",{className:"crew-stats-row",children:[e.jsxs("div",{className:"crew-stat total",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(De,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:v.total}),e.jsx("span",{className:"crew-stat-label",children:"Total On-Site"})]})]}),e.jsxs("div",{className:"crew-stat contract",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(Je,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:v.contract.length}),e.jsx("span",{className:"crew-stat-label",children:"Contract"})]})]}),e.jsxs("div",{className:"crew-stat tm",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(Ct,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:v.tm.length}),e.jsx("span",{className:"crew-stat-label",children:"T&M"})]})]})]}),v.total>0&&e.jsxs("div",{className:"crew-breakdown-bar",children:[e.jsx("div",{className:"crew-bar-segment contract",style:{width:`${v.contract.length/v.total*100}%`},title:`${v.contract.length} Contract`}),e.jsx("div",{className:"crew-bar-segment tm",style:{width:`${v.tm.length/v.total*100}%`},title:`${v.tm.length} T&M`})]}),v.total>0&&e.jsxs("div",{className:"crew-name-lists",children:[v.contract.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header contract",children:[e.jsx(Je,{size:13}),e.jsxs("span",{children:["Contract (",v.contract.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:v.contract.map((M,V)=>e.jsxs("span",{className:"crew-name-tag contract",children:[M.name,M.role&&M.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:M.role})]},V))})]}),v.tm.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header tm",children:[e.jsx(Ct,{size:13}),e.jsxs("span",{children:["T&M (",v.tm.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:v.tm.map((M,V)=>e.jsxs("span",{className:"crew-name-tag tm",children:[M.name,M.role&&M.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:M.role})]},V))})]})]}),e.jsxs("div",{className:"crew-timeline-section",children:[e.jsxs("div",{className:"crew-timeline-header",children:[e.jsx("span",{className:"crew-timeline-title",children:"Daily Breakdown"}),e.jsx("div",{className:"crew-time-range-pills",children:Wa.map(M=>e.jsx("button",{className:`crew-range-pill ${u===M.id?"active":""}`,onClick:()=>m(M.id),children:M.label},M.id))})]}),e.jsx("div",{className:"crew-chart-container",children:e.jsx(Zs,{width:"100%",height:140,children:e.jsxs(Ri,{data:N,onClick:M=>M?.activePayload?.[0]&&_(M.activePayload[0].payload),style:{cursor:"pointer"},children:[e.jsx(nn,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Mt,{dataKey:"displayDate",tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:{stroke:"var(--border-color)"},tickLine:!1,interval:u==="30d"?4:u==="14d"?1:0}),e.jsx(Ot,{tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:!1,tickLine:!1,allowDecimals:!1,width:30}),e.jsx(et,{content:e.jsx(T,{})}),e.jsx(Es,{wrapperStyle:{fontSize:"0.75rem",paddingTop:4},iconType:"circle",iconSize:8}),e.jsx(Da,{dataKey:"contract",name:"Contract",stackId:"crew",fill:Bs.contract,radius:[0,0,0,0]}),e.jsx(Da,{dataKey:"tm",name:"T&M (Extra Work)",stackId:"crew",fill:Bs.tm,radius:[3,3,0,0]})]})})})]}),v.total===0&&e.jsx("div",{className:"crew-empty",children:e.jsx("p",{children:"No crew checked in for this date"})})]})}),ne=o.memo(function({width:t,height:r,borderRadius:n="8px",className:a="",variant:l="default"}){const i=(()=>{switch(l){case"text":return{height:"1em",borderRadius:"4px"};case"circular":return{borderRadius:"50%"};case"rectangular":return{borderRadius:"0"};default:return{borderRadius:n}}})();return e.jsx("div",{className:`skeleton ${a}`,style:{width:t||"100%",height:r||i.height||"1rem",borderRadius:i.borderRadius},"aria-hidden":"true"})});o.memo(function({showProgress:t=!1}){return e.jsxs("div",{className:"metric-skeleton",children:[e.jsx(ne,{width:"60%",height:"0.75rem",className:"skeleton-label"}),e.jsx(ne,{width:"80%",height:"1.75rem",className:"skeleton-value"}),t&&e.jsx(ne,{width:"100%",height:"6px",className:"skeleton-progress"})]})});const Xo=o.memo(function({lines:t=3,showHeader:r=!0,showAction:n=!1}){return e.jsxs("div",{className:"card-skeleton","aria-busy":"true","aria-label":"Loading content",children:[r&&e.jsxs("div",{className:"card-skeleton-header",children:[e.jsx(ne,{width:"40%",height:"1.25rem"}),n&&e.jsx(ne,{width:"80px",height:"32px"})]}),e.jsx("div",{className:"card-skeleton-body",children:Array.from({length:t}).map((a,l)=>e.jsx(ne,{width:`${100-l*15}%`,height:"1rem",className:"skeleton-line"},l))})]})});o.memo(function({count:t=3,showAvatar:r=!1,showAction:n=!1}){return e.jsx("div",{className:"list-skeleton","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:t}).map((a,l)=>e.jsxs("div",{className:"list-item-skeleton",children:[r&&e.jsx(ne,{width:"40px",height:"40px",variant:"circular"}),e.jsxs("div",{className:"list-item-skeleton-content",children:[e.jsx(ne,{width:"60%",height:"1rem"}),e.jsx(ne,{width:"40%",height:"0.75rem"})]}),n&&e.jsx(ne,{width:"60px",height:"28px"})]},l))})});o.memo(function(){return e.jsx("div",{className:"financial-row-skeleton","aria-busy":"true","aria-label":"Loading financial data",children:[1,2,3].map(t=>e.jsxs("div",{className:"financial-card-skeleton",children:[e.jsxs("div",{className:"financial-card-skeleton-header",children:[e.jsx(ne,{width:"24px",height:"24px",variant:"circular"}),e.jsx(ne,{width:"60%",height:"1rem"})]}),e.jsx(ne,{width:"50%",height:"2rem",className:"skeleton-hero-value"}),e.jsxs("div",{className:"financial-card-skeleton-details",children:[e.jsx(ne,{width:"100%",height:"0.875rem"}),e.jsx(ne,{width:"80%",height:"0.875rem"})]})]},t))})});o.memo(function({height:t="200px"}){return e.jsxs("div",{className:"chart-skeleton",style:{height:t},"aria-busy":"true","aria-label":"Loading chart",children:[e.jsx("div",{className:"chart-skeleton-bars",children:[40,65,45,80,55,70,50,75,60,85].map((r,n)=>e.jsx("div",{className:"chart-skeleton-bar",style:{height:`${r}%`}},n))}),e.jsx(ne,{width:"100%",height:"1px",className:"chart-skeleton-axis"})]})});const Ke=o.memo(function({count:t=3}){return e.jsx("div",{className:"ticket-skeleton-list","aria-busy":"true","aria-label":"Loading tickets",children:Array.from({length:t}).map((r,n)=>e.jsxs("div",{className:"ticket-skeleton-item",children:[e.jsxs("div",{className:"ticket-skeleton-header",children:[e.jsx(ne,{width:"100px",height:"0.875rem"}),e.jsx(ne,{width:"80px",height:"24px",borderRadius:"12px"})]}),e.jsx(ne,{width:"90%",height:"1rem"}),e.jsxs("div",{className:"ticket-skeleton-footer",children:[e.jsx(ne,{width:"60px",height:"0.75rem"}),e.jsx(ne,{width:"60px",height:"0.75rem"}),e.jsx(ne,{width:"60px",height:"0.75rem"})]})]},n))})}),Uc=o.memo(function(){return e.jsx("div",{className:"hero-metrics-skeleton","aria-busy":"true","aria-label":"Loading metrics",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"hero-metric-skeleton",children:[e.jsx(ne,{width:"80px",height:"0.75rem",className:"skeleton-label"}),e.jsx(ne,{width:"120px",height:"1.75rem",className:"skeleton-value"}),e.jsx(ne,{width:"100%",height:"4px",className:"skeleton-bar"})]},t))})}),Nn=o.memo(function({title:t="Unable to load data",message:r="Something went wrong. Please try again.",error:n=null,onRetry:a=null,retryLabel:l="Try Again",variant:c="default",icon:i=null}){const u=i||(n?.message?.includes("network")||n?.message?.includes("offline")?Wi:Te);return c==="compact"?e.jsxs("div",{className:"error-state error-state-compact",role:"alert",children:[e.jsx(u,{size:16,className:"error-state-icon","aria-hidden":"true"}),e.jsx("span",{className:"error-state-message",children:r}),a&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:a,"aria-label":l,children:e.jsx(ft,{size:14})})]}):c==="inline"?e.jsxs("div",{className:"error-state error-state-inline",role:"alert",children:[e.jsxs("div",{className:"error-state-content",children:[e.jsx(u,{size:20,className:"error-state-icon","aria-hidden":"true"}),e.jsxs("div",{className:"error-state-text",children:[e.jsx("span",{className:"error-state-title",children:t}),e.jsx("span",{className:"error-state-message",children:r})]})]}),a&&e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:a,children:[e.jsx(ft,{size:14})," ",l]})]}):e.jsxs("div",{className:"error-state",role:"alert","aria-live":"polite",children:[e.jsx("div",{className:"error-state-icon-wrapper",children:e.jsx(u,{size:32,className:"error-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"error-state-title",children:t}),e.jsx("p",{className:"error-state-message",children:r}),!1,a&&e.jsxs("button",{className:"btn btn-primary",onClick:a,children:[e.jsx(ft,{size:16})," ",l]})]})}),Ua=o.memo(function({title:t="No data yet",message:r="Items will appear here once added.",icon:n=null,action:a=null,actionLabel:l="Get Started",onAction:c=null}){return e.jsxs("div",{className:"empty-state",role:"status",children:[n&&e.jsx("div",{className:"empty-state-icon-wrapper",children:e.jsx(n,{size:32,className:"empty-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"empty-state-title",children:t}),e.jsx("p",{className:"empty-state-message",children:r}),c&&e.jsx("button",{className:"btn btn-primary btn-small",onClick:c,children:l}),a&&!c&&a]})});o.memo(function({label:t,error:r,required:n=!1,hint:a,children:l,className:c=""}){return e.jsxs("div",{className:`form-field ${r?"has-error":""} ${c}`,children:[t&&e.jsxs("label",{className:"form-field-label",children:[t,n&&e.jsx("span",{className:"form-field-required",children:"*"})]}),e.jsx("div",{className:"form-field-input",children:l}),r&&e.jsxs("div",{className:"form-field-error",role:"alert",children:[e.jsx(Ds,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:r})]}),a&&!r&&e.jsx("div",{className:"form-field-hint",children:a})]})});o.memo(function({type:t="text",value:r,onChange:n,onBlur:a,error:l,placeholder:c,disabled:i,min:d,max:u,step:m,pattern:h,required:f,autoComplete:j,name:p,id:x,className:k="","aria-label":P,"aria-describedby":g}){const A=x||p,v=l?`${A}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:t,id:A,name:p,value:r,onChange:n,onBlur:a,placeholder:c,disabled:i,min:d,max:u,step:m,pattern:h,required:f,autoComplete:j,className:`validated-input ${l?"has-error":""} ${k}`,"aria-label":P,"aria-invalid":!!l,"aria-describedby":l?v:g}),l&&e.jsxs("div",{id:v,className:"input-error-inline",role:"alert",children:[e.jsx(Ds,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:l})]})]})});o.memo(function({value:t,onChange:r,onBlur:n,error:a,disabled:l,required:c,name:i,id:d,className:u="",children:m,"aria-label":h}){const f=d||i,j=a?`${f}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("select",{id:f,name:i,value:t,onChange:r,onBlur:n,disabled:l,required:c,className:`validated-select ${a?"has-error":""} ${u}`,"aria-label":h,"aria-invalid":!!a,"aria-describedby":a?j:void 0,children:m}),a&&e.jsxs("div",{id:j,className:"input-error-inline",role:"alert",children:[e.jsx(Ds,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:a})]})]})});o.memo(function({value:t,onChange:r,onBlur:n,error:a,placeholder:l,disabled:c,required:i,rows:d=3,maxLength:u,name:m,id:h,className:f="","aria-label":j}){const p=h||m,x=a?`${p}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("textarea",{id:p,name:m,value:t,onChange:r,onBlur:n,placeholder:l,disabled:c,required:i,rows:d,maxLength:u,className:`validated-textarea ${a?"has-error":""} ${f}`,"aria-label":j,"aria-invalid":!!a,"aria-describedby":a?x:void 0}),u&&e.jsxs("div",{className:"textarea-counter",children:[t?.length||0," / ",u]}),a&&e.jsxs("div",{id:x,className:"input-error-inline",role:"alert",children:[e.jsx(Ds,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:a})]})]})});const Hc=o.memo(function({count:t,label:r,variant:n="default",size:a="medium",pulse:l=!1,icon:c}){const[i,d]=o.useState(t),[u,m]=o.useState(!1);return o.useEffect(()=>{if(t!==i){m(!0);const h=setTimeout(()=>{m(!1),d(t)},400);return()=>clearTimeout(h)}},[t,i]),e.jsxs("span",{className:`count-badge count-badge-${n} count-badge-${a} ${l?"badge-new":""} ${u?"animate-count-up":""}`,title:r,children:[c&&e.jsx(c,{size:a==="small"?12:a==="large"?18:14}),e.jsx("span",{className:"count-badge-value",children:t}),r&&e.jsx("span",{className:"count-badge-label",children:r})]})}),Kc=o.memo(function({value:t,max:r=100,showLabel:n=!1,size:a="medium",variant:l="default",animated:c=!0}){const i=Math.min(100,Math.max(0,t/r*100)),d=a==="small"?"4px":a==="large"?"8px":"6px",u=l==="default"?i>=80?"danger":i>=60?"warning":"success":l;return e.jsxs("div",{className:`mini-progress mini-progress-${a}`,children:[e.jsx("div",{className:"mini-progress-track",style:{height:d},children:e.jsx("div",{className:`mini-progress-fill mini-progress-${u} ${c?"progress-animate":""}`,style:{width:`${i}%`}})}),n&&e.jsxs("span",{className:"mini-progress-label",children:[Math.round(i),"%"]})]})}),Gc=o.memo(function({value:t,previousValue:r,format:n="percent",inverted:a=!1,showValue:l=!0}){const c=t-r,i=r!==0?c/r*100:0;let d=c===0?"neutral":c>0?"up":"down",u="neutral";c!==0&&(a?u=c>0?"negative":"positive":u=c>0?"positive":"negative");const m=d==="up"?hs:d==="down"?ps:$t,h=()=>{const f=Math.abs(c);switch(n){case"percent":return`${Math.abs(i).toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(f);default:return f.toLocaleString()}};return e.jsxs("span",{className:`trend-indicator trend-${u}`,children:[e.jsx(m,{size:14}),l&&e.jsx("span",{className:"trend-value",children:h()})]})});o.memo(function({status:t="default",label:r,size:n="medium",pulse:a=!1}){return e.jsxs("span",{className:`status-dot-container status-dot-${n}`,children:[e.jsx("span",{className:`status-dot status-dot-${t} ${a?"status-dot-pulse":""}`}),r&&e.jsx("span",{className:"status-dot-label",children:r})]})});o.memo(function({data:t=[],width:r=80,height:n=24,strokeWidth:a=2,color:l="var(--accent-blue)",showArea:c=!0}){if(!t.length)return null;const i=Math.max(...t),d=Math.min(...t),u=i-d||1,m=t.map((f,j)=>{const p=j/(t.length-1)*r,x=n-(f-d)/u*(n-a*2)-a;return`${p},${x}`}).join(" "),h=`0,${n} ${m} ${r},${n}`;return e.jsxs("svg",{width:r,height:n,className:"sparkline",viewBox:`0 0 ${r} ${n}`,children:[c&&e.jsx("polygon",{points:h,fill:l,fillOpacity:"0.15"}),e.jsx("polyline",{points:m,fill:"none",stroke:l,strokeWidth:a,strokeLinecap:"round",strokeLinejoin:"round"})]})});o.memo(function({items:t=[]}){return e.jsx("div",{className:"quick-stats",children:t.map((r,n)=>e.jsxs("span",{className:"quick-stat-item",children:[r.icon&&e.jsx(r.icon,{size:12}),e.jsx("span",{className:"quick-stat-value",children:r.value}),r.label&&e.jsx("span",{className:"quick-stat-label",children:r.label})]},n))})});o.memo(function({status:t,label:r,size:n="medium"}){const a={success:dn,warning:Te,danger:Te,info:kt,pending:kt},l=a[t]||a.info;return e.jsxs("span",{className:`status-indicator status-indicator-${t} status-indicator-${n}`,children:[e.jsx(l,{size:n==="small"?12:n==="large"?18:14}),r&&e.jsx("span",{className:"status-indicator-label",children:r})]})});o.memo(function({current:t,previous:r,format:n="number",label:a,inverted:l=!1}){const c=t-r,i=l?c<0:c>0,d=l?c>0:c<0,u=m=>{switch(n){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(Math.abs(m));case"percent":return`${Math.abs(m).toFixed(1)}%`;default:return Math.abs(m).toLocaleString()}};return e.jsxs("div",{className:`metric-delta ${i?"positive":d?"negative":"neutral"}`,children:[e.jsx("span",{className:"metric-delta-arrow",children:c>0?"↑":c<0?"↓":"→"}),e.jsx("span",{className:"metric-delta-value",children:u(c)}),a&&e.jsx("span",{className:"metric-delta-label",children:a})]})});o.memo(function({value:t,max:r=100,size:n=40,strokeWidth:a=4,showValue:l=!0,color:c="var(--accent-blue)"}){const i=Math.min(100,Math.max(0,t/r*100)),d=(n-a)/2,u=d*2*Math.PI,m=u-i/100*u;return e.jsxs("div",{className:"circular-progress",style:{width:n,height:n},children:[e.jsxs("svg",{width:n,height:n,viewBox:`0 0 ${n} ${n}`,children:[e.jsx("circle",{className:"circular-progress-track",cx:n/2,cy:n/2,r:d,fill:"none",strokeWidth:a}),e.jsx("circle",{className:"circular-progress-fill",cx:n/2,cy:n/2,r:d,fill:"none",stroke:c,strokeWidth:a,strokeDasharray:u,strokeDashoffset:m,strokeLinecap:"round",transform:`rotate(-90 ${n/2} ${n/2})`,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),l&&e.jsxs("span",{className:"circular-progress-value",children:[Math.round(i),"%"]})]})});o.memo(function({isOpen:t,onClose:r,title:n,children:a,size:l="medium",className:c="",showCloseButton:i=!0,closeOnOverlayClick:d=!0,closeOnEscape:u=!0,footer:m,ariaDescribedBy:h}){const f=o.useRef(null),j=o.useRef(null),p=o.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`);o.useEffect(()=>{if(t){j.current=document.activeElement;const g=setTimeout(()=>{f.current?.focus()},10);return()=>clearTimeout(g)}},[t]),o.useEffect(()=>{!t&&j.current&&j.current.focus()},[t]),o.useEffect(()=>{if(!t||!u)return;const g=A=>{A.key==="Escape"&&(A.preventDefault(),r())};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[t,u,r]),o.useEffect(()=>{if(t){const g=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=g}}},[t]);const x=o.useCallback(g=>{if(g.key!=="Tab")return;const A=f.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!A||A.length===0)return;const v=A[0],N=A[A.length-1];g.shiftKey?document.activeElement===v&&(g.preventDefault(),N.focus()):document.activeElement===N&&(g.preventDefault(),v.focus())},[]),k=g=>{d&&g.target===g.currentTarget&&r()};if(!t)return null;const P={small:"modal-small",medium:"modal-medium",large:"modal-large",full:"modal-full"};return e.jsx("div",{className:"modal-overlay",onClick:k,role:"presentation",children:e.jsxs("div",{ref:f,className:`modal-content ${P[l]||""} ${c}`,role:"dialog","aria-modal":"true","aria-labelledby":n?p.current:void 0,"aria-describedby":h,tabIndex:-1,onKeyDown:x,onClick:g=>g.stopPropagation(),children:[n&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:p.current,children:n}),i&&e.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close modal",type:"button",children:e.jsx(ms,{size:20})})]}),e.jsx("div",{className:"modal-body",children:a}),m&&e.jsx("div",{className:"modal-footer",children:m})]})})});const bs=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Ws=o.memo(function({icon:t,label:r,value:n,formattedValue:a,subLabel:l,progress:c,progressLabel:i,variant:d="default",trend:u,previousValue:m}){const h={default:"var(--accent-blue)",success:"var(--accent-green)",warning:"var(--accent-amber)",danger:"var(--accent-red)"};return e.jsxs("div",{className:"hero-metric-card hover-lift animate-fade-in-up",children:[e.jsxs("div",{className:"hero-metric-header",children:[e.jsx("div",{className:"hero-metric-icon",style:{color:h[d]},children:e.jsx(t,{size:18})}),e.jsx("span",{className:"hero-metric-label",children:r})]}),e.jsxs("div",{className:"hero-metric-value-row",children:[e.jsx("span",{className:`hero-metric-value hero-metric-${d}`,children:a}),u!==void 0&&m!==void 0&&e.jsx(Gc,{value:n,previousValue:m,format:"currency",inverted:r.toLowerCase().includes("cost")})]}),l&&e.jsx("span",{className:"hero-metric-sublabel",children:l}),c!==void 0&&e.jsxs("div",{className:"hero-metric-progress",children:[e.jsx(Kc,{value:c,max:100,size:"small",variant:d,showLabel:!0}),i&&e.jsx("span",{className:"hero-metric-progress-label",children:i})]})]})}),Yc=o.memo(function({contractValue:t=0,earnedRevenue:r=0,totalCosts:n=0,profit:a=0,progress:l=0,corApprovedValue:c=0,loading:i=!1,previousData:d}){const u=t+c,m=r>0?a/r*100:0,h=r>0?n/r*100:0,f=u>0?r/u*100:0,j=u>0?n/u*100:0,p=o.useMemo(()=>m>=20?"success":m>=10?"warning":m<0?"danger":"default",[m]),x=o.useMemo(()=>h<=60?"success":h<=80?"warning":"danger",[h]);return i?e.jsx(Uc,{}):e.jsxs("div",{className:"hero-metrics stagger-children",children:[e.jsx(Ws,{icon:ls,label:"Contract Value",value:u,formattedValue:bs(u),subLabel:c>0?`+${bs(c)} CORs`:null,variant:"default"}),e.jsx(Ws,{icon:hs,label:"Earned Revenue",value:r,formattedValue:bs(r),progress:f,progressLabel:`${Math.round(f)}% of contract`,variant:"success",previousValue:d?.earnedRevenue,trend:d?r:void 0}),e.jsx(Ws,{icon:un,label:"Total Costs",value:n,formattedValue:bs(n),progress:j,progressLabel:`${Math.round(h)}% of revenue`,variant:x,previousValue:d?.totalCosts,trend:d?n:void 0}),e.jsx(Ws,{icon:Ui,label:"Profit",value:a,formattedValue:bs(a),subLabel:`${m>=0?"+":""}${m.toFixed(1)}% margin`,variant:p,previousValue:d?.profit,trend:d?a:void 0})]})}),Ha=[{id:"overview",label:"Overview",shortLabel:"Overview",icon:Ki,description:"Metrics & trends",step:null},{id:"cors",label:"Change Orders",shortLabel:"CORs",icon:os,description:"CORs & approvals",step:1},{id:"tickets",label:"T&M Tickets",shortLabel:"Tickets",icon:xe,description:"Field data",step:2},{id:"billing",label:"Billing",shortLabel:"Billing",icon:un,description:"Invoices & billing",step:3}],Jc=o.memo(function({activeSection:t="overview",onSectionChange:r,collapsed:n=!1,onToggleCollapse:a,onMobileClose:l,stats:c={}}){const{corCount:i=0,ticketCount:d=0,corPending:u=0,ticketPending:m=0,billableCount:h=0,invoiceCount:f=0}=c,j=p=>p==="cors"&&i>0?{count:i,variant:u>0?"warning":"default",pending:u}:p==="tickets"&&d>0?{count:d,variant:m>0?"warning":"default",pending:m}:p==="billing"&&h>0?{count:h,variant:"success",pending:h}:null;return e.jsxs("nav",{className:`financials-nav ${n?"collapsed":""}`,"aria-label":"Financials sections",children:[l&&e.jsxs("div",{className:"financials-nav-mobile-header",children:[e.jsx("span",{className:"financials-nav-mobile-title",children:"Financials"}),e.jsx("button",{className:"financials-nav-mobile-close",onClick:l,"aria-label":"Close menu",children:e.jsx(ms,{size:20})})]}),e.jsxs("button",{className:"financials-nav-toggle",onClick:a,"aria-label":n?"Expand sidebar":"Collapse sidebar",title:n?"Expand sidebar":"Collapse sidebar",children:[n?e.jsx(Hi,{size:18}):e.jsx(on,{size:18}),!n&&e.jsx("span",{children:"Collapse"})]}),e.jsx("div",{className:"financials-nav-items",children:Ha.map((p,x)=>{const k=t===p.id,P=p.icon,g=j(p.id),A=x<Ha.length-1&&p.step!==null;return e.jsxs("div",{className:"financials-nav-item-wrapper",children:[e.jsxs("button",{className:`financials-nav-item ${k?"active":""}`,onClick:()=>r?.(p.id),"aria-current":k?"page":void 0,title:`${p.label}${g?` (${g.count})`:""}`,children:[p.step&&!n&&e.jsx("span",{className:"financials-nav-step",children:p.step}),e.jsxs("div",{className:"financials-nav-icon",children:[e.jsx(P,{size:n?22:20}),g&&g.pending>0&&e.jsx("span",{className:"financials-nav-dot"})]}),n&&e.jsx("span",{className:"financials-nav-short-label",children:p.shortLabel}),!n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"financials-nav-content",children:[e.jsx("span",{className:"financials-nav-label",children:p.label}),e.jsx("span",{className:"financials-nav-desc",children:p.description})]}),g&&e.jsx(Hc,{count:g.count,size:"small",variant:g.variant}),e.jsx(qe,{size:16,className:"financials-nav-arrow"})]})]}),A&&!n&&e.jsx("div",{className:"financials-nav-connector",children:e.jsx("div",{className:"connector-line"})})]},p.id)})}),n&&e.jsxs("button",{className:"financials-nav-expand-btn",onClick:a,"aria-label":"Expand sidebar",children:[e.jsx(qe,{size:14}),e.jsx("span",{children:"Expand"})]})]})});function Xc(s,t,r=[],n=null,a=[]){const l=t?.contract_value||0,c=s?.laborByDate||[],i=s?.haulOffByDate||[],d=s?.materialsEquipmentByDate||[],u=s?.customCosts||[],m=new Set;c.forEach(N=>m.add(N.date)),i.forEach(N=>m.add(N.date)),d.forEach(N=>m.add(N.date)),u.forEach(N=>{N.cost_date&&m.add(N.cost_date)}),r.forEach(N=>{N.work_date&&m.add(N.work_date),N.ticket_date&&m.add(N.ticket_date),N.created_at&&m.add(N.created_at.split("T")[0])}),a.forEach(N=>{N.status==="done"&&N.updated_at&&m.add(N.updated_at.split("T")[0])});const h=[...m].sort((N,F)=>new Date(N)-new Date(F));if(h.length===0)return[];const f={},j=a.reduce((N,F)=>N+(parseFloat(F.weight)||0),0);a.forEach(N=>{if(N.status==="done"&&N.updated_at){const F=N.updated_at.split("T")[0],O=parseFloat(N.weight)||0,S=N.scheduled_value?parseFloat(N.scheduled_value):j>0?O/j*l:0;f[F]||(f[F]=0),f[F]+=S}});let p=0,x=0;const k={};r.forEach(N=>{const F=N.work_date||N.ticket_date||N.created_at?.split("T")[0];if(!F)return;let O=0;const S=N.t_and_m_workers||N.workers||[];Array.isArray(S)&&S.forEach(T=>{const L=parseFloat(T.hours)||parseFloat(T.regular_hours)||0,M=parseFloat(T.overtime_hours)||0,V=parseFloat(T.regular_rate)||parseFloat(T.rate)||65,R=parseFloat(T.overtime_rate)||V*1.5;O+=L*V+M*R});const _=N.t_and_m_items||N.items||[];Array.isArray(_)&&_.forEach(T=>{const L=parseFloat(T.quantity)||1,M=parseFloat(T.unit_cost)||parseFloat(T.materials_equipment?.cost_per_unit)||0;O+=L*M}),k[F]||(k[F]=0),k[F]+=O});const P={};u.forEach(N=>{const F=N.cost_date;F&&(P[F]||(P[F]=0),P[F]+=parseFloat(N.amount)||0)});const g={};d.forEach(N=>{N.date&&(g[N.date]=N.cost||0)});let A=0;return h.map(N=>{const O=c.find(re=>re.date===N)?.cost||0,_=i.find(re=>re.date===N)?.cost||0,T=g[N]||0,L=P[N]||0,M=O+T+_+L;p+=M;const V=k[N]||0;x+=V;const R=f[N]||0;A+=R;const $=Object.keys(f).length>0?A:s?.billable||0;return{date:N,contract:l,revenue:Math.round($),costs:Math.round(p),tmValue:Math.round(x),corValue:Math.round(n?.total_approved_value||0),profit:Math.round($-p),dailyLabor:Math.round(O),dailyRevenue:Math.round(R),dailyMaterials:Math.round(T),dailyHaulOff:Math.round(_),dailyCustom:Math.round(L),dailyTM:Math.round(V),dailyTotal:Math.round(M)}})}function Qc(s,t){if(!t||!s.length)return s;const r=new Date,n=new Date;return n.setDate(r.getDate()-t),s.filter(a=>new Date(a.date)>=n)}function Zc(s=0,t=0,r=[]){const n=[];s>0&&n.push({name:"Labor",value:s,color:G.labor,category:"labor"}),t>0&&n.push({name:"Disposal",value:t,color:G.disposal,category:"disposal"});const a={};r.forEach(c=>{const i=c.category||"other";a[i]||(a[i]={items:[],total:0}),a[i].items.push(c),a[i].total+=parseFloat(c.amount)||0}),Object.entries(a).forEach(([c,i])=>{if(i.total>0){const d=Va[c]||Va.other;n.push({name:d.label,value:i.total,color:d.color,category:c,items:i.items})}});const l=n.reduce((c,i)=>c+i.value,0);return n.forEach(c=>{c.percentage=l>0?Math.round(c.value/l*100):0}),n.sort((c,i)=>i.value-c.value),n}function Ka(s,t){if(!s||s.length<2)return{direction:"flat",percentage:0};const r=s.slice(-7);if(r.length<2)return{direction:"flat",percentage:0};const n=r[0][t]||0,a=r[r.length-1][t]||0;if(n===0)return{direction:a>0?"up":"flat",percentage:0};const l=(a-n)/n*100;return{direction:l>5?"up":l<-5?"down":"flat",percentage:Math.abs(Math.round(l))}}function eo({active:s,payload:t,label:r}){if(!s||!t||!t.length)return null;const n=l=>l>=1e6?`$${(l/1e6).toFixed(2)}M`:l>=1e3?`$${(l/1e3).toFixed(1)}K`:`$${l.toFixed(0)}`,a=t[0]?.payload||{};return e.jsxs("div",{className:"chart-tooltip",children:[e.jsx("div",{className:"chart-tooltip-date",children:Lt(r)}),e.jsxs("div",{className:"chart-tooltip-rows",children:[a.contract!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:G.contract}}),"Contract"]}),e.jsx("span",{className:"chart-tooltip-value",children:n(a.contract)})]}),a.revenue!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:G.revenue}}),"Revenue"]}),e.jsx("span",{className:"chart-tooltip-value",children:n(a.revenue)})]}),a.costs!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:G.costs}}),"Costs"]}),e.jsx("span",{className:"chart-tooltip-value",children:n(a.costs)})]}),a.tmValue!==void 0&&a.tmValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:G.tmValue}}),"T&M Value"]}),e.jsx("span",{className:"chart-tooltip-value",children:n(a.tmValue)})]}),a.corValue!==void 0&&a.corValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:G.corValue}}),"COR Approved"]}),e.jsx("span",{className:"chart-tooltip-value",children:n(a.corValue)})]}),a.profit!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:a.profit>=0?G.profit:G.loss}}),a.profit>=0?"Profit":"Loss"]}),e.jsx("span",{className:"chart-tooltip-value",style:{color:a.profit>=0?G.profit:G.loss},children:n(Math.abs(a.profit))})]})]}),(a.dailyRevenue>0||a.dailyLabor>0||a.dailyMaterials>0||a.dailyHaulOff>0||a.dailyTM>0)&&e.jsxs("div",{className:"chart-tooltip-daily",children:[e.jsx("div",{className:"chart-tooltip-daily-label",children:"Today's Activity"}),a.dailyRevenue>0&&e.jsx("div",{className:"chart-tooltip-daily-row earned",children:e.jsxs("span",{style:{color:G.revenue},children:["Areas Completed: ",n(a.dailyRevenue)]})}),a.dailyLabor>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Labor: ",n(a.dailyLabor)]}),a.dailyMaterials>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Materials: ",n(a.dailyMaterials)]}),a.dailyHaulOff>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Disposal: ",n(a.dailyHaulOff)]}),a.dailyTM>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["T&M Added: ",n(a.dailyTM)]}),a.dailyTotal>0&&e.jsx("div",{className:"chart-tooltip-daily-row total",children:e.jsxs("strong",{children:["Day Costs: ",n(a.dailyTotal)]})})]}),e.jsx("div",{className:"chart-tooltip-hint",children:"Click to see details"})]})}function so({projectData:s,project:t,tmTickets:r=[],corStats:n=null,areas:a=[],onDrillDown:l}){const[c,i]=o.useState("30d"),[d,u]=o.useState(null),m=o.useMemo(()=>{const x=Xc(s,t,r,n,a),k=Ba.find(P=>P.id===c);return Qc(x,k?.days)},[s,t,r,n,a,c]),h=o.useMemo(()=>Ka(m,"costs"),[m]),f=o.useMemo(()=>Ka(m,"revenue"),[m]),j=x=>{if(x?.activePayload?.[0]){const k=x.activePayload[0].payload;l?.(k.date,k)}},p=({trend:x})=>x.direction==="up"?e.jsx(hs,{size:14,className:"trend-icon up"}):x.direction==="down"?e.jsx(ps,{size:14,className:"trend-icon down"}):e.jsx($t,{size:14,className:"trend-icon flat"});return m.length?e.jsxs("div",{className:"financial-trend-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[e.jsx("h3",{children:"Financial Trend"}),e.jsxs("div",{className:"chart-trend-indicators",children:[e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:G.revenue},children:"Revenue"}),e.jsx(p,{trend:f}),f.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[f.percentage,"%"]})]}),e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:G.costs},children:"Costs"}),e.jsx(p,{trend:h}),h.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[h.percentage,"%"]})]})]})]}),e.jsx("div",{className:"time-range-selector",children:Ba.map(x=>e.jsx("button",{className:c===x.id?"active":"",onClick:()=>i(x.id),children:x.label},x.id))})]}),e.jsx("div",{className:"chart-container",children:e.jsx(Zs,{width:"100%",height:300,children:e.jsxs(xc,{data:m,onClick:j,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:Object.values(qc).map(x=>e.jsxs("linearGradient",{id:x.id,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:x.color,stopOpacity:x.startOpacity}),e.jsx("stop",{offset:"95%",stopColor:x.color,stopOpacity:x.endOpacity})]},x.id))}),e.jsx(nn,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Mt,{dataKey:"date",tickFormatter:Lt,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(Ot,{tickFormatter:ze,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:!1,width:60}),e.jsx(et,{content:e.jsx(eo,{})}),e.jsx(Es,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,formatter:x=>e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:x})}),m[0]?.contract>0&&e.jsx(hn,{y:m[0].contract,stroke:G.contract,strokeDasharray:"5 5",strokeWidth:2,label:{value:"Contract",position:"right",fill:G.contract,fontSize:11}}),e.jsx(Ns,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:G.revenue,strokeWidth:2,fill:"url(#revenueGradient)",animationDuration:ws.duration,onMouseEnter:()=>u("revenue"),onMouseLeave:()=>u(null),style:{opacity:d&&d!=="revenue"?.3:1}}),e.jsx(Ns,{type:"monotone",dataKey:"costs",name:"Costs",stroke:G.costs,strokeWidth:2,fill:"url(#costsGradient)",animationDuration:ws.duration,onMouseEnter:()=>u("costs"),onMouseLeave:()=>u(null),style:{opacity:d&&d!=="costs"?.3:1}}),m.some(x=>x.tmValue>0)&&e.jsx(Ns,{type:"monotone",dataKey:"tmValue",name:"T&M Value",stroke:G.tmValue,strokeWidth:2,fill:"url(#tmValueGradient)",animationDuration:ws.duration,onMouseEnter:()=>u("tmValue"),onMouseLeave:()=>u(null),style:{opacity:d&&d!=="tmValue"?.3:1}}),m.some(x=>x.corValue>0)&&e.jsx(Ns,{type:"monotone",dataKey:"corValue",name:"COR Approved",stroke:G.corValue,strokeWidth:2,strokeDasharray:"4 2",fill:"transparent",animationDuration:ws.duration,onMouseEnter:()=>u("corValue"),onMouseLeave:()=>u(null),style:{opacity:d&&d!=="corValue"?.3:1}})]})})}),e.jsxs("div",{className:"chart-quick-stats",children:[e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Current Revenue"}),e.jsx("span",{className:"stat-value",style:{color:G.revenue},children:ze(m[m.length-1]?.revenue||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Total Costs"}),e.jsx("span",{className:"stat-value",style:{color:G.costs},children:ze(m[m.length-1]?.costs||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Margin"}),e.jsx("span",{className:"stat-value",style:{color:(m[m.length-1]?.profit||0)>=0?G.profit:G.loss},children:(()=>{const x=m[m.length-1];return!x||!x.revenue?"0%":`${((x.revenue-x.costs)/x.revenue*100).toFixed(1)}%`})()})]}),m[m.length-1]?.tmValue>0&&e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"T&M Pending"}),e.jsx("span",{className:"stat-value",style:{color:G.tmValue},children:ze(m[m.length-1]?.tmValue||0)})]})]})]}):e.jsx("div",{className:"financial-trend-chart empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No financial data available yet."}),e.jsx("span",{children:"Start tracking labor and costs to see trends."})]})})}function to({laborCost:s=0,haulOffCost:t=0,customCosts:r=[],onSegmentClick:n}){const[a,l]=o.useState(null),c=o.useMemo(()=>Zc(s,t,r),[s,t,r]),i=o.useMemo(()=>c.reduce((j,p)=>j+p.value,0),[c]),d=(j,p)=>{l(p)},u=()=>{l(null)},m=(j,p)=>{n&&n(c[p])},h=({active:j,payload:p})=>{if(!j||!p||!p.length)return null;const x=p[0].payload;return e.jsxs("div",{className:"chart-tooltip donut-tooltip",children:[e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:x.color}}),x.name]}),e.jsx("span",{className:"chart-tooltip-value",children:ze(x.value)})]}),e.jsxs("div",{className:"donut-tooltip-pct",children:[x.percentage,"% of total costs"]}),x.items&&x.items.length>0&&e.jsx("div",{className:"donut-tooltip-items",children:e.jsxs("div",{className:"donut-tooltip-items-label",children:[x.items.length," item",x.items.length>1?"s":""]})}),n&&e.jsx("div",{className:"chart-tooltip-hint",children:"Click to view details"})]})},f=j=>{const{payload:p}=j;return e.jsx("div",{className:"donut-legend",children:p.map((x,k)=>e.jsxs("div",{className:`donut-legend-item ${a===k?"active":""}`,onMouseEnter:()=>l(k),onMouseLeave:()=>l(null),onClick:()=>m(null,k),children:[e.jsx("span",{className:"donut-legend-color",style:{backgroundColor:x.payload.color}}),e.jsx("span",{className:"donut-legend-name",children:x.value}),e.jsx("span",{className:"donut-legend-value",children:ze(x.payload.value)})]},`legend-${k}`))})};return!c.length||i===0?e.jsx("div",{className:"cost-donut empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No cost data available."}),e.jsx("span",{children:"Add labor, disposal, or custom costs to see breakdown."})]})}):e.jsx("div",{className:"cost-donut",children:e.jsxs("div",{className:"donut-chart-container",children:[e.jsx(Zs,{width:"100%",height:200,children:e.jsxs(Pi,{children:[e.jsx(Ti,{data:c,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",onMouseEnter:d,onMouseLeave:u,onClick:m,animationDuration:ws.duration,animationEasing:"ease-out",children:c.map((j,p)=>e.jsx(Fi,{fill:j.color,stroke:"var(--card-bg)",strokeWidth:2,style:{filter:a===p?"brightness(1.1)":"none",cursor:n?"pointer":"default",transform:a===p?"scale(1.05)":"scale(1)",transformOrigin:"center",transition:"all 0.2s ease"}},`cell-${p}`))}),e.jsx(et,{content:e.jsx(h,{})}),e.jsx(Es,{content:f})]})}),e.jsxs("div",{className:"donut-center-label",children:[e.jsx("span",{className:"donut-center-value",children:ze(i)}),e.jsx("span",{className:"donut-center-text",children:"Total"})]})]})})}const Ge=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0);function ao({revenue:s,totalCosts:t,contractValue:r,progress:n}){const a=s-t,l=s>0?a/s*100:0,c=r,i=n>0?t/(n/100):t,d=c-i,u=c>0?d/c*100:0,m=l>=20,h=l>=0&&l<20,f=l<0,j=m?"healthy":h?"warning":"loss",p=m?"On Track":h?"Watch Margin":"Over Cost",x=m?Gi:h?Ds:ps;return e.jsxs("div",{className:`profitability-card ${j}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${j}`,children:[e.jsx(x,{size:14}),e.jsx("span",{children:p})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${l<0?"negative":""}`,children:[Math.round(l),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${l<0?"negative":l<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(l),100)}%`}})})]}),n>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${u<0?"negative":""}`,children:[Math.round(u),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${u<0?"negative":u<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(u),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:Ge(s)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",Ge(t)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${a<0?"negative":"positive"}`,children:[a>=0?"":"-",Ge(Math.abs(a))]})]})]}),n>10&&e.jsxs("div",{className:"profitability-insight",children:[m&&e.jsxs("p",{children:["At ",Math.round(n),"% complete, you're at ",Ge(a)," profit.",d>0&&` Projected final profit: ${Ge(d)}`]}),h&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",d<0&&` Trending toward ${Ge(d)} loss.`]}),f&&e.jsxs("p",{children:["Currently over cost by ",Ge(Math.abs(a)),". Immediate review recommended."]})]})]})}const yt=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Us={labor:{label:"Labor",Icon:Je,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Xe,color:"#10b981"},equipment:{label:"Equipment",Icon:Ct,color:"#f59e0b"},materials:{label:"Materials",Icon:Hs,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:De,color:"#ec4899"},other:{label:"Other",Icon:Yi,color:"#6b7280"}};function no({laborCost:s=0,haulOffCost:t=0,customCosts:r=[],onAddCost:n,onDeleteCost:a}){const[l,c]=o.useState(!0),[i,d]=o.useState(null),u=[];s>0&&u.push({category:"labor",label:"Labor",amount:s,source:"auto",description:"From crew check-ins"}),t>0&&u.push({category:"disposal",label:"Disposal",amount:t,source:"auto",description:"From haul-off logs"});const m={};r.forEach(p=>{m[p.category]||(m[p.category]={category:p.category,items:[],total:0}),m[p.category].items.push(p),m[p.category].total+=parseFloat(p.amount)||0}),Object.values(m).forEach(p=>{const x=Us[p.category]||Us.other;u.push({category:p.category,label:x.label,amount:p.total,source:"manual",items:p.items})});const h=u.reduce((p,x)=>p+x.amount,0);u.forEach(p=>{p.percentage=h>0?p.amount/h*100:0}),u.sort((p,x)=>x.amount-p.amount);const f=p=>{d(i===p?null:p)},j=p=>{p.items&&p.items.length>0&&(c(!1),d(p.category))};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsxs("div",{className:"cost-contributors-title",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:yt(h)})]}),u.length>0&&e.jsxs("div",{className:"cost-view-toggle",children:[e.jsx("button",{className:l?"active":"",onClick:()=>c(!0),children:"Chart"}),e.jsx("button",{className:l?"":"active",onClick:()=>c(!1),children:"List"})]})]}),u.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):l?e.jsx(to,{laborCost:s,haulOffCost:t,customCosts:r,onSegmentClick:j}):e.jsx("div",{className:"cost-breakdown",children:u.map(p=>{const x=Us[p.category]||Us.other,k=x.Icon,P=p.items&&p.items.length>0,g=i===p.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${P?"expandable":""}`,onClick:()=>P&&f(p.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(p.percentage,2)}%`,backgroundColor:x.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(k,{size:14,style:{color:x.color}}),e.jsx("span",{children:p.label}),p.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),P&&(g?e.jsx(tt,{size:14}):e.jsx(es,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:yt(p.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(p.percentage),"%"]})]})]})]}),g&&P&&e.jsx("div",{className:"cost-category-items",children:p.items.map(A=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:A.description}),e.jsx("span",{className:"cost-item-date",children:new Date(A.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:yt(A.amount)}),a&&e.jsx("button",{className:"cost-item-delete",onClick:v=>{v.stopPropagation(),confirm("Delete this cost entry?")&&a(A.id)},children:e.jsx(mn,{size:14})})]})]},A.id))})]},p.category)})}),n&&e.jsxs("button",{className:"cost-add-btn",onClick:n,children:[e.jsx(_s,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const wn=[{value:"concrete",label:"Concrete",icon:"🧱"},{value:"trash",label:"Trash",icon:"🗑️"},{value:"metals",label:"Metals",icon:"🔩"},{value:"hazardous_waste",label:"Hazardous",icon:"☣️"}],ro=s=>wn.find(t=>t.value===s)||{label:s,icon:"📦"};function io({project:s,period:t="week"}){const[r,n]=o.useState([]),[a,l]=o.useState(!0),[c,i]=o.useState(!1);o.useEffect(()=>{s?.id&&d()},[s?.id,t]);const d=async()=>{try{l(!0);const p=t==="week"?7:t==="month"?30:14,x=await q.getDisposalLoadsHistory(s.id,p);n(x||[])}catch(p){console.error("Error loading disposal summary:",p)}finally{l(!1)}},u=r.reduce((p,x)=>{const k=x.load_type;return p[k]||(p[k]=0),p[k]+=x.load_count,p},{}),m=r.reduce((p,x)=>{const k=x.load_date||x.work_date;return p[k]||(p[k]={date:k,loads:[],total:0}),p[k].loads.push(x),p[k].total+=x.load_count,p},{}),h=Object.values(m).sort((p,x)=>new Date(x.date)-new Date(p.date)).slice(0,7),f=r.reduce((p,x)=>p+x.load_count,0),j=f>0;return a?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Xe,{size:18}),e.jsx("span",{children:"Disposal Loads"})]})}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Xe,{size:18}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("span",{className:"period-badge",children:t==="week"?"Last 7 days":t==="month"?"Last 30 days":"Last 14 days"})]}),j?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"disposal-total-value",children:f}),e.jsx("span",{className:"disposal-total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:wn.map(p=>{const x=u[p.value]||0;if(x===0)return null;const k=Math.round(x/f*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"disposal-type-info",children:[e.jsx("span",{className:"disposal-type-icon",children:p.icon}),e.jsx("span",{className:"disposal-type-label",children:p.label})]}),e.jsxs("div",{className:"disposal-type-stats",children:[e.jsx("span",{className:"disposal-type-count",children:x}),e.jsx("div",{className:"disposal-type-bar",children:e.jsx("div",{className:"disposal-type-bar-fill",style:{width:`${k}%`}})})]})]},p.value)})}),h.length>0&&e.jsxs("button",{className:"disposal-expand-btn",onClick:()=>i(!c),children:[c?e.jsx(tt,{size:16}):e.jsx(es,{size:16}),e.jsxs("span",{children:[c?"Hide":"View"," Daily Breakdown"]})]}),c&&h.length>0&&e.jsx("div",{className:"disposal-daily-breakdown",children:h.map(p=>{const x=new Date(p.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),k=p.loads.reduce((P,g)=>(P[g.load_type]||(P[g.load_type]=0),P[g.load_type]+=g.load_count,P),{});return e.jsxs("div",{className:"disposal-daily-row",children:[e.jsxs("div",{className:"disposal-daily-header",children:[e.jsx("span",{className:"disposal-daily-date",children:x}),e.jsxs("span",{className:"disposal-daily-total",children:[p.total," loads"]})]}),e.jsx("div",{className:"disposal-daily-types",children:Object.entries(k).map(([P,g])=>{const A=ro(P);return e.jsxs("span",{className:"disposal-daily-type",children:[A.icon," ",g]},P)})})]},p.date)})})]}):e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx(Xe,{size:32}),e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("span",{className:"text-muted",children:"Loads will appear here when logged by field crews"})]})]})}const Nt=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",lo=o.memo(function({project:t,onAddEquipment:r,onEditEquipment:n,onShowToast:a}){const[l,c]=o.useState([]),[i,d]=o.useState(!0),[u,m]=o.useState(!0),[h,f]=o.useState(0),j=o.useCallback(async()=>{if(t?.id)try{d(!0);const g=await ns.getProjectEquipment(t.id);c(g||[]);const A=ns.calculateProjectEquipmentCost(g||[]);f(A)}catch(g){console.error("Error loading equipment:",g),a?.("Failed to load equipment","error")}finally{d(!1)}},[t?.id]);o.useEffect(()=>{j()},[j]);const p=o.useCallback(async g=>{try{await ns.markEquipmentReturned(g.id),a?.(`${g.equipment_name} marked as returned`,"success"),j()}catch(A){console.error("Error marking equipment returned:",A),a?.("Failed to update equipment","error")}},[j]),x=o.useCallback(async g=>{if(confirm(`Remove ${g.equipment_name} from this project?`))try{await ns.removeEquipmentFromProject(g.id),a?.("Equipment removed","success"),j()}catch(A){console.error("Error removing equipment:",A),a?.("Failed to remove equipment","error")}},[j]),k=o.useMemo(()=>l.filter(g=>!g.end_date),[l]),P=o.useMemo(()=>l.filter(g=>g.end_date),[l]);return e.jsxs("div",{className:"project-equipment-card",children:[e.jsxs("div",{className:"project-equipment-header",children:[e.jsxs("div",{className:"project-equipment-title",children:[e.jsx(Xe,{size:18}),e.jsx("h3",{children:"Equipment on Site"}),l.length>0&&e.jsxs("span",{className:"equipment-count",children:[k.length," active"]})]}),e.jsxs("div",{className:"project-equipment-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>r?.(),title:"Add equipment",children:[e.jsx(_s,{size:14}),e.jsx("span",{children:"Add"})]}),l.length>0&&e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>m(!u),children:u?e.jsx(tt,{size:16}):e.jsx(es,{size:16})})]})]}),i?e.jsx("div",{className:"equipment-loading",children:e.jsx("div",{className:"loading-spinner small"})}):l.length===0?e.jsxs("div",{className:"equipment-empty",children:[e.jsx("p",{children:"No equipment tracked on this project"}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>r?.(),children:[e.jsx(_s,{size:14}),"Track Equipment"]})]}):u?e.jsxs(e.Fragment,{children:[k.length>0&&e.jsx("div",{className:"equipment-list",children:k.map(g=>{const A=ns.calculateDaysOnSite(g.start_date,g.end_date),v=g.daily_rate*A;return e.jsxs("div",{className:"equipment-item active",children:[e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:g.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[e.jsx(st,{size:12}),"On-site since ",Nt(g.start_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-rate",children:[be(g.daily_rate),"/day"]}),e.jsxs("span",{className:"equipment-days",children:[A," days"]}),e.jsx("span",{className:"equipment-total",children:be(v)})]})]}),e.jsxs("div",{className:"equipment-item-actions",children:[e.jsxs("button",{className:"btn btn-xs btn-outline",onClick:()=>p(g),title:"Mark as returned",children:[e.jsx(Ji,{size:12}),"Returned"]}),e.jsx("button",{className:"btn btn-xs btn-ghost",onClick:()=>n?.(g),title:"Edit",children:e.jsx(Xi,{size:12})}),e.jsx("button",{className:"btn btn-xs btn-ghost text-danger",onClick:()=>x(g),title:"Remove",children:e.jsx(mn,{size:12})})]})]},g.id)})}),P.length>0&&e.jsxs("details",{className:"equipment-returned-section",children:[e.jsx("summary",{className:"equipment-returned-toggle",children:e.jsxs("span",{children:["Returned Equipment (",P.length,")"]})}),e.jsx("div",{className:"equipment-list returned",children:P.map(g=>{const A=ns.calculateDaysOnSite(g.start_date,g.end_date),v=g.daily_rate*A;return e.jsx("div",{className:"equipment-item returned",children:e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:g.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[Nt(g.start_date)," - ",Nt(g.end_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-days",children:[A," days"]}),e.jsx("span",{className:"equipment-total",children:be(v)})]})]})},g.id)})})]}),e.jsxs("div",{className:"equipment-total-row",children:[e.jsx("span",{children:"Total Equipment Cost"}),e.jsx("span",{className:"equipment-grand-total",children:be(h)})]})]}):e.jsxs("div",{className:"equipment-summary-collapsed",children:[e.jsxs("span",{children:[k.length," active, ",P.length," returned"]}),e.jsx("span",{className:"equipment-grand-total",children:be(h)})]})]})}),co=o.memo(function({project:t,areas:r=[],corStats:n={},onCreateDraw:a,onViewDraw:l,onShowToast:c}){const[i,d]=o.useState([]),[u,m]=o.useState(!0),h=o.useMemo(()=>r.reduce((v,N)=>{const F=(N.square_footage||0)*(N.price_per_sqft||0);return v+Math.round(F*100)},0),[r]),f=o.useMemo(()=>n?.approvedTotal||0,[n?.approvedTotal]),j=h+f,p=o.useCallback(async()=>{if(t?.id)try{m(!0);const v=await Ai.getProjectDrawRequests(t.id);d(v||[])}catch(v){console.error("Error loading draw requests:",v)}finally{m(!1)}},[t?.id]);o.useEffect(()=>{p()},[p]);const x=o.useMemo(()=>{const v=i.filter(S=>["submitted","approved","paid"].includes(S.status)),N=v.reduce((S,_)=>S+(_.previous_billings||0)+(_.current_billing||0),0),O=v[0]?.retention_held||0;return{billedToDate:N,retentionHeld:O}},[i]),k=j>0?Math.round(x.billedToDate/j*100):0,P=i.length>0?Math.max(...i.map(v=>v.draw_number))+1:1,g=v=>v?new Date(v).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",A=v=>{switch(v){case"draft":return e.jsx("span",{className:"badge badge-muted",children:"Draft"});case"submitted":return e.jsx("span",{className:"badge badge-warning",children:"Submitted"});case"approved":return e.jsx("span",{className:"badge badge-success",children:"Approved"});case"paid":return e.jsx("span",{className:"badge badge-info",children:"Paid"});case"rejected":return e.jsx("span",{className:"badge badge-danger",children:"Rejected"});default:return null}};return e.jsxs("div",{className:"progress-billing-card",children:[e.jsxs("div",{className:"progress-billing-header",children:[e.jsxs("div",{className:"progress-billing-title",children:[e.jsx(Qi,{size:18}),e.jsx("h3",{children:"Progress Billing"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>a?.(),disabled:h===0,title:h===0?"Add areas with contract values first":`Create Draw #${P}`,children:[e.jsx(_s,{size:14}),e.jsxs("span",{children:["Draw #",P]})]})]}),e.jsxs("div",{className:"progress-billing-contract",children:[e.jsxs("div",{className:"contract-row",children:[e.jsx("span",{className:"contract-label",children:"Original Contract"}),e.jsx("span",{className:"contract-value",children:be(h)})]}),f>0&&e.jsxs("div",{className:"contract-row co",children:[e.jsx("span",{className:"contract-label",children:"Approved COs"}),e.jsxs("span",{className:"contract-value positive",children:["+",be(f)]})]}),e.jsxs("div",{className:"contract-row revised",children:[e.jsx("span",{className:"contract-label",children:"Revised Contract"}),e.jsx("span",{className:"contract-value",children:be(j)})]})]}),e.jsxs("div",{className:"progress-billing-status",children:[e.jsx("div",{className:"billing-progress-bar",children:e.jsx("div",{className:"billing-progress-fill",style:{width:`${Math.min(k,100)}%`}})}),e.jsxs("div",{className:"billing-stats",children:[e.jsxs("div",{className:"billing-stat",children:[e.jsx("span",{className:"billing-stat-value",children:be(x.billedToDate)}),e.jsxs("span",{className:"billing-stat-label",children:["Billed to Date (",k,"%)"]})]}),x.retentionHeld>0&&e.jsxs("div",{className:"billing-stat retention",children:[e.jsxs("span",{className:"billing-stat-value",children:["-",be(x.retentionHeld)]}),e.jsx("span",{className:"billing-stat-label",children:"Retention Held"})]}),e.jsxs("div",{className:"billing-stat remaining",children:[e.jsx("span",{className:"billing-stat-value",children:be(j-x.billedToDate)}),e.jsx("span",{className:"billing-stat-label",children:"Balance to Finish"})]})]})]}),u?e.jsx("div",{className:"progress-billing-loading",children:e.jsx("div",{className:"loading-spinner small"})}):i.length===0?e.jsxs("div",{className:"progress-billing-empty",children:[e.jsx("p",{children:"No draw requests yet"}),h>0&&e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>a?.(),children:[e.jsx(_s,{size:14}),"Create First Draw Request"]})]}):e.jsxs("div",{className:"progress-billing-draws",children:[e.jsx("div",{className:"draws-header",children:e.jsx("span",{children:"Recent Draws"})}),e.jsx("div",{className:"draws-list",children:i.slice(0,3).map(v=>e.jsxs("button",{className:"draw-item",onClick:()=>l?.(v),children:[e.jsxs("div",{className:"draw-item-info",children:[e.jsxs("span",{className:"draw-number",children:["Draw #",v.draw_number]}),e.jsx("span",{className:"draw-date",children:g(v.period_end||v.created_at)})]}),e.jsx("div",{className:"draw-item-amount",children:be(v.current_billing||0)}),A(v.status),e.jsx(qe,{size:16,className:"draw-item-arrow"})]},v.id))}),i.length>3&&e.jsxs("button",{className:"btn btn-sm btn-ghost view-all-draws",children:["View all ",i.length," draws"]})]})]})});function oo({project:s,company:t,onShowToast:r}){const[n,a]=o.useState(null),[l,c]=o.useState(!0),[i,d]=o.useState(!1);o.useEffect(()=>{if(s?.id&&t?.id){u();const p=q.subscribeToCrewCheckins?.(s.id,()=>{u()});return()=>{p&&q.unsubscribe?.(p)}}},[s?.id,t?.id]);const u=async()=>{try{const p=await q.calculateManDayCosts(s.id,t.id,s.work_type||"demolition",s.job_type||"standard");a(p)}catch(p){console.error("Error loading man day costs:",p)}finally{c(!1)}},m=p=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(p),h=p=>new Date(p).toLocaleDateString("en-US",{month:"short",day:"numeric"}),f=p=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[p]||p.charAt(0).toUpperCase()+p.slice(1);if(l)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!n||n.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Je,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const j=Object.entries(n.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>d(!i),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:m(n.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:i?"▼ Collapse":"▶ Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:n.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:n.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:m(n.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:n.daysWorked>0?m(n.totalCost/n.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),i&&e.jsxs("div",{className:"man-day-details",children:[j.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:j.map(([p,x])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:f(p)}),e.jsxs("span",{className:"role-rate",children:[m(x.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[x.count," days"]}),e.jsx("span",{className:"role-cost",children:m(x.cost)})]})]},p))})]}),n.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:n.byDate.slice(0,7).map((p,x)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:h(p.date)}),e.jsxs("span",{className:"date-workers",children:[p.workers," crew"]}),e.jsx("span",{className:"date-cost",children:m(p.cost)})]},x))}),n.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",n.byDate.length-7," more days"]})]})]})]})}const Ie=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),uo=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"});function mo({dailyBurn:s,totalBurn:t,daysWorked:r,laborCost:n,materialsEquipmentCost:a=0,progress:l,contractValue:c,laborByDate:i=[],materialsEquipmentByDate:d=[]}){const[u,m]=o.useState(!1),h=c*(l/100)*.6,f=t<=h?"on-budget":t<=h*1.2?"warning":"over-budget",j={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[f],p=f==="on-budget"?ps:f==="warning"?$t:hs,k=l>0?t/(l/100):0,P=[],g={};i.forEach(v=>{g[v.date]||(g[v.date]={date:v.date,labor:0,materialsEquipment:0,total:0}),g[v.date].labor=v.cost||0,g[v.date].total+=v.cost||0}),d.forEach(v=>{g[v.date]||(g[v.date]={date:v.date,labor:0,materialsEquipment:0,total:0}),g[v.date].materialsEquipment=v.cost||0,g[v.date].total+=v.cost||0}),Object.values(g).sort((v,N)=>new Date(N.date)-new Date(v.date)).slice(0,10).forEach(v=>P.push(v));const A=Math.max(...P.map(v=>v.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(Zi,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${f}`,children:[e.jsx(p,{size:14}),e.jsx("span",{children:j})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:Ie(s)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),r>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",r," work day",r!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:Ie(t)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:Ie(n)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Materials"}),e.jsx("span",{className:"burn-summary-value",children:Ie(a)})]})]}),l>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${k>c*.7?"warning":""}`,children:Ie(k)})]}),P.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>m(!u),children:[u?e.jsx(tt,{size:16}):e.jsx(es,{size:16}),e.jsxs("span",{children:[u?"Hide":"View"," Daily Breakdown"]})]}),u&&P.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Materials"}),e.jsx("span",{children:"Total"})]}),P.map(v=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:uo(v.date)}),e.jsx("span",{className:"burn-labor",children:v.labor>0?Ie(v.labor):"-"}),e.jsx("span",{className:"burn-materials",children:v.materialsEquipment>0?Ie(v.materialsEquipment):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${v.total/A*100}%`}}),e.jsx("span",{className:"burn-amount",children:Ie(v.total)})]})]},v.date))]})]})}const ho=()=>oe(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]);function po({project:s,company:t,onShowToast:r}){const{branding:n}=rn(),[a,l]=o.useState([]),[c,i]=o.useState(!0),[d,u]=o.useState(null),[m,h]=o.useState(null),[f,j]=o.useState(new Set),[p,x]=o.useState(!1),[k,P]=o.useState("recent"),[g,A]=o.useState(new Set),[v,N]=o.useState({start:"",end:""});o.useEffect(()=>{F();const b=q.subscribeToDailyReports?.(s.id,()=>{F()});return()=>{b&&q.unsubscribe?.(b)}},[s.id]);const F=o.useCallback(async()=>{try{u(null);const b=await q.getDailyReports(s.id,365);l(b||[])}catch(b){console.error("Error loading daily reports:",b),u(b),r?.("Error loading daily reports","error")}finally{i(!1)}},[s.id]),O=o.useMemo(()=>{let b=[...a];if(v.start){const C=new Date(v.start);C.setHours(0,0,0,0),b=b.filter(W=>new Date(W.report_date||W.created_at)>=C)}if(v.end){const C=new Date(v.end);C.setHours(23,59,59,999),b=b.filter(W=>new Date(W.report_date||W.created_at)<=C)}if(k==="recent"){const C=new Date;C.setDate(C.getDate()-7),C.setHours(0,0,0,0),b=b.filter(W=>new Date(W.report_date||W.created_at)>=C)}return b},[a,k,v]),S=o.useMemo(()=>{if(k!=="all")return null;const b={};return O.forEach(C=>{const W=new Date(C.report_date||C.created_at),E=`${W.getFullYear()}-${String(W.getMonth()+1).padStart(2,"0")}`,Y=W.toLocaleDateString("en-US",{month:"long",year:"numeric"});b[E]||(b[E]={label:Y,reports:[]}),b[E].reports.push(C)}),Object.entries(b).sort((C,W)=>W[0].localeCompare(C[0]))},[O,k]);o.useEffect(()=>{if(S&&S.length>0){const b=S[0][0];A(new Set([b]))}},[S]);const _=()=>{x(!p),p&&j(new Set)},T=b=>{const C=new Set(f);C.has(b)?C.delete(b):C.add(b),j(C)},L=()=>{f.size===O.length?j(new Set):j(new Set(O.map(b=>b.id)))},M=b=>{const C=new Set(g);C.has(b)?C.delete(b):C.add(b),A(C)},V=()=>f.size>0?O.filter(b=>f.has(b.id)):O,R=b=>new Date(b).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),se=b=>new Date(b).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),$=b=>{switch(b){case"submitted":return"✓";case"reviewed":return"✓✓";case"draft":return"○";default:return"○"}},re=b=>{switch(b){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return b}},ue=async()=>{const b=V();if(b.length===0){r?.("No reports to export","error");return}r?.("Generating PDF...","info");const W=(await ho()).default,E=new W,Y=E.internal.pageSize.getWidth(),X=20;let Z=X;const Ee=Cs(n?.primary_color||"#3B82F6"),Ve=Cs(n?.secondary_color||"#1E40AF");E.setFillColor(...Ee),E.rect(0,0,Y,45,"F"),E.setFillColor(...Ve),E.rect(0,42,Y,3,"F");let Be=X;if(n?.logo_url)try{const ee=await ln(n.logo_url);ee&&(E.addImage(ee,"PNG",X,7,30,30),Be=X+40)}catch(ee){console.error("Error adding logo:",ee)}E.setTextColor(255,255,255),E.setFontSize(22),E.setFont("helvetica","bold"),E.text(t?.name||"Company Name",Be,20),E.setFontSize(10),E.setFont("helvetica","normal"),E.text("DAILY REPORTS SUMMARY",Be,30),E.setFontSize(9),E.text(`Generated: ${new Date().toLocaleDateString()}`,Y-X,20,{align:"right"}),s.job_number&&E.text(`Job #: ${s.job_number}`,Y-X,28,{align:"right"}),Z=55,E.setFillColor(248,250,252),E.rect(X,Z-5,Y-X*2,20,"F"),E.setTextColor(...Ee),E.setFontSize(14),E.setFont("helvetica","bold"),E.text(`Project: ${s.name}`,X+5,Z+7),E.setFontSize(10),E.setTextColor(100,100,100),E.text(`${b.length} Report${b.length!==1?"s":""}`,Y-X-5,Z+7,{align:"right"}),Z+=25,b.forEach((ee,Re)=>{Z>250&&(E.addPage(),Z=X),E.setFillColor(...Ee),E.setTextColor(255,255,255),E.rect(X,Z,Y-X*2,10,"F"),E.setFontSize(11),E.setFont("helvetica","bold"),E.text(R(ee.report_date||ee.created_at),X+5,Z+7),E.text(re(ee.status),Y-X-5,Z+7,{align:"right"}),Z+=15,E.setTextColor(50,50,50),E.setFontSize(10),E.setFont("helvetica","normal");const ss=`Crew: ${ee.crew_count||0}  |  Tasks: ${ee.tasks_completed||0}  |  T&M: ${ee.tm_tickets_count||0}  |  Photos: ${ee.photos_count||0}`;if(E.text(ss,X+5,Z),Z+=8,ee.crew_list?.length>0){E.setFont("helvetica","bold"),E.text("Crew:",X+5,Z),E.setFont("helvetica","normal");const _e=ee.crew_list.map(Ts=>`${Ts.name} (${Ts.role})`).join(", "),We=E.splitTextToSize(_e,Y-X*2-30);E.text(We,X+25,Z),Z+=We.length*5+3}if(ee.field_notes){E.setFont("helvetica","bold"),E.text("Notes:",X+5,Z),E.setFont("helvetica","normal");const _e=E.splitTextToSize(ee.field_notes,Y-X*2-30);E.text(_e,X+25,Z),Z+=_e.length*5+3}if(ee.issues){E.setTextColor(180,50,50),E.setFont("helvetica","bold"),E.text("Issues:",X+5,Z),E.setFont("helvetica","normal");const _e=E.splitTextToSize(ee.issues,Y-X*2-30);E.text(_e,X+25,Z),E.setTextColor(50,50,50),Z+=_e.length*5+3}Z+=10});const J=E.internal.getNumberOfPages();for(let ee=1;ee<=J;ee++)E.setPage(ee),E.setFontSize(8),E.setTextColor(150,150,150),E.text(`Page ${ee} of ${J}`,Y/2,E.internal.pageSize.getHeight()-10,{align:"center"});const vs=`${s.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;E.save(vs),r?.("PDF exported!","success")},le=b=>e.jsxs("div",{className:`daily-report-card ${b.status} ${f.has(b.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>h(m===b.id?null:b.id),children:[p&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:f.has(b.id),onChange:C=>{C.stopPropagation(),T(b.id)},onClick:C=>C.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:R(b.report_date||b.created_at)}),e.jsxs("span",{className:`report-status ${b.status}`,children:[$(b.status)," ",re(b.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[b.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[b.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:m===b.id?"▼":"▶"})]})]}),m===b.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),b.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:b.crew_list.map((C,W)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:C.name}),e.jsx("span",{className:"crew-role",children:C.role})]},W))})]}),b.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:b.completed_tasks.map((C,W)=>e.jsxs("li",{children:[C.name,C.group&&e.jsx("span",{className:"task-group",children:C.group})]},W))})]}),b.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:b.field_notes})]}),b.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:b.issues})]}),b.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",b.submitted_by||"Field"," at ",se(b.submitted_at)]})})]})]},b.id);if(c)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});if(d)return e.jsx("div",{className:"daily-reports-list card",children:e.jsx(Nn,{title:"Unable to load reports",message:"There was a problem loading daily reports. Please try again.",error:d,onRetry:F})});const ke=a.length,I=O.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${p?"btn-primary":"btn-secondary"}`,onClick:_,children:p?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:ue,children:["PDF",f.size>0?` (${f.size})`:""]})]})})]}),a.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${k==="recent"?"active":""}`,onClick:()=>P("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${k==="all"?"active":""}`,onClick:()=>P("all"),children:["All (",ke,")"]})]}),k==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(st,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:v.start,onChange:b=>N(C=>({...C,start:b.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:v.end,onChange:b=>N(C=>({...C,end:b.target.value})),className:"date-input"}),(v.start||v.end)&&e.jsx("button",{className:"date-clear",onClick:()=>N({start:"",end:""}),children:"Clear"})]})]}),p&&O.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:f.size===O.length&&O.length>0,onChange:L}),"Select All (",O.length,")"]}),f.size>0&&e.jsxs("span",{className:"selected-count",children:[f.size," selected"]})]}),a.length===0?e.jsx(Ua,{icon:xe,title:"No daily reports yet",message:"Reports from the field will appear here"}):O.length===0?e.jsx(Ua,{icon:xe,title:"No reports in this time period",message:k==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"}):k==="recent"?e.jsxs("div",{className:"daily-reports",children:[O.map(b=>le(b)),ke>I&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>P("all"),children:["View All ",ke," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:S?.map(([b,{label:C,reports:W}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>M(b),children:[g.has(b)?e.jsx(es,{size:18,className:"month-chevron"}):e.jsx(qe,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:C}),e.jsxs("span",{className:"month-count",children:[W.length," report",W.length!==1?"s":""]})]}),g.has(b)&&e.jsx("div",{className:"month-reports",children:W.map(E=>le(E))})]},b))})]})}const Ga=o.memo(function({report:t,formatDate:r,formatTime:n,getInjuryTypeColor:a,getInjuryTypeLabel:l,getStatusColor:c,onViewDetails:i}){const d=()=>i(t),u=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),i(t))};return e.jsxs("div",{className:"report-card",onClick:d,onKeyDown:u,role:"button",tabIndex:0,"aria-label":`Injury report for ${t.employee_name} on ${r(t.incident_date)}`,children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[r(t.incident_date)," at ",n(t.incident_time)]}),e.jsx("div",{className:"employee-name",children:t.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:a(t.injury_type)},children:l(t.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:c(t.status)},children:t.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",t.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",t.reported_by_name," (",t.reported_by_title,")"]}),t.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",t.body_part_affected]}),t.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[t.incident_description.substring(0,150),t.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]})}),xo=()=>oe(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]);function vo({project:s,companyId:t,company:r,user:n,onShowToast:a}){const{branding:l}=rn(),[c,i]=o.useState([]),[d,u]=o.useState(null),[m,h]=o.useState(!1),[f,j]=o.useState(!0),[p,x]=o.useState(null),[k,P]=o.useState(null),[g,A]=o.useState("recent"),[v,N]=o.useState(new Set),[F,O]=o.useState({start:"",end:""});o.useEffect(()=>{S();const I=t||s?.company_id,b=I?q.subscribeToInjuryReports?.(I,()=>{S()}):null;return()=>{b&&q.unsubscribe?.(b)}},[s?.id,t]);const S=o.useCallback(async()=>{j(!0),x(null);try{const I=s?await q.getInjuryReports(s.id):await q.getCompanyInjuryReports(t);i(I)}catch(I){console.error("Error loading injury reports:",I),x(I),P({type:"error",message:"Failed to load injury reports"})}finally{j(!1)}},[s?.id,t]),_=()=>{S(),h(!1),P({type:"success",message:"Injury report created successfully"})},T=I=>{u(I)},L=()=>{u(null)},M=I=>I?new Date(I).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",V=I=>I?new Date(`2000-01-01T${I}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",R=I=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[I]||I,se=I=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[I]||"#9ca3af",$=I=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[I]||"#9ca3af",re=o.useMemo(()=>{let I=[...c];if(F.start){const b=new Date(F.start);b.setHours(0,0,0,0),I=I.filter(C=>new Date(C.incident_date)>=b)}if(F.end){const b=new Date(F.end);b.setHours(23,59,59,999),I=I.filter(C=>new Date(C.incident_date)<=b)}if(g==="recent"){const b=new Date;b.setDate(b.getDate()-7),b.setHours(0,0,0,0),I=I.filter(C=>new Date(C.incident_date)>=b)}return I},[c,g,F]),ue=o.useMemo(()=>{if(g!=="all")return null;const I={};return re.forEach(b=>{const C=new Date(b.incident_date),W=`${C.getFullYear()}-${String(C.getMonth()+1).padStart(2,"0")}`,E=C.toLocaleDateString("en-US",{month:"long",year:"numeric"});I[W]||(I[W]={label:E,reports:[]}),I[W].reports.push(b)}),Object.entries(I).sort((b,C)=>C[0].localeCompare(b[0]))},[re,g]);o.useEffect(()=>{if(ue&&ue.length>0){const I=ue[0][0];N(new Set([I]))}},[ue]);const le=I=>{const b=new Set(v);b.has(I)?b.delete(I):b.add(I),N(b)},ke=async()=>{if(c.length===0){P({type:"error",message:"No reports to export"});return}P({type:"info",message:"Generating PDF..."});const b=(await xo()).default,C=new b,W=C.internal.pageSize.getWidth(),E=20;let Y=E;const X=Cs(l?.primary_color||"#3B82F6"),Z=Cs(l?.secondary_color||"#1E40AF");C.setFillColor(...X),C.rect(0,0,W,45,"F"),C.setFillColor(...Z),C.rect(0,42,W,3,"F");let Ee=E;if(l?.logo_url)try{const J=await ln(l.logo_url);J&&(C.addImage(J,"PNG",E,7,30,30),Ee=E+40)}catch(J){console.error("Error adding logo:",J)}C.setTextColor(255,255,255),C.setFontSize(22),C.setFont("helvetica","bold"),C.text(r?.name||"Company",Ee,20),C.setFontSize(10),C.setFont("helvetica","normal"),C.text("INJURY & INCIDENT REPORTS",Ee,30),C.setFontSize(9),C.text(`Generated: ${new Date().toLocaleDateString()}`,W-E,20,{align:"right"}),C.text(`Total Reports: ${c.length}`,W-E,28,{align:"right"}),Y=55,s&&(C.setFillColor(248,250,252),C.rect(E,Y-5,W-E*2,15,"F"),C.setTextColor(...X),C.setFontSize(12),C.setFont("helvetica","bold"),C.text(`Project: ${s.name}`,E+5,Y+5),Y+=20),c.forEach(J=>{Y>200&&(C.addPage(),Y=E);const vs=Cs($(J.injury_type));C.setFillColor(...vs),C.rect(E,Y,W-E*2,12,"F"),C.setTextColor(255,255,255),C.setFontSize(11),C.setFont("helvetica","bold"),C.text(`${J.employee_name} - ${R(J.injury_type)}`,E+5,Y+8),C.text(M(J.incident_date),W-E-5,Y+8,{align:"right"}),Y+=17,C.setTextColor(50,50,50),C.setFontSize(9),C.setFont("helvetica","normal"),C.text(`Location: ${J.incident_location}`,E+5,Y),J.incident_time&&C.text(`Time: ${V(J.incident_time)}`,E+100,Y),Y+=6,C.setFont("helvetica","bold"),C.text("Description:",E+5,Y),C.setFont("helvetica","normal"),Y+=5;const ee=C.splitTextToSize(J.incident_description,W-E*2-10);C.text(ee,E+5,Y),Y+=ee.length*4+3;const Re=[];J.body_part_affected&&Re.push(`Body Part: ${J.body_part_affected}`),J.osha_recordable&&Re.push("OSHA Recordable"),J.workers_comp_claim&&Re.push("Workers' Comp Filed"),J.medical_treatment_required&&Re.push("Medical Treatment Required"),Re.length>0&&(C.setFontSize(8),C.setTextColor(100,100,100),C.text(Re.join("  |  "),E+5,Y),Y+=5),C.setFontSize(8),C.text(`Reported by: ${J.reported_by_name} (${J.reported_by_title})`,E+5,Y),Y+=12});const Ve=C.internal.getNumberOfPages();for(let J=1;J<=Ve;J++)C.setPage(J),C.setFontSize(8),C.setTextColor(150,150,150),C.text(`Page ${J} of ${Ve}`,W/2,C.internal.pageSize.getHeight()-10,{align:"center"}),C.text("CONFIDENTIAL - Injury Report",E,C.internal.pageSize.getHeight()-10);const Be=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;C.save(Be),P({type:"success",message:"PDF exported!"})};return f?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):p?e.jsx("div",{className:"injury-reports-section card",children:e.jsx(Nn,{title:"Unable to load reports",message:"There was a problem loading injury reports. Please try again.",error:p,onRetry:S})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[c.length>0&&e.jsx("button",{className:"btn-secondary",onClick:ke,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>h(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${g==="recent"?"active":""}`,onClick:()=>{A("recent"),O({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${g==="all"?"active":""}`,onClick:()=>A("all"),children:["All (",c.length,")"]})]}),g==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(st,{size:16}),e.jsx("input",{type:"date",value:F.start,onChange:I=>O(b=>({...b,start:I.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:F.end,onChange:I=>O(b=>({...b,end:I.target.value})),placeholder:"End date"}),(F.start||F.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>O({start:"",end:""}),children:"Clear"})]})]}),re.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:"🏥"}),e.jsxs("h4",{children:["No Injury Reports",g==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),g==="recent"&&c.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>A("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:g==="all"&&ue?ue.map(([I,b])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>le(I),children:e.jsxs("div",{className:"month-header-left",children:[v.has(I)?e.jsx(es,{size:18}):e.jsx(qe,{size:18}),e.jsx("span",{className:"month-label",children:b.label}),e.jsxs("span",{className:"month-count",children:[b.reports.length," reports"]})]})}),v.has(I)&&e.jsx("div",{className:"month-reports",children:b.reports.map(C=>e.jsx(Ga,{report:C,formatDate:M,formatTime:V,getInjuryTypeColor:$,getInjuryTypeLabel:R,getStatusColor:se,onViewDetails:T},C.id))})]},I)):re.map(I=>e.jsx(Ga,{report:I,formatDate:M,formatTime:V,getInjuryTypeColor:$,getInjuryTypeLabel:R,getStatusColor:se,onViewDetails:T},I.id))}),d&&e.jsx("div",{className:"modal-overlay",onClick:L,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:I=>I.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:L,children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[M(d.incident_date)," at ",V(d.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:d.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:$(d.injury_type)},children:R(d.injury_type)})})]}),d.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:d.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:d.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:d.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:d.employee_job_title})]}),d.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:d.employee_phone})]}),d.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:d.employee_email})]}),d.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:d.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:d.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:d.reported_by_title})]}),d.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:d.reported_by_phone})]}),d.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:d.reported_by_email})]})]})]}),d.witnesses&&d.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),d.witnesses.map((I,b)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:I.name}),I.phone&&e.jsxs("span",{children:[" • ",I.phone]}),I.email&&e.jsxs("span",{children:[" • ",I.email]})]}),I.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',I.testimony,'"']})})]},b))]}),d.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[d.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:d.medical_facility_name})]}),d.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:d.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:d.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),d.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:d.immediate_actions_taken})]}),d.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:d.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[d.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:d.safety_equipment_used})]}),d.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:d.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:d.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:d.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:d.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:d.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",M(d.created_at)]})]})]})}),m&&e.jsx(Mi,{project:s,companyId:t,user:n,onClose:()=>h(!1),onReportCreated:_}),k&&e.jsx(Oi,{message:k.message,type:k.type,onClose:()=>P(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const Ya=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function jo({project:s,company:t,user:r,isAdmin:n,onShowToast:a}){const[l,c]=o.useState([]),[i,d]=o.useState([]),[u,m]=o.useState(!0),[h,f]=o.useState(!1),[j,p]=o.useState(""),[x,k]=o.useState("Team Member"),[P,g]=o.useState(null);o.useEffect(()=>{s?.id&&A()},[s?.id]),o.useEffect(()=>{h&&t?.id&&v()},[h,t?.id]);const A=async()=>{try{m(!0);const S=await q.getProjectTeam(s.id);c(S)}catch(S){console.error("Error loading project team:",S),a("Error loading project team","error")}finally{m(!1)}},v=async()=>{try{const S=await q.getCompanyMembers(t.id),_=l.map(L=>L.users?.id),T=S.filter(L=>!_.includes(L.users?.id));d(T)}catch(S){console.error("Error loading company members:",S),a("Error loading company members","error")}},N=async()=>{if(!j){a("Select a team member","error");return}try{g("add"),await q.addProjectMember(s.id,j,x,r.id),a("Team member added","success"),f(!1),p(""),k("Team Member"),A()}catch(S){console.error("Error adding team member:",S),a("Error adding team member","error")}finally{g(null)}},F=async(S,_)=>{try{g(S.id),await q.updateProjectMemberRole(s.id,S.users?.id,_),a("Role updated","success"),A()}catch(T){console.error("Error updating role:",T),a("Error updating role","error")}finally{g(null)}},O=async S=>{try{g(S.id),await q.removeProjectMember(s.id,S.users?.id),a("Team member removed","success"),A()}catch(_){console.error("Error removing team member:",_),a("Error removing team member","error")}finally{g(null)}};return u?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(De,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(De,{size:18})," Project Team"]}),n&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>f(!0),children:[e.jsx(el,{size:14})," Add"]})]}),l.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",n&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:l.map(S=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:S.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:S.users?.email})]}),e.jsx("div",{className:"team-member-role",children:n?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:S.project_role,onChange:_=>F(S,_.target.value),disabled:P===S.id,className:"role-select",children:Ya.map(_=>e.jsx("option",{value:_,children:_},_))}),e.jsx(es,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:S.project_role})}),n&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>O(S),disabled:P===S.id,title:"Remove from project",children:e.jsx(sl,{size:14})})]},S.id))}),h&&e.jsx("div",{className:"modal-overlay",onClick:()=>f(!1),children:e.jsxs("div",{className:"modal-content small",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>f(!1),children:e.jsx(ms,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:j,onChange:S=>p(S.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),i.map(S=>e.jsx("option",{value:S.users?.id,children:S.users?.name||S.users?.email},S.users?.id))]}),i.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:x,onChange:S=>k(S.target.value),className:"form-select",children:Ya.map(S=>e.jsx("option",{value:S,children:S},S))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:N,disabled:!j||P==="add",children:P==="add"?"Adding...":"Add to Project"})]})]})})]})}function fo({onShowToast:s,onClose:t}){const[r,n]=o.useState("loading"),[a,l]=o.useState([]),[c,i]=o.useState(null),[d,u]=o.useState(null),[m,h]=o.useState(null),[f,j]=o.useState(""),[p,x]=o.useState(!1),[k,P]=o.useState(!1),[g,A]=o.useState(null);o.useEffect(()=>{v()},[]);const v=async()=>{try{const{data:T,error:L}=await gs.auth.mfa.listFactors();if(L)throw L;const M=(T?.totp||[]).filter(V=>V.status==="verified");l(M),n("overview")}catch{n("overview")}},N=async()=>{A(null);try{const{data:T,error:L}=await gs.auth.mfa.enroll({factorType:"totp",friendlyName:"FieldSync Authenticator"});if(L)throw L;if(!T?.totp)throw new Error("MFA enrollment response missing TOTP data");i(T.totp.qr_code),u(T.totp.secret),h(T.id),n("enroll")}catch(T){A(T.message),s?.("Failed to start MFA enrollment","error")}},F=async()=>{if(f.length===6){x(!0),A(null);try{const{data:T,error:L}=await gs.auth.mfa.challenge({factorId:m});if(L)throw L;const{error:M}=await gs.auth.mfa.verify({factorId:m,challengeId:T.id,code:f});if(M)throw M;n("success"),s?.("MFA enabled successfully!","success"),await v()}catch{A("Invalid code. Please try again."),j("")}finally{x(!1)}}},O=async T=>{try{const{error:L}=await gs.auth.mfa.unenroll({factorId:T});if(L)throw L;s?.("MFA disabled","success"),await v()}catch{s?.("Failed to disable MFA","error")}},S=()=>{navigator.clipboard.writeText(d),P(!0),setTimeout(()=>P(!1),2e3)},_=a.length>0;return e.jsxs("div",{className:"mfa-setup",children:[e.jsxs("div",{className:"mfa-header",children:[e.jsxs("div",{className:"mfa-title",children:[_?e.jsx(gt,{size:20,className:"text-success"}):e.jsx(_t,{size:20}),e.jsx("h3",{children:"Two-Factor Authentication"})]}),t&&e.jsx("button",{className:"close-btn",onClick:t,"aria-label":"Close",children:e.jsx(ms,{size:20})})]}),r==="loading"&&e.jsxs("div",{className:"mfa-loading",children:[e.jsx(Ra,{size:24,className:"spinner"})," Loading..."]}),r==="overview"&&e.jsxs("div",{className:"mfa-overview",children:[e.jsx("p",{className:"mfa-description",children:"Add an extra layer of security to your account. When enabled, you will need to enter a code from your authenticator app each time you sign in."}),_?e.jsxs("div",{className:"mfa-status mfa-status-enabled",children:[e.jsx(gt,{size:18}),e.jsx("span",{children:"MFA is enabled"}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>O(a[0].id),children:[e.jsx(Pa,{size:14})," Disable"]})]}):e.jsxs("div",{className:"mfa-status mfa-status-disabled",children:[e.jsx(Pa,{size:18}),e.jsx("span",{children:"MFA is not enabled"}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:N,children:[e.jsx(_t,{size:14})," Enable MFA"]})]})]}),r==="enroll"&&e.jsxs("div",{className:"mfa-enroll",children:[e.jsx("p",{children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):"}),c&&e.jsx("div",{className:"mfa-qr-container",children:e.jsx("img",{src:c,alt:"MFA QR Code",className:"mfa-qr"})}),e.jsxs("div",{className:"mfa-secret",children:[e.jsx("span",{className:"mfa-secret-label",children:"Or enter this key manually:"}),e.jsxs("div",{className:"mfa-secret-value",children:[e.jsx("code",{children:d}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:S,"aria-label":"Copy secret key",children:k?e.jsx(dn,{size:14}):e.jsx(tl,{size:14})})]})]}),e.jsxs("div",{className:"mfa-verify-section",children:[e.jsx("label",{htmlFor:"mfa-verify-code",children:"Enter the 6-digit code from your app:"}),e.jsxs("div",{className:"mfa-code-input",children:[e.jsx("input",{id:"mfa-verify-code",type:"text",value:f,onChange:T=>j(T.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,autoFocus:!0,inputMode:"numeric",pattern:"[0-9]*"}),e.jsx("button",{className:"btn btn-primary",onClick:F,disabled:f.length!==6||p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ra,{size:14,className:"spinner"})," Verifying..."]}):"Verify & Enable"})]}),g&&e.jsx("p",{className:"mfa-error",children:g})]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>n("overview"),children:"Cancel"})]}),r==="success"&&e.jsxs("div",{className:"mfa-success",children:[e.jsx(gt,{size:48,className:"text-success"}),e.jsx("h4",{children:"MFA Enabled"}),e.jsx("p",{children:"Your account is now protected with two-factor authentication."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>n("overview"),children:"Done"})]})]})}function go({contractValue:s=0,changeOrderValue:t=0,progressPercent:r=0,actualCosts:n=0,startDate:a,endDate:l,areas:c=[]}){const i=s+t,d=r/100*i,u=bo(i,a,l),m=n,h=m>0?d/m:1,f=u>0?d/u:1,j=d-m,p=d-u,x=h>0?i/h:i*2,k=Math.max(0,x-m),P=i-x,g=i-d,A=i-m,v=A>0?g/A:999,N=No(a,l,f),F=wo(h,f);return{bac:i,earnedValue:d,plannedValue:u,actualCost:m,cpi:rs(h,2),spi:rs(f,2),costVariance:j,scheduleVariance:p,eac:Math.round(x),etc:Math.round(k),vac:Math.round(P),tcpi:rs(v,2),projectedEndDate:N,percentScheduled:yo(a,l),percentComplete:r,healthStatus:F,cpiLabel:Co(h),spiLabel:ko(f),budgetUtilization:i>0?rs(m/i*100,1):0,earnedPercent:i>0?rs(d/i*100,1):0}}function bo(s,t,r){if(!t||!r)return 0;const n=new Date(t),a=new Date(r),l=new Date,c=a-n;if(c<=0)return s;const i=l-n;return Math.min(1,Math.max(0,i/c))*s}function yo(s,t){if(!s||!t)return 0;const r=new Date(s),n=new Date(t),a=new Date,l=n-r;if(l<=0)return 100;const c=a-r;return rs(Math.min(100,Math.max(0,c/l*100)),1)}function No(s,t,r){if(!s||!t||r<=0)return null;const n=new Date(s),c=(new Date(t)-n)/(1e3*60*60*24)/r;return new Date(n.getTime()+c*24*60*60*1e3).toISOString().split("T")[0]}function wo(s,t){return s>=.95&&t>=.95?"healthy":s>=.85&&t>=.85?"watch":s>=.7&&t>=.7?"warning":"critical"}function Co(s){return s>=1.05?"Under Budget":s>=.95?"On Budget":s>=.85?"Slightly Over":"Over Budget"}function ko(s){return s>=1.05?"Ahead of Schedule":s>=.95?"On Schedule":s>=.85?"Slightly Behind":"Behind Schedule"}function rs(s,t){const r=Math.pow(10,t);return Math.round(s*r)/r}function _o({contractValue:s=0,changeOrderValue:t=0,progressPercent:r=0,actualCosts:n=0,startDate:a,endDate:l}){if(!a||!l)return[];const c=s+t,i=new Date(a),d=new Date(l),u=new Date,m=Math.max(1,(d-i)/(1e3*60*60*24)),h=[],f=Math.min(12,Math.ceil(m/7));for(let j=0;j<=f;j++){const p=j/f,x=new Date(i.getTime()+p*(d-i)),k=x.toLocaleDateString("en-US",{month:"short",day:"numeric"}),P=Math.round(p*c),g=x<=u,A=j===f||g&&j===f-1,v={date:k,plannedValue:P};if(g||A){const N=Math.min(1,(x-i)/(u-i));v.earnedValue=Math.round(N*(r/100)*c),v.actualCost=Math.round(N*n)}h.push(v)}return h}function So({contractValue:s=0,changeOrderValue:t=0,progressPercent:r=0,actualCosts:n=0,startDate:a,endDate:l,areas:c=[]}){const i=o.useMemo(()=>go({contractValue:s,changeOrderValue:t,progressPercent:r,actualCosts:n,startDate:a,endDate:l,areas:c}),[s,t,r,n,a,l,c]),d=o.useMemo(()=>_o({contractValue:s,changeOrderValue:t,progressPercent:r,actualCosts:n,startDate:a,endDate:l}),[s,t,r,n,a,l]),u={healthy:"#10b981",watch:"#f59e0b",warning:"#f97316",critical:"#ef4444"},m=u[i.healthStatus]||u.watch;return e.jsxs("div",{className:"ev-card",children:[e.jsxs("div",{className:"ev-card-header",children:[e.jsxs("div",{className:"ev-card-title",children:[e.jsx(Ta,{size:18}),e.jsx("h3",{children:"Earned Value Analysis"})]}),e.jsx("span",{className:"ev-health-badge",style:{background:`${m}18`,color:m,borderColor:`${m}40`},children:i.healthStatus==="healthy"?"Healthy":i.healthStatus==="watch"?"Watch":i.healthStatus==="warning"?"Warning":"Critical"})]}),e.jsxs("div",{className:"ev-indices-row",children:[e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[e.jsx(ls,{size:14}),e.jsx("span",{children:"CPI"})]}),e.jsx("div",{className:"ev-index-value",style:{color:i.cpi>=.95?"#10b981":i.cpi>=.85?"#f59e0b":"#ef4444"},children:i.cpi.toFixed(2)}),e.jsx("div",{className:"ev-index-label",children:i.cpiLabel})]}),e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[e.jsx(kt,{size:14}),e.jsx("span",{children:"SPI"})]}),e.jsx("div",{className:"ev-index-value",style:{color:i.spi>=.95?"#10b981":i.spi>=.85?"#f59e0b":"#ef4444"},children:i.spi.toFixed(2)}),e.jsx("div",{className:"ev-index-label",children:i.spiLabel})]}),e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[i.vac>=0?e.jsx(hs,{size:14}):e.jsx(ps,{size:14}),e.jsx("span",{children:"EAC"})]}),e.jsx("div",{className:"ev-index-value",children:ae(i.eac)}),e.jsx("div",{className:"ev-index-label",children:"Est. at Completion"})]}),e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[e.jsx(Ta,{size:14}),e.jsx("span",{children:"ETC"})]}),e.jsx("div",{className:"ev-index-value",children:ae(i.etc)}),e.jsx("div",{className:"ev-index-label",children:"Est. to Complete"})]})]}),e.jsxs("div",{className:"ev-variance-row",children:[e.jsxs("div",{className:`ev-variance-item ${i.costVariance>=0?"positive":"negative"}`,children:[e.jsx("span",{className:"ev-variance-label",children:"Cost Variance"}),e.jsxs("span",{className:"ev-variance-value",children:[i.costVariance>=0?"+":"",ae(i.costVariance)]})]}),e.jsxs("div",{className:`ev-variance-item ${i.scheduleVariance>=0?"positive":"negative"}`,children:[e.jsx("span",{className:"ev-variance-label",children:"Schedule Variance"}),e.jsxs("span",{className:"ev-variance-value",children:[i.scheduleVariance>=0?"+":"",ae(i.scheduleVariance)]})]}),e.jsxs("div",{className:`ev-variance-item ${i.vac>=0?"positive":"negative"}`,children:[e.jsx("span",{className:"ev-variance-label",children:"Variance at Completion"}),e.jsxs("span",{className:"ev-variance-value",children:[i.vac>=0?"+":"",ae(i.vac)]})]})]}),d.length>0&&e.jsx("div",{className:"ev-chart-container",children:e.jsx(Zs,{width:"100%",height:220,children:e.jsxs($i,{data:d,margin:{top:8,right:8,left:0,bottom:0},children:[e.jsx(Mt,{dataKey:"date",tick:{fontSize:11,fill:"var(--text-secondary)"},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(Ot,{tickFormatter:ze,tick:{fontSize:11,fill:"var(--text-secondary)"},tickLine:!1,axisLine:!1,width:55}),e.jsx(et,{formatter:h=>ae(h),contentStyle:Xs.contentStyle,labelStyle:Xs.labelStyle}),e.jsx(Es,{iconType:"line",wrapperStyle:{fontSize:11,paddingTop:4}}),e.jsx(jt,{type:"monotone",dataKey:"plannedValue",stroke:G.contract,strokeDasharray:"5 5",strokeWidth:2,dot:!1,name:"Planned Value"}),e.jsx(jt,{type:"monotone",dataKey:"earnedValue",stroke:G.revenue,strokeWidth:2,dot:!1,name:"Earned Value",connectNulls:!1}),e.jsx(jt,{type:"monotone",dataKey:"actualCost",stroke:G.costs,strokeWidth:2,dot:!1,name:"Actual Cost",connectNulls:!1})]})})}),i.projectedEndDate&&l&&e.jsxs("div",{className:"ev-projection-row",children:[e.jsxs("div",{className:"ev-projection-item",children:[e.jsx("span",{className:"ev-projection-label",children:"Planned End"}),e.jsx("span",{className:"ev-projection-value",children:new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"ev-projection-item",children:[e.jsx("span",{className:"ev-projection-label",children:"Projected End"}),e.jsx("span",{className:"ev-projection-value",style:{color:i.spi>=.95?"#10b981":"#f59e0b"},children:new Date(i.projectedEndDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),i.tcpi>1.1&&e.jsxs("div",{className:"ev-projection-alert",children:[e.jsx(Te,{size:14}),e.jsxs("span",{children:["Need CPI of ",i.tcpi.toFixed(2)," to finish on budget"]})]})]})]})}const Do=o.lazy(()=>oe(()=>import("./ShareModal-_kvfg_0q.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Eo=o.lazy(()=>oe(()=>import("./NotificationSettings-Cg8ooaC6.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),Ro=o.lazy(()=>oe(()=>import("./CORForm-r1FmPlqC.js"),__vite__mapDeps([8,1,2,3,4,5,6,9]))),Po=o.lazy(()=>oe(()=>import("./CORDetail-C3atAr4n.js"),__vite__mapDeps([10,1,2,3,4,5,6,9,11,12]))),To=o.lazy(()=>oe(()=>import("./CORLog-DCLMFojX.js").then(s=>s.a),__vite__mapDeps([13,4,1,2,3,5,6,9]))),Fo=o.lazy(()=>oe(()=>import("./DrawRequestModal-Ca_XoK7B.js"),__vite__mapDeps([14,1,2,3,4,5,6,9]))),Ao=o.lazy(()=>oe(()=>import("./EquipmentModal-CmbtyiA7.js"),__vite__mapDeps([15,1,2,3,4,5,6]))),Mo=o.lazy(()=>oe(()=>import("./AddCostModal-BkftPmxH.js"),__vite__mapDeps([16,1,2,3,4,5,6]))),Oo=o.lazy(()=>oe(()=>import("./DocumentsTab-CVWzWn1Y.js"),__vite__mapDeps([17,1,2,3,4,5,6]))),$o=o.lazy(()=>oe(()=>import("./CORLogPreview-D4iOI1Ch.js"),__vite__mapDeps([18,1,2,3,4,5,6,9]))),Io=o.lazy(()=>oe(()=>import("./CORList-D_Shw_b2.js"),__vite__mapDeps([19,4,1,2,3,5,6,9,13]))),Lo=o.lazy(()=>oe(()=>import("./TMList-BfrSbPM4.js"),__vite__mapDeps([20,4,1,2,3,5,6,12,9]))),zo=o.lazy(()=>oe(()=>import("./BillingCenter-DIWEd05m.js"),__vite__mapDeps([21,1,2,3,4,5,6,9]))),qo=o.lazy(()=>oe(()=>import("./PhotoTimeline-T-ewDtlp.js"),__vite__mapDeps([22,1,2,3,4,5,6]))),Vo=o.lazy(()=>oe(()=>import("./index-CbEMtBfa.js").then(s=>s.b0),__vite__mapDeps([1,2,3,4,5,6])));function Bo({company:s,user:t,isAdmin:r,userAccessLevel:n,onShowToast:a,navigateToProjectId:l,onProjectNavigated:c}){const[i,d]=o.useState([]),[u,m]=o.useState([]),[h,f]=o.useState(null),[j,p]=o.useState([]),[x,k]=o.useState(!0),[P,g]=o.useState(!1),[A,v]=o.useState(!1),[N,F]=o.useState("overview"),[O,S]=o.useState("overview"),[_,T]=o.useState(!0),[L,M]=o.useState(!1),[V,R]=o.useState(!1),[se,$]=o.useState("list"),[re,ue]=o.useState("preview"),[le,ke]=o.useState([]),[I,b]=o.useState(!1),[C,W]=o.useState(null),[E,Y]=o.useState(!1),[X,Z]=o.useState(null),[Ee,Ve]=o.useState(0),[Be,J]=o.useState(!1),[vs,ee]=o.useState(!1),[Re,ss]=o.useState(!1),[_e,We]=o.useState(null),[Ts,Cn]=o.useState(0),[kn,Fs]=o.useState(!1),[zt,As]=o.useState(null),[_n,Sn]=o.useState(0),{isOpen:Dn,setIsOpen:En,close:Rn}=$c(),{portfolioMetrics:Pn,projectHealth:Tn,scheduleMetrics:Fn,riskAnalysis:Pe}=Dc(u),{editMode:An,editData:he,saving:qt,handleEditClick:Vt,handleCancelEdit:Bt,handleEditChange:Ne,handleAreaEditChange:Wt,handleAddArea:Mn,handleRemoveArea:On,handleSaveEdit:$n,handleDeleteProject:In}=Ec({selectedProject:h,areas:j,company:s,onShowToast:a,loadAreas:lt,setSelectedProject:f}),js=o.useRef(null),Ms=o.useRef(!1),rt=o.useRef(!1),it=o.useRef(new Map),Ut=300*1e3,me=o.useCallback((w={})=>{const{refreshAreas:z=!1,refreshCOR:H=!1,projectId:Q=null}=w;z&&Q&&(Ms.current=Q),H&&(rt.current=!0),js.current&&clearTimeout(js.current),js.current=setTimeout(async()=>{Ms.current&&(await lt(Ms.current),Ms.current=!1),rt.current&&(Ve(de=>de+1),rt.current=!1),await fs()},150)},[]);o.useEffect(()=>()=>{js.current&&clearTimeout(js.current)},[]),o.useEffect(()=>{s?.id&&(fs(),qn())},[s?.id]);const Ln=o.useRef([]),zn=i.map(w=>w.id).sort().join(",");o.useEffect(()=>{if(!s?.id||i.length===0)return;const w=i.map(H=>H.id).sort();Ln.current=w;const z=q.subscribeToCompanyActivity?.(s.id,w,{onMessage:()=>me(),onMaterialRequest:()=>me(),onTMTicket:()=>me(),onCrewCheckin:()=>me(),onAreaUpdate:()=>me(),onCORChange:()=>me({refreshCOR:!0}),onInjuryReport:()=>me(),onProjectChange:()=>me(),onMaterialsEquipmentChange:()=>me(),onLaborRateChange:()=>me()});return()=>{z&&q.unsubscribe?.(z)}},[s?.id,zn,me]),o.useEffect(()=>(L?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[L]);const qn=async()=>{try{const w=await q.getDumpSites(s.id);ke(w||[])}catch(w){console.error("Error loading dump sites:",w)}},Ht=o.useRef(null);o.useEffect(()=>{if(l&&l!==Ht.current&&i.length>0){const w=i.find(z=>z.id===l);w&&(Ht.current=l,f(w),c?.())}},[l,i,c]),o.useEffect(()=>{if(h){lt(h.id);const w=[],z=h.id,H=q.subscribeToAreas?.(z,()=>{me({refreshAreas:!0,projectId:z})});H&&w.push(H);const Q=q.subscribeToDailyReports?.(z,()=>{me()});Q&&w.push(Q);const de=q.subscribeToCrewCheckins?.(z,()=>{me()});de&&w.push(de);const ve=q.subscribeToHaulOffs?.(z,()=>{me()});ve&&w.push(ve);const Ae=q.subscribeToCORs?.(z,()=>{me({refreshCOR:!0})});return Ae&&w.push(Ae),()=>{w.forEach(pe=>q.unsubscribe?.(pe))}}},[h,me]),o.useEffect(()=>{O==="tickets"&&ue("full")},[O]);const Vn=async(w,z=!1)=>{const H=w.id,Q=it.current.get(H);if(Q&&!z&&Date.now()-Q.timestamp<Ut)return Q.data;try{const[de,ve,Ae,pe,je,we,Ue,Is,D,K,ce,Me]=await Promise.all([fe(()=>q.getAreas(w.id),{fallback:[],context:{operation:"getAreas",projectId:w.id}}),fe(()=>q.getTMTickets(w.id),{fallback:[],context:{operation:"getTMTickets",projectId:w.id}}),fe(()=>q.getChangeOrderTotals(w.id),{fallback:null,context:{operation:"getChangeOrderTotals",projectId:w.id}}),fe(()=>q.getDailyReports(w.id,100),{fallback:[],context:{operation:"getDailyReports",projectId:w.id}}),fe(()=>q.getInjuryReports(w.id),{fallback:[],context:{operation:"getInjuryReports",projectId:w.id}}),fe(()=>q.calculateManDayCosts(w.id,s?.id,w.work_type||"demolition",w.job_type||"standard"),{fallback:null,context:{operation:"calculateManDayCosts",projectId:w.id}}),fe(()=>q.calculateHaulOffCosts(w.id),{fallback:null,context:{operation:"calculateHaulOffCosts",projectId:w.id}}),fe(()=>q.getProjectCosts(w.id),{fallback:[],context:{operation:"getProjectCosts",projectId:w.id}}),fe(()=>q.getCORStats(w.id),{fallback:null,context:{operation:"getCORStats",projectId:w.id}}),fe(()=>q.getCrewCheckinHistory(w.id,60),{fallback:[],context:{operation:"getCrewCheckinHistory",projectId:w.id}}),fe(()=>q.getMaterialRequests(w.id),{fallback:[],context:{operation:"getMaterialRequests",projectId:w.id}}),fe(()=>q.getWeeklyDisposalSummary(w.id,4),{fallback:[],context:{operation:"getWeeklyDisposalSummary",projectId:w.id}})]),Ce=Ea(de),ct=Ce.progress,oa=Ae?.totalApprovedValue||0,da=w.contract_value+oa,Ls=Ce.isValueBased?Ce.earnedValue:ct/100*da,pr=ve.filter(U=>U.status==="pending").length,ot=new Date;ot.setDate(ot.getDate()-7);const xr=pe.filter(U=>new Date(U.report_date)>=ot).length,ua=Is.reduce((U,te)=>{const ts=parseFloat(te.amount);return U+(isNaN(ts)?0:ts)},0);let zs=0;const qs={};ve.forEach(U=>{const te=U.work_date||U.ticket_date||U.created_at?.split("T")[0],ts=U.t_and_m_items||U.items||[];let Vs=0;ts.forEach(xt=>{const Pr=parseFloat(xt.quantity)||1,Tr=parseFloat(xt.unit_cost)||parseFloat(xt.materials_equipment?.cost_per_unit)||0;Vs+=Pr*Tr}),Vs>0&&te&&(zs+=Vs,qs[te]||(qs[te]={date:te,cost:0}),qs[te].cost+=Vs)});const ma=Object.values(qs).sort((U,te)=>new Date(te.date)-new Date(U.date)),dt=we?.totalCost||0,vr=Ue?.totalCost||0,ha=dt+zs+ua,pa=Ls-ha,jr=Ls>0?pa/Ls*100:0,xa=we?.byDate?.length||0,fr=ma.length,ut=Math.max(xa,fr),va=dt+zs,gr=ut>0?va/ut:0,Oe=qi({...w,progress:ct},we?.totalManDays||0),He={},ja=new Set;(K||[]).forEach(U=>{const te=U.workers||[];He[U.check_in_date]=te.length,te.forEach(ts=>ja.add(ts.name?.toLowerCase()))});const $e=Object.keys(He).sort(),br=$e.length>0?Math.round($e.reduce((U,te)=>U+He[te],0)/$e.length*10)/10:0,yr=$e.length>0?Math.max(...$e.map(U=>He[U])):0,mt=$e.slice(-7),ht=$e.slice(-14,-7),fa=mt.length>0?mt.reduce((U,te)=>U+He[te],0)/mt.length:0,pt=ht.length>0?ht.reduce((U,te)=>U+He[te],0)/ht.length:0,Nr=(ce||[]).filter(U=>U.status==="pending").length,wr=(ce||[]).filter(U=>U.status==="ordered").length,Cr=(ce||[]).filter(U=>U.status==="delivered").length,kr=(ce||[]).filter(U=>U.priority==="urgent"&&U.status==="pending").length,_r=pe.filter(U=>U.issues&&U.issues.trim().length>0).length,Sr=ve.reduce((U,te)=>U+(te.photos?.length||0),0),Dr=(Me||[]).reduce((U,te)=>U+(te.concrete||0)+(te.trash||0)+(te.metals||0)+(te.hazardous_waste||0),0),ga=je.length>0?new Date(je[0]?.incident_date||je[0]?.created_at):null,Er=ga?Math.floor((new Date-ga)/(1e3*60*60*24)):null,Rr=de.filter(U=>U.status==="done"),ba={...w,areas:de,progress:ct,billable:Ls,changeOrderValue:oa,revisedContractValue:da,changeOrderPending:Ae?.pendingCount||0,totalTickets:ve.length,pendingTickets:pr,approvedTickets:ve.filter(U=>U.status==="approved").length,tmTickets:ve,dailyReportsCount:pe.length,recentDailyReports:xr,injuryReportsCount:je.length,lastDailyReport:pe[0]?.report_date||null,isValueBased:Ce.isValueBased,earnedValue:Ce.earnedValue,totalSOVValue:Ce.totalValue,laborCost:dt,laborDaysWorked:xa,laborManDays:we?.totalManDays||0,laborByDate:we?.byDate||[],dailyBurn:gr,materialsEquipmentCost:zs,materialsEquipmentByDate:ma,haulOffCost:vr,haulOffLoads:Ue?.totalLoads||0,haulOffDays:Ue?.daysWithHaulOff||0,haulOffByType:Ue?.byWasteType||{},haulOffByDate:Ue?.byDate||[],customCosts:Is,customCostTotal:ua,totalBurn:va,totalBurnDays:ut,allCostsTotal:ha,currentProfit:pa,profitMargin:jr,corPendingValue:D?.total_pending_value||0,corPendingCount:D?.pending_count||0,corApprovedValue:D?.total_approved_value||0,corBilledValue:D?.total_billed_value||0,corTotalCount:D?.total_cors||0,corStats:D,scheduleStatus:Oe.scheduleStatus,scheduleVariance:Oe.scheduleVariance,scheduleLabel:Oe.scheduleLabel,laborStatus:Oe.laborStatus,laborVariance:Oe.laborVariance,laborLabel:Oe.laborLabel,hasScheduleData:Oe.hasScheduleData,hasLaborData:Oe.hasLaborData,actualManDays:we?.totalManDays||0,crewHistory:K||[],crewByDate:He,uniqueWorkerCount:ja.size,avgCrewSize:br,peakCrewSize:yr,crewDaysTracked:$e.length,crewTrend:pt>0?(fa-pt)/pt*100:0,recentCrewAvg:fa,materialRequests:ce||[],pendingMaterialRequests:Nr,orderedMaterialRequests:wr,deliveredMaterialRequests:Cr,urgentMaterialRequests:kr,totalMaterialRequests:(ce||[]).length,reportsWithIssues:_r,totalPhotosFromTickets:Sr,dailyReports:pe,weeklyDisposal:Me||[],disposalTotalLoads:Dr,daysSinceLastInjury:Er,injuryReports:je,oshaRecordable:je.filter(U=>U.osha_recordable).length,completedAreasCount:Rr.length,hasError:!1,_detailsLoaded:!0};return it.current.set(H,{data:ba,timestamp:Date.now()}),ba}catch(de){return console.error(`Error loading details for project ${w.id}:`,de),{...w,hasError:!0,_detailsLoaded:!1}}},fs=async()=>{try{const w=await q.getProjectDashboardSummary(s?.id);d(w);const z=w.map(H=>{const Q=it.current.get(H.id);if(Q&&Date.now()-Q.timestamp<Ut)return Q.data;const de=H.areaCount||0,ve=H.completedAreas||0,Ae=de>0?Math.round(ve/de*100):0;return{...H,progress:Ae,areas:[],totalTickets:H.ticketCount||0,pendingTickets:H.pendingTicketCount||0,approvedTickets:H.approvedTicketCount||0,dailyReportsCount:H.dailyReportsThisWeek||0,recentDailyReports:H.dailyReportsThisWeek||0,corTotalCount:H.corCount||0,billable:0,changeOrderValue:0,revisedContractValue:H.contract_value||0,changeOrderPending:0,tmTickets:[],injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,materialsEquipmentCost:0,materialsEquipmentByDate:[],haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corStats:null,scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1,actualManDays:0,hasError:!1,_detailsLoaded:!1}});m(z)}catch(w){console.error("Error loading projects:",w),a("Error loading projects","error")}finally{k(!1)}};async function lt(w){try{const z=await q.getAreas(w);p(z)}catch(z){console.error("Error loading areas:",z)}}const Os=async w=>{if(f(w),!w._detailsLoaded){const z=await Vn(w);m(H=>H.map(Q=>Q.id===w.id?z:Q)),f(z)}},Bn=()=>{f(null),p([]),Bt(),F("overview"),fs()},y=o.useMemo(()=>h?u.find(w=>w.id===h.id):null,[h,u]),Wn=o.useMemo(()=>{if(!h)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const w=Ea(j),z=w.progress,H=y?.changeOrderValue||0,Q=h.contract_value+H,de=w.isValueBased?w.earnedValue:z/100*Q;return{progress:z,billable:de,changeOrderValue:H,revisedContractValue:Q,isValueBased:w.isValueBased,earnedValue:w.earnedValue,totalSOVValue:w.totalValue}},[h,j,y]),Un=o.useCallback(({target:w,projectId:z,alert:H})=>{const Q=i.find(de=>de.id===z);Q&&(f(Q),w==="financials"?F("financials"):w==="reports"?F("reports"):w==="cors"?(F("financials"),S("cors")):F("overview"))},[i]);o.useEffect(()=>{const w=async()=>{for(const z of u)if(Ii(z,30))try{await q.archiveProject(z.id),a(`Project "${z.name}" has been auto-archived after 30 days of completion`,"info")}catch(H){console.error("Failed to auto-archive project:",H)}};u.length>0&&w()},[]);const Hn=o.useCallback(()=>{We(null),ss(!0)},[]),Kn=o.useCallback(w=>{We(w),ss(!0)},[]),Gn=o.useCallback(()=>{As(null),Fs(!0)},[]),Yn=o.useCallback(w=>{As(w),Fs(!0)},[]),Jn=o.useCallback(()=>{ue("full")},[]),Xn=o.useCallback(()=>{T(w=>!w)},[]),Qn=o.useCallback(()=>{M(w=>!w)},[]),Kt=o.useCallback(()=>{M(!1)},[]),Gt=o.useCallback(()=>{R(w=>!w)},[]),$s=o.useCallback(async(w="all")=>{if(h){a("Gathering field data...","info");try{const[z,H,Q]=await Promise.all([q.getDailyReports(h.id,365),q.getInjuryReports(h.id),q.getCrewCheckinHistory(h.id,365)]);w==="daily"?await Rc(z||[],h):w==="incidents"?await Pc(H||[],h):w==="crew"?await Tc(Q||[],h):await Fc({dailyReports:z||[],incidentReports:H||[],crewCheckins:Q||[],project:h}),a("PDF exported!","success")}catch(z){console.error("Error exporting field documents:",z),a("Error generating PDF","error")}}},[h,a]),Zn=o.useCallback(()=>{ue("preview")},[]),er=o.useCallback(()=>{$("log")},[]),Yt=o.useCallback(()=>{W(null),b(!0)},[]),sr=o.useCallback(w=>{Z(w),Y(!0)},[]),tr=o.useCallback(w=>{W(w),b(!0)},[]),ar=o.useCallback(()=>{J(!0)},[]),nr=o.useCallback(async w=>{try{await q.deleteProjectCost(w),fs(),a?.("Cost deleted","success")}catch{a?.("Error deleting cost","error")}},[]),rr=o.useMemo(()=>({corCount:y?.corStats?.total||0,ticketCount:y?.totalTickets||0,corPending:y?.corStats?.pending||0,ticketPending:y?.pendingTickets||0}),[y?.corStats?.total,y?.totalTickets,y?.corStats?.pending,y?.pendingTickets]),{totalOriginalContract:ir,totalChangeOrders:Jt,totalPortfolioValue:lr,totalEarned:cr,totalRemaining:or,weightedCompletion:dr,totalPendingCORValue:ur,totalPendingCORCount:Xt}=Pn,{projectsComplete:Qt,projectsOnTrack:Zt,projectsAtRisk:ea,projectsOverBudget:sa,projectsWithChangeOrders:ta}=Tn,{scheduleAhead:aa,scheduleOnTrack:na,scheduleBehind:ra,laborOver:ia,laborUnder:la,laborOnTrack:ca,hasAnyScheduleData:mr,hasAnyLaborData:hr}=Fn;if(x)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(h){const{progress:w,billable:z,changeOrderValue:H,revisedContractValue:Q,isValueBased:de,earnedValue:ve,totalSOVValue:Ae}=Wn;if(An&&he){const D=he.areas.reduce((K,ce)=>K+(parseFloat(ce.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Bt,style:{marginBottom:"1.5rem"},children:"← Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:he.name,onChange:K=>Ne("name",K.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:he.job_number,onChange:K=>Ne("job_number",K.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:he.address,onChange:K=>Ne("address",K.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:he.general_contractor,onChange:K=>Ne("general_contractor",K.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:he.client_contact,onChange:K=>Ne("client_contact",K.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:he.client_phone,onChange:K=>Ne("client_phone",K.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:he.contract_value,onChange:K=>Ne("contract_value",K.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:he.pin,onChange:K=>Ne("pin",K.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:he.work_type,onChange:K=>Ne("work_type",K.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:he.job_type,onChange:K=>Ne("job_type",K.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:he.default_dump_site_id,onChange:K=>Ne("default_dump_site_id",K.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),le.map(K=>e.jsx("option",{value:K.id,children:K.name},K.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),he.areas.map((K,ce)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:K.name,onChange:Me=>Wt(ce,"name",Me.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:K.weight,onChange:Me=>Wt(ce,"weight",Me.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>On(ce),children:"×"})]},ce)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${D===100?"valid":"invalid"}`,children:[D,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:Mn,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:$n,disabled:qt,style:{flex:1},children:qt?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:In,children:"Delete Project"})]})}const pe=j.filter(D=>D.status==="done").length,je=j.filter(D=>D.status==="working").length,we=j.filter(D=>D.status==="not_started").length,Ue=(y?.pendingTickets||0)+(y?.changeOrderPending||0),Is=[{id:"overview",label:"Overview",Icon:Fa},{id:"financials",label:"Financials",Icon:ls,badge:Ue},{id:"reports",label:"Reports",Icon:xe},{id:"documents",label:"Documents",Icon:wt},{id:"info",label:"Info",Icon:Ks}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:Bn,children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>g(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>v(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:Vt,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:h.name}),(h.job_number||h.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[h.job_number&&`Job #${h.job_number}`,h.job_number&&h.work_type&&" • ",h.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[w,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:ae(z)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:ae(Q-z)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:Is.map(D=>e.jsxs("button",{className:`pv-tab ${N===D.id?"active":""} ${D.badge>0?"has-badge":""}`,onClick:()=>F(D.id),children:[e.jsx(D.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:D.label}),D.badge>0&&e.jsx("span",{className:"pv-tab-badge",children:D.badge})]},D.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[N==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab animate-fade-in",children:[e.jsxs("div",{className:"overview-hero-split",children:[e.jsx(zc,{progress:w,areasComplete:pe,totalAreas:j.length,areasWorking:je}),e.jsx(Vc,{earnedRevenue:z,totalCosts:y?.allCostsTotal||0,laborCost:y?.laborCost||0,disposalCost:y?.haulOffCost||0,equipmentCost:y?.materialsEquipmentCost||0,materialsCost:0,otherCost:y?.customCostTotal||0,contractValue:Q})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(Wc,{project:h,onShowToast:a}),e.jsxs("div",{className:"overview-section-card overview-work-areas-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[pe>0&&e.jsxs("span",{className:"section-badge done",children:[pe," Done"]}),je>0&&e.jsxs("span",{className:"section-badge working",children:[je," Active"]}),we>0&&e.jsxs("span",{className:"section-badge pending",children:[we," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list work-areas-scroll stagger-areas",children:j.map(D=>e.jsxs("div",{className:`work-area-item ${D.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[D.status==="done"&&e.jsx("span",{className:"status-icon done",children:"✓"}),D.status==="working"&&e.jsx("span",{className:"status-icon working",children:"●"}),D.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:"○"})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:D.name}),e.jsx("span",{className:"work-area-weight",children:D.scheduled_value?ae(D.scheduled_value):`${D.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${D.status}`,style:{width:D.status==="done"?"100%":D.status==="working"?"50%":"0%"}})})]},D.id))})]})]}),h?.contract_value>0&&e.jsx(So,{contractValue:h.contract_value,changeOrderValue:H,progressPercent:w,actualCosts:y?.allCostsTotal||0,startDate:h.start_date,endDate:h.end_date,areas:j}),(y?.pendingTickets>0||y?.changeOrderPending>0||y?.pendingMaterialRequests>0||y?.urgentMaterialRequests>0)&&e.jsxs("div",{className:"overview-needs-attention",children:[e.jsxs("div",{className:"overview-needs-attention__header",children:[e.jsx(Te,{size:15,className:"overview-needs-attention__icon"}),e.jsx("span",{className:"overview-needs-attention__title",children:"Needs Attention"}),e.jsx("span",{className:"overview-needs-attention__count",children:[y?.urgentMaterialRequests>0,!y?.urgentMaterialRequests&&y?.pendingMaterialRequests>0,y?.pendingTickets>0,y?.changeOrderPending>0].filter(Boolean).length})]}),e.jsxs("div",{className:"overview-needs-attention__items",children:[y?.urgentMaterialRequests>0&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--warning",onClick:()=>F("reports"),children:[e.jsx(Te,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[y.urgentMaterialRequests," urgent material request",y.urgentMaterialRequests!==1?"s":""]}),e.jsx(ys,{size:13,className:"overview-needs-attention__item-arrow"})]}),y?.pendingMaterialRequests>0&&!y?.urgentMaterialRequests&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--info",onClick:()=>F("reports"),children:[e.jsx(Hs,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[y.pendingMaterialRequests," material request",y.pendingMaterialRequests!==1?"s":""," pending"]}),e.jsx(ys,{size:13,className:"overview-needs-attention__item-arrow"})]}),y?.pendingTickets>0&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--warning",onClick:()=>F("financials"),children:[e.jsx(xe,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[y.pendingTickets," T&M ticket",y.pendingTickets!==1?"s":""," need approval"]}),e.jsx(ys,{size:13,className:"overview-needs-attention__item-arrow"})]}),y?.changeOrderPending>0&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--info",onClick:()=>F("financials"),children:[e.jsx(os,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[y.changeOrderPending," change order",y.changeOrderPending!==1?"s":""," pending"]}),e.jsx(ys,{size:13,className:"overview-needs-attention__item-arrow"})]})]})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"Loading photos..."}),children:e.jsx(qo,{projectId:h?.id,areas:j,onShowToast:a})}),e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"Loading punch list..."}),children:e.jsx(Vo,{projectId:h?.id,areas:j,companyId:s?.id,onShowToast:a})})]}),e.jsx("div",{className:"overview-bottom-strip",children:e.jsxs("div",{className:"overview-quick-actions",children:[e.jsxs("button",{className:"overview-action-btn",onClick:()=>F("reports"),children:[e.jsx(xe,{size:15}),e.jsxs("span",{children:[y?.dailyReportsCount||0," Reports"]})]}),e.jsxs("button",{className:"overview-action-btn",onClick:()=>F("financials"),children:[e.jsx(ls,{size:15}),e.jsxs("span",{children:[y?.totalTickets||0," T&M Tickets"]})]}),e.jsx("span",{className:"overview-action-divider"}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>$s("all"),children:[e.jsx(Ye,{size:15}),e.jsx("span",{children:"Export All"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>$s("daily"),children:[e.jsx(Ye,{size:14}),e.jsx("span",{children:"Daily"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>$s("incidents"),children:[e.jsx(Ye,{size:14}),e.jsx("span",{children:"Incidents"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>$s("crew"),children:[e.jsx(Ye,{size:14}),e.jsx("span",{children:"Crew"})]})]})})]}),N==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsxs("div",{className:"export-actions",style:{display:"flex",gap:"8px",marginLeft:"auto",marginBottom:"12px",justifyContent:"flex-end"},children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>Ac(h,{earnedRevenue:z,approvedCORs:y?.cors?.filter(D=>D.status==="approved"),laborByDate:y?.laborByDate,haulOffByDate:y?.haulOffByDate,customCosts:y?.customCosts}),children:[e.jsx(Ye,{size:14})," Export CSV"]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>Mc(h,{totalLaborCost:y?.totalLaborCost||0,totalDisposalCost:y?.totalDisposalCost||0}),children:[e.jsx(Ye,{size:14})," QuickBooks"]})]}),e.jsx(Yc,{contractValue:h?.contract_value||0,earnedRevenue:z,totalCosts:y?.allCostsTotal||0,profit:y?.currentProfit||0,progress:w,corApprovedValue:H,loading:!y}),e.jsxs("div",{className:`financials-layout ${_?"sidebar-collapsed":""}`,children:[e.jsxs("button",{className:"financials-mobile-menu-toggle",onClick:Qn,"aria-label":"Open navigation menu",title:"Open navigation menu",children:[e.jsx(al,{size:20}),e.jsx("span",{children:"Menu"})]}),L&&e.jsx("div",{className:"financials-sidebar-overlay",onClick:Kt,"aria-hidden":"true"}),e.jsx("div",{className:`financials-sidebar ${_?"collapsed":""} ${L?"mobile-open":""}`,children:e.jsx(Jc,{activeSection:O,onSectionChange:D=>{S(D),M(!1)},collapsed:_,onToggleCollapse:Xn,onMobileClose:Kt,stats:rr})}),e.jsxs("div",{className:"financials-main",children:[O==="overview"&&e.jsxs("div",{className:"financials-overview animate-fade-in",children:[e.jsx(so,{projectData:y,project:h,tmTickets:y?.tmTickets||[],corStats:y?.corStats,areas:j}),e.jsxs("div",{className:"financials-analysis-row stagger-children",children:[e.jsx(mo,{dailyBurn:y?.dailyBurn||0,totalBurn:y?.totalBurn||0,daysWorked:y?.totalBurnDays||0,laborCost:y?.laborCost||0,materialsEquipmentCost:y?.materialsEquipmentCost||0,progress:w,contractValue:Q,laborByDate:y?.laborByDate||[],materialsEquipmentByDate:y?.materialsEquipmentByDate||[]}),e.jsx(ao,{revenue:z,totalCosts:y?.allCostsTotal||0,contractValue:Q,progress:w})]}),e.jsxs("div",{className:"cost-disposal-row",children:[e.jsx(no,{laborCost:y?.laborCost||0,haulOffCost:y?.haulOffCost||0,customCosts:y?.customCosts||[],onAddCost:ar,onDeleteCost:nr}),e.jsx(io,{project:h,period:"week"})]}),e.jsx(lo,{project:h,onAddEquipment:Hn,onEditEquipment:Kn,onShowToast:a},Ts),e.jsx(co,{project:h,areas:j,corStats:y?.corStats,onCreateDraw:Gn,onViewDraw:Yn,onShowToast:a},_n),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(Je,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:ae(y?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(oo,{project:h,company:s,onShowToast:a})})]})]}),O==="cors"&&e.jsxs("div",{className:"financials-cors animate-fade-in",children:[e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(o.Suspense,{fallback:e.jsx(Ke,{}),children:e.jsx($o,{project:h,onShowToast:a,onToggleList:Gt,showingList:V,onViewFullLog:er,onCreateCOR:Yt})})}),V&&e.jsx("div",{className:"financials-section cor-section-list animate-fade-in",style:{marginTop:"1rem"},children:e.jsx(o.Suspense,{fallback:e.jsx(Ke,{}),children:e.jsx(Io,{project:h,company:s,areas:j,refreshKey:Ee,onShowToast:a,previewMode:!1,onViewAll:Gt,onDisplayModeChange:$,onCreateCOR:Yt,onViewCOR:sr,onEditCOR:tr})})})]}),O==="tickets"&&e.jsx("div",{className:"financials-tickets animate-fade-in",children:e.jsxs("div",{className:"financials-section tm-section",children:[re==="full"&&e.jsx("button",{className:"section-back-btn",onClick:Zn,children:"← Back to summary"}),e.jsx(o.Suspense,{fallback:e.jsx(Ke,{}),children:e.jsx(Lo,{project:h,company:s,onShowToast:a,compact:re==="preview",previewMode:re==="preview",onViewAll:Jn})})]})}),O==="billing"&&e.jsx("div",{className:"financials-billing animate-fade-in",children:e.jsx(o.Suspense,{fallback:e.jsx(Ke,{}),children:e.jsx(zo,{project:h,company:s,user:t,onShowToast:a})})})]})]})]}),N==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(xe,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:y?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:y?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((y?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:y?.totalTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"T&M Tickets"}),(y?.pendingTickets||0)>0&&e.jsxs("div",{className:"reports-metric-status",style:{background:"#fef3c7",color:"#92400e"},children:[y.pendingTickets," pending"]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:y?.totalPhotosFromTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"Photos Captured"})]})]})}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsx("div",{className:"reports-insight-header",children:e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(De,{size:18}),e.jsx("h3",{children:"Crew Analytics"})]})}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.uniqueWorkerCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Workers"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.avgCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Avg Crew / Day"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.peakCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Peak Crew Size"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.crewDaysTracked||0}),e.jsx("span",{className:"reports-stat-label",children:"Days Tracked"})]})]}),(y?.crewTrend||0)!==0&&e.jsxs("div",{className:`reports-trend-badge ${y.crewTrend>0?"up":"down"}`,children:[y.crewTrend>0?e.jsx(hs,{size:14}):e.jsx(ps,{size:14}),e.jsxs("span",{children:[Math.abs(Math.round(y.crewTrend)),"% ",y.crewTrend>0?"increase":"decrease"," vs prior week"]})]}),y?.crewByDate&&Object.keys(y.crewByDate).length>0&&e.jsxs("div",{className:"reports-mini-chart",children:[e.jsx("div",{className:"reports-mini-chart-label",children:"Recent Crew Size"}),e.jsx("div",{className:"reports-mini-bars",children:Object.keys(y.crewByDate).sort().slice(-14).map(D=>{const K=y.crewByDate[D],ce=y.peakCrewSize||1;return e.jsx("div",{className:"reports-mini-bar-wrap",title:`${new Date(D+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}: ${K} workers`,children:e.jsx("div",{className:"reports-mini-bar",style:{height:`${K/ce*100}%`}})},D)})})]})]})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(_t,{size:18}),e.jsx("h3",{children:"Safety Dashboard"})]}),e.jsx("span",{className:`reports-section-badge ${(y?.injuryReportsCount||0)>0?"warning":"success"}`,children:(y?.injuryReportsCount||0)>0?`${y.injuryReportsCount} incident${y.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsx("div",{className:"reports-safety-hero",children:e.jsxs("div",{className:`reports-safety-days ${y?.daysSinceLastInjury===null||y?.daysSinceLastInjury>30?"excellent":y?.daysSinceLastInjury>7?"good":"caution"}`,children:[e.jsx("span",{className:"reports-safety-days-value",children:y?.daysSinceLastInjury!==null?y.daysSinceLastInjury:"--"}),e.jsx("span",{className:"reports-safety-days-label",children:y?.daysSinceLastInjury!==null?"Days Since Last Incident":"No Incidents Recorded"})]})}),e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.injuryReportsCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Incidents"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.oshaRecordable||0}),e.jsx("span",{className:"reports-stat-label",children:"OSHA Recordable"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.reportsWithIssues||0}),e.jsx("span",{className:"reports-stat-label",children:"Reports w/ Issues"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.laborManDays||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Man-Days"})]})]})]})]})]}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Hs,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("span",{className:"reports-section-count",children:[y?.totalMaterialRequests||0," total"]})]}),e.jsx("div",{className:"reports-insight-body",children:(y?.totalMaterialRequests||0)===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Hs,{size:32}),e.jsx("p",{children:"No material requests yet"}),e.jsx("span",{children:"Requests from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-material-pipeline",children:[y?.urgentMaterialRequests>0&&e.jsxs("div",{className:"reports-material-status urgent",children:[e.jsx(Te,{size:14}),e.jsxs("span",{children:[y.urgentMaterialRequests," Urgent"]})]}),e.jsxs("div",{className:"reports-material-status pending",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[y?.pendingMaterialRequests||0," Pending"]})]}),e.jsxs("div",{className:"reports-material-status ordered",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[y?.orderedMaterialRequests||0," Ordered"]})]}),e.jsxs("div",{className:"reports-material-status delivered",children:[e.jsx(nl,{size:14}),e.jsxs("span",{children:[y?.deliveredMaterialRequests||0," Delivered"]})]})]}),e.jsx("div",{className:"reports-recent-list",children:(y?.materialRequests||[]).slice(0,3).map(D=>e.jsxs("div",{className:`reports-recent-item ${D.status}`,children:[e.jsxs("div",{className:"reports-recent-item-main",children:[e.jsx("span",{className:`reports-recent-item-status ${D.status}`,children:D.status}),e.jsx("span",{className:"reports-recent-item-date",children:new Date(D.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"reports-recent-item-detail",children:[(D.items||[]).slice(0,2).map((K,ce)=>e.jsxs("span",{children:[K.name,K.quantity?` (${K.quantity})`:""]},ce)),(D.items||[]).length>2&&e.jsxs("span",{className:"reports-recent-more",children:["+",(D.items||[]).length-2," more"]})]}),D.priority==="urgent"&&e.jsx("span",{className:"reports-urgent-tag",children:"URGENT"})]},D.id))})]})})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Xe,{size:18}),e.jsx("h3",{children:"Disposal Trends"})]}),e.jsxs("span",{className:"reports-section-count",children:[y?.disposalTotalLoads||0," loads"]})]}),e.jsx("div",{className:"reports-insight-body",children:(y?.weeklyDisposal||[]).length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Xe,{size:32}),e.jsx("p",{children:"No disposal data yet"}),e.jsx("span",{children:"Disposal loads from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-disposal-chart",children:[e.jsx("div",{className:"reports-disposal-bars",children:(y?.weeklyDisposal||[]).map((D,K)=>{const ce=(D.concrete||0)+(D.trash||0)+(D.metals||0)+(D.hazardous_waste||0),Me=Math.max(...(y?.weeklyDisposal||[]).map(Ce=>(Ce.concrete||0)+(Ce.trash||0)+(Ce.metals||0)+(Ce.hazardous_waste||0)))||1;return e.jsxs("div",{className:"reports-disposal-bar-col",children:[e.jsxs("div",{className:"reports-disposal-bar-stack",style:{height:`${ce/Me*100}%`},children:[D.concrete>0&&e.jsx("div",{className:"reports-disposal-seg concrete",style:{flex:D.concrete},title:`Concrete: ${D.concrete}`}),D.trash>0&&e.jsx("div",{className:"reports-disposal-seg trash",style:{flex:D.trash},title:`Trash: ${D.trash}`}),D.metals>0&&e.jsx("div",{className:"reports-disposal-seg metals",style:{flex:D.metals},title:`Metals: ${D.metals}`}),D.hazardous_waste>0&&e.jsx("div",{className:"reports-disposal-seg hazardous",style:{flex:D.hazardous_waste},title:`Hazardous: ${D.hazardous_waste}`})]}),e.jsx("span",{className:"reports-disposal-bar-label",children:new Date(D.week+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},K)})}),e.jsxs("div",{className:"reports-disposal-legend",children:[e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot concrete"}),"Concrete"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot trash"}),"Trash"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot metals"}),"Metals"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot hazardous"}),"Hazardous"]})]})]}),(y?.haulOffCost||0)>0&&e.jsxs("div",{className:"reports-disposal-cost",children:[e.jsx("span",{children:"Total Disposal Cost"}),e.jsx("strong",{children:ae(y.haulOffCost)})]})]})})]})]}),e.jsxs("div",{className:"reports-insight-card reports-activity-summary",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(xe,{size:18}),e.jsx("h3",{children:"Field Activity Summary"})]}),e.jsx("div",{className:"reports-activity-badges",children:y?.lastDailyReport&&e.jsxs("span",{className:"reports-last-filed",children:["Last report: ",new Date(y.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ","(",Math.floor((new Date-new Date(y.lastDailyReport))/(1e3*60*60*24)),"d ago)"]})})]}),e.jsx("div",{className:"reports-insight-body",children:e.jsxs("div",{className:"reports-activity-grid",children:[e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(xe,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.dailyReportsCount||0}),e.jsx("span",{children:"Daily Reports Filed"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(os,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.totalTickets||0}),e.jsx("span",{children:"T&M Tickets Created"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(rl,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.totalPhotosFromTickets||0}),e.jsx("span",{children:"Photos Documented"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Je,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsxs("strong",{children:[y?.completedAreasCount||0,"/",j.length]}),e.jsx("span",{children:"Work Areas Complete"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(ls,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:ae(y?.allCostsTotal||0)}),e.jsx("span",{children:"Total Costs Tracked"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(De,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.laborManDays||0}),e.jsx("span",{children:"Total Man-Days"})]})]})]})})]}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(xe,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[y?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(o.Suspense,{fallback:e.jsx(Ke,{}),children:e.jsx(po,{project:h,company:s,onShowToast:a})})})]}),e.jsxs("div",{className:`reports-section-card ${(y?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(y?.injuryReportsCount||0)>0?"warning":"success"}`,children:(y?.injuryReportsCount||0)>0?"⚠":"✓"}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(y?.injuryReportsCount||0)>0?"warning":"success"}`,children:(y?.injuryReportsCount||0)>0?`${y.injuryReportsCount} incident${y.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(o.Suspense,{fallback:e.jsx(Ke,{}),children:e.jsx(vo,{project:h,companyId:s?.id||h?.company_id,company:s,user:t,onShowToast:a})})})]})]}),N==="documents"&&e.jsx("div",{className:"pv-tab-panel documents-tab",children:e.jsx(o.Suspense,{fallback:e.jsx(Ke,{}),children:e.jsx(Oo,{project:h,companyId:s?.id||h?.company_id,onShowToast:a,userRole:n||"office"})})}),N==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:h.name}),h.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",h.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:Vt,children:e.jsx("span",{children:"Edit Project"})})]}),h.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(il,{size:14}),e.jsx("span",{children:h.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Je,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:h.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(os,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:h.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ls,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:ae(Q)}),e.jsx("span",{className:"info-quick-label",children:H>0?`Incl. +${ae(H)} COs`:"Contract Value"})]})]}),h.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:h.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(ll,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[h.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:h.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),h.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:h.client_contact})]}),h.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(cl,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${h.client_phone}`,className:"info-detail-value link",children:h.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Fa,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[pe>0&&e.jsxs("span",{className:"info-badge done",children:[pe," Done"]}),je>0&&e.jsxs("span",{className:"info-badge working",children:[je," Active"]}),we>0&&e.jsxs("span",{className:"info-badge pending",children:[we," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:j.map(D=>e.jsxs("div",{className:`info-area-item ${D.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[D.status==="done"&&e.jsx("span",{className:"status-dot done",children:"✓"}),D.status==="working"&&e.jsx("span",{className:"status-dot working",children:"●"}),D.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:"○"})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:D.name}),e.jsx("span",{className:`info-area-status-label ${D.status}`,children:D.status==="done"?"Complete":D.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[D.weight,"%"]})]},D.id))})]}),e.jsx(jo,{project:h,company:s,user:t,isAdmin:r,onShowToast:a}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(Ks,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:ae(h.contract_value)})]}),H>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",ae(H)]})]}),h.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:le.find(D=>D.id===h.default_dump_site_id)?.name||"Unknown"})]})]})]}),e.jsx("div",{className:"info-section-card",children:e.jsx(fo,{onShowToast:a})})]})]}),P&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Do,{project:h,user:t,onClose:()=>g(!1),onShareCreated:D=>{a("Share link created successfully!","success")}})}),A&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(o.Suspense,{fallback:null,children:e.jsx(Eo,{project:h,company:s,onShowToast:a,onClose:()=>v(!1)})})}),I&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Ro,{project:h,company:s,areas:j,existingCOR:C,onClose:()=>{b(!1),W(null)},onSaved:()=>{b(!1),W(null),Ve(D=>D+1)},onShowToast:a})}),E&&X&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Po,{cor:X,project:h,company:s,areas:j,onClose:()=>{Y(!1),Z(null)},onEdit:D=>{Y(!1),Z(null),W(D),b(!0)},onShowToast:a,onStatusChange:()=>{}})}),se==="log"&&h&&e.jsx("div",{className:"cor-log-modal-overlay",onClick:()=>$("list"),children:e.jsxs("div",{className:"cor-log-modal",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"cor-log-modal-header",children:[e.jsx("h2",{children:"Change Order Log"}),e.jsx("button",{className:"cor-log-modal-close",onClick:()=>$("list"),title:"Close",children:"✕"})]}),e.jsx("div",{className:"cor-log-modal-content",children:e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:e.jsx(To,{project:h,company:s,onShowToast:a})})})]})}),Be&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Mo,{onClose:()=>J(!1),saving:vs,onSave:async D=>{try{ee(!0),await q.addProjectCost(h.id,s.id,D),J(!1),fs(),a("Cost added successfully","success")}catch(K){console.error("Error adding cost:",K),a("Error adding cost","error")}finally{ee(!1)}}})}),Re&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Ao,{project:h,company:s,user:t,editItem:_e,onSave:()=>{ss(!1),We(null),Cn(D=>D+1),a(_e?"Equipment updated":"Equipment added","success")},onClose:()=>{ss(!1),We(null)}})}),kn&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Fo,{project:h,company:s,areas:j,corStats:u.find(D=>D.id===h?.id)?.corStats,editDrawRequest:zt,onSave:()=>{Fs(!1),As(null),Sn(D=>D+1),a(zt?"Draw request updated":"Draw request created","success")},onClose:()=>{Fs(!1),As(null)}})})]})}return i.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(xe,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("button",{className:"search-trigger-btn",onClick:()=>En(!0),children:[e.jsx(cn,{size:16}),e.jsx("span",{children:"Search"}),e.jsx("span",{className:"shortcut",children:"⌘K"})]}),e.jsxs("div",{className:"bo-project-count",children:[i.length," Active Project",i.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(dr,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:ae(cr)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:ae(lr)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:ae(or)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Jt>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:ae(ir)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",ta," project",ta!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",ae(Jt)]})]})]}),Xt>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:ae(ur)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",Xt," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[Qt>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:Qt}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),Zt>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Zt}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),ea>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:ea}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),sa>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:sa}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),mr&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[aa>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:aa}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),na>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:na}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),ra>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:ra}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),hr&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),la>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[la," under"]}),ca>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[ca," on track"]}),ia>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[ia," over"]})]})]})]}),Pe.allAlerts.length>0&&e.jsxs("div",{className:`smart-alerts-section${Pe.criticalCount>0?" smart-alerts-section--has-critical":Pe.allAlerts.some(w=>w.type==="warning")?" smart-alerts-section--has-warning":""}`,children:[e.jsxs("div",{className:"smart-alerts-header",children:[e.jsxs("div",{className:"smart-alerts-header__left",children:[e.jsx(Te,{className:"smart-alerts-header__icon",size:18}),e.jsx("h3",{className:"smart-alerts-header__title",children:"Needs Attention"})]}),Pe.criticalCount>0?e.jsxs("span",{className:"smart-alerts-count-badge smart-alerts-count-badge--critical",children:[Pe.criticalCount," critical"]}):e.jsxs("span",{className:"smart-alerts-count-badge smart-alerts-count-badge--warning",children:[Pe.allAlerts.length," item",Pe.allAlerts.length!==1?"s":""]})]}),e.jsx(Ic,{alerts:Pe.allAlerts,onAction:Un,maxVisible:3})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[i.length," active"]})]}),e.jsx("div",{className:"project-list",children:u.map(w=>{const z=Pe.projectRisks.find(H=>H.projectId===w.id);return e.jsx(Wo,{project:w,riskScore:z?.riskScore,riskStatus:z?.riskStatus,onClick:()=>Os(w)},w.id)})}),e.jsx(Oc,{isOpen:Dn,onClose:Rn,companyId:s?.id,onSelectProject:w=>{Os(w)},onSelectTicket:w=>{const z=i.find(H=>H.id===w.project_id);z&&(Os(z),F("financials"),S("tickets"))},onSelectCOR:w=>{const z=i.find(H=>H.id===w.project_id);z&&(Os(z),F("financials"),S("cors"),Z(w),Y(!0))},onShowToast:a})]})}function Wo({project:s,riskScore:t,riskStatus:r,onClick:n}){const a=Li(s.areas||[]),l=zi(s.areas||[]),c=s.contract_value-s.billable,i=s.billable>s.contract_value*.9&&s.progress<90,d={healthy:{bg:"var(--status-success-bg, #064e3b)",color:"var(--status-success, #059669)"},warning:{bg:"var(--status-warning-bg, #78350f)",color:"var(--status-warning, #d97706)"},critical:{bg:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"}},u=d[r]||d.healthy;return e.jsxs("div",{className:`project-card enhanced ${i?"at-risk":""}`,onClick:n,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[typeof t=="number"&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,background:u.bg,color:u.color},title:`Risk Score: ${t}`,"aria-label":`Risk score ${t}, ${r}`,children:t}),e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:s.name}),e.jsx("div",{className:"project-card-value",children:ae(s.contract_value)})]})]}),e.jsx("span",{className:`status-badge ${a}`,children:l})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[s.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:ae(s.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${c<0?"negative":""}`,children:ae(Math.abs(c))}),e.jsx("span",{className:"stat-label",children:c>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${s.progress}%`}})}),(s.pendingTickets>0||s.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[s.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[s.pendingTickets," Pending T&M"]}),s.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[s.approvedTickets," Approved T&M"]})]}),s.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${s.scheduleStatus}`,children:s.scheduleLabel}),s.hasLaborData&&s.laborLabel&&e.jsx("span",{className:`labor-indicator ${s.laborStatus}`,children:s.laborLabel})]})]})}const Qo=Object.freeze(Object.defineProperty({__proto__:null,default:Bo},Symbol.toStringTag,{value:"Module"}));export{xc as A,Xo as C,Qo as D,Ke as T,Hc as a,Ns as b,Jo as c,Yo as e};
//# sourceMappingURL=Dashboard-BRqDn5y2.js.map
