const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ForemanView-C4VgT-X3.js","assets/router-CeQ1XyMZ.js","assets/PieChart-mR7jnLMh.js","assets/imageUtils-Dl7qbYii.js","assets/icons-CvO0oR7x.js","assets/pdf-rft6H0l9.js","assets/FolderGrid-DD7stlTj.js","assets/PunchList-CYD4Y6_3.js","assets/supabase-Ce1s_jZn.js","assets/Dashboard-B0ogE3ht.js","assets/corCalculations-vdJc_BOT.js","assets/Setup-CrUjHuhT.js","assets/BrandingSettings-YCzSoxGi.js","assets/PricingManager-1ILYUE-q.js","assets/PublicView-Qbc0nEY3.js","assets/SignaturePage-BeL4GKK6.js","assets/SignatureCanvas-BbrBdMCr.js","assets/MembershipManager-BfR15Kmn.js","assets/LandingPage-BS0B9ffx.js"])))=>i.map(i=>d[i]);
import{b as dg,c as fg,a as mg,r as R,u as _g,d as pg,e as gg,R as hg,f as Zt,N as Tn,h as Ym,i as yg,B as bg}from"./router-CeQ1XyMZ.js";import{_ as Aa}from"./pdf-rft6H0l9.js";import{c as Gm}from"./supabase-Ce1s_jZn.js";import{H as vg,B as Sg,A as ua,C as rc,U as wg,a as jg,b as _c,E as Eg,c as qg,S as Dg,M as Cg,T as Tg,D as xg,X as Ag,d as Ng,L as Og}from"./icons-CvO0oR7x.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))s(u);new MutationObserver(u=>{for(const d of u)if(d.type==="childList")for(const m of d.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function i(u){const d={};return u.integrity&&(d.integrity=u.integrity),u.referrerPolicy&&(d.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?d.credentials="include":u.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(u){if(u.ep)return;u.ep=!0;const d=i(u);fetch(u.href,d)}})();var lc={exports:{}},ul={};var jm;function Mg(){if(jm)return ul;jm=1;var r=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function i(s,u,d){var m=null;if(d!==void 0&&(m=""+d),u.key!==void 0&&(m=""+u.key),"key"in u){d={};for(var g in u)g!=="key"&&(d[g]=u[g])}else d=u;return u=d.ref,{$$typeof:r,type:s,key:m,ref:u!==void 0?u:null,props:d}}return ul.Fragment=l,ul.jsx=i,ul.jsxs=i,ul}var Em;function zg(){return Em||(Em=1,lc.exports=Mg()),lc.exports}var _=zg(),ic={exports:{}},dl={},sc={exports:{}},oc={};var qm;function Rg(){return qm||(qm=1,(function(r){function l(A,B){var K=A.length;A.push(B);e:for(;0<K;){var ge=K-1>>>1,ce=A[ge];if(0<u(ce,B))A[ge]=B,A[K]=ce,K=ge;else break e}}function i(A){return A.length===0?null:A[0]}function s(A){if(A.length===0)return null;var B=A[0],K=A.pop();if(K!==B){A[0]=K;e:for(var ge=0,ce=A.length,He=ce>>>1;ge<He;){var he=2*(ge+1)-1,re=A[he],Ae=he+1,Ke=A[Ae];if(0>u(re,K))Ae<ce&&0>u(Ke,re)?(A[ge]=Ke,A[Ae]=K,ge=Ae):(A[ge]=re,A[he]=K,ge=he);else if(Ae<ce&&0>u(Ke,K))A[ge]=Ke,A[Ae]=K,ge=Ae;else break e}}return B}function u(A,B){var K=A.sortIndex-B.sortIndex;return K!==0?K:A.id-B.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;r.unstable_now=function(){return d.now()}}else{var m=Date,g=m.now();r.unstable_now=function(){return m.now()-g}}var b=[],x=[],z=1,E=null,k=3,X=!1,H=!1,Y=!1,G=!1,oe=typeof setTimeout=="function"?setTimeout:null,Ee=typeof clearTimeout=="function"?clearTimeout:null,ve=typeof setImmediate<"u"?setImmediate:null;function P(A){for(var B=i(x);B!==null;){if(B.callback===null)s(x);else if(B.startTime<=A)s(x),B.sortIndex=B.expirationTime,l(b,B);else break;B=i(x)}}function _e(A){if(Y=!1,P(A),!H)if(i(b)!==null)H=!0,ke||(ke=!0,xe());else{var B=i(x);B!==null&&Be(_e,B.startTime-A)}}var ke=!1,st=-1,et=5,ta=-1;function Jt(){return G?!0:!(r.unstable_now()-ta<et)}function pt(){if(G=!1,ke){var A=r.unstable_now();ta=A;var B=!0;try{e:{H=!1,Y&&(Y=!1,Ee(st),st=-1),X=!0;var K=k;try{t:{for(P(A),E=i(b);E!==null&&!(E.expirationTime>A&&Jt());){var ge=E.callback;if(typeof ge=="function"){E.callback=null,k=E.priorityLevel;var ce=ge(E.expirationTime<=A);if(A=r.unstable_now(),typeof ce=="function"){E.callback=ce,P(A),B=!0;break t}E===i(b)&&s(b),P(A)}else s(b);E=i(b)}if(E!==null)B=!0;else{var He=i(x);He!==null&&Be(_e,He.startTime-A),B=!1}}break e}finally{E=null,k=K,X=!1}B=void 0}}finally{B?xe():ke=!1}}}var xe;if(typeof ve=="function")xe=function(){ve(pt)};else if(typeof MessageChannel<"u"){var aa=new MessageChannel,qt=aa.port2;aa.port1.onmessage=pt,xe=function(){qt.postMessage(null)}}else xe=function(){oe(pt,0)};function Be(A,B){st=oe(function(){A(r.unstable_now())},B)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(A){A.callback=null},r.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):et=0<A?Math.floor(1e3/A):5},r.unstable_getCurrentPriorityLevel=function(){return k},r.unstable_next=function(A){switch(k){case 1:case 2:case 3:var B=3;break;default:B=k}var K=k;k=B;try{return A()}finally{k=K}},r.unstable_requestPaint=function(){G=!0},r.unstable_runWithPriority=function(A,B){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var K=k;k=A;try{return B()}finally{k=K}},r.unstable_scheduleCallback=function(A,B,K){var ge=r.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?ge+K:ge):K=ge,A){case 1:var ce=-1;break;case 2:ce=250;break;case 5:ce=1073741823;break;case 4:ce=1e4;break;default:ce=5e3}return ce=K+ce,A={id:z++,callback:B,priorityLevel:A,startTime:K,expirationTime:ce,sortIndex:-1},K>ge?(A.sortIndex=K,l(x,A),i(b)===null&&A===i(x)&&(Y?(Ee(st),st=-1):Y=!0,Be(_e,K-ge))):(A.sortIndex=ce,l(b,A),H||X||(H=!0,ke||(ke=!0,xe()))),A},r.unstable_shouldYield=Jt,r.unstable_wrapCallback=function(A){var B=k;return function(){var K=k;k=B;try{return A.apply(this,arguments)}finally{k=K}}}})(oc)),oc}var Dm;function Ug(){return Dm||(Dm=1,sc.exports=Rg()),sc.exports}var Cm;function kg(){if(Cm)return dl;Cm=1;var r=Ug(),l=dg(),i=fg();function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function u(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function m(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function g(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function b(e){if(d(e)!==e)throw Error(s(188))}function x(e){var t=e.alternate;if(!t){if(t=d(e),t===null)throw Error(s(188));return t!==e?null:e}for(var a=e,n=t;;){var o=a.return;if(o===null)break;var c=o.alternate;if(c===null){if(n=o.return,n!==null){a=n;continue}break}if(o.child===c.child){for(c=o.child;c;){if(c===a)return b(o),e;if(c===n)return b(o),t;c=c.sibling}throw Error(s(188))}if(a.return!==n.return)a=o,n=c;else{for(var f=!1,p=o.child;p;){if(p===a){f=!0,a=o,n=c;break}if(p===n){f=!0,n=o,a=c;break}p=p.sibling}if(!f){for(p=c.child;p;){if(p===a){f=!0,a=c,n=o;break}if(p===n){f=!0,n=c,a=o;break}p=p.sibling}if(!f)throw Error(s(189))}}if(a.alternate!==n)throw Error(s(190))}if(a.tag!==3)throw Error(s(188));return a.stateNode.current===a?e:t}function z(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=z(e),t!==null)return t;e=e.sibling}return null}var E=Object.assign,k=Symbol.for("react.element"),X=Symbol.for("react.transitional.element"),H=Symbol.for("react.portal"),Y=Symbol.for("react.fragment"),G=Symbol.for("react.strict_mode"),oe=Symbol.for("react.profiler"),Ee=Symbol.for("react.consumer"),ve=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),_e=Symbol.for("react.suspense"),ke=Symbol.for("react.suspense_list"),st=Symbol.for("react.memo"),et=Symbol.for("react.lazy"),ta=Symbol.for("react.activity"),Jt=Symbol.for("react.memo_cache_sentinel"),pt=Symbol.iterator;function xe(e){return e===null||typeof e!="object"?null:(e=pt&&e[pt]||e["@@iterator"],typeof e=="function"?e:null)}var aa=Symbol.for("react.client.reference");function qt(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===aa?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Y:return"Fragment";case oe:return"Profiler";case G:return"StrictMode";case _e:return"Suspense";case ke:return"SuspenseList";case ta:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case H:return"Portal";case ve:return e.displayName||"Context";case Ee:return(e._context.displayName||"Context")+".Consumer";case P:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case st:return t=e.displayName||null,t!==null?t:qt(e.type)||"Memo";case et:t=e._payload,e=e._init;try{return qt(e(t))}catch{}}return null}var Be=Array.isArray,A=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K={pending:!1,data:null,method:null,action:null},ge=[],ce=-1;function He(e){return{current:e}}function he(e){0>ce||(e.current=ge[ce],ge[ce]=null,ce--)}function re(e,t){ce++,ge[ce]=e.current,e.current=t}var Ae=He(null),Ke=He(null),ot=He(null),da=He(null);function na(e,t){switch(re(ot,t),re(Ke,e),re(Ae,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Zf(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Zf(t),e=Kf(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}he(Ae),re(Ae,e)}function ra(){he(Ae),he(Ke),he(ot)}function $e(e){e.memoizedState!==null&&re(da,e);var t=Ae.current,a=Kf(t,e.type);t!==a&&(re(Ke,e),re(Ae,a))}function ct(e){Ke.current===e&&(he(Ae),he(Ke)),da.current===e&&(he(da),il._currentValue=K)}var gt,$t;function $(e){if(gt===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);gt=t&&t[1]||"",$t=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+gt+e+$t}var W=!1;function de(e,t){if(!e||W)return"";W=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(t){var M=function(){throw Error()};if(Object.defineProperty(M.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(M,[])}catch(T){var C=T}Reflect.construct(e,[],M)}else{try{M.call()}catch(T){C=T}e.call(M.prototype)}}else{try{throw Error()}catch(T){C=T}(M=e())&&typeof M.catch=="function"&&M.catch(function(){})}}catch(T){if(T&&C&&typeof T.stack=="string")return[T.stack,C.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var c=n.DetermineComponentFrameRoot(),f=c[0],p=c[1];if(f&&p){var v=f.split(`
`),D=p.split(`
`);for(o=n=0;n<v.length&&!v[n].includes("DetermineComponentFrameRoot");)n++;for(;o<D.length&&!D[o].includes("DetermineComponentFrameRoot");)o++;if(n===v.length||o===D.length)for(n=v.length-1,o=D.length-1;1<=n&&0<=o&&v[n]!==D[o];)o--;for(;1<=n&&0<=o;n--,o--)if(v[n]!==D[o]){if(n!==1||o!==1)do if(n--,o--,0>o||v[n]!==D[o]){var N=`
`+v[n].replace(" at new "," at ");return e.displayName&&N.includes("<anonymous>")&&(N=N.replace("<anonymous>",e.displayName)),N}while(1<=n&&0<=o);break}}}finally{W=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?$(a):""}function Ft(e,t){switch(e.tag){case 26:case 27:case 5:return $(e.type);case 16:return $("Lazy");case 13:return e.child!==t&&t!==null?$("Suspense Fallback"):$("Suspense");case 19:return $("SuspenseList");case 0:case 15:return de(e.type,!1);case 11:return de(e.type.render,!1);case 1:return de(e.type,!0);case 31:return $("Activity");default:return""}}function ut(e){try{var t="",a=null;do t+=Ft(e,a),a=e,e=e.return;while(e);return t}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var tt=Object.prototype.hasOwnProperty,Oe=r.unstable_scheduleCallback,Wt=r.unstable_cancelCallback,la=r.unstable_shouldYield,Dt=r.unstable_requestPaint,Me=r.unstable_now,sn=r.unstable_getCurrentPriorityLevel,on=r.unstable_ImmediatePriority,yr=r.unstable_UserBlockingPriority,Oa=r.unstable_NormalPriority,hl=r.unstable_LowPriority,U=r.unstable_IdlePriority,De=r.log,Ma=r.unstable_setDisableYieldValue,dt=null,Fe=null;function We(e){if(typeof De=="function"&&Ma(e),Fe&&typeof Fe.setStrictMode=="function")try{Fe.setStrictMode(dt,e)}catch{}}var ze=Math.clz32?Math.clz32:yl,za=Math.log,cn=Math.LN2;function yl(e){return e>>>=0,e===0?32:31-(za(e)/cn|0)|0}var bl=256,vl=262144,Sl=4194304;function un(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function wl(e,t,a){var n=e.pendingLanes;if(n===0)return 0;var o=0,c=e.suspendedLanes,f=e.pingedLanes;e=e.warmLanes;var p=n&134217727;return p!==0?(n=p&~c,n!==0?o=un(n):(f&=p,f!==0?o=un(f):a||(a=p&~e,a!==0&&(o=un(a))))):(p=n&~c,p!==0?o=un(p):f!==0?o=un(f):a||(a=n&~e,a!==0&&(o=un(a)))),o===0?0:t!==0&&t!==o&&(t&c)===0&&(c=o&-o,a=t&-t,c>=a||c===32&&(a&4194048)!==0)?t:o}function br(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function Pm(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Dc(){var e=Sl;return Sl<<=1,(Sl&62914560)===0&&(Sl=4194304),e}function Vi(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function vr(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Im(e,t,a,n,o,c){var f=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var p=e.entanglements,v=e.expirationTimes,D=e.hiddenUpdates;for(a=f&~a;0<a;){var N=31-ze(a),M=1<<N;p[N]=0,v[N]=-1;var C=D[N];if(C!==null)for(D[N]=null,N=0;N<C.length;N++){var T=C[N];T!==null&&(T.lane&=-536870913)}a&=~M}n!==0&&Cc(e,n,0),c!==0&&o===0&&e.tag!==0&&(e.suspendedLanes|=c&~(f&~t))}function Cc(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var n=31-ze(t);e.entangledLanes|=t,e.entanglements[n]=e.entanglements[n]|1073741824|a&261930}function Tc(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var n=31-ze(a),o=1<<n;o&t|e[n]&t&&(e[n]|=t),a&=~o}}function xc(e,t){var a=t&-t;return a=(a&42)!==0?1:Zi(a),(a&(e.suspendedLanes|t))!==0?0:a}function Zi(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Ki(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Ac(){var e=B.p;return e!==0?e:(e=window.event,e===void 0?32:gm(e.type))}function Nc(e,t){var a=B.p;try{return B.p=e,t()}finally{B.p=a}}var Ra=Math.random().toString(36).slice(2),at="__reactFiber$"+Ra,ht="__reactProps$"+Ra,On="__reactContainer$"+Ra,Ji="__reactEvents$"+Ra,e_="__reactListeners$"+Ra,t_="__reactHandles$"+Ra,Oc="__reactResources$"+Ra,Sr="__reactMarker$"+Ra;function $i(e){delete e[at],delete e[ht],delete e[Ji],delete e[e_],delete e[t_]}function Mn(e){var t=e[at];if(t)return t;for(var a=e.parentNode;a;){if(t=a[On]||a[at]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=em(e);e!==null;){if(a=e[at])return a;e=em(e)}return t}e=a,a=e.parentNode}return null}function zn(e){if(e=e[at]||e[On]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function wr(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(s(33))}function Rn(e){var t=e[Oc];return t||(t=e[Oc]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Pe(e){e[Sr]=!0}var Mc=new Set,zc={};function dn(e,t){Un(e,t),Un(e+"Capture",t)}function Un(e,t){for(zc[e]=t,e=0;e<t.length;e++)Mc.add(t[e])}var a_=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Rc={},Uc={};function n_(e){return tt.call(Uc,e)?!0:tt.call(Rc,e)?!1:a_.test(e)?Uc[e]=!0:(Rc[e]=!0,!1)}function jl(e,t,a){if(n_(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var n=t.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function El(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function fa(e,t,a,n){if(n===null)e.removeAttribute(a);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+n)}}function Ut(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function kc(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function r_(e,t,a){var n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,c=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(f){a=""+f,c.call(this,f)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(f){a=""+f},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Fi(e){if(!e._valueTracker){var t=kc(e)?"checked":"value";e._valueTracker=r_(e,t,""+e[t])}}function Bc(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),n="";return e&&(n=kc(e)?e.checked?"true":"false":e.value),e=n,e!==a?(t.setValue(e),!0):!1}function ql(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var l_=/[\n"\\]/g;function kt(e){return e.replace(l_,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Wi(e,t,a,n,o,c,f,p){e.name="",f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"?e.type=f:e.removeAttribute("type"),t!=null?f==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+Ut(t)):e.value!==""+Ut(t)&&(e.value=""+Ut(t)):f!=="submit"&&f!=="reset"||e.removeAttribute("value"),t!=null?Pi(e,f,Ut(t)):a!=null?Pi(e,f,Ut(a)):n!=null&&e.removeAttribute("value"),o==null&&c!=null&&(e.defaultChecked=!!c),o!=null&&(e.checked=o&&typeof o!="function"&&typeof o!="symbol"),p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"?e.name=""+Ut(p):e.removeAttribute("name")}function Hc(e,t,a,n,o,c,f,p){if(c!=null&&typeof c!="function"&&typeof c!="symbol"&&typeof c!="boolean"&&(e.type=c),t!=null||a!=null){if(!(c!=="submit"&&c!=="reset"||t!=null)){Fi(e);return}a=a!=null?""+Ut(a):"",t=t!=null?""+Ut(t):a,p||t===e.value||(e.value=t),e.defaultValue=t}n=n??o,n=typeof n!="function"&&typeof n!="symbol"&&!!n,e.checked=p?e.checked:!!n,e.defaultChecked=!!n,f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"&&(e.name=f),Fi(e)}function Pi(e,t,a){t==="number"&&ql(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function kn(e,t,a,n){if(e=e.options,t){t={};for(var o=0;o<a.length;o++)t["$"+a[o]]=!0;for(a=0;a<e.length;a++)o=t.hasOwnProperty("$"+e[a].value),e[a].selected!==o&&(e[a].selected=o),o&&n&&(e[a].defaultSelected=!0)}else{for(a=""+Ut(a),t=null,o=0;o<e.length;o++){if(e[o].value===a){e[o].selected=!0,n&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function Lc(e,t,a){if(t!=null&&(t=""+Ut(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+Ut(a):""}function Yc(e,t,a,n){if(t==null){if(n!=null){if(a!=null)throw Error(s(92));if(Be(n)){if(1<n.length)throw Error(s(93));n=n[0]}a=n}a==null&&(a=""),t=a}a=Ut(t),e.defaultValue=a,n=e.textContent,n===a&&n!==""&&n!==null&&(e.value=n),Fi(e)}function Bn(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var i_=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Gc(e,t,a){var n=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?n?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":n?e.setProperty(t,a):typeof a!="number"||a===0||i_.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function Qc(e,t,a){if(t!=null&&typeof t!="object")throw Error(s(62));if(e=e.style,a!=null){for(var n in a)!a.hasOwnProperty(n)||t!=null&&t.hasOwnProperty(n)||(n.indexOf("--")===0?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="");for(var o in t)n=t[o],t.hasOwnProperty(o)&&a[o]!==n&&Gc(e,o,n)}else for(var c in t)t.hasOwnProperty(c)&&Gc(e,c,t[c])}function Ii(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var s_=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),o_=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Dl(e){return o_.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function ma(){}var es=null;function ts(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Hn=null,Ln=null;function Xc(e){var t=zn(e);if(t&&(e=t.stateNode)){var a=e[ht]||null;e:switch(e=t.stateNode,t.type){case"input":if(Wi(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+kt(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var n=a[t];if(n!==e&&n.form===e.form){var o=n[ht]||null;if(!o)throw Error(s(90));Wi(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(t=0;t<a.length;t++)n=a[t],n.form===e.form&&Bc(n)}break e;case"textarea":Lc(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&kn(e,!!a.multiple,t,!1)}}}var as=!1;function Vc(e,t,a){if(as)return e(t,a);as=!0;try{var n=e(t);return n}finally{if(as=!1,(Hn!==null||Ln!==null)&&(mi(),Hn&&(t=Hn,e=Ln,Ln=Hn=null,Xc(t),e)))for(t=0;t<e.length;t++)Xc(e[t])}}function jr(e,t){var a=e.stateNode;if(a===null)return null;var n=a[ht]||null;if(n===null)return null;a=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(s(231,t,typeof a));return a}var _a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ns=!1;if(_a)try{var Er={};Object.defineProperty(Er,"passive",{get:function(){ns=!0}}),window.addEventListener("test",Er,Er),window.removeEventListener("test",Er,Er)}catch{ns=!1}var Ua=null,rs=null,Cl=null;function Zc(){if(Cl)return Cl;var e,t=rs,a=t.length,n,o="value"in Ua?Ua.value:Ua.textContent,c=o.length;for(e=0;e<a&&t[e]===o[e];e++);var f=a-e;for(n=1;n<=f&&t[a-n]===o[c-n];n++);return Cl=o.slice(e,1<n?1-n:void 0)}function Tl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function xl(){return!0}function Kc(){return!1}function yt(e){function t(a,n,o,c,f){this._reactName=a,this._targetInst=o,this.type=n,this.nativeEvent=c,this.target=f,this.currentTarget=null;for(var p in e)e.hasOwnProperty(p)&&(a=e[p],this[p]=a?a(c):c[p]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?xl:Kc,this.isPropagationStopped=Kc,this}return E(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=xl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=xl)},persist:function(){},isPersistent:xl}),t}var fn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Al=yt(fn),qr=E({},fn,{view:0,detail:0}),c_=yt(qr),ls,is,Dr,Nl=E({},qr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:os,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Dr&&(Dr&&e.type==="mousemove"?(ls=e.screenX-Dr.screenX,is=e.screenY-Dr.screenY):is=ls=0,Dr=e),ls)},movementY:function(e){return"movementY"in e?e.movementY:is}}),Jc=yt(Nl),u_=E({},Nl,{dataTransfer:0}),d_=yt(u_),f_=E({},qr,{relatedTarget:0}),ss=yt(f_),m_=E({},fn,{animationName:0,elapsedTime:0,pseudoElement:0}),__=yt(m_),p_=E({},fn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),g_=yt(p_),h_=E({},fn,{data:0}),$c=yt(h_),y_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},b_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},v_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function S_(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=v_[e])?!!t[e]:!1}function os(){return S_}var w_=E({},qr,{key:function(e){if(e.key){var t=y_[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Tl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?b_[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:os,charCode:function(e){return e.type==="keypress"?Tl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Tl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),j_=yt(w_),E_=E({},Nl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fc=yt(E_),q_=E({},qr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:os}),D_=yt(q_),C_=E({},fn,{propertyName:0,elapsedTime:0,pseudoElement:0}),T_=yt(C_),x_=E({},Nl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),A_=yt(x_),N_=E({},fn,{newState:0,oldState:0}),O_=yt(N_),M_=[9,13,27,32],cs=_a&&"CompositionEvent"in window,Cr=null;_a&&"documentMode"in document&&(Cr=document.documentMode);var z_=_a&&"TextEvent"in window&&!Cr,Wc=_a&&(!cs||Cr&&8<Cr&&11>=Cr),Pc=" ",Ic=!1;function eu(e,t){switch(e){case"keyup":return M_.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Yn=!1;function R_(e,t){switch(e){case"compositionend":return tu(t);case"keypress":return t.which!==32?null:(Ic=!0,Pc);case"textInput":return e=t.data,e===Pc&&Ic?null:e;default:return null}}function U_(e,t){if(Yn)return e==="compositionend"||!cs&&eu(e,t)?(e=Zc(),Cl=rs=Ua=null,Yn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Wc&&t.locale!=="ko"?null:t.data;default:return null}}var k_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function au(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!k_[e.type]:t==="textarea"}function nu(e,t,a,n){Hn?Ln?Ln.push(n):Ln=[n]:Hn=n,t=vi(t,"onChange"),0<t.length&&(a=new Al("onChange","change",null,a,n),e.push({event:a,listeners:t}))}var Tr=null,xr=null;function B_(e){Lf(e,0)}function Ol(e){var t=wr(e);if(Bc(t))return e}function ru(e,t){if(e==="change")return t}var lu=!1;if(_a){var us;if(_a){var ds="oninput"in document;if(!ds){var iu=document.createElement("div");iu.setAttribute("oninput","return;"),ds=typeof iu.oninput=="function"}us=ds}else us=!1;lu=us&&(!document.documentMode||9<document.documentMode)}function su(){Tr&&(Tr.detachEvent("onpropertychange",ou),xr=Tr=null)}function ou(e){if(e.propertyName==="value"&&Ol(xr)){var t=[];nu(t,xr,e,ts(e)),Vc(B_,t)}}function H_(e,t,a){e==="focusin"?(su(),Tr=t,xr=a,Tr.attachEvent("onpropertychange",ou)):e==="focusout"&&su()}function L_(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Ol(xr)}function Y_(e,t){if(e==="click")return Ol(t)}function G_(e,t){if(e==="input"||e==="change")return Ol(t)}function Q_(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ct=typeof Object.is=="function"?Object.is:Q_;function Ar(e,t){if(Ct(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(n=0;n<a.length;n++){var o=a[n];if(!tt.call(t,o)||!Ct(e[o],t[o]))return!1}return!0}function cu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function uu(e,t){var a=cu(e);e=0;for(var n;a;){if(a.nodeType===3){if(n=e+a.textContent.length,e<=t&&n>=t)return{node:a,offset:t-e};e=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=cu(a)}}function du(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?du(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function fu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=ql(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=ql(e.document)}return t}function fs(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var X_=_a&&"documentMode"in document&&11>=document.documentMode,Gn=null,ms=null,Nr=null,_s=!1;function mu(e,t,a){var n=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;_s||Gn==null||Gn!==ql(n)||(n=Gn,"selectionStart"in n&&fs(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Nr&&Ar(Nr,n)||(Nr=n,n=vi(ms,"onSelect"),0<n.length&&(t=new Al("onSelect","select",null,t,a),e.push({event:t,listeners:n}),t.target=Gn)))}function mn(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Qn={animationend:mn("Animation","AnimationEnd"),animationiteration:mn("Animation","AnimationIteration"),animationstart:mn("Animation","AnimationStart"),transitionrun:mn("Transition","TransitionRun"),transitionstart:mn("Transition","TransitionStart"),transitioncancel:mn("Transition","TransitionCancel"),transitionend:mn("Transition","TransitionEnd")},ps={},_u={};_a&&(_u=document.createElement("div").style,"AnimationEvent"in window||(delete Qn.animationend.animation,delete Qn.animationiteration.animation,delete Qn.animationstart.animation),"TransitionEvent"in window||delete Qn.transitionend.transition);function _n(e){if(ps[e])return ps[e];if(!Qn[e])return e;var t=Qn[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in _u)return ps[e]=t[a];return e}var pu=_n("animationend"),gu=_n("animationiteration"),hu=_n("animationstart"),V_=_n("transitionrun"),Z_=_n("transitionstart"),K_=_n("transitioncancel"),yu=_n("transitionend"),bu=new Map,gs="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");gs.push("scrollEnd");function Pt(e,t){bu.set(e,t),dn(t,[e])}var Ml=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Bt=[],Xn=0,hs=0;function zl(){for(var e=Xn,t=hs=Xn=0;t<e;){var a=Bt[t];Bt[t++]=null;var n=Bt[t];Bt[t++]=null;var o=Bt[t];Bt[t++]=null;var c=Bt[t];if(Bt[t++]=null,n!==null&&o!==null){var f=n.pending;f===null?o.next=o:(o.next=f.next,f.next=o),n.pending=o}c!==0&&vu(a,o,c)}}function Rl(e,t,a,n){Bt[Xn++]=e,Bt[Xn++]=t,Bt[Xn++]=a,Bt[Xn++]=n,hs|=n,e.lanes|=n,e=e.alternate,e!==null&&(e.lanes|=n)}function ys(e,t,a,n){return Rl(e,t,a,n),Ul(e)}function pn(e,t){return Rl(e,null,null,t),Ul(e)}function vu(e,t,a){e.lanes|=a;var n=e.alternate;n!==null&&(n.lanes|=a);for(var o=!1,c=e.return;c!==null;)c.childLanes|=a,n=c.alternate,n!==null&&(n.childLanes|=a),c.tag===22&&(e=c.stateNode,e===null||e._visibility&1||(o=!0)),e=c,c=c.return;return e.tag===3?(c=e.stateNode,o&&t!==null&&(o=31-ze(a),e=c.hiddenUpdates,n=e[o],n===null?e[o]=[t]:n.push(t),t.lane=a|536870912),c):null}function Ul(e){if(50<Ir)throw Ir=0,To=null,Error(s(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var Vn={};function J_(e,t,a,n){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tt(e,t,a,n){return new J_(e,t,a,n)}function bs(e){return e=e.prototype,!(!e||!e.isReactComponent)}function pa(e,t){var a=e.alternate;return a===null?(a=Tt(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Su(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function kl(e,t,a,n,o,c){var f=0;if(n=e,typeof e=="function")bs(e)&&(f=1);else if(typeof e=="string")f=Ip(e,a,Ae.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ta:return e=Tt(31,a,t,o),e.elementType=ta,e.lanes=c,e;case Y:return gn(a.children,o,c,t);case G:f=8,o|=24;break;case oe:return e=Tt(12,a,t,o|2),e.elementType=oe,e.lanes=c,e;case _e:return e=Tt(13,a,t,o),e.elementType=_e,e.lanes=c,e;case ke:return e=Tt(19,a,t,o),e.elementType=ke,e.lanes=c,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case ve:f=10;break e;case Ee:f=9;break e;case P:f=11;break e;case st:f=14;break e;case et:f=16,n=null;break e}f=29,a=Error(s(130,e===null?"null":typeof e,"")),n=null}return t=Tt(f,a,t,o),t.elementType=e,t.type=n,t.lanes=c,t}function gn(e,t,a,n){return e=Tt(7,e,n,t),e.lanes=a,e}function vs(e,t,a){return e=Tt(6,e,null,t),e.lanes=a,e}function wu(e){var t=Tt(18,null,null,0);return t.stateNode=e,t}function Ss(e,t,a){return t=Tt(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var ju=new WeakMap;function Ht(e,t){if(typeof e=="object"&&e!==null){var a=ju.get(e);return a!==void 0?a:(t={value:e,source:t,stack:ut(t)},ju.set(e,t),t)}return{value:e,source:t,stack:ut(t)}}var Zn=[],Kn=0,Bl=null,Or=0,Lt=[],Yt=0,ka=null,ia=1,sa="";function ga(e,t){Zn[Kn++]=Or,Zn[Kn++]=Bl,Bl=e,Or=t}function Eu(e,t,a){Lt[Yt++]=ia,Lt[Yt++]=sa,Lt[Yt++]=ka,ka=e;var n=ia;e=sa;var o=32-ze(n)-1;n&=~(1<<o),a+=1;var c=32-ze(t)+o;if(30<c){var f=o-o%5;c=(n&(1<<f)-1).toString(32),n>>=f,o-=f,ia=1<<32-ze(t)+o|a<<o|n,sa=c+e}else ia=1<<c|a<<o|n,sa=e}function ws(e){e.return!==null&&(ga(e,1),Eu(e,1,0))}function js(e){for(;e===Bl;)Bl=Zn[--Kn],Zn[Kn]=null,Or=Zn[--Kn],Zn[Kn]=null;for(;e===ka;)ka=Lt[--Yt],Lt[Yt]=null,sa=Lt[--Yt],Lt[Yt]=null,ia=Lt[--Yt],Lt[Yt]=null}function qu(e,t){Lt[Yt++]=ia,Lt[Yt++]=sa,Lt[Yt++]=ka,ia=t.id,sa=t.overflow,ka=e}var nt=null,Ce=null,se=!1,Ba=null,Gt=!1,Es=Error(s(519));function Ha(e){var t=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Mr(Ht(t,e)),Es}function Du(e){var t=e.stateNode,a=e.type,n=e.memoizedProps;switch(t[at]=e,t[ht]=n,a){case"dialog":ne("cancel",t),ne("close",t);break;case"iframe":case"object":case"embed":ne("load",t);break;case"video":case"audio":for(a=0;a<tl.length;a++)ne(tl[a],t);break;case"source":ne("error",t);break;case"img":case"image":case"link":ne("error",t),ne("load",t);break;case"details":ne("toggle",t);break;case"input":ne("invalid",t),Hc(t,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":ne("invalid",t);break;case"textarea":ne("invalid",t),Yc(t,n.value,n.defaultValue,n.children)}a=n.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||n.suppressHydrationWarning===!0||Xf(t.textContent,a)?(n.popover!=null&&(ne("beforetoggle",t),ne("toggle",t)),n.onScroll!=null&&ne("scroll",t),n.onScrollEnd!=null&&ne("scrollend",t),n.onClick!=null&&(t.onclick=ma),t=!0):t=!1,t||Ha(e,!0)}function Cu(e){for(nt=e.return;nt;)switch(nt.tag){case 5:case 31:case 13:Gt=!1;return;case 27:case 3:Gt=!0;return;default:nt=nt.return}}function Jn(e){if(e!==nt)return!1;if(!se)return Cu(e),se=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||Qo(e.type,e.memoizedProps)),a=!a),a&&Ce&&Ha(e),Cu(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));Ce=If(e)}else if(t===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));Ce=If(e)}else t===27?(t=Ce,Ia(e.type)?(e=Jo,Jo=null,Ce=e):Ce=t):Ce=nt?Xt(e.stateNode.nextSibling):null;return!0}function hn(){Ce=nt=null,se=!1}function qs(){var e=Ba;return e!==null&&(wt===null?wt=e:wt.push.apply(wt,e),Ba=null),e}function Mr(e){Ba===null?Ba=[e]:Ba.push(e)}var Ds=He(null),yn=null,ha=null;function La(e,t,a){re(Ds,t._currentValue),t._currentValue=a}function ya(e){e._currentValue=Ds.current,he(Ds)}function Cs(e,t,a){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===a)break;e=e.return}}function Ts(e,t,a,n){var o=e.child;for(o!==null&&(o.return=e);o!==null;){var c=o.dependencies;if(c!==null){var f=o.child;c=c.firstContext;e:for(;c!==null;){var p=c;c=o;for(var v=0;v<t.length;v++)if(p.context===t[v]){c.lanes|=a,p=c.alternate,p!==null&&(p.lanes|=a),Cs(c.return,a,e),n||(f=null);break e}c=p.next}}else if(o.tag===18){if(f=o.return,f===null)throw Error(s(341));f.lanes|=a,c=f.alternate,c!==null&&(c.lanes|=a),Cs(f,a,e),f=null}else f=o.child;if(f!==null)f.return=o;else for(f=o;f!==null;){if(f===e){f=null;break}if(o=f.sibling,o!==null){o.return=f.return,f=o;break}f=f.return}o=f}}function $n(e,t,a,n){e=null;for(var o=t,c=!1;o!==null;){if(!c){if((o.flags&524288)!==0)c=!0;else if((o.flags&262144)!==0)break}if(o.tag===10){var f=o.alternate;if(f===null)throw Error(s(387));if(f=f.memoizedProps,f!==null){var p=o.type;Ct(o.pendingProps.value,f.value)||(e!==null?e.push(p):e=[p])}}else if(o===da.current){if(f=o.alternate,f===null)throw Error(s(387));f.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(e!==null?e.push(il):e=[il])}o=o.return}e!==null&&Ts(t,e,a,n),t.flags|=262144}function Hl(e){for(e=e.firstContext;e!==null;){if(!Ct(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function bn(e){yn=e,ha=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function rt(e){return Tu(yn,e)}function Ll(e,t){return yn===null&&bn(e),Tu(e,t)}function Tu(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},ha===null){if(e===null)throw Error(s(308));ha=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else ha=ha.next=t;return a}var $_=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},F_=r.unstable_scheduleCallback,W_=r.unstable_NormalPriority,Qe={$$typeof:ve,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function xs(){return{controller:new $_,data:new Map,refCount:0}}function zr(e){e.refCount--,e.refCount===0&&F_(W_,function(){e.controller.abort()})}var Rr=null,As=0,Fn=0,Wn=null;function P_(e,t){if(Rr===null){var a=Rr=[];As=0,Fn=zo(),Wn={status:"pending",value:void 0,then:function(n){a.push(n)}}}return As++,t.then(xu,xu),t}function xu(){if(--As===0&&Rr!==null){Wn!==null&&(Wn.status="fulfilled");var e=Rr;Rr=null,Fn=0,Wn=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function I_(e,t){var a=[],n={status:"pending",value:null,reason:null,then:function(o){a.push(o)}};return e.then(function(){n.status="fulfilled",n.value=t;for(var o=0;o<a.length;o++)(0,a[o])(t)},function(o){for(n.status="rejected",n.reason=o,o=0;o<a.length;o++)(0,a[o])(void 0)}),n}var Au=A.S;A.S=function(e,t){_f=Me(),typeof t=="object"&&t!==null&&typeof t.then=="function"&&P_(e,t),Au!==null&&Au(e,t)};var vn=He(null);function Ns(){var e=vn.current;return e!==null?e:qe.pooledCache}function Yl(e,t){t===null?re(vn,vn.current):re(vn,t.pool)}function Nu(){var e=Ns();return e===null?null:{parent:Qe._currentValue,pool:e}}var Pn=Error(s(460)),Os=Error(s(474)),Gl=Error(s(542)),Ql={then:function(){}};function Ou(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Mu(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(ma,ma),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Ru(e),e;default:if(typeof t.status=="string")t.then(ma,ma);else{if(e=qe,e!==null&&100<e.shellSuspendCounter)throw Error(s(482));e=t,e.status="pending",e.then(function(n){if(t.status==="pending"){var o=t;o.status="fulfilled",o.value=n}},function(n){if(t.status==="pending"){var o=t;o.status="rejected",o.reason=n}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Ru(e),e}throw wn=t,Pn}}function Sn(e){try{var t=e._init;return t(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(wn=a,Pn):a}}var wn=null;function zu(){if(wn===null)throw Error(s(459));var e=wn;return wn=null,e}function Ru(e){if(e===Pn||e===Gl)throw Error(s(483))}var In=null,Ur=0;function Xl(e){var t=Ur;return Ur+=1,In===null&&(In=[]),Mu(In,e,t)}function kr(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Vl(e,t){throw t.$$typeof===k?Error(s(525)):(e=Object.prototype.toString.call(t),Error(s(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function Uu(e){function t(j,S){if(e){var q=j.deletions;q===null?(j.deletions=[S],j.flags|=16):q.push(S)}}function a(j,S){if(!e)return null;for(;S!==null;)t(j,S),S=S.sibling;return null}function n(j){for(var S=new Map;j!==null;)j.key!==null?S.set(j.key,j):S.set(j.index,j),j=j.sibling;return S}function o(j,S){return j=pa(j,S),j.index=0,j.sibling=null,j}function c(j,S,q){return j.index=q,e?(q=j.alternate,q!==null?(q=q.index,q<S?(j.flags|=67108866,S):q):(j.flags|=67108866,S)):(j.flags|=1048576,S)}function f(j){return e&&j.alternate===null&&(j.flags|=67108866),j}function p(j,S,q,O){return S===null||S.tag!==6?(S=vs(q,j.mode,O),S.return=j,S):(S=o(S,q),S.return=j,S)}function v(j,S,q,O){var J=q.type;return J===Y?N(j,S,q.props.children,O,q.key):S!==null&&(S.elementType===J||typeof J=="object"&&J!==null&&J.$$typeof===et&&Sn(J)===S.type)?(S=o(S,q.props),kr(S,q),S.return=j,S):(S=kl(q.type,q.key,q.props,null,j.mode,O),kr(S,q),S.return=j,S)}function D(j,S,q,O){return S===null||S.tag!==4||S.stateNode.containerInfo!==q.containerInfo||S.stateNode.implementation!==q.implementation?(S=Ss(q,j.mode,O),S.return=j,S):(S=o(S,q.children||[]),S.return=j,S)}function N(j,S,q,O,J){return S===null||S.tag!==7?(S=gn(q,j.mode,O,J),S.return=j,S):(S=o(S,q),S.return=j,S)}function M(j,S,q){if(typeof S=="string"&&S!==""||typeof S=="number"||typeof S=="bigint")return S=vs(""+S,j.mode,q),S.return=j,S;if(typeof S=="object"&&S!==null){switch(S.$$typeof){case X:return q=kl(S.type,S.key,S.props,null,j.mode,q),kr(q,S),q.return=j,q;case H:return S=Ss(S,j.mode,q),S.return=j,S;case et:return S=Sn(S),M(j,S,q)}if(Be(S)||xe(S))return S=gn(S,j.mode,q,null),S.return=j,S;if(typeof S.then=="function")return M(j,Xl(S),q);if(S.$$typeof===ve)return M(j,Ll(j,S),q);Vl(j,S)}return null}function C(j,S,q,O){var J=S!==null?S.key:null;if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return J!==null?null:p(j,S,""+q,O);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case X:return q.key===J?v(j,S,q,O):null;case H:return q.key===J?D(j,S,q,O):null;case et:return q=Sn(q),C(j,S,q,O)}if(Be(q)||xe(q))return J!==null?null:N(j,S,q,O,null);if(typeof q.then=="function")return C(j,S,Xl(q),O);if(q.$$typeof===ve)return C(j,S,Ll(j,q),O);Vl(j,q)}return null}function T(j,S,q,O,J){if(typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint")return j=j.get(q)||null,p(S,j,""+O,J);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case X:return j=j.get(O.key===null?q:O.key)||null,v(S,j,O,J);case H:return j=j.get(O.key===null?q:O.key)||null,D(S,j,O,J);case et:return O=Sn(O),T(j,S,q,O,J)}if(Be(O)||xe(O))return j=j.get(q)||null,N(S,j,O,J,null);if(typeof O.then=="function")return T(j,S,q,Xl(O),J);if(O.$$typeof===ve)return T(j,S,q,Ll(S,O),J);Vl(S,O)}return null}function V(j,S,q,O){for(var J=null,fe=null,Z=S,ee=S=0,ie=null;Z!==null&&ee<q.length;ee++){Z.index>ee?(ie=Z,Z=null):ie=Z.sibling;var me=C(j,Z,q[ee],O);if(me===null){Z===null&&(Z=ie);break}e&&Z&&me.alternate===null&&t(j,Z),S=c(me,S,ee),fe===null?J=me:fe.sibling=me,fe=me,Z=ie}if(ee===q.length)return a(j,Z),se&&ga(j,ee),J;if(Z===null){for(;ee<q.length;ee++)Z=M(j,q[ee],O),Z!==null&&(S=c(Z,S,ee),fe===null?J=Z:fe.sibling=Z,fe=Z);return se&&ga(j,ee),J}for(Z=n(Z);ee<q.length;ee++)ie=T(Z,j,ee,q[ee],O),ie!==null&&(e&&ie.alternate!==null&&Z.delete(ie.key===null?ee:ie.key),S=c(ie,S,ee),fe===null?J=ie:fe.sibling=ie,fe=ie);return e&&Z.forEach(function(rn){return t(j,rn)}),se&&ga(j,ee),J}function F(j,S,q,O){if(q==null)throw Error(s(151));for(var J=null,fe=null,Z=S,ee=S=0,ie=null,me=q.next();Z!==null&&!me.done;ee++,me=q.next()){Z.index>ee?(ie=Z,Z=null):ie=Z.sibling;var rn=C(j,Z,me.value,O);if(rn===null){Z===null&&(Z=ie);break}e&&Z&&rn.alternate===null&&t(j,Z),S=c(rn,S,ee),fe===null?J=rn:fe.sibling=rn,fe=rn,Z=ie}if(me.done)return a(j,Z),se&&ga(j,ee),J;if(Z===null){for(;!me.done;ee++,me=q.next())me=M(j,me.value,O),me!==null&&(S=c(me,S,ee),fe===null?J=me:fe.sibling=me,fe=me);return se&&ga(j,ee),J}for(Z=n(Z);!me.done;ee++,me=q.next())me=T(Z,j,ee,me.value,O),me!==null&&(e&&me.alternate!==null&&Z.delete(me.key===null?ee:me.key),S=c(me,S,ee),fe===null?J=me:fe.sibling=me,fe=me);return e&&Z.forEach(function(ug){return t(j,ug)}),se&&ga(j,ee),J}function je(j,S,q,O){if(typeof q=="object"&&q!==null&&q.type===Y&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case X:e:{for(var J=q.key;S!==null;){if(S.key===J){if(J=q.type,J===Y){if(S.tag===7){a(j,S.sibling),O=o(S,q.props.children),O.return=j,j=O;break e}}else if(S.elementType===J||typeof J=="object"&&J!==null&&J.$$typeof===et&&Sn(J)===S.type){a(j,S.sibling),O=o(S,q.props),kr(O,q),O.return=j,j=O;break e}a(j,S);break}else t(j,S);S=S.sibling}q.type===Y?(O=gn(q.props.children,j.mode,O,q.key),O.return=j,j=O):(O=kl(q.type,q.key,q.props,null,j.mode,O),kr(O,q),O.return=j,j=O)}return f(j);case H:e:{for(J=q.key;S!==null;){if(S.key===J)if(S.tag===4&&S.stateNode.containerInfo===q.containerInfo&&S.stateNode.implementation===q.implementation){a(j,S.sibling),O=o(S,q.children||[]),O.return=j,j=O;break e}else{a(j,S);break}else t(j,S);S=S.sibling}O=Ss(q,j.mode,O),O.return=j,j=O}return f(j);case et:return q=Sn(q),je(j,S,q,O)}if(Be(q))return V(j,S,q,O);if(xe(q)){if(J=xe(q),typeof J!="function")throw Error(s(150));return q=J.call(q),F(j,S,q,O)}if(typeof q.then=="function")return je(j,S,Xl(q),O);if(q.$$typeof===ve)return je(j,S,Ll(j,q),O);Vl(j,q)}return typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint"?(q=""+q,S!==null&&S.tag===6?(a(j,S.sibling),O=o(S,q),O.return=j,j=O):(a(j,S),O=vs(q,j.mode,O),O.return=j,j=O),f(j)):a(j,S)}return function(j,S,q,O){try{Ur=0;var J=je(j,S,q,O);return In=null,J}catch(Z){if(Z===Pn||Z===Gl)throw Z;var fe=Tt(29,Z,null,j.mode);return fe.lanes=O,fe.return=j,fe}finally{}}}var jn=Uu(!0),ku=Uu(!1),Ya=!1;function Ms(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function zs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ga(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Qa(e,t,a){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,(pe&2)!==0){var o=n.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),n.pending=t,t=Ul(e),vu(e,null,a),t}return Rl(e,n,t,a),Ul(e)}function Br(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,Tc(e,a)}}function Rs(e,t){var a=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,a===n)){var o=null,c=null;if(a=a.firstBaseUpdate,a!==null){do{var f={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};c===null?o=c=f:c=c.next=f,a=a.next}while(a!==null);c===null?o=c=t:c=c.next=t}else o=c=t;a={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:c,shared:n.shared,callbacks:n.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var Us=!1;function Hr(){if(Us){var e=Wn;if(e!==null)throw e}}function Lr(e,t,a,n){Us=!1;var o=e.updateQueue;Ya=!1;var c=o.firstBaseUpdate,f=o.lastBaseUpdate,p=o.shared.pending;if(p!==null){o.shared.pending=null;var v=p,D=v.next;v.next=null,f===null?c=D:f.next=D,f=v;var N=e.alternate;N!==null&&(N=N.updateQueue,p=N.lastBaseUpdate,p!==f&&(p===null?N.firstBaseUpdate=D:p.next=D,N.lastBaseUpdate=v))}if(c!==null){var M=o.baseState;f=0,N=D=v=null,p=c;do{var C=p.lane&-536870913,T=C!==p.lane;if(T?(le&C)===C:(n&C)===C){C!==0&&C===Fn&&(Us=!0),N!==null&&(N=N.next={lane:0,tag:p.tag,payload:p.payload,callback:null,next:null});e:{var V=e,F=p;C=t;var je=a;switch(F.tag){case 1:if(V=F.payload,typeof V=="function"){M=V.call(je,M,C);break e}M=V;break e;case 3:V.flags=V.flags&-65537|128;case 0:if(V=F.payload,C=typeof V=="function"?V.call(je,M,C):V,C==null)break e;M=E({},M,C);break e;case 2:Ya=!0}}C=p.callback,C!==null&&(e.flags|=64,T&&(e.flags|=8192),T=o.callbacks,T===null?o.callbacks=[C]:T.push(C))}else T={lane:C,tag:p.tag,payload:p.payload,callback:p.callback,next:null},N===null?(D=N=T,v=M):N=N.next=T,f|=C;if(p=p.next,p===null){if(p=o.shared.pending,p===null)break;T=p,p=T.next,T.next=null,o.lastBaseUpdate=T,o.shared.pending=null}}while(!0);N===null&&(v=M),o.baseState=v,o.firstBaseUpdate=D,o.lastBaseUpdate=N,c===null&&(o.shared.lanes=0),Ja|=f,e.lanes=f,e.memoizedState=M}}function Bu(e,t){if(typeof e!="function")throw Error(s(191,e));e.call(t)}function Hu(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)Bu(a[e],t)}var er=He(null),Zl=He(0);function Lu(e,t){e=Ca,re(Zl,e),re(er,t),Ca=e|t.baseLanes}function ks(){re(Zl,Ca),re(er,er.current)}function Bs(){Ca=Zl.current,he(er),he(Zl)}var xt=He(null),Qt=null;function Xa(e){var t=e.alternate;re(Le,Le.current&1),re(xt,e),Qt===null&&(t===null||er.current!==null||t.memoizedState!==null)&&(Qt=e)}function Hs(e){re(Le,Le.current),re(xt,e),Qt===null&&(Qt=e)}function Yu(e){e.tag===22?(re(Le,Le.current),re(xt,e),Qt===null&&(Qt=e)):Va()}function Va(){re(Le,Le.current),re(xt,xt.current)}function At(e){he(xt),Qt===e&&(Qt=null),he(Le)}var Le=He(0);function Kl(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||Zo(a)||Ko(a)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder==="forwards"||t.memoizedProps.revealOrder==="backwards"||t.memoizedProps.revealOrder==="unstable_legacy-backwards"||t.memoizedProps.revealOrder==="together")){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ba=0,I=null,Se=null,Xe=null,Jl=!1,tr=!1,En=!1,$l=0,Yr=0,ar=null,ep=0;function Re(){throw Error(s(321))}function Ls(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Ct(e[a],t[a]))return!1;return!0}function Ys(e,t,a,n,o,c){return ba=c,I=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,A.H=e===null||e.memoizedState===null?Ed:ao,En=!1,c=a(n,o),En=!1,tr&&(c=Qu(t,a,n,o)),Gu(e),c}function Gu(e){A.H=Xr;var t=Se!==null&&Se.next!==null;if(ba=0,Xe=Se=I=null,Jl=!1,Yr=0,ar=null,t)throw Error(s(300));e===null||Ve||(e=e.dependencies,e!==null&&Hl(e)&&(Ve=!0))}function Qu(e,t,a,n){I=e;var o=0;do{if(tr&&(ar=null),Yr=0,tr=!1,25<=o)throw Error(s(301));if(o+=1,Xe=Se=null,e.updateQueue!=null){var c=e.updateQueue;c.lastEffect=null,c.events=null,c.stores=null,c.memoCache!=null&&(c.memoCache.index=0)}A.H=qd,c=t(a,n)}while(tr);return c}function tp(){var e=A.H,t=e.useState()[0];return t=typeof t.then=="function"?Gr(t):t,e=e.useState()[0],(Se!==null?Se.memoizedState:null)!==e&&(I.flags|=1024),t}function Gs(){var e=$l!==0;return $l=0,e}function Qs(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function Xs(e){if(Jl){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}Jl=!1}ba=0,Xe=Se=I=null,tr=!1,Yr=$l=0,ar=null}function ft(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xe===null?I.memoizedState=Xe=e:Xe=Xe.next=e,Xe}function Ye(){if(Se===null){var e=I.alternate;e=e!==null?e.memoizedState:null}else e=Se.next;var t=Xe===null?I.memoizedState:Xe.next;if(t!==null)Xe=t,Se=e;else{if(e===null)throw I.alternate===null?Error(s(467)):Error(s(310));Se=e,e={memoizedState:Se.memoizedState,baseState:Se.baseState,baseQueue:Se.baseQueue,queue:Se.queue,next:null},Xe===null?I.memoizedState=Xe=e:Xe=Xe.next=e}return Xe}function Fl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Gr(e){var t=Yr;return Yr+=1,ar===null&&(ar=[]),e=Mu(ar,e,t),t=I,(Xe===null?t.memoizedState:Xe.next)===null&&(t=t.alternate,A.H=t===null||t.memoizedState===null?Ed:ao),e}function Wl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Gr(e);if(e.$$typeof===ve)return rt(e)}throw Error(s(438,String(e)))}function Vs(e){var t=null,a=I.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var n=I.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(t={data:n.data.map(function(o){return o.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=Fl(),I.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),n=0;n<e;n++)a[n]=Jt;return t.index++,a}function va(e,t){return typeof t=="function"?t(e):t}function Pl(e){var t=Ye();return Zs(t,Se,e)}function Zs(e,t,a){var n=e.queue;if(n===null)throw Error(s(311));n.lastRenderedReducer=a;var o=e.baseQueue,c=n.pending;if(c!==null){if(o!==null){var f=o.next;o.next=c.next,c.next=f}t.baseQueue=o=c,n.pending=null}if(c=e.baseState,o===null)e.memoizedState=c;else{t=o.next;var p=f=null,v=null,D=t,N=!1;do{var M=D.lane&-536870913;if(M!==D.lane?(le&M)===M:(ba&M)===M){var C=D.revertLane;if(C===0)v!==null&&(v=v.next={lane:0,revertLane:0,gesture:null,action:D.action,hasEagerState:D.hasEagerState,eagerState:D.eagerState,next:null}),M===Fn&&(N=!0);else if((ba&C)===C){D=D.next,C===Fn&&(N=!0);continue}else M={lane:0,revertLane:D.revertLane,gesture:null,action:D.action,hasEagerState:D.hasEagerState,eagerState:D.eagerState,next:null},v===null?(p=v=M,f=c):v=v.next=M,I.lanes|=C,Ja|=C;M=D.action,En&&a(c,M),c=D.hasEagerState?D.eagerState:a(c,M)}else C={lane:M,revertLane:D.revertLane,gesture:D.gesture,action:D.action,hasEagerState:D.hasEagerState,eagerState:D.eagerState,next:null},v===null?(p=v=C,f=c):v=v.next=C,I.lanes|=M,Ja|=M;D=D.next}while(D!==null&&D!==t);if(v===null?f=c:v.next=p,!Ct(c,e.memoizedState)&&(Ve=!0,N&&(a=Wn,a!==null)))throw a;e.memoizedState=c,e.baseState=f,e.baseQueue=v,n.lastRenderedState=c}return o===null&&(n.lanes=0),[e.memoizedState,n.dispatch]}function Ks(e){var t=Ye(),a=t.queue;if(a===null)throw Error(s(311));a.lastRenderedReducer=e;var n=a.dispatch,o=a.pending,c=t.memoizedState;if(o!==null){a.pending=null;var f=o=o.next;do c=e(c,f.action),f=f.next;while(f!==o);Ct(c,t.memoizedState)||(Ve=!0),t.memoizedState=c,t.baseQueue===null&&(t.baseState=c),a.lastRenderedState=c}return[c,n]}function Xu(e,t,a){var n=I,o=Ye(),c=se;if(c){if(a===void 0)throw Error(s(407));a=a()}else a=t();var f=!Ct((Se||o).memoizedState,a);if(f&&(o.memoizedState=a,Ve=!0),o=o.queue,Fs(Ku.bind(null,n,o,e),[e]),o.getSnapshot!==t||f||Xe!==null&&Xe.memoizedState.tag&1){if(n.flags|=2048,nr(9,{destroy:void 0},Zu.bind(null,n,o,a,t),null),qe===null)throw Error(s(349));c||(ba&127)!==0||Vu(n,t,a)}return a}function Vu(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=I.updateQueue,t===null?(t=Fl(),I.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function Zu(e,t,a,n){t.value=a,t.getSnapshot=n,Ju(t)&&$u(e)}function Ku(e,t,a){return a(function(){Ju(t)&&$u(e)})}function Ju(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Ct(e,a)}catch{return!0}}function $u(e){var t=pn(e,2);t!==null&&jt(t,e,2)}function Js(e){var t=ft();if(typeof e=="function"){var a=e;if(e=a(),En){We(!0);try{a()}finally{We(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:e},t}function Fu(e,t,a,n){return e.baseState=a,Zs(e,Se,typeof n=="function"?n:va)}function ap(e,t,a,n,o){if(ti(e))throw Error(s(485));if(e=t.action,e!==null){var c={payload:o,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(f){c.listeners.push(f)}};A.T!==null?a(!0):c.isTransition=!1,n(c),a=t.pending,a===null?(c.next=t.pending=c,Wu(t,c)):(c.next=a.next,t.pending=a.next=c)}}function Wu(e,t){var a=t.action,n=t.payload,o=e.state;if(t.isTransition){var c=A.T,f={};A.T=f;try{var p=a(o,n),v=A.S;v!==null&&v(f,p),Pu(e,t,p)}catch(D){$s(e,t,D)}finally{c!==null&&f.types!==null&&(c.types=f.types),A.T=c}}else try{c=a(o,n),Pu(e,t,c)}catch(D){$s(e,t,D)}}function Pu(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(n){Iu(e,t,n)},function(n){return $s(e,t,n)}):Iu(e,t,a)}function Iu(e,t,a){t.status="fulfilled",t.value=a,ed(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,Wu(e,a)))}function $s(e,t,a){var n=e.pending;if(e.pending=null,n!==null){n=n.next;do t.status="rejected",t.reason=a,ed(t),t=t.next;while(t!==n)}e.action=null}function ed(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function td(e,t){return t}function ad(e,t){if(se){var a=qe.formState;if(a!==null){e:{var n=I;if(se){if(Ce){t:{for(var o=Ce,c=Gt;o.nodeType!==8;){if(!c){o=null;break t}if(o=Xt(o.nextSibling),o===null){o=null;break t}}c=o.data,o=c==="F!"||c==="F"?o:null}if(o){Ce=Xt(o.nextSibling),n=o.data==="F!";break e}}Ha(n)}n=!1}n&&(t=a[0])}}return a=ft(),a.memoizedState=a.baseState=t,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:td,lastRenderedState:t},a.queue=n,a=Sd.bind(null,I,n),n.dispatch=a,n=Js(!1),c=to.bind(null,I,!1,n.queue),n=ft(),o={state:t,dispatch:null,action:e,pending:null},n.queue=o,a=ap.bind(null,I,o,c,a),o.dispatch=a,n.memoizedState=e,[t,a,!1]}function nd(e){var t=Ye();return rd(t,Se,e)}function rd(e,t,a){if(t=Zs(e,t,td)[0],e=Pl(va)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var n=Gr(t)}catch(f){throw f===Pn?Gl:f}else n=t;t=Ye();var o=t.queue,c=o.dispatch;return a!==t.memoizedState&&(I.flags|=2048,nr(9,{destroy:void 0},np.bind(null,o,a),null)),[n,c,e]}function np(e,t){e.action=t}function ld(e){var t=Ye(),a=Se;if(a!==null)return rd(t,a,e);Ye(),t=t.memoizedState,a=Ye();var n=a.queue.dispatch;return a.memoizedState=e,[t,n,!1]}function nr(e,t,a,n){return e={tag:e,create:a,deps:n,inst:t,next:null},t=I.updateQueue,t===null&&(t=Fl(),I.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(n=a.next,a.next=e,e.next=n,t.lastEffect=e),e}function id(){return Ye().memoizedState}function Il(e,t,a,n){var o=ft();I.flags|=e,o.memoizedState=nr(1|t,{destroy:void 0},a,n===void 0?null:n)}function ei(e,t,a,n){var o=Ye();n=n===void 0?null:n;var c=o.memoizedState.inst;Se!==null&&n!==null&&Ls(n,Se.memoizedState.deps)?o.memoizedState=nr(t,c,a,n):(I.flags|=e,o.memoizedState=nr(1|t,c,a,n))}function sd(e,t){Il(8390656,8,e,t)}function Fs(e,t){ei(2048,8,e,t)}function rp(e){I.flags|=4;var t=I.updateQueue;if(t===null)t=Fl(),I.updateQueue=t,t.events=[e];else{var a=t.events;a===null?t.events=[e]:a.push(e)}}function od(e){var t=Ye().memoizedState;return rp({ref:t,nextImpl:e}),function(){if((pe&2)!==0)throw Error(s(440));return t.impl.apply(void 0,arguments)}}function cd(e,t){return ei(4,2,e,t)}function ud(e,t){return ei(4,4,e,t)}function dd(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function fd(e,t,a){a=a!=null?a.concat([e]):null,ei(4,4,dd.bind(null,t,e),a)}function Ws(){}function md(e,t){var a=Ye();t=t===void 0?null:t;var n=a.memoizedState;return t!==null&&Ls(t,n[1])?n[0]:(a.memoizedState=[e,t],e)}function _d(e,t){var a=Ye();t=t===void 0?null:t;var n=a.memoizedState;if(t!==null&&Ls(t,n[1]))return n[0];if(n=e(),En){We(!0);try{e()}finally{We(!1)}}return a.memoizedState=[n,t],n}function Ps(e,t,a){return a===void 0||(ba&1073741824)!==0&&(le&261930)===0?e.memoizedState=t:(e.memoizedState=a,e=gf(),I.lanes|=e,Ja|=e,a)}function pd(e,t,a,n){return Ct(a,t)?a:er.current!==null?(e=Ps(e,a,n),Ct(e,t)||(Ve=!0),e):(ba&42)===0||(ba&1073741824)!==0&&(le&261930)===0?(Ve=!0,e.memoizedState=a):(e=gf(),I.lanes|=e,Ja|=e,t)}function gd(e,t,a,n,o){var c=B.p;B.p=c!==0&&8>c?c:8;var f=A.T,p={};A.T=p,to(e,!1,t,a);try{var v=o(),D=A.S;if(D!==null&&D(p,v),v!==null&&typeof v=="object"&&typeof v.then=="function"){var N=I_(v,n);Qr(e,t,N,Mt(e))}else Qr(e,t,n,Mt(e))}catch(M){Qr(e,t,{then:function(){},status:"rejected",reason:M},Mt())}finally{B.p=c,f!==null&&p.types!==null&&(f.types=p.types),A.T=f}}function lp(){}function Is(e,t,a,n){if(e.tag!==5)throw Error(s(476));var o=hd(e).queue;gd(e,o,t,K,a===null?lp:function(){return yd(e),a(n)})}function hd(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:K},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function yd(e){var t=hd(e);t.next===null&&(t=e.alternate.memoizedState),Qr(e,t.next.queue,{},Mt())}function eo(){return rt(il)}function bd(){return Ye().memoizedState}function vd(){return Ye().memoizedState}function ip(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=Mt();e=Ga(a);var n=Qa(t,e,a);n!==null&&(jt(n,t,a),Br(n,t,a)),t={cache:xs()},e.payload=t;return}t=t.return}}function sp(e,t,a){var n=Mt();a={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},ti(e)?wd(t,a):(a=ys(e,t,a,n),a!==null&&(jt(a,e,n),jd(a,t,n)))}function Sd(e,t,a){var n=Mt();Qr(e,t,a,n)}function Qr(e,t,a,n){var o={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(ti(e))wd(t,o);else{var c=e.alternate;if(e.lanes===0&&(c===null||c.lanes===0)&&(c=t.lastRenderedReducer,c!==null))try{var f=t.lastRenderedState,p=c(f,a);if(o.hasEagerState=!0,o.eagerState=p,Ct(p,f))return Rl(e,t,o,0),qe===null&&zl(),!1}catch{}finally{}if(a=ys(e,t,o,n),a!==null)return jt(a,e,n),jd(a,t,n),!0}return!1}function to(e,t,a,n){if(n={lane:2,revertLane:zo(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},ti(e)){if(t)throw Error(s(479))}else t=ys(e,a,n,2),t!==null&&jt(t,e,2)}function ti(e){var t=e.alternate;return e===I||t!==null&&t===I}function wd(e,t){tr=Jl=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function jd(e,t,a){if((a&4194048)!==0){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,Tc(e,a)}}var Xr={readContext:rt,use:Wl,useCallback:Re,useContext:Re,useEffect:Re,useImperativeHandle:Re,useLayoutEffect:Re,useInsertionEffect:Re,useMemo:Re,useReducer:Re,useRef:Re,useState:Re,useDebugValue:Re,useDeferredValue:Re,useTransition:Re,useSyncExternalStore:Re,useId:Re,useHostTransitionStatus:Re,useFormState:Re,useActionState:Re,useOptimistic:Re,useMemoCache:Re,useCacheRefresh:Re};Xr.useEffectEvent=Re;var Ed={readContext:rt,use:Wl,useCallback:function(e,t){return ft().memoizedState=[e,t===void 0?null:t],e},useContext:rt,useEffect:sd,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,Il(4194308,4,dd.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Il(4194308,4,e,t)},useInsertionEffect:function(e,t){Il(4,2,e,t)},useMemo:function(e,t){var a=ft();t=t===void 0?null:t;var n=e();if(En){We(!0);try{e()}finally{We(!1)}}return a.memoizedState=[n,t],n},useReducer:function(e,t,a){var n=ft();if(a!==void 0){var o=a(t);if(En){We(!0);try{a(t)}finally{We(!1)}}}else o=t;return n.memoizedState=n.baseState=o,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:o},n.queue=e,e=e.dispatch=sp.bind(null,I,e),[n.memoizedState,e]},useRef:function(e){var t=ft();return e={current:e},t.memoizedState=e},useState:function(e){e=Js(e);var t=e.queue,a=Sd.bind(null,I,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:Ws,useDeferredValue:function(e,t){var a=ft();return Ps(a,e,t)},useTransition:function(){var e=Js(!1);return e=gd.bind(null,I,e.queue,!0,!1),ft().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var n=I,o=ft();if(se){if(a===void 0)throw Error(s(407));a=a()}else{if(a=t(),qe===null)throw Error(s(349));(le&127)!==0||Vu(n,t,a)}o.memoizedState=a;var c={value:a,getSnapshot:t};return o.queue=c,sd(Ku.bind(null,n,c,e),[e]),n.flags|=2048,nr(9,{destroy:void 0},Zu.bind(null,n,c,a,t),null),a},useId:function(){var e=ft(),t=qe.identifierPrefix;if(se){var a=sa,n=ia;a=(n&~(1<<32-ze(n)-1)).toString(32)+a,t="_"+t+"R_"+a,a=$l++,0<a&&(t+="H"+a.toString(32)),t+="_"}else a=ep++,t="_"+t+"r_"+a.toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:eo,useFormState:ad,useActionState:ad,useOptimistic:function(e){var t=ft();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=to.bind(null,I,!0,a),a.dispatch=t,[e,t]},useMemoCache:Vs,useCacheRefresh:function(){return ft().memoizedState=ip.bind(null,I)},useEffectEvent:function(e){var t=ft(),a={impl:e};return t.memoizedState=a,function(){if((pe&2)!==0)throw Error(s(440));return a.impl.apply(void 0,arguments)}}},ao={readContext:rt,use:Wl,useCallback:md,useContext:rt,useEffect:Fs,useImperativeHandle:fd,useInsertionEffect:cd,useLayoutEffect:ud,useMemo:_d,useReducer:Pl,useRef:id,useState:function(){return Pl(va)},useDebugValue:Ws,useDeferredValue:function(e,t){var a=Ye();return pd(a,Se.memoizedState,e,t)},useTransition:function(){var e=Pl(va)[0],t=Ye().memoizedState;return[typeof e=="boolean"?e:Gr(e),t]},useSyncExternalStore:Xu,useId:bd,useHostTransitionStatus:eo,useFormState:nd,useActionState:nd,useOptimistic:function(e,t){var a=Ye();return Fu(a,Se,e,t)},useMemoCache:Vs,useCacheRefresh:vd};ao.useEffectEvent=od;var qd={readContext:rt,use:Wl,useCallback:md,useContext:rt,useEffect:Fs,useImperativeHandle:fd,useInsertionEffect:cd,useLayoutEffect:ud,useMemo:_d,useReducer:Ks,useRef:id,useState:function(){return Ks(va)},useDebugValue:Ws,useDeferredValue:function(e,t){var a=Ye();return Se===null?Ps(a,e,t):pd(a,Se.memoizedState,e,t)},useTransition:function(){var e=Ks(va)[0],t=Ye().memoizedState;return[typeof e=="boolean"?e:Gr(e),t]},useSyncExternalStore:Xu,useId:bd,useHostTransitionStatus:eo,useFormState:ld,useActionState:ld,useOptimistic:function(e,t){var a=Ye();return Se!==null?Fu(a,Se,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:Vs,useCacheRefresh:vd};qd.useEffectEvent=od;function no(e,t,a,n){t=e.memoizedState,a=a(n,t),a=a==null?t:E({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var ro={enqueueSetState:function(e,t,a){e=e._reactInternals;var n=Mt(),o=Ga(n);o.payload=t,a!=null&&(o.callback=a),t=Qa(e,o,n),t!==null&&(jt(t,e,n),Br(t,e,n))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var n=Mt(),o=Ga(n);o.tag=1,o.payload=t,a!=null&&(o.callback=a),t=Qa(e,o,n),t!==null&&(jt(t,e,n),Br(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=Mt(),n=Ga(a);n.tag=2,t!=null&&(n.callback=t),t=Qa(e,n,a),t!==null&&(jt(t,e,a),Br(t,e,a))}};function Dd(e,t,a,n,o,c,f){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,c,f):t.prototype&&t.prototype.isPureReactComponent?!Ar(a,n)||!Ar(o,c):!0}function Cd(e,t,a,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,n),t.state!==e&&ro.enqueueReplaceState(t,t.state,null)}function qn(e,t){var a=t;if("ref"in t){a={};for(var n in t)n!=="ref"&&(a[n]=t[n])}if(e=e.defaultProps){a===t&&(a=E({},a));for(var o in e)a[o]===void 0&&(a[o]=e[o])}return a}function Td(e){Ml(e)}function xd(e){console.error(e)}function Ad(e){Ml(e)}function ai(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Nd(e,t,a){try{var n=e.onCaughtError;n(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(o){setTimeout(function(){throw o})}}function lo(e,t,a){return a=Ga(a),a.tag=3,a.payload={element:null},a.callback=function(){ai(e,t)},a}function Od(e){return e=Ga(e),e.tag=3,e}function Md(e,t,a,n){var o=a.type.getDerivedStateFromError;if(typeof o=="function"){var c=n.value;e.payload=function(){return o(c)},e.callback=function(){Nd(t,a,n)}}var f=a.stateNode;f!==null&&typeof f.componentDidCatch=="function"&&(e.callback=function(){Nd(t,a,n),typeof o!="function"&&($a===null?$a=new Set([this]):$a.add(this));var p=n.stack;this.componentDidCatch(n.value,{componentStack:p!==null?p:""})})}function op(e,t,a,n,o){if(a.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(t=a.alternate,t!==null&&$n(t,a,o,!0),a=xt.current,a!==null){switch(a.tag){case 31:case 13:return Qt===null?_i():a.alternate===null&&Ue===0&&(Ue=3),a.flags&=-257,a.flags|=65536,a.lanes=o,n===Ql?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([n]):t.add(n),No(e,n,o)),!1;case 22:return a.flags|=65536,n===Ql?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([n])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([n]):a.add(n)),No(e,n,o)),!1}throw Error(s(435,a.tag))}return No(e,n,o),_i(),!1}if(se)return t=xt.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=o,n!==Es&&(e=Error(s(422),{cause:n}),Mr(Ht(e,a)))):(n!==Es&&(t=Error(s(423),{cause:n}),Mr(Ht(t,a))),e=e.current.alternate,e.flags|=65536,o&=-o,e.lanes|=o,n=Ht(n,a),o=lo(e.stateNode,n,o),Rs(e,o),Ue!==4&&(Ue=2)),!1;var c=Error(s(520),{cause:n});if(c=Ht(c,a),Pr===null?Pr=[c]:Pr.push(c),Ue!==4&&(Ue=2),t===null)return!0;n=Ht(n,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=o&-o,a.lanes|=e,e=lo(a.stateNode,n,e),Rs(a,e),!1;case 1:if(t=a.type,c=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||c!==null&&typeof c.componentDidCatch=="function"&&($a===null||!$a.has(c))))return a.flags|=65536,o&=-o,a.lanes|=o,o=Od(o),Md(o,e,a,n),Rs(a,o),!1}a=a.return}while(a!==null);return!1}var io=Error(s(461)),Ve=!1;function lt(e,t,a,n){t.child=e===null?ku(t,null,a,n):jn(t,e.child,a,n)}function zd(e,t,a,n,o){a=a.render;var c=t.ref;if("ref"in n){var f={};for(var p in n)p!=="ref"&&(f[p]=n[p])}else f=n;return bn(t),n=Ys(e,t,a,f,c,o),p=Gs(),e!==null&&!Ve?(Qs(e,t,o),Sa(e,t,o)):(se&&p&&ws(t),t.flags|=1,lt(e,t,n,o),t.child)}function Rd(e,t,a,n,o){if(e===null){var c=a.type;return typeof c=="function"&&!bs(c)&&c.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=c,Ud(e,t,c,n,o)):(e=kl(a.type,null,n,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(c=e.child,!po(e,o)){var f=c.memoizedProps;if(a=a.compare,a=a!==null?a:Ar,a(f,n)&&e.ref===t.ref)return Sa(e,t,o)}return t.flags|=1,e=pa(c,n),e.ref=t.ref,e.return=t,t.child=e}function Ud(e,t,a,n,o){if(e!==null){var c=e.memoizedProps;if(Ar(c,n)&&e.ref===t.ref)if(Ve=!1,t.pendingProps=n=c,po(e,o))(e.flags&131072)!==0&&(Ve=!0);else return t.lanes=e.lanes,Sa(e,t,o)}return so(e,t,a,n,o)}function kd(e,t,a,n){var o=n.children,c=e!==null?e.memoizedState:null;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((t.flags&128)!==0){if(c=c!==null?c.baseLanes|a:a,e!==null){for(n=t.child=e.child,o=0;n!==null;)o=o|n.lanes|n.childLanes,n=n.sibling;n=o&~c}else n=0,t.child=null;return Bd(e,t,c,a,n)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&Yl(t,c!==null?c.cachePool:null),c!==null?Lu(t,c):ks(),Yu(t);else return n=t.lanes=536870912,Bd(e,t,c!==null?c.baseLanes|a:a,a,n)}else c!==null?(Yl(t,c.cachePool),Lu(t,c),Va(),t.memoizedState=null):(e!==null&&Yl(t,null),ks(),Va());return lt(e,t,o,a),t.child}function Vr(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Bd(e,t,a,n,o){var c=Ns();return c=c===null?null:{parent:Qe._currentValue,pool:c},t.memoizedState={baseLanes:a,cachePool:c},e!==null&&Yl(t,null),ks(),Yu(t),e!==null&&$n(e,t,n,!0),t.childLanes=o,null}function ni(e,t){return t=li({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function Hd(e,t,a){return jn(t,e.child,null,a),e=ni(t,t.pendingProps),e.flags|=2,At(t),t.memoizedState=null,e}function cp(e,t,a){var n=t.pendingProps,o=(t.flags&128)!==0;if(t.flags&=-129,e===null){if(se){if(n.mode==="hidden")return e=ni(t,n),t.lanes=536870912,Vr(null,e);if(Hs(t),(e=Ce)?(e=Pf(e,Gt),e=e!==null&&e.data==="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:ka!==null?{id:ia,overflow:sa}:null,retryLane:536870912,hydrationErrors:null},a=wu(e),a.return=t,t.child=a,nt=t,Ce=null)):e=null,e===null)throw Ha(t);return t.lanes=536870912,null}return ni(t,n)}var c=e.memoizedState;if(c!==null){var f=c.dehydrated;if(Hs(t),o)if(t.flags&256)t.flags&=-257,t=Hd(e,t,a);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(s(558));else if(Ve||$n(e,t,a,!1),o=(a&e.childLanes)!==0,Ve||o){if(n=qe,n!==null&&(f=xc(n,a),f!==0&&f!==c.retryLane))throw c.retryLane=f,pn(e,f),jt(n,e,f),io;_i(),t=Hd(e,t,a)}else e=c.treeContext,Ce=Xt(f.nextSibling),nt=t,se=!0,Ba=null,Gt=!1,e!==null&&qu(t,e),t=ni(t,n),t.flags|=4096;return t}return e=pa(e.child,{mode:n.mode,children:n.children}),e.ref=t.ref,t.child=e,e.return=t,e}function ri(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(s(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function so(e,t,a,n,o){return bn(t),a=Ys(e,t,a,n,void 0,o),n=Gs(),e!==null&&!Ve?(Qs(e,t,o),Sa(e,t,o)):(se&&n&&ws(t),t.flags|=1,lt(e,t,a,o),t.child)}function Ld(e,t,a,n,o,c){return bn(t),t.updateQueue=null,a=Qu(t,n,a,o),Gu(e),n=Gs(),e!==null&&!Ve?(Qs(e,t,c),Sa(e,t,c)):(se&&n&&ws(t),t.flags|=1,lt(e,t,a,c),t.child)}function Yd(e,t,a,n,o){if(bn(t),t.stateNode===null){var c=Vn,f=a.contextType;typeof f=="object"&&f!==null&&(c=rt(f)),c=new a(n,c),t.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=ro,t.stateNode=c,c._reactInternals=t,c=t.stateNode,c.props=n,c.state=t.memoizedState,c.refs={},Ms(t),f=a.contextType,c.context=typeof f=="object"&&f!==null?rt(f):Vn,c.state=t.memoizedState,f=a.getDerivedStateFromProps,typeof f=="function"&&(no(t,a,f,n),c.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(f=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),f!==c.state&&ro.enqueueReplaceState(c,c.state,null),Lr(t,n,c,o),Hr(),c.state=t.memoizedState),typeof c.componentDidMount=="function"&&(t.flags|=4194308),n=!0}else if(e===null){c=t.stateNode;var p=t.memoizedProps,v=qn(a,p);c.props=v;var D=c.context,N=a.contextType;f=Vn,typeof N=="object"&&N!==null&&(f=rt(N));var M=a.getDerivedStateFromProps;N=typeof M=="function"||typeof c.getSnapshotBeforeUpdate=="function",p=t.pendingProps!==p,N||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(p||D!==f)&&Cd(t,c,n,f),Ya=!1;var C=t.memoizedState;c.state=C,Lr(t,n,c,o),Hr(),D=t.memoizedState,p||C!==D||Ya?(typeof M=="function"&&(no(t,a,M,n),D=t.memoizedState),(v=Ya||Dd(t,a,v,n,C,D,f))?(N||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount()),typeof c.componentDidMount=="function"&&(t.flags|=4194308)):(typeof c.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=D),c.props=n,c.state=D,c.context=f,n=v):(typeof c.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{c=t.stateNode,zs(e,t),f=t.memoizedProps,N=qn(a,f),c.props=N,M=t.pendingProps,C=c.context,D=a.contextType,v=Vn,typeof D=="object"&&D!==null&&(v=rt(D)),p=a.getDerivedStateFromProps,(D=typeof p=="function"||typeof c.getSnapshotBeforeUpdate=="function")||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(f!==M||C!==v)&&Cd(t,c,n,v),Ya=!1,C=t.memoizedState,c.state=C,Lr(t,n,c,o),Hr();var T=t.memoizedState;f!==M||C!==T||Ya||e!==null&&e.dependencies!==null&&Hl(e.dependencies)?(typeof p=="function"&&(no(t,a,p,n),T=t.memoizedState),(N=Ya||Dd(t,a,N,n,C,T,v)||e!==null&&e.dependencies!==null&&Hl(e.dependencies))?(D||typeof c.UNSAFE_componentWillUpdate!="function"&&typeof c.componentWillUpdate!="function"||(typeof c.componentWillUpdate=="function"&&c.componentWillUpdate(n,T,v),typeof c.UNSAFE_componentWillUpdate=="function"&&c.UNSAFE_componentWillUpdate(n,T,v)),typeof c.componentDidUpdate=="function"&&(t.flags|=4),typeof c.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof c.componentDidUpdate!="function"||f===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&C===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=T),c.props=n,c.state=T,c.context=v,n=N):(typeof c.componentDidUpdate!="function"||f===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&C===e.memoizedState||(t.flags|=1024),n=!1)}return c=n,ri(e,t),n=(t.flags&128)!==0,c||n?(c=t.stateNode,a=n&&typeof a.getDerivedStateFromError!="function"?null:c.render(),t.flags|=1,e!==null&&n?(t.child=jn(t,e.child,null,o),t.child=jn(t,null,a,o)):lt(e,t,a,o),t.memoizedState=c.state,e=t.child):e=Sa(e,t,o),e}function Gd(e,t,a,n){return hn(),t.flags|=256,lt(e,t,a,n),t.child}var oo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function co(e){return{baseLanes:e,cachePool:Nu()}}function uo(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=Ot),e}function Qd(e,t,a){var n=t.pendingProps,o=!1,c=(t.flags&128)!==0,f;if((f=c)||(f=e!==null&&e.memoizedState===null?!1:(Le.current&2)!==0),f&&(o=!0,t.flags&=-129),f=(t.flags&32)!==0,t.flags&=-33,e===null){if(se){if(o?Xa(t):Va(),(e=Ce)?(e=Pf(e,Gt),e=e!==null&&e.data!=="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:ka!==null?{id:ia,overflow:sa}:null,retryLane:536870912,hydrationErrors:null},a=wu(e),a.return=t,t.child=a,nt=t,Ce=null)):e=null,e===null)throw Ha(t);return Ko(e)?t.lanes=32:t.lanes=536870912,null}var p=n.children;return n=n.fallback,o?(Va(),o=t.mode,p=li({mode:"hidden",children:p},o),n=gn(n,o,a,null),p.return=t,n.return=t,p.sibling=n,t.child=p,n=t.child,n.memoizedState=co(a),n.childLanes=uo(e,f,a),t.memoizedState=oo,Vr(null,n)):(Xa(t),fo(t,p))}var v=e.memoizedState;if(v!==null&&(p=v.dehydrated,p!==null)){if(c)t.flags&256?(Xa(t),t.flags&=-257,t=mo(e,t,a)):t.memoizedState!==null?(Va(),t.child=e.child,t.flags|=128,t=null):(Va(),p=n.fallback,o=t.mode,n=li({mode:"visible",children:n.children},o),p=gn(p,o,a,null),p.flags|=2,n.return=t,p.return=t,n.sibling=p,t.child=n,jn(t,e.child,null,a),n=t.child,n.memoizedState=co(a),n.childLanes=uo(e,f,a),t.memoizedState=oo,t=Vr(null,n));else if(Xa(t),Ko(p)){if(f=p.nextSibling&&p.nextSibling.dataset,f)var D=f.dgst;f=D,n=Error(s(419)),n.stack="",n.digest=f,Mr({value:n,source:null,stack:null}),t=mo(e,t,a)}else if(Ve||$n(e,t,a,!1),f=(a&e.childLanes)!==0,Ve||f){if(f=qe,f!==null&&(n=xc(f,a),n!==0&&n!==v.retryLane))throw v.retryLane=n,pn(e,n),jt(f,e,n),io;Zo(p)||_i(),t=mo(e,t,a)}else Zo(p)?(t.flags|=192,t.child=e.child,t=null):(e=v.treeContext,Ce=Xt(p.nextSibling),nt=t,se=!0,Ba=null,Gt=!1,e!==null&&qu(t,e),t=fo(t,n.children),t.flags|=4096);return t}return o?(Va(),p=n.fallback,o=t.mode,v=e.child,D=v.sibling,n=pa(v,{mode:"hidden",children:n.children}),n.subtreeFlags=v.subtreeFlags&65011712,D!==null?p=pa(D,p):(p=gn(p,o,a,null),p.flags|=2),p.return=t,n.return=t,n.sibling=p,t.child=n,Vr(null,n),n=t.child,p=e.child.memoizedState,p===null?p=co(a):(o=p.cachePool,o!==null?(v=Qe._currentValue,o=o.parent!==v?{parent:v,pool:v}:o):o=Nu(),p={baseLanes:p.baseLanes|a,cachePool:o}),n.memoizedState=p,n.childLanes=uo(e,f,a),t.memoizedState=oo,Vr(e.child,n)):(Xa(t),a=e.child,e=a.sibling,a=pa(a,{mode:"visible",children:n.children}),a.return=t,a.sibling=null,e!==null&&(f=t.deletions,f===null?(t.deletions=[e],t.flags|=16):f.push(e)),t.child=a,t.memoizedState=null,a)}function fo(e,t){return t=li({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function li(e,t){return e=Tt(22,e,null,t),e.lanes=0,e}function mo(e,t,a){return jn(t,e.child,null,a),e=fo(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Xd(e,t,a){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),Cs(e.return,t,a)}function _o(e,t,a,n,o,c){var f=e.memoizedState;f===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:a,tailMode:o,treeForkCount:c}:(f.isBackwards=t,f.rendering=null,f.renderingStartTime=0,f.last=n,f.tail=a,f.tailMode=o,f.treeForkCount=c)}function Vd(e,t,a){var n=t.pendingProps,o=n.revealOrder,c=n.tail;n=n.children;var f=Le.current,p=(f&2)!==0;if(p?(f=f&1|2,t.flags|=128):f&=1,re(Le,f),lt(e,t,n,a),n=se?Or:0,!p&&e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Xd(e,a,t);else if(e.tag===19)Xd(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(o){case"forwards":for(a=t.child,o=null;a!==null;)e=a.alternate,e!==null&&Kl(e)===null&&(o=a),a=a.sibling;a=o,a===null?(o=t.child,t.child=null):(o=a.sibling,a.sibling=null),_o(t,!1,o,a,c,n);break;case"backwards":case"unstable_legacy-backwards":for(a=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&Kl(e)===null){t.child=o;break}e=o.sibling,o.sibling=a,a=o,o=e}_o(t,!0,a,null,c,n);break;case"together":_o(t,!1,null,null,void 0,n);break;default:t.memoizedState=null}return t.child}function Sa(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),Ja|=t.lanes,(a&t.childLanes)===0)if(e!==null){if($n(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(s(153));if(t.child!==null){for(e=t.child,a=pa(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=pa(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function po(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&Hl(e)))}function up(e,t,a){switch(t.tag){case 3:na(t,t.stateNode.containerInfo),La(t,Qe,e.memoizedState.cache),hn();break;case 27:case 5:$e(t);break;case 4:na(t,t.stateNode.containerInfo);break;case 10:La(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,Hs(t),null;break;case 13:var n=t.memoizedState;if(n!==null)return n.dehydrated!==null?(Xa(t),t.flags|=128,null):(a&t.child.childLanes)!==0?Qd(e,t,a):(Xa(t),e=Sa(e,t,a),e!==null?e.sibling:null);Xa(t);break;case 19:var o=(e.flags&128)!==0;if(n=(a&t.childLanes)!==0,n||($n(e,t,a,!1),n=(a&t.childLanes)!==0),o){if(n)return Vd(e,t,a);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),re(Le,Le.current),n)break;return null;case 22:return t.lanes=0,kd(e,t,a,t.pendingProps);case 24:La(t,Qe,e.memoizedState.cache)}return Sa(e,t,a)}function Zd(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)Ve=!0;else{if(!po(e,a)&&(t.flags&128)===0)return Ve=!1,up(e,t,a);Ve=(e.flags&131072)!==0}else Ve=!1,se&&(t.flags&1048576)!==0&&Eu(t,Or,t.index);switch(t.lanes=0,t.tag){case 16:e:{var n=t.pendingProps;if(e=Sn(t.elementType),t.type=e,typeof e=="function")bs(e)?(n=qn(e,n),t.tag=1,t=Yd(null,t,e,n,a)):(t.tag=0,t=so(null,t,e,n,a));else{if(e!=null){var o=e.$$typeof;if(o===P){t.tag=11,t=zd(null,t,e,n,a);break e}else if(o===st){t.tag=14,t=Rd(null,t,e,n,a);break e}}throw t=qt(e)||e,Error(s(306,t,""))}}return t;case 0:return so(e,t,t.type,t.pendingProps,a);case 1:return n=t.type,o=qn(n,t.pendingProps),Yd(e,t,n,o,a);case 3:e:{if(na(t,t.stateNode.containerInfo),e===null)throw Error(s(387));n=t.pendingProps;var c=t.memoizedState;o=c.element,zs(e,t),Lr(t,n,null,a);var f=t.memoizedState;if(n=f.cache,La(t,Qe,n),n!==c.cache&&Ts(t,[Qe],a,!0),Hr(),n=f.element,c.isDehydrated)if(c={element:n,isDehydrated:!1,cache:f.cache},t.updateQueue.baseState=c,t.memoizedState=c,t.flags&256){t=Gd(e,t,n,a);break e}else if(n!==o){o=Ht(Error(s(424)),t),Mr(o),t=Gd(e,t,n,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(Ce=Xt(e.firstChild),nt=t,se=!0,Ba=null,Gt=!0,a=ku(t,null,n,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(hn(),n===o){t=Sa(e,t,a);break e}lt(e,t,n,a)}t=t.child}return t;case 26:return ri(e,t),e===null?(a=rm(t.type,null,t.pendingProps,null))?t.memoizedState=a:se||(a=t.type,e=t.pendingProps,n=Si(ot.current).createElement(a),n[at]=t,n[ht]=e,it(n,a,e),Pe(n),t.stateNode=n):t.memoizedState=rm(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return $e(t),e===null&&se&&(n=t.stateNode=tm(t.type,t.pendingProps,ot.current),nt=t,Gt=!0,o=Ce,Ia(t.type)?(Jo=o,Ce=Xt(n.firstChild)):Ce=o),lt(e,t,t.pendingProps.children,a),ri(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&se&&((o=n=Ce)&&(n=Lp(n,t.type,t.pendingProps,Gt),n!==null?(t.stateNode=n,nt=t,Ce=Xt(n.firstChild),Gt=!1,o=!0):o=!1),o||Ha(t)),$e(t),o=t.type,c=t.pendingProps,f=e!==null?e.memoizedProps:null,n=c.children,Qo(o,c)?n=null:f!==null&&Qo(o,f)&&(t.flags|=32),t.memoizedState!==null&&(o=Ys(e,t,tp,null,null,a),il._currentValue=o),ri(e,t),lt(e,t,n,a),t.child;case 6:return e===null&&se&&((e=a=Ce)&&(a=Yp(a,t.pendingProps,Gt),a!==null?(t.stateNode=a,nt=t,Ce=null,e=!0):e=!1),e||Ha(t)),null;case 13:return Qd(e,t,a);case 4:return na(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=jn(t,null,n,a):lt(e,t,n,a),t.child;case 11:return zd(e,t,t.type,t.pendingProps,a);case 7:return lt(e,t,t.pendingProps,a),t.child;case 8:return lt(e,t,t.pendingProps.children,a),t.child;case 12:return lt(e,t,t.pendingProps.children,a),t.child;case 10:return n=t.pendingProps,La(t,t.type,n.value),lt(e,t,n.children,a),t.child;case 9:return o=t.type._context,n=t.pendingProps.children,bn(t),o=rt(o),n=n(o),t.flags|=1,lt(e,t,n,a),t.child;case 14:return Rd(e,t,t.type,t.pendingProps,a);case 15:return Ud(e,t,t.type,t.pendingProps,a);case 19:return Vd(e,t,a);case 31:return cp(e,t,a);case 22:return kd(e,t,a,t.pendingProps);case 24:return bn(t),n=rt(Qe),e===null?(o=Ns(),o===null&&(o=qe,c=xs(),o.pooledCache=c,c.refCount++,c!==null&&(o.pooledCacheLanes|=a),o=c),t.memoizedState={parent:n,cache:o},Ms(t),La(t,Qe,o)):((e.lanes&a)!==0&&(zs(e,t),Lr(t,null,null,a),Hr()),o=e.memoizedState,c=t.memoizedState,o.parent!==n?(o={parent:n,cache:n},t.memoizedState=o,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=o),La(t,Qe,n)):(n=c.cache,La(t,Qe,n),n!==o.cache&&Ts(t,[Qe],a,!0))),lt(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(s(156,t.tag))}function wa(e){e.flags|=4}function go(e,t,a,n,o){if((t=(e.mode&32)!==0)&&(t=!1),t){if(e.flags|=16777216,(o&335544128)===o)if(e.stateNode.complete)e.flags|=8192;else if(vf())e.flags|=8192;else throw wn=Ql,Os}else e.flags&=-16777217}function Kd(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!cm(t))if(vf())e.flags|=8192;else throw wn=Ql,Os}function ii(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?Dc():536870912,e.lanes|=t,sr|=t)}function Zr(e,t){if(!se)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var n=null;a!==null;)a.alternate!==null&&(n=a),a=a.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Te(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,n=0;if(t)for(var o=e.child;o!==null;)a|=o.lanes|o.childLanes,n|=o.subtreeFlags&65011712,n|=o.flags&65011712,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)a|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=n,e.childLanes=a,t}function dp(e,t,a){var n=t.pendingProps;switch(js(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Te(t),null;case 1:return Te(t),null;case 3:return a=t.stateNode,n=null,e!==null&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),ya(Qe),ra(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Jn(t)?wa(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,qs())),Te(t),null;case 26:var o=t.type,c=t.memoizedState;return e===null?(wa(t),c!==null?(Te(t),Kd(t,c)):(Te(t),go(t,o,null,n,a))):c?c!==e.memoizedState?(wa(t),Te(t),Kd(t,c)):(Te(t),t.flags&=-16777217):(e=e.memoizedProps,e!==n&&wa(t),Te(t),go(t,o,e,n,a)),null;case 27:if(ct(t),a=ot.current,o=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&wa(t);else{if(!n){if(t.stateNode===null)throw Error(s(166));return Te(t),null}e=Ae.current,Jn(t)?Du(t):(e=tm(o,n,a),t.stateNode=e,wa(t))}return Te(t),null;case 5:if(ct(t),o=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&wa(t);else{if(!n){if(t.stateNode===null)throw Error(s(166));return Te(t),null}if(c=Ae.current,Jn(t))Du(t);else{var f=Si(ot.current);switch(c){case 1:c=f.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:c=f.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":c=f.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":c=f.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":c=f.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild);break;case"select":c=typeof n.is=="string"?f.createElement("select",{is:n.is}):f.createElement("select"),n.multiple?c.multiple=!0:n.size&&(c.size=n.size);break;default:c=typeof n.is=="string"?f.createElement(o,{is:n.is}):f.createElement(o)}}c[at]=t,c[ht]=n;e:for(f=t.child;f!==null;){if(f.tag===5||f.tag===6)c.appendChild(f.stateNode);else if(f.tag!==4&&f.tag!==27&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}t.stateNode=c;e:switch(it(c,o,n),o){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&wa(t)}}return Te(t),go(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,a),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==n&&wa(t);else{if(typeof n!="string"&&t.stateNode===null)throw Error(s(166));if(e=ot.current,Jn(t)){if(e=t.stateNode,a=t.memoizedProps,n=null,o=nt,o!==null)switch(o.tag){case 27:case 5:n=o.memoizedProps}e[at]=t,e=!!(e.nodeValue===a||n!==null&&n.suppressHydrationWarning===!0||Xf(e.nodeValue,a)),e||Ha(t,!0)}else e=Si(e).createTextNode(n),e[at]=t,t.stateNode=e}return Te(t),null;case 31:if(a=t.memoizedState,e===null||e.memoizedState!==null){if(n=Jn(t),a!==null){if(e===null){if(!n)throw Error(s(318));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(557));e[at]=t}else hn(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Te(t),e=!1}else a=qs(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return t.flags&256?(At(t),t):(At(t),null);if((t.flags&128)!==0)throw Error(s(558))}return Te(t),null;case 13:if(n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(o=Jn(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(s(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(s(317));o[at]=t}else hn(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Te(t),o=!1}else o=qs(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=o),o=!0;if(!o)return t.flags&256?(At(t),t):(At(t),null)}return At(t),(t.flags&128)!==0?(t.lanes=a,t):(a=n!==null,e=e!==null&&e.memoizedState!==null,a&&(n=t.child,o=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(o=n.alternate.memoizedState.cachePool.pool),c=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),c!==o&&(n.flags|=2048)),a!==e&&a&&(t.child.flags|=8192),ii(t,t.updateQueue),Te(t),null);case 4:return ra(),e===null&&Bo(t.stateNode.containerInfo),Te(t),null;case 10:return ya(t.type),Te(t),null;case 19:if(he(Le),n=t.memoizedState,n===null)return Te(t),null;if(o=(t.flags&128)!==0,c=n.rendering,c===null)if(o)Zr(n,!1);else{if(Ue!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(c=Kl(e),c!==null){for(t.flags|=128,Zr(n,!1),e=c.updateQueue,t.updateQueue=e,ii(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)Su(a,e),a=a.sibling;return re(Le,Le.current&1|2),se&&ga(t,n.treeForkCount),t.child}e=e.sibling}n.tail!==null&&Me()>di&&(t.flags|=128,o=!0,Zr(n,!1),t.lanes=4194304)}else{if(!o)if(e=Kl(c),e!==null){if(t.flags|=128,o=!0,e=e.updateQueue,t.updateQueue=e,ii(t,e),Zr(n,!0),n.tail===null&&n.tailMode==="hidden"&&!c.alternate&&!se)return Te(t),null}else 2*Me()-n.renderingStartTime>di&&a!==536870912&&(t.flags|=128,o=!0,Zr(n,!1),t.lanes=4194304);n.isBackwards?(c.sibling=t.child,t.child=c):(e=n.last,e!==null?e.sibling=c:t.child=c,n.last=c)}return n.tail!==null?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=Me(),e.sibling=null,a=Le.current,re(Le,o?a&1|2:a&1),se&&ga(t,n.treeForkCount),e):(Te(t),null);case 22:case 23:return At(t),Bs(),n=t.memoizedState!==null,e!==null?e.memoizedState!==null!==n&&(t.flags|=8192):n&&(t.flags|=8192),n?(a&536870912)!==0&&(t.flags&128)===0&&(Te(t),t.subtreeFlags&6&&(t.flags|=8192)):Te(t),a=t.updateQueue,a!==null&&ii(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),n=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),n!==a&&(t.flags|=2048),e!==null&&he(vn),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),ya(Qe),Te(t),null;case 25:return null;case 30:return null}throw Error(s(156,t.tag))}function fp(e,t){switch(js(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ya(Qe),ra(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return ct(t),null;case 31:if(t.memoizedState!==null){if(At(t),t.alternate===null)throw Error(s(340));hn()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if(At(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(s(340));hn()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return he(Le),null;case 4:return ra(),null;case 10:return ya(t.type),null;case 22:case 23:return At(t),Bs(),e!==null&&he(vn),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return ya(Qe),null;case 25:return null;default:return null}}function Jd(e,t){switch(js(t),t.tag){case 3:ya(Qe),ra();break;case 26:case 27:case 5:ct(t);break;case 4:ra();break;case 31:t.memoizedState!==null&&At(t);break;case 13:At(t);break;case 19:he(Le);break;case 10:ya(t.type);break;case 22:case 23:At(t),Bs(),e!==null&&he(vn);break;case 24:ya(Qe)}}function Kr(e,t){try{var a=t.updateQueue,n=a!==null?a.lastEffect:null;if(n!==null){var o=n.next;a=o;do{if((a.tag&e)===e){n=void 0;var c=a.create,f=a.inst;n=c(),f.destroy=n}a=a.next}while(a!==o)}}catch(p){be(t,t.return,p)}}function Za(e,t,a){try{var n=t.updateQueue,o=n!==null?n.lastEffect:null;if(o!==null){var c=o.next;n=c;do{if((n.tag&e)===e){var f=n.inst,p=f.destroy;if(p!==void 0){f.destroy=void 0,o=t;var v=a,D=p;try{D()}catch(N){be(o,v,N)}}}n=n.next}while(n!==c)}}catch(N){be(t,t.return,N)}}function $d(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{Hu(t,a)}catch(n){be(e,e.return,n)}}}function Fd(e,t,a){a.props=qn(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(n){be(e,t,n)}}function Jr(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;case 30:n=e.stateNode;break;default:n=e.stateNode}typeof a=="function"?e.refCleanup=a(n):a.current=n}}catch(o){be(e,t,o)}}function oa(e,t){var a=e.ref,n=e.refCleanup;if(a!==null)if(typeof n=="function")try{n()}catch(o){be(e,t,o)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(o){be(e,t,o)}else a.current=null}function Wd(e){var t=e.type,a=e.memoizedProps,n=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break e;case"img":a.src?n.src=a.src:a.srcSet&&(n.srcset=a.srcSet)}}catch(o){be(e,e.return,o)}}function ho(e,t,a){try{var n=e.stateNode;zp(n,e.type,a,t),n[ht]=t}catch(o){be(e,e.return,o)}}function Pd(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Ia(e.type)||e.tag===4}function yo(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Pd(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Ia(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function bo(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=ma));else if(n!==4&&(n===27&&Ia(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(bo(e,t,a),e=e.sibling;e!==null;)bo(e,t,a),e=e.sibling}function si(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(n!==4&&(n===27&&Ia(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(si(e,t,a),e=e.sibling;e!==null;)si(e,t,a),e=e.sibling}function Id(e){var t=e.stateNode,a=e.memoizedProps;try{for(var n=e.type,o=t.attributes;o.length;)t.removeAttributeNode(o[0]);it(t,n,a),t[at]=e,t[ht]=a}catch(c){be(e,e.return,c)}}var ja=!1,Ze=!1,vo=!1,ef=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function mp(e,t){if(e=e.containerInfo,Yo=Ti,e=fu(e),fs(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var n=a.getSelection&&a.getSelection();if(n&&n.rangeCount!==0){a=n.anchorNode;var o=n.anchorOffset,c=n.focusNode;n=n.focusOffset;try{a.nodeType,c.nodeType}catch{a=null;break e}var f=0,p=-1,v=-1,D=0,N=0,M=e,C=null;t:for(;;){for(var T;M!==a||o!==0&&M.nodeType!==3||(p=f+o),M!==c||n!==0&&M.nodeType!==3||(v=f+n),M.nodeType===3&&(f+=M.nodeValue.length),(T=M.firstChild)!==null;)C=M,M=T;for(;;){if(M===e)break t;if(C===a&&++D===o&&(p=f),C===c&&++N===n&&(v=f),(T=M.nextSibling)!==null)break;M=C,C=M.parentNode}M=T}a=p===-1||v===-1?null:{start:p,end:v}}else a=null}a=a||{start:0,end:0}}else a=null;for(Go={focusedElem:e,selectionRange:a},Ti=!1,Ie=t;Ie!==null;)if(t=Ie,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ie=e;else for(;Ie!==null;){switch(t=Ie,c=t.alternate,e=t.flags,t.tag){case 0:if((e&4)!==0&&(e=t.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)o=e[a],o.ref.impl=o.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&c!==null){e=void 0,a=t,o=c.memoizedProps,c=c.memoizedState,n=a.stateNode;try{var V=qn(a.type,o);e=n.getSnapshotBeforeUpdate(V,c),n.__reactInternalSnapshotBeforeUpdate=e}catch(F){be(a,a.return,F)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)Vo(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Vo(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(s(163))}if(e=t.sibling,e!==null){e.return=t.return,Ie=e;break}Ie=t.return}}function tf(e,t,a){var n=a.flags;switch(a.tag){case 0:case 11:case 15:qa(e,a),n&4&&Kr(5,a);break;case 1:if(qa(e,a),n&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(f){be(a,a.return,f)}else{var o=qn(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(o,t,e.__reactInternalSnapshotBeforeUpdate)}catch(f){be(a,a.return,f)}}n&64&&$d(a),n&512&&Jr(a,a.return);break;case 3:if(qa(e,a),n&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{Hu(e,t)}catch(f){be(a,a.return,f)}}break;case 27:t===null&&n&4&&Id(a);case 26:case 5:qa(e,a),t===null&&n&4&&Wd(a),n&512&&Jr(a,a.return);break;case 12:qa(e,a);break;case 31:qa(e,a),n&4&&rf(e,a);break;case 13:qa(e,a),n&4&&lf(e,a),n&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=wp.bind(null,a),Gp(e,a))));break;case 22:if(n=a.memoizedState!==null||ja,!n){t=t!==null&&t.memoizedState!==null||Ze,o=ja;var c=Ze;ja=n,(Ze=t)&&!c?Da(e,a,(a.subtreeFlags&8772)!==0):qa(e,a),ja=o,Ze=c}break;case 30:break;default:qa(e,a)}}function af(e){var t=e.alternate;t!==null&&(e.alternate=null,af(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&$i(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ne=null,bt=!1;function Ea(e,t,a){for(a=a.child;a!==null;)nf(e,t,a),a=a.sibling}function nf(e,t,a){if(Fe&&typeof Fe.onCommitFiberUnmount=="function")try{Fe.onCommitFiberUnmount(dt,a)}catch{}switch(a.tag){case 26:Ze||oa(a,t),Ea(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:Ze||oa(a,t);var n=Ne,o=bt;Ia(a.type)&&(Ne=a.stateNode,bt=!1),Ea(e,t,a),nl(a.stateNode),Ne=n,bt=o;break;case 5:Ze||oa(a,t);case 6:if(n=Ne,o=bt,Ne=null,Ea(e,t,a),Ne=n,bt=o,Ne!==null)if(bt)try{(Ne.nodeType===9?Ne.body:Ne.nodeName==="HTML"?Ne.ownerDocument.body:Ne).removeChild(a.stateNode)}catch(c){be(a,t,c)}else try{Ne.removeChild(a.stateNode)}catch(c){be(a,t,c)}break;case 18:Ne!==null&&(bt?(e=Ne,Ff(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),pr(e)):Ff(Ne,a.stateNode));break;case 4:n=Ne,o=bt,Ne=a.stateNode.containerInfo,bt=!0,Ea(e,t,a),Ne=n,bt=o;break;case 0:case 11:case 14:case 15:Za(2,a,t),Ze||Za(4,a,t),Ea(e,t,a);break;case 1:Ze||(oa(a,t),n=a.stateNode,typeof n.componentWillUnmount=="function"&&Fd(a,t,n)),Ea(e,t,a);break;case 21:Ea(e,t,a);break;case 22:Ze=(n=Ze)||a.memoizedState!==null,Ea(e,t,a),Ze=n;break;default:Ea(e,t,a)}}function rf(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{pr(e)}catch(a){be(t,t.return,a)}}}function lf(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{pr(e)}catch(a){be(t,t.return,a)}}function _p(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new ef),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new ef),t;default:throw Error(s(435,e.tag))}}function oi(e,t){var a=_p(e);t.forEach(function(n){if(!a.has(n)){a.add(n);var o=jp.bind(null,e,n);n.then(o,o)}})}function vt(e,t){var a=t.deletions;if(a!==null)for(var n=0;n<a.length;n++){var o=a[n],c=e,f=t,p=f;e:for(;p!==null;){switch(p.tag){case 27:if(Ia(p.type)){Ne=p.stateNode,bt=!1;break e}break;case 5:Ne=p.stateNode,bt=!1;break e;case 3:case 4:Ne=p.stateNode.containerInfo,bt=!0;break e}p=p.return}if(Ne===null)throw Error(s(160));nf(c,f,o),Ne=null,bt=!1,c=o.alternate,c!==null&&(c.return=null),o.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)sf(t,e),t=t.sibling}var It=null;function sf(e,t){var a=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:vt(t,e),St(e),n&4&&(Za(3,e,e.return),Kr(3,e),Za(5,e,e.return));break;case 1:vt(t,e),St(e),n&512&&(Ze||a===null||oa(a,a.return)),n&64&&ja&&(e=e.updateQueue,e!==null&&(n=e.callbacks,n!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?n:a.concat(n))));break;case 26:var o=It;if(vt(t,e),St(e),n&512&&(Ze||a===null||oa(a,a.return)),n&4){var c=a!==null?a.memoizedState:null;if(n=e.memoizedState,a===null)if(n===null)if(e.stateNode===null){e:{n=e.type,a=e.memoizedProps,o=o.ownerDocument||o;t:switch(n){case"title":c=o.getElementsByTagName("title")[0],(!c||c[Sr]||c[at]||c.namespaceURI==="http://www.w3.org/2000/svg"||c.hasAttribute("itemprop"))&&(c=o.createElement(n),o.head.insertBefore(c,o.querySelector("head > title"))),it(c,n,a),c[at]=e,Pe(c),n=c;break e;case"link":var f=sm("link","href",o).get(n+(a.href||""));if(f){for(var p=0;p<f.length;p++)if(c=f[p],c.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&c.getAttribute("rel")===(a.rel==null?null:a.rel)&&c.getAttribute("title")===(a.title==null?null:a.title)&&c.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){f.splice(p,1);break t}}c=o.createElement(n),it(c,n,a),o.head.appendChild(c);break;case"meta":if(f=sm("meta","content",o).get(n+(a.content||""))){for(p=0;p<f.length;p++)if(c=f[p],c.getAttribute("content")===(a.content==null?null:""+a.content)&&c.getAttribute("name")===(a.name==null?null:a.name)&&c.getAttribute("property")===(a.property==null?null:a.property)&&c.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&c.getAttribute("charset")===(a.charSet==null?null:a.charSet)){f.splice(p,1);break t}}c=o.createElement(n),it(c,n,a),o.head.appendChild(c);break;default:throw Error(s(468,n))}c[at]=e,Pe(c),n=c}e.stateNode=n}else om(o,e.type,e.stateNode);else e.stateNode=im(o,n,e.memoizedProps);else c!==n?(c===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):c.count--,n===null?om(o,e.type,e.stateNode):im(o,n,e.memoizedProps)):n===null&&e.stateNode!==null&&ho(e,e.memoizedProps,a.memoizedProps)}break;case 27:vt(t,e),St(e),n&512&&(Ze||a===null||oa(a,a.return)),a!==null&&n&4&&ho(e,e.memoizedProps,a.memoizedProps);break;case 5:if(vt(t,e),St(e),n&512&&(Ze||a===null||oa(a,a.return)),e.flags&32){o=e.stateNode;try{Bn(o,"")}catch(V){be(e,e.return,V)}}n&4&&e.stateNode!=null&&(o=e.memoizedProps,ho(e,o,a!==null?a.memoizedProps:o)),n&1024&&(vo=!0);break;case 6:if(vt(t,e),St(e),n&4){if(e.stateNode===null)throw Error(s(162));n=e.memoizedProps,a=e.stateNode;try{a.nodeValue=n}catch(V){be(e,e.return,V)}}break;case 3:if(Ei=null,o=It,It=wi(t.containerInfo),vt(t,e),It=o,St(e),n&4&&a!==null&&a.memoizedState.isDehydrated)try{pr(t.containerInfo)}catch(V){be(e,e.return,V)}vo&&(vo=!1,of(e));break;case 4:n=It,It=wi(e.stateNode.containerInfo),vt(t,e),St(e),It=n;break;case 12:vt(t,e),St(e);break;case 31:vt(t,e),St(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,oi(e,n)));break;case 13:vt(t,e),St(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(ui=Me()),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,oi(e,n)));break;case 22:o=e.memoizedState!==null;var v=a!==null&&a.memoizedState!==null,D=ja,N=Ze;if(ja=D||o,Ze=N||v,vt(t,e),Ze=N,ja=D,St(e),n&8192)e:for(t=e.stateNode,t._visibility=o?t._visibility&-2:t._visibility|1,o&&(a===null||v||ja||Ze||Dn(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){v=a=t;try{if(c=v.stateNode,o)f=c.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none";else{p=v.stateNode;var M=v.memoizedProps.style,C=M!=null&&M.hasOwnProperty("display")?M.display:null;p.style.display=C==null||typeof C=="boolean"?"":(""+C).trim()}}catch(V){be(v,v.return,V)}}}else if(t.tag===6){if(a===null){v=t;try{v.stateNode.nodeValue=o?"":v.memoizedProps}catch(V){be(v,v.return,V)}}}else if(t.tag===18){if(a===null){v=t;try{var T=v.stateNode;o?Wf(T,!0):Wf(v.stateNode,!1)}catch(V){be(v,v.return,V)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}n&4&&(n=e.updateQueue,n!==null&&(a=n.retryQueue,a!==null&&(n.retryQueue=null,oi(e,a))));break;case 19:vt(t,e),St(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,oi(e,n)));break;case 30:break;case 21:break;default:vt(t,e),St(e)}}function St(e){var t=e.flags;if(t&2){try{for(var a,n=e.return;n!==null;){if(Pd(n)){a=n;break}n=n.return}if(a==null)throw Error(s(160));switch(a.tag){case 27:var o=a.stateNode,c=yo(e);si(e,c,o);break;case 5:var f=a.stateNode;a.flags&32&&(Bn(f,""),a.flags&=-33);var p=yo(e);si(e,p,f);break;case 3:case 4:var v=a.stateNode.containerInfo,D=yo(e);bo(e,D,v);break;default:throw Error(s(161))}}catch(N){be(e,e.return,N)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function of(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;of(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function qa(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)tf(e,t.alternate,t),t=t.sibling}function Dn(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Za(4,t,t.return),Dn(t);break;case 1:oa(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&Fd(t,t.return,a),Dn(t);break;case 27:nl(t.stateNode);case 26:case 5:oa(t,t.return),Dn(t);break;case 22:t.memoizedState===null&&Dn(t);break;case 30:Dn(t);break;default:Dn(t)}e=e.sibling}}function Da(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var n=t.alternate,o=e,c=t,f=c.flags;switch(c.tag){case 0:case 11:case 15:Da(o,c,a),Kr(4,c);break;case 1:if(Da(o,c,a),n=c,o=n.stateNode,typeof o.componentDidMount=="function")try{o.componentDidMount()}catch(D){be(n,n.return,D)}if(n=c,o=n.updateQueue,o!==null){var p=n.stateNode;try{var v=o.shared.hiddenCallbacks;if(v!==null)for(o.shared.hiddenCallbacks=null,o=0;o<v.length;o++)Bu(v[o],p)}catch(D){be(n,n.return,D)}}a&&f&64&&$d(c),Jr(c,c.return);break;case 27:Id(c);case 26:case 5:Da(o,c,a),a&&n===null&&f&4&&Wd(c),Jr(c,c.return);break;case 12:Da(o,c,a);break;case 31:Da(o,c,a),a&&f&4&&rf(o,c);break;case 13:Da(o,c,a),a&&f&4&&lf(o,c);break;case 22:c.memoizedState===null&&Da(o,c,a),Jr(c,c.return);break;case 30:break;default:Da(o,c,a)}t=t.sibling}}function So(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&zr(a))}function wo(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&zr(e))}function ea(e,t,a,n){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)cf(e,t,a,n),t=t.sibling}function cf(e,t,a,n){var o=t.flags;switch(t.tag){case 0:case 11:case 15:ea(e,t,a,n),o&2048&&Kr(9,t);break;case 1:ea(e,t,a,n);break;case 3:ea(e,t,a,n),o&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&zr(e)));break;case 12:if(o&2048){ea(e,t,a,n),e=t.stateNode;try{var c=t.memoizedProps,f=c.id,p=c.onPostCommit;typeof p=="function"&&p(f,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(v){be(t,t.return,v)}}else ea(e,t,a,n);break;case 31:ea(e,t,a,n);break;case 13:ea(e,t,a,n);break;case 23:break;case 22:c=t.stateNode,f=t.alternate,t.memoizedState!==null?c._visibility&2?ea(e,t,a,n):$r(e,t):c._visibility&2?ea(e,t,a,n):(c._visibility|=2,rr(e,t,a,n,(t.subtreeFlags&10256)!==0||!1)),o&2048&&So(f,t);break;case 24:ea(e,t,a,n),o&2048&&wo(t.alternate,t);break;default:ea(e,t,a,n)}}function rr(e,t,a,n,o){for(o=o&&((t.subtreeFlags&10256)!==0||!1),t=t.child;t!==null;){var c=e,f=t,p=a,v=n,D=f.flags;switch(f.tag){case 0:case 11:case 15:rr(c,f,p,v,o),Kr(8,f);break;case 23:break;case 22:var N=f.stateNode;f.memoizedState!==null?N._visibility&2?rr(c,f,p,v,o):$r(c,f):(N._visibility|=2,rr(c,f,p,v,o)),o&&D&2048&&So(f.alternate,f);break;case 24:rr(c,f,p,v,o),o&&D&2048&&wo(f.alternate,f);break;default:rr(c,f,p,v,o)}t=t.sibling}}function $r(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,n=t,o=n.flags;switch(n.tag){case 22:$r(a,n),o&2048&&So(n.alternate,n);break;case 24:$r(a,n),o&2048&&wo(n.alternate,n);break;default:$r(a,n)}t=t.sibling}}var Fr=8192;function lr(e,t,a){if(e.subtreeFlags&Fr)for(e=e.child;e!==null;)uf(e,t,a),e=e.sibling}function uf(e,t,a){switch(e.tag){case 26:lr(e,t,a),e.flags&Fr&&e.memoizedState!==null&&eg(a,It,e.memoizedState,e.memoizedProps);break;case 5:lr(e,t,a);break;case 3:case 4:var n=It;It=wi(e.stateNode.containerInfo),lr(e,t,a),It=n;break;case 22:e.memoizedState===null&&(n=e.alternate,n!==null&&n.memoizedState!==null?(n=Fr,Fr=16777216,lr(e,t,a),Fr=n):lr(e,t,a));break;default:lr(e,t,a)}}function df(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Wr(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var n=t[a];Ie=n,mf(n,e)}df(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)ff(e),e=e.sibling}function ff(e){switch(e.tag){case 0:case 11:case 15:Wr(e),e.flags&2048&&Za(9,e,e.return);break;case 3:Wr(e);break;case 12:Wr(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,ci(e)):Wr(e);break;default:Wr(e)}}function ci(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var n=t[a];Ie=n,mf(n,e)}df(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Za(8,t,t.return),ci(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,ci(t));break;default:ci(t)}e=e.sibling}}function mf(e,t){for(;Ie!==null;){var a=Ie;switch(a.tag){case 0:case 11:case 15:Za(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var n=a.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:zr(a.memoizedState.cache)}if(n=a.child,n!==null)n.return=a,Ie=n;else e:for(a=e;Ie!==null;){n=Ie;var o=n.sibling,c=n.return;if(af(n),n===a){Ie=null;break e}if(o!==null){o.return=c,Ie=o;break e}Ie=c}}}var pp={getCacheForType:function(e){var t=rt(Qe),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a},cacheSignal:function(){return rt(Qe).controller.signal}},gp=typeof WeakMap=="function"?WeakMap:Map,pe=0,qe=null,ae=null,le=0,ye=0,Nt=null,Ka=!1,ir=!1,jo=!1,Ca=0,Ue=0,Ja=0,Cn=0,Eo=0,Ot=0,sr=0,Pr=null,wt=null,qo=!1,ui=0,_f=0,di=1/0,fi=null,$a=null,Je=0,Fa=null,or=null,Ta=0,Do=0,Co=null,pf=null,Ir=0,To=null;function Mt(){return(pe&2)!==0&&le!==0?le&-le:A.T!==null?zo():Ac()}function gf(){if(Ot===0)if((le&536870912)===0||se){var e=vl;vl<<=1,(vl&3932160)===0&&(vl=262144),Ot=e}else Ot=536870912;return e=xt.current,e!==null&&(e.flags|=32),Ot}function jt(e,t,a){(e===qe&&(ye===2||ye===9)||e.cancelPendingCommit!==null)&&(cr(e,0),Wa(e,le,Ot,!1)),vr(e,a),((pe&2)===0||e!==qe)&&(e===qe&&((pe&2)===0&&(Cn|=a),Ue===4&&Wa(e,le,Ot,!1)),ca(e))}function hf(e,t,a){if((pe&6)!==0)throw Error(s(327));var n=!a&&(t&127)===0&&(t&e.expiredLanes)===0||br(e,t),o=n?bp(e,t):Ao(e,t,!0),c=n;do{if(o===0){ir&&!n&&Wa(e,t,0,!1);break}else{if(a=e.current.alternate,c&&!hp(a)){o=Ao(e,t,!1),c=!1;continue}if(o===2){if(c=t,e.errorRecoveryDisabledLanes&c)var f=0;else f=e.pendingLanes&-536870913,f=f!==0?f:f&536870912?536870912:0;if(f!==0){t=f;e:{var p=e;o=Pr;var v=p.current.memoizedState.isDehydrated;if(v&&(cr(p,f).flags|=256),f=Ao(p,f,!1),f!==2){if(jo&&!v){p.errorRecoveryDisabledLanes|=c,Cn|=c,o=4;break e}c=wt,wt=o,c!==null&&(wt===null?wt=c:wt.push.apply(wt,c))}o=f}if(c=!1,o!==2)continue}}if(o===1){cr(e,0),Wa(e,t,0,!0);break}e:{switch(n=e,c=o,c){case 0:case 1:throw Error(s(345));case 4:if((t&4194048)!==t)break;case 6:Wa(n,t,Ot,!Ka);break e;case 2:wt=null;break;case 3:case 5:break;default:throw Error(s(329))}if((t&62914560)===t&&(o=ui+300-Me(),10<o)){if(Wa(n,t,Ot,!Ka),wl(n,0,!0)!==0)break e;Ta=t,n.timeoutHandle=Jf(yf.bind(null,n,a,wt,fi,qo,t,Ot,Cn,sr,Ka,c,"Throttled",-0,0),o);break e}yf(n,a,wt,fi,qo,t,Ot,Cn,sr,Ka,c,null,-0,0)}}break}while(!0);ca(e)}function yf(e,t,a,n,o,c,f,p,v,D,N,M,C,T){if(e.timeoutHandle=-1,M=t.subtreeFlags,M&8192||(M&16785408)===16785408){M={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ma},uf(t,c,M);var V=(c&62914560)===c?ui-Me():(c&4194048)===c?_f-Me():0;if(V=tg(M,V),V!==null){Ta=c,e.cancelPendingCommit=V(Df.bind(null,e,t,c,a,n,o,f,p,v,N,M,null,C,T)),Wa(e,c,f,!D);return}}Df(e,t,c,a,n,o,f,p,v)}function hp(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var n=0;n<a.length;n++){var o=a[n],c=o.getSnapshot;o=o.value;try{if(!Ct(c(),o))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Wa(e,t,a,n){t&=~Eo,t&=~Cn,e.suspendedLanes|=t,e.pingedLanes&=~t,n&&(e.warmLanes|=t),n=e.expirationTimes;for(var o=t;0<o;){var c=31-ze(o),f=1<<c;n[c]=-1,o&=~f}a!==0&&Cc(e,a,t)}function mi(){return(pe&6)===0?(el(0),!1):!0}function xo(){if(ae!==null){if(ye===0)var e=ae.return;else e=ae,ha=yn=null,Xs(e),In=null,Ur=0,e=ae;for(;e!==null;)Jd(e.alternate,e),e=e.return;ae=null}}function cr(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,kp(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),Ta=0,xo(),qe=e,ae=a=pa(e.current,null),le=t,ye=0,Nt=null,Ka=!1,ir=br(e,t),jo=!1,sr=Ot=Eo=Cn=Ja=Ue=0,wt=Pr=null,qo=!1,(t&8)!==0&&(t|=t&32);var n=e.entangledLanes;if(n!==0)for(e=e.entanglements,n&=t;0<n;){var o=31-ze(n),c=1<<o;t|=e[o],n&=~c}return Ca=t,zl(),a}function bf(e,t){I=null,A.H=Xr,t===Pn||t===Gl?(t=zu(),ye=3):t===Os?(t=zu(),ye=4):ye=t===io?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,Nt=t,ae===null&&(Ue=1,ai(e,Ht(t,e.current)))}function vf(){var e=xt.current;return e===null?!0:(le&4194048)===le?Qt===null:(le&62914560)===le||(le&536870912)!==0?e===Qt:!1}function Sf(){var e=A.H;return A.H=Xr,e===null?Xr:e}function wf(){var e=A.A;return A.A=pp,e}function _i(){Ue=4,Ka||(le&4194048)!==le&&xt.current!==null||(ir=!0),(Ja&134217727)===0&&(Cn&134217727)===0||qe===null||Wa(qe,le,Ot,!1)}function Ao(e,t,a){var n=pe;pe|=2;var o=Sf(),c=wf();(qe!==e||le!==t)&&(fi=null,cr(e,t)),t=!1;var f=Ue;e:do try{if(ye!==0&&ae!==null){var p=ae,v=Nt;switch(ye){case 8:xo(),f=6;break e;case 3:case 2:case 9:case 6:xt.current===null&&(t=!0);var D=ye;if(ye=0,Nt=null,ur(e,p,v,D),a&&ir){f=0;break e}break;default:D=ye,ye=0,Nt=null,ur(e,p,v,D)}}yp(),f=Ue;break}catch(N){bf(e,N)}while(!0);return t&&e.shellSuspendCounter++,ha=yn=null,pe=n,A.H=o,A.A=c,ae===null&&(qe=null,le=0,zl()),f}function yp(){for(;ae!==null;)jf(ae)}function bp(e,t){var a=pe;pe|=2;var n=Sf(),o=wf();qe!==e||le!==t?(fi=null,di=Me()+500,cr(e,t)):ir=br(e,t);e:do try{if(ye!==0&&ae!==null){t=ae;var c=Nt;t:switch(ye){case 1:ye=0,Nt=null,ur(e,t,c,1);break;case 2:case 9:if(Ou(c)){ye=0,Nt=null,Ef(t);break}t=function(){ye!==2&&ye!==9||qe!==e||(ye=7),ca(e)},c.then(t,t);break e;case 3:ye=7;break e;case 4:ye=5;break e;case 7:Ou(c)?(ye=0,Nt=null,Ef(t)):(ye=0,Nt=null,ur(e,t,c,7));break;case 5:var f=null;switch(ae.tag){case 26:f=ae.memoizedState;case 5:case 27:var p=ae;if(f?cm(f):p.stateNode.complete){ye=0,Nt=null;var v=p.sibling;if(v!==null)ae=v;else{var D=p.return;D!==null?(ae=D,pi(D)):ae=null}break t}}ye=0,Nt=null,ur(e,t,c,5);break;case 6:ye=0,Nt=null,ur(e,t,c,6);break;case 8:xo(),Ue=6;break e;default:throw Error(s(462))}}vp();break}catch(N){bf(e,N)}while(!0);return ha=yn=null,A.H=n,A.A=o,pe=a,ae!==null?0:(qe=null,le=0,zl(),Ue)}function vp(){for(;ae!==null&&!la();)jf(ae)}function jf(e){var t=Zd(e.alternate,e,Ca);e.memoizedProps=e.pendingProps,t===null?pi(e):ae=t}function Ef(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=Ld(a,t,t.pendingProps,t.type,void 0,le);break;case 11:t=Ld(a,t,t.pendingProps,t.type.render,t.ref,le);break;case 5:Xs(t);default:Jd(a,t),t=ae=Su(t,Ca),t=Zd(a,t,Ca)}e.memoizedProps=e.pendingProps,t===null?pi(e):ae=t}function ur(e,t,a,n){ha=yn=null,Xs(t),In=null,Ur=0;var o=t.return;try{if(op(e,o,t,a,le)){Ue=1,ai(e,Ht(a,e.current)),ae=null;return}}catch(c){if(o!==null)throw ae=o,c;Ue=1,ai(e,Ht(a,e.current)),ae=null;return}t.flags&32768?(se||n===1?e=!0:ir||(le&536870912)!==0?e=!1:(Ka=e=!0,(n===2||n===9||n===3||n===6)&&(n=xt.current,n!==null&&n.tag===13&&(n.flags|=16384))),qf(t,e)):pi(t)}function pi(e){var t=e;do{if((t.flags&32768)!==0){qf(t,Ka);return}e=t.return;var a=dp(t.alternate,t,Ca);if(a!==null){ae=a;return}if(t=t.sibling,t!==null){ae=t;return}ae=t=e}while(t!==null);Ue===0&&(Ue=5)}function qf(e,t){do{var a=fp(e.alternate,e);if(a!==null){a.flags&=32767,ae=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){ae=e;return}ae=e=a}while(e!==null);Ue=6,ae=null}function Df(e,t,a,n,o,c,f,p,v){e.cancelPendingCommit=null;do gi();while(Je!==0);if((pe&6)!==0)throw Error(s(327));if(t!==null){if(t===e.current)throw Error(s(177));if(c=t.lanes|t.childLanes,c|=hs,Im(e,a,c,f,p,v),e===qe&&(ae=qe=null,le=0),or=t,Fa=e,Ta=a,Do=c,Co=o,pf=n,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Ep(Oa,function(){return Nf(),null})):(e.callbackNode=null,e.callbackPriority=0),n=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||n){n=A.T,A.T=null,o=B.p,B.p=2,f=pe,pe|=4;try{mp(e,t,a)}finally{pe=f,B.p=o,A.T=n}}Je=1,Cf(),Tf(),xf()}}function Cf(){if(Je===1){Je=0;var e=Fa,t=or,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=A.T,A.T=null;var n=B.p;B.p=2;var o=pe;pe|=4;try{sf(t,e);var c=Go,f=fu(e.containerInfo),p=c.focusedElem,v=c.selectionRange;if(f!==p&&p&&p.ownerDocument&&du(p.ownerDocument.documentElement,p)){if(v!==null&&fs(p)){var D=v.start,N=v.end;if(N===void 0&&(N=D),"selectionStart"in p)p.selectionStart=D,p.selectionEnd=Math.min(N,p.value.length);else{var M=p.ownerDocument||document,C=M&&M.defaultView||window;if(C.getSelection){var T=C.getSelection(),V=p.textContent.length,F=Math.min(v.start,V),je=v.end===void 0?F:Math.min(v.end,V);!T.extend&&F>je&&(f=je,je=F,F=f);var j=uu(p,F),S=uu(p,je);if(j&&S&&(T.rangeCount!==1||T.anchorNode!==j.node||T.anchorOffset!==j.offset||T.focusNode!==S.node||T.focusOffset!==S.offset)){var q=M.createRange();q.setStart(j.node,j.offset),T.removeAllRanges(),F>je?(T.addRange(q),T.extend(S.node,S.offset)):(q.setEnd(S.node,S.offset),T.addRange(q))}}}}for(M=[],T=p;T=T.parentNode;)T.nodeType===1&&M.push({element:T,left:T.scrollLeft,top:T.scrollTop});for(typeof p.focus=="function"&&p.focus(),p=0;p<M.length;p++){var O=M[p];O.element.scrollLeft=O.left,O.element.scrollTop=O.top}}Ti=!!Yo,Go=Yo=null}finally{pe=o,B.p=n,A.T=a}}e.current=t,Je=2}}function Tf(){if(Je===2){Je=0;var e=Fa,t=or,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=A.T,A.T=null;var n=B.p;B.p=2;var o=pe;pe|=4;try{tf(e,t.alternate,t)}finally{pe=o,B.p=n,A.T=a}}Je=3}}function xf(){if(Je===4||Je===3){Je=0,Dt();var e=Fa,t=or,a=Ta,n=pf;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?Je=5:(Je=0,or=Fa=null,Af(e,e.pendingLanes));var o=e.pendingLanes;if(o===0&&($a=null),Ki(a),t=t.stateNode,Fe&&typeof Fe.onCommitFiberRoot=="function")try{Fe.onCommitFiberRoot(dt,t,void 0,(t.current.flags&128)===128)}catch{}if(n!==null){t=A.T,o=B.p,B.p=2,A.T=null;try{for(var c=e.onRecoverableError,f=0;f<n.length;f++){var p=n[f];c(p.value,{componentStack:p.stack})}}finally{A.T=t,B.p=o}}(Ta&3)!==0&&gi(),ca(e),o=e.pendingLanes,(a&261930)!==0&&(o&42)!==0?e===To?Ir++:(Ir=0,To=e):Ir=0,el(0)}}function Af(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,zr(t)))}function gi(){return Cf(),Tf(),xf(),Nf()}function Nf(){if(Je!==5)return!1;var e=Fa,t=Do;Do=0;var a=Ki(Ta),n=A.T,o=B.p;try{B.p=32>a?32:a,A.T=null,a=Co,Co=null;var c=Fa,f=Ta;if(Je=0,or=Fa=null,Ta=0,(pe&6)!==0)throw Error(s(331));var p=pe;if(pe|=4,ff(c.current),cf(c,c.current,f,a),pe=p,el(0,!1),Fe&&typeof Fe.onPostCommitFiberRoot=="function")try{Fe.onPostCommitFiberRoot(dt,c)}catch{}return!0}finally{B.p=o,A.T=n,Af(e,t)}}function Of(e,t,a){t=Ht(a,t),t=lo(e.stateNode,t,2),e=Qa(e,t,2),e!==null&&(vr(e,2),ca(e))}function be(e,t,a){if(e.tag===3)Of(e,e,a);else for(;t!==null;){if(t.tag===3){Of(t,e,a);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&($a===null||!$a.has(n))){e=Ht(a,e),a=Od(2),n=Qa(t,a,2),n!==null&&(Md(a,n,t,e),vr(n,2),ca(n));break}}t=t.return}}function No(e,t,a){var n=e.pingCache;if(n===null){n=e.pingCache=new gp;var o=new Set;n.set(t,o)}else o=n.get(t),o===void 0&&(o=new Set,n.set(t,o));o.has(a)||(jo=!0,o.add(a),e=Sp.bind(null,e,t,a),t.then(e,e))}function Sp(e,t,a){var n=e.pingCache;n!==null&&n.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,qe===e&&(le&a)===a&&(Ue===4||Ue===3&&(le&62914560)===le&&300>Me()-ui?(pe&2)===0&&cr(e,0):Eo|=a,sr===le&&(sr=0)),ca(e)}function Mf(e,t){t===0&&(t=Dc()),e=pn(e,t),e!==null&&(vr(e,t),ca(e))}function wp(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),Mf(e,a)}function jp(e,t){var a=0;switch(e.tag){case 31:case 13:var n=e.stateNode,o=e.memoizedState;o!==null&&(a=o.retryLane);break;case 19:n=e.stateNode;break;case 22:n=e.stateNode._retryCache;break;default:throw Error(s(314))}n!==null&&n.delete(t),Mf(e,a)}function Ep(e,t){return Oe(e,t)}var hi=null,dr=null,Oo=!1,yi=!1,Mo=!1,Pa=0;function ca(e){e!==dr&&e.next===null&&(dr===null?hi=dr=e:dr=dr.next=e),yi=!0,Oo||(Oo=!0,Dp())}function el(e,t){if(!Mo&&yi){Mo=!0;do for(var a=!1,n=hi;n!==null;){if(e!==0){var o=n.pendingLanes;if(o===0)var c=0;else{var f=n.suspendedLanes,p=n.pingedLanes;c=(1<<31-ze(42|e)+1)-1,c&=o&~(f&~p),c=c&201326741?c&201326741|1:c?c|2:0}c!==0&&(a=!0,kf(n,c))}else c=le,c=wl(n,n===qe?c:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(c&3)===0||br(n,c)||(a=!0,kf(n,c));n=n.next}while(a);Mo=!1}}function qp(){zf()}function zf(){yi=Oo=!1;var e=0;Pa!==0&&Up()&&(e=Pa);for(var t=Me(),a=null,n=hi;n!==null;){var o=n.next,c=Rf(n,t);c===0?(n.next=null,a===null?hi=o:a.next=o,o===null&&(dr=a)):(a=n,(e!==0||(c&3)!==0)&&(yi=!0)),n=o}Je!==0&&Je!==5||el(e),Pa!==0&&(Pa=0)}function Rf(e,t){for(var a=e.suspendedLanes,n=e.pingedLanes,o=e.expirationTimes,c=e.pendingLanes&-62914561;0<c;){var f=31-ze(c),p=1<<f,v=o[f];v===-1?((p&a)===0||(p&n)!==0)&&(o[f]=Pm(p,t)):v<=t&&(e.expiredLanes|=p),c&=~p}if(t=qe,a=le,a=wl(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n=e.callbackNode,a===0||e===t&&(ye===2||ye===9)||e.cancelPendingCommit!==null)return n!==null&&n!==null&&Wt(n),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||br(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(n!==null&&Wt(n),Ki(a)){case 2:case 8:a=yr;break;case 32:a=Oa;break;case 268435456:a=U;break;default:a=Oa}return n=Uf.bind(null,e),a=Oe(a,n),e.callbackPriority=t,e.callbackNode=a,t}return n!==null&&n!==null&&Wt(n),e.callbackPriority=2,e.callbackNode=null,2}function Uf(e,t){if(Je!==0&&Je!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(gi()&&e.callbackNode!==a)return null;var n=le;return n=wl(e,e===qe?n:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n===0?null:(hf(e,n,t),Rf(e,Me()),e.callbackNode!=null&&e.callbackNode===a?Uf.bind(null,e):null)}function kf(e,t){if(gi())return null;hf(e,t,!0)}function Dp(){Bp(function(){(pe&6)!==0?Oe(on,qp):zf()})}function zo(){if(Pa===0){var e=Fn;e===0&&(e=bl,bl<<=1,(bl&261888)===0&&(bl=256)),Pa=e}return Pa}function Bf(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Dl(""+e)}function Hf(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function Cp(e,t,a,n,o){if(t==="submit"&&a&&a.stateNode===o){var c=Bf((o[ht]||null).action),f=n.submitter;f&&(t=(t=f[ht]||null)?Bf(t.formAction):f.getAttribute("formAction"),t!==null&&(c=t,f=null));var p=new Al("action","action",null,n,o);e.push({event:p,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(Pa!==0){var v=f?Hf(o,f):new FormData(o);Is(a,{pending:!0,data:v,method:o.method,action:c},null,v)}}else typeof c=="function"&&(p.preventDefault(),v=f?Hf(o,f):new FormData(o),Is(a,{pending:!0,data:v,method:o.method,action:c},c,v))},currentTarget:o}]})}}for(var Ro=0;Ro<gs.length;Ro++){var Uo=gs[Ro],Tp=Uo.toLowerCase(),xp=Uo[0].toUpperCase()+Uo.slice(1);Pt(Tp,"on"+xp)}Pt(pu,"onAnimationEnd"),Pt(gu,"onAnimationIteration"),Pt(hu,"onAnimationStart"),Pt("dblclick","onDoubleClick"),Pt("focusin","onFocus"),Pt("focusout","onBlur"),Pt(V_,"onTransitionRun"),Pt(Z_,"onTransitionStart"),Pt(K_,"onTransitionCancel"),Pt(yu,"onTransitionEnd"),Un("onMouseEnter",["mouseout","mouseover"]),Un("onMouseLeave",["mouseout","mouseover"]),Un("onPointerEnter",["pointerout","pointerover"]),Un("onPointerLeave",["pointerout","pointerover"]),dn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),dn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),dn("onBeforeInput",["compositionend","keypress","textInput","paste"]),dn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),dn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),dn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var tl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ap=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(tl));function Lf(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var n=e[a],o=n.event;n=n.listeners;e:{var c=void 0;if(t)for(var f=n.length-1;0<=f;f--){var p=n[f],v=p.instance,D=p.currentTarget;if(p=p.listener,v!==c&&o.isPropagationStopped())break e;c=p,o.currentTarget=D;try{c(o)}catch(N){Ml(N)}o.currentTarget=null,c=v}else for(f=0;f<n.length;f++){if(p=n[f],v=p.instance,D=p.currentTarget,p=p.listener,v!==c&&o.isPropagationStopped())break e;c=p,o.currentTarget=D;try{c(o)}catch(N){Ml(N)}o.currentTarget=null,c=v}}}}function ne(e,t){var a=t[Ji];a===void 0&&(a=t[Ji]=new Set);var n=e+"__bubble";a.has(n)||(Yf(t,e,2,!1),a.add(n))}function ko(e,t,a){var n=0;t&&(n|=4),Yf(a,e,n,t)}var bi="_reactListening"+Math.random().toString(36).slice(2);function Bo(e){if(!e[bi]){e[bi]=!0,Mc.forEach(function(a){a!=="selectionchange"&&(Ap.has(a)||ko(a,!1,e),ko(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[bi]||(t[bi]=!0,ko("selectionchange",!1,t))}}function Yf(e,t,a,n){switch(gm(t)){case 2:var o=rg;break;case 8:o=lg;break;default:o=Io}a=o.bind(null,t,a,e),o=void 0,!ns||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),n?o!==void 0?e.addEventListener(t,a,{capture:!0,passive:o}):e.addEventListener(t,a,!0):o!==void 0?e.addEventListener(t,a,{passive:o}):e.addEventListener(t,a,!1)}function Ho(e,t,a,n,o){var c=n;if((t&1)===0&&(t&2)===0&&n!==null)e:for(;;){if(n===null)return;var f=n.tag;if(f===3||f===4){var p=n.stateNode.containerInfo;if(p===o)break;if(f===4)for(f=n.return;f!==null;){var v=f.tag;if((v===3||v===4)&&f.stateNode.containerInfo===o)return;f=f.return}for(;p!==null;){if(f=Mn(p),f===null)return;if(v=f.tag,v===5||v===6||v===26||v===27){n=c=f;continue e}p=p.parentNode}}n=n.return}Vc(function(){var D=c,N=ts(a),M=[];e:{var C=bu.get(e);if(C!==void 0){var T=Al,V=e;switch(e){case"keypress":if(Tl(a)===0)break e;case"keydown":case"keyup":T=j_;break;case"focusin":V="focus",T=ss;break;case"focusout":V="blur",T=ss;break;case"beforeblur":case"afterblur":T=ss;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":T=Jc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":T=d_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":T=D_;break;case pu:case gu:case hu:T=__;break;case yu:T=T_;break;case"scroll":case"scrollend":T=c_;break;case"wheel":T=A_;break;case"copy":case"cut":case"paste":T=g_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":T=Fc;break;case"toggle":case"beforetoggle":T=O_}var F=(t&4)!==0,je=!F&&(e==="scroll"||e==="scrollend"),j=F?C!==null?C+"Capture":null:C;F=[];for(var S=D,q;S!==null;){var O=S;if(q=O.stateNode,O=O.tag,O!==5&&O!==26&&O!==27||q===null||j===null||(O=jr(S,j),O!=null&&F.push(al(S,O,q))),je)break;S=S.return}0<F.length&&(C=new T(C,V,null,a,N),M.push({event:C,listeners:F}))}}if((t&7)===0){e:{if(C=e==="mouseover"||e==="pointerover",T=e==="mouseout"||e==="pointerout",C&&a!==es&&(V=a.relatedTarget||a.fromElement)&&(Mn(V)||V[On]))break e;if((T||C)&&(C=N.window===N?N:(C=N.ownerDocument)?C.defaultView||C.parentWindow:window,T?(V=a.relatedTarget||a.toElement,T=D,V=V?Mn(V):null,V!==null&&(je=d(V),F=V.tag,V!==je||F!==5&&F!==27&&F!==6)&&(V=null)):(T=null,V=D),T!==V)){if(F=Jc,O="onMouseLeave",j="onMouseEnter",S="mouse",(e==="pointerout"||e==="pointerover")&&(F=Fc,O="onPointerLeave",j="onPointerEnter",S="pointer"),je=T==null?C:wr(T),q=V==null?C:wr(V),C=new F(O,S+"leave",T,a,N),C.target=je,C.relatedTarget=q,O=null,Mn(N)===D&&(F=new F(j,S+"enter",V,a,N),F.target=q,F.relatedTarget=je,O=F),je=O,T&&V)t:{for(F=Np,j=T,S=V,q=0,O=j;O;O=F(O))q++;O=0;for(var J=S;J;J=F(J))O++;for(;0<q-O;)j=F(j),q--;for(;0<O-q;)S=F(S),O--;for(;q--;){if(j===S||S!==null&&j===S.alternate){F=j;break t}j=F(j),S=F(S)}F=null}else F=null;T!==null&&Gf(M,C,T,F,!1),V!==null&&je!==null&&Gf(M,je,V,F,!0)}}e:{if(C=D?wr(D):window,T=C.nodeName&&C.nodeName.toLowerCase(),T==="select"||T==="input"&&C.type==="file")var fe=ru;else if(au(C))if(lu)fe=G_;else{fe=L_;var Z=H_}else T=C.nodeName,!T||T.toLowerCase()!=="input"||C.type!=="checkbox"&&C.type!=="radio"?D&&Ii(D.elementType)&&(fe=ru):fe=Y_;if(fe&&(fe=fe(e,D))){nu(M,fe,a,N);break e}Z&&Z(e,C,D),e==="focusout"&&D&&C.type==="number"&&D.memoizedProps.value!=null&&Pi(C,"number",C.value)}switch(Z=D?wr(D):window,e){case"focusin":(au(Z)||Z.contentEditable==="true")&&(Gn=Z,ms=D,Nr=null);break;case"focusout":Nr=ms=Gn=null;break;case"mousedown":_s=!0;break;case"contextmenu":case"mouseup":case"dragend":_s=!1,mu(M,a,N);break;case"selectionchange":if(X_)break;case"keydown":case"keyup":mu(M,a,N)}var ee;if(cs)e:{switch(e){case"compositionstart":var ie="onCompositionStart";break e;case"compositionend":ie="onCompositionEnd";break e;case"compositionupdate":ie="onCompositionUpdate";break e}ie=void 0}else Yn?eu(e,a)&&(ie="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(ie="onCompositionStart");ie&&(Wc&&a.locale!=="ko"&&(Yn||ie!=="onCompositionStart"?ie==="onCompositionEnd"&&Yn&&(ee=Zc()):(Ua=N,rs="value"in Ua?Ua.value:Ua.textContent,Yn=!0)),Z=vi(D,ie),0<Z.length&&(ie=new $c(ie,e,null,a,N),M.push({event:ie,listeners:Z}),ee?ie.data=ee:(ee=tu(a),ee!==null&&(ie.data=ee)))),(ee=z_?R_(e,a):U_(e,a))&&(ie=vi(D,"onBeforeInput"),0<ie.length&&(Z=new $c("onBeforeInput","beforeinput",null,a,N),M.push({event:Z,listeners:ie}),Z.data=ee)),Cp(M,e,D,a,N)}Lf(M,t)})}function al(e,t,a){return{instance:e,listener:t,currentTarget:a}}function vi(e,t){for(var a=t+"Capture",n=[];e!==null;){var o=e,c=o.stateNode;if(o=o.tag,o!==5&&o!==26&&o!==27||c===null||(o=jr(e,a),o!=null&&n.unshift(al(e,o,c)),o=jr(e,t),o!=null&&n.push(al(e,o,c))),e.tag===3)return n;e=e.return}return[]}function Np(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Gf(e,t,a,n,o){for(var c=t._reactName,f=[];a!==null&&a!==n;){var p=a,v=p.alternate,D=p.stateNode;if(p=p.tag,v!==null&&v===n)break;p!==5&&p!==26&&p!==27||D===null||(v=D,o?(D=jr(a,c),D!=null&&f.unshift(al(a,D,v))):o||(D=jr(a,c),D!=null&&f.push(al(a,D,v)))),a=a.return}f.length!==0&&e.push({event:t,listeners:f})}var Op=/\r\n?/g,Mp=/\u0000|\uFFFD/g;function Qf(e){return(typeof e=="string"?e:""+e).replace(Op,`
`).replace(Mp,"")}function Xf(e,t){return t=Qf(t),Qf(e)===t}function we(e,t,a,n,o,c){switch(a){case"children":typeof n=="string"?t==="body"||t==="textarea"&&n===""||Bn(e,n):(typeof n=="number"||typeof n=="bigint")&&t!=="body"&&Bn(e,""+n);break;case"className":El(e,"class",n);break;case"tabIndex":El(e,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":El(e,a,n);break;case"style":Qc(e,n,c);break;case"data":if(t!=="object"){El(e,"data",n);break}case"src":case"href":if(n===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(a);break}n=Dl(""+n),e.setAttribute(a,n);break;case"action":case"formAction":if(typeof n=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof c=="function"&&(a==="formAction"?(t!=="input"&&we(e,t,"name",o.name,o,null),we(e,t,"formEncType",o.formEncType,o,null),we(e,t,"formMethod",o.formMethod,o,null),we(e,t,"formTarget",o.formTarget,o,null)):(we(e,t,"encType",o.encType,o,null),we(e,t,"method",o.method,o,null),we(e,t,"target",o.target,o,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(a);break}n=Dl(""+n),e.setAttribute(a,n);break;case"onClick":n!=null&&(e.onclick=ma);break;case"onScroll":n!=null&&ne("scroll",e);break;case"onScrollEnd":n!=null&&ne("scrollend",e);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(s(61));if(a=n.__html,a!=null){if(o.children!=null)throw Error(s(60));e.innerHTML=a}}break;case"multiple":e.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":e.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){e.removeAttribute("xlink:href");break}a=Dl(""+n),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,""+n):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":n===!0?e.setAttribute(a,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,n):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?e.setAttribute(a,n):e.removeAttribute(a);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?e.removeAttribute(a):e.setAttribute(a,n);break;case"popover":ne("beforetoggle",e),ne("toggle",e),jl(e,"popover",n);break;case"xlinkActuate":fa(e,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":fa(e,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":fa(e,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":fa(e,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":fa(e,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":fa(e,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":fa(e,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":fa(e,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":fa(e,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":jl(e,"is",n);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=s_.get(a)||a,jl(e,a,n))}}function Lo(e,t,a,n,o,c){switch(a){case"style":Qc(e,n,c);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(s(61));if(a=n.__html,a!=null){if(o.children!=null)throw Error(s(60));e.innerHTML=a}}break;case"children":typeof n=="string"?Bn(e,n):(typeof n=="number"||typeof n=="bigint")&&Bn(e,""+n);break;case"onScroll":n!=null&&ne("scroll",e);break;case"onScrollEnd":n!=null&&ne("scrollend",e);break;case"onClick":n!=null&&(e.onclick=ma);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!zc.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(o=a.endsWith("Capture"),t=a.slice(2,o?a.length-7:void 0),c=e[ht]||null,c=c!=null?c[a]:null,typeof c=="function"&&e.removeEventListener(t,c,o),typeof n=="function")){typeof c!="function"&&c!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,n,o);break e}a in e?e[a]=n:n===!0?e.setAttribute(a,""):jl(e,a,n)}}}function it(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ne("error",e),ne("load",e);var n=!1,o=!1,c;for(c in a)if(a.hasOwnProperty(c)){var f=a[c];if(f!=null)switch(c){case"src":n=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:we(e,t,c,f,a,null)}}o&&we(e,t,"srcSet",a.srcSet,a,null),n&&we(e,t,"src",a.src,a,null);return;case"input":ne("invalid",e);var p=c=f=o=null,v=null,D=null;for(n in a)if(a.hasOwnProperty(n)){var N=a[n];if(N!=null)switch(n){case"name":o=N;break;case"type":f=N;break;case"checked":v=N;break;case"defaultChecked":D=N;break;case"value":c=N;break;case"defaultValue":p=N;break;case"children":case"dangerouslySetInnerHTML":if(N!=null)throw Error(s(137,t));break;default:we(e,t,n,N,a,null)}}Hc(e,c,p,v,D,f,o,!1);return;case"select":ne("invalid",e),n=f=c=null;for(o in a)if(a.hasOwnProperty(o)&&(p=a[o],p!=null))switch(o){case"value":c=p;break;case"defaultValue":f=p;break;case"multiple":n=p;default:we(e,t,o,p,a,null)}t=c,a=f,e.multiple=!!n,t!=null?kn(e,!!n,t,!1):a!=null&&kn(e,!!n,a,!0);return;case"textarea":ne("invalid",e),c=o=n=null;for(f in a)if(a.hasOwnProperty(f)&&(p=a[f],p!=null))switch(f){case"value":n=p;break;case"defaultValue":o=p;break;case"children":c=p;break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(s(91));break;default:we(e,t,f,p,a,null)}Yc(e,n,o,c);return;case"option":for(v in a)if(a.hasOwnProperty(v)&&(n=a[v],n!=null))switch(v){case"selected":e.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:we(e,t,v,n,a,null)}return;case"dialog":ne("beforetoggle",e),ne("toggle",e),ne("cancel",e),ne("close",e);break;case"iframe":case"object":ne("load",e);break;case"video":case"audio":for(n=0;n<tl.length;n++)ne(tl[n],e);break;case"image":ne("error",e),ne("load",e);break;case"details":ne("toggle",e);break;case"embed":case"source":case"link":ne("error",e),ne("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(D in a)if(a.hasOwnProperty(D)&&(n=a[D],n!=null))switch(D){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:we(e,t,D,n,a,null)}return;default:if(Ii(t)){for(N in a)a.hasOwnProperty(N)&&(n=a[N],n!==void 0&&Lo(e,t,N,n,a,void 0));return}}for(p in a)a.hasOwnProperty(p)&&(n=a[p],n!=null&&we(e,t,p,n,a,null))}function zp(e,t,a,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,c=null,f=null,p=null,v=null,D=null,N=null;for(T in a){var M=a[T];if(a.hasOwnProperty(T)&&M!=null)switch(T){case"checked":break;case"value":break;case"defaultValue":v=M;default:n.hasOwnProperty(T)||we(e,t,T,null,n,M)}}for(var C in n){var T=n[C];if(M=a[C],n.hasOwnProperty(C)&&(T!=null||M!=null))switch(C){case"type":c=T;break;case"name":o=T;break;case"checked":D=T;break;case"defaultChecked":N=T;break;case"value":f=T;break;case"defaultValue":p=T;break;case"children":case"dangerouslySetInnerHTML":if(T!=null)throw Error(s(137,t));break;default:T!==M&&we(e,t,C,T,n,M)}}Wi(e,f,p,v,D,N,c,o);return;case"select":T=f=p=C=null;for(c in a)if(v=a[c],a.hasOwnProperty(c)&&v!=null)switch(c){case"value":break;case"multiple":T=v;default:n.hasOwnProperty(c)||we(e,t,c,null,n,v)}for(o in n)if(c=n[o],v=a[o],n.hasOwnProperty(o)&&(c!=null||v!=null))switch(o){case"value":C=c;break;case"defaultValue":p=c;break;case"multiple":f=c;default:c!==v&&we(e,t,o,c,n,v)}t=p,a=f,n=T,C!=null?kn(e,!!a,C,!1):!!n!=!!a&&(t!=null?kn(e,!!a,t,!0):kn(e,!!a,a?[]:"",!1));return;case"textarea":T=C=null;for(p in a)if(o=a[p],a.hasOwnProperty(p)&&o!=null&&!n.hasOwnProperty(p))switch(p){case"value":break;case"children":break;default:we(e,t,p,null,n,o)}for(f in n)if(o=n[f],c=a[f],n.hasOwnProperty(f)&&(o!=null||c!=null))switch(f){case"value":C=o;break;case"defaultValue":T=o;break;case"children":break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(s(91));break;default:o!==c&&we(e,t,f,o,n,c)}Lc(e,C,T);return;case"option":for(var V in a)if(C=a[V],a.hasOwnProperty(V)&&C!=null&&!n.hasOwnProperty(V))switch(V){case"selected":e.selected=!1;break;default:we(e,t,V,null,n,C)}for(v in n)if(C=n[v],T=a[v],n.hasOwnProperty(v)&&C!==T&&(C!=null||T!=null))switch(v){case"selected":e.selected=C&&typeof C!="function"&&typeof C!="symbol";break;default:we(e,t,v,C,n,T)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var F in a)C=a[F],a.hasOwnProperty(F)&&C!=null&&!n.hasOwnProperty(F)&&we(e,t,F,null,n,C);for(D in n)if(C=n[D],T=a[D],n.hasOwnProperty(D)&&C!==T&&(C!=null||T!=null))switch(D){case"children":case"dangerouslySetInnerHTML":if(C!=null)throw Error(s(137,t));break;default:we(e,t,D,C,n,T)}return;default:if(Ii(t)){for(var je in a)C=a[je],a.hasOwnProperty(je)&&C!==void 0&&!n.hasOwnProperty(je)&&Lo(e,t,je,void 0,n,C);for(N in n)C=n[N],T=a[N],!n.hasOwnProperty(N)||C===T||C===void 0&&T===void 0||Lo(e,t,N,C,n,T);return}}for(var j in a)C=a[j],a.hasOwnProperty(j)&&C!=null&&!n.hasOwnProperty(j)&&we(e,t,j,null,n,C);for(M in n)C=n[M],T=a[M],!n.hasOwnProperty(M)||C===T||C==null&&T==null||we(e,t,M,C,n,T)}function Vf(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Rp(){if(typeof performance.getEntriesByType=="function"){for(var e=0,t=0,a=performance.getEntriesByType("resource"),n=0;n<a.length;n++){var o=a[n],c=o.transferSize,f=o.initiatorType,p=o.duration;if(c&&p&&Vf(f)){for(f=0,p=o.responseEnd,n+=1;n<a.length;n++){var v=a[n],D=v.startTime;if(D>p)break;var N=v.transferSize,M=v.initiatorType;N&&Vf(M)&&(v=v.responseEnd,f+=N*(v<p?1:(p-D)/(v-D)))}if(--n,t+=8*(c+f)/(o.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var Yo=null,Go=null;function Si(e){return e.nodeType===9?e:e.ownerDocument}function Zf(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Kf(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function Qo(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Xo=null;function Up(){var e=window.event;return e&&e.type==="popstate"?e===Xo?!1:(Xo=e,!0):(Xo=null,!1)}var Jf=typeof setTimeout=="function"?setTimeout:void 0,kp=typeof clearTimeout=="function"?clearTimeout:void 0,$f=typeof Promise=="function"?Promise:void 0,Bp=typeof queueMicrotask=="function"?queueMicrotask:typeof $f<"u"?function(e){return $f.resolve(null).then(e).catch(Hp)}:Jf;function Hp(e){setTimeout(function(){throw e})}function Ia(e){return e==="head"}function Ff(e,t){var a=t,n=0;do{var o=a.nextSibling;if(e.removeChild(a),o&&o.nodeType===8)if(a=o.data,a==="/$"||a==="/&"){if(n===0){e.removeChild(o),pr(t);return}n--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")n++;else if(a==="html")nl(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,nl(a);for(var c=a.firstChild;c;){var f=c.nextSibling,p=c.nodeName;c[Sr]||p==="SCRIPT"||p==="STYLE"||p==="LINK"&&c.rel.toLowerCase()==="stylesheet"||a.removeChild(c),c=f}}else a==="body"&&nl(e.ownerDocument.body);a=o}while(a);pr(t)}function Wf(e,t){var a=e;e=0;do{var n=a.nextSibling;if(a.nodeType===1?t?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(t?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),n&&n.nodeType===8)if(a=n.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=n}while(a)}function Vo(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Vo(a),$i(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Lp(e,t,a,n){for(;e.nodeType===1;){var o=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!n&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(n){if(!e[Sr])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(c=e.getAttribute("rel"),c==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(c!==o.rel||e.getAttribute("href")!==(o.href==null||o.href===""?null:o.href)||e.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin)||e.getAttribute("title")!==(o.title==null?null:o.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(c=e.getAttribute("src"),(c!==(o.src==null?null:o.src)||e.getAttribute("type")!==(o.type==null?null:o.type)||e.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin))&&c&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var c=o.name==null?null:""+o.name;if(o.type==="hidden"&&e.getAttribute("name")===c)return e}else return e;if(e=Xt(e.nextSibling),e===null)break}return null}function Yp(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=Xt(e.nextSibling),e===null))return null;return e}function Pf(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!t||(e=Xt(e.nextSibling),e===null))return null;return e}function Zo(e){return e.data==="$?"||e.data==="$~"}function Ko(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function Gp(e,t){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=t;else if(e.data!=="$?"||a.readyState!=="loading")t();else{var n=function(){t(),a.removeEventListener("DOMContentLoaded",n)};a.addEventListener("DOMContentLoaded",n),e._reactRetry=n}}function Xt(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="$~"||t==="&"||t==="F!"||t==="F")break;if(t==="/$"||t==="/&")return null}}return e}var Jo=null;function If(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(t===0)return Xt(e.nextSibling);t--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||t++}e=e.nextSibling}return null}function em(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(t===0)return e;t--}else a!=="/$"&&a!=="/&"||t++}e=e.previousSibling}return null}function tm(e,t,a){switch(t=Si(a),e){case"html":if(e=t.documentElement,!e)throw Error(s(452));return e;case"head":if(e=t.head,!e)throw Error(s(453));return e;case"body":if(e=t.body,!e)throw Error(s(454));return e;default:throw Error(s(451))}}function nl(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);$i(e)}var Vt=new Map,am=new Set;function wi(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var xa=B.d;B.d={f:Qp,r:Xp,D:Vp,C:Zp,L:Kp,m:Jp,X:Fp,S:$p,M:Wp};function Qp(){var e=xa.f(),t=mi();return e||t}function Xp(e){var t=zn(e);t!==null&&t.tag===5&&t.type==="form"?yd(t):xa.r(e)}var fr=typeof document>"u"?null:document;function nm(e,t,a){var n=fr;if(n&&typeof t=="string"&&t){var o=kt(t);o='link[rel="'+e+'"][href="'+o+'"]',typeof a=="string"&&(o+='[crossorigin="'+a+'"]'),am.has(o)||(am.add(o),e={rel:e,crossOrigin:a,href:t},n.querySelector(o)===null&&(t=n.createElement("link"),it(t,"link",e),Pe(t),n.head.appendChild(t)))}}function Vp(e){xa.D(e),nm("dns-prefetch",e,null)}function Zp(e,t){xa.C(e,t),nm("preconnect",e,t)}function Kp(e,t,a){xa.L(e,t,a);var n=fr;if(n&&e&&t){var o='link[rel="preload"][as="'+kt(t)+'"]';t==="image"&&a&&a.imageSrcSet?(o+='[imagesrcset="'+kt(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(o+='[imagesizes="'+kt(a.imageSizes)+'"]')):o+='[href="'+kt(e)+'"]';var c=o;switch(t){case"style":c=mr(e);break;case"script":c=_r(e)}Vt.has(c)||(e=E({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),Vt.set(c,e),n.querySelector(o)!==null||t==="style"&&n.querySelector(rl(c))||t==="script"&&n.querySelector(ll(c))||(t=n.createElement("link"),it(t,"link",e),Pe(t),n.head.appendChild(t)))}}function Jp(e,t){xa.m(e,t);var a=fr;if(a&&e){var n=t&&typeof t.as=="string"?t.as:"script",o='link[rel="modulepreload"][as="'+kt(n)+'"][href="'+kt(e)+'"]',c=o;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":c=_r(e)}if(!Vt.has(c)&&(e=E({rel:"modulepreload",href:e},t),Vt.set(c,e),a.querySelector(o)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(ll(c)))return}n=a.createElement("link"),it(n,"link",e),Pe(n),a.head.appendChild(n)}}}function $p(e,t,a){xa.S(e,t,a);var n=fr;if(n&&e){var o=Rn(n).hoistableStyles,c=mr(e);t=t||"default";var f=o.get(c);if(!f){var p={loading:0,preload:null};if(f=n.querySelector(rl(c)))p.loading=5;else{e=E({rel:"stylesheet",href:e,"data-precedence":t},a),(a=Vt.get(c))&&$o(e,a);var v=f=n.createElement("link");Pe(v),it(v,"link",e),v._p=new Promise(function(D,N){v.onload=D,v.onerror=N}),v.addEventListener("load",function(){p.loading|=1}),v.addEventListener("error",function(){p.loading|=2}),p.loading|=4,ji(f,t,n)}f={type:"stylesheet",instance:f,count:1,state:p},o.set(c,f)}}}function Fp(e,t){xa.X(e,t);var a=fr;if(a&&e){var n=Rn(a).hoistableScripts,o=_r(e),c=n.get(o);c||(c=a.querySelector(ll(o)),c||(e=E({src:e,async:!0},t),(t=Vt.get(o))&&Fo(e,t),c=a.createElement("script"),Pe(c),it(c,"link",e),a.head.appendChild(c)),c={type:"script",instance:c,count:1,state:null},n.set(o,c))}}function Wp(e,t){xa.M(e,t);var a=fr;if(a&&e){var n=Rn(a).hoistableScripts,o=_r(e),c=n.get(o);c||(c=a.querySelector(ll(o)),c||(e=E({src:e,async:!0,type:"module"},t),(t=Vt.get(o))&&Fo(e,t),c=a.createElement("script"),Pe(c),it(c,"link",e),a.head.appendChild(c)),c={type:"script",instance:c,count:1,state:null},n.set(o,c))}}function rm(e,t,a,n){var o=(o=ot.current)?wi(o):null;if(!o)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=mr(a.href),a=Rn(o).hoistableStyles,n=a.get(t),n||(n={type:"style",instance:null,count:0,state:null},a.set(t,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=mr(a.href);var c=Rn(o).hoistableStyles,f=c.get(e);if(f||(o=o.ownerDocument||o,f={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},c.set(e,f),(c=o.querySelector(rl(e)))&&!c._p&&(f.instance=c,f.state.loading=5),Vt.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Vt.set(e,a),c||Pp(o,e,a,f.state))),t&&n===null)throw Error(s(528,""));return f}if(t&&n!==null)throw Error(s(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=_r(a),a=Rn(o).hoistableScripts,n=a.get(t),n||(n={type:"script",instance:null,count:0,state:null},a.set(t,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function mr(e){return'href="'+kt(e)+'"'}function rl(e){return'link[rel="stylesheet"]['+e+"]"}function lm(e){return E({},e,{"data-precedence":e.precedence,precedence:null})}function Pp(e,t,a,n){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?n.loading=1:(t=e.createElement("link"),n.preload=t,t.addEventListener("load",function(){return n.loading|=1}),t.addEventListener("error",function(){return n.loading|=2}),it(t,"link",a),Pe(t),e.head.appendChild(t))}function _r(e){return'[src="'+kt(e)+'"]'}function ll(e){return"script[async]"+e}function im(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var n=e.querySelector('style[data-href~="'+kt(a.href)+'"]');if(n)return t.instance=n,Pe(n),n;var o=E({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return n=(e.ownerDocument||e).createElement("style"),Pe(n),it(n,"style",o),ji(n,a.precedence,e),t.instance=n;case"stylesheet":o=mr(a.href);var c=e.querySelector(rl(o));if(c)return t.state.loading|=4,t.instance=c,Pe(c),c;n=lm(a),(o=Vt.get(o))&&$o(n,o),c=(e.ownerDocument||e).createElement("link"),Pe(c);var f=c;return f._p=new Promise(function(p,v){f.onload=p,f.onerror=v}),it(c,"link",n),t.state.loading|=4,ji(c,a.precedence,e),t.instance=c;case"script":return c=_r(a.src),(o=e.querySelector(ll(c)))?(t.instance=o,Pe(o),o):(n=a,(o=Vt.get(c))&&(n=E({},a),Fo(n,o)),e=e.ownerDocument||e,o=e.createElement("script"),Pe(o),it(o,"link",n),e.head.appendChild(o),t.instance=o);case"void":return null;default:throw Error(s(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(n=t.instance,t.state.loading|=4,ji(n,a.precedence,e));return t.instance}function ji(e,t,a){for(var n=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=n.length?n[n.length-1]:null,c=o,f=0;f<n.length;f++){var p=n[f];if(p.dataset.precedence===t)c=p;else if(c!==o)break}c?c.parentNode.insertBefore(e,c.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function $o(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Fo(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Ei=null;function sm(e,t,a){if(Ei===null){var n=new Map,o=Ei=new Map;o.set(a,n)}else o=Ei,n=o.get(a),n||(n=new Map,o.set(a,n));if(n.has(e))return n;for(n.set(e,null),a=a.getElementsByTagName(e),o=0;o<a.length;o++){var c=a[o];if(!(c[Sr]||c[at]||e==="link"&&c.getAttribute("rel")==="stylesheet")&&c.namespaceURI!=="http://www.w3.org/2000/svg"){var f=c.getAttribute(t)||"";f=e+f;var p=n.get(f);p?p.push(c):n.set(f,[c])}}return n}function om(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function Ip(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function cm(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function eg(e,t,a,n){if(a.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var o=mr(n.href),c=t.querySelector(rl(o));if(c){t=c._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(e.count++,e=qi.bind(e),t.then(e,e)),a.state.loading|=4,a.instance=c,Pe(c);return}c=t.ownerDocument||t,n=lm(n),(o=Vt.get(o))&&$o(n,o),c=c.createElement("link"),Pe(c);var f=c;f._p=new Promise(function(p,v){f.onload=p,f.onerror=v}),it(c,"link",n),a.instance=c}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,t),(t=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=qi.bind(e),t.addEventListener("load",a),t.addEventListener("error",a))}}var Wo=0;function tg(e,t){return e.stylesheets&&e.count===0&&Ci(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var n=setTimeout(function(){if(e.stylesheets&&Ci(e,e.stylesheets),e.unsuspend){var c=e.unsuspend;e.unsuspend=null,c()}},6e4+t);0<e.imgBytes&&Wo===0&&(Wo=62500*Rp());var o=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Ci(e,e.stylesheets),e.unsuspend)){var c=e.unsuspend;e.unsuspend=null,c()}},(e.imgBytes>Wo?50:800)+t);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(n),clearTimeout(o)}}:null}function qi(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ci(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Di=null;function Ci(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Di=new Map,t.forEach(ag,e),Di=null,qi.call(e))}function ag(e,t){if(!(t.state.loading&4)){var a=Di.get(e);if(a)var n=a.get(null);else{a=new Map,Di.set(e,a);for(var o=e.querySelectorAll("link[data-precedence],style[data-precedence]"),c=0;c<o.length;c++){var f=o[c];(f.nodeName==="LINK"||f.getAttribute("media")!=="not all")&&(a.set(f.dataset.precedence,f),n=f)}n&&a.set(null,n)}o=t.instance,f=o.getAttribute("data-precedence"),c=a.get(f)||n,c===n&&a.set(null,o),a.set(f,o),this.count++,n=qi.bind(this),o.addEventListener("load",n),o.addEventListener("error",n),c?c.parentNode.insertBefore(o,c.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(o,e.firstChild)),t.state.loading|=4}}var il={$$typeof:ve,Provider:null,Consumer:null,_currentValue:K,_currentValue2:K,_threadCount:0};function ng(e,t,a,n,o,c,f,p,v){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Vi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vi(0),this.hiddenUpdates=Vi(null),this.identifierPrefix=n,this.onUncaughtError=o,this.onCaughtError=c,this.onRecoverableError=f,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=v,this.incompleteTransitions=new Map}function um(e,t,a,n,o,c,f,p,v,D,N,M){return e=new ng(e,t,a,f,v,D,N,M,p),t=1,c===!0&&(t|=24),c=Tt(3,null,null,t),e.current=c,c.stateNode=e,t=xs(),t.refCount++,e.pooledCache=t,t.refCount++,c.memoizedState={element:n,isDehydrated:a,cache:t},Ms(c),e}function dm(e){return e?(e=Vn,e):Vn}function fm(e,t,a,n,o,c){o=dm(o),n.context===null?n.context=o:n.pendingContext=o,n=Ga(t),n.payload={element:a},c=c===void 0?null:c,c!==null&&(n.callback=c),a=Qa(e,n,t),a!==null&&(jt(a,e,t),Br(a,e,t))}function mm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function Po(e,t){mm(e,t),(e=e.alternate)&&mm(e,t)}function _m(e){if(e.tag===13||e.tag===31){var t=pn(e,67108864);t!==null&&jt(t,e,67108864),Po(e,67108864)}}function pm(e){if(e.tag===13||e.tag===31){var t=Mt();t=Zi(t);var a=pn(e,t);a!==null&&jt(a,e,t),Po(e,t)}}var Ti=!0;function rg(e,t,a,n){var o=A.T;A.T=null;var c=B.p;try{B.p=2,Io(e,t,a,n)}finally{B.p=c,A.T=o}}function lg(e,t,a,n){var o=A.T;A.T=null;var c=B.p;try{B.p=8,Io(e,t,a,n)}finally{B.p=c,A.T=o}}function Io(e,t,a,n){if(Ti){var o=ec(n);if(o===null)Ho(e,t,n,xi,a),hm(e,n);else if(sg(o,e,t,a,n))n.stopPropagation();else if(hm(e,n),t&4&&-1<ig.indexOf(e)){for(;o!==null;){var c=zn(o);if(c!==null)switch(c.tag){case 3:if(c=c.stateNode,c.current.memoizedState.isDehydrated){var f=un(c.pendingLanes);if(f!==0){var p=c;for(p.pendingLanes|=2,p.entangledLanes|=2;f;){var v=1<<31-ze(f);p.entanglements[1]|=v,f&=~v}ca(c),(pe&6)===0&&(di=Me()+500,el(0))}}break;case 31:case 13:p=pn(c,2),p!==null&&jt(p,c,2),mi(),Po(c,2)}if(c=ec(n),c===null&&Ho(e,t,n,xi,a),c===o)break;o=c}o!==null&&n.stopPropagation()}else Ho(e,t,n,null,a)}}function ec(e){return e=ts(e),tc(e)}var xi=null;function tc(e){if(xi=null,e=Mn(e),e!==null){var t=d(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=m(t),e!==null)return e;e=null}else if(a===31){if(e=g(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return xi=e,null}function gm(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(sn()){case on:return 2;case yr:return 8;case Oa:case hl:return 32;case U:return 268435456;default:return 32}default:return 32}}var ac=!1,en=null,tn=null,an=null,sl=new Map,ol=new Map,nn=[],ig="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function hm(e,t){switch(e){case"focusin":case"focusout":en=null;break;case"dragenter":case"dragleave":tn=null;break;case"mouseover":case"mouseout":an=null;break;case"pointerover":case"pointerout":sl.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ol.delete(t.pointerId)}}function cl(e,t,a,n,o,c){return e===null||e.nativeEvent!==c?(e={blockedOn:t,domEventName:a,eventSystemFlags:n,nativeEvent:c,targetContainers:[o]},t!==null&&(t=zn(t),t!==null&&_m(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function sg(e,t,a,n,o){switch(t){case"focusin":return en=cl(en,e,t,a,n,o),!0;case"dragenter":return tn=cl(tn,e,t,a,n,o),!0;case"mouseover":return an=cl(an,e,t,a,n,o),!0;case"pointerover":var c=o.pointerId;return sl.set(c,cl(sl.get(c)||null,e,t,a,n,o)),!0;case"gotpointercapture":return c=o.pointerId,ol.set(c,cl(ol.get(c)||null,e,t,a,n,o)),!0}return!1}function ym(e){var t=Mn(e.target);if(t!==null){var a=d(t);if(a!==null){if(t=a.tag,t===13){if(t=m(a),t!==null){e.blockedOn=t,Nc(e.priority,function(){pm(a)});return}}else if(t===31){if(t=g(a),t!==null){e.blockedOn=t,Nc(e.priority,function(){pm(a)});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ai(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=ec(e.nativeEvent);if(a===null){a=e.nativeEvent;var n=new a.constructor(a.type,a);es=n,a.target.dispatchEvent(n),es=null}else return t=zn(a),t!==null&&_m(t),e.blockedOn=a,!1;t.shift()}return!0}function bm(e,t,a){Ai(e)&&a.delete(t)}function og(){ac=!1,en!==null&&Ai(en)&&(en=null),tn!==null&&Ai(tn)&&(tn=null),an!==null&&Ai(an)&&(an=null),sl.forEach(bm),ol.forEach(bm)}function Ni(e,t){e.blockedOn===t&&(e.blockedOn=null,ac||(ac=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,og)))}var Oi=null;function vm(e){Oi!==e&&(Oi=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Oi===e&&(Oi=null);for(var t=0;t<e.length;t+=3){var a=e[t],n=e[t+1],o=e[t+2];if(typeof n!="function"){if(tc(n||a)===null)continue;break}var c=zn(a);c!==null&&(e.splice(t,3),t-=3,Is(c,{pending:!0,data:o,method:a.method,action:n},n,o))}}))}function pr(e){function t(v){return Ni(v,e)}en!==null&&Ni(en,e),tn!==null&&Ni(tn,e),an!==null&&Ni(an,e),sl.forEach(t),ol.forEach(t);for(var a=0;a<nn.length;a++){var n=nn[a];n.blockedOn===e&&(n.blockedOn=null)}for(;0<nn.length&&(a=nn[0],a.blockedOn===null);)ym(a),a.blockedOn===null&&nn.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(n=0;n<a.length;n+=3){var o=a[n],c=a[n+1],f=o[ht]||null;if(typeof c=="function")f||vm(a);else if(f){var p=null;if(c&&c.hasAttribute("formAction")){if(o=c,f=c[ht]||null)p=f.formAction;else if(tc(o)!==null)continue}else p=f.action;typeof p=="function"?a[n+1]=p:(a.splice(n,3),n-=3),vm(a)}}}function Sm(){function e(c){c.canIntercept&&c.info==="react-transition"&&c.intercept({handler:function(){return new Promise(function(f){return o=f})},focusReset:"manual",scroll:"manual"})}function t(){o!==null&&(o(),o=null),n||setTimeout(a,20)}function a(){if(!n&&!navigation.transition){var c=navigation.currentEntry;c&&c.url!=null&&navigation.navigate(c.url,{state:c.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,o=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(a,100),function(){n=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),o!==null&&(o(),o=null)}}}function nc(e){this._internalRoot=e}Mi.prototype.render=nc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(s(409));var a=t.current,n=Mt();fm(a,n,e,t,null,null)},Mi.prototype.unmount=nc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;fm(e.current,2,null,e,null,null),mi(),t[On]=null}};function Mi(e){this._internalRoot=e}Mi.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ac();e={blockedOn:null,target:e,priority:t};for(var a=0;a<nn.length&&t!==0&&t<nn[a].priority;a++);nn.splice(a,0,e),a===0&&ym(e)}};var wm=l.version;if(wm!=="19.2.0")throw Error(s(527,wm,"19.2.0"));B.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(s(188)):(e=Object.keys(e).join(","),Error(s(268,e)));return e=x(t),e=e!==null?z(e):null,e=e===null?null:e.stateNode,e};var cg={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:A,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zi.isDisabled&&zi.supportsFiber)try{dt=zi.inject(cg),Fe=zi}catch{}}return dl.createRoot=function(e,t){if(!u(e))throw Error(s(299));var a=!1,n="",o=Td,c=xd,f=Ad;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onUncaughtError!==void 0&&(o=t.onUncaughtError),t.onCaughtError!==void 0&&(c=t.onCaughtError),t.onRecoverableError!==void 0&&(f=t.onRecoverableError)),t=um(e,1,!1,null,null,a,n,null,o,c,f,Sm),e[On]=t.current,Bo(e),new nc(t)},dl.hydrateRoot=function(e,t,a){if(!u(e))throw Error(s(299));var n=!1,o="",c=Td,f=xd,p=Ad,v=null;return a!=null&&(a.unstable_strictMode===!0&&(n=!0),a.identifierPrefix!==void 0&&(o=a.identifierPrefix),a.onUncaughtError!==void 0&&(c=a.onUncaughtError),a.onCaughtError!==void 0&&(f=a.onCaughtError),a.onRecoverableError!==void 0&&(p=a.onRecoverableError),a.formState!==void 0&&(v=a.formState)),t=um(e,1,!0,t,a??null,n,o,v,c,f,p,Sm),t.context=dm(null),a=t.current,n=Mt(),n=Zi(n),o=Ga(n),o.callback=null,Qa(a,o,n),a=n,t.current.lanes=a,vr(t,a),ca(t),e[On]=t.current,Bo(e),new Mi(t)},dl.version="19.2.0",dl}var Tm;function Bg(){if(Tm)return ic.exports;Tm=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(l){console.error(l)}}return r(),ic.exports=kg(),ic.exports}var Hg=Bg();const Lg=mg(Hg);function Yg(r,l,i=[]){if(!r||!l)return{hasConflict:!1,conflicts:[]};const s=new Date(r._offlineModifiedAt||r.updated_at||0),u=new Date(l.updated_at||0),d=new Date(r._cachedAt||0);if(u<=d)return{hasConflict:!1,conflicts:[]};const m=[],g=i.length>0?i:Object.keys(r).filter(b=>!b.startsWith("_")&&b!=="id"&&b!=="created_at");for(const b of g){const x=r[b],z=l[b];if(x!==void 0&&z!==void 0&&!Li(x,z)){const E=r._cachedValues?.[b],k=E!==void 0?!Li(x,E):!0,X=E!==void 0?!Li(z,E):!0;k&&X&&m.push({field:b,localValue:x,serverValue:z,cachedValue:E})}}return{hasConflict:m.length>0,conflicts:m,localModifiedAt:s,serverUpdatedAt:u}}function Li(r,l){if(r===l)return!0;if(r==null||l==null)return r===l;if(typeof r!=typeof l)return!1;if(typeof r!="object")return r===l;if(Array.isArray(r)!==Array.isArray(l))return!1;const i=Object.keys(r),s=Object.keys(l);return i.length!==s.length?!1:i.every(u=>Li(r[u],l[u]))}const Gg={KEEP_LOCAL:"keep_local",KEEP_SERVER:"keep_server",MERGE:"merge"};function Qg(r,l=[]){const i={...r,_cachedAt:new Date().toISOString()};if(l.length>0){i._cachedValues={};for(const s of l)r[s]!==void 0&&(i._cachedValues[s]=JSON.parse(JSON.stringify(r[s])))}return i}function Xg(r,l="record"){if(!r.hasConflict)return null;if(r.deletedOnServer)return{title:`${xm(l)} was deleted`,description:`This ${l} was deleted by another user while you were offline.`,severity:"warning",conflictCount:1};const i=r.conflicts.map(s=>s.field).join(", ");return{title:`${xm(l)} was modified`,description:`The following fields were changed by another user: ${i}`,severity:r.conflicts.length>2?"warning":"info",conflictCount:r.conflicts.length,fields:r.conflicts}}function xm(r){return r.charAt(0).toUpperCase()+r.slice(1)}const Vg="fieldsync-offline",Zg=2,ue={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",TM_TICKETS:"tm_tickets",DAILY_REPORTS:"daily_reports",MESSAGES:"messages",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let xn=null;const Na=()=>new Promise((r,l)=>{if(xn){r(xn);return}const i=indexedDB.open(Vg,Zg);i.onerror=()=>{console.error("Failed to open offline database"),l(i.error)},i.onsuccess=()=>{xn=i.result,r(xn)},i.onupgradeneeded=s=>{const u=s.target.result;if(u.objectStoreNames.contains(ue.PROJECTS)||u.createObjectStore(ue.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),u.objectStoreNames.contains(ue.AREAS)||u.createObjectStore(ue.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),u.objectStoreNames.contains(ue.CREW_CHECKINS)||u.createObjectStore(ue.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),u.objectStoreNames.contains(ue.TM_TICKETS)||u.createObjectStore(ue.TM_TICKETS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),u.objectStoreNames.contains(ue.DAILY_REPORTS)||u.createObjectStore(ue.DAILY_REPORTS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),u.objectStoreNames.contains(ue.MESSAGES)||u.createObjectStore(ue.MESSAGES,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!u.objectStoreNames.contains(ue.PENDING_ACTIONS)){const d=u.createObjectStore(ue.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});d.createIndex("type","type",{unique:!1}),d.createIndex("created_at","created_at",{unique:!1})}u.objectStoreNames.contains(ue.CACHED_DATA)||u.createObjectStore(ue.CACHED_DATA,{keyPath:"key"})}}),An=(r,l="readonly")=>{if(!xn)throw new Error("Database not initialized");return xn.transaction(r,l).objectStore(r)},gl=async(r,l)=>(await Na(),new Promise((i,s)=>{const d=An(r,"readwrite").put(l);d.onsuccess=()=>i(d.result),d.onerror=()=>s(d.error)})),Qm=async(r,l)=>(await Na(),new Promise((i,s)=>{const u=xn.transaction(r,"readwrite"),d=u.objectStore(r);l.forEach(m=>d.put(m)),u.oncomplete=()=>i(),u.onerror=()=>s(u.error)})),Xm=async(r,l)=>(await Na(),new Promise((i,s)=>{const d=An(r).get(l);d.onsuccess=()=>i(d.result),d.onerror=()=>s(d.error)})),Vm=async r=>(await Na(),new Promise((l,i)=>{const u=An(r).getAll();u.onsuccess=()=>l(u.result||[]),u.onerror=()=>i(u.error)})),Sc=async(r,l,i)=>(await Na(),new Promise((s,u)=>{const g=An(r).index(l).getAll(i);g.onsuccess=()=>s(g.result||[]),g.onerror=()=>u(g.error)})),Kg=async(r,l)=>(await Na(),new Promise((i,s)=>{const d=An(r,"readwrite").delete(l);d.onsuccess=()=>i(),d.onerror=()=>s(d.error)})),Ge={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},zt=async(r,l,i={})=>{await Na();const s={type:r,payload:l,metadata:i,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((u,d)=>{const g=An(ue.PENDING_ACTIONS,"readwrite").add(s);g.onsuccess=()=>{u(g.result)},g.onerror=()=>d(g.error)})},Zm=async()=>Vm(ue.PENDING_ACTIONS),Yi=async()=>(await Zm()).length,Am=async r=>Kg(ue.PENDING_ACTIONS,r),Jg=async(r,l)=>(await Na(),new Promise((i,s)=>{const u=An(ue.PENDING_ACTIONS,"readwrite"),d=u.get(r);d.onsuccess=()=>{const m=d.result;if(m){const g={...m,...l},b=u.put(g);b.onsuccess=()=>i(g),b.onerror=()=>s(b.error)}else s(new Error("Action not found"))},d.onerror=()=>s(d.error)})),$g=async r=>Qm(ue.PROJECTS,r),Nm=async r=>r?Sc(ue.PROJECTS,"company_id",r):Vm(ue.PROJECTS),Fg=async r=>{const l=r.map(i=>Qg(i,["status","weight","name"]));return Qm(ue.AREAS,l)},Om=async r=>Sc(ue.AREAS,"project_id",r),cc=async(r,l)=>{const i=await Xm(ue.AREAS,r);return i&&(i.status=l,i.updated_at=new Date().toISOString(),i._offlineModifiedAt=new Date().toISOString(),await gl(ue.AREAS,i)),i},Ri=async r=>gl(ue.CREW_CHECKINS,r),Mm=async r=>gl(ue.TM_TICKETS,r),Et=()=>{const r=new Uint8Array(6);crypto.getRandomValues(r);const l=Array.from(r,i=>i.toString(36)).join("");return`temp_${Date.now()}_${l}`},gr=async r=>gl(ue.DAILY_REPORTS,r),Wg=async(r,l)=>(await Sc(ue.DAILY_REPORTS,"project_id",r)).find(s=>s.report_date===l)||null,zm=async r=>gl(ue.MESSAGES,r);let wc=typeof navigator<"u"?navigator.onLine:!0;const pc=new Set,jc=r=>(pc.add(r),()=>pc.delete(r)),Kt=()=>wc,Rm=r=>{wc=r,pc.forEach(l=>l(r))};typeof window<"u"&&(window.addEventListener("online",()=>{Rm(!0)}),window.addEventListener("offline",()=>{Rm(!1)}));let uc=!1;const Km=async(r,l={})=>{if(uc||!wc)return{synced:0,failed:0,conflicts:[]};const{onConflict:i}=l;uc=!0;const s={synced:0,failed:0,conflicts:[]};try{const u=await Zm();for(const d of u)try{if(d.payload?.id&&d.type===Ge.UPDATE_AREA_STATUS){const m=await Pg(r,d.type,d.payload);if(m){const g=await Xm(ue.AREAS,d.payload.areaId||d.payload.id);if(g){const b=Yg(g,m,["status"]);if(b.hasConflict){const x=Xg(b,"area");if(s.conflicts.push({action:d,conflict:b,summary:x}),i&&await i({action:d,conflict:b,summary:x})===Gg.KEEP_SERVER){await Am(d.id);continue}}}}}await Ig(d,r),await Am(d.id),s.synced++}catch(m){s.failed++,await Jg(d.id,{attempts:(d.attempts||0)+1,last_error:m.message,last_attempt:new Date().toISOString()})}}finally{uc=!1}return s},Pg=async(r,l,i)=>{try{switch(l){case Ge.UPDATE_AREA_STATUS:return r.getArea?await r.getArea(i.areaId):null;default:return null}}catch{return null}},Ig=async(r,l)=>{const{type:i,payload:s}=r;switch(i){case Ge.UPDATE_AREA_STATUS:return l.updateAreaStatus(s.areaId,s.status);case Ge.CREATE_TM_TICKET:{const u=await l.createTMTicket(s.ticket);return s.workers?.length>0&&await l.addTMWorkers(u.id,s.workers),s.items?.length>0&&await l.addTMItems(u.id,s.items),u}case Ge.SAVE_CREW_CHECKIN:return l.saveCrewCheckin(s.projectId,s.workers,s.checkInDate);case Ge.SUBMIT_DAILY_REPORT:return await l.saveDailyReport(s.projectId,s.reportData),l.submitDailyReport(s.projectId,s.submittedBy);case Ge.SEND_MESSAGE:return l.sendMessage(s.projectId,s.senderType,s.senderName,s.content);case Ge.CREATE_MATERIAL_REQUEST:return l.createMaterialRequest(s.projectId,s.items,s.requestedBy,s.neededBy,s.priority,s.notes);default:throw new Error(`Unknown action type: ${i}`)}},Ec="",Jm="",y=!!Ec,h=y?Gm(Ec,Jm):null,Ui={slowQueryThreshold:200,enableSupabase:y},w={query(r,l){const i={type:"query",operation:r,duration_ms:l.duration,rows_returned:l.rows,company_id:l.company_id||null,project_id:l.project_id||null,user_id:l.user_id||null,timestamp:new Date().toISOString()};Ui.enableSupabase&&l.duration>=Ui.slowQueryThreshold&&dc("query",i)},error(r,l){const i={type:"error",category:r,severity:l.severity||"error",error_code:l.code||null,message:l.message,company_id:l.company_id||null,user_id:l.user_id||null,project_id:l.project_id||null,operation:l.operation||null,context:l.extra||{},timestamp:new Date().toISOString()};Ui.enableSupabase&&dc("error",i)},storage(r,l){const i={type:"storage",operation:r,company_id:l.company_id||null,project_id:l.project_id||null,file_size_bytes:l.size||0,duration_ms:l.duration||0,success:l.success!==!1,error_message:l.error||null,timestamp:new Date().toISOString()};Ui.enableSupabase&&(!i.success||i.duration_ms>5e3)&&dc("storage",i)},activity(r,l){}};async function dc(r,l){if(h)try{r==="error"?await h.rpc("log_error",{p_severity:l.severity,p_category:l.category,p_message:l.message,p_company_id:l.company_id,p_user_id:l.user_id,p_project_id:l.project_id,p_operation:l.operation,p_error_code:l.error_code,p_context:l.context||{}}):r==="query"&&await h.rpc("log_query_metric",{p_operation:l.operation,p_duration_ms:l.duration_ms,p_rows_returned:l.rows_returned,p_company_id:l.company_id,p_project_id:l.project_id,p_user_id:l.user_id,p_context:{}})}catch{}}w.wrapQuery=function(r,l){return async function(...i){const s=performance.now();try{const u=await l.apply(this,i),m={duration:Math.round(performance.now()-s),rows:Array.isArray(u)?u.length:void 0};return w.query(r,m),u}catch(u){const d=Math.round(performance.now()-s);throw w.error("database",{message:u.message,operation:r,severity:"error",extra:{duration:d}}),u}}};w.time=async function(r,l){const i=performance.now();try{const s=await l(),u=Math.round(performance.now()-i);return w.query(r,{duration:u}),s}catch(s){throw w.error("general",{message:s.message,operation:r}),s}};const gc="fieldsync_field_session";let _l=null;const Nn=()=>{if(_l)return _l;try{const r=sessionStorage.getItem(gc);if(r)return _l=JSON.parse(r),_l}catch{}return null},Gi=r=>{_l=r,r?sessionStorage.setItem(gc,JSON.stringify(r)):sessionStorage.removeItem(gc)},hc=async()=>{const r=Nn();if(r?.token&&y)try{await h.rpc("invalidate_field_session",{p_session_token:r.token})}catch{}Gi(null)};let fl=null;const qc=()=>{const r=Nn();return!r?.token||!y?h:((!fl||fl._sessionToken!==r.token)&&(fl=Gm(Ec,Jm,{global:{headers:{"x-field-session":r.token}}}),fl._sessionToken=r.token),fl)},yc=()=>Nn()?.token?qc():h,L=()=>y?Nn()?.token?qc():h:null,bc=()=>{const r=Nn();return!!(r?.token&&r?.projectId)},eh=()=>Nn()?.projectId||null,th=()=>Nn()?.companyId||null,vc="fieldsync_data",Xi="fieldsync_user",Um={projects:[],areas:[],users:[],assignments:[]},Q=()=>{try{const r=localStorage.getItem(vc);return r?JSON.parse(r):Um}catch{return localStorage.removeItem(vc),Um}},te=r=>{localStorage.setItem(vc,JSON.stringify(r))},ki=()=>{try{const r=localStorage.getItem(Xi);return r?JSON.parse(r):null}catch{return localStorage.removeItem(Xi),null}},Bi=r=>{r?localStorage.setItem(Xi,JSON.stringify(r)):localStorage.removeItem(Xi)},ah={async createCOR(r,l=0){if(y){let i=r.cor_number;l>0&&(i=await this.getNextCORNumber(r.project_id));const{data:s,error:u}=await h.from("change_orders").insert({company_id:r.company_id,project_id:r.project_id,area_id:r.area_id||null,cor_number:i,title:r.title,description:r.description||"",scope_of_work:r.scope_of_work,period_start:r.period_start,period_end:r.period_end,status:"draft",labor_markup_percent:r.labor_markup_percent??1500,materials_markup_percent:r.materials_markup_percent??1500,equipment_markup_percent:r.equipment_markup_percent??1500,subcontractors_markup_percent:r.subcontractors_markup_percent??500,liability_insurance_percent:r.liability_insurance_percent??144,bond_percent:r.bond_percent??100,license_fee_percent:r.license_fee_percent??10,created_by:r.created_by||null}).select().single();if((u?.code==="23505"||u?.code==="PGRST116"||u?.status===409||u?.message?.includes("duplicate")||u?.message?.includes("unique_cor_number"))&&l<3)return w.error("database",{message:`COR number conflict, retrying (attempt ${l+1})`,severity:"warning",operation:"createCOR"}),this.createCOR(r,l+1);if(u)throw u;return s}return null},async updateCOR(r,l){if(y){const{data:i,error:s}=await h.from("change_orders").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(s)throw s;return i}return null},async deleteCOR(r){if(y){const{error:l}=await h.from("change_orders").delete().eq("id",r);if(l)throw l}},async bulkUpdateCORGroup(r,l){if(y){const{error:i}=await h.from("change_orders").update({group_name:l,updated_at:new Date().toISOString()}).in("id",r);if(i)throw i.message?.includes("group_name")||i.code==="PGRST204"?new Error("COR grouping requires a database migration. Please run database/migration_cor_enhancements.sql in Supabase SQL Editor."):i}},async getCORs(r,l={}){if(y){let i=h.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",r);l.status&&(i=i.eq("status",l.status)),l.area_id&&(i=i.eq("area_id",l.area_id)),l.date_start&&(i=i.gte("period_start",l.date_start)),l.date_end&&(i=i.lte("period_end",l.date_end)),i=i.order("created_at",{ascending:!1});const{data:s,error:u}=await i;if(u)throw u;return s}return[]},async getCORById(r){if(y){const{data:l,error:i}=await h.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              *,
              t_and_m_workers (*),
              t_and_m_items (
                *,
                materials_equipment (name, unit, cost_per_unit, category)
              )
            )
          )
        `).eq("id",r).single();if(i)throw i;return l}return null},async getCORsByArea(r,l){if(y){const{data:i,error:s}=await h.from("change_orders").select("*").eq("project_id",r).eq("area_id",l).order("created_at",{ascending:!1});if(s)throw s;return i}return[]},async getAssignableCORs(r){if(y){const l=L();if(!l)return[];const{data:i,error:s}=await l.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",r).in("status",["draft","pending_approval","approved"]).order("cor_number",{ascending:!0});if(s)throw s;return i||[]}return[]},async getNextCORNumber(r){if(y){const{data:l,error:i}=await h.from("change_orders").select("cor_number").eq("project_id",r);if(i)throw i;if(l&&l.length>0){let s=0;for(const u of l){const d=u.cor_number?.match(/COR #(\d+)/);if(d){const m=parseInt(d[1]);m>s&&(s=m)}}return`COR #${s+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(r,l){if(y){const i=Math.round(l.regular_hours*l.regular_rate),s=Math.round(l.overtime_hours*l.overtime_rate),u=i+s,{data:d,error:m}=await h.from("change_order_labor").insert({change_order_id:r,labor_class:l.labor_class,wage_type:l.wage_type||"standard",regular_hours:l.regular_hours||0,overtime_hours:l.overtime_hours||0,regular_rate:l.regular_rate||0,overtime_rate:l.overtime_rate||0,regular_total:i,overtime_total:s,total:u,sort_order:l.sort_order||0,source_ticket_id:l.source_ticket_id||null}).select().single();if(m)throw m;return d}return null},async updateCORLaborItem(r,l){if(y){const i={...l};if(l.regular_hours!==void 0||l.regular_rate!==void 0||l.overtime_hours!==void 0||l.overtime_rate!==void 0){const{data:d}=await h.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",r).single(),m=l.regular_hours??d?.regular_hours??0,g=l.overtime_hours??d?.overtime_hours??0,b=l.regular_rate??d?.regular_rate??0,x=l.overtime_rate??d?.overtime_rate??0;i.regular_total=Math.round(m*b),i.overtime_total=Math.round(g*x),i.total=i.regular_total+i.overtime_total}const{data:s,error:u}=await h.from("change_order_labor").update(i).eq("id",r).select().single();if(u)throw u;return s}return null},async deleteCORLaborItem(r){if(y){const{error:l}=await h.from("change_order_labor").delete().eq("id",r);if(l)throw l}},async addCORMaterialItem(r,l){if(y){const s=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",u=Math.round(Number(l.unit_cost)||0),d=Number(l.quantity)||1,m=Math.round(d*u),{data:g,error:b}=await h.from("change_order_materials").insert({change_order_id:r,description:l.description||"",quantity:d,unit:l.unit||"each",unit_cost:u,total:m,source_type:s,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(b)throw b;return g}return null},async updateCORMaterialItem(r,l){if(y){const i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:d}=await h.from("change_order_materials").select("quantity, unit_cost").eq("id",r).single(),m=l.quantity??d?.quantity??1,g=l.unit_cost??d?.unit_cost??0;i.total=Math.round(m*g)}const{data:s,error:u}=await h.from("change_order_materials").update(i).eq("id",r).select().single();if(u)throw u;return s}return null},async deleteCORMaterialItem(r){if(y){const{error:l}=await h.from("change_order_materials").delete().eq("id",r);if(l)throw l}},async addCOREquipmentItem(r,l){if(y){const s=["backup_sheet","invoice","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",u=Math.round(Number(l.unit_cost)||0),d=Number(l.quantity)||1,m=Math.round(d*u),{data:g,error:b}=await h.from("change_order_equipment").insert({change_order_id:r,description:l.description||"",quantity:d,unit:l.unit||"day",unit_cost:u,total:m,source_type:s,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(b)throw b;return g}return null},async updateCOREquipmentItem(r,l){if(y){const i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:d}=await h.from("change_order_equipment").select("quantity, unit_cost").eq("id",r).single(),m=l.quantity??d?.quantity??1,g=l.unit_cost??d?.unit_cost??0;i.total=Math.round(m*g)}const{data:s,error:u}=await h.from("change_order_equipment").update(i).eq("id",r).select().single();if(u)throw u;return s}return null},async deleteCOREquipmentItem(r){if(y){const{error:l}=await h.from("change_order_equipment").delete().eq("id",r);if(l)throw l}},async addCORSubcontractorItem(r,l){if(y){const i=Math.round(l.quantity*l.unit_cost),{data:s,error:u}=await h.from("change_order_subcontractors").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"lump sum",unit_cost:l.unit_cost||0,total:i,source_type:l.source_type||"custom",source_reference:l.source_reference||null,sort_order:l.sort_order||0}).select().single();if(u)throw u;return s}return null},async updateCORSubcontractorItem(r,l){if(y){const i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:d}=await h.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",r).single(),m=l.quantity??d?.quantity??1,g=l.unit_cost??d?.unit_cost??0;i.total=Math.round(m*g)}const{data:s,error:u}=await h.from("change_order_subcontractors").update(i).eq("id",r).select().single();if(u)throw u;return s}return null},async deleteCORSubcontractorItem(r){if(y){const{error:l}=await h.from("change_order_subcontractors").delete().eq("id",r);if(l)throw l}},async addBulkLaborItems(r,l){if(y&&l.length>0){const i=L();if(!i)throw new Error("Database client not available");const s=l.map((m,g)=>{const b=Math.round(m.regular_hours*m.regular_rate),x=Math.round(m.overtime_hours*m.overtime_rate);return{change_order_id:r,labor_class:m.labor_class,wage_type:m.wage_type||"standard",regular_hours:m.regular_hours||0,overtime_hours:m.overtime_hours||0,regular_rate:m.regular_rate||0,overtime_rate:m.overtime_rate||0,regular_total:b,overtime_total:x,total:b+x,sort_order:m.sort_order??g,source_ticket_id:m.source_ticket_id||null}}),{data:u,error:d}=await i.from("change_order_labor").insert(s).select();if(d)throw d;return u}return[]},async addBulkMaterialItems(r,l){if(y&&l.length>0){const i=L();if(!i)throw new Error("Database client not available");const s=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"],u=l.map((g,b)=>{const x=s.includes(g.source_type)?g.source_type:"custom",z=Math.round(Number(g.unit_cost)||0),E=Number(g.quantity)||1;return{change_order_id:r,description:g.description||"",quantity:E,unit:g.unit||"each",unit_cost:z,total:Math.round(E*z),source_type:x,source_reference:g.source_reference||null,source_ticket_id:g.source_ticket_id||null,sort_order:g.sort_order??b}}),{data:d,error:m}=await i.from("change_order_materials").insert(u).select();if(m)throw m;return d}return[]},async addBulkEquipmentItems(r,l){if(y&&l.length>0){const i=L();if(!i)throw new Error("Database client not available");const s=["backup_sheet","invoice","custom","field_ticket","rental"],u=l.map((g,b)=>{const x=s.includes(g.source_type)?g.source_type:"custom",z=Math.round(Number(g.unit_cost)||0),E=Number(g.quantity)||1;return{change_order_id:r,description:g.description||"",quantity:E,unit:g.unit||"day",unit_cost:z,total:Math.round(E*z),source_type:x,source_reference:g.source_reference||null,source_ticket_id:g.source_ticket_id||null,sort_order:g.sort_order??b}}),{data:d,error:m}=await i.from("change_order_equipment").insert(u).select();if(m)throw m;return d}return[]},async addBulkSubcontractorItems(r,l){if(y&&l.length>0){const i=L();if(!i)throw new Error("Database client not available");const s=l.map((m,g)=>({change_order_id:r,company_name:m.company_name||"",description:m.description||"",quantity:m.quantity||1,unit:m.unit||"lump sum",unit_cost:m.unit_cost||m.total||m.amount||0,total:m.total||m.amount||0,source_type:m.source_type||"invoice",source_reference:m.source_reference||null,sort_order:m.sort_order??g})),{data:u,error:d}=await i.from("change_order_subcontractors").insert(s).select();if(d)throw d;return u}return[]},async clearCORLineItems(r){if(!y)return;const l=L();if(!l)throw new Error("Database client not available");try{const i=await Promise.all([l.from("change_order_labor").delete().eq("change_order_id",r),l.from("change_order_materials").delete().eq("change_order_id",r),l.from("change_order_equipment").delete().eq("change_order_id",r),l.from("change_order_subcontractors").delete().eq("change_order_id",r)]);for(const s of i)if(s.error)throw s.error}catch(i){throw w.error("database",{message:i?.message,operation:"clearCORLineItems"}),i}},async saveCORLineItems(r,{laborItems:l,materialItems:i,equipmentItems:s,subcontractorItems:u}){if(y){await this.clearCORLineItems(r);const d=await Promise.all([l?.length>0?this.addBulkLaborItems(r,l):[],i?.length>0?this.addBulkMaterialItems(r,i):[],s?.length>0?this.addBulkEquipmentItems(r,s):[],u?.length>0?this.addBulkSubcontractorItems(r,u):[]]);return{labor:d[0],materials:d[1],equipment:d[2],subcontractors:d[3]}}return null},async assignTicketToCOR(r,l){if(y){const{error:i}=await h.rpc("assign_ticket_to_cor",{p_ticket_id:r,p_cor_id:l});if(i)throw w.error("database",{message:i.message,operation:"assignTicketToCOR",extra:{ticketId:r,corId:l}}),i;return{ticket_id:r,change_order_id:l}}return null},async unassignTicketFromCOR(r,l){if(y){const{error:i}=await h.rpc("unassign_ticket_from_cor",{p_ticket_id:r,p_cor_id:l});if(i)throw w.error("database",{message:i.message,operation:"unassignTicketFromCOR",extra:{ticketId:r,corId:l}}),i}},async checkTicketCORIntegrity(){if(y){const{data:r,error:l}=await h.rpc("check_ticket_cor_integrity");if(l)throw l;return r||[]}return[]},async fixTicketCORIntegrity(){if(y){const{data:r,error:l}=await h.rpc("fix_ticket_cor_integrity");if(l)throw l;return r}return 0},async getTicketsForCOR(r){if(y){const{data:l,error:i}=await h.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",r);if(i)throw i;return l}return[]},async getUnassignedTickets(r){if(y){const{data:l,error:i}=await h.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(i)throw i;return l}return[]},async importTicketDataToCOR(r,l,i,s,u){if(y){const d=L();if(!d)throw new Error("Database client not available");const{data:m,error:g}=await d.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",r).single();if(g)throw g;const{data:b,error:x}=await d.from("labor_rates").select("*").eq("company_id",i).eq("work_type",s||"demolition").eq("job_type",u||"standard");if(x)throw x;const z={};b?.forEach(G=>{z[G.role.toLowerCase()]=G});const E={};m.t_and_m_workers?.forEach(G=>{const oe=(G.role||"laborer").toLowerCase();E[oe]||(E[oe]={regular_hours:0,overtime_hours:0}),E[oe].regular_hours+=parseFloat(G.hours)||0,E[oe].overtime_hours+=parseFloat(G.overtime_hours)||0});const k=Object.entries(E).map(([G,oe])=>{const Ee=z[G]||{regular_rate:0,overtime_rate:0},ve=Math.round((parseFloat(Ee.regular_rate)||0)*100),P=Math.round((parseFloat(Ee.overtime_rate)||0)*100);return{labor_class:G.charAt(0).toUpperCase()+G.slice(1),wage_type:u||"standard",regular_hours:oe.regular_hours,overtime_hours:oe.overtime_hours,regular_rate:ve,overtime_rate:P,source_ticket_id:r}});k.length>0&&await this.addBulkLaborItems(l,k);const X=[],H=[];m.t_and_m_items?.forEach(G=>{const oe=G.custom_name||G.materials_equipment?.name||"Unknown Item",Ee=G.custom_category||G.materials_equipment?.category||"Other",ve=G.materials_equipment?.unit||"each",P=Math.round((parseFloat(G.materials_equipment?.cost_per_unit)||0)*100),_e={description:oe,quantity:G.quantity||1,unit:ve,unit_cost:P,source_type:"backup_sheet",source_ticket_id:r};Ee==="Equipment"?H.push(_e):X.push(_e)}),X.length>0&&await this.addBulkMaterialItems(l,X),H.length>0&&await this.addBulkEquipmentItems(l,H);const{error:Y}=await d.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString(),import_status:"completed",import_failed_at:null,import_error:null}).eq("change_order_id",l).eq("ticket_id",r);if(Y)throw Y;return w.activity("cor_import_success",{ticket_id:r,cor_id:l,labor_count:k.length,material_count:X.length,equipment_count:H.length}),{laborItems:k,materialItems:X,equipmentItems:H}}return null},async reimportTicketDataToCOR(r,l,i,s,u){if(y){const d=L();if(!d)throw new Error("Database client not available");return await d.from("change_order_labor").delete().eq("change_order_id",l).eq("source_ticket_id",r),await d.from("change_order_materials").delete().eq("change_order_id",l).eq("source_ticket_id",r),await d.from("change_order_equipment").delete().eq("change_order_id",l).eq("source_ticket_id",r),this.importTicketDataToCOR(r,l,i,s,u)}return null},async markImportFailed(r,l,i="Import failed"){if(y){const s=L();if(!s)throw new Error("Database client not available");const{error:u}=await s.from("change_order_ticket_associations").update({import_status:"failed",import_failed_at:new Date().toISOString(),import_error:i}).eq("change_order_id",l).eq("ticket_id",r);if(u)throw w.error("database",{message:u.message,operation:"markImportFailed",extra:{ticketId:r,corId:l}}),u;w.error("cor_import_failed",{ticket_id:r,cor_id:l,error:i})}},async getTicketsNeedingImport(r){if(y){const{data:l,error:i}=await h.from("t_and_m_tickets").select(`
          id,
          work_date,
          ce_pco_number,
          assigned_cor_id,
          change_order_ticket_associations!inner (
            change_order_id,
            import_status,
            import_failed_at,
            import_error
          )
        `).eq("project_id",r).eq("change_order_ticket_associations.import_status","failed");if(i)throw i;return l||[]}return[]},async getTicketImportStatus(r,l){if(y){const{data:i,error:s}=await h.from("change_order_ticket_associations").select("import_status, import_failed_at, import_error, data_imported").eq("ticket_id",r).eq("change_order_id",l).single();if(s&&s.code!=="PGRST116")throw s;return i}return null},async recalculateCOR(r){if(y){const{error:l}=await h.rpc("recalculate_cor_totals",{cor_id:r});if(l)throw l;return this.getCORById(r)}return null},async updateCORMarkupPercentages(r,l){if(y){const i={};l.labor!==void 0&&(i.labor_markup_percent=l.labor),l.materials!==void 0&&(i.materials_markup_percent=l.materials),l.equipment!==void 0&&(i.equipment_markup_percent=l.equipment),l.subcontractors!==void 0&&(i.subcontractors_markup_percent=l.subcontractors);const{data:s,error:u}=await h.from("change_orders").update(i).eq("id",r).select().single();if(u)throw u;return s}return null},async updateCORFeePercentages(r,l){if(y){const i={};l.liabilityInsurance!==void 0&&(i.liability_insurance_percent=l.liabilityInsurance),l.bond!==void 0&&(i.bond_percent=l.bond),l.licenseFee!==void 0&&(i.license_fee_percent=l.licenseFee);const{data:s,error:u}=await h.from("change_orders").update(i).eq("id",r).select().single();if(u)throw u;return s}return null},async submitCORForApproval(r){if(y){const{data:l,error:i}=await h.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return l}return null},async approveCOR(r,l){if(y){const{data:i,error:s}=await h.from("change_orders").update({status:"approved",approved_by:l,approved_at:new Date().toISOString()}).eq("id",r).select().single();if(s)throw s;return i}return null},async rejectCOR(r,l=null){if(y){const{data:i,error:s}=await h.from("change_orders").update({status:"rejected",rejection_reason:l}).eq("id",r).select().single();if(s)throw s;return i}return null},async markCORAsBilled(r){if(y){const{data:l,error:i}=await h.from("change_orders").update({status:"billed"}).eq("id",r).select().single();if(i)throw i;return l}return null},async closeCOR(r){if(y){const{data:l,error:i}=await h.from("change_orders").update({status:"closed"}).eq("id",r).select().single();if(i)throw i;return l}return null},async saveCORSignature(r,l,i){if(y){const{data:s,error:u}=await h.from("change_orders").update({gc_signature_data:l,gc_signature_name:i,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",r).select().single();if(u)throw u;return s}return null},async getCORStats(r){if(y){const{data:l,error:i}=await h.from("change_orders").select("status, cor_total").eq("project_id",r);if(i)throw i;const s={total_cors:l.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return l.forEach(u=>{switch(u.status){case"draft":s.draft_count++;break;case"pending_approval":s.pending_count++,s.total_pending_value+=u.cor_total||0;break;case"approved":s.approved_count++,s.total_approved_value+=u.cor_total||0;break;case"rejected":s.rejected_count++;break;case"billed":case"closed":s.billed_count++,s.total_billed_value+=u.cor_total||0;break}}),s}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(r,l){return y?h.channel(`change_orders:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCorTickets(r,l){return y?h.channel(`cor-tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${r}`},l).subscribe():null},async getCORLog(r){if(y){const{data:l,error:i}=await h.from("cor_log_entries").select(`
          id,
          log_number,
          date_sent_to_client,
          ce_number,
          comments,
          created_at,
          updated_at,
          change_order:change_orders (
            id,
            cor_number,
            title,
            cor_total,
            status,
            created_at,
            approved_at,
            approved_by
          )
        `).eq("project_id",r).order("log_number",{ascending:!0});if(i)throw w.error("database",{message:i?.message,operation:"getCORLog"}),i;return(l||[]).map(s=>({id:s.id,logNumber:s.log_number,dateSentToClient:s.date_sent_to_client,ceNumber:s.ce_number,comments:s.comments,createdAt:s.created_at,updatedAt:s.updated_at,changeOrder:{id:s.change_order?.id,corNumber:s.change_order?.cor_number,title:s.change_order?.title,corTotal:s.change_order?.cor_total,status:s.change_order?.status,createdAt:s.change_order?.created_at,approvedAt:s.change_order?.approved_at,approvedBy:s.change_order?.approved_by}}))}return[]},async updateCORLogEntry(r,l){if(y){const i={updated_at:new Date().toISOString()};l.dateSentToClient!==void 0&&(i.date_sent_to_client=l.dateSentToClient||null),l.ceNumber!==void 0&&(i.ce_number=l.ceNumber||null),l.comments!==void 0&&(i.comments=l.comments||null);const{data:s,error:u}=await h.from("cor_log_entries").update(i).eq("id",r).select().single();if(u)throw w.error("database",{message:u?.message,operation:"updateCORLogEntry"}),u;return s}return null},async updateChangeOrderStatus(r,l){if(y){const{data:i,error:s}=await h.from("change_orders").update({status:l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(s)throw w.error("database",{message:s?.message,operation:"updateChangeOrderStatus"}),s;return i}return null},subscribeToCORLog(r,l){return y?h.channel(`cor-log:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"cor_log_entries",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToDocuments(r,l){return y?h.channel(`documents:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"documents",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToDocumentFolders(r,l){return y?h.channel(`document_folders:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"document_folders",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMaterialsEquipment(r,l){return y?h.channel(`materials_equipment:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"materials_equipment",filter:`company_id=eq.${r}`},l).subscribe():null},subscribeToLaborRates(r,l){return y?h.channel(`labor_rates:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"labor_rates",filter:`company_id=eq.${r}`},l).subscribe():null},subscribeToProject(r,l){return y?h.channel(`project:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"projects",filter:`id=eq.${r}`},l).subscribe():null},subscribeToPunchList(r,l){return y?h.channel(`punch_list:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"punch_list_items",filter:`project_id=eq.${r}`},l).subscribe():null},async createSignatureRequest(r,l,i,s,u=null,d=null){if(y){const m=L();if(!m)throw new Error("Database client not available");const{data:g,error:b}=await m.rpc("generate_signature_token");if(b)throw b;const{data:x,error:z}=await m.from("signature_requests").insert({document_type:r,document_id:l,company_id:i,project_id:s,signature_token:g,expires_at:d,created_by:u}).select().single();if(z)throw z;return x}return null},async getSignatureRequestByToken(r){if(y){const l=L();if(!l)throw new Error("Database client not available");await l.rpc("increment_signature_view_count",{token:r});const{data:i,error:s}=await l.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",r).single();if(s)throw s;return i}return null},async getSignatureRequestsForDocument(r,l){if(y){const i=L();if(!i)throw new Error("Database client not available");const{data:s,error:u}=await i.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",r).eq("document_id",l).order("created_at",{ascending:!1});if(u)throw u;return s||[]}return[]},async addSignature(r,l,i){if(y){const s=L();if(!s)throw new Error("Database client not available");const{data:u,error:d}=await s.from("signatures").insert({signature_request_id:r,signature_slot:l,signature_image:i.signature,signer_name:i.signerName,signer_title:i.signerTitle||null,signer_company:i.signerCompany||null,signed_at:i.signedAt||new Date().toISOString(),ip_address:i.ipAddress||null,user_agent:i.userAgent||null}).select().single();if(d)throw d;return u}return null},async syncSignatureToDocument(r,l){if(!y)return null;const i=L();if(!i)throw new Error("Database client not available");const{document_type:s,document_id:u}=l,d=r.signature_slot,m={};d===1?(m.gc_signature_data=r.signature_image,m.gc_signature_name=r.signer_name,m.gc_signature_title=r.signer_title,m.gc_signature_company=r.signer_company,m.gc_signature_date=r.signed_at,m.gc_signature_ip=r.ip_address):d===2&&(m.client_signature_data=r.signature_image,m.client_signature_name=r.signer_name,m.client_signature_title=r.signer_title,m.client_signature_company=r.signer_company,m.client_signature_date=r.signed_at,m.client_signature_ip=r.ip_address);const g=s==="cor"?"change_orders":"t_and_m_tickets",{data:b,error:x}=await i.from(g).update(m).eq("id",u).select().single();if(x)throw x;return b},async revokeSignatureRequest(r){if(y){const l=L();if(!l)throw new Error("Database client not available");const{data:i,error:s}=await l.from("signature_requests").update({status:"revoked"}).eq("id",r).select().single();if(s)throw s;return i}return null},async getDocumentForSigning(r,l){if(!y)return null;const i=L();if(!i)throw new Error("Database client not available");if(r==="cor"){const{data:s,error:u}=await i.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",l).single();if(u)throw u;return s}else if(r==="tm_ticket"){const{data:s,error:u}=await i.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (
              id,
              name,
              unit,
              cost_per_unit,
              category
            )
          )
        `).eq("id",l).single();if(u)throw u;return s}return null},async getProjectCosts(r){if(y){const{data:i,error:s}=await h.from("project_costs").select("*").eq("project_id",r).order("cost_date",{ascending:!1});return s?(w.error("database",{message:s?.message,operation:"getProjectCosts"}),[]):i||[]}return(Q().projectCosts||[]).filter(i=>i.project_id===r).sort((i,s)=>new Date(s.cost_date)-new Date(i.cost_date))},async addProjectCost(r,l,i){const s={project_id:r,company_id:l,category:i.category,description:i.description,amount:parseFloat(i.amount),cost_date:i.cost_date||new Date().toISOString().split("T")[0],notes:i.notes||null,created_by:i.created_by||null};if(y){const{data:m,error:g}=await h.from("project_costs").insert(s).select().single();if(g)throw w.error("database",{message:g?.message,operation:"addProjectCost"}),g;return m}const u=Q();u.projectCosts||(u.projectCosts=[]);const d={...s,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return u.projectCosts.push(d),te(u),d},async updateProjectCost(r,l){const i={category:l.category,description:l.description,amount:parseFloat(l.amount),cost_date:l.cost_date,notes:l.notes||null,updated_at:new Date().toISOString()};if(y){const{data:d,error:m}=await h.from("project_costs").update(i).eq("id",r).select().single();if(m)throw w.error("database",{message:m?.message,operation:"updateProjectCost"}),m;return d}const s=Q();if(!s.projectCosts)return null;const u=s.projectCosts.findIndex(d=>d.id===r);return u===-1?null:(s.projectCosts[u]={...s.projectCosts[u],...i},te(s),s.projectCosts[u])},async deleteProjectCost(r){if(y){const{error:i}=await h.from("project_costs").delete().eq("id",r);if(i)throw w.error("database",{message:i?.message,operation:"deleteProjectCost"}),i;return!0}const l=Q();return l.projectCosts&&(l.projectCosts=l.projectCosts.filter(i=>i.id!==r),te(l)),!0},async getProjectCostsSummary(r){const l=await this.getProjectCosts(r),i={};let s=0;return l.forEach(u=>{const d=parseFloat(u.amount)||0;s+=d,i[u.category]||(i[u.category]={category:u.category,total:0,count:0,items:[]}),i[u.category].total+=d,i[u.category].count++,i[u.category].items.push(u)}),Object.values(i).forEach(u=>{u.percentage=s>0?u.total/s*100:0}),{totalCost:s,byCategory:i,itemCount:l.length}},async getNextInvoiceNumber(r){if(y){const{data:l,error:i}=await h.rpc("get_next_invoice_number",{p_company_id:r});return i?(w.error("database",{message:i?.message,operation:"getNextInvoiceNumber"}),this._generateLocalInvoiceNumber(r)):l}return this._generateLocalInvoiceNumber(r)},async _generateLocalInvoiceNumber(r){const i=(await this.getCompanyInvoices(r)).reduce((s,u)=>{const d=u.invoice_number?.match(/^INV-(\d+)$/);if(d){const m=parseInt(d[1],10);return m>s?m:s}return s},0);return`INV-${String(i+1).padStart(4,"0")}`},async getBillableItems(r){if(y){const{data:l,error:i}=await h.from("change_orders").select("id, cor_number, title, cor_total, status, approved_at").eq("project_id",r).eq("status","approved").order("cor_number",{ascending:!0});i&&w.error("database",{message:i?.message,operation:"getBillableCORs"});const{data:s,error:u}=await h.from("t_and_m_tickets").select("id, work_date, ce_pco_number, change_order_value, status, client_signature_date").eq("project_id",r).eq("status","approved").not("client_signature_data","is",null).order("work_date",{ascending:!0});return u&&w.error("database",{message:u?.message,operation:"getBillableTMTickets"}),{cors:l||[],tickets:s||[]}}return{cors:[],tickets:[]}},async getProjectInvoices(r){if(y){const{data:i,error:s}=await h.from("invoices").select(`
          *,
          invoice_items (*)
        `).eq("project_id",r).order("invoice_date",{ascending:!1});if(s)throw w.error("database",{message:s?.message,operation:"getProjectInvoices"}),s;return i||[]}return(Q().invoices||[]).filter(i=>i.project_id===r)},async getCompanyInvoices(r){if(y){const{data:i,error:s}=await h.from("invoices").select("*").eq("company_id",r).order("invoice_date",{ascending:!1});if(s)throw w.error("database",{message:s?.message,operation:"getCompanyInvoices"}),s;return i||[]}return(Q().invoices||[]).filter(i=>i.company_id===r)},async createInvoice(r,l){if(y){const{data:u,error:d}=await h.from("invoices").insert({project_id:r.project_id,company_id:r.company_id,invoice_number:r.invoice_number,invoice_date:r.invoice_date,due_date:r.due_date,status:r.status||"draft",retention_percent:r.retention_percent||0,bill_to_name:r.bill_to_name,bill_to_address:r.bill_to_address,bill_to_contact:r.bill_to_contact,notes:r.notes,terms:r.terms||"Net 30",created_by:r.created_by}).select().single();if(d)throw w.error("database",{message:d?.message,operation:"createInvoice"}),d;if(l&&l.length>0){const m=l.map((b,x)=>({invoice_id:u.id,item_type:b.item_type,reference_id:b.reference_id,reference_number:b.reference_number,description:b.description,amount:b.amount,sort_order:x})),{error:g}=await h.from("invoice_items").insert(m);if(g)throw w.error("database",{message:g?.message,operation:"createInvoiceItems"}),await h.from("invoices").delete().eq("id",u.id),g}return this.getInvoice(u.id)}const i=Q();i.invoices||(i.invoices=[]);const s={...r,id:Et(),created_at:new Date().toISOString(),invoice_items:l||[]};return i.invoices.push(s),te(i),s},async getInvoice(r){if(y){const{data:i,error:s}=await h.from("invoices").select(`
          *,
          invoice_items (*)
        `).eq("id",r).single();if(s)throw w.error("database",{message:s?.message,operation:"getInvoice"}),s;return i}return(Q().invoices||[]).find(i=>i.id===r)},async updateInvoice(r,l){if(y){const{data:u,error:d}=await h.from("invoices").update(l).eq("id",r).select().single();if(d)throw w.error("database",{message:d?.message,operation:"updateInvoice"}),d;return u}const i=Q(),s=(i.invoices||[]).findIndex(u=>u.id===r);return s>=0?(i.invoices[s]={...i.invoices[s],...l},te(i),i.invoices[s]):null},async markInvoiceSent(r){return this.updateInvoice(r,{status:"sent",sent_at:new Date().toISOString()})},async recordInvoicePayment(r,l){const i=await this.getInvoice(r);if(!i)throw new Error("Invoice not found");const s=(i.amount_paid||0)+l,u=s>=i.total;return this.updateInvoice(r,{amount_paid:s,status:u?"paid":"partial",paid_at:u?new Date().toISOString():null})},async deleteInvoice(r){if(y){const{error:i}=await h.from("invoices").delete().eq("id",r).eq("status","draft");if(i)throw w.error("database",{message:i?.message,operation:"deleteInvoice"}),i;return!0}const l=Q();return l.invoices=(l.invoices||[]).filter(i=>i.id!==r),te(l),!0},async markItemsBilled(r=[],l=[]){if(y){if(r.length>0){const{error:i}=await h.from("change_orders").update({status:"billed"}).in("id",r);i&&w.error("database",{message:i?.message,operation:"markCORsAsBilled"})}if(l.length>0){const{error:i}=await h.from("t_and_m_tickets").update({status:"billed"}).in("id",l);i&&w.error("database",{message:i?.message,operation:"markTMTicketsAsBilled"})}}}},nh={async getCompanyEquipment(r,l=!0){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),[];let i=h.from("equipment").select("*").eq("company_id",r).order("name");l&&(i=i.eq("is_active",!0));const{data:s,error:u}=await i;return u?(w.error("database",{message:u?.message,operation:"getCompanyEquipment"}),[]):s||[]},async createEquipment(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),null;const{data:l,error:i}=await h.from("equipment").insert(r).select().single();if(i)throw w.error("database",{message:i?.message,operation:"createEquipment"}),i;return l},async updateEquipment(r,l){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),null;const{data:i,error:s}=await h.from("equipment").update(l).eq("id",r).select().single();if(s)throw w.error("database",{message:s?.message,operation:"updateEquipment"}),s;return i},async deactivateEquipment(r){return this.updateEquipment(r,{is_active:!1})},async getProjectEquipment(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),[];const{data:l,error:i}=await h.from("project_equipment").select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).eq("project_id",r).order("start_date",{ascending:!1});return i?(w.error("database",{message:i?.message,operation:"getProjectEquipment"}),[]):l||[]},async getActiveProjectEquipment(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),[];const{data:l,error:i}=await h.from("project_equipment").select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).eq("project_id",r).is("end_date",null).order("start_date",{ascending:!1});return i?(w.error("database",{message:i?.message,operation:"getActiveProjectEquipment"}),[]):l||[]},async addEquipmentToProject(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),null;const{data:l,error:i}=await h.from("project_equipment").insert(r).select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).single();if(i)throw w.error("database",{message:i?.message,operation:"addEquipmentToProject"}),i;return l},async updateProjectEquipment(r,l){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),null;const{data:i,error:s}=await h.from("project_equipment").update(l).eq("id",r).select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).single();if(s)throw w.error("database",{message:s?.message,operation:"updateProjectEquipment"}),s;return i},async markEquipmentReturned(r,l=null){return this.updateProjectEquipment(r,{end_date:l||new Date().toISOString().split("T")[0]})},async removeEquipmentFromProject(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),!1;const{error:l}=await h.from("project_equipment").delete().eq("id",r);if(l)throw w.error("database",{message:l?.message,operation:"removeProjectEquipment"}),l;return!0},calculateProjectEquipmentCost(r){const l=new Date;return l.setHours(0,0,0,0),r.reduce((i,s)=>{const u=new Date(s.start_date);u.setHours(0,0,0,0);let d;s.end_date?(d=new Date(s.end_date),d.setHours(0,0,0,0)):d=l;const m=Math.max(1,Math.floor((d-u)/(1e3*60*60*24))+1);return i+s.daily_rate*m},0)},calculateDaysOnSite(r,l=null){const i=new Date(r);i.setHours(0,0,0,0);let s;return l?s=new Date(l):s=new Date,s.setHours(0,0,0,0),Math.max(1,Math.floor((s-i)/(1e3*60*60*24))+1)}},rh={async getNextDrawNumber(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),1;const{data:l,error:i}=await h.from("draw_requests").select("draw_number").eq("project_id",r).order("draw_number",{ascending:!1}).limit(1).single();return i&&i.code!=="PGRST116"&&w.error("database",{message:i?.message,operation:"getNextDrawNumber"}),(l?.draw_number||0)+1},async getPreviousBillingTotals(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),{totalBilled:0,totalRetention:0};const{data:l,error:i}=await h.from("draw_requests").select("current_billing, retention_held").eq("project_id",r).in("status",["submitted","approved","paid"]);if(i)return w.error("database",{message:i?.message,operation:"getPreviousBillingTotals"}),{totalBilled:0,totalRetention:0};const s=(l||[]).reduce((d,m)=>d+(m.current_billing||0),0),u=l?.length>0?Math.max(...l.map(d=>d.retention_held||0)):0;return{totalBilled:s,totalRetention:u}},async getProjectDrawRequests(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),[];const{data:l,error:i}=await h.from("draw_requests").select("*").eq("project_id",r).order("draw_number",{ascending:!1});return i?(w.error("database",{message:i?.message,operation:"getDrawRequests"}),[]):l||[]},async getDrawRequest(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),null;const{data:l,error:i}=await h.from("draw_requests").select(`
        *,
        draw_request_items (
          *
        )
      `).eq("id",r).single();return i?(w.error("database",{message:i?.message,operation:"getDrawRequest"}),null):l},async createDrawRequest(r,l){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),null;const{data:i,error:s}=await h.from("draw_requests").insert(r).select().single();if(s)throw w.error("database",{message:s?.message,operation:"createDrawRequest"}),s;if(l&&l.length>0){const u=l.map((m,g)=>({...m,draw_request_id:i.id,sort_order:g})),{error:d}=await h.from("draw_request_items").insert(u);d&&w.error("database",{message:d?.message,operation:"createDrawRequestItems"})}return this.getDrawRequest(i.id)},async updateDrawRequest(r,l){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),null;const{data:i,error:s}=await h.from("draw_requests").update(l).eq("id",r).select().single();if(s)throw w.error("database",{message:s?.message,operation:"updateDrawRequest"}),s;return i},async updateDrawRequestStatus(r,l){const i={status:l};return l==="submitted"?i.submitted_at=new Date().toISOString():l==="approved"?i.approved_at=new Date().toISOString():l==="paid"&&(i.paid_at=new Date().toISOString()),this.updateDrawRequest(r,i)},async updateDrawRequestItems(r,l){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),!1;const{error:i}=await h.from("draw_request_items").delete().eq("draw_request_id",r);if(i)throw w.error("database",{message:i?.message,operation:"updateDrawRequestItems"}),i;if(l&&l.length>0){const s=l.map((d,m)=>({...d,draw_request_id:r,sort_order:m})),{error:u}=await h.from("draw_request_items").insert(s);if(u)throw w.error("database",{message:u?.message,operation:"insertDrawRequestItems"}),u}return!0},async deleteDrawRequest(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),!1;const{error:l}=await h.from("draw_requests").delete().eq("id",r);if(l)throw w.error("database",{message:l?.message,operation:"deleteDrawRequest"}),l;return!0},async getScheduleOfValues(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),[];const{data:l,error:i}=await h.from("areas").select("id, name, square_footage, price_per_sqft").eq("project_id",r).order("created_at");return i?(w.error("database",{message:i?.message,operation:"getScheduleOfValues"}),[]):(l||[]).map((s,u)=>({area_id:s.id,item_number:String(u+1),description:s.name,scheduled_value:Math.round((s.square_footage||0)*(s.price_per_sqft||0)*100)}))},async getPreviousDrawItems(r){if(!y)return w.error("general",{message:"Supabase not configured",severity:"warning"}),{};const{data:l,error:i}=await h.from("draw_requests").select("id").eq("project_id",r).in("status",["submitted","approved","paid"]).order("draw_number",{ascending:!1}).limit(1).single();if(i&&i.code!=="PGRST116")return w.error("database",{message:i?.message,operation:"getPreviousDrawData"}),{};if(!l)return{};const{data:s,error:u}=await h.from("draw_request_items").select("area_id, total_percent, total_amount").eq("draw_request_id",l.id);return u?(w.error("database",{message:u?.message,operation:"getPreviousDrawItems"}),{}):(s||[]).reduce((d,m)=>(m.area_id&&(d[m.area_id]={previous_percent:m.total_percent||0,previous_amount:m.total_amount||0}),d),{})},calculatePercentFromAmount(r,l){return!l||l===0?0:Math.round(r/l*1e4)},calculateAmountFromPercent(r,l){return Math.round(r/1e4*l)}};typeof window<"u"&&Na().catch(r=>w.error("database",{message:r?.message||"Failed to init offline DB",operation:"initOfflineDB"}));const fc=()=>{const r="fieldsync_device_id";let l=localStorage.getItem(r);return l||(l=crypto.randomUUID(),localStorage.setItem(r,l)),l},Qi={async signUp(r,l,i,s){if(y){const{data:u,error:d}=await h.auth.signUp({email:r,password:l,options:{data:{name:i,role:s}}});if(d)throw d;return u}else{const u=Q(),d={id:crypto.randomUUID(),email:r,name:i,role:s,created_at:new Date().toISOString()};return u.users.push(d),te(u),Bi(d),{user:d}}},async signIn(r,l){if(y){const{data:i,error:s}=await h.auth.signInWithPassword({email:r,password:l});if(s)throw s;return i}else{const s=Q().users.find(u=>u.email===r);if(!s)throw new Error("User not found");return Bi(s),{user:s}}},async signOut(){if(y){const{error:r}=await h.auth.signOut();if(r)throw r}else Bi(null)},async getUser(){if(y){const{data:{user:r}}=await h.auth.getUser();return r}else return ki()},async getProfile(){if(y){const{data:{user:r}}=await h.auth.getUser();if(!r)return null;const{data:l,error:i}=await h.from("users").select("*").eq("id",r.id).single();return i?{id:r.id,email:r.email,name:r.user_metadata?.name||"",role:r.user_metadata?.role||"foreman"}:l}else return ki()},async updateRole(r,l){if(y){const{data:i,error:s}=await h.from("users").update({role:l}).eq("id",r).select().single();if(s)throw s;return i}else{const i=Q(),s=i.users.find(u=>u.id===r);return s&&(s.role=l,te(i),ki()?.id===r&&Bi(s)),s}},onAuthStateChange(r){if(y)return h.auth.onAuthStateChange(r);{const l=ki();return r(l?"SIGNED_IN":"SIGNED_OUT",{user:l}),{data:{subscription:{unsubscribe:()=>{}}}}}}},mt={async getProjects(r=null,l=!1){if(y){if(!Kt()){const s=await Nm(r);return l?s:s.filter(u=>u.status!=="archived")}const i=performance.now();try{let s=h.from("projects").select("*").order("created_at",{ascending:!1});r&&(s=s.eq("company_id",r)),l||(s=s.eq("status","active"));const{data:u,error:d}=await s,m=Math.round(performance.now()-i);if(w.query("getProjects",{duration:m,rows:u?.length,company_id:r}),d){w.error("database",{message:d.message,operation:"getProjects",company_id:r});const g=await Nm(r);if(g.length>0)return g;throw d}return u?.length>0&&$g(u).catch(g=>w.error("database",{message:g?.message||"Failed to cache projects",operation:"getProjects"})),u}catch(s){throw w.error("database",{message:s.message,operation:"getProjects",company_id:r}),s}}else{const i=Q().projects;return l?i:i.filter(s=>s.status!=="archived")}},async getProjectsPaginated(r,{page:l=0,limit:i=25,status:s="active"}={}){if(y){const m=performance.now();try{let g=h.from("projects").select("*",{count:"exact"}).eq("company_id",r).order("created_at",{ascending:!1}).range(l*i,(l+1)*i-1);s!=="all"&&(g=g.eq("status",s));const{data:b,error:x,count:z}=await g,E=Math.round(performance.now()-m);if(w.query("getProjectsPaginated",{duration:E,rows:b?.length,page:l,company_id:r}),x)throw x;return{projects:b||[],totalCount:z||0,hasMore:(l+1)*i<(z||0),page:l,limit:i}}catch(g){throw w.error("database",{message:g.message,operation:"getProjectsPaginated",company_id:r}),g}}const u=Q().projects.filter(m=>m.company_id===r&&(s==="all"||m.status===s)),d=l*i;return{projects:u.slice(d,d+i),totalCount:u.length,hasMore:d+i<u.length,page:l,limit:i}},async getProjectsWithSummary(r){if(y){const l=performance.now();try{const{data:i,error:s}=await h.from("projects").select(`
            *,
            areas:areas(count),
            tickets:t_and_m_tickets(count),
            daily_reports:daily_reports(count)
          `).eq("company_id",r).eq("status","active").order("created_at",{ascending:!1}),u=Math.round(performance.now()-l);if(w.query("getProjectsWithSummary",{duration:u,rows:i?.length,company_id:r}),s)throw s;return(i||[]).map(d=>({...d,areaCount:d.areas?.[0]?.count||0,ticketCount:d.tickets?.[0]?.count||0,pendingTicketCount:0,reportCount:d.daily_reports?.[0]?.count||0,areas:void 0,tickets:void 0,daily_reports:void 0}))}catch(i){return w.error("database",{message:i.message,operation:"getProjectsWithSummary",company_id:r}),this.getProjects(r)}}return Q().projects.filter(l=>l.company_id===r&&l.status==="active")},async getProjectDashboardSummary(r){if(y){const l=performance.now();try{const{data:i,error:s}=await h.rpc("get_project_dashboard_summary",{p_company_id:r}),u=Math.round(performance.now()-l);if(w.query("getProjectDashboardSummary",{duration:u,rows:i?.length,company_id:r}),s){if(s.message?.includes("function")||s.code==="42883")return this.getProjectsWithSummary(r);throw s}return(i||[]).map(d=>({id:d.project_id,name:d.project_name,status:d.project_status,job_number:d.project_number,address:d.project_address,pin:d.project_pin,created_at:d.created_at,start_date:d.start_date,end_date:d.end_date,contract_value:Number(d.contract_value)||0,work_type:d.work_type||"demolition",job_type:d.job_type||"standard",general_contractor:d.general_contractor||"",areaCount:Number(d.total_areas)||0,completedAreas:Number(d.completed_areas)||0,inProgressAreas:Number(d.in_progress_areas)||0,pendingAreas:Number(d.pending_areas)||0,ticketCount:Number(d.total_tickets)||0,pendingTicketCount:Number(d.pending_tickets)||0,submittedTicketCount:Number(d.submitted_tickets)||0,approvedTicketCount:Number(d.approved_tickets)||0,totalLaborHours:Number(d.total_labor_hours)||0,todayLaborHours:Number(d.today_labor_hours)||0,todayWorkerCount:Number(d.today_worker_count)||0,lastActivityAt:d.last_activity_at,dailyReportsThisWeek:Number(d.daily_reports_this_week)||0,corCount:Number(d.cor_count)||0,pendingCorCount:Number(d.pending_cor_count)||0,disposalLoadsToday:Number(d.disposal_loads_today)||0}))}catch(i){return w.error("database",{message:i.message,operation:"getProjectDashboardSummary",company_id:r}),this.getProjectsWithSummary(r)}}return Q().projects.filter(l=>l.company_id===r&&l.status==="active")},async getArchivedProjects(r){if(y){const{data:l,error:i}=await h.from("projects").select("*").eq("company_id",r).eq("status","archived").order("archived_at",{ascending:!1});if(i)throw i;return l}else return Q().projects.filter(l=>l.status==="archived")},async getProjectCount(r){if(y){const{count:l,error:i}=await h.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",r).in("status",["active","archived"]);if(i)throw i;return l||0}else return Q().projects.filter(i=>i.company_id===r&&i.status!=="deleted").length},async universalSearch(r,l,i=10){if(!y||!l?.trim())return{projects:[],tickets:[],cors:[],workers:[]};const s=l.trim().toLowerCase(),u={projects:[],tickets:[],cors:[],workers:[]};try{const{data:d}=await h.from("projects").select("id, name, job_number, address, status").eq("company_id",r).eq("status","active").or(`name.ilike.%${s}%,job_number.ilike.%${s}%,address.ilike.%${s}%`).limit(i);u.projects=d||[];const{data:m}=await h.from("t_and_m_tickets").select(`
          id, notes, work_date, status, project_id,
          projects!inner(id, name, company_id)
        `).eq("projects.company_id",r).ilike("notes",`%${s}%`).order("work_date",{ascending:!1}).limit(i);u.tickets=(m||[]).map(z=>({...z,projectName:z.projects?.name||"Unknown Project"}));const{data:g}=await h.from("change_orders").select(`
          id, cor_number, title, status, project_id,
          projects!inner(id, name, company_id)
        `).eq("projects.company_id",r).or(`title.ilike.%${s}%,cor_number.ilike.%${s}%`).order("created_at",{ascending:!1}).limit(i);u.cors=(g||[]).map(z=>({...z,projectName:z.projects?.name||"Unknown Project"}));const{data:b}=await h.from("crew_checkins").select(`
          workers,
          project_id,
          projects!inner(id, name, company_id)
        `).eq("projects.company_id",r).order("check_in_date",{ascending:!1}).limit(50),x=new Map;return(b||[]).forEach(z=>{(z.workers||[]).forEach(E=>{if(E.name.toLowerCase().includes(s)){const k=E.name.toLowerCase();x.has(k)||x.set(k,{name:E.name,role:E.role,projectName:z.projects?.name,lastProject:z.projects})}})}),u.workers=Array.from(x.values()).slice(0,i),u}catch(d){return w.error("database",{message:d?.message||"Universal search error",operation:"universalSearch"}),u}},async archiveProject(r){if(y){const{data:l,error:i}=await h.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return l}else{const l=Q(),i=l.projects.find(s=>s.id===r);return i&&(i.status="archived",i.archived_at=new Date().toISOString(),te(l)),i}},async getProjectStorageStats(r){if(!y)return{photoCount:0,estimatedMB:0};const{data:l,error:i}=await h.from("t_and_m_tickets").select("photos").eq("project_id",r);if(i)throw i;let s=0;const u=[];l?.forEach(m=>{m.photos&&Array.isArray(m.photos)&&(s+=m.photos.length,u.push(...m.photos))});const d=s*1.5;return{photoCount:s,estimatedMB:d,photoUrls:u}},async archiveProjectDeep(r,l){if(!y)return null;const{photoUrls:i}=await this.getProjectStorageStats(r);if(i.length>0){const d=i.map(m=>{if(!m)return null;if(m.startsWith("http"))try{const b=new URL(m).pathname.match(/\/tm-photos\/(.+)$/);return b?b[1]:null}catch{return null}return m}).filter(Boolean);if(d.length>0)for(let m=0;m<d.length;m+=100){const g=d.slice(m,m+100);await h.storage.from("tm-photos").remove(g)}}await h.from("t_and_m_tickets").update({photos:[]}).eq("project_id",r);const{data:s,error:u}=await h.from("projects").update({status:"archived",archived_at:new Date().toISOString(),photos:[],storage_cleaned:!0}).eq("id",r).select().single();if(u)throw u;return{...s,photosDeleted:i.length}},async restoreProject(r){if(y){const{data:l,error:i}=await h.from("projects").update({status:"active",archived_at:null}).eq("id",r).select().single();if(i)throw i;return l}else{const l=Q(),i=l.projects.find(s=>s.id===r);return i&&(i.status="active",i.archived_at=null,te(l)),i}},async getProject(r){if(y){const{data:l,error:i}=await h.from("projects").select("*").eq("id",r).single();if(i)throw i;return l}else return Q().projects.find(l=>l.id===r)},async createProject(r){if(y){const{data:l,error:i}=await h.from("projects").insert({...r,status:"active"}).select().single();if(i)throw w.error("database",{message:i?.message||"Supabase createProject error",operation:"createProject",extra:{details:i.details,hint:i.hint}}),i;return l}else{const l=Q(),i={...r,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return l.projects.push(i),te(l),i}},async getProjectByPin(r){if(y){const{data:l,error:i}=await h.from("projects").select("*").eq("pin",r).eq("status","active").single();return i?null:l}else return Q().projects.find(i=>i.pin===r&&i.status==="active")||null},async getProjectByPinAndCompany(r,l){if(y){const{data:i,error:s}=await h.from("projects").select("*").eq("pin",r).eq("company_id",l).eq("status","active").single();return s?null:i}else return Q().projects.find(s=>s.pin===r&&s.company_id===l&&s.status==="active")||null},async getProjectByPinSecure(r,l){if(y){const i=`pin_attempts_${l}`,s=`pin_lockout_${l}`,u=5,d=300*1e3,m=localStorage.getItem(s);if(m&&Date.now()<parseInt(m)){const X=parseInt(m)-Date.now(),H=Math.ceil(X/6e4);return{success:!1,rateLimited:!0,project:null,error:`Too many attempts. Please try again in ${H} minute${H>1?"s":""}.`}}const g=fc(),{data:b,error:x}=await h.rpc("validate_pin_and_create_session",{p_pin:r,p_company_code:l,p_device_id:g,p_ip_address:null});if(x)return w.error("general",{message:"RPC unavailable, using direct PIN lookup",severity:"warning",operation:"PIN Auth"}),await this._pinFallbackDirectQuery(r,l,i,s,u,d);if(!b||b.length===0)return{success:!1,rateLimited:!1,project:null};const z=b[0];if(z.error_code==="RATE_LIMITED")return{success:!1,rateLimited:!0,project:null};if(z.error_code==="INVALID_COMPANY"||z.error_code==="INVALID_PIN"){let X=parseInt(localStorage.getItem(i)||"0");return X++,localStorage.setItem(i,X.toString()),X>=u?(localStorage.setItem(s,(Date.now()+d).toString()),{success:!1,rateLimited:!0,project:null,error:"Too many failed attempts. Please try again in 5 minutes."}):{success:!1,rateLimited:!1,project:null}}if(!z.success||!z.project_id)return{success:!1,rateLimited:!1,project:null};localStorage.removeItem(`pin_attempts_${l}`),localStorage.removeItem(`pin_lockout_${l}`),Gi({token:z.session_token,projectId:z.project_id,companyId:z.company_id,projectName:z.project_name,companyName:z.company_name,createdAt:new Date().toISOString()});const E=qc(),{data:k}=await E.from("projects").select("*").eq("id",z.project_id).single();return{success:!0,rateLimited:!1,sessionToken:z.session_token,project:k||{id:z.project_id,name:z.project_name,company_id:z.company_id,status:"active"}}}else{const i=Q(),u=(i.companies||[]).find(m=>m.code===l);if(!u)return{success:!1,rateLimited:!1,project:null};const d=i.projects.find(m=>m.pin===r&&m.company_id===u.id&&m.status==="active");if(d){const m=`demo_${Date.now()}_${Math.random().toString(36).slice(2)}`;Gi({token:m,projectId:d.id,companyId:u.id,projectName:d.name,companyName:u.name,createdAt:new Date().toISOString()})}return{success:!!d,rateLimited:!1,project:d||null}}},async _pinFallbackDirectQuery(r,l,i,s,u,d){try{const{data:m,error:g}=await h.from("companies").select("*").ilike("code",l.trim()).single();if(g||!m)return{success:!1,rateLimited:!1,project:null};const{data:b,error:x}=await h.from("projects").select("*").eq("pin",r.trim()).eq("company_id",m.id).eq("status","active").single();if(x||!b){let E=parseInt(localStorage.getItem(i)||"0");return E++,localStorage.setItem(i,E.toString()),E>=u?(localStorage.setItem(s,(Date.now()+d).toString()),{success:!1,rateLimited:!0,project:null,error:"Too many failed attempts. Please try again in 5 minutes."}):{success:!1,rateLimited:!1,project:null}}localStorage.removeItem(i),localStorage.removeItem(s);let z=null;try{const E=Array.from(crypto.getRandomValues(new Uint8Array(32))).map(X=>X.toString(16).padStart(2,"0")).join(""),{error:k}=await h.from("field_sessions").insert({project_id:b.id,company_id:m.id,session_token:E,device_id:typeof fc=="function"?fc():null});k||(z=E)}catch{}return z&&Gi({token:z,projectId:b.id,companyId:m.id,projectName:b.name,companyName:m.name,createdAt:new Date().toISOString()}),{success:!0,rateLimited:!1,project:b}}catch(m){return w.error("database",{message:m?.message||"Fallback query failed",operation:"PIN Auth"}),{success:!1,rateLimited:!1,project:null,error:"Connection error. Please try again."}}},async isPinAvailable(r,l=null){if(y){let i=h.from("projects").select("id").eq("pin",r);l&&(i=i.neq("id",l));const{data:s,error:u}=await i;if(u)throw u;return s.length===0}else return!Q().projects.some(s=>s.pin===r&&s.id!==l)},async updateProjectPin(r,l){if(y){const{data:i,error:s}=await h.from("projects").update({pin:l}).eq("id",r).select().single();if(s)throw s;return i}else{const i=Q(),s=i.projects.find(u=>u.id===r);return s&&(s.pin=l,te(i)),s}},async updateProject(r,l,i=null){if(y){if(!i)throw console.error("[Security] updateProject called without companyId - this is a security risk"),new Error("Company ID is required for security verification");const{data:s,error:u}=await h.from("projects").update(l).eq("id",r).eq("company_id",i).select().single();if(u)throw w.error("database",{message:u?.message||"Error updating project",operation:"updateProject"}),u;return s}else{const s=Q(),u=s.projects.find(d=>d.id===r);return u&&(Object.assign(u,l),te(s)),u}},async deleteProject(r,l=null){if(y){const i=[];try{const{data:m}=await h.from("t_and_m_tickets").select("photos").eq("project_id",r);m?.forEach(g=>{Array.isArray(g.photos)&&g.photos.forEach(b=>{if(b)if(b.startsWith("http"))try{const x=new URL(b).pathname.match(/\/(?:public\/)?tm-photos\/(.+)$/);x&&i.push(decodeURIComponent(x[1]))}catch{}else i.push(b)})})}catch{}if(i.length>0)try{for(let m=0;m<i.length;m+=100)await h.storage.from("tm-photos").remove(i.slice(m,m+100))}catch{}await h.from("t_and_m_tickets").delete().eq("project_id",r),await h.from("daily_reports").delete().eq("project_id",r);let s=h.from("projects").delete({count:"exact"}).eq("id",r);l&&(s=s.eq("company_id",l));const{error:u,count:d}=await s;if(u)throw u;if(d===0)throw new Error("Project could not be deleted. You may not have permission (admin or owner role required).")}else{const i=Q();i.projects=i.projects.filter(s=>s.id!==r),i.areas=i.areas.filter(s=>s.project_id!==r),te(i)}},async getAreas(r){if(y){if(!Kt())return Om(r);const l=L(),{data:i,error:s}=await l.from("areas").select("*").eq("project_id",r).order("sort_order",{ascending:!0});if(s){const u=await Om(r);if(u.length>0)return u;throw s}return i?.length>0&&Fg(i).catch(u=>w.error("database",{message:u?.message||"Failed to cache areas",operation:"getAreas"})),i}else return Q().areas.filter(l=>l.project_id===r)},async createArea(r){if(y){const l=L(),{data:i,error:s}=await l.from("areas").insert(r).select().single();if(s)throw s;return i}else{const l=Q(),i={...r,id:crypto.randomUUID(),created_at:new Date().toISOString()};return l.areas.push(i),te(l),i}},async updateAreaStatus(r,l,i=null){if(y){if(!Kt()){const g=await cc(r,l);return await zt(Ge.UPDATE_AREA_STATUS,{areaId:r,status:l}),g}let u=L().from("areas").update({status:l}).eq("id",r);i&&(u=u.eq("project_id",i));const{data:d,error:m}=await u.select().single();if(m){if(m.message?.includes("fetch")||m.message?.includes("network")){const g=await cc(r,l);return await zt(Ge.UPDATE_AREA_STATUS,{areaId:r,status:l}),g}throw m}return d&&cc(r,l).catch(g=>w.error("database",{message:g?.message||"Failed to update cached area status",operation:"updateAreaStatus"})),d}else{const s=Q(),u=s.areas.find(d=>d.id===r);return u&&(u.status=l,u.updated_at=new Date().toISOString()),te(s),u}},async updateArea(r,l,i=null){if(y){let s=h.from("areas").update(l).eq("id",r);i&&(s=s.eq("project_id",i));const{data:u,error:d}=await s.select().single();if(d)throw d;return u}else{const s=Q(),u=s.areas.find(d=>d.id===r);return u&&(Object.assign(u,l),u.updated_at=new Date().toISOString()),te(s),u}},async deleteArea(r,l=null){if(y){let i=h.from("areas").delete().eq("id",r);l&&(i=i.eq("project_id",l));const{error:s}=await i;if(s)throw s}else{const i=Q();i.areas=i.areas.filter(s=>s.id!==r),te(i)}},subscribeToAreas(r,l){return y?h.channel(`areas:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMessages(r,l){return y?h.channel(`messages:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"messages",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMaterialRequests(r,l){return y?h.channel(`material_requests:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToDailyReports(r,l){return y?h.channel(`daily_reports:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCrewCheckins(r,l){return y?h.channel(`crew_checkins:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToInjuryReports(r,l){return y?h.channel(`injury_reports:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},l).subscribe():null},subscribeToTMTickets(r,l){return y?h.channel(`tm_tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCompanyActivity(r,l,i){if(!y||!l||l.length===0)return null;const s=h.channel(`company_activity:${r}`);return l.forEach(u=>{s.on("postgres_changes",{event:"*",schema:"public",table:"messages",filter:`project_id=eq.${u}`},d=>i.onMessage?.(d)),s.on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${u}`},d=>i.onMaterialRequest?.(d)),s.on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${u}`},d=>i.onTMTicket?.(d)),s.on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${u}`},d=>i.onCrewCheckin?.(d)),s.on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${u}`},d=>i.onAreaUpdate?.(d)),s.on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${u}`},d=>i.onCORChange?.(d)),s.on("postgres_changes",{event:"*",schema:"public",table:"projects",filter:`id=eq.${u}`},d=>i.onProjectChange?.(d)),s.on("postgres_changes",{event:"*",schema:"public",table:"punch_list_items",filter:`project_id=eq.${u}`},d=>i.onPunchListChange?.(d))}),s.on("postgres_changes",{event:"*",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},u=>i.onInjuryReport?.(u)),s.on("postgres_changes",{event:"*",schema:"public",table:"materials_equipment",filter:`company_id=eq.${r}`},u=>i.onMaterialsEquipmentChange?.(u)),s.on("postgres_changes",{event:"*",schema:"public",table:"labor_rates",filter:`company_id=eq.${r}`},u=>i.onLaborRateChange?.(u)),s.subscribe()},unsubscribe(r){r&&y&&h.removeChannel(r)},async getAssignedProjects(r){if(y){const{data:l,error:i}=await h.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",r);if(i)throw i;return l.map(s=>s.projects)}else{const l=Q();return(l.assignments?.filter(s=>s.user_id===r)||[]).map(s=>l.projects.find(u=>u.id===s.project_id)).filter(Boolean)}},async assignUserToProject(r,l,i){if(y){const{data:s,error:u}=await h.from("project_assignments").insert({project_id:r,user_id:l,assigned_by:i}).select().single();if(u)throw u;return s}else{const s=Q();s.assignments||(s.assignments=[]);const u={id:crypto.randomUUID(),project_id:r,user_id:l,assigned_by:i,assigned_at:new Date().toISOString()};return s.assignments.push(u),te(s),u}},async removeUserFromProject(r,l){if(y){const{error:i}=await h.from("project_assignments").delete().eq("project_id",r).eq("user_id",l);if(i)throw i}else{const i=Q();i.assignments=i.assignments?.filter(s=>!(s.project_id===r&&s.user_id===l))||[],te(i)}},async getProjectAssignments(r){if(y){const{data:l,error:i}=await h.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",r);if(i)throw i;return l.map(s=>s.users)}else{const l=Q();return(l.assignments?.filter(s=>s.project_id===r)||[]).map(s=>l.users.find(u=>u.id===s.user_id)).filter(Boolean)}},async getAllUsers(r=500){if(y){const{data:l,error:i}=await h.from("users").select("id, email, name, role").order("name").limit(r);if(i)throw i;return l}else return Q().users||[]},async getForemen(r=500){if(y){const{data:l,error:i}=await h.from("users").select("id, email, name, role").eq("role","foreman").order("name").limit(r);if(i)throw i;return l}else return(Q().users||[]).filter(l=>l.role==="foreman")},async logActivity(r,l,i,s,u,d){if(y){const{error:m}=await h.from("activity_log").insert({user_id:r,project_id:l,area_id:i,action:s,old_value:u,new_value:d});m&&w.error("database",{message:m?.message||"Error logging activity",operation:"logActivity"})}},async getProjectActivity(r,l=50){if(y){const{data:i,error:s}=await h.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",r).order("created_at",{ascending:!1}).limit(l);if(s)throw s;return i}return[]},async getMaterialsEquipment(r){if(y){const{data:l,error:i}=await h.from("materials_equipment").select("*").eq("company_id",r).eq("active",!0).order("category").order("name");if(i)throw i;return l}return[]},async getMaterialsEquipmentByCategory(r,l){if(y){const i=L();if(!i)return[];const{data:s,error:u}=await i.from("materials_equipment").select("*").eq("company_id",r).eq("category",l).eq("active",!0).order("name");if(u)throw u;return s}return[]},async getAllMaterialsEquipment(r){if(y){const l=L();if(!l)return[];const{data:i,error:s}=await l.from("materials_equipment").select("*").eq("company_id",r).order("category").order("name");if(s)throw s;return i}return[]},async createMaterialEquipment(r){if(y){const{data:l,error:i}=await h.from("materials_equipment").insert(r).select().single();if(i)throw i;return l}return null},async updateMaterialEquipment(r,l){if(y){const{data:i,error:s}=await h.from("materials_equipment").update(l).eq("id",r).select().single();if(s)throw s;return i}return null},async deleteMaterialEquipment(r){if(y){const{error:l}=await h.from("materials_equipment").update({active:!1}).eq("id",r);if(l)throw l}},async getLaborCategories(r){if(y){const{data:l,error:i}=await h.from("labor_categories").select("*").eq("company_id",r).eq("active",!0).order("sort_order").order("name");if(i)throw i;return l||[]}return[]},async createLaborCategory(r,l,i=0){if(y){const{data:s,error:u}=await h.from("labor_categories").insert({company_id:r,name:l,sort_order:i}).select().single();if(u)throw u;return s}return null},async updateLaborCategory(r,l){if(y){const{data:i,error:s}=await h.from("labor_categories").update(l).eq("id",r).select().single();if(s)throw s;return i}return null},async deleteLaborCategory(r){if(y){const{error:l}=await h.from("labor_categories").update({active:!1}).eq("id",r);if(l)throw l}},async getLaborClasses(r){if(y){const{data:l,error:i}=await h.from("labor_classes").select(`
          *,
          labor_categories (id, name)
        `).eq("company_id",r).eq("active",!0).order("sort_order").order("name");if(i)throw i;return l||[]}return[]},async getLaborClassesWithCategories(r){if(y){const[l,i]=await Promise.all([h.from("labor_categories").select("*").eq("company_id",r).eq("active",!0).order("sort_order").order("name"),h.from("labor_classes").select("*").eq("company_id",r).eq("active",!0).order("sort_order").order("name")]);if(l.error)throw l.error;if(i.error)throw i.error;return{categories:l.data||[],classes:i.data||[]}}return{categories:[],classes:[]}},async getLaborClassesForField(r){if(y){const l=L();if(!l)return{categories:[],classes:[]};const{data:i,error:s}=await l.rpc("get_labor_classes_for_field",{p_company_id:r});if(s){w.error("database",{message:s?.message||"Error loading field labor classes",operation:"getLaborClassesForField"});const[m,g]=await Promise.all([l.from("labor_categories").select("id, name").eq("company_id",r).eq("active",!0).order("name"),l.from("labor_classes").select("id, name, category_id").eq("company_id",r).eq("active",!0).order("name")]);return{categories:m.data||[],classes:g.data||[]}}const u=new Map,d=[];for(const m of i||[])m.category_id&&m.category_name&&!u.has(m.category_id)&&u.set(m.category_id,{id:m.category_id,name:m.category_name}),d.push({id:m.id,name:m.name,category_id:m.category_id});return{categories:Array.from(u.values()),classes:d}}return{categories:[],classes:[]}},async createLaborClass(r,l,i,s=0){if(y){const{data:u,error:d}=await h.from("labor_classes").insert({company_id:r,category_id:l,name:i,sort_order:s}).select().single();if(d)throw d;return u}return null},async updateLaborClass(r,l){if(y){const{data:i,error:s}=await h.from("labor_classes").update(l).eq("id",r).select().single();if(s)throw s;return i}return null},async deleteLaborClass(r){if(y){const{error:l}=await h.from("labor_classes").update({active:!1}).eq("id",r);if(l)throw l}},async getLaborClassRates(r){if(y){const{data:l,error:i}=await h.from("labor_class_rates").select("*").eq("labor_class_id",r);if(i)throw i;return l||[]}return[]},async getAllLaborClassRates(r){if(y){const{data:l,error:i}=await h.from("labor_classes").select(`
          id,
          name,
          labor_class_rates (*)
        `).eq("company_id",r).eq("active",!0);if(i)throw i;return l||[]}return[]},async saveLaborClassRates(r,l){if(y){const i=l.map(u=>({...u,labor_class_id:r})),{error:s}=await h.from("labor_class_rates").upsert(i,{onConflict:"labor_class_id,work_type,job_type"});if(s)throw s}},async getLaborClassRate(r,l,i){if(y){const{data:s,error:u}=await h.from("labor_class_rates").select("regular_rate, overtime_rate").eq("labor_class_id",r).eq("work_type",l).eq("job_type",i).single();if(u&&u.code!=="PGRST116")throw u;return s||null}return null},async getTMTickets(r){if(y){const l=performance.now(),i=L(),u=bc()?"materials_equipment (name, unit, category)":"materials_equipment (name, unit, cost_per_unit, category)";try{const{data:d,error:m}=await i.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              ${u}
            )
          `).eq("project_id",r).order("created_at",{ascending:!1}),g=Math.round(performance.now()-l);if(w.query("getTMTickets",{duration:g,rows:d?.length,project_id:r}),m)throw m;return d}catch(d){throw w.error("database",{message:d.message,operation:"getTMTickets",project_id:r}),d}}return[]},async getTMTicketsPaginated(r,{page:l=0,limit:i=25,status:s=null}={}){if(y){const u=performance.now(),d=L(),g=bc()?"materials_equipment (name, unit, category)":"materials_equipment (name, unit, cost_per_unit, category)";try{let b=d.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              ${g}
            )
          `,{count:"exact"}).eq("project_id",r).order("created_at",{ascending:!1}).range(l*i,(l+1)*i-1);s&&(b=b.eq("status",s));const{data:x,error:z,count:E}=await b,k=Math.round(performance.now()-u);if(w.query("getTMTicketsPaginated",{duration:k,rows:x?.length,page:l,project_id:r}),z)throw z;return{tickets:x||[],totalCount:E||0,hasMore:(l+1)*i<(E||0),page:l,limit:i}}catch(b){throw w.error("database",{message:b.message,operation:"getTMTicketsPaginated",project_id:r}),b}}return{tickets:[],totalCount:0,hasMore:!1,page:0,limit:25}},async getChangeOrderTotals(r){if(y){const{data:l,error:i}=await h.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",r).not("ce_pco_number","is",null).neq("ce_pco_number","");if(i)throw i;const s={};let u=0,d=0;return l?.forEach(m=>{const g=m.ce_pco_number;if(s[g]||(s[g]={approved:0,pending:0,count:0}),s[g].count++,m.status==="approved"||m.status==="billed"){const b=parseFloat(m.change_order_value)||0;s[g].approved+=b,u+=b}else m.status==="pending"&&d++}),{changeOrders:s,totalApprovedValue:u,pendingCount:d}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(r,l){if(y){const i=L();if(!i)return[];const{data:s,error:u}=await i.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).eq("status",l).order("created_at",{ascending:!1});if(u)throw u;return s}return[]},async getCORTickets(r){if(y){const l=L();if(!l)return[];const{data:i,error:s}=await l.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",r).order("work_date",{ascending:!0});if(s)throw s;return i||[]}return[]},async createTMTicket(r){if(y){if(!Kt()){const u={id:Et(),project_id:r.project_id,work_date:r.work_date,ce_pco_number:r.ce_pco_number||null,assigned_cor_id:r.assigned_cor_id||null,notes:r.notes,photos:r.photos||[],status:"pending_sync",created_by_name:r.created_by_name||"Field User",created_at:new Date().toISOString(),_offline:!0};return await Mm(u),await zt(Ge.CREATE_TM_TICKET,{ticket:u,workers:r._workers||[],items:r._items||[]}),u}const l=L();if(!l)throw new Error("Database client not available");const{data:i,error:s}=await l.from("t_and_m_tickets").insert({project_id:r.project_id,work_date:r.work_date,ce_pco_number:r.ce_pco_number||null,assigned_cor_id:r.assigned_cor_id||null,notes:r.notes,photos:r.photos||[],status:"pending",created_by_name:r.created_by_name||"Field User"}).select().single();if(s){if(s.message?.includes("fetch")||s.message?.includes("network")){const u={id:Et(),...r,status:"pending_sync",_offline:!0};return await Mm(u),await zt(Ge.CREATE_TM_TICKET,{ticket:u,workers:r._workers||[],items:r._items||[]}),u}throw s}return i}return null},async addTMWorkers(r,l){if(y){const i=l.map(d=>({ticket_id:r,name:d.name,hours:d.hours,overtime_hours:d.overtime_hours||0,time_started:d.time_started||null,time_ended:d.time_ended||null,role:d.role||"Laborer"})),s=L();if(!s)throw new Error("Database client not available");const{error:u}=await s.from("t_and_m_workers").insert(i);if(u)throw u}},async addTMItems(r,l){if(y){const i=l.map(d=>({ticket_id:r,material_equipment_id:d.material_equipment_id||null,custom_name:d.custom_name||null,custom_category:d.custom_category||null,quantity:d.quantity})),s=L();if(!s)throw new Error("Database client not available");const{error:u}=await s.from("t_and_m_items").insert(i);if(u)throw u}},async getPreviousTicketCrew(r,l){if(!y)return null;const i=L();if(!i)return null;const{data:s,error:u}=await i.from("t_and_m_tickets").select(`
        id,
        work_date,
        t_and_m_workers (*)
      `).eq("project_id",r).lt("work_date",l).order("work_date",{ascending:!1}).limit(1).maybeSingle();if(u||!s)return null;const d=s.t_and_m_workers||[],m=d.some(E=>E.labor_class_id),g={};m&&d.forEach(E=>{E.labor_class_id&&(g[E.labor_class_id]||(g[E.labor_class_id]=[]),g[E.labor_class_id].push({name:E.name,hours:E.hours?.toString()||"",overtimeHours:E.overtime_hours?.toString()||"",timeStarted:E.time_started||"",timeEnded:E.time_ended||""}))});const b=d.filter(E=>["Foreman","General Foreman","Superintendent"].includes(E.role)).map(E=>({name:E.name,hours:E.hours?.toString()||"",overtimeHours:E.overtime_hours?.toString()||"",timeStarted:E.time_started||"",timeEnded:E.time_ended||"",role:E.role})),x=d.filter(E=>E.role==="Operator").map(E=>({name:E.name,hours:E.hours?.toString()||"",overtimeHours:E.overtime_hours?.toString()||"",timeStarted:E.time_started||"",timeEnded:E.time_ended||""})),z=d.filter(E=>E.role==="Laborer").map(E=>({name:E.name,hours:E.hours?.toString()||"",overtimeHours:E.overtime_hours?.toString()||"",timeStarted:E.time_started||"",timeEnded:E.time_ended||""}));return{workDate:s.work_date,supervision:b.length>0?b:null,operators:x.length>0?x:null,laborers:z.length>0?z:null,dynamicWorkers:Object.keys(g).length>0?g:null,totalWorkers:d.length}},async updateTMTicketStatus(r,l){if(y){const i=L();if(!i)throw new Error("Database client not available");const{data:s,error:u}=await i.from("t_and_m_tickets").update({status:l}).eq("id",r).select().single();if(u)throw u;return s}return null},async approveTMTicket(r,l,i,s=null){if(y){const u={status:"approved",approved_by_user_id:l,approved_by_name:i,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};s!==null&&(u.change_order_value=parseFloat(s)||0);const d=L();if(!d)throw new Error("Database client not available");const{data:m,error:g}=await d.from("t_and_m_tickets").update(u).eq("id",r).select().single();if(g)throw g;return m}return null},async rejectTMTicket(r,l,i,s=""){if(y){const u=L();if(!u)throw new Error("Database client not available");const{data:d,error:m}=await u.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:l,rejected_by_name:i,rejected_at:new Date().toISOString(),rejection_reason:s,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",r).select().single();if(m)throw m;return d}return null},canApproveTickets(r){return["owner","admin","manager"].includes(r)},async updateTMTicketPhotos(r,l,i=null){if(y){const s=L();if(!s)throw new Error("Database client not available");const u={photos:l};i&&(u.photo_locations=i);const{data:d,error:m}=await s.from("t_and_m_tickets").update(u).eq("id",r).select().single();if(m)throw m;return d}return null},async saveTMClientSignature(r,l){if(y){const i=L();if(!i)throw new Error("Database client not available");const{data:s,error:u}=await i.from("t_and_m_tickets").update({client_signature_data:l.signature,client_signature_name:l.signerName,client_signature_title:l.signerTitle,client_signature_company:l.signerCompany,client_signature_date:l.signedAt,client_signature_ip:null,status:"client_signed"}).eq("id",r).select().single();if(u)throw u;return s}return null},async deleteTMTicket(r){if(y){const l=L();if(!l)throw new Error("Database client not available");const{error:i}=await l.from("t_and_m_tickets").delete().eq("id",r);if(i)throw i}},async isTicketEditable(r){if(!r?.assigned_cor_id)return{editable:!0};if(y)try{const{data:l,error:i}=await h.from("change_orders").select("id, status, cor_number").eq("id",r.assigned_cor_id).single();if(i||!l)return{editable:!0};const u=["draft","pending_approval"].includes(l.status);return{editable:u,lockedBy:u?null:l,reason:u?null:`This ticket is linked to ${l.cor_number} which has been ${l.status==="approved"?"approved":l.status}`}}catch(l){return w.error("database",{message:l?.message||"Error checking ticket editability",operation:"isTicketEditable"}),{editable:!0}}return{editable:!0}},async getCompanyByCode(r){if(y){const{data:l,error:i}=await h.from("companies").select("*").ilike("code",r.trim()).single();return i?(w.error("database",{message:i?.message||"Company lookup error",operation:"getCompanyByCode",extra:{code:i.code,details:i.details,hint:i.hint}}),null):l}return null},async getCompany(r){if(y){const{data:l,error:i}=await h.from("companies").select("*").eq("id",r).single();if(i)throw i;return l}return null},async getUserCompanies(r){if(y){const{data:l,error:i}=await h.from("user_companies").select(`
          id,
          access_level,
          company_id,
          status,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",r).eq("status","active").order("created_at",{ascending:!0});return i?(w.error("database",{message:i?.message||"Error fetching user companies",operation:"getUserCompanies"}),[]):l.map(s=>({id:s.companies.id,name:s.companies.name,code:s.companies.code,access_level:s.access_level}))}return[]},async getUserPendingMemberships(r){if(y){const{count:l,error:i}=await h.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r).eq("status","pending");return i?(w.error("database",{message:i?.message||"Error fetching pending memberships",operation:"getUserPendingMemberships"}),0):l||0}return 0},async getCompanyMemberships(r){if(y){const{data:l,error:i}=await h.from("user_companies").select(`
          id,
          access_level,
          company_role,
          status,
          created_at,
          approved_at,
          approved_by,
          removed_at,
          removed_by,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).order("created_at",{ascending:!1});return i?(w.error("database",{message:i?.message||"Error fetching company memberships",operation:"getCompanyMemberships"}),[]):l||[]}return[]},async approveMembership(r,l){if(y){const{error:i}=await h.from("user_companies").update({status:"active",approved_at:new Date().toISOString(),approved_by:l}).eq("id",r);if(i)throw i}},async approveMembershipWithRole(r,l,i="member"){if(y){const{error:s}=await h.rpc("approve_membership_with_role",{membership_id:r,approved_by_user:l,new_access_level:i});if(s)throw s}},async rejectMembership(r){if(y){const{error:l}=await h.from("user_companies").delete().eq("id",r);if(l)throw l}},async removeMember(r,l){if(y){const{error:i}=await h.from("user_companies").update({status:"removed",removed_at:new Date().toISOString(),removed_by:l}).eq("id",r);if(i)throw i}},async getProjectTeam(r){if(y){const{data:l,error:i}=await h.from("project_users").select(`
          id,
          project_role,
          assigned_at,
          notes,
          users!project_users_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("project_id",r).order("assigned_at",{ascending:!0});return i?(w.error("database",{message:i?.message||"Error fetching project team",operation:"getProjectTeam"}),[]):l||[]}return[]},async getCompanyMembers(r){if(y){const{data:l,error:i}=await h.from("user_companies").select(`
          id,
          access_level,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).eq("status","active").order("created_at",{ascending:!0});return i?(w.error("database",{message:i?.message||"Error fetching company members",operation:"getCompanyMembers"}),[]):l||[]}return[]},async addProjectMember(r,l,i,s){if(y){const{data:u,error:d}=await h.from("project_users").insert({project_id:r,user_id:l,project_role:i,assigned_by:s}).select().single();if(d)throw d;return u}return null},async updateProjectMemberRole(r,l,i){if(y){const{error:s}=await h.from("project_users").update({project_role:i}).eq("project_id",r).eq("user_id",l);if(s)throw s}},async removeProjectMember(r,l){if(y){const{error:i}=await h.from("project_users").delete().eq("project_id",r).eq("user_id",l);if(i)throw i}},async updateMemberAccessLevel(r,l){if(y){const{error:i}=await h.from("user_companies").update({access_level:l}).eq("id",r);if(i)throw i}},async updateMemberCompanyRole(r,l){if(y){const{error:i}=await h.from("user_companies").update({company_role:l}).eq("id",r);if(i)throw i}},async repairLegacyUser(r,l,i="member"){if(!y||!r||!l)return!1;try{const{data:s,error:u}=await h.rpc("repair_legacy_user",{p_user_id:r,p_company_id:l,p_role:i});return u?(w.error("database",{message:u?.message||"RPC repair_legacy_user failed",operation:"repairLegacyUser"}),!1):s===!0}catch(s){return w.error("database",{message:s?.message||"Error repairing legacy user",operation:"repairLegacyUser"}),!1}},async isLegacyUser(r){if(!y)return!1;try{const{data:l}=await h.from("users").select("company_id, role").eq("id",r).single();if(!l?.company_id)return!1;const{count:i}=await h.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r);return i===0}catch(l){return w.error("database",{message:l?.message||"Error checking legacy user",operation:"isLegacyUser"}),!1}},DISPOSAL_LOAD_TYPES:[{value:"concrete",label:"Concrete"},{value:"trash",label:"Trash"},{value:"metals",label:"Metals"},{value:"hazardous_waste",label:"Hazardous Waste"}],async getDisposalLoads(r,l){if(!y)return[];const i=L();if(!i)return[];const s=performance.now();try{const{data:u,error:d}=await i.from("disposal_loads").select("*").eq("project_id",r).eq("work_date",l).order("created_at",{ascending:!1}),m=Math.round(performance.now()-s);if(w.query("getDisposalLoads",{duration:m,rows:u?.length,project_id:r}),d)throw d;return u||[]}catch(u){throw w.error("database",{message:u.message,operation:"getDisposalLoads",project_id:r}),u}},async getDisposalLoadsHistory(r,l=14){if(!y)return[];const i=L();if(!i)return[];const s=performance.now();try{const u=new Date,d=new Date;d.setDate(d.getDate()-l);const{data:m,error:g}=await i.from("disposal_loads").select("*").eq("project_id",r).gte("work_date",d.toISOString().split("T")[0]).lte("work_date",u.toISOString().split("T")[0]).order("work_date",{ascending:!1}),b=Math.round(performance.now()-s);if(w.query("getDisposalLoadsHistory",{duration:b,rows:m?.length,project_id:r}),g)throw g;return(m||[]).map(x=>({...x,load_date:x.work_date}))}catch(u){throw w.error("database",{message:u.message,operation:"getDisposalLoadsHistory",project_id:r}),u}},async addDisposalLoad(r,l,i,s,u,d=null){if(!y)return null;const m=L();if(!m)throw new Error("Database client not available");const{data:g,error:b}=await m.from("disposal_loads").insert({project_id:r,user_id:l,work_date:i,load_type:s,load_count:u,notes:d}).select().single();if(b)throw w.error("database",{message:b.message,operation:"addDisposalLoad",project_id:r}),b;return g},async updateDisposalLoad(r,l,i,s=null){if(!y)return null;const u=L();if(!u)throw new Error("Database client not available");const{data:d,error:m}=await u.from("disposal_loads").update({load_type:l,load_count:i,notes:s}).eq("id",r).select().single();if(m)throw w.error("database",{message:m.message,operation:"updateDisposalLoad"}),m;return d},async deleteDisposalLoad(r){if(!y)return!1;const l=L();if(!l)throw new Error("Database client not available");const{error:i}=await l.from("disposal_loads").delete().eq("id",r);if(i)throw w.error("database",{message:i.message,operation:"deleteDisposalLoad"}),i;return!0},async getDisposalSummary(r,l=null,i=null){if(!y)return[];const s=L();if(!s)return[];const u=performance.now();try{const{data:d,error:m}=await s.rpc("get_disposal_summary",{p_project_id:r,p_start_date:l,p_end_date:i}),g=Math.round(performance.now()-u);if(w.query("getDisposalSummary",{duration:g,rows:d?.length,project_id:r}),m)throw m;return d||[]}catch(d){return w.error("database",{message:d.message,operation:"getDisposalSummary",project_id:r}),this.getDisposalSummaryFallback(r,l,i)}},async getDisposalSummaryFallback(r,l,i){let u=(L()||h).from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r);l&&(u=u.gte("work_date",l)),i&&(u=u.lte("work_date",i));const{data:d,error:m}=await u;if(m)throw m;const g={};return d?.forEach(b=>{g[b.load_type]||(g[b.load_type]={load_type:b.load_type,total_loads:0,days:new Set}),g[b.load_type].total_loads+=b.load_count,g[b.load_type].days.add(b.work_date)}),Object.values(g).map(b=>({load_type:b.load_type,total_loads:b.total_loads,days_with_activity:b.days.size}))},async getWeeklyDisposalSummary(r,l=4){if(!y)return[];const i=L();if(!i)return[];const s=new Date,u=new Date;u.setDate(u.getDate()-l*7);const{data:d,error:m}=await i.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r).gte("work_date",u.toISOString().split("T")[0]).lte("work_date",s.toISOString().split("T")[0]).order("work_date",{ascending:!0});if(m)throw m;const g={};return d?.forEach(b=>{const x=new Date(b.work_date),z=new Date(x);z.setDate(x.getDate()-x.getDay());const E=z.toISOString().split("T")[0];g[E]||(g[E]={week:E,concrete:0,trash:0,metals:0,hazardous_waste:0}),g[E][b.load_type]+=b.load_count}),Object.values(g).sort((b,x)=>b.week.localeCompare(x.week))},async uploadPhoto(r,l,i,s){if(!y)return null;const u=L();if(!u)throw new Error("Database client not available");const d=performance.now(),m=s.size||0,g=Date.now(),b=new Uint8Array(6);crypto.getRandomValues(b);const x=Array.from(b,X=>X.toString(36)).join(""),z=s.name?.split(".").pop()||"jpg",E=`${g}-${x}.${z}`,k=`${r}/${l}/${i}/${E}`;try{const{error:X}=await u.storage.from("tm-photos").upload(k,s,{cacheControl:"3600",upsert:!1}),H=Math.round(performance.now()-d);if(w.storage("upload",{company_id:r,project_id:l,size:m,duration:H,success:!X}),X)throw X;return k}catch(X){throw w.error("storage",{message:X.message,operation:"uploadPhoto",company_id:r,project_id:l}),X}},async uploadPhotoBase64(r,l,i,s,u="photo.jpg"){if(!y)return null;const d=L();if(!d)throw new Error("Database client not available");const g=await(await fetch(s)).blob(),b=Date.now(),x=new Uint8Array(6);crypto.getRandomValues(x);const z=Array.from(x,Y=>Y.toString(36)).join(""),E=u.split(".").pop()||"jpg",k=`${b}-${z}.${E}`,X=`${r}/${l}/${i}/${k}`,{error:H}=await d.storage.from("tm-photos").upload(X,g,{cacheControl:"3600",upsert:!1,contentType:g.type});if(H)throw H;return X},async resolvePhotoUrl(r){if(!r||!y)return r;let l;if(r.startsWith("http"))try{const s=new URL(r).pathname.match(/\/(?:public\/)?tm-photos\/(.+)$/);if(!s)return r;l=decodeURIComponent(s[1])}catch{return r}else l=r;try{const i=yc(),{data:s,error:u}=await i.storage.from("tm-photos").createSignedUrl(l,3600);return u||!s?.signedUrl?null:s.signedUrl}catch{return null}},async resolvePhotoUrls(r){if(!y||!r?.length)return r||[];const l=[],i=[];for(let s=0;s<r.length;s++){const u=r[s];if(!u)continue;let d;if(u.startsWith("http"))try{const g=new URL(u).pathname.match(/\/(?:public\/)?tm-photos\/(.+)$/);g&&(d=decodeURIComponent(g[1]))}catch{}else d=u;d&&(l.push(d),i.push(s))}if(!l.length)return r;try{const s=yc(),{data:u,error:d}=await s.storage.from("tm-photos").createSignedUrls(l,3600);if(d||!u)return r;const m=[...r];return u.forEach((g,b)=>{m[i[b]]=g.signedUrl||null}),m}catch{return r}},async deletePhoto(r){if(!y||!r)return;let l;if(r.startsWith("http"))try{const u=new URL(r).pathname.match(/\/tm-photos\/(.+)$/);if(!u)return;l=u[1]}catch{return}else l=r;const{error:i}=await h.storage.from("tm-photos").remove([l]);if(i)throw i},async verifyPhotoAccessible(r){if(!y||!r)return{accessible:!1,error:"Invalid input"};let l;if(r.startsWith("http"))try{const s=new URL(r).pathname.match(/\/(?:public\/)?tm-photos\/(.+)$/);if(!s)return{accessible:!1,error:"Not a tm-photos URL"};l=decodeURIComponent(s[1])}catch{return{accessible:!1,error:"Invalid URL"}}else l=r;try{const{data:i,error:s}=await h.storage.from("tm-photos").createSignedUrl(l,60);return s?{accessible:!1,error:s.message}:{accessible:!!i?.signedUrl,status:200}}catch(i){return{accessible:!1,error:i.message||"Verification failed"}}},async verifyTicketPhotos(r){if(!y)return{verified:!1,issues:[]};try{const{data:l,error:i}=await h.from("t_and_m_tickets").select("photos").eq("id",r).single();if(i)throw i;if(!l?.photos||l.photos.length===0)return await h.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:"empty",photos_issue_count:0}).eq("id",r),{verified:!0,status:"empty",issues:[]};const s=[];for(const d of l.photos){const m=await this.verifyPhotoAccessible(d);m.accessible||s.push({url:d,error:m.error})}const u=s.length===0?"verified":"issues";return await h.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:u,photos_issue_count:s.length}).eq("id",r),{verified:s.length===0,status:u,totalPhotos:l.photos.length,issues:s}}catch(l){return w.error("database",{message:l?.message||"Error verifying ticket photos",operation:"verifyTicketPhotos"}),{verified:!1,error:l.message,issues:[]}}},async queuePhotoUpload(r,l,i,s){if(!y)return null;const{data:u,error:d}=await h.from("photo_upload_queue").insert({ticket_id:r,temp_id:l,file_name:i,file_size_bytes:s,status:"pending"}).select().single();return d?(w.error("database",{message:d?.message||"Error queueing photo upload",operation:"queuePhotoUpload"}),null):u},async confirmQueuedUpload(r,l,i){if(!y)return!1;const{data:s,error:u}=await h.rpc("confirm_photo_upload",{p_queue_id:r,p_uploaded_url:l,p_storage_path:i});return u?(w.error("database",{message:u?.message||"Error confirming photo upload",operation:"confirmQueuedUpload"}),!1):s===!0},async markQueuedUploadFailed(r,l){if(!y)return!1;const{data:i,error:s}=await h.rpc("mark_photo_upload_failed",{p_queue_id:r,p_error:l});return s?(w.error("database",{message:s?.message||"Error marking photo upload failed",operation:"markQueuedUploadFailed"}),!1):i===!0},async getPendingPhotoUploads(r){if(!y)return[];const{data:l,error:i}=await h.rpc("get_pending_photo_uploads",{p_ticket_id:r});return i?(w.error("database",{message:i?.message||"Error getting pending photo uploads",operation:"getPendingPhotoUploads"}),[]):l||[]},async logPhotoOperation(r,l,i={}){if(y)try{await h.from("photo_audit_log").insert({ticket_id:r,cor_id:i.corId||null,operation:l,photo_url:i.photoUrl||null,storage_path:i.storagePath||null,details:i.metadata?i.metadata:null,error_message:i.error||null,triggered_by:i.triggeredBy||"system"})}catch(s){w.error("database",{message:s?.message||"Error logging photo operation",operation:"logPhotoOperation"})}},async saveExportSnapshot(r,l,i={}){if(!y)return null;const{exportType:s="pdf",exportReason:u=null,clientEmail:d=null,clientName:m=null}=i;try{const{data:g,error:b}=await h.from("cor_export_snapshots").insert({cor_id:r,export_type:s,export_reason:u,cor_data:l.cor_data,tickets_data:l.tickets_data,photos_manifest:l.photos_manifest,totals_snapshot:l.totals_snapshot,checksum:l.checksum,client_email:d,client_name:m}).select().single();if(b)throw b;return g}catch(g){return w.error("database",{message:g?.message||"Error saving export snapshot",operation:"saveExportSnapshot"}),null}},async getExportSnapshots(r){if(!y)return[];const{data:l,error:i}=await h.from("cor_export_snapshots").select("id, exported_at, export_type, export_reason, client_name, client_email, checksum").eq("cor_id",r).order("exported_at",{ascending:!1});return i?(w.error("database",{message:i?.message||"Error fetching export snapshots",operation:"getExportSnapshots"}),[]):l||[]},async getExportSnapshot(r){if(!y)return null;const{data:l,error:i}=await h.from("cor_export_snapshots").select("*").eq("id",r).single();return i?(w.error("database",{message:i?.message||"Error fetching export snapshot",operation:"getExportSnapshot"}),null):l},async requestCORExport(r,l,i={}){if(!y)return null;try{const s=await h.auth.getUser(),{data:u,error:d}=await h.rpc("request_cor_export",{p_cor_id:r,p_idempotency_key:l,p_options:i,p_requested_by:s?.data?.user?.id||null});if(d)throw d;return u?.[0]||null}catch(s){throw w.error("database",{message:s.message,operation:"requestCORExport",extra:{corId:r}}),s}},async getExportJob(r){if(!y)return null;const{data:l,error:i}=await h.from("cor_export_jobs").select("*").eq("id",r).single();return i?(w.error("database",{message:i?.message||"Error fetching export job",operation:"getExportJob"}),null):l},async getExportJobs(r,l=10){if(!y)return[];const{data:i,error:s}=await h.from("cor_export_jobs").select("*").eq("cor_id",r).order("created_at",{ascending:!1}).limit(l);return s?(w.error("database",{message:s?.message||"Error fetching export jobs",operation:"getExportJobs"}),[]):i||[]},async updateExportJobStatus(r,l,i={}){if(!y)return null;try{const{data:s,error:u}=await h.rpc("update_export_job_status",{p_job_id:r,p_status:l,p_snapshot_id:i.snapshotId||null,p_pdf_url:i.pdfUrl||null,p_error:i.error||null,p_error_details:i.errorDetails||null,p_metrics:i.metrics||null});if(u)throw u;return s}catch(s){throw w.error("database",{message:s.message,operation:"updateExportJobStatus",extra:{jobId:r,status:l}}),s}},async getCurrentCORSnapshot(r){if(!y)return null;const{data:l}=await h.from("change_orders").select("version, last_snapshot_version").eq("id",r).single();if(!l||l.version!==l.last_snapshot_version)return null;const{data:i}=await h.from("cor_export_snapshots").select("*").eq("cor_id",r).eq("is_current",!0).single();return i||null},async saveCORSnapshot(r,l){if(!y)return null;try{await h.from("cor_export_snapshots").update({is_current:!1}).eq("cor_id",r.corId);const i=await h.auth.getUser(),{data:s,error:u}=await h.from("cor_export_snapshots").insert({id:r.snapshotId,cor_id:r.corId,job_id:l,cor_version:r.corVersion,cor_data:r.corData,tickets_data:r.ticketsData,photos_manifest:r.photoManifest,totals_snapshot:r.totals,checksum:r.checksum,is_current:!0,exported_by:i?.data?.user?.id||null}).select().single();if(u)throw u;return await h.from("change_orders").update({last_snapshot_version:r.corVersion}).eq("id",r.corId),s}catch(i){throw w.error("database",{message:i.message,operation:"saveCORSnapshot",extra:{corId:r.corId}}),i}},async updateCORAggregatedStats(r){if(y)try{await h.rpc("update_cor_aggregated_stats",{p_cor_id:r})}catch(l){w.error("database",{message:l?.message||"Error updating COR aggregated stats",operation:"updateCORAggregatedStats"})}},async getCrewCheckin(r,l=null){if(!y)return null;const i=l||new Date().toISOString().split("T")[0],s=L(),{data:u,error:d}=await s.from("crew_checkins").select("*").eq("project_id",r).eq("check_in_date",i).maybeSingle();return d&&w.error("database",{message:d?.message||"Error fetching crew checkin",operation:"getCrewCheckin"}),u},async saveCrewCheckin(r,l,i=null,s=null){if(!y)return null;const u=s||new Date().toISOString().split("T")[0];if(!Kt()){const b={id:Et(),project_id:r,check_in_date:u,workers:l,created_by:i,updated_at:new Date().toISOString(),_offline:!0};return await Ri(b),await zt(Ge.SAVE_CREW_CHECKIN,{projectId:r,workers:l,checkInDate:u}),b}const d=L();if(!d){const b={id:Et(),project_id:r,check_in_date:u,workers:l,created_by:i,updated_at:new Date().toISOString(),_offline:!0};return await Ri(b),await zt(Ge.SAVE_CREW_CHECKIN,{projectId:r,workers:l,checkInDate:u}),b}const{data:m,error:g}=await d.from("crew_checkins").upsert({project_id:r,check_in_date:u,workers:l,created_by:i,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(g){if(g.message?.includes("fetch")||g.message?.includes("network")){const b={id:Et(),project_id:r,check_in_date:u,workers:l,_offline:!0};return await Ri(b),await zt(Ge.SAVE_CREW_CHECKIN,{projectId:r,workers:l,checkInDate:u}),b}throw w.error("database",{message:g?.message||"Error saving crew checkin",operation:"saveCrewCheckin"}),g}return m&&Ri(m).catch(b=>w.error("database",{message:b?.message||"Failed to cache checkin",operation:"saveCrewCheckin"})),m},async addCrewMember(r,l,i=null){if(!y)return null;const s=await this.getCrewCheckin(r),u=s?.workers||[];return u.find(d=>d.name.toLowerCase()===l.name.toLowerCase())?s:(u.push(l),await this.saveCrewCheckin(r,u,i))},async removeCrewMember(r,l){if(!y)return null;const i=await this.getCrewCheckin(r);if(!i)return null;const s=i.workers.filter(u=>u.name.toLowerCase()!==l.toLowerCase());return await this.saveCrewCheckin(r,s,i.created_by)},async getCrewCheckinHistory(r,l=30){if(!y)return[];const i=L();if(!i)return[];const{data:s,error:u}=await i.from("crew_checkins").select("*").eq("project_id",r).order("check_in_date",{ascending:!1}).limit(l);return u?(w.error("database",{message:u?.message||"Error fetching crew history",operation:"getCrewCheckinHistory"}),[]):s||[]},async getRecentWorkers(r,l=30){if(!y)return[];const i=await this.getCrewCheckinHistory(r,l),s=new Map;return i.forEach(u=>{(u.workers||[]).forEach(d=>{const m=d.name.toLowerCase();s.has(m)||s.set(m,{name:d.name,role:d.role,labor_class_id:d.labor_class_id||null,lastSeen:u.check_in_date})})}),Array.from(s.values()).sort((u,d)=>u.name.localeCompare(d.name))},async getLaborRates(r,l=null,i=null){if(!y)return[];let s=h.from("labor_rates").select("*").eq("company_id",r);l&&(s=s.eq("work_type",l)),i&&(s=s.eq("job_type",i));const{data:u,error:d}=await s;return d?(w.error("database",{message:d?.message||"Error fetching labor rates",operation:"getLaborRates"}),[]):u||[]},async calculateManDayCosts(r,l,i,s){if(!y)return{totalCost:0,totalManDays:0,breakdown:[]};const u=await this.getCrewCheckinHistory(r,365),d=await this.getLaborRates(l,i,s),m={};d.forEach(E=>{m[E.role.toLowerCase()]=parseFloat(E.regular_rate)||0});let g=0,b=0;const x={},z=[];return u.forEach(E=>{const k=E.workers||[];let X=0;const H={};k.forEach(Y=>{const G=(Y.role||"laborer").toLowerCase(),oe=m[G]||0;H[G]||(H[G]={count:0,cost:0}),H[G].count++,H[G].cost+=oe,X+=oe,x[G]||(x[G]={count:0,cost:0,rate:oe}),x[G].count++,x[G].cost+=oe}),g+=X,b+=k.length,z.push({date:E.check_in_date,workers:k.length,cost:X,breakdown:H})}),{totalCost:g,totalManDays:b,byRole:x,byDate:z,daysWorked:u.length}},async getDailyReport(r,l=null){if(!y)return null;const i=l||new Date().toISOString().split("T")[0],s=L(),{data:u,error:d}=await s.from("daily_reports").select("*").eq("project_id",r).eq("report_date",i).maybeSingle();return d&&w.error("database",{message:d?.message||"Error fetching daily report",operation:"getDailyReport"}),u},async compileDailyReport(r,l=null){if(!y)return null;const i=l||new Date().toISOString().split("T")[0],s=L(),[u,d,m]=await Promise.all([this.getCrewCheckin(r,i),s.from("areas").select("*").eq("project_id",r),s.from("t_and_m_tickets").select("*").eq("project_id",r).eq("work_date",i)]),g=d?.data||[],b=m?.data||[],x=g.filter(E=>E.status==="done"&&E.completed_at?.startsWith(i)),z=b.reduce((E,k)=>E+(k.photos?.length||0),0);return{crew_count:u?.workers?.length||0,crew_list:u?.workers||[],tasks_completed:x.length,tasks_total:g.length,completed_tasks:x.map(E=>({name:E.name,group:E.group_name})),tm_tickets_count:b.length,photos_count:z}},async saveDailyReport(r,l,i=null){if(!y)return null;const s=i||new Date().toISOString().split("T")[0];if(!Kt()){const g={id:Et(),project_id:r,report_date:s,...l,updated_at:new Date().toISOString(),_offline:!0};return await gr(g),g}const u=L(),{data:d,error:m}=await u.from("daily_reports").upsert({project_id:r,report_date:s,...l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(m){if(m.message?.includes("fetch")||m.message?.includes("network")){const g={id:Et(),project_id:r,report_date:s,...l,_offline:!0};return await gr(g),g}throw w.error("database",{message:m?.message||"Error saving daily report",operation:"saveDailyReport"}),m}return d&&gr(d).catch(g=>w.error("database",{message:g?.message||"Failed to cache report",operation:"saveDailyReport"})),d},async submitDailyReport(r,l,i=null){if(!y)return null;const s=i||new Date().toISOString().split("T")[0];if(!Kt()){const b=await Wg(r,s),x={id:Et(),project_id:r,report_date:s,...b||{},status:"pending_sync",submitted_by:l,submitted_at:new Date().toISOString(),_offline:!0};return await gr(x),await zt(Ge.SUBMIT_DAILY_REPORT,{projectId:r,reportData:b||{},submittedBy:l}),x}const u=await this.compileDailyReport(r,s),d=L();if(!d)throw new Error("Database client not available");const{data:m,error:g}=await d.from("daily_reports").upsert({project_id:r,report_date:s,...u,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(g){if(g.message?.includes("fetch")||g.message?.includes("network")){const b={id:Et(),project_id:r,report_date:s,...u,status:"pending_sync",submitted_by:l,_offline:!0};return await gr(b),await zt(Ge.SUBMIT_DAILY_REPORT,{projectId:r,reportData:u,submittedBy:l}),b}throw w.error("database",{message:g?.message||"Error submitting daily report",operation:"submitDailyReport"}),g}return m&&gr(m).catch(b=>w.error("database",{message:b?.message||"Failed to cache report",operation:"submitDailyReport"})),m},async getDailyReports(r,l=30){if(!y)return[];const i=L();if(!i)return[];const{data:s,error:u}=await i.from("daily_reports").select("*").eq("project_id",r).order("report_date",{ascending:!1}).limit(l);return u?(w.error("database",{message:u?.message||"Error fetching daily reports",operation:"getDailyReports"}),[]):s||[]},async sendMessage(r,l,i,s,u=null,d=null,m="general",g=null){if(!y)return null;if(!Kt()){const z={id:Et(),project_id:r,sender_type:i,sender_name:s,sender_user_id:u,message:l,photo_url:d,message_type:m,parent_message_id:g,created_at:new Date().toISOString(),_offline:!0};return await zm(z),await zt(Ge.SEND_MESSAGE,{projectId:r,senderType:i,senderName:s,content:l}),z}const{data:b,error:x}=await h.from("messages").insert({project_id:r,sender_type:i,sender_name:s,sender_user_id:u,message:l,photo_url:d,message_type:m,parent_message_id:g}).select().single();if(x){if(x.message?.includes("fetch")||x.message?.includes("network")){const z={id:Et(),project_id:r,sender_type:i,sender_name:s,message:l,created_at:new Date().toISOString(),_offline:!0};return await zm(z),await zt(Ge.SEND_MESSAGE,{projectId:r,senderType:i,senderName:s,content:l}),z}throw w.error("database",{message:x?.message||"Error sending message",operation:"sendMessage"}),x}return b},async getMessages(r,l=50){if(!y)return[];const i=L(),{data:s,error:u}=await i.from("messages").select("*").eq("project_id",r).order("created_at",{ascending:!1}).limit(l);return u?[]:s||[]},async getUnreadCount(r,l){if(!y)return 0;const i=L(),s=l==="field"?"office":"field",{count:u,error:d}=await i.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("sender_type",s).eq("is_read",!1);return d?0:u||0},async markMessagesRead(r,l){if(!y)return;const i=L(),s=l==="field"?"office":"field";await i.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",r).eq("sender_type",s).eq("is_read",!1)},async createMaterialRequest(r,l,i,s=null,u="normal",d=null){if(!y)return null;if(!Kt()){const b={id:Et(),project_id:r,items:l,requested_by:i,needed_by:s,priority:u,notes:d,status:"pending_sync",created_at:new Date().toISOString(),_offline:!0};return await zt(Ge.CREATE_MATERIAL_REQUEST,{projectId:r,items:l,requestedBy:i,neededBy:s,priority:u,notes:d}),b}const{data:m,error:g}=await h.from("material_requests").insert({project_id:r,items:l,requested_by:i,needed_by:s,priority:u,notes:d}).select().single();if(g){if(g.message?.includes("fetch")||g.message?.includes("network")){const b={id:Et(),project_id:r,items:l,requested_by:i,status:"pending_sync",_offline:!0};return await zt(Ge.CREATE_MATERIAL_REQUEST,{projectId:r,items:l,requestedBy:i,neededBy:s,priority:u,notes:d}),b}throw w.error("database",{message:g?.message||"Error creating material request",operation:"createMaterialRequest"}),g}return m},async getMaterialRequests(r,l=null){if(!y)return[];let i=h.from("material_requests").select("*").eq("project_id",r).order("created_at",{ascending:!1});l&&(i=i.eq("status",l));const{data:s,error:u}=await i;return u?(w.error("database",{message:u?.message||"Error fetching material requests",operation:"getMaterialRequests"}),[]):s||[]},async getPendingRequestsCount(r){if(!y)return 0;const{count:l,error:i}=await h.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("status","pending");return i?0:l||0},async updateMaterialRequest(r,l,i,s=null,u=null){if(!y)return null;const d={status:l,responded_by:i,responded_at:new Date().toISOString(),response_notes:s,updated_at:new Date().toISOString()};u&&(d.expected_delivery=u),l==="delivered"&&(d.delivered_at=new Date().toISOString());const{data:m,error:g}=await h.from("material_requests").update(d).eq("id",r).select().single();if(g)throw w.error("database",{message:g?.message||"Error updating material request",operation:"updateMaterialRequest"}),g;return m},generateShareToken(){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",l=new Uint8Array(12);return crypto.getRandomValues(l),Array.from(l,i=>r[i%r.length]).join("")},async createProjectShare(r,l,i,s=null){if(!y){const b=Q();b.projectShares||(b.projectShares=[]);const x={id:crypto.randomUUID(),project_id:r,share_token:this.generateShareToken(),created_by:l,expires_at:s,is_active:!0,permissions:i,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return b.projectShares.push(x),te(b),x}const{data:u,error:d}=await h.rpc("generate_share_token");if(d)throw w.error("database",{message:d?.message||"Error generating share token",operation:"createProjectShare"}),d;const{data:m,error:g}=await h.from("project_shares").insert({project_id:r,share_token:u,created_by:l,expires_at:s,permissions:i}).select().single();if(g)throw w.error("database",{message:g?.message||"Error creating project share",operation:"createProjectShare"}),g;return m},async getShareByToken(r){if(!y){const s=Q();if(!s.projectShares)return null;const u=s.projectShares.find(d=>d.share_token===r&&d.is_active&&(!d.expires_at||new Date(d.expires_at)>new Date));return u&&(u.view_count++,u.last_viewed_at=new Date().toISOString(),te(s)),u}const{data:l,error:i}=await h.from("project_shares").select("*, projects(*)").eq("share_token",r).eq("is_active",!0).single();return i?(w.error("database",{message:i?.message||"Error fetching share by token",operation:"getShareByToken"}),null):l.expires_at&&new Date(l.expires_at)<new Date?null:(await h.rpc("increment_share_view_count",{token:r}),l)},async getProjectShares(r){if(!y){const s=Q();return s.projectShares?s.projectShares.filter(u=>u.project_id===r):[]}const{data:l,error:i}=await h.from("project_shares").select("*, users(name, email)").eq("project_id",r).order("created_at",{ascending:!1});return i?(w.error("database",{message:i?.message||"Error fetching project shares",operation:"getProjectShares"}),[]):l||[]},async updateProjectShare(r,l){if(!y){const u=Q();if(!u.projectShares)return null;const d=u.projectShares.findIndex(m=>m.id===r);return d===-1?null:(u.projectShares[d]={...u.projectShares[d],...l,updated_at:new Date().toISOString()},te(u),u.projectShares[d])}const{data:i,error:s}=await h.from("project_shares").update(l).eq("id",r).select().single();if(s)throw w.error("database",{message:s?.message||"Error updating project share",operation:"updateProjectShare"}),s;return i},async revokeProjectShare(r){return this.updateProjectShare(r,{is_active:!1})},async deleteProjectShare(r){if(!y){const i=Q();if(!i.projectShares)return;i.projectShares=i.projectShares.filter(s=>s.id!==r),te(i);return}const{error:l}=await h.from("project_shares").delete().eq("id",r);if(l)throw w.error("database",{message:l?.message||"Error deleting project share",operation:"deleteProjectShare"}),l},async getPublicProjectData(r){const l=await this.getShareByToken(r);if(!l)return null;const i=l.project_id||l.projects?.id;if(!y){const d=Q(),m=d.projects.find(E=>E.id===i);if(!m)return null;const g=d.areas.filter(E=>E.project_id===i),b=g.reduce((E,k)=>E+parseFloat(k.weight||0),0),x=g.filter(E=>E.status==="done").reduce((E,k)=>E+parseFloat(k.weight||0),0),z=b>0?Math.round(x/b*100):0;return{share:l,project:m,progress:z,areas:l.permissions.progress?g:[],photos:[],dailyReports:[],tmTickets:[]}}const s=l.projects||await this.getProject(i);if(!s)return null;const u={share:l,project:s,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(l.permissions.progress){u.areas=await this.getAreas(i);const d=u.areas.reduce((g,b)=>g+parseFloat(b.weight||0),0),m=u.areas.filter(g=>g.status==="done").reduce((g,b)=>g+parseFloat(b.weight||0),0);u.progress=d>0?Math.round(m/d*100):0}if(l.permissions.photos){const{data:d}=await h.from("t_and_m_tickets").select("photos, work_date").eq("project_id",i).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);u.photos=d?.flatMap(m=>(m.photos||[]).map(g=>({url:g,date:m.work_date})))||[]}if(l.permissions.daily_reports){const{data:d}=await h.from("daily_reports").select("*").eq("project_id",i).order("report_date",{ascending:!1}).limit(10);u.dailyReports=d||[]}return l.permissions.tm_tickets&&(u.tmTickets=await this.getTMTickets(i)),u},async createInjuryReport(r){if(!y){const s=Q();s.injuryReports||(s.injuryReports=[]);const u={id:crypto.randomUUID(),...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return s.injuryReports.push(u),te(s),u}const{data:l,error:i}=await h.from("injury_reports").insert(r).select().single();if(i)throw w.error("database",{message:i?.message||"Error creating injury report",operation:"createInjuryReport"}),i;return l},async getInjuryReports(r){if(!y){const s=Q();return s.injuryReports?s.injuryReports.filter(u=>u.project_id===r).sort((u,d)=>new Date(d.incident_date)-new Date(u.incident_date)):[]}const{data:l,error:i}=await h.from("injury_reports").select("*").eq("project_id",r).order("incident_date",{ascending:!1});return i?(w.error("database",{message:i?.message||"Error fetching injury reports",operation:"getInjuryReports"}),[]):l||[]},async getCompanyInjuryReports(r,l=null){if(!y){const d=Q();if(!d.injuryReports)return[];let m=d.injuryReports.filter(g=>g.company_id===r);return l&&(m=m.filter(g=>g.status===l)),m.sort((g,b)=>new Date(b.incident_date)-new Date(g.incident_date))}let i=h.from("injury_reports").select("*, projects(name)").eq("company_id",r).order("incident_date",{ascending:!1});l&&(i=i.eq("status",l));const{data:s,error:u}=await i;return u?(w.error("database",{message:u?.message||"Error fetching company injury reports",operation:"getCompanyInjuryReports"}),[]):s||[]},async getInjuryReport(r){if(!y){const s=Q();return s.injuryReports?s.injuryReports.find(u=>u.id===r):null}const{data:l,error:i}=await h.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",r).single();return i?(w.error("database",{message:i?.message||"Error fetching injury report",operation:"getInjuryReport"}),null):l},async updateInjuryReport(r,l){if(!y){const u=Q();if(!u.injuryReports)return null;const d=u.injuryReports.findIndex(m=>m.id===r);return d===-1?null:(u.injuryReports[d]={...u.injuryReports[d],...l,updated_at:new Date().toISOString()},te(u),u.injuryReports[d])}const{data:i,error:s}=await h.from("injury_reports").update(l).eq("id",r).select().single();if(s)throw w.error("database",{message:s?.message||"Error updating injury report",operation:"updateInjuryReport"}),s;return i},async closeInjuryReport(r,l){return this.updateInjuryReport(r,{status:"closed",closed_at:new Date().toISOString(),closed_by:l})},async deleteInjuryReport(r){if(!y){const i=Q();if(!i.injuryReports)return;i.injuryReports=i.injuryReports.filter(s=>s.id!==r),te(i);return}const{error:l}=await h.from("injury_reports").delete().eq("id",r);if(l)throw w.error("database",{message:l?.message||"Error deleting injury report",operation:"deleteInjuryReport"}),l},async getInjuryStatistics(r,l=null,i=null){if(!y){const d=Q();if(!d.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let m=d.injuryReports.filter(g=>g.company_id===r);return l&&(m=m.filter(g=>new Date(g.incident_date)>=new Date(l))),i&&(m=m.filter(g=>new Date(g.incident_date)<=new Date(i))),{total_incidents:m.length,minor_injuries:m.filter(g=>g.injury_type==="minor").length,serious_injuries:m.filter(g=>g.injury_type==="serious").length,critical_injuries:m.filter(g=>g.injury_type==="critical").length,near_misses:m.filter(g=>g.injury_type==="near_miss").length,osha_recordable:m.filter(g=>g.osha_recordable).length,total_days_away:m.reduce((g,b)=>g+(b.days_away_from_work||0),0),total_restricted_days:m.reduce((g,b)=>g+(b.restricted_work_days||0),0)}}const{data:s,error:u}=await h.rpc("get_injury_statistics",{comp_id:r,start_date:l,end_date:i});return u?(w.error("database",{message:u?.message||"Error fetching injury statistics",operation:"getInjuryStatistics"}),null):s[0]||null},async addWitness(r,l){if(!y){const u=Q();if(!u.injuryReports)return null;const d=u.injuryReports.findIndex(b=>b.id===r);if(d===-1)return null;const m=u.injuryReports[d],g=m.witnesses||[];return g.push(l),u.injuryReports[d]={...m,witnesses:g,updated_at:new Date().toISOString()},te(u),u.injuryReports[d]}const i=await this.getInjuryReport(r);if(!i)return null;const s=i.witnesses||[];return s.push(l),this.updateInjuryReport(r,{witnesses:s})},async removeWitness(r,l){if(!y){const u=Q();if(!u.injuryReports)return null;const d=u.injuryReports.findIndex(b=>b.id===r);if(d===-1)return null;const m=u.injuryReports[d],g=m.witnesses||[];return g.splice(l,1),u.injuryReports[d]={...m,witnesses:g,updated_at:new Date().toISOString()},te(u),u.injuryReports[d]}const i=await this.getInjuryReport(r);if(!i)return null;const s=i.witnesses||[];return s.splice(l,1),this.updateInjuryReport(r,{witnesses:s})},async getCompanyUsers(r){if(y){const{data:l,error:i}=await h.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",r);return i?(w.error("database",{message:i?.message||"Error fetching company users",operation:"getCompanyUsers"}),[]):l?.map(s=>({id:s.user_id,name:s.users?.name||s.users?.email,email:s.users?.email,role:s.role}))||[]}return[]},async getProjectNotificationPreferences(r){if(y){const{data:i,error:s}=await h.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",r);return s?(w.error("database",{message:s?.message||"Error fetching notification preferences",operation:"getProjectNotificationPreferences"}),[]):i||[]}const l=Q();return l.notificationPreferences?l.notificationPreferences.filter(i=>i.project_id===r):[]},async getUserNotificationPreferences(r){if(y){const{data:i,error:s}=await h.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",r);return s?(w.error("database",{message:s?.message||"Error fetching user notification preferences",operation:"getUserNotificationPreferences"}),[]):i||[]}const l=Q();return l.notificationPreferences?l.notificationPreferences.filter(i=>i.user_id===r):[]},async setNotificationPreference(r,l,i){if(y){const{data:m,error:g}=await h.from("notification_preferences").upsert({project_id:r,user_id:l,notification_types:i,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(g)throw w.error("database",{message:g?.message||"Error setting notification preference",operation:"setNotificationPreference"}),g;return m}const s=Q();s.notificationPreferences||(s.notificationPreferences=[]);const u=s.notificationPreferences.findIndex(m=>m.project_id===r&&m.user_id===l),d={id:u>=0?s.notificationPreferences[u].id:crypto.randomUUID(),project_id:r,user_id:l,notification_types:i,created_at:u>=0?s.notificationPreferences[u].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return u>=0?s.notificationPreferences[u]=d:s.notificationPreferences.push(d),te(s),d},async removeNotificationPreference(r,l){if(y){const{error:s}=await h.from("notification_preferences").delete().eq("project_id",r).eq("user_id",l);if(s)throw w.error("database",{message:s?.message||"Error removing notification preference",operation:"removeNotificationPreference"}),s;return!0}const i=Q();return i.notificationPreferences&&(i.notificationPreferences=i.notificationPreferences.filter(s=>!(s.project_id===r&&s.user_id===l)),te(i)),!0},async setProjectNotificationPreferences(r,l){const i=[];for(const s of l)if(s.notificationTypes&&s.notificationTypes.length>0){const u=await this.setNotificationPreference(r,s.userId,s.notificationTypes);i.push(u)}else await this.removeNotificationPreference(r,s.userId);return i},async getNotificationPresets(r){if(y){const{data:i,error:s}=await h.from("notification_presets").select("*").eq("company_id",r).order("name");return s?(w.error("database",{message:s?.message||"Error fetching notification presets",operation:"getNotificationPresets"}),[]):i||[]}const l=Q();return l.notificationPresets?l.notificationPresets.filter(i=>i.company_id===r):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:r},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:r},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:r},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:r}]},async createNotificationPreset(r,l,i){if(y){const{data:d,error:m}=await h.from("notification_presets").insert({company_id:r,name:l,notification_types:i}).select().single();if(m)throw w.error("database",{message:m?.message||"Error creating notification preset",operation:"createNotificationPreset"}),m;return d}const s=Q();s.notificationPresets||(s.notificationPresets=[]);const u={id:crypto.randomUUID(),company_id:r,name:l,notification_types:i,created_at:new Date().toISOString()};return s.notificationPresets.push(u),te(s),u},async updateNotificationPreset(r,l,i){if(y){const{data:d,error:m}=await h.from("notification_presets").update({name:l,notification_types:i,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(m)throw w.error("database",{message:m?.message||"Error updating notification preset",operation:"updateNotificationPreset"}),m;return d}const s=Q();if(!s.notificationPresets)return null;const u=s.notificationPresets.findIndex(d=>d.id===r);return u===-1?null:(s.notificationPresets[u]={...s.notificationPresets[u],name:l,notification_types:i,updated_at:new Date().toISOString()},te(s),s.notificationPresets[u])},async deleteNotificationPreset(r){if(y){const{error:i}=await h.from("notification_presets").delete().eq("id",r);if(i)throw w.error("database",{message:i?.message||"Error deleting notification preset",operation:"deleteNotificationPreset"}),i;return!0}const l=Q();return l.notificationPresets&&(l.notificationPresets=l.notificationPresets.filter(i=>i.id!==r),te(l)),!0},async getDumpSites(r){if(y){const{data:i,error:s}=await h.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",r).eq("active",!0).order("name");return s?(w.error("database",{message:s?.message||"Error fetching dump sites",operation:"getDumpSites"}),[]):i||[]}return(Q().dumpSites||[]).filter(i=>i.company_id===r&&i.active)},async createDumpSite(r,l,i="",s=""){if(y){const{data:m,error:g}=await h.from("dump_sites").insert({company_id:r,name:l,address:i,notes:s,active:!0}).select().single();if(g)throw w.error("database",{message:g?.message||"Error creating dump site",operation:"createDumpSite"}),g;return m}const u=Q();u.dumpSites||(u.dumpSites=[]);const d={id:crypto.randomUUID(),company_id:r,name:l,address:i,notes:s,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return u.dumpSites.push(d),te(u),d},async updateDumpSite(r,l){if(y){const{data:u,error:d}=await h.from("dump_sites").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(d)throw w.error("database",{message:d?.message||"Error updating dump site",operation:"updateDumpSite"}),d;return u}const i=Q();if(!i.dumpSites)return null;const s=i.dumpSites.findIndex(u=>u.id===r);return s===-1?null:(i.dumpSites[s]={...i.dumpSites[s],...l},te(i),i.dumpSites[s])},async deleteDumpSite(r){return this.updateDumpSite(r,{active:!1})},async setDumpSiteRate(r,l,i,s="load"){if(y){const{data:g}=await h.from("dump_site_rates").select("id").eq("dump_site_id",r).eq("waste_type",l).maybeSingle();if(g){const{data:b,error:x}=await h.from("dump_site_rates").update({estimated_cost_per_load:i,unit:s}).eq("id",g.id).select().single();if(x)throw w.error("database",{message:x?.message||"Error updating dump site rate",operation:"setDumpSiteRate"}),x;return b}else{const{data:b,error:x}=await h.from("dump_site_rates").insert({dump_site_id:r,waste_type:l,estimated_cost_per_load:i,unit:s}).select().single();if(x)throw w.error("database",{message:x?.message||"Error inserting dump site rate",operation:"setDumpSiteRate"}),x;return b}}const u=Q();u.dumpSiteRates||(u.dumpSiteRates=[]);const d=u.dumpSiteRates.findIndex(g=>g.dump_site_id===r&&g.waste_type===l),m={id:d>=0?u.dumpSiteRates[d].id:crypto.randomUUID(),dump_site_id:r,waste_type:l,estimated_cost_per_load:i,unit:s,created_at:new Date().toISOString()};return d>=0?u.dumpSiteRates[d]=m:u.dumpSiteRates.push(m),te(u),m},async getDumpSiteRates(r){if(y){const{data:i,error:s}=await h.from("dump_site_rates").select("*").eq("dump_site_id",r);return s?(w.error("database",{message:s?.message||"Error fetching dump site rates",operation:"getDumpSiteRates"}),[]):i||[]}return(Q().dumpSiteRates||[]).filter(i=>i.dump_site_id===r)},async getHaulOffs(r){if(y){const{data:i,error:s}=await h.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",r).order("work_date",{ascending:!1});return s?(w.error("database",{message:s?.message||"Error fetching haul-offs",operation:"getHaulOffs"}),[]):i||[]}return(Q().haulOffs||[]).filter(i=>i.project_id===r).sort((i,s)=>new Date(s.work_date)-new Date(i.work_date))},async createHaulOff(r,l){const i={project_id:r,dump_site_id:l.dumpSiteId,waste_type:l.wasteType,loads:l.loads,hauling_company:l.haulingCompany||"",work_date:l.workDate,notes:l.notes||"",estimated_cost:l.estimatedCost||0,created_by:l.createdBy||""};if(y){const{data:d,error:m}=await h.from("haul_offs").insert(i).select().single();if(m)throw w.error("database",{message:m?.message||"Error creating haul-off",operation:"createHaulOff"}),m;return d}const s=Q();s.haulOffs||(s.haulOffs=[]);const u={...i,id:crypto.randomUUID(),created_at:new Date().toISOString()};return s.haulOffs.push(u),te(s),u},async calculateHaulOffCosts(r){const l=await this.getHaulOffs(r);let i=0,s=0;const u={},d=[],m={};l.forEach(b=>{const x=parseFloat(b.estimated_cost)||0,z=parseInt(b.loads)||0;i+=x,s+=z,u[b.waste_type]||(u[b.waste_type]={loads:0,cost:0}),u[b.waste_type].loads+=z,u[b.waste_type].cost+=x,m[b.work_date]||(m[b.work_date]={date:b.work_date,loads:0,cost:0}),m[b.work_date].loads+=z,m[b.work_date].cost+=x}),Object.values(m).sort((b,x)=>new Date(x.date)-new Date(b.date)).forEach(b=>d.push(b));const g=d.length;return{totalCost:i,totalLoads:s,byWasteType:u,byDate:d,daysWithHaulOff:g,avgDailyHaulOffCost:g>0?i/g:0}},subscribeToHaulOffs(r,l){return y?h.channel(`haul_offs:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${r}`},l).subscribe():null},...ah,async createFolder(r,l,i){const s=L(),{data:u,error:d}=await s.from("document_folders").insert({company_id:r,project_id:l,name:i.name,description:i.description||null,icon:i.icon||"folder",color:i.color||"blue",sort_order:i.sort_order||0,created_by:(await s.auth.getUser()).data.user?.id}).select().single();if(d)throw d;return u},async getProjectFolders(r){const l=L(),{data:i,error:s}=await l.from("document_folders").select("*").eq("project_id",r).order("sort_order",{ascending:!0}).order("name",{ascending:!0});if(s)throw s;const u=i.map(d=>d.id);if(u.length>0){const{data:d,error:m}=await l.from("documents").select("folder_id").in("folder_id",u).is("archived_at",null).eq("is_current",!0);if(!m&&d){const g={};d.forEach(b=>{g[b.folder_id]=(g[b.folder_id]||0)+1}),i.forEach(b=>{b.document_count=g[b.id]||0})}}return i},async updateFolder(r,l){const i=L(),{data:s,error:u}=await i.from("document_folders").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(u)throw u;return s},async deleteFolder(r){const l=L();await l.from("documents").update({folder_id:null}).eq("folder_id",r);const{error:i}=await l.from("document_folders").delete().eq("id",r);if(i)throw i;return!0},async reorderFolders(r,l){const i=L(),s=l.map(({id:u,sort_order:d})=>i.from("document_folders").update({sort_order:d,updated_at:new Date().toISOString()}).eq("id",u).eq("project_id",r));return await Promise.all(s),!0},async getFolderDocuments(r,l={}){const i=L(),{page:s=0,limit:u=25}=l,d=i.from("documents").select("*",{count:"exact"}).eq("folder_id",r).is("archived_at",null).eq("is_current",!0).order("uploaded_at",{ascending:!1}).range(s*u,(s+1)*u-1),{data:m,error:g,count:b}=await d;if(g)throw g;return{documents:m||[],totalCount:b||0,hasMore:(b||0)>(s+1)*u}},async moveDocumentToFolder(r,l){const i=L(),{data:s,error:u}=await i.from("documents").update({folder_id:l}).eq("id",r).select().single();if(u)throw u;return s},async getUnfiledDocuments(r,l={}){const i=L(),{page:s=0,limit:u=25}=l,{data:d,error:m,count:g}=await i.from("documents").select("*",{count:"exact"}).eq("project_id",r).is("folder_id",null).is("archived_at",null).eq("is_current",!0).order("uploaded_at",{ascending:!1}).range(s*u,(s+1)*u-1);if(m)throw m;return{documents:d||[],totalCount:g||0,hasMore:(g||0)>(s+1)*u}},async uploadDocument(r,l,i,s={}){const u=L(),d=Date.now(),m=250*1024*1024,{data:g}=await u.from("documents").select("file_size_bytes").eq("project_id",l).is("archived_at",null),b=g?.reduce((Y,G)=>Y+(G.file_size_bytes||0),0)||0;if(b+i.size>m){const Y=Math.round(b/1024/1024),G=Math.round(m/1024/1024);throw new Error(`Project storage limit reached (${Y}/${G} MB). Contact support to upgrade.`)}const x=Date.now(),z=new Uint8Array(6);crypto.getRandomValues(z);const E=Array.from(z,Y=>Y.toString(36)).join(""),k=i.name.split(".").pop()?.toLowerCase()||"bin",X=`${x}-${E}.${k}`,H=`${r}/${l}/documents/${X}`;try{const{error:Y}=await u.storage.from("project-documents").upload(H,i,{cacheControl:"3600",upsert:!1});if(Y)throw Y;const{data:G}=u.storage.from("project-documents").getPublicUrl(H),oe=G.publicUrl,Ee=s.category==="contracts"?"pending":"approved",{data:ve,error:P}=await u.from("documents").insert({company_id:r,project_id:l,name:s.name||i.name.replace(/\.[^/.]+$/,""),description:s.description||null,file_name:i.name,file_size_bytes:i.size,mime_type:i.type,storage_path:H,folder_id:s.folderId||null,category:s.category||"general",tags:s.tags||[],visibility:s.visibility||"all",approval_status:Ee,resource_type:s.resourceType||null,resource_id:s.resourceId||null,uploaded_by:(await u.auth.getUser()).data?.user?.id}).select().single();if(P)throw P;const _e=Date.now()-d;return w.storage("document_upload",{company_id:r,project_id:l,file_size:i.size,mime_type:i.type,duration:_e,success:!0}),{...ve,url:oe}}catch(Y){throw w.error("storage",{message:Y.message,operation:"uploadDocument",company_id:r,project_id:l}),Y}},async getProjectDocuments(r,{category:l=null,page:i=0,limit:s=25,includeArchived:u=!1}={}){let m=L().from("documents").select("*",{count:"exact"}).eq("project_id",r).eq("is_current",!0).order("uploaded_at",{ascending:!1}).range(i*s,(i+1)*s-1);u||(m=m.is("archived_at",null)),l&&l!=="all"&&(m=m.eq("category",l));const{data:g,error:b,count:x}=await m;if(b)throw b;return{documents:g||[],totalCount:x||0,hasMore:(i+1)*s<(x||0),page:i,limit:s}},async getDocument(r){const l=L(),{data:i,error:s}=await l.from("documents").select("*").eq("id",r).single();if(s)throw s;return i},async getDocumentVersions(r){const l=L(),{data:i,error:s}=await l.from("documents").select("id, parent_document_id").eq("id",r).single();if(s)throw s;const u=i.parent_document_id||r,{data:d,error:m}=await l.from("documents").select("*").or(`id.eq.${u},parent_document_id.eq.${u}`).order("version",{ascending:!1});if(m)throw m;return d||[]},async uploadDocumentVersion(r,l,i,s,u={}){const d=L(),{data:m,error:g}=await d.from("documents").select("*").eq("id",r).single();if(g)throw g;const{data:b}=await d.from("documents").select("version").or(`id.eq.${r},parent_document_id.eq.${r}`).order("version",{ascending:!1}).limit(1),x=(b?.[0]?.version||1)+1;await d.from("documents").update({is_current:!1}).or(`id.eq.${r},parent_document_id.eq.${r}`);const z=await this.uploadDocument(l,i,s,{name:u.name||m.name,description:u.description||m.description,category:m.category,visibility:m.visibility,tags:m.tags,resourceType:m.resource_type,resourceId:m.resource_id}),{data:E,error:k}=await d.from("documents").update({version:x,is_current:!0,parent_document_id:r}).eq("id",z.id).select().single();if(k)throw k;return await d.from("document_audit_log").insert({document_id:z.id,project_id:i,company_id:l,operation:"version_created",details:{version:x,parent_id:r},triggered_by:"user",user_id:(await d.auth.getUser()).data?.user?.id}),{...z,...E}},async updateDocument(r,l){const i=L(),{data:s,error:u}=await i.from("documents").update({name:l.name,description:l.description,category:l.category,visibility:l.visibility,tags:l.tags}).eq("id",r).select().single();if(u)throw u;return s},async archiveDocument(r){const l=L(),i=(await l.auth.getUser()).data?.user?.id,{data:s,error:u}=await l.from("documents").update({archived_at:new Date().toISOString(),archived_by:i}).eq("id",r).select().single();if(u)throw u;return await l.from("document_audit_log").insert({document_id:r,project_id:s.project_id,company_id:s.company_id,operation:"deleted",triggered_by:"user",user_id:i}),s},async restoreDocument(r){const l=L(),i=(await l.auth.getUser()).data?.user?.id,{data:s,error:u}=await l.from("documents").update({archived_at:null,archived_by:null}).eq("id",r).select().single();if(u)throw u;return await l.from("document_audit_log").insert({document_id:r,project_id:s.project_id,company_id:s.company_id,operation:"restored",triggered_by:"user",user_id:i}),s},async deleteDocumentPermanently(r){const l=L(),{data:i,error:s}=await l.from("documents").select("storage_path, company_id, project_id").eq("id",r).single();if(s)throw s;i.storage_path&&await l.storage.from("project-documents").remove([i.storage_path]);const{error:u}=await l.from("documents").delete().eq("id",r);if(u)throw u;return!0},async linkDocumentToResource(r,l,i){const s=L(),{data:u,error:d}=await s.from("documents").update({resource_type:l,resource_id:i}).eq("id",r).select().single();if(d)throw d;return await s.from("document_audit_log").insert({document_id:r,project_id:u.project_id,company_id:u.company_id,operation:"linked",details:{resource_type:l,resource_id:i},triggered_by:"user",user_id:(await s.auth.getUser()).data?.user?.id}),u},async unlinkDocumentFromResource(r){const l=L(),{data:i}=await l.from("documents").select("resource_type, resource_id, project_id, company_id").eq("id",r).single(),{data:s,error:u}=await l.from("documents").update({resource_type:null,resource_id:null}).eq("id",r).select().single();if(u)throw u;return await l.from("document_audit_log").insert({document_id:r,project_id:i.project_id,company_id:i.company_id,operation:"unlinked",details:{resource_type:i.resource_type,resource_id:i.resource_id},triggered_by:"user",user_id:(await l.auth.getUser()).data?.user?.id}),s},async getResourceDocuments(r,l){const i=L(),{data:s,error:u}=await i.from("documents").select("*").eq("resource_type",r).eq("resource_id",l).is("archived_at",null).order("uploaded_at",{ascending:!1});if(u)throw u;return s||[]},async approveDocument(r){const l=L(),{data:i,error:s}=await l.rpc("approve_document",{p_document_id:r});if(s)throw s;return i},async rejectDocument(r,l){const i=L(),{data:s,error:u}=await i.rpc("reject_document",{p_document_id:r,p_reason:l});if(u)throw u;return s},async getPendingDocuments(r){const l=L(),{data:i,error:s}=await l.from("documents").select("*, project:projects(name)").eq("company_id",r).eq("approval_status","pending").is("archived_at",null).order("uploaded_at",{ascending:!1});if(s)throw s;return i||[]},async searchDocuments(r,l){const i=L(),{data:s,error:u}=await i.from("documents").select("*").eq("project_id",r).eq("is_current",!0).is("archived_at",null).or(`name.ilike.%${l}%,description.ilike.%${l}%`).order("uploaded_at",{ascending:!1}).limit(20);if(u)throw u;return s||[]},async logDocumentAccess(r,l="downloaded"){const i=L(),{data:s}=await i.from("documents").select("project_id, company_id").eq("id",r).single();s&&await i.from("document_audit_log").insert({document_id:r,project_id:s.project_id,company_id:s.company_id,operation:l,triggered_by:"user",user_id:(await i.auth.getUser()).data?.user?.id})}};jc(async r=>{if(r&&y)try{await Km(mt)}catch(l){w.error("database",{message:l?.message||"Error syncing pending actions",operation:"syncPendingActions"})}});const Ah=Object.freeze(Object.defineProperty({__proto__:null,auth:Qi,clearFieldSession:hc,db:mt,drawRequestOps:rh,equipmentOps:nh,getConnectionStatus:Kt,getFieldCompanyId:th,getFieldProjectId:eh,getPendingActionCount:Yi,getSupabaseClient:yc,isFieldMode:bc,isSupabaseConfigured:y,onConnectionChange:jc,supabase:h,syncPendingActions:Km},Symbol.toStringTag,{value:"Module"})),$m=R.createContext(),Rt={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function Hi({children:r,companyId:l}){const[i,s]=R.useState(Rt),[u,d]=R.useState(!0);R.useEffect(()=>{l?m(l):g()},[l]),R.useEffect(()=>{z(i)},[i]);const m=async H=>{try{if(d(!0),!y){s(Rt),d(!1);return}const{data:Y,error:G}=await h.from("company_branding").select("*").eq("company_id",H).single();G?(G.code==="PGRST116"?await b(H):w.error("database",{message:G?.message,operation:"loadBranding"}),s(Rt)):s({...Rt,...Y})}catch(Y){w.error("database",{message:Y?.message,operation:"loadBranding"}),s(Rt)}finally{d(!1)}},g=async()=>{try{d(!0);const H=window.location.hostname;if(H==="localhost"||H==="127.0.0.1"){s(Rt),d(!1);return}if(!y){s(Rt),d(!1);return}const{data:Y,error:G}=await h.rpc("get_branding_by_domain",{domain_name:H});G||!Y||Y.length===0?s(Rt):s({...Rt,...Y[0]})}catch(H){w.error("database",{message:H?.message,operation:"loadBrandingByDomain"}),s(Rt)}finally{d(!1)}},b=async H=>{try{const{data:Y,error:G}=await h.from("company_branding").insert({company_id:H,...Rt}).select().single();G&&w.error("database",{message:G?.message,operation:"createDefaultBranding"})}catch(Y){w.error("database",{message:Y?.message,operation:"createDefaultBranding"})}},x=R.useCallback(async H=>{try{if(!y)return s(_e=>({..._e,...H})),{success:!0};if(!l)return{success:!1,error:"No company ID"};const Y={},G=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const _e of G)H[_e]!==void 0&&(Y[_e]=H[_e]);const{data:oe,error:Ee}=await h.from("company_branding").select("id").eq("company_id",l).single();if(Ee&&Ee.code==="PGRST116"){const{data:_e,error:ke}=await h.from("company_branding").insert({company_id:l,...Y}).select().single();return ke?(w.error("database",{message:ke?.message,operation:"createBranding"}),{success:!1,error:ke.message}):(s({...Rt,..._e}),{success:!0,data:_e})}const{data:ve,error:P}=await h.from("company_branding").update(Y).eq("company_id",l).select().single();return P?(w.error("database",{message:P?.message,operation:"updateBranding"}),{success:!1,error:P.message}):(s({...Rt,...ve}),{success:!0,data:ve})}catch(Y){return w.error("database",{message:Y?.message,operation:"updateBranding"}),{success:!1,error:Y.message}}},[l]),z=H=>{const Y=document.documentElement;if(Y.style.setProperty("--primary-color",H.primary_color),Y.style.setProperty("--secondary-color",H.secondary_color),H.favicon_url){let G=document.querySelector("link[rel*='icon']");G||(G=document.createElement("link"),G.rel="icon",document.head.appendChild(G)),G.href=H.favicon_url}document.title=H.custom_app_name||"FieldSync"},E=R.useCallback(async(H,Y)=>{try{if(!y)return{success:!0,url:URL.createObjectURL(H)};const G=H.name.split(".").pop(),Ee=`branding/${`${l}/${Y}-${Date.now()}.${G}`}`,{data:ve,error:P}=await h.storage.from("public").upload(Ee,H,{cacheControl:"3600",upsert:!0});if(P)return w.error("storage",{message:P?.message,operation:"uploadBrandingImage"}),{success:!1,error:P.message};const{data:{publicUrl:_e}}=h.storage.from("public").getPublicUrl(Ee);return{success:!0,url:_e}}catch(G){return w.error("storage",{message:G?.message,operation:"uploadBrandingImage"}),{success:!1,error:G.message}}},[l]),k=R.useCallback(()=>{l?m(l):g()},[l]),X=R.useMemo(()=>({branding:i,loading:u,updateBranding:x,uploadBrandingImage:E,refreshBranding:k}),[i,u,x,E,k]);return _.jsx($m.Provider,{value:X,children:r})}function lh(){const r=R.useContext($m);if(!r)throw new Error("useBranding must be used within a BrandingProvider");return r}const Fm=R.createContext();function mc({children:r}){const[l,i]=R.useState(()=>{const d=localStorage.getItem("fieldsync-theme");return d==="light"||d==="dark"?d:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"});R.useEffect(()=>{document.documentElement.setAttribute("data-theme",l),localStorage.setItem("fieldsync-theme",l)},[l]),R.useEffect(()=>{const d=window.matchMedia("(prefers-color-scheme: light)"),m=g=>{localStorage.getItem("fieldsync-theme")||i(g.matches?"light":"dark")};return d.addEventListener("change",m),()=>d.removeEventListener("change",m)},[]);const s=R.useCallback(()=>{i(d=>d==="dark"?"light":"dark")},[]),u=R.useMemo(()=>({theme:l,setTheme:i,toggleTheme:s}),[l,s]);return _.jsx(Fm.Provider,{value:u,children:r})}function ih(){const r=R.useContext(Fm);if(!r)throw new Error("useTheme must be used within a ThemeProvider");return r}const Wm=R.createContext(null);function sh({children:r}){const[l,i]=R.useState(null),[s,u]=R.useState([]),d=R.useCallback(()=>{i(null)},[]),m=R.useCallback((H,Y="info",G=3e3)=>{if(l){u(oe=>[...oe,{message:H,type:Y,duration:G}]);return}i({message:H,type:Y,duration:G}),G>0&&setTimeout(()=>{i(null)},G)},[l]),g=R.useCallback(()=>{if(s.length>0){const[H,...Y]=s;u(Y),setTimeout(()=>{m(H.message,H.type,H.duration)},300)}},[s,m]),b=R.useCallback(()=>{d(),g()},[d,g]),x=R.useCallback((H,Y)=>{m(H,"success",Y)},[m]),z=R.useCallback((H,Y)=>{m(H,"error",Y)},[m]),E=R.useCallback((H,Y)=>{m(H,"warning",Y)},[m]),k=R.useCallback((H,Y)=>{m(H,"info",Y)},[m]),X=R.useMemo(()=>({toast:l,showToast:m,hideToast:b,success:x,error:z,warning:E,info:k}),[l,m,b,x,z,E,k]);return _.jsxs(Wm.Provider,{value:X,children:[r,l&&_.jsx("div",{className:"toast-container",children:_.jsx("div",{className:`toast ${l.type}`,onClick:b,children:l.message})})]})}function Nh(){const r=R.useContext(Wm);if(!r)throw new Error("useToast must be used within a ToastProvider");return r}function _t({className:r="",showPoweredBy:l=!1}){const{branding:i}=lh();return _.jsxs("div",{className:`app-logo ${r}`,children:[i.logo_url?_.jsx("img",{src:i.logo_url,alt:i.custom_app_name||"Logo",className:"custom-logo"}):_.jsxs("div",{className:"logo",children:[i.custom_app_name||"Field",_.jsx("span",{children:"Sync"})]}),l&&!i.hide_fieldsync_branding&&_.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function oh(r){if(!r)return{score:0,label:"",color:""};let l=0;return r.length>=6&&l++,r.length>=8&&l++,/[A-Z]/.test(r)&&/[a-z]/.test(r)&&l++,/\d/.test(r)&&l++,/[^A-Za-z0-9]/.test(r)&&l++,l<=1?{score:1,label:"Weak",color:"var(--accent-red)"}:l<=2?{score:2,label:"Fair",color:"var(--accent-orange)"}:l<=3?{score:3,label:"Good",color:"var(--accent-amber)"}:l<=4?{score:4,label:"Strong",color:"var(--accent-green)"}:{score:5,label:"Very strong",color:"var(--accent-green)"}}function km(r=6){const l="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",i=new Uint32Array(r);return crypto.getRandomValues(i),Array.from(i,s=>l[s%l.length]).join("")}function hr(r){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)}function ml({steps:r,currentStep:l}){return _.jsx("div",{className:"onboarding-step-indicator",children:r.map((i,s)=>{const u=s+1,d=u===l,m=u<l;return _.jsxs("div",{className:"onboarding-step-wrapper",children:[s>0&&_.jsx("div",{className:`onboarding-step-line ${m?"completed":""}`}),_.jsx("div",{className:`onboarding-step-circle ${d?"active":""} ${m?"completed":""}`,children:m?_.jsx(_c,{size:14}):u}),_.jsx("span",{className:`onboarding-step-label ${d?"active":""} ${m?"completed":""}`,children:i})]},s)})})}function Bm({value:r,onChange:l,placeholder:i,onKeyDown:s,autoFocus:u,showStrength:d}){const[m,g]=R.useState(!1),b=oh(r);return _.jsxs("div",{className:"password-field",children:[_.jsxs("div",{className:"password-input-wrapper",children:[_.jsx("input",{type:m?"text":"password",value:r,onChange:l,placeholder:i||"Password",onKeyDown:s,autoFocus:u}),_.jsx("button",{type:"button",className:"password-toggle",onClick:()=>g(!m),tabIndex:-1,"aria-label":m?"Hide password":"Show password",children:m?_.jsx(Eg,{size:18}):_.jsx(qg,{size:18})})]}),d&&r&&_.jsxs("div",{className:"password-strength",children:[_.jsx("div",{className:"password-strength-bar",children:_.jsx("div",{className:"password-strength-fill",style:{width:`${b.score/5*100}%`,background:b.color}})}),_.jsx("span",{className:"password-strength-label",style:{color:b.color},children:b.label})]})]})}function ch({onForemanAccess:r,onOfficeLogin:l,onShowToast:i}){const[s]=_g(),[u,d]=R.useState(()=>{const U=s.get("mode");return U==="foreman"||U==="office"?U:null}),[m,g]=R.useState(""),[b,x]=R.useState(null),[z,E]=R.useState(""),[k,X]=R.useState(!1),[H,Y]=R.useState(""),[G,oe]=R.useState(null),[Ee,ve]=R.useState(()=>{try{return localStorage.getItem("fieldsync_foreman_name")||""}catch{return""}}),P=R.useRef(null),_e=R.useRef(null);R.useEffect(()=>()=>{P.current&&clearTimeout(P.current),_e.current&&clearTimeout(_e.current)},[]);const[ke,st]=R.useState(""),[et,ta]=R.useState(""),[Jt,pt]=R.useState(1),[xe,aa]=R.useState(null),[qt,Be]=R.useState(""),[A,B]=R.useState(""),[K,ge]=R.useState(""),[ce,He]=R.useState(""),[he,re]=R.useState(!1),[Ae,Ke]=R.useState(1),[ot,da]=R.useState(""),[na,ra]=R.useState(""),[$e,ct]=R.useState(""),[gt,$t]=R.useState(""),[$,W]=R.useState(null),de=U=>{const De=U.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);g(De)},Ft=async()=>{if(m.length<2){i("Enter company code","error");return}X(!0);try{const U=await mt.getCompanyByCode(m);U?x(U):(i("Invalid company code","error"),g(""))}catch{i("Error checking code","error")}finally{X(!1)}},ut=async U=>{if(U.length===4){X(!0),Y("");try{const De=await mt.getProjectByPinSecure(U,b.code);if(De.rateLimited){Y("error"),i("Too many attempts. Please wait 15 minutes.","error"),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{E(""),Y("")},800);return}if(De.success&&De.project){oe(De.project);return}if(De.error){console.error("[Foreman Auth] PIN validation failed:",De.error),i(De.error,"error"),E("");return}i("Invalid PIN","error"),E("")}catch{i("Error checking PIN. Please check your connection.","error"),E("")}finally{X(!1)}}},tt=()=>{if(!Ee.trim()){i("Enter your name to continue","error");return}try{localStorage.setItem("fieldsync_foreman_name",Ee.trim())}catch{}r(G,Ee.trim())},Oe=U=>{if(z.length<4&&!k){const De=z+U;E(De),Y(""),De.length===4&&(_e.current&&clearTimeout(_e.current),_e.current=setTimeout(()=>ut(De),150))}},Wt=()=>{k||(E(U=>U.slice(0,-1)),Y(""))},la=()=>{x(null),E(""),Y("")},Dt=()=>{if(!ke.trim()||!et.trim()){i("Enter email and password","error");return}l(ke,et)},Me=async()=>{if(m.length<2){i("Enter company code","error");return}X(!0);try{const U=await mt.getCompanyByCode(m);U?(aa(U),pt(2)):(i("Invalid company code","error"),g(""))}catch{i("Error checking code","error")}finally{X(!1)}},sn=async()=>{if(!qt.trim()){i("Enter office code","error");return}X(!0);try{const{data:U,error:De}=await h.rpc("verify_office_code",{company_id:xe.id,code:qt.trim()});if(De)throw De;U===!0?pt(3):(i("Invalid office code","error"),Be(""))}catch{i("Error verifying code","error")}finally{X(!1)}},on=async()=>{if(!k){if(!A.trim()){i("Enter your name","error");return}if(!K.trim()||!hr(K)){i("Enter a valid email address","error");return}if(ce.length<6){i("Password must be 6+ characters","error");return}X(!0);try{const U=K.toLowerCase().trim(),{data:De,error:Ma}=await h.auth.signUp({email:U,password:ce});let dt;if(Ma?.message?.includes("already registered")||De?.user&&De.user.identities?.length===0){const{data:We,error:ze}=await h.auth.signInWithPassword({email:U,password:ce});if(ze){i("Account exists with different password. Use your existing password.","error"),X(!1);return}dt=We.user.id;const{data:za}=await h.from("user_companies").select("id, status").eq("user_id",dt).eq("company_id",xe.id).maybeSingle();if(za){za.status==="active"?(i("You already belong to this company. Logging you in...","success"),setTimeout(()=>window.location.reload(),1e3)):za.status==="pending"?(i("Your request is still pending approval.","error"),await h.auth.signOut()):(i("Your membership was removed. Contact the company admin.","error"),await h.auth.signOut());return}const{error:cn}=await h.from("user_companies").insert({user_id:dt,company_id:xe.id,role:"member",status:"pending"});if(cn)throw console.error("Error adding to user_companies:",cn),await h.auth.signOut(),new Error("Failed to submit join request");await h.auth.signOut(),re(!0)}else{if(Ma)throw Ma;{if(dt=De.user?.id,!dt)throw new Error("Failed to create user");const{error:We}=await h.from("users").insert({id:dt,email:U,password_hash:"managed_by_supabase_auth",name:A.trim(),company_id:xe.id,role:"member",is_active:!0});if(We)throw We;const{error:ze}=await h.from("user_companies").insert({user_id:dt,company_id:xe.id,role:"member",status:"pending"});if(ze)throw console.error("Error adding to user_companies:",ze),new Error("Failed to submit join request");await h.auth.signOut(),re(!0)}}}catch(U){console.error("Join error:",U),i(U.message||"Error creating account","error")}finally{X(!1)}}},yr=async()=>{if(!k){if(!na.trim()){i("Enter your name","error");return}if(!$e.trim()||!hr($e)){i("Enter a valid email address","error");return}if(gt.length<6){i("Password must be 6+ characters","error");return}X(!0);try{const U=$e.toLowerCase().trim(),De=km(6),Ma=km(6),{data:dt,error:Fe}=await h.auth.signUp({email:U,password:gt});if(Fe){if(Fe.message?.includes("already registered"))i("An account with this email already exists. Sign in instead.","error");else throw Fe;return}const We=dt.user?.id;if(!We)throw new Error("Failed to create account");const{data:ze,error:za}=await h.from("companies").insert({name:ot.trim(),code:De,office_code:Ma,subscription_tier:"free",owner_user_id:We}).select().single();if(za)throw console.error("Company creation error:",za),new Error("Failed to create company. Please try again.");const{error:cn}=await h.from("users").insert({id:We,email:U,password_hash:"managed_by_supabase_auth",name:na.trim(),company_id:ze.id,role:"admin",is_active:!0});if(cn)throw console.error("User record error:",cn),new Error("Failed to set up user profile");const{error:yl}=await h.from("user_companies").insert({user_id:We,company_id:ze.id,role:"admin",access_level:"administrator",status:"active"});if(yl)throw console.error("User-company link error:",yl),new Error("Failed to link account to company");W({name:ze.name,code:De,officeCode:Ma}),Ke(3)}catch(U){console.error("Registration error:",U),i(U.message||"Error creating company","error")}finally{X(!1)}}},Oa=()=>{pt(1),aa(null),Be(""),B(""),ge(""),He(""),re(!1),g("")},hl=()=>{Ke(1),da(""),ra(""),ct(""),$t(""),W(null)};if(u===null)return _.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card animate-fade-in-up",children:[_.jsx(_t,{className:"entry-logo",showPoweredBy:!1}),_.jsxs("div",{className:"entry-buttons stagger-children",children:[_.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>d("foreman"),children:[_.jsx("span",{className:"entry-mode-icon",children:_.jsx(vg,{size:32})}),_.jsx("span",{className:"entry-mode-title",children:"Foreman"}),_.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),_.jsxs("button",{className:"entry-mode-btn office",onClick:()=>d("office"),children:[_.jsx("span",{className:"entry-mode-icon",children:_.jsx(Sg,{size:32})}),_.jsx("span",{className:"entry-mode-title",children:"Office"}),_.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(u==="foreman")return G?_.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card animate-fade-in",children:[_.jsx(_t,{className:"entry-logo",showPoweredBy:!1}),_.jsx("div",{className:"entry-company-badge",children:G.name}),_.jsx("p",{className:"entry-subtitle",children:"Who's checking in?"}),_.jsxs("div",{className:"entry-form",children:[_.jsx("input",{type:"text",value:Ee,onChange:U=>ve(U.target.value),placeholder:"Your name",autoFocus:!0,onKeyDown:U=>{U.key==="Enter"&&tt()},style:{fontSize:"1.1rem",textAlign:"center"}}),_.jsx("button",{className:"entry-login-btn",onClick:tt,disabled:!Ee.trim(),children:"Enter Site"})]}),_.jsx("p",{className:"entry-hint",style:{marginTop:"0.75rem"},children:"Your name will appear on reports and submissions"}),_.jsxs("button",{className:"entry-join-link",style:{marginTop:"0.5rem",display:"flex",alignSelf:"center"},onClick:()=>{oe(null),E(""),Y("")},children:[_.jsx(ua,{size:16}),_.jsx("span",{children:"Back"})]})]})}):b?_.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card animate-fade-in",children:[_.jsx("button",{className:"entry-back",onClick:la,children:_.jsx(ua,{size:20})}),_.jsx(_t,{className:"entry-logo",showPoweredBy:!1}),_.jsx("div",{className:"entry-company-badge",children:b.name}),_.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),_.jsx("div",{className:`pin-display ${H==="error"?"shake":""}`,children:[0,1,2,3].map(U=>_.jsx("div",{className:`pin-dot ${z.length>U?"filled":""} ${H}`,children:z.length>U?"":""},U))}),_.jsxs("div",{className:"number-pad",role:"group","aria-label":"PIN entry keypad",children:[[1,2,3,4,5,6,7,8,9].map(U=>_.jsx("button",{className:"num-btn",onClick:()=>Oe(U.toString()),disabled:k,"aria-label":String(U),children:U},U)),_.jsx("button",{className:"num-btn empty",disabled:!0,"aria-hidden":"true"}),_.jsx("button",{className:"num-btn",onClick:()=>Oe("0"),disabled:k,"aria-label":"0",children:"0"}),_.jsx("button",{className:"num-btn backspace",onClick:Wt,disabled:k||z.length===0,"aria-label":"Delete last digit",children:_.jsx(ua,{size:18})})]}),k&&_.jsx("div",{className:"entry-loading",children:_.jsx("div",{className:"spinner"})})]})}):_.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card animate-fade-in",children:[_.jsx("button",{className:"entry-back",onClick:()=>d(null),children:_.jsx(ua,{size:20})}),_.jsx(_t,{className:"entry-logo",showPoweredBy:!1}),_.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),_.jsxs("div",{className:"entry-input-group",children:[_.jsx("input",{type:"text",value:m,onChange:U=>de(U.target.value),placeholder:"Company Code",disabled:k,autoFocus:!0,onKeyDown:U=>{U.key==="Enter"&&Ft()}}),_.jsx("button",{className:"entry-submit-btn",onClick:Ft,disabled:k||m.length<2,children:k?_.jsx("div",{className:"spinner-small"}):_.jsx(rc,{size:20})})]})]})});if(u==="office")return _.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card animate-fade-in",children:[_.jsx("button",{className:"entry-back",onClick:()=>d(null),children:_.jsx(ua,{size:20})}),_.jsx(_t,{className:"entry-logo",showPoweredBy:!1}),_.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),_.jsxs("div",{className:"entry-form",children:[_.jsx("input",{type:"email",value:ke,onChange:U=>st(U.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:U=>{U.key==="Enter"&&Dt()}}),_.jsx("input",{type:"password",value:et,onChange:U=>ta(U.target.value),placeholder:"Password",onKeyDown:U=>{U.key==="Enter"&&Dt()}}),_.jsx("button",{className:"entry-login-btn",onClick:Dt,children:"Sign In"})]}),_.jsx("div",{className:"entry-signup-hint",children:_.jsxs("div",{className:"entry-signup-options",children:[_.jsxs("button",{className:"entry-join-link",onClick:()=>{Oa(),d("join")},children:[_.jsx(wg,{size:16}),_.jsx("span",{children:"Join your company"})]}),_.jsxs("button",{className:"entry-join-link",onClick:()=>{hl(),d("register")},children:[_.jsx(jg,{size:16}),_.jsx("span",{children:"Register a new company"})]})]})})]})});if(u==="join")return he?_.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card animate-scale-in",children:[_.jsx("div",{className:"entry-success-icon",children:_.jsx(_c,{size:32})}),_.jsx("h2",{className:"entry-success-title",children:"Request Submitted"}),_.jsxs("p",{className:"entry-success-message",children:["Your request to join ",_.jsx("strong",{children:xe?.name})," has been submitted. A company admin will review and approve your access."]}),_.jsx("p",{className:"entry-success-detail",children:"You'll be able to sign in once approved."}),_.jsx("button",{className:"entry-login-btn",onClick:()=>{Oa(),d("office")},style:{marginTop:"1.5rem"},children:"Back to Sign In"})]})}):Jt===1?_.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card animate-fade-in",children:[_.jsx("button",{className:"entry-back",onClick:()=>{Oa(),d("office")},children:_.jsx(ua,{size:20})}),_.jsx(_t,{className:"entry-logo",showPoweredBy:!1}),_.jsx(ml,{steps:["Company","Verify","Account"],currentStep:1}),_.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),_.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),_.jsxs("div",{className:"entry-input-group",children:[_.jsx("input",{type:"text",value:m,onChange:U=>de(U.target.value),placeholder:"Company Code",disabled:k,autoFocus:!0,onKeyDown:U=>{U.key==="Enter"&&Me()}}),_.jsx("button",{className:"entry-submit-btn",onClick:Me,disabled:k||m.length<2,children:k?_.jsx("div",{className:"spinner-small"}):_.jsx(rc,{size:20})})]})]})}):Jt===2?_.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card animate-fade-in",children:[_.jsx("button",{className:"entry-back",onClick:()=>{pt(1),aa(null),Be("")},children:_.jsx(ua,{size:20})}),_.jsx(_t,{className:"entry-logo",showPoweredBy:!1}),_.jsx(ml,{steps:["Company","Verify","Account"],currentStep:2}),_.jsx("div",{className:"entry-company-badge",children:xe?.name}),_.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),_.jsx("p",{className:"entry-hint",children:"This verifies your office access"}),_.jsxs("div",{className:"entry-input-group",children:[_.jsx("input",{type:"password",value:qt,onChange:U=>Be(U.target.value),placeholder:"Office Code",disabled:k,autoFocus:!0,onKeyDown:U=>{U.key==="Enter"&&sn()}}),_.jsx("button",{className:"entry-submit-btn",onClick:sn,disabled:k||!qt.trim(),children:k?_.jsx("div",{className:"spinner-small"}):_.jsx(rc,{size:20})})]})]})}):_.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card animate-fade-in",children:[_.jsx("button",{className:"entry-back",onClick:()=>{pt(2),Be("")},children:_.jsx(ua,{size:20})}),_.jsx(_t,{className:"entry-logo",showPoweredBy:!1}),_.jsx(ml,{steps:["Company","Verify","Account"],currentStep:3}),_.jsx("div",{className:"entry-company-badge",children:xe?.name}),_.jsx("p",{className:"entry-subtitle",children:"Create your account"}),_.jsxs("div",{className:"entry-form",children:[_.jsx("input",{type:"text",value:A,onChange:U=>B(U.target.value),placeholder:"Your Name",autoFocus:!0}),_.jsx("input",{type:"email",value:K,onChange:U=>ge(U.target.value),placeholder:"Email",className:K&&!hr(K)?"input-error":""}),_.jsx(Bm,{value:ce,onChange:U=>He(U.target.value),placeholder:"Password (6+ characters)",onKeyDown:U=>{U.key==="Enter"&&on()},showStrength:!0}),_.jsx("button",{className:"entry-login-btn",onClick:on,disabled:k||!A.trim()||!hr(K)||ce.length<6,children:k?_.jsxs("span",{className:"btn-loading",children:[_.jsx("div",{className:"spinner-small"}),"Creating account..."]}):"Join Company"})]}),_.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})});if(u==="register"){if(Ae===3&&$)return _.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card entry-card-wide animate-scale-in",children:[_.jsx("div",{className:"entry-success-icon",children:_.jsx(_c,{size:32})}),_.jsx("h2",{className:"entry-success-title",children:"Company Created"}),_.jsxs("p",{className:"entry-success-message",children:[_.jsx("strong",{children:$.name})," is ready to go. Save these codes to share with your team."]}),_.jsxs("div",{className:"entry-codes-grid",children:[_.jsxs("div",{className:"entry-code-card",children:[_.jsx("span",{className:"entry-code-label",children:"Company Code"}),_.jsx("span",{className:"entry-code-value",children:$.code}),_.jsx("span",{className:"entry-code-hint",children:"Share with all employees"})]}),_.jsxs("div",{className:"entry-code-card",children:[_.jsx("span",{className:"entry-code-label",children:"Office Code"}),_.jsx("span",{className:"entry-code-value",children:$.officeCode}),_.jsx("span",{className:"entry-code-hint",children:"Office staff only"})]})]}),_.jsx("p",{className:"entry-codes-warning",children:"Save these codes now. You can also find them in your company settings later."}),_.jsx("button",{className:"entry-login-btn",onClick:()=>{window.location.reload()},style:{marginTop:"0.5rem"},children:"Go to Dashboard"})]})});if(Ae===1)return _.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card animate-fade-in",children:[_.jsx("button",{className:"entry-back",onClick:()=>{hl(),d("office")},children:_.jsx(ua,{size:20})}),_.jsx(_t,{className:"entry-logo",showPoweredBy:!1}),_.jsx(ml,{steps:["Company","Your Account"],currentStep:1}),_.jsx("p",{className:"entry-subtitle",children:"Register your company"}),_.jsx("p",{className:"entry-hint",children:"Set up your company on FieldSync"}),_.jsxs("div",{className:"entry-form",children:[_.jsx("input",{type:"text",value:ot,onChange:U=>da(U.target.value),placeholder:"Company Name",autoFocus:!0,onKeyDown:U=>{U.key==="Enter"&&ot.trim()&&Ke(2)}}),_.jsx("button",{className:"entry-login-btn",onClick:()=>Ke(2),disabled:!ot.trim(),children:"Continue"})]})]})});if(Ae===2)return _.jsx("div",{className:"entry-container",children:_.jsxs("div",{className:"entry-card animate-fade-in",children:[_.jsx("button",{className:"entry-back",onClick:()=>Ke(1),children:_.jsx(ua,{size:20})}),_.jsx(_t,{className:"entry-logo",showPoweredBy:!1}),_.jsx(ml,{steps:["Company","Your Account"],currentStep:2}),_.jsx("div",{className:"entry-company-badge",children:ot}),_.jsx("p",{className:"entry-subtitle",children:"Create your admin account"}),_.jsxs("div",{className:"entry-form",children:[_.jsx("input",{type:"text",value:na,onChange:U=>ra(U.target.value),placeholder:"Your Name",autoFocus:!0}),_.jsx("input",{type:"email",value:$e,onChange:U=>ct(U.target.value),placeholder:"Email",className:$e&&!hr($e)?"input-error":""}),_.jsx(Bm,{value:gt,onChange:U=>$t(U.target.value),placeholder:"Password (6+ characters)",onKeyDown:U=>{U.key==="Enter"&&yr()},showStrength:!0}),_.jsx("button",{className:"entry-login-btn",onClick:yr,disabled:k||!na.trim()||!hr($e)||gt.length<6,children:k?_.jsxs("span",{className:"btn-loading",children:[_.jsx("div",{className:"spinner-small"}),"Setting up company..."]}):"Create Company"})]}),_.jsx("p",{className:"entry-join-note",children:"You'll be the administrator. Company and office codes will be generated for you."})]})})}}function uh({message:r,type:l="",onClose:i}){return R.useEffect(()=>{const s=setTimeout(i,3e3);return()=>clearTimeout(s)},[i]),_.jsx("div",{className:"toast-container",children:_.jsx("div",{className:`toast ${l}`,children:r})})}function Hm({compact:r=!1}){const{theme:l,toggleTheme:i}=ih();return _.jsx("button",{className:`theme-toggle ${r?"theme-toggle-compact":""}`,onClick:i,title:`Switch to ${l==="dark"?"light":"dark"} mode`,"aria-label":`Switch to ${l==="dark"?"light":"dark"} mode`,children:l==="dark"?_.jsxs(_.Fragment,{children:[_.jsx(Dg,{size:r?18:16}),!r&&_.jsx("span",{children:"Light"})]}):_.jsxs(_.Fragment,{children:[_.jsx(Cg,{size:r?18:16}),!r&&_.jsx("span",{children:"Dark"})]})})}class ln extends R.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0}}componentDidCatch(l,i){this.setState({error:l,errorInfo:i}),console.error("ErrorBoundary caught an error:",l,i),(l?.message?.includes("Failed to fetch dynamically imported module")||l?.message?.includes("Loading chunk")||l?.message?.includes("Loading CSS chunk"))&&("caches"in window?caches.keys().then(u=>{Promise.all(u.map(d=>caches.delete(d))).then(()=>{window.location.reload()})}).catch(u=>{u.message,window.location.reload()}):window.location.reload())}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?_.jsx("div",{className:"error-boundary",children:_.jsxs("div",{className:"error-boundary-content",children:[_.jsx("div",{className:"error-icon",children:_.jsx(Tg,{size:48})}),_.jsx("h2",{children:"Something went wrong"}),_.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),_.jsxs("div",{className:"error-actions",children:[_.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),_.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function Lm(){const[r,l]=R.useState(Kt()),[i,s]=R.useState(0),[u,d]=R.useState(!1),m=R.useRef(!1),g=R.useRef(null);return R.useEffect(()=>{const b=jc(async z=>{l(z),z&&m.current&&(d(!0),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>d(!1),3e3),m.current=!1),z||(m.current=!0);const E=await Yi();s(E)});Yi().then(s);const x=setInterval(async()=>{if(!Kt()){const z=await Yi();s(z)}},5e3);return()=>{b(),clearInterval(x),g.current&&clearTimeout(g.current)}},[]),r&&i===0&&!u?null:_.jsxs("div",{className:`offline-indicator ${r?"online":"offline"} ${u?"synced":""}`,children:[_.jsx("div",{className:"offline-indicator-content",children:r?u?_.jsxs(_.Fragment,{children:[_.jsx("span",{className:"online-icon",children:_.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:_.jsx("polyline",{points:"20 6 9 17 4 12"})})}),_.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):i>0?_.jsxs(_.Fragment,{children:[_.jsx("span",{className:"syncing-icon",children:_.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[_.jsx("polyline",{points:"23 4 23 10 17 10"}),_.jsx("polyline",{points:"1 20 1 14 7 14"}),_.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),_.jsxs("span",{className:"offline-text",children:["Syncing ",i,"..."]})]}):null:_.jsxs(_.Fragment,{children:[_.jsx("span",{className:"offline-icon",children:_.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[_.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),_.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),_.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),_.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),_.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),_.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),_.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),_.jsxs("span",{className:"offline-text",children:["Offline",i>0&&_.jsxs("span",{className:"pending-badge",children:[i," pending"]})]})]})}),_.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function dh(){const[r,l]=R.useState(null),[i,s]=R.useState(!1);R.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches)return;const m=localStorage.getItem("pwa-install-dismissed");if(m){const b=parseInt(m,10);if(Date.now()-b<10080*60*1e3)return}const g=b=>{b.preventDefault(),l(b),s(!0)};return window.addEventListener("beforeinstallprompt",g),()=>window.removeEventListener("beforeinstallprompt",g)},[]);const u=async()=>{if(!r)return;r.prompt();const{outcome:m}=await r.userChoice;m==="accepted"&&s(!1),l(null)},d=()=>{s(!1),localStorage.setItem("pwa-install-dismissed",Date.now().toString())};return i?_.jsxs("div",{className:"install-prompt",children:[_.jsxs("div",{className:"install-prompt-content",children:[_.jsx(xg,{size:20}),_.jsxs("div",{className:"install-prompt-text",children:[_.jsx("strong",{children:"Install FieldSync"}),_.jsx("span",{children:"Add to home screen for quick access"})]})]}),_.jsxs("div",{className:"install-prompt-actions",children:[_.jsx("button",{className:"btn btn-primary btn-small",onClick:u,children:"Install"}),_.jsx("button",{className:"install-prompt-dismiss",onClick:d,"aria-label":"Dismiss",children:_.jsx(Ag,{size:18})})]})]}):null}function fh({factorId:r,onVerified:l,onCancel:i}){const[s,u]=R.useState(""),[d,m]=R.useState(!1),[g,b]=R.useState(null),x=async()=>{if(s.length===6){m(!0),b(null);try{const{data:E,error:k}=await h.auth.mfa.challenge({factorId:r});if(k)throw k;const{error:X}=await h.auth.mfa.verify({factorId:r,challengeId:E.id,code:s});if(X)throw X;l()}catch{b("Invalid code. Please try again."),u("")}finally{m(!1)}}},z=E=>{E.key==="Enter"&&s.length===6&&x()};return _.jsxs("div",{className:"mfa-challenge",children:[_.jsx("div",{className:"mfa-challenge-icon",children:_.jsx(Ng,{size:40})}),_.jsx("h2",{children:"Two-Factor Authentication"}),_.jsx("p",{children:"Enter the 6-digit code from your authenticator app"}),_.jsx("div",{className:"mfa-code-input",children:_.jsx("input",{type:"text",value:s,onChange:E=>u(E.target.value.replace(/\D/g,"").slice(0,6)),onKeyDown:z,placeholder:"000000",maxLength:6,autoFocus:!0,inputMode:"numeric",pattern:"[0-9]*",className:"mfa-input-large","aria-label":"MFA verification code"})}),g&&_.jsx("p",{className:"mfa-error",children:g}),_.jsxs("div",{className:"mfa-challenge-actions",children:[_.jsx("button",{className:"btn btn-secondary",onClick:i,children:"Cancel"}),_.jsx("button",{className:"btn btn-primary",onClick:x,disabled:s.length!==6||d,children:d?_.jsxs(_.Fragment,{children:[_.jsx(Og,{size:14,className:"spinner"})," Verifying..."]}):"Verify"})]})]})}const mh=R.lazy(()=>Aa(()=>import("./ForemanView-C4VgT-X3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),_h=R.lazy(()=>Aa(()=>import("./Dashboard-B0ogE3ht.js").then(r=>r.D),__vite__mapDeps([9,5,1,2,4,10,3]))),ph=R.lazy(()=>Aa(()=>import("./Setup-CrUjHuhT.js"),__vite__mapDeps([11,5,1,8,4]))),gh=R.lazy(()=>Aa(()=>import("./BrandingSettings-YCzSoxGi.js"),__vite__mapDeps([12,1,5,8,4]))),hh=R.lazy(()=>Aa(()=>import("./PricingManager-1ILYUE-q.js"),__vite__mapDeps([13,1,4,5,8]))),yh=R.lazy(()=>Aa(()=>import("./PublicView-Qbc0nEY3.js"),__vite__mapDeps([14,1,4,5,8]))),bh=R.lazy(()=>Aa(()=>import("./SignaturePage-BeL4GKK6.js"),__vite__mapDeps([15,1,10,5,3,16,4,8]))),vh=R.lazy(()=>Aa(()=>import("./MembershipManager-BfR15Kmn.js"),__vite__mapDeps([17,1,4,5,8]))),Sh=R.lazy(()=>Aa(()=>import("./LandingPage-BS0B9ffx.js"),__vite__mapDeps([18,1,4,5,8])));function pl(){return _.jsxs("div",{className:"page-loader",children:[_.jsx(_t,{className:"loading-logo"}),_.jsx("div",{className:"spinner"})]})}function wh({pendingCompanyName:r,userName:l,onCheckStatus:i,onLogout:s}){const[u,d]=R.useState(!1);R.useEffect(()=>{const g=setInterval(()=>{i()},3e4);return()=>clearInterval(g)},[i]);const m=async()=>{d(!0),await i(),setTimeout(()=>d(!1),1e3)};return _.jsxs("div",{className:"pending-approval-screen",children:[_.jsx(_t,{className:"pending-logo"}),_.jsx("div",{className:"pending-pulse-ring",children:_.jsx("div",{className:"pending-pulse-dot"})}),_.jsx("h2",{children:"Awaiting Approval"}),r&&_.jsx("div",{className:"pending-company-name",children:r}),_.jsxs("p",{className:"pending-message",children:[l?`Hi ${l.split(" ")[0]}, your`:"Your"," membership request has been submitted. A company administrator will review and approve your access."]}),_.jsx("p",{className:"pending-auto-check",children:"We'll automatically check for updates"}),_.jsxs("div",{className:"pending-actions",children:[_.jsx("button",{className:"btn btn-secondary",onClick:s,children:"Sign Out"}),_.jsx("button",{className:"btn btn-primary",onClick:m,disabled:u,children:u?"Checking...":"Check Status"})]})]})}function jh(){const{token:r}=Ym();return _.jsx(R.Suspense,{fallback:_.jsx(pl,{}),children:_.jsx(yh,{shareToken:r})})}function Eh(){const{token:r}=Ym();return _.jsx(R.Suspense,{fallback:_.jsx(pl,{}),children:_.jsx(bh,{signatureToken:r})})}function qh(){const r=pg(),l=gg(),[i,s]=R.useState(null),[u,d]=R.useState(null),[m,g]=R.useState([]),[,b]=R.useState([]),[x,z]=R.useState(null),[E,k]=R.useState(""),[X,H]=R.useState(!0),[Y,G]=R.useState(null),[oe,Ee]=R.useState(!1),[ve,P]=R.useState(!1),[_e,ke]=R.useState(null),[st,et]=R.useState(0),[ta,Jt]=R.useState(!1),[pt,xe]=R.useState(null),[aa,qt]=R.useState(""),[Be,A]=R.useState(!1),B=R.useCallback(($,W="")=>{G({message:$,type:W})},[]),K=R.useCallback(async()=>{try{if(!y){H(!1);return}const{data:{user:$}}=await h.auth.getUser();if(!$){H(!1);return}const{data:W}=await h.from("users").select("*").eq("id",$.id).single();if(W){s(W);let de=await mt.getUserCompanies($.id);if(de.length===0&&W.company_id&&await mt.repairLegacyUser($.id,W.company_id,W.role||"member")&&(de=await mt.getUserCompanies($.id)),g(de),de.length===0){if(await mt.getUserPendingMemberships($.id)>0){try{const{data:Oe}=await h.from("user_companies").select("company_id, companies(name)").eq("user_id",$.id).eq("status","pending").limit(1);Oe?.[0]?.companies?.name&&qt(Oe[0].companies.name)}catch{}r("/pending",{replace:!0});return}G({message:"No company access. Join a company to continue.",type:"error"}),await Qi.signOut();return}const Ft=localStorage.getItem("selectedCompanyId");let ut=null;if(Ft&&de.find(tt=>tt.id===Ft)?ut=de.find(tt=>tt.id===Ft):de.length>0&&(ut=de[0]),ut){const{data:tt}=await h.from("companies").select("*").eq("id",ut.id).single();d(tt),A(!0);const Oe=l.pathname,Wt=Oe.startsWith("/view/")||Oe.startsWith("/sign/"),la=["/dashboard","/projects/new","/pricing","/branding","/team"].includes(Oe);!Wt&&!la&&Oe!=="/field"&&r("/dashboard",{replace:!0})}}}catch($){console.error("Auth check error:",$)}finally{H(!1)}},[r,l.pathname]);R.useEffect(()=>{const $=l.pathname;$.startsWith("/view/")||$.startsWith("/sign/")?H(!1):K()},[]),R.useEffect(()=>{if(!y)return;const{data:{subscription:$}}=h.auth.onAuthStateChange(async W=>{if(W==="SIGNED_OUT"||W==="USER_DELETED"){const de=l.pathname;if(de.startsWith("/sign/")||de.startsWith("/view/"))return;s(null),d(null),g([]),A(!1),r("/login",{replace:!0})}else if(W==="SIGNED_IN"&&!i){const de=l.pathname;!de.startsWith("/sign/")&&!de.startsWith("/view/")&&K()}});return()=>{$?.unsubscribe()}},[i,K,r,l.pathname]);const ge=($,W="")=>{localStorage.setItem("fieldsync-has-visited","true"),z($),k(W),r("/field")},ce=async($,W)=>{try{await hc(),localStorage.setItem("fieldsync-has-visited","true");const{data:de,error:Ft}=await h.auth.signInWithPassword({email:$,password:W});if(Ft){B(Ft.message||"Invalid credentials","error");return}const{data:ut,error:tt}=await h.from("users").select("*").eq("id",de.user.id).single();if(tt){console.error("User fetch error:",tt),B("Error loading profile","error");return}if(ut){s(ut);let Oe=await mt.getUserCompanies(de.user.id);Oe.length===0&&ut.company_id&&await mt.repairLegacyUser(de.user.id,ut.company_id,ut.role||"member")&&(Oe=await mt.getUserCompanies(de.user.id)),g(Oe);const Wt=localStorage.getItem("selectedCompanyId");let la=null;if(Wt&&Oe.find(Dt=>Dt.id===Wt)?la=Oe.find(Dt=>Dt.id===Wt):Oe.length>0&&(la=Oe[0]),la){const{data:Dt}=await h.from("companies").select("*").eq("id",la.id).single();d(Dt),A(!0);const{data:Me}=await h.auth.mfa.listFactors(),sn=Me?.totp?.find(on=>on.status==="verified");sn?(xe(sn.id),Jt(!0)):r("/dashboard")}else if(await mt.getUserPendingMemberships(de.user.id)>0){try{const{data:Me}=await h.from("user_companies").select("company_id, companies(name)").eq("user_id",de.user.id).eq("status","pending").limit(1);Me?.[0]?.companies?.name&&qt(Me[0].companies.name)}catch{}r("/pending")}else B("No company access. Please contact admin.","error")}else B("Profile not found. Please contact admin.","error")}catch(de){console.error("Login error:",de),B("Login failed","error")}},He=async $=>{try{const{data:W}=await h.from("companies").select("*").eq("id",$).single();W&&(d(W),localStorage.setItem("selectedCompanyId",$),Ee(!1),r("/dashboard"),B(`Switched to ${W.name}`,"success"))}catch(W){console.error("Switch company error:",W),B("Error switching company","error")}},he=async()=>{try{await Qi.signOut(),s(null),d(null),g([]),A(!1),localStorage.removeItem("selectedCompanyId"),r("/login")}catch($){console.error("Logout error:",$),B("Error signing out","error")}},re=async()=>{await hc(),z(null),k(""),r("/login")},Ae=()=>{r("/dashboard"),u?.id&&Ke()},Ke=async()=>{if(u?.id)try{const $=await mt.getProjects(u.id);b($)}catch($){console.error("Error loading projects:",$)}};R.useEffect(()=>{u?.id&&Be&&(Ke(),ot())},[u?.id,Be]);const ot=async()=>{if(u?.id)try{const W=(await mt.getCompanyMemberships(u.id)).filter(de=>de.status==="pending").length;et(W)}catch($){console.error("Error loading pending count:",$)}},da=R.useCallback(()=>{ke(null)},[]),$e=m.find($=>$.id===u?.id)?.access_level==="administrator"||u?.owner_user_id===i?.id,ct=Y&&_.jsx(uh,{message:Y.message,type:Y.type,onClose:()=>G(null)});if(X)return _.jsx(mc,{children:_.jsx(Hi,{companyId:u?.id,children:_.jsxs("div",{className:"loading-screen",children:[_.jsx(_t,{className:"loading-logo"}),_.jsx("div",{className:"spinner"})]})})});if(ta)return _.jsx(mc,{children:_.jsxs(Hi,{companyId:u?.id,children:[_.jsx(ln,{children:_.jsx(fh,{factorId:pt,onVerified:()=>{Jt(!1),r("/dashboard")},onCancel:async()=>{Jt(!1),xe(null),await Qi.signOut(),s(null),d(null),g([]),A(!1),r("/login")}})}),ct]})});const gt=$=>!i||!u||!Be?_.jsx(Tn,{to:"/login",replace:!0}):$,$t=$=>_.jsx(sh,{children:_.jsxs("div",{children:[!y&&_.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),_.jsx("nav",{className:"nav",children:_.jsxs("div",{className:"nav-content",children:[_.jsx(_t,{}),_.jsxs("div",{className:"nav-tabs nav-tabs-desktop",children:[_.jsx("button",{className:`nav-tab ${l.pathname==="/dashboard"?"active":""}`,onClick:()=>r("/dashboard"),children:"Dashboard"}),_.jsx("button",{className:`nav-tab ${l.pathname==="/projects/new"?"active":""}`,onClick:()=>r("/projects/new"),children:"+ New Project"}),_.jsx("button",{className:`nav-tab ${l.pathname==="/pricing"?"active":""}`,onClick:()=>r("/pricing"),children:"Pricing"}),$e&&_.jsx("button",{className:`nav-tab ${l.pathname==="/branding"?"active":""}`,onClick:()=>r("/branding"),children:"Branding"}),$e&&_.jsxs("button",{className:`nav-tab ${l.pathname==="/team"?"active":""}`,onClick:()=>r("/team"),children:["Team",st>0&&_.jsx("span",{className:"nav-tab-badge",children:st})]})]}),_.jsxs("div",{className:"nav-user nav-user-desktop",children:[_.jsx(Hm,{compact:!0}),_.jsxs("div",{className:"mobile-menu",children:[_.jsx("button",{className:"mobile-menu-btn",onClick:()=>P(!ve),"aria-label":"User menu",children:""}),ve&&_.jsxs("div",{className:"mobile-menu-dropdown",children:[_.jsxs("div",{className:"mobile-menu-info",children:[_.jsx("div",{className:"mobile-menu-user",children:i?.name||i?.email}),u&&_.jsx("div",{className:"mobile-menu-company",children:u.name})]}),_.jsx("button",{className:"mobile-menu-logout",onClick:()=>{P(!1),he()},children:"Sign Out"})]})]}),m.length>1&&_.jsxs("div",{className:"company-switcher",children:[_.jsxs("button",{className:"company-switcher-btn",onClick:()=>Ee(!oe),children:[u?.name||"Select Company",_.jsx("span",{className:"switcher-arrow",children:""})]}),oe&&_.jsx("div",{className:"company-dropdown",children:m.map(W=>_.jsxs("button",{className:`company-option ${W.id===u?.id?"active":""}`,onClick:()=>He(W.id),children:[W.name,W.id===u?.id&&_.jsx("span",{className:"check",children:""})]},W.id))})]}),m.length<=1&&u&&_.jsx("span",{className:"nav-company-name",children:u.name}),_.jsx("span",{className:"nav-user-name",children:i?.name||i?.email}),_.jsx("button",{className:"nav-logout",onClick:he,children:"Sign Out"})]}),_.jsx("button",{className:"mobile-menu-btn",onClick:()=>P(!0),"aria-label":"Open menu",children:_.jsxs("span",{className:"hamburger-icon",children:[_.jsx("span",{}),_.jsx("span",{}),_.jsx("span",{})]})})]})}),ve&&_.jsx("div",{className:"mobile-drawer-overlay",onClick:()=>P(!1),children:_.jsxs("div",{className:"mobile-drawer",onClick:W=>W.stopPropagation(),children:[_.jsxs("div",{className:"mobile-drawer-header",children:[_.jsx(_t,{}),_.jsx("button",{className:"mobile-drawer-close",onClick:()=>P(!1),"aria-label":"Close menu",children:""})]}),_.jsxs("div",{className:"mobile-drawer-user",children:[_.jsx("div",{className:"mobile-user-avatar",children:(i?.name||i?.email||"U")[0].toUpperCase()}),_.jsxs("div",{className:"mobile-user-info",children:[_.jsx("span",{className:"mobile-user-name",children:i?.name||i?.email}),_.jsx("span",{className:"mobile-user-company",children:u?.name})]})]}),m.length>1&&_.jsxs("div",{className:"mobile-drawer-section",children:[_.jsx("div",{className:"mobile-section-title",children:"Switch Company"}),_.jsx("div",{className:"mobile-company-list",children:m.map(W=>_.jsxs("button",{className:`mobile-company-option ${W.id===u?.id?"active":""}`,onClick:()=>{He(W.id),P(!1)},children:[_.jsx("span",{className:"mobile-company-name",children:W.name}),W.id===u?.id&&_.jsx("span",{className:"mobile-company-check",children:""})]},W.id))})]}),_.jsxs("div",{className:"mobile-drawer-section",children:[_.jsx("div",{className:"mobile-section-title",children:"Navigation"}),_.jsxs("div",{className:"mobile-nav-list",children:[_.jsx("button",{className:`mobile-nav-item ${l.pathname==="/dashboard"?"active":""}`,onClick:()=>{r("/dashboard"),P(!1)},children:"Dashboard"}),_.jsx("button",{className:`mobile-nav-item ${l.pathname==="/projects/new"?"active":""}`,onClick:()=>{r("/projects/new"),P(!1)},children:"+ New Project"}),_.jsx("button",{className:`mobile-nav-item ${l.pathname==="/pricing"?"active":""}`,onClick:()=>{r("/pricing"),P(!1)},children:"Pricing"}),$e&&_.jsx("button",{className:`mobile-nav-item ${l.pathname==="/branding"?"active":""}`,onClick:()=>{r("/branding"),P(!1)},children:"Branding"}),$e&&_.jsxs("button",{className:`mobile-nav-item ${l.pathname==="/team"?"active":""}`,onClick:()=>{r("/team"),P(!1)},children:["Team",st>0&&_.jsx("span",{className:"mobile-nav-badge",children:st})]})]})]}),_.jsxs("div",{className:"mobile-drawer-section",children:[_.jsx("div",{className:"mobile-section-title",children:"Appearance"}),_.jsx("div",{className:"mobile-theme-toggle",children:_.jsx(Hm,{})})]}),_.jsx("div",{className:"mobile-drawer-footer",children:_.jsx("button",{className:"mobile-logout-btn",onClick:()=>{he(),P(!1)},children:"Sign Out"})})]})}),_.jsx(ln,{children:_.jsx(R.Suspense,{fallback:_.jsx(pl,{}),children:_.jsx("div",{className:"container",children:$},u?.id)})}),_.jsx(Lm,{}),ct,_.jsx(dh,{})]})});return _.jsx(mc,{children:_.jsx(Hi,{companyId:u?.id,children:_.jsxs(hg,{children:[_.jsx(Zt,{path:"/view/:token",element:_.jsxs(ln,{children:[_.jsx(jh,{}),ct]})}),_.jsx(Zt,{path:"/sign/:token",element:_.jsxs(ln,{children:[_.jsx(Eh,{}),ct]})}),_.jsx(Zt,{path:"/login",element:i&&u&&Be?_.jsx(Tn,{to:"/dashboard",replace:!0}):_.jsxs(ln,{children:[_.jsx(ch,{onForemanAccess:ge,onOfficeLogin:ce,onShowToast:B}),ct]})}),_.jsx(Zt,{path:"/pending",element:_.jsxs(ln,{children:[_.jsx(wh,{pendingCompanyName:aa,userName:i?.name,onCheckStatus:K,onLogout:he}),ct]})}),_.jsx(Zt,{path:"/field",element:x?_.jsxs(Hi,{companyId:x.company_id,children:[_.jsx(ln,{children:_.jsx(R.Suspense,{fallback:_.jsx(pl,{}),children:_.jsx(mh,{project:x,companyId:x.company_id,foremanName:E,onShowToast:B,onExit:re})})}),_.jsx(Lm,{}),ct]}):_.jsx(Tn,{to:"/login",replace:!0})}),_.jsx(Zt,{path:"/dashboard",element:gt($t(_.jsx(_h,{company:u,user:i,isAdmin:$e,onShowToast:B,navigateToProjectId:_e,onProjectNavigated:da})))}),_.jsx(Zt,{path:"/projects/new",element:gt($t(_.jsx(ph,{company:u,user:i,onProjectCreated:Ae,onShowToast:B})))}),_.jsx(Zt,{path:"/pricing",element:gt($t(_.jsx(hh,{company:u,onShowToast:B})))}),_.jsx(Zt,{path:"/branding",element:gt($t(_.jsx(gh,{company:u,onShowToast:B})))}),_.jsx(Zt,{path:"/team",element:gt($e?$t(_.jsx(vh,{company:u,user:i,onShowToast:B})):_.jsx(Tn,{to:"/dashboard",replace:!0}))}),_.jsx(Zt,{path:"/",element:i&&u&&Be?_.jsx(Tn,{to:"/dashboard",replace:!0}):localStorage.getItem("fieldsync-has-visited")?_.jsx(Tn,{to:"/login",replace:!0}):_.jsx(ln,{children:_.jsx(R.Suspense,{fallback:_.jsx(pl,{}),children:_.jsx(Sh,{})})})}),_.jsx(Zt,{path:"*",element:_.jsx(Tn,{to:"/",replace:!0})})]})})})}Lg.createRoot(document.getElementById("root")).render(_.jsx(yg.StrictMode,{children:_.jsx(bg,{children:_.jsx(qh,{})})}));"serviceWorker"in navigator&&(window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(r=>{setInterval(()=>{r.update().catch(l=>console.debug("[SW] Update check failed:",l.message))},3e5)}).catch(r=>{console.debug("[SW] Registration failed:",r.message)})}),navigator.serviceWorker.addEventListener("message",r=>{r.data?.type==="SW_UPDATED"&&window.location.reload(),r.data?.type==="ASSET_NOT_FOUND"&&(r.data.url,"caches"in window?caches.keys().then(l=>{l.forEach(i=>caches.delete(i))}).finally(()=>{window.location.reload()}):window.location.reload())}));export{_t as L,uh as T,rh as a,Nh as b,Ah as c,mt as d,nh as e,yc as g,y as i,_ as j,w as o,h as s,lh as u};
