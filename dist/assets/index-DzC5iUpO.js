import{r as ef,a as tf,b as zx}from"./react-DXGY7bZi.js";import{c as Ox}from"./supabase-VuevzHjS.js";import{u as hn,w as Rx,r as qx}from"./xlsx-BTp1RmNK.js";import{E as Gi,a as fn}from"./pdf-C0G31WKZ.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))i(u);new MutationObserver(u=>{for(const m of u)if(m.type==="childList")for(const x of m.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&i(x)}).observe(document,{childList:!0,subtree:!0});function c(u){const m={};return u.integrity&&(m.integrity=u.integrity),u.referrerPolicy&&(m.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?m.credentials="include":u.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function i(u){if(u.ep)return;u.ep=!0;const m=c(u);fetch(u.href,m)}})();var td={exports:{}},xl={};var bp;function Lx(){if(bp)return xl;bp=1;var r=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function c(i,u,m){var x=null;if(m!==void 0&&(x=""+m),u.key!==void 0&&(x=""+u.key),"key"in u){m={};for(var f in u)f!=="key"&&(m[f]=u[f])}else m=u;return u=m.ref,{$$typeof:r,type:i,key:x,ref:u!==void 0?u:null,props:m}}return xl.Fragment=l,xl.jsx=c,xl.jsxs=c,xl}var _p;function Ux(){return _p||(_p=1,td.exports=Lx()),td.exports}var e=Ux(),g=ef();const Hx=tf(g);var ad={exports:{}},jl={},sd={exports:{}},nd={};var Np;function Fx(){return Np||(Np=1,(function(r){function l(w,Z){var M=w.length;w.push(Z);e:for(;0<M;){var oe=M-1>>>1,E=w[oe];if(0<u(E,Z))w[oe]=Z,w[M]=E,M=oe;else break e}}function c(w){return w.length===0?null:w[0]}function i(w){if(w.length===0)return null;var Z=w[0],M=w.pop();if(M!==Z){w[0]=M;e:for(var oe=0,E=w.length,U=E>>>1;oe<U;){var de=2*(oe+1)-1,A=w[de],xe=de+1,Q=w[xe];if(0>u(A,M))xe<E&&0>u(Q,A)?(w[oe]=Q,w[xe]=M,oe=xe):(w[oe]=A,w[de]=M,oe=de);else if(xe<E&&0>u(Q,M))w[oe]=Q,w[xe]=M,oe=xe;else break e}}return Z}function u(w,Z){var M=w.sortIndex-Z.sortIndex;return M!==0?M:w.id-Z.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var m=performance;r.unstable_now=function(){return m.now()}}else{var x=Date,f=x.now();r.unstable_now=function(){return x.now()-f}}var b=[],p=[],j=1,R=null,S=3,v=!1,H=!1,B=!1,I=!1,ae=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function C(w){for(var Z=c(p);Z!==null;){if(Z.callback===null)i(p);else if(Z.startTime<=w)i(p),Z.sortIndex=Z.expirationTime,l(b,Z);else break;Z=c(p)}}function ee(w){if(B=!1,C(w),!H)if(c(b)!==null)H=!0,me||(me=!0,y());else{var Z=c(p);Z!==null&&J(ee,Z.startTime-w)}}var me=!1,te=-1,P=5,V=-1;function ie(){return I?!0:!(r.unstable_now()-V<P)}function D(){if(I=!1,me){var w=r.unstable_now();V=w;var Z=!0;try{e:{H=!1,B&&(B=!1,G(te),te=-1),v=!0;var M=S;try{t:{for(C(w),R=c(b);R!==null&&!(R.expirationTime>w&&ie());){var oe=R.callback;if(typeof oe=="function"){R.callback=null,S=R.priorityLevel;var E=oe(R.expirationTime<=w);if(w=r.unstable_now(),typeof E=="function"){R.callback=E,C(w),Z=!0;break t}R===c(b)&&i(b),C(w)}else i(b);R=c(b)}if(R!==null)Z=!0;else{var U=c(p);U!==null&&J(ee,U.startTime-w),Z=!1}}break e}finally{R=null,S=M,v=!1}Z=void 0}}finally{Z?y():me=!1}}}var y;if(typeof O=="function")y=function(){O(D)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,L=z.port2;z.port1.onmessage=D,y=function(){L.postMessage(null)}}else y=function(){ae(D,0)};function J(w,Z){te=ae(function(){w(r.unstable_now())},Z)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(w){w.callback=null},r.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<w?Math.floor(1e3/w):5},r.unstable_getCurrentPriorityLevel=function(){return S},r.unstable_next=function(w){switch(S){case 1:case 2:case 3:var Z=3;break;default:Z=S}var M=S;S=Z;try{return w()}finally{S=M}},r.unstable_requestPaint=function(){I=!0},r.unstable_runWithPriority=function(w,Z){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var M=S;S=w;try{return Z()}finally{S=M}},r.unstable_scheduleCallback=function(w,Z,M){var oe=r.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?oe+M:oe):M=oe,w){case 1:var E=-1;break;case 2:E=250;break;case 5:E=1073741823;break;case 4:E=1e4;break;default:E=5e3}return E=M+E,w={id:j++,callback:Z,priorityLevel:w,startTime:M,expirationTime:E,sortIndex:-1},M>oe?(w.sortIndex=M,l(p,w),c(b)===null&&w===c(p)&&(B?(G(te),te=-1):B=!0,J(ee,M-oe))):(w.sortIndex=E,l(b,w),H||v||(H=!0,me||(me=!0,y()))),w},r.unstable_shouldYield=ie,r.unstable_wrapCallback=function(w){var Z=S;return function(){var M=S;S=Z;try{return w.apply(this,arguments)}finally{S=M}}}})(nd)),nd}var Sp;function Bx(){return Sp||(Sp=1,sd.exports=Fx()),sd.exports}var wp;function $x(){if(wp)return jl;wp=1;var r=Bx(),l=ef(),c=zx();function i(t){var a="https://react.dev/errors/"+t;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)a+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function u(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function m(t){var a=t,s=t;if(t.alternate)for(;a.return;)a=a.return;else{t=a;do a=t,(a.flags&4098)!==0&&(s=a.return),t=a.return;while(t)}return a.tag===3?s:null}function x(t){if(t.tag===13){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function f(t){if(t.tag===31){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function b(t){if(m(t)!==t)throw Error(i(188))}function p(t){var a=t.alternate;if(!a){if(a=m(t),a===null)throw Error(i(188));return a!==t?null:t}for(var s=t,n=a;;){var o=s.return;if(o===null)break;var d=o.alternate;if(d===null){if(n=o.return,n!==null){s=n;continue}break}if(o.child===d.child){for(d=o.child;d;){if(d===s)return b(o),t;if(d===n)return b(o),a;d=d.sibling}throw Error(i(188))}if(s.return!==n.return)s=o,n=d;else{for(var h=!1,_=o.child;_;){if(_===s){h=!0,s=o,n=d;break}if(_===n){h=!0,n=o,s=d;break}_=_.sibling}if(!h){for(_=d.child;_;){if(_===s){h=!0,s=d,n=o;break}if(_===n){h=!0,n=d,s=o;break}_=_.sibling}if(!h)throw Error(i(189))}}if(s.alternate!==n)throw Error(i(190))}if(s.tag!==3)throw Error(i(188));return s.stateNode.current===s?t:a}function j(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t;for(t=t.child;t!==null;){if(a=j(t),a!==null)return a;t=t.sibling}return null}var R=Object.assign,S=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),H=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),ae=Symbol.for("react.profiler"),G=Symbol.for("react.consumer"),O=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),ee=Symbol.for("react.suspense"),me=Symbol.for("react.suspense_list"),te=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),V=Symbol.for("react.activity"),ie=Symbol.for("react.memo_cache_sentinel"),D=Symbol.iterator;function y(t){return t===null||typeof t!="object"?null:(t=D&&t[D]||t["@@iterator"],typeof t=="function"?t:null)}var z=Symbol.for("react.client.reference");function L(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===z?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case B:return"Fragment";case ae:return"Profiler";case I:return"StrictMode";case ee:return"Suspense";case me:return"SuspenseList";case V:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case H:return"Portal";case O:return t.displayName||"Context";case G:return(t._context.displayName||"Context")+".Consumer";case C:var a=t.render;return t=t.displayName,t||(t=a.displayName||a.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case te:return a=t.displayName||null,a!==null?a:L(t.type)||"Memo";case P:a=t._payload,t=t._init;try{return L(t(a))}catch{}}return null}var J=Array.isArray,w=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z=c.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M={pending:!1,data:null,method:null,action:null},oe=[],E=-1;function U(t){return{current:t}}function de(t){0>E||(t.current=oe[E],oe[E]=null,E--)}function A(t,a){E++,oe[E]=t.current,t.current=a}var xe=U(null),Q=U(null),Se=U(null),he=U(null);function Oe(t,a){switch(A(Se,a),A(Q,t),A(xe,null),a.nodeType){case 9:case 11:t=(t=a.documentElement)&&(t=t.namespaceURI)?Gh(t):0;break;default:if(t=a.tagName,a=a.namespaceURI)a=Gh(a),t=Ph(a,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}de(xe),A(xe,t)}function Be(){de(xe),de(Q),de(Se)}function Re(t){t.memoizedState!==null&&A(he,t);var a=xe.current,s=Ph(a,t.type);a!==s&&(A(Q,t),A(xe,s))}function ze(t){Q.current===t&&(de(xe),de(Q)),he.current===t&&(de(he),hl._currentValue=M)}var pt,rt;function se(t){if(pt===void 0)try{throw Error()}catch(s){var a=s.stack.trim().match(/\n( *(at )?)/);pt=a&&a[1]||"",rt=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+pt+t+rt}var Ae=!1;function Ye(t,a){if(!t||Ae)return"";Ae=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(a){var _e=function(){throw Error()};if(Object.defineProperty(_e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_e,[])}catch(pe){var ue=pe}Reflect.construct(t,[],_e)}else{try{_e.call()}catch(pe){ue=pe}t.call(_e.prototype)}}else{try{throw Error()}catch(pe){ue=pe}(_e=t())&&typeof _e.catch=="function"&&_e.catch(function(){})}}catch(pe){if(pe&&ue&&typeof pe.stack=="string")return[pe.stack,ue.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=n.DetermineComponentFrameRoot(),h=d[0],_=d[1];if(h&&_){var F=h.split(`
`),ce=_.split(`
`);for(o=n=0;n<F.length&&!F[n].includes("DetermineComponentFrameRoot");)n++;for(;o<ce.length&&!ce[o].includes("DetermineComponentFrameRoot");)o++;if(n===F.length||o===ce.length)for(n=F.length-1,o=ce.length-1;1<=n&&0<=o&&F[n]!==ce[o];)o--;for(;1<=n&&0<=o;n--,o--)if(F[n]!==ce[o]){if(n!==1||o!==1)do if(n--,o--,0>o||F[n]!==ce[o]){var je=`
`+F[n].replace(" at new "," at ");return t.displayName&&je.includes("<anonymous>")&&(je=je.replace("<anonymous>",t.displayName)),je}while(1<=n&&0<=o);break}}}finally{Ae=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?se(s):""}function ft(t,a){switch(t.tag){case 26:case 27:case 5:return se(t.type);case 16:return se("Lazy");case 13:return t.child!==a&&a!==null?se("Suspense Fallback"):se("Suspense");case 19:return se("SuspenseList");case 0:case 15:return Ye(t.type,!1);case 11:return Ye(t.type.render,!1);case 1:return Ye(t.type,!0);case 31:return se("Activity");default:return""}}function ja(t){try{var a="",s=null;do a+=ft(t,s),s=t,t=t.return;while(t);return a}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var Ce=Object.prototype.hasOwnProperty,qe=r.unstable_scheduleCallback,Fe=r.unstable_cancelCallback,Ze=r.unstable_shouldYield,Ke=r.unstable_requestPaint,et=r.unstable_now,Me=r.unstable_getCurrentPriorityLevel,bt=r.unstable_ImmediatePriority,kt=r.unstable_UserBlockingPriority,Mt=r.unstable_NormalPriority,Gt=r.unstable_LowPriority,Et=r.unstable_IdlePriority,aa=r.log,da=r.unstable_setDisableYieldValue,St=null,Je=null;function qt(t){if(typeof aa=="function"&&da(t),Je&&typeof Je.setStrictMode=="function")try{Je.setStrictMode(St,t)}catch{}}var Ee=Math.clz32?Math.clz32:we,Y=Math.log,q=Math.LN2;function we(t){return t>>>=0,t===0?32:31-(Y(t)/q|0)|0}var lt=256,De=262144,ve=4194304;function at(t){var a=t&42;if(a!==0)return a;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function ot(t,a,s){var n=t.pendingLanes;if(n===0)return 0;var o=0,d=t.suspendedLanes,h=t.pingedLanes;t=t.warmLanes;var _=n&134217727;return _!==0?(n=_&~d,n!==0?o=at(n):(h&=_,h!==0?o=at(h):s||(s=_&~t,s!==0&&(o=at(s))))):(_=n&~d,_!==0?o=at(_):h!==0?o=at(h):s||(s=n&~t,s!==0&&(o=at(s)))),o===0?0:a!==0&&a!==o&&(a&d)===0&&(d=o&-o,s=a&-a,d>=s||d===32&&(s&4194048)!==0)?a:o}function Yt(t,a){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&a)===0}function sa(t,a){switch(t){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ne(){var t=ve;return ve<<=1,(ve&62914560)===0&&(ve=4194304),t}function xt(t){for(var a=[],s=0;31>s;s++)a.push(t);return a}function dt(t,a){t.pendingLanes|=a,a!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Oa(t,a,s,n,o,d){var h=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var _=t.entanglements,F=t.expirationTimes,ce=t.hiddenUpdates;for(s=h&~s;0<s;){var je=31-Ee(s),_e=1<<je;_[je]=0,F[je]=-1;var ue=ce[je];if(ue!==null)for(ce[je]=null,je=0;je<ue.length;je++){var pe=ue[je];pe!==null&&(pe.lane&=-536870913)}s&=~_e}n!==0&&ke(t,n,0),d!==0&&o===0&&t.tag!==0&&(t.suspendedLanes|=d&~(h&~a))}function ke(t,a,s){t.pendingLanes|=a,t.suspendedLanes&=~a;var n=31-Ee(a);t.entangledLanes|=a,t.entanglements[n]=t.entanglements[n]|1073741824|s&261930}function T(t,a){var s=t.entangledLanes|=a;for(t=t.entanglements;s;){var n=31-Ee(s),o=1<<n;o&a|t[n]&a&&(t[n]|=a),s&=~o}}function ge(t,a){var s=a&-a;return s=(s&42)!==0?1:fe(s),(s&(t.suspendedLanes|a))!==0?0:s}function fe(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Te(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function jt(){var t=Z.p;return t!==0?t:(t=window.event,t===void 0?32:pp(t.type))}function it(t,a){var s=Z.p;try{return Z.p=t,a()}finally{Z.p=s}}var Dt=Math.random().toString(36).slice(2),ct="__reactFiber$"+Dt,mt="__reactProps$"+Dt,va="__reactContainer$"+Dt,Qt="__reactEvents$"+Dt,Na="__reactListeners$"+Dt,$e="__reactHandles$"+Dt,st="__reactResources$"+Dt,Xt="__reactMarker$"+Dt;function ya(t){delete t[ct],delete t[mt],delete t[Qt],delete t[Na],delete t[$e]}function Ba(t){var a=t[ct];if(a)return a;for(var s=t.parentNode;s;){if(a=s[va]||s[ct]){if(s=a.alternate,a.child!==null||s!==null&&s.child!==null)for(t=Wh(t);t!==null;){if(s=t[ct])return s;t=Wh(t)}return a}t=s,s=t.parentNode}return null}function ba(t){if(t=t[ct]||t[va]){var a=t.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return t}return null}function It(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t.stateNode;throw Error(i(33))}function ga(t){var a=t[st];return a||(a=t[st]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Tt(t){t[Xt]=!0}var $a=new Set,Ve={};function tt(t,a){At(t,a),At(t+"Capture",a)}function At(t,a){for(Ve[t]=a,t=0;t<a.length;t++)$a.add(a[t])}var $t=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),N={},ne={};function be(t){return Ce.call(ne,t)?!0:Ce.call(N,t)?!1:$t.test(t)?ne[t]=!0:(N[t]=!0,!1)}function re(t,a,s){if(be(a))if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(a);return;case"boolean":var n=a.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){t.removeAttribute(a);return}}t.setAttribute(a,""+s)}}function Ge(t,a,s){if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(a);return}t.setAttribute(a,""+s)}}function Ue(t,a,s,n){if(n===null)t.removeAttribute(s);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(a,s,""+n)}}function gt(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Qe(t){var a=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function ua(t,a,s){var n=Object.getOwnPropertyDescriptor(t.constructor.prototype,a);if(!t.hasOwnProperty(a)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,d=n.set;return Object.defineProperty(t,a,{configurable:!0,get:function(){return o.call(this)},set:function(h){s=""+h,d.call(this,h)}}),Object.defineProperty(t,a,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(h){s=""+h},stopTracking:function(){t._valueTracker=null,delete t[a]}}}}function Ka(t){if(!t._valueTracker){var a=Qe(t)?"checked":"value";t._valueTracker=ua(t,a,""+t[a])}}function Sl(t){if(!t)return!1;var a=t._valueTracker;if(!a)return!0;var s=a.getValue(),n="";return t&&(n=Qe(t)?t.checked?"true":"false":t.value),t=n,t!==s?(a.setValue(t),!0):!1}function Dr(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var Kt=/[\n"\\]/g;function ea(t){return t.replace(Kt,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Xi(t,a,s,n,o,d,h,_){t.name="",h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"?t.type=h:t.removeAttribute("type"),a!=null?h==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+gt(a)):t.value!==""+gt(a)&&(t.value=""+gt(a)):h!=="submit"&&h!=="reset"||t.removeAttribute("value"),a!=null?Ii(t,h,gt(a)):s!=null?Ii(t,h,gt(s)):n!=null&&t.removeAttribute("value"),o==null&&d!=null&&(t.defaultChecked=!!d),o!=null&&(t.checked=o&&typeof o!="function"&&typeof o!="symbol"),_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?t.name=""+gt(_):t.removeAttribute("name")}function Ud(t,a,s,n,o,d,h,_){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(t.type=d),a!=null||s!=null){if(!(d!=="submit"&&d!=="reset"||a!=null)){Ka(t);return}s=s!=null?""+gt(s):"",a=a!=null?""+gt(a):s,_||a===t.value||(t.value=a),t.defaultValue=a}n=n??o,n=typeof n!="function"&&typeof n!="symbol"&&!!n,t.checked=_?t.checked:!!n,t.defaultChecked=!!n,h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(t.name=h),Ka(t)}function Ii(t,a,s){a==="number"&&Dr(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function Gn(t,a,s,n){if(t=t.options,a){a={};for(var o=0;o<s.length;o++)a["$"+s[o]]=!0;for(s=0;s<t.length;s++)o=a.hasOwnProperty("$"+t[s].value),t[s].selected!==o&&(t[s].selected=o),o&&n&&(t[s].defaultSelected=!0)}else{for(s=""+gt(s),a=null,o=0;o<t.length;o++){if(t[o].value===s){t[o].selected=!0,n&&(t[o].defaultSelected=!0);return}a!==null||t[o].disabled||(a=t[o])}a!==null&&(a.selected=!0)}}function Hd(t,a,s){if(a!=null&&(a=""+gt(a),a!==t.value&&(t.value=a),s==null)){t.defaultValue!==a&&(t.defaultValue=a);return}t.defaultValue=s!=null?""+gt(s):""}function Fd(t,a,s,n){if(a==null){if(n!=null){if(s!=null)throw Error(i(92));if(J(n)){if(1<n.length)throw Error(i(93));n=n[0]}s=n}s==null&&(s=""),a=s}s=gt(a),t.defaultValue=s,n=t.textContent,n===s&&n!==""&&n!==null&&(t.value=n),Ka(t)}function Pn(t,a){if(a){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=a;return}}t.textContent=a}var Ef=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Bd(t,a,s){var n=a.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?n?t.setProperty(a,""):a==="float"?t.cssFloat="":t[a]="":n?t.setProperty(a,s):typeof s!="number"||s===0||Ef.has(a)?a==="float"?t.cssFloat=s:t[a]=(""+s).trim():t[a]=s+"px"}function $d(t,a,s){if(a!=null&&typeof a!="object")throw Error(i(62));if(t=t.style,s!=null){for(var n in s)!s.hasOwnProperty(n)||a!=null&&a.hasOwnProperty(n)||(n.indexOf("--")===0?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="");for(var o in a)n=a[o],a.hasOwnProperty(o)&&s[o]!==n&&Bd(t,o,n)}else for(var d in a)a.hasOwnProperty(d)&&Bd(t,d,a[d])}function Zi(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Df=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Mf=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function wl(t){return Mf.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function ys(){}var Ji=null;function Wi(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Yn=null,Qn=null;function Vd(t){var a=ba(t);if(a&&(t=a.stateNode)){var s=t[mt]||null;e:switch(t=a.stateNode,a.type){case"input":if(Xi(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),a=s.name,s.type==="radio"&&a!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+ea(""+a)+'"][type="radio"]'),a=0;a<s.length;a++){var n=s[a];if(n!==t&&n.form===t.form){var o=n[mt]||null;if(!o)throw Error(i(90));Xi(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(a=0;a<s.length;a++)n=s[a],n.form===t.form&&Sl(n)}break e;case"textarea":Hd(t,s.value,s.defaultValue);break e;case"select":a=s.value,a!=null&&Gn(t,!!s.multiple,a,!1)}}}var Ki=!1;function Gd(t,a,s){if(Ki)return t(a,s);Ki=!0;try{var n=t(a);return n}finally{if(Ki=!1,(Yn!==null||Qn!==null)&&(mi(),Yn&&(a=Yn,t=Qn,Qn=Yn=null,Vd(a),t)))for(a=0;a<t.length;a++)Vd(t[a])}}function Mr(t,a){var s=t.stateNode;if(s===null)return null;var n=s[mt]||null;if(n===null)return null;s=n[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(i(231,a,typeof s));return s}var bs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ec=!1;if(bs)try{var Tr={};Object.defineProperty(Tr,"passive",{get:function(){ec=!0}}),window.addEventListener("test",Tr,Tr),window.removeEventListener("test",Tr,Tr)}catch{ec=!1}var $s=null,tc=null,Cl=null;function Pd(){if(Cl)return Cl;var t,a=tc,s=a.length,n,o="value"in $s?$s.value:$s.textContent,d=o.length;for(t=0;t<s&&a[t]===o[t];t++);var h=s-t;for(n=1;n<=h&&a[s-n]===o[d-n];n++);return Cl=o.slice(t,1<n?1-n:void 0)}function kl(t){var a=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&a===13&&(t=13)):t=a,t===10&&(t=13),32<=t||t===13?t:0}function El(){return!0}function Yd(){return!1}function Ra(t){function a(s,n,o,d,h){this._reactName=s,this._targetInst=o,this.type=n,this.nativeEvent=d,this.target=h,this.currentTarget=null;for(var _ in t)t.hasOwnProperty(_)&&(s=t[_],this[_]=s?s(d):d[_]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?El:Yd,this.isPropagationStopped=Yd,this}return R(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=El)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=El)},persist:function(){},isPersistent:El}),a}var yn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Dl=Ra(yn),Ar=R({},yn,{view:0,detail:0}),Tf=Ra(Ar),ac,sc,zr,Ml=R({},Ar,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:rc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==zr&&(zr&&t.type==="mousemove"?(ac=t.screenX-zr.screenX,sc=t.screenY-zr.screenY):sc=ac=0,zr=t),ac)},movementY:function(t){return"movementY"in t?t.movementY:sc}}),Qd=Ra(Ml),Af=R({},Ml,{dataTransfer:0}),zf=Ra(Af),Of=R({},Ar,{relatedTarget:0}),nc=Ra(Of),Rf=R({},yn,{animationName:0,elapsedTime:0,pseudoElement:0}),qf=Ra(Rf),Lf=R({},yn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Uf=Ra(Lf),Hf=R({},yn,{data:0}),Xd=Ra(Hf),Ff={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$f={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vf(t){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(t):(t=$f[t])?!!a[t]:!1}function rc(){return Vf}var Gf=R({},Ar,{key:function(t){if(t.key){var a=Ff[t.key]||t.key;if(a!=="Unidentified")return a}return t.type==="keypress"?(t=kl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Bf[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:rc,charCode:function(t){return t.type==="keypress"?kl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?kl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Pf=Ra(Gf),Yf=R({},Ml,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Id=Ra(Yf),Qf=R({},Ar,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:rc}),Xf=Ra(Qf),If=R({},yn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Zf=Ra(If),Jf=R({},Ml,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Wf=Ra(Jf),Kf=R({},yn,{newState:0,oldState:0}),eg=Ra(Kf),tg=[9,13,27,32],lc=bs&&"CompositionEvent"in window,Or=null;bs&&"documentMode"in document&&(Or=document.documentMode);var ag=bs&&"TextEvent"in window&&!Or,Zd=bs&&(!lc||Or&&8<Or&&11>=Or),Jd=" ",Wd=!1;function Kd(t,a){switch(t){case"keyup":return tg.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eu(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Xn=!1;function sg(t,a){switch(t){case"compositionend":return eu(a);case"keypress":return a.which!==32?null:(Wd=!0,Jd);case"textInput":return t=a.data,t===Jd&&Wd?null:t;default:return null}}function ng(t,a){if(Xn)return t==="compositionend"||!lc&&Kd(t,a)?(t=Pd(),Cl=tc=$s=null,Xn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Zd&&a.locale!=="ko"?null:a.data;default:return null}}var rg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tu(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a==="input"?!!rg[t.type]:a==="textarea"}function au(t,a,s,n){Yn?Qn?Qn.push(n):Qn=[n]:Yn=n,a=vi(a,"onChange"),0<a.length&&(s=new Dl("onChange","change",null,s,n),t.push({event:s,listeners:a}))}var Rr=null,qr=null;function lg(t){Uh(t,0)}function Tl(t){var a=It(t);if(Sl(a))return t}function su(t,a){if(t==="change")return a}var nu=!1;if(bs){var ic;if(bs){var cc="oninput"in document;if(!cc){var ru=document.createElement("div");ru.setAttribute("oninput","return;"),cc=typeof ru.oninput=="function"}ic=cc}else ic=!1;nu=ic&&(!document.documentMode||9<document.documentMode)}function lu(){Rr&&(Rr.detachEvent("onpropertychange",iu),qr=Rr=null)}function iu(t){if(t.propertyName==="value"&&Tl(qr)){var a=[];au(a,qr,t,Wi(t)),Gd(lg,a)}}function ig(t,a,s){t==="focusin"?(lu(),Rr=a,qr=s,Rr.attachEvent("onpropertychange",iu)):t==="focusout"&&lu()}function cg(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Tl(qr)}function og(t,a){if(t==="click")return Tl(a)}function dg(t,a){if(t==="input"||t==="change")return Tl(a)}function ug(t,a){return t===a&&(t!==0||1/t===1/a)||t!==t&&a!==a}var Va=typeof Object.is=="function"?Object.is:ug;function Lr(t,a){if(Va(t,a))return!0;if(typeof t!="object"||t===null||typeof a!="object"||a===null)return!1;var s=Object.keys(t),n=Object.keys(a);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var o=s[n];if(!Ce.call(a,o)||!Va(t[o],a[o]))return!1}return!0}function cu(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ou(t,a){var s=cu(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=a&&n>=a)return{node:s,offset:a-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=cu(s)}}function du(t,a){return t&&a?t===a?!0:t&&t.nodeType===3?!1:a&&a.nodeType===3?du(t,a.parentNode):"contains"in t?t.contains(a):t.compareDocumentPosition?!!(t.compareDocumentPosition(a)&16):!1:!1}function uu(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var a=Dr(t.document);a instanceof t.HTMLIFrameElement;){try{var s=typeof a.contentWindow.location.href=="string"}catch{s=!1}if(s)t=a.contentWindow;else break;a=Dr(t.document)}return a}function oc(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a&&(a==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||a==="textarea"||t.contentEditable==="true")}var mg=bs&&"documentMode"in document&&11>=document.documentMode,In=null,dc=null,Ur=null,uc=!1;function mu(t,a,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;uc||In==null||In!==Dr(n)||(n=In,"selectionStart"in n&&oc(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Ur&&Lr(Ur,n)||(Ur=n,n=vi(dc,"onSelect"),0<n.length&&(a=new Dl("onSelect","select",null,a,s),t.push({event:a,listeners:n}),a.target=In)))}function bn(t,a){var s={};return s[t.toLowerCase()]=a.toLowerCase(),s["Webkit"+t]="webkit"+a,s["Moz"+t]="moz"+a,s}var Zn={animationend:bn("Animation","AnimationEnd"),animationiteration:bn("Animation","AnimationIteration"),animationstart:bn("Animation","AnimationStart"),transitionrun:bn("Transition","TransitionRun"),transitionstart:bn("Transition","TransitionStart"),transitioncancel:bn("Transition","TransitionCancel"),transitionend:bn("Transition","TransitionEnd")},mc={},hu={};bs&&(hu=document.createElement("div").style,"AnimationEvent"in window||(delete Zn.animationend.animation,delete Zn.animationiteration.animation,delete Zn.animationstart.animation),"TransitionEvent"in window||delete Zn.transitionend.transition);function _n(t){if(mc[t])return mc[t];if(!Zn[t])return t;var a=Zn[t],s;for(s in a)if(a.hasOwnProperty(s)&&s in hu)return mc[t]=a[s];return t}var pu=_n("animationend"),fu=_n("animationiteration"),gu=_n("animationstart"),hg=_n("transitionrun"),pg=_n("transitionstart"),fg=_n("transitioncancel"),xu=_n("transitionend"),ju=new Map,hc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");hc.push("scrollEnd");function us(t,a){ju.set(t,a),tt(a,[t])}var Al=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},es=[],Jn=0,pc=0;function zl(){for(var t=Jn,a=pc=Jn=0;a<t;){var s=es[a];es[a++]=null;var n=es[a];es[a++]=null;var o=es[a];es[a++]=null;var d=es[a];if(es[a++]=null,n!==null&&o!==null){var h=n.pending;h===null?o.next=o:(o.next=h.next,h.next=o),n.pending=o}d!==0&&vu(s,o,d)}}function Ol(t,a,s,n){es[Jn++]=t,es[Jn++]=a,es[Jn++]=s,es[Jn++]=n,pc|=n,t.lanes|=n,t=t.alternate,t!==null&&(t.lanes|=n)}function fc(t,a,s,n){return Ol(t,a,s,n),Rl(t)}function Nn(t,a){return Ol(t,null,null,a),Rl(t)}function vu(t,a,s){t.lanes|=s;var n=t.alternate;n!==null&&(n.lanes|=s);for(var o=!1,d=t.return;d!==null;)d.childLanes|=s,n=d.alternate,n!==null&&(n.childLanes|=s),d.tag===22&&(t=d.stateNode,t===null||t._visibility&1||(o=!0)),t=d,d=d.return;return t.tag===3?(d=t.stateNode,o&&a!==null&&(o=31-Ee(s),t=d.hiddenUpdates,n=t[o],n===null?t[o]=[a]:n.push(a),a.lane=s|536870912),d):null}function Rl(t){if(50<ll)throw ll=0,wo=null,Error(i(185));for(var a=t.return;a!==null;)t=a,a=t.return;return t.tag===3?t.stateNode:null}var Wn={};function gg(t,a,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ga(t,a,s,n){return new gg(t,a,s,n)}function gc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function _s(t,a){var s=t.alternate;return s===null?(s=Ga(t.tag,a,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=a,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,a=t.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function yu(t,a){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=a,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,a=s.dependencies,t.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),t}function ql(t,a,s,n,o,d){var h=0;if(n=t,typeof t=="function")gc(t)&&(h=1);else if(typeof t=="string")h=bx(t,s,xe.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case V:return t=Ga(31,s,a,o),t.elementType=V,t.lanes=d,t;case B:return Sn(s.children,o,d,a);case I:h=8,o|=24;break;case ae:return t=Ga(12,s,a,o|2),t.elementType=ae,t.lanes=d,t;case ee:return t=Ga(13,s,a,o),t.elementType=ee,t.lanes=d,t;case me:return t=Ga(19,s,a,o),t.elementType=me,t.lanes=d,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case O:h=10;break e;case G:h=9;break e;case C:h=11;break e;case te:h=14;break e;case P:h=16,n=null;break e}h=29,s=Error(i(130,t===null?"null":typeof t,"")),n=null}return a=Ga(h,s,a,o),a.elementType=t,a.type=n,a.lanes=d,a}function Sn(t,a,s,n){return t=Ga(7,t,n,a),t.lanes=s,t}function xc(t,a,s){return t=Ga(6,t,null,a),t.lanes=s,t}function bu(t){var a=Ga(18,null,null,0);return a.stateNode=t,a}function jc(t,a,s){return a=Ga(4,t.children!==null?t.children:[],t.key,a),a.lanes=s,a.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},a}var _u=new WeakMap;function ts(t,a){if(typeof t=="object"&&t!==null){var s=_u.get(t);return s!==void 0?s:(a={value:t,source:a,stack:ja(a)},_u.set(t,a),a)}return{value:t,source:a,stack:ja(a)}}var Kn=[],er=0,Ll=null,Hr=0,as=[],ss=0,Vs=null,fs=1,gs="";function Ns(t,a){Kn[er++]=Hr,Kn[er++]=Ll,Ll=t,Hr=a}function Nu(t,a,s){as[ss++]=fs,as[ss++]=gs,as[ss++]=Vs,Vs=t;var n=fs;t=gs;var o=32-Ee(n)-1;n&=~(1<<o),s+=1;var d=32-Ee(a)+o;if(30<d){var h=o-o%5;d=(n&(1<<h)-1).toString(32),n>>=h,o-=h,fs=1<<32-Ee(a)+o|s<<o|n,gs=d+t}else fs=1<<d|s<<o|n,gs=t}function vc(t){t.return!==null&&(Ns(t,1),Nu(t,1,0))}function yc(t){for(;t===Ll;)Ll=Kn[--er],Kn[er]=null,Hr=Kn[--er],Kn[er]=null;for(;t===Vs;)Vs=as[--ss],as[ss]=null,gs=as[--ss],as[ss]=null,fs=as[--ss],as[ss]=null}function Su(t,a){as[ss++]=fs,as[ss++]=gs,as[ss++]=Vs,fs=a.id,gs=a.overflow,Vs=t}var Sa=null,Zt=null,wt=!1,Gs=null,ns=!1,bc=Error(i(519));function Ps(t){var a=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Fr(ts(a,t)),bc}function wu(t){var a=t.stateNode,s=t.type,n=t.memoizedProps;switch(a[ct]=t,a[mt]=n,s){case"dialog":yt("cancel",a),yt("close",a);break;case"iframe":case"object":case"embed":yt("load",a);break;case"video":case"audio":for(s=0;s<cl.length;s++)yt(cl[s],a);break;case"source":yt("error",a);break;case"img":case"image":case"link":yt("error",a),yt("load",a);break;case"details":yt("toggle",a);break;case"input":yt("invalid",a),Ud(a,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":yt("invalid",a);break;case"textarea":yt("invalid",a),Fd(a,n.value,n.defaultValue,n.children)}s=n.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||a.textContent===""+s||n.suppressHydrationWarning===!0||$h(a.textContent,s)?(n.popover!=null&&(yt("beforetoggle",a),yt("toggle",a)),n.onScroll!=null&&yt("scroll",a),n.onScrollEnd!=null&&yt("scrollend",a),n.onClick!=null&&(a.onclick=ys),a=!0):a=!1,a||Ps(t,!0)}function Cu(t){for(Sa=t.return;Sa;)switch(Sa.tag){case 5:case 31:case 13:ns=!1;return;case 27:case 3:ns=!0;return;default:Sa=Sa.return}}function tr(t){if(t!==Sa)return!1;if(!wt)return Cu(t),wt=!0,!1;var a=t.tag,s;if((s=a!==3&&a!==27)&&((s=a===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||Fo(t.type,t.memoizedProps)),s=!s),s&&Zt&&Ps(t),Cu(t),a===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(317));Zt=Jh(t)}else if(a===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(317));Zt=Jh(t)}else a===27?(a=Zt,rn(t.type)?(t=Po,Po=null,Zt=t):Zt=a):Zt=Sa?ls(t.stateNode.nextSibling):null;return!0}function wn(){Zt=Sa=null,wt=!1}function _c(){var t=Gs;return t!==null&&(Ha===null?Ha=t:Ha.push.apply(Ha,t),Gs=null),t}function Fr(t){Gs===null?Gs=[t]:Gs.push(t)}var Nc=U(null),Cn=null,Ss=null;function Ys(t,a,s){A(Nc,a._currentValue),a._currentValue=s}function ws(t){t._currentValue=Nc.current,de(Nc)}function Sc(t,a,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&a)!==a?(t.childLanes|=a,n!==null&&(n.childLanes|=a)):n!==null&&(n.childLanes&a)!==a&&(n.childLanes|=a),t===s)break;t=t.return}}function wc(t,a,s,n){var o=t.child;for(o!==null&&(o.return=t);o!==null;){var d=o.dependencies;if(d!==null){var h=o.child;d=d.firstContext;e:for(;d!==null;){var _=d;d=o;for(var F=0;F<a.length;F++)if(_.context===a[F]){d.lanes|=s,_=d.alternate,_!==null&&(_.lanes|=s),Sc(d.return,s,t),n||(h=null);break e}d=_.next}}else if(o.tag===18){if(h=o.return,h===null)throw Error(i(341));h.lanes|=s,d=h.alternate,d!==null&&(d.lanes|=s),Sc(h,s,t),h=null}else h=o.child;if(h!==null)h.return=o;else for(h=o;h!==null;){if(h===t){h=null;break}if(o=h.sibling,o!==null){o.return=h.return,h=o;break}h=h.return}o=h}}function ar(t,a,s,n){t=null;for(var o=a,d=!1;o!==null;){if(!d){if((o.flags&524288)!==0)d=!0;else if((o.flags&262144)!==0)break}if(o.tag===10){var h=o.alternate;if(h===null)throw Error(i(387));if(h=h.memoizedProps,h!==null){var _=o.type;Va(o.pendingProps.value,h.value)||(t!==null?t.push(_):t=[_])}}else if(o===he.current){if(h=o.alternate,h===null)throw Error(i(387));h.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(t!==null?t.push(hl):t=[hl])}o=o.return}t!==null&&wc(a,t,s,n),a.flags|=262144}function Ul(t){for(t=t.firstContext;t!==null;){if(!Va(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function kn(t){Cn=t,Ss=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function wa(t){return ku(Cn,t)}function Hl(t,a){return Cn===null&&kn(t),ku(t,a)}function ku(t,a){var s=a._currentValue;if(a={context:a,memoizedValue:s,next:null},Ss===null){if(t===null)throw Error(i(308));Ss=a,t.dependencies={lanes:0,firstContext:a},t.flags|=524288}else Ss=Ss.next=a;return s}var xg=typeof AbortController<"u"?AbortController:function(){var t=[],a=this.signal={aborted:!1,addEventListener:function(s,n){t.push(n)}};this.abort=function(){a.aborted=!0,t.forEach(function(s){return s()})}},jg=r.unstable_scheduleCallback,vg=r.unstable_NormalPriority,ma={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Cc(){return{controller:new xg,data:new Map,refCount:0}}function Br(t){t.refCount--,t.refCount===0&&jg(vg,function(){t.controller.abort()})}var $r=null,kc=0,sr=0,nr=null;function yg(t,a){if($r===null){var s=$r=[];kc=0,sr=To(),nr={status:"pending",value:void 0,then:function(n){s.push(n)}}}return kc++,a.then(Eu,Eu),a}function Eu(){if(--kc===0&&$r!==null){nr!==null&&(nr.status="fulfilled");var t=$r;$r=null,sr=0,nr=null;for(var a=0;a<t.length;a++)(0,t[a])()}}function bg(t,a){var s=[],n={status:"pending",value:null,reason:null,then:function(o){s.push(o)}};return t.then(function(){n.status="fulfilled",n.value=a;for(var o=0;o<s.length;o++)(0,s[o])(a)},function(o){for(n.status="rejected",n.reason=o,o=0;o<s.length;o++)(0,s[o])(void 0)}),n}var Du=w.S;w.S=function(t,a){mh=et(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&yg(t,a),Du!==null&&Du(t,a)};var En=U(null);function Ec(){var t=En.current;return t!==null?t:Vt.pooledCache}function Fl(t,a){a===null?A(En,En.current):A(En,a.pool)}function Mu(){var t=Ec();return t===null?null:{parent:ma._currentValue,pool:t}}var rr=Error(i(460)),Dc=Error(i(474)),Bl=Error(i(542)),$l={then:function(){}};function Tu(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Au(t,a,s){switch(s=t[s],s===void 0?t.push(a):s!==a&&(a.then(ys,ys),a=s),a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,Ou(t),t;default:if(typeof a.status=="string")a.then(ys,ys);else{if(t=Vt,t!==null&&100<t.shellSuspendCounter)throw Error(i(482));t=a,t.status="pending",t.then(function(n){if(a.status==="pending"){var o=a;o.status="fulfilled",o.value=n}},function(n){if(a.status==="pending"){var o=a;o.status="rejected",o.reason=n}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,Ou(t),t}throw Mn=a,rr}}function Dn(t){try{var a=t._init;return a(t._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(Mn=s,rr):s}}var Mn=null;function zu(){if(Mn===null)throw Error(i(459));var t=Mn;return Mn=null,t}function Ou(t){if(t===rr||t===Bl)throw Error(i(483))}var lr=null,Vr=0;function Vl(t){var a=Vr;return Vr+=1,lr===null&&(lr=[]),Au(lr,t,a)}function Gr(t,a){a=a.props.ref,t.ref=a!==void 0?a:null}function Gl(t,a){throw a.$$typeof===S?Error(i(525)):(t=Object.prototype.toString.call(a),Error(i(31,t==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":t)))}function Ru(t){function a(W,X){if(t){var le=W.deletions;le===null?(W.deletions=[X],W.flags|=16):le.push(X)}}function s(W,X){if(!t)return null;for(;X!==null;)a(W,X),X=X.sibling;return null}function n(W){for(var X=new Map;W!==null;)W.key!==null?X.set(W.key,W):X.set(W.index,W),W=W.sibling;return X}function o(W,X){return W=_s(W,X),W.index=0,W.sibling=null,W}function d(W,X,le){return W.index=le,t?(le=W.alternate,le!==null?(le=le.index,le<X?(W.flags|=67108866,X):le):(W.flags|=67108866,X)):(W.flags|=1048576,X)}function h(W){return t&&W.alternate===null&&(W.flags|=67108866),W}function _(W,X,le,ye){return X===null||X.tag!==6?(X=xc(le,W.mode,ye),X.return=W,X):(X=o(X,le),X.return=W,X)}function F(W,X,le,ye){var We=le.type;return We===B?je(W,X,le.props.children,ye,le.key):X!==null&&(X.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===P&&Dn(We)===X.type)?(X=o(X,le.props),Gr(X,le),X.return=W,X):(X=ql(le.type,le.key,le.props,null,W.mode,ye),Gr(X,le),X.return=W,X)}function ce(W,X,le,ye){return X===null||X.tag!==4||X.stateNode.containerInfo!==le.containerInfo||X.stateNode.implementation!==le.implementation?(X=jc(le,W.mode,ye),X.return=W,X):(X=o(X,le.children||[]),X.return=W,X)}function je(W,X,le,ye,We){return X===null||X.tag!==7?(X=Sn(le,W.mode,ye,We),X.return=W,X):(X=o(X,le),X.return=W,X)}function _e(W,X,le){if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return X=xc(""+X,W.mode,le),X.return=W,X;if(typeof X=="object"&&X!==null){switch(X.$$typeof){case v:return le=ql(X.type,X.key,X.props,null,W.mode,le),Gr(le,X),le.return=W,le;case H:return X=jc(X,W.mode,le),X.return=W,X;case P:return X=Dn(X),_e(W,X,le)}if(J(X)||y(X))return X=Sn(X,W.mode,le,null),X.return=W,X;if(typeof X.then=="function")return _e(W,Vl(X),le);if(X.$$typeof===O)return _e(W,Hl(W,X),le);Gl(W,X)}return null}function ue(W,X,le,ye){var We=X!==null?X.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return We!==null?null:_(W,X,""+le,ye);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case v:return le.key===We?F(W,X,le,ye):null;case H:return le.key===We?ce(W,X,le,ye):null;case P:return le=Dn(le),ue(W,X,le,ye)}if(J(le)||y(le))return We!==null?null:je(W,X,le,ye,null);if(typeof le.then=="function")return ue(W,X,Vl(le),ye);if(le.$$typeof===O)return ue(W,X,Hl(W,le),ye);Gl(W,le)}return null}function pe(W,X,le,ye,We){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return W=W.get(le)||null,_(X,W,""+ye,We);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case v:return W=W.get(ye.key===null?le:ye.key)||null,F(X,W,ye,We);case H:return W=W.get(ye.key===null?le:ye.key)||null,ce(X,W,ye,We);case P:return ye=Dn(ye),pe(W,X,le,ye,We)}if(J(ye)||y(ye))return W=W.get(le)||null,je(X,W,ye,We,null);if(typeof ye.then=="function")return pe(W,X,le,Vl(ye),We);if(ye.$$typeof===O)return pe(W,X,le,Hl(X,ye),We);Gl(X,ye)}return null}function Pe(W,X,le,ye){for(var We=null,zt=null,Xe=X,ht=X=0,Nt=null;Xe!==null&&ht<le.length;ht++){Xe.index>ht?(Nt=Xe,Xe=null):Nt=Xe.sibling;var Ot=ue(W,Xe,le[ht],ye);if(Ot===null){Xe===null&&(Xe=Nt);break}t&&Xe&&Ot.alternate===null&&a(W,Xe),X=d(Ot,X,ht),zt===null?We=Ot:zt.sibling=Ot,zt=Ot,Xe=Nt}if(ht===le.length)return s(W,Xe),wt&&Ns(W,ht),We;if(Xe===null){for(;ht<le.length;ht++)Xe=_e(W,le[ht],ye),Xe!==null&&(X=d(Xe,X,ht),zt===null?We=Xe:zt.sibling=Xe,zt=Xe);return wt&&Ns(W,ht),We}for(Xe=n(Xe);ht<le.length;ht++)Nt=pe(Xe,W,ht,le[ht],ye),Nt!==null&&(t&&Nt.alternate!==null&&Xe.delete(Nt.key===null?ht:Nt.key),X=d(Nt,X,ht),zt===null?We=Nt:zt.sibling=Nt,zt=Nt);return t&&Xe.forEach(function(un){return a(W,un)}),wt&&Ns(W,ht),We}function nt(W,X,le,ye){if(le==null)throw Error(i(151));for(var We=null,zt=null,Xe=X,ht=X=0,Nt=null,Ot=le.next();Xe!==null&&!Ot.done;ht++,Ot=le.next()){Xe.index>ht?(Nt=Xe,Xe=null):Nt=Xe.sibling;var un=ue(W,Xe,Ot.value,ye);if(un===null){Xe===null&&(Xe=Nt);break}t&&Xe&&un.alternate===null&&a(W,Xe),X=d(un,X,ht),zt===null?We=un:zt.sibling=un,zt=un,Xe=Nt}if(Ot.done)return s(W,Xe),wt&&Ns(W,ht),We;if(Xe===null){for(;!Ot.done;ht++,Ot=le.next())Ot=_e(W,Ot.value,ye),Ot!==null&&(X=d(Ot,X,ht),zt===null?We=Ot:zt.sibling=Ot,zt=Ot);return wt&&Ns(W,ht),We}for(Xe=n(Xe);!Ot.done;ht++,Ot=le.next())Ot=pe(Xe,W,ht,Ot.value,ye),Ot!==null&&(t&&Ot.alternate!==null&&Xe.delete(Ot.key===null?ht:Ot.key),X=d(Ot,X,ht),zt===null?We=Ot:zt.sibling=Ot,zt=Ot);return t&&Xe.forEach(function(Ax){return a(W,Ax)}),wt&&Ns(W,ht),We}function Bt(W,X,le,ye){if(typeof le=="object"&&le!==null&&le.type===B&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case v:e:{for(var We=le.key;X!==null;){if(X.key===We){if(We=le.type,We===B){if(X.tag===7){s(W,X.sibling),ye=o(X,le.props.children),ye.return=W,W=ye;break e}}else if(X.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===P&&Dn(We)===X.type){s(W,X.sibling),ye=o(X,le.props),Gr(ye,le),ye.return=W,W=ye;break e}s(W,X);break}else a(W,X);X=X.sibling}le.type===B?(ye=Sn(le.props.children,W.mode,ye,le.key),ye.return=W,W=ye):(ye=ql(le.type,le.key,le.props,null,W.mode,ye),Gr(ye,le),ye.return=W,W=ye)}return h(W);case H:e:{for(We=le.key;X!==null;){if(X.key===We)if(X.tag===4&&X.stateNode.containerInfo===le.containerInfo&&X.stateNode.implementation===le.implementation){s(W,X.sibling),ye=o(X,le.children||[]),ye.return=W,W=ye;break e}else{s(W,X);break}else a(W,X);X=X.sibling}ye=jc(le,W.mode,ye),ye.return=W,W=ye}return h(W);case P:return le=Dn(le),Bt(W,X,le,ye)}if(J(le))return Pe(W,X,le,ye);if(y(le)){if(We=y(le),typeof We!="function")throw Error(i(150));return le=We.call(le),nt(W,X,le,ye)}if(typeof le.then=="function")return Bt(W,X,Vl(le),ye);if(le.$$typeof===O)return Bt(W,X,Hl(W,le),ye);Gl(W,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,X!==null&&X.tag===6?(s(W,X.sibling),ye=o(X,le),ye.return=W,W=ye):(s(W,X),ye=xc(le,W.mode,ye),ye.return=W,W=ye),h(W)):s(W,X)}return function(W,X,le,ye){try{Vr=0;var We=Bt(W,X,le,ye);return lr=null,We}catch(Xe){if(Xe===rr||Xe===Bl)throw Xe;var zt=Ga(29,Xe,null,W.mode);return zt.lanes=ye,zt.return=W,zt}finally{}}}var Tn=Ru(!0),qu=Ru(!1),Qs=!1;function Mc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Tc(t,a){t=t.updateQueue,a.updateQueue===t&&(a.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Xs(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Is(t,a,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(Rt&2)!==0){var o=n.pending;return o===null?a.next=a:(a.next=o.next,o.next=a),n.pending=a,a=Rl(t),vu(t,null,s),a}return Ol(t,n,a,s),Rl(t)}function Pr(t,a,s){if(a=a.updateQueue,a!==null&&(a=a.shared,(s&4194048)!==0)){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,T(t,s)}}function Ac(t,a){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var o=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var h={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};d===null?o=d=h:d=d.next=h,s=s.next}while(s!==null);d===null?o=d=a:d=d.next=a}else o=d=a;s={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:d,shared:n.shared,callbacks:n.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=a:t.next=a,s.lastBaseUpdate=a}var zc=!1;function Yr(){if(zc){var t=nr;if(t!==null)throw t}}function Qr(t,a,s,n){zc=!1;var o=t.updateQueue;Qs=!1;var d=o.firstBaseUpdate,h=o.lastBaseUpdate,_=o.shared.pending;if(_!==null){o.shared.pending=null;var F=_,ce=F.next;F.next=null,h===null?d=ce:h.next=ce,h=F;var je=t.alternate;je!==null&&(je=je.updateQueue,_=je.lastBaseUpdate,_!==h&&(_===null?je.firstBaseUpdate=ce:_.next=ce,je.lastBaseUpdate=F))}if(d!==null){var _e=o.baseState;h=0,je=ce=F=null,_=d;do{var ue=_.lane&-536870913,pe=ue!==_.lane;if(pe?(_t&ue)===ue:(n&ue)===ue){ue!==0&&ue===sr&&(zc=!0),je!==null&&(je=je.next={lane:0,tag:_.tag,payload:_.payload,callback:null,next:null});e:{var Pe=t,nt=_;ue=a;var Bt=s;switch(nt.tag){case 1:if(Pe=nt.payload,typeof Pe=="function"){_e=Pe.call(Bt,_e,ue);break e}_e=Pe;break e;case 3:Pe.flags=Pe.flags&-65537|128;case 0:if(Pe=nt.payload,ue=typeof Pe=="function"?Pe.call(Bt,_e,ue):Pe,ue==null)break e;_e=R({},_e,ue);break e;case 2:Qs=!0}}ue=_.callback,ue!==null&&(t.flags|=64,pe&&(t.flags|=8192),pe=o.callbacks,pe===null?o.callbacks=[ue]:pe.push(ue))}else pe={lane:ue,tag:_.tag,payload:_.payload,callback:_.callback,next:null},je===null?(ce=je=pe,F=_e):je=je.next=pe,h|=ue;if(_=_.next,_===null){if(_=o.shared.pending,_===null)break;pe=_,_=pe.next,pe.next=null,o.lastBaseUpdate=pe,o.shared.pending=null}}while(!0);je===null&&(F=_e),o.baseState=F,o.firstBaseUpdate=ce,o.lastBaseUpdate=je,d===null&&(o.shared.lanes=0),en|=h,t.lanes=h,t.memoizedState=_e}}function Lu(t,a){if(typeof t!="function")throw Error(i(191,t));t.call(a)}function Uu(t,a){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)Lu(s[t],a)}var ir=U(null),Pl=U(0);function Hu(t,a){t=Os,A(Pl,t),A(ir,a),Os=t|a.baseLanes}function Oc(){A(Pl,Os),A(ir,ir.current)}function Rc(){Os=Pl.current,de(ir),de(Pl)}var Pa=U(null),rs=null;function Zs(t){var a=t.alternate;A(la,la.current&1),A(Pa,t),rs===null&&(a===null||ir.current!==null||a.memoizedState!==null)&&(rs=t)}function qc(t){A(la,la.current),A(Pa,t),rs===null&&(rs=t)}function Fu(t){t.tag===22?(A(la,la.current),A(Pa,t),rs===null&&(rs=t)):Js()}function Js(){A(la,la.current),A(Pa,Pa.current)}function Ya(t){de(Pa),rs===t&&(rs=null),de(la)}var la=U(0);function Yl(t){for(var a=t;a!==null;){if(a.tag===13){var s=a.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||Vo(s)||Go(s)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Cs=0,ut=null,Ht=null,ha=null,Ql=!1,cr=!1,An=!1,Xl=0,Xr=0,or=null,_g=0;function na(){throw Error(i(321))}function Lc(t,a){if(a===null)return!1;for(var s=0;s<a.length&&s<t.length;s++)if(!Va(t[s],a[s]))return!1;return!0}function Uc(t,a,s,n,o,d){return Cs=d,ut=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,w.H=t===null||t.memoizedState===null?Nm:Kc,An=!1,d=s(n,o),An=!1,cr&&(d=$u(a,s,n,o)),Bu(t),d}function Bu(t){w.H=Jr;var a=Ht!==null&&Ht.next!==null;if(Cs=0,ha=Ht=ut=null,Ql=!1,Xr=0,or=null,a)throw Error(i(300));t===null||pa||(t=t.dependencies,t!==null&&Ul(t)&&(pa=!0))}function $u(t,a,s,n){ut=t;var o=0;do{if(cr&&(or=null),Xr=0,cr=!1,25<=o)throw Error(i(301));if(o+=1,ha=Ht=null,t.updateQueue!=null){var d=t.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}w.H=Sm,d=a(s,n)}while(cr);return d}function Ng(){var t=w.H,a=t.useState()[0];return a=typeof a.then=="function"?Ir(a):a,t=t.useState()[0],(Ht!==null?Ht.memoizedState:null)!==t&&(ut.flags|=1024),a}function Hc(){var t=Xl!==0;return Xl=0,t}function Fc(t,a,s){a.updateQueue=t.updateQueue,a.flags&=-2053,t.lanes&=~s}function Bc(t){if(Ql){for(t=t.memoizedState;t!==null;){var a=t.queue;a!==null&&(a.pending=null),t=t.next}Ql=!1}Cs=0,ha=Ht=ut=null,cr=!1,Xr=Xl=0,or=null}function Ma(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ha===null?ut.memoizedState=ha=t:ha=ha.next=t,ha}function ia(){if(Ht===null){var t=ut.alternate;t=t!==null?t.memoizedState:null}else t=Ht.next;var a=ha===null?ut.memoizedState:ha.next;if(a!==null)ha=a,Ht=t;else{if(t===null)throw ut.alternate===null?Error(i(467)):Error(i(310));Ht=t,t={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},ha===null?ut.memoizedState=ha=t:ha=ha.next=t}return ha}function Il(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ir(t){var a=Xr;return Xr+=1,or===null&&(or=[]),t=Au(or,t,a),a=ut,(ha===null?a.memoizedState:ha.next)===null&&(a=a.alternate,w.H=a===null||a.memoizedState===null?Nm:Kc),t}function Zl(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Ir(t);if(t.$$typeof===O)return wa(t)}throw Error(i(438,String(t)))}function $c(t){var a=null,s=ut.updateQueue;if(s!==null&&(a=s.memoCache),a==null){var n=ut.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(a={data:n.data.map(function(o){return o.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),s===null&&(s=Il(),ut.updateQueue=s),s.memoCache=a,s=a.data[a.index],s===void 0)for(s=a.data[a.index]=Array(t),n=0;n<t;n++)s[n]=ie;return a.index++,s}function ks(t,a){return typeof a=="function"?a(t):a}function Jl(t){var a=ia();return Vc(a,Ht,t)}function Vc(t,a,s){var n=t.queue;if(n===null)throw Error(i(311));n.lastRenderedReducer=s;var o=t.baseQueue,d=n.pending;if(d!==null){if(o!==null){var h=o.next;o.next=d.next,d.next=h}a.baseQueue=o=d,n.pending=null}if(d=t.baseState,o===null)t.memoizedState=d;else{a=o.next;var _=h=null,F=null,ce=a,je=!1;do{var _e=ce.lane&-536870913;if(_e!==ce.lane?(_t&_e)===_e:(Cs&_e)===_e){var ue=ce.revertLane;if(ue===0)F!==null&&(F=F.next={lane:0,revertLane:0,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null}),_e===sr&&(je=!0);else if((Cs&ue)===ue){ce=ce.next,ue===sr&&(je=!0);continue}else _e={lane:0,revertLane:ce.revertLane,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},F===null?(_=F=_e,h=d):F=F.next=_e,ut.lanes|=ue,en|=ue;_e=ce.action,An&&s(d,_e),d=ce.hasEagerState?ce.eagerState:s(d,_e)}else ue={lane:_e,revertLane:ce.revertLane,gesture:ce.gesture,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},F===null?(_=F=ue,h=d):F=F.next=ue,ut.lanes|=_e,en|=_e;ce=ce.next}while(ce!==null&&ce!==a);if(F===null?h=d:F.next=_,!Va(d,t.memoizedState)&&(pa=!0,je&&(s=nr,s!==null)))throw s;t.memoizedState=d,t.baseState=h,t.baseQueue=F,n.lastRenderedState=d}return o===null&&(n.lanes=0),[t.memoizedState,n.dispatch]}function Gc(t){var a=ia(),s=a.queue;if(s===null)throw Error(i(311));s.lastRenderedReducer=t;var n=s.dispatch,o=s.pending,d=a.memoizedState;if(o!==null){s.pending=null;var h=o=o.next;do d=t(d,h.action),h=h.next;while(h!==o);Va(d,a.memoizedState)||(pa=!0),a.memoizedState=d,a.baseQueue===null&&(a.baseState=d),s.lastRenderedState=d}return[d,n]}function Vu(t,a,s){var n=ut,o=ia(),d=wt;if(d){if(s===void 0)throw Error(i(407));s=s()}else s=a();var h=!Va((Ht||o).memoizedState,s);if(h&&(o.memoizedState=s,pa=!0),o=o.queue,Qc(Yu.bind(null,n,o,t),[t]),o.getSnapshot!==a||h||ha!==null&&ha.memoizedState.tag&1){if(n.flags|=2048,dr(9,{destroy:void 0},Pu.bind(null,n,o,s,a),null),Vt===null)throw Error(i(349));d||(Cs&127)!==0||Gu(n,a,s)}return s}function Gu(t,a,s){t.flags|=16384,t={getSnapshot:a,value:s},a=ut.updateQueue,a===null?(a=Il(),ut.updateQueue=a,a.stores=[t]):(s=a.stores,s===null?a.stores=[t]:s.push(t))}function Pu(t,a,s,n){a.value=s,a.getSnapshot=n,Qu(a)&&Xu(t)}function Yu(t,a,s){return s(function(){Qu(a)&&Xu(t)})}function Qu(t){var a=t.getSnapshot;t=t.value;try{var s=a();return!Va(t,s)}catch{return!0}}function Xu(t){var a=Nn(t,2);a!==null&&Fa(a,t,2)}function Pc(t){var a=Ma();if(typeof t=="function"){var s=t;if(t=s(),An){qt(!0);try{s()}finally{qt(!1)}}}return a.memoizedState=a.baseState=t,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:t},a}function Iu(t,a,s,n){return t.baseState=s,Vc(t,Ht,typeof n=="function"?n:ks)}function Sg(t,a,s,n,o){if(ei(t))throw Error(i(485));if(t=a.action,t!==null){var d={payload:o,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(h){d.listeners.push(h)}};w.T!==null?s(!0):d.isTransition=!1,n(d),s=a.pending,s===null?(d.next=a.pending=d,Zu(a,d)):(d.next=s.next,a.pending=s.next=d)}}function Zu(t,a){var s=a.action,n=a.payload,o=t.state;if(a.isTransition){var d=w.T,h={};w.T=h;try{var _=s(o,n),F=w.S;F!==null&&F(h,_),Ju(t,a,_)}catch(ce){Yc(t,a,ce)}finally{d!==null&&h.types!==null&&(d.types=h.types),w.T=d}}else try{d=s(o,n),Ju(t,a,d)}catch(ce){Yc(t,a,ce)}}function Ju(t,a,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(n){Wu(t,a,n)},function(n){return Yc(t,a,n)}):Wu(t,a,s)}function Wu(t,a,s){a.status="fulfilled",a.value=s,Ku(a),t.state=s,a=t.pending,a!==null&&(s=a.next,s===a?t.pending=null:(s=s.next,a.next=s,Zu(t,s)))}function Yc(t,a,s){var n=t.pending;if(t.pending=null,n!==null){n=n.next;do a.status="rejected",a.reason=s,Ku(a),a=a.next;while(a!==n)}t.action=null}function Ku(t){t=t.listeners;for(var a=0;a<t.length;a++)(0,t[a])()}function em(t,a){return a}function tm(t,a){if(wt){var s=Vt.formState;if(s!==null){e:{var n=ut;if(wt){if(Zt){t:{for(var o=Zt,d=ns;o.nodeType!==8;){if(!d){o=null;break t}if(o=ls(o.nextSibling),o===null){o=null;break t}}d=o.data,o=d==="F!"||d==="F"?o:null}if(o){Zt=ls(o.nextSibling),n=o.data==="F!";break e}}Ps(n)}n=!1}n&&(a=s[0])}}return s=Ma(),s.memoizedState=s.baseState=a,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:em,lastRenderedState:a},s.queue=n,s=ym.bind(null,ut,n),n.dispatch=s,n=Pc(!1),d=Wc.bind(null,ut,!1,n.queue),n=Ma(),o={state:a,dispatch:null,action:t,pending:null},n.queue=o,s=Sg.bind(null,ut,o,d,s),o.dispatch=s,n.memoizedState=t,[a,s,!1]}function am(t){var a=ia();return sm(a,Ht,t)}function sm(t,a,s){if(a=Vc(t,a,em)[0],t=Jl(ks)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var n=Ir(a)}catch(h){throw h===rr?Bl:h}else n=a;a=ia();var o=a.queue,d=o.dispatch;return s!==a.memoizedState&&(ut.flags|=2048,dr(9,{destroy:void 0},wg.bind(null,o,s),null)),[n,d,t]}function wg(t,a){t.action=a}function nm(t){var a=ia(),s=Ht;if(s!==null)return sm(a,s,t);ia(),a=a.memoizedState,s=ia();var n=s.queue.dispatch;return s.memoizedState=t,[a,n,!1]}function dr(t,a,s,n){return t={tag:t,create:s,deps:n,inst:a,next:null},a=ut.updateQueue,a===null&&(a=Il(),ut.updateQueue=a),s=a.lastEffect,s===null?a.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,a.lastEffect=t),t}function rm(){return ia().memoizedState}function Wl(t,a,s,n){var o=Ma();ut.flags|=t,o.memoizedState=dr(1|a,{destroy:void 0},s,n===void 0?null:n)}function Kl(t,a,s,n){var o=ia();n=n===void 0?null:n;var d=o.memoizedState.inst;Ht!==null&&n!==null&&Lc(n,Ht.memoizedState.deps)?o.memoizedState=dr(a,d,s,n):(ut.flags|=t,o.memoizedState=dr(1|a,d,s,n))}function lm(t,a){Wl(8390656,8,t,a)}function Qc(t,a){Kl(2048,8,t,a)}function Cg(t){ut.flags|=4;var a=ut.updateQueue;if(a===null)a=Il(),ut.updateQueue=a,a.events=[t];else{var s=a.events;s===null?a.events=[t]:s.push(t)}}function im(t){var a=ia().memoizedState;return Cg({ref:a,nextImpl:t}),function(){if((Rt&2)!==0)throw Error(i(440));return a.impl.apply(void 0,arguments)}}function cm(t,a){return Kl(4,2,t,a)}function om(t,a){return Kl(4,4,t,a)}function dm(t,a){if(typeof a=="function"){t=t();var s=a(t);return function(){typeof s=="function"?s():a(null)}}if(a!=null)return t=t(),a.current=t,function(){a.current=null}}function um(t,a,s){s=s!=null?s.concat([t]):null,Kl(4,4,dm.bind(null,a,t),s)}function Xc(){}function mm(t,a){var s=ia();a=a===void 0?null:a;var n=s.memoizedState;return a!==null&&Lc(a,n[1])?n[0]:(s.memoizedState=[t,a],t)}function hm(t,a){var s=ia();a=a===void 0?null:a;var n=s.memoizedState;if(a!==null&&Lc(a,n[1]))return n[0];if(n=t(),An){qt(!0);try{t()}finally{qt(!1)}}return s.memoizedState=[n,a],n}function Ic(t,a,s){return s===void 0||(Cs&1073741824)!==0&&(_t&261930)===0?t.memoizedState=a:(t.memoizedState=s,t=ph(),ut.lanes|=t,en|=t,s)}function pm(t,a,s,n){return Va(s,a)?s:ir.current!==null?(t=Ic(t,s,n),Va(t,a)||(pa=!0),t):(Cs&42)===0||(Cs&1073741824)!==0&&(_t&261930)===0?(pa=!0,t.memoizedState=s):(t=ph(),ut.lanes|=t,en|=t,a)}function fm(t,a,s,n,o){var d=Z.p;Z.p=d!==0&&8>d?d:8;var h=w.T,_={};w.T=_,Wc(t,!1,a,s);try{var F=o(),ce=w.S;if(ce!==null&&ce(_,F),F!==null&&typeof F=="object"&&typeof F.then=="function"){var je=bg(F,n);Zr(t,a,je,Ia(t))}else Zr(t,a,n,Ia(t))}catch(_e){Zr(t,a,{then:function(){},status:"rejected",reason:_e},Ia())}finally{Z.p=d,h!==null&&_.types!==null&&(h.types=_.types),w.T=h}}function kg(){}function Zc(t,a,s,n){if(t.tag!==5)throw Error(i(476));var o=gm(t).queue;fm(t,o,a,M,s===null?kg:function(){return xm(t),s(n)})}function gm(t){var a=t.memoizedState;if(a!==null)return a;a={memoizedState:M,baseState:M,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:M},next:null};var s={};return a.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:s},next:null},t.memoizedState=a,t=t.alternate,t!==null&&(t.memoizedState=a),a}function xm(t){var a=gm(t);a.next===null&&(a=t.alternate.memoizedState),Zr(t,a.next.queue,{},Ia())}function Jc(){return wa(hl)}function jm(){return ia().memoizedState}function vm(){return ia().memoizedState}function Eg(t){for(var a=t.return;a!==null;){switch(a.tag){case 24:case 3:var s=Ia();t=Xs(s);var n=Is(a,t,s);n!==null&&(Fa(n,a,s),Pr(n,a,s)),a={cache:Cc()},t.payload=a;return}a=a.return}}function Dg(t,a,s){var n=Ia();s={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},ei(t)?bm(a,s):(s=fc(t,a,s,n),s!==null&&(Fa(s,t,n),_m(s,a,n)))}function ym(t,a,s){var n=Ia();Zr(t,a,s,n)}function Zr(t,a,s,n){var o={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(ei(t))bm(a,o);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=a.lastRenderedReducer,d!==null))try{var h=a.lastRenderedState,_=d(h,s);if(o.hasEagerState=!0,o.eagerState=_,Va(_,h))return Ol(t,a,o,0),Vt===null&&zl(),!1}catch{}finally{}if(s=fc(t,a,o,n),s!==null)return Fa(s,t,n),_m(s,a,n),!0}return!1}function Wc(t,a,s,n){if(n={lane:2,revertLane:To(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},ei(t)){if(a)throw Error(i(479))}else a=fc(t,s,n,2),a!==null&&Fa(a,t,2)}function ei(t){var a=t.alternate;return t===ut||a!==null&&a===ut}function bm(t,a){cr=Ql=!0;var s=t.pending;s===null?a.next=a:(a.next=s.next,s.next=a),t.pending=a}function _m(t,a,s){if((s&4194048)!==0){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,T(t,s)}}var Jr={readContext:wa,use:Zl,useCallback:na,useContext:na,useEffect:na,useImperativeHandle:na,useLayoutEffect:na,useInsertionEffect:na,useMemo:na,useReducer:na,useRef:na,useState:na,useDebugValue:na,useDeferredValue:na,useTransition:na,useSyncExternalStore:na,useId:na,useHostTransitionStatus:na,useFormState:na,useActionState:na,useOptimistic:na,useMemoCache:na,useCacheRefresh:na};Jr.useEffectEvent=na;var Nm={readContext:wa,use:Zl,useCallback:function(t,a){return Ma().memoizedState=[t,a===void 0?null:a],t},useContext:wa,useEffect:lm,useImperativeHandle:function(t,a,s){s=s!=null?s.concat([t]):null,Wl(4194308,4,dm.bind(null,a,t),s)},useLayoutEffect:function(t,a){return Wl(4194308,4,t,a)},useInsertionEffect:function(t,a){Wl(4,2,t,a)},useMemo:function(t,a){var s=Ma();a=a===void 0?null:a;var n=t();if(An){qt(!0);try{t()}finally{qt(!1)}}return s.memoizedState=[n,a],n},useReducer:function(t,a,s){var n=Ma();if(s!==void 0){var o=s(a);if(An){qt(!0);try{s(a)}finally{qt(!1)}}}else o=a;return n.memoizedState=n.baseState=o,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:o},n.queue=t,t=t.dispatch=Dg.bind(null,ut,t),[n.memoizedState,t]},useRef:function(t){var a=Ma();return t={current:t},a.memoizedState=t},useState:function(t){t=Pc(t);var a=t.queue,s=ym.bind(null,ut,a);return a.dispatch=s,[t.memoizedState,s]},useDebugValue:Xc,useDeferredValue:function(t,a){var s=Ma();return Ic(s,t,a)},useTransition:function(){var t=Pc(!1);return t=fm.bind(null,ut,t.queue,!0,!1),Ma().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,a,s){var n=ut,o=Ma();if(wt){if(s===void 0)throw Error(i(407));s=s()}else{if(s=a(),Vt===null)throw Error(i(349));(_t&127)!==0||Gu(n,a,s)}o.memoizedState=s;var d={value:s,getSnapshot:a};return o.queue=d,lm(Yu.bind(null,n,d,t),[t]),n.flags|=2048,dr(9,{destroy:void 0},Pu.bind(null,n,d,s,a),null),s},useId:function(){var t=Ma(),a=Vt.identifierPrefix;if(wt){var s=gs,n=fs;s=(n&~(1<<32-Ee(n)-1)).toString(32)+s,a="_"+a+"R_"+s,s=Xl++,0<s&&(a+="H"+s.toString(32)),a+="_"}else s=_g++,a="_"+a+"r_"+s.toString(32)+"_";return t.memoizedState=a},useHostTransitionStatus:Jc,useFormState:tm,useActionState:tm,useOptimistic:function(t){var a=Ma();a.memoizedState=a.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=s,a=Wc.bind(null,ut,!0,s),s.dispatch=a,[t,a]},useMemoCache:$c,useCacheRefresh:function(){return Ma().memoizedState=Eg.bind(null,ut)},useEffectEvent:function(t){var a=Ma(),s={impl:t};return a.memoizedState=s,function(){if((Rt&2)!==0)throw Error(i(440));return s.impl.apply(void 0,arguments)}}},Kc={readContext:wa,use:Zl,useCallback:mm,useContext:wa,useEffect:Qc,useImperativeHandle:um,useInsertionEffect:cm,useLayoutEffect:om,useMemo:hm,useReducer:Jl,useRef:rm,useState:function(){return Jl(ks)},useDebugValue:Xc,useDeferredValue:function(t,a){var s=ia();return pm(s,Ht.memoizedState,t,a)},useTransition:function(){var t=Jl(ks)[0],a=ia().memoizedState;return[typeof t=="boolean"?t:Ir(t),a]},useSyncExternalStore:Vu,useId:jm,useHostTransitionStatus:Jc,useFormState:am,useActionState:am,useOptimistic:function(t,a){var s=ia();return Iu(s,Ht,t,a)},useMemoCache:$c,useCacheRefresh:vm};Kc.useEffectEvent=im;var Sm={readContext:wa,use:Zl,useCallback:mm,useContext:wa,useEffect:Qc,useImperativeHandle:um,useInsertionEffect:cm,useLayoutEffect:om,useMemo:hm,useReducer:Gc,useRef:rm,useState:function(){return Gc(ks)},useDebugValue:Xc,useDeferredValue:function(t,a){var s=ia();return Ht===null?Ic(s,t,a):pm(s,Ht.memoizedState,t,a)},useTransition:function(){var t=Gc(ks)[0],a=ia().memoizedState;return[typeof t=="boolean"?t:Ir(t),a]},useSyncExternalStore:Vu,useId:jm,useHostTransitionStatus:Jc,useFormState:nm,useActionState:nm,useOptimistic:function(t,a){var s=ia();return Ht!==null?Iu(s,Ht,t,a):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:$c,useCacheRefresh:vm};Sm.useEffectEvent=im;function eo(t,a,s,n){a=t.memoizedState,s=s(n,a),s=s==null?a:R({},a,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var to={enqueueSetState:function(t,a,s){t=t._reactInternals;var n=Ia(),o=Xs(n);o.payload=a,s!=null&&(o.callback=s),a=Is(t,o,n),a!==null&&(Fa(a,t,n),Pr(a,t,n))},enqueueReplaceState:function(t,a,s){t=t._reactInternals;var n=Ia(),o=Xs(n);o.tag=1,o.payload=a,s!=null&&(o.callback=s),a=Is(t,o,n),a!==null&&(Fa(a,t,n),Pr(a,t,n))},enqueueForceUpdate:function(t,a){t=t._reactInternals;var s=Ia(),n=Xs(s);n.tag=2,a!=null&&(n.callback=a),a=Is(t,n,s),a!==null&&(Fa(a,t,s),Pr(a,t,s))}};function wm(t,a,s,n,o,d,h){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,d,h):a.prototype&&a.prototype.isPureReactComponent?!Lr(s,n)||!Lr(o,d):!0}function Cm(t,a,s,n){t=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(s,n),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(s,n),a.state!==t&&to.enqueueReplaceState(a,a.state,null)}function zn(t,a){var s=a;if("ref"in a){s={};for(var n in a)n!=="ref"&&(s[n]=a[n])}if(t=t.defaultProps){s===a&&(s=R({},s));for(var o in t)s[o]===void 0&&(s[o]=t[o])}return s}function km(t){Al(t)}function Em(t){console.error(t)}function Dm(t){Al(t)}function ti(t,a){try{var s=t.onUncaughtError;s(a.value,{componentStack:a.stack})}catch(n){setTimeout(function(){throw n})}}function Mm(t,a,s){try{var n=t.onCaughtError;n(s.value,{componentStack:s.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(o){setTimeout(function(){throw o})}}function ao(t,a,s){return s=Xs(s),s.tag=3,s.payload={element:null},s.callback=function(){ti(t,a)},s}function Tm(t){return t=Xs(t),t.tag=3,t}function Am(t,a,s,n){var o=s.type.getDerivedStateFromError;if(typeof o=="function"){var d=n.value;t.payload=function(){return o(d)},t.callback=function(){Mm(a,s,n)}}var h=s.stateNode;h!==null&&typeof h.componentDidCatch=="function"&&(t.callback=function(){Mm(a,s,n),typeof o!="function"&&(tn===null?tn=new Set([this]):tn.add(this));var _=n.stack;this.componentDidCatch(n.value,{componentStack:_!==null?_:""})})}function Mg(t,a,s,n,o){if(s.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(a=s.alternate,a!==null&&ar(a,s,o,!0),s=Pa.current,s!==null){switch(s.tag){case 31:case 13:return rs===null?hi():s.alternate===null&&ra===0&&(ra=3),s.flags&=-257,s.flags|=65536,s.lanes=o,n===$l?s.flags|=16384:(a=s.updateQueue,a===null?s.updateQueue=new Set([n]):a.add(n),Eo(t,n,o)),!1;case 22:return s.flags|=65536,n===$l?s.flags|=16384:(a=s.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([n])},s.updateQueue=a):(s=a.retryQueue,s===null?a.retryQueue=new Set([n]):s.add(n)),Eo(t,n,o)),!1}throw Error(i(435,s.tag))}return Eo(t,n,o),hi(),!1}if(wt)return a=Pa.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=o,n!==bc&&(t=Error(i(422),{cause:n}),Fr(ts(t,s)))):(n!==bc&&(a=Error(i(423),{cause:n}),Fr(ts(a,s))),t=t.current.alternate,t.flags|=65536,o&=-o,t.lanes|=o,n=ts(n,s),o=ao(t.stateNode,n,o),Ac(t,o),ra!==4&&(ra=2)),!1;var d=Error(i(520),{cause:n});if(d=ts(d,s),rl===null?rl=[d]:rl.push(d),ra!==4&&(ra=2),a===null)return!0;n=ts(n,s),s=a;do{switch(s.tag){case 3:return s.flags|=65536,t=o&-o,s.lanes|=t,t=ao(s.stateNode,n,t),Ac(s,t),!1;case 1:if(a=s.type,d=s.stateNode,(s.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(tn===null||!tn.has(d))))return s.flags|=65536,o&=-o,s.lanes|=o,o=Tm(o),Am(o,t,s,n),Ac(s,o),!1}s=s.return}while(s!==null);return!1}var so=Error(i(461)),pa=!1;function Ca(t,a,s,n){a.child=t===null?qu(a,null,s,n):Tn(a,t.child,s,n)}function zm(t,a,s,n,o){s=s.render;var d=a.ref;if("ref"in n){var h={};for(var _ in n)_!=="ref"&&(h[_]=n[_])}else h=n;return kn(a),n=Uc(t,a,s,h,d,o),_=Hc(),t!==null&&!pa?(Fc(t,a,o),Es(t,a,o)):(wt&&_&&vc(a),a.flags|=1,Ca(t,a,n,o),a.child)}function Om(t,a,s,n,o){if(t===null){var d=s.type;return typeof d=="function"&&!gc(d)&&d.defaultProps===void 0&&s.compare===null?(a.tag=15,a.type=d,Rm(t,a,d,n,o)):(t=ql(s.type,null,n,a,a.mode,o),t.ref=a.ref,t.return=a,a.child=t)}if(d=t.child,!mo(t,o)){var h=d.memoizedProps;if(s=s.compare,s=s!==null?s:Lr,s(h,n)&&t.ref===a.ref)return Es(t,a,o)}return a.flags|=1,t=_s(d,n),t.ref=a.ref,t.return=a,a.child=t}function Rm(t,a,s,n,o){if(t!==null){var d=t.memoizedProps;if(Lr(d,n)&&t.ref===a.ref)if(pa=!1,a.pendingProps=n=d,mo(t,o))(t.flags&131072)!==0&&(pa=!0);else return a.lanes=t.lanes,Es(t,a,o)}return no(t,a,s,n,o)}function qm(t,a,s,n){var o=n.children,d=t!==null?t.memoizedState:null;if(t===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((a.flags&128)!==0){if(d=d!==null?d.baseLanes|s:s,t!==null){for(n=a.child=t.child,o=0;n!==null;)o=o|n.lanes|n.childLanes,n=n.sibling;n=o&~d}else n=0,a.child=null;return Lm(t,a,d,s,n)}if((s&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},t!==null&&Fl(a,d!==null?d.cachePool:null),d!==null?Hu(a,d):Oc(),Fu(a);else return n=a.lanes=536870912,Lm(t,a,d!==null?d.baseLanes|s:s,s,n)}else d!==null?(Fl(a,d.cachePool),Hu(a,d),Js(),a.memoizedState=null):(t!==null&&Fl(a,null),Oc(),Js());return Ca(t,a,o,s),a.child}function Wr(t,a){return t!==null&&t.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Lm(t,a,s,n,o){var d=Ec();return d=d===null?null:{parent:ma._currentValue,pool:d},a.memoizedState={baseLanes:s,cachePool:d},t!==null&&Fl(a,null),Oc(),Fu(a),t!==null&&ar(t,a,n,!0),a.childLanes=o,null}function ai(t,a){return a=ni({mode:a.mode,children:a.children},t.mode),a.ref=t.ref,t.child=a,a.return=t,a}function Um(t,a,s){return Tn(a,t.child,null,s),t=ai(a,a.pendingProps),t.flags|=2,Ya(a),a.memoizedState=null,t}function Tg(t,a,s){var n=a.pendingProps,o=(a.flags&128)!==0;if(a.flags&=-129,t===null){if(wt){if(n.mode==="hidden")return t=ai(a,n),a.lanes=536870912,Wr(null,t);if(qc(a),(t=Zt)?(t=Zh(t,ns),t=t!==null&&t.data==="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:Vs!==null?{id:fs,overflow:gs}:null,retryLane:536870912,hydrationErrors:null},s=bu(t),s.return=a,a.child=s,Sa=a,Zt=null)):t=null,t===null)throw Ps(a);return a.lanes=536870912,null}return ai(a,n)}var d=t.memoizedState;if(d!==null){var h=d.dehydrated;if(qc(a),o)if(a.flags&256)a.flags&=-257,a=Um(t,a,s);else if(a.memoizedState!==null)a.child=t.child,a.flags|=128,a=null;else throw Error(i(558));else if(pa||ar(t,a,s,!1),o=(s&t.childLanes)!==0,pa||o){if(n=Vt,n!==null&&(h=ge(n,s),h!==0&&h!==d.retryLane))throw d.retryLane=h,Nn(t,h),Fa(n,t,h),so;hi(),a=Um(t,a,s)}else t=d.treeContext,Zt=ls(h.nextSibling),Sa=a,wt=!0,Gs=null,ns=!1,t!==null&&Su(a,t),a=ai(a,n),a.flags|=4096;return a}return t=_s(t.child,{mode:n.mode,children:n.children}),t.ref=a.ref,a.child=t,t.return=a,t}function si(t,a){var s=a.ref;if(s===null)t!==null&&t.ref!==null&&(a.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(i(284));(t===null||t.ref!==s)&&(a.flags|=4194816)}}function no(t,a,s,n,o){return kn(a),s=Uc(t,a,s,n,void 0,o),n=Hc(),t!==null&&!pa?(Fc(t,a,o),Es(t,a,o)):(wt&&n&&vc(a),a.flags|=1,Ca(t,a,s,o),a.child)}function Hm(t,a,s,n,o,d){return kn(a),a.updateQueue=null,s=$u(a,n,s,o),Bu(t),n=Hc(),t!==null&&!pa?(Fc(t,a,d),Es(t,a,d)):(wt&&n&&vc(a),a.flags|=1,Ca(t,a,s,d),a.child)}function Fm(t,a,s,n,o){if(kn(a),a.stateNode===null){var d=Wn,h=s.contextType;typeof h=="object"&&h!==null&&(d=wa(h)),d=new s(n,d),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=to,a.stateNode=d,d._reactInternals=a,d=a.stateNode,d.props=n,d.state=a.memoizedState,d.refs={},Mc(a),h=s.contextType,d.context=typeof h=="object"&&h!==null?wa(h):Wn,d.state=a.memoizedState,h=s.getDerivedStateFromProps,typeof h=="function"&&(eo(a,s,h,n),d.state=a.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(h=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),h!==d.state&&to.enqueueReplaceState(d,d.state,null),Qr(a,n,d,o),Yr(),d.state=a.memoizedState),typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!0}else if(t===null){d=a.stateNode;var _=a.memoizedProps,F=zn(s,_);d.props=F;var ce=d.context,je=s.contextType;h=Wn,typeof je=="object"&&je!==null&&(h=wa(je));var _e=s.getDerivedStateFromProps;je=typeof _e=="function"||typeof d.getSnapshotBeforeUpdate=="function",_=a.pendingProps!==_,je||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(_||ce!==h)&&Cm(a,d,n,h),Qs=!1;var ue=a.memoizedState;d.state=ue,Qr(a,n,d,o),Yr(),ce=a.memoizedState,_||ue!==ce||Qs?(typeof _e=="function"&&(eo(a,s,_e,n),ce=a.memoizedState),(F=Qs||wm(a,s,F,n,ue,ce,h))?(je||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(a.flags|=4194308)):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=n,a.memoizedState=ce),d.props=n,d.state=ce,d.context=h,n=F):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!1)}else{d=a.stateNode,Tc(t,a),h=a.memoizedProps,je=zn(s,h),d.props=je,_e=a.pendingProps,ue=d.context,ce=s.contextType,F=Wn,typeof ce=="object"&&ce!==null&&(F=wa(ce)),_=s.getDerivedStateFromProps,(ce=typeof _=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==_e||ue!==F)&&Cm(a,d,n,F),Qs=!1,ue=a.memoizedState,d.state=ue,Qr(a,n,d,o),Yr();var pe=a.memoizedState;h!==_e||ue!==pe||Qs||t!==null&&t.dependencies!==null&&Ul(t.dependencies)?(typeof _=="function"&&(eo(a,s,_,n),pe=a.memoizedState),(je=Qs||wm(a,s,je,n,ue,pe,F)||t!==null&&t.dependencies!==null&&Ul(t.dependencies))?(ce||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,pe,F),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,pe,F)),typeof d.componentDidUpdate=="function"&&(a.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&ue===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&ue===t.memoizedState||(a.flags|=1024),a.memoizedProps=n,a.memoizedState=pe),d.props=n,d.state=pe,d.context=F,n=je):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&ue===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&ue===t.memoizedState||(a.flags|=1024),n=!1)}return d=n,si(t,a),n=(a.flags&128)!==0,d||n?(d=a.stateNode,s=n&&typeof s.getDerivedStateFromError!="function"?null:d.render(),a.flags|=1,t!==null&&n?(a.child=Tn(a,t.child,null,o),a.child=Tn(a,null,s,o)):Ca(t,a,s,o),a.memoizedState=d.state,t=a.child):t=Es(t,a,o),t}function Bm(t,a,s,n){return wn(),a.flags|=256,Ca(t,a,s,n),a.child}var ro={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function lo(t){return{baseLanes:t,cachePool:Mu()}}function io(t,a,s){return t=t!==null?t.childLanes&~s:0,a&&(t|=Xa),t}function $m(t,a,s){var n=a.pendingProps,o=!1,d=(a.flags&128)!==0,h;if((h=d)||(h=t!==null&&t.memoizedState===null?!1:(la.current&2)!==0),h&&(o=!0,a.flags&=-129),h=(a.flags&32)!==0,a.flags&=-33,t===null){if(wt){if(o?Zs(a):Js(),(t=Zt)?(t=Zh(t,ns),t=t!==null&&t.data!=="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:Vs!==null?{id:fs,overflow:gs}:null,retryLane:536870912,hydrationErrors:null},s=bu(t),s.return=a,a.child=s,Sa=a,Zt=null)):t=null,t===null)throw Ps(a);return Go(t)?a.lanes=32:a.lanes=536870912,null}var _=n.children;return n=n.fallback,o?(Js(),o=a.mode,_=ni({mode:"hidden",children:_},o),n=Sn(n,o,s,null),_.return=a,n.return=a,_.sibling=n,a.child=_,n=a.child,n.memoizedState=lo(s),n.childLanes=io(t,h,s),a.memoizedState=ro,Wr(null,n)):(Zs(a),co(a,_))}var F=t.memoizedState;if(F!==null&&(_=F.dehydrated,_!==null)){if(d)a.flags&256?(Zs(a),a.flags&=-257,a=oo(t,a,s)):a.memoizedState!==null?(Js(),a.child=t.child,a.flags|=128,a=null):(Js(),_=n.fallback,o=a.mode,n=ni({mode:"visible",children:n.children},o),_=Sn(_,o,s,null),_.flags|=2,n.return=a,_.return=a,n.sibling=_,a.child=n,Tn(a,t.child,null,s),n=a.child,n.memoizedState=lo(s),n.childLanes=io(t,h,s),a.memoizedState=ro,a=Wr(null,n));else if(Zs(a),Go(_)){if(h=_.nextSibling&&_.nextSibling.dataset,h)var ce=h.dgst;h=ce,n=Error(i(419)),n.stack="",n.digest=h,Fr({value:n,source:null,stack:null}),a=oo(t,a,s)}else if(pa||ar(t,a,s,!1),h=(s&t.childLanes)!==0,pa||h){if(h=Vt,h!==null&&(n=ge(h,s),n!==0&&n!==F.retryLane))throw F.retryLane=n,Nn(t,n),Fa(h,t,n),so;Vo(_)||hi(),a=oo(t,a,s)}else Vo(_)?(a.flags|=192,a.child=t.child,a=null):(t=F.treeContext,Zt=ls(_.nextSibling),Sa=a,wt=!0,Gs=null,ns=!1,t!==null&&Su(a,t),a=co(a,n.children),a.flags|=4096);return a}return o?(Js(),_=n.fallback,o=a.mode,F=t.child,ce=F.sibling,n=_s(F,{mode:"hidden",children:n.children}),n.subtreeFlags=F.subtreeFlags&65011712,ce!==null?_=_s(ce,_):(_=Sn(_,o,s,null),_.flags|=2),_.return=a,n.return=a,n.sibling=_,a.child=n,Wr(null,n),n=a.child,_=t.child.memoizedState,_===null?_=lo(s):(o=_.cachePool,o!==null?(F=ma._currentValue,o=o.parent!==F?{parent:F,pool:F}:o):o=Mu(),_={baseLanes:_.baseLanes|s,cachePool:o}),n.memoizedState=_,n.childLanes=io(t,h,s),a.memoizedState=ro,Wr(t.child,n)):(Zs(a),s=t.child,t=s.sibling,s=_s(s,{mode:"visible",children:n.children}),s.return=a,s.sibling=null,t!==null&&(h=a.deletions,h===null?(a.deletions=[t],a.flags|=16):h.push(t)),a.child=s,a.memoizedState=null,s)}function co(t,a){return a=ni({mode:"visible",children:a},t.mode),a.return=t,t.child=a}function ni(t,a){return t=Ga(22,t,null,a),t.lanes=0,t}function oo(t,a,s){return Tn(a,t.child,null,s),t=co(a,a.pendingProps.children),t.flags|=2,a.memoizedState=null,t}function Vm(t,a,s){t.lanes|=a;var n=t.alternate;n!==null&&(n.lanes|=a),Sc(t.return,a,s)}function uo(t,a,s,n,o,d){var h=t.memoizedState;h===null?t.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:o,treeForkCount:d}:(h.isBackwards=a,h.rendering=null,h.renderingStartTime=0,h.last=n,h.tail=s,h.tailMode=o,h.treeForkCount=d)}function Gm(t,a,s){var n=a.pendingProps,o=n.revealOrder,d=n.tail;n=n.children;var h=la.current,_=(h&2)!==0;if(_?(h=h&1|2,a.flags|=128):h&=1,A(la,h),Ca(t,a,n,s),n=wt?Hr:0,!_&&t!==null&&(t.flags&128)!==0)e:for(t=a.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Vm(t,s,a);else if(t.tag===19)Vm(t,s,a);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===a)break e;for(;t.sibling===null;){if(t.return===null||t.return===a)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(o){case"forwards":for(s=a.child,o=null;s!==null;)t=s.alternate,t!==null&&Yl(t)===null&&(o=s),s=s.sibling;s=o,s===null?(o=a.child,a.child=null):(o=s.sibling,s.sibling=null),uo(a,!1,o,s,d,n);break;case"backwards":case"unstable_legacy-backwards":for(s=null,o=a.child,a.child=null;o!==null;){if(t=o.alternate,t!==null&&Yl(t)===null){a.child=o;break}t=o.sibling,o.sibling=s,s=o,o=t}uo(a,!0,s,null,d,n);break;case"together":uo(a,!1,null,null,void 0,n);break;default:a.memoizedState=null}return a.child}function Es(t,a,s){if(t!==null&&(a.dependencies=t.dependencies),en|=a.lanes,(s&a.childLanes)===0)if(t!==null){if(ar(t,a,s,!1),(s&a.childLanes)===0)return null}else return null;if(t!==null&&a.child!==t.child)throw Error(i(153));if(a.child!==null){for(t=a.child,s=_s(t,t.pendingProps),a.child=s,s.return=a;t.sibling!==null;)t=t.sibling,s=s.sibling=_s(t,t.pendingProps),s.return=a;s.sibling=null}return a.child}function mo(t,a){return(t.lanes&a)!==0?!0:(t=t.dependencies,!!(t!==null&&Ul(t)))}function Ag(t,a,s){switch(a.tag){case 3:Oe(a,a.stateNode.containerInfo),Ys(a,ma,t.memoizedState.cache),wn();break;case 27:case 5:Re(a);break;case 4:Oe(a,a.stateNode.containerInfo);break;case 10:Ys(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,qc(a),null;break;case 13:var n=a.memoizedState;if(n!==null)return n.dehydrated!==null?(Zs(a),a.flags|=128,null):(s&a.child.childLanes)!==0?$m(t,a,s):(Zs(a),t=Es(t,a,s),t!==null?t.sibling:null);Zs(a);break;case 19:var o=(t.flags&128)!==0;if(n=(s&a.childLanes)!==0,n||(ar(t,a,s,!1),n=(s&a.childLanes)!==0),o){if(n)return Gm(t,a,s);a.flags|=128}if(o=a.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),A(la,la.current),n)break;return null;case 22:return a.lanes=0,qm(t,a,s,a.pendingProps);case 24:Ys(a,ma,t.memoizedState.cache)}return Es(t,a,s)}function Pm(t,a,s){if(t!==null)if(t.memoizedProps!==a.pendingProps)pa=!0;else{if(!mo(t,s)&&(a.flags&128)===0)return pa=!1,Ag(t,a,s);pa=(t.flags&131072)!==0}else pa=!1,wt&&(a.flags&1048576)!==0&&Nu(a,Hr,a.index);switch(a.lanes=0,a.tag){case 16:e:{var n=a.pendingProps;if(t=Dn(a.elementType),a.type=t,typeof t=="function")gc(t)?(n=zn(t,n),a.tag=1,a=Fm(null,a,t,n,s)):(a.tag=0,a=no(null,a,t,n,s));else{if(t!=null){var o=t.$$typeof;if(o===C){a.tag=11,a=zm(null,a,t,n,s);break e}else if(o===te){a.tag=14,a=Om(null,a,t,n,s);break e}}throw a=L(t)||t,Error(i(306,a,""))}}return a;case 0:return no(t,a,a.type,a.pendingProps,s);case 1:return n=a.type,o=zn(n,a.pendingProps),Fm(t,a,n,o,s);case 3:e:{if(Oe(a,a.stateNode.containerInfo),t===null)throw Error(i(387));n=a.pendingProps;var d=a.memoizedState;o=d.element,Tc(t,a),Qr(a,n,null,s);var h=a.memoizedState;if(n=h.cache,Ys(a,ma,n),n!==d.cache&&wc(a,[ma],s,!0),Yr(),n=h.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:h.cache},a.updateQueue.baseState=d,a.memoizedState=d,a.flags&256){a=Bm(t,a,n,s);break e}else if(n!==o){o=ts(Error(i(424)),a),Fr(o),a=Bm(t,a,n,s);break e}else{switch(t=a.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Zt=ls(t.firstChild),Sa=a,wt=!0,Gs=null,ns=!0,s=qu(a,null,n,s),a.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(wn(),n===o){a=Es(t,a,s);break e}Ca(t,a,n,s)}a=a.child}return a;case 26:return si(t,a),t===null?(s=ap(a.type,null,a.pendingProps,null))?a.memoizedState=s:wt||(s=a.type,t=a.pendingProps,n=yi(Se.current).createElement(s),n[ct]=a,n[mt]=t,ka(n,s,t),Tt(n),a.stateNode=n):a.memoizedState=ap(a.type,t.memoizedProps,a.pendingProps,t.memoizedState),null;case 27:return Re(a),t===null&&wt&&(n=a.stateNode=Kh(a.type,a.pendingProps,Se.current),Sa=a,ns=!0,o=Zt,rn(a.type)?(Po=o,Zt=ls(n.firstChild)):Zt=o),Ca(t,a,a.pendingProps.children,s),si(t,a),t===null&&(a.flags|=4194304),a.child;case 5:return t===null&&wt&&((o=n=Zt)&&(n=cx(n,a.type,a.pendingProps,ns),n!==null?(a.stateNode=n,Sa=a,Zt=ls(n.firstChild),ns=!1,o=!0):o=!1),o||Ps(a)),Re(a),o=a.type,d=a.pendingProps,h=t!==null?t.memoizedProps:null,n=d.children,Fo(o,d)?n=null:h!==null&&Fo(o,h)&&(a.flags|=32),a.memoizedState!==null&&(o=Uc(t,a,Ng,null,null,s),hl._currentValue=o),si(t,a),Ca(t,a,n,s),a.child;case 6:return t===null&&wt&&((t=s=Zt)&&(s=ox(s,a.pendingProps,ns),s!==null?(a.stateNode=s,Sa=a,Zt=null,t=!0):t=!1),t||Ps(a)),null;case 13:return $m(t,a,s);case 4:return Oe(a,a.stateNode.containerInfo),n=a.pendingProps,t===null?a.child=Tn(a,null,n,s):Ca(t,a,n,s),a.child;case 11:return zm(t,a,a.type,a.pendingProps,s);case 7:return Ca(t,a,a.pendingProps,s),a.child;case 8:return Ca(t,a,a.pendingProps.children,s),a.child;case 12:return Ca(t,a,a.pendingProps.children,s),a.child;case 10:return n=a.pendingProps,Ys(a,a.type,n.value),Ca(t,a,n.children,s),a.child;case 9:return o=a.type._context,n=a.pendingProps.children,kn(a),o=wa(o),n=n(o),a.flags|=1,Ca(t,a,n,s),a.child;case 14:return Om(t,a,a.type,a.pendingProps,s);case 15:return Rm(t,a,a.type,a.pendingProps,s);case 19:return Gm(t,a,s);case 31:return Tg(t,a,s);case 22:return qm(t,a,s,a.pendingProps);case 24:return kn(a),n=wa(ma),t===null?(o=Ec(),o===null&&(o=Vt,d=Cc(),o.pooledCache=d,d.refCount++,d!==null&&(o.pooledCacheLanes|=s),o=d),a.memoizedState={parent:n,cache:o},Mc(a),Ys(a,ma,o)):((t.lanes&s)!==0&&(Tc(t,a),Qr(a,null,null,s),Yr()),o=t.memoizedState,d=a.memoizedState,o.parent!==n?(o={parent:n,cache:n},a.memoizedState=o,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=o),Ys(a,ma,n)):(n=d.cache,Ys(a,ma,n),n!==o.cache&&wc(a,[ma],s,!0))),Ca(t,a,a.pendingProps.children,s),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function Ds(t){t.flags|=4}function ho(t,a,s,n,o){if((a=(t.mode&32)!==0)&&(a=!1),a){if(t.flags|=16777216,(o&335544128)===o)if(t.stateNode.complete)t.flags|=8192;else if(jh())t.flags|=8192;else throw Mn=$l,Dc}else t.flags&=-16777217}function Ym(t,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!ip(a))if(jh())t.flags|=8192;else throw Mn=$l,Dc}function ri(t,a){a!==null&&(t.flags|=4),t.flags&16384&&(a=t.tag!==22?Ne():536870912,t.lanes|=a,pr|=a)}function Kr(t,a){if(!wt)switch(t.tailMode){case"hidden":a=t.tail;for(var s=null;a!==null;)a.alternate!==null&&(s=a),a=a.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?a||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Jt(t){var a=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(a)for(var o=t.child;o!==null;)s|=o.lanes|o.childLanes,n|=o.subtreeFlags&65011712,n|=o.flags&65011712,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)s|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=n,t.childLanes=s,a}function zg(t,a,s){var n=a.pendingProps;switch(yc(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(a),null;case 1:return Jt(a),null;case 3:return s=a.stateNode,n=null,t!==null&&(n=t.memoizedState.cache),a.memoizedState.cache!==n&&(a.flags|=2048),ws(ma),Be(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(tr(a)?Ds(a):t===null||t.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,_c())),Jt(a),null;case 26:var o=a.type,d=a.memoizedState;return t===null?(Ds(a),d!==null?(Jt(a),Ym(a,d)):(Jt(a),ho(a,o,null,n,s))):d?d!==t.memoizedState?(Ds(a),Jt(a),Ym(a,d)):(Jt(a),a.flags&=-16777217):(t=t.memoizedProps,t!==n&&Ds(a),Jt(a),ho(a,o,t,n,s)),null;case 27:if(ze(a),s=Se.current,o=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&Ds(a);else{if(!n){if(a.stateNode===null)throw Error(i(166));return Jt(a),null}t=xe.current,tr(a)?wu(a):(t=Kh(o,n,s),a.stateNode=t,Ds(a))}return Jt(a),null;case 5:if(ze(a),o=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&Ds(a);else{if(!n){if(a.stateNode===null)throw Error(i(166));return Jt(a),null}if(d=xe.current,tr(a))wu(a);else{var h=yi(Se.current);switch(d){case 1:d=h.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:d=h.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":d=h.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":d=h.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":d=h.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof n.is=="string"?h.createElement("select",{is:n.is}):h.createElement("select"),n.multiple?d.multiple=!0:n.size&&(d.size=n.size);break;default:d=typeof n.is=="string"?h.createElement(o,{is:n.is}):h.createElement(o)}}d[ct]=a,d[mt]=n;e:for(h=a.child;h!==null;){if(h.tag===5||h.tag===6)d.appendChild(h.stateNode);else if(h.tag!==4&&h.tag!==27&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break e;for(;h.sibling===null;){if(h.return===null||h.return===a)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}a.stateNode=d;e:switch(ka(d,o,n),o){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&Ds(a)}}return Jt(a),ho(a,a.type,t===null?null:t.memoizedProps,a.pendingProps,s),null;case 6:if(t&&a.stateNode!=null)t.memoizedProps!==n&&Ds(a);else{if(typeof n!="string"&&a.stateNode===null)throw Error(i(166));if(t=Se.current,tr(a)){if(t=a.stateNode,s=a.memoizedProps,n=null,o=Sa,o!==null)switch(o.tag){case 27:case 5:n=o.memoizedProps}t[ct]=a,t=!!(t.nodeValue===s||n!==null&&n.suppressHydrationWarning===!0||$h(t.nodeValue,s)),t||Ps(a,!0)}else t=yi(t).createTextNode(n),t[ct]=a,a.stateNode=t}return Jt(a),null;case 31:if(s=a.memoizedState,t===null||t.memoizedState!==null){if(n=tr(a),s!==null){if(t===null){if(!n)throw Error(i(318));if(t=a.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(557));t[ct]=a}else wn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Jt(a),t=!1}else s=_c(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),t=!0;if(!t)return a.flags&256?(Ya(a),a):(Ya(a),null);if((a.flags&128)!==0)throw Error(i(558))}return Jt(a),null;case 13:if(n=a.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(o=tr(a),n!==null&&n.dehydrated!==null){if(t===null){if(!o)throw Error(i(318));if(o=a.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(i(317));o[ct]=a}else wn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Jt(a),o=!1}else o=_c(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=o),o=!0;if(!o)return a.flags&256?(Ya(a),a):(Ya(a),null)}return Ya(a),(a.flags&128)!==0?(a.lanes=s,a):(s=n!==null,t=t!==null&&t.memoizedState!==null,s&&(n=a.child,o=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(o=n.alternate.memoizedState.cachePool.pool),d=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(d=n.memoizedState.cachePool.pool),d!==o&&(n.flags|=2048)),s!==t&&s&&(a.child.flags|=8192),ri(a,a.updateQueue),Jt(a),null);case 4:return Be(),t===null&&Ro(a.stateNode.containerInfo),Jt(a),null;case 10:return ws(a.type),Jt(a),null;case 19:if(de(la),n=a.memoizedState,n===null)return Jt(a),null;if(o=(a.flags&128)!==0,d=n.rendering,d===null)if(o)Kr(n,!1);else{if(ra!==0||t!==null&&(t.flags&128)!==0)for(t=a.child;t!==null;){if(d=Yl(t),d!==null){for(a.flags|=128,Kr(n,!1),t=d.updateQueue,a.updateQueue=t,ri(a,t),a.subtreeFlags=0,t=s,s=a.child;s!==null;)yu(s,t),s=s.sibling;return A(la,la.current&1|2),wt&&Ns(a,n.treeForkCount),a.child}t=t.sibling}n.tail!==null&&et()>di&&(a.flags|=128,o=!0,Kr(n,!1),a.lanes=4194304)}else{if(!o)if(t=Yl(d),t!==null){if(a.flags|=128,o=!0,t=t.updateQueue,a.updateQueue=t,ri(a,t),Kr(n,!0),n.tail===null&&n.tailMode==="hidden"&&!d.alternate&&!wt)return Jt(a),null}else 2*et()-n.renderingStartTime>di&&s!==536870912&&(a.flags|=128,o=!0,Kr(n,!1),a.lanes=4194304);n.isBackwards?(d.sibling=a.child,a.child=d):(t=n.last,t!==null?t.sibling=d:a.child=d,n.last=d)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=et(),t.sibling=null,s=la.current,A(la,o?s&1|2:s&1),wt&&Ns(a,n.treeForkCount),t):(Jt(a),null);case 22:case 23:return Ya(a),Rc(),n=a.memoizedState!==null,t!==null?t.memoizedState!==null!==n&&(a.flags|=8192):n&&(a.flags|=8192),n?(s&536870912)!==0&&(a.flags&128)===0&&(Jt(a),a.subtreeFlags&6&&(a.flags|=8192)):Jt(a),s=a.updateQueue,s!==null&&ri(a,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),n=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(n=a.memoizedState.cachePool.pool),n!==s&&(a.flags|=2048),t!==null&&de(En),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),a.memoizedState.cache!==s&&(a.flags|=2048),ws(ma),Jt(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function Og(t,a){switch(yc(a),a.tag){case 1:return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 3:return ws(ma),Be(),t=a.flags,(t&65536)!==0&&(t&128)===0?(a.flags=t&-65537|128,a):null;case 26:case 27:case 5:return ze(a),null;case 31:if(a.memoizedState!==null){if(Ya(a),a.alternate===null)throw Error(i(340));wn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 13:if(Ya(a),t=a.memoizedState,t!==null&&t.dehydrated!==null){if(a.alternate===null)throw Error(i(340));wn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 19:return de(la),null;case 4:return Be(),null;case 10:return ws(a.type),null;case 22:case 23:return Ya(a),Rc(),t!==null&&de(En),t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 24:return ws(ma),null;case 25:return null;default:return null}}function Qm(t,a){switch(yc(a),a.tag){case 3:ws(ma),Be();break;case 26:case 27:case 5:ze(a);break;case 4:Be();break;case 31:a.memoizedState!==null&&Ya(a);break;case 13:Ya(a);break;case 19:de(la);break;case 10:ws(a.type);break;case 22:case 23:Ya(a),Rc(),t!==null&&de(En);break;case 24:ws(ma)}}function el(t,a){try{var s=a.updateQueue,n=s!==null?s.lastEffect:null;if(n!==null){var o=n.next;s=o;do{if((s.tag&t)===t){n=void 0;var d=s.create,h=s.inst;n=d(),h.destroy=n}s=s.next}while(s!==o)}}catch(_){Ut(a,a.return,_)}}function Ws(t,a,s){try{var n=a.updateQueue,o=n!==null?n.lastEffect:null;if(o!==null){var d=o.next;n=d;do{if((n.tag&t)===t){var h=n.inst,_=h.destroy;if(_!==void 0){h.destroy=void 0,o=a;var F=s,ce=_;try{ce()}catch(je){Ut(o,F,je)}}}n=n.next}while(n!==d)}}catch(je){Ut(a,a.return,je)}}function Xm(t){var a=t.updateQueue;if(a!==null){var s=t.stateNode;try{Uu(a,s)}catch(n){Ut(t,t.return,n)}}}function Im(t,a,s){s.props=zn(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(n){Ut(t,a,n)}}function tl(t,a){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var n=t.stateNode;break;case 30:n=t.stateNode;break;default:n=t.stateNode}typeof s=="function"?t.refCleanup=s(n):s.current=n}}catch(o){Ut(t,a,o)}}function xs(t,a){var s=t.ref,n=t.refCleanup;if(s!==null)if(typeof n=="function")try{n()}catch(o){Ut(t,a,o)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(o){Ut(t,a,o)}else s.current=null}function Zm(t){var a=t.type,s=t.memoizedProps,n=t.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break e;case"img":s.src?n.src=s.src:s.srcSet&&(n.srcset=s.srcSet)}}catch(o){Ut(t,t.return,o)}}function po(t,a,s){try{var n=t.stateNode;ax(n,t.type,s,a),n[mt]=a}catch(o){Ut(t,t.return,o)}}function Jm(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&rn(t.type)||t.tag===4}function fo(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Jm(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&rn(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function go(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,a):(a=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,a.appendChild(t),s=s._reactRootContainer,s!=null||a.onclick!==null||(a.onclick=ys));else if(n!==4&&(n===27&&rn(t.type)&&(s=t.stateNode,a=null),t=t.child,t!==null))for(go(t,a,s),t=t.sibling;t!==null;)go(t,a,s),t=t.sibling}function li(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?s.insertBefore(t,a):s.appendChild(t);else if(n!==4&&(n===27&&rn(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(li(t,a,s),t=t.sibling;t!==null;)li(t,a,s),t=t.sibling}function Wm(t){var a=t.stateNode,s=t.memoizedProps;try{for(var n=t.type,o=a.attributes;o.length;)a.removeAttributeNode(o[0]);ka(a,n,s),a[ct]=t,a[mt]=s}catch(d){Ut(t,t.return,d)}}var Ms=!1,fa=!1,xo=!1,Km=typeof WeakSet=="function"?WeakSet:Set,_a=null;function Rg(t,a){if(t=t.containerInfo,Uo=ki,t=uu(t),oc(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var o=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var h=0,_=-1,F=-1,ce=0,je=0,_e=t,ue=null;t:for(;;){for(var pe;_e!==s||o!==0&&_e.nodeType!==3||(_=h+o),_e!==d||n!==0&&_e.nodeType!==3||(F=h+n),_e.nodeType===3&&(h+=_e.nodeValue.length),(pe=_e.firstChild)!==null;)ue=_e,_e=pe;for(;;){if(_e===t)break t;if(ue===s&&++ce===o&&(_=h),ue===d&&++je===n&&(F=h),(pe=_e.nextSibling)!==null)break;_e=ue,ue=_e.parentNode}_e=pe}s=_===-1||F===-1?null:{start:_,end:F}}else s=null}s=s||{start:0,end:0}}else s=null;for(Ho={focusedElem:t,selectionRange:s},ki=!1,_a=a;_a!==null;)if(a=_a,t=a.child,(a.subtreeFlags&1028)!==0&&t!==null)t.return=a,_a=t;else for(;_a!==null;){switch(a=_a,d=a.alternate,t=a.flags,a.tag){case 0:if((t&4)!==0&&(t=a.updateQueue,t=t!==null?t.events:null,t!==null))for(s=0;s<t.length;s++)o=t[s],o.ref.impl=o.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&d!==null){t=void 0,s=a,o=d.memoizedProps,d=d.memoizedState,n=s.stateNode;try{var Pe=zn(s.type,o);t=n.getSnapshotBeforeUpdate(Pe,d),n.__reactInternalSnapshotBeforeUpdate=t}catch(nt){Ut(s,s.return,nt)}}break;case 3:if((t&1024)!==0){if(t=a.stateNode.containerInfo,s=t.nodeType,s===9)$o(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":$o(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(i(163))}if(t=a.sibling,t!==null){t.return=a.return,_a=t;break}_a=a.return}}function eh(t,a,s){var n=s.flags;switch(s.tag){case 0:case 11:case 15:As(t,s),n&4&&el(5,s);break;case 1:if(As(t,s),n&4)if(t=s.stateNode,a===null)try{t.componentDidMount()}catch(h){Ut(s,s.return,h)}else{var o=zn(s.type,a.memoizedProps);a=a.memoizedState;try{t.componentDidUpdate(o,a,t.__reactInternalSnapshotBeforeUpdate)}catch(h){Ut(s,s.return,h)}}n&64&&Xm(s),n&512&&tl(s,s.return);break;case 3:if(As(t,s),n&64&&(t=s.updateQueue,t!==null)){if(a=null,s.child!==null)switch(s.child.tag){case 27:case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}try{Uu(t,a)}catch(h){Ut(s,s.return,h)}}break;case 27:a===null&&n&4&&Wm(s);case 26:case 5:As(t,s),a===null&&n&4&&Zm(s),n&512&&tl(s,s.return);break;case 12:As(t,s);break;case 31:As(t,s),n&4&&sh(t,s);break;case 13:As(t,s),n&4&&nh(t,s),n&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=Gg.bind(null,s),dx(t,s))));break;case 22:if(n=s.memoizedState!==null||Ms,!n){a=a!==null&&a.memoizedState!==null||fa,o=Ms;var d=fa;Ms=n,(fa=a)&&!d?zs(t,s,(s.subtreeFlags&8772)!==0):As(t,s),Ms=o,fa=d}break;case 30:break;default:As(t,s)}}function th(t){var a=t.alternate;a!==null&&(t.alternate=null,th(a)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(a=t.stateNode,a!==null&&ya(a)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var ta=null,qa=!1;function Ts(t,a,s){for(s=s.child;s!==null;)ah(t,a,s),s=s.sibling}function ah(t,a,s){if(Je&&typeof Je.onCommitFiberUnmount=="function")try{Je.onCommitFiberUnmount(St,s)}catch{}switch(s.tag){case 26:fa||xs(s,a),Ts(t,a,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:fa||xs(s,a);var n=ta,o=qa;rn(s.type)&&(ta=s.stateNode,qa=!1),Ts(t,a,s),dl(s.stateNode),ta=n,qa=o;break;case 5:fa||xs(s,a);case 6:if(n=ta,o=qa,ta=null,Ts(t,a,s),ta=n,qa=o,ta!==null)if(qa)try{(ta.nodeType===9?ta.body:ta.nodeName==="HTML"?ta.ownerDocument.body:ta).removeChild(s.stateNode)}catch(d){Ut(s,a,d)}else try{ta.removeChild(s.stateNode)}catch(d){Ut(s,a,d)}break;case 18:ta!==null&&(qa?(t=ta,Xh(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),_r(t)):Xh(ta,s.stateNode));break;case 4:n=ta,o=qa,ta=s.stateNode.containerInfo,qa=!0,Ts(t,a,s),ta=n,qa=o;break;case 0:case 11:case 14:case 15:Ws(2,s,a),fa||Ws(4,s,a),Ts(t,a,s);break;case 1:fa||(xs(s,a),n=s.stateNode,typeof n.componentWillUnmount=="function"&&Im(s,a,n)),Ts(t,a,s);break;case 21:Ts(t,a,s);break;case 22:fa=(n=fa)||s.memoizedState!==null,Ts(t,a,s),fa=n;break;default:Ts(t,a,s)}}function sh(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{_r(t)}catch(s){Ut(a,a.return,s)}}}function nh(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{_r(t)}catch(s){Ut(a,a.return,s)}}function qg(t){switch(t.tag){case 31:case 13:case 19:var a=t.stateNode;return a===null&&(a=t.stateNode=new Km),a;case 22:return t=t.stateNode,a=t._retryCache,a===null&&(a=t._retryCache=new Km),a;default:throw Error(i(435,t.tag))}}function ii(t,a){var s=qg(t);a.forEach(function(n){if(!s.has(n)){s.add(n);var o=Pg.bind(null,t,n);n.then(o,o)}})}function La(t,a){var s=a.deletions;if(s!==null)for(var n=0;n<s.length;n++){var o=s[n],d=t,h=a,_=h;e:for(;_!==null;){switch(_.tag){case 27:if(rn(_.type)){ta=_.stateNode,qa=!1;break e}break;case 5:ta=_.stateNode,qa=!1;break e;case 3:case 4:ta=_.stateNode.containerInfo,qa=!0;break e}_=_.return}if(ta===null)throw Error(i(160));ah(d,h,o),ta=null,qa=!1,d=o.alternate,d!==null&&(d.return=null),o.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)rh(a,t),a=a.sibling}var ms=null;function rh(t,a){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:La(a,t),Ua(t),n&4&&(Ws(3,t,t.return),el(3,t),Ws(5,t,t.return));break;case 1:La(a,t),Ua(t),n&512&&(fa||s===null||xs(s,s.return)),n&64&&Ms&&(t=t.updateQueue,t!==null&&(n=t.callbacks,n!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?n:s.concat(n))));break;case 26:var o=ms;if(La(a,t),Ua(t),n&512&&(fa||s===null||xs(s,s.return)),n&4){var d=s!==null?s.memoizedState:null;if(n=t.memoizedState,s===null)if(n===null)if(t.stateNode===null){e:{n=t.type,s=t.memoizedProps,o=o.ownerDocument||o;t:switch(n){case"title":d=o.getElementsByTagName("title")[0],(!d||d[Xt]||d[ct]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=o.createElement(n),o.head.insertBefore(d,o.querySelector("head > title"))),ka(d,n,s),d[ct]=t,Tt(d),n=d;break e;case"link":var h=rp("link","href",o).get(n+(s.href||""));if(h){for(var _=0;_<h.length;_++)if(d=h[_],d.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&d.getAttribute("rel")===(s.rel==null?null:s.rel)&&d.getAttribute("title")===(s.title==null?null:s.title)&&d.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){h.splice(_,1);break t}}d=o.createElement(n),ka(d,n,s),o.head.appendChild(d);break;case"meta":if(h=rp("meta","content",o).get(n+(s.content||""))){for(_=0;_<h.length;_++)if(d=h[_],d.getAttribute("content")===(s.content==null?null:""+s.content)&&d.getAttribute("name")===(s.name==null?null:s.name)&&d.getAttribute("property")===(s.property==null?null:s.property)&&d.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&d.getAttribute("charset")===(s.charSet==null?null:s.charSet)){h.splice(_,1);break t}}d=o.createElement(n),ka(d,n,s),o.head.appendChild(d);break;default:throw Error(i(468,n))}d[ct]=t,Tt(d),n=d}t.stateNode=n}else lp(o,t.type,t.stateNode);else t.stateNode=np(o,n,t.memoizedProps);else d!==n?(d===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):d.count--,n===null?lp(o,t.type,t.stateNode):np(o,n,t.memoizedProps)):n===null&&t.stateNode!==null&&po(t,t.memoizedProps,s.memoizedProps)}break;case 27:La(a,t),Ua(t),n&512&&(fa||s===null||xs(s,s.return)),s!==null&&n&4&&po(t,t.memoizedProps,s.memoizedProps);break;case 5:if(La(a,t),Ua(t),n&512&&(fa||s===null||xs(s,s.return)),t.flags&32){o=t.stateNode;try{Pn(o,"")}catch(Pe){Ut(t,t.return,Pe)}}n&4&&t.stateNode!=null&&(o=t.memoizedProps,po(t,o,s!==null?s.memoizedProps:o)),n&1024&&(xo=!0);break;case 6:if(La(a,t),Ua(t),n&4){if(t.stateNode===null)throw Error(i(162));n=t.memoizedProps,s=t.stateNode;try{s.nodeValue=n}catch(Pe){Ut(t,t.return,Pe)}}break;case 3:if(Ni=null,o=ms,ms=bi(a.containerInfo),La(a,t),ms=o,Ua(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{_r(a.containerInfo)}catch(Pe){Ut(t,t.return,Pe)}xo&&(xo=!1,lh(t));break;case 4:n=ms,ms=bi(t.stateNode.containerInfo),La(a,t),Ua(t),ms=n;break;case 12:La(a,t),Ua(t);break;case 31:La(a,t),Ua(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,ii(t,n)));break;case 13:La(a,t),Ua(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(oi=et()),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,ii(t,n)));break;case 22:o=t.memoizedState!==null;var F=s!==null&&s.memoizedState!==null,ce=Ms,je=fa;if(Ms=ce||o,fa=je||F,La(a,t),fa=je,Ms=ce,Ua(t),n&8192)e:for(a=t.stateNode,a._visibility=o?a._visibility&-2:a._visibility|1,o&&(s===null||F||Ms||fa||On(t)),s=null,a=t;;){if(a.tag===5||a.tag===26){if(s===null){F=s=a;try{if(d=F.stateNode,o)h=d.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none";else{_=F.stateNode;var _e=F.memoizedProps.style,ue=_e!=null&&_e.hasOwnProperty("display")?_e.display:null;_.style.display=ue==null||typeof ue=="boolean"?"":(""+ue).trim()}}catch(Pe){Ut(F,F.return,Pe)}}}else if(a.tag===6){if(s===null){F=a;try{F.stateNode.nodeValue=o?"":F.memoizedProps}catch(Pe){Ut(F,F.return,Pe)}}}else if(a.tag===18){if(s===null){F=a;try{var pe=F.stateNode;o?Ih(pe,!0):Ih(F.stateNode,!1)}catch(Pe){Ut(F,F.return,Pe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===t)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break e;for(;a.sibling===null;){if(a.return===null||a.return===t)break e;s===a&&(s=null),a=a.return}s===a&&(s=null),a.sibling.return=a.return,a=a.sibling}n&4&&(n=t.updateQueue,n!==null&&(s=n.retryQueue,s!==null&&(n.retryQueue=null,ii(t,s))));break;case 19:La(a,t),Ua(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,ii(t,n)));break;case 30:break;case 21:break;default:La(a,t),Ua(t)}}function Ua(t){var a=t.flags;if(a&2){try{for(var s,n=t.return;n!==null;){if(Jm(n)){s=n;break}n=n.return}if(s==null)throw Error(i(160));switch(s.tag){case 27:var o=s.stateNode,d=fo(t);li(t,d,o);break;case 5:var h=s.stateNode;s.flags&32&&(Pn(h,""),s.flags&=-33);var _=fo(t);li(t,_,h);break;case 3:case 4:var F=s.stateNode.containerInfo,ce=fo(t);go(t,ce,F);break;default:throw Error(i(161))}}catch(je){Ut(t,t.return,je)}t.flags&=-3}a&4096&&(t.flags&=-4097)}function lh(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var a=t;lh(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),t=t.sibling}}function As(t,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)eh(t,a.alternate,a),a=a.sibling}function On(t){for(t=t.child;t!==null;){var a=t;switch(a.tag){case 0:case 11:case 14:case 15:Ws(4,a,a.return),On(a);break;case 1:xs(a,a.return);var s=a.stateNode;typeof s.componentWillUnmount=="function"&&Im(a,a.return,s),On(a);break;case 27:dl(a.stateNode);case 26:case 5:xs(a,a.return),On(a);break;case 22:a.memoizedState===null&&On(a);break;case 30:On(a);break;default:On(a)}t=t.sibling}}function zs(t,a,s){for(s=s&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var n=a.alternate,o=t,d=a,h=d.flags;switch(d.tag){case 0:case 11:case 15:zs(o,d,s),el(4,d);break;case 1:if(zs(o,d,s),n=d,o=n.stateNode,typeof o.componentDidMount=="function")try{o.componentDidMount()}catch(ce){Ut(n,n.return,ce)}if(n=d,o=n.updateQueue,o!==null){var _=n.stateNode;try{var F=o.shared.hiddenCallbacks;if(F!==null)for(o.shared.hiddenCallbacks=null,o=0;o<F.length;o++)Lu(F[o],_)}catch(ce){Ut(n,n.return,ce)}}s&&h&64&&Xm(d),tl(d,d.return);break;case 27:Wm(d);case 26:case 5:zs(o,d,s),s&&n===null&&h&4&&Zm(d),tl(d,d.return);break;case 12:zs(o,d,s);break;case 31:zs(o,d,s),s&&h&4&&sh(o,d);break;case 13:zs(o,d,s),s&&h&4&&nh(o,d);break;case 22:d.memoizedState===null&&zs(o,d,s),tl(d,d.return);break;case 30:break;default:zs(o,d,s)}a=a.sibling}}function jo(t,a){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(t=a.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&Br(s))}function vo(t,a){t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&Br(t))}function hs(t,a,s,n){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)ih(t,a,s,n),a=a.sibling}function ih(t,a,s,n){var o=a.flags;switch(a.tag){case 0:case 11:case 15:hs(t,a,s,n),o&2048&&el(9,a);break;case 1:hs(t,a,s,n);break;case 3:hs(t,a,s,n),o&2048&&(t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&Br(t)));break;case 12:if(o&2048){hs(t,a,s,n),t=a.stateNode;try{var d=a.memoizedProps,h=d.id,_=d.onPostCommit;typeof _=="function"&&_(h,a.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(F){Ut(a,a.return,F)}}else hs(t,a,s,n);break;case 31:hs(t,a,s,n);break;case 13:hs(t,a,s,n);break;case 23:break;case 22:d=a.stateNode,h=a.alternate,a.memoizedState!==null?d._visibility&2?hs(t,a,s,n):al(t,a):d._visibility&2?hs(t,a,s,n):(d._visibility|=2,ur(t,a,s,n,(a.subtreeFlags&10256)!==0||!1)),o&2048&&jo(h,a);break;case 24:hs(t,a,s,n),o&2048&&vo(a.alternate,a);break;default:hs(t,a,s,n)}}function ur(t,a,s,n,o){for(o=o&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var d=t,h=a,_=s,F=n,ce=h.flags;switch(h.tag){case 0:case 11:case 15:ur(d,h,_,F,o),el(8,h);break;case 23:break;case 22:var je=h.stateNode;h.memoizedState!==null?je._visibility&2?ur(d,h,_,F,o):al(d,h):(je._visibility|=2,ur(d,h,_,F,o)),o&&ce&2048&&jo(h.alternate,h);break;case 24:ur(d,h,_,F,o),o&&ce&2048&&vo(h.alternate,h);break;default:ur(d,h,_,F,o)}a=a.sibling}}function al(t,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var s=t,n=a,o=n.flags;switch(n.tag){case 22:al(s,n),o&2048&&jo(n.alternate,n);break;case 24:al(s,n),o&2048&&vo(n.alternate,n);break;default:al(s,n)}a=a.sibling}}var sl=8192;function mr(t,a,s){if(t.subtreeFlags&sl)for(t=t.child;t!==null;)ch(t,a,s),t=t.sibling}function ch(t,a,s){switch(t.tag){case 26:mr(t,a,s),t.flags&sl&&t.memoizedState!==null&&_x(s,ms,t.memoizedState,t.memoizedProps);break;case 5:mr(t,a,s);break;case 3:case 4:var n=ms;ms=bi(t.stateNode.containerInfo),mr(t,a,s),ms=n;break;case 22:t.memoizedState===null&&(n=t.alternate,n!==null&&n.memoizedState!==null?(n=sl,sl=16777216,mr(t,a,s),sl=n):mr(t,a,s));break;default:mr(t,a,s)}}function oh(t){var a=t.alternate;if(a!==null&&(t=a.child,t!==null)){a.child=null;do a=t.sibling,t.sibling=null,t=a;while(t!==null)}}function nl(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];_a=n,uh(n,t)}oh(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)dh(t),t=t.sibling}function dh(t){switch(t.tag){case 0:case 11:case 15:nl(t),t.flags&2048&&Ws(9,t,t.return);break;case 3:nl(t);break;case 12:nl(t);break;case 22:var a=t.stateNode;t.memoizedState!==null&&a._visibility&2&&(t.return===null||t.return.tag!==13)?(a._visibility&=-3,ci(t)):nl(t);break;default:nl(t)}}function ci(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];_a=n,uh(n,t)}oh(t)}for(t=t.child;t!==null;){switch(a=t,a.tag){case 0:case 11:case 15:Ws(8,a,a.return),ci(a);break;case 22:s=a.stateNode,s._visibility&2&&(s._visibility&=-3,ci(a));break;default:ci(a)}t=t.sibling}}function uh(t,a){for(;_a!==null;){var s=_a;switch(s.tag){case 0:case 11:case 15:Ws(8,s,a);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var n=s.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:Br(s.memoizedState.cache)}if(n=s.child,n!==null)n.return=s,_a=n;else e:for(s=t;_a!==null;){n=_a;var o=n.sibling,d=n.return;if(th(n),n===s){_a=null;break e}if(o!==null){o.return=d,_a=o;break e}_a=d}}}var Lg={getCacheForType:function(t){var a=wa(ma),s=a.data.get(t);return s===void 0&&(s=t(),a.data.set(t,s)),s},cacheSignal:function(){return wa(ma).controller.signal}},Ug=typeof WeakMap=="function"?WeakMap:Map,Rt=0,Vt=null,vt=null,_t=0,Lt=0,Qa=null,Ks=!1,hr=!1,yo=!1,Os=0,ra=0,en=0,Rn=0,bo=0,Xa=0,pr=0,rl=null,Ha=null,_o=!1,oi=0,mh=0,di=1/0,ui=null,tn=null,xa=0,an=null,fr=null,Rs=0,No=0,So=null,hh=null,ll=0,wo=null;function Ia(){return(Rt&2)!==0&&_t!==0?_t&-_t:w.T!==null?To():jt()}function ph(){if(Xa===0)if((_t&536870912)===0||wt){var t=De;De<<=1,(De&3932160)===0&&(De=262144),Xa=t}else Xa=536870912;return t=Pa.current,t!==null&&(t.flags|=32),Xa}function Fa(t,a,s){(t===Vt&&(Lt===2||Lt===9)||t.cancelPendingCommit!==null)&&(gr(t,0),sn(t,_t,Xa,!1)),dt(t,s),((Rt&2)===0||t!==Vt)&&(t===Vt&&((Rt&2)===0&&(Rn|=s),ra===4&&sn(t,_t,Xa,!1)),js(t))}function fh(t,a,s){if((Rt&6)!==0)throw Error(i(327));var n=!s&&(a&127)===0&&(a&t.expiredLanes)===0||Yt(t,a),o=n?Bg(t,a):ko(t,a,!0),d=n;do{if(o===0){hr&&!n&&sn(t,a,0,!1);break}else{if(s=t.current.alternate,d&&!Hg(s)){o=ko(t,a,!1),d=!1;continue}if(o===2){if(d=a,t.errorRecoveryDisabledLanes&d)var h=0;else h=t.pendingLanes&-536870913,h=h!==0?h:h&536870912?536870912:0;if(h!==0){a=h;e:{var _=t;o=rl;var F=_.current.memoizedState.isDehydrated;if(F&&(gr(_,h).flags|=256),h=ko(_,h,!1),h!==2){if(yo&&!F){_.errorRecoveryDisabledLanes|=d,Rn|=d,o=4;break e}d=Ha,Ha=o,d!==null&&(Ha===null?Ha=d:Ha.push.apply(Ha,d))}o=h}if(d=!1,o!==2)continue}}if(o===1){gr(t,0),sn(t,a,0,!0);break}e:{switch(n=t,d=o,d){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:sn(n,a,Xa,!Ks);break e;case 2:Ha=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(o=oi+300-et(),10<o)){if(sn(n,a,Xa,!Ks),ot(n,0,!0)!==0)break e;Rs=a,n.timeoutHandle=Yh(gh.bind(null,n,s,Ha,ui,_o,a,Xa,Rn,pr,Ks,d,"Throttled",-0,0),o);break e}gh(n,s,Ha,ui,_o,a,Xa,Rn,pr,Ks,d,null,-0,0)}}break}while(!0);js(t)}function gh(t,a,s,n,o,d,h,_,F,ce,je,_e,ue,pe){if(t.timeoutHandle=-1,_e=a.subtreeFlags,_e&8192||(_e&16785408)===16785408){_e={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ys},ch(a,d,_e);var Pe=(d&62914560)===d?oi-et():(d&4194048)===d?mh-et():0;if(Pe=Nx(_e,Pe),Pe!==null){Rs=d,t.cancelPendingCommit=Pe(Sh.bind(null,t,a,d,s,n,o,h,_,F,je,_e,null,ue,pe)),sn(t,d,h,!ce);return}}Sh(t,a,d,s,n,o,h,_,F)}function Hg(t){for(var a=t;;){var s=a.tag;if((s===0||s===11||s===15)&&a.flags&16384&&(s=a.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var n=0;n<s.length;n++){var o=s[n],d=o.getSnapshot;o=o.value;try{if(!Va(d(),o))return!1}catch{return!1}}if(s=a.child,a.subtreeFlags&16384&&s!==null)s.return=a,a=s;else{if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function sn(t,a,s,n){a&=~bo,a&=~Rn,t.suspendedLanes|=a,t.pingedLanes&=~a,n&&(t.warmLanes|=a),n=t.expirationTimes;for(var o=a;0<o;){var d=31-Ee(o),h=1<<d;n[d]=-1,o&=~h}s!==0&&ke(t,s,a)}function mi(){return(Rt&6)===0?(il(0),!1):!0}function Co(){if(vt!==null){if(Lt===0)var t=vt.return;else t=vt,Ss=Cn=null,Bc(t),lr=null,Vr=0,t=vt;for(;t!==null;)Qm(t.alternate,t),t=t.return;vt=null}}function gr(t,a){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,rx(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),Rs=0,Co(),Vt=t,vt=s=_s(t.current,null),_t=a,Lt=0,Qa=null,Ks=!1,hr=Yt(t,a),yo=!1,pr=Xa=bo=Rn=en=ra=0,Ha=rl=null,_o=!1,(a&8)!==0&&(a|=a&32);var n=t.entangledLanes;if(n!==0)for(t=t.entanglements,n&=a;0<n;){var o=31-Ee(n),d=1<<o;a|=t[o],n&=~d}return Os=a,zl(),s}function xh(t,a){ut=null,w.H=Jr,a===rr||a===Bl?(a=zu(),Lt=3):a===Dc?(a=zu(),Lt=4):Lt=a===so?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Qa=a,vt===null&&(ra=1,ti(t,ts(a,t.current)))}function jh(){var t=Pa.current;return t===null?!0:(_t&4194048)===_t?rs===null:(_t&62914560)===_t||(_t&536870912)!==0?t===rs:!1}function vh(){var t=w.H;return w.H=Jr,t===null?Jr:t}function yh(){var t=w.A;return w.A=Lg,t}function hi(){ra=4,Ks||(_t&4194048)!==_t&&Pa.current!==null||(hr=!0),(en&134217727)===0&&(Rn&134217727)===0||Vt===null||sn(Vt,_t,Xa,!1)}function ko(t,a,s){var n=Rt;Rt|=2;var o=vh(),d=yh();(Vt!==t||_t!==a)&&(ui=null,gr(t,a)),a=!1;var h=ra;e:do try{if(Lt!==0&&vt!==null){var _=vt,F=Qa;switch(Lt){case 8:Co(),h=6;break e;case 3:case 2:case 9:case 6:Pa.current===null&&(a=!0);var ce=Lt;if(Lt=0,Qa=null,xr(t,_,F,ce),s&&hr){h=0;break e}break;default:ce=Lt,Lt=0,Qa=null,xr(t,_,F,ce)}}Fg(),h=ra;break}catch(je){xh(t,je)}while(!0);return a&&t.shellSuspendCounter++,Ss=Cn=null,Rt=n,w.H=o,w.A=d,vt===null&&(Vt=null,_t=0,zl()),h}function Fg(){for(;vt!==null;)bh(vt)}function Bg(t,a){var s=Rt;Rt|=2;var n=vh(),o=yh();Vt!==t||_t!==a?(ui=null,di=et()+500,gr(t,a)):hr=Yt(t,a);e:do try{if(Lt!==0&&vt!==null){a=vt;var d=Qa;t:switch(Lt){case 1:Lt=0,Qa=null,xr(t,a,d,1);break;case 2:case 9:if(Tu(d)){Lt=0,Qa=null,_h(a);break}a=function(){Lt!==2&&Lt!==9||Vt!==t||(Lt=7),js(t)},d.then(a,a);break e;case 3:Lt=7;break e;case 4:Lt=5;break e;case 7:Tu(d)?(Lt=0,Qa=null,_h(a)):(Lt=0,Qa=null,xr(t,a,d,7));break;case 5:var h=null;switch(vt.tag){case 26:h=vt.memoizedState;case 5:case 27:var _=vt;if(h?ip(h):_.stateNode.complete){Lt=0,Qa=null;var F=_.sibling;if(F!==null)vt=F;else{var ce=_.return;ce!==null?(vt=ce,pi(ce)):vt=null}break t}}Lt=0,Qa=null,xr(t,a,d,5);break;case 6:Lt=0,Qa=null,xr(t,a,d,6);break;case 8:Co(),ra=6;break e;default:throw Error(i(462))}}$g();break}catch(je){xh(t,je)}while(!0);return Ss=Cn=null,w.H=n,w.A=o,Rt=s,vt!==null?0:(Vt=null,_t=0,zl(),ra)}function $g(){for(;vt!==null&&!Ze();)bh(vt)}function bh(t){var a=Pm(t.alternate,t,Os);t.memoizedProps=t.pendingProps,a===null?pi(t):vt=a}function _h(t){var a=t,s=a.alternate;switch(a.tag){case 15:case 0:a=Hm(s,a,a.pendingProps,a.type,void 0,_t);break;case 11:a=Hm(s,a,a.pendingProps,a.type.render,a.ref,_t);break;case 5:Bc(a);default:Qm(s,a),a=vt=yu(a,Os),a=Pm(s,a,Os)}t.memoizedProps=t.pendingProps,a===null?pi(t):vt=a}function xr(t,a,s,n){Ss=Cn=null,Bc(a),lr=null,Vr=0;var o=a.return;try{if(Mg(t,o,a,s,_t)){ra=1,ti(t,ts(s,t.current)),vt=null;return}}catch(d){if(o!==null)throw vt=o,d;ra=1,ti(t,ts(s,t.current)),vt=null;return}a.flags&32768?(wt||n===1?t=!0:hr||(_t&536870912)!==0?t=!1:(Ks=t=!0,(n===2||n===9||n===3||n===6)&&(n=Pa.current,n!==null&&n.tag===13&&(n.flags|=16384))),Nh(a,t)):pi(a)}function pi(t){var a=t;do{if((a.flags&32768)!==0){Nh(a,Ks);return}t=a.return;var s=zg(a.alternate,a,Os);if(s!==null){vt=s;return}if(a=a.sibling,a!==null){vt=a;return}vt=a=t}while(a!==null);ra===0&&(ra=5)}function Nh(t,a){do{var s=Og(t.alternate,t);if(s!==null){s.flags&=32767,vt=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!a&&(t=t.sibling,t!==null)){vt=t;return}vt=t=s}while(t!==null);ra=6,vt=null}function Sh(t,a,s,n,o,d,h,_,F){t.cancelPendingCommit=null;do fi();while(xa!==0);if((Rt&6)!==0)throw Error(i(327));if(a!==null){if(a===t.current)throw Error(i(177));if(d=a.lanes|a.childLanes,d|=pc,Oa(t,s,d,h,_,F),t===Vt&&(vt=Vt=null,_t=0),fr=a,an=t,Rs=s,No=d,So=o,hh=n,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,Yg(Mt,function(){return Dh(),null})):(t.callbackNode=null,t.callbackPriority=0),n=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||n){n=w.T,w.T=null,o=Z.p,Z.p=2,h=Rt,Rt|=4;try{Rg(t,a,s)}finally{Rt=h,Z.p=o,w.T=n}}xa=1,wh(),Ch(),kh()}}function wh(){if(xa===1){xa=0;var t=an,a=fr,s=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||s){s=w.T,w.T=null;var n=Z.p;Z.p=2;var o=Rt;Rt|=4;try{rh(a,t);var d=Ho,h=uu(t.containerInfo),_=d.focusedElem,F=d.selectionRange;if(h!==_&&_&&_.ownerDocument&&du(_.ownerDocument.documentElement,_)){if(F!==null&&oc(_)){var ce=F.start,je=F.end;if(je===void 0&&(je=ce),"selectionStart"in _)_.selectionStart=ce,_.selectionEnd=Math.min(je,_.value.length);else{var _e=_.ownerDocument||document,ue=_e&&_e.defaultView||window;if(ue.getSelection){var pe=ue.getSelection(),Pe=_.textContent.length,nt=Math.min(F.start,Pe),Bt=F.end===void 0?nt:Math.min(F.end,Pe);!pe.extend&&nt>Bt&&(h=Bt,Bt=nt,nt=h);var W=ou(_,nt),X=ou(_,Bt);if(W&&X&&(pe.rangeCount!==1||pe.anchorNode!==W.node||pe.anchorOffset!==W.offset||pe.focusNode!==X.node||pe.focusOffset!==X.offset)){var le=_e.createRange();le.setStart(W.node,W.offset),pe.removeAllRanges(),nt>Bt?(pe.addRange(le),pe.extend(X.node,X.offset)):(le.setEnd(X.node,X.offset),pe.addRange(le))}}}}for(_e=[],pe=_;pe=pe.parentNode;)pe.nodeType===1&&_e.push({element:pe,left:pe.scrollLeft,top:pe.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<_e.length;_++){var ye=_e[_];ye.element.scrollLeft=ye.left,ye.element.scrollTop=ye.top}}ki=!!Uo,Ho=Uo=null}finally{Rt=o,Z.p=n,w.T=s}}t.current=a,xa=2}}function Ch(){if(xa===2){xa=0;var t=an,a=fr,s=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||s){s=w.T,w.T=null;var n=Z.p;Z.p=2;var o=Rt;Rt|=4;try{eh(t,a.alternate,a)}finally{Rt=o,Z.p=n,w.T=s}}xa=3}}function kh(){if(xa===4||xa===3){xa=0,Ke();var t=an,a=fr,s=Rs,n=hh;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?xa=5:(xa=0,fr=an=null,Eh(t,t.pendingLanes));var o=t.pendingLanes;if(o===0&&(tn=null),Te(s),a=a.stateNode,Je&&typeof Je.onCommitFiberRoot=="function")try{Je.onCommitFiberRoot(St,a,void 0,(a.current.flags&128)===128)}catch{}if(n!==null){a=w.T,o=Z.p,Z.p=2,w.T=null;try{for(var d=t.onRecoverableError,h=0;h<n.length;h++){var _=n[h];d(_.value,{componentStack:_.stack})}}finally{w.T=a,Z.p=o}}(Rs&3)!==0&&fi(),js(t),o=t.pendingLanes,(s&261930)!==0&&(o&42)!==0?t===wo?ll++:(ll=0,wo=t):ll=0,il(0)}}function Eh(t,a){(t.pooledCacheLanes&=a)===0&&(a=t.pooledCache,a!=null&&(t.pooledCache=null,Br(a)))}function fi(){return wh(),Ch(),kh(),Dh()}function Dh(){if(xa!==5)return!1;var t=an,a=No;No=0;var s=Te(Rs),n=w.T,o=Z.p;try{Z.p=32>s?32:s,w.T=null,s=So,So=null;var d=an,h=Rs;if(xa=0,fr=an=null,Rs=0,(Rt&6)!==0)throw Error(i(331));var _=Rt;if(Rt|=4,dh(d.current),ih(d,d.current,h,s),Rt=_,il(0,!1),Je&&typeof Je.onPostCommitFiberRoot=="function")try{Je.onPostCommitFiberRoot(St,d)}catch{}return!0}finally{Z.p=o,w.T=n,Eh(t,a)}}function Mh(t,a,s){a=ts(s,a),a=ao(t.stateNode,a,2),t=Is(t,a,2),t!==null&&(dt(t,2),js(t))}function Ut(t,a,s){if(t.tag===3)Mh(t,t,s);else for(;a!==null;){if(a.tag===3){Mh(a,t,s);break}else if(a.tag===1){var n=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(tn===null||!tn.has(n))){t=ts(s,t),s=Tm(2),n=Is(a,s,2),n!==null&&(Am(s,n,a,t),dt(n,2),js(n));break}}a=a.return}}function Eo(t,a,s){var n=t.pingCache;if(n===null){n=t.pingCache=new Ug;var o=new Set;n.set(a,o)}else o=n.get(a),o===void 0&&(o=new Set,n.set(a,o));o.has(s)||(yo=!0,o.add(s),t=Vg.bind(null,t,a,s),a.then(t,t))}function Vg(t,a,s){var n=t.pingCache;n!==null&&n.delete(a),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,Vt===t&&(_t&s)===s&&(ra===4||ra===3&&(_t&62914560)===_t&&300>et()-oi?(Rt&2)===0&&gr(t,0):bo|=s,pr===_t&&(pr=0)),js(t)}function Th(t,a){a===0&&(a=Ne()),t=Nn(t,a),t!==null&&(dt(t,a),js(t))}function Gg(t){var a=t.memoizedState,s=0;a!==null&&(s=a.retryLane),Th(t,s)}function Pg(t,a){var s=0;switch(t.tag){case 31:case 13:var n=t.stateNode,o=t.memoizedState;o!==null&&(s=o.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(i(314))}n!==null&&n.delete(a),Th(t,s)}function Yg(t,a){return qe(t,a)}var gi=null,jr=null,Do=!1,xi=!1,Mo=!1,nn=0;function js(t){t!==jr&&t.next===null&&(jr===null?gi=jr=t:jr=jr.next=t),xi=!0,Do||(Do=!0,Xg())}function il(t,a){if(!Mo&&xi){Mo=!0;do for(var s=!1,n=gi;n!==null;){if(t!==0){var o=n.pendingLanes;if(o===0)var d=0;else{var h=n.suspendedLanes,_=n.pingedLanes;d=(1<<31-Ee(42|t)+1)-1,d&=o&~(h&~_),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(s=!0,Rh(n,d))}else d=_t,d=ot(n,n===Vt?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(d&3)===0||Yt(n,d)||(s=!0,Rh(n,d));n=n.next}while(s);Mo=!1}}function Qg(){Ah()}function Ah(){xi=Do=!1;var t=0;nn!==0&&nx()&&(t=nn);for(var a=et(),s=null,n=gi;n!==null;){var o=n.next,d=zh(n,a);d===0?(n.next=null,s===null?gi=o:s.next=o,o===null&&(jr=s)):(s=n,(t!==0||(d&3)!==0)&&(xi=!0)),n=o}xa!==0&&xa!==5||il(t),nn!==0&&(nn=0)}function zh(t,a){for(var s=t.suspendedLanes,n=t.pingedLanes,o=t.expirationTimes,d=t.pendingLanes&-62914561;0<d;){var h=31-Ee(d),_=1<<h,F=o[h];F===-1?((_&s)===0||(_&n)!==0)&&(o[h]=sa(_,a)):F<=a&&(t.expiredLanes|=_),d&=~_}if(a=Vt,s=_t,s=ot(t,t===a?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n=t.callbackNode,s===0||t===a&&(Lt===2||Lt===9)||t.cancelPendingCommit!==null)return n!==null&&n!==null&&Fe(n),t.callbackNode=null,t.callbackPriority=0;if((s&3)===0||Yt(t,s)){if(a=s&-s,a===t.callbackPriority)return a;switch(n!==null&&Fe(n),Te(s)){case 2:case 8:s=kt;break;case 32:s=Mt;break;case 268435456:s=Et;break;default:s=Mt}return n=Oh.bind(null,t),s=qe(s,n),t.callbackPriority=a,t.callbackNode=s,a}return n!==null&&n!==null&&Fe(n),t.callbackPriority=2,t.callbackNode=null,2}function Oh(t,a){if(xa!==0&&xa!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(fi()&&t.callbackNode!==s)return null;var n=_t;return n=ot(t,t===Vt?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n===0?null:(fh(t,n,a),zh(t,et()),t.callbackNode!=null&&t.callbackNode===s?Oh.bind(null,t):null)}function Rh(t,a){if(fi())return null;fh(t,a,!0)}function Xg(){lx(function(){(Rt&6)!==0?qe(bt,Qg):Ah()})}function To(){if(nn===0){var t=sr;t===0&&(t=lt,lt<<=1,(lt&261888)===0&&(lt=256)),nn=t}return nn}function qh(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:wl(""+t)}function Lh(t,a){var s=a.ownerDocument.createElement("input");return s.name=a.name,s.value=a.value,t.id&&s.setAttribute("form",t.id),a.parentNode.insertBefore(s,a),t=new FormData(t),s.parentNode.removeChild(s),t}function Ig(t,a,s,n,o){if(a==="submit"&&s&&s.stateNode===o){var d=qh((o[mt]||null).action),h=n.submitter;h&&(a=(a=h[mt]||null)?qh(a.formAction):h.getAttribute("formAction"),a!==null&&(d=a,h=null));var _=new Dl("action","action",null,n,o);t.push({event:_,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(nn!==0){var F=h?Lh(o,h):new FormData(o);Zc(s,{pending:!0,data:F,method:o.method,action:d},null,F)}}else typeof d=="function"&&(_.preventDefault(),F=h?Lh(o,h):new FormData(o),Zc(s,{pending:!0,data:F,method:o.method,action:d},d,F))},currentTarget:o}]})}}for(var Ao=0;Ao<hc.length;Ao++){var zo=hc[Ao],Zg=zo.toLowerCase(),Jg=zo[0].toUpperCase()+zo.slice(1);us(Zg,"on"+Jg)}us(pu,"onAnimationEnd"),us(fu,"onAnimationIteration"),us(gu,"onAnimationStart"),us("dblclick","onDoubleClick"),us("focusin","onFocus"),us("focusout","onBlur"),us(hg,"onTransitionRun"),us(pg,"onTransitionStart"),us(fg,"onTransitionCancel"),us(xu,"onTransitionEnd"),At("onMouseEnter",["mouseout","mouseover"]),At("onMouseLeave",["mouseout","mouseover"]),At("onPointerEnter",["pointerout","pointerover"]),At("onPointerLeave",["pointerout","pointerover"]),tt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),tt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),tt("onBeforeInput",["compositionend","keypress","textInput","paste"]),tt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),tt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),tt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Wg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(cl));function Uh(t,a){a=(a&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],o=n.event;n=n.listeners;e:{var d=void 0;if(a)for(var h=n.length-1;0<=h;h--){var _=n[h],F=_.instance,ce=_.currentTarget;if(_=_.listener,F!==d&&o.isPropagationStopped())break e;d=_,o.currentTarget=ce;try{d(o)}catch(je){Al(je)}o.currentTarget=null,d=F}else for(h=0;h<n.length;h++){if(_=n[h],F=_.instance,ce=_.currentTarget,_=_.listener,F!==d&&o.isPropagationStopped())break e;d=_,o.currentTarget=ce;try{d(o)}catch(je){Al(je)}o.currentTarget=null,d=F}}}}function yt(t,a){var s=a[Qt];s===void 0&&(s=a[Qt]=new Set);var n=t+"__bubble";s.has(n)||(Hh(a,t,2,!1),s.add(n))}function Oo(t,a,s){var n=0;a&&(n|=4),Hh(s,t,n,a)}var ji="_reactListening"+Math.random().toString(36).slice(2);function Ro(t){if(!t[ji]){t[ji]=!0,$a.forEach(function(s){s!=="selectionchange"&&(Wg.has(s)||Oo(s,!1,t),Oo(s,!0,t))});var a=t.nodeType===9?t:t.ownerDocument;a===null||a[ji]||(a[ji]=!0,Oo("selectionchange",!1,a))}}function Hh(t,a,s,n){switch(pp(a)){case 2:var o=Cx;break;case 8:o=kx;break;default:o=Zo}s=o.bind(null,a,s,t),o=void 0,!ec||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(o=!0),n?o!==void 0?t.addEventListener(a,s,{capture:!0,passive:o}):t.addEventListener(a,s,!0):o!==void 0?t.addEventListener(a,s,{passive:o}):t.addEventListener(a,s,!1)}function qo(t,a,s,n,o){var d=n;if((a&1)===0&&(a&2)===0&&n!==null)e:for(;;){if(n===null)return;var h=n.tag;if(h===3||h===4){var _=n.stateNode.containerInfo;if(_===o)break;if(h===4)for(h=n.return;h!==null;){var F=h.tag;if((F===3||F===4)&&h.stateNode.containerInfo===o)return;h=h.return}for(;_!==null;){if(h=Ba(_),h===null)return;if(F=h.tag,F===5||F===6||F===26||F===27){n=d=h;continue e}_=_.parentNode}}n=n.return}Gd(function(){var ce=d,je=Wi(s),_e=[];e:{var ue=ju.get(t);if(ue!==void 0){var pe=Dl,Pe=t;switch(t){case"keypress":if(kl(s)===0)break e;case"keydown":case"keyup":pe=Pf;break;case"focusin":Pe="focus",pe=nc;break;case"focusout":Pe="blur",pe=nc;break;case"beforeblur":case"afterblur":pe=nc;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=Qd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=zf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=Xf;break;case pu:case fu:case gu:pe=qf;break;case xu:pe=Zf;break;case"scroll":case"scrollend":pe=Tf;break;case"wheel":pe=Wf;break;case"copy":case"cut":case"paste":pe=Uf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=Id;break;case"toggle":case"beforetoggle":pe=eg}var nt=(a&4)!==0,Bt=!nt&&(t==="scroll"||t==="scrollend"),W=nt?ue!==null?ue+"Capture":null:ue;nt=[];for(var X=ce,le;X!==null;){var ye=X;if(le=ye.stateNode,ye=ye.tag,ye!==5&&ye!==26&&ye!==27||le===null||W===null||(ye=Mr(X,W),ye!=null&&nt.push(ol(X,ye,le))),Bt)break;X=X.return}0<nt.length&&(ue=new pe(ue,Pe,null,s,je),_e.push({event:ue,listeners:nt}))}}if((a&7)===0){e:{if(ue=t==="mouseover"||t==="pointerover",pe=t==="mouseout"||t==="pointerout",ue&&s!==Ji&&(Pe=s.relatedTarget||s.fromElement)&&(Ba(Pe)||Pe[va]))break e;if((pe||ue)&&(ue=je.window===je?je:(ue=je.ownerDocument)?ue.defaultView||ue.parentWindow:window,pe?(Pe=s.relatedTarget||s.toElement,pe=ce,Pe=Pe?Ba(Pe):null,Pe!==null&&(Bt=m(Pe),nt=Pe.tag,Pe!==Bt||nt!==5&&nt!==27&&nt!==6)&&(Pe=null)):(pe=null,Pe=ce),pe!==Pe)){if(nt=Qd,ye="onMouseLeave",W="onMouseEnter",X="mouse",(t==="pointerout"||t==="pointerover")&&(nt=Id,ye="onPointerLeave",W="onPointerEnter",X="pointer"),Bt=pe==null?ue:It(pe),le=Pe==null?ue:It(Pe),ue=new nt(ye,X+"leave",pe,s,je),ue.target=Bt,ue.relatedTarget=le,ye=null,Ba(je)===ce&&(nt=new nt(W,X+"enter",Pe,s,je),nt.target=le,nt.relatedTarget=Bt,ye=nt),Bt=ye,pe&&Pe)t:{for(nt=Kg,W=pe,X=Pe,le=0,ye=W;ye;ye=nt(ye))le++;ye=0;for(var We=X;We;We=nt(We))ye++;for(;0<le-ye;)W=nt(W),le--;for(;0<ye-le;)X=nt(X),ye--;for(;le--;){if(W===X||X!==null&&W===X.alternate){nt=W;break t}W=nt(W),X=nt(X)}nt=null}else nt=null;pe!==null&&Fh(_e,ue,pe,nt,!1),Pe!==null&&Bt!==null&&Fh(_e,Bt,Pe,nt,!0)}}e:{if(ue=ce?It(ce):window,pe=ue.nodeName&&ue.nodeName.toLowerCase(),pe==="select"||pe==="input"&&ue.type==="file")var zt=su;else if(tu(ue))if(nu)zt=dg;else{zt=cg;var Xe=ig}else pe=ue.nodeName,!pe||pe.toLowerCase()!=="input"||ue.type!=="checkbox"&&ue.type!=="radio"?ce&&Zi(ce.elementType)&&(zt=su):zt=og;if(zt&&(zt=zt(t,ce))){au(_e,zt,s,je);break e}Xe&&Xe(t,ue,ce),t==="focusout"&&ce&&ue.type==="number"&&ce.memoizedProps.value!=null&&Ii(ue,"number",ue.value)}switch(Xe=ce?It(ce):window,t){case"focusin":(tu(Xe)||Xe.contentEditable==="true")&&(In=Xe,dc=ce,Ur=null);break;case"focusout":Ur=dc=In=null;break;case"mousedown":uc=!0;break;case"contextmenu":case"mouseup":case"dragend":uc=!1,mu(_e,s,je);break;case"selectionchange":if(mg)break;case"keydown":case"keyup":mu(_e,s,je)}var ht;if(lc)e:{switch(t){case"compositionstart":var Nt="onCompositionStart";break e;case"compositionend":Nt="onCompositionEnd";break e;case"compositionupdate":Nt="onCompositionUpdate";break e}Nt=void 0}else Xn?Kd(t,s)&&(Nt="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(Nt="onCompositionStart");Nt&&(Zd&&s.locale!=="ko"&&(Xn||Nt!=="onCompositionStart"?Nt==="onCompositionEnd"&&Xn&&(ht=Pd()):($s=je,tc="value"in $s?$s.value:$s.textContent,Xn=!0)),Xe=vi(ce,Nt),0<Xe.length&&(Nt=new Xd(Nt,t,null,s,je),_e.push({event:Nt,listeners:Xe}),ht?Nt.data=ht:(ht=eu(s),ht!==null&&(Nt.data=ht)))),(ht=ag?sg(t,s):ng(t,s))&&(Nt=vi(ce,"onBeforeInput"),0<Nt.length&&(Xe=new Xd("onBeforeInput","beforeinput",null,s,je),_e.push({event:Xe,listeners:Nt}),Xe.data=ht)),Ig(_e,t,ce,s,je)}Uh(_e,a)})}function ol(t,a,s){return{instance:t,listener:a,currentTarget:s}}function vi(t,a){for(var s=a+"Capture",n=[];t!==null;){var o=t,d=o.stateNode;if(o=o.tag,o!==5&&o!==26&&o!==27||d===null||(o=Mr(t,s),o!=null&&n.unshift(ol(t,o,d)),o=Mr(t,a),o!=null&&n.push(ol(t,o,d))),t.tag===3)return n;t=t.return}return[]}function Kg(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Fh(t,a,s,n,o){for(var d=a._reactName,h=[];s!==null&&s!==n;){var _=s,F=_.alternate,ce=_.stateNode;if(_=_.tag,F!==null&&F===n)break;_!==5&&_!==26&&_!==27||ce===null||(F=ce,o?(ce=Mr(s,d),ce!=null&&h.unshift(ol(s,ce,F))):o||(ce=Mr(s,d),ce!=null&&h.push(ol(s,ce,F)))),s=s.return}h.length!==0&&t.push({event:a,listeners:h})}var ex=/\r\n?/g,tx=/\u0000|\uFFFD/g;function Bh(t){return(typeof t=="string"?t:""+t).replace(ex,`
`).replace(tx,"")}function $h(t,a){return a=Bh(a),Bh(t)===a}function Ft(t,a,s,n,o,d){switch(s){case"children":typeof n=="string"?a==="body"||a==="textarea"&&n===""||Pn(t,n):(typeof n=="number"||typeof n=="bigint")&&a!=="body"&&Pn(t,""+n);break;case"className":Ge(t,"class",n);break;case"tabIndex":Ge(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":Ge(t,s,n);break;case"style":$d(t,n,d);break;case"data":if(a!=="object"){Ge(t,"data",n);break}case"src":case"href":if(n===""&&(a!=="a"||s!=="href")){t.removeAttribute(s);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=wl(""+n),t.setAttribute(s,n);break;case"action":case"formAction":if(typeof n=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(s==="formAction"?(a!=="input"&&Ft(t,a,"name",o.name,o,null),Ft(t,a,"formEncType",o.formEncType,o,null),Ft(t,a,"formMethod",o.formMethod,o,null),Ft(t,a,"formTarget",o.formTarget,o,null)):(Ft(t,a,"encType",o.encType,o,null),Ft(t,a,"method",o.method,o,null),Ft(t,a,"target",o.target,o,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=wl(""+n),t.setAttribute(s,n);break;case"onClick":n!=null&&(t.onclick=ys);break;case"onScroll":n!=null&&yt("scroll",t);break;case"onScrollEnd":n!=null&&yt("scrollend",t);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(s=n.__html,s!=null){if(o.children!=null)throw Error(i(60));t.innerHTML=s}}break;case"multiple":t.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":t.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){t.removeAttribute("xlink:href");break}s=wl(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""+n):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":n===!0?t.setAttribute(s,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,n):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?t.setAttribute(s,n):t.removeAttribute(s);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?t.removeAttribute(s):t.setAttribute(s,n);break;case"popover":yt("beforetoggle",t),yt("toggle",t),re(t,"popover",n);break;case"xlinkActuate":Ue(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":Ue(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":Ue(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":Ue(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":Ue(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":Ue(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":Ue(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":Ue(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":Ue(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":re(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=Df.get(s)||s,re(t,s,n))}}function Lo(t,a,s,n,o,d){switch(s){case"style":$d(t,n,d);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(s=n.__html,s!=null){if(o.children!=null)throw Error(i(60));t.innerHTML=s}}break;case"children":typeof n=="string"?Pn(t,n):(typeof n=="number"||typeof n=="bigint")&&Pn(t,""+n);break;case"onScroll":n!=null&&yt("scroll",t);break;case"onScrollEnd":n!=null&&yt("scrollend",t);break;case"onClick":n!=null&&(t.onclick=ys);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ve.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(o=s.endsWith("Capture"),a=s.slice(2,o?s.length-7:void 0),d=t[mt]||null,d=d!=null?d[s]:null,typeof d=="function"&&t.removeEventListener(a,d,o),typeof n=="function")){typeof d!="function"&&d!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(a,n,o);break e}s in t?t[s]=n:n===!0?t.setAttribute(s,""):re(t,s,n)}}}function ka(t,a,s){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":yt("error",t),yt("load",t);var n=!1,o=!1,d;for(d in s)if(s.hasOwnProperty(d)){var h=s[d];if(h!=null)switch(d){case"src":n=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Ft(t,a,d,h,s,null)}}o&&Ft(t,a,"srcSet",s.srcSet,s,null),n&&Ft(t,a,"src",s.src,s,null);return;case"input":yt("invalid",t);var _=d=h=o=null,F=null,ce=null;for(n in s)if(s.hasOwnProperty(n)){var je=s[n];if(je!=null)switch(n){case"name":o=je;break;case"type":h=je;break;case"checked":F=je;break;case"defaultChecked":ce=je;break;case"value":d=je;break;case"defaultValue":_=je;break;case"children":case"dangerouslySetInnerHTML":if(je!=null)throw Error(i(137,a));break;default:Ft(t,a,n,je,s,null)}}Ud(t,d,_,F,ce,h,o,!1);return;case"select":yt("invalid",t),n=h=d=null;for(o in s)if(s.hasOwnProperty(o)&&(_=s[o],_!=null))switch(o){case"value":d=_;break;case"defaultValue":h=_;break;case"multiple":n=_;default:Ft(t,a,o,_,s,null)}a=d,s=h,t.multiple=!!n,a!=null?Gn(t,!!n,a,!1):s!=null&&Gn(t,!!n,s,!0);return;case"textarea":yt("invalid",t),d=o=n=null;for(h in s)if(s.hasOwnProperty(h)&&(_=s[h],_!=null))switch(h){case"value":n=_;break;case"defaultValue":o=_;break;case"children":d=_;break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(i(91));break;default:Ft(t,a,h,_,s,null)}Fd(t,n,o,d);return;case"option":for(F in s)if(s.hasOwnProperty(F)&&(n=s[F],n!=null))switch(F){case"selected":t.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:Ft(t,a,F,n,s,null)}return;case"dialog":yt("beforetoggle",t),yt("toggle",t),yt("cancel",t),yt("close",t);break;case"iframe":case"object":yt("load",t);break;case"video":case"audio":for(n=0;n<cl.length;n++)yt(cl[n],t);break;case"image":yt("error",t),yt("load",t);break;case"details":yt("toggle",t);break;case"embed":case"source":case"link":yt("error",t),yt("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ce in s)if(s.hasOwnProperty(ce)&&(n=s[ce],n!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Ft(t,a,ce,n,s,null)}return;default:if(Zi(a)){for(je in s)s.hasOwnProperty(je)&&(n=s[je],n!==void 0&&Lo(t,a,je,n,s,void 0));return}}for(_ in s)s.hasOwnProperty(_)&&(n=s[_],n!=null&&Ft(t,a,_,n,s,null))}function ax(t,a,s,n){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,d=null,h=null,_=null,F=null,ce=null,je=null;for(pe in s){var _e=s[pe];if(s.hasOwnProperty(pe)&&_e!=null)switch(pe){case"checked":break;case"value":break;case"defaultValue":F=_e;default:n.hasOwnProperty(pe)||Ft(t,a,pe,null,n,_e)}}for(var ue in n){var pe=n[ue];if(_e=s[ue],n.hasOwnProperty(ue)&&(pe!=null||_e!=null))switch(ue){case"type":d=pe;break;case"name":o=pe;break;case"checked":ce=pe;break;case"defaultChecked":je=pe;break;case"value":h=pe;break;case"defaultValue":_=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(i(137,a));break;default:pe!==_e&&Ft(t,a,ue,pe,n,_e)}}Xi(t,h,_,F,ce,je,d,o);return;case"select":pe=h=_=ue=null;for(d in s)if(F=s[d],s.hasOwnProperty(d)&&F!=null)switch(d){case"value":break;case"multiple":pe=F;default:n.hasOwnProperty(d)||Ft(t,a,d,null,n,F)}for(o in n)if(d=n[o],F=s[o],n.hasOwnProperty(o)&&(d!=null||F!=null))switch(o){case"value":ue=d;break;case"defaultValue":_=d;break;case"multiple":h=d;default:d!==F&&Ft(t,a,o,d,n,F)}a=_,s=h,n=pe,ue!=null?Gn(t,!!s,ue,!1):!!n!=!!s&&(a!=null?Gn(t,!!s,a,!0):Gn(t,!!s,s?[]:"",!1));return;case"textarea":pe=ue=null;for(_ in s)if(o=s[_],s.hasOwnProperty(_)&&o!=null&&!n.hasOwnProperty(_))switch(_){case"value":break;case"children":break;default:Ft(t,a,_,null,n,o)}for(h in n)if(o=n[h],d=s[h],n.hasOwnProperty(h)&&(o!=null||d!=null))switch(h){case"value":ue=o;break;case"defaultValue":pe=o;break;case"children":break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(i(91));break;default:o!==d&&Ft(t,a,h,o,n,d)}Hd(t,ue,pe);return;case"option":for(var Pe in s)if(ue=s[Pe],s.hasOwnProperty(Pe)&&ue!=null&&!n.hasOwnProperty(Pe))switch(Pe){case"selected":t.selected=!1;break;default:Ft(t,a,Pe,null,n,ue)}for(F in n)if(ue=n[F],pe=s[F],n.hasOwnProperty(F)&&ue!==pe&&(ue!=null||pe!=null))switch(F){case"selected":t.selected=ue&&typeof ue!="function"&&typeof ue!="symbol";break;default:Ft(t,a,F,ue,n,pe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var nt in s)ue=s[nt],s.hasOwnProperty(nt)&&ue!=null&&!n.hasOwnProperty(nt)&&Ft(t,a,nt,null,n,ue);for(ce in n)if(ue=n[ce],pe=s[ce],n.hasOwnProperty(ce)&&ue!==pe&&(ue!=null||pe!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":if(ue!=null)throw Error(i(137,a));break;default:Ft(t,a,ce,ue,n,pe)}return;default:if(Zi(a)){for(var Bt in s)ue=s[Bt],s.hasOwnProperty(Bt)&&ue!==void 0&&!n.hasOwnProperty(Bt)&&Lo(t,a,Bt,void 0,n,ue);for(je in n)ue=n[je],pe=s[je],!n.hasOwnProperty(je)||ue===pe||ue===void 0&&pe===void 0||Lo(t,a,je,ue,n,pe);return}}for(var W in s)ue=s[W],s.hasOwnProperty(W)&&ue!=null&&!n.hasOwnProperty(W)&&Ft(t,a,W,null,n,ue);for(_e in n)ue=n[_e],pe=s[_e],!n.hasOwnProperty(_e)||ue===pe||ue==null&&pe==null||Ft(t,a,_e,ue,n,pe)}function Vh(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function sx(){if(typeof performance.getEntriesByType=="function"){for(var t=0,a=0,s=performance.getEntriesByType("resource"),n=0;n<s.length;n++){var o=s[n],d=o.transferSize,h=o.initiatorType,_=o.duration;if(d&&_&&Vh(h)){for(h=0,_=o.responseEnd,n+=1;n<s.length;n++){var F=s[n],ce=F.startTime;if(ce>_)break;var je=F.transferSize,_e=F.initiatorType;je&&Vh(_e)&&(F=F.responseEnd,h+=je*(F<_?1:(_-ce)/(F-ce)))}if(--n,a+=8*(d+h)/(o.duration/1e3),t++,10<t)break}}if(0<t)return a/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var Uo=null,Ho=null;function yi(t){return t.nodeType===9?t:t.ownerDocument}function Gh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ph(t,a){if(t===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&a==="foreignObject"?0:t}function Fo(t,a){return t==="textarea"||t==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Bo=null;function nx(){var t=window.event;return t&&t.type==="popstate"?t===Bo?!1:(Bo=t,!0):(Bo=null,!1)}var Yh=typeof setTimeout=="function"?setTimeout:void 0,rx=typeof clearTimeout=="function"?clearTimeout:void 0,Qh=typeof Promise=="function"?Promise:void 0,lx=typeof queueMicrotask=="function"?queueMicrotask:typeof Qh<"u"?function(t){return Qh.resolve(null).then(t).catch(ix)}:Yh;function ix(t){setTimeout(function(){throw t})}function rn(t){return t==="head"}function Xh(t,a){var s=a,n=0;do{var o=s.nextSibling;if(t.removeChild(s),o&&o.nodeType===8)if(s=o.data,s==="/$"||s==="/&"){if(n===0){t.removeChild(o),_r(a);return}n--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")n++;else if(s==="html")dl(t.ownerDocument.documentElement);else if(s==="head"){s=t.ownerDocument.head,dl(s);for(var d=s.firstChild;d;){var h=d.nextSibling,_=d.nodeName;d[Xt]||_==="SCRIPT"||_==="STYLE"||_==="LINK"&&d.rel.toLowerCase()==="stylesheet"||s.removeChild(d),d=h}}else s==="body"&&dl(t.ownerDocument.body);s=o}while(s);_r(a)}function Ih(t,a){var s=t;t=0;do{var n=s.nextSibling;if(s.nodeType===1?a?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(a?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),n&&n.nodeType===8)if(s=n.data,s==="/$"){if(t===0)break;t--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||t++;s=n}while(s)}function $o(t){var a=t.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var s=a;switch(a=a.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":$o(s),ya(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function cx(t,a,s,n){for(;t.nodeType===1;){var o=s;if(t.nodeName.toLowerCase()!==a.toLowerCase()){if(!n&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(n){if(!t[Xt])switch(a){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(d=t.getAttribute("rel"),d==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(d!==o.rel||t.getAttribute("href")!==(o.href==null||o.href===""?null:o.href)||t.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin)||t.getAttribute("title")!==(o.title==null?null:o.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(d=t.getAttribute("src"),(d!==(o.src==null?null:o.src)||t.getAttribute("type")!==(o.type==null?null:o.type)||t.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin))&&d&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(a==="input"&&t.type==="hidden"){var d=o.name==null?null:""+o.name;if(o.type==="hidden"&&t.getAttribute("name")===d)return t}else return t;if(t=ls(t.nextSibling),t===null)break}return null}function ox(t,a,s){if(a==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=ls(t.nextSibling),t===null))return null;return t}function Zh(t,a){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!a||(t=ls(t.nextSibling),t===null))return null;return t}function Vo(t){return t.data==="$?"||t.data==="$~"}function Go(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function dx(t,a){var s=t.ownerDocument;if(t.data==="$~")t._reactRetry=a;else if(t.data!=="$?"||s.readyState!=="loading")a();else{var n=function(){a(),s.removeEventListener("DOMContentLoaded",n)};s.addEventListener("DOMContentLoaded",n),t._reactRetry=n}}function ls(t){for(;t!=null;t=t.nextSibling){var a=t.nodeType;if(a===1||a===3)break;if(a===8){if(a=t.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return t}var Po=null;function Jh(t){t=t.nextSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"||s==="/&"){if(a===0)return ls(t.nextSibling);a--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||a++}t=t.nextSibling}return null}function Wh(t){t=t.previousSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(a===0)return t;a--}else s!=="/$"&&s!=="/&"||a++}t=t.previousSibling}return null}function Kh(t,a,s){switch(a=yi(s),t){case"html":if(t=a.documentElement,!t)throw Error(i(452));return t;case"head":if(t=a.head,!t)throw Error(i(453));return t;case"body":if(t=a.body,!t)throw Error(i(454));return t;default:throw Error(i(451))}}function dl(t){for(var a=t.attributes;a.length;)t.removeAttributeNode(a[0]);ya(t)}var is=new Map,ep=new Set;function bi(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var qs=Z.d;Z.d={f:ux,r:mx,D:hx,C:px,L:fx,m:gx,X:jx,S:xx,M:vx};function ux(){var t=qs.f(),a=mi();return t||a}function mx(t){var a=ba(t);a!==null&&a.tag===5&&a.type==="form"?xm(a):qs.r(t)}var vr=typeof document>"u"?null:document;function tp(t,a,s){var n=vr;if(n&&typeof a=="string"&&a){var o=ea(a);o='link[rel="'+t+'"][href="'+o+'"]',typeof s=="string"&&(o+='[crossorigin="'+s+'"]'),ep.has(o)||(ep.add(o),t={rel:t,crossOrigin:s,href:a},n.querySelector(o)===null&&(a=n.createElement("link"),ka(a,"link",t),Tt(a),n.head.appendChild(a)))}}function hx(t){qs.D(t),tp("dns-prefetch",t,null)}function px(t,a){qs.C(t,a),tp("preconnect",t,a)}function fx(t,a,s){qs.L(t,a,s);var n=vr;if(n&&t&&a){var o='link[rel="preload"][as="'+ea(a)+'"]';a==="image"&&s&&s.imageSrcSet?(o+='[imagesrcset="'+ea(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(o+='[imagesizes="'+ea(s.imageSizes)+'"]')):o+='[href="'+ea(t)+'"]';var d=o;switch(a){case"style":d=yr(t);break;case"script":d=br(t)}is.has(d)||(t=R({rel:"preload",href:a==="image"&&s&&s.imageSrcSet?void 0:t,as:a},s),is.set(d,t),n.querySelector(o)!==null||a==="style"&&n.querySelector(ul(d))||a==="script"&&n.querySelector(ml(d))||(a=n.createElement("link"),ka(a,"link",t),Tt(a),n.head.appendChild(a)))}}function gx(t,a){qs.m(t,a);var s=vr;if(s&&t){var n=a&&typeof a.as=="string"?a.as:"script",o='link[rel="modulepreload"][as="'+ea(n)+'"][href="'+ea(t)+'"]',d=o;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=br(t)}if(!is.has(d)&&(t=R({rel:"modulepreload",href:t},a),is.set(d,t),s.querySelector(o)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(ml(d)))return}n=s.createElement("link"),ka(n,"link",t),Tt(n),s.head.appendChild(n)}}}function xx(t,a,s){qs.S(t,a,s);var n=vr;if(n&&t){var o=ga(n).hoistableStyles,d=yr(t);a=a||"default";var h=o.get(d);if(!h){var _={loading:0,preload:null};if(h=n.querySelector(ul(d)))_.loading=5;else{t=R({rel:"stylesheet",href:t,"data-precedence":a},s),(s=is.get(d))&&Yo(t,s);var F=h=n.createElement("link");Tt(F),ka(F,"link",t),F._p=new Promise(function(ce,je){F.onload=ce,F.onerror=je}),F.addEventListener("load",function(){_.loading|=1}),F.addEventListener("error",function(){_.loading|=2}),_.loading|=4,_i(h,a,n)}h={type:"stylesheet",instance:h,count:1,state:_},o.set(d,h)}}}function jx(t,a){qs.X(t,a);var s=vr;if(s&&t){var n=ga(s).hoistableScripts,o=br(t),d=n.get(o);d||(d=s.querySelector(ml(o)),d||(t=R({src:t,async:!0},a),(a=is.get(o))&&Qo(t,a),d=s.createElement("script"),Tt(d),ka(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(o,d))}}function vx(t,a){qs.M(t,a);var s=vr;if(s&&t){var n=ga(s).hoistableScripts,o=br(t),d=n.get(o);d||(d=s.querySelector(ml(o)),d||(t=R({src:t,async:!0,type:"module"},a),(a=is.get(o))&&Qo(t,a),d=s.createElement("script"),Tt(d),ka(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(o,d))}}function ap(t,a,s,n){var o=(o=Se.current)?bi(o):null;if(!o)throw Error(i(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(a=yr(s.href),s=ga(o).hoistableStyles,n=s.get(a),n||(n={type:"style",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=yr(s.href);var d=ga(o).hoistableStyles,h=d.get(t);if(h||(o=o.ownerDocument||o,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(t,h),(d=o.querySelector(ul(t)))&&!d._p&&(h.instance=d,h.state.loading=5),is.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},is.set(t,s),d||yx(o,t,s,h.state))),a&&n===null)throw Error(i(528,""));return h}if(a&&n!==null)throw Error(i(529,""));return null;case"script":return a=s.async,s=s.src,typeof s=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=br(s),s=ga(o).hoistableScripts,n=s.get(a),n||(n={type:"script",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,t))}}function yr(t){return'href="'+ea(t)+'"'}function ul(t){return'link[rel="stylesheet"]['+t+"]"}function sp(t){return R({},t,{"data-precedence":t.precedence,precedence:null})}function yx(t,a,s,n){t.querySelector('link[rel="preload"][as="style"]['+a+"]")?n.loading=1:(a=t.createElement("link"),n.preload=a,a.addEventListener("load",function(){return n.loading|=1}),a.addEventListener("error",function(){return n.loading|=2}),ka(a,"link",s),Tt(a),t.head.appendChild(a))}function br(t){return'[src="'+ea(t)+'"]'}function ml(t){return"script[async]"+t}function np(t,a,s){if(a.count++,a.instance===null)switch(a.type){case"style":var n=t.querySelector('style[data-href~="'+ea(s.href)+'"]');if(n)return a.instance=n,Tt(n),n;var o=R({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return n=(t.ownerDocument||t).createElement("style"),Tt(n),ka(n,"style",o),_i(n,s.precedence,t),a.instance=n;case"stylesheet":o=yr(s.href);var d=t.querySelector(ul(o));if(d)return a.state.loading|=4,a.instance=d,Tt(d),d;n=sp(s),(o=is.get(o))&&Yo(n,o),d=(t.ownerDocument||t).createElement("link"),Tt(d);var h=d;return h._p=new Promise(function(_,F){h.onload=_,h.onerror=F}),ka(d,"link",n),a.state.loading|=4,_i(d,s.precedence,t),a.instance=d;case"script":return d=br(s.src),(o=t.querySelector(ml(d)))?(a.instance=o,Tt(o),o):(n=s,(o=is.get(d))&&(n=R({},s),Qo(n,o)),t=t.ownerDocument||t,o=t.createElement("script"),Tt(o),ka(o,"link",n),t.head.appendChild(o),a.instance=o);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(n=a.instance,a.state.loading|=4,_i(n,s.precedence,t));return a.instance}function _i(t,a,s){for(var n=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=n.length?n[n.length-1]:null,d=o,h=0;h<n.length;h++){var _=n[h];if(_.dataset.precedence===a)d=_;else if(d!==o)break}d?d.parentNode.insertBefore(t,d.nextSibling):(a=s.nodeType===9?s.head:s,a.insertBefore(t,a.firstChild))}function Yo(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.title==null&&(t.title=a.title)}function Qo(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.integrity==null&&(t.integrity=a.integrity)}var Ni=null;function rp(t,a,s){if(Ni===null){var n=new Map,o=Ni=new Map;o.set(s,n)}else o=Ni,n=o.get(s),n||(n=new Map,o.set(s,n));if(n.has(t))return n;for(n.set(t,null),s=s.getElementsByTagName(t),o=0;o<s.length;o++){var d=s[o];if(!(d[Xt]||d[ct]||t==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var h=d.getAttribute(a)||"";h=t+h;var _=n.get(h);_?_.push(d):n.set(h,[d])}}return n}function lp(t,a,s){t=t.ownerDocument||t,t.head.insertBefore(s,a==="title"?t.querySelector("head > title"):null)}function bx(t,a,s){if(s===1||a.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return t=a.disabled,typeof a.precedence=="string"&&t==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function ip(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function _x(t,a,s,n){if(s.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var o=yr(n.href),d=a.querySelector(ul(o));if(d){a=d._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(t.count++,t=Si.bind(t),a.then(t,t)),s.state.loading|=4,s.instance=d,Tt(d);return}d=a.ownerDocument||a,n=sp(n),(o=is.get(o))&&Yo(n,o),d=d.createElement("link"),Tt(d);var h=d;h._p=new Promise(function(_,F){h.onload=_,h.onerror=F}),ka(d,"link",n),s.instance=d}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(s,a),(a=s.state.preload)&&(s.state.loading&3)===0&&(t.count++,s=Si.bind(t),a.addEventListener("load",s),a.addEventListener("error",s))}}var Xo=0;function Nx(t,a){return t.stylesheets&&t.count===0&&Ci(t,t.stylesheets),0<t.count||0<t.imgCount?function(s){var n=setTimeout(function(){if(t.stylesheets&&Ci(t,t.stylesheets),t.unsuspend){var d=t.unsuspend;t.unsuspend=null,d()}},6e4+a);0<t.imgBytes&&Xo===0&&(Xo=62500*sx());var o=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&Ci(t,t.stylesheets),t.unsuspend)){var d=t.unsuspend;t.unsuspend=null,d()}},(t.imgBytes>Xo?50:800)+a);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(n),clearTimeout(o)}}:null}function Si(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ci(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var wi=null;function Ci(t,a){t.stylesheets=null,t.unsuspend!==null&&(t.count++,wi=new Map,a.forEach(Sx,t),wi=null,Si.call(t))}function Sx(t,a){if(!(a.state.loading&4)){var s=wi.get(t);if(s)var n=s.get(null);else{s=new Map,wi.set(t,s);for(var o=t.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<o.length;d++){var h=o[d];(h.nodeName==="LINK"||h.getAttribute("media")!=="not all")&&(s.set(h.dataset.precedence,h),n=h)}n&&s.set(null,n)}o=a.instance,h=o.getAttribute("data-precedence"),d=s.get(h)||n,d===n&&s.set(null,o),s.set(h,o),this.count++,n=Si.bind(this),o.addEventListener("load",n),o.addEventListener("error",n),d?d.parentNode.insertBefore(o,d.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(o,t.firstChild)),a.state.loading|=4}}var hl={$$typeof:O,Provider:null,Consumer:null,_currentValue:M,_currentValue2:M,_threadCount:0};function wx(t,a,s,n,o,d,h,_,F){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=xt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xt(0),this.hiddenUpdates=xt(null),this.identifierPrefix=n,this.onUncaughtError=o,this.onCaughtError=d,this.onRecoverableError=h,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=F,this.incompleteTransitions=new Map}function cp(t,a,s,n,o,d,h,_,F,ce,je,_e){return t=new wx(t,a,s,h,F,ce,je,_e,_),a=1,d===!0&&(a|=24),d=Ga(3,null,null,a),t.current=d,d.stateNode=t,a=Cc(),a.refCount++,t.pooledCache=a,a.refCount++,d.memoizedState={element:n,isDehydrated:s,cache:a},Mc(d),t}function op(t){return t?(t=Wn,t):Wn}function dp(t,a,s,n,o,d){o=op(o),n.context===null?n.context=o:n.pendingContext=o,n=Xs(a),n.payload={element:s},d=d===void 0?null:d,d!==null&&(n.callback=d),s=Is(t,n,a),s!==null&&(Fa(s,t,a),Pr(s,t,a))}function up(t,a){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<a?s:a}}function Io(t,a){up(t,a),(t=t.alternate)&&up(t,a)}function mp(t){if(t.tag===13||t.tag===31){var a=Nn(t,67108864);a!==null&&Fa(a,t,67108864),Io(t,67108864)}}function hp(t){if(t.tag===13||t.tag===31){var a=Ia();a=fe(a);var s=Nn(t,a);s!==null&&Fa(s,t,a),Io(t,a)}}var ki=!0;function Cx(t,a,s,n){var o=w.T;w.T=null;var d=Z.p;try{Z.p=2,Zo(t,a,s,n)}finally{Z.p=d,w.T=o}}function kx(t,a,s,n){var o=w.T;w.T=null;var d=Z.p;try{Z.p=8,Zo(t,a,s,n)}finally{Z.p=d,w.T=o}}function Zo(t,a,s,n){if(ki){var o=Jo(n);if(o===null)qo(t,a,n,Ei,s),fp(t,n);else if(Dx(o,t,a,s,n))n.stopPropagation();else if(fp(t,n),a&4&&-1<Ex.indexOf(t)){for(;o!==null;){var d=ba(o);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var h=at(d.pendingLanes);if(h!==0){var _=d;for(_.pendingLanes|=2,_.entangledLanes|=2;h;){var F=1<<31-Ee(h);_.entanglements[1]|=F,h&=~F}js(d),(Rt&6)===0&&(di=et()+500,il(0))}}break;case 31:case 13:_=Nn(d,2),_!==null&&Fa(_,d,2),mi(),Io(d,2)}if(d=Jo(n),d===null&&qo(t,a,n,Ei,s),d===o)break;o=d}o!==null&&n.stopPropagation()}else qo(t,a,n,null,s)}}function Jo(t){return t=Wi(t),Wo(t)}var Ei=null;function Wo(t){if(Ei=null,t=Ba(t),t!==null){var a=m(t);if(a===null)t=null;else{var s=a.tag;if(s===13){if(t=x(a),t!==null)return t;t=null}else if(s===31){if(t=f(a),t!==null)return t;t=null}else if(s===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;t=null}else a!==t&&(t=null)}}return Ei=t,null}function pp(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Me()){case bt:return 2;case kt:return 8;case Mt:case Gt:return 32;case Et:return 268435456;default:return 32}default:return 32}}var Ko=!1,ln=null,cn=null,on=null,pl=new Map,fl=new Map,dn=[],Ex="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function fp(t,a){switch(t){case"focusin":case"focusout":ln=null;break;case"dragenter":case"dragleave":cn=null;break;case"mouseover":case"mouseout":on=null;break;case"pointerover":case"pointerout":pl.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":fl.delete(a.pointerId)}}function gl(t,a,s,n,o,d){return t===null||t.nativeEvent!==d?(t={blockedOn:a,domEventName:s,eventSystemFlags:n,nativeEvent:d,targetContainers:[o]},a!==null&&(a=ba(a),a!==null&&mp(a)),t):(t.eventSystemFlags|=n,a=t.targetContainers,o!==null&&a.indexOf(o)===-1&&a.push(o),t)}function Dx(t,a,s,n,o){switch(a){case"focusin":return ln=gl(ln,t,a,s,n,o),!0;case"dragenter":return cn=gl(cn,t,a,s,n,o),!0;case"mouseover":return on=gl(on,t,a,s,n,o),!0;case"pointerover":var d=o.pointerId;return pl.set(d,gl(pl.get(d)||null,t,a,s,n,o)),!0;case"gotpointercapture":return d=o.pointerId,fl.set(d,gl(fl.get(d)||null,t,a,s,n,o)),!0}return!1}function gp(t){var a=Ba(t.target);if(a!==null){var s=m(a);if(s!==null){if(a=s.tag,a===13){if(a=x(s),a!==null){t.blockedOn=a,it(t.priority,function(){hp(s)});return}}else if(a===31){if(a=f(s),a!==null){t.blockedOn=a,it(t.priority,function(){hp(s)});return}}else if(a===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Di(t){if(t.blockedOn!==null)return!1;for(var a=t.targetContainers;0<a.length;){var s=Jo(t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);Ji=n,s.target.dispatchEvent(n),Ji=null}else return a=ba(s),a!==null&&mp(a),t.blockedOn=s,!1;a.shift()}return!0}function xp(t,a,s){Di(t)&&s.delete(a)}function Mx(){Ko=!1,ln!==null&&Di(ln)&&(ln=null),cn!==null&&Di(cn)&&(cn=null),on!==null&&Di(on)&&(on=null),pl.forEach(xp),fl.forEach(xp)}function Mi(t,a){t.blockedOn===a&&(t.blockedOn=null,Ko||(Ko=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Mx)))}var Ti=null;function jp(t){Ti!==t&&(Ti=t,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Ti===t&&(Ti=null);for(var a=0;a<t.length;a+=3){var s=t[a],n=t[a+1],o=t[a+2];if(typeof n!="function"){if(Wo(n||s)===null)continue;break}var d=ba(s);d!==null&&(t.splice(a,3),a-=3,Zc(d,{pending:!0,data:o,method:s.method,action:n},n,o))}}))}function _r(t){function a(F){return Mi(F,t)}ln!==null&&Mi(ln,t),cn!==null&&Mi(cn,t),on!==null&&Mi(on,t),pl.forEach(a),fl.forEach(a);for(var s=0;s<dn.length;s++){var n=dn[s];n.blockedOn===t&&(n.blockedOn=null)}for(;0<dn.length&&(s=dn[0],s.blockedOn===null);)gp(s),s.blockedOn===null&&dn.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(n=0;n<s.length;n+=3){var o=s[n],d=s[n+1],h=o[mt]||null;if(typeof d=="function")h||jp(s);else if(h){var _=null;if(d&&d.hasAttribute("formAction")){if(o=d,h=d[mt]||null)_=h.formAction;else if(Wo(o)!==null)continue}else _=h.action;typeof _=="function"?s[n+1]=_:(s.splice(n,3),n-=3),jp(s)}}}function vp(){function t(d){d.canIntercept&&d.info==="react-transition"&&d.intercept({handler:function(){return new Promise(function(h){return o=h})},focusReset:"manual",scroll:"manual"})}function a(){o!==null&&(o(),o=null),n||setTimeout(s,20)}function s(){if(!n&&!navigation.transition){var d=navigation.currentEntry;d&&d.url!=null&&navigation.navigate(d.url,{state:d.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,o=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(s,100),function(){n=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),o!==null&&(o(),o=null)}}}function ed(t){this._internalRoot=t}Ai.prototype.render=ed.prototype.render=function(t){var a=this._internalRoot;if(a===null)throw Error(i(409));var s=a.current,n=Ia();dp(s,n,t,a,null,null)},Ai.prototype.unmount=ed.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var a=t.containerInfo;dp(t.current,2,null,t,null,null),mi(),a[va]=null}};function Ai(t){this._internalRoot=t}Ai.prototype.unstable_scheduleHydration=function(t){if(t){var a=jt();t={blockedOn:null,target:t,priority:a};for(var s=0;s<dn.length&&a!==0&&a<dn[s].priority;s++);dn.splice(s,0,t),s===0&&gp(t)}};var yp=l.version;if(yp!=="19.2.0")throw Error(i(527,yp,"19.2.0"));Z.findDOMNode=function(t){var a=t._reactInternals;if(a===void 0)throw typeof t.render=="function"?Error(i(188)):(t=Object.keys(t).join(","),Error(i(268,t)));return t=p(a),t=t!==null?j(t):null,t=t===null?null:t.stateNode,t};var Tx={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:w,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zi.isDisabled&&zi.supportsFiber)try{St=zi.inject(Tx),Je=zi}catch{}}return jl.createRoot=function(t,a){if(!u(t))throw Error(i(299));var s=!1,n="",o=km,d=Em,h=Dm;return a!=null&&(a.unstable_strictMode===!0&&(s=!0),a.identifierPrefix!==void 0&&(n=a.identifierPrefix),a.onUncaughtError!==void 0&&(o=a.onUncaughtError),a.onCaughtError!==void 0&&(d=a.onCaughtError),a.onRecoverableError!==void 0&&(h=a.onRecoverableError)),a=cp(t,1,!1,null,null,s,n,null,o,d,h,vp),t[va]=a.current,Ro(t),new ed(a)},jl.hydrateRoot=function(t,a,s){if(!u(t))throw Error(i(299));var n=!1,o="",d=km,h=Em,_=Dm,F=null;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(o=s.identifierPrefix),s.onUncaughtError!==void 0&&(d=s.onUncaughtError),s.onCaughtError!==void 0&&(h=s.onCaughtError),s.onRecoverableError!==void 0&&(_=s.onRecoverableError),s.formState!==void 0&&(F=s.formState)),a=cp(t,1,!0,a,s??null,n,o,F,d,h,_,vp),a.context=op(null),s=a.current,n=Ia(),n=fe(n),o=Xs(n),o.callback=null,Is(s,o,n),s=n,a.current.lanes=s,dt(a,s),js(a),t[va]=a.current,Ro(t),new Ai(a)},jl.version="19.2.0",jl}var Cp;function Vx(){if(Cp)return ad.exports;Cp=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(l){console.error(l)}}return r(),ad.exports=$x(),ad.exports}var Gx=Vx();const Px=tf(Gx),Yx="fieldsync-offline",Qx=1,ca={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let Bn=null;const Bs=()=>new Promise((r,l)=>{if(Bn){r(Bn);return}const c=indexedDB.open(Yx,Qx);c.onerror=()=>{console.error("Failed to open offline database"),l(c.error)},c.onsuccess=()=>{Bn=c.result,console.log("Offline database initialized"),r(Bn)},c.onupgradeneeded=i=>{const u=i.target.result;if(u.objectStoreNames.contains(ca.PROJECTS)||u.createObjectStore(ca.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),u.objectStoreNames.contains(ca.AREAS)||u.createObjectStore(ca.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),u.objectStoreNames.contains(ca.CREW_CHECKINS)||u.createObjectStore(ca.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!u.objectStoreNames.contains(ca.PENDING_ACTIONS)){const m=u.createObjectStore(ca.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});m.createIndex("type","type",{unique:!1}),m.createIndex("created_at","created_at",{unique:!1})}u.objectStoreNames.contains(ca.CACHED_DATA)||u.createObjectStore(ca.CACHED_DATA,{keyPath:"key"})}}),Vn=(r,l="readonly")=>{if(!Bn)throw new Error("Database not initialized");return Bn.transaction(r,l).objectStore(r)},Xx=async(r,l)=>(await Bs(),new Promise((c,i)=>{const m=Vn(r,"readwrite").put(l);m.onsuccess=()=>c(m.result),m.onerror=()=>i(m.error)})),af=async(r,l)=>(await Bs(),new Promise((c,i)=>{const u=Bn.transaction(r,"readwrite"),m=u.objectStore(r);l.forEach(x=>m.put(x)),u.oncomplete=()=>c(),u.onerror=()=>i(u.error)})),Ix=async(r,l)=>(await Bs(),new Promise((c,i)=>{const m=Vn(r).get(l);m.onsuccess=()=>c(m.result),m.onerror=()=>i(m.error)})),sf=async r=>(await Bs(),new Promise((l,c)=>{const u=Vn(r).getAll();u.onsuccess=()=>l(u.result||[]),u.onerror=()=>c(u.error)})),nf=async(r,l,c)=>(await Bs(),new Promise((i,u)=>{const f=Vn(r).index(l).getAll(c);f.onsuccess=()=>i(f.result||[]),f.onerror=()=>u(f.error)})),Zx=async(r,l)=>(await Bs(),new Promise((c,i)=>{const m=Vn(r,"readwrite").delete(l);m.onsuccess=()=>c(),m.onerror=()=>i(m.error)})),gn={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},kp=async(r,l,c={})=>{await Bs();const i={type:r,payload:l,metadata:c,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((u,m)=>{const f=Vn(ca.PENDING_ACTIONS,"readwrite").add(i);f.onsuccess=()=>{console.log(`Queued offline action: ${r}`),u(f.result)},f.onerror=()=>m(f.error)})},rf=async()=>sf(ca.PENDING_ACTIONS),rd=async()=>(await rf()).length,Jx=async r=>Zx(ca.PENDING_ACTIONS,r),Wx=async(r,l)=>(await Bs(),new Promise((c,i)=>{const u=Vn(ca.PENDING_ACTIONS,"readwrite"),m=u.get(r);m.onsuccess=()=>{const x=m.result;if(x){const f={...x,...l},b=u.put(f);b.onsuccess=()=>c(f),b.onerror=()=>i(b.error)}else i(new Error("Action not found"))},m.onerror=()=>i(m.error)})),Kx=async r=>af(ca.PROJECTS,r),Ep=async r=>r?nf(ca.PROJECTS,"company_id",r):sf(ca.PROJECTS),ej=async r=>af(ca.AREAS,r),Dp=async r=>nf(ca.AREAS,"project_id",r),ld=async(r,l)=>{const c=await Ix(ca.AREAS,r);return c&&(c.status=l,c.updated_at=new Date().toISOString(),await Xx(ca.AREAS,c)),c};let Td=navigator.onLine;const Nd=new Set,lf=r=>(Nd.add(r),()=>Nd.delete(r)),vl=()=>Td,Mp=r=>{Td=r,Nd.forEach(l=>l(r))};typeof window<"u"&&(window.addEventListener("online",()=>{console.log("Connection restored"),Mp(!0)}),window.addEventListener("offline",()=>{console.log("Connection lost"),Mp(!1)}));let id=!1;const tj=async r=>{if(id||!Td)return{synced:0,failed:0};id=!0;const l={synced:0,failed:0};try{const c=await rf();console.log(`Syncing ${c.length} pending actions...`);for(const i of c)try{await aj(i,r),await Jx(i.id),l.synced++,console.log(`Synced action: ${i.type}`)}catch(u){console.error(`Failed to sync action ${i.type}:`,u),l.failed++,await Wx(i.id,{attempts:(i.attempts||0)+1,last_error:u.message,last_attempt:new Date().toISOString()})}}finally{id=!1}return l},aj=async(r,l)=>{const{type:c,payload:i}=r;switch(c){case gn.UPDATE_AREA_STATUS:return l.updateAreaStatus(i.areaId,i.status);case gn.CREATE_TM_TICKET:const u=await l.createTMTicket(i.ticket);return i.workers?.length>0&&await l.addTMWorkers(u.id,i.workers),i.items?.length>0&&await l.addTMItems(u.id,i.items),u;case gn.SAVE_CREW_CHECKIN:return l.saveCrewCheckin(i.projectId,i.workers,i.checkInDate);case gn.SUBMIT_DAILY_REPORT:return await l.saveDailyReport(i.projectId,i.reportData),l.submitDailyReport(i.projectId,i.submittedBy);case gn.SEND_MESSAGE:return l.sendMessage(i.projectId,i.senderType,i.senderName,i.content);case gn.CREATE_MATERIAL_REQUEST:return l.createMaterialRequest(i.projectId,i.items,i.requestedBy,i.neededBy,i.priority,i.notes);default:throw new Error(`Unknown action type: ${c}`)}},sj={slowQueryThreshold:200},Wt={query(r,l){const c={type:"query",operation:r,duration_ms:l.duration,rows_returned:l.rows,company_id:l.company_id||null,project_id:l.project_id||null,user_id:l.user_id||null,timestamp:new Date().toISOString()};l.duration>=sj.slowQueryThreshold&&cd("query",c)},error(r,l){const c={type:"error",category:r,severity:l.severity||"error",error_code:l.code||null,message:l.message,company_id:l.company_id||null,user_id:l.user_id||null,project_id:l.project_id||null,operation:l.operation||null,context:l.extra||{},timestamp:new Date().toISOString()};cd("error",c)},storage(r,l){const c={type:"storage",operation:r,company_id:l.company_id||null,project_id:l.project_id||null,file_size_bytes:l.size||0,duration_ms:l.duration||0,success:l.success!==!1,error_message:l.error||null,timestamp:new Date().toISOString()};(!c.success||c.duration_ms>5e3)&&cd("storage",c)},activity(r,l){}};async function cd(r,l){try{r==="error"?await k.rpc("log_error",{p_severity:l.severity,p_category:l.category,p_message:l.message,p_company_id:l.company_id,p_user_id:l.user_id,p_project_id:l.project_id,p_operation:l.operation,p_error_code:l.error_code,p_context:l.context||{}}):r==="query"&&await k.rpc("log_query_metric",{p_operation:l.operation,p_duration_ms:l.duration_ms,p_rows_returned:l.rows_returned,p_company_id:l.company_id,p_project_id:l.project_id,p_user_id:l.user_id,p_context:{}})}catch{}}Wt.wrapQuery=function(r,l){return async function(...c){const i=performance.now();try{const u=await l.apply(this,c),x={duration:Math.round(performance.now()-i),rows:Array.isArray(u)?u.length:void 0};return Wt.query(r,x),u}catch(u){const m=Math.round(performance.now()-i);throw Wt.error("database",{message:u.message,operation:r,severity:"error",extra:{duration:m}}),u}}};Wt.time=async function(r,l){const c=performance.now();try{const i=await l(),u=Math.round(performance.now()-c);return Wt.query(r,{duration:u}),i}catch(i){throw Wt.error("general",{message:i.message,operation:r}),i}};const nj="https://cegifnrcwdilromcyouq.supabase.co",cf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlZ2lmbnJjd2RpbHJvbWN5b3VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTQ5OTAsImV4cCI6MjA4MDIzMDk5MH0.qAiBG5XaB0C1E0U2tQbQkrhpm1iUhM6A2MXngEHhX4A",$=!!cf;Bs().catch(r=>console.error("Failed to init offline DB:",r));const k=$?Ox(nj,cf):null,of="fieldsync_data",Sd="fieldsync_user",Ie=()=>{const r=localStorage.getItem(of);return r?JSON.parse(r):{projects:[],areas:[],users:[],assignments:[]}},Ct=r=>{localStorage.setItem(of,JSON.stringify(r))},Oi=()=>{const r=localStorage.getItem(Sd);return r?JSON.parse(r):null},Ri=r=>{r?localStorage.setItem(Sd,JSON.stringify(r)):localStorage.removeItem(Sd)},Tp={async signUp(r,l,c,i){if($){const{data:u,error:m}=await k.auth.signUp({email:r,password:l,options:{data:{name:c,role:i}}});if(m)throw m;return u}else{const u=Ie(),m={id:crypto.randomUUID(),email:r,name:c,role:i,created_at:new Date().toISOString()};return u.users.push(m),Ct(u),Ri(m),{user:m}}},async signIn(r,l){if($){const{data:c,error:i}=await k.auth.signInWithPassword({email:r,password:l});if(i)throw i;return c}else{const i=Ie().users.find(u=>u.email===r);if(!i)throw new Error("User not found");return Ri(i),{user:i}}},async signOut(){if($){const{error:r}=await k.auth.signOut();if(r)throw r}else Ri(null)},async getUser(){if($){const{data:{user:r}}=await k.auth.getUser();return r}else return Oi()},async getProfile(){if($){const{data:{user:r}}=await k.auth.getUser();if(!r)return null;const{data:l,error:c}=await k.from("users").select("*").eq("id",r.id).single();return c?{id:r.id,email:r.email,name:r.user_metadata?.name||"",role:r.user_metadata?.role||"foreman"}:l}else return Oi()},async updateRole(r,l){if($){const{data:c,error:i}=await k.from("users").update({role:l}).eq("id",r).select().single();if(i)throw i;return c}else{const c=Ie(),i=c.users.find(u=>u.id===r);return i&&(i.role=l,Ct(c),Oi()?.id===r&&Ri(i)),i}},onAuthStateChange(r){if($)return k.auth.onAuthStateChange(r);{const l=Oi();return r(l?"SIGNED_IN":"SIGNED_OUT",{user:l}),{data:{subscription:{unsubscribe:()=>{}}}}}}},K={async getProjects(r=null,l=!1){if($){if(!vl()){console.log("Offline: returning cached projects");const i=await Ep(r);return l?i:i.filter(u=>u.status!=="archived")}const c=performance.now();try{let i=k.from("projects").select("*").order("created_at",{ascending:!1});r&&(i=i.eq("company_id",r)),l||(i=i.eq("status","active"));const{data:u,error:m}=await i,x=Math.round(performance.now()-c);if(Wt.query("getProjects",{duration:x,rows:u?.length,company_id:r}),m){Wt.error("database",{message:m.message,operation:"getProjects",company_id:r}),console.log("Error fetching projects, trying cache:",m.message);const f=await Ep(r);if(f.length>0)return f;throw m}return u?.length>0&&Kx(u).catch(f=>console.error("Failed to cache projects:",f)),u}catch(i){throw Wt.error("database",{message:i.message,operation:"getProjects",company_id:r}),i}}else{const c=Ie().projects;return l?c:c.filter(i=>i.status!=="archived")}},async getArchivedProjects(r){if($){const{data:l,error:c}=await k.from("projects").select("*").eq("company_id",r).eq("status","archived").order("archived_at",{ascending:!1});if(c)throw c;return l}else return Ie().projects.filter(l=>l.status==="archived")},async getProjectCount(r){if($){const{count:l,error:c}=await k.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",r).in("status",["active","archived"]);if(c)throw c;return l||0}else return Ie().projects.filter(c=>c.company_id===r&&c.status!=="deleted").length},async archiveProject(r){if($){const{data:l,error:c}=await k.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw c;return l}else{const l=Ie(),c=l.projects.find(i=>i.id===r);return c&&(c.status="archived",c.archived_at=new Date().toISOString(),Ct(l)),c}},async getProjectStorageStats(r){if(!$)return{photoCount:0,estimatedMB:0};const{data:l,error:c}=await k.from("t_and_m_tickets").select("photos").eq("project_id",r);if(c)throw c;let i=0;const u=[];l?.forEach(x=>{x.photos&&Array.isArray(x.photos)&&(i+=x.photos.length,u.push(...x.photos))});const m=i*1.5;return{photoCount:i,estimatedMB:m,photoUrls:u}},async archiveProjectDeep(r,l){if(!$)return null;const{photoUrls:c}=await this.getProjectStorageStats(r);if(c.length>0){const m=c.map(x=>{try{const b=new URL(x).pathname.match(/\/tm-photos\/(.+)$/);return b?b[1]:null}catch{return null}}).filter(Boolean);if(m.length>0)for(let x=0;x<m.length;x+=100){const f=m.slice(x,x+100);await k.storage.from("tm-photos").remove(f)}}await k.from("t_and_m_tickets").update({photos:[]}).eq("project_id",r);const{data:i,error:u}=await k.from("projects").update({status:"archived",archived_at:new Date().toISOString(),photos:[],storage_cleaned:!0}).eq("id",r).select().single();if(u)throw u;return{...i,photosDeleted:c.length}},async restoreProject(r){if($){const{data:l,error:c}=await k.from("projects").update({status:"active",archived_at:null}).eq("id",r).select().single();if(c)throw c;return l}else{const l=Ie(),c=l.projects.find(i=>i.id===r);return c&&(c.status="active",c.archived_at=null,Ct(l)),c}},async getProject(r){if($){const{data:l,error:c}=await k.from("projects").select("*").eq("id",r).single();if(c)throw c;return l}else return Ie().projects.find(l=>l.id===r)},async createProject(r){if($){console.log("Creating project with data:",r);const{data:l,error:c}=await k.from("projects").insert({...r,status:"active"}).select().single();if(c)throw console.error("Supabase createProject error:",c.message,c.details,c.hint),c;return l}else{const l=Ie(),c={...r,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return l.projects.push(c),Ct(l),c}},async getProjectByPin(r){if($){const{data:l,error:c}=await k.from("projects").select("*").eq("pin",r).eq("status","active").single();return c?null:l}else return Ie().projects.find(c=>c.pin===r&&c.status==="active")||null},async getProjectByPinAndCompany(r,l){if($){const{data:c,error:i}=await k.from("projects").select("*").eq("pin",r).eq("company_id",l).eq("status","active").single();return i?null:c}else return Ie().projects.find(i=>i.pin===r&&i.company_id===l&&i.status==="active")||null},async isPinAvailable(r,l=null){if($){let c=k.from("projects").select("id").eq("pin",r);l&&(c=c.neq("id",l));const{data:i,error:u}=await c;if(u)throw u;return i.length===0}else return!Ie().projects.some(i=>i.pin===r&&i.id!==l)},async updateProjectPin(r,l){if($){const{data:c,error:i}=await k.from("projects").update({pin:l}).eq("id",r).select().single();if(i)throw i;return c}else{const c=Ie(),i=c.projects.find(u=>u.id===r);return i&&(i.pin=l,Ct(c)),i}},async updateProject(r,l){if($){const{data:c,error:i}=await k.from("projects").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating project:",i),i;return c}else{const c=Ie(),i=c.projects.find(u=>u.id===r);return i&&(Object.assign(i,l),Ct(c)),i}},async deleteProject(r){if($){const{error:l}=await k.from("projects").delete().eq("id",r);if(l)throw l}else{const l=Ie();l.projects=l.projects.filter(c=>c.id!==r),l.areas=l.areas.filter(c=>c.project_id!==r),Ct(l)}},async getAreas(r){if($){if(!vl())return console.log("Offline: returning cached areas"),Dp(r);const{data:l,error:c}=await k.from("areas").select("*").eq("project_id",r).order("sort_order",{ascending:!0});if(c){console.log("Error fetching areas, trying cache:",c.message);const i=await Dp(r);if(i.length>0)return i;throw c}return l?.length>0&&ej(l).catch(i=>console.error("Failed to cache areas:",i)),l}else return Ie().areas.filter(l=>l.project_id===r)},async createArea(r){if($){const{data:l,error:c}=await k.from("areas").insert(r).select().single();if(c)throw c;return l}else{const l=Ie(),c={...r,id:crypto.randomUUID(),created_at:new Date().toISOString()};return l.areas.push(c),Ct(l),c}},async updateAreaStatus(r,l){if($){if(!vl()){console.log("Offline: queuing area status update");const u=await ld(r,l);return await kp(gn.UPDATE_AREA_STATUS,{areaId:r,status:l}),u}const{data:c,error:i}=await k.from("areas").update({status:l}).eq("id",r).select().single();if(i){if(i.message?.includes("fetch")||i.message?.includes("network")){console.log("Network error: queuing area status update");const u=await ld(r,l);return await kp(gn.UPDATE_AREA_STATUS,{areaId:r,status:l}),u}throw i}return c&&ld(r,l).catch(u=>console.error("Failed to update cached area:",u)),c}else{const c=Ie(),i=c.areas.find(u=>u.id===r);return i&&(i.status=l,i.updated_at=new Date().toISOString()),Ct(c),i}},async updateArea(r,l){if($){const{data:c,error:i}=await k.from("areas").update(l).eq("id",r).select().single();if(i)throw i;return c}else{const c=Ie(),i=c.areas.find(u=>u.id===r);return i&&(Object.assign(i,l),i.updated_at=new Date().toISOString()),Ct(c),i}},async deleteArea(r){if($){const{error:l}=await k.from("areas").delete().eq("id",r);if(l)throw l}else{const l=Ie();l.areas=l.areas.filter(c=>c.id!==r),Ct(l)}},subscribeToAreas(r,l){return $?k.channel(`areas:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMessages(r,l){return $?k.channel(`messages:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMaterialRequests(r,l){return $?k.channel(`material_requests:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToDailyReports(r,l){return $?k.channel(`daily_reports:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCrewCheckins(r,l){return $?k.channel(`crew_checkins:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToInjuryReports(r,l){return $?k.channel(`injury_reports:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},l).subscribe():null},subscribeToTMTickets(r,l){return $?k.channel(`tm_tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCompanyActivity(r,l,c){if(!$||!l||l.length===0)return null;const i=k.channel(`company_activity:${r}`);return l.forEach(u=>{i.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${u}`},m=>c.onMessage?.(m)),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"material_requests",filter:`project_id=eq.${u}`},m=>c.onMaterialRequest?.(m)),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${u}`},m=>c.onTMTicket?.(m))}),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},u=>c.onInjuryReport?.(u)),i.subscribe()},unsubscribe(r){r&&$&&k.removeChannel(r)},async getAssignedProjects(r){if($){const{data:l,error:c}=await k.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",r);if(c)throw c;return l.map(i=>i.projects)}else{const l=Ie();return(l.assignments?.filter(i=>i.user_id===r)||[]).map(i=>l.projects.find(u=>u.id===i.project_id)).filter(Boolean)}},async assignUserToProject(r,l,c){if($){const{data:i,error:u}=await k.from("project_assignments").insert({project_id:r,user_id:l,assigned_by:c}).select().single();if(u)throw u;return i}else{const i=Ie();i.assignments||(i.assignments=[]);const u={id:crypto.randomUUID(),project_id:r,user_id:l,assigned_by:c,assigned_at:new Date().toISOString()};return i.assignments.push(u),Ct(i),u}},async removeUserFromProject(r,l){if($){const{error:c}=await k.from("project_assignments").delete().eq("project_id",r).eq("user_id",l);if(c)throw c}else{const c=Ie();c.assignments=c.assignments?.filter(i=>!(i.project_id===r&&i.user_id===l))||[],Ct(c)}},async getProjectAssignments(r){if($){const{data:l,error:c}=await k.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",r);if(c)throw c;return l.map(i=>i.users)}else{const l=Ie();return(l.assignments?.filter(i=>i.project_id===r)||[]).map(i=>l.users.find(u=>u.id===i.user_id)).filter(Boolean)}},async getAllUsers(){if($){const{data:r,error:l}=await k.from("users").select("*").order("name");if(l)throw l;return r}else return Ie().users||[]},async getForemen(){if($){const{data:r,error:l}=await k.from("users").select("*").eq("role","foreman").order("name");if(l)throw l;return r}else return(Ie().users||[]).filter(r=>r.role==="foreman")},async logActivity(r,l,c,i,u,m){if($){const{error:x}=await k.from("activity_log").insert({user_id:r,project_id:l,area_id:c,action:i,old_value:u,new_value:m});x&&console.error("Error logging activity:",x)}},async getProjectActivity(r,l=50){if($){const{data:c,error:i}=await k.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",r).order("created_at",{ascending:!1}).limit(l);if(i)throw i;return c}return[]},async getMaterialsEquipment(r){if($){const{data:l,error:c}=await k.from("materials_equipment").select("*").eq("company_id",r).eq("active",!0).order("category").order("name");if(c)throw c;return l}return[]},async getMaterialsEquipmentByCategory(r,l){if($){const{data:c,error:i}=await k.from("materials_equipment").select("*").eq("company_id",r).eq("category",l).eq("active",!0).order("name");if(i)throw i;return c}return[]},async getAllMaterialsEquipment(r){if($){const{data:l,error:c}=await k.from("materials_equipment").select("*").eq("company_id",r).order("category").order("name");if(c)throw c;return l}return[]},async createMaterialEquipment(r){if($){const{data:l,error:c}=await k.from("materials_equipment").insert(r).select().single();if(c)throw c;return l}return null},async updateMaterialEquipment(r,l){if($){const{data:c,error:i}=await k.from("materials_equipment").update(l).eq("id",r).select().single();if(i)throw i;return c}return null},async deleteMaterialEquipment(r){if($){const{error:l}=await k.from("materials_equipment").update({active:!1}).eq("id",r);if(l)throw l}},async getTMTickets(r){if($){const l=performance.now();try{const{data:c,error:i}=await k.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          `).eq("project_id",r).order("created_at",{ascending:!1}),u=Math.round(performance.now()-l);if(Wt.query("getTMTickets",{duration:u,rows:c?.length,project_id:r}),i)throw i;return c}catch(c){throw Wt.error("database",{message:c.message,operation:"getTMTickets",project_id:r}),c}}return[]},async getChangeOrderTotals(r){if($){const{data:l,error:c}=await k.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",r).not("ce_pco_number","is",null).neq("ce_pco_number","");if(c)throw c;const i={};let u=0,m=0;return l?.forEach(x=>{const f=x.ce_pco_number;if(i[f]||(i[f]={approved:0,pending:0,count:0}),i[f].count++,x.status==="approved"||x.status==="billed"){const b=parseFloat(x.change_order_value)||0;i[f].approved+=b,u+=b}else x.status==="pending"&&m++}),{changeOrders:i,totalApprovedValue:u,pendingCount:m}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(r,l){if($){const{data:c,error:i}=await k.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).eq("status",l).order("created_at",{ascending:!1});if(i)throw i;return c}return[]},async getCORTickets(r){if($){const{data:l,error:c}=await k.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",r).order("work_date",{ascending:!0});if(c)throw c;return l||[]}return[]},async createTMTicket(r){if($){const{data:l,error:c}=await k.from("t_and_m_tickets").insert({project_id:r.project_id,work_date:r.work_date,ce_pco_number:r.ce_pco_number||null,assigned_cor_id:r.assigned_cor_id||null,notes:r.notes,photos:r.photos||[],status:"pending",created_by_name:r.created_by_name||"Field User"}).select().single();if(c)throw c;return l}return null},async addTMWorkers(r,l){if($){const c=l.map(u=>({ticket_id:r,name:u.name,hours:u.hours,overtime_hours:u.overtime_hours||0,time_started:u.time_started||null,time_ended:u.time_ended||null,role:u.role||"Laborer"})),{error:i}=await k.from("t_and_m_workers").insert(c);if(i)throw i}},async addTMItems(r,l){if($){const c=l.map(u=>({ticket_id:r,material_equipment_id:u.material_equipment_id||null,custom_name:u.custom_name||null,custom_category:u.custom_category||null,quantity:u.quantity})),{error:i}=await k.from("t_and_m_items").insert(c);if(i)throw i}},async getPreviousTicketCrew(r,l){if(!$)return null;const{data:c,error:i}=await k.from("t_and_m_tickets").select(`
        id,
        work_date,
        t_and_m_workers (*)
      `).eq("project_id",r).lt("work_date",l).order("work_date",{ascending:!1}).limit(1).single();if(i||!c)return null;const u=c.t_and_m_workers||[],m=u.filter(b=>["Foreman","General Foreman","Superintendent"].includes(b.role)).map(b=>({name:b.name,hours:b.hours?.toString()||"",overtimeHours:b.overtime_hours?.toString()||"",timeStarted:b.time_started||"",timeEnded:b.time_ended||"",role:b.role})),x=u.filter(b=>b.role==="Operator").map(b=>({name:b.name,hours:b.hours?.toString()||"",overtimeHours:b.overtime_hours?.toString()||"",timeStarted:b.time_started||"",timeEnded:b.time_ended||""})),f=u.filter(b=>b.role==="Laborer").map(b=>({name:b.name,hours:b.hours?.toString()||"",overtimeHours:b.overtime_hours?.toString()||"",timeStarted:b.time_started||"",timeEnded:b.time_ended||""}));return{workDate:c.work_date,supervision:m.length>0?m:null,operators:x.length>0?x:null,laborers:f.length>0?f:null,totalWorkers:u.length}},async updateTMTicketStatus(r,l){if($){const{data:c,error:i}=await k.from("t_and_m_tickets").update({status:l}).eq("id",r).select().single();if(i)throw i;return c}return null},async approveTMTicket(r,l,c,i=null){if($){const u={status:"approved",approved_by_user_id:l,approved_by_name:c,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};i!==null&&(u.change_order_value=parseFloat(i)||0);const{data:m,error:x}=await k.from("t_and_m_tickets").update(u).eq("id",r).select().single();if(x)throw x;return m}return null},async rejectTMTicket(r,l,c,i=""){if($){const{data:u,error:m}=await k.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:l,rejected_by_name:c,rejected_at:new Date().toISOString(),rejection_reason:i,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",r).select().single();if(m)throw m;return u}return null},canApproveTickets(r){return["owner","admin","manager"].includes(r)},async updateTMTicketPhotos(r,l){if($){const{data:c,error:i}=await k.from("t_and_m_tickets").update({photos:l}).eq("id",r).select().single();if(i)throw i;return c}return null},async saveTMClientSignature(r,l){if($){const{data:c,error:i}=await k.from("t_and_m_tickets").update({client_signature_data:l.signature,client_signature_name:l.signerName,client_signature_title:l.signerTitle,client_signature_company:l.signerCompany,client_signature_date:l.signedAt,client_signature_ip:null,status:"client_signed"}).eq("id",r).select().single();if(i)throw i;return c}return null},async deleteTMTicket(r){if($){const{error:l}=await k.from("t_and_m_tickets").delete().eq("id",r);if(l)throw l}},async isTicketEditable(r){if(!r?.assigned_cor_id)return{editable:!0};if($)try{const{data:l,error:c}=await k.from("change_orders").select("id, status, cor_number").eq("id",r.assigned_cor_id).single();if(c||!l)return{editable:!0};const u=["draft","pending_approval"].includes(l.status);return{editable:u,lockedBy:u?null:l,reason:u?null:`This ticket is linked to ${l.cor_number} which has been ${l.status==="approved"?"approved":l.status}`}}catch(l){return console.error("Error checking ticket editability:",l),{editable:!0}}return{editable:!0}},async getCompanyByCode(r){if($){const{data:l,error:c}=await k.from("companies").select("*").eq("code",r).single();return c?null:l}return null},async getCompany(r){if($){const{data:l,error:c}=await k.from("companies").select("*").eq("id",r).single();if(c)throw c;return l}return null},async getUserCompanies(r){if($){const{data:l,error:c}=await k.from("user_companies").select(`
          id,
          access_level,
          company_id,
          status,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",r).eq("status","active").order("created_at",{ascending:!0});return c?(console.error("Error fetching user companies:",c),[]):l.map(i=>({id:i.companies.id,name:i.companies.name,code:i.companies.code,access_level:i.access_level}))}return[]},async getUserPendingMemberships(r){if($){const{count:l,error:c}=await k.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r).eq("status","pending");return c?(console.error("Error fetching pending memberships:",c),0):l||0}return 0},async getCompanyMemberships(r){if($){const{data:l,error:c}=await k.from("user_companies").select(`
          id,
          access_level,
          company_role,
          status,
          created_at,
          approved_at,
          approved_by,
          removed_at,
          removed_by,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).order("created_at",{ascending:!1});return c?(console.error("Error fetching company memberships:",c),[]):l||[]}return[]},async approveMembership(r,l){if($){const{error:c}=await k.from("user_companies").update({status:"active",approved_at:new Date().toISOString(),approved_by:l}).eq("id",r);if(c)throw c}},async approveMembershipWithRole(r,l,c="member"){if($){const{error:i}=await k.rpc("approve_membership_with_role",{membership_id:r,approved_by_user:l,new_access_level:c});if(i)throw i}},async rejectMembership(r){if($){const{error:l}=await k.from("user_companies").delete().eq("id",r);if(l)throw l}},async removeMember(r,l){if($){const{error:c}=await k.from("user_companies").update({status:"removed",removed_at:new Date().toISOString(),removed_by:l}).eq("id",r);if(c)throw c}},async getProjectTeam(r){if($){const{data:l,error:c}=await k.from("project_users").select(`
          id,
          project_role,
          assigned_at,
          notes,
          users!project_users_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("project_id",r).order("assigned_at",{ascending:!0});return c?(console.error("Error fetching project team:",c),[]):l||[]}return[]},async getCompanyMembers(r){if($){const{data:l,error:c}=await k.from("user_companies").select(`
          id,
          access_level,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).eq("status","active").order("created_at",{ascending:!0});return c?(console.error("Error fetching company members:",c),[]):l||[]}return[]},async addProjectMember(r,l,c,i){if($){const{data:u,error:m}=await k.from("project_users").insert({project_id:r,user_id:l,project_role:c,assigned_by:i}).select().single();if(m)throw m;return u}return null},async updateProjectMemberRole(r,l,c){if($){const{error:i}=await k.from("project_users").update({project_role:c}).eq("project_id",r).eq("user_id",l);if(i)throw i}},async removeProjectMember(r,l){if($){const{error:c}=await k.from("project_users").delete().eq("project_id",r).eq("user_id",l);if(c)throw c}},async updateMemberAccessLevel(r,l){if($){const{error:c}=await k.from("user_companies").update({access_level:l}).eq("id",r);if(c)throw c}},async updateMemberCompanyRole(r,l){if($){const{error:c}=await k.from("user_companies").update({company_role:l}).eq("id",r);if(c)throw c}},async repairLegacyUser(r,l,c="member"){if(!$||!r||!l)return!1;try{const{data:i,error:u}=await k.rpc("repair_legacy_user",{p_user_id:r,p_company_id:l,p_role:c});return u?(console.error("RPC repair_legacy_user failed:",u),!1):(console.log("Legacy user repaired via RPC:",i),i===!0)}catch(i){return console.error("Error repairing legacy user:",i),!1}},async isLegacyUser(r){if(!$)return!1;try{const{data:l}=await k.from("users").select("company_id, role").eq("id",r).single();if(!l?.company_id)return!1;const{count:c}=await k.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r);return c===0}catch(l){return console.error("Error checking legacy user:",l),!1}},DISPOSAL_LOAD_TYPES:[{value:"concrete",label:"Concrete"},{value:"trash",label:"Trash"},{value:"metals",label:"Metals"},{value:"hazardous_waste",label:"Hazardous Waste"}],async getDisposalLoads(r,l){if(!$)return[];const c=performance.now();try{const{data:i,error:u}=await k.from("disposal_loads").select("*").eq("project_id",r).eq("work_date",l).order("created_at",{ascending:!1}),m=Math.round(performance.now()-c);if(Wt.query("getDisposalLoads",{duration:m,rows:i?.length,project_id:r}),u)throw u;return i||[]}catch(i){throw Wt.error("database",{message:i.message,operation:"getDisposalLoads",project_id:r}),i}},async addDisposalLoad(r,l,c,i,u,m=null){if(!$)return null;const{data:x,error:f}=await k.from("disposal_loads").insert({project_id:r,user_id:l,work_date:c,load_type:i,load_count:u,notes:m}).select().single();if(f)throw Wt.error("database",{message:f.message,operation:"addDisposalLoad",project_id:r}),f;return x},async updateDisposalLoad(r,l,c,i=null){if(!$)return null;const{data:u,error:m}=await k.from("disposal_loads").update({load_type:l,load_count:c,notes:i}).eq("id",r).select().single();if(m)throw Wt.error("database",{message:m.message,operation:"updateDisposalLoad"}),m;return u},async deleteDisposalLoad(r){if(!$)return!1;const{error:l}=await k.from("disposal_loads").delete().eq("id",r);if(l)throw Wt.error("database",{message:l.message,operation:"deleteDisposalLoad"}),l;return!0},async getDisposalSummary(r,l=null,c=null){if(!$)return[];const i=performance.now();try{const{data:u,error:m}=await k.rpc("get_disposal_summary",{p_project_id:r,p_start_date:l,p_end_date:c}),x=Math.round(performance.now()-i);if(Wt.query("getDisposalSummary",{duration:x,rows:u?.length,project_id:r}),m)throw m;return u||[]}catch(u){return Wt.error("database",{message:u.message,operation:"getDisposalSummary",project_id:r}),this.getDisposalSummaryFallback(r,l,c)}},async getDisposalSummaryFallback(r,l,c){let i=k.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r);l&&(i=i.gte("work_date",l)),c&&(i=i.lte("work_date",c));const{data:u,error:m}=await i;if(m)throw m;const x={};return u?.forEach(f=>{x[f.load_type]||(x[f.load_type]={load_type:f.load_type,total_loads:0,days:new Set}),x[f.load_type].total_loads+=f.load_count,x[f.load_type].days.add(f.work_date)}),Object.values(x).map(f=>({load_type:f.load_type,total_loads:f.total_loads,days_with_activity:f.days.size}))},async getWeeklyDisposalSummary(r,l=4){if(!$)return[];const c=new Date,i=new Date;i.setDate(i.getDate()-l*7);const{data:u,error:m}=await k.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r).gte("work_date",i.toISOString().split("T")[0]).lte("work_date",c.toISOString().split("T")[0]).order("work_date",{ascending:!0});if(m)throw m;const x={};return u?.forEach(f=>{const b=new Date(f.work_date),p=new Date(b);p.setDate(b.getDate()-b.getDay());const j=p.toISOString().split("T")[0];x[j]||(x[j]={week:j,concrete:0,trash:0,metals:0,hazardous_waste:0}),x[j][f.load_type]+=f.load_count}),Object.values(x).sort((f,b)=>f.week.localeCompare(b.week))},async uploadPhoto(r,l,c,i){if(!$)return null;const u=performance.now(),m=i.size||0,x=Date.now(),f=Math.random().toString(36).substring(7),b=i.name?.split(".").pop()||"jpg",p=`${x}-${f}.${b}`,j=`${r}/${l}/${c}/${p}`;try{const{data:R,error:S}=await k.storage.from("tm-photos").upload(j,i,{cacheControl:"3600",upsert:!1}),v=Math.round(performance.now()-u);if(Wt.storage("upload",{company_id:r,project_id:l,size:m,duration:v,success:!S}),S)throw S;const{data:H}=k.storage.from("tm-photos").getPublicUrl(j);return H.publicUrl}catch(R){throw Wt.error("storage",{message:R.message,operation:"uploadPhoto",company_id:r,project_id:l}),R}},async uploadPhotoBase64(r,l,c,i,u="photo.jpg"){if(!$)return null;const x=await(await fetch(i)).blob(),f=Date.now(),b=Math.random().toString(36).substring(7),p=u.split(".").pop()||"jpg",j=`${f}-${b}.${p}`,R=`${r}/${l}/${c}/${j}`,{data:S,error:v}=await k.storage.from("tm-photos").upload(R,x,{cacheControl:"3600",upsert:!1,contentType:x.type});if(v)throw v;const{data:H}=k.storage.from("tm-photos").getPublicUrl(R);return H.publicUrl},async deletePhoto(r){if(!$)return;const c=new URL(r).pathname.match(/\/tm-photos\/(.+)$/);if(!c)return;const i=c[1],{error:u}=await k.storage.from("tm-photos").remove([i]);if(u)throw u},async verifyPhotoAccessible(r){if(!$||!r)return{accessible:!1,error:"Invalid URL"};try{const l=await fetch(r,{method:"HEAD"});return{accessible:l.ok,status:l.status,error:l.ok?null:`HTTP ${l.status}`}}catch(l){return{accessible:!1,error:l.message||"Network error"}}},async verifyTicketPhotos(r){if(!$)return{verified:!1,issues:[]};try{const{data:l,error:c}=await k.from("t_and_m_tickets").select("photos").eq("id",r).single();if(c)throw c;if(!l?.photos||l.photos.length===0)return await k.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:"empty",photos_issue_count:0}).eq("id",r),{verified:!0,status:"empty",issues:[]};const i=[];for(const m of l.photos){const x=await this.verifyPhotoAccessible(m);x.accessible||i.push({url:m,error:x.error})}const u=i.length===0?"verified":"issues";return await k.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:u,photos_issue_count:i.length}).eq("id",r),{verified:i.length===0,status:u,totalPhotos:l.photos.length,issues:i}}catch(l){return console.error("Error verifying ticket photos:",l),{verified:!1,error:l.message,issues:[]}}},async queuePhotoUpload(r,l,c,i){if(!$)return null;const{data:u,error:m}=await k.from("photo_upload_queue").insert({ticket_id:r,temp_id:l,file_name:c,file_size_bytes:i,status:"pending"}).select().single();return m?(console.error("Error queueing photo upload:",m),null):u},async confirmQueuedUpload(r,l,c){if(!$)return!1;const{data:i,error:u}=await k.rpc("confirm_photo_upload",{p_queue_id:r,p_uploaded_url:l,p_storage_path:c});return u?(console.error("Error confirming photo upload:",u),!1):i===!0},async markQueuedUploadFailed(r,l){if(!$)return!1;const{data:c,error:i}=await k.rpc("mark_photo_upload_failed",{p_queue_id:r,p_error:l});return i?(console.error("Error marking photo upload failed:",i),!1):c===!0},async getPendingPhotoUploads(r){if(!$)return[];const{data:l,error:c}=await k.rpc("get_pending_photo_uploads",{p_ticket_id:r});return c?(console.error("Error getting pending photo uploads:",c),[]):l||[]},async logPhotoOperation(r,l,c={}){if($)try{await k.from("photo_audit_log").insert({ticket_id:r,cor_id:c.corId||null,operation:l,photo_url:c.photoUrl||null,storage_path:c.storagePath||null,details:c.metadata?c.metadata:null,error_message:c.error||null,triggered_by:c.triggeredBy||"system"})}catch(i){console.error("Error logging photo operation:",i)}},async saveExportSnapshot(r,l,c={}){if(!$)return null;const{exportType:i="pdf",exportReason:u=null,clientEmail:m=null,clientName:x=null}=c;try{const{data:f,error:b}=await k.from("cor_export_snapshots").insert({cor_id:r,export_type:i,export_reason:u,cor_data:l.cor_data,tickets_data:l.tickets_data,photos_manifest:l.photos_manifest,totals_snapshot:l.totals_snapshot,checksum:l.checksum,client_email:m,client_name:x}).select().single();if(b)throw b;return f}catch(f){return console.error("Error saving export snapshot:",f),null}},async getExportSnapshots(r){if(!$)return[];const{data:l,error:c}=await k.from("cor_export_snapshots").select("id, exported_at, export_type, export_reason, client_name, client_email, checksum").eq("cor_id",r).order("exported_at",{ascending:!1});return c?(console.error("Error fetching export snapshots:",c),[]):l||[]},async getExportSnapshot(r){if(!$)return null;const{data:l,error:c}=await k.from("cor_export_snapshots").select("*").eq("id",r).single();return c?(console.error("Error fetching export snapshot:",c),null):l},async getCrewCheckin(r,l=null){if(!$)return null;const c=l||new Date().toISOString().split("T")[0],{data:i,error:u}=await k.from("crew_checkins").select("*").eq("project_id",r).eq("check_in_date",c).single();return u&&u.code!=="PGRST116"&&console.error("Error fetching crew checkin:",u),i},async saveCrewCheckin(r,l,c=null,i=null){if(!$)return null;const u=i||new Date().toISOString().split("T")[0],{data:m,error:x}=await k.from("crew_checkins").upsert({project_id:r,check_in_date:u,workers:l,created_by:c,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(x)throw console.error("Error saving crew checkin:",x),x;return m},async addCrewMember(r,l,c=null){if(!$)return null;const i=await this.getCrewCheckin(r),u=i?.workers||[];return u.find(m=>m.name.toLowerCase()===l.name.toLowerCase())?i:(u.push(l),await this.saveCrewCheckin(r,u,c))},async removeCrewMember(r,l){if(!$)return null;const c=await this.getCrewCheckin(r);if(!c)return null;const i=c.workers.filter(u=>u.name.toLowerCase()!==l.toLowerCase());return await this.saveCrewCheckin(r,i,c.created_by)},async getCrewCheckinHistory(r,l=30){if(!$)return[];const{data:c,error:i}=await k.from("crew_checkins").select("*").eq("project_id",r).order("check_in_date",{ascending:!1}).limit(l);return i?(console.error("Error fetching crew history:",i),[]):c||[]},async getLaborRates(r,l=null,c=null){if(!$)return[];let i=k.from("labor_rates").select("*").eq("company_id",r);l&&(i=i.eq("work_type",l)),c&&(i=i.eq("job_type",c));const{data:u,error:m}=await i;return m?(console.error("Error fetching labor rates:",m),[]):u||[]},async calculateManDayCosts(r,l,c,i){if(!$)return{totalCost:0,totalManDays:0,breakdown:[]};const u=await this.getCrewCheckinHistory(r,365),m=await this.getLaborRates(l,c,i),x={};m.forEach(R=>{x[R.role.toLowerCase()]=parseFloat(R.regular_rate)||0});let f=0,b=0;const p={},j=[];return u.forEach(R=>{const S=R.workers||[];let v=0;const H={};S.forEach(B=>{const I=(B.role||"laborer").toLowerCase(),ae=x[I]||0;H[I]||(H[I]={count:0,cost:0}),H[I].count++,H[I].cost+=ae,v+=ae,p[I]||(p[I]={count:0,cost:0,rate:ae}),p[I].count++,p[I].cost+=ae}),f+=v,b+=S.length,j.push({date:R.check_in_date,workers:S.length,cost:v,breakdown:H})}),{totalCost:f,totalManDays:b,byRole:p,byDate:j,daysWorked:u.length}},async getDailyReport(r,l=null){if(!$)return null;const c=l||new Date().toISOString().split("T")[0],{data:i,error:u}=await k.from("daily_reports").select("*").eq("project_id",r).eq("report_date",c).single();return u&&u.code!=="PGRST116"&&console.error("Error fetching daily report:",u),i},async compileDailyReport(r,l=null){if(!$)return null;const c=l||new Date().toISOString().split("T")[0],i=await this.getCrewCheckin(r,c),{data:u}=await k.from("areas").select("*").eq("project_id",r),m=u?.filter(b=>b.status==="done"&&b.completed_at?.startsWith(c))||[],{data:x}=await k.from("t_and_m_tickets").select("*").eq("project_id",r).eq("work_date",c),f=x?.reduce((b,p)=>b+(p.photos?.length||0),0)||0;return{crew_count:i?.workers?.length||0,crew_list:i?.workers||[],tasks_completed:m.length,tasks_total:u?.length||0,completed_tasks:m.map(b=>({name:b.name,group:b.group_name})),tm_tickets_count:x?.length||0,photos_count:f}},async saveDailyReport(r,l,c=null){if(!$)return null;const i=c||new Date().toISOString().split("T")[0],{data:u,error:m}=await k.from("daily_reports").upsert({project_id:r,report_date:i,...l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(m)throw console.error("Error saving daily report:",m),m;return u},async submitDailyReport(r,l,c=null){if(!$)return null;const i=c||new Date().toISOString().split("T")[0],u=await this.compileDailyReport(r,i),{data:m,error:x}=await k.from("daily_reports").upsert({project_id:r,report_date:i,...u,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(x)throw console.error("Error submitting daily report:",x),x;return m},async getDailyReports(r,l=30){if(!$)return[];const{data:c,error:i}=await k.from("daily_reports").select("*").eq("project_id",r).order("report_date",{ascending:!1}).limit(l);return i?(console.error("Error fetching daily reports:",i),[]):c||[]},async sendMessage(r,l,c,i,u=null,m=null,x="general",f=null){if(!$)return null;const{data:b,error:p}=await k.from("messages").insert({project_id:r,sender_type:c,sender_name:i,sender_user_id:u,message:l,photo_url:m,message_type:x,parent_message_id:f}).select().single();if(p)throw console.error("Error sending message:",p),p;return b},async getMessages(r,l=50){if(!$)return[];const{data:c,error:i}=await k.from("messages").select("*").eq("project_id",r).order("created_at",{ascending:!1}).limit(l);return i?(console.error("Error fetching messages:",i),[]):c||[]},async getUnreadCount(r,l){if(!$)return 0;const c=l==="field"?"office":"field",{count:i,error:u}=await k.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("sender_type",c).eq("is_read",!1);return u?(console.error("Error getting unread count:",u),0):i||0},async markMessagesRead(r,l){if(!$)return;const c=l==="field"?"office":"field",{error:i}=await k.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",r).eq("sender_type",c).eq("is_read",!1);i&&console.error("Error marking messages read:",i)},async createMaterialRequest(r,l,c,i=null,u="normal",m=null){if(!$)return null;const{data:x,error:f}=await k.from("material_requests").insert({project_id:r,items:l,requested_by:c,needed_by:i,priority:u,notes:m}).select().single();if(f)throw console.error("Error creating material request:",f),f;return x},async getMaterialRequests(r,l=null){if(!$)return[];let c=k.from("material_requests").select("*").eq("project_id",r).order("created_at",{ascending:!1});l&&(c=c.eq("status",l));const{data:i,error:u}=await c;return u?(console.error("Error fetching material requests:",u),[]):i||[]},async getPendingRequestsCount(r){if(!$)return 0;const{count:l,error:c}=await k.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("status","pending");return c?0:l||0},async updateMaterialRequest(r,l,c,i=null,u=null){if(!$)return null;const m={status:l,responded_by:c,responded_at:new Date().toISOString(),response_notes:i,updated_at:new Date().toISOString()};u&&(m.expected_delivery=u),l==="delivered"&&(m.delivered_at=new Date().toISOString());const{data:x,error:f}=await k.from("material_requests").update(m).eq("id",r).select().single();if(f)throw console.error("Error updating material request:",f),f;return x},generateShareToken(){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let l="";for(let c=0;c<12;c++)l+=r.charAt(Math.floor(Math.random()*r.length));return l},async createProjectShare(r,l,c,i=null){if(!$){const b=Ie();b.projectShares||(b.projectShares=[]);const p={id:crypto.randomUUID(),project_id:r,share_token:this.generateShareToken(),created_by:l,expires_at:i,is_active:!0,permissions:c,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return b.projectShares.push(p),Ct(b),p}const{data:u,error:m}=await k.rpc("generate_share_token");if(m)throw console.error("Error generating share token:",m),m;const{data:x,error:f}=await k.from("project_shares").insert({project_id:r,share_token:u,created_by:l,expires_at:i,permissions:c}).select().single();if(f)throw console.error("Error creating project share:",f),f;return x},async getShareByToken(r){if(!$){const i=Ie();if(!i.projectShares)return null;const u=i.projectShares.find(m=>m.share_token===r&&m.is_active&&(!m.expires_at||new Date(m.expires_at)>new Date));return u&&(u.view_count++,u.last_viewed_at=new Date().toISOString(),Ct(i)),u}const{data:l,error:c}=await k.from("project_shares").select("*, projects(*)").eq("share_token",r).eq("is_active",!0).single();return c?(console.error("Error fetching share by token:",c),null):l.expires_at&&new Date(l.expires_at)<new Date?null:(await k.rpc("increment_share_view_count",{token:r}),l)},async getProjectShares(r){if(!$){const i=Ie();return i.projectShares?i.projectShares.filter(u=>u.project_id===r):[]}const{data:l,error:c}=await k.from("project_shares").select("*, users(name, email)").eq("project_id",r).order("created_at",{ascending:!1});return c?(console.error("Error fetching project shares:",c),[]):l||[]},async updateProjectShare(r,l){if(!$){const u=Ie();if(!u.projectShares)return null;const m=u.projectShares.findIndex(x=>x.id===r);return m===-1?null:(u.projectShares[m]={...u.projectShares[m],...l,updated_at:new Date().toISOString()},Ct(u),u.projectShares[m])}const{data:c,error:i}=await k.from("project_shares").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating project share:",i),i;return c},async revokeProjectShare(r){return this.updateProjectShare(r,{is_active:!1})},async deleteProjectShare(r){if(!$){const c=Ie();if(!c.projectShares)return;c.projectShares=c.projectShares.filter(i=>i.id!==r),Ct(c);return}const{error:l}=await k.from("project_shares").delete().eq("id",r);if(l)throw console.error("Error deleting project share:",l),l},async getPublicProjectData(r){const l=await this.getShareByToken(r);if(!l)return null;const c=l.project_id||l.projects?.id;if(!$){const m=Ie(),x=m.projects.find(R=>R.id===c);if(!x)return null;const f=m.areas.filter(R=>R.project_id===c),b=f.reduce((R,S)=>R+parseFloat(S.weight||0),0),p=f.filter(R=>R.status==="done").reduce((R,S)=>R+parseFloat(S.weight||0),0),j=b>0?Math.round(p/b*100):0;return{share:l,project:x,progress:j,areas:l.permissions.progress?f:[],photos:[],dailyReports:[],tmTickets:[]}}const i=l.projects||await this.getProject(c);if(!i)return null;const u={share:l,project:i,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(l.permissions.progress){u.areas=await this.getAreas(c);const m=u.areas.reduce((f,b)=>f+parseFloat(b.weight||0),0),x=u.areas.filter(f=>f.status==="done").reduce((f,b)=>f+parseFloat(b.weight||0),0);u.progress=m>0?Math.round(x/m*100):0}if(l.permissions.photos){const{data:m}=await k.from("t_and_m_tickets").select("photos, work_date").eq("project_id",c).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);u.photos=m?.flatMap(x=>(x.photos||[]).map(f=>({url:f,date:x.work_date})))||[]}if(l.permissions.daily_reports){const{data:m}=await k.from("daily_reports").select("*").eq("project_id",c).order("report_date",{ascending:!1}).limit(10);u.dailyReports=m||[]}return l.permissions.tm_tickets&&(u.tmTickets=await this.getTMTickets(c)),u},async createInjuryReport(r){if(!$){const i=Ie();i.injuryReports||(i.injuryReports=[]);const u={id:crypto.randomUUID(),...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return i.injuryReports.push(u),Ct(i),u}const{data:l,error:c}=await k.from("injury_reports").insert(r).select().single();if(c)throw console.error("Error creating injury report:",c),c;return l},async getInjuryReports(r){if(!$){const i=Ie();return i.injuryReports?i.injuryReports.filter(u=>u.project_id===r).sort((u,m)=>new Date(m.incident_date)-new Date(u.incident_date)):[]}const{data:l,error:c}=await k.from("injury_reports").select("*").eq("project_id",r).order("incident_date",{ascending:!1});return c?(console.error("Error fetching injury reports:",c),[]):l||[]},async getCompanyInjuryReports(r,l=null){if(!$){const m=Ie();if(!m.injuryReports)return[];let x=m.injuryReports.filter(f=>f.company_id===r);return l&&(x=x.filter(f=>f.status===l)),x.sort((f,b)=>new Date(b.incident_date)-new Date(f.incident_date))}let c=k.from("injury_reports").select("*, projects(name)").eq("company_id",r).order("incident_date",{ascending:!1});l&&(c=c.eq("status",l));const{data:i,error:u}=await c;return u?(console.error("Error fetching company injury reports:",u),[]):i||[]},async getInjuryReport(r){if(!$){const i=Ie();return i.injuryReports?i.injuryReports.find(u=>u.id===r):null}const{data:l,error:c}=await k.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",r).single();return c?(console.error("Error fetching injury report:",c),null):l},async updateInjuryReport(r,l){if(!$){const u=Ie();if(!u.injuryReports)return null;const m=u.injuryReports.findIndex(x=>x.id===r);return m===-1?null:(u.injuryReports[m]={...u.injuryReports[m],...l,updated_at:new Date().toISOString()},Ct(u),u.injuryReports[m])}const{data:c,error:i}=await k.from("injury_reports").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating injury report:",i),i;return c},async closeInjuryReport(r,l){return this.updateInjuryReport(r,{status:"closed",closed_at:new Date().toISOString(),closed_by:l})},async deleteInjuryReport(r){if(!$){const c=Ie();if(!c.injuryReports)return;c.injuryReports=c.injuryReports.filter(i=>i.id!==r),Ct(c);return}const{error:l}=await k.from("injury_reports").delete().eq("id",r);if(l)throw console.error("Error deleting injury report:",l),l},async getInjuryStatistics(r,l=null,c=null){if(!$){const m=Ie();if(!m.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let x=m.injuryReports.filter(f=>f.company_id===r);return l&&(x=x.filter(f=>new Date(f.incident_date)>=new Date(l))),c&&(x=x.filter(f=>new Date(f.incident_date)<=new Date(c))),{total_incidents:x.length,minor_injuries:x.filter(f=>f.injury_type==="minor").length,serious_injuries:x.filter(f=>f.injury_type==="serious").length,critical_injuries:x.filter(f=>f.injury_type==="critical").length,near_misses:x.filter(f=>f.injury_type==="near_miss").length,osha_recordable:x.filter(f=>f.osha_recordable).length,total_days_away:x.reduce((f,b)=>f+(b.days_away_from_work||0),0),total_restricted_days:x.reduce((f,b)=>f+(b.restricted_work_days||0),0)}}const{data:i,error:u}=await k.rpc("get_injury_statistics",{comp_id:r,start_date:l,end_date:c});return u?(console.error("Error fetching injury statistics:",u),null):i[0]||null},async addWitness(r,l){if(!$){const u=Ie();if(!u.injuryReports)return null;const m=u.injuryReports.findIndex(b=>b.id===r);if(m===-1)return null;const x=u.injuryReports[m],f=x.witnesses||[];return f.push(l),u.injuryReports[m]={...x,witnesses:f,updated_at:new Date().toISOString()},Ct(u),u.injuryReports[m]}const c=await this.getInjuryReport(r);if(!c)return null;const i=c.witnesses||[];return i.push(l),this.updateInjuryReport(r,{witnesses:i})},async removeWitness(r,l){if(!$){const u=Ie();if(!u.injuryReports)return null;const m=u.injuryReports.findIndex(b=>b.id===r);if(m===-1)return null;const x=u.injuryReports[m],f=x.witnesses||[];return f.splice(l,1),u.injuryReports[m]={...x,witnesses:f,updated_at:new Date().toISOString()},Ct(u),u.injuryReports[m]}const c=await this.getInjuryReport(r);if(!c)return null;const i=c.witnesses||[];return i.splice(l,1),this.updateInjuryReport(r,{witnesses:i})},async getCompanyUsers(r){if($){const{data:l,error:c}=await k.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",r);return c?(console.error("Error fetching company users:",c),[]):l?.map(i=>({id:i.user_id,name:i.users?.name||i.users?.email,email:i.users?.email,role:i.role}))||[]}return[]},async getProjectNotificationPreferences(r){if($){const{data:c,error:i}=await k.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",r);return i?(console.error("Error fetching notification preferences:",i),[]):c||[]}const l=Ie();return l.notificationPreferences?l.notificationPreferences.filter(c=>c.project_id===r):[]},async getUserNotificationPreferences(r){if($){const{data:c,error:i}=await k.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",r);return i?(console.error("Error fetching user notification preferences:",i),[]):c||[]}const l=Ie();return l.notificationPreferences?l.notificationPreferences.filter(c=>c.user_id===r):[]},async setNotificationPreference(r,l,c){if($){const{data:x,error:f}=await k.from("notification_preferences").upsert({project_id:r,user_id:l,notification_types:c,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(f)throw console.error("Error setting notification preference:",f),f;return x}const i=Ie();i.notificationPreferences||(i.notificationPreferences=[]);const u=i.notificationPreferences.findIndex(x=>x.project_id===r&&x.user_id===l),m={id:u>=0?i.notificationPreferences[u].id:crypto.randomUUID(),project_id:r,user_id:l,notification_types:c,created_at:u>=0?i.notificationPreferences[u].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return u>=0?i.notificationPreferences[u]=m:i.notificationPreferences.push(m),Ct(i),m},async removeNotificationPreference(r,l){if($){const{error:i}=await k.from("notification_preferences").delete().eq("project_id",r).eq("user_id",l);if(i)throw console.error("Error removing notification preference:",i),i;return!0}const c=Ie();return c.notificationPreferences&&(c.notificationPreferences=c.notificationPreferences.filter(i=>!(i.project_id===r&&i.user_id===l)),Ct(c)),!0},async setProjectNotificationPreferences(r,l){const c=[];for(const i of l)if(i.notificationTypes&&i.notificationTypes.length>0){const u=await this.setNotificationPreference(r,i.userId,i.notificationTypes);c.push(u)}else await this.removeNotificationPreference(r,i.userId);return c},async getNotificationPresets(r){if($){const{data:c,error:i}=await k.from("notification_presets").select("*").eq("company_id",r).order("name");return i?(console.error("Error fetching notification presets:",i),[]):c||[]}const l=Ie();return l.notificationPresets?l.notificationPresets.filter(c=>c.company_id===r):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:r},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:r},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:r},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:r}]},async createNotificationPreset(r,l,c){if($){const{data:m,error:x}=await k.from("notification_presets").insert({company_id:r,name:l,notification_types:c}).select().single();if(x)throw console.error("Error creating notification preset:",x),x;return m}const i=Ie();i.notificationPresets||(i.notificationPresets=[]);const u={id:crypto.randomUUID(),company_id:r,name:l,notification_types:c,created_at:new Date().toISOString()};return i.notificationPresets.push(u),Ct(i),u},async updateNotificationPreset(r,l,c){if($){const{data:m,error:x}=await k.from("notification_presets").update({name:l,notification_types:c,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(x)throw console.error("Error updating notification preset:",x),x;return m}const i=Ie();if(!i.notificationPresets)return null;const u=i.notificationPresets.findIndex(m=>m.id===r);return u===-1?null:(i.notificationPresets[u]={...i.notificationPresets[u],name:l,notification_types:c,updated_at:new Date().toISOString()},Ct(i),i.notificationPresets[u])},async deleteNotificationPreset(r){if($){const{error:c}=await k.from("notification_presets").delete().eq("id",r);if(c)throw console.error("Error deleting notification preset:",c),c;return!0}const l=Ie();return l.notificationPresets&&(l.notificationPresets=l.notificationPresets.filter(c=>c.id!==r),Ct(l)),!0},async getDumpSites(r){if($){const{data:c,error:i}=await k.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",r).eq("active",!0).order("name");return i?(console.error("Error fetching dump sites:",i),[]):c||[]}return(Ie().dumpSites||[]).filter(c=>c.company_id===r&&c.active)},async createDumpSite(r,l,c="",i=""){if($){const{data:x,error:f}=await k.from("dump_sites").insert({company_id:r,name:l,address:c,notes:i,active:!0}).select().single();if(f)throw console.error("Error creating dump site:",f),f;return x}const u=Ie();u.dumpSites||(u.dumpSites=[]);const m={id:crypto.randomUUID(),company_id:r,name:l,address:c,notes:i,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return u.dumpSites.push(m),Ct(u),m},async updateDumpSite(r,l){if($){const{data:u,error:m}=await k.from("dump_sites").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(m)throw console.error("Error updating dump site:",m),m;return u}const c=Ie();if(!c.dumpSites)return null;const i=c.dumpSites.findIndex(u=>u.id===r);return i===-1?null:(c.dumpSites[i]={...c.dumpSites[i],...l},Ct(c),c.dumpSites[i])},async deleteDumpSite(r){return this.updateDumpSite(r,{active:!1})},async setDumpSiteRate(r,l,c,i="load"){if($){const{data:f}=await k.from("dump_site_rates").select("id").eq("dump_site_id",r).eq("waste_type",l).maybeSingle();if(f){const{data:b,error:p}=await k.from("dump_site_rates").update({estimated_cost_per_load:c,unit:i}).eq("id",f.id).select().single();if(p)throw console.error("Error updating dump site rate:",p),p;return b}else{const{data:b,error:p}=await k.from("dump_site_rates").insert({dump_site_id:r,waste_type:l,estimated_cost_per_load:c,unit:i}).select().single();if(p)throw console.error("Error inserting dump site rate:",p),p;return b}}const u=Ie();u.dumpSiteRates||(u.dumpSiteRates=[]);const m=u.dumpSiteRates.findIndex(f=>f.dump_site_id===r&&f.waste_type===l),x={id:m>=0?u.dumpSiteRates[m].id:crypto.randomUUID(),dump_site_id:r,waste_type:l,estimated_cost_per_load:c,unit:i,created_at:new Date().toISOString()};return m>=0?u.dumpSiteRates[m]=x:u.dumpSiteRates.push(x),Ct(u),x},async getDumpSiteRates(r){if($){const{data:c,error:i}=await k.from("dump_site_rates").select("*").eq("dump_site_id",r);return i?(console.error("Error fetching dump site rates:",i),[]):c||[]}return(Ie().dumpSiteRates||[]).filter(c=>c.dump_site_id===r)},async getHaulOffs(r){if($){const{data:c,error:i}=await k.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",r).order("work_date",{ascending:!1});return i?(console.error("Error fetching haul-offs:",i),[]):c||[]}return(Ie().haulOffs||[]).filter(c=>c.project_id===r).sort((c,i)=>new Date(i.work_date)-new Date(c.work_date))},async createHaulOff(r,l){const c={project_id:r,dump_site_id:l.dumpSiteId,waste_type:l.wasteType,loads:l.loads,hauling_company:l.haulingCompany||"",work_date:l.workDate,notes:l.notes||"",estimated_cost:l.estimatedCost||0,created_by:l.createdBy||""};if($){const{data:m,error:x}=await k.from("haul_offs").insert(c).select().single();if(x)throw console.error("Error creating haul-off:",x),x;return m}const i=Ie();i.haulOffs||(i.haulOffs=[]);const u={...c,id:crypto.randomUUID(),created_at:new Date().toISOString()};return i.haulOffs.push(u),Ct(i),u},async calculateHaulOffCosts(r){const l=await this.getHaulOffs(r);let c=0,i=0;const u={},m=[],x={};l.forEach(b=>{const p=parseFloat(b.estimated_cost)||0,j=parseInt(b.loads)||0;c+=p,i+=j,u[b.waste_type]||(u[b.waste_type]={loads:0,cost:0}),u[b.waste_type].loads+=j,u[b.waste_type].cost+=p,x[b.work_date]||(x[b.work_date]={date:b.work_date,loads:0,cost:0}),x[b.work_date].loads+=j,x[b.work_date].cost+=p}),Object.values(x).sort((b,p)=>new Date(p.date)-new Date(b.date)).forEach(b=>m.push(b));const f=m.length;return{totalCost:c,totalLoads:i,byWasteType:u,byDate:m,daysWithHaulOff:f,avgDailyHaulOffCost:f>0?c/f:0}},subscribeToHaulOffs(r,l){return $?k.channel(`haul_offs:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${r}`},l).subscribe():null},async createCOR(r,l=0){if($){let c=r.cor_number;l>0&&(c=await this.getNextCORNumber(r.project_id));const{data:i,error:u}=await k.from("change_orders").insert({company_id:r.company_id,project_id:r.project_id,area_id:r.area_id||null,cor_number:c,title:r.title,description:r.description||"",scope_of_work:r.scope_of_work,period_start:r.period_start,period_end:r.period_end,status:"draft",labor_markup_percent:r.labor_markup_percent??1500,materials_markup_percent:r.materials_markup_percent??1500,equipment_markup_percent:r.equipment_markup_percent??1500,subcontractors_markup_percent:r.subcontractors_markup_percent??500,liability_insurance_percent:r.liability_insurance_percent??144,bond_percent:r.bond_percent??100,license_fee_percent:r.license_fee_percent??10,created_by:r.created_by||null}).select().single();if((u?.code==="23505"||u?.code==="PGRST116"||u?.status===409||u?.message?.includes("duplicate")||u?.message?.includes("unique_cor_number"))&&l<3)return console.warn(`COR number conflict, retrying with fresh number (attempt ${l+1})`),this.createCOR(r,l+1);if(u)throw u;return i}return null},async updateCOR(r,l){if($){const{data:c,error:i}=await k.from("change_orders").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return c}return null},async deleteCOR(r){if($){const{error:l}=await k.from("change_orders").delete().eq("id",r);if(l)throw l}},async bulkUpdateCORGroup(r,l){if($){const{error:c}=await k.from("change_orders").update({group_name:l,updated_at:new Date().toISOString()}).in("id",r);if(c)throw c.message?.includes("group_name")||c.code==="PGRST204"?new Error("COR grouping requires a database migration. Please run database/migration_cor_enhancements.sql in Supabase SQL Editor."):c}},async getCORs(r,l={}){if($){let c=k.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",r);l.status&&(c=c.eq("status",l.status)),l.area_id&&(c=c.eq("area_id",l.area_id)),l.date_start&&(c=c.gte("period_start",l.date_start)),l.date_end&&(c=c.lte("period_end",l.date_end)),c=c.order("created_at",{ascending:!1});const{data:i,error:u}=await c;if(u)throw u;return i}return[]},async getCORById(r){if($){const{data:l,error:c}=await k.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              *,
              t_and_m_workers (*),
              t_and_m_items (
                *,
                materials_equipment (name, unit, cost_per_unit, category)
              )
            )
          )
        `).eq("id",r).single();if(c)throw c;return l}return null},async getCORsByArea(r,l){if($){const{data:c,error:i}=await k.from("change_orders").select("*").eq("project_id",r).eq("area_id",l).order("created_at",{ascending:!1});if(i)throw i;return c}return[]},async getAssignableCORs(r){if($){const{data:l,error:c}=await k.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",r).in("status",["draft","pending_approval","approved"]).order("cor_number",{ascending:!0});if(c)throw c;return l||[]}return[]},async getNextCORNumber(r){if($){const{data:l,error:c}=await k.from("change_orders").select("cor_number").eq("project_id",r);if(c)throw c;if(l&&l.length>0){let i=0;for(const u of l){const m=u.cor_number?.match(/COR #(\d+)/);if(m){const x=parseInt(m[1]);x>i&&(i=x)}}return`COR #${i+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(r,l){if($){const c=Math.round(l.regular_hours*l.regular_rate),i=Math.round(l.overtime_hours*l.overtime_rate),u=c+i,{data:m,error:x}=await k.from("change_order_labor").insert({change_order_id:r,labor_class:l.labor_class,wage_type:l.wage_type||"standard",regular_hours:l.regular_hours||0,overtime_hours:l.overtime_hours||0,regular_rate:l.regular_rate||0,overtime_rate:l.overtime_rate||0,regular_total:c,overtime_total:i,total:u,sort_order:l.sort_order||0,source_ticket_id:l.source_ticket_id||null}).select().single();if(x)throw x;return m}return null},async updateCORLaborItem(r,l){if($){let c={...l};if(l.regular_hours!==void 0||l.regular_rate!==void 0||l.overtime_hours!==void 0||l.overtime_rate!==void 0){const{data:m}=await k.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",r).single(),x=l.regular_hours??m?.regular_hours??0,f=l.overtime_hours??m?.overtime_hours??0,b=l.regular_rate??m?.regular_rate??0,p=l.overtime_rate??m?.overtime_rate??0;c.regular_total=Math.round(x*b),c.overtime_total=Math.round(f*p),c.total=c.regular_total+c.overtime_total}const{data:i,error:u}=await k.from("change_order_labor").update(c).eq("id",r).select().single();if(u)throw u;return i}return null},async deleteCORLaborItem(r){if($){const{error:l}=await k.from("change_order_labor").delete().eq("id",r);if(l)throw l}},async addCORMaterialItem(r,l){if($){const i=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",u=Math.round(Number(l.unit_cost)||0),m=Number(l.quantity)||1,x=Math.round(m*u),{data:f,error:b}=await k.from("change_order_materials").insert({change_order_id:r,description:l.description||"",quantity:m,unit:l.unit||"each",unit_cost:u,total:x,source_type:i,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(b)throw b;return f}return null},async updateCORMaterialItem(r,l){if($){let c={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await k.from("change_order_materials").select("quantity, unit_cost").eq("id",r).single(),x=l.quantity??m?.quantity??1,f=l.unit_cost??m?.unit_cost??0;c.total=Math.round(x*f)}const{data:i,error:u}=await k.from("change_order_materials").update(c).eq("id",r).select().single();if(u)throw u;return i}return null},async deleteCORMaterialItem(r){if($){const{error:l}=await k.from("change_order_materials").delete().eq("id",r);if(l)throw l}},async addCOREquipmentItem(r,l){if($){const i=["backup_sheet","invoice","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",u=Math.round(Number(l.unit_cost)||0),m=Number(l.quantity)||1,x=Math.round(m*u),{data:f,error:b}=await k.from("change_order_equipment").insert({change_order_id:r,description:l.description||"",quantity:m,unit:l.unit||"day",unit_cost:u,total:x,source_type:i,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(b)throw b;return f}return null},async updateCOREquipmentItem(r,l){if($){let c={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await k.from("change_order_equipment").select("quantity, unit_cost").eq("id",r).single(),x=l.quantity??m?.quantity??1,f=l.unit_cost??m?.unit_cost??0;c.total=Math.round(x*f)}const{data:i,error:u}=await k.from("change_order_equipment").update(c).eq("id",r).select().single();if(u)throw u;return i}return null},async deleteCOREquipmentItem(r){if($){const{error:l}=await k.from("change_order_equipment").delete().eq("id",r);if(l)throw l}},async addCORSubcontractorItem(r,l){if($){const c=Math.round(l.quantity*l.unit_cost),{data:i,error:u}=await k.from("change_order_subcontractors").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"lump sum",unit_cost:l.unit_cost||0,total:c,source_type:l.source_type||"custom",source_reference:l.source_reference||null,sort_order:l.sort_order||0}).select().single();if(u)throw u;return i}return null},async updateCORSubcontractorItem(r,l){if($){let c={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await k.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",r).single(),x=l.quantity??m?.quantity??1,f=l.unit_cost??m?.unit_cost??0;c.total=Math.round(x*f)}const{data:i,error:u}=await k.from("change_order_subcontractors").update(c).eq("id",r).select().single();if(u)throw u;return i}return null},async deleteCORSubcontractorItem(r){if($){const{error:l}=await k.from("change_order_subcontractors").delete().eq("id",r);if(l)throw l}},async addBulkLaborItems(r,l){if($&&l.length>0){const c=l.map((m,x)=>{const f=Math.round(m.regular_hours*m.regular_rate),b=Math.round(m.overtime_hours*m.overtime_rate);return{change_order_id:r,labor_class:m.labor_class,wage_type:m.wage_type||"standard",regular_hours:m.regular_hours||0,overtime_hours:m.overtime_hours||0,regular_rate:m.regular_rate||0,overtime_rate:m.overtime_rate||0,regular_total:f,overtime_total:b,total:f+b,sort_order:m.sort_order??x,source_ticket_id:m.source_ticket_id||null}}),{data:i,error:u}=await k.from("change_order_labor").insert(c).select();if(u)throw u;return i}return[]},async addBulkMaterialItems(r,l){if($&&l.length>0){const c=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"],i=l.map((x,f)=>{const b=c.includes(x.source_type)?x.source_type:"custom",p=Math.round(Number(x.unit_cost)||0),j=Number(x.quantity)||1;return{change_order_id:r,description:x.description||"",quantity:j,unit:x.unit||"each",unit_cost:p,total:Math.round(j*p),source_type:b,source_reference:x.source_reference||null,source_ticket_id:x.source_ticket_id||null,sort_order:x.sort_order??f}}),{data:u,error:m}=await k.from("change_order_materials").insert(i).select();if(m)throw m;return u}return[]},async addBulkEquipmentItems(r,l){if($&&l.length>0){const c=["backup_sheet","invoice","custom","field_ticket","rental"],i=l.map((x,f)=>{const b=c.includes(x.source_type)?x.source_type:"custom",p=Math.round(Number(x.unit_cost)||0),j=Number(x.quantity)||1;return{change_order_id:r,description:x.description||"",quantity:j,unit:x.unit||"day",unit_cost:p,total:Math.round(j*p),source_type:b,source_reference:x.source_reference||null,source_ticket_id:x.source_ticket_id||null,sort_order:x.sort_order??f}}),{data:u,error:m}=await k.from("change_order_equipment").insert(i).select();if(m)throw m;return u}return[]},async addBulkSubcontractorItems(r,l){if($&&l.length>0){const c=l.map((m,x)=>({change_order_id:r,company_name:m.company_name||"",description:m.description||"",quantity:m.quantity||1,unit:m.unit||"lump sum",unit_cost:m.unit_cost||m.total||m.amount||0,total:m.total||m.amount||0,source_type:m.source_type||"invoice",source_reference:m.source_reference||null,sort_order:m.sort_order??x})),{data:i,error:u}=await k.from("change_order_subcontractors").insert(c).select();if(u)throw u;return i}return[]},async clearCORLineItems(r){$&&(await k.from("change_order_labor").delete().eq("change_order_id",r),await k.from("change_order_materials").delete().eq("change_order_id",r),await k.from("change_order_equipment").delete().eq("change_order_id",r),await k.from("change_order_subcontractors").delete().eq("change_order_id",r))},async saveCORLineItems(r,{laborItems:l,materialItems:c,equipmentItems:i,subcontractorItems:u}){if($){await this.clearCORLineItems(r);const m=await Promise.all([l?.length>0?this.addBulkLaborItems(r,l):[],c?.length>0?this.addBulkMaterialItems(r,c):[],i?.length>0?this.addBulkEquipmentItems(r,i):[],u?.length>0?this.addBulkSubcontractorItems(r,u):[]]);return{labor:m[0],materials:m[1],equipment:m[2],subcontractors:m[3]}}return null},async assignTicketToCOR(r,l){if($){const{error:c}=await k.rpc("assign_ticket_to_cor",{p_ticket_id:r,p_cor_id:l});if(c)throw Wt.error("database",{message:c.message,operation:"assignTicketToCOR",extra:{ticketId:r,corId:l}}),c;return{ticket_id:r,change_order_id:l}}return null},async unassignTicketFromCOR(r,l){if($){const{error:c}=await k.rpc("unassign_ticket_from_cor",{p_ticket_id:r,p_cor_id:l});if(c)throw Wt.error("database",{message:c.message,operation:"unassignTicketFromCOR",extra:{ticketId:r,corId:l}}),c}},async checkTicketCORIntegrity(){if($){const{data:r,error:l}=await k.rpc("check_ticket_cor_integrity");if(l)throw l;return r||[]}return[]},async fixTicketCORIntegrity(){if($){const{data:r,error:l}=await k.rpc("fix_ticket_cor_integrity");if(l)throw l;return r}return 0},async getTicketsForCOR(r){if($){const{data:l,error:c}=await k.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",r);if(c)throw c;return l}return[]},async getUnassignedTickets(r){if($){const{data:l,error:c}=await k.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(c)throw c;return l}return[]},async importTicketDataToCOR(r,l,c,i,u){if($){const{data:m,error:x}=await k.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",r).single();if(x)throw x;const{data:f,error:b}=await k.from("labor_rates").select("*").eq("company_id",c).eq("work_type",i||"demolition").eq("job_type",u||"standard");if(b)throw b;const p={};f?.forEach(B=>{p[B.role.toLowerCase()]=B});const j={};m.t_and_m_workers?.forEach(B=>{const I=(B.role||"laborer").toLowerCase();j[I]||(j[I]={regular_hours:0,overtime_hours:0}),j[I].regular_hours+=parseFloat(B.hours)||0,j[I].overtime_hours+=parseFloat(B.overtime_hours)||0});const R=Object.entries(j).map(([B,I])=>{const ae=p[B]||{regular_rate:0,overtime_rate:0},G=Math.round((parseFloat(ae.regular_rate)||0)*100),O=Math.round((parseFloat(ae.overtime_rate)||0)*100);return{labor_class:B.charAt(0).toUpperCase()+B.slice(1),wage_type:u||"standard",regular_hours:I.regular_hours,overtime_hours:I.overtime_hours,regular_rate:G,overtime_rate:O,source_ticket_id:r}});R.length>0&&await this.addBulkLaborItems(l,R);const S=[],v=[];m.t_and_m_items?.forEach(B=>{const I=B.custom_name||B.materials_equipment?.name||"Unknown Item",ae=B.custom_category||B.materials_equipment?.category||"Other",G=B.materials_equipment?.unit||"each",O=Math.round((parseFloat(B.materials_equipment?.cost_per_unit)||0)*100),C={description:I,quantity:B.quantity||1,unit:G,unit_cost:O,source_type:"backup_sheet",source_ticket_id:r};ae==="Equipment"?v.push(C):S.push(C)}),S.length>0&&await this.addBulkMaterialItems(l,S),v.length>0&&await this.addBulkEquipmentItems(l,v);const{error:H}=await k.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString(),import_status:"completed",import_failed_at:null,import_error:null}).eq("change_order_id",l).eq("ticket_id",r);if(H)throw H;return Wt.activity("cor_import_success",{ticket_id:r,cor_id:l,labor_count:R.length,material_count:S.length,equipment_count:v.length}),{laborItems:R,materialItems:S,equipmentItems:v}}return null},async reimportTicketDataToCOR(r,l,c,i,u){return $?(await k.from("change_order_labor").delete().eq("change_order_id",l).eq("source_ticket_id",r),await k.from("change_order_materials").delete().eq("change_order_id",l).eq("source_ticket_id",r),await k.from("change_order_equipment").delete().eq("change_order_id",l).eq("source_ticket_id",r),this.importTicketDataToCOR(r,l,c,i,u)):null},async markImportFailed(r,l,c="Import failed"){if($){const{error:i}=await k.from("change_order_ticket_associations").update({import_status:"failed",import_failed_at:new Date().toISOString(),import_error:c}).eq("change_order_id",l).eq("ticket_id",r);if(i)throw Wt.error("database",{message:i.message,operation:"markImportFailed",extra:{ticketId:r,corId:l}}),i;Wt.error("cor_import_failed",{ticket_id:r,cor_id:l,error:c})}},async getTicketsNeedingImport(r){if($){const{data:l,error:c}=await k.from("t_and_m_tickets").select(`
          id,
          work_date,
          ce_pco_number,
          assigned_cor_id,
          change_order_ticket_associations!inner (
            change_order_id,
            import_status,
            import_failed_at,
            import_error
          )
        `).eq("project_id",r).eq("change_order_ticket_associations.import_status","failed");if(c)throw c;return l||[]}return[]},async getTicketImportStatus(r,l){if($){const{data:c,error:i}=await k.from("change_order_ticket_associations").select("import_status, import_failed_at, import_error, data_imported").eq("ticket_id",r).eq("change_order_id",l).single();if(i&&i.code!=="PGRST116")throw i;return c}return null},async recalculateCOR(r){if($){const{error:l}=await k.rpc("recalculate_cor_totals",{cor_id:r});if(l)throw l;return this.getCORById(r)}return null},async updateCORMarkupPercentages(r,l){if($){const c={};l.labor!==void 0&&(c.labor_markup_percent=l.labor),l.materials!==void 0&&(c.materials_markup_percent=l.materials),l.equipment!==void 0&&(c.equipment_markup_percent=l.equipment),l.subcontractors!==void 0&&(c.subcontractors_markup_percent=l.subcontractors);const{data:i,error:u}=await k.from("change_orders").update(c).eq("id",r).select().single();if(u)throw u;return i}return null},async updateCORFeePercentages(r,l){if($){const c={};l.liabilityInsurance!==void 0&&(c.liability_insurance_percent=l.liabilityInsurance),l.bond!==void 0&&(c.bond_percent=l.bond),l.licenseFee!==void 0&&(c.license_fee_percent=l.licenseFee);const{data:i,error:u}=await k.from("change_orders").update(c).eq("id",r).select().single();if(u)throw u;return i}return null},async submitCORForApproval(r){if($){const{data:l,error:c}=await k.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw c;return l}return null},async approveCOR(r,l){if($){const{data:c,error:i}=await k.from("change_orders").update({status:"approved",approved_by:l,approved_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return c}return null},async rejectCOR(r,l=null){if($){const{data:c,error:i}=await k.from("change_orders").update({status:"rejected",rejection_reason:l}).eq("id",r).select().single();if(i)throw i;return c}return null},async markCORAsBilled(r){if($){const{data:l,error:c}=await k.from("change_orders").update({status:"billed"}).eq("id",r).select().single();if(c)throw c;return l}return null},async closeCOR(r){if($){const{data:l,error:c}=await k.from("change_orders").update({status:"closed"}).eq("id",r).select().single();if(c)throw c;return l}return null},async saveCORSignature(r,l,c){if($){const{data:i,error:u}=await k.from("change_orders").update({gc_signature_data:l,gc_signature_name:c,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",r).select().single();if(u)throw u;return i}return null},async getCORStats(r){if($){const{data:l,error:c}=await k.from("change_orders").select("status, cor_total").eq("project_id",r);if(c)throw c;const i={total_cors:l.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return l.forEach(u=>{switch(u.status){case"draft":i.draft_count++;break;case"pending_approval":i.pending_count++,i.total_pending_value+=u.cor_total||0;break;case"approved":i.approved_count++,i.total_approved_value+=u.cor_total||0;break;case"rejected":i.rejected_count++;break;case"billed":case"closed":i.billed_count++,i.total_billed_value+=u.cor_total||0;break}}),i}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(r,l){return $?k.channel(`change_orders:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCorTickets(r,l){return $?k.channel(`cor-tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${r}`},l).subscribe():null},async createSignatureRequest(r,l,c,i,u=null,m=null){if($){const{data:x,error:f}=await k.rpc("generate_signature_token");if(f)throw f;const{data:b,error:p}=await k.from("signature_requests").insert({document_type:r,document_id:l,company_id:c,project_id:i,signature_token:x,expires_at:m,created_by:u}).select().single();if(p)throw p;return b}return null},async getSignatureRequestByToken(r){if($){await k.rpc("increment_signature_view_count",{token:r});const{data:l,error:c}=await k.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",r).single();if(c)throw c;return l}return null},async getSignatureRequestsForDocument(r,l){if($){const{data:c,error:i}=await k.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",r).eq("document_id",l).order("created_at",{ascending:!1});if(i)throw i;return c||[]}return[]},async addSignature(r,l,c){if($){const{data:i,error:u}=await k.from("signatures").insert({signature_request_id:r,signature_slot:l,signature_image:c.signature,signer_name:c.signerName,signer_title:c.signerTitle||null,signer_company:c.signerCompany||null,signed_at:c.signedAt||new Date().toISOString(),ip_address:c.ipAddress||null,user_agent:c.userAgent||null}).select().single();if(u)throw u;return i}return null},async syncSignatureToDocument(r,l){if(!$)return null;const{document_type:c,document_id:i}=l,u=r.signature_slot,m={};u===1?(m.gc_signature_data=r.signature_image,m.gc_signature_name=r.signer_name,m.gc_signature_title=r.signer_title,m.gc_signature_company=r.signer_company,m.gc_signature_date=r.signed_at,m.gc_signature_ip=r.ip_address):u===2&&(m.client_signature_data=r.signature_image,m.client_signature_name=r.signer_name,m.client_signature_title=r.signer_title,m.client_signature_company=r.signer_company,m.client_signature_date=r.signed_at,m.client_signature_ip=r.ip_address);const x=c==="cor"?"change_orders":"t_and_m_tickets",{data:f,error:b}=await k.from(x).update(m).eq("id",i).select().single();if(b)throw b;return f},async revokeSignatureRequest(r){if($){const{data:l,error:c}=await k.from("signature_requests").update({status:"revoked"}).eq("id",r).select().single();if(c)throw c;return l}return null},async getDocumentForSigning(r,l){if(!$)return null;if(r==="cor"){const{data:c,error:i}=await k.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",l).single();if(i)throw i;return c}else if(r==="tm_ticket"){const{data:c,error:i}=await k.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (*)
        `).eq("id",l).single();if(i)throw i;return c}return null},async getProjectCosts(r){if($){const{data:c,error:i}=await k.from("project_costs").select("*").eq("project_id",r).order("cost_date",{ascending:!1});return i?(console.error("Error fetching project costs:",i),[]):c||[]}return(Ie().projectCosts||[]).filter(c=>c.project_id===r).sort((c,i)=>new Date(i.cost_date)-new Date(c.cost_date))},async addProjectCost(r,l,c){const i={project_id:r,company_id:l,category:c.category,description:c.description,amount:parseFloat(c.amount),cost_date:c.cost_date||new Date().toISOString().split("T")[0],notes:c.notes||null,created_by:c.created_by||null};if($){const{data:x,error:f}=await k.from("project_costs").insert(i).select().single();if(f)throw console.error("Error adding project cost:",f),f;return x}const u=Ie();u.projectCosts||(u.projectCosts=[]);const m={...i,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return u.projectCosts.push(m),Ct(u),m},async updateProjectCost(r,l){const c={category:l.category,description:l.description,amount:parseFloat(l.amount),cost_date:l.cost_date,notes:l.notes||null,updated_at:new Date().toISOString()};if($){const{data:m,error:x}=await k.from("project_costs").update(c).eq("id",r).select().single();if(x)throw console.error("Error updating project cost:",x),x;return m}const i=Ie();if(!i.projectCosts)return null;const u=i.projectCosts.findIndex(m=>m.id===r);return u===-1?null:(i.projectCosts[u]={...i.projectCosts[u],...c},Ct(i),i.projectCosts[u])},async deleteProjectCost(r){if($){const{error:c}=await k.from("project_costs").delete().eq("id",r);if(c)throw console.error("Error deleting project cost:",c),c;return!0}const l=Ie();return l.projectCosts&&(l.projectCosts=l.projectCosts.filter(c=>c.id!==r),Ct(l)),!0},async getProjectCostsSummary(r){const l=await this.getProjectCosts(r),c={};let i=0;return l.forEach(u=>{const m=parseFloat(u.amount)||0;i+=m,c[u.category]||(c[u.category]={category:u.category,total:0,count:0,items:[]}),c[u.category].total+=m,c[u.category].count++,c[u.category].items.push(u)}),Object.values(c).forEach(u=>{u.percentage=i>0?u.total/i*100:0}),{totalCost:i,byCategory:c,itemCount:l.length}}};lf(async r=>{if(r&&$){console.log("Back online - syncing pending actions...");try{const l=await tj(K);l.synced>0&&console.log(`Synced ${l.synced} pending actions`),l.failed>0&&console.warn(`Failed to sync ${l.failed} actions`)}catch(l){console.error("Error syncing pending actions:",l)}}});const df=g.createContext(),Za={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function qn({children:r,companyId:l}){const[c,i]=g.useState(Za),[u,m]=g.useState(!0);g.useEffect(()=>{l?x(l):f()},[l]),g.useEffect(()=>{j(c)},[c]);const x=async v=>{try{if(m(!0),!$){i(Za),m(!1);return}const{data:H,error:B}=await k.from("company_branding").select("*").eq("company_id",v).single();B?(B.code==="PGRST116"?await b(v):console.error("Error loading branding:",B),i(Za)):i({...Za,...H})}catch(H){console.error("Error in loadBranding:",H),i(Za)}finally{m(!1)}},f=async()=>{try{m(!0);const v=window.location.hostname;if(v==="localhost"||v==="127.0.0.1"){i(Za),m(!1);return}if(!$){i(Za),m(!1);return}const{data:H,error:B}=await k.rpc("get_branding_by_domain",{domain_name:v});B||!H||H.length===0?i(Za):i({...Za,...H[0]})}catch(v){console.error("Error loading branding by domain:",v),i(Za)}finally{m(!1)}},b=async v=>{try{const{data:H,error:B}=await k.from("company_branding").insert({company_id:v,...Za}).select().single();B&&console.error("Error creating default branding:",B)}catch(H){console.error("Error in createDefaultBranding:",H)}},p=async v=>{try{if(!$)return i(C=>({...C,...v})),{success:!0};if(!l)return{success:!1,error:"No company ID"};const H={},B=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const C of B)v[C]!==void 0&&(H[C]=v[C]);const{data:I,error:ae}=await k.from("company_branding").select("id").eq("company_id",l).single();if(ae&&ae.code==="PGRST116"){const{data:C,error:ee}=await k.from("company_branding").insert({company_id:l,...H}).select().single();return ee?(console.error("Error creating branding:",ee),{success:!1,error:ee.message}):(i({...Za,...C}),{success:!0,data:C})}const{data:G,error:O}=await k.from("company_branding").update(H).eq("company_id",l).select().single();return O?(console.error("Error updating branding:",O),{success:!1,error:O.message}):(i({...Za,...G}),{success:!0,data:G})}catch(H){return console.error("Error in updateBranding:",H),{success:!1,error:H.message}}},j=v=>{const H=document.documentElement;if(H.style.setProperty("--primary-color",v.primary_color),H.style.setProperty("--secondary-color",v.secondary_color),v.favicon_url){let B=document.querySelector("link[rel*='icon']");B||(B=document.createElement("link"),B.rel="icon",document.head.appendChild(B)),B.href=v.favicon_url}document.title=v.custom_app_name||"FieldSync"},S={branding:c,loading:u,updateBranding:p,uploadBrandingImage:async(v,H)=>{try{if(!$)return{success:!0,url:URL.createObjectURL(v)};const B=v.name.split(".").pop(),ae=`branding/${`${l}/${H}-${Date.now()}.${B}`}`,{data:G,error:O}=await k.storage.from("public").upload(ae,v,{cacheControl:"3600",upsert:!0});if(O)return console.error("Error uploading image:",O),{success:!1,error:O.message};const{data:{publicUrl:C}}=k.storage.from("public").getPublicUrl(ae);return{success:!0,url:C}}catch(B){return console.error("Error in uploadBrandingImage:",B),{success:!1,error:B.message}}},refreshBranding:()=>l?x(l):f()};return e.jsx(df.Provider,{value:S,children:r})}function Cr(){const r=g.useContext(df);if(!r)throw new Error("useBranding must be used within a BrandingProvider");return r}const uf=g.createContext();function Ln({children:r}){const[l,c]=g.useState(()=>{const u=localStorage.getItem("fieldsync-theme");return u==="light"||u==="dark"?u:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"});g.useEffect(()=>{document.documentElement.setAttribute("data-theme",l),localStorage.setItem("fieldsync-theme",l)},[l]),g.useEffect(()=>{const u=window.matchMedia("(prefers-color-scheme: light)"),m=x=>{localStorage.getItem("fieldsync-theme")||c(x.matches?"light":"dark")};return u.addEventListener("change",m),()=>u.removeEventListener("change",m)},[]);const i=()=>{c(u=>u==="dark"?"light":"dark")};return e.jsx(uf.Provider,{value:{theme:l,setTheme:c,toggleTheme:i},children:r})}function rj(){const r=g.useContext(uf);if(!r)throw new Error("useTheme must be used within a ThemeProvider");return r}const lj=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ij=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(l,c,i)=>i?i.toUpperCase():c.toLowerCase()),Ap=r=>{const l=ij(r);return l.charAt(0).toUpperCase()+l.slice(1)},mf=(...r)=>r.filter((l,c,i)=>!!l&&l.trim()!==""&&i.indexOf(l)===c).join(" ").trim(),cj=r=>{for(const l in r)if(l.startsWith("aria-")||l==="role"||l==="title")return!0};var oj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const dj=g.forwardRef(({color:r="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:i,className:u="",children:m,iconNode:x,...f},b)=>g.createElement("svg",{ref:b,...oj,width:l,height:l,stroke:r,strokeWidth:i?Number(c)*24/Number(l):c,className:mf("lucide",u),...!m&&!cj(f)&&{"aria-hidden":"true"},...f},[...x.map(([p,j])=>g.createElement(p,j)),...Array.isArray(m)?m:[m]]));const He=(r,l)=>{const c=g.forwardRef(({className:i,...u},m)=>g.createElement(dj,{ref:m,iconNode:l,className:mf(`lucide-${lj(Ap(r))}`,`lucide-${r}`,i),...u}));return c.displayName=Ap(r),c};const uj=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],mj=He("bell",uj);const hj=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],_l=He("briefcase",hj);const pj=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],$i=He("building-2",pj);const fj=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],gj=He("building",fj);const xj=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],kr=He("calendar",xj);const jj=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],$n=He("camera",jj);const vj=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ta=He("check",vj);const yj=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Da=He("chevron-down",yj);const bj=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Hs=He("chevron-right",bj);const _j=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],hf=He("chevron-up",_j);const Nj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],jn=He("circle-alert",Nj);const Sj=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ja=He("circle-check-big",Sj);const wj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],od=He("circle-check",wj);const Cj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],zp=He("circle-x",Cj);const kj=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],cs=He("clipboard-list",kj);const Ej=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],xn=He("clock",Ej);const Dj=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],wd=He("copy",Dj);const Mj=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],wr=He("dollar-sign",Mj);const Tj=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],pf=He("download",Tj);const Aj=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],ff=He("ellipsis",Aj);const zj=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Op=He("external-link",zj);const Oj=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Rj=He("eye",Oj);const qj=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Aa=He("file-text",qj);const Lj=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],Uj=He("flame",Lj);const Hj=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Fj=He("folder-plus",Hj);const Bj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],$j=He("globe",Bj);const Vj=[["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["rect",{x:"2",y:"15",width:"20",height:"4",rx:"1",key:"g3x8cw"}]],Ea=He("hard-hat",Vj);const Gj=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Pj=He("image",Gj);const Yj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Cd=He("info",Yj);const Qj=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Rp=He("layout-grid",Qj);const Xj=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Ij=He("link-2",Xj);const Zj=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Ad=He("link",Zj);const Jj=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],qi=He("loader-circle",Jj);const Wj=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],qp=He("lock",Wj);const Kj=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],ev=He("map-pin",Kj);const tv=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],gf=He("message-square",tv);const av=[["path",{d:"M5 12h14",key:"1ays0h"}]],kd=He("minus",av);const sv=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],nv=He("moon",sv);const rv=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],vn=He("package",rv);const lv=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],yl=He("pen-line",lv);const iv=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],dd=He("pen-tool",iv);const cv=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],zd=He("pen",cv);const ov=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Od=He("pencil",ov);const dv=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],uv=He("percent",dv);const mv=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],hv=He("phone",mv);const pv=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],vs=He("plus",pv);const fv=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],xf=He("refresh-cw",fv);const gv=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],bl=He("rotate-ccw",gv);const xv=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],jv=He("save",xv);const vv=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Vi=He("search",vv);const yv=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Rd=He("send",yv);const bv=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Pi=He("shield",bv);const _v=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ed=He("square-check-big",_v);const Nv=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Sv=He("square",Nv);const wv=[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]],Cv=He("stamp",wv);const kv=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Ev=He("sun",kv);const Dv=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Us=He("trash-2",Dv);const Mv=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],jf=He("trending-down",Mv);const Tv=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],vf=He("trending-up",Tv);const Av=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Er=He("triangle-alert",Av);const zv=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],ds=He("truck",zv);const Ov=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Rv=He("upload",Ov);const qv=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],yf=He("user-check",qv);const Lv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],bf=He("user-minus",Lv);const Uv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Hv=He("user-plus",Uv);const Fv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Bv=He("user-x",Fv);const $v=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],qd=He("user",$v);const Vv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Fs=He("users",Vv);const Gv=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],Nl=He("wrench",Gv);const Pv=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],za=He("x",Pv);const Yv=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Dd=He("zap",Yv);function ps({className:r="",showPoweredBy:l=!1}){const{branding:c}=Cr();return e.jsxs("div",{className:`app-logo ${r}`,children:[c.logo_url?e.jsx("img",{src:c.logo_url,alt:c.custom_app_name||"Logo",className:"custom-logo"}):e.jsxs("div",{className:"logo",children:[c.custom_app_name||"Field",e.jsx("span",{children:"Sync"})]}),l&&!c.hide_fieldsync_branding&&e.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function Qv({onForemanAccess:r,onOfficeLogin:l,onShowToast:c}){const[i,u]=g.useState(null),[m,x]=g.useState(""),[f,b]=g.useState(null),[p,j]=g.useState(""),[R,S]=g.useState(!1),[v,H]=g.useState(""),[B,I]=g.useState(""),[ae,G]=g.useState(1),[O,C]=g.useState(null),[ee,me]=g.useState(""),[te,P]=g.useState(""),[V,ie]=g.useState(""),[D,y]=g.useState(""),z=A=>{const xe=A.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);x(xe)},L=async()=>{if(m.length<2){c("Enter company code","error");return}S(!0);try{const A=await K.getCompanyByCode(m);A?b(A):(c("Invalid company code","error"),x(""))}catch{c("Error checking code","error")}finally{S(!1)}},J=async A=>{if(A.length===4){S(!0);try{const xe=await K.getProjectByPinAndCompany(A,f.id);xe?r(xe):(c("Invalid PIN","error"),j(""))}catch{c("Error checking PIN","error")}finally{S(!1)}}},w=A=>{if(p.length<4){const xe=p+A;j(xe),xe.length===4&&setTimeout(()=>J(xe),200)}},Z=()=>{j(A=>A.slice(0,-1))},M=()=>{b(null),j("")},oe=()=>{if(!v.trim()||!B.trim()){c("Enter email and password","error");return}l(v,B)},E=async()=>{if(m.length<2){c("Enter company code","error");return}S(!0);try{const A=await K.getCompanyByCode(m);A?(C(A),G(2)):(c("Invalid company code","error"),x(""))}catch{c("Error checking code","error")}finally{S(!1)}},U=async()=>{if(!ee.trim()){c("Enter office code","error");return}S(!0);try{const{data:A,error:xe}=await k.rpc("verify_office_code",{company_id:O.id,code:ee.trim()});if(xe)throw xe;A===!0?G(3):(c("Invalid office code","error"),me(""))}catch{c("Error verifying code","error")}finally{S(!1)}},de=async()=>{if(!te.trim()){c("Enter your name","error");return}if(!V.trim()||!V.includes("@")){c("Enter valid email","error");return}if(D.length<6){c("Password must be 6+ characters","error");return}S(!0);try{const A=V.toLowerCase().trim(),{data:xe,error:Q}=await k.auth.signUp({email:A,password:D});let Se;if(Q?.message?.includes("already registered")||xe?.user&&xe.user.identities?.length===0){const{data:Oe,error:Be}=await k.auth.signInWithPassword({email:A,password:D});if(Be){c("Account exists with different password. Use your existing password.","error"),S(!1);return}Se=Oe.user.id;const{data:Re}=await k.from("user_companies").select("id, status").eq("user_id",Se).eq("company_id",O.id).maybeSingle();if(Re){Re.status==="active"?(c("You already belong to this company. Logging you in...","success"),setTimeout(()=>window.location.reload(),1e3)):Re.status==="pending"?(c("Your request is still pending approval.","error"),await k.auth.signOut()):(c("Your membership was removed. Contact the company admin.","error"),await k.auth.signOut());return}const{error:ze}=await k.from("user_companies").insert({user_id:Se,company_id:O.id,role:"member",status:"pending"});if(ze)throw console.error("Error adding to user_companies:",ze),await k.auth.signOut(),new Error("Failed to submit join request");await k.auth.signOut(),c("Request to join submitted! Awaiting admin approval.","success")}else{if(Q)throw Q;{if(Se=xe.user?.id,!Se)throw new Error("Failed to create user");const{error:Oe}=await k.from("users").insert({id:Se,email:A,password_hash:"managed_by_supabase_auth",name:te.trim(),company_id:O.id,role:"member",is_active:!0});if(Oe)throw Oe;const{error:Be}=await k.from("user_companies").insert({user_id:Se,company_id:O.id,role:"member",status:"pending"});if(Be)throw console.error("Error adding to user_companies:",Be),new Error("Failed to submit join request");await k.auth.signOut(),c("Account created! Awaiting admin approval.","success")}}}catch(A){console.error("Join error:",A),c(A.message||"Error creating account","error")}finally{S(!1)}};if(i===null)return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsxs("div",{className:"entry-buttons",children:[e.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>u("foreman"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(Ea,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Foreman"}),e.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),e.jsxs("button",{className:"entry-mode-btn office",onClick:()=>u("office"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(_l,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Office"}),e.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(i==="foreman")return f?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:M,children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:f.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),e.jsx("div",{className:"pin-display",children:[0,1,2,3].map(A=>e.jsx("div",{className:`pin-dot ${p.length>A?"filled":""}`,children:p.length>A?"":""},A))}),e.jsxs("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map(A=>e.jsx("button",{className:"num-btn",onClick:()=>w(A.toString()),disabled:R,children:A},A)),e.jsx("button",{className:"num-btn empty",disabled:!0}),e.jsx("button",{className:"num-btn",onClick:()=>w("0"),disabled:R,children:"0"}),e.jsx("button",{className:"num-btn backspace",onClick:Z,disabled:R||p.length===0,children:""})]}),R&&e.jsx("div",{className:"entry-loading",children:e.jsx("div",{className:"spinner"})})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>u(null),children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:m,onChange:A=>z(A.target.value),placeholder:"Company Code",disabled:R,autoFocus:!0,onKeyDown:A=>{A.key==="Enter"&&L()}}),e.jsx("button",{className:"entry-submit-btn",onClick:L,disabled:R||m.length<2,children:R?"...":""})]})]})});if(i==="office")return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>u(null),children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"email",value:v,onChange:A=>H(A.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:A=>{A.key==="Enter"&&oe()}}),e.jsx("input",{type:"password",value:B,onChange:A=>I(A.target.value),placeholder:"Password",onKeyDown:A=>{A.key==="Enter"&&oe()}}),e.jsx("button",{className:"entry-login-btn",onClick:oe,children:"Sign In"})]}),e.jsxs("div",{className:"entry-signup-hint",children:[e.jsx("p",{children:"New employee?"}),e.jsx("button",{className:"entry-join-link",onClick:()=>u("join"),children:"Join your company"})]})]})});if(i==="join")return ae===1?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>u("office"),children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),e.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:m,onChange:A=>z(A.target.value),placeholder:"Company Code",disabled:R,autoFocus:!0,onKeyDown:A=>{A.key==="Enter"&&E()}}),e.jsx("button",{className:"entry-submit-btn",onClick:E,disabled:R||m.length<2,children:R?"...":""})]})]})}):ae===2?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{G(1),C(null),me("")},children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:O?.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),e.jsx("p",{className:"entry-hint",children:"This code is only for office staff"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"password",value:ee,onChange:A=>me(A.target.value),placeholder:"Office Code",disabled:R,autoFocus:!0,onKeyDown:A=>{A.key==="Enter"&&U()}}),e.jsx("button",{className:"entry-submit-btn",onClick:U,disabled:R||!ee.trim(),children:R?"...":""})]})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{G(2),me("")},children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:O?.name}),e.jsx("p",{className:"entry-subtitle",children:"Create your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"text",value:te,onChange:A=>P(A.target.value),placeholder:"Your Name",autoFocus:!0}),e.jsx("input",{type:"email",value:V,onChange:A=>ie(A.target.value),placeholder:"Email"}),e.jsx("input",{type:"password",value:D,onChange:A=>y(A.target.value),placeholder:"Password (6+ characters)",onKeyDown:A=>{A.key==="Enter"&&de()}}),e.jsx("button",{className:"entry-login-btn",onClick:de,disabled:R,children:R?"Creating...":"Join Company"})]}),e.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})})}function Pt(r){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}function Xv(r){if(!r||r.length===0)return 0;let l=0;return r.forEach(c=>{c.status==="done"&&(l+=c.weight)}),Math.round(l)}function Lp(r){if(!r||r.length===0)return{progress:0,earnedValue:0,totalValue:0,isValueBased:!1};if(r.some(i=>i.scheduled_value>0)){const i=r.reduce((x,f)=>x+(f.scheduled_value||0),0),u=r.filter(x=>x.status==="done").reduce((x,f)=>x+(f.scheduled_value||0),0);return{progress:i>0?Math.round(u/i*100):0,earnedValue:u,totalValue:i,isValueBased:!0}}const c=r.filter(i=>i.status==="done").reduce((i,u)=>i+(u.weight||0),0);return{progress:Math.round(c),earnedValue:0,totalValue:0,isValueBased:!1}}function _f(r){if(!r||r.length===0)return"not_started";const l=r.some(u=>u.status==="working"),c=r.some(u=>u.status==="done");return r.every(u=>u.status==="done")?"done":l||c?"working":"not_started"}function Iv(r){const l=_f(r);return l==="done"?"Complete":l==="working"?"In Progress":"Not Started"}function Zv(r,l=0){const c=new Date;c.setHours(0,0,0,0);const i={scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1};if(r.start_date&&r.end_date){const u=new Date(r.start_date),m=new Date(r.end_date);u.setHours(0,0,0,0),m.setHours(0,0,0,0);const x=Math.max(1,Math.ceil((m-u)/(1e3*60*60*24))),f=Math.max(0,Math.ceil((c-u)/(1e3*60*60*24))),b=Math.min(100,f/x*100),j=(r.progress||0)-b;i.scheduleVariance=Math.round(j),i.hasScheduleData=!0,j>5?(i.scheduleStatus="ahead",i.scheduleLabel=`Ahead of Schedule (+${i.scheduleVariance}%)`):j<-5?(i.scheduleStatus="behind",i.scheduleLabel=`Behind Schedule (${i.scheduleVariance}%)`):(i.scheduleStatus="on_track",i.scheduleLabel="On Track")}if(r.planned_man_days&&r.planned_man_days>0){const m=(r.progress||0)/100*r.planned_man_days;if(m>0&&l>0){const x=(l-m)/m*100;i.laborVariance=Math.round(x),i.hasLaborData=!0,x>10?(i.laborStatus="over",i.laborLabel=`Over Planned (+${i.laborVariance}% man-days)`):x<-10?(i.laborStatus="under",i.laborLabel=`Under Planned (${i.laborVariance}% man-days)`):(i.laborStatus="on_track",i.laborLabel="Labor On Track")}else l>0&&(i.hasLaborData=!0,i.laborLabel=`${l} man-days used`)}return i}function Jv(r,l=30){if(r.status==="archived"||r.progress<100)return!1;const c=r.areas||[];if(c.length===0||!c.every(x=>x.status==="done"))return!1;const u=c.reduce((x,f)=>{const b=new Date(f.updated_at);return b>x?b:x},new Date(0));return u.getTime()===0?!1:Math.floor((Date.now()-u.getTime())/(1e3*60*60*24))>=l}async function Up(r,l=1920,c=.8){return!r.type.startsWith("image/")||r.size<500*1024?r:new Promise(i=>{const u=document.createElement("canvas"),m=u.getContext("2d"),x=new Image;x.onload=()=>{let{width:f,height:b}=x;f>l&&(b=Math.round(b*l/f),f=l);const p=1920;b>p&&(f=Math.round(f*p/b),b=p),u.width=f,u.height=b,m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high",m.drawImage(x,0,0,f,b),u.toBlob(j=>{if(j){const R=r.name.replace(/\.[^/.]+$/,""),S=new File([j],`${R}.jpg`,{type:"image/jpeg",lastModified:Date.now()}),v=((1-j.size/r.size)*100).toFixed(1);console.log(`Image compressed: ${r.name} - ${(r.size/1024).toFixed(0)}KB  ${(j.size/1024).toFixed(0)}KB (${v}% smaller)`),i(S)}else console.warn("Image compression failed, using original"),i(r)},"image/jpeg",c),URL.revokeObjectURL(x.src)},x.onerror=()=>{console.warn("Failed to load image for compression, using original"),URL.revokeObjectURL(x.src),i(r)},x.src=URL.createObjectURL(r)})}const Hp=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";function Ld({documentType:r,documentId:l,companyId:c,projectId:i,documentTitle:u="",onClose:m,onShowToast:x}){const[f,b]=g.useState(!0),[p,j]=g.useState(!1),[R,S]=g.useState([]),[v,H]=g.useState(null),[B,I]=g.useState(!1),[ae,G]=g.useState("never");g.useEffect(()=>{O()},[r,l]);const O=async()=>{try{b(!0);const V=await K.getSignatureRequestsForDocument(r,l);S(V||[])}catch(V){console.error("Error loading signature requests:",V)}finally{b(!1)}},C=async()=>{try{j(!0);let V=null;if(ae!=="never"){const D=parseInt(ae);V=new Date,V.setDate(V.getDate()+D),V=V.toISOString()}const ie=await K.createSignatureRequest(r,l,c,i,null,V);if(ie){const D=`${window.location.origin}/sign/${ie.signature_token}`;H(D),await O(),x?.("Signature link created","success")}}catch(V){console.error("Error generating signature link:",V),x?.("Failed to create signature link","error")}finally{j(!1)}},ee=async V=>{try{await navigator.clipboard.writeText(V),I(!0),x?.("Link copied to clipboard","success"),setTimeout(()=>I(!1),2e3)}catch(ie){console.error("Error copying to clipboard:",ie)}},me=async V=>{if(confirm("Are you sure you want to revoke this signature link? It will no longer be usable."))try{await K.revokeSignatureRequest(V),await O(),x?.("Signature link revoked","success")}catch(ie){console.error("Error revoking signature request:",ie),x?.("Failed to revoke link","error")}},te=V=>{switch(V){case"pending":return{label:"Awaiting Signatures",color:"#f59e0b",bg:"#fef3c7"};case"partially_signed":return{label:"1 of 2 Signed",color:"#3b82f6",bg:"#dbeafe"};case"completed":return{label:"Fully Signed",color:"#10b981",bg:"#d1fae5"};case"revoked":return{label:"Revoked",color:"#ef4444",bg:"#fee2e2"};case"expired":return{label:"Expired",color:"#6b7280",bg:"#f3f4f6"};default:return{label:V,color:"#6b7280",bg:"#f3f4f6"}}},P=r==="cor"?"Change Order":"T&M Ticket";return e.jsx("div",{className:"modal-overlay",onClick:m,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content signature-link-modal",onClick:V=>V.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Get Signature Link"}),u&&e.jsx("span",{className:"modal-subtitle",children:u})]}),e.jsx("button",{className:"close-btn",onClick:m,"aria-label":"Close",children:e.jsx(za,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(Ad,{size:16}),"Create New Signature Link"]}),e.jsxs("p",{className:"section-description",children:["Generate a secure link that allows GC/Client to sign this ",P," without logging in."]}),e.jsxs("div",{className:"link-options",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("select",{value:ae,onChange:V=>G(V.target.value),disabled:p,children:[e.jsx("option",{value:"never",children:"Never expires"}),e.jsx("option",{value:"7",children:"7 days"}),e.jsx("option",{value:"30",children:"30 days"}),e.jsx("option",{value:"90",children:"90 days"})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:C,disabled:p,children:p?"Generating...":"Generate Link"})]}),v&&e.jsxs("div",{className:"new-link-box",children:[e.jsxs("div",{className:"link-display",children:[e.jsx("input",{type:"text",value:v,readOnly:!0,className:"link-input"}),e.jsxs("button",{className:"btn btn-secondary copy-btn",onClick:()=>ee(v),children:[B?e.jsx(Ta,{size:16}):e.jsx(wd,{size:16}),B?"Copied!":"Copy"]})]}),e.jsxs("a",{href:v,target:"_blank",rel:"noopener noreferrer",className:"preview-link",children:[e.jsx(Op,{size:14}),"Preview link"]})]})]}),e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(xn,{size:16}),"Existing Signature Links"]}),f?e.jsx("div",{className:"loading-inline",children:"Loading..."}):R.length===0?e.jsxs("p",{className:"empty-state",children:["No signature links have been created for this ",P,"."]}):e.jsx("div",{className:"existing-links-list",children:R.map(V=>{const ie=te(V.status),D=`${window.location.origin}/sign/${V.signature_token}`,y=V.signatures?.length||0;return e.jsxs("div",{className:"existing-link-card",children:[e.jsxs("div",{className:"link-card-header",children:[e.jsx("span",{className:"status-badge",style:{color:ie.color,backgroundColor:ie.bg},children:ie.label}),e.jsxs("span",{className:"link-created",children:["Created ",Hp(V.created_at)]})]}),e.jsxs("div",{className:"link-card-body",children:[e.jsxs("div",{className:"link-info",children:[e.jsxs("span",{className:"link-token",children:["...",V.signature_token.slice(-8)]}),V.expires_at&&e.jsxs("span",{className:"link-expires",children:["Expires ",Hp(V.expires_at)]}),e.jsxs("span",{className:"link-views",children:[V.view_count," view",V.view_count!==1?"s":""]})]}),y>0&&e.jsx("div",{className:"signatures-summary",children:V.signatures.map(z=>e.jsxs("div",{className:"sig-item",children:[e.jsx(Ta,{size:12}),e.jsxs("span",{children:["Slot ",z.signature_slot,": ",z.signer_name,z.signer_company&&` (${z.signer_company})`]})]},z.id))})]}),e.jsxs("div",{className:"link-card-actions",children:[V.status!=="revoked"&&V.status!=="expired"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>ee(D),children:[e.jsx(wd,{size:14})," Copy"]}),e.jsxs("a",{href:D,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-small",children:[e.jsx(Op,{size:14})," Open"]})]}),V.status!=="completed"&&V.status!=="revoked"&&e.jsxs("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>me(V.id),children:[e.jsx(Us,{size:14})," Revoke"]})]})]},V.id)})})]}),e.jsxs("div",{className:"signature-info-box",children:[e.jsx(jn,{size:16}),e.jsxs("div",{children:[e.jsx("strong",{children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Share the link with your GC or Client"}),e.jsx("li",{children:"They can view the document and sign without logging in"}),e.jsx("li",{children:"Supports 2 signatures (GC + Client)"}),e.jsx("li",{children:"Signatures are recorded with name, title, company, date, and IP"})]})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:m,children:"Close"})})]})})}function Wv({ticketId:r,ticketSummary:l,lang:c="en",onSave:i,onClose:u,onShowToast:m}){const x=g.useRef(null),[f,b]=g.useState(""),[p,j]=g.useState(""),[R,S]=g.useState(""),[v,H]=g.useState(!1),[B,I]=g.useState(!1),[ae,G]=g.useState(!1),O={en:{title:"Client Signature",subtitle:"Sign to verify the work performed",signerName:"Your Name",signerNamePlaceholder:"Full name",signerTitle:"Title",signerTitlePlaceholder:"e.g. Project Manager",signerCompany:"Company",signerCompanyPlaceholder:"Company name",signBelow:"Sign below",signHere:"Sign here",clear:"Clear",cancel:"Cancel",saveSignature:"Submit Signature",saving:"Saving...",workDate:"Work Date",workers:"Workers",hours:"Total Hours",certification:"By signing, I acknowledge that the work described in this T&M ticket was performed as documented.",nameRequired:"Please enter your name",signatureRequired:"Please sign above",signatureSaved:"Signature saved successfully",signatureError:"Error saving signature"},es:{title:"Firma del Cliente",subtitle:"Firme para verificar el trabajo realizado",signerName:"Su Nombre",signerNamePlaceholder:"Nombre completo",signerTitle:"Titulo",signerTitlePlaceholder:"ej. Gerente de Proyecto",signerCompany:"Empresa",signerCompanyPlaceholder:"Nombre de la empresa",signBelow:"Firme abajo",signHere:"Firme aqui",clear:"Borrar",cancel:"Cancelar",saveSignature:"Enviar Firma",saving:"Guardando...",workDate:"Fecha",workers:"Trabajadores",hours:"Horas Total",certification:"Al firmar, reconozco que el trabajo descrito en este ticket T&M fue realizado como se documenta.",nameRequired:"Por favor ingrese su nombre",signatureRequired:"Por favor firme arriba",signatureSaved:"Firma guardada exitosamente",signatureError:"Error al guardar la firma"}},C=O[c]||O.en,ee=()=>{const z=x.current;return z?z.getContext("2d"):null},me=z=>{const L=x.current;if(!L)return{x:0,y:0};const J=L.getBoundingClientRect(),w=L.width/J.width,Z=L.height/J.height,M=z.touches?z.touches[0].clientX:z.clientX,oe=z.touches?z.touches[0].clientY:z.clientY;return{x:(M-J.left)*w,y:(oe-J.top)*Z}},te=z=>{z.preventDefault();const L=ee();if(!L)return;const{x:J,y:w}=me(z);L.beginPath(),L.moveTo(J,w),I(!0),H(!0)},P=z=>{if(!B)return;z.preventDefault();const L=ee();if(!L)return;const{x:J,y:w}=me(z);L.lineTo(J,w),L.stroke()},V=()=>{I(!1)},ie=()=>{const z=x.current,L=ee();!z||!L||(L.clearRect(0,0,z.width,z.height),H(!1))},D=z=>{if(!z)return;x.current=z;const L=z.getContext("2d");L.strokeStyle="#1e293b",L.lineWidth=2,L.lineCap="round",L.lineJoin="round"},y=async()=>{if(!f.trim()){m?.(C.nameRequired,"error");return}if(!v){m?.(C.signatureRequired,"error");return}const z=x.current;if(z){G(!0);try{const L=z.toDataURL("image/png");await K.saveTMClientSignature(r,{signature:L,signerName:f.trim(),signerTitle:p.trim()||null,signerCompany:R.trim()||null,signedAt:new Date().toISOString()}),m?.(C.signatureSaved,"success"),i?.({signerName:f.trim(),signerTitle:p.trim(),signerCompany:R.trim()})}catch(L){console.error("Error saving signature:",L),m?.(C.signatureError,"error")}finally{G(!1)}}};return e.jsx("div",{className:"tm-modal-overlay",onClick:u,children:e.jsxs("div",{className:"tm-client-signature-modal",onClick:z=>z.stopPropagation(),children:[e.jsxs("div",{className:"tm-sig-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:C.title}),e.jsx("p",{className:"tm-sig-subtitle",children:C.subtitle})]}),e.jsx("button",{className:"tm-sig-close",onClick:u,children:e.jsx(za,{size:20})})]}),e.jsxs("div",{className:"tm-sig-body",children:[l&&e.jsxs("div",{className:"tm-sig-summary",children:[e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:C.workDate}),e.jsx("span",{className:"tm-sig-summary-value",children:new Date(l.workDate).toLocaleDateString()})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:C.workers}),e.jsx("span",{className:"tm-sig-summary-value",children:l.workerCount})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:C.hours}),e.jsx("span",{className:"tm-sig-summary-value",children:l.totalHours})]})]}),e.jsxs("div",{className:"tm-sig-fields",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(qd,{size:14}),C.signerName," *"]}),e.jsx("input",{type:"text",value:f,onChange:z=>b(z.target.value),placeholder:C.signerNamePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field-row",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(_l,{size:14}),C.signerTitle]}),e.jsx("input",{type:"text",value:p,onChange:z=>j(z.target.value),placeholder:C.signerTitlePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(gj,{size:14}),C.signerCompany]}),e.jsx("input",{type:"text",value:R,onChange:z=>S(z.target.value),placeholder:C.signerCompanyPlaceholder})]})]})]}),e.jsxs("div",{className:"tm-sig-area",children:[e.jsxs("div",{className:"tm-sig-label",children:[e.jsx(zd,{size:14}),e.jsx("span",{children:C.signBelow})]}),e.jsxs("div",{className:"tm-sig-canvas-container",children:[e.jsx("canvas",{ref:D,width:500,height:180,className:"tm-sig-canvas",onMouseDown:te,onMouseMove:P,onMouseUp:V,onMouseLeave:V,onTouchStart:te,onTouchMove:P,onTouchEnd:V}),!v&&e.jsx("div",{className:"tm-sig-placeholder",children:C.signHere})]}),e.jsxs("button",{className:"tm-sig-clear",onClick:ie,disabled:!v,children:[e.jsx(bl,{size:14})," ",C.clear]})]}),e.jsx("p",{className:"tm-sig-certification",children:C.certification})]}),e.jsxs("div",{className:"tm-sig-footer",children:[e.jsx("button",{className:"tm-sig-btn secondary",onClick:u,disabled:ae,children:C.cancel}),e.jsx("button",{className:"tm-sig-btn primary",onClick:y,disabled:!v||!f.trim()||ae,children:ae?C.saving:e.jsxs(e.Fragment,{children:[e.jsx(Ta,{size:16})," ",C.saveSignature]})})]})]})})}const ud=["Containment","PPE","Disposal","Equipment"],Kv={en:{workInfo:"Work Info",crewHours:"Crew & Hours",materialsEquipment:"Materials",review:"Review",quickActions:"Quick Actions",sameAsYesterday:"Same as Yesterday",setCrewHours:"Set Crew Hours",loading:"Loading...",supervision:"Supervision",operators:"Operators",laborers:"Laborers",addSupervision:"+ Add Supervision",addOperator:"+ Add Operator",addLaborer:"+ Add Laborer",foreman:"Foreman",superintendent:"Superintendent",firstLastName:"First & Last Name",start:"Start",end:"End",regHrs:"Reg Hrs",otHrs:"OT Hrs",selectCategory:"Select a category:",addCustomItem:"+ Add Custom Item",customItem:"Custom Item",itemName:"Item Name",category:"Category",quantity:"Quantity",addItem:"Add Item",cancel:"Cancel",noItemsCategory:"No items in this category yet",workDate:"Work Date",ceNumber:"CE/PCO #",optional:"optional",linkedCOR:"Link to Change Order",selectCOR:"Select COR (optional)",noCORs:"No pending CORs",laborSummary:"Labor Summary",worker:"worker",workers_plural:"workers",totalHours:"Total Hours",regular:"Regular",overtime:"Overtime",materials:"Materials",item:"item",items_plural:"items",noMaterials:"No materials added",notes:"Notes",addNotes:"Add notes about the work performed...",photos:"Photos",addPhotos:"Add Photos",maxPhotos:"max",noPhotos:"No photos added",certification:"Certification",certifyStatement:"I certify that this T&M ticket accurately reflects the work performed.",foremanSignature:"Foreman's Name (Signature)",yourName:"Your name",describeWork:"Describe the work performed",descriptionRequired:"Description is required",whatWorkPerformed:"What work was performed today?",searchMaterials:"Search materials & equipment...",noSearchResults:"No items found",orBrowse:"Or browse by category:",back:"Back",next:"Next",nextCrew:"Next: Crew",nextMaterials:"Next: Materials",reviewItems:"Review",skipNoMaterials:"Skip (no materials)",submitTM:"Submit T&M",submitting:"Submitting...",applySameHours:"Apply Same Hours",batchDescription:"Set start/end time and hours for all workers with names entered.",timeStarted:"Time Started",timeEnded:"Time Ended",regularHours:"Regular Hours",overtimeHours:"Overtime Hours",willApplyTo:"Will apply to",applyToAll:"Apply to All",preset8hr:"8hr Day",preset10hr:"10hr Day",preset4hr:"4hr Day",loadedWorkers:"Loaded {count} workers from {date}",noPreviousCrew:"No previous crew found for this project",appliedHours:"Applied hours to {count} worker(s)",assignedToCOR:"Assigned to COR"},es:{workInfo:"Info del Trabajo",crewHours:"Cuadrilla y Horas",materialsEquipment:"Materiales",review:"Revisar",quickActions:"Acciones Rapidas",sameAsYesterday:"Igual que Ayer",setCrewHours:"Poner Horas",loading:"Cargando...",supervision:"Supervision",operators:"Operadores",laborers:"Trabajadores",addSupervision:"+ Agregar Supervision",addOperator:"+ Agregar Operador",addLaborer:"+ Agregar Trabajador",foreman:"Capataz",superintendent:"Superintendente",firstLastName:"Nombre y Apellido",start:"Inicio",end:"Fin",regHrs:"Hrs Reg",otHrs:"Hrs Extra",selectCategory:"Seleccione una categoria:",addCustomItem:"+ Agregar Articulo",customItem:"Articulo Personalizado",itemName:"Nombre del Articulo",category:"Categoria",quantity:"Cantidad",addItem:"Agregar",cancel:"Cancelar",noItemsCategory:"No hay articulos en esta categoria",workDate:"Fecha de Trabajo",ceNumber:"CE/PCO #",optional:"opcional",linkedCOR:"Vincular a Orden de Cambio",selectCOR:"Seleccionar COR (opcional)",noCORs:"No hay CORs pendientes",laborSummary:"Resumen de Mano de Obra",worker:"trabajador",workers_plural:"trabajadores",totalHours:"Horas Totales",regular:"Regular",overtime:"Extra",materials:"Materiales",item:"articulo",items_plural:"articulos",noMaterials:"No se agregaron materiales",notes:"Notas",addNotes:"Agregar notas sobre el trabajo realizado...",photos:"Fotos",addPhotos:"Agregar Fotos",maxPhotos:"max",noPhotos:"No se agregaron fotos",certification:"Certificacion",certifyStatement:"Certifico que este ticket T&M refleja con precision el trabajo realizado.",foremanSignature:"Nombre del Capataz (Firma)",yourName:"Su nombre",describeWork:"Describir el trabajo realizado",descriptionRequired:"Descripcion es requerida",whatWorkPerformed:"Que trabajo se realizo hoy?",searchMaterials:"Buscar materiales y equipo...",noSearchResults:"No se encontraron articulos",orBrowse:"O navegar por categoria:",back:"Atras",next:"Siguiente",nextCrew:"Siguiente: Cuadrilla",nextMaterials:"Siguiente: Materiales",reviewItems:"Revisar",skipNoMaterials:"Saltar (sin materiales)",submitTM:"Enviar T&M",submitting:"Enviando...",applySameHours:"Aplicar Mismas Horas",batchDescription:"Establezca hora de inicio/fin y horas para todos los trabajadores.",timeStarted:"Hora de Inicio",timeEnded:"Hora de Fin",regularHours:"Horas Regulares",overtimeHours:"Horas Extra",willApplyTo:"Se aplicara a",applyToAll:"Aplicar a Todos",preset8hr:"Dia 8hr",preset10hr:"Dia 10hr",preset4hr:"Dia 4hr",loadedWorkers:"Se cargaron {count} trabajadores del {date}",noPreviousCrew:"No se encontro equipo anterior para este proyecto",appliedHours:"Horas aplicadas a {count} trabajador(es)",assignedToCOR:"Asignado a COR"}};function ey({project:r,companyId:l,maxPhotos:c=10,onSubmit:i,onCancel:u,onShowToast:m}){const[x,f]=g.useState(1),[b,p]=g.useState(new Date().toISOString().split("T")[0]),[j,R]=g.useState(null),[S,v]=g.useState(!1),[H,B]=g.useState(!1),[I,ae]=g.useState(!1),[G,O]=g.useState(""),[C,ee]=g.useState(""),[me,te]=g.useState(""),[P,V]=g.useState([]),[ie,D]=g.useState(!1),[y,z]=g.useState(!1),[L,J]=g.useState({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),[w,Z]=g.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}]),[M,oe]=g.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[E,U]=g.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[de,A]=g.useState([]),[xe,Q]=g.useState(""),[Se,he]=g.useState([]),[Oe,Be]=g.useState(!1),[Re,ze]=g.useState(""),[pt,rt]=g.useState([]),[se,Ae]=g.useState(!1),[Ye,ft]=g.useState(null),[ja,Ce]=g.useState([]),[qe,Fe]=g.useState(!1),[Ze,Ke]=g.useState(""),[et,Me]=g.useState([]),[bt,kt]=g.useState([]),[Mt,Gt]=g.useState(!1),[Et,aa]=g.useState({name:"",category:"",quantity:""}),[da,St]=g.useState(!1),[Je,qt]=g.useState("en"),Ee=N=>Kv[Je][N]||N,Y=(N,ne)=>{if(!N||!ne)return null;const[be,re]=N.split(":").map(Number),[Ge,Ue]=ne.split(":").map(Number);let gt=Ge*60+Ue-(be*60+re);gt<0&&(gt+=1440);const Qe=gt/60,ua=Math.min(Qe,8),Ka=Math.max(0,Qe-8);return{hours:ua.toFixed(1),overtimeHours:Ka>0?Ka.toFixed(1):""}},q=N=>{const ne=N.name.trim()!=="",be=parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0;return ne?be?"complete":"incomplete":"empty"},we=N=>{let ne,be,re,Ge;switch(N){case"full":ne="07:00",be="15:30",re="8",Ge="";break;case"10hr":ne="06:00",be="16:30",re="8",Ge="2";break;case"half":ne="07:00",be="11:00",re="4",Ge="";break;default:return}J({timeStarted:ne,timeEnded:be,hours:re,overtimeHours:Ge})};g.useEffect(()=>{at(),lt()},[r.id]);const lt=async()=>{D(!0);try{const N=await K.getAssignableCORs(r.id);V(N||[])}catch(N){console.error("Error loading assignable CORs:",N)}finally{D(!1)}},De=()=>{const{timeStarted:N,timeEnded:ne,hours:be,overtimeHours:re}=L;Z(w.map(Ue=>Ue.name.trim()?{...Ue,timeStarted:N,timeEnded:ne,hours:be,overtimeHours:re}:Ue)),oe(M.map(Ue=>Ue.name.trim()?{...Ue,timeStarted:N,timeEnded:ne,hours:be,overtimeHours:re}:Ue)),U(E.map(Ue=>Ue.name.trim()?{...Ue,timeStarted:N,timeEnded:ne,hours:be,overtimeHours:re}:Ue));const Ge=[...w.filter(Ue=>Ue.name.trim()),...M.filter(Ue=>Ue.name.trim()),...E.filter(Ue=>Ue.name.trim())].length;z(!1),J({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),m(`Applied hours to ${Ge} worker${Ge!==1?"s":""}`,"success")},ve=N=>{let ne,be,re,Ge;switch(N){case"8hr":ne="07:00",be="15:30",re="8",Ge="";break;case"10hr":ne="06:00",be="16:30",re="8",Ge="2";break;case"4hr":ne="07:00",be="11:00",re="4",Ge="";break;default:return}Z(gt=>gt.map(Qe=>Qe.name.trim()?{...Qe,timeStarted:ne,timeEnded:be,hours:re,overtimeHours:Ge}:Qe)),oe(gt=>gt.map(Qe=>Qe.name.trim()?{...Qe,timeStarted:ne,timeEnded:be,hours:re,overtimeHours:Ge}:Qe)),U(gt=>gt.map(Qe=>Qe.name.trim()?{...Qe,timeStarted:ne,timeEnded:be,hours:re,overtimeHours:Ge}:Qe));const Ue=[...w.filter(gt=>gt.name.trim()),...M.filter(gt=>gt.name.trim()),...E.filter(gt=>gt.name.trim())].length;Ue>0?m(Ee("appliedHours").replace("{count}",Ue),"success"):m(Je==="en"?"Add workers first":"Agregue trabajadores primero","info")},at=async()=>{try{const N=await K.getCrewCheckin(r.id);N?.workers&&rt(N.workers)}catch(N){console.error("Error loading crew:",N)}};g.useEffect(()=>{Ye&&l&&ot(Ye)},[Ye,l]);const ot=async N=>{Fe(!0);try{const ne=await K.getMaterialsEquipmentByCategory(l,N);Ce(ne)}catch(ne){console.error("Error loading items:",ne),m("Error loading items","error")}finally{Fe(!1)}},Yt=async()=>{if(!(bt.length>0))try{const N=[];for(const ne of ud){const be=await K.getMaterialsEquipmentByCategory(l,ne);N.push(...be.map(re=>({...re,category:ne})))}kt(N)}catch(N){console.error("Error loading all materials:",N)}},sa=N=>{if(Ke(N),!N.trim()){Me([]);return}const ne=N.toLowerCase(),be=bt.filter(re=>re.name.toLowerCase().includes(ne)||re.category.toLowerCase().includes(ne));Me(be.slice(0,10))},Ne=async()=>{St(!0);try{const N=await K.getPreviousTicketCrew(r.id,b);if(!N||N.totalWorkers===0){m("No previous crew found for this project","info");return}N.supervision&&Z(N.supervision),N.operators&&oe(N.operators),N.laborers&&U(N.laborers);const ne=new Date(N.workDate).toLocaleDateString();m(`Loaded ${N.totalWorkers} workers from ${ne}`,"success")}catch(N){console.error("Error loading previous crew:",N),m("Error loading previous crew","error")}finally{St(!1)}},xt=()=>{Z([...w,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},dt=(N,ne,be)=>{Z(w.map((re,Ge)=>{if(Ge!==N)return re;const Ue={...re,[ne]:be};if(ne==="timeStarted"||ne==="timeEnded"){const gt=ne==="timeStarted"?be:re.timeStarted,Qe=ne==="timeEnded"?be:re.timeEnded,ua=Y(gt,Qe);ua&&(Ue.hours=ua.hours,Ue.overtimeHours=ua.overtimeHours)}return Ue}))},Oa=N=>{w.length>1?Z(w.filter((ne,be)=>be!==N)):Z([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},ke=()=>{U([...E,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},T=(N,ne,be)=>{U(E.map((re,Ge)=>{if(Ge!==N)return re;const Ue={...re,[ne]:be};if(ne==="timeStarted"||ne==="timeEnded"){const gt=ne==="timeStarted"?be:re.timeStarted,Qe=ne==="timeEnded"?be:re.timeEnded,ua=Y(gt,Qe);ua&&(Ue.hours=ua.hours,Ue.overtimeHours=ua.overtimeHours)}return Ue}))},ge=N=>{E.length>1?U(E.filter((ne,be)=>be!==N)):U([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},fe=()=>{oe([...M,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Te=(N,ne,be)=>{oe(M.map((re,Ge)=>{if(Ge!==N)return re;const Ue={...re,[ne]:be};if(ne==="timeStarted"||ne==="timeEnded"){const gt=ne==="timeStarted"?be:re.timeStarted,Qe=ne==="timeEnded"?be:re.timeEnded,ua=Y(gt,Qe);ua&&(Ue.hours=ua.hours,Ue.overtimeHours=ua.overtimeHours)}return Ue}))},jt=N=>{M.length>1?oe(M.filter((ne,be)=>be!==N)):oe([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},it=N=>{const ne=de.findIndex(be=>be.material_equipment_id===N.id);ne>=0?A(de.map((be,re)=>re===ne?{...be,quantity:be.quantity+1}:be)):A([...de,{material_equipment_id:N.id,name:N.name,unit:N.unit,category:N.category,quantity:1,isCustom:!1}]),m(`Added ${N.name}`,"success")},Dt=()=>{if(!Et.name||!Et.category||!Et.quantity){m("Fill in all fields","error");return}A([...de,{material_equipment_id:null,custom_name:Et.name,custom_category:Et.category,name:Et.name,category:Et.category,quantity:parseFloat(Et.quantity),unit:"each",isCustom:!0}]),aa({name:"",category:"",quantity:""}),Gt(!1),ft(null),m("Custom item added","success")},ct=(N,ne)=>{const be=parseFloat(ne)||0;be<=0?mt(N):A(de.map((re,Ge)=>Ge===N?{...re,quantity:be}:re))},mt=N=>{A(de.filter((ne,be)=>be!==N))},va=N=>{const ne=Array.from(N.target.files);if(ne.length===0)return;const be=c===-1?1/0:c-Se.length;if(be<=0){m(`Photo limit reached (${c} max)`,"error"),N.target.value="";return}const re=ne.slice(0,be);re.length<ne.length&&m(`Only ${re.length} photo(s) added (${c} max)`,"error"),re.forEach(Ge=>{if(!Ge.type.startsWith("image/")){m("Please select an image file","error");return}const Ue=URL.createObjectURL(Ge),gt=`photo-${Date.now()}-${Math.random().toString(36).substring(7)}`;he(Qe=>[...Qe,{id:Date.now()+Math.random(),tempId:gt,file:Ge,previewUrl:Ue,name:Ge.name,status:"pending",attempts:0,error:null,uploadedUrl:null}])}),N.target.value=""},Qt=(N,ne)=>{he(be=>be.map(re=>re.id===N?{...re,...ne}:re))},Na=async(N,ne)=>{const be=Se.find(re=>re.id===N);if(!(!be||be.status!=="failed")){Qt(N,{status:"compressing",error:null});try{let re=be.file;try{re=await Up(be.file)}catch(Ue){console.warn("Compression failed, using original:",Ue)}Qt(N,{status:"uploading"});const Ge=await K.uploadPhoto(l,r.id,ne,re);Qt(N,{status:"confirmed",uploadedUrl:Ge,attempts:be.attempts+1}),await K.updateTMTicketPhotos(ne,[...Se.filter(Ue=>Ue.uploadedUrl).map(Ue=>Ue.uploadedUrl),Ge]),m("Photo uploaded successfully","success")}catch(re){console.error("Retry failed:",re),Qt(N,{status:"failed",error:re.message||"Upload failed",attempts:be.attempts+1}),m("Photo retry failed","error")}}},$e=N=>{const ne=Se.find(be=>be.id===N);ne?.previewUrl&&URL.revokeObjectURL(ne.previewUrl),he(Se.filter(be=>be.id!==N))},st=()=>{if(x===1)return xe.trim().length>0;if(x===2){const N=w.some(re=>re.name.trim()&&(parseFloat(re.hours)>0||parseFloat(re.overtimeHours)>0)),ne=M.some(re=>re.name.trim()&&(parseFloat(re.hours)>0||parseFloat(re.overtimeHours)>0)),be=E.some(re=>re.name.trim()&&(parseFloat(re.hours)>0||parseFloat(re.overtimeHours)>0));return N||ne||be}return!0},Xt=()=>{x<4&&f(x+1)},ya=()=>{Ye?(ft(null),Gt(!1)):Mt?Gt(!1):x>1?f(x-1):u()},Ba=async()=>{if(!C.trim()){m("Enter your name to submit","error");return}const N=w.filter(re=>re.name.trim()&&(parseFloat(re.hours)>0||parseFloat(re.overtimeHours)>0)),ne=M.filter(re=>re.name.trim()&&(parseFloat(re.hours)>0||parseFloat(re.overtimeHours)>0)),be=E.filter(re=>re.name.trim()&&(parseFloat(re.hours)>0||parseFloat(re.overtimeHours)>0));if(N.length===0&&ne.length===0&&be.length===0){m("Add at least one worker","error");return}Be(!0),ze("Creating ticket...");try{const re=await K.createTMTicket({project_id:r.id,work_date:b,ce_pco_number:G.trim()||null,assigned_cor_id:me||null,notes:xe.trim()||null,photos:[],created_by_name:C.trim()});let Ge=[];const Ue=Se.filter(Qe=>Qe.status==="pending");if(Ue.length>0){ze(`Compressing ${Ue.length} photo${Ue.length>1?"s":""}...`),Ue.forEach(Kt=>Qt(Kt.id,{status:"compressing"}));const Qe=await Promise.all(Ue.map(async Kt=>{try{const ea=await Up(Kt.file);return{...Kt,file:ea}}catch(ea){return console.warn(`Failed to compress photo ${Kt.name}, using original:`,ea),Kt}}));ze(`Uploading ${Ue.length} photo${Ue.length>1?"s":""}...`),Ue.forEach(Kt=>Qt(Kt.id,{status:"uploading"}));let ua=0,Ka=0;const Sl=Qe.map(async Kt=>{try{const ea=await K.uploadPhoto(l,r.id,re.id,Kt.file);return ua++,ze(`Uploading ${ua}/${Ue.length} photos...`),console.log(`Photo ${Kt.name} uploaded successfully:`,ea),Qt(Kt.id,{status:"confirmed",uploadedUrl:ea,attempts:(Kt.attempts||0)+1}),{id:Kt.id,url:ea}}catch(ea){return console.error(`Photo ${Kt.name} upload failed:`,ea),Ka++,Qt(Kt.id,{status:"failed",error:ea.message||"Upload failed",attempts:(Kt.attempts||0)+1}),{id:Kt.id,url:null,error:ea.message}}});Ge=(await Promise.all(Sl)).filter(Kt=>Kt.url!==null).map(Kt=>Kt.url),Ka>0&&Ge.length>0?m(`${Ge.length}/${Ue.length} photos uploaded. ${Ka} failed - can retry later.`,"warning"):Ka>0&&Ge.length===0&&m(`All ${Ka} photos failed to upload - can retry after submission.`,"error")}Ge.length>0&&(ze("Saving photos..."),await K.updateTMTicketPhotos(re.id,Ge));const gt=[...N.map(Qe=>({name:Qe.name.trim(),hours:parseFloat(Qe.hours)||0,overtime_hours:parseFloat(Qe.overtimeHours)||0,time_started:Qe.timeStarted||null,time_ended:Qe.timeEnded||null,role:Qe.role})),...ne.map(Qe=>({name:Qe.name.trim(),hours:parseFloat(Qe.hours)||0,overtime_hours:parseFloat(Qe.overtimeHours)||0,time_started:Qe.timeStarted||null,time_ended:Qe.timeEnded||null,role:"Operator"})),...be.map(Qe=>({name:Qe.name.trim(),hours:parseFloat(Qe.hours)||0,overtime_hours:parseFloat(Qe.overtimeHours)||0,time_started:Qe.timeStarted||null,time_ended:Qe.timeEnded||null,role:"Laborer"}))];if(ze("Saving workers..."),await K.addTMWorkers(re.id,gt),de.length>0&&(ze("Saving materials..."),await K.addTMItems(re.id,de.map(Qe=>({material_equipment_id:Qe.material_equipment_id,custom_name:Qe.custom_name||null,custom_category:Qe.custom_category||null,quantity:Qe.quantity})))),me){ze("Importing to COR...");try{await K.importTicketDataToCOR(re.id,me,l,r.work_type||"demolition",r.job_type||"standard")}catch(Qe){console.error("Error importing to COR:",Qe);try{await K.markImportFailed(re.id,me,Qe?.message||"Import failed")}catch(ua){console.error("Error marking import failed:",ua)}m("T&M saved. COR data sync failed - retry from ticket list.","warning")}}Se.forEach(Qe=>{Qe.previewUrl&&URL.revokeObjectURL(Qe.previewUrl)}),R(re),m("T&M submitted!","success"),f(5)}catch(re){console.error("Error submitting T&M:",re),m("Error submitting T&M","error")}finally{Be(!1),ze("")}},ba=w.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),It=M.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),ga=E.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),Tt=ba.length+It.length+ga.length,$a=[...ba,...It,...ga].reduce((N,ne)=>N+parseFloat(ne.hours||0),0),Ve=[...ba,...It,...ga].reduce((N,ne)=>N+parseFloat(ne.overtimeHours||0),0);de.reduce((N,ne)=>N+ne.quantity,0);const tt=[...w.filter(N=>N.name.trim()),...M.filter(N=>N.name.trim()),...E.filter(N=>N.name.trim())],At=Tt,$t=tt.length-At;return x===3&&(Ye||Mt)?e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[e.jsx("button",{className:"tm-back-btn",onClick:ya,children:""}),e.jsx("h2",{children:Mt?"Add Custom Item":Ye}),e.jsxs("div",{className:"tm-item-count",children:[de.length," items"]})]}),Mt?e.jsxs("div",{className:"tm-custom-form",children:[e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Item Name"}),e.jsx("input",{type:"text",placeholder:"What did you use?",value:Et.name,onChange:N=>aa({...Et,name:N.target.value}),autoFocus:!0})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Category"}),e.jsx("div",{className:"tm-category-select",children:ud.map(N=>e.jsx("button",{className:`tm-cat-chip ${Et.category===N?"active":""}`,onClick:()=>aa({...Et,category:N}),children:N},N))})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",placeholder:"How many?",value:Et.quantity,onChange:N=>aa({...Et,quantity:N.target.value})})]}),e.jsx("button",{className:"tm-big-btn primary",onClick:Dt,children:"Add Custom Item"})]}):e.jsx("div",{className:"tm-item-grid",children:qe?e.jsx("div",{className:"tm-loading",children:"Loading..."}):e.jsxs(e.Fragment,{children:[ja.map(N=>{const ne=de.find(be=>be.material_equipment_id===N.id);return e.jsxs("button",{className:`tm-item-card ${ne?"added":""}`,onClick:()=>it(N),children:[e.jsx("span",{className:"tm-item-name",children:N.name}),e.jsx("span",{className:"tm-item-unit",children:N.unit}),ne&&e.jsx("span",{className:"tm-item-badge",children:ne.quantity})]},N.id)}),e.jsxs("button",{className:"tm-item-card custom",onClick:()=>Gt(!0),children:[e.jsx("span",{className:"tm-item-name",children:"+ Add Other"}),e.jsx("span",{className:"tm-item-unit",children:"Not on list"})]})]})}),!Mt&&de.length>0&&e.jsx("div",{className:"tm-wizard-footer",children:e.jsxs("button",{className:"tm-big-btn primary",onClick:()=>ft(null),children:["Done Adding (",de.length," items)"]})})]}):e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[x<5?e.jsx("button",{className:"tm-back-btn",onClick:ya,children:""}):e.jsx("div",{className:"tm-success-check",children:e.jsx(od,{size:24})}),e.jsxs("h2",{children:[x===1&&Ee("workInfo"),x===2&&Ee("crewHours"),x===3&&Ee("materialsEquipment"),x===4&&Ee("review"),x===5&&(Je==="en"?"Submitted":"Enviado")]}),e.jsxs("div",{className:"tm-header-right",children:[x<5&&e.jsxs("button",{className:"tm-lang-toggle",onClick:()=>qt(Je==="en"?"es":"en"),title:Je==="en"?"Cambiar a Espaol":"Switch to English",children:[e.jsx($j,{size:16}),Je==="en"?"ES":"EN"]}),x<5&&e.jsxs("div",{className:"tm-step-dots",children:[e.jsx("span",{className:`tm-dot ${x>=1?"active":""}`}),e.jsx("span",{className:`tm-dot ${x>=2?"active":""}`}),e.jsx("span",{className:`tm-dot ${x>=3?"active":""}`}),e.jsx("span",{className:`tm-dot ${x>=4?"active":""}`})]})]})]}),x===1&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-project-info",children:[r.job_number&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Job #"}),e.jsx("span",{className:"tm-project-value",children:r.job_number})]}),e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Project"}),e.jsx("span",{className:"tm-project-value",children:r.name})]}),r.address&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Address"}),e.jsx("span",{className:"tm-project-value",children:r.address})]}),r.general_contractor&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"GC"}),e.jsx("span",{className:"tm-project-value",children:r.general_contractor})]})]}),e.jsxs("div",{className:"tm-field-row",children:[e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:b,onChange:N=>p(N.target.value),className:"tm-date"})]}),e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"CE / PCO #"}),e.jsx("input",{type:"text",placeholder:"Change Event / PCO",value:G,onChange:N=>O(N.target.value),className:"tm-input"})]})]}),e.jsxs("div",{className:"tm-field tm-description-field",children:[e.jsxs("label",{children:[e.jsx(Aa,{size:16,className:"inline-icon"}),Ee("describeWork")," ",e.jsx("span",{className:"tm-required",children:"*"})]}),e.jsx("textarea",{placeholder:Ee("whatWorkPerformed"),value:xe,onChange:N=>Q(N.target.value),rows:4,className:`tm-description ${xe.trim()?"":"tm-field-required"}`})]}),e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:[e.jsx($n,{size:16,className:"inline-icon"})," ",Ee("photos"),c!==-1&&e.jsxs("span",{className:"tm-photo-count",children:["(",Se.length,"/",c,")"]})]}),Se.length>0&&e.jsx("div",{className:"tm-photo-grid",children:Se.map(N=>e.jsxs("div",{className:`tm-photo-item ${N.status?`photo-${N.status}`:""}`,children:[e.jsx("img",{src:N.previewUrl,alt:N.name}),N.status==="compressing"&&e.jsxs("div",{className:"tm-photo-status compressing",children:[e.jsx(qi,{size:20,className:"tm-spinner"}),e.jsx("span",{children:Je==="en"?"Compressing":"Comprimiendo"})]}),N.status==="uploading"&&e.jsxs("div",{className:"tm-photo-status uploading",children:[e.jsx(qi,{size:20,className:"tm-spinner"}),e.jsx("span",{children:Je==="en"?"Uploading":"Subiendo"})]}),N.status==="confirmed"&&e.jsx("div",{className:"tm-photo-status confirmed",children:e.jsx(Ta,{size:20})}),N.status==="failed"&&e.jsxs("div",{className:"tm-photo-status failed",title:N.error||"Upload failed",children:[e.jsx(jn,{size:20}),e.jsx("span",{children:Je==="en"?"Failed":"Error"})]}),(!N.status||N.status==="pending"||N.status==="failed")&&e.jsx("button",{className:"tm-photo-remove",onClick:()=>$e(N.id),children:""})]},N.id))}),(c===-1||Se.length<c)&&e.jsxs("label",{className:"tm-photo-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:va,style:{display:"none"}}),e.jsx($n,{size:16,className:"inline-icon"})," ",Se.length>0?Je==="en"?"Add More Photos":"Ms Fotos":Ee("addPhotos")]})]}),e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:["Link to Change Order Request (",Ee("optional"),")"]}),e.jsxs("div",{className:"tm-cor-row",children:[e.jsxs("select",{value:me,onChange:N=>te(N.target.value),className:"tm-input tm-select",children:[e.jsx("option",{value:"",children:"-- No COR --"}),P.map(N=>e.jsxs("option",{value:N.id,children:[N.cor_number,": ",N.title||"Untitled"," (",N.status,")"]},N.id))]}),e.jsx("button",{type:"button",className:"tm-refresh-btn",onClick:lt,disabled:ie,title:"Refresh COR list",children:e.jsx(xf,{size:16,className:ie?"spinning":""})})]})]})]}),x===2&&e.jsxs("div",{className:"tm-step-content",children:[pt.length>0&&e.jsxs("div",{className:"tm-crew-picker",children:[e.jsxs("button",{className:"tm-crew-picker-btn",onClick:()=>Ae(!se),children:[e.jsx(Ea,{size:16})," ",se?"Hide":"Select from"," Today's Crew (",pt.length,")"]}),se&&e.jsx("div",{className:"tm-crew-list",children:pt.map((N,ne)=>{const be=w.some(re=>re.name.toLowerCase()===N.name.toLowerCase())||M.some(re=>re.name.toLowerCase()===N.name.toLowerCase())||E.some(re=>re.name.toLowerCase()===N.name.toLowerCase());return e.jsxs("button",{className:`tm-crew-item ${be?"added":""}`,onClick:()=>{if(!be){if(N.role==="Foreman"||N.role==="Supervisor"){const re=w.findIndex(Ge=>!Ge.name.trim());re>=0?dt(re,"name",N.name):Z([...w,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:N.role==="Supervisor"?"Superintendent":"Foreman"}])}else if(N.role==="Operator"){const re=M.findIndex(Ge=>!Ge.name.trim());re>=0?Te(re,"name",N.name):oe([...M,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}else{const re=E.findIndex(Ge=>!Ge.name.trim());re>=0?T(re,"name",N.name):U([...E,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}m(`Added ${N.name}`,"success")}},disabled:be,children:[e.jsx("span",{className:"tm-crew-item-name",children:N.name}),e.jsx("span",{className:`tm-crew-item-role ${(N.role||"laborer").toLowerCase()}`,children:N.role||"Laborer"}),be&&e.jsx("span",{className:"tm-crew-item-check",children:""})]},ne)})})]}),e.jsxs("div",{className:"tm-quick-actions-panel",children:[e.jsxs("div",{className:"tm-batch-hours-header",children:[e.jsx(Dd,{size:18}),e.jsx("span",{children:Ee("quickActions")})]}),e.jsxs("div",{className:"tm-quick-actions-buttons",children:[e.jsxs("button",{type:"button",className:"tm-quick-action-btn primary",onClick:Ne,disabled:da,children:[e.jsx(wd,{size:16}),Ee(da?"loading":"sameAsYesterday")]}),e.jsxs("button",{type:"button",className:"tm-quick-action-btn",onClick:()=>z(!0),children:[e.jsx(xn,{size:16}),Ee("setCrewHours")]})]})]}),e.jsxs("div",{className:"tm-inline-presets",children:[e.jsx("span",{className:"tm-inline-presets-label",children:Je==="en"?"Apply to all:":"Aplicar a todos:"}),e.jsxs("div",{className:"tm-inline-presets-buttons",children:[e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>ve("8hr"),children:Ee("preset8hr")}),e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>ve("10hr"),children:Ee("preset10hr")}),e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>ve("4hr"),children:Ee("preset4hr")})]})]}),e.jsxs("div",{className:`tm-running-total ${Tt>0?"has-data":""}`,children:[e.jsxs("div",{className:"tm-running-total-workers",children:[e.jsx(Ea,{size:18}),e.jsx("span",{className:"tm-running-total-count",children:tt.length}),e.jsx("span",{className:"tm-running-total-label",children:tt.length===1?Ee("worker"):Ee("workers_plural")}),$t>0&&e.jsxs("span",{className:"tm-running-total-warning",children:["(",$t," ",Je==="en"?"need hours":"sin horas",")"]})]}),e.jsxs("div",{className:"tm-running-total-hours",children:[e.jsx(xn,{size:18}),e.jsx("span",{className:"tm-running-total-count",children:$a+Ve}),e.jsx("span",{className:"tm-running-total-label",children:Je==="en"?"total hrs":"hrs total"}),Ve>0&&e.jsxs("span",{className:"tm-running-total-ot",children:["(",Ve," OT)"]})]})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:Ee("supervision")}),e.jsx("div",{className:"tm-workers-list",children:w.map((N,ne)=>{const be=q(N);return e.jsxs("div",{className:`tm-worker-card-expanded ${be!=="empty"?`worker-${be}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[be==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Ta,{size:14})}),e.jsx("div",{className:"tm-role-select",children:e.jsxs("select",{value:N.role,onChange:re=>dt(ne,"role",re.target.value),children:[e.jsx("option",{value:"Foreman",children:Ee("foreman")}),e.jsx("option",{value:"Superintendent",children:Ee("superintendent")})]})}),e.jsx("input",{type:"text",placeholder:Ee("firstLastName"),value:N.name,onChange:re=>dt(ne,"name",re.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>Oa(ne),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("start")}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:re=>dt(ne,"timeStarted",re.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("end")}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:re=>dt(ne,"timeEnded",re.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:re=>dt(ne,"hours",re.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:re=>dt(ne,"overtimeHours",re.target.value)})]})]})]},ne)})}),e.jsx("button",{className:"tm-add-btn",onClick:xt,children:Ee("addSupervision")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:Ee("operators")}),e.jsx("div",{className:"tm-workers-list",children:M.map((N,ne)=>{const be=q(N);return e.jsxs("div",{className:`tm-worker-card-expanded ${be!=="empty"?`worker-${be}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[be==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Ta,{size:14})}),e.jsx("input",{type:"text",placeholder:Ee("firstLastName"),value:N.name,onChange:re=>Te(ne,"name",re.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>jt(ne),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("start")}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:re=>Te(ne,"timeStarted",re.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("end")}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:re=>Te(ne,"timeEnded",re.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:re=>Te(ne,"hours",re.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:re=>Te(ne,"overtimeHours",re.target.value)})]})]})]},ne)})}),e.jsx("button",{className:"tm-add-btn",onClick:fe,children:Ee("addOperator")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:Ee("laborers")}),e.jsx("div",{className:"tm-workers-list",children:E.map((N,ne)=>{const be=q(N);return e.jsxs("div",{className:`tm-worker-card-expanded ${be!=="empty"?`worker-${be}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[be==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Ta,{size:14})}),e.jsx("input",{type:"text",placeholder:Ee("firstLastName"),value:N.name,onChange:re=>T(ne,"name",re.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>ge(ne),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("start")}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:re=>T(ne,"timeStarted",re.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("end")}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:re=>T(ne,"timeEnded",re.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:re=>T(ne,"hours",re.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:Ee("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:re=>T(ne,"overtimeHours",re.target.value)})]})]})]},ne)})}),e.jsx("button",{className:"tm-add-btn",onClick:ke,children:Ee("addLaborer")})]})]}),x===3&&!Ye&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-field tm-search-field",children:[e.jsxs("div",{className:"tm-search-input-wrapper",children:[e.jsx(Vi,{size:18,className:"tm-search-icon"}),e.jsx("input",{type:"text",placeholder:Ee("searchMaterials"),value:Ze,onChange:N=>sa(N.target.value),onFocus:()=>Yt(),className:"tm-search-input"}),Ze&&e.jsx("button",{className:"tm-search-clear",onClick:()=>{Ke(""),Me([])},children:""})]}),Ze&&et.length>0&&e.jsx("div",{className:"tm-search-results",children:et.map((N,ne)=>{const be=de.find(re=>re.id===N.id);return e.jsxs("button",{className:`tm-search-result-item ${be?"added":""}`,onClick:()=>{be?ct(de.indexOf(be),be.quantity+1):A([...de,{...N,quantity:1,isCustom:!1}]),Ke(""),Me([])},children:[e.jsx("span",{className:"tm-search-result-name",children:N.name}),e.jsx("span",{className:"tm-search-result-category",children:N.category}),be&&e.jsxs("span",{className:"tm-search-result-qty",children:["",be.quantity]})]},ne)})}),Ze&&et.length===0&&e.jsx("div",{className:"tm-search-no-results",children:Ee("noSearchResults")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:Ee("orBrowse")}),e.jsx("div",{className:"tm-category-grid",children:ud.map(N=>{const ne=de.filter(be=>be.category===N);return e.jsxs("button",{className:"tm-category-card",onClick:()=>ft(N),children:[e.jsx("span",{className:"tm-cat-name",children:N}),ne.length>0&&e.jsx("span",{className:"tm-cat-count",children:ne.length})]},N)})})]}),de.length>0&&e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:["Added Items (",de.length,")"]}),e.jsx("div",{className:"tm-added-list",children:de.map((N,ne)=>e.jsxs("div",{className:"tm-added-item",children:[e.jsxs("div",{className:"tm-added-info",children:[N.isCustom&&e.jsx("span",{className:"tm-custom-badge",children:"Custom"}),e.jsx("span",{className:"tm-added-name",children:N.name})]}),e.jsxs("div",{className:"tm-added-qty",children:[e.jsx("button",{onClick:()=>ct(ne,N.quantity-1),children:""}),e.jsx("span",{children:N.quantity}),e.jsx("button",{onClick:()=>ct(ne,N.quantity+1),children:"+"})]})]},ne))})]})]}),x===4&&e.jsxs("div",{className:"tm-step-content",children:[e.jsx("div",{className:"tm-review-section",children:e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Date"}),e.jsx("span",{children:new Date(b).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]})}),xe&&e.jsxs("div",{className:"tm-review-section",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(Aa,{size:16,className:"inline-icon"})," ",Ee("notes")]})}),e.jsx("div",{className:"tm-review-notes",children:xe})]}),Se.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx($n,{size:16,className:"inline-icon"})," ",Ee("photos")]}),e.jsx("span",{children:Se.length})]}),e.jsx("div",{className:"tm-review-photos",children:Se.map(N=>e.jsx("img",{src:N.previewUrl,alt:N.name},N.id))})]}),me&&e.jsxs("div",{className:"tm-review-section",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[" ",Ee("linkedCOR")]})}),e.jsxs("div",{className:"tm-review-cor",children:[P.find(N=>N.id===me)?.cor_number,": ",P.find(N=>N.id===me)?.title||"Untitled"]})]}),ba.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(yf,{size:16,className:"inline-icon"})," Supervision"]}),e.jsxs("span",{children:[ba.reduce((N,ne)=>N+parseFloat(ne.hours||0)+parseFloat(ne.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:ba.map((N,ne)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsxs("div",{className:"tm-review-worker-name",children:[e.jsx("span",{className:"tm-role-badge",children:N.role})," ",N.name]}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},ne))})]}),It.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Operators"}),e.jsxs("span",{children:[It.reduce((N,ne)=>N+parseFloat(ne.hours||0)+parseFloat(ne.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:It.map((N,ne)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:N.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},ne))})]}),ga.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(Ea,{size:16,className:"inline-icon"})," Laborers"]}),e.jsxs("span",{children:[ga.reduce((N,ne)=>N+parseFloat(ne.hours||0)+parseFloat(ne.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:ga.map((N,ne)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:N.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},ne))})]}),de.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(Nl,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsxs("span",{children:[de.length," items"]})]}),e.jsx("div",{className:"tm-review-list",children:de.map((N,ne)=>e.jsxs("div",{className:"tm-review-row",children:[e.jsxs("span",{children:[N.isCustom&&e.jsxs(e.Fragment,{children:[e.jsx(Dd,{size:14,className:"inline-icon"})," "]}),N.name]}),e.jsxs("span",{children:[N.quantity," ",N.unit]})]},ne))})]}),e.jsxs("div",{className:"tm-review-section tm-certification",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(yl,{size:16,className:"inline-icon"})," Submitted By"]})}),e.jsx("input",{type:"text",className:"tm-certification-input",placeholder:"Enter your name",value:C,onChange:N=>ee(N.target.value)}),e.jsx("p",{className:"tm-certification-note",children:"By submitting, you certify this T&M is accurate."})]})]}),x===5&&j&&e.jsxs("div",{className:"tm-step-content tm-success-step",children:[e.jsxs("div",{className:"tm-success-header",children:[e.jsx("div",{className:"tm-success-icon",children:e.jsx(od,{size:48})}),e.jsx("h2",{children:Je==="en"?"T&M Ticket Submitted!":"Ticket T&M Enviado!"}),e.jsx("p",{className:"tm-success-subtitle",children:Je==="en"?"Your ticket has been saved and is ready for client signature.":"Su ticket ha sido guardado y est listo para la firma del cliente."})]}),e.jsxs("div",{className:"tm-success-summary",children:[e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:Tt}),e.jsx("span",{className:"tm-success-stat-label",children:Je==="en"?"Workers":"Trabajadores"})]}),e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:$a+Ve}),e.jsx("span",{className:"tm-success-stat-label",children:Je==="en"?"Total Hours":"Horas Total"})]}),e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx("span",{className:"tm-success-stat-label",children:Je==="en"?"Work Date":"Fecha"})]})]}),Se.some(N=>N.status==="failed")&&e.jsxs("div",{className:"tm-failed-photos-section",children:[e.jsxs("div",{className:"tm-failed-photos-header",children:[e.jsx(jn,{size:18}),e.jsx("span",{children:Je==="en"?`${Se.filter(N=>N.status==="failed").length} photo(s) failed to upload`:`${Se.filter(N=>N.status==="failed").length} foto(s) no se subieron`})]}),e.jsx("div",{className:"tm-failed-photos-grid",children:Se.filter(N=>N.status==="failed").map(N=>e.jsxs("div",{className:"tm-failed-photo-item",children:[e.jsx("img",{src:N.previewUrl,alt:N.name}),e.jsx("div",{className:"tm-failed-photo-overlay",children:e.jsx("button",{className:"tm-retry-photo-btn",onClick:()=>Na(N.id,j.id),disabled:N.status==="uploading"||N.status==="compressing",children:N.status==="uploading"||N.status==="compressing"?e.jsx(qi,{size:16,className:"tm-spinner"}):e.jsxs(e.Fragment,{children:[e.jsx(bl,{size:16}),e.jsx("span",{children:Je==="en"?"Retry":"Reintentar"})]})})}),N.error&&e.jsxs("div",{className:"tm-failed-photo-error",title:N.error,children:[N.error.substring(0,20),N.error.length>20?"...":""]})]},N.id))}),e.jsxs("button",{className:"tm-retry-all-btn",onClick:async()=>{const N=Se.filter(ne=>ne.status==="failed");for(const ne of N)await Na(ne.id,j.id)},children:[e.jsx(bl,{size:16}),Je==="en"?"Retry All Failed Photos":"Reintentar Todas las Fotos"]})]}),Se.length>0&&Se.every(N=>N.status==="confirmed")&&e.jsxs("div",{className:"tm-photos-success",children:[e.jsx(Ta,{size:16}),e.jsx("span",{children:Je==="en"?`All ${Se.length} photo(s) uploaded successfully`:`${Se.length} foto(s) subidas exitosamente`})]}),e.jsxs("div",{className:"tm-signature-options",children:[e.jsx("h3",{children:Je==="en"?"Get Client Signature":"Obtener Firma del Cliente"}),e.jsx("p",{className:"tm-signature-description",children:Je==="en"?"Have the client sign this T&M ticket to verify the work performed.":"Haga que el cliente firme este ticket T&M para verificar el trabajo realizado."}),I?e.jsxs("div",{className:"tm-signed-confirmation",children:[e.jsx(od,{size:32,className:"tm-signed-icon"}),e.jsx("span",{children:Je==="en"?"Client signature collected!":"Firma del cliente recopilada!"})]}):e.jsxs("div",{className:"tm-signature-buttons",children:[e.jsxs("button",{className:"tm-signature-option-btn primary",onClick:()=>B(!0),children:[e.jsx("div",{className:"tm-signature-option-icon",children:e.jsx(yl,{size:24})}),e.jsxs("div",{className:"tm-signature-option-text",children:[e.jsx("span",{className:"tm-signature-option-title",children:Je==="en"?"Sign Now (On-Site)":"Firmar Ahora"}),e.jsx("span",{className:"tm-signature-option-desc",children:Je==="en"?"Client signs on this device":"Cliente firma en este dispositivo"})]})]}),e.jsxs("button",{className:"tm-signature-option-btn",onClick:()=>v(!0),children:[e.jsx("div",{className:"tm-signature-option-icon",children:e.jsx(Rd,{size:24})}),e.jsxs("div",{className:"tm-signature-option-text",children:[e.jsx("span",{className:"tm-signature-option-title",children:Je==="en"?"Send Signature Link":"Enviar Enlace"}),e.jsx("span",{className:"tm-signature-option-desc",children:Je==="en"?"Client signs later via link":"Cliente firma despus va enlace"})]})]})]})]})]}),S&&j&&e.jsx(Ld,{documentType:"tm_ticket",documentId:j.id,companyId:l,projectId:r.id,documentTitle:`T&M - ${new Date(b).toLocaleDateString()}`,onClose:()=>v(!1),onShowToast:m}),H&&j&&e.jsx(Wv,{ticketId:j.id,ticketSummary:{workDate:b,workerCount:Tt,totalHours:$a+Ve},lang:Je,onSave:()=>{B(!1),ae(!0)},onClose:()=>B(!1),onShowToast:m}),x<5&&e.jsxs("div",{className:"tm-wizard-footer",children:[x===1&&e.jsx("button",{className:"tm-big-btn primary",onClick:Xt,disabled:!st(),children:Ee("nextCrew")}),x===2&&e.jsx(e.Fragment,{children:e.jsxs("button",{className:"tm-big-btn primary",onClick:Xt,disabled:!st(),children:[Ee("nextMaterials")," (",Tt," ",Ee(Tt===1?"worker":"workers_plural"),", ",$a+Ve," hrs)"]})}),x===3&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"tm-big-btn primary",onClick:Xt,children:[Ee("reviewItems")," (",de.length," ",de.length===1?Ee("item"):Ee("items_plural"),")"]}),e.jsx("button",{className:"tm-skip-btn",onClick:Xt,children:Ee("skipNoMaterials")})]}),x===4&&e.jsx("button",{className:`tm-big-btn submit ${Oe?"submitting":""} ${C.trim()?"ready":"needs-name"}`,onClick:Ba,disabled:Oe||!C.trim(),children:Oe?e.jsxs(e.Fragment,{children:[e.jsx(qi,{size:20,className:"tm-spinner"}),e.jsx("span",{className:"tm-submit-text",children:Re||Ee("submitting")})]}):C.trim()?e.jsxs(e.Fragment,{children:[e.jsx(Ta,{size:20}),e.jsx("span",{children:Ee("submitTM")})]}):e.jsxs(e.Fragment,{children:[e.jsx(yl,{size:18}),e.jsx("span",{children:Je==="en"?"Enter name to submit":"Ingrese nombre"})]})})]}),x===5&&e.jsxs("div",{className:"tm-wizard-footer",children:[e.jsxs("button",{className:"tm-big-btn primary",onClick:i,children:[e.jsx(Ta,{size:20}),e.jsx("span",{children:Je==="en"?"Done":"Listo"})]}),e.jsx("button",{className:"tm-skip-btn",onClick:i,children:Je==="en"?"Skip signature for now":"Saltar firma por ahora"})]}),y&&e.jsx("div",{className:"tm-modal-overlay",onClick:()=>z(!1),children:e.jsxs("div",{className:"tm-batch-modal",onClick:N=>N.stopPropagation(),children:[e.jsxs("h3",{children:[e.jsx(xn,{size:18})," ",Ee("applySameHours")]}),e.jsx("p",{className:"tm-batch-description",children:Ee("batchDescription")}),e.jsxs("div",{className:"tm-time-presets",children:[e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>we("full"),children:Ee("preset8hr")}),e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>we("10hr"),children:Ee("preset10hr")}),e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>we("half"),children:Ee("preset4hr")})]}),e.jsxs("div",{className:"tm-batch-form",children:[e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:Ee("timeStarted")}),e.jsx("input",{type:"time",value:L.timeStarted,onChange:N=>{const ne=N.target.value,be=Y(ne,L.timeEnded);J({...L,timeStarted:ne,...be||{}})}})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:Ee("timeEnded")}),e.jsx("input",{type:"time",value:L.timeEnded,onChange:N=>{const ne=N.target.value,be=Y(L.timeStarted,ne);J({...L,timeEnded:ne,...be||{}})}})]})]}),e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:Ee("regularHours")}),e.jsx("input",{type:"number",placeholder:"8",value:L.hours,onChange:N=>J({...L,hours:N.target.value})})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:Ee("overtimeHours")}),e.jsx("input",{type:"number",placeholder:"0",value:L.overtimeHours,onChange:N=>J({...L,overtimeHours:N.target.value})})]})]})]}),e.jsxs("div",{className:"tm-batch-preview",children:[e.jsxs("strong",{children:[Ee("willApplyTo"),":"]}),e.jsxs("span",{children:[[...w.filter(N=>N.name.trim()),...M.filter(N=>N.name.trim()),...E.filter(N=>N.name.trim())].length," ",Ee("workers_plural")]})]}),e.jsxs("div",{className:"tm-batch-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>z(!1),children:Ee("cancel")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:De,disabled:!L.hours&&!L.overtimeHours,children:Ee("applyToAll")})]})]})})]})}function ty({project:r,onShowToast:l}){const[c,i]=g.useState([]),[u,m]=g.useState(!0),[x,f]=g.useState(!1),[b,p]=g.useState(!1),[j,R]=g.useState({name:"",role:"Laborer"});g.useEffect(()=>{S()},[r.id]);const S=async()=>{try{const I=await K.getCrewCheckin(r.id);I?.workers&&i(I.workers)}catch(I){console.error("Error loading crew:",I)}finally{m(!1)}},v=async()=>{if(!j.name.trim()){l("Enter worker name","error");return}if(c.find(I=>I.name.toLowerCase()===j.name.trim().toLowerCase())){l("Worker already added","error");return}f(!0);try{const I=[...c,{name:j.name.trim(),role:j.role}];await K.saveCrewCheckin(r.id,I),i(I),R({name:"",role:"Laborer"}),p(!1),l("Crew member added","success")}catch(I){console.error("Error adding worker:",I),l("Error adding crew member","error")}finally{f(!1)}},H=async I=>{f(!0);try{const ae=c.filter(G=>G.name.toLowerCase()!==I.toLowerCase());await K.saveCrewCheckin(r.id,ae),i(ae),l("Crew member removed","success")}catch(ae){console.error("Error removing worker:",ae),l("Error removing crew member","error")}finally{f(!1)}},B=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"});return u?e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(Ea,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:B})]}),e.jsx("div",{className:"crew-loading",children:"Loading..."})]}):e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(Ea,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:B})]}),c.length===0?e.jsxs("div",{className:"crew-empty",children:[e.jsx("p",{children:"No crew checked in yet"}),e.jsx("p",{className:"crew-empty-hint",children:"Add your crew for the day"})]}):e.jsx("div",{className:"crew-list",children:c.map(I=>e.jsxs("div",{className:"crew-member",children:[e.jsxs("div",{className:"crew-member-info",children:[e.jsx("span",{className:"crew-member-name",children:I.name}),e.jsx("span",{className:`crew-member-role ${I.role.toLowerCase()}`,children:I.role})]}),e.jsx("button",{className:"crew-remove-btn",onClick:()=>H(I.name),disabled:x,children:""})]},I.name))}),b?e.jsxs("div",{className:"crew-add-form",children:[e.jsx("input",{type:"text",value:j.name,onChange:I=>R({...j,name:I.target.value}),placeholder:"Name",autoFocus:!0}),e.jsxs("select",{value:j.role,onChange:I=>R({...j,role:I.target.value}),children:[e.jsx("option",{value:"Foreman",children:"Foreman"}),e.jsx("option",{value:"Laborer",children:"Laborer"}),e.jsx("option",{value:"Supervisor",children:"Supervisor"}),e.jsx("option",{value:"Operator",children:"Operator"})]}),e.jsxs("div",{className:"crew-add-buttons",children:[e.jsx("button",{className:"crew-add-confirm",onClick:v,disabled:x,children:x?"...":"Add"}),e.jsx("button",{className:"crew-add-cancel",onClick:()=>{p(!1),R({name:"",role:"Laborer"})},children:"Cancel"})]})]}):e.jsx("button",{className:"crew-add-btn",onClick:()=>p(!0),children:"+ Add Crew Member"}),e.jsxs("div",{className:"crew-count",children:[c.length," ",c.length===1?"person":"people"," on site"]})]})}function ay({project:r,onShowToast:l,onClose:c}){const[i,u]=g.useState(!0),[m,x]=g.useState(!1),[f,b]=g.useState(null),[p,j]=g.useState(""),[R,S]=g.useState("");g.useEffect(()=>{v()},[r.id]);const v=async()=>{try{const ae=await K.getDailyReport(r.id);if(ae)b(ae),j(ae.field_notes||""),S(ae.issues||"");else{const G=await K.compileDailyReport(r.id);b({...G,status:"draft"})}}catch(ae){console.error("Error loading report:",ae),l("Error loading report","error")}finally{u(!1)}},H=async()=>{if(!$){l("Demo Mode: Report saved locally only - won't reach office","info"),c();return}x(!0);try{await K.saveDailyReport(r.id,{field_notes:p,issues:R}),await K.submitDailyReport(r.id,"Field")?(l("Daily report submitted!","success"),c()):l("Report not sent - check connection","error")}catch(ae){console.error("Error submitting report:",ae),l("Error submitting report","error")}finally{x(!1)}},B=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});if(i)return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsx("h2",{children:"Daily Report"})]}),e.jsx("div",{className:"daily-report-loading",children:"Compiling report..."})]});const I=f?.status==="submitted";return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsxs("div",{children:[e.jsx("h2",{children:"Daily Report"}),e.jsx("p",{className:"daily-report-date",children:B})]})]}),I&&e.jsxs("div",{className:"daily-report-submitted-banner",children:[" Submitted ",new Date(f.submitted_at).toLocaleTimeString()]}),e.jsxs("div",{className:"daily-report-content",children:[e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:f.crew_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:f.tasks_completed||0}),e.jsx("div",{className:"daily-report-card-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:f.tm_tickets_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:f.photos_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Photos"})]})]}),f.crew_list?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Ea,{size:18,className:"inline-icon"})," Crew"]}),e.jsx("div",{className:"daily-report-crew",children:f.crew_list.map((ae,G)=>e.jsxs("div",{className:"daily-report-crew-item",children:[e.jsx("span",{children:ae.name}),e.jsx("span",{className:"daily-report-crew-role",children:ae.role})]},G))})]}),f.completed_tasks?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Ja,{size:18,className:"inline-icon"})," Completed Today"]}),e.jsx("ul",{className:"daily-report-tasks",children:f.completed_tasks.map((ae,G)=>e.jsxs("li",{children:[ae.name,ae.group&&e.jsx("span",{className:"daily-report-task-group",children:ae.group})]},G))})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Aa,{size:18,className:"inline-icon"})," Notes"]}),e.jsx("textarea",{value:p,onChange:ae=>j(ae.target.value),placeholder:"Any notes about today's work...",rows:3,disabled:I})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Er,{size:18,className:"inline-icon"})," Issues / Concerns"]}),e.jsx("textarea",{value:R,onChange:ae=>S(ae.target.value),placeholder:"Any problems, delays, or concerns...",rows:3,disabled:I})]})]}),!I&&e.jsxs("div",{className:"daily-report-footer",children:[e.jsx("button",{className:"btn btn-primary daily-report-submit",onClick:H,disabled:m,children:m?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(Rv,{size:16,className:"inline-icon"})," Submit Report"]})}),e.jsx("p",{className:"daily-report-hint",children:"This will be sent to the office"})]})]})}const sy=g.createContext({}),Nf=()=>g.useContext(sy);function Ls({message:r,type:l="",onClose:c}){return g.useEffect(()=>{const i=setTimeout(c,3e3);return()=>clearTimeout(i)},[c]),e.jsx("div",{className:"toast-container",children:e.jsx("div",{className:`toast ${l}`,children:r})})}function Sf({project:r,companyId:l,onClose:c,onReportCreated:i}){const{user:u}=Nf(),[m,x]=g.useState(!1),[f,b]=g.useState(null),[p,j]=g.useState(1),[R,S]=g.useState(new Date().toISOString().split("T")[0]),[v,H]=g.useState(new Date().toTimeString().split(" ")[0].substring(0,5)),[B,I]=g.useState(""),[ae,G]=g.useState(""),[O,C]=g.useState("minor"),[ee,me]=g.useState(""),[te,P]=g.useState(""),[V,ie]=g.useState(""),[D,y]=g.useState(""),[z,L]=g.useState(""),[J,w]=g.useState(""),[Z,M]=g.useState(""),[oe,E]=g.useState(u?.name||""),[U,de]=g.useState(""),[A,xe]=g.useState(""),[Q,Se]=g.useState(u?.email||""),[he,Oe]=g.useState([]),[Be,Re]=g.useState(""),[ze,pt]=g.useState(""),[rt,se]=g.useState(""),[Ae,Ye]=g.useState(""),[ft,ja]=g.useState(!1),[Ce,qe]=g.useState(""),[Fe,Ze]=g.useState(""),[Ke,et]=g.useState(!1),[Me,bt]=g.useState(""),[kt,Mt]=g.useState(""),[Gt,Et]=g.useState(""),[aa,da]=g.useState(""),[St,Je]=g.useState(!1),[qt,Ee]=g.useState(!1),[Y,q]=g.useState(0),[we,lt]=g.useState(0),De=()=>{if(!Be.trim()){b({type:"error",message:"Please enter witness name"});return}const Ne={name:Be,phone:ze,email:rt,testimony:Ae};Oe([...he,Ne]),Re(""),pt(""),se(""),Ye(""),b({type:"success",message:"Witness added"})},ve=Ne=>{Oe(he.filter((xt,dt)=>dt!==Ne))},at=Ne=>{switch(Ne){case 1:if(!B.trim()||!ae.trim())return b({type:"error",message:"Please fill in all incident details"}),!1;break;case 2:if(!te.trim()||!J.trim())return b({type:"error",message:"Please fill in employee name and job title"}),!1;break;case 3:if(!oe.trim()||!U.trim())return b({type:"error",message:"Please fill in supervisor name and title"}),!1;break}return!0},ot=()=>{at(p)&&j(p+1)},Yt=()=>{j(p-1)},sa=async()=>{if(at(p)){if(!$){b({type:"info",message:"Demo Mode: Report saved locally only - won't reach office"}),setTimeout(()=>{c()},1500);return}x(!0);try{const Ne={project_id:r.id,company_id:l,incident_date:R,incident_time:v,incident_location:B,incident_description:ae,injury_type:O,body_part_affected:ee||null,employee_name:te,employee_phone:V||null,employee_email:D||null,employee_address:z||null,employee_job_title:J,employee_hire_date:Z||null,medical_treatment_required:ft,medical_facility_name:Ce||null,medical_facility_address:Fe||null,hospitalized:Ke,reported_by_name:oe,reported_by_title:U,reported_by_phone:A||null,reported_by_email:Q||null,witnesses:he,immediate_actions_taken:Me||null,corrective_actions_planned:kt||null,safety_equipment_used:Gt||null,safety_equipment_failed:aa||null,osha_recordable:St,workers_comp_claim:qt,days_away_from_work:parseInt(Y)||0,restricted_work_days:parseInt(we)||0,status:"reported",created_by:u?.id},xt=await K.createInjuryReport(Ne);b({type:"success",message:"Injury report submitted successfully"}),i&&i(xt),setTimeout(()=>{c()},1500)}catch(Ne){console.error("Error submitting injury report:",Ne),b({type:"error",message:"Failed to submit injury report"})}finally{x(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:c,children:e.jsxs("div",{className:"modal-content injury-report-modal",onClick:Ne=>Ne.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Workplace Injury/Incident Report"}),e.jsx("button",{className:"close-btn",onClick:c,children:""})]}),e.jsxs("div",{className:"progress-steps",children:[e.jsx("div",{className:`step ${p>=1?"active":""}`,children:"1. Incident"}),e.jsx("div",{className:`step ${p>=2?"active":""}`,children:"2. Employee"}),e.jsx("div",{className:`step ${p>=3?"active":""}`,children:"3. Supervisor"}),e.jsx("div",{className:`step ${p>=4?"active":""}`,children:"4. Witnesses"}),e.jsx("div",{className:`step ${p>=5?"active":""}`,children:"5. Medical & Safety"})]}),e.jsxs("div",{className:"modal-body",children:[p===1&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Incident Details"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date of Incident *"}),e.jsx("input",{type:"date",value:R,onChange:Ne=>S(Ne.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Time of Incident *"}),e.jsx("input",{type:"time",value:v,onChange:Ne=>H(Ne.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Location on Site *"}),e.jsx("input",{type:"text",value:B,onChange:Ne=>I(Ne.target.value),placeholder:"e.g., Floor 2, near elevator shaft"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Incident Description *"}),e.jsx("textarea",{value:ae,onChange:Ne=>G(Ne.target.value),rows:4,placeholder:"Describe what happened in detail..."})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Injury Type *"}),e.jsxs("select",{value:O,onChange:Ne=>C(Ne.target.value),children:[e.jsx("option",{value:"minor",children:"Minor Injury"}),e.jsx("option",{value:"serious",children:"Serious Injury"}),e.jsx("option",{value:"critical",children:"Critical Injury"}),e.jsx("option",{value:"near_miss",children:"Near Miss (No Injury)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("input",{type:"text",value:ee,onChange:Ne=>me(Ne.target.value),placeholder:"e.g., Left hand, lower back"})]})]})]}),p===2&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Injured Employee Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:te,onChange:Ne=>P(Ne.target.value),placeholder:"First and last name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:V,onChange:Ne=>ie(Ne.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:D,onChange:Ne=>y(Ne.target.value),placeholder:"email@example.com"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Home Address"}),e.jsx("input",{type:"text",value:z,onChange:Ne=>L(Ne.target.value),placeholder:"Street address, city, state, zip"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Title *"}),e.jsx("input",{type:"text",value:J,onChange:Ne=>w(Ne.target.value),placeholder:"e.g., Carpenter, Electrician"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Hire Date"}),e.jsx("input",{type:"date",value:Z,onChange:Ne=>M(Ne.target.value)})]})]})]}),p===3&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Foreman/Supervisor Making Report"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Name *"}),e.jsx("input",{type:"text",value:oe,onChange:Ne=>E(Ne.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Title *"}),e.jsx("input",{type:"text",value:U,onChange:Ne=>de(Ne.target.value),placeholder:"e.g., Site Foreman, Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Phone Number"}),e.jsx("input",{type:"tel",value:A,onChange:Ne=>xe(Ne.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Email Address"}),e.jsx("input",{type:"email",value:Q,onChange:Ne=>Se(Ne.target.value),placeholder:"email@example.com"})]})]}),p===4&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Witness Testimonies (Optional)"}),he.length>0&&e.jsx("div",{className:"witnesses-list",children:he.map((Ne,xt)=>e.jsxs("div",{className:"witness-item",children:[e.jsxs("div",{className:"witness-info",children:[e.jsx("strong",{children:Ne.name}),Ne.phone&&e.jsxs("span",{children:["  ",Ne.phone]}),Ne.testimony&&e.jsxs("p",{className:"witness-testimony",children:['"',Ne.testimony,'"']})]}),e.jsx("button",{className:"btn-danger btn-small",onClick:()=>ve(xt),children:"Remove"})]},xt))}),e.jsxs("div",{className:"add-witness-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Name"}),e.jsx("input",{type:"text",value:Be,onChange:Ne=>Re(Ne.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:ze,onChange:Ne=>pt(Ne.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:rt,onChange:Ne=>se(Ne.target.value),placeholder:"email@example.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Testimony"}),e.jsx("textarea",{value:Ae,onChange:Ne=>Ye(Ne.target.value),rows:3,placeholder:"What did the witness see or hear?"})]}),e.jsx("button",{className:"btn-secondary",onClick:De,children:"+ Add Witness"})]})]}),p===5&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Medical Treatment & Safety"}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:ft,onChange:Ne=>ja(Ne.target.checked)}),"Medical treatment required"]})}),ft&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Name"}),e.jsx("input",{type:"text",value:Ce,onChange:Ne=>qe(Ne.target.value),placeholder:"Hospital or clinic name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Address"}),e.jsx("input",{type:"text",value:Fe,onChange:Ne=>Ze(Ne.target.value),placeholder:"Street address"})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Ke,onChange:Ne=>et(Ne.target.checked)}),"Employee was hospitalized"]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("textarea",{value:Me,onChange:Ne=>bt(Ne.target.value),rows:2,placeholder:"What was done immediately after the incident?"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("textarea",{value:kt,onChange:Ne=>Mt(Ne.target.value),rows:2,placeholder:"What will be done to prevent this in the future?"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("input",{type:"text",value:Gt,onChange:Ne=>Et(Ne.target.value),placeholder:"e.g., Hard hat, gloves, harness"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("input",{type:"text",value:aa,onChange:Ne=>da(Ne.target.value),placeholder:"Equipment that failed, if any"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("input",{type:"number",min:"0",value:Y,onChange:Ne=>q(Ne.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("input",{type:"number",min:"0",value:we,onChange:Ne=>lt(Ne.target.value)})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:St,onChange:Ne=>Je(Ne.target.checked)}),"OSHA Recordable Incident"]})}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:qt,onChange:Ne=>Ee(Ne.target.checked)}),"Workers' Compensation Claim Filed"]})})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"form-actions",children:[p>1&&e.jsx("button",{className:"btn-secondary",onClick:Yt,children:" Back"}),e.jsx("button",{className:"btn-secondary",onClick:c,children:"Cancel"}),p<5?e.jsx("button",{className:"btn-primary",onClick:ot,children:"Next "}):e.jsx("button",{className:"btn-primary",onClick:sa,disabled:m,children:m?"Submitting...":"Submit Report"})]})})]})}),f&&e.jsx(Ls,{message:f.message,type:f.type,onClose:()=>b(null)}),e.jsx("style",{children:`
        .injury-report-modal {
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid var(--border-color);
          background-color: var(--bg-elevated);
          overflow-x: auto;
        }

        .progress-steps .step {
          font-size: 0.875rem;
          color: var(--text-muted);
          font-weight: 500;
          white-space: nowrap;
          padding: 0.5rem;
        }

        .progress-steps .step.active {
          color: var(--accent-primary);
          font-weight: 600;
        }

        .form-step h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          color: var(--text-primary);
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 1rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-group textarea {
          resize: vertical;
        }

        .checkbox-group label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: normal;
          cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
          width: auto;
          margin: 0;
        }

        .witnesses-list {
          margin-bottom: 1.5rem;
        }

        .witness-item {
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .witness-info {
          flex: 1;
          color: var(--text-primary);
        }

        .witness-testimony {
          margin-top: 0.5rem;
          color: var(--text-secondary);
          font-style: italic;
          font-size: 0.875rem;
        }

        .add-witness-form {
          border: 2px dashed var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          background-color: var(--bg-elevated);
        }

        .modal-footer {
          border-top: 1px solid var(--border-color);
          padding: 1rem 1.5rem;
        }

        .form-actions {
          display: flex;
          justify-content: space-between;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
        }

        @media (max-width: 768px) {
          .injury-report-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }

          .form-row {
            grid-template-columns: 1fr;
          }

          .progress-steps .step {
            font-size: 0.75rem;
            padding: 0.25rem;
          }
        }
      `})]})}function wf({compact:r=!1}){const{theme:l,toggleTheme:c}=rj();return e.jsx("button",{className:`theme-toggle ${r?"theme-toggle-compact":""}`,onClick:c,title:`Switch to ${l==="dark"?"light":"dark"} mode`,"aria-label":`Switch to ${l==="dark"?"light":"dark"} mode`,children:l==="dark"?e.jsxs(e.Fragment,{children:[e.jsx(Ev,{size:r?18:16}),!r&&e.jsx("span",{children:"Light"})]}):e.jsxs(e.Fragment,{children:[e.jsx(nv,{size:r?18:16}),!r&&e.jsx("span",{children:"Dark"})]})})}const md=[{value:"concrete",label:"Concrete",icon:""},{value:"trash",label:"Trash",icon:""},{value:"metals",label:"Metals",icon:""},{value:"hazardous_waste",label:"Hazardous",icon:""}];function ny({project:r,user:l=null,date:c,onShowToast:i}){const[u,m]=g.useState([]),[x,f]=g.useState(!0),[b,p]=g.useState(!1),[j,R]=g.useState(!1),[S,v]=g.useState({type:"concrete",count:1}),H=new Date(c).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});g.useEffect(()=>{B()},[r.id,c]);const B=async()=>{try{f(!0);const te=await K.getDisposalLoads(r.id,c);m(te||[])}catch(te){console.error("Error loading disposal loads:",te)}finally{f(!1)}},I=async()=>{if(!(S.count<1)){p(!0);try{await K.addDisposalLoad(r.id,l?.id||null,c,S.type,S.count),await B(),v({type:"concrete",count:1}),R(!1),i?.("Disposal load added","success")}catch(te){console.error("Error adding disposal load:",te),i?.("Error adding load","error")}finally{p(!1)}}},ae=async te=>{p(!0);try{await K.deleteDisposalLoad(te),await B(),i?.("Load removed","success")}catch(P){console.error("Error deleting disposal load:",P),i?.("Error removing load","error")}finally{p(!1)}},G=async te=>{p(!0);try{await K.addDisposalLoad(r.id,l?.id||null,c,te,1),await B(),i?.("Load added","success")}catch(P){console.error("Error adding disposal load:",P),i?.("Error adding load","error")}finally{p(!1)}},O=async te=>{p(!0);try{await K.updateDisposalLoad(te.id,te.load_type,te.load_count+1),await B()}catch(P){console.error("Error updating load:",P),i?.("Error updating load","error")}finally{p(!1)}},C=async te=>{if(te.load_count<=1){await ae(te.id);return}p(!0);try{await K.updateDisposalLoad(te.id,te.load_type,te.load_count-1),await B()}catch(P){console.error("Error updating load:",P),i?.("Error updating load","error")}finally{p(!1)}},ee=u.reduce((te,P)=>(te[P.load_type]||(te[P.load_type]={items:[],total:0}),te[P.load_type].items.push(P),te[P.load_type].total+=P.load_count,te),{}),me=u.reduce((te,P)=>te+P.load_count,0);return x?e.jsxs("div",{className:"disposal-load-input",children:[e.jsxs("div",{className:"disposal-header",children:[e.jsx(ds,{size:20}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("div",{className:"disposal-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-load-input",children:[e.jsxs("div",{className:"disposal-header",children:[e.jsxs("div",{className:"disposal-title",children:[e.jsx(ds,{size:20}),e.jsx("span",{children:"Disposal Loads"}),me>0&&e.jsx("span",{className:"disposal-badge",children:me})]}),e.jsx("span",{className:"disposal-date",children:H})]}),e.jsx("div",{className:"disposal-quick-add",children:md.map(te=>e.jsxs("button",{className:"quick-add-btn",onClick:()=>G(te.value),disabled:b,children:[e.jsx("span",{className:"quick-add-icon",children:te.icon}),e.jsxs("span",{className:"quick-add-label",children:["+ ",te.label]})]},te.value))}),Object.keys(ee).length>0?e.jsx("div",{className:"disposal-loads-list",children:md.map(te=>{const P=ee[te.value];return P?e.jsxs("div",{className:"disposal-load-row",children:[e.jsxs("div",{className:"load-info",children:[e.jsx("span",{className:"load-icon",children:te.icon}),e.jsx("span",{className:"load-label",children:te.label})]}),e.jsxs("div",{className:"load-controls",children:[e.jsx("button",{className:"load-btn decrement",onClick:()=>C(P.items[0]),disabled:b,children:e.jsx(kd,{size:16})}),e.jsx("span",{className:"load-count",children:P.total}),e.jsx("button",{className:"load-btn increment",onClick:()=>O(P.items[0]),disabled:b,children:e.jsx(vs,{size:16})})]})]},te.value):null})}):e.jsxs("div",{className:"disposal-empty",children:[e.jsxs("p",{children:["No disposal loads recorded for ",H]}),e.jsx("p",{className:"disposal-hint",children:"Tap a button above to add loads"})]}),j&&e.jsxs("div",{className:"disposal-add-form",children:[e.jsxs("div",{className:"add-form-row",children:[e.jsx("select",{value:S.type,onChange:te=>v({...S,type:te.target.value}),className:"load-type-select",children:md.map(te=>e.jsxs("option",{value:te.value,children:[te.icon," ",te.label]},te.value))}),e.jsxs("div",{className:"count-input-group",children:[e.jsx("button",{className:"count-btn",onClick:()=>v({...S,count:Math.max(1,S.count-1)}),children:e.jsx(kd,{size:16})}),e.jsx("input",{type:"number",min:"1",value:S.count,onChange:te=>v({...S,count:parseInt(te.target.value)||1}),className:"count-input"}),e.jsx("button",{className:"count-btn",onClick:()=>v({...S,count:S.count+1}),children:e.jsx(vs,{size:16})})]})]}),e.jsxs("div",{className:"add-form-actions",children:[e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>R(!1),children:[e.jsx(za,{size:16})," Cancel"]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:I,disabled:b,children:[e.jsx(Ta,{size:16})," Add"]})]})]}),!j&&e.jsxs("button",{className:"disposal-add-custom",onClick:()=>R(!0),children:[e.jsx(vs,{size:16}),"Add multiple loads"]}),me>0&&e.jsxs("div",{className:"disposal-summary",children:[e.jsx("strong",{children:me})," total load",me!==1?"s":""," today"]})]})}function ry({project:r,companyId:l,onShowToast:c,onExit:i}){const[u,m]=g.useState([]),[x,f]=g.useState(!0),[b,p]=g.useState(null),[j,R]=g.useState({}),[S,v]=g.useState(!1),[H,B]=g.useState(!1),[I,ae]=g.useState(!1),[G,O]=g.useState(!1),[C,ee]=g.useState(!1),[me,te]=g.useState(!1),[P,V]=g.useState("actions");g.useEffect(()=>{ie()},[r.id]);const ie=async()=>{try{const E=await K.getAreas(r.id);m(E);const U=[...new Set(E.map(A=>A.group_name||"General"))],de={};U.forEach(A=>de[A]=!1),R(de)}catch(E){console.error("Error loading areas:",E),c("Error loading areas","error")}finally{f(!1)}},D=async(E,U)=>{const de=u.find(xe=>xe.id===E);if(!de)return;const A=de.status===U?"not_started":U;p(E);try{await K.updateAreaStatus(E,A),m(xe=>xe.map(Q=>Q.id===E?{...Q,status:A}:Q)),c("Updated","success")}catch(xe){console.error("Error updating status:",xe),c("Error updating","error")}finally{p(null)}},y=E=>{R(U=>({...U,[E]:!U[E]}))};if(x)return e.jsx("div",{className:"foreman-container",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading..."]})});if(S)return e.jsx("div",{className:"foreman-container",children:e.jsx(ey,{project:r,companyId:l,onSubmit:()=>v(!1),onCancel:()=>v(!1),onShowToast:c})});if(G)return e.jsx(ay,{project:r,onShowToast:c,onClose:()=>O(!1)});if(C)return e.jsx("div",{className:"foreman-container",children:e.jsx(Sf,{project:r,companyId:l,onClose:()=>ee(!1),onReportCreated:()=>{ee(!1),c("Injury report submitted","success")}})});if(H)return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-view-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:()=>B(!1),children:""}),e.jsx("h2",{children:"Crew Check-in"})]}),e.jsx(ty,{project:r,onShowToast:c})]});if(I)return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-view-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:()=>ae(!1),children:""}),e.jsx("h2",{children:"Disposal Loads"})]}),e.jsx(ny,{project:r,date:new Date().toISOString().split("T")[0],onShowToast:c})]});const z=Xv(u),L=u.reduce((E,U)=>{const de=U.group_name||"General";return E[de]||(E[de]=[]),E[de].push(U),E},{}),J=Object.keys(L).length>1||Object.keys(L).length===1&&!L.General,w=E=>`${E.filter(de=>de.status==="done").length}/${E.length}`,Z=u.filter(E=>E.status==="done").length,M=u.filter(E=>E.status==="working").length,oe=u.length-Z;return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),e.jsxs("div",{className:"foreman-header-info",children:[e.jsx("div",{className:"foreman-project-name",children:r.name}),e.jsxs("div",{className:"foreman-progress",children:[z,"% Complete"]})]}),e.jsxs("div",{className:"foreman-header-actions",children:[e.jsx(wf,{compact:!0}),e.jsx("button",{className:"foreman-info-btn",onClick:()=>te(!me),children:e.jsx(Cd,{size:20})})]})]}),me&&e.jsxs("div",{className:"foreman-project-info",children:[r.job_number&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Job #"}),e.jsx("span",{className:"foreman-info-value",children:r.job_number})]}),r.address&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Address"}),e.jsx("span",{className:"foreman-info-value",children:r.address})]}),r.general_contractor&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"GC / Client"}),e.jsx("span",{className:"foreman-info-value",children:r.general_contractor})]}),r.client_contact&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Contact"}),e.jsx("span",{className:"foreman-info-value",children:r.client_contact})]}),r.client_phone&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Phone"}),e.jsx("a",{href:`tel:${r.client_phone}`,className:"foreman-info-value foreman-info-link",children:r.client_phone})]})]}),e.jsxs("div",{className:"foreman-stats",children:[e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value working",children:M}),e.jsx("div",{className:"foreman-stat-label",children:"Working"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value done",children:Z}),e.jsx("div",{className:"foreman-stat-label",children:"Done"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value remaining",children:oe}),e.jsx("div",{className:"foreman-stat-label",children:"Remaining"})]})]}),e.jsxs("div",{className:"foreman-tabs",children:[e.jsxs("button",{className:`foreman-tab ${P==="actions"?"active":""}`,onClick:()=>V("actions"),children:[e.jsx(Dd,{size:18}),"Actions"]}),e.jsxs("button",{className:`foreman-tab ${P==="progress"?"active":""}`,onClick:()=>V("progress"),children:[e.jsx(Ed,{size:18}),"Progress"]})]}),P==="actions"&&e.jsxs("div",{className:"field-actions",children:[e.jsxs("button",{className:"field-action-btn",onClick:()=>v(!0),children:[e.jsx(Aa,{size:22}),"T&M Ticket"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>B(!0),children:[e.jsx(Ea,{size:22}),"Crew Check-in"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>ae(!0),children:[e.jsx(ds,{size:22}),"Disposal Loads"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>O(!0),children:[e.jsx(cs,{size:22}),"Daily Report"]}),e.jsxs("button",{className:"field-action-btn danger",onClick:()=>ee(!0),children:[e.jsx(Er,{size:22}),"Report Injury"]})]}),P==="progress"&&e.jsxs("div",{className:"foreman-areas",children:[J?Object.entries(L).map(([E,U])=>e.jsxs("div",{className:"foreman-group",children:[e.jsxs("div",{className:"foreman-group-header",onClick:()=>y(E),children:[e.jsxs("div",{className:"foreman-group-title",children:[e.jsx("span",{className:"foreman-group-arrow",children:j[E]?"":""}),e.jsx("span",{className:"foreman-group-name",children:E})]}),e.jsx("span",{className:"foreman-group-progress",children:w(U)})]}),j[E]&&e.jsx("div",{className:"foreman-group-tasks",children:U.map(de=>e.jsxs("div",{className:`foreman-area-card ${de.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:de.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${de.status==="working"?"active":""}`,onClick:()=>D(de.id,"working"),disabled:b===de.id,children:b===de.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${de.status==="done"?"active":""}`,onClick:()=>D(de.id,"done"),disabled:b===de.id,children:b===de.id?"...":"Done"})]})]},de.id))})]},E)):u.map(E=>e.jsxs("div",{className:`foreman-area-card ${E.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:E.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${E.status==="working"?"active":""}`,onClick:()=>D(E.id,"working"),disabled:b===E.id,children:b===E.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${E.status==="done"?"active":""}`,onClick:()=>D(E.id,"done"),disabled:b===E.id,children:b===E.id?"...":"Done"})]})]},E.id)),u.length===0&&e.jsxs("div",{className:"foreman-empty",children:[e.jsx(cs,{size:48,className:"foreman-empty-icon"}),e.jsx("div",{className:"foreman-empty-text",children:"No areas yet"}),e.jsx("div",{className:"foreman-empty-subtext",children:"Office needs to add areas to this project"})]})]})]})}const Fp=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},ly=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});function iy({project:r,company:l,onShowToast:c,compact:i=!1}){const{branding:u}=Cr(),[m,x]=g.useState([]),[f,b]=g.useState(!0),[p,j]=g.useState("all"),[R,S]=g.useState(null),[v,H]=g.useState(new Set),[B,I]=g.useState("recent"),[ae,G]=g.useState(new Set),[O,C]=g.useState({start:"",end:""}),[ee,me]=g.useState(!1),[te,P]=g.useState(null),[V,ie]=g.useState(""),[D,y]=g.useState(!1),[z,L]=g.useState(null),[J,w]=g.useState(!1),[Z,M]=g.useState(null),[oe,E]=g.useState([]),[U,de]=g.useState(""),[A,xe]=g.useState(!1),[Q,Se]=g.useState({}),[he,Oe]=g.useState({}),[Be,Re]=g.useState(null);g.useEffect(()=>{ze();const Y=K.subscribeToTMTickets?.(r.id,()=>{ze()});return()=>{Y&&K.unsubscribe?.(Y)}},[r.id]);const ze=async()=>{try{const Y=await K.getTMTickets(r.id);x(Y);const q=Y.filter(we=>we.assigned_cor_id);if(q.length>0){const we={},lt={};await Promise.all(q.map(async De=>{const ve=await K.isTicketEditable(De);ve.editable||(we[De.id]=ve);try{const at=await K.getTicketImportStatus(De.id,De.assigned_cor_id);at?.import_status==="failed"&&(lt[De.id]=at)}catch{}})),Se(we),Oe(lt)}}catch(Y){console.error("Error loading tickets:",Y),c("Error loading T&M tickets","error")}finally{b(!1)}},pt=async(Y,q)=>{if(Q[Y]){c(Q[Y].reason||"This ticket is locked (COR approved)","error");return}try{await K.updateTMTicketStatus(Y,q),x(m.map(we=>we.id===Y?{...we,status:q}:we)),c(`Ticket ${q}`,"success")}catch(we){console.error("Error updating status:",we),c("Error updating status","error")}},rt=Y=>{if(Q[Y.id]){c(Q[Y.id].reason||"This ticket is locked (COR approved)","error");return}pt(Y.id,"approved")},se=async()=>{if(te)try{const Y=parseFloat(V)||0;await K.approveTMTicket(te.id,null,null,Y),x(m.map(q=>q.id===te.id?{...q,status:"approved",change_order_value:Y}:q)),c(`Ticket approved with $${Y.toLocaleString()} change order`,"success"),me(!1),P(null),ie("")}catch(Y){console.error("Error approving ticket:",Y),c("Error approving ticket","error")}},Ae=async Y=>{if(Q[Y]){c(Q[Y].reason||"This ticket is locked (COR approved)","error");return}if(confirm("Delete this T&M ticket?"))try{await K.deleteTMTicket(Y),x(m.filter(q=>q.id!==Y)),c("Ticket deleted","success")}catch(q){console.error("Error deleting ticket:",q),c("Error deleting ticket","error")}},Ye=async Y=>{M(Y),de(Y.assigned_cor_id||""),w(!0),xe(!0);try{const q=await K.getAssignableCORs(r.id);E(q||[])}catch(q){console.error("Error loading CORs:",q),c("Error loading change orders","error")}finally{xe(!1)}},ft=async()=>{if(Z)try{if(U){await K.assignTicketToCOR(Z.id,U);const Y=oe.find(q=>q.id===U);c(`Ticket linked to ${Y?.cor_number||"COR"}`,"success")}else Z.assigned_cor_id&&(await K.unassignTicketFromCOR(Z.id,Z.assigned_cor_id),c("Ticket unlinked from COR","success"));ze(),w(!1),M(null),de("")}catch(Y){console.error("Error updating COR association:",Y),c("Error updating COR link","error")}},ja=async(Y,q)=>{if(q?.stopPropagation(),!!Y.assigned_cor_id){Re(Y.id);try{await K.importTicketDataToCOR(Y.id,Y.assigned_cor_id,l.id,r.work_type||"demolition",r.job_type||"standard"),c("COR data import successful!","success"),Oe(we=>{const lt={...we};return delete lt[Y.id],lt}),ze()}catch(we){console.error("Error retrying import:",we),c("Import retry failed. Please try again.","error")}finally{Re(null)}}},Ce=Y=>{let q=0;return Y.t_and_m_items&&Y.t_and_m_items.forEach(we=>{we.materials_equipment?.cost_per_unit&&(q+=we.quantity*we.materials_equipment.cost_per_unit)}),q},qe=Y=>Y.t_and_m_workers?Y.t_and_m_workers.reduce((q,we)=>{const lt=parseFloat(we.hours)||0,De=parseFloat(we.overtime_hours)||0;return q+lt+De},0):0,Fe=Y=>new Date(Y).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Ze=(Y,q)=>{q.stopPropagation(),H(we=>{const lt=new Set(we);return lt.has(Y)?lt.delete(Y):lt.add(Y),lt})},Ke=()=>{const Y=p==="all"?m:m.filter(we=>we.status===p),q=Y.every(we=>v.has(we.id));H(q?new Set:new Set(Y.map(we=>we.id)))},et=()=>{H(new Set)},Me=()=>{const Y=p==="all"?m:m.filter(q=>q.status===p);return v.size>0?Y.filter(q=>v.has(q.id)):Y},bt=()=>{const Y=Me();if(Y.length===0){c("No tickets to export","error");return}const q=[],we=[],lt=[];Y.forEach(ot=>{const Yt=Fe(ot.work_date),sa=ot.status;ot.t_and_m_workers&&ot.t_and_m_workers.forEach(Ne=>{const xt=parseFloat(Ne.hours)||0,dt=parseFloat(Ne.overtime_hours)||0;q.push({Date:Yt,Status:sa,"Worker Name":Ne.name,Role:Ne.role||"Laborer","Regular Hours":xt,"OT Hours":dt,"Total Hours":xt+dt})}),ot.t_and_m_items&&ot.t_and_m_items.forEach(Ne=>{const xt=Ne.custom_name||Ne.materials_equipment?.name||"Unknown",dt=Ne.custom_category||Ne.materials_equipment?.category||"Unknown",Oa=Ne.materials_equipment?.unit||"each",ke=Ne.materials_equipment?.cost_per_unit||0,T=Ne.quantity*ke;we.push({Date:Yt,Status:sa,Category:dt,Item:xt,Quantity:Ne.quantity,Unit:Oa,"Cost/Unit":ke,Total:T})}),lt.push({Date:Yt,Status:sa,Workers:ot.t_and_m_workers?.length||0,"Total Hours":qe(ot),Items:ot.t_and_m_items?.length||0,"Materials Cost":Ce(ot),Notes:ot.notes||""})});const De=hn.book_new(),ve=hn.json_to_sheet(lt);if(hn.book_append_sheet(De,ve,"Summary"),q.length>0){const ot=hn.json_to_sheet(q);hn.book_append_sheet(De,ot,"Workers")}if(we.length>0){const ot=hn.json_to_sheet(we);hn.book_append_sheet(De,ot,"Materials & Equipment")}const at=`${r.name}_TM_${new Date().toISOString().split("T")[0]}.xlsx`;Rx(De,at),c("Export downloaded!","success")},kt=async()=>{const Y=Me();if(Y.length===0){c("No tickets to export","error");return}c("Generating PDF...","info");const q=new Gi,we=q.internal.pageSize.getWidth(),lt=q.internal.pageSize.getHeight(),De=20;let ve=De;const at=Fp(u?.primary_color||"#3B82F6"),ot=Fp(u?.secondary_color||"#1E40AF");q.setFillColor(...at),q.rect(0,0,we,45,"F"),q.setFillColor(...ot),q.rect(0,42,we,3,"F");let Yt=De;if(u?.logo_url)try{const Ve=await ly(u.logo_url);Ve&&(q.addImage(Ve,"PNG",De,7,30,30),Yt=De+30+10)}catch(Ve){console.error("Error adding logo:",Ve)}q.setTextColor(255,255,255),q.setFontSize(22),q.setFont("helvetica","bold"),q.text(l?.name||"Company Name",Yt,20),q.setFontSize(10),q.setFont("helvetica","normal"),q.text("TIME & MATERIALS REPORT",Yt,30),q.setFontSize(9),q.text(`Report Date: ${new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,we-De,18,{align:"right"}),r.job_number&&q.text(`Job #: ${r.job_number}`,we-De,26,{align:"right"}),q.text(`Status: ${p.charAt(0).toUpperCase()+p.slice(1)}`,we-De,34,{align:"right"}),ve=55,q.setFillColor(248,250,252),q.rect(De,ve-5,we-De*2,30,"F"),q.setDrawColor(...at),q.setLineWidth(.5),q.rect(De,ve-5,we-De*2,30,"S"),q.setTextColor(...at),q.setFontSize(14),q.setFont("helvetica","bold"),q.text(`Project: ${r.name}`,De+5,ve+7),q.setFontSize(10),q.setFont("helvetica","normal"),q.setTextColor(51,65,85);const sa=Y.map(Ve=>new Date(Ve.work_date)).sort((Ve,tt)=>Ve-tt),Ne=sa[0]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),xt=sa[sa.length-1]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});q.text(`Date Range: ${Ne} - ${xt}`,De+5,ve+17),q.text(`Total Tickets: ${Y.length}`,we-De-5,ve+7,{align:"right"}),ve+=40;const dt=Y.reduce((Ve,tt)=>Ve+qe(tt),0),Oa=Y.reduce((Ve,tt)=>Ve+Ce(tt),0),ke=new Set(Y.flatMap(Ve=>Ve.t_and_m_workers?.map(tt=>tt.name)||[])).size;q.setTextColor(...at),q.setFontSize(12),q.setFont("helvetica","bold"),q.text("SUMMARY",De,ve),ve+=8;const T=(we-De*2-20)/3,ge=[{label:"Total Labor Hours",value:dt.toFixed(1)},{label:"Unique Workers",value:ke.toString()},{label:"Materials Cost",value:`$${Oa.toFixed(2)}`}],fe=at.map(Ve=>Math.min(255,Ve+180));ge.forEach((Ve,tt)=>{const At=De+tt*(T+10);q.setFillColor(...fe),q.rect(At,ve,T,25,"F"),q.setDrawColor(...at),q.setLineWidth(.5),q.rect(At,ve,T,25,"S"),q.setTextColor(...at),q.setFontSize(16),q.setFont("helvetica","bold"),q.text(Ve.value,At+T/2,ve+12,{align:"center"}),q.setTextColor(100,116,139),q.setFontSize(8),q.setFont("helvetica","normal"),q.text(Ve.label,At+T/2,ve+20,{align:"center"})}),ve+=35;const Te=[],jt=[],it=[];let Dt=0,ct=0,mt=0,va=0,Qt=0,Na=0;Y.forEach(Ve=>{Ve.t_and_m_workers&&Ve.t_and_m_workers.forEach(tt=>{const At=parseFloat(tt.hours)||0,$t=parseFloat(tt.overtime_hours)||0,N=tt.role||"Laborer",ne=[Fe(Ve.work_date),tt.name,At.toString(),$t>0?$t.toString():"-",(At+$t).toString()];N==="Foreman"||N==="Superintendent"?(Te.push(ne),Dt+=At,ct+=$t):N==="Operator"?(jt.push(ne),mt+=At,va+=$t):(it.push(ne),Qt+=At,Na+=$t)})});const $e=(Ve,tt,At,$t)=>{tt.length!==0&&(ve>lt-80&&(q.addPage(),ve=De),q.setTextColor(...at),q.setFontSize(11),q.setFont("helvetica","bold"),q.text(Ve,De,ve),ve+=5,fn(q,{startY:ve,head:[["Date","Name","Reg Hrs","OT Hrs","Total"]],body:tt,margin:{left:De,right:De},headStyles:{fillColor:at,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:30},2:{halign:"center",cellWidth:22},3:{halign:"center",cellWidth:22},4:{halign:"center",cellWidth:22}},foot:[["","SUBTOTAL:",At.toString(),$t>0?$t.toString():"-",(At+$t).toString()]],footStyles:{fillColor:ot,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),ve=q.lastAutoTable.finalY+10)};if(Te.length>0||jt.length>0||it.length>0){q.setTextColor(...at),q.setFontSize(12),q.setFont("helvetica","bold"),q.text("LABOR",De,ve),ve+=8,$e("SUPERVISION",Te,Dt,ct),$e("OPERATORS",jt,mt,va),$e("LABORERS",it,Qt,Na);const Ve=Dt+mt+Qt,tt=ct+va+Na;q.setFillColor(...at),q.rect(De,ve,we-De*2,12,"F"),q.setTextColor(255,255,255),q.setFontSize(10),q.setFont("helvetica","bold"),q.text("LABOR TOTAL:",De+5,ve+8),q.text(`${Ve} Reg + ${tt} OT = ${Ve+tt} Hours`,we-De-5,ve+8,{align:"right"}),ve+=20}ve>lt-100&&(q.addPage(),ve=De);const st={},Xt={},ya=["Containment","PPE","Disposal","Equipment","Other"];Y.forEach(Ve=>{Ve.t_and_m_items&&Ve.t_and_m_items.forEach(tt=>{const At=tt.custom_name||tt.materials_equipment?.name||"Unknown",$t=tt.custom_category||tt.materials_equipment?.category||"Other",N=tt.materials_equipment?.unit||"each",ne=tt.materials_equipment?.cost_per_unit||0,be=tt.quantity*ne;st[$t]||(st[$t]=[],Xt[$t]=0),st[$t].push([Fe(Ve.work_date),At,tt.quantity.toString(),N,`$${ne.toFixed(2)}`,`$${be.toFixed(2)}`]),Xt[$t]+=be})});const Ba=(Ve,tt,At)=>{!tt||tt.length===0||(ve>lt-80&&(q.addPage(),ve=De),q.setTextColor(...at),q.setFontSize(11),q.setFont("helvetica","bold"),q.text(Ve.toUpperCase(),De,ve),ve+=5,fn(q,{startY:ve,head:[["Date","Item","Qty","Unit","Rate","Total"]],body:tt,margin:{left:De,right:De},headStyles:{fillColor:at,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{2:{halign:"center",cellWidth:20},3:{halign:"center",cellWidth:25},4:{halign:"right",cellWidth:25},5:{halign:"right",cellWidth:30}},foot:[["","","","","Subtotal:",`$${At.toFixed(2)}`]],footStyles:{fillColor:ot,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),ve=q.lastAutoTable.finalY+10)};Object.keys(st).length>0&&(q.setTextColor(...at),q.setFontSize(12),q.setFont("helvetica","bold"),q.text("MATERIALS & EQUIPMENT",De,ve),ve+=8,ya.forEach(Ve=>{st[Ve]&&Ba(Ve,st[Ve],Xt[Ve])}),Object.keys(st).forEach(Ve=>{ya.includes(Ve)||Ba(Ve,st[Ve],Xt[Ve])}),q.setFillColor(...at),q.rect(De,ve,we-De*2,12,"F"),q.setTextColor(255,255,255),q.setFontSize(10),q.setFont("helvetica","bold"),q.text("MATERIALS TOTAL:",De+5,ve+8),q.text(`$${Oa.toFixed(2)}`,we-De-5,ve+8,{align:"right"}),ve+=20),ve>lt-80&&(q.addPage(),ve=De),ve+=10,q.setDrawColor(...at),q.setLineWidth(1),q.line(De,ve,we-De,ve),ve+=15,q.setTextColor(...at),q.setFontSize(12),q.setFont("helvetica","bold"),q.text("AUTHORIZATION",De,ve),ve+=10,q.setFontSize(10),q.setFont("helvetica","normal"),q.setTextColor(71,85,105),q.text("I hereby authorize the above time and materials charges as accurate and approved for billing.",De,ve),ve+=20;const It=ticketsToExport[0]||{},ga=(Ve,tt,At,$t,N,ne,be)=>{q.setFont("helvetica","bold"),q.setFontSize(8),q.setTextColor(...at),q.text(tt,De,Ve),q.setFont("helvetica","normal"),q.setFontSize(9),q.setTextColor(100,116,139);const re=Ve+18;if(q.setDrawColor(...ot),q.setLineWidth(.5),q.line(De,re,De+70,re),q.text("Signature",De,re+8),q.line(De+85,re,De+145,re),q.text("Title / Company",De+85,re+8),q.line(we-De-40,re,we-De,re),q.text("Date",we-De-40,re+8),At)try{if(q.addImage(At,"PNG",De,re-16,60,16),$t&&(q.setFontSize(8),q.text($t,De,re+15)),N||ne){const Ge=[N,ne].filter(Boolean).join(" - ");q.text(Ge,De+85,re-5)}if(be){const Ge=new Date(be).toLocaleDateString();q.text(Ge,we-De-40,re-5)}}catch(Ge){console.error("Error adding signature to PDF:",Ge)}return re+25};ve=ga(ve,"GC AUTHORIZATION",It.gc_signature_data,It.gc_signature_name,It.gc_signature_title,It.gc_signature_company,It.gc_signature_date),ve+=8,ve=ga(ve,"CLIENT AUTHORIZATION",It.client_signature_data,It.client_signature_name,It.client_signature_title,It.client_signature_company,It.client_signature_date);const Tt=q.internal.getNumberOfPages();for(let Ve=1;Ve<=Tt;Ve++){q.setPage(Ve);const tt=lt-15;q.setFontSize(8),q.setTextColor(148,163,184),q.text(`${l?.name||"Company"} - T&M Report - ${r.name}`,De,tt),q.text(`Page ${Ve} of ${Tt}`,we-De,tt,{align:"right"})}const $a=`${r.name}_TM_Report_${new Date().toISOString().split("T")[0]}.pdf`;q.save($a),c("PDF exported!","success")},Mt=g.useMemo(()=>{let Y=p==="all"?[...m]:m.filter(q=>q.status===p);if(O.start){const q=new Date(O.start);q.setHours(0,0,0,0),Y=Y.filter(we=>new Date(we.work_date)>=q)}if(O.end){const q=new Date(O.end);q.setHours(23,59,59,999),Y=Y.filter(we=>new Date(we.work_date)<=q)}if(B==="recent"){const q=new Date;q.setDate(q.getDate()-7),q.setHours(0,0,0,0),Y=Y.filter(we=>new Date(we.work_date)>=q)}return Y},[m,p,B,O]),Gt=g.useMemo(()=>{if(B!=="all")return null;const Y={};return Mt.forEach(q=>{const we=new Date(q.work_date),lt=`${we.getFullYear()}-${String(we.getMonth()+1).padStart(2,"0")}`,De=we.toLocaleDateString("en-US",{month:"long",year:"numeric"});Y[lt]||(Y[lt]={label:De,tickets:[],hours:0,cost:0}),Y[lt].tickets.push(q),Y[lt].hours+=qe(q),Y[lt].cost+=Ce(q)}),Object.entries(Y).sort((q,we)=>we[0].localeCompare(q[0]))},[Mt,B]);g.useEffect(()=>{if(Gt&&Gt.length>0){const Y=Gt[0][0];G(new Set([Y]))}},[Gt]);const Et=Y=>{const q=new Set(ae);q.has(Y)?q.delete(Y):q.add(Y),G(q)},aa=Mt.reduce((Y,q)=>Y+qe(q),0),da=Mt.reduce((Y,q)=>Y+Ce(q),0),St=p==="all"?m.length:m.filter(Y=>Y.status===p).length;if(f)return e.jsx("div",{className:"loading",children:"Loading T&M tickets..."});const Je=Mt.length>0&&Mt.every(Y=>v.has(Y.id)),qt=v.size>0,Ee=Y=>{const q=!!Q[Y.id],we=Q[Y.id],lt=!!he[Y.id],De=Be===Y.id;return e.jsxs("div",{className:`tm-ticket-card ${Y.status} ${v.has(Y.id)?"selected":""} ${q?"locked":""}`,children:[e.jsxs("div",{className:"tm-ticket-header",onClick:()=>S(R===Y.id?null:Y.id),children:[e.jsx("input",{type:"checkbox",checked:v.has(Y.id),onChange:ve=>Ze(Y.id,ve),onClick:ve=>ve.stopPropagation(),className:"tm-checkbox"}),e.jsxs("div",{className:"tm-ticket-info",children:[e.jsx("span",{className:"tm-ticket-date",children:Fe(Y.work_date)}),Y.ce_pco_number&&e.jsx("span",{className:"tm-ce-badge",children:Y.ce_pco_number}),Y.assigned_cor_id&&we?.lockedBy&&e.jsxs("span",{className:`tm-cor-badge ${q?"locked":""}`,title:we.reason,children:[q&&e.jsx(qp,{size:10}),we.lockedBy.cor_number]}),Y.photos?.length>0&&e.jsxs("span",{className:"tm-photo-badge",title:`${Y.photos.length} photo${Y.photos.length>1?"s":""}`,children:[e.jsx($n,{size:12})," ",Y.photos.length]}),lt&&e.jsxs("span",{className:"tm-import-failed-badge",title:"COR data import failed - retry needed",children:[e.jsx(Er,{size:12})," Import Failed"]}),Y.client_signature_data&&e.jsxs("span",{className:"tm-verified-badge",title:`Verified by ${Y.client_signature_name||"client"}${Y.client_signature_date?` on ${Fe(Y.client_signature_date)}`:""}`,children:[e.jsx(Ja,{size:12})," Verified"]}),e.jsx("span",{className:`tm-ticket-status ${Y.status}`,children:Y.status})]}),e.jsxs("div",{className:"tm-ticket-summary",children:[e.jsxs("span",{className:"tm-ticket-hours",children:[qe(Y)," hrs"]}),e.jsxs("span",{className:"tm-ticket-total",children:["$",Ce(Y).toFixed(2)]}),e.jsx("span",{className:"tm-expand-arrow",children:R===Y.id?"":""})]})]}),R===Y.id&&e.jsxs("div",{className:"tm-ticket-details",children:[Y.t_and_m_workers?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Ea,{size:16,className:"inline-icon"})," Workers"]}),e.jsx("div",{className:"tm-detail-list",children:Y.t_and_m_workers.map(ve=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsxs("span",{children:[ve.role&&ve.role!=="Laborer"&&e.jsx("span",{className:"tm-role-badge",children:ve.role}),ve.name]}),e.jsxs("span",{children:[ve.hours," hrs",parseFloat(ve.overtime_hours)>0&&e.jsxs("span",{className:"tm-ot-badge",children:[" +",ve.overtime_hours," OT"]})]})]},ve.id))})]}),Y.t_and_m_items?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Nl,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsx("div",{className:"tm-detail-list",children:Y.t_and_m_items.map(ve=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsx("span",{children:ve.custom_name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"tm-custom-badge",children:"Custom"})," ",ve.custom_name]}):ve.materials_equipment?.name}),e.jsxs("span",{className:"tm-detail-qty",children:[ve.quantity," ",ve.materials_equipment?.unit||"each",ve.materials_equipment?.cost_per_unit>0&&e.jsxs("span",{className:"tm-item-cost",children:["$",(ve.quantity*ve.materials_equipment.cost_per_unit).toFixed(2)]})]})]},ve.id))})]}),Y.notes&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Aa,{size:16,className:"inline-icon"})," Description"]}),e.jsx("p",{className:"tm-notes-text",children:Y.notes})]}),Y.photos&&Y.photos.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx($n,{size:16,className:"inline-icon"})," Photos (",Y.photos.length,")"]}),e.jsx("div",{className:"tm-photos-grid",children:Y.photos.map((ve,at)=>e.jsx("a",{href:ve,target:"_blank",rel:"noopener noreferrer",className:"tm-photo-thumb",children:e.jsx("img",{src:ve,alt:`Photo ${at+1}`,onError:ot=>{ot.target.onerror=null,ot.target.classList.add("photo-error"),ot.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg==",console.error("Failed to load photo:",ve)}})},at))})]}),Y.ce_pco_number&&Y.change_order_value>0&&e.jsxs("div",{className:"tm-change-order-value",children:[e.jsx("span",{className:"tm-co-label",children:"Change Order Value:"}),e.jsxs("span",{className:"tm-co-amount",children:["$",Y.change_order_value.toLocaleString()]})]}),q&&e.jsxs("div",{className:"tm-lock-notice",children:[e.jsx(qp,{size:14}),e.jsx("span",{children:we?.reason||"This ticket is locked (COR approved)"})]}),e.jsxs("div",{className:"tm-ticket-actions",children:[Y.status==="pending"&&!q&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:ve=>{ve.stopPropagation(),rt(Y)},children:"Approve"}),e.jsx("button",{className:"btn btn-warning btn-small",onClick:ve=>{ve.stopPropagation(),pt(Y.id,"rejected")},children:"Reject"})]}),Y.status==="approved"&&!q&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary btn-small",onClick:ve=>{ve.stopPropagation(),pt(Y.id,"billed")},children:"Mark Billed"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:ve=>{ve.stopPropagation(),L(Y),y(!0)},children:[e.jsx(Ad,{size:14})," Signature Link"]})]}),Y.status==="rejected"&&!q&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:ve=>{ve.stopPropagation(),pt(Y.id,"pending")},children:"Restore"}),!q&&e.jsxs("button",{className:`btn btn-small ${Y.assigned_cor_id?"btn-ghost":"btn-secondary"}`,onClick:ve=>{ve.stopPropagation(),Ye(Y)},title:Y.assigned_cor_id?"Change COR link":"Link to Change Order",children:[e.jsx(Ij,{size:14})," ",Y.assigned_cor_id?"COR":"Link COR"]}),lt&&!q&&e.jsxs("button",{className:"btn btn-warning btn-small",onClick:ve=>ja(Y,ve),disabled:De,title:"Retry syncing data to COR",children:[e.jsx(xf,{size:14,className:De?"spin":""})," ",De?"Syncing...":"Retry Sync"]}),!q&&e.jsx("button",{className:"btn btn-danger btn-small",onClick:ve=>{ve.stopPropagation(),Ae(Y.id)},children:"Delete"})]})]})]},Y.id)};return e.jsxs("div",{className:`tm-list ${i?"tm-list-compact":""}`,children:[!i&&e.jsxs("div",{className:"tm-list-header",children:[e.jsxs("div",{className:"tm-list-title",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("div",{className:"tm-export-buttons",children:[qt&&e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:et,children:["Clear (",v.size,")"]}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:bt,children:["Excel ",qt?`(${v.size})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:kt,children:["PDF ",qt?`(${v.size})`:""]})]})]}),e.jsx("div",{className:"tm-filter-tabs",children:["all","pending","approved","billed","rejected"].map(Y=>e.jsxs("button",{className:`tm-filter-tab ${p===Y?"active":""}`,onClick:()=>{j(Y),et()},children:[Y.charAt(0).toUpperCase()+Y.slice(1),e.jsx("span",{className:"tm-filter-count",children:Y==="all"?m.length:m.filter(q=>q.status===Y).length})]},Y))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${B==="recent"?"active":""}`,onClick:()=>{I("recent"),C({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${B==="all"?"active":""}`,onClick:()=>I("all"),children:["All (",St,")"]})]}),B==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(kr,{size:16}),e.jsx("input",{type:"date",value:O.start,onChange:Y=>C(q=>({...q,start:Y.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:O.end,onChange:Y=>C(q=>({...q,end:Y.target.value})),placeholder:"End date"}),(O.start||O.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>C({start:"",end:""}),children:"Clear"})]})]})]}),!i&&Mt.length>0&&e.jsxs("div",{className:"tm-summary-bar",children:[e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Tickets"}),e.jsx("span",{className:"tm-summary-value",children:Mt.length})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Total Hours"}),e.jsx("span",{className:"tm-summary-value",children:aa.toFixed(1)})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Materials Cost"}),e.jsxs("span",{className:"tm-summary-value",children:["$",da.toFixed(2)]})]})]}),Mt.length===0?e.jsxs("div",{className:"tm-empty-state",children:[e.jsxs("p",{children:["No ",p==="all"?"":p," T&M tickets",B==="recent"?" in the last 7 days":""]}),B==="recent"&&St>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>I("all"),children:"View All Tickets"})]}):e.jsxs("div",{className:"tm-tickets",children:[e.jsx("div",{className:"tm-select-all-row",children:e.jsxs("label",{className:"tm-checkbox-label",onClick:Ke,children:[e.jsx("input",{type:"checkbox",checked:Je,onChange:Ke,className:"tm-checkbox"}),e.jsxs("span",{children:["Select All (",Mt.length,")"]})]})}),B==="all"&&Gt?Gt.map(([Y,q])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>Et(Y),children:[e.jsxs("div",{className:"month-header-left",children:[ae.has(Y)?e.jsx(Da,{size:18}):e.jsx(Hs,{size:18}),e.jsx("span",{className:"month-label",children:q.label}),e.jsxs("span",{className:"month-count",children:[q.tickets.length," tickets"]})]}),e.jsxs("div",{className:"month-header-right",children:[e.jsxs("span",{className:"month-stat",children:[q.hours.toFixed(1)," hrs"]}),e.jsxs("span",{className:"month-stat",children:["$",q.cost.toFixed(2)]})]})]}),ae.has(Y)&&e.jsx("div",{className:"month-tickets",children:q.tickets.map(we=>Ee(we))})]},Y)):Mt.map(Y=>Ee(Y))]}),ee&&te&&e.jsx("div",{className:"modal-overlay",onClick:()=>me(!1),children:e.jsxs("div",{className:"modal change-order-modal",onClick:Y=>Y.stopPropagation(),children:[e.jsx("h3",{children:"Approve Change Order Work"}),e.jsxs("p",{className:"modal-subtitle",children:["This T&M ticket is associated with ",e.jsx("strong",{children:te.ce_pco_number})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Change Order Value ($)"}),e.jsx("input",{type:"number",value:V,onChange:Y=>ie(Y.target.value),placeholder:"Enter the change order amount",autoFocus:!0}),e.jsx("p",{className:"form-help",children:"This amount will be added to the project's total contract value."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>me(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:se,children:["Approve with $",parseFloat(V||0).toLocaleString()]})]})]})}),D&&z&&e.jsx(Ld,{documentType:"tm_ticket",documentId:z.id,companyId:l?.id,projectId:r?.id,documentTitle:`T&M Ticket - ${new Date(z.work_date).toLocaleDateString()}${z.ce_pco_number?` (${z.ce_pco_number})`:""}`,onClose:()=>{y(!1),L(null)},onShowToast:c}),J&&Z&&e.jsx("div",{className:"modal-overlay",onClick:()=>w(!1),children:e.jsxs("div",{className:"modal cor-assign-modal",onClick:Y=>Y.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Link Ticket to Change Order"}),e.jsx("button",{className:"close-btn",onClick:()=>w(!1),children:e.jsx(za,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{className:"modal-subtitle",children:["Ticket: ",e.jsx("strong",{children:new Date(Z.work_date).toLocaleDateString()}),Z.ce_pco_number&&` (${Z.ce_pco_number})`]}),A?e.jsx("div",{className:"loading",children:"Loading change orders..."}):oe.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No change orders found for this project."}),e.jsx("p",{className:"text-muted",children:"Create a COR first, then link tickets to it."})]}):e.jsxs("div",{className:"cor-select-wrapper",children:[e.jsx("label",{children:"Select Change Order:"}),e.jsxs("select",{value:U,onChange:Y=>de(Y.target.value),className:"cor-select",children:[e.jsx("option",{value:"",children:"-- No COR (unlink) --"}),oe.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.cor_number," - ",Y.title||"Untitled"," (",Y.status,")"]},Y.id))]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>w(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:ft,disabled:A||oe.length===0,children:Z.assigned_cor_id&&!U?"Unlink from COR":"Link to COR"})]})]})})]})}function cy({project:r,onClose:l,onShareCreated:c}){const{user:i}=Nf(),[u,m]=g.useState(!1),[x,f]=g.useState(null),[b,p]=g.useState([]),[j,R]=g.useState(!1),[S,v]=g.useState({progress:!0,photos:!0,daily_reports:!0,tm_tickets:!1,crew_info:!1}),[H,B]=g.useState("never"),[I,ae]=g.useState("");g.useEffect(()=>{G()},[r.id]);const G=async()=>{try{const y=await K.getProjectShares(r.id);p(y)}catch(y){console.error("Error loading shares:",y)}},O=y=>{v(z=>({...z,[y]:!z[y]}))},C=()=>{if(H==="never")return null;const y=new Date;if(H==="30days")y.setDate(y.getDate()+30);else if(H==="90days")y.setDate(y.getDate()+90);else if(H==="custom"&&I)return new Date(I).toISOString();return y.toISOString()},ee=async()=>{m(!0);try{const y=C(),z=await K.createProjectShare(r.id,i.id,S,y);f({type:"success",message:"Share link created!"}),R(!1),G(),c&&c(z)}catch(y){console.error("Error creating share:",y),f({type:"error",message:"Failed to create share link"})}finally{m(!1)}},me=y=>{const z=`${window.location.origin}/view/${y}`;navigator.clipboard.writeText(z),f({type:"success",message:"Link copied to clipboard!"})},te=async y=>{if(confirm("Are you sure you want to revoke this share link?"))try{await K.revokeProjectShare(y),f({type:"success",message:"Share link revoked"}),G()}catch(z){console.error("Error revoking share:",z),f({type:"error",message:"Failed to revoke share link"})}},P=async y=>{if(confirm("Are you sure you want to permanently delete this share link?"))try{await K.deleteProjectShare(y),f({type:"success",message:"Share link deleted"}),G()}catch(z){console.error("Error deleting share:",z),f({type:"error",message:"Failed to delete share link"})}},V=y=>y?new Date(y).toLocaleDateString():"Never",ie=y=>y?new Date(y)<new Date:!1,D=y=>{const z=[];return y.progress&&z.push("Progress"),y.photos&&z.push("Photos"),y.daily_reports&&z.push("Reports"),y.tm_tickets&&z.push("T&M"),y.crew_info&&z.push("Crew"),z.join(", ")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:l,children:e.jsxs("div",{className:"modal-content share-modal",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Share Project: ",r.name]}),e.jsx("button",{className:"close-btn",onClick:l,children:""})]}),e.jsxs("div",{className:"modal-body",children:[b.length>0&&e.jsxs("div",{className:"existing-shares",children:[e.jsx("h3",{children:"Active Share Links"}),e.jsx("div",{className:"shares-list",children:b.map(y=>e.jsxs("div",{className:`share-item ${!y.is_active||ie(y.expires_at)?"inactive":""}`,children:[e.jsxs("div",{className:"share-info",children:[e.jsxs("div",{className:"share-token",children:[e.jsxs("code",{children:[window.location.origin,"/view/",y.share_token]}),e.jsx("button",{className:"btn-small",onClick:()=>me(y.share_token),disabled:!y.is_active||ie(y.expires_at),children:"Copy"})]}),e.jsxs("div",{className:"share-meta",children:[e.jsx("span",{className:"permissions",children:D(y.permissions)}),e.jsxs("span",{className:"expiry",children:["Expires: ",V(y.expires_at)]}),e.jsxs("span",{className:"views",children:["Views: ",y.view_count||0,y.last_viewed_at&&` (Last: ${V(y.last_viewed_at)})`]})]}),!y.is_active&&e.jsx("div",{className:"status-badge revoked",children:"Revoked"}),ie(y.expires_at)&&y.is_active&&e.jsx("div",{className:"status-badge expired",children:"Expired"})]}),e.jsxs("div",{className:"share-actions",children:[y.is_active&&!ie(y.expires_at)&&e.jsx("button",{className:"btn-secondary",onClick:()=>te(y.id),children:"Revoke"}),e.jsx("button",{className:"btn-danger",onClick:()=>P(y.id),children:"Delete"})]})]},y.id))})]}),!j&&e.jsx("button",{className:"btn-primary",onClick:()=>R(!0),children:"+ Create New Share Link"}),j&&e.jsxs("div",{className:"new-share-form",children:[e.jsx("h3",{children:"Create New Share Link"}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Permissions"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:S.progress,onChange:()=>O("progress")}),"Progress/completion status"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:S.photos,onChange:()=>O("photos")}),"Photos feed"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:S.daily_reports,onChange:()=>O("daily_reports")}),"Daily reports"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:S.tm_tickets,onChange:()=>O("tm_tickets")}),"T&M tickets"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:S.crew_info,onChange:()=>O("crew_info")}),"Crew information"]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"never",checked:H==="never",onChange:y=>B(y.target.value)}),"Never expires"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"30days",checked:H==="30days",onChange:y=>B(y.target.value)}),"30 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"90days",checked:H==="90days",onChange:y=>B(y.target.value)}),"90 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"custom",checked:H==="custom",onChange:y=>B(y.target.value)}),"Custom date"]})]}),H==="custom"&&e.jsx("input",{type:"date",value:I,onChange:y=>ae(y.target.value),min:new Date().toISOString().split("T")[0],className:"date-input"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>R(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:ee,disabled:u,children:u?"Generating...":"Generate Share Link"})]})]})]})]})}),x&&e.jsx(Ls,{message:x.message,type:x.type,onClose:()=>f(null)}),e.jsx("style",{children:`
        .share-modal {
          max-width: 700px;
          max-height: 80vh;
          overflow-y: auto;
        }

        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1.5rem;
          border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .close-btn {
          background: none;
          border: none;
          font-size: 2rem;
          cursor: pointer;
          color: var(--text-secondary);
          padding: 0;
          width: 2rem;
          height: 2rem;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .close-btn:hover {
          color: var(--text-primary);
        }

        .modal-body {
          padding: 1.5rem;
        }

        .existing-shares {
          margin-bottom: 2rem;
        }

        .existing-shares h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .shares-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .share-item {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          gap: 1rem;
          background: var(--bg-card);
        }

        .share-item.inactive {
          opacity: 0.6;
          background-color: var(--bg-elevated);
        }

        .share-info {
          flex: 1;
        }

        .share-token {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-bottom: 0.5rem;
        }

        .share-token code {
          background-color: var(--bg-elevated);
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.875rem;
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          color: var(--text-primary);
        }

        .share-meta {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .status-badge {
          display: inline-block;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 500;
          margin-top: 0.5rem;
        }

        .status-badge.revoked {
          background-color: #fee2e2;
          color: #991b1b;
        }

        .status-badge.expired {
          background-color: #fef3c7;
          color: #92400e;
        }

        .share-actions {
          display: flex;
          gap: 0.5rem;
          flex-shrink: 0;
        }

        .new-share-form {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          background-color: var(--bg-elevated);
        }

        .new-share-form h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .form-section {
          margin-bottom: 1.5rem;
        }

        .form-section label {
          display: block;
          font-weight: 500;
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .checkbox-group,
        .radio-group {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .checkbox-group label,
        .radio-group label {
          font-weight: normal;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .checkbox-group input[type="checkbox"],
        .radio-group input[type="radio"] {
          margin: 0;
        }

        .date-input {
          margin-top: 0.5rem;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          width: 100%;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-actions {
          display: flex;
          justify-content: flex-end;
          gap: 0.5rem;
          margin-top: 1.5rem;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
          border: 1px solid var(--border-color);
          background-color: var(--bg-card);
          color: var(--text-primary);
          border-radius: 4px;
          cursor: pointer;
        }

        .btn-small:hover:not(:disabled) {
          background-color: var(--bg-elevated);
        }

        .btn-small:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }
      `})]})}const hd=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},oy=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});function dy({project:r,companyId:l,company:c,onShowToast:i}){const{branding:u}=Cr(),[m,x]=g.useState([]),[f,b]=g.useState(null),[p,j]=g.useState(!1),[R,S]=g.useState(!0),[v,H]=g.useState(null),[B,I]=g.useState("recent"),[ae,G]=g.useState(new Set),[O,C]=g.useState({start:"",end:""});g.useEffect(()=>{ee();const M=l||r?.company_id,oe=M?K.subscribeToInjuryReports?.(M,()=>{ee()}):null;return()=>{oe&&K.unsubscribe?.(oe)}},[r?.id,l]);const ee=async()=>{S(!0);try{const M=r?await K.getInjuryReports(r.id):await K.getCompanyInjuryReports(l);x(M)}catch(M){console.error("Error loading injury reports:",M),H({type:"error",message:"Failed to load injury reports"})}finally{S(!1)}},me=()=>{ee(),j(!1),H({type:"success",message:"Injury report created successfully"})},te=M=>{b(M)},P=()=>{b(null)},V=M=>M?new Date(M).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",ie=M=>M?new Date(`2000-01-01T${M}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",D=M=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[M]||M,y=M=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[M]||"#9ca3af",z=M=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[M]||"#9ca3af",L=g.useMemo(()=>{let M=[...m];if(O.start){const oe=new Date(O.start);oe.setHours(0,0,0,0),M=M.filter(E=>new Date(E.incident_date)>=oe)}if(O.end){const oe=new Date(O.end);oe.setHours(23,59,59,999),M=M.filter(E=>new Date(E.incident_date)<=oe)}if(B==="recent"){const oe=new Date;oe.setDate(oe.getDate()-7),oe.setHours(0,0,0,0),M=M.filter(E=>new Date(E.incident_date)>=oe)}return M},[m,B,O]),J=g.useMemo(()=>{if(B!=="all")return null;const M={};return L.forEach(oe=>{const E=new Date(oe.incident_date),U=`${E.getFullYear()}-${String(E.getMonth()+1).padStart(2,"0")}`,de=E.toLocaleDateString("en-US",{month:"long",year:"numeric"});M[U]||(M[U]={label:de,reports:[]}),M[U].reports.push(oe)}),Object.entries(M).sort((oe,E)=>E[0].localeCompare(oe[0]))},[L,B]);g.useEffect(()=>{if(J&&J.length>0){const M=J[0][0];G(new Set([M]))}},[J]);const w=M=>{const oe=new Set(ae);oe.has(M)?oe.delete(M):oe.add(M),G(oe)},Z=async()=>{if(m.length===0){H({type:"error",message:"No reports to export"});return}H({type:"info",message:"Generating PDF..."});const M=new Gi,oe=M.internal.pageSize.getWidth(),E=20;let U=E;const de=hd(u?.primary_color||"#3B82F6"),A=hd(u?.secondary_color||"#1E40AF");M.setFillColor(...de),M.rect(0,0,oe,45,"F"),M.setFillColor(...A),M.rect(0,42,oe,3,"F");let xe=E;if(u?.logo_url)try{const he=await oy(u.logo_url);he&&(M.addImage(he,"PNG",E,7,30,30),xe=E+40)}catch(he){console.error("Error adding logo:",he)}M.setTextColor(255,255,255),M.setFontSize(22),M.setFont("helvetica","bold"),M.text(c?.name||"Company",xe,20),M.setFontSize(10),M.setFont("helvetica","normal"),M.text("INJURY & INCIDENT REPORTS",xe,30),M.setFontSize(9),M.text(`Generated: ${new Date().toLocaleDateString()}`,oe-E,20,{align:"right"}),M.text(`Total Reports: ${m.length}`,oe-E,28,{align:"right"}),U=55,r&&(M.setFillColor(248,250,252),M.rect(E,U-5,oe-E*2,15,"F"),M.setTextColor(...de),M.setFontSize(12),M.setFont("helvetica","bold"),M.text(`Project: ${r.name}`,E+5,U+5),U+=20),m.forEach(he=>{U>200&&(M.addPage(),U=E);const Oe=hd(z(he.injury_type));M.setFillColor(...Oe),M.rect(E,U,oe-E*2,12,"F"),M.setTextColor(255,255,255),M.setFontSize(11),M.setFont("helvetica","bold"),M.text(`${he.employee_name} - ${D(he.injury_type)}`,E+5,U+8),M.text(V(he.incident_date),oe-E-5,U+8,{align:"right"}),U+=17,M.setTextColor(50,50,50),M.setFontSize(9),M.setFont("helvetica","normal"),M.text(`Location: ${he.incident_location}`,E+5,U),he.incident_time&&M.text(`Time: ${ie(he.incident_time)}`,E+100,U),U+=6,M.setFont("helvetica","bold"),M.text("Description:",E+5,U),M.setFont("helvetica","normal"),U+=5;const Be=M.splitTextToSize(he.incident_description,oe-E*2-10);M.text(Be,E+5,U),U+=Be.length*4+3;const Re=[];he.body_part_affected&&Re.push(`Body Part: ${he.body_part_affected}`),he.osha_recordable&&Re.push("OSHA Recordable"),he.workers_comp_claim&&Re.push("Workers' Comp Filed"),he.medical_treatment_required&&Re.push("Medical Treatment Required"),Re.length>0&&(M.setFontSize(8),M.setTextColor(100,100,100),M.text(Re.join("  |  "),E+5,U),U+=5),M.setFontSize(8),M.text(`Reported by: ${he.reported_by_name} (${he.reported_by_title})`,E+5,U),U+=12});const Q=M.internal.getNumberOfPages();for(let he=1;he<=Q;he++)M.setPage(he),M.setFontSize(8),M.setTextColor(150,150,150),M.text(`Page ${he} of ${Q}`,oe/2,M.internal.pageSize.getHeight()-10,{align:"center"}),M.text("CONFIDENTIAL - Injury Report",E,M.internal.pageSize.getHeight()-10);const Se=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;M.save(Se),H({type:"success",message:"PDF exported!"})};return R?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[m.length>0&&e.jsx("button",{className:"btn-secondary",onClick:Z,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>j(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${B==="recent"?"active":""}`,onClick:()=>{I("recent"),C({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${B==="all"?"active":""}`,onClick:()=>I("all"),children:["All (",m.length,")"]})]}),B==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(kr,{size:16}),e.jsx("input",{type:"date",value:O.start,onChange:M=>C(oe=>({...oe,start:M.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:O.end,onChange:M=>C(oe=>({...oe,end:M.target.value})),placeholder:"End date"}),(O.start||O.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>C({start:"",end:""}),children:"Clear"})]})]}),L.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:""}),e.jsxs("h4",{children:["No Injury Reports",B==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),B==="recent"&&m.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>I("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:B==="all"&&J?J.map(([M,oe])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>w(M),children:e.jsxs("div",{className:"month-header-left",children:[ae.has(M)?e.jsx(Da,{size:18}):e.jsx(Hs,{size:18}),e.jsx("span",{className:"month-label",children:oe.label}),e.jsxs("span",{className:"month-count",children:[oe.reports.length," reports"]})]})}),ae.has(M)&&e.jsx("div",{className:"month-reports",children:oe.reports.map(E=>e.jsxs("div",{className:"report-card",onClick:()=>te(E),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[V(E.incident_date)," at ",ie(E.incident_time)]}),e.jsx("div",{className:"employee-name",children:E.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:z(E.injury_type)},children:D(E.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:y(E.status)},children:E.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",E.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",E.reported_by_name," (",E.reported_by_title,")"]}),E.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",E.body_part_affected]}),E.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[E.incident_description.substring(0,150),E.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},E.id))})]},M)):L.map(M=>e.jsxs("div",{className:"report-card",onClick:()=>te(M),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[V(M.incident_date)," at ",ie(M.incident_time)]}),e.jsx("div",{className:"employee-name",children:M.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:z(M.injury_type)},children:D(M.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:y(M.status)},children:M.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",M.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",M.reported_by_name," (",M.reported_by_title,")"]}),M.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",M.body_part_affected]}),M.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[M.incident_description.substring(0,150),M.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},M.id))}),f&&e.jsx("div",{className:"modal-overlay",onClick:P,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:P,children:""})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[V(f.incident_date)," at ",ie(f.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:f.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:z(f.injury_type)},children:D(f.injury_type)})})]}),f.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:f.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:f.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:f.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:f.employee_job_title})]}),f.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:f.employee_phone})]}),f.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:f.employee_email})]}),f.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:f.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:f.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:f.reported_by_title})]}),f.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:f.reported_by_phone})]}),f.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:f.reported_by_email})]})]})]}),f.witnesses&&f.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),f.witnesses.map((M,oe)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:M.name}),M.phone&&e.jsxs("span",{children:["  ",M.phone]}),M.email&&e.jsxs("span",{children:["  ",M.email]})]}),M.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',M.testimony,'"']})})]},oe))]}),f.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[f.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:f.medical_facility_name})]}),f.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:f.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:f.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),f.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:f.immediate_actions_taken})]}),f.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:f.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[f.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:f.safety_equipment_used})]}),f.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:f.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:f.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:f.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:f.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:f.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",V(f.created_at)]})]})]})}),p&&e.jsx(Sf,{project:r,companyId:l,onClose:()=>j(!1),onReportCreated:me}),v&&e.jsx(Ls,{message:v.message,type:v.type,onClose:()=>H(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const pd=[{id:"message",label:"Messages",Icon:gf,description:"Chat messages from field"},{id:"material_request",label:"Material Requests",Icon:vn,description:"Equipment and material requests"},{id:"injury_report",label:"Safety Reports",Icon:jn,description:"Injury and safety incident reports"},{id:"tm_ticket",label:"T&M Tickets",Icon:cs,description:"Time and materials tickets"}];function uy({project:r,company:l,onShowToast:c,onClose:i}){const[u,m]=g.useState([]),[x,f]=g.useState({}),[b,p]=g.useState([]),[j,R]=g.useState(!0),[S,v]=g.useState(!1);g.useEffect(()=>{H()},[r?.id,l?.id]);const H=async()=>{if(!(!r?.id||!l?.id))try{R(!0);const O=await K.getCompanyUsers(l.id);m(O);const C=await K.getProjectNotificationPreferences(r.id),ee={};C.forEach(te=>{ee[te.user_id]={types:te.notification_types||[],presetId:null}}),f(ee);const me=await K.getNotificationPresets(l.id);p(me)}catch(O){console.error("Error loading notification settings:",O),c?.("Error loading notification settings","error")}finally{R(!1)}},B=(O,C)=>{f(ee=>{const me=ee[O]||{types:[]},te=me.types.includes(C)?me.types.filter(P=>P!==C):[...me.types,C];return{...ee,[O]:{types:te,presetId:null}}})},I=(O,C)=>{const ee=b.find(me=>me.id===C);ee&&f(me=>({...me,[O]:{types:[...ee.notification_types],presetId:C}}))},ae=(O,C)=>{f(ee=>({...ee,[O]:{types:C?pd.map(me=>me.id):[],presetId:null}}))},G=async()=>{try{v(!0);const O=Object.entries(x).map(([C,ee])=>({userId:C,notificationTypes:ee.types}));await K.setProjectNotificationPreferences(r.id,O),c?.("Notification settings saved","success"),i?.()}catch(O){console.error("Error saving notification settings:",O),c?.("Error saving notification settings","error")}finally{v(!1)}};return j?e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsx("button",{className:"close-btn",onClick:i,children:""})]}),e.jsx("div",{className:"loading-message",children:"Loading..."})]}):e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsxs("h3",{children:["Notification Settings for ",r?.name]}),e.jsx("button",{className:"close-btn",onClick:i,children:""})]}),e.jsx("p",{className:"settings-description",children:"Choose who receives notifications when field workers send messages, request materials, submit safety reports, or create T&M tickets for this project."}),u.length===0?e.jsxs("div",{className:"no-users-message",children:[e.jsx("p",{children:"No users found in this company."}),e.jsx("small",{children:"Users need to be added to the company to receive notifications."})]}):e.jsx("div",{className:"notification-users-list",children:u.map(O=>{const C=x[O.id]||{types:[],presetId:null},ee=C.types.length===pd.length,me=C.types.length>0&&!ee;return e.jsxs("div",{className:"notification-user-row",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:O.name?.charAt(0).toUpperCase()||O.email?.charAt(0).toUpperCase()}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:O.name||O.email}),O.role&&e.jsx("span",{className:"user-role",children:O.role})]})]}),e.jsxs("div",{className:"notification-controls",children:[e.jsxs("select",{className:"preset-select",value:C.presetId||"",onChange:te=>te.target.value&&I(O.id,te.target.value),children:[e.jsx("option",{value:"",children:"Apply preset..."}),b.map(te=>e.jsx("option",{value:te.id,children:te.name},te.id))]}),e.jsx("button",{className:`toggle-all-btn ${ee?"all-on":me?"some-on":""}`,onClick:()=>ae(O.id,!ee),title:ee?"Disable all":"Enable all",children:ee?"All On":me?"Some":"None"})]}),e.jsx("div",{className:"notification-types",children:pd.map(te=>e.jsxs("label",{className:`notification-type-toggle ${C.types.includes(te.id)?"active":""}`,title:te.description,children:[e.jsx("input",{type:"checkbox",checked:C.types.includes(te.id),onChange:()=>B(O.id,te.id)}),e.jsx("span",{className:"type-icon",children:e.jsx(te.Icon,{size:16})}),e.jsx("span",{className:"type-label",children:te.label})]},te.id))})]},O.id)})}),e.jsxs("div",{className:"notification-settings-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:i,children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:G,disabled:S,children:S?"Saving...":"Save Settings"})]})]})}const Bp=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},my=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});function hy({project:r,company:l,onShowToast:c}){const{branding:i}=Cr(),[u,m]=g.useState([]),[x,f]=g.useState(!0),[b,p]=g.useState(null),[j,R]=g.useState(new Set),[S,v]=g.useState(!1),[H,B]=g.useState("recent"),[I,ae]=g.useState(new Set),[G,O]=g.useState({start:"",end:""});g.useEffect(()=>{C();const E=K.subscribeToDailyReports?.(r.id,()=>{C()});return()=>{E&&K.unsubscribe?.(E)}},[r.id]);const C=async()=>{try{const E=await K.getDailyReports(r.id,365);m(E||[])}catch(E){console.error("Error loading daily reports:",E),c?.("Error loading daily reports","error")}finally{f(!1)}},ee=g.useMemo(()=>{let E=[...u];if(G.start){const U=new Date(G.start);U.setHours(0,0,0,0),E=E.filter(de=>new Date(de.report_date||de.created_at)>=U)}if(G.end){const U=new Date(G.end);U.setHours(23,59,59,999),E=E.filter(de=>new Date(de.report_date||de.created_at)<=U)}if(H==="recent"){const U=new Date;U.setDate(U.getDate()-7),U.setHours(0,0,0,0),E=E.filter(de=>new Date(de.report_date||de.created_at)>=U)}return E},[u,H,G]),me=g.useMemo(()=>{if(H!=="all")return null;const E={};return ee.forEach(U=>{const de=new Date(U.report_date||U.created_at),A=`${de.getFullYear()}-${String(de.getMonth()+1).padStart(2,"0")}`,xe=de.toLocaleDateString("en-US",{month:"long",year:"numeric"});E[A]||(E[A]={label:xe,reports:[]}),E[A].reports.push(U)}),Object.entries(E).sort((U,de)=>de[0].localeCompare(U[0]))},[ee,H]);g.useEffect(()=>{if(me&&me.length>0){const E=me[0][0];ae(new Set([E]))}},[me]);const te=()=>{v(!S),S&&R(new Set)},P=E=>{const U=new Set(j);U.has(E)?U.delete(E):U.add(E),R(U)},V=()=>{j.size===ee.length?R(new Set):R(new Set(ee.map(E=>E.id)))},ie=E=>{const U=new Set(I);U.has(E)?U.delete(E):U.add(E),ae(U)},D=()=>j.size>0?ee.filter(E=>j.has(E.id)):ee,y=E=>new Date(E).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),z=E=>new Date(E).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),L=E=>{switch(E){case"submitted":return"";case"reviewed":return"";case"draft":return"";default:return""}},J=E=>{switch(E){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return E}},w=async()=>{const E=D();if(E.length===0){c?.("No reports to export","error");return}c?.("Generating PDF...","info");const U=new Gi,de=U.internal.pageSize.getWidth(),A=20;let xe=A;const Q=Bp(i?.primary_color||"#3B82F6"),Se=Bp(i?.secondary_color||"#1E40AF");U.setFillColor(...Q),U.rect(0,0,de,45,"F"),U.setFillColor(...Se),U.rect(0,42,de,3,"F");let he=A;if(i?.logo_url)try{const Re=await my(i.logo_url);Re&&(U.addImage(Re,"PNG",A,7,30,30),he=A+40)}catch(Re){console.error("Error adding logo:",Re)}U.setTextColor(255,255,255),U.setFontSize(22),U.setFont("helvetica","bold"),U.text(l?.name||"Company Name",he,20),U.setFontSize(10),U.setFont("helvetica","normal"),U.text("DAILY REPORTS SUMMARY",he,30),U.setFontSize(9),U.text(`Generated: ${new Date().toLocaleDateString()}`,de-A,20,{align:"right"}),r.job_number&&U.text(`Job #: ${r.job_number}`,de-A,28,{align:"right"}),xe=55,U.setFillColor(248,250,252),U.rect(A,xe-5,de-A*2,20,"F"),U.setTextColor(...Q),U.setFontSize(14),U.setFont("helvetica","bold"),U.text(`Project: ${r.name}`,A+5,xe+7),U.setFontSize(10),U.setTextColor(100,100,100),U.text(`${E.length} Report${E.length!==1?"s":""}`,de-A-5,xe+7,{align:"right"}),xe+=25,E.forEach((Re,ze)=>{xe>250&&(U.addPage(),xe=A),U.setFillColor(...Q),U.setTextColor(255,255,255),U.rect(A,xe,de-A*2,10,"F"),U.setFontSize(11),U.setFont("helvetica","bold"),U.text(y(Re.report_date||Re.created_at),A+5,xe+7),U.text(J(Re.status),de-A-5,xe+7,{align:"right"}),xe+=15,U.setTextColor(50,50,50),U.setFontSize(10),U.setFont("helvetica","normal");const pt=`Crew: ${Re.crew_count||0}  |  Tasks: ${Re.tasks_completed||0}  |  T&M: ${Re.tm_tickets_count||0}  |  Photos: ${Re.photos_count||0}`;if(U.text(pt,A+5,xe),xe+=8,Re.crew_list?.length>0){U.setFont("helvetica","bold"),U.text("Crew:",A+5,xe),U.setFont("helvetica","normal");const rt=Re.crew_list.map(Ae=>`${Ae.name} (${Ae.role})`).join(", "),se=U.splitTextToSize(rt,de-A*2-30);U.text(se,A+25,xe),xe+=se.length*5+3}if(Re.field_notes){U.setFont("helvetica","bold"),U.text("Notes:",A+5,xe),U.setFont("helvetica","normal");const rt=U.splitTextToSize(Re.field_notes,de-A*2-30);U.text(rt,A+25,xe),xe+=rt.length*5+3}if(Re.issues){U.setTextColor(180,50,50),U.setFont("helvetica","bold"),U.text("Issues:",A+5,xe),U.setFont("helvetica","normal");const rt=U.splitTextToSize(Re.issues,de-A*2-30);U.text(rt,A+25,xe),U.setTextColor(50,50,50),xe+=rt.length*5+3}xe+=10});const Oe=U.internal.getNumberOfPages();for(let Re=1;Re<=Oe;Re++)U.setPage(Re),U.setFontSize(8),U.setTextColor(150,150,150),U.text(`Page ${Re} of ${Oe}`,de/2,U.internal.pageSize.getHeight()-10,{align:"center"});const Be=`${r.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;U.save(Be),c?.("PDF exported!","success")},Z=E=>e.jsxs("div",{className:`daily-report-card ${E.status} ${j.has(E.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>p(b===E.id?null:E.id),children:[S&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:j.has(E.id),onChange:U=>{U.stopPropagation(),P(E.id)},onClick:U=>U.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:y(E.report_date||E.created_at)}),e.jsxs("span",{className:`report-status ${E.status}`,children:[L(E.status)," ",J(E.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[E.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[E.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:b===E.id?"":""})]})]}),b===E.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:E.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:E.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:E.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:E.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),E.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:E.crew_list.map((U,de)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:U.name}),e.jsx("span",{className:"crew-role",children:U.role})]},de))})]}),E.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:E.completed_tasks.map((U,de)=>e.jsxs("li",{children:[U.name,U.group&&e.jsx("span",{className:"task-group",children:U.group})]},de))})]}),E.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:E.field_notes})]}),E.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:E.issues})]}),E.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",E.submitted_by||"Field"," at ",z(E.submitted_at)]})})]})]},E.id);if(x)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});const M=u.length,oe=ee.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${S?"btn-primary":"btn-secondary"}`,onClick:te,children:S?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:w,children:["PDF",j.size>0?` (${j.size})`:""]})]})})]}),u.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${H==="recent"?"active":""}`,onClick:()=>B("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${H==="all"?"active":""}`,onClick:()=>B("all"),children:["All (",M,")"]})]}),H==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(kr,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:G.start,onChange:E=>O(U=>({...U,start:E.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:G.end,onChange:E=>O(U=>({...U,end:E.target.value})),className:"date-input"}),(G.start||G.end)&&e.jsx("button",{className:"date-clear",onClick:()=>O({start:"",end:""}),children:"Clear"})]})]}),S&&ee.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:j.size===ee.length&&ee.length>0,onChange:V}),"Select All (",ee.length,")"]}),j.size>0&&e.jsxs("span",{className:"selected-count",children:[j.size," selected"]})]}),u.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(cs,{size:32})}),e.jsx("p",{children:"No daily reports yet"}),e.jsx("small",{children:"Reports from the field will appear here"})]}):ee.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(cs,{size:32})}),e.jsx("p",{children:"No reports in this time period"}),e.jsx("small",{children:H==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"})]}):H==="recent"?e.jsxs("div",{className:"daily-reports",children:[ee.map(E=>Z(E)),M>oe&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>B("all"),children:["View All ",M," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:me?.map(([E,{label:U,reports:de}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>ie(E),children:[I.has(E)?e.jsx(Da,{size:18,className:"month-chevron"}):e.jsx(Hs,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:U}),e.jsxs("span",{className:"month-count",children:[de.length," report",de.length!==1?"s":""]})]}),I.has(E)&&e.jsx("div",{className:"month-reports",children:de.map(A=>Z(A))})]},E))})]})}function py({project:r,company:l,onShowToast:c}){const[i,u]=g.useState(null),[m,x]=g.useState(!0),[f,b]=g.useState(!1);g.useEffect(()=>{if(r?.id&&l?.id){p();const H=K.subscribeToCrewCheckins?.(r.id,()=>{p()});return()=>{H&&K.unsubscribe?.(H)}}},[r?.id,l?.id]);const p=async()=>{try{const H=await K.calculateManDayCosts(r.id,l.id,r.work_type||"demolition",r.job_type||"standard");u(H)}catch(H){console.error("Error loading man day costs:",H)}finally{x(!1)}},j=H=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(H),R=H=>new Date(H).toLocaleDateString("en-US",{month:"short",day:"numeric"}),S=H=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[H]||H.charAt(0).toUpperCase()+H.slice(1);if(m)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!i||i.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Ea,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const v=Object.entries(i.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>b(!f),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:j(i.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:f?" Collapse":" Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:j(i.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.daysWorked>0?j(i.totalCost/i.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),f&&e.jsxs("div",{className:"man-day-details",children:[v.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:v.map(([H,B])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:S(H)}),e.jsxs("span",{className:"role-rate",children:[j(B.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[B.count," days"]}),e.jsx("span",{className:"role-cost",children:j(B.cost)})]})]},H))})]}),i.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:i.byDate.slice(0,7).map((H,B)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:R(H.date)}),e.jsxs("span",{className:"date-workers",children:[H.workers," crew"]}),e.jsx("span",{className:"date-cost",children:j(H.cost)})]},B))}),i.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",i.byDate.length-7," more days"]})]})]})]})}const os=r=>((r||0)/100).toFixed(2),Le=r=>{const l=(r||0)/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(l)},Li=r=>Math.round((parseFloat(r)||0)*100),pn=r=>((r||0)/100).toFixed(2),oa=r=>`${pn(r)}%`,Un=r=>Math.round((parseFloat(r)||0)*100),fy=(r,l,c,i)=>{const u=parseFloat(r)||0,m=parseFloat(l)||0,x=parseInt(c)||0,f=parseInt(i)||0,b=Math.round(u*x),p=Math.round(m*f),j=b+p;return{regularTotal:b,overtimeTotal:p,total:j}},$p=(r,l)=>{const c=parseFloat(r)||0,i=parseInt(l)||0;return Math.round(c*i)},Ui=(r,l)=>{const c=parseInt(r)||0,i=parseInt(l)||0;return Math.round(c*i/1e4)},fd=(r,l)=>{const c=parseInt(r)||0,i=parseInt(l)||0;return Math.round(c*i/1e4)},Yi=r=>{const l=(r.change_order_labor||[]).reduce((B,I)=>B+(parseInt(I.total)||0),0),c=(r.change_order_materials||[]).reduce((B,I)=>B+(parseInt(I.total)||0),0),i=(r.change_order_equipment||[]).reduce((B,I)=>B+(parseInt(I.total)||0),0),u=(r.change_order_subcontractors||[]).reduce((B,I)=>B+(parseInt(I.total)||0),0),m=Ui(l,r.labor_markup_percent??1500),x=Ui(c,r.materials_markup_percent??1500),f=Ui(i,r.equipment_markup_percent??1500),b=Ui(u,r.subcontractors_markup_percent??500),p=l+c+i+u+m+x+f+b,j=fd(p,r.liability_insurance_percent??144),R=fd(p,r.bond_percent??100),S=fd(p,r.license_fee_percent??10),v=j+R+S,H=p+v;return{labor_subtotal:l,materials_subtotal:c,equipment_subtotal:i,subcontractors_subtotal:u,labor_markup_amount:m,materials_markup_amount:x,equipment_markup_amount:f,subcontractors_markup_amount:b,liability_insurance_amount:j,bond_amount:R,license_fee_amount:S,additional_fees_total:v,cor_subtotal:p,cor_total:H}},Vp=r=>{const l=[];if(r.title?.trim()||l.push("Title is required"),r.scope_of_work?.trim()||l.push("Description is required"),r.period_start&&r.period_end){const i=new Date(r.period_start);new Date(r.period_end)<i&&l.push("End date must be after start date")}const c=5e3;return r.labor_markup_percent>c&&l.push("Labor markup percentage seems too high (>50%)"),r.materials_markup_percent>c&&l.push("Materials markup percentage seems too high (>50%)"),r.equipment_markup_percent>c&&l.push("Equipment markup percentage seems too high (>50%)"),r.subcontractors_markup_percent>c&&l.push("Subcontractors markup percentage seems too high (>50%)"),{valid:l.length===0,errors:l}},Cf=r=>{const l={draft:{label:"Draft",color:"#6b7280",bgColor:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bgColor:"#fef3c7"},approved:{label:"Approved",color:"#059669",bgColor:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bgColor:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bgColor:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bgColor:"#e5e7eb"}};return l[r]||l.draft},Wa=r=>r?new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",Qi=(r,l)=>{const c=Wa(r),i=Wa(l);return c&&i?`${c} - ${i}`:c||i||""},Hn={labor_markup:1500,materials_markup:1500,equipment_markup:1500,subcontractors_markup:500,liability_insurance:144,bond:100,license_fee:10},Gp=["Foreman","Superintendent","Operator","Laborer"],gy=[{value:"standard",label:"Standard"},{value:"pla",label:"PLA (Project Labor Agreement)"},{value:"prevailing",label:"Prevailing Wage"}],Pp=["each","day","week","month","hour","sqft","lf","gallon","pound","ton","cy","lump sum"];function xy({project:r,company:l,areas:c,refreshKey:i,onShowToast:u,onCreateCOR:m,onViewCOR:x,onEditCOR:f}){const[b,p]=g.useState([]),[j,R]=g.useState(!0),[S,v]=g.useState("all"),[H,B]=g.useState("all"),[I,ae]=g.useState("all"),[G,O]=g.useState(null),[C,ee]=g.useState(new Set),[me,te]=g.useState(!1),[P,V]=g.useState(!1),[ie,D]=g.useState(""),[y,z]=g.useState("recent"),[L,J]=g.useState(new Set),[w,Z]=g.useState({start:"",end:""}),[M,oe]=g.useState(null);g.useEffect(()=>{E(),U();const se=K.subscribeToCORs?.(r.id,()=>{E(),U()});return()=>{se&&K.unsubscribe?.(se)}},[r.id,i]);const E=async()=>{try{const se=await K.getCORs(r.id);p(se||[])}catch(se){console.error("Error loading CORs:",se),u?.("Error loading change order requests","error")}finally{R(!1)}},U=async()=>{try{const se=await K.getCORStats?.(r.id);oe(se)}catch(se){console.error("Error loading COR stats:",se)}},de=async(se,Ae)=>{if(Ae?.stopPropagation(),!!confirm("Are you sure you want to delete this COR? This action cannot be undone."))try{await K.deleteCOR(se),p(b.filter(Ye=>Ye.id!==se)),u?.("COR deleted","success"),U()}catch(Ye){console.error("Error deleting COR:",Ye),u?.("Error deleting COR","error")}},A=async(se,Ae)=>{Ae?.stopPropagation();try{await K.submitCORForApproval(se),await E(),u?.("COR submitted for approval","success"),U()}catch(Ye){console.error("Error submitting COR:",Ye?.message||Ye),u?.(Ye?.message||"Error submitting COR","error")}},xe=(se,Ae)=>{Ae?.stopPropagation(),ee(Ye=>{const ft=new Set(Ye);return ft.has(se)?ft.delete(se):ft.add(se),ft})},Q=()=>{te(!1),ee(new Set)},Se=async()=>{if(!ie.trim()){u?.("Please enter a group name","error");return}try{await K.bulkUpdateCORGroup([...C],ie.trim()),u?.(`${C.size} CORs grouped as "${ie.trim()}"`,"success"),V(!1),D(""),ee(new Set),te(!1),E()}catch(se){console.error("Error grouping CORs:",se),u?.("Error grouping CORs","error")}},he=g.useMemo(()=>{const se=b.map(Ae=>Ae.group_name).filter(Boolean);return[...new Set(se)].sort()},[b]),Oe=g.useMemo(()=>{let se=[...b];if(S!=="all"&&(se=se.filter(Ae=>Ae.status===S)),H!=="all"&&(se=se.filter(Ae=>Ae.area_id===H)),I!=="all"&&(se=se.filter(Ae=>Ae.group_name===I)),w.start){const Ae=new Date(w.start);Ae.setHours(0,0,0,0),se=se.filter(Ye=>new Date(Ye.created_at)>=Ae)}if(w.end){const Ae=new Date(w.end);Ae.setHours(23,59,59,999),se=se.filter(Ye=>new Date(Ye.created_at)<=Ae)}if(y==="recent"){const Ae=new Date;Ae.setDate(Ae.getDate()-7),Ae.setHours(0,0,0,0),se=se.filter(Ye=>new Date(Ye.created_at)>=Ae)}return se.sort((Ae,Ye)=>new Date(Ye.created_at)-new Date(Ae.created_at)),se},[b,S,H,I,y,w]),Be=g.useMemo(()=>{if(y!=="all")return null;const se={};return Oe.forEach(Ae=>{const Ye=new Date(Ae.created_at),ft=`${Ye.getFullYear()}-${String(Ye.getMonth()+1).padStart(2,"0")}`,ja=Ye.toLocaleDateString("en-US",{month:"long",year:"numeric"});se[ft]||(se[ft]={label:ja,cors:[],totalAmount:0}),se[ft].cors.push(Ae),se[ft].totalAmount+=Ae.cor_total||0}),Object.entries(se).sort((Ae,Ye)=>Ye[0].localeCompare(Ae[0]))},[Oe,y]);g.useEffect(()=>{if(Be&&Be.length>0){const se=Be[0][0];J(new Set([se]))}},[Be]);const Re=se=>{const Ae=new Set(L);Ae.has(se)?Ae.delete(se):Ae.add(se),J(Ae)},ze=g.useMemo(()=>({all:b.length,draft:b.filter(se=>se.status==="draft").length,pending_approval:b.filter(se=>se.status==="pending_approval").length,approved:b.filter(se=>se.status==="approved").length,rejected:b.filter(se=>se.status==="rejected").length,billed:b.filter(se=>se.status==="billed").length,closed:b.filter(se=>se.status==="closed").length}),[b]);S==="all"?b.length:b.filter(se=>se.status===S).length;const pt=se=>c?.find(Ye=>Ye.id===se)?.name||"No Area",rt=se=>{const Ae=Cf(se.status);se.id;const Ye=C.has(se.id),ft=["draft","pending_approval","approved"].includes(se.status),ja=["draft","pending_approval","rejected"].includes(se.status),Ce=se.status==="draft";return e.jsxs("div",{className:`cor-card ${se.status} ${Ye?"selected":""}`,onClick:()=>me?xe(se.id):x?.(se),onKeyDown:qe=>{(qe.key==="Enter"||qe.key===" ")&&(qe.preventDefault(),me?xe(se.id):x?.(se))},tabIndex:0,role:"button","aria-label":`${me?Ye?"Deselect":"Select":"View"} COR ${se.cor_number}: ${se.title||"Untitled"}, ${Ae.label}, ${Le(se.cor_total||0)}`,children:[e.jsxs("div",{className:"cor-card-header",children:[e.jsxs("div",{className:"cor-card-left",children:[me&&e.jsx("button",{className:"cor-select-checkbox",onClick:qe=>xe(se.id,qe),"aria-label":Ye?"Deselect":"Select",children:Ye?e.jsx(Ed,{size:18}):e.jsx(Sv,{size:18})}),e.jsx("span",{className:"cor-number",children:se.cor_number}),e.jsx("span",{className:"cor-status-badge",style:{backgroundColor:Ae.bgColor,color:Ae.color},children:Ae.label})]}),e.jsx("div",{className:"cor-card-right",children:e.jsx("span",{className:"cor-total",children:Le(se.cor_total||0)})})]}),e.jsxs("div",{className:"cor-card-body",children:[e.jsx("h4",{className:"cor-title",children:se.title||"Untitled COR"}),e.jsxs("div",{className:"cor-meta",children:[se.group_name&&e.jsx("span",{className:"cor-group-badge",children:se.group_name}),se.area_id&&e.jsx("span",{className:"cor-area",children:pt(se.area_id)}),e.jsx("span",{className:"cor-period",children:Qi(se.period_start,se.period_end)})]})]}),e.jsxs("div",{className:"cor-card-footer",children:[e.jsx("span",{className:"cor-created",children:Wa(se.created_at)}),e.jsxs("div",{className:"cor-actions",onClick:qe=>qe.stopPropagation(),children:[Ce&&e.jsx("button",{className:"cor-action-btn submit",onClick:qe=>A(se.id,qe),title:"Submit for Approval","aria-label":`Submit COR ${se.cor_number} for approval`,children:e.jsx(Rd,{size:14,"aria-hidden":"true"})}),ft&&e.jsx("button",{className:"cor-action-btn edit",onClick:qe=>{qe.stopPropagation(),f?.(se)},title:"Edit","aria-label":`Edit COR ${se.cor_number}`,children:e.jsx(yl,{size:14,"aria-hidden":"true"})}),e.jsx("button",{className:"cor-action-btn view",onClick:qe=>{qe.stopPropagation(),x?.(se)},title:"View Details","aria-label":`View COR ${se.cor_number} details`,children:e.jsx(Rj,{size:14,"aria-hidden":"true"})}),ja&&e.jsx("button",{className:"cor-action-btn delete",onClick:qe=>de(se.id,qe),title:"Delete","aria-label":`Delete COR ${se.cor_number}`,children:e.jsx(Us,{size:14,"aria-hidden":"true"})})]})]})]},se.id)};return j?e.jsx("div",{className:"loading",children:"Loading change order requests..."}):e.jsxs("div",{className:"cor-list",children:[e.jsxs("div",{className:"cor-list-header",children:[e.jsxs("div",{className:"cor-list-info",children:[e.jsx("h3",{children:"Change Orders"}),e.jsxs("div",{className:"cor-stats-inline",children:[e.jsxs("span",{className:"cor-stat-item",children:[ze.all," total"]}),ze.pending_approval>0&&e.jsxs("span",{className:"cor-stat-item pending",children:[ze.pending_approval," pending"]}),M?.totalApproved>0&&e.jsx("span",{className:"cor-stat-item approved",children:Le(M.totalApproved)})]})]}),e.jsxs("div",{className:"cor-header-actions",children:[e.jsx("button",{className:`btn btn-secondary btn-small ${me?"active":""}`,onClick:()=>me?Q():te(!0),children:me?e.jsxs(e.Fragment,{children:[e.jsx(za,{size:14})," Cancel"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ed,{size:14})," Select"]})}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:m,children:[e.jsx(vs,{size:14})," New COR"]})]})]}),me&&C.size>0&&e.jsxs("div",{className:"cor-selection-bar",children:[e.jsxs("span",{className:"selection-count",children:[C.size," selected"]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:()=>V(!0),children:[e.jsx(Fj,{size:14})," Group Selected"]})]}),e.jsxs("div",{className:"cor-controls",children:[e.jsx("div",{className:"cor-filter-pills",role:"tablist",children:[{id:"all",label:"All"},{id:"draft",label:"Draft"},{id:"pending_approval",label:"Pending"},{id:"approved",label:"Approved"}].map(se=>e.jsxs("button",{role:"tab","aria-selected":S===se.id,className:`cor-pill ${S===se.id?"active":""}`,onClick:()=>v(se.id),children:[se.label,ze[se.id]>0&&e.jsx("span",{className:"cor-pill-count",children:ze[se.id]})]},se.id))}),he.length>0&&e.jsxs("select",{className:"cor-group-filter",value:I,onChange:se=>ae(se.target.value),children:[e.jsx("option",{value:"all",children:"All Groups"}),he.map(se=>e.jsx("option",{value:se,children:se},se))]}),e.jsxs("div",{className:"cor-view-toggle",children:[e.jsx("button",{className:`cor-toggle-btn ${y==="recent"?"active":""}`,onClick:()=>{z("recent"),Z({start:"",end:""})},children:"Recent"}),e.jsx("button",{className:`cor-toggle-btn ${y==="all"?"active":""}`,onClick:()=>z("all"),children:"All"})]})]}),y==="all"&&e.jsxs("div",{className:"cor-date-filter",children:[e.jsx(kr,{size:14}),e.jsx("input",{type:"date",value:w.start,onChange:se=>Z(Ae=>({...Ae,start:se.target.value}))}),e.jsx("span",{className:"cor-date-sep",children:"to"}),e.jsx("input",{type:"date",value:w.end,onChange:se=>Z(Ae=>({...Ae,end:se.target.value}))}),(w.start||w.end)&&e.jsx("button",{className:"cor-clear-btn",onClick:()=>Z({start:"",end:""}),children:"Clear"})]}),Oe.length===0?e.jsxs("div",{className:"cor-empty",children:[e.jsx(Aa,{size:24,className:"cor-empty-icon"}),e.jsxs("p",{children:["No change orders ",S!=="all"?`(${S.replace("_"," ")})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:m,children:[e.jsx(vs,{size:14})," Create COR"]})]}):e.jsx("div",{className:"cor-cards",children:y==="all"&&Be?Be.map(([se,Ae])=>e.jsxs("div",{className:"cor-month-group",children:[e.jsxs("button",{className:"cor-month-header",onClick:()=>Re(se),children:[e.jsxs("div",{className:"cor-month-left",children:[L.has(se)?e.jsx(Da,{size:16}):e.jsx(Hs,{size:16}),e.jsx("span",{children:Ae.label}),e.jsx("span",{className:"cor-month-count",children:Ae.cors.length})]}),e.jsx("span",{className:"cor-month-total",children:Le(Ae.totalAmount)})]}),L.has(se)&&e.jsx("div",{className:"cor-month-items",children:Ae.cors.map(Ye=>rt(Ye))})]},se)):Oe.map(se=>rt(se))}),P&&e.jsx("div",{className:"modal-overlay",onClick:()=>V(!1),children:e.jsxs("div",{className:"modal-content cor-group-modal",onClick:se=>se.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Group ",C.size," CORs"]}),e.jsx("button",{className:"close-btn",onClick:()=>V(!1),children:e.jsx(za,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Group Name"}),e.jsx("input",{type:"text",value:ie,onChange:se=>D(se.target.value),placeholder:"e.g., Phase 1, Building A, Week 1",autoFocus:!0,onKeyDown:se=>{se.key==="Enter"&&Se(),se.key==="Escape"&&V(!1)}})]}),he.length>0&&e.jsxs("div",{className:"existing-groups",children:[e.jsx("label",{children:"Or select existing group:"}),e.jsx("div",{className:"group-chips",children:he.map(se=>e.jsx("button",{className:"group-chip",onClick:()=>D(se),children:se},se))})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>V(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:Se,children:"Group CORs"})]})]})})]})}function jy({projectId:r,corId:l,onImport:c,onClose:i,onShowToast:u}){const[m,x]=g.useState([]),[f,b]=g.useState(!0),[p,j]=g.useState(new Set),[R,S]=g.useState(null),[v,H]=g.useState(""),[B,I]=g.useState("unassigned");g.useEffect(()=>{ae()},[r]);const ae=async()=>{try{const P=await K.getTMTickets(r);x(P||[])}catch(P){console.error("Error loading tickets:",P),u?.("Error loading tickets","error")}finally{b(!1)}},G=g.useMemo(()=>{let P=[...m];if(B==="unassigned"?P=P.filter(V=>!V.assigned_cor_id):B==="approved"&&(P=P.filter(V=>V.status==="approved")),v){const V=v.toLowerCase();P=P.filter(ie=>ie.work_description?.toLowerCase().includes(V)||ie.ce_pco_number?.toLowerCase().includes(V)||ie.ticket_date?.includes(V))}return P.sort((V,ie)=>new Date(ie.ticket_date)-new Date(V.ticket_date)),P},[m,B,v]),O=P=>{const V=new Set(p);V.has(P)?V.delete(P):V.add(P),j(V)},C=()=>{p.size===G.length?j(new Set):j(new Set(G.map(P=>P.id)))},ee=P=>new Date(P).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),me=P=>{const V=P.workers?.length||0,ie=P.items?.length||0,D=P.materials_equipment?.filter(z=>z.type==="equipment")?.length||0;let y=0;return P.workers?.forEach(z=>{y+=(parseFloat(z.regular_hours)||0)+(parseFloat(z.overtime_hours)||0)}),{workerCount:V,itemCount:ie,equipmentCount:D,laborHours:y}},te=()=>{if(p.size===0){u?.("Please select at least one ticket","error");return}const P=m.filter(y=>p.has(y.id)),V=[],ie=[],D=[];P.forEach(y=>{y.workers?.forEach(z=>{V.push({id:`import-${y.id}-${z.id||Date.now()}`,labor_class:z.role||"Laborer",wage_type:"standard",regular_hours:parseFloat(z.regular_hours)||0,overtime_hours:parseFloat(z.overtime_hours)||0,regular_rate:0,overtime_rate:0,total:0,source_ticket_id:y.id,source_ticket_date:y.ticket_date})}),y.items?.forEach(z=>{ie.push({id:`import-${y.id}-${z.id||Date.now()}`,description:z.description||z.name,source_type:"backup_sheet",source_reference:`Ticket ${ee(y.ticket_date)}`,quantity:parseFloat(z.quantity)||1,unit:z.unit||"each",unit_cost:Li(z.unit_cost||0),total:Li((z.quantity||1)*(z.unit_cost||0)),source_ticket_id:y.id})}),y.materials_equipment?.filter(z=>z.type==="equipment").forEach(z=>{D.push({id:`import-${y.id}-${z.id||Date.now()}`,description:z.description||z.name,source_type:"backup_sheet",source_reference:`Ticket ${ee(y.ticket_date)}`,quantity:parseFloat(z.quantity)||1,unit:z.unit||"day",unit_cost:Li(z.unit_cost||z.cost||0),total:Li((z.quantity||1)*(z.unit_cost||z.cost||0)),source_ticket_id:y.id})})}),c?.({ticketIds:Array.from(p),laborItems:V,materialsItems:ie,equipmentItems:D}),i?.()};return f?e.jsx("div",{className:"modal-overlay",onClick:i,role:"dialog","aria-modal":"true","aria-label":"Loading tickets",children:e.jsx("div",{className:"modal-content ticket-selector-modal",onClick:P=>P.stopPropagation(),children:e.jsx("div",{className:"loading",role:"status","aria-live":"polite",children:"Loading tickets..."})})}):e.jsx("div",{className:"modal-overlay",onClick:i,role:"dialog","aria-modal":"true","aria-labelledby":"ticket-selector-title",children:e.jsxs("div",{className:"modal-content ticket-selector-modal",onClick:P=>P.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"ticket-selector-title",children:"Import from T&M Tickets"}),e.jsx("button",{className:"close-btn",onClick:i,"aria-label":"Close ticket selector",children:e.jsx(za,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"ticket-selector-controls",children:[e.jsxs("div",{className:"ticket-search",children:[e.jsx(Vi,{size:16,"aria-hidden":"true"}),e.jsx("input",{type:"text",placeholder:"Search tickets...",value:v,onChange:P=>H(P.target.value),"aria-label":"Search tickets"})]}),e.jsxs("div",{className:"ticket-filters",role:"group","aria-label":"Filter tickets by status",children:[e.jsx("button",{className:`filter-btn ${B==="unassigned"?"active":""}`,onClick:()=>I("unassigned"),"aria-pressed":B==="unassigned",children:"Unassigned"}),e.jsx("button",{className:`filter-btn ${B==="approved"?"active":""}`,onClick:()=>I("approved"),"aria-pressed":B==="approved",children:"Approved"}),e.jsx("button",{className:`filter-btn ${B==="all"?"active":""}`,onClick:()=>I("all"),"aria-pressed":B==="all",children:"All"})]})]}),e.jsxs("div",{className:"ticket-selector-header",children:[e.jsxs("label",{className:"select-all",children:[e.jsx("input",{type:"checkbox",checked:p.size===G.length&&G.length>0,onChange:C,"aria-label":`Select all ${G.length} tickets`}),e.jsxs("span",{children:["Select All (",G.length,")"]})]}),e.jsxs("span",{className:"selected-count",children:[p.size," selected"]})]}),e.jsx("div",{className:"modal-body ticket-selector-body",children:G.length===0?e.jsxs("div",{className:"ticket-empty",children:[e.jsx(Aa,{size:32}),e.jsx("p",{children:"No tickets found"}),B==="unassigned"&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>I("all"),children:"Show all tickets"})]}):e.jsx("div",{className:"ticket-list",children:G.map(P=>{const V=me(P),ie=p.has(P.id),D=R===P.id;return e.jsxs("div",{className:`ticket-item ${ie?"selected":""} ${P.assigned_cor_id?"assigned":""}`,children:[e.jsxs("div",{className:"ticket-item-main",children:[e.jsx("label",{className:"ticket-checkbox",children:e.jsx("input",{type:"checkbox",checked:ie,onChange:()=>O(P.id),disabled:P.assigned_cor_id&&P.assigned_cor_id!==l})}),e.jsxs("div",{className:"ticket-item-info",onClick:()=>S(D?null:P.id),children:[e.jsxs("div",{className:"ticket-item-header",children:[e.jsx("span",{className:"ticket-date",children:ee(P.ticket_date)}),e.jsx("span",{className:`ticket-status ${P.status}`,children:P.status}),P.ce_pco_number&&e.jsxs("span",{className:"ticket-pco",children:["CE/PCO: ",P.ce_pco_number]})]}),e.jsx("div",{className:"ticket-item-desc",children:P.work_description||"No description"}),e.jsxs("div",{className:"ticket-item-summary",children:[V.workerCount>0&&e.jsxs("span",{children:[e.jsx(Fs,{size:12})," ",V.workerCount," workers"]}),V.itemCount>0&&e.jsxs("span",{children:[e.jsx(vn,{size:12})," ",V.itemCount," items"]}),V.equipmentCount>0&&e.jsxs("span",{children:[e.jsx(ds,{size:12})," ",V.equipmentCount," equipment"]}),V.laborHours>0&&e.jsxs("span",{children:[V.laborHours," hrs"]})]})]}),e.jsx("button",{className:"ticket-expand-btn",onClick:()=>S(D?null:P.id),children:D?e.jsx(Da,{size:16}):e.jsx(Hs,{size:16})})]}),D&&e.jsxs("div",{className:"ticket-item-details",children:[P.workers?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Workers"}),e.jsx("ul",{children:P.workers.map((y,z)=>e.jsxs("li",{children:[y.name||y.role," - ",y.regular_hours||0," reg hrs",y.overtime_hours>0&&`, ${y.overtime_hours} OT hrs`]},z))})]}),P.items?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Materials"}),e.jsx("ul",{children:P.items.map((y,z)=>e.jsxs("li",{children:[y.description||y.name," - ",y.quantity," ",y.unit]},z))})]}),P.materials_equipment?.filter(y=>y.type==="equipment").length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Equipment"}),e.jsx("ul",{children:P.materials_equipment.filter(y=>y.type==="equipment").map((y,z)=>e.jsx("li",{children:y.description||y.name},z))})]})]})]},P.id)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:i,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:te,disabled:p.size===0,children:[e.jsx(Ta,{size:16})," Import ",p.size," Ticket",p.size!==1?"s":""]})]})]})})}function vy({project:r,company:l,areas:c,existingCOR:i,onClose:u,onSaved:m,onShowToast:x}){const[f,b]=g.useState(!1),[p,j]=g.useState([]),[R,S]=g.useState(!1),[v,H]=g.useState({labor:i?.change_order_labor?.length>0,materials:i?.change_order_materials?.length>0,equipment:i?.change_order_equipment?.length>0,subcontractors:i?.change_order_subcontractors?.length>0,markups:!1}),[B,I]=g.useState([]),[ae,G]=g.useState(""),[O,C]=g.useState("all"),[ee,me]=g.useState(""),[te,P]=g.useState(i?.title||""),[V,ie]=g.useState(i?.scope_of_work||""),[D,y]=g.useState(i?.cor_number||""),[z,L]=g.useState(i?.group_name||""),[J,w]=g.useState(i?.area_id||""),[Z,M]=g.useState(i?.period_start||""),[oe,E]=g.useState(i?.period_end||""),[U,de]=g.useState(i?.change_order_labor||[]),[A,xe]=g.useState(i?.change_order_materials||[]),[Q,Se]=g.useState(i?.change_order_equipment||[]),[he,Oe]=g.useState(i?.change_order_subcontractors||[]),[Be,Re]=g.useState(i?.labor_markup_percent??Hn.labor_markup),[ze,pt]=g.useState(i?.materials_markup_percent??Hn.materials_markup),[rt,se]=g.useState(i?.equipment_markup_percent??Hn.equipment_markup),[Ae,Ye]=g.useState(i?.subcontractors_markup_percent??Hn.subcontractors_markup),[ft,ja]=g.useState(i?.liability_insurance_percent??Hn.liability_insurance),[Ce,qe]=g.useState(i?.bond_percent??Hn.bond),[Fe,Ze]=g.useState(i?.license_fee_percent??Hn.license_fee);g.useEffect(()=>{Mt(),Ke(),i||Et()},[]);const Ke=async()=>{try{const T=await K.getAllMaterialsEquipment(l?.id);I(T||[])}catch(T){console.error("Error loading company materials:",T)}},et=g.useMemo(()=>B.filter(T=>!["Containment","PPE","Disposal"].includes(T.category)||T.active===!1||O!=="all"&&T.category!==O?!1:ae?T.name.toLowerCase().includes(ae.toLowerCase()):!0),[B,ae,O]),Me=g.useMemo(()=>B.filter(T=>T.category!=="Equipment"||T.active===!1?!1:ee?T.name.toLowerCase().includes(ee.toLowerCase()):!0),[B,ee]),bt=T=>{xe([...A,{description:T.name,source_type:"field_ticket",source_reference:"",quantity:1,unit:T.unit||"each",unit_cost:T.cost_per_unit||0,total:T.cost_per_unit||0}])},kt=T=>{Se([...Q,{description:T.name,source_type:"rental",source_reference:"",quantity:1,unit:T.unit||"day",unit_cost:T.cost_per_unit||0,total:T.cost_per_unit||0}])},Mt=async()=>{try{const T=await K.getLaborRates?.(l?.id,r?.work_type,r?.job_type);j(T||[])}catch(T){console.error("Error loading labor rates:",T)}},Gt=T=>{const ge=T?.toLowerCase()||"";return p.find(fe=>fe.role?.toLowerCase()===ge)||null},Et=async()=>{try{const T=await K.getNextCORNumber?.(r.id);y(T||`COR-${Date.now()}`)}catch(T){console.error("Error generating COR number:",T),y(`COR-${Date.now()}`)}},aa=T=>{H(ge=>({...ge,[T]:!ge[T]}))},da=g.useMemo(()=>({title:te,scope_of_work:V,area_id:J||null,cor_number:D,group_name:z||null,period_start:Z||null,period_end:oe||null,change_order_labor:U,change_order_materials:A,change_order_equipment:Q,change_order_subcontractors:he,labor_markup_percent:Be,materials_markup_percent:ze,equipment_markup_percent:rt,subcontractors_markup_percent:Ae,liability_insurance_percent:ft,bond_percent:Ce,license_fee_percent:Fe}),[te,V,J,D,z,Z,oe,U,A,Q,he,Be,ze,rt,Ae,ft,Ce,Fe]),St=g.useMemo(()=>Yi(da),[da]),Je=()=>{const T=Gp[0],ge=Gt(T);de([...U,{id:`temp-${Date.now()}`,labor_class:T,wage_type:"standard",regular_hours:0,overtime_hours:0,regular_rate:ge?Math.round((parseFloat(ge.regular_rate)||0)*100):0,overtime_rate:ge?Math.round((parseFloat(ge.overtime_rate)||0)*100):0,total:0}]),v.labor||aa("labor")},qt=(T,ge,fe)=>{const Te=[...U];if(Te[T]={...Te[T],[ge]:fe},ge==="labor_class"){const it=Gt(fe);it&&(Te[T].regular_rate=Math.round((parseFloat(it.regular_rate)||0)*100),Te[T].overtime_rate=Math.round((parseFloat(it.overtime_rate)||0)*100))}const{total:jt}=fy(Te[T].regular_hours,Te[T].overtime_hours,Te[T].regular_rate,Te[T].overtime_rate);Te[T].total=jt,de(Te)},Ee=T=>{de(U.filter((ge,fe)=>fe!==T))},Y=()=>{xe([...A,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"each",unit_cost:0,total:0}]),v.materials||aa("materials")},q=(T,ge,fe)=>{const Te=[...A];Te[T]={...Te[T],[ge]:fe},Te[T].total=$p(Te[T].quantity,Te[T].unit_cost),xe(Te)},we=T=>{xe(A.filter((ge,fe)=>fe!==T))},lt=()=>{Se([...Q,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"day",unit_cost:0,total:0}]),v.equipment||aa("equipment")},De=(T,ge,fe)=>{const Te=[...Q];Te[T]={...Te[T],[ge]:fe},Te[T].total=$p(Te[T].quantity,Te[T].unit_cost),Se(Te)},ve=T=>{Se(Q.filter((ge,fe)=>fe!==T))},at=()=>{Oe([...he,{id:`temp-${Date.now()}`,company_name:"",description:"",source_type:"invoice",source_reference:"",amount:0,total:0}]),v.subcontractors||aa("subcontractors")},ot=(T,ge,fe)=>{const Te=[...he];Te[T]={...Te[T],[ge]:fe},ge==="amount"&&(Te[T].total=parseInt(fe)||0),Oe(Te)},Yt=T=>{Oe(he.filter((ge,fe)=>fe!==T))},sa=T=>{T.laborItems?.length>0&&(de([...U,...T.laborItems]),H(ge=>({...ge,labor:!0}))),T.materialsItems?.length>0&&(xe([...A,...T.materialsItems]),H(ge=>({...ge,materials:!0}))),T.equipmentItems?.length>0&&(Se([...Q,...T.equipmentItems]),H(ge=>({...ge,equipment:!0}))),x?.(`Imported data from ${T.ticketIds.length} ticket(s)`,"success")},Ne=te.trim().length>0,xt=()=>({company_id:l.id,project_id:r.id,title:te,scope_of_work:V||"",area_id:J||null,cor_number:D,group_name:z||null,period_start:Z||new Date().toISOString().split("T")[0],period_end:oe||new Date().toISOString().split("T")[0],labor_markup_percent:Be,materials_markup_percent:ze,equipment_markup_percent:rt,subcontractors_markup_percent:Ae,liability_insurance_percent:ft,bond_percent:Ce,license_fee_percent:Fe,...St}),dt=async()=>{if(!Ne){x?.("Title is required","error");return}b(!0);try{const T={...xt(),status:"draft"};let ge;i?.id?ge=await K.updateCOR(i.id,T):ge=await K.createCOR(T),ge?.id&&await K.saveCORLineItems(ge.id,{laborItems:U,materialItems:A,equipmentItems:Q,subcontractorItems:he}),x?.("COR saved as draft","success"),m?.(ge),u?.()}catch(T){console.error("Error saving COR:",T),x?.("Error saving COR","error")}finally{b(!1)}},Oa=async()=>{const T=Vp(da);if(!T.valid){x?.(T.errors[0],"error");return}b(!0);try{const ge={...xt(),status:"draft"};let fe;i?.id?(fe=await K.updateCOR(i.id,ge),await K.saveCORLineItems(i.id,{laborItems:U,materialItems:A,equipmentItems:Q,subcontractorItems:he}),await K.submitCORForApproval(i.id)):(fe=await K.createCOR(ge),fe?.id&&(await K.saveCORLineItems(fe.id,{laborItems:U,materialItems:A,equipmentItems:Q,subcontractorItems:he}),await K.submitCORForApproval(fe.id))),x?.("COR submitted for approval","success"),m?.(fe),u?.()}catch(ge){console.error("Error submitting COR:",ge),x?.("Error submitting COR","error")}finally{b(!1)}},ke=({section:T,label:ge,count:fe,subtotal:Te})=>e.jsxs("div",{className:`cor-section-header ${v[T]?"expanded":""}`,onClick:()=>aa(T),children:[e.jsxs("div",{className:"cor-section-title",children:[v[T]?e.jsx(Da,{size:18}):e.jsx(Hs,{size:18}),e.jsx("span",{children:ge}),fe>0&&e.jsx("span",{className:"cor-section-count",children:fe})]}),Te>0&&e.jsx("span",{className:"cor-section-subtotal",children:Le(Te)})]});return e.jsxs("div",{className:"modal-overlay",onClick:u,children:[e.jsxs("div",{className:"modal-content cor-form-modal cor-form-simplified",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:i?"Edit Change Order Request":"New Change Order Request"}),e.jsx("button",{className:"close-btn",onClick:u,children:e.jsx(za,{size:20})})]}),e.jsxs("div",{className:"modal-body cor-form-body",children:[e.jsxs("div",{className:"cor-form-required",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group cor-number-field",children:[e.jsx("label",{children:"COR #"}),e.jsx("input",{type:"text",value:D,onChange:T=>y(T.target.value),className:"input-small"})]}),e.jsxs("div",{className:"form-group flex-grow",children:[e.jsx("label",{children:"Title *"}),e.jsx("input",{type:"text",value:te,onChange:T=>P(T.target.value),placeholder:"e.g., Additional Demolition Work - Building A"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:V,onChange:T=>ie(T.target.value),rows:2,placeholder:"Describe the scope of work (optional)"})]}),e.jsxs("div",{className:"form-row form-row-compact",children:[c&&c.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Area"}),e.jsxs("select",{value:J,onChange:T=>w(T.target.value),children:[e.jsx("option",{value:"",children:"None"}),c.map(T=>e.jsx("option",{value:T.id,children:T.name},T.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Group"}),e.jsx("input",{type:"text",value:z,onChange:T=>L(T.target.value),placeholder:"e.g., Phase 1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"date",value:Z,onChange:T=>M(T.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"date",value:oe,onChange:T=>E(T.target.value),min:Z})]})]})]}),e.jsx("div",{className:"cor-import-bar",children:e.jsxs("button",{className:"btn btn-ghost",onClick:()=>S(!0),children:[e.jsx(Aa,{size:16})," Import from T&M Tickets"]})}),e.jsxs("div",{className:"cor-sections",children:[e.jsxs("div",{className:"cor-section",children:[e.jsx(ke,{section:"labor",label:"Labor",count:U.length,subtotal:St.labor_subtotal}),v.labor&&e.jsxs("div",{className:"cor-section-content",children:[U.map((T,ge)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("select",{value:T.labor_class,onChange:fe=>qt(ge,"labor_class",fe.target.value),children:Gp.map(fe=>e.jsx("option",{value:fe,children:fe},fe))}),e.jsx("select",{value:T.wage_type,onChange:fe=>qt(ge,"wage_type",fe.target.value),children:gy.map(fe=>e.jsx("option",{value:fe.value,children:fe.label},fe.value))}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Reg hrs",value:T.regular_hours||"",onChange:fe=>qt(ge,"regular_hours",fe.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/hr",value:T.regular_rate?T.regular_rate/100:"",onChange:fe=>{const Te=fe.target.value.replace(/[^0-9.]/g,"");qt(ge,"regular_rate",Math.round(parseFloat(Te||0)*100))},className:"input-small"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"OT hrs",value:T.overtime_hours||"",onChange:fe=>qt(ge,"overtime_hours",fe.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/hr",value:T.overtime_rate?T.overtime_rate/100:"",onChange:fe=>{const Te=fe.target.value.replace(/[^0-9.]/g,"");qt(ge,"overtime_rate",Math.round(parseFloat(Te||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Le(T.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>Ee(ge),children:e.jsx(Us,{size:14})})]})},T.id||ge)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:Je,children:[e.jsx(vs,{size:14})," Add Labor"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(ke,{section:"materials",label:"Materials",count:A.length,subtotal:St.materials_subtotal}),v.materials&&e.jsxs("div",{className:"cor-section-content",children:[B.filter(T=>["Containment","PPE","Disposal"].includes(T.category)&&T.active!==!1).length>0&&e.jsxs("div",{className:"quick-select-compact",children:[e.jsxs("div",{className:"quick-select-search",children:[e.jsx(Vi,{size:14}),e.jsx("input",{type:"text",placeholder:"Search materials...",value:ae,onChange:T=>G(T.target.value)})]}),e.jsx("div",{className:"quick-select-items",children:et.slice(0,8).map(T=>e.jsx("button",{className:"quick-item",onClick:()=>bt(T),children:T.name},T.id))})]}),A.map((T,ge)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Description",value:T.description,onChange:fe=>q(ge,"description",fe.target.value),className:"input-wide"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Qty",value:T.quantity||"",onChange:fe=>q(ge,"quantity",fe.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("select",{value:T.unit,onChange:fe=>q(ge,"unit",fe.target.value),children:Pp.map(fe=>e.jsx("option",{value:fe,children:fe},fe))}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/unit",value:T.unit_cost?T.unit_cost/100:"",onChange:fe=>{const Te=fe.target.value.replace(/[^0-9.]/g,"");q(ge,"unit_cost",Math.round(parseFloat(Te||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Le(T.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>we(ge),children:e.jsx(Us,{size:14})})]})},T.id||ge)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:Y,children:[e.jsx(vs,{size:14})," Add Material"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(ke,{section:"equipment",label:"Equipment",count:Q.length,subtotal:St.equipment_subtotal}),v.equipment&&e.jsxs("div",{className:"cor-section-content",children:[B.filter(T=>T.category==="Equipment"&&T.active!==!1).length>0&&e.jsxs("div",{className:"quick-select-compact",children:[e.jsxs("div",{className:"quick-select-search",children:[e.jsx(Vi,{size:14}),e.jsx("input",{type:"text",placeholder:"Search equipment...",value:ee,onChange:T=>me(T.target.value)})]}),e.jsx("div",{className:"quick-select-items",children:Me.slice(0,8).map(T=>e.jsx("button",{className:"quick-item",onClick:()=>kt(T),children:T.name},T.id))})]}),Q.map((T,ge)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Description",value:T.description,onChange:fe=>De(ge,"description",fe.target.value),className:"input-wide"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Qty",value:T.quantity||"",onChange:fe=>De(ge,"quantity",fe.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("select",{value:T.unit,onChange:fe=>De(ge,"unit",fe.target.value),children:Pp.map(fe=>e.jsx("option",{value:fe,children:fe},fe))}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/unit",value:T.unit_cost?T.unit_cost/100:"",onChange:fe=>{const Te=fe.target.value.replace(/[^0-9.]/g,"");De(ge,"unit_cost",Math.round(parseFloat(Te||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Le(T.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>ve(ge),children:e.jsx(Us,{size:14})})]})},T.id||ge)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:lt,children:[e.jsx(vs,{size:14})," Add Equipment"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(ke,{section:"subcontractors",label:"Subcontractors",count:he.length,subtotal:St.subcontractors_subtotal}),v.subcontractors&&e.jsxs("div",{className:"cor-section-content",children:[he.map((T,ge)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Company",value:T.company_name,onChange:fe=>ot(ge,"company_name",fe.target.value)}),e.jsx("input",{type:"text",placeholder:"Description",value:T.description,onChange:fe=>ot(ge,"description",fe.target.value),className:"input-wide"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Amount",value:T.amount?T.amount/100:"",onChange:fe=>{const Te=fe.target.value.replace(/[^0-9.]/g,"");ot(ge,"amount",Math.round(parseFloat(Te||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Le(T.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>Yt(ge),children:e.jsx(Us,{size:14})})]})},T.id||ge)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:at,children:[e.jsx(vs,{size:14})," Add Subcontractor"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(ke,{section:"markups",label:"Markups & Fees",count:0,subtotal:St.total_markup_amount+St.total_fees}),v.markups&&e.jsxs("div",{className:"cor-section-content markups-content",children:[e.jsxs("div",{className:"markups-grid-compact",children:[e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Labor Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(Be),onChange:T=>Re(Un(T.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Le(St.labor_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Materials Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(ze),onChange:T=>pt(Un(T.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Le(St.materials_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Equipment Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(rt),onChange:T=>se(Un(T.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Le(St.equipment_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Subcontractors Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(Ae),onChange:T=>Ye(Un(T.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Le(St.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"fees-grid-compact",children:[e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Liability Insurance"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(ft),onChange:T=>ja(Un(T.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Le(St.liability_insurance_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Bond"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(Ce),onChange:T=>qe(Un(T.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Le(St.bond_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"City License Fee"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:pn(Fe),onChange:T=>Ze(Un(T.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Le(St.license_fee_amount)]})]})]})]})]})]}),e.jsxs("div",{className:"cor-summary-bar",children:[e.jsxs("div",{className:"cor-summary-item",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:Le(St.cor_subtotal)})]}),e.jsxs("div",{className:"cor-summary-item total",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:Le(St.cor_total)})]})]})]}),e.jsxs("div",{className:"modal-footer cor-form-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:u,disabled:f,children:"Cancel"}),e.jsxs("div",{className:"footer-actions",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:dt,disabled:f||!Ne,children:[e.jsx(jv,{size:16})," Save Draft"]}),e.jsxs("button",{className:"btn btn-primary",onClick:Oa,disabled:f||!Vp(da).valid,children:[e.jsx(Rd,{size:16})," Submit"]})]})]})]}),R&&e.jsx(jy,{projectId:r.id,corId:i?.id,onImport:sa,onClose:()=>S(!1),onShowToast:x})]})}const yy=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},Yp=r=>{if(!r)return"";const[l,c]=r.split(":"),i=parseInt(l),u=i>=12?"pm":"am";return`${i%12||12}:${c}${u}`},by=r=>r.time_started&&r.time_ended?`${Yp(r.time_started)} - ${Yp(r.time_ended)}`:"-",Md=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});async function _y(r){if(!r||r.length===0)return{totalPhotos:0,verified:0,failed:0,issues:[],manifest:[]};const l=[];let c=0,i=0;const u=[];for(const m of r)if(!(!m.photos||m.photos.length===0))for(const x of m.photos){const f={ticketId:m.id,workDate:m.work_date,url:x,verified:!1,error:null};try{await Md(x)?(f.verified=!0,c++):(f.error="Failed to load image",i++,u.push({ticketId:m.id,workDate:m.work_date,url:x,error:"Failed to load image"}))}catch(b){f.error=b.message||"Unknown error",i++,u.push({ticketId:m.id,workDate:m.work_date,url:x,error:f.error})}l.push(f)}return{totalPhotos:c+i,verified:c,failed:i,issues:u,manifest:l,allVerified:i===0,verifiedAt:new Date().toISOString()}}function Ny(r,l,c,i){const u=JSON.stringify({cor:r,tmTickets:l,photoManifest:c,totals:i});let m=0;for(let f=0;f<u.length;f++){const b=u.charCodeAt(f);m=(m<<5)-m+b,m=m&m}const x=Math.abs(m).toString(16).padStart(16,"0");return{cor_data:{id:r.id,cor_number:r.cor_number,title:r.title,description:r.description,status:r.status,created_at:r.created_at,submitted_at:r.submitted_at,labor_items:r.labor_items,material_items:r.material_items,equipment_items:r.equipment_items,gc_markup_percent:r.gc_markup_percent,profit_markup_percent:r.profit_markup_percent},tickets_data:(l||[]).map(f=>({id:f.id,work_date:f.work_date,ce_pco_number:f.ce_pco_number,notes:f.notes,status:f.status,created_at:f.created_at,workers:f.t_and_m_workers||[],items:f.t_and_m_items||[],photos:f.photos||[],client_signature_name:f.client_signature_name,client_signature_date:f.client_signature_date})),photos_manifest:c,totals_snapshot:i,checksum:x}}async function kf(r,l,c,i={},u=null,m={}){const{verifyPhotos:x=!1,createSnapshot:f=!1}=m;let b=null;x&&u?.length>0&&(b=await _y(u));const p=new Gi,j=p.internal.pageSize.getWidth(),R=p.internal.pageSize.getHeight(),S=20;let v=S;const H=Yi(r),B=i.primaryColor?yy(i.primaryColor):[30,58,138],I=[241,245,249];let ae=null;if(i.logoUrl)try{ae=await Md(i.logoUrl)}catch(y){console.error("Error loading logo:",y)}if(ae)try{p.addImage(ae,"PNG",S,v,40,15),v+=20}catch{p.setFontSize(16),p.setFont("helvetica","bold"),p.setTextColor(...B),p.text(c?.name||"Company Name",S,v+10),v+=20}else p.setFontSize(16),p.setFont("helvetica","bold"),p.setTextColor(...B),p.text(c?.name||"Company Name",S,v+10),v+=20;p.setFontSize(20),p.setFont("helvetica","bold"),p.setTextColor(0,0,0),p.text("CHANGE ORDER REQUEST",S,v),v+=10,p.setFontSize(12),p.setFont("helvetica","normal"),p.setTextColor(100,100,100),p.text(r.cor_number||"COR-XXXX",S,v);const G=r.status?.replace("_"," ").toUpperCase()||"DRAFT";p.setTextColor(...B),p.text(G,j-S-p.getTextWidth(G),v),v+=12,p.setDrawColor(...B),p.setLineWidth(.5),p.line(S,v,j-S,v),v+=10,p.setFontSize(10),p.setTextColor(0,0,0);const O=S,C=j/2;p.setFont("helvetica","bold"),p.text("Project:",O,v),p.setFont("helvetica","normal"),p.text(l?.name||"Project Name",O+25,v),p.setFont("helvetica","bold"),p.text("Job #:",C,v),p.setFont("helvetica","normal"),p.text(l?.job_number||"N/A",C+25,v),v+=6,p.setFont("helvetica","bold"),p.text("Period:",O,v),p.setFont("helvetica","normal"),p.text(Qi(r.period_start,r.period_end),O+25,v),p.setFont("helvetica","bold"),p.text("Date:",C,v),p.setFont("helvetica","normal"),p.text(Wa(r.created_at),C+25,v),v+=10,p.setFont("helvetica","bold"),p.setFontSize(12),p.text(r.title||"Untitled Change Order",S,v),v+=8,p.setFont("helvetica","normal"),p.setFontSize(10),p.setTextColor(80,80,80);const ee=p.splitTextToSize(r.scope_of_work||"No scope of work provided.",j-S*2);p.text(ee,S,v),v+=ee.length*5+10,r.change_order_labor?.length>0&&(p.setFont("helvetica","bold"),p.setFontSize(11),p.setTextColor(0,0,0),p.text("LABOR",S,v),v+=6,fn(p,{startY:v,head:[["Class","Type","Reg Hrs","Reg Rate","OT Hrs","OT Rate","Total"]],body:r.change_order_labor.map(y=>[y.labor_class,y.wage_type,y.regular_hours.toString(),`$${os(y.regular_rate)}/hr`,y.overtime_hours?.toString()||"-",y.overtime_hours?`$${os(y.overtime_rate)}/hr`:"-",Le(y.total)]),foot:[[{content:`Subtotal: ${Le(H.labor_subtotal)}`,colSpan:5,styles:{halign:"right",fontStyle:"bold"}},{content:`+${oa(r.labor_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Le(H.labor_subtotal+H.labor_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:S,right:S},headStyles:{fillColor:B,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:I,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=p.lastAutoTable.finalY+10),r.change_order_materials?.length>0&&(v>R-80&&(p.addPage(),v=S),p.setFont("helvetica","bold"),p.setFontSize(11),p.setTextColor(0,0,0),p.text("MATERIALS",S,v),v+=6,fn(p,{startY:v,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:r.change_order_materials.map(y=>[y.description,y.source_reference||y.source_type,y.quantity.toString(),y.unit,`$${os(y.unit_cost)}`,Le(y.total)]),foot:[[{content:`Subtotal: ${Le(H.materials_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${oa(r.materials_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Le(H.materials_subtotal+H.materials_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:S,right:S},headStyles:{fillColor:B,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:I,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=p.lastAutoTable.finalY+10),r.change_order_equipment?.length>0&&(v>R-80&&(p.addPage(),v=S),p.setFont("helvetica","bold"),p.setFontSize(11),p.setTextColor(0,0,0),p.text("EQUIPMENT",S,v),v+=6,fn(p,{startY:v,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:r.change_order_equipment.map(y=>[y.description,y.source_reference||y.source_type,y.quantity.toString(),y.unit,`$${os(y.unit_cost)}`,Le(y.total)]),foot:[[{content:`Subtotal: ${Le(H.equipment_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${oa(r.equipment_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Le(H.equipment_subtotal+H.equipment_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:S,right:S},headStyles:{fillColor:B,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:I,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=p.lastAutoTable.finalY+10),r.change_order_subcontractors?.length>0&&(v>R-80&&(p.addPage(),v=S),p.setFont("helvetica","bold"),p.setFontSize(11),p.setTextColor(0,0,0),p.text("SUBCONTRACTORS",S,v),v+=6,fn(p,{startY:v,head:[["Company","Description","Source","Amount"]],body:r.change_order_subcontractors.map(y=>[y.company_name,y.description,y.source_reference||y.source_type,Le(y.total)]),foot:[[{content:`Subtotal: ${Le(H.subcontractors_subtotal)}`,colSpan:2,styles:{halign:"right",fontStyle:"bold"}},{content:`+${oa(r.subcontractors_markup_percent||500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Le(H.subcontractors_subtotal+H.subcontractors_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:S,right:S},headStyles:{fillColor:B,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:I,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=p.lastAutoTable.finalY+10),v>R-100&&(p.addPage(),v=S),p.setFillColor(...I),p.roundedRect(S,v,j-S*2,70,3,3,"F"),v+=10,p.setFontSize(10),p.setFont("helvetica","normal"),p.setTextColor(0,0,0);const me=S+10,te=j-S-60;p.text("COR Subtotal:",me,v),p.setFont("helvetica","bold"),p.text(Le(H.cor_subtotal),te,v,{align:"right"}),v+=8,p.setFont("helvetica","normal"),p.setFontSize(9),p.text(`Liability Insurance (${oa(r.liability_insurance_percent||144)}):`,me,v),p.text(Le(H.liability_insurance_amount),te,v,{align:"right"}),v+=6,p.text(`Bond (${oa(r.bond_percent||100)}):`,me,v),p.text(Le(H.bond_amount),te,v,{align:"right"}),v+=6,p.text(`City License Fee (${oa(r.license_fee_percent||10)}):`,me,v),p.text(Le(H.license_fee_amount),te,v,{align:"right"}),v+=10,p.setFillColor(...B),p.roundedRect(me-5,v-3,j-S*2-10,16,2,2,"F"),p.setTextColor(255,255,255),p.setFontSize(12),p.setFont("helvetica","bold"),p.text("COR TOTAL:",me,v+8),p.text(Le(H.cor_total),te,v+8,{align:"right"}),v+=25,v>R-120&&(p.addPage(),v=S),v+=10,p.setTextColor(0,0,0),p.setFontSize(10),p.setFont("helvetica","bold"),p.text("AUTHORIZATION",S,v),v+=15,p.setFont("helvetica","normal"),p.setFontSize(9),p.setDrawColor(0,0,0);const P=(y,z,L,J,w,Z,M)=>{p.setFont("helvetica","bold"),p.setFontSize(8),p.text(z,S,y),p.setFont("helvetica","normal"),p.setFontSize(9);const oe=y+20;if(p.line(S,oe,S+70,oe),p.text("Signature",S,oe+8),p.line(S+85,oe,S+145,oe),p.text("Title / Company",S+85,oe+8),p.line(j-S-40,oe,j-S,oe),p.text("Date",j-S-40,oe+8),L)try{if(p.addImage(L,"PNG",S,oe-18,60,18),J&&(p.setFontSize(8),p.text(J,S,oe+15)),w||Z){const E=[w,Z].filter(Boolean).join(" - ");p.text(E,S+85,oe-5)}M&&p.text(Wa(M),j-S-40,oe-5)}catch(E){console.error("Error adding signature:",E)}else p.setFont("helvetica","italic"),p.setFontSize(9),p.setTextColor(150,150,150),p.text("Awaiting Signature",S+5,oe-5),p.setTextColor(0,0,0),p.setFont("helvetica","normal");return oe+25};if(v=P(v,"GC AUTHORIZATION",r.gc_signature_data||r.gc_signature,r.gc_signature_name||r.gc_signer_name,r.gc_signature_title,r.gc_signature_company,r.gc_signature_date||r.signed_at),v+=10,v=P(v,"CLIENT AUTHORIZATION",r.client_signature_data,r.client_signature_name,r.client_signature_title,r.client_signature_company,r.client_signature_date),u&&u.length>0){p.addPage(),v=S,p.setFontSize(16),p.setFont("helvetica","bold"),p.setTextColor(...B),p.text("T&M BACKUP DOCUMENTATION",S,v),v+=8,p.setFontSize(10),p.setFont("helvetica","normal"),p.setTextColor(100,100,100),p.text(`${u.length} T&M ticket${u.length>1?"s":""} associated with this COR`,S,v),v+=12,p.setDrawColor(...B),p.setLineWidth(.5),p.line(S,v,j-S,v),v+=10;for(const y of u){v>R-100&&(p.addPage(),v=S),p.setFillColor(245,247,250),p.roundedRect(S,v,j-S*2,18,2,2,"F"),p.setFontSize(11),p.setFont("helvetica","bold"),p.setTextColor(0,0,0),p.text(`T&M Ticket  ${Wa(y.work_date)}`,S+5,v+7),y.ce_pco_number&&(p.setFontSize(9),p.setFont("helvetica","normal"),p.setTextColor(100,100,100),p.text(`CE/PCO: ${y.ce_pco_number}`,S+5,v+14));const L={pending:[217,119,6],approved:[5,150,105],billed:[37,99,235]}[y.status]||[100,100,100];if(p.setFontSize(8),p.setTextColor(...L),p.text(y.status?.toUpperCase()||"PENDING",j-S-30,v+10),v+=24,y.notes){p.setFontSize(9),p.setFont("helvetica","italic"),p.setTextColor(80,80,80);const J=p.splitTextToSize(y.notes,j-S*2-10);p.text(J,S+5,v),v+=J.length*4+6}if(y.t_and_m_workers?.length>0&&(p.setFontSize(9),p.setFont("helvetica","bold"),p.setTextColor(0,0,0),p.text("Labor:",S+5,v),v+=4,fn(p,{startY:v,head:[["Worker","Time","Class","Hrs","OT"]],body:y.t_and_m_workers.map(J=>[J.name,by(J),J.role||J.labor_class||"Laborer",J.hours?.toString()||"0",J.overtime_hours?.toString()||"-"]),margin:{left:S+5,right:S},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),v=p.lastAutoTable.finalY+8),y.t_and_m_items?.length>0&&(v>R-60&&(p.addPage(),v=S),p.setFontSize(9),p.setFont("helvetica","bold"),p.setTextColor(0,0,0),p.text("Materials/Equipment:",S+5,v),v+=4,fn(p,{startY:v,head:[["Item","Qty","Unit","Unit Cost","Total"]],body:y.t_and_m_items.map(J=>[J.materials_equipment?.name||J.description||"Item",J.quantity?.toString()||"1",J.materials_equipment?.unit||"ea",J.materials_equipment?.cost_per_unit?`$${J.materials_equipment.cost_per_unit}`:"-",J.materials_equipment?.cost_per_unit&&J.quantity?`$${(J.quantity*J.materials_equipment.cost_per_unit).toFixed(2)}`:"-"]),margin:{left:S+5,right:S},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),v=p.lastAutoTable.finalY+8),y.photos?.length>0){v>R-80&&(p.addPage(),v=S),p.setFontSize(9),p.setFont("helvetica","bold"),p.setTextColor(0,0,0),p.text(`Photos (${y.photos.length}):`,S+5,v),v+=6;let J=S+5;const w=45,Z=35,M=3;for(let oe=0;oe<y.photos.length;oe++){oe>0&&oe%M===0&&(J=S+5,v+=Z+5),v+Z>R-20&&(p.addPage(),v=S,J=S+5);try{const E=await Md(y.photos[oe]);E?p.addImage(E,"JPEG",J,v,w,Z):(p.setFillColor(240,240,240),p.rect(J,v,w,Z,"F"),p.setFontSize(7),p.setTextColor(150,150,150),p.text("Photo unavailable",J+5,v+Z/2))}catch{p.setFillColor(240,240,240),p.rect(J,v,w,Z,"F"),p.setFontSize(7),p.setTextColor(150,150,150),p.text("Photo unavailable",J+5,v+Z/2)}J+=w+5}v+=Z+10}if(y.client_signature_data){v>R-40&&(p.addPage(),v=S),p.setFontSize(9),p.setFont("helvetica","bold"),p.setTextColor(16,185,129),p.text("Client Verification",S+5,v),v+=5;try{p.addImage(y.client_signature_data,"PNG",S+5,v,40,15),p.setFont("helvetica","normal"),p.setFontSize(8),p.setTextColor(0,0,0);const J=y.client_signature_name||"Client",w=y.client_signature_title||"",Z=y.client_signature_company||"",M=y.client_signature_date?Wa(y.client_signature_date):"";p.text(J,S+50,v+5),(w||Z)&&(p.setTextColor(100,100,100),p.text(`${w}${w&&Z?", ":""}${Z}`,S+50,v+9)),M&&(p.setTextColor(100,100,100),p.text(`Verified: ${M}`,S+50,v+13)),v+=20}catch{p.setFont("helvetica","normal"),p.setFontSize(8),p.setTextColor(0,0,0),p.text(`Verified by ${y.client_signature_name||"Client"}`,S+5,v+5),v+=10}}v+=5,p.setDrawColor(200,200,200),p.setLineWidth(.2),p.line(S,v,j-S,v),v+=10}}const V=p.internal.getNumberOfPages();for(let y=1;y<=V;y++){p.setPage(y);const z=R-10;p.setFontSize(8),p.setTextColor(150,150,150),p.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,S,z),p.text(`Page ${y} of ${V}`,j-S,z,{align:"right"})}const ie=`${r.cor_number||"COR"}_${l?.job_number||"export"}${u?.length?"_with_backup":""}.pdf`;p.save(ie);const D={success:!0,fileName:ie,exportedAt:new Date().toISOString(),photoManifest:b};return f&&(D.snapshot=Ny(r,u,b,H)),D}function Sy({onSave:r,onClose:l,signerName:c=""}){const i=g.useRef(null),[u,m]=g.useState(c),[x,f]=g.useState(!1),[b,p]=g.useState(!1),j=()=>{const G=i.current;return G?G.getContext("2d"):null},R=G=>{const O=i.current;if(!O)return{x:0,y:0};const C=O.getBoundingClientRect(),ee=O.width/C.width,me=O.height/C.height,te=G.touches?G.touches[0].clientX:G.clientX,P=G.touches?G.touches[0].clientY:G.clientY;return{x:(te-C.left)*ee,y:(P-C.top)*me}},S=G=>{G.preventDefault();const O=j();if(!O)return;const{x:C,y:ee}=R(G);O.beginPath(),O.moveTo(C,ee),p(!0),f(!0)},v=G=>{if(!b)return;G.preventDefault();const O=j();if(!O)return;const{x:C,y:ee}=R(G);O.lineTo(C,ee),O.stroke()},H=()=>{p(!1)},B=()=>{const G=i.current,O=j();!G||!O||(O.clearRect(0,0,G.width,G.height),f(!1))},I=G=>{if(!G)return;i.current=G;const O=G.getContext("2d");O.strokeStyle="#1e293b",O.lineWidth=2,O.lineCap="round",O.lineJoin="round"},ae=()=>{if(!x||!u.trim())return;const G=i.current;if(!G)return;const O=G.toDataURL("image/png");r({signature:O,signerName:u.trim(),signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal",onClick:G=>G.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"signature-title",children:"GC Signature"}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close signature modal",children:e.jsx(za,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Signer Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:u,onChange:G=>m(G.target.value),placeholder:"Enter full name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(zd,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Sign below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:I,width:500,height:200,className:"signature-canvas",onMouseDown:S,onMouseMove:v,onMouseUp:H,onMouseLeave:H,onTouchStart:S,onTouchMove:v,onTouchEnd:H,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!x&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:B,disabled:!x,"aria-label":"Clear signature",children:[e.jsx(bl,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("p",{className:"signature-legal",role:"note",children:"By signing above, I acknowledge that I have reviewed and approve this Change Order Request."})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:ae,disabled:!x||!u.trim(),"aria-label":"Save signature",children:[e.jsx(Ta,{size:16,"aria-hidden":"true"})," Save Signature"]})]})]})})}function wy({cor:r,project:l,company:c,areas:i,onClose:u,onEdit:m,onShowToast:x,onStatusChange:f}){const[b,p]=g.useState(!0),[j,R]=g.useState(r),[S,v]=g.useState(!1),[H,B]=g.useState(!1),[I,ae]=g.useState(new Set),[G,O]=g.useState(null),[C,ee]=g.useState(!1),[me,te]=g.useState(""),P=g.useCallback(async()=>{try{const Q=await K.getCORById(r.id);Q&&R(Q)}catch(Q){console.error("Error fetching COR details:",Q),x?.("Error loading COR details","error")}finally{p(!1)}},[r.id,x]);g.useEffect(()=>{P()},[P]),g.useEffect(()=>{const Q=K.subscribeToCorTickets?.(r.id,()=>{P()});return()=>{Q&&K.unsubscribe?.(Q)}},[r.id,P]);const V=g.useMemo(()=>Yi(j),[j]),ie=Cf(j.status),D=j.status==="pending_approval",y=["draft","pending_approval","approved"].includes(j.status),z=Q=>i?.find(he=>he.id===Q)?.name||null,L=async()=>{if(confirm("Approve this change order request?")){p(!0);try{await K.approveCOR(j.id),R({...j,status:"approved",approved_at:new Date().toISOString()}),x?.("COR approved","success"),f?.()}catch(Q){console.error("Error approving COR:",Q),x?.("Error approving COR","error")}finally{p(!1)}}},J=async()=>{const Q=prompt("Enter rejection reason (optional):");if(Q!==null){p(!0);try{await K.rejectCOR(j.id,Q),R({...j,status:"rejected",rejection_reason:Q}),x?.("COR rejected","success"),f?.()}catch(Se){console.error("Error rejecting COR:",Se),x?.("Error rejecting COR","error")}finally{p(!1)}}},w=async()=>{if(confirm("Mark this COR as billed?")){p(!0);try{await K.markCORAsBilled(j.id),R({...j,status:"billed"}),x?.("COR marked as billed","success"),f?.()}catch(Q){console.error("Error marking COR as billed:",Q),x?.("Error updating status","error")}finally{p(!1)}}},Z=async Q=>{p(!0);try{await K.saveCORSignature?.(j.id,{gc_signature:Q.signature,gc_signer_name:Q.signerName,signed_at:Q.signedAt}),R({...j,gc_signature:Q.signature,gc_signer_name:Q.signerName,signed_at:Q.signedAt}),v(!1),x?.("Signature saved","success"),f?.()}catch(Se){console.error("Error saving signature:",Se),x?.("Error saving signature","error")}finally{p(!1)}},M=j.status==="approved"&&!j.gc_signature,oe=async()=>{if(!me.trim()){ee(!1);return}p(!0);try{await K.updateCOR(j.id,{cor_number:me.trim()}),R({...j,cor_number:me.trim()}),ee(!1),x?.("COR number updated","success")}catch(Q){console.error("Error updating COR number:",Q),x?.("Error updating COR number","error")}finally{p(!1)}},E=()=>{te(j.cor_number||""),ee(!0)},U=Q=>{ae(Se=>{const he=new Set(Se);return he.has(Q)?he.delete(Q):he.add(Q),he})},de=g.useMemo(()=>j.change_order_ticket_associations?.map(Q=>Q.t_and_m_tickets).filter(Boolean)||[],[j.change_order_ticket_associations]),A=Q=>{const Se=Q.t_and_m_workers||[],he=Se.reduce((Be,Re)=>Be+(parseFloat(Re.hours)||0),0),Oe=Se.reduce((Be,Re)=>Be+(parseFloat(Re.overtime_hours)||0),0);return{regular:he,overtime:Oe,total:he+Oe}},xe=async()=>{try{x?.("Generating PDF with backup...","info"),await kf(j,l,c,{},de),x?.("PDF downloaded","success")}catch(Q){console.error("Error exporting PDF:",Q),x?.("Error generating PDF","error")}};return b?e.jsx("div",{className:"modal-overlay",onClick:u,children:e.jsx("div",{className:"modal-content cor-detail-modal",onClick:Q=>Q.stopPropagation(),children:e.jsx("div",{className:"cor-detail-loading",children:"Loading COR details..."})})}):e.jsxs("div",{className:"modal-overlay",onClick:u,role:"dialog","aria-modal":"true","aria-labelledby":"cor-detail-title",children:[e.jsxs("div",{className:"modal-content cor-detail-modal",onClick:Q=>Q.stopPropagation(),children:[e.jsxs("div",{className:"modal-header cor-detail-header",children:[e.jsxs("div",{className:"cor-detail-title-row",children:[e.jsxs("div",{children:[e.jsx("div",{className:"cor-detail-number",children:C?e.jsxs("div",{className:"cor-number-edit",children:[e.jsx("input",{type:"text",value:me,onChange:Q=>te(Q.target.value),onKeyDown:Q=>{Q.key==="Enter"&&oe(),Q.key==="Escape"&&ee(!1)},autoFocus:!0,className:"cor-number-input"}),e.jsx("button",{className:"btn-icon-sm",onClick:oe,title:"Save",children:e.jsx(Ta,{size:14})}),e.jsx("button",{className:"btn-icon-sm",onClick:()=>ee(!1),title:"Cancel",children:e.jsx(za,{size:14})})]}):e.jsxs("div",{className:"cor-number-display",children:[e.jsx("span",{children:j.cor_number}),y&&e.jsx("button",{className:"btn-icon-sm",onClick:E,title:"Edit COR number",children:e.jsx(Od,{size:12})})]})}),e.jsx("h2",{id:"cor-detail-title",children:j.title||"Untitled COR"})]}),e.jsx("button",{className:"close-btn",onClick:u,"aria-label":"Close COR details",children:e.jsx(za,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"cor-detail-meta",children:[e.jsx("span",{className:"cor-detail-status",style:{backgroundColor:ie.bgColor,color:ie.color},children:ie.label}),j.group_name&&e.jsx("span",{className:"cor-detail-group",children:j.group_name}),z(j.area_id)&&e.jsx("span",{className:"cor-detail-area",children:z(j.area_id)}),e.jsxs("span",{className:"cor-detail-period",children:[e.jsx(xn,{size:14})," ",Qi(j.period_start,j.period_end)]})]})]}),e.jsxs("div",{className:"modal-body cor-detail-body",children:[e.jsxs("div",{className:"cor-detail-section",children:[e.jsxs("h3",{children:[e.jsx(Aa,{size:18})," Scope of Work"]}),e.jsx("p",{className:"cor-scope-text",children:j.scope_of_work||"No scope of work provided."})]}),e.jsxs("div",{className:"cor-detail-section pricing-breakdown",children:[e.jsxs("h3",{children:[e.jsx(wr,{size:18})," Pricing Breakdown"]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Fs,{size:16}),e.jsx("span",{children:"Labor"})]}),e.jsx("span",{className:"category-subtotal",children:Le(V.labor_subtotal)})]}),j.change_order_labor?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"Reg Rate"}),e.jsx("th",{children:"OT Hrs"}),e.jsx("th",{children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:j.change_order_labor.map((Q,Se)=>e.jsxs("tr",{children:[e.jsx("td",{children:Q.labor_class}),e.jsx("td",{children:Q.wage_type}),e.jsx("td",{children:Q.regular_hours}),e.jsxs("td",{children:["$",os(Q.regular_rate),"/hr"]}),e.jsx("td",{children:Q.overtime_hours||"-"}),e.jsx("td",{children:Q.overtime_hours?`$${os(Q.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:Le(Q.total)})]},Se))})]})}):e.jsx("div",{className:"category-empty",children:"No labor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",oa(j.labor_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Le(V.labor_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(vn,{size:16}),e.jsx("span",{children:"Materials"})]}),e.jsx("span",{className:"category-subtotal",children:Le(V.materials_subtotal)})]}),j.change_order_materials?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:j.change_order_materials.map((Q,Se)=>e.jsxs("tr",{children:[e.jsx("td",{children:Q.description}),e.jsx("td",{children:Q.source_reference||Q.source_type}),e.jsx("td",{children:Q.quantity}),e.jsx("td",{children:Q.unit}),e.jsxs("td",{children:["$",os(Q.unit_cost)]}),e.jsx("td",{className:"text-right",children:Le(Q.total)})]},Se))})]})}):e.jsx("div",{className:"category-empty",children:"No material items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",oa(j.materials_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Le(V.materials_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(ds,{size:16}),e.jsx("span",{children:"Equipment"})]}),e.jsx("span",{className:"category-subtotal",children:Le(V.equipment_subtotal)})]}),j.change_order_equipment?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:j.change_order_equipment.map((Q,Se)=>e.jsxs("tr",{children:[e.jsx("td",{children:Q.description}),e.jsx("td",{children:Q.source_reference||Q.source_type}),e.jsx("td",{children:Q.quantity}),e.jsx("td",{children:Q.unit}),e.jsxs("td",{children:["$",os(Q.unit_cost)]}),e.jsx("td",{className:"text-right",children:Le(Q.total)})]},Se))})]})}):e.jsx("div",{className:"category-empty",children:"No equipment items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",oa(j.equipment_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Le(V.equipment_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(_l,{size:16}),e.jsx("span",{children:"Subcontractors"})]}),e.jsx("span",{className:"category-subtotal",children:Le(V.subcontractors_subtotal)})]}),j.change_order_subcontractors?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:j.change_order_subcontractors.map((Q,Se)=>e.jsxs("tr",{children:[e.jsx("td",{children:Q.company_name}),e.jsx("td",{children:Q.description}),e.jsx("td",{children:Q.source_reference||Q.source_type}),e.jsx("td",{className:"text-right",children:Le(Q.total)})]},Se))})]})}):e.jsx("div",{className:"category-empty",children:"No subcontractor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",oa(j.subcontractors_markup_percent||500),")"]}),e.jsxs("span",{children:["+",Le(V.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"cor-subtotal-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Le(V.cor_subtotal)})]}),e.jsxs("div",{className:"pricing-category fees-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(uv,{size:16}),e.jsx("span",{children:"Additional Fees"})]}),e.jsx("span",{className:"category-subtotal",children:Le(V.additional_fees_total)})]}),e.jsxs("div",{className:"fees-list",children:[e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Pi,{size:14}),e.jsxs("span",{children:["Liability Insurance (",oa(j.liability_insurance_percent||144),")"]})]}),e.jsx("span",{className:"fee-amount",children:Le(V.liability_insurance_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Aa,{size:14}),e.jsxs("span",{children:["Bond (",oa(j.bond_percent||100),")"]})]}),e.jsx("span",{className:"fee-amount",children:Le(V.bond_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx($i,{size:14}),e.jsxs("span",{children:["City License Fee (",oa(j.license_fee_percent||10),")"]})]}),e.jsx("span",{className:"fee-amount",children:Le(V.license_fee_amount)})]})]})]}),e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:Le(V.cor_total)})]})]}),de.length>0&&e.jsxs("div",{className:"cor-detail-section backup-section",children:[e.jsxs("h3",{children:[e.jsx(Aa,{size:18})," Backup Documentation"]}),e.jsxs("p",{className:"backup-summary",children:[de.length," T&M ticket",de.length!==1?"s":""," associated with this COR"]}),e.jsx("div",{className:"backup-tickets-list",children:de.map(Q=>{const Se=I.has(Q.id),he=A(Q),Oe=Q.t_and_m_workers?.length||0,Be=Q.t_and_m_items?.length||0,Re=Q.photos?.length||0;return e.jsxs("div",{className:"backup-ticket-card",children:[e.jsxs("div",{className:"backup-ticket-header",onClick:()=>U(Q.id),children:[e.jsx("div",{className:"backup-ticket-toggle",children:Se?e.jsx(Da,{size:18}):e.jsx(Hs,{size:18})}),e.jsxs("div",{className:"backup-ticket-info",children:[e.jsxs("div",{className:"backup-ticket-date",children:[e.jsx(kr,{size:14}),e.jsx("span",{children:Wa(Q.work_date)})]}),Q.ce_pco_number&&e.jsxs("span",{className:"backup-ticket-pco",children:["CE/PCO: ",Q.ce_pco_number]})]}),e.jsxs("div",{className:"backup-ticket-stats",children:[e.jsxs("span",{className:"backup-stat",children:[e.jsx(Fs,{size:14})," ",Oe]}),e.jsxs("span",{className:"backup-stat",children:[he.total.toFixed(1)," hrs"]}),Re>0&&e.jsxs("span",{className:"backup-stat",children:[e.jsx(Pj,{size:14})," ",Re]}),Q.client_signature_data&&e.jsxs("span",{className:"backup-stat verified",title:`Verified by ${Q.client_signature_name}`,children:[e.jsx(dd,{size:14})," Verified"]})]}),e.jsx("span",{className:`backup-ticket-status status-${Q.status}`,children:Q.status})]}),Se&&e.jsxs("div",{className:"backup-ticket-details",children:[Q.notes&&e.jsxs("div",{className:"backup-ticket-notes",children:[e.jsx("strong",{children:"Notes:"})," ",Q.notes]}),Q.t_and_m_workers?.length>0&&e.jsxs("div",{className:"backup-workers",children:[e.jsxs("h4",{children:["Labor (",Oe," workers)"]}),e.jsxs("table",{className:"backup-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"OT Hrs"})]})}),e.jsx("tbody",{children:Q.t_and_m_workers.map((ze,pt)=>e.jsxs("tr",{children:[e.jsx("td",{children:ze.name}),e.jsx("td",{children:ze.role||"-"}),e.jsx("td",{className:"backup-time-range",children:ze.time_started&&ze.time_ended?`${ze.time_started} - ${ze.time_ended}`:"-"}),e.jsx("td",{children:ze.hours||0}),e.jsx("td",{children:ze.overtime_hours||"-"})]},pt))})]})]}),Q.t_and_m_items?.length>0&&e.jsxs("div",{className:"backup-items",children:[e.jsxs("h4",{children:["Materials & Equipment (",Be," items)"]}),e.jsxs("table",{className:"backup-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Qty"})]})}),e.jsx("tbody",{children:Q.t_and_m_items.map((ze,pt)=>e.jsxs("tr",{children:[e.jsx("td",{children:ze.materials_equipment?.name||ze.custom_name||"Item"}),e.jsx("td",{children:ze.materials_equipment?.category||ze.custom_category||"-"}),e.jsx("td",{children:ze.quantity})]},pt))})]})]}),Q.photos?.length>0&&e.jsxs("div",{className:"backup-photos",children:[e.jsxs("h4",{children:["Photos (",Re,")"]}),e.jsx("div",{className:"backup-photos-grid",children:Q.photos.map((ze,pt)=>e.jsx("div",{className:"backup-photo-thumb",onClick:()=>O(ze),children:e.jsx("img",{src:ze,alt:`Photo ${pt+1}`})},pt))})]}),Q.client_signature_data&&e.jsxs("div",{className:"backup-verification",children:[e.jsxs("h4",{children:[e.jsx(dd,{size:14})," Client Verification"]}),e.jsxs("div",{className:"backup-signature-display",children:[e.jsx("img",{src:Q.client_signature_data,alt:"Client Signature",className:"backup-signature-image"}),e.jsxs("div",{className:"backup-signature-info",children:[e.jsx("span",{className:"backup-signer-name",children:Q.client_signature_name}),Q.client_signature_title&&e.jsx("span",{className:"backup-signer-title",children:Q.client_signature_title}),Q.client_signature_company&&e.jsx("span",{className:"backup-signer-company",children:Q.client_signature_company}),e.jsxs("span",{className:"backup-signed-date",children:["Verified: ",Wa(Q.client_signature_date)]})]})]})]})]})]},Q.id)})})]}),(j.gc_signature_data||j.gc_signature||j.client_signature_data)&&e.jsxs("div",{className:"cor-detail-section signature-section",children:[e.jsxs("h3",{children:[e.jsx(Cv,{size:18})," Signatures"]}),e.jsxs("div",{className:"dual-signatures",children:[(j.gc_signature_data||j.gc_signature)&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"GC Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:j.gc_signature_data||j.gc_signature,alt:"GC Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:j.gc_signature_name||j.gc_signer_name}),(j.gc_signature_title||j.gc_signature_company)&&e.jsxs("span",{className:"signer-org",children:[j.gc_signature_title,j.gc_signature_title&&j.gc_signature_company&&" - ",j.gc_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",Wa(j.gc_signature_date||j.signed_at)]})]})]})]}),j.client_signature_data&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"Client Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:j.client_signature_data,alt:"Client Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:j.client_signature_name}),(j.client_signature_title||j.client_signature_company)&&e.jsxs("span",{className:"signer-org",children:[j.client_signature_title,j.client_signature_title&&j.client_signature_company&&" - ",j.client_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",Wa(j.client_signature_date)]})]})]})]})]})]}),j.status==="rejected"&&j.rejection_reason&&e.jsxs("div",{className:"cor-detail-section rejection-section",children:[e.jsxs("h3",{children:[e.jsx(zp,{size:18})," Rejection Reason"]}),e.jsx("p",{className:"rejection-text",children:j.rejection_reason})]})]}),e.jsxs("div",{className:"modal-footer cor-detail-footer",children:[e.jsxs("div",{className:"footer-info",children:[e.jsxs("span",{children:["Created: ",Wa(j.created_at)]}),j.approved_at&&e.jsxs("span",{children:["Approved: ",Wa(j.approved_at)]})]}),e.jsxs("div",{className:"footer-actions",role:"group","aria-label":"COR actions",children:[y&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>m?.(j),disabled:b,"aria-label":"Edit this COR",children:[e.jsx(yl,{size:16,"aria-hidden":"true"})," Edit"]}),D&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-danger",onClick:J,disabled:b,"aria-label":"Reject this COR",children:[e.jsx(zp,{size:16,"aria-hidden":"true"})," Reject"]}),e.jsxs("button",{className:"btn btn-success",onClick:L,disabled:b,"aria-label":"Approve this COR",children:[e.jsx(Ja,{size:16,"aria-hidden":"true"})," Approve"]})]}),M&&e.jsxs("button",{className:"btn btn-success",onClick:()=>v(!0),disabled:b,"aria-label":"Get GC signature for this COR",children:[e.jsx(dd,{size:16,"aria-hidden":"true"})," Get GC Signature"]}),(j.status==="approved"||j.status==="pending_approval")&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>B(!0),disabled:b,"aria-label":"Get shareable signature link",children:[e.jsx(Ad,{size:16,"aria-hidden":"true"})," Get Signature Link"]}),j.status==="approved"&&e.jsxs("button",{className:"btn btn-primary",onClick:w,disabled:b,"aria-label":"Mark this COR as billed",children:[e.jsx(wr,{size:16,"aria-hidden":"true"})," Mark Billed"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:xe,"aria-label":"Export COR to PDF",children:[e.jsx(pf,{size:16,"aria-hidden":"true"})," Export PDF"]})]})]})]}),S&&e.jsx(Sy,{onSave:Z,onClose:()=>v(!1),signerName:""}),H&&e.jsx(Ld,{documentType:"cor",documentId:j.id,companyId:c?.id,projectId:l?.id,documentTitle:`COR ${j.cor_number}: ${j.title||"Untitled"}`,onClose:()=>B(!1),onShowToast:x}),G&&e.jsxs("div",{className:"photo-lightbox",onClick:()=>O(null),children:[e.jsx("button",{className:"lightbox-close",onClick:()=>O(null),children:e.jsx(za,{size:24})}),e.jsx("img",{src:G,alt:"Full size photo",onClick:Q=>Q.stopPropagation()})]})]})}const mn=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),Cy=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric"});function ky({dailyBurn:r,totalBurn:l,daysWorked:c,laborCost:i,haulOffCost:u,progress:m,contractValue:x,laborByDate:f=[],haulOffByDate:b=[]}){const[p,j]=g.useState(!1),R=x*(m/100)*.6,S=l<=R?"on-budget":l<=R*1.2?"warning":"over-budget",v={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[S],H=S==="on-budget"?jf:S==="warning"?kd:vf,I=m>0?l/(m/100):0,ae=[],G={};f.forEach(C=>{G[C.date]||(G[C.date]={date:C.date,labor:0,haulOff:0,total:0}),G[C.date].labor=C.cost||0,G[C.date].total+=C.cost||0}),b.forEach(C=>{G[C.date]||(G[C.date]={date:C.date,labor:0,haulOff:0,total:0}),G[C.date].haulOff=C.cost||0,G[C.date].total+=C.cost||0}),Object.values(G).sort((C,ee)=>new Date(ee.date)-new Date(C.date)).slice(0,10).forEach(C=>ae.push(C));const O=Math.max(...ae.map(C=>C.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(Uj,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${S}`,children:[e.jsx(H,{size:14}),e.jsx("span",{children:v})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:mn(r)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),c>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",c," work day",c!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:mn(l)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:mn(i)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Disposal"}),e.jsx("span",{className:"burn-summary-value",children:mn(u)})]})]}),m>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${I>x*.7?"warning":""}`,children:mn(I)})]}),ae.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>j(!p),children:[p?e.jsx(hf,{size:16}):e.jsx(Da,{size:16}),e.jsxs("span",{children:[p?"Hide":"View"," Daily Breakdown"]})]}),p&&ae.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Disposal"}),e.jsx("span",{children:"Total"})]}),ae.map(C=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:Cy(C.date)}),e.jsx("span",{className:"burn-labor",children:C.labor>0?mn(C.labor):"-"}),e.jsx("span",{className:"burn-hauloff",children:C.haulOff>0?mn(C.haulOff):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${C.total/O*100}%`}}),e.jsx("span",{className:"burn-amount",children:mn(C.total)})]})]},C.date))]})]})}const gd=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),Hi={labor:{label:"Labor",Icon:Ea,color:"#3b82f6"},disposal:{label:"Disposal",Icon:ds,color:"#10b981"},equipment:{label:"Equipment",Icon:Nl,color:"#f59e0b"},materials:{label:"Materials",Icon:vn,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:Fs,color:"#ec4899"},other:{label:"Other",Icon:ff,color:"#6b7280"}};function Ey({laborCost:r=0,haulOffCost:l=0,customCosts:c=[],onAddCost:i,onDeleteCost:u}){const[m,x]=g.useState(!1),[f,b]=g.useState(null),p=[];r>0&&p.push({category:"labor",label:"Labor",amount:r,source:"auto",description:"From crew check-ins"}),l>0&&p.push({category:"disposal",label:"Disposal",amount:l,source:"auto",description:"From haul-off logs"});const j={};c.forEach(v=>{j[v.category]||(j[v.category]={category:v.category,items:[],total:0}),j[v.category].items.push(v),j[v.category].total+=parseFloat(v.amount)||0}),Object.values(j).forEach(v=>{const H=Hi[v.category]||Hi.other;p.push({category:v.category,label:H.label,amount:v.total,source:"manual",items:v.items})});const R=p.reduce((v,H)=>v+H.amount,0);p.forEach(v=>{v.percentage=R>0?v.amount/R*100:0}),p.sort((v,H)=>H.amount-v.amount);const S=v=>{b(f===v?null:v)};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:gd(R)})]}),p.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):e.jsx("div",{className:"cost-breakdown",children:p.map(v=>{const H=Hi[v.category]||Hi.other,B=H.Icon,I=v.items&&v.items.length>0,ae=f===v.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${I?"expandable":""}`,onClick:()=>I&&S(v.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(v.percentage,2)}%`,backgroundColor:H.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(B,{size:14,style:{color:H.color}}),e.jsx("span",{children:v.label}),v.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),I&&(ae?e.jsx(hf,{size:14}):e.jsx(Da,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:gd(v.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(v.percentage),"%"]})]})]})]}),ae&&I&&e.jsx("div",{className:"cost-category-items",children:v.items.map(G=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:G.description}),e.jsx("span",{className:"cost-item-date",children:new Date(G.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:gd(G.amount)}),u&&e.jsx("button",{className:"cost-item-delete",onClick:O=>{O.stopPropagation(),confirm("Delete this cost entry?")&&u(G.id)},children:e.jsx(Us,{size:14})})]})]},G.id))})]},v.category)})}),i&&e.jsxs("button",{className:"cost-add-btn",onClick:i,children:[e.jsx(vs,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const Fn=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0);function Dy({revenue:r,totalCosts:l,contractValue:c,progress:i}){const u=r-l,m=r>0?u/r*100:0,x=c,f=i>0?l/(i/100):l,b=x-f,p=x>0?b/x*100:0,j=m>=20,R=m>=0&&m<20,S=m<0,v=j?"healthy":R?"warning":"loss",H=j?"On Track":R?"Watch Margin":"Over Cost",B=j?Ja:R?jn:jf;return e.jsxs("div",{className:`profitability-card ${v}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${v}`,children:[e.jsx(B,{size:14}),e.jsx("span",{children:H})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${m<0?"negative":""}`,children:[Math.round(m),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${m<0?"negative":m<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(m),100)}%`}})})]}),i>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${p<0?"negative":""}`,children:[Math.round(p),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${p<0?"negative":p<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(p),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:Fn(r)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",Fn(l)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${u<0?"negative":"positive"}`,children:[u>=0?"":"-",Fn(Math.abs(u))]})]})]}),i>10&&e.jsxs("div",{className:"profitability-insight",children:[j&&e.jsxs("p",{children:["At ",Math.round(i),"% complete, you're at ",Fn(u)," profit.",b>0&&` Projected final profit: ${Fn(b)}`]}),R&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",b<0&&` Trending toward ${Fn(b)} loss.`]}),S&&e.jsxs("p",{children:["Currently over cost by ",Fn(Math.abs(u)),". Immediate review recommended."]})]})]})}const My={concrete:{label:"Concrete",icon:"",color:"#6b7280"},trash:{label:"Trash",icon:"",color:"#10b981"},metals:{label:"Metals",icon:"",color:"#3b82f6"},hazardous_waste:{label:"Hazardous Waste",icon:"",color:"#f59e0b"}};function Ty({project:r,period:l="week"}){const[c,i]=g.useState([]),[u,m]=g.useState([]),[x,f]=g.useState(!0),b=()=>{const S=new Date,v=new Date;switch(l){case"week":v.setDate(v.getDate()-7);break;case"month":v.setMonth(v.getMonth()-1);break;case"all":v.setFullYear(2020);break;default:v.setDate(v.getDate()-7)}return{startDate:v.toISOString().split("T")[0],endDate:S.toISOString().split("T")[0]}};g.useEffect(()=>{p()},[r.id,l]);const p=async()=>{try{f(!0);const{startDate:S,endDate:v}=b(),[H,B]=await Promise.all([K.getDisposalSummary(r.id,S,v),K.getWeeklyDisposalSummary(r.id,4)]);i(H||[]),m(B||[])}catch(S){console.error("Error loading disposal summary:",S)}finally{f(!1)}},j=c.reduce((S,v)=>S+(v.total_loads||0),0),R={week:"This Week",month:"This Month",all:"All Time"}[l]||"This Week";return x?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(ds,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):j===0?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(ds,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("p",{className:"text-muted",children:R})]})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(ds,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsx("span",{className:"period-badge",children:R})]}),e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"total-number",children:j}),e.jsx("span",{className:"total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:c.map(S=>{const v=My[S.load_type]||{label:S.load_type,icon:"",color:"#6b7280"},H=Math.round(S.total_loads/j*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"type-info",children:[e.jsx("span",{className:"type-icon",children:v.icon}),e.jsx("span",{className:"type-label",children:v.label})]}),e.jsxs("div",{className:"type-stats",children:[e.jsx("div",{className:"type-bar-container",children:e.jsx("div",{className:"type-bar",style:{width:`${H}%`,backgroundColor:v.color}})}),e.jsx("span",{className:"type-count",children:S.total_loads})]})]},S.load_type)})}),u.length>1&&e.jsxs("div",{className:"disposal-trend",children:[e.jsxs("div",{className:"trend-header",children:[e.jsx(vf,{size:16}),e.jsx("span",{children:"Weekly Trend"})]}),e.jsx("div",{className:"trend-chart",children:u.map((S,v)=>{const H=S.concrete+S.trash+S.metals+S.hazardous_waste,B=Math.max(...u.map(ae=>ae.concrete+ae.trash+ae.metals+ae.hazardous_waste)),I=B>0?H/B*100:0;return e.jsxs("div",{className:"trend-bar-wrapper",children:[e.jsx("div",{className:"trend-bar",style:{height:`${I}%`},title:`Week of ${S.week}: ${H} loads`}),e.jsxs("span",{className:"trend-label",children:["W",v+1]})]},S.week)})})]}),c.length>0&&c[0].days_with_activity&&e.jsxs("div",{className:"disposal-activity-days",children:[e.jsx(kr,{size:14}),e.jsxs("span",{children:[c.reduce((S,v)=>Math.max(S,v.days_with_activity||0),0)," days with disposal activity"]})]})]})}const Ay=[{value:"labor",label:"Labor",Icon:Ea,description:"Additional labor costs"},{value:"materials",label:"Materials",Icon:vn,description:"Materials and supplies"},{value:"equipment",label:"Equipment",Icon:Nl,description:"Equipment rental or purchase"},{value:"subcontractor",label:"Subcontractor",Icon:Fs,description:"Subcontractor work"},{value:"disposal",label:"Disposal",Icon:ds,description:"Additional disposal costs"},{value:"other",label:"Other",Icon:ff,description:"Miscellaneous costs"}];function zy({onClose:r,onSave:l,saving:c=!1}){const[i,u]=g.useState({category:"materials",description:"",amount:"",cost_date:new Date().toISOString().split("T")[0],notes:""}),[m,x]=g.useState({}),f=(j,R)=>{u(S=>({...S,[j]:R})),m[j]&&x(S=>({...S,[j]:null}))},b=()=>{const j={};i.description.trim()||(j.description="Description is required");const R=parseFloat(i.amount);return(isNaN(R)||R<=0)&&(j.amount="Enter a valid amount"),i.cost_date||(j.cost_date="Date is required"),x(j),Object.keys(j).length===0},p=j=>{j.preventDefault(),b()&&l(i)};return e.jsx("div",{className:"modal-overlay",onClick:r,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content add-cost-modal",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(wr,{size:20}),"Add Cost"]}),e.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close",children:e.jsx(za,{size:20})})]}),e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category *"}),e.jsx("div",{className:"category-grid",children:Ay.map(j=>{const R=j.Icon,S=i.category===j.value;return e.jsxs("button",{type:"button",className:`category-option ${S?"selected":""}`,onClick:()=>f("category",j.value),children:[e.jsx(R,{size:18}),e.jsx("span",{className:"category-label",children:j.label})]},j.value)})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-description",children:"Description *"}),e.jsx("input",{id:"cost-description",type:"text",value:i.description,onChange:j=>f("description",j.target.value),placeholder:"e.g., Excavator rental - Week 1",className:m.description?"error":""}),m.description&&e.jsx("span",{className:"form-error",children:m.description})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-amount",children:"Amount *"}),e.jsxs("div",{className:"input-with-prefix",children:[e.jsx("span",{className:"input-prefix",children:"$"}),e.jsx("input",{id:"cost-amount",type:"text",inputMode:"decimal",value:i.amount,onChange:j=>{const R=j.target.value.replace(/[^0-9.]/g,"");f("amount",R)},placeholder:"0.00",className:m.amount?"error":""})]}),m.amount&&e.jsx("span",{className:"form-error",children:m.amount})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-date",children:"Date *"}),e.jsx("input",{id:"cost-date",type:"date",value:i.cost_date,onChange:j=>f("cost_date",j.target.value),className:m.cost_date?"error":""}),m.cost_date&&e.jsx("span",{className:"form-error",children:m.cost_date})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-notes",children:"Notes (optional)"}),e.jsx("textarea",{id:"cost-notes",value:i.notes,onChange:j=>f("notes",j.target.value),placeholder:"Additional details...",rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:r,disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:c,children:c?"Saving...":"Add Cost"})]})]})]})})}const Qp=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function Oy({project:r,company:l,user:c,isAdmin:i,onShowToast:u}){const[m,x]=g.useState([]),[f,b]=g.useState([]),[p,j]=g.useState(!0),[R,S]=g.useState(!1),[v,H]=g.useState(""),[B,I]=g.useState("Team Member"),[ae,G]=g.useState(null);g.useEffect(()=>{r?.id&&O()},[r?.id]),g.useEffect(()=>{R&&l?.id&&C()},[R,l?.id]);const O=async()=>{try{j(!0);const P=await K.getProjectTeam(r.id);x(P)}catch(P){console.error("Error loading project team:",P)}finally{j(!1)}},C=async()=>{try{const P=await K.getCompanyMembers(l.id),V=m.map(D=>D.users?.id),ie=P.filter(D=>!V.includes(D.users?.id));b(ie)}catch(P){console.error("Error loading company members:",P)}},ee=async()=>{if(!v){u("Select a team member","error");return}try{G("add"),await K.addProjectMember(r.id,v,B,c.id),u("Team member added","success"),S(!1),H(""),I("Team Member"),O()}catch(P){console.error("Error adding team member:",P),u("Error adding team member","error")}finally{G(null)}},me=async(P,V)=>{try{G(P.id),await K.updateProjectMemberRole(r.id,P.users?.id,V),u("Role updated","success"),O()}catch(ie){console.error("Error updating role:",ie),u("Error updating role","error")}finally{G(null)}},te=async P=>{try{G(P.id),await K.removeProjectMember(r.id,P.users?.id),u("Team member removed","success"),O()}catch(V){console.error("Error removing team member:",V),u("Error removing team member","error")}finally{G(null)}};return p?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(Fs,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(Fs,{size:18})," Project Team"]}),i&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>S(!0),children:[e.jsx(Hv,{size:14})," Add"]})]}),m.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",i&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:m.map(P=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:P.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:P.users?.email})]}),e.jsx("div",{className:"team-member-role",children:i?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:P.project_role,onChange:V=>me(P,V.target.value),disabled:ae===P.id,className:"role-select",children:Qp.map(V=>e.jsx("option",{value:V,children:V},V))}),e.jsx(Da,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:P.project_role})}),i&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>te(P),disabled:ae===P.id,title:"Remove from project",children:e.jsx(bf,{size:14})})]},P.id))}),R&&e.jsx("div",{className:"modal-overlay",onClick:()=>S(!1),children:e.jsxs("div",{className:"modal-content small",onClick:P=>P.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>S(!1),children:e.jsx(za,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:v,onChange:P=>H(P.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),f.map(P=>e.jsx("option",{value:P.users?.id,children:P.users?.name||P.users?.email},P.users?.id))]}),f.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:B,onChange:P=>I(P.target.value),className:"form-select",children:Qp.map(P=>e.jsx("option",{value:P,children:P},P))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>S(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:ee,disabled:!v||ae==="add",children:ae==="add"?"Adding...":"Add to Project"})]})]})})]})}function Ry({company:r,user:l,isAdmin:c,onShowToast:i,navigateToProjectId:u,onProjectNavigated:m}){const[x,f]=g.useState([]),[b,p]=g.useState([]),[j,R]=g.useState(null),[S,v]=g.useState([]),[H,B]=g.useState(!0),[I,ae]=g.useState(!1),[G,O]=g.useState(null),[C,ee]=g.useState(!1),[me,te]=g.useState(!1),[P,V]=g.useState(!1),[ie,D]=g.useState("overview"),[y,z]=g.useState([]),[L,J]=g.useState(!1),[w,Z]=g.useState(null),[M,oe]=g.useState(!1),[E,U]=g.useState(null),[de,A]=g.useState(0),[xe,Q]=g.useState(!1),[Se,he]=g.useState(!1),Oe=g.useRef(null),Be=g.useRef(!1),Re=g.useRef(!1),ze=g.useCallback((ke={})=>{const{refreshAreas:T=!1,refreshCOR:ge=!1,projectId:fe=null}=ke;T&&fe&&(Be.current=fe),ge&&(Re.current=!0),Oe.current&&clearTimeout(Oe.current),Oe.current=setTimeout(async()=>{Be.current&&(await se(Be.current),Be.current=!1),Re.current&&(A(Te=>Te+1),Re.current=!1),await rt()},150)},[]);g.useEffect(()=>()=>{Oe.current&&clearTimeout(Oe.current)},[]),g.useEffect(()=>{if(r?.id){rt(),pt();const ke=x.map(ge=>ge.id),T=ke.length>0?K.subscribeToCompanyActivity?.(r.id,ke,{onMessage:()=>ze(),onMaterialRequest:()=>ze(),onTMTicket:()=>ze(),onInjuryReport:()=>ze()}):null;return()=>{T&&K.unsubscribe?.(T)}}},[r?.id,x.length,ze]);const pt=async()=>{try{const ke=await K.getDumpSites(r.id);z(ke||[])}catch(ke){console.error("Error loading dump sites:",ke)}};g.useEffect(()=>{if(u&&x.length>0){const ke=x.find(T=>T.id===u);ke&&(R(ke),m?.())}},[u,x]),g.useEffect(()=>{if(j){se(j.id);const ke=[],T=j.id,ge=K.subscribeToAreas?.(T,()=>{ze({refreshAreas:!0,projectId:T})});ge&&ke.push(ge);const fe=K.subscribeToDailyReports?.(T,()=>{ze()});fe&&ke.push(fe);const Te=K.subscribeToCrewCheckins?.(T,()=>{ze()});Te&&ke.push(Te);const jt=K.subscribeToHaulOffs?.(T,()=>{ze()});jt&&ke.push(jt);const it=K.subscribeToCORs?.(T,()=>{ze({refreshCOR:!0})});return it&&ke.push(it),()=>{ke.forEach(Dt=>K.unsubscribe?.(Dt))}}},[j,ze]);const rt=async()=>{try{const ke=await K.getProjects(r?.id);f(ke);const T=await Promise.all(ke.map(async ge=>{try{const[fe,Te,jt,it,Dt,ct,mt,va,Qt]=await Promise.all([K.getAreas(ge.id).catch(()=>[]),K.getTMTickets(ge.id).catch(()=>[]),K.getChangeOrderTotals(ge.id).catch(()=>null),K.getDailyReports(ge.id,100).catch(()=>[]),K.getInjuryReports(ge.id).catch(()=>[]),K.calculateManDayCosts(ge.id,r?.id,ge.work_type||"demolition",ge.job_type||"standard").catch(()=>null),K.calculateHaulOffCosts(ge.id).catch(()=>null),K.getProjectCosts(ge.id).catch(()=>[]),K.getCORStats(ge.id).catch(()=>null)]),Na=Lp(fe),$e=Na.progress,st=jt?.totalApprovedValue||0,Xt=ge.contract_value+st,ya=Na.isValueBased?Na.earnedValue:$e/100*Xt,Ba=Te.filter(Ue=>Ue.status==="pending").length,ba=new Date;ba.setDate(ba.getDate()-7);const It=it.filter(Ue=>new Date(Ue.report_date)>=ba).length,ga=va.reduce((Ue,gt)=>{const Qe=parseFloat(gt.amount);return Ue+(isNaN(Qe)?0:Qe)},0),Tt=ct?.totalCost||0,$a=mt?.totalCost||0,Ve=Tt+$a+ga,tt=ya-Ve,At=ya>0?tt/ya*100:0,$t=ct?.byDate?.length||0,N=mt?.daysWithHaulOff||0,ne=Math.max($t,N),be=Tt+$a,re=ne>0?be/ne:0,Ge=Zv({...ge,progress:$e},ct?.totalManDays||0);return{...ge,areas:fe,progress:$e,billable:ya,changeOrderValue:st,revisedContractValue:Xt,changeOrderPending:jt?.pendingCount||0,totalTickets:Te.length,pendingTickets:Ba,approvedTickets:Te.filter(Ue=>Ue.status==="approved").length,dailyReportsCount:it.length,recentDailyReports:It,injuryReportsCount:Dt.length,lastDailyReport:it[0]?.report_date||null,isValueBased:Na.isValueBased,earnedValue:Na.earnedValue,totalSOVValue:Na.totalValue,laborCost:Tt,laborDaysWorked:$t,laborManDays:ct?.totalManDays||0,laborByDate:ct?.byDate||[],dailyBurn:re,haulOffCost:$a,haulOffLoads:mt?.totalLoads||0,haulOffDays:N,haulOffByType:mt?.byWasteType||{},haulOffByDate:mt?.byDate||[],customCosts:va,customCostTotal:ga,totalBurn:be,totalBurnDays:ne,allCostsTotal:Ve,currentProfit:tt,profitMargin:At,corPendingValue:Qt?.total_pending_value||0,corPendingCount:Qt?.pending_count||0,corApprovedValue:Qt?.total_approved_value||0,corBilledValue:Qt?.total_billed_value||0,corTotalCount:Qt?.total_cors||0,scheduleStatus:Ge.scheduleStatus,scheduleVariance:Ge.scheduleVariance,scheduleLabel:Ge.scheduleLabel,laborStatus:Ge.laborStatus,laborVariance:Ge.laborVariance,laborLabel:Ge.laborLabel,hasScheduleData:Ge.hasScheduleData,hasLaborData:Ge.hasLaborData,actualManDays:ct?.totalManDays||0,hasError:!1}}catch(fe){return console.error(`Error loading data for project ${ge.id}:`,fe),{...ge,areas:[],progress:0,billable:0,changeOrderValue:0,revisedContractValue:ge.contract_value,changeOrderPending:0,totalTickets:0,pendingTickets:0,approvedTickets:0,dailyReportsCount:0,recentDailyReports:0,injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corTotalCount:0,hasError:!0}}}));p(T)}catch(ke){console.error("Error loading projects:",ke),i("Error loading projects","error")}finally{B(!1)}},se=async ke=>{try{const T=await K.getAreas(ke);v(T)}catch(T){console.error("Error loading areas:",T)}},Ae=ke=>{R(ke)},Ye=()=>{R(null),v([]),ae(!1),O(null),D("overview"),rt()},ft=()=>{O({name:j.name,job_number:j.job_number||"",address:j.address||"",general_contractor:j.general_contractor||"",client_contact:j.client_contact||"",client_phone:j.client_phone||"",contract_value:j.contract_value,work_type:j.work_type||"demolition",job_type:j.job_type||"standard",pin:j.pin||"",default_dump_site_id:j.default_dump_site_id||"",areas:S.map(ke=>({id:ke.id,name:ke.name,weight:ke.weight,isNew:!1}))}),ae(!0)},ja=()=>{ae(!1),O(null)},Ce=(ke,T)=>{O(ge=>({...ge,[ke]:T}))},qe=(ke,T,ge)=>{O(fe=>({...fe,areas:fe.areas.map((Te,jt)=>jt===ke?{...Te,[T]:ge}:Te)}))},Fe=()=>{O(ke=>({...ke,areas:[...ke.areas,{id:null,name:"",weight:"",isNew:!0}]}))},Ze=ke=>{G.areas.length>1&&O(T=>({...T,areas:T.areas.filter((ge,fe)=>fe!==ke)}))},Ke=async()=>{if(!G.name.trim()){i("Please enter a project name","error");return}const ke=parseFloat(G.contract_value);if(!ke||ke<=0){i("Please enter a valid contract value","error");return}if(G.pin&&G.pin.length!==4){i("PIN must be 4 digits","error");return}if(G.pin&&G.pin!==j.pin&&!await K.isPinAvailable(G.pin,j.id)){i("This PIN is already in use","error");return}const T=G.areas.filter(fe=>fe.name.trim()&&parseFloat(fe.weight)>0);if(T.length===0){i("Please add at least one area","error");return}if(T.reduce((fe,Te)=>fe+parseFloat(Te.weight),0)!==100){i("Area weights must total 100%","error");return}ee(!0);try{await K.updateProject(j.id,{name:G.name.trim(),job_number:G.job_number?.trim()||null,address:G.address?.trim()||null,general_contractor:G.general_contractor?.trim()||null,client_contact:G.client_contact?.trim()||null,client_phone:G.client_phone?.trim()||null,contract_value:ke,work_type:G.work_type||"demolition",job_type:G.job_type||"standard",pin:G.pin||null,default_dump_site_id:G.default_dump_site_id||null});const fe=S.map(it=>it.id),Te=G.areas.filter(it=>it.id).map(it=>it.id);for(const it of fe)Te.includes(it)||await K.deleteArea(it);for(let it=0;it<T.length;it++){const Dt=T[it];Dt.id?await K.updateArea(Dt.id,{name:Dt.name.trim(),weight:parseFloat(Dt.weight),sort_order:it}):await K.createArea({project_id:j.id,name:Dt.name.trim(),weight:parseFloat(Dt.weight),status:"not_started",sort_order:it})}const jt=await K.getProject(j.id);R(jt),await se(j.id),ae(!1),O(null),i("Project updated!","success")}catch(fe){console.error("Error saving project:",fe?.message||fe),i(fe?.message||"Error saving changes","error")}finally{ee(!1)}},et=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await K.deleteProject(j.id),i("Project deleted","success"),Ye()}catch(ke){console.error("Error deleting project:",ke),i("Error deleting project","error")}},Me=g.useMemo(()=>j?b.find(ke=>ke.id===j.id):null,[j,b]),bt=g.useMemo(()=>{if(!j)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const ke=Lp(S),T=ke.progress,ge=Me?.changeOrderValue||0,fe=j.contract_value+ge,Te=ke.isValueBased?ke.earnedValue:T/100*fe;return{progress:T,billable:Te,changeOrderValue:ge,revisedContractValue:fe,isValueBased:ke.isValueBased,earnedValue:ke.earnedValue,totalSOVValue:ke.totalValue}},[j,S,Me]),kt=g.useMemo(()=>{const ke=b.reduce((ct,mt)=>ct+(mt.contract_value||0),0),T=b.reduce((ct,mt)=>ct+(mt.changeOrderValue||0),0),ge=ke+T,fe=b.reduce((ct,mt)=>ct+(mt.billable||0),0),Te=ge-fe,jt=ge>0?Math.round(fe/ge*100):0,it=b.reduce((ct,mt)=>ct+(mt.corPendingValue||0),0),Dt=b.reduce((ct,mt)=>ct+(mt.corPendingCount||0),0);return{totalOriginalContract:ke,totalChangeOrders:T,totalPortfolioValue:ge,totalEarned:fe,totalRemaining:Te,weightedCompletion:jt,totalPendingCORValue:it,totalPendingCORCount:Dt}},[b]),Mt=g.useMemo(()=>{let ke=0,T=0,ge=0,fe=0,Te=0;for(const jt of b){const it=jt.revisedContractValue||jt.contract_value;jt.progress>=100&&ke++,jt.progress<100&&jt.billable<=it*(jt.progress/100)*1.1&&T++,jt.billable>it*.9&&jt.progress<90&&ge++,jt.billable>it&&fe++,(jt.changeOrderValue||0)>0&&Te++}return{projectsComplete:ke,projectsOnTrack:T,projectsAtRisk:ge,projectsOverBudget:fe,projectsWithChangeOrders:Te}},[b]),Gt=g.useMemo(()=>{let ke=0,T=0,ge=0,fe=0,Te=0,jt=0;for(const it of b)it.hasScheduleData&&(it.scheduleStatus==="ahead"?ke++:it.scheduleStatus==="behind"?ge++:T++),it.hasLaborData&&(it.laborStatus==="over"?fe++:it.laborStatus==="under"?Te++:jt++);return{scheduleAhead:ke,scheduleOnTrack:T,scheduleBehind:ge,laborOver:fe,laborUnder:Te,laborOnTrack:jt,hasAnyScheduleData:ke+T+ge>0,hasAnyLaborData:fe+Te+jt>0}},[b]);g.useEffect(()=>{const ke=async()=>{for(const T of b)if(Jv(T,30)){console.log(`Auto-archiving completed project: ${T.name}`);try{await K.archiveProject(T.id),i(`Project "${T.name}" has been auto-archived after 30 days of completion`,"info")}catch(ge){console.error("Failed to auto-archive project:",ge)}}};b.length>0&&ke()},[]);const{totalOriginalContract:Et,totalChangeOrders:aa,totalPortfolioValue:da,totalEarned:St,totalRemaining:Je,weightedCompletion:qt,totalPendingCORValue:Ee,totalPendingCORCount:Y}=kt,{projectsComplete:q,projectsOnTrack:we,projectsAtRisk:lt,projectsOverBudget:De,projectsWithChangeOrders:ve}=Mt,{scheduleAhead:at,scheduleOnTrack:ot,scheduleBehind:Yt,laborOver:sa,laborUnder:Ne,laborOnTrack:xt,hasAnyScheduleData:dt,hasAnyLaborData:Oa}=Gt;if(H)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(j){const{progress:ke,billable:T,changeOrderValue:ge,revisedContractValue:fe,isValueBased:Te,earnedValue:jt,totalSOVValue:it}=bt;if(I&&G){const $e=G.areas.reduce((st,Xt)=>st+(parseFloat(Xt.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:ja,style:{marginBottom:"1.5rem"},children:" Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:G.name,onChange:st=>Ce("name",st.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:G.job_number,onChange:st=>Ce("job_number",st.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:G.address,onChange:st=>Ce("address",st.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:G.general_contractor,onChange:st=>Ce("general_contractor",st.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:G.client_contact,onChange:st=>Ce("client_contact",st.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:G.client_phone,onChange:st=>Ce("client_phone",st.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:G.contract_value,onChange:st=>Ce("contract_value",st.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:G.pin,onChange:st=>Ce("pin",st.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:G.work_type,onChange:st=>Ce("work_type",st.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:G.job_type,onChange:st=>Ce("job_type",st.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:G.default_dump_site_id,onChange:st=>Ce("default_dump_site_id",st.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),y.map(st=>e.jsx("option",{value:st.id,children:st.name},st.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),G.areas.map((st,Xt)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:st.name,onChange:ya=>qe(Xt,"name",ya.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:st.weight,onChange:ya=>qe(Xt,"weight",ya.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>Ze(Xt),children:""})]},Xt)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${$e===100?"valid":"invalid"}`,children:[$e,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:Fe,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:Ke,disabled:C,style:{flex:1},children:C?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:et,children:"Delete Project"})]})}const Dt=S.filter($e=>$e.status==="done").length,ct=S.filter($e=>$e.status==="working").length,mt=S.filter($e=>$e.status==="not_started").length,va=fe>0?Math.round(T/fe*100):0,Qt=ge>0,Na=[{id:"overview",label:"Overview",Icon:Rp},{id:"financials",label:"Financials",Icon:wr},{id:"reports",label:"Reports",Icon:cs},{id:"info",label:"Info",Icon:Cd}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:Ye,children:[e.jsx("span",{children:""}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>te(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>V(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:ft,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:j.name}),(j.job_number||j.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[j.job_number&&`Job #${j.job_number}`,j.job_number&&j.work_type&&"  ",j.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[ke,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:Pt(T)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:Pt(fe-T)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:Na.map($e=>e.jsxs("button",{className:`pv-tab ${ie===$e.id?"active":""}`,onClick:()=>D($e.id),children:[e.jsx($e.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:$e.label})]},$e.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[ie==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab",children:[e.jsx("div",{className:"overview-hero",children:e.jsxs("div",{className:"overview-hero-grid",children:[e.jsxs("div",{className:"overview-metric primary",children:[e.jsxs("div",{className:"overview-metric-value",children:[ke,"%"]}),e.jsx("div",{className:"overview-metric-label",children:"Complete"}),e.jsx("div",{className:"overview-metric-bar",children:e.jsx("div",{className:"overview-metric-fill",style:{width:`${ke}%`}})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsxs("div",{className:"overview-metric-value",children:[Dt,"/",S.length]}),e.jsx("div",{className:"overview-metric-label",children:"Areas Done"}),e.jsx("div",{className:"overview-metric-detail",children:ct>0&&e.jsxs("span",{className:"working",children:[ct," active"]})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value",children:Pt(fe)}),e.jsx("div",{className:"overview-metric-label",children:"Contract"}),Qt&&e.jsxs("div",{className:"overview-metric-detail green",children:["+",Pt(ge)," COs"]})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value green",children:Pt(T)}),e.jsx("div",{className:"overview-metric-label",children:"Earned"}),e.jsx("div",{className:"overview-metric-detail",children:Te?e.jsxs("span",{children:["of ",Pt(it)," SOV"]}):e.jsxs("span",{children:[va,"% billed"]})})]})]})}),(Me?.pendingTickets>0||Me?.changeOrderPending>0)&&e.jsxs("div",{className:"overview-attention-card",children:[e.jsxs("div",{className:"attention-header",children:[e.jsx("h3",{children:"Needs Attention"}),e.jsxs("span",{className:"attention-count",children:[(Me?.pendingTickets||0)+(Me?.changeOrderPending||0)," items"]})]}),e.jsxs("div",{className:"attention-items",children:[Me?.pendingTickets>0&&e.jsxs("div",{className:"attention-item",onClick:()=>D("financials"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(cs,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[Me.pendingTickets," T&M ticket",Me.pendingTickets!==1?"s":""," awaiting approval"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]}),Me?.changeOrderPending>0&&e.jsxs("div",{className:"attention-item",onClick:()=>D("financials"),children:[e.jsx("div",{className:"attention-item-icon info",children:e.jsx(Aa,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[Me.changeOrderPending," change order",Me.changeOrderPending!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]})]})]}),e.jsxs("div",{className:"overview-section-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[Dt>0&&e.jsxs("span",{className:"section-badge done",children:[Dt," Complete"]}),ct>0&&e.jsxs("span",{className:"section-badge working",children:[ct," Active"]}),mt>0&&e.jsxs("span",{className:"section-badge pending",children:[mt," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list",children:S.map($e=>e.jsxs("div",{className:`work-area-item ${$e.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[$e.status==="done"&&e.jsx("span",{className:"status-icon done",children:""}),$e.status==="working"&&e.jsx("span",{className:"status-icon working",children:""}),$e.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:""})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:$e.name}),e.jsx("span",{className:"work-area-weight",children:$e.scheduled_value?Pt($e.scheduled_value):`${$e.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${$e.status}`,style:{width:$e.status==="done"?"100%":$e.status==="working"?"50%":"0%"}})})]},$e.id))})]}),e.jsxs("div",{className:"overview-stats-row",children:[e.jsxs("div",{className:"quick-stat-card",onClick:()=>D("reports"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(cs,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:Me?.dailyReportsCount||0}),e.jsx("span",{className:"quick-stat-label",children:"Daily Reports"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>D("financials"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(wr,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:Me?.totalTickets||0}),e.jsx("span",{className:"quick-stat-label",children:"T&M Tickets"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]})]})]}),ie==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsx("div",{className:"financials-hero",children:e.jsxs("div",{className:"financials-hero-grid",children:[e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Contract"}),e.jsx("div",{className:"fin-metric-value",children:Pt(fe)}),Qt&&e.jsxs("div",{className:"fin-metric-detail green",children:["+",Pt(ge)," COs"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Earned"}),e.jsx("div",{className:"fin-metric-value",children:Pt(T)}),e.jsx("div",{className:"fin-metric-bar",children:e.jsx("div",{className:"fin-metric-fill",style:{width:`${va}%`}})})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Costs"}),e.jsx("div",{className:"fin-metric-value",children:Pt(Me?.allCostsTotal||0)}),T>0&&e.jsxs("div",{className:`fin-metric-detail ${(Me?.allCostsTotal||0)/T>.6?"warning":""}`,children:[Math.round((Me?.allCostsTotal||0)/T*100),"% of revenue"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Profit"}),e.jsx("div",{className:`fin-metric-value ${(Me?.currentProfit||0)<0?"negative":"positive"}`,children:Pt(Me?.currentProfit||0)}),e.jsxs("div",{className:`fin-metric-detail ${(Me?.profitMargin||0)<20?"warning":""}`,children:[Math.round(Me?.profitMargin||0),"% margin"]})]})]})}),e.jsxs("div",{className:"financials-analysis-row",children:[e.jsx(ky,{dailyBurn:Me?.dailyBurn||0,totalBurn:Me?.totalBurn||0,daysWorked:Me?.totalBurnDays||0,laborCost:Me?.laborCost||0,haulOffCost:Me?.haulOffCost||0,progress:ke,contractValue:fe,laborByDate:Me?.laborByDate||[],haulOffByDate:Me?.haulOffByDate||[]}),e.jsx(Dy,{revenue:T,totalCosts:Me?.allCostsTotal||0,contractValue:fe,progress:ke}),e.jsx(Ty,{project:j,period:"week"})]}),e.jsx(Ey,{laborCost:Me?.laborCost||0,haulOffCost:Me?.haulOffCost||0,customCosts:Me?.customCosts||[],onAddCost:()=>Q(!0),onDeleteCost:async $e=>{try{await K.deleteProjectCost($e),rt(),i("Cost deleted","success")}catch{i("Error deleting cost","error")}}}),e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(xy,{project:j,company:r,areas:S,refreshKey:de,onShowToast:i,onCreateCOR:()=>{Z(null),J(!0)},onViewCOR:$e=>{U($e),oe(!0)},onEditCOR:$e=>{Z($e),J(!0)}})}),e.jsxs("div",{className:"financials-section tm-section",children:[e.jsxs("div",{className:"tm-section-header",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("span",{className:"tm-badge",children:[Me?.totalTickets||0," total",Me?.pendingTickets>0&&`  ${Me.pendingTickets} pending`]})]}),e.jsx(iy,{project:j,company:r,onShowToast:i,compact:!0})]}),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(Ea,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:Pt(Me?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(py,{project:j,company:r,onShowToast:i})})]})]}),ie==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(cs,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:Me?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:Me?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((Me?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:`reports-metric ${(Me?.injuryReportsCount||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"reports-metric-value",children:Me?.injuryReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Injuries"}),e.jsx("div",{className:"reports-metric-status",children:(Me?.injuryReportsCount||0)===0?"No incidents":"Review required"})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value small",children:Me?.lastDailyReport?new Date(Me.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"None"}),e.jsx("div",{className:"reports-metric-label",children:"Last Filed"}),Me?.lastDailyReport&&e.jsxs("div",{className:"reports-metric-detail",children:[Math.floor((new Date-new Date(Me.lastDailyReport))/(1e3*60*60*24))," days ago"]})]})]})}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(cs,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[Me?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(hy,{project:j,company:r,onShowToast:i})})]}),e.jsxs("div",{className:`reports-section-card ${(Me?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(Me?.injuryReportsCount||0)>0?"warning":"success"}`,children:(Me?.injuryReportsCount||0)>0?"":""}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(Me?.injuryReportsCount||0)>0?"warning":"success"}`,children:(Me?.injuryReportsCount||0)>0?`${Me.injuryReportsCount} incident${Me.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(dy,{project:j,companyId:r?.id||j?.company_id,company:r,onShowToast:i})})]})]}),ie==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:j.name}),j.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",j.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:ft,children:e.jsx("span",{children:"Edit Project"})})]}),j.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(ev,{size:14}),e.jsx("span",{children:j.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Ea,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:j.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Aa,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:j.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(wr,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:Pt(fe)}),e.jsx("span",{className:"info-quick-label",children:ge>0?`Incl. +${Pt(ge)} COs`:"Contract Value"})]})]}),j.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:j.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx($i,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[j.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:j.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),j.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:j.client_contact})]}),j.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(hv,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${j.client_phone}`,className:"info-detail-value link",children:j.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Rp,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[Dt>0&&e.jsxs("span",{className:"info-badge done",children:[Dt," Done"]}),ct>0&&e.jsxs("span",{className:"info-badge working",children:[ct," Active"]}),mt>0&&e.jsxs("span",{className:"info-badge pending",children:[mt," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:S.map($e=>e.jsxs("div",{className:`info-area-item ${$e.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[$e.status==="done"&&e.jsx("span",{className:"status-dot done",children:""}),$e.status==="working"&&e.jsx("span",{className:"status-dot working",children:""}),$e.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:""})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:$e.name}),e.jsx("span",{className:`info-area-status-label ${$e.status}`,children:$e.status==="done"?"Complete":$e.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[$e.weight,"%"]})]},$e.id))})]}),e.jsx(Oy,{project:j,company:r,user:l,isAdmin:c,onShowToast:i}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(Cd,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:Pt(j.contract_value)})]}),ge>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",Pt(ge)]})]}),j.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:y.find($e=>$e.id===j.default_dump_site_id)?.name||"Unknown"})]})]})]})]})]}),me&&e.jsx(cy,{project:j,onClose:()=>te(!1),onShareCreated:$e=>{i("Share link created successfully!","success")}}),P&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(uy,{project:j,company:r,onShowToast:i,onClose:()=>V(!1)})}),L&&e.jsx(vy,{project:j,company:r,areas:S,existingCOR:w,onClose:()=>{J(!1),Z(null)},onSaved:()=>{J(!1),Z(null),A($e=>$e+1)},onShowToast:i}),M&&E&&e.jsx(wy,{cor:E,project:j,company:r,areas:S,onClose:()=>{oe(!1),U(null)},onEdit:$e=>{oe(!1),U(null),Z($e),J(!0)},onShowToast:i,onStatusChange:()=>{}}),xe&&e.jsx(zy,{onClose:()=>Q(!1),saving:Se,onSave:async $e=>{try{he(!0),await K.addProjectCost(j.id,r.id,$e),Q(!1),rt(),i("Cost added successfully","success")}catch(st){console.error("Error adding cost:",st),i("Error adding cost","error")}finally{he(!1)}}})]})}return x.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(cs,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("div",{className:"bo-project-count",children:[x.length," Active Project",x.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(qt,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Pt(St)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Pt(da)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:Pt(Je)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),aa>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:Pt(Et)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",ve," project",ve!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",Pt(aa)]})]})]}),Y>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:Pt(Ee)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",Y," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[q>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:q}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),we>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:we}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),lt>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:lt}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),De>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:De}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),dt&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[at>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:at}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),ot>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:ot}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Yt>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:Yt}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),Oa&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),Ne>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[Ne," under"]}),xt>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[xt," on track"]}),sa>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[sa," over"]})]})]})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[x.length," active"]})]}),e.jsx("div",{className:"project-list",children:b.map(ke=>e.jsx(qy,{project:ke,onClick:()=>Ae(ke)},ke.id))})]})}function qy({project:r,onClick:l}){const c=_f(r.areas||[]),i=Iv(r.areas||[]),u=r.contract_value-r.billable,m=r.billable>r.contract_value*.9&&r.progress<90;return e.jsxs("div",{className:`project-card enhanced ${m?"at-risk":""}`,onClick:l,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:r.name}),e.jsx("div",{className:"project-card-value",children:Pt(r.contract_value)})]}),e.jsx("span",{className:`status-badge ${c}`,children:i})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[r.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:Pt(r.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${u<0?"negative":""}`,children:Pt(Math.abs(u))}),e.jsx("span",{className:"stat-label",children:u>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${r.progress}%`}})}),(r.pendingTickets>0||r.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[r.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[r.pendingTickets," Pending T&M"]}),r.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[r.approvedTickets," Approved T&M"]})]}),r.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${r.scheduleStatus}`,children:r.scheduleLabel}),r.hasLaborData&&r.laborLabel&&e.jsx("span",{className:`labor-indicator ${r.laborStatus}`,children:r.laborLabel})]})]})}const xd=r=>{if(r==null||r==="")return"";const l=parseFloat(r);return isNaN(l)?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)},Xp=r=>{if(!r)return null;const l=String(r).replace(/[$,\s]/g,""),c=parseFloat(l);return isNaN(c)?null:c};function Ly({company:r,user:l,onProjectCreated:c,onShowToast:i}){const[u,m]=g.useState(""),[x,f]=g.useState(""),[b,p]=g.useState(""),[j,R]=g.useState(""),[S,v]=g.useState(""),[H,B]=g.useState(""),[I,ae]=g.useState("demolition"),[G,O]=g.useState("standard"),[C,ee]=g.useState([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),[me,te]=g.useState(!1),[P,V]=g.useState(!1),[ie,D]=g.useState(!1),[y,z]=g.useState([]),[L,J]=g.useState(!1),[w,Z]=g.useState(""),[M,oe]=g.useState(""),[E,U]=g.useState(""),de=g.useRef(null),A=C.reduce((Ce,qe)=>Ce+(parseFloat(qe.weight)||0),0),xe=Ce=>{const qe=Ce.replace(/\D/g,"").slice(0,4);B(qe)},Q=()=>{const Ce=Math.floor(1e3+Math.random()*9e3).toString();B(Ce)},Se=(Ce,qe,Fe)=>{ee(Ze=>Ze.map((Ke,et)=>et===Ce?{...Ke,[qe]:Fe}:Ke))},he=()=>{ee(Ce=>[...Ce,{name:"",weight:"",group:"",scheduledValue:null}])},Oe=Ce=>{C.length>1&&ee(qe=>qe.filter((Fe,Ze)=>Ze!==Ce))},Be=(Ce="value")=>{const qe=C.filter(Me=>Me.name.trim());if(qe.length===0){i("Add tasks first","error");return}let Fe=[...C];const Ze=C.map((Me,bt)=>Me.name.trim()?bt:-1).filter(Me=>Me>=0);if(Ce==="value"){const Me=qe.reduce((bt,kt)=>bt+(parseFloat(kt.scheduledValue)||0),0);if(Me===0)i("No scheduled values - using equal distribution","info"),Ce="equal";else{let bt=0;Ze.forEach((kt,Mt)=>{const Gt=parseFloat(C[kt].scheduledValue)||0;let Et;Mt===Ze.length-1?Et=100-bt:(Et=Math.round(Gt/Me*1e4)/100,bt+=Et),Fe[kt]={...Fe[kt],weight:Et.toFixed(2)}}),ee(Fe),J(!1),i("Weights calculated by value","success");return}}const Ke=Math.round(100/Ze.length*100)/100;let et=0;Ze.forEach((Me,bt)=>{let kt;bt===Ze.length-1?kt=100-et:(kt=Ke,et+=kt),Fe[Me]={...Fe[Me],weight:kt.toFixed(2)}}),ee(Fe),J(!1),i("Weights distributed equally","success")},Re=()=>{m(""),f(""),p(""),R(""),v(""),B(""),ae("demolition"),O("standard"),Z(""),oe(""),U(""),ee([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),D(!1),z([])},ze=()=>{de.current?.click()},pt=Ce=>new Promise((qe,Fe)=>{const Ze=new FileReader;Ze.onload=Ke=>{try{const et=new Uint8Array(Ke.target.result),Me=qx(et,{type:"array"}),bt=Me.SheetNames[0],kt=Me.Sheets[bt],Mt=hn.sheet_to_json(kt,{header:1}),Gt=[];let Et="General";const aa=/^\$?\d{1,3}(,\d{3})*(\.\d{2})?$/,da=/^(\d+\.?\d*|[A-Z]\.?\d*)$/i,St=/^(SF|LF|EA|LS|Days?|MD|Load|CY|SY|GAL|TON)$/i,Je=/^\d{1,3}(,\d{3})*$|^\d+$/,qt=/^(Item|#|No\.?|Description|Scheduled|Value|Amount|Quantity|Unit|Total|Application|Balance|Completed|Stored|Retainage)/i;for(const q of Mt){if(!q||q.length===0)continue;const we=q.map(xt=>xt==null?"":String(xt).trim()).filter(xt=>xt.length>0);if(we.length===0)continue;const lt=we.join(" ");if(qt.test(we[0])||we.length>1&&qt.test(we[1])||/^(Total|Subtotal|Grand Total|Base Bid|Contract Sum)/i.test(lt))continue;const De=we.some(xt=>aa.test(xt.replace(/[$,]/g,"")+(xt.includes(".")?"":".00")));if((!De&&we.length<=3&&/^(L\d|Level|Floor|\d+(?:st|nd|rd|th)|Plaza|Street|Basement|Roof|Penthouse|Site|Exterior|Interior|Misc|MEP|ABATEMENT|DEMOLITION|UNIVERSAL|SOFT|TRASH|DEMO|Phase|Division|Section|Area|Building|Wing)/i.test(we[0])||we.length===2&&da.test(we[0])&&!De&&!/^\d+\.\d+$/.test(we[0]))&&!De){Et=(we.find(dt=>!da.test(dt)&&dt.length>1)||we.join(" ")).replace(/\s*\(\d{1,3}(?:,\d{3})*\s*SF\)\s*$/i,"").replace(/\s*[-:]\s*$/,"").trim();continue}let at="",ot=!1,Yt="",sa=null;const Ne=[];for(let xt=0;xt<we.length;xt++){const dt=we[xt];if(xt===0&&da.test(dt)){Yt=dt;continue}if(!/^ID-\d+$/i.test(dt)&&!/^KN\s*\d+$/i.test(dt)){if(aa.test(dt.replace(/[$,]/g,"")+(dt.includes(".")?"":".00"))||/^\$/.test(dt)){const Oa=dt.replace(/[$,]/g,""),ke=parseFloat(Oa);!isNaN(ke)&&ke>100&&(sa===null||ke>sa)&&(sa=ke),ot=!0;continue}if(Je.test(dt.replace(/,/g,""))){ot=!0;continue}St.test(dt)||/^\d+\.?\d*%$/.test(dt)||dt.length>1&&!da.test(dt)&&Ne.push(dt)}}at=Ne.join(" ").trim(),at=at.replace(/\s+/g," ").replace(/^[-]\s*/,"").trim(),!(at.length<3)&&(/^(Plan|Page|Total|Base Bid|Payment|Condition|Exclusion|Subtotal)/i.test(at)||ot&&at.length>=3&&Gt.push({name:at,group:Et,itemNumber:Yt,scheduledValue:sa,selected:!0}))}const Ee=new Set,Y=Gt.filter(q=>{const we=`${q.group}:${q.name}`;return Ee.has(we)?!1:(Ee.add(we),!0)});qe(Y)}catch(et){Fe(et)}},Ze.onerror=()=>Fe(new Error("Failed to read file")),Ze.readAsArrayBuffer(Ce)}),rt=async Ce=>{const qe=Ce.target.files?.[0];if(!qe)return;const Fe=qe.name.split(".").pop().toLowerCase();if(!["xlsx","xls","csv"].includes(Fe)){i("Please upload an Excel file (.xlsx, .xls, or .csv)","error");return}V(!0);try{const Ze=await pt(qe);if(Ze.length===0){i("No tasks found. Check Excel format.","error"),V(!1);return}z(Ze),D(!0),i(`Found ${Ze.length} tasks`,"success")}catch(Ze){console.error("Excel import error:",Ze),i("Error reading Excel file","error")}finally{V(!1),de.current&&(de.current.value="")}},se=Ce=>{z(qe=>qe.map((Fe,Ze)=>Ze===Ce?{...Fe,selected:!Fe.selected}:Fe))},Ae=()=>{const Ce=y.filter(Ke=>Ke.selected);if(Ce.length===0){i("Please select at least one task","error");return}const qe=Ce.reduce((Ke,et)=>Ke+(et.scheduledValue||0),0),Fe=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});let Ze;if(qe>0){let Ke=0;Ze=Ce.map((et,Me)=>{const bt=et.scheduledValue||0;let kt;return Me===Ce.length-1?kt=100-Ke:(kt=Math.round(bt/qe*1e4)/100,Ke+=kt),{name:et.name,weight:kt.toFixed(2),group:et.group,scheduledValue:et.scheduledValue||null}}),i(`Tasks imported with value-based weights! Total SOV: ${Fe.format(qe)}`,"success")}else{const Ke=Math.round(100/Ce.length*100)/100;Ze=Ce.map((et,Me)=>({name:et.name,weight:Me===Ce.length-1?(100-Ke*(Ce.length-1)).toFixed(2):Ke.toFixed(2),group:et.group,scheduledValue:et.scheduledValue||null})),i("Tasks imported with equal weights","success")}ee(Ze),D(!1)},Ye=async()=>{if(!r?.id){i("No company selected. Please log in again.","error");return}if(!u.trim()){i("Please enter a project name","error");return}const Ce=parseFloat(S);if(!Ce||Ce<=0){i("Please enter a valid contract value","error");return}if(H.length!==4){i("Please enter a 4-digit PIN","error");return}if(!await K.isPinAvailable(H)){i("This PIN is already in use. Try another.","error");return}const Fe=C.filter(Ze=>Ze.name.trim()&&parseFloat(Ze.weight)>0);if(Fe.length===0){i("Please add at least one area","error");return}if(Math.abs(A-100)>.1){i("Area weights must total 100%","error");return}if(!w||!M){i("Start date and end date are required","error");return}if(new Date(M)<new Date(w)){i("End date must be on or after start date","error");return}te(!0);try{const Ze=await K.createProject({name:u.trim(),job_number:x.trim()||null,address:b.trim()||null,general_contractor:j.trim()||null,contract_value:Ce,pin:H,work_type:I,job_type:G,company_id:r?.id,created_by:l?.id,start_date:w,end_date:M,planned_man_days:E?parseInt(E):null});for(let Ke=0;Ke<Fe.length;Ke++)await K.createArea({project_id:Ze.id,name:Fe[Ke].name.trim(),weight:parseFloat(Fe[Ke].weight),scheduled_value:Fe[Ke].scheduledValue||null,group_name:Fe[Ke].group||null,status:"not_started",sort_order:Ke});i("Project created!","success"),Re(),c()}catch(Ze){console.error("Error creating project:",Ze),i("Error creating project","error")}finally{te(!1)}};if(ie){const Ce=[...new Set(y.map(Ke=>Ke.group))],qe=y.filter(Ke=>Ke.selected).length,Fe=y.reduce((Ke,et)=>Ke+(et.scheduledValue||0),0),Ze=y.filter(Ke=>Ke.selected).reduce((Ke,et)=>Ke+(et.scheduledValue||0),0);return e.jsxs("div",{children:[e.jsx("h1",{children:"Review Imported Tasks"}),e.jsx("p",{className:"subtitle",children:"Select the tasks to include in your project"}),e.jsxs("div",{className:"import-summary",children:[e.jsxs("span",{children:[qe," of ",y.length," tasks selected"]}),Fe>0&&e.jsxs("span",{className:"import-sov-total",children:[" Total SOV: ",new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(Ze)]})]}),Ce.map(Ke=>{const et=y.filter(bt=>bt.group===Ke),Me=et.filter(bt=>bt.selected).length;return e.jsxs("div",{className:"card import-group",children:[e.jsxs("div",{className:"import-group-header",children:[e.jsx("h3",{children:Ke}),e.jsxs("span",{className:"import-group-count",children:[Me,"/",et.length]})]}),e.jsx("div",{className:"import-task-list",children:et.map(bt=>{const kt=y.indexOf(bt);return e.jsxs("label",{className:"import-task-item",children:[e.jsx("input",{type:"checkbox",checked:bt.selected,onChange:()=>se(kt)}),e.jsx("span",{className:"import-task-name",children:bt.name}),bt.scheduledValue>0&&e.jsx("span",{className:"import-task-value",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(bt.scheduledValue)})]},kt)})})]},Ke)}),e.jsxs("div",{className:"import-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>D(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:Ae,children:["Use Selected Tasks (",qe,")"]})]})]})}const ft=C.reduce((Ce,qe,Fe)=>{const Ze=qe.group||"General";return Ce[Ze]||(Ce[Ze]=[]),Ce[Ze].push({...qe,originalIndex:Fe}),Ce},{}),ja=Object.keys(ft).length>1||Object.keys(ft).length===1&&!ft.General;return e.jsxs("div",{children:[e.jsx("h1",{children:"New Project"}),e.jsx("p",{className:"subtitle",children:"Set up a new project to track"}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Name"}),e.jsx("input",{type:"text",placeholder:"e.g., Sunrise Apartments",value:u,onChange:Ce=>m(Ce.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",placeholder:"e.g., 4032",value:x,onChange:Ce=>f(Ce.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($)"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"e.g., 365000",value:S,onChange:Ce=>{const qe=Ce.target.value.replace(/[^0-9.]/g,"");v(qe)},className:"currency-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",placeholder:"e.g., 123 Main St, Los Angeles, CA 90001",value:b,onChange:Ce=>p(Ce.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",placeholder:"e.g., ABC Construction Inc.",value:j,onChange:Ce=>R(Ce.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Start Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:w,onChange:Ce=>Z(Ce.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["End Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:M,onChange:Ce=>oe(Ce.target.value),min:w||void 0,required:!0}),w&&M&&new Date(M)<new Date(w)&&e.jsx("span",{className:"error-text",children:"End date must be after start date"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Planned Man-Days ",e.jsx("span",{className:"optional",children:"(optional)"})]}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Total estimated man-days to complete the project"}),e.jsx("input",{type:"number",inputMode:"numeric",placeholder:"e.g., 120",value:E,onChange:Ce=>U(Ce.target.value.replace(/\D/g,"")),min:"1"})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${I==="demolition"?"active":""}`,onClick:()=>ae("demolition"),children:"Demolition"}),e.jsx("button",{type:"button",className:`toggle-btn ${I==="abatement"?"active":""}`,onClick:()=>ae("abatement"),children:"Abatement"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${G==="standard"?"active":""}`,onClick:()=>O("standard"),children:"Standard"}),e.jsx("button",{type:"button",className:`toggle-btn ${G==="pla"?"active":""}`,onClick:()=>O("pla"),children:"PLA"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN (4 digits)"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Foremen will enter this PIN to access this project"}),e.jsxs("div",{className:"pin-input-row",children:[e.jsx("input",{type:"text",placeholder:"e.g., 2847",value:H,onChange:Ce=>xe(Ce.target.value),maxLength:4,className:"pin-input"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Q,children:"Generate"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"areas-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Areas / Tasks"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginTop:"0.25rem"},children:"Define the areas for this project. Weights must total 100%."})]}),e.jsxs("div",{className:"import-btn-container",children:[e.jsx("input",{ref:de,type:"file",accept:".xlsx,.xls,.csv",onChange:rt,style:{display:"none"}}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:ze,disabled:P,children:P?"Reading...":" Import Excel"})]})]}),ja?Object.entries(ft).map(([Ce,qe])=>e.jsxs("div",{className:"area-group",children:[e.jsx("div",{className:"area-group-header",children:Ce}),qe.map(Fe=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Task name",value:Fe.name,onChange:Ze=>Se(Fe.originalIndex,"name",Ze.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:Fe.scheduledValue?xd(Fe.scheduledValue):"",onChange:Ze=>Se(Fe.originalIndex,"scheduledValue",Xp(Ze.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:Fe.weight,onChange:Ze=>Se(Fe.originalIndex,"weight",Ze.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>Oe(Fe.originalIndex),children:""})]},Fe.originalIndex))]},Ce)):C.map((Ce,qe)=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Area name (e.g., Level 1)",value:Ce.name,onChange:Fe=>Se(qe,"name",Fe.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:Ce.scheduledValue?xd(Ce.scheduledValue):"",onChange:Fe=>Se(qe,"scheduledValue",Xp(Fe.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:Ce.weight,onChange:Fe=>Se(qe,"weight",Fe.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>Oe(qe),children:""})]},qe)),e.jsxs("div",{className:"weight-total-row",children:[e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Math.abs(A-100)<.1?"valid":"invalid"}`,children:[A.toFixed(1),"%"]}),C.some(Ce=>Ce.scheduledValue>0)&&e.jsxs("span",{className:"sov-total",children:[" SOV: ",xd(C.reduce((Ce,qe)=>Ce+(parseFloat(qe.scheduledValue)||0),0))]})]}),e.jsxs("div",{className:"auto-weight-dropdown",children:[e.jsx("button",{type:"button",className:"btn btn-secondary btn-small",onClick:()=>J(!L),children:"Auto-Calculate "}),L&&e.jsxs("div",{className:"weight-dropdown-menu",children:[e.jsxs("button",{onClick:()=>Be("value"),children:["By Value ",e.jsx("span",{className:"dropdown-hint",children:"(Recommended)"})]}),e.jsx("button",{onClick:()=>Be("equal"),children:"Equal Distribution"})]})]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:he,children:"+ Add Area"})]}),e.jsx("button",{className:"btn btn-primary btn-full",onClick:Ye,disabled:me,children:me?"Creating...":"Create Project"})]})}function Uy({company:r,onShowToast:l}){const{branding:c,updateBranding:i,uploadBrandingImage:u,loading:m}=Cr(),[x,f]=g.useState(!1),[b,p]=g.useState(!1),[j,R]=g.useState(c),[S,v]=g.useState(""),[H,B]=g.useState(!1),I=g.useRef(null),ae=g.useRef(null),G=g.useRef(null);g.useEffect(()=>{r?.id&&O()},[r?.id]);const O=async()=>{try{const{data:L,error:J}=await k.from("companies").select("office_code").eq("id",r.id).single();!J&&L?.office_code&&v(L.office_code)}catch(L){console.error("Error loading office code:",L)}},C=async()=>{if(confirm("Regenerate office code? Current code will stop working immediately.")){B(!0);try{const L=Math.random().toString(36).substring(2,8).toUpperCase(),{error:J}=await k.from("companies").update({office_code:L}).eq("id",r.id);if(J)throw J;v(L),l?.("Office code regenerated","success")}catch(L){console.error("Error regenerating code:",L),l?.("Error regenerating code","error")}finally{B(!1)}}},ee=()=>{navigator.clipboard.writeText(S),l?.("Office code copied to clipboard","success")},me=r?.subscription_tier||"free",te=["pro","business","enterprise"].includes(me),P=["business","enterprise"].includes(me),V=me==="enterprise",ie=(L,J)=>{R(w=>({...w,[L]:J}))},D=async(L,J)=>{if(L){if(L.size>5*1024*1024){l?.("Image must be smaller than 5MB","error");return}if(!L.type.startsWith("image/")){l?.("Please upload an image file","error");return}try{const w=await u(L,J);w.success?(ie(`${J}_url`,w.url),l?.(`${J.charAt(0).toUpperCase()+J.slice(1)} uploaded successfully`,"success")):l?.(w.error||"Failed to upload image","error")}catch(w){console.error("Upload error:",w),l?.("Failed to upload image","error")}}},y=async()=>{try{f(!0);const L=/^#[0-9A-F]{6}$/i;if(!L.test(j.primary_color)){l?.("Primary color must be a valid hex color (e.g., #3B82F6)","error");return}if(!L.test(j.secondary_color)){l?.("Secondary color must be a valid hex color (e.g., #1E40AF)","error");return}const J=await i(j);J.success?l?.("Branding settings saved successfully!","success"):l?.(J.error||"Failed to save branding settings","error")}catch(L){console.error("Save error:",L),l?.("Failed to save branding settings","error")}finally{f(!1)}},z=()=>{b?(document.documentElement.style.setProperty("--primary-color",c.primary_color),document.documentElement.style.setProperty("--secondary-color",c.secondary_color),document.title=c.custom_app_name||"FieldSync"):(document.documentElement.style.setProperty("--primary-color",j.primary_color),document.documentElement.style.setProperty("--secondary-color",j.secondary_color),document.title=j.custom_app_name||"FieldSync"),p(!b)};return m?e.jsxs("div",{className:"settings-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading branding settings..."})]}):e.jsxs("div",{className:"branding-settings",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("h2",{children:" Branding Settings"}),me==="free"&&e.jsx("div",{className:"tier-badge tier-free",children:"Free Plan - Upgrade for branding options"}),me==="pro"&&e.jsx("div",{className:"tier-badge tier-pro",children:"Pro Plan"}),me==="business"&&e.jsx("div",{className:"tier-badge tier-business",children:"Business Plan"}),me==="enterprise"&&e.jsx("div",{className:"tier-badge tier-enterprise",children:"Enterprise Plan"})]}),e.jsxs("div",{className:"settings-section security-section",children:[e.jsx("h3",{children:"Security"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Office Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Share this code with office staff only. Required to create new office accounts."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:S||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:ee,disabled:!S,children:"Copy"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:C,disabled:H,children:H?"...":"Regenerate"})]}),e.jsx("p",{className:"help-text",style:{marginTop:"0.5rem",color:"var(--accent-amber)"},children:"Field workers should NOT have this code - they use project PINs only."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Company Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Public code for employees to find your company."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:r?.code||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:()=>{navigator.clipboard.writeText(r?.code||""),l?.("Company code copied","success")},disabled:!r?.code,children:"Copy"})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Visual Identity"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Logo"}),te?e.jsxs(e.Fragment,{children:[j.logo_url&&e.jsx("div",{className:"logo-preview",children:e.jsx("img",{src:j.logo_url,alt:"Logo preview"})}),e.jsx("input",{ref:I,type:"file",accept:"image/*",style:{display:"none"},onChange:L=>D(L.target.files[0],"logo")}),e.jsx("button",{className:"btn-secondary",onClick:()=>I.current?.click(),children:j.logo_url?"Change Logo":"Upload Logo"}),e.jsx("p",{className:"help-text",children:"Recommended: 200x60px, PNG with transparent background"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your logo"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"app-name",children:"App Name"}),te?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"app-name",type:"text",className:"input",value:j.custom_app_name||"",onChange:L=>ie("custom_app_name",L.target.value),placeholder:"FieldSync",maxLength:50}),e.jsx("p",{className:"help-text",children:"This name appears in the browser tab and throughout the app"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your app name"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"primary-color",children:"Primary Color"}),te?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"primary-color",type:"color",value:j.primary_color||"#3B82F6",onChange:L=>ie("primary_color",L.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:j.primary_color||"#3B82F6",onChange:L=>ie("primary_color",L.target.value),placeholder:"#3B82F6",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"secondary-color",children:"Secondary Color"}),te?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"secondary-color",type:"color",value:j.secondary_color||"#1E40AF",onChange:L=>ie("secondary_color",L.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:j.secondary_color||"#1E40AF",onChange:L=>ie("secondary_color",L.target.value),placeholder:"#1E40AF",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Favicon"}),te?e.jsxs(e.Fragment,{children:[j.favicon_url&&e.jsx("div",{className:"favicon-preview",children:e.jsx("img",{src:j.favicon_url,alt:"Favicon preview"})}),e.jsx("input",{ref:ae,type:"file",accept:"image/*",style:{display:"none"},onChange:L=>D(L.target.files[0],"favicon")}),e.jsx("button",{className:"btn-secondary",onClick:()=>ae.current?.click(),children:j.favicon_url?"Change Favicon":"Upload Favicon"}),e.jsx("p",{className:"help-text",children:"Recommended: 32x32px or 64x64px, PNG or ICO format"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your favicon"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Login Background"}),P?e.jsxs(e.Fragment,{children:[j.login_background_url&&e.jsx("div",{className:"background-preview",children:e.jsx("img",{src:j.login_background_url,alt:"Background preview"})}),e.jsx("input",{ref:G,type:"file",accept:"image/*",style:{display:"none"},onChange:L=>D(L.target.files[0],"login_background")}),e.jsx("button",{className:"btn-secondary",onClick:()=>G.current?.click(),children:j.login_background_url?"Change Background":"Upload Background"}),e.jsx("p",{className:"help-text",children:"Recommended: 1920x1080px, JPG or PNG"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Business or Enterprise to customize login background"})})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"White-Label Options"}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:j.hide_fieldsync_branding||!1,onChange:L=>ie("hide_fieldsync_branding",L.target.checked),disabled:!P}),e.jsx("span",{children:'Hide "Powered by FieldSync"'})]}),!P&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Email Branding"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-name",children:"From Name"}),e.jsx("input",{id:"email-from-name",type:"text",className:"input",value:j.email_from_name||"",onChange:L=>ie("email_from_name",L.target.value),placeholder:"Your Company Name",disabled:!P}),!P&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-address",children:"From Email"}),e.jsx("input",{id:"email-from-address",type:"email",className:"input",value:j.email_from_address||"",onChange:L=>ie("email_from_address",L.target.value),placeholder:"noreply@yourcompany.com",disabled:!P}),!P&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Custom Domain"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"custom-domain",children:"Domain"}),V?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"custom-domain",type:"text",className:"input",value:j.custom_domain||"",onChange:L=>ie("custom_domain",L.target.value),placeholder:"app.yourcompany.com"}),j.custom_domain&&e.jsx("div",{className:`domain-status ${j.domain_verified?"verified":"pending"}`,children:j.domain_verified?e.jsx(e.Fragment,{children:" Connected"}):e.jsx(e.Fragment,{children:" DNS setup required"})}),e.jsx("p",{className:"help-text",children:"Contact support to configure DNS and SSL certificate for your custom domain"})]}):e.jsxs("div",{className:"upgrade-notice",children:[e.jsx("p",{children:" Enterprise plan required for custom domain support"}),e.jsx("p",{className:"help-text",children:"Custom domains allow you to host the app at your own URL (e.g., app.yourcompany.com)"})]})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:z,children:b?"Exit Preview":"Preview Changes"}),e.jsx("button",{className:"btn-primary",onClick:y,disabled:x||!te,children:x?"Saving...":"Save Changes"})]}),b&&e.jsx("div",{className:"preview-banner",children:"Preview Mode Active - Your changes are not yet saved"})]})}const jd=["foreman","operator","laborer"],vd=["demolition","abatement"],yd=["standard","pla"];function Hy({company:r,onShowToast:l}){const[c,i]=g.useState({}),[u,m]=g.useState(!1),[x,f]=g.useState(!1),[b,p]=g.useState("demolition"),[j,R]=g.useState(!0);g.useEffect(()=>{r?.id&&v()},[r?.id]);const S=()=>{const O={};return vd.forEach(C=>{O[C]={},yd.forEach(ee=>{O[C][ee]={},jd.forEach(me=>{O[C][ee][me]={regular:"",overtime:""}})})}),O},v=async()=>{if(!$){i(S()),R(!1);return}const O=S();try{const{data:C,error:ee}=await k.from("labor_rates").select("*").eq("company_id",r.id);if(ee){i(O),R(!1);return}C&&C.length>0&&C.forEach(me=>{O[me.work_type]&&O[me.work_type][me.job_type]&&O[me.work_type][me.job_type][me.role]&&(O[me.work_type][me.job_type][me.role]={regular:me.regular_rate||"",overtime:me.overtime_rate||""})}),i(O)}catch(C){console.error("Error loading labor rates:",C),i(O)}finally{R(!1)}},H=async()=>{if(!$){l("Labor rates require database connection","error");return}f(!0);try{await k.from("labor_rates").delete().eq("company_id",r.id);const O=[];vd.forEach(ee=>{yd.forEach(me=>{jd.forEach(te=>{const P=c[ee]?.[me]?.[te]||{regular:0,overtime:0};O.push({company_id:r.id,role:te,work_type:ee,job_type:me,regular_rate:parseFloat(P.regular)||0,overtime_rate:parseFloat(P.overtime)||0})})})});const{error:C}=await k.from("labor_rates").insert(O);if(C)throw C;l("Labor rates saved","success"),m(!1)}catch(O){console.error("Error saving labor rates:",O),l("Error saving rates: "+(O.message||"Unknown error"),"error")}finally{f(!1)}},B=(O,C,ee,me,te)=>{i(P=>({...P,[O]:{...P[O],[C]:{...P[O]?.[C],[ee]:{...P[O]?.[C]?.[ee],[me]:te}}}}))},I=O=>O.charAt(0).toUpperCase()+O.slice(1),ae=O=>O.charAt(0).toUpperCase()+O.slice(1),G=O=>O==="pla"?"PLA (Prevailing Wage)":"Standard (Private)";return j?e.jsx("div",{className:"loading",children:"Loading labor rates..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"pricing-section-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Labor Rates"}),e.jsx("p",{className:"section-desc",children:"Configure hourly rates by role, work type, and job classification"})]}),u?e.jsxs("div",{className:"rate-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>{m(!1),v()},children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:H,disabled:x,children:x?"Saving...":"Save All Rates"})]}):e.jsx("button",{className:"btn btn-primary",onClick:()=>m(!0),children:"Edit Rates"})]}),e.jsx("div",{className:"work-type-tabs",children:vd.map(O=>e.jsx("button",{className:`work-type-tab ${b===O?"active":""}`,onClick:()=>p(O),children:ae(O)},O))}),e.jsx("div",{className:"labor-rates-container",children:yd.map(O=>e.jsxs("div",{className:"job-type-section",children:[e.jsx("h3",{className:"job-type-header",children:G(O)}),e.jsxs("div",{className:"rates-table",children:[e.jsxs("div",{className:"rates-table-header",children:[e.jsx("div",{className:"rate-cell role-cell",children:"Role"}),e.jsx("div",{className:"rate-cell",children:"Regular"}),e.jsx("div",{className:"rate-cell",children:"Overtime"})]}),jd.map(C=>{const ee=c[b]?.[O]?.[C]||{regular:"",overtime:""};return e.jsxs("div",{className:"rates-table-row",children:[e.jsx("div",{className:"rate-cell role-cell",children:I(C)}),e.jsx("div",{className:"rate-cell",children:u?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",value:ee.regular,onChange:me=>B(b,O,C,"regular",me.target.value.replace(/[^0-9.]/g,"")),placeholder:"0"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value",children:["$",parseFloat(ee.regular)||0,"/hr"]})}),e.jsx("div",{className:"rate-cell",children:u?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",value:ee.overtime,onChange:me=>B(b,O,C,"overtime",me.target.value.replace(/[^0-9.]/g,"")),placeholder:"0"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value ot",children:["$",parseFloat(ee.overtime)||0,"/hr"]})})]},C)})]})]},O))})]})}const Fi=["Containment","PPE","Disposal","Equipment"];function Fy({company:r,onShowToast:l}){const[c,i]=g.useState([]),[u,m]=g.useState(!0),[x,f]=g.useState("all"),[b,p]=g.useState(null),[j,R]=g.useState(!1),[S,v]=g.useState({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),[H,B]=g.useState([]),[I,ae]=g.useState(!1);g.useEffect(()=>{r?.id&&G()},[r?.id]);const G=async()=>{m(!0);try{const D=await K.getAllMaterialsEquipment(r.id);i(D||[]),O(D||[])}catch(D){console.error("Error loading items:",D),l("Error loading materials","error")}finally{m(!1)}},O=D=>{const y={},z=[];D.filter(J=>J.active!==!1).forEach(J=>{const w=J.name.toLowerCase().trim();y[w]||(y[w]=[]),y[w].push(J)}),Object.entries(y).forEach(([J,w])=>{w.length>1&&z.push({name:J,items:w})}),B(z)},C=async D=>{try{const y=D.items.filter(J=>J.cost_per_unit>0),z=y.length>0?y[0]:D.items[0],L=D.items.filter(J=>J.id!==z.id);for(const J of L)await K.deleteMaterialEquipment(J.id);l(`Merged ${D.items.length} items into one`,"success"),G()}catch(y){console.error("Error merging duplicates:",y),l("Error merging duplicates","error")}},ee=async()=>{if(confirm(`Merge all ${H.length} duplicate groups?`))try{for(const D of H){const y=D.items.filter(J=>J.cost_per_unit>0),z=y.length>0?y[0]:D.items[0],L=D.items.filter(J=>J.id!==z.id);for(const J of L)await K.deleteMaterialEquipment(J.id)}l("All duplicates merged!","success"),G(),ae(!1)}catch(D){console.error("Error merging all duplicates:",D),l("Error merging duplicates","error")}},me=async()=>{if(!S.name.trim()){l("Enter item name","error");return}try{await K.createMaterialEquipment({company_id:r.id,name:S.name.trim(),category:S.category,unit:S.unit||"each",cost_per_unit:parseFloat(S.cost_per_unit)||0,active:!0}),l("Item added","success"),v({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),R(!1),G()}catch(D){console.error("Error adding item:",D),l("Error adding item","error")}},te=async D=>{try{await K.updateMaterialEquipment(D.id,{name:D.name,category:D.category,unit:D.unit,cost_per_unit:parseFloat(D.cost_per_unit)||0}),l("Item updated","success"),p(null),G()}catch(y){console.error("Error updating item:",y),l("Error updating item","error")}},P=async D=>{if(confirm("Delete this item?"))try{await K.deleteMaterialEquipment(D),l("Item deleted","success"),G()}catch(y){console.error("Error deleting item:",y),l("Error deleting item","error")}},V=x==="all"?c.filter(D=>D.active!==!1):c.filter(D=>D.category===x&&D.active!==!1),ie=V.reduce((D,y)=>{const z=y.category||"Other";return D[z]||(D[z]=[]),D[z].push(y),D},{});return u?e.jsx("div",{className:"loading",children:"Loading materials..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"materials-header",children:[e.jsxs("div",{className:"materials-title",children:[e.jsx("h2",{children:"Materials & Equipment"}),e.jsxs("span",{className:"materials-count",children:[c.filter(D=>D.active!==!1).length," items"]})]}),e.jsxs("div",{className:"materials-actions",children:[H.length>0&&e.jsxs("button",{className:`btn btn-warning ${I?"active":""}`,onClick:()=>ae(!I),children:[H.length," Duplicates"]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>R(!0),children:"+ Add Item"})]})]}),I&&H.length>0&&e.jsxs("div",{className:"duplicates-panel",children:[e.jsxs("div",{className:"duplicates-header",children:[e.jsx("h3",{children:"Duplicate Items Found"}),e.jsxs("button",{className:"btn btn-success btn-small",onClick:ee,children:["Merge All (",H.length,")"]})]}),e.jsx("div",{className:"duplicates-list",children:H.map((D,y)=>e.jsxs("div",{className:"duplicate-group",children:[e.jsxs("div",{className:"duplicate-name",children:['"',D.name,'" x ',D.items.length]}),e.jsx("div",{className:"duplicate-items",children:D.items.map(z=>e.jsxs("span",{className:"duplicate-item",children:[z.category," - $",z.cost_per_unit||0]},z.id))}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>C(D),children:"Merge"})]},y))})]}),j&&e.jsxs("div",{className:"add-item-form",children:[e.jsx("h3",{children:"Add New Item"}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Item Name",value:S.name,onChange:D=>v({...S,name:D.target.value}),autoFocus:!0}),e.jsx("select",{value:S.category,onChange:D=>v({...S,category:D.target.value}),children:Fi.map(D=>e.jsx("option",{value:D,children:D},D))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Unit (e.g., each, day, hour)",value:S.unit,onChange:D=>v({...S,unit:D.target.value})}),e.jsxs("div",{className:"dollar-input-wrapper",children:[e.jsx("span",{className:"dollar-prefix",children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",className:"dollar-input",placeholder:"Cost per unit",value:S.cost_per_unit,onChange:D=>{const y=D.target.value.replace(/[^0-9.]/g,"");v({...S,cost_per_unit:y})}})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>R(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:me,children:"Add Item"})]})]}),e.jsxs("div",{className:"materials-filter",children:[e.jsx("button",{className:`filter-tab ${x==="all"?"active":""}`,onClick:()=>f("all"),children:"All"}),Fi.map(D=>e.jsxs("button",{className:`filter-tab ${x===D?"active":""}`,onClick:()=>f(D),children:[D,e.jsx("span",{className:"filter-count",children:c.filter(y=>y.category===D&&y.active!==!1).length})]},D))]}),e.jsxs("div",{className:"materials-list",children:[x==="all"?Object.entries(ie).map(([D,y])=>e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:D}),e.jsx("div",{className:"category-items",children:y.map(z=>e.jsx(Ip,{item:z,editingItem:b,setEditingItem:p,handleUpdateItem:te,handleDeleteItem:P,categories:Fi},z.id))})]},D)):e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:x}),e.jsx("div",{className:"category-items",children:V.map(D=>e.jsx(Ip,{item:D,editingItem:b,setEditingItem:p,handleUpdateItem:te,handleDeleteItem:P,categories:Fi},D.id))})]}),V.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No items in this category"})})]})]})}function Ip({item:r,editingItem:l,setEditingItem:c,handleUpdateItem:i,handleDeleteItem:u,categories:m}){return l?.id===r.id?e.jsx("div",{className:"material-item",children:e.jsxs("div",{className:"item-edit-form",children:[e.jsx("input",{type:"text",value:l.name,onChange:x=>c({...l,name:x.target.value})}),e.jsx("select",{value:l.category,onChange:x=>c({...l,category:x.target.value}),children:m.map(x=>e.jsx("option",{value:x,children:x},x))}),e.jsx("input",{type:"text",value:l.unit,onChange:x=>c({...l,unit:x.target.value}),placeholder:"Unit"}),e.jsxs("div",{className:"dollar-input-wrapper compact",children:[e.jsx("span",{className:"dollar-prefix",children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",className:"dollar-input",value:l.cost_per_unit,onChange:x=>{const f=x.target.value.replace(/[^0-9.]/g,"");c({...l,cost_per_unit:f})},placeholder:"Cost"})]}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>i(l),children:"Save"}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>c(null),children:"Cancel"})]})]})}):e.jsxs("div",{className:"material-item",children:[e.jsxs("div",{className:"item-info",children:[e.jsx("span",{className:"item-name",children:r.name}),e.jsx("span",{className:"item-unit",children:r.unit||"each"})]}),e.jsxs("div",{className:"item-cost",children:["$",(r.cost_per_unit||0).toFixed(2)]}),e.jsxs("div",{className:"item-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>c({...r}),title:"Edit",children:e.jsx(Od,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:()=>u(r.id),title:"Delete",children:e.jsx(Us,{size:16})})]})]})}const By=[{id:"trash",label:"Trash",description:"General debris"},{id:"metal",label:"Metal",description:"Scrap metal (recyclable)"},{id:"copper",label:"Copper",description:"Copper scrap (recyclable)"},{id:"concrete",label:"Concrete",description:"Concrete/masonry"},{id:"hazardous",label:"Hazardous",description:"Hazardous materials"}];function $y({company:r,onShowToast:l}){const[c,i]=g.useState([]),[u,m]=g.useState(!0),[x,f]=g.useState(!1),[b,p]=g.useState(null),[j,R]=g.useState({name:"",address:"",notes:""}),[S,v]=g.useState(!1),[H,B]=g.useState({}),I=g.useRef({});g.useEffect(()=>{r?.id&&ae()},[r?.id]),g.useEffect(()=>()=>{Object.values(I.current).forEach(V=>clearTimeout(V))},[]);const ae=async()=>{m(!0);try{const V=await K.getDumpSites(r.id);i(V||[])}catch(V){console.error("Error loading dump sites:",V),l("Error loading dump sites","error")}finally{m(!1)}},G=async()=>{if(!j.name.trim()){l("Please enter a site name","error");return}v(!0);try{await K.createDumpSite(r.id,j.name,j.address,j.notes),l("Dump site added","success"),R({name:"",address:"",notes:""}),f(!1),ae()}catch(V){console.error("Error adding dump site:",V),l("Error adding dump site","error")}finally{v(!1)}},O=async()=>{if(!b?.name.trim()){l("Please enter a site name","error");return}v(!0);try{await K.updateDumpSite(b.id,{name:b.name,address:b.address,notes:b.notes}),l("Dump site updated","success"),p(null),ae()}catch(V){console.error("Error updating dump site:",V),l("Error updating dump site","error")}finally{v(!1)}},C=async V=>{if(confirm("Are you sure you want to delete this dump site?"))try{await K.deleteDumpSite(V),l("Dump site deleted","success"),ae()}catch(ie){console.error("Error deleting dump site:",ie),l("Error deleting dump site","error")}},ee=g.useCallback(async(V,ie,D)=>{try{await K.setDumpSiteRate(V,ie,D),i(y=>y.map(z=>{if(z.id===V){const L=[...z.dump_site_rates||[]],J=L.findIndex(w=>w.waste_type===ie);return J>=0?L[J]={...L[J],estimated_cost_per_load:D}:L.push({waste_type:ie,estimated_cost_per_load:D}),{...z,dump_site_rates:L}}return z})),B(y=>{const z={...y};return delete z[`${V}-${ie}`],z})}catch(y){console.error("Error saving rate:",y?.message||y),l("Error saving rate","error")}},[l]),me=(V,ie,D)=>{const y=`${V}-${ie}`;B(z=>({...z,[y]:D})),I.current[y]&&clearTimeout(I.current[y]),I.current[y]=setTimeout(()=>{const z=parseFloat(D)||0;ee(V,ie,z)},500)},te=(V,ie)=>{const D=`${V.id}-${ie}`;return H[D]!==void 0?H[D]:V.dump_site_rates?.find(z=>z.waste_type===ie)?.estimated_cost_per_load??""},P=V=>{if(V===""||V===null||V===void 0)return"";const ie=parseFloat(V);return ie<0?`-$${Math.abs(ie).toFixed(0)}`:`$${ie.toFixed(0)}`};return u?e.jsx("div",{className:"loading",children:"Loading dump sites..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"dump-site-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Disposal & Haul-Off"}),e.jsx("p",{className:"section-desc",children:"Configure dump sites and estimated costs per load for each waste type. Use negative values for recyclables (metal, copper) to indicate revenue."})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>f(!0),children:"+ Add Dump Site"})]}),x&&e.jsxs("div",{className:"dump-site-form card",children:[e.jsx("h4",{children:"Add Dump Site"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:j.name,onChange:V=>R({...j,name:V.target.value}),placeholder:"e.g., Metro Landfill"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:j.address,onChange:V=>R({...j,address:V.target.value}),placeholder:"123 Main St, City"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:j.notes,onChange:V=>R({...j,notes:V.target.value}),placeholder:"Operating hours, contact, etc."})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:G,disabled:S,children:S?"Adding...":"Add Site"})]})]}),c.length===0?e.jsxs("div",{className:"dump-site-empty",children:[e.jsx("p",{children:"No dump sites configured yet."}),e.jsx("p",{children:"Add a dump site to start tracking haul-off costs."})]}):e.jsx("div",{className:"dump-sites-list",children:c.map(V=>e.jsxs("div",{className:"dump-site-card card",children:[b?.id===V.id?e.jsxs("div",{className:"dump-site-edit",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:b.name,onChange:ie=>p({...b,name:ie.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:b.address||"",onChange:ie=>p({...b,address:ie.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:b.notes||"",onChange:ie=>p({...b,notes:ie.target.value})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>p(null),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:O,disabled:S,children:S?"Saving...":"Save"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dump-site-info",children:[e.jsx("div",{className:"dump-site-name",children:V.name}),V.address&&e.jsx("div",{className:"dump-site-address",children:V.address}),V.notes&&e.jsx("div",{className:"dump-site-notes",children:V.notes})]}),e.jsxs("div",{className:"dump-site-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>p({...V}),title:"Edit",children:e.jsx(Od,{size:16})}),e.jsx("button",{className:"btn-icon",onClick:()=>C(V.id),title:"Delete",children:e.jsx(Us,{size:16})})]})]}),e.jsxs("div",{className:"dump-site-rates",children:[e.jsx("div",{className:"rates-header",children:"Estimated Cost per Load"}),e.jsx("div",{className:"rates-grid",children:By.map(ie=>e.jsxs("div",{className:"rate-item",children:[e.jsxs("label",{children:[e.jsx("span",{className:"rate-label",children:ie.label}),e.jsx("span",{className:"rate-desc",children:ie.description})]}),e.jsxs("div",{className:"rate-input-wrapper",children:[e.jsx("span",{className:"rate-prefix",children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",className:"rate-input",value:te(V,ie.id),onChange:D=>{const y=D.target.value.replace(/[^0-9.-]/g,"");me(V.id,ie.id,y)},placeholder:"0"})]}),te(V,ie.id)!==""&&e.jsxs("span",{className:`rate-preview ${parseFloat(te(V,ie.id))<0?"revenue":"cost"}`,children:[P(te(V,ie.id)),"/load"]})]},ie.id))}),e.jsx("div",{className:"rates-note",children:"Tip: Use negative values for recyclables that generate revenue (e.g., -50 for metal)"})]})]},V.id))})]})}const Vy=[{id:"labor",label:"Labor Rates",Icon:Ea},{id:"materials",label:"Materials & Equipment",Icon:Nl},{id:"disposal",label:"Disposal & Haul-Off",Icon:ds}];function Gy({company:r,onShowToast:l}){const[c,i]=g.useState("labor");return e.jsxs("div",{className:"pricing-manager",children:[e.jsxs("div",{className:"pricing-header",children:[e.jsx("h1",{children:"Pricing Configuration"}),e.jsx("p",{className:"pricing-subtitle",children:"Set up labor rates, materials pricing, and disposal costs"})]}),e.jsx("div",{className:"pricing-tabs",children:Vy.map(u=>e.jsxs("button",{className:`pricing-tab ${c===u.id?"active":""}`,onClick:()=>i(u.id),children:[e.jsx(u.Icon,{size:18,className:"pricing-tab-icon"}),e.jsx("span",{className:"pricing-tab-label",children:u.label})]},u.id))}),e.jsxs("div",{className:"pricing-content",children:[c==="labor"&&e.jsx(Hy,{company:r,onShowToast:l}),c==="materials"&&e.jsx(Fy,{company:r,onShowToast:l}),c==="disposal"&&e.jsx($y,{company:r,onShowToast:l})]})]})}function Py({shareToken:r}){const[l,c]=g.useState(!0),[i,u]=g.useState(null),[m,x]=g.useState(null),[f,b]=g.useState(0),{branding:p}=Cr();g.useEffect(()=>{j()},[r]);const j=async()=>{c(!0),u(null);try{const C=await K.getPublicProjectData(r);if(!C){u("This share link is invalid or has expired.");return}x(C)}catch(C){console.error("Error loading public data:",C),u("Failed to load project data.")}finally{c(!1)}},R=C=>C?new Date(C).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",S=C=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(C);if(l)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading project..."})]}),e.jsx("style",{children:bd})]});if(i)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx(Er,{size:48})}),e.jsx("h2",{children:i}),e.jsx("p",{children:"Please contact the project owner for a valid link."})]}),e.jsx("style",{children:bd})]});const{share:v,project:H,progress:B,areas:I,photos:ae,dailyReports:G,tmTickets:O}=m;return e.jsxs("div",{className:"public-view",children:[e.jsx("header",{className:"public-header",children:e.jsxs("div",{className:"container",children:[e.jsx(ps,{size:"large"}),e.jsx("div",{className:"header-meta",children:e.jsxs("span",{className:"last-updated",children:["Last updated: ",R(H.updated_at||H.created_at)]})})]})}),e.jsx("main",{className:"public-main",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"project-header",children:[e.jsx("h1",{children:H.name}),H.address&&e.jsx("p",{className:"project-address",children:H.address})]}),v.permissions.progress&&e.jsxs("div",{className:"public-card progress-card",children:[e.jsx("h2",{children:"Project Progress"}),e.jsxs("div",{className:"progress-visual",children:[e.jsxs("div",{className:"progress-circle",children:[e.jsxs("svg",{viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"var(--primary-color, #3b82f6)",strokeWidth:"8",strokeDasharray:`${B*2.827} 282.7`,strokeLinecap:"round",transform:"rotate(-90 50 50)"})]}),e.jsxs("div",{className:"progress-percentage",children:[B,"%"]})]}),e.jsxs("div",{className:"progress-details",children:[e.jsx("div",{className:"progress-label",children:"Complete"}),I&&I.length>0&&e.jsxs("div",{className:"areas-summary",children:[I.filter(C=>C.status==="done").length," of ",I.length," areas completed"]})]})]}),I&&I.length>0&&e.jsxs("div",{className:"areas-list",children:[e.jsx("h3",{children:"Work Areas"}),I.map(C=>e.jsxs("div",{className:"area-item",children:[e.jsxs("div",{className:"area-info",children:[e.jsx("span",{className:"area-name",children:C.name}),e.jsxs("span",{className:"area-weight",children:[C.weight,"%"]})]}),e.jsx("div",{className:`area-status status-${C.status}`,children:C.status==="done"?" Complete":C.status==="working"?" In Progress":" Not Started"})]},C.id))]})]}),v.permissions.photos&&ae&&ae.length>0&&e.jsxs("div",{className:"public-card photos-card",children:[e.jsx("h2",{children:"Recent Photos"}),e.jsxs("div",{className:"photos-carousel",children:[e.jsxs("div",{className:"carousel-main",children:[ae[f]&&e.jsx("img",{src:ae[f].url,alt:`Project photo from ${R(ae[f].date)}`,className:"carousel-image"}),e.jsx("div",{className:"carousel-date",children:R(ae[f]?.date)})]}),e.jsx("div",{className:"carousel-thumbnails",children:ae.slice(0,10).map((C,ee)=>e.jsx("div",{className:`thumbnail ${ee===f?"active":""}`,onClick:()=>b(ee),children:e.jsx("img",{src:C.url,alt:`Thumbnail ${ee+1}`})},ee))}),ae.length>1&&e.jsxs("div",{className:"carousel-controls",children:[e.jsx("button",{onClick:()=>b(C=>C>0?C-1:ae.length-1),className:"carousel-btn",children:""}),e.jsxs("span",{className:"carousel-counter",children:[f+1," / ",ae.length]}),e.jsx("button",{onClick:()=>b(C=>C<ae.length-1?C+1:0),className:"carousel-btn",children:""})]})]})]}),v.permissions.daily_reports&&G&&G.length>0&&e.jsxs("div",{className:"public-card reports-card",children:[e.jsx("h2",{children:"Daily Reports"}),e.jsx("div",{className:"reports-list",children:G.map((C,ee)=>e.jsxs("div",{className:"report-item",children:[e.jsx("div",{className:"report-date",children:R(C.report_date)}),e.jsxs("div",{className:"report-content",children:[C.crew_count&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Crew:"})," ",C.crew_count," workers"]}),C.tasks_completed&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Tasks Completed:"})," ",C.tasks_completed]}),C.weather&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Weather:"})," ",C.weather]}),C.notes&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Notes:"})," ",C.notes]})]})]},ee))})]}),v.permissions.tm_tickets&&O&&O.length>0&&e.jsxs("div",{className:"public-card tm-card",children:[e.jsx("h2",{children:"Time & Materials Tickets"}),e.jsx("div",{className:"tm-list",children:O.map((C,ee)=>e.jsxs("div",{className:"tm-item",children:[e.jsxs("div",{className:"tm-header",children:[e.jsx("span",{className:"tm-date",children:R(C.work_date)}),e.jsx("span",{className:`tm-status status-${C.status}`,children:C.status})]}),C.description&&e.jsx("div",{className:"tm-description",children:C.description}),C.total_amount&&e.jsxs("div",{className:"tm-amount",children:["Total: ",S(C.total_amount)]})]},ee))})]})]})}),e.jsx("footer",{className:"public-footer",children:e.jsx("div",{className:"container",children:!p?.hide_fieldsync_branding&&e.jsx("p",{children:"Powered by FieldSync"})})}),e.jsx("style",{children:bd})]})}const bd=`
  .public-view {
    min-height: 100vh;
    background-color: #f9fafb;
    display: flex;
    flex-direction: column;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 1rem;
    width: 100%;
  }

  /* Header */
  .public-header {
    background-color: white;
    border-bottom: 1px solid #e5e7eb;
    padding: 1.5rem 0;
  }

  .public-header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header-meta {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Main Content */
  .public-main {
    flex: 1;
    padding: 2rem 0;
  }

  .project-header {
    margin-bottom: 2rem;
  }

  .project-header h1 {
    font-size: 2rem;
    margin: 0 0 0.5rem 0;
    color: #111827;
  }

  .project-address {
    font-size: 1rem;
    color: #6b7280;
    margin: 0;
  }

  /* Cards */
  .public-card {
    background-color: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .public-card h2 {
    font-size: 1.5rem;
    margin: 0 0 1.5rem 0;
    color: #111827;
  }

  .public-card h3 {
    font-size: 1.125rem;
    margin: 1.5rem 0 1rem 0;
    color: #374151;
  }

  /* Progress Card */
  .progress-visual {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .progress-circle {
    position: relative;
    width: 150px;
    height: 150px;
    flex-shrink: 0;
  }

  .progress-circle svg {
    width: 100%;
    height: 100%;
  }

  .progress-percentage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary-color, #3b82f6);
  }

  .progress-details {
    flex: 1;
  }

  .progress-label {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.5rem;
  }

  .areas-summary {
    font-size: 1rem;
    color: #6b7280;
  }

  /* Areas List */
  .areas-list {
    border-top: 1px solid #e5e7eb;
    padding-top: 1rem;
  }

  .area-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f3f4f6;
  }

  .area-item:last-child {
    border-bottom: none;
  }

  .area-info {
    flex: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-right: 1rem;
  }

  .area-name {
    font-weight: 500;
    color: #374151;
  }

  .area-weight {
    color: #6b7280;
    font-size: 0.875rem;
  }

  .area-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
  }

  .area-status.status-done {
    background-color: #d1fae5;
    color: #065f46;
  }

  .area-status.status-working {
    background-color: #fef3c7;
    color: #92400e;
  }

  .area-status.status-not_started {
    background-color: #f3f4f6;
    color: #6b7280;
  }

  /* Photos Carousel */
  .photos-carousel {
    position: relative;
  }

  .carousel-main {
    position: relative;
    width: 100%;
    height: 400px;
    background-color: #111827;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .carousel-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .carousel-date {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
    color: white;
    padding: 1rem;
    text-align: center;
  }

  .carousel-thumbnails {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
  }

  .thumbnail {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s;
  }

  .thumbnail:hover {
    border-color: #d1d5db;
  }

  .thumbnail.active {
    border-color: var(--primary-color, #3b82f6);
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .carousel-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
  }

  .carousel-btn {
    background-color: white;
    border: 1px solid #d1d5db;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.25rem;
    transition: background-color 0.2s;
  }

  .carousel-btn:hover {
    background-color: #f3f4f6;
  }

  .carousel-counter {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Daily Reports */
  .reports-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .report-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .report-date {
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.75rem;
    font-size: 1.125rem;
  }

  .report-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .report-field {
    color: #374151;
    line-height: 1.5;
  }

  .report-field strong {
    color: #111827;
  }

  /* T&M Tickets */
  .tm-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .tm-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .tm-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .tm-date {
    font-weight: 600;
    color: #111827;
  }

  .tm-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: capitalize;
  }

  .tm-status.status-approved {
    background-color: #d1fae5;
    color: #065f46;
  }

  .tm-status.status-pending {
    background-color: #fef3c7;
    color: #92400e;
  }

  .tm-status.status-rejected {
    background-color: #fee2e2;
    color: #991b1b;
  }

  .tm-description {
    color: #374151;
    margin-bottom: 0.5rem;
  }

  .tm-amount {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--primary-color, #3b82f6);
  }

  /* Footer */
  .public-footer {
    background-color: white;
    border-top: 1px solid #e5e7eb;
    padding: 2rem 0;
    margin-top: auto;
  }

  .public-footer p {
    text-align: center;
    color: #6b7280;
    margin: 0;
    font-size: 0.875rem;
  }

  /* Loading & Error States */
  .loading-container,
  .error-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 2rem;
  }

  .spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #e5e7eb;
    border-top-color: var(--primary-color, #3b82f6);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .loading-container p {
    margin-top: 1rem;
    color: #6b7280;
  }

  .error-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .error-container h2 {
    color: #111827;
    margin: 0 0 0.5rem 0;
  }

  .error-container p {
    color: #6b7280;
    margin: 0;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .project-header h1 {
      font-size: 1.5rem;
    }

    .public-card {
      padding: 1.5rem;
    }

    .progress-visual {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .progress-circle {
      width: 120px;
      height: 120px;
    }

    .progress-percentage {
      font-size: 1.5rem;
    }

    .carousel-main {
      height: 300px;
    }

    .area-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .area-info {
      width: 100%;
      margin-right: 0;
    }
  }
`;function Zp({onSave:r,onClose:l,slot:c=1,documentType:i="cor",documentTitle:u="",signerName:m="",signerTitle:x="",signerCompany:f=""}){const b=g.useRef(null),[p,j]=g.useState(m),[R,S]=g.useState(x),[v,H]=g.useState(f),[B,I]=g.useState(!1),[ae,G]=g.useState(!1),[O,C]=g.useState(!1),ee=c===1?"GC Authorization":"Client Authorization",me=i==="cor"?"Change Order Request":"T&M Work Order",te=()=>{const w=b.current;return w?w.getContext("2d"):null},P=w=>{const Z=b.current;if(!Z)return{x:0,y:0};const M=Z.getBoundingClientRect(),oe=Z.width/M.width,E=Z.height/M.height,U=w.touches?w.touches[0].clientX:w.clientX,de=w.touches?w.touches[0].clientY:w.clientY;return{x:(U-M.left)*oe,y:(de-M.top)*E}},V=w=>{w.preventDefault();const Z=te();if(!Z)return;const{x:M,y:oe}=P(w);Z.beginPath(),Z.moveTo(M,oe),G(!0),I(!0)},ie=w=>{if(!ae)return;w.preventDefault();const Z=te();if(!Z)return;const{x:M,y:oe}=P(w);Z.lineTo(M,oe),Z.stroke()},D=()=>{G(!1)},y=()=>{const w=b.current,Z=te();!w||!Z||(Z.clearRect(0,0,w.width,w.height),I(!1))},z=w=>{if(!w)return;b.current=w;const Z=w.getContext("2d");Z.strokeStyle="#1e293b",Z.lineWidth=2,Z.lineCap="round",Z.lineJoin="round"},L=B&&p.trim()&&O,J=()=>{if(!L)return;const w=b.current;if(!w)return;const Z=w.toDataURL("image/png");r({signature:Z,signerName:p.trim(),signerTitle:R.trim()||null,signerCompany:v.trim()||null,signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal enhanced",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"signature-header-info",children:[e.jsx("h2",{id:"signature-title",children:ee}),u&&e.jsx("span",{className:"signature-doc-ref",children:u})]}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close signature modal",children:e.jsx(za,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"signature-slot-badge",children:[e.jsx(Pi,{size:14}),e.jsxs("span",{children:["Signature ",c," of 2"]})]}),e.jsxs("div",{className:"signature-fields",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Print Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:p,onChange:w=>j(w.target.value),placeholder:"Enter your full legal name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-fields-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-title",children:"Title"}),e.jsx("input",{id:"signer-title",type:"text",value:R,onChange:w=>S(w.target.value),placeholder:"e.g., Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-company",children:"Company"}),e.jsx("input",{id:"signer-company",type:"text",value:v,onChange:w=>H(w.target.value),placeholder:"e.g., ABC Construction"})]})]})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(zd,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Draw your signature below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:z,width:500,height:180,className:"signature-canvas",onMouseDown:V,onMouseMove:ie,onMouseUp:D,onMouseLeave:D,onTouchStart:V,onTouchMove:ie,onTouchEnd:D,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!B&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:y,disabled:!B,"aria-label":"Clear signature",children:[e.jsx(bl,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("div",{className:"signature-acknowledgment",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:w=>C(w.target.checked)}),e.jsxs("span",{children:["I acknowledge that this electronic signature is legally binding and that I have reviewed and approve this ",me,". I understand that my signature, name, and IP address will be recorded for verification purposes."]})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:J,disabled:!L,"aria-label":"Submit signature",children:[e.jsx(Ta,{size:16,"aria-hidden":"true"})," Submit Signature"]})]})]})})}const Sr=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",Jp=r=>{if(!r)return"";const[l,c]=r.split(":"),i=parseInt(l),u=i>=12?"pm":"am";return`${i%12||12}:${c}${u}`},Yy=({status:r})=>{const l={draft:{label:"Draft",color:"#6b7280",bg:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bg:"#fef3c7"},approved:{label:"Approved",color:"#059669",bg:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bg:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bg:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bg:"#e5e7eb"}},c=l[r]||l.draft;return e.jsx("span",{className:"cor-status-badge",style:{color:c.color,backgroundColor:c.bg},children:c.label})};function Qy({signatureToken:r}){const[l,c]=g.useState(!0),[i,u]=g.useState(null),[m,x]=g.useState(null),[f,b]=g.useState(null),[p,j]=g.useState(!1),[R,S]=g.useState(null),[v,H]=g.useState(!1),[B,I]=g.useState(null),[ae,G]=g.useState(!1),[O,C]=g.useState([]),[ee,me]=g.useState(!1),[te,P]=g.useState(new Set);g.useEffect(()=>{V()},[r]);const V=async()=>{try{c(!0),u(null);const A=await K.getSignatureRequestByToken(r);if(!A){u("This signature link is invalid or has expired.");return}if(A.status==="completed"){u("This document has already been fully signed.");return}if(A.status==="revoked"){u("This signature link has been revoked.");return}if(A.status==="expired"){u("This signature link has expired.");return}x(A);const xe=await K.getDocumentForSigning(A.document_type,A.document_id);if(!xe){u("The document associated with this link could not be found.");return}if(b(xe),A.document_type==="cor"&&xe?.id)try{const Q=await K.getCORTickets(xe.id);C(Q||[])}catch(Q){console.warn("Failed to load backup tickets:",Q)}}catch(A){console.error("Error loading signature data:",A),u("Unable to load signature request. Please try again.")}finally{c(!1)}},ie=g.useMemo(()=>!f||m?.document_type!=="cor"?null:Yi(f),[f,m]),D=()=>{if(!m)return{slot1:null,slot2:null,availableSlots:[]};const A=m.signatures||[],xe=A.find(he=>he.signature_slot===1),Q=A.find(he=>he.signature_slot===2),Se=[];return xe||Se.push(1),Q||Se.push(2),{slot1:xe,slot2:Q,availableSlots:Se}},y=async()=>{try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return null}},z=async A=>{if(!(!m||!R))try{H(!0);const xe=await y(),Q=await K.addSignature(m.id,R,{...A,ipAddress:xe,userAgent:navigator.userAgent});await K.syncSignatureToDocument(Q,m),await V(),j(!1),S(null),I(`Signature ${R} has been recorded successfully.`),setTimeout(()=>I(null),5e3)}catch(xe){console.error("Error submitting signature:",xe),u("Failed to submit signature. Please try again.")}finally{H(!1)}},L=A=>{S(A),j(!0)},J=async()=>{if(!(!f||!m))try{G(!0);let A=null;if(E)try{A=await K.getCORTickets(f.id)}catch(Q){console.warn("Failed to fetch T&M tickets for backup:",Q)}const xe={logoUrl:U?.logo_url,primaryColor:U?.branding_color};await kf(f,de,U,xe,A),I("PDF downloaded successfully!"),setTimeout(()=>I(null),3e3)}catch(A){console.error("Download failed:",A),u("Failed to generate PDF. Please try again.")}finally{G(!1)}};if(l)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading document..."})]})});if(i)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-error",children:[e.jsx(jn,{size:48}),e.jsx("h2",{children:"Unable to Load Document"}),e.jsx("p",{children:i})]})});const{slot1:w,slot2:Z,availableSlots:M}=D(),oe=w||Z,E=m?.document_type==="cor",U=f?.projects?.companies,de=f?.projects;if(!E){const A=f.t_and_m_workers?.length||0,xe=f.t_and_m_workers?.reduce((Q,Se)=>Q+(Se.hours||0),0)||0;return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[U?.logo_url?e.jsx("img",{src:U.logo_url,alt:U.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx($i,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:U?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"T&M Ticket Signature"})]})]}),B&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(Ja,{size:18}),B]}),e.jsxs("main",{className:"signature-page-content",children:[e.jsxs("div",{className:"signature-document-card",children:[e.jsxs("div",{className:"document-card-header",children:[e.jsx(Aa,{size:20}),e.jsxs("div",{className:"document-card-title",children:[e.jsx("h2",{children:"T&M Ticket"}),e.jsx("span",{className:"document-subtitle",children:f.ce_pco_number?`CE/PCO: ${f.ce_pco_number}`:"Time & Materials"})]})]}),e.jsxs("div",{className:"document-card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Project"}),e.jsx("span",{className:"detail-value",children:de?.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Work Date"}),e.jsx("span",{className:"detail-value",children:Sr(f.work_date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Workers"}),e.jsxs("span",{className:"detail-value",children:[A," (",xe," hrs)"]})]}),f.notes&&e.jsxs("div",{className:"detail-row full-width",children:[e.jsx("span",{className:"detail-label",children:"Description"}),e.jsx("span",{className:"detail-value",children:f.notes})]})]}),f.t_and_m_workers?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Ea,{size:16})," Workers"]}),e.jsxs("table",{className:"signature-detail-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"OT"})]})}),e.jsx("tbody",{children:f.t_and_m_workers.map((Q,Se)=>e.jsxs("tr",{children:[e.jsx("td",{children:Q.name}),e.jsx("td",{children:Q.role||"Laborer"}),e.jsx("td",{children:Q.time_started&&Q.time_ended?`${Jp(Q.time_started)} - ${Jp(Q.time_ended)}`:"-"}),e.jsx("td",{children:Q.hours||0}),e.jsx("td",{children:Q.overtime_hours||"-"})]},Se))})]})]}),f.t_and_m_items?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx(vn,{size:16})," Materials & Equipment"]}),e.jsxs("table",{className:"signature-detail-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"})]})}),e.jsx("tbody",{children:f.t_and_m_items.map((Q,Se)=>e.jsxs("tr",{children:[e.jsx("td",{children:Q.custom_name||Q.materials_equipment?.name||"Item"}),e.jsx("td",{children:Q.quantity}),e.jsx("td",{children:Q.materials_equipment?.unit||"each"})]},Se))})]})]}),f.photos?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx($n,{size:16})," Photos (",f.photos.length,")"]}),e.jsx("div",{className:"signature-photo-grid",children:f.photos.map((Q,Se)=>e.jsx("div",{className:"signature-photo-thumb",children:e.jsx("img",{src:typeof Q=="string"?Q:Q.url,alt:`Photo ${Se+1}`,onError:he=>{he.target.style.display="none"}})},Se))})]})]}),e.jsxs("div",{className:"signature-status-section",children:[e.jsx("h3",{children:"Signature"}),oe?e.jsxs(e.Fragment,{children:[w&&Bi(1,w,"GC Authorization",L,v),Z&&Bi(2,Z,"Client Authorization",L,v)]}):e.jsxs(e.Fragment,{children:[Bi(1,w,"GC Authorization",L,v),!w&&e.jsx("p",{className:"or-divider",children:" or "}),Bi(2,Z,"Client Authorization",L,v)]}),oe&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Ja,{size:24}),e.jsx("p",{children:"This document has been signed."})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),p&&R&&e.jsx(Zp,{slot:R,documentType:"tm_ticket",documentTitle:"T&M Ticket",onSave:z,onClose:()=>{j(!1),S(null)}})]})}return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[U?.logo_url?e.jsx("img",{src:U.logo_url,alt:U.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx($i,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:U?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"Change Order Request"})]})]}),B&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(Ja,{size:18}),B]}),e.jsxs("main",{className:"signature-page-content cor-full-document",children:[e.jsxs("div",{className:"cor-header-card",children:[e.jsxs("div",{className:"cor-header-top",children:[e.jsxs("div",{className:"cor-title-section",children:[e.jsx("h2",{className:"cor-number",children:f.cor_number}),e.jsx(Yy,{status:f.status})]}),e.jsxs("div",{className:"cor-date",children:["Created ",Sr(f.created_at)]})]}),e.jsx("h3",{className:"cor-title",children:f.title||"Untitled Change Order"}),e.jsxs("div",{className:"cor-info-grid",children:[e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Project"}),e.jsx("span",{className:"cor-info-value",children:de?.name})]}),de?.job_number&&e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Job #"}),e.jsx("span",{className:"cor-info-value",children:de.job_number})]}),e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Period"}),e.jsx("span",{className:"cor-info-value",children:Qi(f.period_start,f.period_end)})]})]}),f.scope_of_work&&e.jsxs("div",{className:"cor-scope",children:[e.jsx("h4",{children:"Scope of Work"}),e.jsx("p",{children:f.scope_of_work})]})]}),f.change_order_labor?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Fs,{size:18}),e.jsx("h4",{children:"Labor"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{className:"text-right",children:"Reg Hrs"}),e.jsx("th",{className:"text-right",children:"Reg Rate"}),e.jsx("th",{className:"text-right",children:"OT Hrs"}),e.jsx("th",{className:"text-right",children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:f.change_order_labor.map((A,xe)=>e.jsxs("tr",{children:[e.jsx("td",{children:A.labor_class}),e.jsx("td",{children:A.wage_type}),e.jsx("td",{className:"text-right",children:A.regular_hours}),e.jsxs("td",{className:"text-right",children:["$",os(A.regular_rate),"/hr"]}),e.jsx("td",{className:"text-right",children:A.overtime_hours||"-"}),e.jsx("td",{className:"text-right",children:A.overtime_hours?`$${os(A.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:Le(A.total)})]},xe))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Le(ie.labor_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"5",className:"text-right",children:["+ ",oa(f.labor_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Le(ie.labor_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"5",className:"text-right",children:e.jsx("strong",{children:"Labor Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Le(ie.labor_subtotal+ie.labor_markup_amount)})})]})]})]})})]}),f.change_order_materials?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(vn,{size:18}),e.jsx("h4",{children:"Materials"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:f.change_order_materials.map((A,xe)=>e.jsxs("tr",{children:[e.jsx("td",{children:A.description}),e.jsx("td",{children:A.source_reference||A.source_type}),e.jsx("td",{className:"text-right",children:A.quantity}),e.jsx("td",{children:A.unit}),e.jsxs("td",{className:"text-right",children:["$",os(A.unit_cost)]}),e.jsx("td",{className:"text-right",children:Le(A.total)})]},xe))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Le(ie.materials_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",oa(f.materials_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Le(ie.materials_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Materials Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Le(ie.materials_subtotal+ie.materials_markup_amount)})})]})]})]})})]}),f.change_order_equipment?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(ds,{size:18}),e.jsx("h4",{children:"Equipment"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:f.change_order_equipment.map((A,xe)=>e.jsxs("tr",{children:[e.jsx("td",{children:A.description}),e.jsx("td",{children:A.source_reference||A.source_type}),e.jsx("td",{className:"text-right",children:A.quantity}),e.jsx("td",{children:A.unit}),e.jsxs("td",{className:"text-right",children:["$",os(A.unit_cost)]}),e.jsx("td",{className:"text-right",children:Le(A.total)})]},xe))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Le(ie.equipment_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",oa(f.equipment_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Le(ie.equipment_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Equipment Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Le(ie.equipment_subtotal+ie.equipment_markup_amount)})})]})]})]})})]}),f.change_order_subcontractors?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(_l,{size:18}),e.jsx("h4",{children:"Subcontractors"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:f.change_order_subcontractors.map((A,xe)=>e.jsxs("tr",{children:[e.jsx("td",{children:A.company_name}),e.jsx("td",{children:A.description}),e.jsx("td",{children:A.source_reference||A.source_type}),e.jsx("td",{className:"text-right",children:Le(A.total)})]},xe))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Le(ie.subcontractors_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"2",className:"text-right",children:["+ ",oa(f.subcontractors_markup_percent||500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Le(ie.subcontractors_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"2",className:"text-right",children:e.jsx("strong",{children:"Subcontractors Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Le(ie.subcontractors_subtotal+ie.subcontractors_markup_amount)})})]})]})]})})]}),O.length>0&&e.jsxs("div",{className:"cor-section cor-backup-section",children:[e.jsxs("div",{className:"cor-section-header cor-backup-header",onClick:()=>me(!ee),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"backup-header-left",children:[e.jsx(Aa,{size:18}),e.jsx("h4",{children:"Supporting T&M Documentation"}),e.jsxs("span",{className:"backup-count",children:[O.length," ticket",O.length!==1?"s":""]})]}),e.jsx("div",{className:"backup-header-toggle",children:ee?e.jsx(Da,{size:20}):e.jsx(Hs,{size:20})})]}),ee&&e.jsx("div",{className:"backup-tickets-list",children:O.map((A,xe)=>{const Q=te.has(A.id),Se=A.t_and_m_workers?.reduce((he,Oe)=>he+(parseFloat(Oe.hours)||0)+(parseFloat(Oe.overtime_hours)||0),0)||0;return e.jsxs("div",{className:"backup-ticket",children:[e.jsxs("div",{className:"backup-ticket-header",onClick:()=>{const he=new Set(te);Q?he.delete(A.id):he.add(A.id),P(he)},children:[e.jsxs("div",{className:"backup-ticket-info",children:[e.jsx("span",{className:"backup-ticket-date",children:Sr(A.work_date)}),A.ce_pco_number&&e.jsx("span",{className:"backup-ticket-ce",children:A.ce_pco_number}),e.jsxs("span",{className:"backup-ticket-summary",children:[A.t_and_m_workers?.length||0," workers  ",Se," hrs",A.photos?.length>0&&`  ${A.photos.length} photos`]})]}),e.jsx("div",{className:"backup-ticket-toggle",children:Q?e.jsx(Da,{size:16}):e.jsx(Hs,{size:16})})]}),Q&&e.jsxs("div",{className:"backup-ticket-details",children:[A.t_and_m_workers?.length>0&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsxs("div",{className:"backup-detail-label",children:[e.jsx(Ea,{size:14})," Workers"]}),e.jsx("div",{className:"backup-workers-list",children:A.t_and_m_workers.map((he,Oe)=>e.jsxs("div",{className:"backup-worker",children:[e.jsxs("span",{className:"worker-name",children:[he.role&&he.role!=="Laborer"&&e.jsx("span",{className:"worker-role",children:he.role}),he.name]}),e.jsxs("span",{className:"worker-time-hours",children:[he.time_started&&he.time_ended&&e.jsxs("span",{className:"worker-time",children:[he.time_started," - ",he.time_ended]}),e.jsxs("span",{className:"worker-hours",children:[he.hours||0," hrs",parseFloat(he.overtime_hours)>0&&e.jsxs("span",{className:"worker-ot",children:[" + ",he.overtime_hours," OT"]})]})]})]},Oe))})]}),A.notes&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsx("div",{className:"backup-detail-label",children:"Description"}),e.jsx("p",{className:"backup-notes",children:A.notes})]}),A.photos?.length>0&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsxs("div",{className:"backup-detail-label",children:[e.jsx($n,{size:14})," Photos (",A.photos.length,")"]}),e.jsx("div",{className:"backup-photos-grid",children:A.photos.map((he,Oe)=>e.jsx("a",{href:he,target:"_blank",rel:"noopener noreferrer",className:"backup-photo",children:e.jsx("img",{src:he,alt:`Photo ${Oe+1}`,onError:Be=>{Be.target.onerror=null,Be.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiI+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=="}})},Oe))})]})]})]},A.id)})}),e.jsxs("div",{className:"backup-note",children:[e.jsx(jn,{size:14}),e.jsx("span",{children:"This documentation supports the work described in this Change Order Request."})]})]}),e.jsxs("div",{className:"cor-totals-card",children:[e.jsx("h4",{children:"COR Summary"}),e.jsxs("div",{className:"cor-totals-grid",children:[e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Le(ie.cor_subtotal)})]}),e.jsxs("div",{className:"cor-fees-section",children:[e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Liability Insurance (",oa(f.liability_insurance_percent||144),")"]}),e.jsx("span",{children:Le(ie.liability_insurance_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Bond (",oa(f.bond_percent||100),")"]}),e.jsx("span",{children:Le(ie.bond_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["City License Fee (",oa(f.license_fee_percent||10),")"]}),e.jsx("span",{children:Le(ie.license_fee_amount)})]})]}),e.jsxs("div",{className:"cor-grand-total",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:Le(ie.cor_total)})]})]})]}),e.jsxs("div",{className:"cor-signature-section",children:[e.jsx("h4",{children:"Authorization"}),e.jsx("p",{className:"signature-instruction",children:"By signing below, you authorize the above change order request and agree to the terms and costs outlined."}),e.jsx("div",{className:"signature-slots-grid",children:oe?e.jsxs(e.Fragment,{children:[w&&e.jsxs("div",{className:"signature-slot-card signed",children:[e.jsxs("div",{className:"slot-header",children:[e.jsx(Ja,{size:20,className:"status-icon signed"}),e.jsx("span",{className:"slot-label",children:"GC Authorization"})]}),e.jsxs("div",{className:"slot-signed-info",children:[w.signature_data&&e.jsx("img",{src:w.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:w.signer_name}),(w.signer_title||w.signer_company)&&e.jsxs("span",{className:"signer-org",children:[w.signer_title,w.signer_title&&w.signer_company&&"  ",w.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",Sr(w.signed_at)]})]})]}),Z&&e.jsxs("div",{className:"signature-slot-card signed",children:[e.jsxs("div",{className:"slot-header",children:[e.jsx(Ja,{size:20,className:"status-icon signed"}),e.jsx("span",{className:"slot-label",children:"Client Authorization"})]}),e.jsxs("div",{className:"slot-signed-info",children:[Z.signature_data&&e.jsx("img",{src:Z.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:Z.signer_name}),(Z.signer_title||Z.signer_company)&&e.jsxs("span",{className:"signer-org",children:[Z.signer_title,Z.signer_title&&Z.signer_company&&"  ",Z.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",Sr(Z.signed_at)]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`signature-slot-card ${w?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[w?e.jsx(Ja,{size:20,className:"status-icon signed"}):e.jsx(xn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"GC Authorization"})]}),e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>L(1),disabled:v,children:"Sign as GC"})]}),e.jsx("p",{className:"or-divider",children:" or "}),e.jsxs("div",{className:`signature-slot-card ${Z?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[Z?e.jsx(Ja,{size:20,className:"status-icon signed"}):e.jsx(xn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Client Authorization"})]}),e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>L(2),disabled:v,children:"Sign as Client"})]})]})}),oe&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Ja,{size:24}),e.jsx("p",{children:"This change order request has been signed."})]}),e.jsxs("div",{className:"cor-download-section",children:[e.jsx("h4",{children:"Download Your Copy"}),e.jsx("p",{className:"download-description",children:oe?"Download a PDF copy of this fully signed COR including all T&M backup documentation.":"Download a PDF copy of this COR for your records. Signature status will be included."}),e.jsx("button",{className:"btn btn-primary download-btn",onClick:J,disabled:ae,children:ae?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"download-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pf,{size:18}),"Download COR + Backup"]})})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),p&&R&&e.jsx(Zp,{slot:R,documentType:m.document_type,documentTitle:`${f.cor_number} - ${f.title}`,onSave:z,onClose:()=>{j(!1),S(null)}})]})}function Bi(r,l,c,i,u){return e.jsxs("div",{className:`signature-slot-card ${l?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[l?e.jsx(Ja,{size:20,className:"status-icon signed"}):e.jsx(xn,{size:20,className:"status-icon pending"}),e.jsxs("span",{className:"slot-label",children:["Signature ",r,"  ",c]})]}),l?e.jsxs("div",{className:"slot-signed-info",children:[e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:l.signer_name}),(l.signer_title||l.signer_company)&&e.jsxs("span",{className:"signer-org",children:[l.signer_title,l.signer_title&&l.signer_company&&"  ",l.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",Sr(l.signed_at)]})]}):e.jsxs("button",{className:"btn btn-primary sign-btn",onClick:()=>i(r),disabled:u,children:["Sign as ",r===1?"GC":"Client"]})]})}const _d=[{value:"member",label:"Member",icon:qd,description:"Standard access to projects"},{value:"administrator",label:"Administrator",icon:Pi,description:"Full control, can manage team"}],Wp=[{value:"Project Manager",label:"Project Manager"},{value:"Superintendent",label:"Superintendent"},{value:"Job Costing",label:"Job Costing"},{value:"Accounting",label:"Accounting"}];function Xy({company:r,user:l,onShowToast:c}){const[i,u]=g.useState("pending"),[m,x]=g.useState([]),[f,b]=g.useState(!0),[p,j]=g.useState(null),[R,S]=g.useState({}),[v,H]=g.useState({});g.useEffect(()=>{r?.id&&B()},[r?.id]);const B=async()=>{try{b(!0);const D=await K.getCompanyMemberships(r.id);x(D)}catch(D){console.error("Error loading members:",D),c("Error loading team members","error")}finally{b(!1)}},I=async D=>{const y=v[D.id];if(!y){c("Please select a role for this member","error");return}try{j(D.id);const z=R[D.id]||"member";await K.approveMembershipWithRole(D.id,l.id,z),await K.updateMemberCompanyRole(D.id,y),c(`${D.users?.name||D.users?.email} approved as ${y}`,"success"),S(L=>{const J={...L};return delete J[D.id],J}),H(L=>{const J={...L};return delete J[D.id],J}),B()}catch(z){console.error("Error approving membership:",z),c("Error approving request","error")}finally{j(null)}},ae=(D,y)=>{S(z=>({...z,[D]:y}))},G=(D,y)=>{H(z=>({...z,[D]:y}))},O=async(D,y)=>{try{j(D.id),await K.updateMemberCompanyRole(D.id,y),c(`${D.users?.name||"User"} role updated to ${y}`,"success"),B()}catch(z){console.error("Error updating company role:",z),c("Error updating role","error")}finally{j(null)}},C=async(D,y)=>{if(D.users?.id===l.id&&y!=="administrator"){c("You cannot demote yourself","error");return}try{j(D.id),await K.updateMemberAccessLevel(D.id,y);const z=_d.find(L=>L.value===y)?.label||y;c(`${D.users?.name||"User"} is now ${z}`,"success"),B()}catch(z){console.error("Error updating access level:",z),c("Error updating access level","error")}finally{j(null)}},ee=async D=>{try{j(D.id),await K.rejectMembership(D.id),c("Request rejected","success"),B()}catch(y){console.error("Error rejecting membership:",y),c("Error rejecting request","error")}finally{j(null)}},me=async D=>{if(D.users?.id===l.id){c("You cannot remove yourself","error");return}try{j(D.id),await K.removeMember(D.id,l.id),c(`${D.users?.name||D.users?.email} removed`,"success"),B()}catch(y){console.error("Error removing member:",y),c("Error removing member","error")}finally{j(null)}},te=m.filter(D=>i==="all"?!0:D.status===i),P=m.filter(D=>D.status==="pending").length,V=m.filter(D=>D.status==="active").length,ie=m.filter(D=>D.status==="removed").length;return f?e.jsx("div",{className:"membership-manager",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading team members..."]})}):e.jsxs("div",{className:"membership-manager",children:[e.jsxs("div",{className:"membership-header",children:[e.jsxs("h2",{children:[e.jsx(Fs,{size:24})," Team Members"]}),e.jsxs("p",{className:"membership-subtitle",children:["Manage who has access to ",r?.name]})]}),P>0&&e.jsxs("div",{className:"pending-alert",children:[e.jsx(Er,{size:20}),e.jsxs("span",{children:[P," pending request",P>1?"s":""," awaiting approval"]})]}),e.jsxs("div",{className:"tm-filter-tabs",children:[e.jsxs("button",{className:`tm-filter-tab ${i==="pending"?"active":""}`,onClick:()=>u("pending"),children:["Pending",e.jsx("span",{className:"tm-filter-count",children:P})]}),e.jsxs("button",{className:`tm-filter-tab ${i==="active"?"active":""}`,onClick:()=>u("active"),children:["Active",e.jsx("span",{className:"tm-filter-count",children:V})]}),e.jsxs("button",{className:`tm-filter-tab ${i==="removed"?"active":""}`,onClick:()=>u("removed"),children:["Removed",e.jsx("span",{className:"tm-filter-count",children:ie})]})]}),e.jsx("div",{className:"member-list",children:te.length===0?e.jsxs("div",{className:"member-empty",children:[i==="pending"&&"No pending requests",i==="active"&&"No active members",i==="removed"&&"No removed members"]}):te.map(D=>e.jsxs("div",{className:`member-card ${D.status}`,children:[e.jsxs("div",{className:"member-info",children:[e.jsxs("div",{className:"member-name",children:[D.users?.name||"Unknown",D.users?.id===l.id&&e.jsx("span",{className:"member-you",children:"(You)"})]}),e.jsx("div",{className:"member-email",children:D.users?.email}),e.jsxs("div",{className:"member-meta",children:[D.status==="pending"&&e.jsxs(e.Fragment,{children:["Requested ",new Date(D.created_at).toLocaleDateString()]}),D.status==="active"&&D.approved_at&&e.jsxs(e.Fragment,{children:["Approved ",new Date(D.approved_at).toLocaleDateString()]}),D.status==="active"&&!D.approved_at&&e.jsxs(e.Fragment,{children:["Member since ",new Date(D.created_at).toLocaleDateString()]}),D.status==="removed"&&D.removed_at&&e.jsxs(e.Fragment,{children:["Removed ",new Date(D.removed_at).toLocaleDateString()]})]}),D.status==="active"&&e.jsxs("div",{className:"member-badges",children:[D.access_level==="administrator"?e.jsxs("span",{className:"access-badge admin",children:[e.jsx(Pi,{size:12})," Administrator"]}):e.jsxs("span",{className:"access-badge member",children:[e.jsx(qd,{size:12})," Member"]}),D.company_role&&e.jsxs("span",{className:"access-badge role",children:[e.jsx(_l,{size:12})," ",D.company_role]})]})]}),e.jsxs("div",{className:"member-actions",children:[D.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"role-selector",children:[e.jsxs("select",{value:v[D.id]||"",onChange:y=>G(D.id,y.target.value),disabled:p===D.id,className:"role-select",children:[e.jsx("option",{value:"",children:"Select Role..."}),Wp.map(y=>e.jsx("option",{value:y.value,children:y.label},y.value))]}),e.jsx(Da,{size:14,className:"role-select-icon"})]}),e.jsxs("div",{className:"role-selector",children:[e.jsx("select",{value:R[D.id]||"member",onChange:y=>ae(D.id,y.target.value),disabled:p===D.id,className:"role-select",children:_d.map(y=>e.jsx("option",{value:y.value,children:y.label},y.value))}),e.jsx(Da,{size:14,className:"role-select-icon"})]}),e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>I(D),disabled:p===D.id,children:p===D.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(yf,{size:16})," Approve"]})}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>ee(D),disabled:p===D.id,children:p===D.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(Bv,{size:16})," Reject"]})})]}),D.status==="active"&&D.users?.id!==l.id&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"role-selector",children:[e.jsxs("select",{value:D.company_role||"",onChange:y=>O(D,y.target.value),disabled:p===D.id,className:"role-select",children:[e.jsx("option",{value:"",children:"No Role"}),Wp.map(y=>e.jsx("option",{value:y.value,children:y.label},y.value))]}),e.jsx(Da,{size:14,className:"role-select-icon"})]}),e.jsxs("div",{className:"role-selector",children:[e.jsx("select",{value:D.access_level||"member",onChange:y=>C(D,y.target.value),disabled:p===D.id,className:"role-select",children:_d.map(y=>e.jsx("option",{value:y.value,children:y.label},y.value))}),e.jsx(Da,{size:14,className:"role-select-icon"})]}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>me(D),disabled:p===D.id,children:p===D.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(bf,{size:16})," Remove"]})})]})]})]},D.id))})]})}function Iy({company:r,projects:l,userId:c,onNotificationClick:i,onShowToast:u}){const[m,x]=g.useState([]),[f,b]=g.useState(0),[p,j]=g.useState(!1),[R,S]=g.useState(!1),[v,H]=g.useState({}),B=g.useRef(null);g.useRef(null);const I=g.useRef(null);g.useEffect(()=>{c&&ae()},[c]);const ae=async()=>{try{const y=await K.getUserNotificationPreferences(c),z={};y.forEach(L=>{z[L.project_id]=L.notification_types||[]}),H(z)}catch(y){console.error("Error loading user preferences:",y)}},G=(y,z)=>v[y]?v[y].length===0?!1:v[y].includes(z):!0;g.useEffect(()=>{if(!r?.id||!l||l.length===0)return;O();const y=C();return()=>{y&&K.unsubscribe(y)}},[r?.id,l,v]),g.useEffect(()=>()=>{I.current&&(I.current.close().catch(()=>{}),I.current=null)},[]),g.useEffect(()=>{function y(z){B.current&&!B.current.contains(z.target)&&j(!1)}return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[]);const O=async()=>{if(!l||l.length===0)return;const y=[];for(const z of l)try{G(z.id,"message")&&(await K.getMessages(z.id,20)).filter(w=>w.sender_type==="field"&&!w.is_read).forEach(w=>{y.push({id:`msg-${w.id}`,type:"message",title:"New Message",message:w.message?.slice(0,50)+(w.message?.length>50?"...":""),projectId:z.id,projectName:z.name,senderName:w.sender_name,createdAt:w.created_at,isRead:w.is_read,data:w})}),G(z.id,"material_request")&&(await K.getMaterialRequests(z.id,"pending")).forEach(J=>{y.push({id:`req-${J.id}`,type:"material_request",title:"Material Request",message:`${J.items?.length||0} items requested`,projectId:z.id,projectName:z.name,senderName:J.requested_by,priority:J.priority,createdAt:J.created_at,isRead:!1,data:J})})}catch(L){console.error("Error loading notifications for project:",z.id,L)}try{(await K.getCompanyInjuryReports(r.id,"open")).slice(0,5).forEach(L=>{if(G(L.project_id,"injury_report")){const J=l.find(w=>w.id===L.project_id);y.push({id:`injury-${L.id}`,type:"injury_report",title:"Safety Report",message:`${L.injury_type} - ${L.injured_person_name}`,projectId:L.project_id,projectName:J?.name||"Unknown Project",senderName:L.reported_by_name,createdAt:L.created_at,isRead:L.status!=="open",data:L})}})}catch(z){console.error("Error loading injury reports:",z)}y.sort((z,L)=>new Date(L.createdAt)-new Date(z.createdAt)),x(y.slice(0,50)),b(y.filter(z=>!z.isRead).length)},C=()=>{if(!r?.id||!l||l.length===0)return null;const y=l.map(L=>L.id),z=K.subscribeToCompanyActivity(r.id,y,{onMessage:L=>{if(L.new?.sender_type==="field"){if(!G(L.new.project_id,"message"))return;ee({id:`msg-${L.new.id}`,type:"message",title:"New Message",message:L.new.message?.slice(0,50)+(L.new.message?.length>50?"...":""),projectId:L.new.project_id,projectName:l.find(J=>J.id===L.new.project_id)?.name||"Project",senderName:L.new.sender_name,createdAt:L.new.created_at,isRead:!1,data:L.new})}},onMaterialRequest:L=>{G(L.new.project_id,"material_request")&&ee({id:`req-${L.new.id}`,type:"material_request",title:"Material Request",message:`${L.new.items?.length||0} items requested`,projectId:L.new.project_id,projectName:l.find(J=>J.id===L.new.project_id)?.name||"Project",senderName:L.new.requested_by,priority:L.new.priority,createdAt:L.new.created_at,isRead:!1,data:L.new})},onTMTicket:L=>{if(L.eventType==="INSERT"){if(!G(L.new.project_id,"tm_ticket"))return;ee({id:`tm-${L.new.id}`,type:"tm_ticket",title:"New T&M Ticket",message:`Submitted by ${L.new.created_by_name||"Field"}`,projectId:L.new.project_id,projectName:l.find(J=>J.id===L.new.project_id)?.name||"Project",senderName:L.new.created_by_name,createdAt:L.new.created_at,isRead:!1,data:L.new})}},onInjuryReport:L=>{G(L.new.project_id,"injury_report")&&ee({id:`injury-${L.new.id}`,type:"injury_report",title:"Safety Report",message:`${L.new.injury_type} - ${L.new.injured_person_name}`,projectId:L.new.project_id,projectName:l.find(J=>J.id===L.new.project_id)?.name||"Project",senderName:L.new.reported_by_name,createdAt:L.new.created_at,isRead:!1,data:L.new})}});return z&&S(!0),z},ee=y=>{x(L=>[y,...L.slice(0,49)]),b(L=>L+1),me();const z=te(y.type);u?.(`${z} ${y.title}: ${y.message}`,"info")},me=()=>{try{(!I.current||I.current.state==="closed")&&(I.current=new(window.AudioContext||window.webkitAudioContext));const y=I.current;y.state==="suspended"&&y.resume();const z=y.createOscillator(),L=y.createGain();z.connect(L),L.connect(y.destination),z.frequency.value=800,z.type="sine",L.gain.value=.3,z.start(),z.stop(y.currentTime+.15),setTimeout(()=>{if(!I.current||I.current.state==="closed")return;const J=I.current.createOscillator(),w=I.current.createGain();J.connect(w),w.connect(I.current.destination),J.frequency.value=1e3,J.type="sine",w.gain.value=.3,J.start(),J.stop(I.current.currentTime+.15)},150)}catch{}},te=y=>{switch(y){case"message":return e.jsx(gf,{size:16});case"material_request":return e.jsx(vn,{size:16});case"injury_report":return e.jsx(jn,{size:16});case"tm_ticket":return e.jsx(cs,{size:16});default:return e.jsx(mj,{size:16})}},P=y=>{switch(y){case"message":return"blue";case"material_request":return"orange";case"injury_report":return"red";case"tm_ticket":return"green";default:return"gray"}},V=y=>{x(z=>z.map(L=>L.id===y.id?{...L,isRead:!0}:L)),b(z=>Math.max(0,z-1)),j(!1),i?.(y)},ie=async()=>{for(const y of l)try{await K.markMessagesRead(y.id,"office")}catch{}x(y=>y.map(z=>({...z,isRead:!0}))),b(0)},D=y=>{const z=new Date(y),J=new Date-z,w=Math.floor(J/6e4),Z=Math.floor(J/36e5),M=Math.floor(J/864e5);return w<1?"Just now":w<60?`${w}m ago`:Z<24?`${Z}h ago`:M<7?`${M}d ago`:z.toLocaleDateString()};return e.jsxs("div",{className:"notification-center",ref:B,children:[e.jsxs("button",{className:`notification-bell ${f>0?"has-notifications":""}`,onClick:()=>j(!p),title:`${f} unread notifications`,children:[e.jsx("span",{className:"bell-icon",children:""}),f>0&&e.jsx("span",{className:"notification-badge",children:f>99?"99+":f}),R&&e.jsx("span",{className:"connection-dot"})]}),p&&e.jsxs("div",{className:"notification-dropdown",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h4",{children:"Notifications"}),f>0&&e.jsx("button",{className:"mark-all-read",onClick:ie,children:"Mark all read"})]}),e.jsx("div",{className:"notification-list",children:m.length===0?e.jsxs("div",{className:"notification-empty",children:[e.jsx("span",{className:"empty-icon",children:""}),e.jsx("p",{children:"No notifications yet"}),e.jsx("small",{children:"You'll see updates from the field here"})]}):m.map(y=>e.jsxs("div",{className:`notification-item ${y.isRead?"read":"unread"} ${P(y.type)}`,onClick:()=>V(y),children:[e.jsx("div",{className:"notification-icon",children:te(y.type)}),e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"notification-title",children:[y.title,y.priority==="urgent"&&e.jsx("span",{className:"priority-badge urgent",children:"URGENT"})]}),e.jsx("div",{className:"notification-message",children:y.message}),e.jsxs("div",{className:"notification-meta",children:[e.jsx("span",{className:"notification-project",children:y.projectName}),e.jsx("span",{className:"notification-time",children:D(y.createdAt)})]})]}),!y.isRead&&e.jsx("div",{className:"unread-dot"})]},y.id))}),m.length>0&&e.jsx("div",{className:"notification-footer",children:e.jsx("button",{className:"view-all-btn",onClick:()=>{j(!1),i?.({type:"view_all"})},children:"View All Activity"})})]})]})}class Nr extends g.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0}}componentDidCatch(l,c){this.setState({error:l,errorInfo:c}),console.error("ErrorBoundary caught an error:",l,c)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("div",{className:"error-icon",children:e.jsx(Er,{size:48})}),e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),e.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function Kp(){const[r,l]=g.useState(vl()),[c,i]=g.useState(0),[u,m]=g.useState(!1),[x,f]=g.useState(!1);return g.useEffect(()=>{const b=lf(async j=>{l(j),j&&x&&(m(!0),setTimeout(()=>m(!1),3e3)),j||f(!0);const R=await rd();i(R)});rd().then(i);const p=setInterval(async()=>{if(!vl()){const j=await rd();i(j)}},5e3);return()=>{b(),clearInterval(p)}},[x]),r&&c===0&&!u?null:e.jsxs("div",{className:`offline-indicator ${r?"online":"offline"} ${u?"synced":""}`,children:[e.jsx("div",{className:"offline-indicator-content",children:r?u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"online-icon",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):c>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"syncing-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),e.jsxs("span",{className:"offline-text",children:["Syncing ",c,"..."]})]}):null:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"offline-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),e.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),e.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),e.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),e.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),e.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),e.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),e.jsxs("span",{className:"offline-text",children:["Offline",c>0&&e.jsxs("span",{className:"pending-badge",children:[c," pending"]})]})]})}),e.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function Zy(){const[r,l]=g.useState("entry"),[c,i]=g.useState(null),[u,m]=g.useState(null),[x,f]=g.useState([]),[b,p]=g.useState([]),[j,R]=g.useState(null),[S,v]=g.useState(null),[H,B]=g.useState(null),[I,ae]=g.useState(!0),[G,O]=g.useState("dashboard"),[C,ee]=g.useState(null),[me,te]=g.useState(!1),[P,V]=g.useState(null),[ie,D]=g.useState(0);g.useEffect(()=>{const he=window.location.pathname,Oe=he.match(/^\/view\/([a-zA-Z0-9_-]+)$/),Be=he.match(/^\/sign\/([a-zA-Z0-9_-]+)$/);Oe?(v(Oe[1]),l("public"),ae(!1)):Be?(B(Be[1]),l("signature"),ae(!1)):y()},[]);const y=async()=>{try{const{data:{user:he}}=await k.auth.getUser();if(!he){ae(!1);return}const{data:Oe,error:Be}=await k.from("users").select("*").eq("id",he.id).single();if(Oe){i(Oe);let Re=await K.getUserCompanies(he.id);if(Re.length===0&&Oe.company_id&&(console.log("Legacy user detected, attempting repair..."),await K.repairLegacyUser(he.id,Oe.company_id,Oe.role||"member")&&(Re=await K.getUserCompanies(he.id),console.log("Legacy user repaired, companies:",Re.length))),f(Re),Re.length===0){if(await K.getUserPendingMemberships(he.id)>0){l("pending");return}M("No company access. Join a company to continue.","error"),await Tp.signOut();return}const ze=localStorage.getItem("selectedCompanyId");let pt=null;if(ze&&Re.find(rt=>rt.id===ze)?pt=Re.find(rt=>rt.id===ze):Re.length>0&&(pt=Re[0]),pt){const{data:rt}=await k.from("companies").select("*").eq("id",pt.id).single();m(rt),l("office")}}}catch(he){console.error("Auth check error:",he)}finally{ae(!1)}},z=he=>{R(he),l("foreman")},L=async(he,Oe)=>{try{const{data:Be,error:Re}=await k.auth.signInWithPassword({email:he,password:Oe});if(Re){M(Re.message||"Invalid credentials","error");return}const{data:ze,error:pt}=await k.from("users").select("*").eq("id",Be.user.id).single();if(pt){console.error("User fetch error:",pt),M("Error loading profile","error");return}if(ze){i(ze);let rt=await K.getUserCompanies(Be.user.id);rt.length===0&&ze.company_id&&(console.log("Legacy user detected on login, attempting repair..."),await K.repairLegacyUser(Be.user.id,ze.company_id,ze.role||"member")&&(rt=await K.getUserCompanies(Be.user.id),console.log("Legacy user repaired on login, companies:",rt.length))),f(rt);const se=localStorage.getItem("selectedCompanyId");let Ae=null;if(se&&rt.find(Ye=>Ye.id===se)?Ae=rt.find(Ye=>Ye.id===se):rt.length>0&&(Ae=rt[0]),Ae){const{data:Ye}=await k.from("companies").select("*").eq("id",Ae.id).single();m(Ye),l("office")}else await K.getUserPendingMemberships(Be.user.id)>0?l("pending"):M("No company access. Please contact admin.","error")}else M("Profile not found. Please contact admin.","error")}catch(Be){console.error("Login error:",Be),M("Login failed","error")}},J=async he=>{try{const{data:Oe}=await k.from("companies").select("*").eq("id",he).single();Oe&&(m(Oe),localStorage.setItem("selectedCompanyId",he),te(!1),O("dashboard"),M(`Switched to ${Oe.name}`,"success"))}catch(Oe){console.error("Switch company error:",Oe),M("Error switching company","error")}},w=async()=>{try{await Tp.signOut(),i(null),m(null),f([]),l("entry"),O("dashboard"),localStorage.removeItem("selectedCompanyId")}catch(he){console.error("Logout error:",he),M("Error signing out","error")}},Z=()=>{R(null),l("entry")},M=(he,Oe="")=>{ee({message:he,type:Oe})},oe=()=>{O("dashboard"),u?.id&&E()},E=async()=>{if(u?.id)try{const he=await K.getProjects(u.id);p(he)}catch(he){console.error("Error loading projects:",he)}};g.useEffect(()=>{u?.id&&r==="office"&&(E(),U())},[u?.id,r]);const U=async()=>{if(u?.id)try{const Oe=(await K.getCompanyMemberships(u.id)).filter(Be=>Be.status==="pending").length;D(Oe)}catch(he){console.error("Error loading pending count:",he)}},de=he=>{if(he.type==="view_all"){O("dashboard"),V(null);return}O("dashboard"),he.projectId&&V(he.projectId)},A=()=>{V(null)};if(I)return e.jsx(Ln,{children:e.jsx(qn,{companyId:u?.id,children:e.jsxs("div",{className:"loading-screen",children:[e.jsx(ps,{className:"loading-logo"}),e.jsx("div",{className:"spinner"})]})})});if(r==="entry")return e.jsx(Ln,{children:e.jsxs(qn,{children:[e.jsx(Nr,{children:e.jsx(Qv,{onForemanAccess:z,onOfficeLogin:L,onShowToast:M})}),C&&e.jsx(Ls,{message:C.message,type:C.type,onClose:()=>ee(null)})]})});if(r==="public"&&S)return e.jsx(Ln,{children:e.jsxs(qn,{children:[e.jsx(Nr,{children:e.jsx(Py,{shareToken:S})}),C&&e.jsx(Ls,{message:C.message,type:C.type,onClose:()=>ee(null)})]})});if(r==="signature"&&H)return e.jsx(Ln,{children:e.jsxs(qn,{children:[e.jsx(Nr,{children:e.jsx(Qy,{signatureToken:H})}),C&&e.jsx(Ls,{message:C.message,type:C.type,onClose:()=>ee(null)})]})});if(r==="pending")return e.jsx(Ln,{children:e.jsxs(qn,{children:[e.jsx(Nr,{children:e.jsxs("div",{className:"pending-approval-screen",children:[e.jsx(ps,{className:"pending-logo"}),e.jsx("h2",{children:"Awaiting Approval"}),e.jsx("p",{children:"Your membership request has been submitted."}),e.jsx("p",{children:"A company admin will review your request."}),e.jsxs("div",{className:"pending-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:w,children:"Sign Out"}),e.jsx("button",{className:"btn btn-primary",onClick:y,children:"Check Status"})]})]})}),C&&e.jsx(Ls,{message:C.message,type:C.type,onClose:()=>ee(null)})]})});if(r==="foreman"&&j)return e.jsx(Ln,{children:e.jsxs(qn,{companyId:j.company_id,children:[e.jsx(Nr,{children:e.jsx(ry,{project:j,companyId:j.company_id,onShowToast:M,onExit:Z})}),e.jsx(Kp,{}),C&&e.jsx(Ls,{message:C.message,type:C.type,onClose:()=>ee(null)})]})});const Se=x.find(he=>he.id===u?.id)?.access_level==="administrator"||u?.owner_user_id===c?.id;return e.jsx(Ln,{children:e.jsx(qn,{companyId:u?.id,children:e.jsxs("div",{children:[!$&&e.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),e.jsx("nav",{className:"nav",children:e.jsxs("div",{className:"nav-content",children:[e.jsx(ps,{}),e.jsxs("div",{className:"nav-tabs",children:[e.jsx("button",{className:`nav-tab ${G==="dashboard"?"active":""}`,onClick:()=>O("dashboard"),children:"Dashboard"}),e.jsx("button",{className:`nav-tab ${G==="setup"?"active":""}`,onClick:()=>O("setup"),children:"+ New Project"}),e.jsx("button",{className:`nav-tab ${G==="pricing"?"active":""}`,onClick:()=>O("pricing"),children:"Pricing"}),Se&&e.jsx("button",{className:`nav-tab ${G==="branding"?"active":""}`,onClick:()=>O("branding"),children:"Branding"}),Se&&e.jsxs("button",{className:`nav-tab ${G==="team"?"active":""}`,onClick:()=>O("team"),children:["Team",ie>0&&e.jsx("span",{className:"nav-tab-badge",children:ie})]})]}),e.jsxs("div",{className:"nav-user",children:[e.jsx(wf,{compact:!0}),e.jsx(Iy,{company:u,projects:b,userId:c?.id,onNotificationClick:de,onShowToast:M}),x.length>1&&e.jsxs("div",{className:"company-switcher",children:[e.jsxs("button",{className:"company-switcher-btn",onClick:()=>te(!me),children:[u?.name||"Select Company",e.jsx("span",{className:"switcher-arrow",children:""})]}),me&&e.jsx("div",{className:"company-dropdown",children:x.map(he=>e.jsxs("button",{className:`company-option ${he.id===u?.id?"active":""}`,onClick:()=>J(he.id),children:[he.name,he.id===u?.id&&e.jsx("span",{className:"check",children:""})]},he.id))})]}),x.length<=1&&u&&e.jsx("span",{className:"nav-company-name",children:u.name}),e.jsx("span",{className:"nav-user-name",children:c?.name||c?.email}),e.jsx("button",{className:"nav-logout",onClick:w,children:"Sign Out"})]})]})}),e.jsx(Nr,{children:e.jsxs("div",{className:"container",children:[G==="dashboard"&&e.jsx(Ry,{company:u,user:c,isAdmin:Se,onShowToast:M,navigateToProjectId:P,onProjectNavigated:A}),G==="setup"&&e.jsx(Ly,{company:u,user:c,onProjectCreated:oe,onShowToast:M}),G==="pricing"&&e.jsx(Gy,{company:u,onShowToast:M}),G==="branding"&&e.jsx(Uy,{company:u,onShowToast:M}),G==="team"&&Se&&e.jsx(Xy,{company:u,user:c,onShowToast:M})]},u?.id)}),e.jsx(Kp,{}),C&&e.jsx(Ls,{message:C.message,type:C.type,onClose:()=>ee(null)})]})})})}Px.createRoot(document.getElementById("root")).render(e.jsx(Hx.StrictMode,{children:e.jsx(Zy,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(r=>{console.log("SW registered:",r.scope),setInterval(()=>{r.update()},6e4)}).catch(r=>{console.log("SW registration failed:",r)})});
