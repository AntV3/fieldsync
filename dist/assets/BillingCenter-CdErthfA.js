import{as as e,ar as R}from"./index-DffI6H_y.js";import{r as d,L as te,ag as q,X as re,n as ee,F as Y,a8 as ce,j as se,s as de,Q as me,a as ne,h as oe,az as ae,D as Z,aH as ue}from"./icons-B-oSmWeD.js";import{f as v,h as he}from"./corCalculations-D9qkkIbo.js";import{_ as le}from"./pdf-aQqpMATS.js";import"./react-DXGY7bZi.js";import"./supabase-VuevzHjS.js";async function xe(l,g,y){const{default:i}=await le(async()=>{const{default:u}=await import("./pdf-aQqpMATS.js").then(j=>j.j);return{default:u}},[]),{default:m}=await le(async()=>{const{default:u}=await import("./pdf-aQqpMATS.js").then(j=>j.c);return{default:u}},[]),t=new i("portrait"),w=t.internal.pageSize.width,B=t.internal.pageSize.height,x=20,N=[33,33,33],p=[59,130,246],k=[156,163,175],E=[229,231,235];let r=x;t.setFontSize(18),t.setFont(void 0,"bold"),t.setTextColor(...N),t.text(y?.name||"Company Name",x,r),t.setFontSize(9),t.setFont(void 0,"normal"),t.setTextColor(...k);const $=[];y?.phone&&$.push(y.phone),y?.email&&$.push(y.email),y?.address&&$.push(y.address);let O=r;$.forEach(u=>{t.text(u,w-x,O,{align:"right"}),O+=4}),r+=15,t.setFontSize(28),t.setFont(void 0,"bold"),t.setTextColor(...p),t.text("INVOICE",x,r),r+=15,t.setFontSize(10),t.setFont(void 0,"normal"),t.setTextColor(...N);const F=[["Invoice #:",l.invoice_number],["Invoice Date:",ie(l.invoice_date)],["Due Date:",l.due_date?ie(l.due_date):"Upon Receipt"],["Terms:",l.terms||"Net 30"]];let D=r;F.forEach(([u,j])=>{t.setFont(void 0,"bold"),t.text(u,x,D),t.setFont(void 0,"normal"),t.text(j,x+30,D),D+=5});const o=w/2;t.setFont(void 0,"bold"),t.setTextColor(...k),t.text("BILL TO",o,r),t.setFont(void 0,"normal"),t.setTextColor(...N);let f=r+5;l.bill_to_name&&(t.text(l.bill_to_name,o,f),f+=4),l.bill_to_address&&t.splitTextToSize(l.bill_to_address,80).forEach(j=>{t.text(j,o,f),f+=4}),l.bill_to_contact&&t.text(l.bill_to_contact,o,f),r=Math.max(D,f)+10,t.setFontSize(9),t.setTextColor(...k),t.text(`Project: ${g.name}${g.job_number?` (Job #${g.job_number})`:""}`,x,r),r+=10;const M=(l.invoice_items||[]).map((u,j)=>[j+1,u.reference_number||"-",u.description,v(u.amount)]);m(t,{startY:r,head:[["#","Ref","Description","Amount"]],body:M,theme:"plain",styles:{fontSize:9,cellPadding:4,textColor:N,lineColor:E,lineWidth:.1},headStyles:{fillColor:[249,250,251],textColor:N,fontStyle:"bold",lineWidth:{bottom:.5},lineColor:E},columnStyles:{0:{cellWidth:12,halign:"center"},1:{cellWidth:25},2:{cellWidth:"auto"},3:{cellWidth:30,halign:"right"}},alternateRowStyles:{fillColor:[255,255,255]},margin:{left:x,right:x}}),r=t.lastAutoTable.finalY+10;const P=w-x-80,_=w-x;if(t.setFontSize(10),t.setFont(void 0,"normal"),t.setTextColor(...N),t.text("Subtotal",P,r),t.text(v(l.subtotal),_,r,{align:"right"}),r+=6,l.retention_percent>0){const u=l.retention_percent/100;t.text(`Retention (${u}%)`,P,r),t.setTextColor(220,38,38),t.text(`-${v(l.retention_amount)}`,_,r,{align:"right"}),t.setTextColor(...N),r+=6}t.setDrawColor(...E),t.setLineWidth(.5),t.line(P-5,r,_,r),r+=6,t.setFontSize(12),t.setFont(void 0,"bold"),t.text("Total Due",P,r),t.setTextColor(...p),t.text(v(l.total),_,r,{align:"right"}),r+=15,l.notes&&(t.setFontSize(9),t.setFont(void 0,"bold"),t.setTextColor(...k),t.text("Notes:",x,r),r+=5,t.setFont(void 0,"normal"),t.setTextColor(...N),t.splitTextToSize(l.notes,w-x*2).forEach(j=>{t.text(j,x,r),r+=4}));const T=B-15;return t.setFontSize(8),t.setTextColor(...k),t.text(`Invoice ${l.invoice_number} | Generated ${new Date().toLocaleDateString()}`,w/2,T,{align:"center"}),t}async function be(l,g,y){const i=await xe(l,g,y),m=`Invoice_${l.invoice_number}_${g.job_number||g.name.replace(/\s+/g,"_")}.pdf`;return i.save(m),m}function ie(l){return l?new Date(l).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):""}function pe({project:l,company:g,user:y,selectedItems:i={cors:[],tickets:[]},onClose:m,onSuccess:t}){const[w,B]=d.useState(!0),[x,N]=d.useState(!1),[p,k]=d.useState(""),[E,r]=d.useState(new Date().toISOString().split("T")[0]),[$,O]=d.useState(""),[F,D]=d.useState(0),[o,f]=d.useState(""),[M,P]=d.useState("Net 30"),[_,T]=d.useState([]),[u,j]=d.useState({});d.useEffect(()=>{(async()=>{try{const a=new Date;a.setDate(a.getDate()+30),O(a.toISOString().split("T")[0]);const b=await R.getNextInvoiceNumber(g.id);k(b)}catch(a){console.error("Error initializing invoice:",a)}finally{B(!1)}})()},[g.id]);const z=d.useMemo(()=>{const n=[];return i.cors.forEach(a=>{n.push({id:a.id,item_type:"cor",reference_id:a.id,reference_number:a.cor_number,description:`COR ${a.cor_number}: ${a.title||"Change Order"}`,amount:a.cor_total||0})}),i.tickets.forEach(a=>{n.push({id:a.id,item_type:"tm_ticket",reference_id:a.id,reference_number:a.ce_pco_number||null,description:`T&M Ticket - ${new Date(a.work_date).toLocaleDateString()}`,amount:(parseFloat(a.change_order_value)||0)*100})}),_.forEach((a,b)=>{n.push({id:`manual-${b}`,item_type:"manual",reference_id:null,reference_number:null,description:a.description,amount:he(parseFloat(a.amount)||0)})}),n},[i,_]),W=d.useMemo(()=>{const n=z.reduce((L,S)=>L+S.amount,0),a=Math.round(n*F/100),b=n-a;return{subtotal:n,retentionAmount:a,total:b}},[z,F]),X=()=>{T(n=>[...n,{description:"",amount:""}])},V=(n,a,b)=>{T(L=>{const S=[...L];return S[n]={...S[n],[a]:b},S})},G=n=>{T(a=>a.filter((b,L)=>L!==n))},H=()=>{const n={};return p.trim()||(n.invoiceNumber="Invoice number is required"),E||(n.invoiceDate="Invoice date is required"),z.length===0&&(n.items="At least one line item is required"),_.forEach((a,b)=>{a.description.trim()||(n[`manual-${b}-desc`]="Description required"),(!a.amount||parseFloat(a.amount)<=0)&&(n[`manual-${b}-amount`]="Valid amount required")}),j(n),Object.keys(n).length===0},J=async()=>{if(H()){N(!0);try{const n={project_id:l.id,company_id:g.id,invoice_number:p,invoice_date:E,due_date:$||null,status:"draft",retention_percent:F*100,bill_to_name:l.general_contractor||"",bill_to_address:l.address||"",notes:o||null,terms:M||"Net 30",created_by:y?.id},a=z.map(C=>({item_type:C.item_type,reference_id:C.item_type!=="manual"?C.reference_id:null,reference_number:C.reference_number,description:C.description,amount:C.amount})),b=await R.createInvoice(n,a),L=i.cors.map(C=>C.id),S=i.tickets.map(C=>C.id);await R.markItemsBilled(L,S),t?.(b)}catch(n){console.error("Error creating invoice:",n),j({submit:"Failed to create invoice. Please try again."})}finally{N(!1)}}};return w?e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"modal-content invoice-modal",children:e.jsxs("div",{className:"invoice-loading",children:[e.jsx(te,{size:24,className:"spinning"}),e.jsx("span",{children:"Loading..."})]})})}):e.jsx("div",{className:"modal-overlay",onClick:m,children:e.jsxs("div",{className:"modal-content invoice-modal",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(q,{size:20}),"Create Invoice"]}),e.jsx("button",{className:"close-btn",onClick:m,"aria-label":"Close",children:e.jsx(re,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"invoice-header-fields",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"invoice-number",children:"Invoice Number *"}),e.jsx("input",{id:"invoice-number",type:"text",value:p,onChange:n=>k(n.target.value),className:u.invoiceNumber?"error":""}),u.invoiceNumber&&e.jsx("span",{className:"form-error",children:u.invoiceNumber})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"invoice-date",children:"Invoice Date *"}),e.jsx("input",{id:"invoice-date",type:"date",value:E,onChange:n=>r(n.target.value),className:u.invoiceDate?"error":""})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"due-date",children:"Due Date"}),e.jsx("input",{id:"due-date",type:"date",value:$,onChange:n=>O(n.target.value)})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"bill-to",children:"Bill To"}),e.jsx("input",{id:"bill-to",type:"text",value:l.general_contractor||"",disabled:!0,className:"disabled"})]}),e.jsxs("div",{className:"form-group retention-group",children:[e.jsx("label",{htmlFor:"retention",children:"Retention %"}),e.jsxs("div",{className:"input-with-suffix",children:[e.jsx("input",{id:"retention",type:"number",min:"0",max:"100",step:"0.5",value:F,onChange:n=>D(parseFloat(n.target.value)||0)}),e.jsx("span",{className:"input-suffix",children:"%"})]})]})]})]}),e.jsxs("div",{className:"invoice-line-items",children:[e.jsxs("div",{className:"line-items-header",children:[e.jsx("h4",{children:"Line Items"}),e.jsxs("button",{type:"button",className:"btn btn-text btn-sm",onClick:X,children:[e.jsx(ee,{size:14}),"Add Item"]})]}),u.items&&e.jsx("div",{className:"form-error",children:u.items}),e.jsxs("div",{className:"line-items-table",children:[e.jsxs("div",{className:"line-items-table-header",children:[e.jsx("span",{className:"col-type",children:"Type"}),e.jsx("span",{className:"col-desc",children:"Description"}),e.jsx("span",{className:"col-amount",children:"Amount"}),e.jsx("span",{className:"col-action"})]}),z.map((n,a)=>e.jsxs("div",{className:"line-item-row",children:[e.jsxs("span",{className:"col-type",children:[n.item_type==="cor"&&e.jsx(Y,{size:14}),n.item_type==="tm_ticket"&&e.jsx(Y,{size:14}),n.item_type==="manual"&&e.jsx(ee,{size:14}),n.item_type==="cor"?"COR":n.item_type==="tm_ticket"?"T&M":"Manual"]}),n.item_type==="manual"?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:`col-desc ${u[`manual-${a-i.cors.length-i.tickets.length}-desc`]?"error":""}`,value:_[a-i.cors.length-i.tickets.length]?.description||"",onChange:b=>V(a-i.cors.length-i.tickets.length,"description",b.target.value),placeholder:"Description"}),e.jsxs("div",{className:"col-amount",children:[e.jsx("span",{className:"currency-prefix",children:"$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:u[`manual-${a-i.cors.length-i.tickets.length}-amount`]?"error":"",value:_[a-i.cors.length-i.tickets.length]?.amount||"",onChange:b=>V(a-i.cors.length-i.tickets.length,"amount",b.target.value),placeholder:"0.00"})]}),e.jsx("button",{type:"button",className:"btn btn-icon btn-ghost col-action",onClick:()=>G(a-i.cors.length-i.tickets.length),children:e.jsx(ce,{size:14})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"col-desc",children:n.description}),e.jsx("span",{className:"col-amount",children:v(n.amount)}),e.jsx("span",{className:"col-action"})]})]},n.id))]}),e.jsxs("div",{className:"invoice-totals",children:[e.jsxs("div",{className:"total-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:v(W.subtotal)})]}),F>0&&e.jsxs("div",{className:"total-row retention",children:[e.jsxs("span",{children:["Retention (",F,"%)"]}),e.jsxs("span",{children:["-",v(W.retentionAmount)]})]}),e.jsxs("div",{className:"total-row grand-total",children:[e.jsx("span",{children:"Total Due"}),e.jsx("span",{children:v(W.total)})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group flex-2",children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",value:o,onChange:n=>f(n.target.value),rows:2,placeholder:"Additional notes for the client..."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"terms",children:"Payment Terms"}),e.jsxs("select",{id:"terms",value:M,onChange:n=>P(n.target.value),children:[e.jsx("option",{value:"Due on Receipt",children:"Due on Receipt"}),e.jsx("option",{value:"Net 15",children:"Net 15"}),e.jsx("option",{value:"Net 30",children:"Net 30"}),e.jsx("option",{value:"Net 45",children:"Net 45"}),e.jsx("option",{value:"Net 60",children:"Net 60"})]})]})]}),u.submit&&e.jsx("div",{className:"form-error submit-error",children:u.submit})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:m,disabled:x,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:J,disabled:x||z.length===0,children:x?e.jsxs(e.Fragment,{children:[e.jsx(te,{size:16,className:"spinning"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{size:16}),"Create Invoice"]})})]})]})})}const U={draft:{label:"Draft",icon:Y,className:"status-draft"},sent:{label:"Sent",icon:oe,className:"status-sent"},partial:{label:"Partial",icon:ne,className:"status-partial"},paid:{label:"Paid",icon:se,className:"status-paid"},void:{label:"Void",icon:ne,className:"status-void"}};function Ce({project:l,company:g,user:y,onShowToast:i}){const[m,t]=d.useState({cors:[],tickets:[]}),[w,B]=d.useState([]),[x,N]=d.useState(!0),[p,k]=d.useState({cors:new Set,tickets:new Set}),[E,r]=d.useState(!1),[$,O]=d.useState(null),[F,D]=d.useState(null),[o,f]=d.useState(null),[M,P]=d.useState(!1),_=d.useRef(null);d.useEffect(()=>{T()},[l.id]);const T=async()=>{try{N(!0);const[s,c]=await Promise.all([R.getBillableItems(l.id),R.getProjectInvoices(l.id)]);t(s),B(c)}catch(s){console.error("Error loading billing data:",s),i?.("Error loading billing data","error")}finally{N(!1)}};d.useEffect(()=>{const s=c=>{_.current&&!_.current.contains(c.target)&&D(null)};if(F)return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[F]);const u=d.useCallback((s,c)=>{c.stopPropagation(),D(h=>h===s?null:s)},[]),j=d.useCallback(async s=>{D(null);try{const c=await R.getInvoice(s.id);f(c)}catch(c){console.error("Error fetching invoice:",c),i?.("Error loading invoice details","error")}},[]),z=d.useCallback(async s=>{D(null),P(!0);try{const c=await R.getInvoice(s.id),h=await be(c,l,g);i?.(`Downloaded ${h}`,"success")}catch(c){console.error("Error generating PDF:",c),i?.("Error generating PDF","error")}finally{P(!1)}},[l,g]),W=d.useCallback(async s=>{if(D(null),s.status!=="draft"){i?.("Only draft invoices can be marked as sent","error");return}try{await R.markInvoiceSent(s.id),await T(),i?.(`Invoice ${s.invoice_number} marked as sent`,"success")}catch(c){console.error("Error updating invoice:",c),i?.("Error updating invoice","error")}},[]),X=d.useCallback(async s=>{if(D(null),s.status==="paid"){i?.("Invoice is already marked as paid","error");return}try{await R.updateInvoice(s.id,{status:"paid",paid_at:new Date().toISOString(),amount_paid:s.total}),await T(),i?.(`Invoice ${s.invoice_number} marked as paid`,"success")}catch(c){console.error("Error updating invoice:",c),i?.("Error updating invoice","error")}},[]),V=d.useMemo(()=>{const s=m.cors.filter(I=>p.cors.has(I.id)).reduce((I,A)=>I+(A.cor_total||0),0),c=m.tickets.filter(I=>p.tickets.has(I.id)).reduce((I,A)=>I+(parseFloat(A.change_order_value)||0)*100,0),h=m.cors.reduce((I,A)=>I+(A.cor_total||0),0),K=m.tickets.reduce((I,A)=>I+(parseFloat(A.change_order_value)||0)*100,0);return{selected:s+c,total:h+K,selectedCount:p.cors.size+p.tickets.size}},[m,p]),G=s=>{k(c=>{const h=new Set(c.cors);return h.has(s)?h.delete(s):h.add(s),{...c,cors:h}})},H=s=>{k(c=>{const h=new Set(c.tickets);return h.has(s)?h.delete(s):h.add(s),{...c,tickets:h}})},J=()=>{k({cors:new Set(m.cors.map(s=>s.id)),tickets:new Set(m.tickets.map(s=>s.id))})},n=()=>{k({cors:new Set,tickets:new Set})},a=()=>{O(null),r(!0)},b=async s=>{r(!1),n(),await T(),i?.(`Invoice ${s.invoice_number} created`,"success")},L=()=>{const s=m.cors.filter(h=>p.cors.has(h.id)),c=m.tickets.filter(h=>p.tickets.has(h.id));return{cors:s,tickets:c}},S=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"}):"-",C=m.cors.length>0||m.tickets.length>0,Q=V.selectedCount>0;return x?e.jsx("div",{className:"billing-center loading",children:e.jsxs("div",{className:"billing-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Loading billing data..."})]})}):e.jsxs("div",{className:"billing-center",children:[e.jsxs("div",{className:"billing-section",children:[e.jsxs("div",{className:"billing-section-header",children:[e.jsxs("div",{className:"billing-section-title",children:[e.jsx(q,{size:20}),e.jsx("h3",{children:"Ready to Bill"}),C&&e.jsxs("span",{className:"billing-count",children:[m.cors.length+m.tickets.length," items"]})]}),C&&e.jsx("div",{className:"billing-section-actions",children:e.jsx("button",{className:"btn btn-text btn-sm",onClick:Q?n:J,children:Q?"Clear Selection":"Select All"})})]}),C?e.jsxs(e.Fragment,{children:[m.cors.length>0&&e.jsxs("div",{className:"billable-group",children:[e.jsxs("div",{className:"billable-group-header",children:[e.jsx(Y,{size:16}),e.jsxs("span",{children:["Change Orders (",m.cors.length,")"]})]}),e.jsx("div",{className:"billable-items",children:m.cors.map(s=>e.jsxs("label",{className:`billable-item ${p.cors.has(s.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:p.cors.has(s.id),onChange:()=>G(s.id)}),e.jsxs("div",{className:"billable-item-content",children:[e.jsx("span",{className:"billable-item-number",children:s.cor_number}),e.jsx("span",{className:"billable-item-title",children:s.title||"Untitled COR"})]}),e.jsx("span",{className:"billable-item-amount",children:v(s.cor_total||0)})]},s.id))})]}),m.tickets.length>0&&e.jsxs("div",{className:"billable-group",children:[e.jsxs("div",{className:"billable-group-header",children:[e.jsx(de,{size:16}),e.jsxs("span",{children:["T&M Tickets (",m.tickets.length,")"]})]}),e.jsx("div",{className:"billable-items",children:m.tickets.map(s=>e.jsxs("label",{className:`billable-item ${p.tickets.has(s.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:p.tickets.has(s.id),onChange:()=>H(s.id)}),e.jsxs("div",{className:"billable-item-content",children:[e.jsx("span",{className:"billable-item-number",children:s.ce_pco_number||S(s.work_date)}),e.jsxs("span",{className:"billable-item-title",children:["T&M Ticket - ",S(s.work_date)]})]}),e.jsx("span",{className:"billable-item-amount",children:v((parseFloat(s.change_order_value)||0)*100)})]},s.id))})]}),e.jsxs("div",{className:"billing-action-bar",children:[e.jsxs("div",{className:"billing-action-summary",children:[e.jsxs("span",{className:"selected-count",children:[V.selectedCount," of ",m.cors.length+m.tickets.length," selected"]}),e.jsx("span",{className:"selected-total",children:v(V.selected)})]}),e.jsxs("button",{className:"btn btn-primary",disabled:!Q,onClick:a,children:[e.jsx(ee,{size:16}),"Create Invoice"]})]})]}):e.jsxs("div",{className:"billing-empty-state",children:[e.jsx(se,{size:32,className:"text-success"}),e.jsx("p",{children:"No items ready to bill"}),e.jsx("span",{children:"Approved CORs and signed T&M tickets will appear here"})]})]}),e.jsxs("div",{className:"billing-section",children:[e.jsx("div",{className:"billing-section-header",children:e.jsxs("div",{className:"billing-section-title",children:[e.jsx(me,{size:20}),e.jsx("h3",{children:"Invoices"}),w.length>0&&e.jsx("span",{className:"billing-count",children:w.length})]})}),w.length===0?e.jsxs("div",{className:"billing-empty-state",children:[e.jsx(q,{size:32}),e.jsx("p",{children:"No invoices yet"}),e.jsx("span",{children:"Create an invoice from the items above"})]}):e.jsx("div",{className:"invoice-list",children:w.map(s=>{const c=U[s.status]?.icon||Y,h=F===s.id;return e.jsxs("div",{className:"invoice-row",children:[e.jsxs("div",{className:"invoice-info",children:[e.jsx("span",{className:"invoice-number",children:s.invoice_number}),e.jsx("span",{className:"invoice-date",children:S(s.invoice_date)})]}),e.jsx("span",{className:"invoice-amount",children:v(s.total||0)}),e.jsxs("span",{className:`invoice-status ${U[s.status]?.className||""}`,children:[e.jsx(c,{size:14}),U[s.status]?.label||s.status]}),e.jsxs("div",{className:"invoice-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-secondary",title:"View invoice details",onClick:()=>j(s),disabled:M,children:[e.jsx(ae,{size:14}),"View"]}),e.jsxs("button",{className:"btn btn-sm btn-primary",title:"Download PDF",onClick:()=>z(s),disabled:M,children:[e.jsx(Z,{size:14}),"PDF"]})]}),e.jsxs("div",{className:"invoice-actions-container",ref:h?_:null,children:[e.jsx("button",{className:"btn btn-icon btn-ghost",title:"More options",onClick:K=>u(s.id,K),disabled:M,children:e.jsx(ue,{size:16})}),h&&e.jsxs("div",{className:"invoice-dropdown",children:[e.jsxs("button",{className:"dropdown-item",onClick:()=>j(s),children:[e.jsx(ae,{size:14}),"View Details"]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>z(s),children:[e.jsx(Z,{size:14}),"Download PDF"]}),s.status==="draft"&&e.jsxs("button",{className:"dropdown-item",onClick:()=>W(s),children:[e.jsx(oe,{size:14}),"Mark as Sent"]}),s.status!=="paid"&&s.status!=="void"&&e.jsxs("button",{className:"dropdown-item success",onClick:()=>X(s),children:[e.jsx(se,{size:14}),"Mark as Paid"]})]})]})]},s.id)})})]}),E&&e.jsx(pe,{project:l,company:g,user:y,selectedItems:L(),onClose:()=>r(!1),onSuccess:b}),o&&e.jsx("div",{className:"modal-overlay",onClick:()=>f(null),children:e.jsxs("div",{className:"modal invoice-detail-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Invoice ",o.invoice_number]}),e.jsx("button",{className:"btn btn-icon btn-ghost",onClick:()=>f(null),children:e.jsx(re,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"invoice-detail-header",children:[e.jsxs("div",{className:"invoice-detail-info",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Date:"}),e.jsx("span",{className:"detail-value",children:S(o.invoice_date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Due:"}),e.jsx("span",{className:"detail-value",children:o.due_date?S(o.due_date):"Upon Receipt"})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Status:"}),e.jsx("span",{className:`invoice-status ${U[o.status]?.className||""}`,children:U[o.status]?.label||o.status})]})]}),e.jsxs("div",{className:"invoice-detail-billto",children:[e.jsx("span",{className:"detail-label",children:"Bill To:"}),e.jsxs("div",{className:"billto-content",children:[o.bill_to_name&&e.jsx("p",{children:o.bill_to_name}),o.bill_to_address&&e.jsx("p",{children:o.bill_to_address}),o.bill_to_contact&&e.jsx("p",{children:o.bill_to_contact})]})]})]}),e.jsxs("div",{className:"invoice-detail-items",children:[e.jsx("h3",{children:"Line Items"}),e.jsxs("table",{className:"invoice-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:(o.invoice_items||[]).map((s,c)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.reference_number||"-"}),e.jsx("td",{children:s.description}),e.jsx("td",{className:"text-right",children:v(s.amount)})]},s.id||c))})]})]}),e.jsxs("div",{className:"invoice-detail-totals",children:[e.jsxs("div",{className:"total-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:v(o.subtotal)})]}),o.retention_percent>0&&e.jsxs("div",{className:"total-row retention",children:[e.jsxs("span",{children:["Retention (",o.retention_percent/100,"%)"]}),e.jsxs("span",{children:["-",v(o.retention_amount)]})]}),e.jsxs("div",{className:"total-row grand-total",children:[e.jsx("span",{children:"Total Due"}),e.jsx("span",{children:v(o.total)})]}),o.amount_paid>0&&e.jsxs("div",{className:"total-row paid",children:[e.jsx("span",{children:"Amount Paid"}),e.jsx("span",{children:v(o.amount_paid)})]})]}),o.notes&&e.jsxs("div",{className:"invoice-detail-notes",children:[e.jsx("span",{className:"detail-label",children:"Notes:"}),e.jsx("p",{children:o.notes})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>f(null),children:"Close"}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{z(o),f(null)},children:[e.jsx(Z,{size:16}),"Download PDF"]})]})]})})]})}export{Ce as default};
//# sourceMappingURL=BillingCenter-CdErthfA.js.map
