import{r as Tf,a as Af,b as mx}from"./react-DXGY7bZi.js";import{c as hx}from"./supabase-VuevzHjS.js";import{u as Gs,w as fx,r as px}from"./xlsx-BTp1RmNK.js";import{E as Mi,a as Qs}from"./pdf-C0G31WKZ.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))c(m);new MutationObserver(m=>{for(const u of m)if(u.type==="childList")for(const x of u.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&c(x)}).observe(document,{childList:!0,subtree:!0});function o(m){const u={};return m.integrity&&(u.integrity=m.integrity),m.referrerPolicy&&(u.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?u.credentials="include":m.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(m){if(m.ep)return;m.ep=!0;const u=o(m);fetch(m.href,u)}})();var Ho={exports:{}},Kl={};var Kh;function gx(){if(Kh)return Kl;Kh=1;var l=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function o(c,m,u){var x=null;if(u!==void 0&&(x=""+u),m.key!==void 0&&(x=""+m.key),"key"in m){u={};for(var g in m)g!=="key"&&(u[g]=m[g])}else u=m;return m=u.ref,{$$typeof:l,type:c,key:x,ref:m!==void 0?m:null,props:u}}return Kl.Fragment=i,Kl.jsx=o,Kl.jsxs=o,Kl}var Wh;function xx(){return Wh||(Wh=1,Ho.exports=gx()),Ho.exports}var e=xx(),p=Tf();const jx=Af(p);var $o={exports:{}},Wl={},Vo={exports:{}},Go={};var ef;function vx(){return ef||(ef=1,(function(l){function i(w,k){var M=w.length;w.push(k);e:for(;0<M;){var he=M-1>>>1,V=w[he];if(0<m(V,k))w[he]=k,w[M]=V,M=he;else break e}}function o(w){return w.length===0?null:w[0]}function c(w){if(w.length===0)return null;var k=w[0],M=w.pop();if(M!==k){w[0]=M;e:for(var he=0,V=w.length,q=V>>>1;he<q;){var L=2*(he+1)-1,$=w[L],xe=L+1,be=w[xe];if(0>m($,M))xe<V&&0>m(be,$)?(w[he]=be,w[xe]=M,he=xe):(w[he]=$,w[L]=M,he=L);else if(xe<V&&0>m(be,M))w[he]=be,w[xe]=M,he=xe;else break e}}return k}function m(w,k){var M=w.sortIndex-k.sortIndex;return M!==0?M:w.id-k.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;l.unstable_now=function(){return u.now()}}else{var x=Date,g=x.now();l.unstable_now=function(){return x.now()-g}}var f=[],v=[],y=1,A=null,Y=3,B=!1,H=!1,U=!1,z=!1,K=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function S(w){for(var k=o(v);k!==null;){if(k.callback===null)c(v);else if(k.startTime<=w)c(v),k.sortIndex=k.expirationTime,i(f,k);else break;k=o(v)}}function te(w){if(U=!1,S(w),!H)if(o(f)!==null)H=!0,se||(se=!0,j());else{var k=o(v);k!==null&&ee(te,k.startTime-w)}}var se=!1,Z=-1,Q=5,F=-1;function I(){return z?!0:!(l.unstable_now()-F<Q)}function P(){if(z=!1,se){var w=l.unstable_now();F=w;var k=!0;try{e:{H=!1,U&&(U=!1,E(Z),Z=-1),B=!0;var M=Y;try{t:{for(S(w),A=o(f);A!==null&&!(A.expirationTime>w&&I());){var he=A.callback;if(typeof he=="function"){A.callback=null,Y=A.priorityLevel;var V=he(A.expirationTime<=w);if(w=l.unstable_now(),typeof V=="function"){A.callback=V,S(w),k=!0;break t}A===o(f)&&c(f),S(w)}else c(f);A=o(f)}if(A!==null)k=!0;else{var q=o(v);q!==null&&ee(te,q.startTime-w),k=!1}}break e}finally{A=null,Y=M,B=!1}k=void 0}}finally{k?j():se=!1}}}var j;if(typeof D=="function")j=function(){D(P)};else if(typeof MessageChannel<"u"){var _=new MessageChannel,C=_.port2;_.port1.onmessage=P,j=function(){C.postMessage(null)}}else j=function(){K(P,0)};function ee(w,k){Z=K(function(){w(l.unstable_now())},k)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(w){w.callback=null},l.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<w?Math.floor(1e3/w):5},l.unstable_getCurrentPriorityLevel=function(){return Y},l.unstable_next=function(w){switch(Y){case 1:case 2:case 3:var k=3;break;default:k=Y}var M=Y;Y=k;try{return w()}finally{Y=M}},l.unstable_requestPaint=function(){z=!0},l.unstable_runWithPriority=function(w,k){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var M=Y;Y=w;try{return k()}finally{Y=M}},l.unstable_scheduleCallback=function(w,k,M){var he=l.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?he+M:he):M=he,w){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=M+V,w={id:y++,callback:k,priorityLevel:w,startTime:M,expirationTime:V,sortIndex:-1},M>he?(w.sortIndex=M,i(v,w),o(f)===null&&w===o(v)&&(U?(E(Z),Z=-1):U=!0,ee(te,M-he))):(w.sortIndex=V,i(f,w),H||B||(H=!0,se||(se=!0,j()))),w},l.unstable_shouldYield=I,l.unstable_wrapCallback=function(w){var k=Y;return function(){var M=Y;Y=k;try{return w.apply(this,arguments)}finally{Y=M}}}})(Go)),Go}var tf;function yx(){return tf||(tf=1,Vo.exports=vx()),Vo.exports}var af;function bx(){if(af)return Wl;af=1;var l=yx(),i=Tf(),o=mx();function c(t){var a="https://react.dev/errors/"+t;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)a+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function m(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function u(t){var a=t,s=t;if(t.alternate)for(;a.return;)a=a.return;else{t=a;do a=t,(a.flags&4098)!==0&&(s=a.return),t=a.return;while(t)}return a.tag===3?s:null}function x(t){if(t.tag===13){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function g(t){if(t.tag===31){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function f(t){if(u(t)!==t)throw Error(c(188))}function v(t){var a=t.alternate;if(!a){if(a=u(t),a===null)throw Error(c(188));return a!==t?null:t}for(var s=t,n=a;;){var r=s.return;if(r===null)break;var d=r.alternate;if(d===null){if(n=r.return,n!==null){s=n;continue}break}if(r.child===d.child){for(d=r.child;d;){if(d===s)return f(r),t;if(d===n)return f(r),a;d=d.sibling}throw Error(c(188))}if(s.return!==n.return)s=r,n=d;else{for(var h=!1,b=r.child;b;){if(b===s){h=!0,s=r,n=d;break}if(b===n){h=!0,n=r,s=d;break}b=b.sibling}if(!h){for(b=d.child;b;){if(b===s){h=!0,s=d,n=r;break}if(b===n){h=!0,n=d,s=r;break}b=b.sibling}if(!h)throw Error(c(189))}}if(s.alternate!==n)throw Error(c(190))}if(s.tag!==3)throw Error(c(188));return s.stateNode.current===s?t:a}function y(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t;for(t=t.child;t!==null;){if(a=y(t),a!==null)return a;t=t.sibling}return null}var A=Object.assign,Y=Symbol.for("react.element"),B=Symbol.for("react.transitional.element"),H=Symbol.for("react.portal"),U=Symbol.for("react.fragment"),z=Symbol.for("react.strict_mode"),K=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),D=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),te=Symbol.for("react.suspense"),se=Symbol.for("react.suspense_list"),Z=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),I=Symbol.for("react.memo_cache_sentinel"),P=Symbol.iterator;function j(t){return t===null||typeof t!="object"?null:(t=P&&t[P]||t["@@iterator"],typeof t=="function"?t:null)}var _=Symbol.for("react.client.reference");function C(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===_?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case U:return"Fragment";case K:return"Profiler";case z:return"StrictMode";case te:return"Suspense";case se:return"SuspenseList";case F:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case H:return"Portal";case D:return t.displayName||"Context";case E:return(t._context.displayName||"Context")+".Consumer";case S:var a=t.render;return t=t.displayName,t||(t=a.displayName||a.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Z:return a=t.displayName||null,a!==null?a:C(t.type)||"Memo";case Q:a=t._payload,t=t._init;try{return C(t(a))}catch{}}return null}var ee=Array.isArray,w=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M={pending:!1,data:null,method:null,action:null},he=[],V=-1;function q(t){return{current:t}}function L(t){0>V||(t.current=he[V],he[V]=null,V--)}function $(t,a){V++,he[V]=t.current,t.current=a}var xe=q(null),be=q(null),Fe=q(null),ye=q(null);function We(t,a){switch($(Fe,a),$(be,t),$(xe,null),a.nodeType){case 9:case 11:t=(t=a.documentElement)&&(t=t.namespaceURI)?bh(t):0;break;default:if(t=a.tagName,a=a.namespaceURI)a=bh(a),t=_h(a,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}L(xe),$(xe,t)}function Ve(){L(xe),L(be),L(Fe)}function De(t){t.memoizedState!==null&&$(ye,t);var a=xe.current,s=_h(a,t.type);a!==s&&($(be,t),$(xe,s))}function nt(t){be.current===t&&(L(xe),L(be)),ye.current===t&&(L(ye),Zl._currentValue=M)}var Vt,ke;function ze(t){if(Vt===void 0)try{throw Error()}catch(s){var a=s.stack.trim().match(/\n( *(at )?)/);Vt=a&&a[1]||"",ke=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Vt+t+ke}var Ae=!1;function Me(t,a){if(!t||Ae)return"";Ae=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(a){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(me){var oe=me}Reflect.construct(t,[],ve)}else{try{ve.call()}catch(me){oe=me}t.call(ve.prototype)}}else{try{throw Error()}catch(me){oe=me}(ve=t())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(me){if(me&&oe&&typeof me.stack=="string")return[me.stack,oe.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=n.DetermineComponentFrameRoot(),h=d[0],b=d[1];if(h&&b){var R=h.split(`
`),ie=b.split(`
`);for(r=n=0;n<R.length&&!R[n].includes("DetermineComponentFrameRoot");)n++;for(;r<ie.length&&!ie[r].includes("DetermineComponentFrameRoot");)r++;if(n===R.length||r===ie.length)for(n=R.length-1,r=ie.length-1;1<=n&&0<=r&&R[n]!==ie[r];)r--;for(;1<=n&&0<=r;n--,r--)if(R[n]!==ie[r]){if(n!==1||r!==1)do if(n--,r--,0>r||R[n]!==ie[r]){var fe=`
`+R[n].replace(" at new "," at ");return t.displayName&&fe.includes("<anonymous>")&&(fe=fe.replace("<anonymous>",t.displayName)),fe}while(1<=n&&0<=r);break}}}finally{Ae=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?ze(s):""}function Ce(t,a){switch(t.tag){case 26:case 27:case 5:return ze(t.type);case 16:return ze("Lazy");case 13:return t.child!==a&&a!==null?ze("Suspense Fallback"):ze("Suspense");case 19:return ze("SuspenseList");case 0:case 15:return Me(t.type,!1);case 11:return Me(t.type.render,!1);case 1:return Me(t.type,!0);case 31:return ze("Activity");default:return""}}function Xe(t){try{var a="",s=null;do a+=Ce(t,s),s=t,t=t.return;while(t);return a}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var X=Object.prototype.hasOwnProperty,T=l.unstable_scheduleCallback,_e=l.unstable_cancelCallback,Ee=l.unstable_shouldYield,ae=l.unstable_requestPaint,Se=l.unstable_now,ct=l.unstable_getCurrentPriorityLevel,Pe=l.unstable_ImmediatePriority,Ut=l.unstable_UserBlockingPriority,Rt=l.unstable_NormalPriority,ut=l.unstable_LowPriority,Gt=l.unstable_IdlePriority,Lt=l.log,Et=l.unstable_setDisableYieldValue,et=null,tt=null;function xt(t){if(typeof Lt=="function"&&Et(t),tt&&typeof tt.setStrictMode=="function")try{tt.setStrictMode(et,t)}catch{}}var jt=Math.clz32?Math.clz32:pe,ne=Math.log,Ne=Math.LN2;function pe(t){return t>>>=0,t===0?32:31-(ne(t)/Ne|0)|0}var N=256,re=262144,ce=4194304;function ue(t){var a=t&42;if(a!==0)return a;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Oe(t,a,s){var n=t.pendingLanes;if(n===0)return 0;var r=0,d=t.suspendedLanes,h=t.pingedLanes;t=t.warmLanes;var b=n&134217727;return b!==0?(n=b&~d,n!==0?r=ue(n):(h&=b,h!==0?r=ue(h):s||(s=b&~t,s!==0&&(r=ue(s))))):(b=n&~d,b!==0?r=ue(b):h!==0?r=ue(h):s||(s=n&~t,s!==0&&(r=ue(s)))),r===0?0:a!==0&&a!==r&&(a&d)===0&&(d=r&-r,s=a&-a,d>=s||d===32&&(s&4194048)!==0)?a:r}function Qe(t,a){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&a)===0}function Te(t,a){switch(t){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function je(){var t=ce;return ce<<=1,(ce&62914560)===0&&(ce=4194304),t}function lt(t){for(var a=[],s=0;31>s;s++)a.push(t);return a}function pt(t,a){t.pendingLanes|=a,a!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Bt(t,a,s,n,r,d){var h=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var b=t.entanglements,R=t.expirationTimes,ie=t.hiddenUpdates;for(s=h&~s;0<s;){var fe=31-jt(s),ve=1<<fe;b[fe]=0,R[fe]=-1;var oe=ie[fe];if(oe!==null)for(ie[fe]=null,fe=0;fe<oe.length;fe++){var me=oe[fe];me!==null&&(me.lane&=-536870913)}s&=~ve}n!==0&&la(t,n,0),d!==0&&r===0&&t.tag!==0&&(t.suspendedLanes|=d&~(h&~a))}function la(t,a,s){t.pendingLanes|=a,t.suspendedLanes&=~a;var n=31-jt(a);t.entangledLanes|=a,t.entanglements[n]=t.entanglements[n]|1073741824|s&261930}function vt(t,a){var s=t.entangledLanes|=a;for(t=t.entanglements;s;){var n=31-jt(s),r=1<<n;r&a|t[n]&a&&(t[n]|=a),s&=~r}}function Re(t,a){var s=a&-a;return s=(s&42)!==0?1:Ze(s),(s&(t.suspendedLanes|a))!==0?0:s}function Ze(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function ra(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function Ue(){var t=k.p;return t!==0?t:(t=window.event,t===void 0?32:Yh(t.type))}function Ye(t,a){var s=k.p;try{return k.p=t,a()}finally{k.p=s}}var mt=Math.random().toString(36).slice(2),Ie="__reactFiber$"+mt,Mt="__reactProps$"+mt,Jt="__reactContainer$"+mt,fa="__reactEvents$"+mt,Yt="__reactListeners$"+mt,Ba="__reactHandles$"+mt,ol="__reactResources$"+mt,Js="__reactMarker$"+mt;function Nn(t){delete t[Ie],delete t[Mt],delete t[fa],delete t[Yt],delete t[Ba]}function Pa(t){var a=t[Ie];if(a)return a;for(var s=t.parentNode;s;){if(a=s[Jt]||s[Ie]){if(s=a.alternate,a.child!==null||s!==null&&s.child!==null)for(t=Dh(t);t!==null;){if(s=t[Ie])return s;t=Dh(t)}return a}t=s,s=t.parentNode}return null}function Fa(t){if(t=t[Ie]||t[Jt]){var a=t.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return t}return null}function js(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t.stateNode;throw Error(c(33))}function vs(t){var a=t[ol];return a||(a=t[ol]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function _t(t){t[Js]=!0}var dr=new Set,dl={};function Is(t,a){Sn(t,a),Sn(t+"Capture",a)}function Sn(t,a){for(dl[t]=a,t=0;t<a.length;t++)dr.add(a[t])}var sp=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ud={},md={};function np(t){return X.call(md,t)?!0:X.call(ud,t)?!1:sp.test(t)?md[t]=!0:(ud[t]=!0,!1)}function ur(t,a,s){if(np(a))if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(a);return;case"boolean":var n=a.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){t.removeAttribute(a);return}}t.setAttribute(a,""+s)}}function mr(t,a,s){if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(a);return}t.setAttribute(a,""+s)}}function Ja(t,a,s,n){if(n===null)t.removeAttribute(s);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(a,s,""+n)}}function Na(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function hd(t){var a=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function lp(t,a,s){var n=Object.getOwnPropertyDescriptor(t.constructor.prototype,a);if(!t.hasOwnProperty(a)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,d=n.set;return Object.defineProperty(t,a,{configurable:!0,get:function(){return r.call(this)},set:function(h){s=""+h,d.call(this,h)}}),Object.defineProperty(t,a,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(h){s=""+h},stopTracking:function(){t._valueTracker=null,delete t[a]}}}}function Ri(t){if(!t._valueTracker){var a=hd(t)?"checked":"value";t._valueTracker=lp(t,a,""+t[a])}}function fd(t){if(!t)return!1;var a=t._valueTracker;if(!a)return!0;var s=a.getValue(),n="";return t&&(n=hd(t)?t.checked?"true":"false":t.value),t=n,t!==s?(a.setValue(t),!0):!1}function hr(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var rp=/[\n"\\]/g;function Sa(t){return t.replace(rp,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function zi(t,a,s,n,r,d,h,b){t.name="",h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"?t.type=h:t.removeAttribute("type"),a!=null?h==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+Na(a)):t.value!==""+Na(a)&&(t.value=""+Na(a)):h!=="submit"&&h!=="reset"||t.removeAttribute("value"),a!=null?qi(t,h,Na(a)):s!=null?qi(t,h,Na(s)):n!=null&&t.removeAttribute("value"),r==null&&d!=null&&(t.defaultChecked=!!d),r!=null&&(t.checked=r&&typeof r!="function"&&typeof r!="symbol"),b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?t.name=""+Na(b):t.removeAttribute("name")}function pd(t,a,s,n,r,d,h,b){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(t.type=d),a!=null||s!=null){if(!(d!=="submit"&&d!=="reset"||a!=null)){Ri(t);return}s=s!=null?""+Na(s):"",a=a!=null?""+Na(a):s,b||a===t.value||(t.value=a),t.defaultValue=a}n=n??r,n=typeof n!="function"&&typeof n!="symbol"&&!!n,t.checked=b?t.checked:!!n,t.defaultChecked=!!n,h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(t.name=h),Ri(t)}function qi(t,a,s){a==="number"&&hr(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function Cn(t,a,s,n){if(t=t.options,a){a={};for(var r=0;r<s.length;r++)a["$"+s[r]]=!0;for(s=0;s<t.length;s++)r=a.hasOwnProperty("$"+t[s].value),t[s].selected!==r&&(t[s].selected=r),r&&n&&(t[s].defaultSelected=!0)}else{for(s=""+Na(s),a=null,r=0;r<t.length;r++){if(t[r].value===s){t[r].selected=!0,n&&(t[r].defaultSelected=!0);return}a!==null||t[r].disabled||(a=t[r])}a!==null&&(a.selected=!0)}}function gd(t,a,s){if(a!=null&&(a=""+Na(a),a!==t.value&&(t.value=a),s==null)){t.defaultValue!==a&&(t.defaultValue=a);return}t.defaultValue=s!=null?""+Na(s):""}function xd(t,a,s,n){if(a==null){if(n!=null){if(s!=null)throw Error(c(92));if(ee(n)){if(1<n.length)throw Error(c(93));n=n[0]}s=n}s==null&&(s=""),a=s}s=Na(a),t.defaultValue=s,n=t.textContent,n===s&&n!==""&&n!==null&&(t.value=n),Ri(t)}function wn(t,a){if(a){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=a;return}}t.textContent=a}var ip=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function jd(t,a,s){var n=a.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?n?t.setProperty(a,""):a==="float"?t.cssFloat="":t[a]="":n?t.setProperty(a,s):typeof s!="number"||s===0||ip.has(a)?a==="float"?t.cssFloat=s:t[a]=(""+s).trim():t[a]=s+"px"}function vd(t,a,s){if(a!=null&&typeof a!="object")throw Error(c(62));if(t=t.style,s!=null){for(var n in s)!s.hasOwnProperty(n)||a!=null&&a.hasOwnProperty(n)||(n.indexOf("--")===0?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="");for(var r in a)n=a[r],a.hasOwnProperty(r)&&s[r]!==n&&jd(t,r,n)}else for(var d in a)a.hasOwnProperty(d)&&jd(t,d,a[d])}function Oi(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),op=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function fr(t){return op.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function Ia(){}var Ui=null;function Li(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var kn=null,En=null;function yd(t){var a=Fa(t);if(a&&(t=a.stateNode)){var s=t[Mt]||null;e:switch(t=a.stateNode,a.type){case"input":if(zi(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),a=s.name,s.type==="radio"&&a!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+Sa(""+a)+'"][type="radio"]'),a=0;a<s.length;a++){var n=s[a];if(n!==t&&n.form===t.form){var r=n[Mt]||null;if(!r)throw Error(c(90));zi(n,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(a=0;a<s.length;a++)n=s[a],n.form===t.form&&fd(n)}break e;case"textarea":gd(t,s.value,s.defaultValue);break e;case"select":a=s.value,a!=null&&Cn(t,!!s.multiple,a,!1)}}}var Bi=!1;function bd(t,a,s){if(Bi)return t(a,s);Bi=!0;try{var n=t(a);return n}finally{if(Bi=!1,(kn!==null||En!==null)&&(ti(),kn&&(a=kn,t=En,En=kn=null,yd(a),t)))for(a=0;a<t.length;a++)yd(t[a])}}function ul(t,a){var s=t.stateNode;if(s===null)return null;var n=s[Mt]||null;if(n===null)return null;s=n[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(c(231,a,typeof s));return s}var Ka=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fi=!1;if(Ka)try{var ml={};Object.defineProperty(ml,"passive",{get:function(){Fi=!0}}),window.addEventListener("test",ml,ml),window.removeEventListener("test",ml,ml)}catch{Fi=!1}var ys=null,Hi=null,pr=null;function _d(){if(pr)return pr;var t,a=Hi,s=a.length,n,r="value"in ys?ys.value:ys.textContent,d=r.length;for(t=0;t<s&&a[t]===r[t];t++);var h=s-t;for(n=1;n<=h&&a[s-n]===r[d-n];n++);return pr=r.slice(t,1<n?1-n:void 0)}function gr(t){var a=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&a===13&&(t=13)):t=a,t===10&&(t=13),32<=t||t===13?t:0}function xr(){return!0}function Nd(){return!1}function ca(t){function a(s,n,r,d,h){this._reactName=s,this._targetInst=r,this.type=n,this.nativeEvent=d,this.target=h,this.currentTarget=null;for(var b in t)t.hasOwnProperty(b)&&(s=t[b],this[b]=s?s(d):d[b]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?xr:Nd,this.isPropagationStopped=Nd,this}return A(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=xr)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=xr)},persist:function(){},isPersistent:xr}),a}var Ks={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jr=ca(Ks),hl=A({},Ks,{view:0,detail:0}),dp=ca(hl),$i,Vi,fl,vr=A({},hl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yi,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==fl&&(fl&&t.type==="mousemove"?($i=t.screenX-fl.screenX,Vi=t.screenY-fl.screenY):Vi=$i=0,fl=t),$i)},movementY:function(t){return"movementY"in t?t.movementY:Vi}}),Sd=ca(vr),up=A({},vr,{dataTransfer:0}),mp=ca(up),hp=A({},hl,{relatedTarget:0}),Gi=ca(hp),fp=A({},Ks,{animationName:0,elapsedTime:0,pseudoElement:0}),pp=ca(fp),gp=A({},Ks,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),xp=ca(gp),jp=A({},Ks,{data:0}),Cd=ca(jp),vp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _p(t){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(t):(t=bp[t])?!!a[t]:!1}function Yi(){return _p}var Np=A({},hl,{key:function(t){if(t.key){var a=vp[t.key]||t.key;if(a!=="Unidentified")return a}return t.type==="keypress"?(t=gr(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?yp[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yi,charCode:function(t){return t.type==="keypress"?gr(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?gr(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Sp=ca(Np),Cp=A({},vr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wd=ca(Cp),wp=A({},hl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yi}),kp=ca(wp),Ep=A({},Ks,{propertyName:0,elapsedTime:0,pseudoElement:0}),Dp=ca(Ep),Mp=A({},vr,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Tp=ca(Mp),Ap=A({},Ks,{newState:0,oldState:0}),Rp=ca(Ap),zp=[9,13,27,32],Qi=Ka&&"CompositionEvent"in window,pl=null;Ka&&"documentMode"in document&&(pl=document.documentMode);var qp=Ka&&"TextEvent"in window&&!pl,kd=Ka&&(!Qi||pl&&8<pl&&11>=pl),Ed=" ",Dd=!1;function Md(t,a){switch(t){case"keyup":return zp.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Td(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Dn=!1;function Op(t,a){switch(t){case"compositionend":return Td(a);case"keypress":return a.which!==32?null:(Dd=!0,Ed);case"textInput":return t=a.data,t===Ed&&Dd?null:t;default:return null}}function Up(t,a){if(Dn)return t==="compositionend"||!Qi&&Md(t,a)?(t=_d(),pr=Hi=ys=null,Dn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return kd&&a.locale!=="ko"?null:a.data;default:return null}}var Lp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ad(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a==="input"?!!Lp[t.type]:a==="textarea"}function Rd(t,a,s,n){kn?En?En.push(n):En=[n]:kn=n,a=ci(a,"onChange"),0<a.length&&(s=new jr("onChange","change",null,s,n),t.push({event:s,listeners:a}))}var gl=null,xl=null;function Bp(t){ph(t,0)}function yr(t){var a=js(t);if(fd(a))return t}function zd(t,a){if(t==="change")return a}var qd=!1;if(Ka){var Xi;if(Ka){var Zi="oninput"in document;if(!Zi){var Od=document.createElement("div");Od.setAttribute("oninput","return;"),Zi=typeof Od.oninput=="function"}Xi=Zi}else Xi=!1;qd=Xi&&(!document.documentMode||9<document.documentMode)}function Ud(){gl&&(gl.detachEvent("onpropertychange",Ld),xl=gl=null)}function Ld(t){if(t.propertyName==="value"&&yr(xl)){var a=[];Rd(a,xl,t,Li(t)),bd(Bp,a)}}function Fp(t,a,s){t==="focusin"?(Ud(),gl=a,xl=s,gl.attachEvent("onpropertychange",Ld)):t==="focusout"&&Ud()}function Hp(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return yr(xl)}function $p(t,a){if(t==="click")return yr(a)}function Vp(t,a){if(t==="input"||t==="change")return yr(a)}function Gp(t,a){return t===a&&(t!==0||1/t===1/a)||t!==t&&a!==a}var pa=typeof Object.is=="function"?Object.is:Gp;function jl(t,a){if(pa(t,a))return!0;if(typeof t!="object"||t===null||typeof a!="object"||a===null)return!1;var s=Object.keys(t),n=Object.keys(a);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var r=s[n];if(!X.call(a,r)||!pa(t[r],a[r]))return!1}return!0}function Bd(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Fd(t,a){var s=Bd(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=a&&n>=a)return{node:s,offset:a-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Bd(s)}}function Hd(t,a){return t&&a?t===a?!0:t&&t.nodeType===3?!1:a&&a.nodeType===3?Hd(t,a.parentNode):"contains"in t?t.contains(a):t.compareDocumentPosition?!!(t.compareDocumentPosition(a)&16):!1:!1}function $d(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var a=hr(t.document);a instanceof t.HTMLIFrameElement;){try{var s=typeof a.contentWindow.location.href=="string"}catch{s=!1}if(s)t=a.contentWindow;else break;a=hr(t.document)}return a}function Pi(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a&&(a==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||a==="textarea"||t.contentEditable==="true")}var Yp=Ka&&"documentMode"in document&&11>=document.documentMode,Mn=null,Ji=null,vl=null,Ii=!1;function Vd(t,a,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Ii||Mn==null||Mn!==hr(n)||(n=Mn,"selectionStart"in n&&Pi(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),vl&&jl(vl,n)||(vl=n,n=ci(Ji,"onSelect"),0<n.length&&(a=new jr("onSelect","select",null,a,s),t.push({event:a,listeners:n}),a.target=Mn)))}function Ws(t,a){var s={};return s[t.toLowerCase()]=a.toLowerCase(),s["Webkit"+t]="webkit"+a,s["Moz"+t]="moz"+a,s}var Tn={animationend:Ws("Animation","AnimationEnd"),animationiteration:Ws("Animation","AnimationIteration"),animationstart:Ws("Animation","AnimationStart"),transitionrun:Ws("Transition","TransitionRun"),transitionstart:Ws("Transition","TransitionStart"),transitioncancel:Ws("Transition","TransitionCancel"),transitionend:Ws("Transition","TransitionEnd")},Ki={},Gd={};Ka&&(Gd=document.createElement("div").style,"AnimationEvent"in window||(delete Tn.animationend.animation,delete Tn.animationiteration.animation,delete Tn.animationstart.animation),"TransitionEvent"in window||delete Tn.transitionend.transition);function en(t){if(Ki[t])return Ki[t];if(!Tn[t])return t;var a=Tn[t],s;for(s in a)if(a.hasOwnProperty(s)&&s in Gd)return Ki[t]=a[s];return t}var Yd=en("animationend"),Qd=en("animationiteration"),Xd=en("animationstart"),Qp=en("transitionrun"),Xp=en("transitionstart"),Zp=en("transitioncancel"),Zd=en("transitionend"),Pd=new Map,Wi="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Wi.push("scrollEnd");function qa(t,a){Pd.set(t,a),Is(a,[t])}var br=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},Ca=[],An=0,ec=0;function _r(){for(var t=An,a=ec=An=0;a<t;){var s=Ca[a];Ca[a++]=null;var n=Ca[a];Ca[a++]=null;var r=Ca[a];Ca[a++]=null;var d=Ca[a];if(Ca[a++]=null,n!==null&&r!==null){var h=n.pending;h===null?r.next=r:(r.next=h.next,h.next=r),n.pending=r}d!==0&&Jd(s,r,d)}}function Nr(t,a,s,n){Ca[An++]=t,Ca[An++]=a,Ca[An++]=s,Ca[An++]=n,ec|=n,t.lanes|=n,t=t.alternate,t!==null&&(t.lanes|=n)}function tc(t,a,s,n){return Nr(t,a,s,n),Sr(t)}function tn(t,a){return Nr(t,null,null,a),Sr(t)}function Jd(t,a,s){t.lanes|=s;var n=t.alternate;n!==null&&(n.lanes|=s);for(var r=!1,d=t.return;d!==null;)d.childLanes|=s,n=d.alternate,n!==null&&(n.childLanes|=s),d.tag===22&&(t=d.stateNode,t===null||t._visibility&1||(r=!0)),t=d,d=d.return;return t.tag===3?(d=t.stateNode,r&&a!==null&&(r=31-jt(s),t=d.hiddenUpdates,n=t[r],n===null?t[r]=[a]:n.push(a),a.lane=s|536870912),d):null}function Sr(t){if(50<Hl)throw Hl=0,uo=null,Error(c(185));for(var a=t.return;a!==null;)t=a,a=t.return;return t.tag===3?t.stateNode:null}var Rn={};function Pp(t,a,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ga(t,a,s,n){return new Pp(t,a,s,n)}function ac(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Wa(t,a){var s=t.alternate;return s===null?(s=ga(t.tag,a,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=a,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,a=t.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function Id(t,a){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=a,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,a=s.dependencies,t.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),t}function Cr(t,a,s,n,r,d){var h=0;if(n=t,typeof t=="function")ac(t)&&(h=1);else if(typeof t=="string")h=ex(t,s,xe.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case F:return t=ga(31,s,a,r),t.elementType=F,t.lanes=d,t;case U:return an(s.children,r,d,a);case z:h=8,r|=24;break;case K:return t=ga(12,s,a,r|2),t.elementType=K,t.lanes=d,t;case te:return t=ga(13,s,a,r),t.elementType=te,t.lanes=d,t;case se:return t=ga(19,s,a,r),t.elementType=se,t.lanes=d,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case D:h=10;break e;case E:h=9;break e;case S:h=11;break e;case Z:h=14;break e;case Q:h=16,n=null;break e}h=29,s=Error(c(130,t===null?"null":typeof t,"")),n=null}return a=ga(h,s,a,r),a.elementType=t,a.type=n,a.lanes=d,a}function an(t,a,s,n){return t=ga(7,t,n,a),t.lanes=s,t}function sc(t,a,s){return t=ga(6,t,null,a),t.lanes=s,t}function Kd(t){var a=ga(18,null,null,0);return a.stateNode=t,a}function nc(t,a,s){return a=ga(4,t.children!==null?t.children:[],t.key,a),a.lanes=s,a.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},a}var Wd=new WeakMap;function wa(t,a){if(typeof t=="object"&&t!==null){var s=Wd.get(t);return s!==void 0?s:(a={value:t,source:a,stack:Xe(a)},Wd.set(t,a),a)}return{value:t,source:a,stack:Xe(a)}}var zn=[],qn=0,wr=null,yl=0,ka=[],Ea=0,bs=null,Ha=1,$a="";function es(t,a){zn[qn++]=yl,zn[qn++]=wr,wr=t,yl=a}function eu(t,a,s){ka[Ea++]=Ha,ka[Ea++]=$a,ka[Ea++]=bs,bs=t;var n=Ha;t=$a;var r=32-jt(n)-1;n&=~(1<<r),s+=1;var d=32-jt(a)+r;if(30<d){var h=r-r%5;d=(n&(1<<h)-1).toString(32),n>>=h,r-=h,Ha=1<<32-jt(a)+r|s<<r|n,$a=d+t}else Ha=1<<d|s<<r|n,$a=t}function lc(t){t.return!==null&&(es(t,1),eu(t,1,0))}function rc(t){for(;t===wr;)wr=zn[--qn],zn[qn]=null,yl=zn[--qn],zn[qn]=null;for(;t===bs;)bs=ka[--Ea],ka[Ea]=null,$a=ka[--Ea],ka[Ea]=null,Ha=ka[--Ea],ka[Ea]=null}function tu(t,a){ka[Ea++]=Ha,ka[Ea++]=$a,ka[Ea++]=bs,Ha=a.id,$a=a.overflow,bs=t}var Wt=null,Tt=null,ot=!1,_s=null,Da=!1,ic=Error(c(519));function Ns(t){var a=Error(c(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw bl(wa(a,t)),ic}function au(t){var a=t.stateNode,s=t.type,n=t.memoizedProps;switch(a[Ie]=t,a[Mt]=n,s){case"dialog":st("cancel",a),st("close",a);break;case"iframe":case"object":case"embed":st("load",a);break;case"video":case"audio":for(s=0;s<Vl.length;s++)st(Vl[s],a);break;case"source":st("error",a);break;case"img":case"image":case"link":st("error",a),st("load",a);break;case"details":st("toggle",a);break;case"input":st("invalid",a),pd(a,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":st("invalid",a);break;case"textarea":st("invalid",a),xd(a,n.value,n.defaultValue,n.children)}s=n.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||a.textContent===""+s||n.suppressHydrationWarning===!0||vh(a.textContent,s)?(n.popover!=null&&(st("beforetoggle",a),st("toggle",a)),n.onScroll!=null&&st("scroll",a),n.onScrollEnd!=null&&st("scrollend",a),n.onClick!=null&&(a.onclick=Ia),a=!0):a=!1,a||Ns(t,!0)}function su(t){for(Wt=t.return;Wt;)switch(Wt.tag){case 5:case 31:case 13:Da=!1;return;case 27:case 3:Da=!0;return;default:Wt=Wt.return}}function On(t){if(t!==Wt)return!1;if(!ot)return su(t),ot=!0,!1;var a=t.tag,s;if((s=a!==3&&a!==27)&&((s=a===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||wo(t.type,t.memoizedProps)),s=!s),s&&Tt&&Ns(t),su(t),a===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(317));Tt=Eh(t)}else if(a===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(317));Tt=Eh(t)}else a===27?(a=Tt,Us(t.type)?(t=To,To=null,Tt=t):Tt=a):Tt=Wt?Ta(t.stateNode.nextSibling):null;return!0}function sn(){Tt=Wt=null,ot=!1}function cc(){var t=_s;return t!==null&&(ma===null?ma=t:ma.push.apply(ma,t),_s=null),t}function bl(t){_s===null?_s=[t]:_s.push(t)}var oc=q(null),nn=null,ts=null;function Ss(t,a,s){$(oc,a._currentValue),a._currentValue=s}function as(t){t._currentValue=oc.current,L(oc)}function dc(t,a,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&a)!==a?(t.childLanes|=a,n!==null&&(n.childLanes|=a)):n!==null&&(n.childLanes&a)!==a&&(n.childLanes|=a),t===s)break;t=t.return}}function uc(t,a,s,n){var r=t.child;for(r!==null&&(r.return=t);r!==null;){var d=r.dependencies;if(d!==null){var h=r.child;d=d.firstContext;e:for(;d!==null;){var b=d;d=r;for(var R=0;R<a.length;R++)if(b.context===a[R]){d.lanes|=s,b=d.alternate,b!==null&&(b.lanes|=s),dc(d.return,s,t),n||(h=null);break e}d=b.next}}else if(r.tag===18){if(h=r.return,h===null)throw Error(c(341));h.lanes|=s,d=h.alternate,d!==null&&(d.lanes|=s),dc(h,s,t),h=null}else h=r.child;if(h!==null)h.return=r;else for(h=r;h!==null;){if(h===t){h=null;break}if(r=h.sibling,r!==null){r.return=h.return,h=r;break}h=h.return}r=h}}function Un(t,a,s,n){t=null;for(var r=a,d=!1;r!==null;){if(!d){if((r.flags&524288)!==0)d=!0;else if((r.flags&262144)!==0)break}if(r.tag===10){var h=r.alternate;if(h===null)throw Error(c(387));if(h=h.memoizedProps,h!==null){var b=r.type;pa(r.pendingProps.value,h.value)||(t!==null?t.push(b):t=[b])}}else if(r===ye.current){if(h=r.alternate,h===null)throw Error(c(387));h.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(t!==null?t.push(Zl):t=[Zl])}r=r.return}t!==null&&uc(a,t,s,n),a.flags|=262144}function kr(t){for(t=t.firstContext;t!==null;){if(!pa(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function ln(t){nn=t,ts=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function ea(t){return nu(nn,t)}function Er(t,a){return nn===null&&ln(t),nu(t,a)}function nu(t,a){var s=a._currentValue;if(a={context:a,memoizedValue:s,next:null},ts===null){if(t===null)throw Error(c(308));ts=a,t.dependencies={lanes:0,firstContext:a},t.flags|=524288}else ts=ts.next=a;return s}var Jp=typeof AbortController<"u"?AbortController:function(){var t=[],a=this.signal={aborted:!1,addEventListener:function(s,n){t.push(n)}};this.abort=function(){a.aborted=!0,t.forEach(function(s){return s()})}},Ip=l.unstable_scheduleCallback,Kp=l.unstable_NormalPriority,Qt={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function mc(){return{controller:new Jp,data:new Map,refCount:0}}function _l(t){t.refCount--,t.refCount===0&&Ip(Kp,function(){t.controller.abort()})}var Nl=null,hc=0,Ln=0,Bn=null;function Wp(t,a){if(Nl===null){var s=Nl=[];hc=0,Ln=xo(),Bn={status:"pending",value:void 0,then:function(n){s.push(n)}}}return hc++,a.then(lu,lu),a}function lu(){if(--hc===0&&Nl!==null){Bn!==null&&(Bn.status="fulfilled");var t=Nl;Nl=null,Ln=0,Bn=null;for(var a=0;a<t.length;a++)(0,t[a])()}}function eg(t,a){var s=[],n={status:"pending",value:null,reason:null,then:function(r){s.push(r)}};return t.then(function(){n.status="fulfilled",n.value=a;for(var r=0;r<s.length;r++)(0,s[r])(a)},function(r){for(n.status="rejected",n.reason=r,r=0;r<s.length;r++)(0,s[r])(void 0)}),n}var ru=w.S;w.S=function(t,a){Vm=Se(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&Wp(t,a),ru!==null&&ru(t,a)};var rn=q(null);function fc(){var t=rn.current;return t!==null?t:kt.pooledCache}function Dr(t,a){a===null?$(rn,rn.current):$(rn,a.pool)}function iu(){var t=fc();return t===null?null:{parent:Qt._currentValue,pool:t}}var Fn=Error(c(460)),pc=Error(c(474)),Mr=Error(c(542)),Tr={then:function(){}};function cu(t){return t=t.status,t==="fulfilled"||t==="rejected"}function ou(t,a,s){switch(s=t[s],s===void 0?t.push(a):s!==a&&(a.then(Ia,Ia),a=s),a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,uu(t),t;default:if(typeof a.status=="string")a.then(Ia,Ia);else{if(t=kt,t!==null&&100<t.shellSuspendCounter)throw Error(c(482));t=a,t.status="pending",t.then(function(n){if(a.status==="pending"){var r=a;r.status="fulfilled",r.value=n}},function(n){if(a.status==="pending"){var r=a;r.status="rejected",r.reason=n}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,uu(t),t}throw on=a,Fn}}function cn(t){try{var a=t._init;return a(t._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(on=s,Fn):s}}var on=null;function du(){if(on===null)throw Error(c(459));var t=on;return on=null,t}function uu(t){if(t===Fn||t===Mr)throw Error(c(483))}var Hn=null,Sl=0;function Ar(t){var a=Sl;return Sl+=1,Hn===null&&(Hn=[]),ou(Hn,t,a)}function Cl(t,a){a=a.props.ref,t.ref=a!==void 0?a:null}function Rr(t,a){throw a.$$typeof===Y?Error(c(525)):(t=Object.prototype.toString.call(a),Error(c(31,t==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":t)))}function mu(t){function a(W,G){if(t){var le=W.deletions;le===null?(W.deletions=[G],W.flags|=16):le.push(G)}}function s(W,G){if(!t)return null;for(;G!==null;)a(W,G),G=G.sibling;return null}function n(W){for(var G=new Map;W!==null;)W.key!==null?G.set(W.key,W):G.set(W.index,W),W=W.sibling;return G}function r(W,G){return W=Wa(W,G),W.index=0,W.sibling=null,W}function d(W,G,le){return W.index=le,t?(le=W.alternate,le!==null?(le=le.index,le<G?(W.flags|=67108866,G):le):(W.flags|=67108866,G)):(W.flags|=1048576,G)}function h(W){return t&&W.alternate===null&&(W.flags|=67108866),W}function b(W,G,le,ge){return G===null||G.tag!==6?(G=sc(le,W.mode,ge),G.return=W,G):(G=r(G,le),G.return=W,G)}function R(W,G,le,ge){var $e=le.type;return $e===U?fe(W,G,le.props.children,ge,le.key):G!==null&&(G.elementType===$e||typeof $e=="object"&&$e!==null&&$e.$$typeof===Q&&cn($e)===G.type)?(G=r(G,le.props),Cl(G,le),G.return=W,G):(G=Cr(le.type,le.key,le.props,null,W.mode,ge),Cl(G,le),G.return=W,G)}function ie(W,G,le,ge){return G===null||G.tag!==4||G.stateNode.containerInfo!==le.containerInfo||G.stateNode.implementation!==le.implementation?(G=nc(le,W.mode,ge),G.return=W,G):(G=r(G,le.children||[]),G.return=W,G)}function fe(W,G,le,ge,$e){return G===null||G.tag!==7?(G=an(le,W.mode,ge,$e),G.return=W,G):(G=r(G,le),G.return=W,G)}function ve(W,G,le){if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return G=sc(""+G,W.mode,le),G.return=W,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case B:return le=Cr(G.type,G.key,G.props,null,W.mode,le),Cl(le,G),le.return=W,le;case H:return G=nc(G,W.mode,le),G.return=W,G;case Q:return G=cn(G),ve(W,G,le)}if(ee(G)||j(G))return G=an(G,W.mode,le,null),G.return=W,G;if(typeof G.then=="function")return ve(W,Ar(G),le);if(G.$$typeof===D)return ve(W,Er(W,G),le);Rr(W,G)}return null}function oe(W,G,le,ge){var $e=G!==null?G.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return $e!==null?null:b(W,G,""+le,ge);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case B:return le.key===$e?R(W,G,le,ge):null;case H:return le.key===$e?ie(W,G,le,ge):null;case Q:return le=cn(le),oe(W,G,le,ge)}if(ee(le)||j(le))return $e!==null?null:fe(W,G,le,ge,null);if(typeof le.then=="function")return oe(W,G,Ar(le),ge);if(le.$$typeof===D)return oe(W,G,Er(W,le),ge);Rr(W,le)}return null}function me(W,G,le,ge,$e){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return W=W.get(le)||null,b(G,W,""+ge,$e);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case B:return W=W.get(ge.key===null?le:ge.key)||null,R(G,W,ge,$e);case H:return W=W.get(ge.key===null?le:ge.key)||null,ie(G,W,ge,$e);case Q:return ge=cn(ge),me(W,G,le,ge,$e)}if(ee(ge)||j(ge))return W=W.get(le)||null,fe(G,W,ge,$e,null);if(typeof ge.then=="function")return me(W,G,le,Ar(ge),$e);if(ge.$$typeof===D)return me(W,G,le,Er(G,ge),$e);Rr(G,ge)}return null}function qe(W,G,le,ge){for(var $e=null,ht=null,Le=G,Ke=G=0,it=null;Le!==null&&Ke<le.length;Ke++){Le.index>Ke?(it=Le,Le=null):it=Le.sibling;var ft=oe(W,Le,le[Ke],ge);if(ft===null){Le===null&&(Le=it);break}t&&Le&&ft.alternate===null&&a(W,Le),G=d(ft,G,Ke),ht===null?$e=ft:ht.sibling=ft,ht=ft,Le=it}if(Ke===le.length)return s(W,Le),ot&&es(W,Ke),$e;if(Le===null){for(;Ke<le.length;Ke++)Le=ve(W,le[Ke],ge),Le!==null&&(G=d(Le,G,Ke),ht===null?$e=Le:ht.sibling=Le,ht=Le);return ot&&es(W,Ke),$e}for(Le=n(Le);Ke<le.length;Ke++)it=me(Le,W,Ke,le[Ke],ge),it!==null&&(t&&it.alternate!==null&&Le.delete(it.key===null?Ke:it.key),G=d(it,G,Ke),ht===null?$e=it:ht.sibling=it,ht=it);return t&&Le.forEach(function($s){return a(W,$s)}),ot&&es(W,Ke),$e}function Ge(W,G,le,ge){if(le==null)throw Error(c(151));for(var $e=null,ht=null,Le=G,Ke=G=0,it=null,ft=le.next();Le!==null&&!ft.done;Ke++,ft=le.next()){Le.index>Ke?(it=Le,Le=null):it=Le.sibling;var $s=oe(W,Le,ft.value,ge);if($s===null){Le===null&&(Le=it);break}t&&Le&&$s.alternate===null&&a(W,Le),G=d($s,G,Ke),ht===null?$e=$s:ht.sibling=$s,ht=$s,Le=it}if(ft.done)return s(W,Le),ot&&es(W,Ke),$e;if(Le===null){for(;!ft.done;Ke++,ft=le.next())ft=ve(W,ft.value,ge),ft!==null&&(G=d(ft,G,Ke),ht===null?$e=ft:ht.sibling=ft,ht=ft);return ot&&es(W,Ke),$e}for(Le=n(Le);!ft.done;Ke++,ft=le.next())ft=me(Le,W,Ke,ft.value,ge),ft!==null&&(t&&ft.alternate!==null&&Le.delete(ft.key===null?Ke:ft.key),G=d(ft,G,Ke),ht===null?$e=ft:ht.sibling=ft,ht=ft);return t&&Le.forEach(function(ux){return a(W,ux)}),ot&&es(W,Ke),$e}function Ct(W,G,le,ge){if(typeof le=="object"&&le!==null&&le.type===U&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case B:e:{for(var $e=le.key;G!==null;){if(G.key===$e){if($e=le.type,$e===U){if(G.tag===7){s(W,G.sibling),ge=r(G,le.props.children),ge.return=W,W=ge;break e}}else if(G.elementType===$e||typeof $e=="object"&&$e!==null&&$e.$$typeof===Q&&cn($e)===G.type){s(W,G.sibling),ge=r(G,le.props),Cl(ge,le),ge.return=W,W=ge;break e}s(W,G);break}else a(W,G);G=G.sibling}le.type===U?(ge=an(le.props.children,W.mode,ge,le.key),ge.return=W,W=ge):(ge=Cr(le.type,le.key,le.props,null,W.mode,ge),Cl(ge,le),ge.return=W,W=ge)}return h(W);case H:e:{for($e=le.key;G!==null;){if(G.key===$e)if(G.tag===4&&G.stateNode.containerInfo===le.containerInfo&&G.stateNode.implementation===le.implementation){s(W,G.sibling),ge=r(G,le.children||[]),ge.return=W,W=ge;break e}else{s(W,G);break}else a(W,G);G=G.sibling}ge=nc(le,W.mode,ge),ge.return=W,W=ge}return h(W);case Q:return le=cn(le),Ct(W,G,le,ge)}if(ee(le))return qe(W,G,le,ge);if(j(le)){if($e=j(le),typeof $e!="function")throw Error(c(150));return le=$e.call(le),Ge(W,G,le,ge)}if(typeof le.then=="function")return Ct(W,G,Ar(le),ge);if(le.$$typeof===D)return Ct(W,G,Er(W,le),ge);Rr(W,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,G!==null&&G.tag===6?(s(W,G.sibling),ge=r(G,le),ge.return=W,W=ge):(s(W,G),ge=sc(le,W.mode,ge),ge.return=W,W=ge),h(W)):s(W,G)}return function(W,G,le,ge){try{Sl=0;var $e=Ct(W,G,le,ge);return Hn=null,$e}catch(Le){if(Le===Fn||Le===Mr)throw Le;var ht=ga(29,Le,null,W.mode);return ht.lanes=ge,ht.return=W,ht}finally{}}}var dn=mu(!0),hu=mu(!1),Cs=!1;function gc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function xc(t,a){t=t.updateQueue,a.updateQueue===t&&(a.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function ws(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function ks(t,a,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(gt&2)!==0){var r=n.pending;return r===null?a.next=a:(a.next=r.next,r.next=a),n.pending=a,a=Sr(t),Jd(t,null,s),a}return Nr(t,n,a,s),Sr(t)}function wl(t,a,s){if(a=a.updateQueue,a!==null&&(a=a.shared,(s&4194048)!==0)){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,vt(t,s)}}function jc(t,a){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var r=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var h={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};d===null?r=d=h:d=d.next=h,s=s.next}while(s!==null);d===null?r=d=a:d=d.next=a}else r=d=a;s={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:d,shared:n.shared,callbacks:n.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=a:t.next=a,s.lastBaseUpdate=a}var vc=!1;function kl(){if(vc){var t=Bn;if(t!==null)throw t}}function El(t,a,s,n){vc=!1;var r=t.updateQueue;Cs=!1;var d=r.firstBaseUpdate,h=r.lastBaseUpdate,b=r.shared.pending;if(b!==null){r.shared.pending=null;var R=b,ie=R.next;R.next=null,h===null?d=ie:h.next=ie,h=R;var fe=t.alternate;fe!==null&&(fe=fe.updateQueue,b=fe.lastBaseUpdate,b!==h&&(b===null?fe.firstBaseUpdate=ie:b.next=ie,fe.lastBaseUpdate=R))}if(d!==null){var ve=r.baseState;h=0,fe=ie=R=null,b=d;do{var oe=b.lane&-536870913,me=oe!==b.lane;if(me?(rt&oe)===oe:(n&oe)===oe){oe!==0&&oe===Ln&&(vc=!0),fe!==null&&(fe=fe.next={lane:0,tag:b.tag,payload:b.payload,callback:null,next:null});e:{var qe=t,Ge=b;oe=a;var Ct=s;switch(Ge.tag){case 1:if(qe=Ge.payload,typeof qe=="function"){ve=qe.call(Ct,ve,oe);break e}ve=qe;break e;case 3:qe.flags=qe.flags&-65537|128;case 0:if(qe=Ge.payload,oe=typeof qe=="function"?qe.call(Ct,ve,oe):qe,oe==null)break e;ve=A({},ve,oe);break e;case 2:Cs=!0}}oe=b.callback,oe!==null&&(t.flags|=64,me&&(t.flags|=8192),me=r.callbacks,me===null?r.callbacks=[oe]:me.push(oe))}else me={lane:oe,tag:b.tag,payload:b.payload,callback:b.callback,next:null},fe===null?(ie=fe=me,R=ve):fe=fe.next=me,h|=oe;if(b=b.next,b===null){if(b=r.shared.pending,b===null)break;me=b,b=me.next,me.next=null,r.lastBaseUpdate=me,r.shared.pending=null}}while(!0);fe===null&&(R=ve),r.baseState=R,r.firstBaseUpdate=ie,r.lastBaseUpdate=fe,d===null&&(r.shared.lanes=0),As|=h,t.lanes=h,t.memoizedState=ve}}function fu(t,a){if(typeof t!="function")throw Error(c(191,t));t.call(a)}function pu(t,a){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)fu(s[t],a)}var $n=q(null),zr=q(0);function gu(t,a){t=us,$(zr,t),$($n,a),us=t|a.baseLanes}function yc(){$(zr,us),$($n,$n.current)}function bc(){us=zr.current,L($n),L(zr)}var xa=q(null),Ma=null;function Es(t){var a=t.alternate;$(Ft,Ft.current&1),$(xa,t),Ma===null&&(a===null||$n.current!==null||a.memoizedState!==null)&&(Ma=t)}function _c(t){$(Ft,Ft.current),$(xa,t),Ma===null&&(Ma=t)}function xu(t){t.tag===22?($(Ft,Ft.current),$(xa,t),Ma===null&&(Ma=t)):Ds()}function Ds(){$(Ft,Ft.current),$(xa,xa.current)}function ja(t){L(xa),Ma===t&&(Ma=null),L(Ft)}var Ft=q(0);function qr(t){for(var a=t;a!==null;){if(a.tag===13){var s=a.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||Do(s)||Mo(s)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ss=0,Je=null,Nt=null,Xt=null,Or=!1,Vn=!1,un=!1,Ur=0,Dl=0,Gn=null,tg=0;function qt(){throw Error(c(321))}function Nc(t,a){if(a===null)return!1;for(var s=0;s<a.length&&s<t.length;s++)if(!pa(t[s],a[s]))return!1;return!0}function Sc(t,a,s,n,r,d){return ss=d,Je=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,w.H=t===null||t.memoizedState===null?em:Bc,un=!1,d=s(n,r),un=!1,Vn&&(d=vu(a,s,n,r)),ju(t),d}function ju(t){w.H=Al;var a=Nt!==null&&Nt.next!==null;if(ss=0,Xt=Nt=Je=null,Or=!1,Dl=0,Gn=null,a)throw Error(c(300));t===null||Zt||(t=t.dependencies,t!==null&&kr(t)&&(Zt=!0))}function vu(t,a,s,n){Je=t;var r=0;do{if(Vn&&(Gn=null),Dl=0,Vn=!1,25<=r)throw Error(c(301));if(r+=1,Xt=Nt=null,t.updateQueue!=null){var d=t.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}w.H=tm,d=a(s,n)}while(Vn);return d}function ag(){var t=w.H,a=t.useState()[0];return a=typeof a.then=="function"?Ml(a):a,t=t.useState()[0],(Nt!==null?Nt.memoizedState:null)!==t&&(Je.flags|=1024),a}function Cc(){var t=Ur!==0;return Ur=0,t}function wc(t,a,s){a.updateQueue=t.updateQueue,a.flags&=-2053,t.lanes&=~s}function kc(t){if(Or){for(t=t.memoizedState;t!==null;){var a=t.queue;a!==null&&(a.pending=null),t=t.next}Or=!1}ss=0,Xt=Nt=Je=null,Vn=!1,Dl=Ur=0,Gn=null}function ia(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xt===null?Je.memoizedState=Xt=t:Xt=Xt.next=t,Xt}function Ht(){if(Nt===null){var t=Je.alternate;t=t!==null?t.memoizedState:null}else t=Nt.next;var a=Xt===null?Je.memoizedState:Xt.next;if(a!==null)Xt=a,Nt=t;else{if(t===null)throw Je.alternate===null?Error(c(467)):Error(c(310));Nt=t,t={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},Xt===null?Je.memoizedState=Xt=t:Xt=Xt.next=t}return Xt}function Lr(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ml(t){var a=Dl;return Dl+=1,Gn===null&&(Gn=[]),t=ou(Gn,t,a),a=Je,(Xt===null?a.memoizedState:Xt.next)===null&&(a=a.alternate,w.H=a===null||a.memoizedState===null?em:Bc),t}function Br(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Ml(t);if(t.$$typeof===D)return ea(t)}throw Error(c(438,String(t)))}function Ec(t){var a=null,s=Je.updateQueue;if(s!==null&&(a=s.memoCache),a==null){var n=Je.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(a={data:n.data.map(function(r){return r.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),s===null&&(s=Lr(),Je.updateQueue=s),s.memoCache=a,s=a.data[a.index],s===void 0)for(s=a.data[a.index]=Array(t),n=0;n<t;n++)s[n]=I;return a.index++,s}function ns(t,a){return typeof a=="function"?a(t):a}function Fr(t){var a=Ht();return Dc(a,Nt,t)}function Dc(t,a,s){var n=t.queue;if(n===null)throw Error(c(311));n.lastRenderedReducer=s;var r=t.baseQueue,d=n.pending;if(d!==null){if(r!==null){var h=r.next;r.next=d.next,d.next=h}a.baseQueue=r=d,n.pending=null}if(d=t.baseState,r===null)t.memoizedState=d;else{a=r.next;var b=h=null,R=null,ie=a,fe=!1;do{var ve=ie.lane&-536870913;if(ve!==ie.lane?(rt&ve)===ve:(ss&ve)===ve){var oe=ie.revertLane;if(oe===0)R!==null&&(R=R.next={lane:0,revertLane:0,gesture:null,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null}),ve===Ln&&(fe=!0);else if((ss&oe)===oe){ie=ie.next,oe===Ln&&(fe=!0);continue}else ve={lane:0,revertLane:ie.revertLane,gesture:null,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},R===null?(b=R=ve,h=d):R=R.next=ve,Je.lanes|=oe,As|=oe;ve=ie.action,un&&s(d,ve),d=ie.hasEagerState?ie.eagerState:s(d,ve)}else oe={lane:ve,revertLane:ie.revertLane,gesture:ie.gesture,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null},R===null?(b=R=oe,h=d):R=R.next=oe,Je.lanes|=ve,As|=ve;ie=ie.next}while(ie!==null&&ie!==a);if(R===null?h=d:R.next=b,!pa(d,t.memoizedState)&&(Zt=!0,fe&&(s=Bn,s!==null)))throw s;t.memoizedState=d,t.baseState=h,t.baseQueue=R,n.lastRenderedState=d}return r===null&&(n.lanes=0),[t.memoizedState,n.dispatch]}function Mc(t){var a=Ht(),s=a.queue;if(s===null)throw Error(c(311));s.lastRenderedReducer=t;var n=s.dispatch,r=s.pending,d=a.memoizedState;if(r!==null){s.pending=null;var h=r=r.next;do d=t(d,h.action),h=h.next;while(h!==r);pa(d,a.memoizedState)||(Zt=!0),a.memoizedState=d,a.baseQueue===null&&(a.baseState=d),s.lastRenderedState=d}return[d,n]}function yu(t,a,s){var n=Je,r=Ht(),d=ot;if(d){if(s===void 0)throw Error(c(407));s=s()}else s=a();var h=!pa((Nt||r).memoizedState,s);if(h&&(r.memoizedState=s,Zt=!0),r=r.queue,Rc(Nu.bind(null,n,r,t),[t]),r.getSnapshot!==a||h||Xt!==null&&Xt.memoizedState.tag&1){if(n.flags|=2048,Yn(9,{destroy:void 0},_u.bind(null,n,r,s,a),null),kt===null)throw Error(c(349));d||(ss&127)!==0||bu(n,a,s)}return s}function bu(t,a,s){t.flags|=16384,t={getSnapshot:a,value:s},a=Je.updateQueue,a===null?(a=Lr(),Je.updateQueue=a,a.stores=[t]):(s=a.stores,s===null?a.stores=[t]:s.push(t))}function _u(t,a,s,n){a.value=s,a.getSnapshot=n,Su(a)&&Cu(t)}function Nu(t,a,s){return s(function(){Su(a)&&Cu(t)})}function Su(t){var a=t.getSnapshot;t=t.value;try{var s=a();return!pa(t,s)}catch{return!0}}function Cu(t){var a=tn(t,2);a!==null&&ha(a,t,2)}function Tc(t){var a=ia();if(typeof t=="function"){var s=t;if(t=s(),un){xt(!0);try{s()}finally{xt(!1)}}}return a.memoizedState=a.baseState=t,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ns,lastRenderedState:t},a}function wu(t,a,s,n){return t.baseState=s,Dc(t,Nt,typeof n=="function"?n:ns)}function sg(t,a,s,n,r){if(Vr(t))throw Error(c(485));if(t=a.action,t!==null){var d={payload:r,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(h){d.listeners.push(h)}};w.T!==null?s(!0):d.isTransition=!1,n(d),s=a.pending,s===null?(d.next=a.pending=d,ku(a,d)):(d.next=s.next,a.pending=s.next=d)}}function ku(t,a){var s=a.action,n=a.payload,r=t.state;if(a.isTransition){var d=w.T,h={};w.T=h;try{var b=s(r,n),R=w.S;R!==null&&R(h,b),Eu(t,a,b)}catch(ie){Ac(t,a,ie)}finally{d!==null&&h.types!==null&&(d.types=h.types),w.T=d}}else try{d=s(r,n),Eu(t,a,d)}catch(ie){Ac(t,a,ie)}}function Eu(t,a,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(n){Du(t,a,n)},function(n){return Ac(t,a,n)}):Du(t,a,s)}function Du(t,a,s){a.status="fulfilled",a.value=s,Mu(a),t.state=s,a=t.pending,a!==null&&(s=a.next,s===a?t.pending=null:(s=s.next,a.next=s,ku(t,s)))}function Ac(t,a,s){var n=t.pending;if(t.pending=null,n!==null){n=n.next;do a.status="rejected",a.reason=s,Mu(a),a=a.next;while(a!==n)}t.action=null}function Mu(t){t=t.listeners;for(var a=0;a<t.length;a++)(0,t[a])()}function Tu(t,a){return a}function Au(t,a){if(ot){var s=kt.formState;if(s!==null){e:{var n=Je;if(ot){if(Tt){t:{for(var r=Tt,d=Da;r.nodeType!==8;){if(!d){r=null;break t}if(r=Ta(r.nextSibling),r===null){r=null;break t}}d=r.data,r=d==="F!"||d==="F"?r:null}if(r){Tt=Ta(r.nextSibling),n=r.data==="F!";break e}}Ns(n)}n=!1}n&&(a=s[0])}}return s=ia(),s.memoizedState=s.baseState=a,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tu,lastRenderedState:a},s.queue=n,s=Iu.bind(null,Je,n),n.dispatch=s,n=Tc(!1),d=Lc.bind(null,Je,!1,n.queue),n=ia(),r={state:a,dispatch:null,action:t,pending:null},n.queue=r,s=sg.bind(null,Je,r,d,s),r.dispatch=s,n.memoizedState=t,[a,s,!1]}function Ru(t){var a=Ht();return zu(a,Nt,t)}function zu(t,a,s){if(a=Dc(t,a,Tu)[0],t=Fr(ns)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var n=Ml(a)}catch(h){throw h===Fn?Mr:h}else n=a;a=Ht();var r=a.queue,d=r.dispatch;return s!==a.memoizedState&&(Je.flags|=2048,Yn(9,{destroy:void 0},ng.bind(null,r,s),null)),[n,d,t]}function ng(t,a){t.action=a}function qu(t){var a=Ht(),s=Nt;if(s!==null)return zu(a,s,t);Ht(),a=a.memoizedState,s=Ht();var n=s.queue.dispatch;return s.memoizedState=t,[a,n,!1]}function Yn(t,a,s,n){return t={tag:t,create:s,deps:n,inst:a,next:null},a=Je.updateQueue,a===null&&(a=Lr(),Je.updateQueue=a),s=a.lastEffect,s===null?a.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,a.lastEffect=t),t}function Ou(){return Ht().memoizedState}function Hr(t,a,s,n){var r=ia();Je.flags|=t,r.memoizedState=Yn(1|a,{destroy:void 0},s,n===void 0?null:n)}function $r(t,a,s,n){var r=Ht();n=n===void 0?null:n;var d=r.memoizedState.inst;Nt!==null&&n!==null&&Nc(n,Nt.memoizedState.deps)?r.memoizedState=Yn(a,d,s,n):(Je.flags|=t,r.memoizedState=Yn(1|a,d,s,n))}function Uu(t,a){Hr(8390656,8,t,a)}function Rc(t,a){$r(2048,8,t,a)}function lg(t){Je.flags|=4;var a=Je.updateQueue;if(a===null)a=Lr(),Je.updateQueue=a,a.events=[t];else{var s=a.events;s===null?a.events=[t]:s.push(t)}}function Lu(t){var a=Ht().memoizedState;return lg({ref:a,nextImpl:t}),function(){if((gt&2)!==0)throw Error(c(440));return a.impl.apply(void 0,arguments)}}function Bu(t,a){return $r(4,2,t,a)}function Fu(t,a){return $r(4,4,t,a)}function Hu(t,a){if(typeof a=="function"){t=t();var s=a(t);return function(){typeof s=="function"?s():a(null)}}if(a!=null)return t=t(),a.current=t,function(){a.current=null}}function $u(t,a,s){s=s!=null?s.concat([t]):null,$r(4,4,Hu.bind(null,a,t),s)}function zc(){}function Vu(t,a){var s=Ht();a=a===void 0?null:a;var n=s.memoizedState;return a!==null&&Nc(a,n[1])?n[0]:(s.memoizedState=[t,a],t)}function Gu(t,a){var s=Ht();a=a===void 0?null:a;var n=s.memoizedState;if(a!==null&&Nc(a,n[1]))return n[0];if(n=t(),un){xt(!0);try{t()}finally{xt(!1)}}return s.memoizedState=[n,a],n}function qc(t,a,s){return s===void 0||(ss&1073741824)!==0&&(rt&261930)===0?t.memoizedState=a:(t.memoizedState=s,t=Ym(),Je.lanes|=t,As|=t,s)}function Yu(t,a,s,n){return pa(s,a)?s:$n.current!==null?(t=qc(t,s,n),pa(t,a)||(Zt=!0),t):(ss&42)===0||(ss&1073741824)!==0&&(rt&261930)===0?(Zt=!0,t.memoizedState=s):(t=Ym(),Je.lanes|=t,As|=t,a)}function Qu(t,a,s,n,r){var d=k.p;k.p=d!==0&&8>d?d:8;var h=w.T,b={};w.T=b,Lc(t,!1,a,s);try{var R=r(),ie=w.S;if(ie!==null&&ie(b,R),R!==null&&typeof R=="object"&&typeof R.then=="function"){var fe=eg(R,n);Tl(t,a,fe,ba(t))}else Tl(t,a,n,ba(t))}catch(ve){Tl(t,a,{then:function(){},status:"rejected",reason:ve},ba())}finally{k.p=d,h!==null&&b.types!==null&&(h.types=b.types),w.T=h}}function rg(){}function Oc(t,a,s,n){if(t.tag!==5)throw Error(c(476));var r=Xu(t).queue;Qu(t,r,a,M,s===null?rg:function(){return Zu(t),s(n)})}function Xu(t){var a=t.memoizedState;if(a!==null)return a;a={memoizedState:M,baseState:M,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ns,lastRenderedState:M},next:null};var s={};return a.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ns,lastRenderedState:s},next:null},t.memoizedState=a,t=t.alternate,t!==null&&(t.memoizedState=a),a}function Zu(t){var a=Xu(t);a.next===null&&(a=t.alternate.memoizedState),Tl(t,a.next.queue,{},ba())}function Uc(){return ea(Zl)}function Pu(){return Ht().memoizedState}function Ju(){return Ht().memoizedState}function ig(t){for(var a=t.return;a!==null;){switch(a.tag){case 24:case 3:var s=ba();t=ws(s);var n=ks(a,t,s);n!==null&&(ha(n,a,s),wl(n,a,s)),a={cache:mc()},t.payload=a;return}a=a.return}}function cg(t,a,s){var n=ba();s={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},Vr(t)?Ku(a,s):(s=tc(t,a,s,n),s!==null&&(ha(s,t,n),Wu(s,a,n)))}function Iu(t,a,s){var n=ba();Tl(t,a,s,n)}function Tl(t,a,s,n){var r={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(Vr(t))Ku(a,r);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=a.lastRenderedReducer,d!==null))try{var h=a.lastRenderedState,b=d(h,s);if(r.hasEagerState=!0,r.eagerState=b,pa(b,h))return Nr(t,a,r,0),kt===null&&_r(),!1}catch{}finally{}if(s=tc(t,a,r,n),s!==null)return ha(s,t,n),Wu(s,a,n),!0}return!1}function Lc(t,a,s,n){if(n={lane:2,revertLane:xo(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Vr(t)){if(a)throw Error(c(479))}else a=tc(t,s,n,2),a!==null&&ha(a,t,2)}function Vr(t){var a=t.alternate;return t===Je||a!==null&&a===Je}function Ku(t,a){Vn=Or=!0;var s=t.pending;s===null?a.next=a:(a.next=s.next,s.next=a),t.pending=a}function Wu(t,a,s){if((s&4194048)!==0){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,vt(t,s)}}var Al={readContext:ea,use:Br,useCallback:qt,useContext:qt,useEffect:qt,useImperativeHandle:qt,useLayoutEffect:qt,useInsertionEffect:qt,useMemo:qt,useReducer:qt,useRef:qt,useState:qt,useDebugValue:qt,useDeferredValue:qt,useTransition:qt,useSyncExternalStore:qt,useId:qt,useHostTransitionStatus:qt,useFormState:qt,useActionState:qt,useOptimistic:qt,useMemoCache:qt,useCacheRefresh:qt};Al.useEffectEvent=qt;var em={readContext:ea,use:Br,useCallback:function(t,a){return ia().memoizedState=[t,a===void 0?null:a],t},useContext:ea,useEffect:Uu,useImperativeHandle:function(t,a,s){s=s!=null?s.concat([t]):null,Hr(4194308,4,Hu.bind(null,a,t),s)},useLayoutEffect:function(t,a){return Hr(4194308,4,t,a)},useInsertionEffect:function(t,a){Hr(4,2,t,a)},useMemo:function(t,a){var s=ia();a=a===void 0?null:a;var n=t();if(un){xt(!0);try{t()}finally{xt(!1)}}return s.memoizedState=[n,a],n},useReducer:function(t,a,s){var n=ia();if(s!==void 0){var r=s(a);if(un){xt(!0);try{s(a)}finally{xt(!1)}}}else r=a;return n.memoizedState=n.baseState=r,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:r},n.queue=t,t=t.dispatch=cg.bind(null,Je,t),[n.memoizedState,t]},useRef:function(t){var a=ia();return t={current:t},a.memoizedState=t},useState:function(t){t=Tc(t);var a=t.queue,s=Iu.bind(null,Je,a);return a.dispatch=s,[t.memoizedState,s]},useDebugValue:zc,useDeferredValue:function(t,a){var s=ia();return qc(s,t,a)},useTransition:function(){var t=Tc(!1);return t=Qu.bind(null,Je,t.queue,!0,!1),ia().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,a,s){var n=Je,r=ia();if(ot){if(s===void 0)throw Error(c(407));s=s()}else{if(s=a(),kt===null)throw Error(c(349));(rt&127)!==0||bu(n,a,s)}r.memoizedState=s;var d={value:s,getSnapshot:a};return r.queue=d,Uu(Nu.bind(null,n,d,t),[t]),n.flags|=2048,Yn(9,{destroy:void 0},_u.bind(null,n,d,s,a),null),s},useId:function(){var t=ia(),a=kt.identifierPrefix;if(ot){var s=$a,n=Ha;s=(n&~(1<<32-jt(n)-1)).toString(32)+s,a="_"+a+"R_"+s,s=Ur++,0<s&&(a+="H"+s.toString(32)),a+="_"}else s=tg++,a="_"+a+"r_"+s.toString(32)+"_";return t.memoizedState=a},useHostTransitionStatus:Uc,useFormState:Au,useActionState:Au,useOptimistic:function(t){var a=ia();a.memoizedState=a.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=s,a=Lc.bind(null,Je,!0,s),s.dispatch=a,[t,a]},useMemoCache:Ec,useCacheRefresh:function(){return ia().memoizedState=ig.bind(null,Je)},useEffectEvent:function(t){var a=ia(),s={impl:t};return a.memoizedState=s,function(){if((gt&2)!==0)throw Error(c(440));return s.impl.apply(void 0,arguments)}}},Bc={readContext:ea,use:Br,useCallback:Vu,useContext:ea,useEffect:Rc,useImperativeHandle:$u,useInsertionEffect:Bu,useLayoutEffect:Fu,useMemo:Gu,useReducer:Fr,useRef:Ou,useState:function(){return Fr(ns)},useDebugValue:zc,useDeferredValue:function(t,a){var s=Ht();return Yu(s,Nt.memoizedState,t,a)},useTransition:function(){var t=Fr(ns)[0],a=Ht().memoizedState;return[typeof t=="boolean"?t:Ml(t),a]},useSyncExternalStore:yu,useId:Pu,useHostTransitionStatus:Uc,useFormState:Ru,useActionState:Ru,useOptimistic:function(t,a){var s=Ht();return wu(s,Nt,t,a)},useMemoCache:Ec,useCacheRefresh:Ju};Bc.useEffectEvent=Lu;var tm={readContext:ea,use:Br,useCallback:Vu,useContext:ea,useEffect:Rc,useImperativeHandle:$u,useInsertionEffect:Bu,useLayoutEffect:Fu,useMemo:Gu,useReducer:Mc,useRef:Ou,useState:function(){return Mc(ns)},useDebugValue:zc,useDeferredValue:function(t,a){var s=Ht();return Nt===null?qc(s,t,a):Yu(s,Nt.memoizedState,t,a)},useTransition:function(){var t=Mc(ns)[0],a=Ht().memoizedState;return[typeof t=="boolean"?t:Ml(t),a]},useSyncExternalStore:yu,useId:Pu,useHostTransitionStatus:Uc,useFormState:qu,useActionState:qu,useOptimistic:function(t,a){var s=Ht();return Nt!==null?wu(s,Nt,t,a):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:Ec,useCacheRefresh:Ju};tm.useEffectEvent=Lu;function Fc(t,a,s,n){a=t.memoizedState,s=s(n,a),s=s==null?a:A({},a,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var Hc={enqueueSetState:function(t,a,s){t=t._reactInternals;var n=ba(),r=ws(n);r.payload=a,s!=null&&(r.callback=s),a=ks(t,r,n),a!==null&&(ha(a,t,n),wl(a,t,n))},enqueueReplaceState:function(t,a,s){t=t._reactInternals;var n=ba(),r=ws(n);r.tag=1,r.payload=a,s!=null&&(r.callback=s),a=ks(t,r,n),a!==null&&(ha(a,t,n),wl(a,t,n))},enqueueForceUpdate:function(t,a){t=t._reactInternals;var s=ba(),n=ws(s);n.tag=2,a!=null&&(n.callback=a),a=ks(t,n,s),a!==null&&(ha(a,t,s),wl(a,t,s))}};function am(t,a,s,n,r,d,h){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,d,h):a.prototype&&a.prototype.isPureReactComponent?!jl(s,n)||!jl(r,d):!0}function sm(t,a,s,n){t=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(s,n),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(s,n),a.state!==t&&Hc.enqueueReplaceState(a,a.state,null)}function mn(t,a){var s=a;if("ref"in a){s={};for(var n in a)n!=="ref"&&(s[n]=a[n])}if(t=t.defaultProps){s===a&&(s=A({},s));for(var r in t)s[r]===void 0&&(s[r]=t[r])}return s}function nm(t){br(t)}function lm(t){console.error(t)}function rm(t){br(t)}function Gr(t,a){try{var s=t.onUncaughtError;s(a.value,{componentStack:a.stack})}catch(n){setTimeout(function(){throw n})}}function im(t,a,s){try{var n=t.onCaughtError;n(s.value,{componentStack:s.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function $c(t,a,s){return s=ws(s),s.tag=3,s.payload={element:null},s.callback=function(){Gr(t,a)},s}function cm(t){return t=ws(t),t.tag=3,t}function om(t,a,s,n){var r=s.type.getDerivedStateFromError;if(typeof r=="function"){var d=n.value;t.payload=function(){return r(d)},t.callback=function(){im(a,s,n)}}var h=s.stateNode;h!==null&&typeof h.componentDidCatch=="function"&&(t.callback=function(){im(a,s,n),typeof r!="function"&&(Rs===null?Rs=new Set([this]):Rs.add(this));var b=n.stack;this.componentDidCatch(n.value,{componentStack:b!==null?b:""})})}function og(t,a,s,n,r){if(s.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(a=s.alternate,a!==null&&Un(a,s,r,!0),s=xa.current,s!==null){switch(s.tag){case 31:case 13:return Ma===null?ai():s.alternate===null&&Ot===0&&(Ot=3),s.flags&=-257,s.flags|=65536,s.lanes=r,n===Tr?s.flags|=16384:(a=s.updateQueue,a===null?s.updateQueue=new Set([n]):a.add(n),fo(t,n,r)),!1;case 22:return s.flags|=65536,n===Tr?s.flags|=16384:(a=s.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([n])},s.updateQueue=a):(s=a.retryQueue,s===null?a.retryQueue=new Set([n]):s.add(n)),fo(t,n,r)),!1}throw Error(c(435,s.tag))}return fo(t,n,r),ai(),!1}if(ot)return a=xa.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=r,n!==ic&&(t=Error(c(422),{cause:n}),bl(wa(t,s)))):(n!==ic&&(a=Error(c(423),{cause:n}),bl(wa(a,s))),t=t.current.alternate,t.flags|=65536,r&=-r,t.lanes|=r,n=wa(n,s),r=$c(t.stateNode,n,r),jc(t,r),Ot!==4&&(Ot=2)),!1;var d=Error(c(520),{cause:n});if(d=wa(d,s),Fl===null?Fl=[d]:Fl.push(d),Ot!==4&&(Ot=2),a===null)return!0;n=wa(n,s),s=a;do{switch(s.tag){case 3:return s.flags|=65536,t=r&-r,s.lanes|=t,t=$c(s.stateNode,n,t),jc(s,t),!1;case 1:if(a=s.type,d=s.stateNode,(s.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(Rs===null||!Rs.has(d))))return s.flags|=65536,r&=-r,s.lanes|=r,r=cm(r),om(r,t,s,n),jc(s,r),!1}s=s.return}while(s!==null);return!1}var Vc=Error(c(461)),Zt=!1;function ta(t,a,s,n){a.child=t===null?hu(a,null,s,n):dn(a,t.child,s,n)}function dm(t,a,s,n,r){s=s.render;var d=a.ref;if("ref"in n){var h={};for(var b in n)b!=="ref"&&(h[b]=n[b])}else h=n;return ln(a),n=Sc(t,a,s,h,d,r),b=Cc(),t!==null&&!Zt?(wc(t,a,r),ls(t,a,r)):(ot&&b&&lc(a),a.flags|=1,ta(t,a,n,r),a.child)}function um(t,a,s,n,r){if(t===null){var d=s.type;return typeof d=="function"&&!ac(d)&&d.defaultProps===void 0&&s.compare===null?(a.tag=15,a.type=d,mm(t,a,d,n,r)):(t=Cr(s.type,null,n,a,a.mode,r),t.ref=a.ref,t.return=a,a.child=t)}if(d=t.child,!Ic(t,r)){var h=d.memoizedProps;if(s=s.compare,s=s!==null?s:jl,s(h,n)&&t.ref===a.ref)return ls(t,a,r)}return a.flags|=1,t=Wa(d,n),t.ref=a.ref,t.return=a,a.child=t}function mm(t,a,s,n,r){if(t!==null){var d=t.memoizedProps;if(jl(d,n)&&t.ref===a.ref)if(Zt=!1,a.pendingProps=n=d,Ic(t,r))(t.flags&131072)!==0&&(Zt=!0);else return a.lanes=t.lanes,ls(t,a,r)}return Gc(t,a,s,n,r)}function hm(t,a,s,n){var r=n.children,d=t!==null?t.memoizedState:null;if(t===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((a.flags&128)!==0){if(d=d!==null?d.baseLanes|s:s,t!==null){for(n=a.child=t.child,r=0;n!==null;)r=r|n.lanes|n.childLanes,n=n.sibling;n=r&~d}else n=0,a.child=null;return fm(t,a,d,s,n)}if((s&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},t!==null&&Dr(a,d!==null?d.cachePool:null),d!==null?gu(a,d):yc(),xu(a);else return n=a.lanes=536870912,fm(t,a,d!==null?d.baseLanes|s:s,s,n)}else d!==null?(Dr(a,d.cachePool),gu(a,d),Ds(),a.memoizedState=null):(t!==null&&Dr(a,null),yc(),Ds());return ta(t,a,r,s),a.child}function Rl(t,a){return t!==null&&t.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function fm(t,a,s,n,r){var d=fc();return d=d===null?null:{parent:Qt._currentValue,pool:d},a.memoizedState={baseLanes:s,cachePool:d},t!==null&&Dr(a,null),yc(),xu(a),t!==null&&Un(t,a,n,!0),a.childLanes=r,null}function Yr(t,a){return a=Xr({mode:a.mode,children:a.children},t.mode),a.ref=t.ref,t.child=a,a.return=t,a}function pm(t,a,s){return dn(a,t.child,null,s),t=Yr(a,a.pendingProps),t.flags|=2,ja(a),a.memoizedState=null,t}function dg(t,a,s){var n=a.pendingProps,r=(a.flags&128)!==0;if(a.flags&=-129,t===null){if(ot){if(n.mode==="hidden")return t=Yr(a,n),a.lanes=536870912,Rl(null,t);if(_c(a),(t=Tt)?(t=kh(t,Da),t=t!==null&&t.data==="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:bs!==null?{id:Ha,overflow:$a}:null,retryLane:536870912,hydrationErrors:null},s=Kd(t),s.return=a,a.child=s,Wt=a,Tt=null)):t=null,t===null)throw Ns(a);return a.lanes=536870912,null}return Yr(a,n)}var d=t.memoizedState;if(d!==null){var h=d.dehydrated;if(_c(a),r)if(a.flags&256)a.flags&=-257,a=pm(t,a,s);else if(a.memoizedState!==null)a.child=t.child,a.flags|=128,a=null;else throw Error(c(558));else if(Zt||Un(t,a,s,!1),r=(s&t.childLanes)!==0,Zt||r){if(n=kt,n!==null&&(h=Re(n,s),h!==0&&h!==d.retryLane))throw d.retryLane=h,tn(t,h),ha(n,t,h),Vc;ai(),a=pm(t,a,s)}else t=d.treeContext,Tt=Ta(h.nextSibling),Wt=a,ot=!0,_s=null,Da=!1,t!==null&&tu(a,t),a=Yr(a,n),a.flags|=4096;return a}return t=Wa(t.child,{mode:n.mode,children:n.children}),t.ref=a.ref,a.child=t,t.return=a,t}function Qr(t,a){var s=a.ref;if(s===null)t!==null&&t.ref!==null&&(a.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(c(284));(t===null||t.ref!==s)&&(a.flags|=4194816)}}function Gc(t,a,s,n,r){return ln(a),s=Sc(t,a,s,n,void 0,r),n=Cc(),t!==null&&!Zt?(wc(t,a,r),ls(t,a,r)):(ot&&n&&lc(a),a.flags|=1,ta(t,a,s,r),a.child)}function gm(t,a,s,n,r,d){return ln(a),a.updateQueue=null,s=vu(a,n,s,r),ju(t),n=Cc(),t!==null&&!Zt?(wc(t,a,d),ls(t,a,d)):(ot&&n&&lc(a),a.flags|=1,ta(t,a,s,d),a.child)}function xm(t,a,s,n,r){if(ln(a),a.stateNode===null){var d=Rn,h=s.contextType;typeof h=="object"&&h!==null&&(d=ea(h)),d=new s(n,d),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Hc,a.stateNode=d,d._reactInternals=a,d=a.stateNode,d.props=n,d.state=a.memoizedState,d.refs={},gc(a),h=s.contextType,d.context=typeof h=="object"&&h!==null?ea(h):Rn,d.state=a.memoizedState,h=s.getDerivedStateFromProps,typeof h=="function"&&(Fc(a,s,h,n),d.state=a.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(h=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),h!==d.state&&Hc.enqueueReplaceState(d,d.state,null),El(a,n,d,r),kl(),d.state=a.memoizedState),typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!0}else if(t===null){d=a.stateNode;var b=a.memoizedProps,R=mn(s,b);d.props=R;var ie=d.context,fe=s.contextType;h=Rn,typeof fe=="object"&&fe!==null&&(h=ea(fe));var ve=s.getDerivedStateFromProps;fe=typeof ve=="function"||typeof d.getSnapshotBeforeUpdate=="function",b=a.pendingProps!==b,fe||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(b||ie!==h)&&sm(a,d,n,h),Cs=!1;var oe=a.memoizedState;d.state=oe,El(a,n,d,r),kl(),ie=a.memoizedState,b||oe!==ie||Cs?(typeof ve=="function"&&(Fc(a,s,ve,n),ie=a.memoizedState),(R=Cs||am(a,s,R,n,oe,ie,h))?(fe||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(a.flags|=4194308)):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=n,a.memoizedState=ie),d.props=n,d.state=ie,d.context=h,n=R):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!1)}else{d=a.stateNode,xc(t,a),h=a.memoizedProps,fe=mn(s,h),d.props=fe,ve=a.pendingProps,oe=d.context,ie=s.contextType,R=Rn,typeof ie=="object"&&ie!==null&&(R=ea(ie)),b=s.getDerivedStateFromProps,(ie=typeof b=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==ve||oe!==R)&&sm(a,d,n,R),Cs=!1,oe=a.memoizedState,d.state=oe,El(a,n,d,r),kl();var me=a.memoizedState;h!==ve||oe!==me||Cs||t!==null&&t.dependencies!==null&&kr(t.dependencies)?(typeof b=="function"&&(Fc(a,s,b,n),me=a.memoizedState),(fe=Cs||am(a,s,fe,n,oe,me,R)||t!==null&&t.dependencies!==null&&kr(t.dependencies))?(ie||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,me,R),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,me,R)),typeof d.componentDidUpdate=="function"&&(a.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=1024),a.memoizedProps=n,a.memoizedState=me),d.props=n,d.state=me,d.context=R,n=fe):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=1024),n=!1)}return d=n,Qr(t,a),n=(a.flags&128)!==0,d||n?(d=a.stateNode,s=n&&typeof s.getDerivedStateFromError!="function"?null:d.render(),a.flags|=1,t!==null&&n?(a.child=dn(a,t.child,null,r),a.child=dn(a,null,s,r)):ta(t,a,s,r),a.memoizedState=d.state,t=a.child):t=ls(t,a,r),t}function jm(t,a,s,n){return sn(),a.flags|=256,ta(t,a,s,n),a.child}var Yc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Qc(t){return{baseLanes:t,cachePool:iu()}}function Xc(t,a,s){return t=t!==null?t.childLanes&~s:0,a&&(t|=ya),t}function vm(t,a,s){var n=a.pendingProps,r=!1,d=(a.flags&128)!==0,h;if((h=d)||(h=t!==null&&t.memoizedState===null?!1:(Ft.current&2)!==0),h&&(r=!0,a.flags&=-129),h=(a.flags&32)!==0,a.flags&=-33,t===null){if(ot){if(r?Es(a):Ds(),(t=Tt)?(t=kh(t,Da),t=t!==null&&t.data!=="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:bs!==null?{id:Ha,overflow:$a}:null,retryLane:536870912,hydrationErrors:null},s=Kd(t),s.return=a,a.child=s,Wt=a,Tt=null)):t=null,t===null)throw Ns(a);return Mo(t)?a.lanes=32:a.lanes=536870912,null}var b=n.children;return n=n.fallback,r?(Ds(),r=a.mode,b=Xr({mode:"hidden",children:b},r),n=an(n,r,s,null),b.return=a,n.return=a,b.sibling=n,a.child=b,n=a.child,n.memoizedState=Qc(s),n.childLanes=Xc(t,h,s),a.memoizedState=Yc,Rl(null,n)):(Es(a),Zc(a,b))}var R=t.memoizedState;if(R!==null&&(b=R.dehydrated,b!==null)){if(d)a.flags&256?(Es(a),a.flags&=-257,a=Pc(t,a,s)):a.memoizedState!==null?(Ds(),a.child=t.child,a.flags|=128,a=null):(Ds(),b=n.fallback,r=a.mode,n=Xr({mode:"visible",children:n.children},r),b=an(b,r,s,null),b.flags|=2,n.return=a,b.return=a,n.sibling=b,a.child=n,dn(a,t.child,null,s),n=a.child,n.memoizedState=Qc(s),n.childLanes=Xc(t,h,s),a.memoizedState=Yc,a=Rl(null,n));else if(Es(a),Mo(b)){if(h=b.nextSibling&&b.nextSibling.dataset,h)var ie=h.dgst;h=ie,n=Error(c(419)),n.stack="",n.digest=h,bl({value:n,source:null,stack:null}),a=Pc(t,a,s)}else if(Zt||Un(t,a,s,!1),h=(s&t.childLanes)!==0,Zt||h){if(h=kt,h!==null&&(n=Re(h,s),n!==0&&n!==R.retryLane))throw R.retryLane=n,tn(t,n),ha(h,t,n),Vc;Do(b)||ai(),a=Pc(t,a,s)}else Do(b)?(a.flags|=192,a.child=t.child,a=null):(t=R.treeContext,Tt=Ta(b.nextSibling),Wt=a,ot=!0,_s=null,Da=!1,t!==null&&tu(a,t),a=Zc(a,n.children),a.flags|=4096);return a}return r?(Ds(),b=n.fallback,r=a.mode,R=t.child,ie=R.sibling,n=Wa(R,{mode:"hidden",children:n.children}),n.subtreeFlags=R.subtreeFlags&65011712,ie!==null?b=Wa(ie,b):(b=an(b,r,s,null),b.flags|=2),b.return=a,n.return=a,n.sibling=b,a.child=n,Rl(null,n),n=a.child,b=t.child.memoizedState,b===null?b=Qc(s):(r=b.cachePool,r!==null?(R=Qt._currentValue,r=r.parent!==R?{parent:R,pool:R}:r):r=iu(),b={baseLanes:b.baseLanes|s,cachePool:r}),n.memoizedState=b,n.childLanes=Xc(t,h,s),a.memoizedState=Yc,Rl(t.child,n)):(Es(a),s=t.child,t=s.sibling,s=Wa(s,{mode:"visible",children:n.children}),s.return=a,s.sibling=null,t!==null&&(h=a.deletions,h===null?(a.deletions=[t],a.flags|=16):h.push(t)),a.child=s,a.memoizedState=null,s)}function Zc(t,a){return a=Xr({mode:"visible",children:a},t.mode),a.return=t,t.child=a}function Xr(t,a){return t=ga(22,t,null,a),t.lanes=0,t}function Pc(t,a,s){return dn(a,t.child,null,s),t=Zc(a,a.pendingProps.children),t.flags|=2,a.memoizedState=null,t}function ym(t,a,s){t.lanes|=a;var n=t.alternate;n!==null&&(n.lanes|=a),dc(t.return,a,s)}function Jc(t,a,s,n,r,d){var h=t.memoizedState;h===null?t.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:r,treeForkCount:d}:(h.isBackwards=a,h.rendering=null,h.renderingStartTime=0,h.last=n,h.tail=s,h.tailMode=r,h.treeForkCount=d)}function bm(t,a,s){var n=a.pendingProps,r=n.revealOrder,d=n.tail;n=n.children;var h=Ft.current,b=(h&2)!==0;if(b?(h=h&1|2,a.flags|=128):h&=1,$(Ft,h),ta(t,a,n,s),n=ot?yl:0,!b&&t!==null&&(t.flags&128)!==0)e:for(t=a.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&ym(t,s,a);else if(t.tag===19)ym(t,s,a);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===a)break e;for(;t.sibling===null;){if(t.return===null||t.return===a)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(r){case"forwards":for(s=a.child,r=null;s!==null;)t=s.alternate,t!==null&&qr(t)===null&&(r=s),s=s.sibling;s=r,s===null?(r=a.child,a.child=null):(r=s.sibling,s.sibling=null),Jc(a,!1,r,s,d,n);break;case"backwards":case"unstable_legacy-backwards":for(s=null,r=a.child,a.child=null;r!==null;){if(t=r.alternate,t!==null&&qr(t)===null){a.child=r;break}t=r.sibling,r.sibling=s,s=r,r=t}Jc(a,!0,s,null,d,n);break;case"together":Jc(a,!1,null,null,void 0,n);break;default:a.memoizedState=null}return a.child}function ls(t,a,s){if(t!==null&&(a.dependencies=t.dependencies),As|=a.lanes,(s&a.childLanes)===0)if(t!==null){if(Un(t,a,s,!1),(s&a.childLanes)===0)return null}else return null;if(t!==null&&a.child!==t.child)throw Error(c(153));if(a.child!==null){for(t=a.child,s=Wa(t,t.pendingProps),a.child=s,s.return=a;t.sibling!==null;)t=t.sibling,s=s.sibling=Wa(t,t.pendingProps),s.return=a;s.sibling=null}return a.child}function Ic(t,a){return(t.lanes&a)!==0?!0:(t=t.dependencies,!!(t!==null&&kr(t)))}function ug(t,a,s){switch(a.tag){case 3:We(a,a.stateNode.containerInfo),Ss(a,Qt,t.memoizedState.cache),sn();break;case 27:case 5:De(a);break;case 4:We(a,a.stateNode.containerInfo);break;case 10:Ss(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,_c(a),null;break;case 13:var n=a.memoizedState;if(n!==null)return n.dehydrated!==null?(Es(a),a.flags|=128,null):(s&a.child.childLanes)!==0?vm(t,a,s):(Es(a),t=ls(t,a,s),t!==null?t.sibling:null);Es(a);break;case 19:var r=(t.flags&128)!==0;if(n=(s&a.childLanes)!==0,n||(Un(t,a,s,!1),n=(s&a.childLanes)!==0),r){if(n)return bm(t,a,s);a.flags|=128}if(r=a.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),$(Ft,Ft.current),n)break;return null;case 22:return a.lanes=0,hm(t,a,s,a.pendingProps);case 24:Ss(a,Qt,t.memoizedState.cache)}return ls(t,a,s)}function _m(t,a,s){if(t!==null)if(t.memoizedProps!==a.pendingProps)Zt=!0;else{if(!Ic(t,s)&&(a.flags&128)===0)return Zt=!1,ug(t,a,s);Zt=(t.flags&131072)!==0}else Zt=!1,ot&&(a.flags&1048576)!==0&&eu(a,yl,a.index);switch(a.lanes=0,a.tag){case 16:e:{var n=a.pendingProps;if(t=cn(a.elementType),a.type=t,typeof t=="function")ac(t)?(n=mn(t,n),a.tag=1,a=xm(null,a,t,n,s)):(a.tag=0,a=Gc(null,a,t,n,s));else{if(t!=null){var r=t.$$typeof;if(r===S){a.tag=11,a=dm(null,a,t,n,s);break e}else if(r===Z){a.tag=14,a=um(null,a,t,n,s);break e}}throw a=C(t)||t,Error(c(306,a,""))}}return a;case 0:return Gc(t,a,a.type,a.pendingProps,s);case 1:return n=a.type,r=mn(n,a.pendingProps),xm(t,a,n,r,s);case 3:e:{if(We(a,a.stateNode.containerInfo),t===null)throw Error(c(387));n=a.pendingProps;var d=a.memoizedState;r=d.element,xc(t,a),El(a,n,null,s);var h=a.memoizedState;if(n=h.cache,Ss(a,Qt,n),n!==d.cache&&uc(a,[Qt],s,!0),kl(),n=h.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:h.cache},a.updateQueue.baseState=d,a.memoizedState=d,a.flags&256){a=jm(t,a,n,s);break e}else if(n!==r){r=wa(Error(c(424)),a),bl(r),a=jm(t,a,n,s);break e}else{switch(t=a.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Tt=Ta(t.firstChild),Wt=a,ot=!0,_s=null,Da=!0,s=hu(a,null,n,s),a.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(sn(),n===r){a=ls(t,a,s);break e}ta(t,a,n,s)}a=a.child}return a;case 26:return Qr(t,a),t===null?(s=Rh(a.type,null,a.pendingProps,null))?a.memoizedState=s:ot||(s=a.type,t=a.pendingProps,n=oi(Fe.current).createElement(s),n[Ie]=a,n[Mt]=t,aa(n,s,t),_t(n),a.stateNode=n):a.memoizedState=Rh(a.type,t.memoizedProps,a.pendingProps,t.memoizedState),null;case 27:return De(a),t===null&&ot&&(n=a.stateNode=Mh(a.type,a.pendingProps,Fe.current),Wt=a,Da=!0,r=Tt,Us(a.type)?(To=r,Tt=Ta(n.firstChild)):Tt=r),ta(t,a,a.pendingProps.children,s),Qr(t,a),t===null&&(a.flags|=4194304),a.child;case 5:return t===null&&ot&&((r=n=Tt)&&(n=Hg(n,a.type,a.pendingProps,Da),n!==null?(a.stateNode=n,Wt=a,Tt=Ta(n.firstChild),Da=!1,r=!0):r=!1),r||Ns(a)),De(a),r=a.type,d=a.pendingProps,h=t!==null?t.memoizedProps:null,n=d.children,wo(r,d)?n=null:h!==null&&wo(r,h)&&(a.flags|=32),a.memoizedState!==null&&(r=Sc(t,a,ag,null,null,s),Zl._currentValue=r),Qr(t,a),ta(t,a,n,s),a.child;case 6:return t===null&&ot&&((t=s=Tt)&&(s=$g(s,a.pendingProps,Da),s!==null?(a.stateNode=s,Wt=a,Tt=null,t=!0):t=!1),t||Ns(a)),null;case 13:return vm(t,a,s);case 4:return We(a,a.stateNode.containerInfo),n=a.pendingProps,t===null?a.child=dn(a,null,n,s):ta(t,a,n,s),a.child;case 11:return dm(t,a,a.type,a.pendingProps,s);case 7:return ta(t,a,a.pendingProps,s),a.child;case 8:return ta(t,a,a.pendingProps.children,s),a.child;case 12:return ta(t,a,a.pendingProps.children,s),a.child;case 10:return n=a.pendingProps,Ss(a,a.type,n.value),ta(t,a,n.children,s),a.child;case 9:return r=a.type._context,n=a.pendingProps.children,ln(a),r=ea(r),n=n(r),a.flags|=1,ta(t,a,n,s),a.child;case 14:return um(t,a,a.type,a.pendingProps,s);case 15:return mm(t,a,a.type,a.pendingProps,s);case 19:return bm(t,a,s);case 31:return dg(t,a,s);case 22:return hm(t,a,s,a.pendingProps);case 24:return ln(a),n=ea(Qt),t===null?(r=fc(),r===null&&(r=kt,d=mc(),r.pooledCache=d,d.refCount++,d!==null&&(r.pooledCacheLanes|=s),r=d),a.memoizedState={parent:n,cache:r},gc(a),Ss(a,Qt,r)):((t.lanes&s)!==0&&(xc(t,a),El(a,null,null,s),kl()),r=t.memoizedState,d=a.memoizedState,r.parent!==n?(r={parent:n,cache:n},a.memoizedState=r,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=r),Ss(a,Qt,n)):(n=d.cache,Ss(a,Qt,n),n!==r.cache&&uc(a,[Qt],s,!0))),ta(t,a,a.pendingProps.children,s),a.child;case 29:throw a.pendingProps}throw Error(c(156,a.tag))}function rs(t){t.flags|=4}function Kc(t,a,s,n,r){if((a=(t.mode&32)!==0)&&(a=!1),a){if(t.flags|=16777216,(r&335544128)===r)if(t.stateNode.complete)t.flags|=8192;else if(Pm())t.flags|=8192;else throw on=Tr,pc}else t.flags&=-16777217}function Nm(t,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!Lh(a))if(Pm())t.flags|=8192;else throw on=Tr,pc}function Zr(t,a){a!==null&&(t.flags|=4),t.flags&16384&&(a=t.tag!==22?je():536870912,t.lanes|=a,Pn|=a)}function zl(t,a){if(!ot)switch(t.tailMode){case"hidden":a=t.tail;for(var s=null;a!==null;)a.alternate!==null&&(s=a),a=a.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?a||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function At(t){var a=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(a)for(var r=t.child;r!==null;)s|=r.lanes|r.childLanes,n|=r.subtreeFlags&65011712,n|=r.flags&65011712,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)s|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=n,t.childLanes=s,a}function mg(t,a,s){var n=a.pendingProps;switch(rc(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return At(a),null;case 1:return At(a),null;case 3:return s=a.stateNode,n=null,t!==null&&(n=t.memoizedState.cache),a.memoizedState.cache!==n&&(a.flags|=2048),as(Qt),Ve(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(On(a)?rs(a):t===null||t.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,cc())),At(a),null;case 26:var r=a.type,d=a.memoizedState;return t===null?(rs(a),d!==null?(At(a),Nm(a,d)):(At(a),Kc(a,r,null,n,s))):d?d!==t.memoizedState?(rs(a),At(a),Nm(a,d)):(At(a),a.flags&=-16777217):(t=t.memoizedProps,t!==n&&rs(a),At(a),Kc(a,r,t,n,s)),null;case 27:if(nt(a),s=Fe.current,r=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&rs(a);else{if(!n){if(a.stateNode===null)throw Error(c(166));return At(a),null}t=xe.current,On(a)?au(a):(t=Mh(r,n,s),a.stateNode=t,rs(a))}return At(a),null;case 5:if(nt(a),r=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&rs(a);else{if(!n){if(a.stateNode===null)throw Error(c(166));return At(a),null}if(d=xe.current,On(a))au(a);else{var h=oi(Fe.current);switch(d){case 1:d=h.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:d=h.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":d=h.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":d=h.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":d=h.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof n.is=="string"?h.createElement("select",{is:n.is}):h.createElement("select"),n.multiple?d.multiple=!0:n.size&&(d.size=n.size);break;default:d=typeof n.is=="string"?h.createElement(r,{is:n.is}):h.createElement(r)}}d[Ie]=a,d[Mt]=n;e:for(h=a.child;h!==null;){if(h.tag===5||h.tag===6)d.appendChild(h.stateNode);else if(h.tag!==4&&h.tag!==27&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break e;for(;h.sibling===null;){if(h.return===null||h.return===a)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}a.stateNode=d;e:switch(aa(d,r,n),r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&rs(a)}}return At(a),Kc(a,a.type,t===null?null:t.memoizedProps,a.pendingProps,s),null;case 6:if(t&&a.stateNode!=null)t.memoizedProps!==n&&rs(a);else{if(typeof n!="string"&&a.stateNode===null)throw Error(c(166));if(t=Fe.current,On(a)){if(t=a.stateNode,s=a.memoizedProps,n=null,r=Wt,r!==null)switch(r.tag){case 27:case 5:n=r.memoizedProps}t[Ie]=a,t=!!(t.nodeValue===s||n!==null&&n.suppressHydrationWarning===!0||vh(t.nodeValue,s)),t||Ns(a,!0)}else t=oi(t).createTextNode(n),t[Ie]=a,a.stateNode=t}return At(a),null;case 31:if(s=a.memoizedState,t===null||t.memoizedState!==null){if(n=On(a),s!==null){if(t===null){if(!n)throw Error(c(318));if(t=a.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(557));t[Ie]=a}else sn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;At(a),t=!1}else s=cc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),t=!0;if(!t)return a.flags&256?(ja(a),a):(ja(a),null);if((a.flags&128)!==0)throw Error(c(558))}return At(a),null;case 13:if(n=a.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(r=On(a),n!==null&&n.dehydrated!==null){if(t===null){if(!r)throw Error(c(318));if(r=a.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(c(317));r[Ie]=a}else sn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;At(a),r=!1}else r=cc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=r),r=!0;if(!r)return a.flags&256?(ja(a),a):(ja(a),null)}return ja(a),(a.flags&128)!==0?(a.lanes=s,a):(s=n!==null,t=t!==null&&t.memoizedState!==null,s&&(n=a.child,r=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(r=n.alternate.memoizedState.cachePool.pool),d=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(d=n.memoizedState.cachePool.pool),d!==r&&(n.flags|=2048)),s!==t&&s&&(a.child.flags|=8192),Zr(a,a.updateQueue),At(a),null);case 4:return Ve(),t===null&&bo(a.stateNode.containerInfo),At(a),null;case 10:return as(a.type),At(a),null;case 19:if(L(Ft),n=a.memoizedState,n===null)return At(a),null;if(r=(a.flags&128)!==0,d=n.rendering,d===null)if(r)zl(n,!1);else{if(Ot!==0||t!==null&&(t.flags&128)!==0)for(t=a.child;t!==null;){if(d=qr(t),d!==null){for(a.flags|=128,zl(n,!1),t=d.updateQueue,a.updateQueue=t,Zr(a,t),a.subtreeFlags=0,t=s,s=a.child;s!==null;)Id(s,t),s=s.sibling;return $(Ft,Ft.current&1|2),ot&&es(a,n.treeForkCount),a.child}t=t.sibling}n.tail!==null&&Se()>Wr&&(a.flags|=128,r=!0,zl(n,!1),a.lanes=4194304)}else{if(!r)if(t=qr(d),t!==null){if(a.flags|=128,r=!0,t=t.updateQueue,a.updateQueue=t,Zr(a,t),zl(n,!0),n.tail===null&&n.tailMode==="hidden"&&!d.alternate&&!ot)return At(a),null}else 2*Se()-n.renderingStartTime>Wr&&s!==536870912&&(a.flags|=128,r=!0,zl(n,!1),a.lanes=4194304);n.isBackwards?(d.sibling=a.child,a.child=d):(t=n.last,t!==null?t.sibling=d:a.child=d,n.last=d)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=Se(),t.sibling=null,s=Ft.current,$(Ft,r?s&1|2:s&1),ot&&es(a,n.treeForkCount),t):(At(a),null);case 22:case 23:return ja(a),bc(),n=a.memoizedState!==null,t!==null?t.memoizedState!==null!==n&&(a.flags|=8192):n&&(a.flags|=8192),n?(s&536870912)!==0&&(a.flags&128)===0&&(At(a),a.subtreeFlags&6&&(a.flags|=8192)):At(a),s=a.updateQueue,s!==null&&Zr(a,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),n=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(n=a.memoizedState.cachePool.pool),n!==s&&(a.flags|=2048),t!==null&&L(rn),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),a.memoizedState.cache!==s&&(a.flags|=2048),as(Qt),At(a),null;case 25:return null;case 30:return null}throw Error(c(156,a.tag))}function hg(t,a){switch(rc(a),a.tag){case 1:return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 3:return as(Qt),Ve(),t=a.flags,(t&65536)!==0&&(t&128)===0?(a.flags=t&-65537|128,a):null;case 26:case 27:case 5:return nt(a),null;case 31:if(a.memoizedState!==null){if(ja(a),a.alternate===null)throw Error(c(340));sn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 13:if(ja(a),t=a.memoizedState,t!==null&&t.dehydrated!==null){if(a.alternate===null)throw Error(c(340));sn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 19:return L(Ft),null;case 4:return Ve(),null;case 10:return as(a.type),null;case 22:case 23:return ja(a),bc(),t!==null&&L(rn),t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 24:return as(Qt),null;case 25:return null;default:return null}}function Sm(t,a){switch(rc(a),a.tag){case 3:as(Qt),Ve();break;case 26:case 27:case 5:nt(a);break;case 4:Ve();break;case 31:a.memoizedState!==null&&ja(a);break;case 13:ja(a);break;case 19:L(Ft);break;case 10:as(a.type);break;case 22:case 23:ja(a),bc(),t!==null&&L(rn);break;case 24:as(Qt)}}function ql(t,a){try{var s=a.updateQueue,n=s!==null?s.lastEffect:null;if(n!==null){var r=n.next;s=r;do{if((s.tag&t)===t){n=void 0;var d=s.create,h=s.inst;n=d(),h.destroy=n}s=s.next}while(s!==r)}}catch(b){bt(a,a.return,b)}}function Ms(t,a,s){try{var n=a.updateQueue,r=n!==null?n.lastEffect:null;if(r!==null){var d=r.next;n=d;do{if((n.tag&t)===t){var h=n.inst,b=h.destroy;if(b!==void 0){h.destroy=void 0,r=a;var R=s,ie=b;try{ie()}catch(fe){bt(r,R,fe)}}}n=n.next}while(n!==d)}}catch(fe){bt(a,a.return,fe)}}function Cm(t){var a=t.updateQueue;if(a!==null){var s=t.stateNode;try{pu(a,s)}catch(n){bt(t,t.return,n)}}}function wm(t,a,s){s.props=mn(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(n){bt(t,a,n)}}function Ol(t,a){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var n=t.stateNode;break;case 30:n=t.stateNode;break;default:n=t.stateNode}typeof s=="function"?t.refCleanup=s(n):s.current=n}}catch(r){bt(t,a,r)}}function Va(t,a){var s=t.ref,n=t.refCleanup;if(s!==null)if(typeof n=="function")try{n()}catch(r){bt(t,a,r)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(r){bt(t,a,r)}else s.current=null}function km(t){var a=t.type,s=t.memoizedProps,n=t.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break e;case"img":s.src?n.src=s.src:s.srcSet&&(n.srcset=s.srcSet)}}catch(r){bt(t,t.return,r)}}function Wc(t,a,s){try{var n=t.stateNode;qg(n,t.type,s,a),n[Mt]=a}catch(r){bt(t,t.return,r)}}function Em(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Us(t.type)||t.tag===4}function eo(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Em(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Us(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function to(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,a):(a=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,a.appendChild(t),s=s._reactRootContainer,s!=null||a.onclick!==null||(a.onclick=Ia));else if(n!==4&&(n===27&&Us(t.type)&&(s=t.stateNode,a=null),t=t.child,t!==null))for(to(t,a,s),t=t.sibling;t!==null;)to(t,a,s),t=t.sibling}function Pr(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?s.insertBefore(t,a):s.appendChild(t);else if(n!==4&&(n===27&&Us(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(Pr(t,a,s),t=t.sibling;t!==null;)Pr(t,a,s),t=t.sibling}function Dm(t){var a=t.stateNode,s=t.memoizedProps;try{for(var n=t.type,r=a.attributes;r.length;)a.removeAttributeNode(r[0]);aa(a,n,s),a[Ie]=t,a[Mt]=s}catch(d){bt(t,t.return,d)}}var is=!1,Pt=!1,ao=!1,Mm=typeof WeakSet=="function"?WeakSet:Set,Kt=null;function fg(t,a){if(t=t.containerInfo,So=gi,t=$d(t),Pi(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var r=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var h=0,b=-1,R=-1,ie=0,fe=0,ve=t,oe=null;t:for(;;){for(var me;ve!==s||r!==0&&ve.nodeType!==3||(b=h+r),ve!==d||n!==0&&ve.nodeType!==3||(R=h+n),ve.nodeType===3&&(h+=ve.nodeValue.length),(me=ve.firstChild)!==null;)oe=ve,ve=me;for(;;){if(ve===t)break t;if(oe===s&&++ie===r&&(b=h),oe===d&&++fe===n&&(R=h),(me=ve.nextSibling)!==null)break;ve=oe,oe=ve.parentNode}ve=me}s=b===-1||R===-1?null:{start:b,end:R}}else s=null}s=s||{start:0,end:0}}else s=null;for(Co={focusedElem:t,selectionRange:s},gi=!1,Kt=a;Kt!==null;)if(a=Kt,t=a.child,(a.subtreeFlags&1028)!==0&&t!==null)t.return=a,Kt=t;else for(;Kt!==null;){switch(a=Kt,d=a.alternate,t=a.flags,a.tag){case 0:if((t&4)!==0&&(t=a.updateQueue,t=t!==null?t.events:null,t!==null))for(s=0;s<t.length;s++)r=t[s],r.ref.impl=r.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&d!==null){t=void 0,s=a,r=d.memoizedProps,d=d.memoizedState,n=s.stateNode;try{var qe=mn(s.type,r);t=n.getSnapshotBeforeUpdate(qe,d),n.__reactInternalSnapshotBeforeUpdate=t}catch(Ge){bt(s,s.return,Ge)}}break;case 3:if((t&1024)!==0){if(t=a.stateNode.containerInfo,s=t.nodeType,s===9)Eo(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Eo(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(c(163))}if(t=a.sibling,t!==null){t.return=a.return,Kt=t;break}Kt=a.return}}function Tm(t,a,s){var n=s.flags;switch(s.tag){case 0:case 11:case 15:os(t,s),n&4&&ql(5,s);break;case 1:if(os(t,s),n&4)if(t=s.stateNode,a===null)try{t.componentDidMount()}catch(h){bt(s,s.return,h)}else{var r=mn(s.type,a.memoizedProps);a=a.memoizedState;try{t.componentDidUpdate(r,a,t.__reactInternalSnapshotBeforeUpdate)}catch(h){bt(s,s.return,h)}}n&64&&Cm(s),n&512&&Ol(s,s.return);break;case 3:if(os(t,s),n&64&&(t=s.updateQueue,t!==null)){if(a=null,s.child!==null)switch(s.child.tag){case 27:case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}try{pu(t,a)}catch(h){bt(s,s.return,h)}}break;case 27:a===null&&n&4&&Dm(s);case 26:case 5:os(t,s),a===null&&n&4&&km(s),n&512&&Ol(s,s.return);break;case 12:os(t,s);break;case 31:os(t,s),n&4&&zm(t,s);break;case 13:os(t,s),n&4&&qm(t,s),n&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=Ng.bind(null,s),Vg(t,s))));break;case 22:if(n=s.memoizedState!==null||is,!n){a=a!==null&&a.memoizedState!==null||Pt,r=is;var d=Pt;is=n,(Pt=a)&&!d?ds(t,s,(s.subtreeFlags&8772)!==0):os(t,s),is=r,Pt=d}break;case 30:break;default:os(t,s)}}function Am(t){var a=t.alternate;a!==null&&(t.alternate=null,Am(a)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(a=t.stateNode,a!==null&&Nn(a)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var zt=null,oa=!1;function cs(t,a,s){for(s=s.child;s!==null;)Rm(t,a,s),s=s.sibling}function Rm(t,a,s){if(tt&&typeof tt.onCommitFiberUnmount=="function")try{tt.onCommitFiberUnmount(et,s)}catch{}switch(s.tag){case 26:Pt||Va(s,a),cs(t,a,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:Pt||Va(s,a);var n=zt,r=oa;Us(s.type)&&(zt=s.stateNode,oa=!1),cs(t,a,s),Yl(s.stateNode),zt=n,oa=r;break;case 5:Pt||Va(s,a);case 6:if(n=zt,r=oa,zt=null,cs(t,a,s),zt=n,oa=r,zt!==null)if(oa)try{(zt.nodeType===9?zt.body:zt.nodeName==="HTML"?zt.ownerDocument.body:zt).removeChild(s.stateNode)}catch(d){bt(s,a,d)}else try{zt.removeChild(s.stateNode)}catch(d){bt(s,a,d)}break;case 18:zt!==null&&(oa?(t=zt,Ch(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),sl(t)):Ch(zt,s.stateNode));break;case 4:n=zt,r=oa,zt=s.stateNode.containerInfo,oa=!0,cs(t,a,s),zt=n,oa=r;break;case 0:case 11:case 14:case 15:Ms(2,s,a),Pt||Ms(4,s,a),cs(t,a,s);break;case 1:Pt||(Va(s,a),n=s.stateNode,typeof n.componentWillUnmount=="function"&&wm(s,a,n)),cs(t,a,s);break;case 21:cs(t,a,s);break;case 22:Pt=(n=Pt)||s.memoizedState!==null,cs(t,a,s),Pt=n;break;default:cs(t,a,s)}}function zm(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{sl(t)}catch(s){bt(a,a.return,s)}}}function qm(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{sl(t)}catch(s){bt(a,a.return,s)}}function pg(t){switch(t.tag){case 31:case 13:case 19:var a=t.stateNode;return a===null&&(a=t.stateNode=new Mm),a;case 22:return t=t.stateNode,a=t._retryCache,a===null&&(a=t._retryCache=new Mm),a;default:throw Error(c(435,t.tag))}}function Jr(t,a){var s=pg(t);a.forEach(function(n){if(!s.has(n)){s.add(n);var r=Sg.bind(null,t,n);n.then(r,r)}})}function da(t,a){var s=a.deletions;if(s!==null)for(var n=0;n<s.length;n++){var r=s[n],d=t,h=a,b=h;e:for(;b!==null;){switch(b.tag){case 27:if(Us(b.type)){zt=b.stateNode,oa=!1;break e}break;case 5:zt=b.stateNode,oa=!1;break e;case 3:case 4:zt=b.stateNode.containerInfo,oa=!0;break e}b=b.return}if(zt===null)throw Error(c(160));Rm(d,h,r),zt=null,oa=!1,d=r.alternate,d!==null&&(d.return=null),r.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Om(a,t),a=a.sibling}var Oa=null;function Om(t,a){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:da(a,t),ua(t),n&4&&(Ms(3,t,t.return),ql(3,t),Ms(5,t,t.return));break;case 1:da(a,t),ua(t),n&512&&(Pt||s===null||Va(s,s.return)),n&64&&is&&(t=t.updateQueue,t!==null&&(n=t.callbacks,n!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?n:s.concat(n))));break;case 26:var r=Oa;if(da(a,t),ua(t),n&512&&(Pt||s===null||Va(s,s.return)),n&4){var d=s!==null?s.memoizedState:null;if(n=t.memoizedState,s===null)if(n===null)if(t.stateNode===null){e:{n=t.type,s=t.memoizedProps,r=r.ownerDocument||r;t:switch(n){case"title":d=r.getElementsByTagName("title")[0],(!d||d[Js]||d[Ie]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=r.createElement(n),r.head.insertBefore(d,r.querySelector("head > title"))),aa(d,n,s),d[Ie]=t,_t(d),n=d;break e;case"link":var h=Oh("link","href",r).get(n+(s.href||""));if(h){for(var b=0;b<h.length;b++)if(d=h[b],d.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&d.getAttribute("rel")===(s.rel==null?null:s.rel)&&d.getAttribute("title")===(s.title==null?null:s.title)&&d.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){h.splice(b,1);break t}}d=r.createElement(n),aa(d,n,s),r.head.appendChild(d);break;case"meta":if(h=Oh("meta","content",r).get(n+(s.content||""))){for(b=0;b<h.length;b++)if(d=h[b],d.getAttribute("content")===(s.content==null?null:""+s.content)&&d.getAttribute("name")===(s.name==null?null:s.name)&&d.getAttribute("property")===(s.property==null?null:s.property)&&d.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&d.getAttribute("charset")===(s.charSet==null?null:s.charSet)){h.splice(b,1);break t}}d=r.createElement(n),aa(d,n,s),r.head.appendChild(d);break;default:throw Error(c(468,n))}d[Ie]=t,_t(d),n=d}t.stateNode=n}else Uh(r,t.type,t.stateNode);else t.stateNode=qh(r,n,t.memoizedProps);else d!==n?(d===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):d.count--,n===null?Uh(r,t.type,t.stateNode):qh(r,n,t.memoizedProps)):n===null&&t.stateNode!==null&&Wc(t,t.memoizedProps,s.memoizedProps)}break;case 27:da(a,t),ua(t),n&512&&(Pt||s===null||Va(s,s.return)),s!==null&&n&4&&Wc(t,t.memoizedProps,s.memoizedProps);break;case 5:if(da(a,t),ua(t),n&512&&(Pt||s===null||Va(s,s.return)),t.flags&32){r=t.stateNode;try{wn(r,"")}catch(qe){bt(t,t.return,qe)}}n&4&&t.stateNode!=null&&(r=t.memoizedProps,Wc(t,r,s!==null?s.memoizedProps:r)),n&1024&&(ao=!0);break;case 6:if(da(a,t),ua(t),n&4){if(t.stateNode===null)throw Error(c(162));n=t.memoizedProps,s=t.stateNode;try{s.nodeValue=n}catch(qe){bt(t,t.return,qe)}}break;case 3:if(mi=null,r=Oa,Oa=di(a.containerInfo),da(a,t),Oa=r,ua(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{sl(a.containerInfo)}catch(qe){bt(t,t.return,qe)}ao&&(ao=!1,Um(t));break;case 4:n=Oa,Oa=di(t.stateNode.containerInfo),da(a,t),ua(t),Oa=n;break;case 12:da(a,t),ua(t);break;case 31:da(a,t),ua(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Jr(t,n)));break;case 13:da(a,t),ua(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(Kr=Se()),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Jr(t,n)));break;case 22:r=t.memoizedState!==null;var R=s!==null&&s.memoizedState!==null,ie=is,fe=Pt;if(is=ie||r,Pt=fe||R,da(a,t),Pt=fe,is=ie,ua(t),n&8192)e:for(a=t.stateNode,a._visibility=r?a._visibility&-2:a._visibility|1,r&&(s===null||R||is||Pt||hn(t)),s=null,a=t;;){if(a.tag===5||a.tag===26){if(s===null){R=s=a;try{if(d=R.stateNode,r)h=d.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none";else{b=R.stateNode;var ve=R.memoizedProps.style,oe=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;b.style.display=oe==null||typeof oe=="boolean"?"":(""+oe).trim()}}catch(qe){bt(R,R.return,qe)}}}else if(a.tag===6){if(s===null){R=a;try{R.stateNode.nodeValue=r?"":R.memoizedProps}catch(qe){bt(R,R.return,qe)}}}else if(a.tag===18){if(s===null){R=a;try{var me=R.stateNode;r?wh(me,!0):wh(R.stateNode,!1)}catch(qe){bt(R,R.return,qe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===t)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break e;for(;a.sibling===null;){if(a.return===null||a.return===t)break e;s===a&&(s=null),a=a.return}s===a&&(s=null),a.sibling.return=a.return,a=a.sibling}n&4&&(n=t.updateQueue,n!==null&&(s=n.retryQueue,s!==null&&(n.retryQueue=null,Jr(t,s))));break;case 19:da(a,t),ua(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Jr(t,n)));break;case 30:break;case 21:break;default:da(a,t),ua(t)}}function ua(t){var a=t.flags;if(a&2){try{for(var s,n=t.return;n!==null;){if(Em(n)){s=n;break}n=n.return}if(s==null)throw Error(c(160));switch(s.tag){case 27:var r=s.stateNode,d=eo(t);Pr(t,d,r);break;case 5:var h=s.stateNode;s.flags&32&&(wn(h,""),s.flags&=-33);var b=eo(t);Pr(t,b,h);break;case 3:case 4:var R=s.stateNode.containerInfo,ie=eo(t);to(t,ie,R);break;default:throw Error(c(161))}}catch(fe){bt(t,t.return,fe)}t.flags&=-3}a&4096&&(t.flags&=-4097)}function Um(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var a=t;Um(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),t=t.sibling}}function os(t,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Tm(t,a.alternate,a),a=a.sibling}function hn(t){for(t=t.child;t!==null;){var a=t;switch(a.tag){case 0:case 11:case 14:case 15:Ms(4,a,a.return),hn(a);break;case 1:Va(a,a.return);var s=a.stateNode;typeof s.componentWillUnmount=="function"&&wm(a,a.return,s),hn(a);break;case 27:Yl(a.stateNode);case 26:case 5:Va(a,a.return),hn(a);break;case 22:a.memoizedState===null&&hn(a);break;case 30:hn(a);break;default:hn(a)}t=t.sibling}}function ds(t,a,s){for(s=s&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var n=a.alternate,r=t,d=a,h=d.flags;switch(d.tag){case 0:case 11:case 15:ds(r,d,s),ql(4,d);break;case 1:if(ds(r,d,s),n=d,r=n.stateNode,typeof r.componentDidMount=="function")try{r.componentDidMount()}catch(ie){bt(n,n.return,ie)}if(n=d,r=n.updateQueue,r!==null){var b=n.stateNode;try{var R=r.shared.hiddenCallbacks;if(R!==null)for(r.shared.hiddenCallbacks=null,r=0;r<R.length;r++)fu(R[r],b)}catch(ie){bt(n,n.return,ie)}}s&&h&64&&Cm(d),Ol(d,d.return);break;case 27:Dm(d);case 26:case 5:ds(r,d,s),s&&n===null&&h&4&&km(d),Ol(d,d.return);break;case 12:ds(r,d,s);break;case 31:ds(r,d,s),s&&h&4&&zm(r,d);break;case 13:ds(r,d,s),s&&h&4&&qm(r,d);break;case 22:d.memoizedState===null&&ds(r,d,s),Ol(d,d.return);break;case 30:break;default:ds(r,d,s)}a=a.sibling}}function so(t,a){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(t=a.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&_l(s))}function no(t,a){t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&_l(t))}function Ua(t,a,s,n){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Lm(t,a,s,n),a=a.sibling}function Lm(t,a,s,n){var r=a.flags;switch(a.tag){case 0:case 11:case 15:Ua(t,a,s,n),r&2048&&ql(9,a);break;case 1:Ua(t,a,s,n);break;case 3:Ua(t,a,s,n),r&2048&&(t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&_l(t)));break;case 12:if(r&2048){Ua(t,a,s,n),t=a.stateNode;try{var d=a.memoizedProps,h=d.id,b=d.onPostCommit;typeof b=="function"&&b(h,a.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(R){bt(a,a.return,R)}}else Ua(t,a,s,n);break;case 31:Ua(t,a,s,n);break;case 13:Ua(t,a,s,n);break;case 23:break;case 22:d=a.stateNode,h=a.alternate,a.memoizedState!==null?d._visibility&2?Ua(t,a,s,n):Ul(t,a):d._visibility&2?Ua(t,a,s,n):(d._visibility|=2,Qn(t,a,s,n,(a.subtreeFlags&10256)!==0||!1)),r&2048&&so(h,a);break;case 24:Ua(t,a,s,n),r&2048&&no(a.alternate,a);break;default:Ua(t,a,s,n)}}function Qn(t,a,s,n,r){for(r=r&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var d=t,h=a,b=s,R=n,ie=h.flags;switch(h.tag){case 0:case 11:case 15:Qn(d,h,b,R,r),ql(8,h);break;case 23:break;case 22:var fe=h.stateNode;h.memoizedState!==null?fe._visibility&2?Qn(d,h,b,R,r):Ul(d,h):(fe._visibility|=2,Qn(d,h,b,R,r)),r&&ie&2048&&so(h.alternate,h);break;case 24:Qn(d,h,b,R,r),r&&ie&2048&&no(h.alternate,h);break;default:Qn(d,h,b,R,r)}a=a.sibling}}function Ul(t,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var s=t,n=a,r=n.flags;switch(n.tag){case 22:Ul(s,n),r&2048&&so(n.alternate,n);break;case 24:Ul(s,n),r&2048&&no(n.alternate,n);break;default:Ul(s,n)}a=a.sibling}}var Ll=8192;function Xn(t,a,s){if(t.subtreeFlags&Ll)for(t=t.child;t!==null;)Bm(t,a,s),t=t.sibling}function Bm(t,a,s){switch(t.tag){case 26:Xn(t,a,s),t.flags&Ll&&t.memoizedState!==null&&tx(s,Oa,t.memoizedState,t.memoizedProps);break;case 5:Xn(t,a,s);break;case 3:case 4:var n=Oa;Oa=di(t.stateNode.containerInfo),Xn(t,a,s),Oa=n;break;case 22:t.memoizedState===null&&(n=t.alternate,n!==null&&n.memoizedState!==null?(n=Ll,Ll=16777216,Xn(t,a,s),Ll=n):Xn(t,a,s));break;default:Xn(t,a,s)}}function Fm(t){var a=t.alternate;if(a!==null&&(t=a.child,t!==null)){a.child=null;do a=t.sibling,t.sibling=null,t=a;while(t!==null)}}function Bl(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];Kt=n,$m(n,t)}Fm(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Hm(t),t=t.sibling}function Hm(t){switch(t.tag){case 0:case 11:case 15:Bl(t),t.flags&2048&&Ms(9,t,t.return);break;case 3:Bl(t);break;case 12:Bl(t);break;case 22:var a=t.stateNode;t.memoizedState!==null&&a._visibility&2&&(t.return===null||t.return.tag!==13)?(a._visibility&=-3,Ir(t)):Bl(t);break;default:Bl(t)}}function Ir(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];Kt=n,$m(n,t)}Fm(t)}for(t=t.child;t!==null;){switch(a=t,a.tag){case 0:case 11:case 15:Ms(8,a,a.return),Ir(a);break;case 22:s=a.stateNode,s._visibility&2&&(s._visibility&=-3,Ir(a));break;default:Ir(a)}t=t.sibling}}function $m(t,a){for(;Kt!==null;){var s=Kt;switch(s.tag){case 0:case 11:case 15:Ms(8,s,a);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var n=s.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:_l(s.memoizedState.cache)}if(n=s.child,n!==null)n.return=s,Kt=n;else e:for(s=t;Kt!==null;){n=Kt;var r=n.sibling,d=n.return;if(Am(n),n===s){Kt=null;break e}if(r!==null){r.return=d,Kt=r;break e}Kt=d}}}var gg={getCacheForType:function(t){var a=ea(Qt),s=a.data.get(t);return s===void 0&&(s=t(),a.data.set(t,s)),s},cacheSignal:function(){return ea(Qt).controller.signal}},xg=typeof WeakMap=="function"?WeakMap:Map,gt=0,kt=null,at=null,rt=0,yt=0,va=null,Ts=!1,Zn=!1,lo=!1,us=0,Ot=0,As=0,fn=0,ro=0,ya=0,Pn=0,Fl=null,ma=null,io=!1,Kr=0,Vm=0,Wr=1/0,ei=null,Rs=null,It=0,zs=null,Jn=null,ms=0,co=0,oo=null,Gm=null,Hl=0,uo=null;function ba(){return(gt&2)!==0&&rt!==0?rt&-rt:w.T!==null?xo():Ue()}function Ym(){if(ya===0)if((rt&536870912)===0||ot){var t=re;re<<=1,(re&3932160)===0&&(re=262144),ya=t}else ya=536870912;return t=xa.current,t!==null&&(t.flags|=32),ya}function ha(t,a,s){(t===kt&&(yt===2||yt===9)||t.cancelPendingCommit!==null)&&(In(t,0),qs(t,rt,ya,!1)),pt(t,s),((gt&2)===0||t!==kt)&&(t===kt&&((gt&2)===0&&(fn|=s),Ot===4&&qs(t,rt,ya,!1)),Ga(t))}function Qm(t,a,s){if((gt&6)!==0)throw Error(c(327));var n=!s&&(a&127)===0&&(a&t.expiredLanes)===0||Qe(t,a),r=n?yg(t,a):ho(t,a,!0),d=n;do{if(r===0){Zn&&!n&&qs(t,a,0,!1);break}else{if(s=t.current.alternate,d&&!jg(s)){r=ho(t,a,!1),d=!1;continue}if(r===2){if(d=a,t.errorRecoveryDisabledLanes&d)var h=0;else h=t.pendingLanes&-536870913,h=h!==0?h:h&536870912?536870912:0;if(h!==0){a=h;e:{var b=t;r=Fl;var R=b.current.memoizedState.isDehydrated;if(R&&(In(b,h).flags|=256),h=ho(b,h,!1),h!==2){if(lo&&!R){b.errorRecoveryDisabledLanes|=d,fn|=d,r=4;break e}d=ma,ma=r,d!==null&&(ma===null?ma=d:ma.push.apply(ma,d))}r=h}if(d=!1,r!==2)continue}}if(r===1){In(t,0),qs(t,a,0,!0);break}e:{switch(n=t,d=r,d){case 0:case 1:throw Error(c(345));case 4:if((a&4194048)!==a)break;case 6:qs(n,a,ya,!Ts);break e;case 2:ma=null;break;case 3:case 5:break;default:throw Error(c(329))}if((a&62914560)===a&&(r=Kr+300-Se(),10<r)){if(qs(n,a,ya,!Ts),Oe(n,0,!0)!==0)break e;ms=a,n.timeoutHandle=Nh(Xm.bind(null,n,s,ma,ei,io,a,ya,fn,Pn,Ts,d,"Throttled",-0,0),r);break e}Xm(n,s,ma,ei,io,a,ya,fn,Pn,Ts,d,null,-0,0)}}break}while(!0);Ga(t)}function Xm(t,a,s,n,r,d,h,b,R,ie,fe,ve,oe,me){if(t.timeoutHandle=-1,ve=a.subtreeFlags,ve&8192||(ve&16785408)===16785408){ve={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ia},Bm(a,d,ve);var qe=(d&62914560)===d?Kr-Se():(d&4194048)===d?Vm-Se():0;if(qe=ax(ve,qe),qe!==null){ms=d,t.cancelPendingCommit=qe(th.bind(null,t,a,d,s,n,r,h,b,R,fe,ve,null,oe,me)),qs(t,d,h,!ie);return}}th(t,a,d,s,n,r,h,b,R)}function jg(t){for(var a=t;;){var s=a.tag;if((s===0||s===11||s===15)&&a.flags&16384&&(s=a.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var n=0;n<s.length;n++){var r=s[n],d=r.getSnapshot;r=r.value;try{if(!pa(d(),r))return!1}catch{return!1}}if(s=a.child,a.subtreeFlags&16384&&s!==null)s.return=a,a=s;else{if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function qs(t,a,s,n){a&=~ro,a&=~fn,t.suspendedLanes|=a,t.pingedLanes&=~a,n&&(t.warmLanes|=a),n=t.expirationTimes;for(var r=a;0<r;){var d=31-jt(r),h=1<<d;n[d]=-1,r&=~h}s!==0&&la(t,s,a)}function ti(){return(gt&6)===0?($l(0),!1):!0}function mo(){if(at!==null){if(yt===0)var t=at.return;else t=at,ts=nn=null,kc(t),Hn=null,Sl=0,t=at;for(;t!==null;)Sm(t.alternate,t),t=t.return;at=null}}function In(t,a){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,Lg(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),ms=0,mo(),kt=t,at=s=Wa(t.current,null),rt=a,yt=0,va=null,Ts=!1,Zn=Qe(t,a),lo=!1,Pn=ya=ro=fn=As=Ot=0,ma=Fl=null,io=!1,(a&8)!==0&&(a|=a&32);var n=t.entangledLanes;if(n!==0)for(t=t.entanglements,n&=a;0<n;){var r=31-jt(n),d=1<<r;a|=t[r],n&=~d}return us=a,_r(),s}function Zm(t,a){Je=null,w.H=Al,a===Fn||a===Mr?(a=du(),yt=3):a===pc?(a=du(),yt=4):yt=a===Vc?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,va=a,at===null&&(Ot=1,Gr(t,wa(a,t.current)))}function Pm(){var t=xa.current;return t===null?!0:(rt&4194048)===rt?Ma===null:(rt&62914560)===rt||(rt&536870912)!==0?t===Ma:!1}function Jm(){var t=w.H;return w.H=Al,t===null?Al:t}function Im(){var t=w.A;return w.A=gg,t}function ai(){Ot=4,Ts||(rt&4194048)!==rt&&xa.current!==null||(Zn=!0),(As&134217727)===0&&(fn&134217727)===0||kt===null||qs(kt,rt,ya,!1)}function ho(t,a,s){var n=gt;gt|=2;var r=Jm(),d=Im();(kt!==t||rt!==a)&&(ei=null,In(t,a)),a=!1;var h=Ot;e:do try{if(yt!==0&&at!==null){var b=at,R=va;switch(yt){case 8:mo(),h=6;break e;case 3:case 2:case 9:case 6:xa.current===null&&(a=!0);var ie=yt;if(yt=0,va=null,Kn(t,b,R,ie),s&&Zn){h=0;break e}break;default:ie=yt,yt=0,va=null,Kn(t,b,R,ie)}}vg(),h=Ot;break}catch(fe){Zm(t,fe)}while(!0);return a&&t.shellSuspendCounter++,ts=nn=null,gt=n,w.H=r,w.A=d,at===null&&(kt=null,rt=0,_r()),h}function vg(){for(;at!==null;)Km(at)}function yg(t,a){var s=gt;gt|=2;var n=Jm(),r=Im();kt!==t||rt!==a?(ei=null,Wr=Se()+500,In(t,a)):Zn=Qe(t,a);e:do try{if(yt!==0&&at!==null){a=at;var d=va;t:switch(yt){case 1:yt=0,va=null,Kn(t,a,d,1);break;case 2:case 9:if(cu(d)){yt=0,va=null,Wm(a);break}a=function(){yt!==2&&yt!==9||kt!==t||(yt=7),Ga(t)},d.then(a,a);break e;case 3:yt=7;break e;case 4:yt=5;break e;case 7:cu(d)?(yt=0,va=null,Wm(a)):(yt=0,va=null,Kn(t,a,d,7));break;case 5:var h=null;switch(at.tag){case 26:h=at.memoizedState;case 5:case 27:var b=at;if(h?Lh(h):b.stateNode.complete){yt=0,va=null;var R=b.sibling;if(R!==null)at=R;else{var ie=b.return;ie!==null?(at=ie,si(ie)):at=null}break t}}yt=0,va=null,Kn(t,a,d,5);break;case 6:yt=0,va=null,Kn(t,a,d,6);break;case 8:mo(),Ot=6;break e;default:throw Error(c(462))}}bg();break}catch(fe){Zm(t,fe)}while(!0);return ts=nn=null,w.H=n,w.A=r,gt=s,at!==null?0:(kt=null,rt=0,_r(),Ot)}function bg(){for(;at!==null&&!Ee();)Km(at)}function Km(t){var a=_m(t.alternate,t,us);t.memoizedProps=t.pendingProps,a===null?si(t):at=a}function Wm(t){var a=t,s=a.alternate;switch(a.tag){case 15:case 0:a=gm(s,a,a.pendingProps,a.type,void 0,rt);break;case 11:a=gm(s,a,a.pendingProps,a.type.render,a.ref,rt);break;case 5:kc(a);default:Sm(s,a),a=at=Id(a,us),a=_m(s,a,us)}t.memoizedProps=t.pendingProps,a===null?si(t):at=a}function Kn(t,a,s,n){ts=nn=null,kc(a),Hn=null,Sl=0;var r=a.return;try{if(og(t,r,a,s,rt)){Ot=1,Gr(t,wa(s,t.current)),at=null;return}}catch(d){if(r!==null)throw at=r,d;Ot=1,Gr(t,wa(s,t.current)),at=null;return}a.flags&32768?(ot||n===1?t=!0:Zn||(rt&536870912)!==0?t=!1:(Ts=t=!0,(n===2||n===9||n===3||n===6)&&(n=xa.current,n!==null&&n.tag===13&&(n.flags|=16384))),eh(a,t)):si(a)}function si(t){var a=t;do{if((a.flags&32768)!==0){eh(a,Ts);return}t=a.return;var s=mg(a.alternate,a,us);if(s!==null){at=s;return}if(a=a.sibling,a!==null){at=a;return}at=a=t}while(a!==null);Ot===0&&(Ot=5)}function eh(t,a){do{var s=hg(t.alternate,t);if(s!==null){s.flags&=32767,at=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!a&&(t=t.sibling,t!==null)){at=t;return}at=t=s}while(t!==null);Ot=6,at=null}function th(t,a,s,n,r,d,h,b,R){t.cancelPendingCommit=null;do ni();while(It!==0);if((gt&6)!==0)throw Error(c(327));if(a!==null){if(a===t.current)throw Error(c(177));if(d=a.lanes|a.childLanes,d|=ec,Bt(t,s,d,h,b,R),t===kt&&(at=kt=null,rt=0),Jn=a,zs=t,ms=s,co=d,oo=r,Gm=n,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,Cg(Rt,function(){return rh(),null})):(t.callbackNode=null,t.callbackPriority=0),n=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||n){n=w.T,w.T=null,r=k.p,k.p=2,h=gt,gt|=4;try{fg(t,a,s)}finally{gt=h,k.p=r,w.T=n}}It=1,ah(),sh(),nh()}}function ah(){if(It===1){It=0;var t=zs,a=Jn,s=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||s){s=w.T,w.T=null;var n=k.p;k.p=2;var r=gt;gt|=4;try{Om(a,t);var d=Co,h=$d(t.containerInfo),b=d.focusedElem,R=d.selectionRange;if(h!==b&&b&&b.ownerDocument&&Hd(b.ownerDocument.documentElement,b)){if(R!==null&&Pi(b)){var ie=R.start,fe=R.end;if(fe===void 0&&(fe=ie),"selectionStart"in b)b.selectionStart=ie,b.selectionEnd=Math.min(fe,b.value.length);else{var ve=b.ownerDocument||document,oe=ve&&ve.defaultView||window;if(oe.getSelection){var me=oe.getSelection(),qe=b.textContent.length,Ge=Math.min(R.start,qe),Ct=R.end===void 0?Ge:Math.min(R.end,qe);!me.extend&&Ge>Ct&&(h=Ct,Ct=Ge,Ge=h);var W=Fd(b,Ge),G=Fd(b,Ct);if(W&&G&&(me.rangeCount!==1||me.anchorNode!==W.node||me.anchorOffset!==W.offset||me.focusNode!==G.node||me.focusOffset!==G.offset)){var le=ve.createRange();le.setStart(W.node,W.offset),me.removeAllRanges(),Ge>Ct?(me.addRange(le),me.extend(G.node,G.offset)):(le.setEnd(G.node,G.offset),me.addRange(le))}}}}for(ve=[],me=b;me=me.parentNode;)me.nodeType===1&&ve.push({element:me,left:me.scrollLeft,top:me.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<ve.length;b++){var ge=ve[b];ge.element.scrollLeft=ge.left,ge.element.scrollTop=ge.top}}gi=!!So,Co=So=null}finally{gt=r,k.p=n,w.T=s}}t.current=a,It=2}}function sh(){if(It===2){It=0;var t=zs,a=Jn,s=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||s){s=w.T,w.T=null;var n=k.p;k.p=2;var r=gt;gt|=4;try{Tm(t,a.alternate,a)}finally{gt=r,k.p=n,w.T=s}}It=3}}function nh(){if(It===4||It===3){It=0,ae();var t=zs,a=Jn,s=ms,n=Gm;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?It=5:(It=0,Jn=zs=null,lh(t,t.pendingLanes));var r=t.pendingLanes;if(r===0&&(Rs=null),ra(s),a=a.stateNode,tt&&typeof tt.onCommitFiberRoot=="function")try{tt.onCommitFiberRoot(et,a,void 0,(a.current.flags&128)===128)}catch{}if(n!==null){a=w.T,r=k.p,k.p=2,w.T=null;try{for(var d=t.onRecoverableError,h=0;h<n.length;h++){var b=n[h];d(b.value,{componentStack:b.stack})}}finally{w.T=a,k.p=r}}(ms&3)!==0&&ni(),Ga(t),r=t.pendingLanes,(s&261930)!==0&&(r&42)!==0?t===uo?Hl++:(Hl=0,uo=t):Hl=0,$l(0)}}function lh(t,a){(t.pooledCacheLanes&=a)===0&&(a=t.pooledCache,a!=null&&(t.pooledCache=null,_l(a)))}function ni(){return ah(),sh(),nh(),rh()}function rh(){if(It!==5)return!1;var t=zs,a=co;co=0;var s=ra(ms),n=w.T,r=k.p;try{k.p=32>s?32:s,w.T=null,s=oo,oo=null;var d=zs,h=ms;if(It=0,Jn=zs=null,ms=0,(gt&6)!==0)throw Error(c(331));var b=gt;if(gt|=4,Hm(d.current),Lm(d,d.current,h,s),gt=b,$l(0,!1),tt&&typeof tt.onPostCommitFiberRoot=="function")try{tt.onPostCommitFiberRoot(et,d)}catch{}return!0}finally{k.p=r,w.T=n,lh(t,a)}}function ih(t,a,s){a=wa(s,a),a=$c(t.stateNode,a,2),t=ks(t,a,2),t!==null&&(pt(t,2),Ga(t))}function bt(t,a,s){if(t.tag===3)ih(t,t,s);else for(;a!==null;){if(a.tag===3){ih(a,t,s);break}else if(a.tag===1){var n=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Rs===null||!Rs.has(n))){t=wa(s,t),s=cm(2),n=ks(a,s,2),n!==null&&(om(s,n,a,t),pt(n,2),Ga(n));break}}a=a.return}}function fo(t,a,s){var n=t.pingCache;if(n===null){n=t.pingCache=new xg;var r=new Set;n.set(a,r)}else r=n.get(a),r===void 0&&(r=new Set,n.set(a,r));r.has(s)||(lo=!0,r.add(s),t=_g.bind(null,t,a,s),a.then(t,t))}function _g(t,a,s){var n=t.pingCache;n!==null&&n.delete(a),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,kt===t&&(rt&s)===s&&(Ot===4||Ot===3&&(rt&62914560)===rt&&300>Se()-Kr?(gt&2)===0&&In(t,0):ro|=s,Pn===rt&&(Pn=0)),Ga(t)}function ch(t,a){a===0&&(a=je()),t=tn(t,a),t!==null&&(pt(t,a),Ga(t))}function Ng(t){var a=t.memoizedState,s=0;a!==null&&(s=a.retryLane),ch(t,s)}function Sg(t,a){var s=0;switch(t.tag){case 31:case 13:var n=t.stateNode,r=t.memoizedState;r!==null&&(s=r.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(c(314))}n!==null&&n.delete(a),ch(t,s)}function Cg(t,a){return T(t,a)}var li=null,Wn=null,po=!1,ri=!1,go=!1,Os=0;function Ga(t){t!==Wn&&t.next===null&&(Wn===null?li=Wn=t:Wn=Wn.next=t),ri=!0,po||(po=!0,kg())}function $l(t,a){if(!go&&ri){go=!0;do for(var s=!1,n=li;n!==null;){if(t!==0){var r=n.pendingLanes;if(r===0)var d=0;else{var h=n.suspendedLanes,b=n.pingedLanes;d=(1<<31-jt(42|t)+1)-1,d&=r&~(h&~b),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(s=!0,mh(n,d))}else d=rt,d=Oe(n,n===kt?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(d&3)===0||Qe(n,d)||(s=!0,mh(n,d));n=n.next}while(s);go=!1}}function wg(){oh()}function oh(){ri=po=!1;var t=0;Os!==0&&Ug()&&(t=Os);for(var a=Se(),s=null,n=li;n!==null;){var r=n.next,d=dh(n,a);d===0?(n.next=null,s===null?li=r:s.next=r,r===null&&(Wn=s)):(s=n,(t!==0||(d&3)!==0)&&(ri=!0)),n=r}It!==0&&It!==5||$l(t),Os!==0&&(Os=0)}function dh(t,a){for(var s=t.suspendedLanes,n=t.pingedLanes,r=t.expirationTimes,d=t.pendingLanes&-62914561;0<d;){var h=31-jt(d),b=1<<h,R=r[h];R===-1?((b&s)===0||(b&n)!==0)&&(r[h]=Te(b,a)):R<=a&&(t.expiredLanes|=b),d&=~b}if(a=kt,s=rt,s=Oe(t,t===a?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n=t.callbackNode,s===0||t===a&&(yt===2||yt===9)||t.cancelPendingCommit!==null)return n!==null&&n!==null&&_e(n),t.callbackNode=null,t.callbackPriority=0;if((s&3)===0||Qe(t,s)){if(a=s&-s,a===t.callbackPriority)return a;switch(n!==null&&_e(n),ra(s)){case 2:case 8:s=Ut;break;case 32:s=Rt;break;case 268435456:s=Gt;break;default:s=Rt}return n=uh.bind(null,t),s=T(s,n),t.callbackPriority=a,t.callbackNode=s,a}return n!==null&&n!==null&&_e(n),t.callbackPriority=2,t.callbackNode=null,2}function uh(t,a){if(It!==0&&It!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(ni()&&t.callbackNode!==s)return null;var n=rt;return n=Oe(t,t===kt?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n===0?null:(Qm(t,n,a),dh(t,Se()),t.callbackNode!=null&&t.callbackNode===s?uh.bind(null,t):null)}function mh(t,a){if(ni())return null;Qm(t,a,!0)}function kg(){Bg(function(){(gt&6)!==0?T(Pe,wg):oh()})}function xo(){if(Os===0){var t=Ln;t===0&&(t=N,N<<=1,(N&261888)===0&&(N=256)),Os=t}return Os}function hh(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:fr(""+t)}function fh(t,a){var s=a.ownerDocument.createElement("input");return s.name=a.name,s.value=a.value,t.id&&s.setAttribute("form",t.id),a.parentNode.insertBefore(s,a),t=new FormData(t),s.parentNode.removeChild(s),t}function Eg(t,a,s,n,r){if(a==="submit"&&s&&s.stateNode===r){var d=hh((r[Mt]||null).action),h=n.submitter;h&&(a=(a=h[Mt]||null)?hh(a.formAction):h.getAttribute("formAction"),a!==null&&(d=a,h=null));var b=new jr("action","action",null,n,r);t.push({event:b,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(Os!==0){var R=h?fh(r,h):new FormData(r);Oc(s,{pending:!0,data:R,method:r.method,action:d},null,R)}}else typeof d=="function"&&(b.preventDefault(),R=h?fh(r,h):new FormData(r),Oc(s,{pending:!0,data:R,method:r.method,action:d},d,R))},currentTarget:r}]})}}for(var jo=0;jo<Wi.length;jo++){var vo=Wi[jo],Dg=vo.toLowerCase(),Mg=vo[0].toUpperCase()+vo.slice(1);qa(Dg,"on"+Mg)}qa(Yd,"onAnimationEnd"),qa(Qd,"onAnimationIteration"),qa(Xd,"onAnimationStart"),qa("dblclick","onDoubleClick"),qa("focusin","onFocus"),qa("focusout","onBlur"),qa(Qp,"onTransitionRun"),qa(Xp,"onTransitionStart"),qa(Zp,"onTransitionCancel"),qa(Zd,"onTransitionEnd"),Sn("onMouseEnter",["mouseout","mouseover"]),Sn("onMouseLeave",["mouseout","mouseover"]),Sn("onPointerEnter",["pointerout","pointerover"]),Sn("onPointerLeave",["pointerout","pointerover"]),Is("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Is("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Is("onBeforeInput",["compositionend","keypress","textInput","paste"]),Is("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Is("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Is("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Tg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Vl));function ph(t,a){a=(a&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],r=n.event;n=n.listeners;e:{var d=void 0;if(a)for(var h=n.length-1;0<=h;h--){var b=n[h],R=b.instance,ie=b.currentTarget;if(b=b.listener,R!==d&&r.isPropagationStopped())break e;d=b,r.currentTarget=ie;try{d(r)}catch(fe){br(fe)}r.currentTarget=null,d=R}else for(h=0;h<n.length;h++){if(b=n[h],R=b.instance,ie=b.currentTarget,b=b.listener,R!==d&&r.isPropagationStopped())break e;d=b,r.currentTarget=ie;try{d(r)}catch(fe){br(fe)}r.currentTarget=null,d=R}}}}function st(t,a){var s=a[fa];s===void 0&&(s=a[fa]=new Set);var n=t+"__bubble";s.has(n)||(gh(a,t,2,!1),s.add(n))}function yo(t,a,s){var n=0;a&&(n|=4),gh(s,t,n,a)}var ii="_reactListening"+Math.random().toString(36).slice(2);function bo(t){if(!t[ii]){t[ii]=!0,dr.forEach(function(s){s!=="selectionchange"&&(Tg.has(s)||yo(s,!1,t),yo(s,!0,t))});var a=t.nodeType===9?t:t.ownerDocument;a===null||a[ii]||(a[ii]=!0,yo("selectionchange",!1,a))}}function gh(t,a,s,n){switch(Yh(a)){case 2:var r=lx;break;case 8:r=rx;break;default:r=Oo}s=r.bind(null,a,s,t),r=void 0,!Fi||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(r=!0),n?r!==void 0?t.addEventListener(a,s,{capture:!0,passive:r}):t.addEventListener(a,s,!0):r!==void 0?t.addEventListener(a,s,{passive:r}):t.addEventListener(a,s,!1)}function _o(t,a,s,n,r){var d=n;if((a&1)===0&&(a&2)===0&&n!==null)e:for(;;){if(n===null)return;var h=n.tag;if(h===3||h===4){var b=n.stateNode.containerInfo;if(b===r)break;if(h===4)for(h=n.return;h!==null;){var R=h.tag;if((R===3||R===4)&&h.stateNode.containerInfo===r)return;h=h.return}for(;b!==null;){if(h=Pa(b),h===null)return;if(R=h.tag,R===5||R===6||R===26||R===27){n=d=h;continue e}b=b.parentNode}}n=n.return}bd(function(){var ie=d,fe=Li(s),ve=[];e:{var oe=Pd.get(t);if(oe!==void 0){var me=jr,qe=t;switch(t){case"keypress":if(gr(s)===0)break e;case"keydown":case"keyup":me=Sp;break;case"focusin":qe="focus",me=Gi;break;case"focusout":qe="blur",me=Gi;break;case"beforeblur":case"afterblur":me=Gi;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":me=Sd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":me=mp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":me=kp;break;case Yd:case Qd:case Xd:me=pp;break;case Zd:me=Dp;break;case"scroll":case"scrollend":me=dp;break;case"wheel":me=Tp;break;case"copy":case"cut":case"paste":me=xp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":me=wd;break;case"toggle":case"beforetoggle":me=Rp}var Ge=(a&4)!==0,Ct=!Ge&&(t==="scroll"||t==="scrollend"),W=Ge?oe!==null?oe+"Capture":null:oe;Ge=[];for(var G=ie,le;G!==null;){var ge=G;if(le=ge.stateNode,ge=ge.tag,ge!==5&&ge!==26&&ge!==27||le===null||W===null||(ge=ul(G,W),ge!=null&&Ge.push(Gl(G,ge,le))),Ct)break;G=G.return}0<Ge.length&&(oe=new me(oe,qe,null,s,fe),ve.push({event:oe,listeners:Ge}))}}if((a&7)===0){e:{if(oe=t==="mouseover"||t==="pointerover",me=t==="mouseout"||t==="pointerout",oe&&s!==Ui&&(qe=s.relatedTarget||s.fromElement)&&(Pa(qe)||qe[Jt]))break e;if((me||oe)&&(oe=fe.window===fe?fe:(oe=fe.ownerDocument)?oe.defaultView||oe.parentWindow:window,me?(qe=s.relatedTarget||s.toElement,me=ie,qe=qe?Pa(qe):null,qe!==null&&(Ct=u(qe),Ge=qe.tag,qe!==Ct||Ge!==5&&Ge!==27&&Ge!==6)&&(qe=null)):(me=null,qe=ie),me!==qe)){if(Ge=Sd,ge="onMouseLeave",W="onMouseEnter",G="mouse",(t==="pointerout"||t==="pointerover")&&(Ge=wd,ge="onPointerLeave",W="onPointerEnter",G="pointer"),Ct=me==null?oe:js(me),le=qe==null?oe:js(qe),oe=new Ge(ge,G+"leave",me,s,fe),oe.target=Ct,oe.relatedTarget=le,ge=null,Pa(fe)===ie&&(Ge=new Ge(W,G+"enter",qe,s,fe),Ge.target=le,Ge.relatedTarget=Ct,ge=Ge),Ct=ge,me&&qe)t:{for(Ge=Ag,W=me,G=qe,le=0,ge=W;ge;ge=Ge(ge))le++;ge=0;for(var $e=G;$e;$e=Ge($e))ge++;for(;0<le-ge;)W=Ge(W),le--;for(;0<ge-le;)G=Ge(G),ge--;for(;le--;){if(W===G||G!==null&&W===G.alternate){Ge=W;break t}W=Ge(W),G=Ge(G)}Ge=null}else Ge=null;me!==null&&xh(ve,oe,me,Ge,!1),qe!==null&&Ct!==null&&xh(ve,Ct,qe,Ge,!0)}}e:{if(oe=ie?js(ie):window,me=oe.nodeName&&oe.nodeName.toLowerCase(),me==="select"||me==="input"&&oe.type==="file")var ht=zd;else if(Ad(oe))if(qd)ht=Vp;else{ht=Hp;var Le=Fp}else me=oe.nodeName,!me||me.toLowerCase()!=="input"||oe.type!=="checkbox"&&oe.type!=="radio"?ie&&Oi(ie.elementType)&&(ht=zd):ht=$p;if(ht&&(ht=ht(t,ie))){Rd(ve,ht,s,fe);break e}Le&&Le(t,oe,ie),t==="focusout"&&ie&&oe.type==="number"&&ie.memoizedProps.value!=null&&qi(oe,"number",oe.value)}switch(Le=ie?js(ie):window,t){case"focusin":(Ad(Le)||Le.contentEditable==="true")&&(Mn=Le,Ji=ie,vl=null);break;case"focusout":vl=Ji=Mn=null;break;case"mousedown":Ii=!0;break;case"contextmenu":case"mouseup":case"dragend":Ii=!1,Vd(ve,s,fe);break;case"selectionchange":if(Yp)break;case"keydown":case"keyup":Vd(ve,s,fe)}var Ke;if(Qi)e:{switch(t){case"compositionstart":var it="onCompositionStart";break e;case"compositionend":it="onCompositionEnd";break e;case"compositionupdate":it="onCompositionUpdate";break e}it=void 0}else Dn?Md(t,s)&&(it="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(it="onCompositionStart");it&&(kd&&s.locale!=="ko"&&(Dn||it!=="onCompositionStart"?it==="onCompositionEnd"&&Dn&&(Ke=_d()):(ys=fe,Hi="value"in ys?ys.value:ys.textContent,Dn=!0)),Le=ci(ie,it),0<Le.length&&(it=new Cd(it,t,null,s,fe),ve.push({event:it,listeners:Le}),Ke?it.data=Ke:(Ke=Td(s),Ke!==null&&(it.data=Ke)))),(Ke=qp?Op(t,s):Up(t,s))&&(it=ci(ie,"onBeforeInput"),0<it.length&&(Le=new Cd("onBeforeInput","beforeinput",null,s,fe),ve.push({event:Le,listeners:it}),Le.data=Ke)),Eg(ve,t,ie,s,fe)}ph(ve,a)})}function Gl(t,a,s){return{instance:t,listener:a,currentTarget:s}}function ci(t,a){for(var s=a+"Capture",n=[];t!==null;){var r=t,d=r.stateNode;if(r=r.tag,r!==5&&r!==26&&r!==27||d===null||(r=ul(t,s),r!=null&&n.unshift(Gl(t,r,d)),r=ul(t,a),r!=null&&n.push(Gl(t,r,d))),t.tag===3)return n;t=t.return}return[]}function Ag(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function xh(t,a,s,n,r){for(var d=a._reactName,h=[];s!==null&&s!==n;){var b=s,R=b.alternate,ie=b.stateNode;if(b=b.tag,R!==null&&R===n)break;b!==5&&b!==26&&b!==27||ie===null||(R=ie,r?(ie=ul(s,d),ie!=null&&h.unshift(Gl(s,ie,R))):r||(ie=ul(s,d),ie!=null&&h.push(Gl(s,ie,R)))),s=s.return}h.length!==0&&t.push({event:a,listeners:h})}var Rg=/\r\n?/g,zg=/\u0000|\uFFFD/g;function jh(t){return(typeof t=="string"?t:""+t).replace(Rg,`
`).replace(zg,"")}function vh(t,a){return a=jh(a),jh(t)===a}function St(t,a,s,n,r,d){switch(s){case"children":typeof n=="string"?a==="body"||a==="textarea"&&n===""||wn(t,n):(typeof n=="number"||typeof n=="bigint")&&a!=="body"&&wn(t,""+n);break;case"className":mr(t,"class",n);break;case"tabIndex":mr(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":mr(t,s,n);break;case"style":vd(t,n,d);break;case"data":if(a!=="object"){mr(t,"data",n);break}case"src":case"href":if(n===""&&(a!=="a"||s!=="href")){t.removeAttribute(s);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=fr(""+n),t.setAttribute(s,n);break;case"action":case"formAction":if(typeof n=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(s==="formAction"?(a!=="input"&&St(t,a,"name",r.name,r,null),St(t,a,"formEncType",r.formEncType,r,null),St(t,a,"formMethod",r.formMethod,r,null),St(t,a,"formTarget",r.formTarget,r,null)):(St(t,a,"encType",r.encType,r,null),St(t,a,"method",r.method,r,null),St(t,a,"target",r.target,r,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=fr(""+n),t.setAttribute(s,n);break;case"onClick":n!=null&&(t.onclick=Ia);break;case"onScroll":n!=null&&st("scroll",t);break;case"onScrollEnd":n!=null&&st("scrollend",t);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(c(61));if(s=n.__html,s!=null){if(r.children!=null)throw Error(c(60));t.innerHTML=s}}break;case"multiple":t.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":t.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){t.removeAttribute("xlink:href");break}s=fr(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""+n):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":n===!0?t.setAttribute(s,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,n):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?t.setAttribute(s,n):t.removeAttribute(s);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?t.removeAttribute(s):t.setAttribute(s,n);break;case"popover":st("beforetoggle",t),st("toggle",t),ur(t,"popover",n);break;case"xlinkActuate":Ja(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":Ja(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":Ja(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":Ja(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":Ja(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":Ja(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":Ja(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":Ja(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":Ja(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":ur(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=cp.get(s)||s,ur(t,s,n))}}function No(t,a,s,n,r,d){switch(s){case"style":vd(t,n,d);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(c(61));if(s=n.__html,s!=null){if(r.children!=null)throw Error(c(60));t.innerHTML=s}}break;case"children":typeof n=="string"?wn(t,n):(typeof n=="number"||typeof n=="bigint")&&wn(t,""+n);break;case"onScroll":n!=null&&st("scroll",t);break;case"onScrollEnd":n!=null&&st("scrollend",t);break;case"onClick":n!=null&&(t.onclick=Ia);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!dl.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(r=s.endsWith("Capture"),a=s.slice(2,r?s.length-7:void 0),d=t[Mt]||null,d=d!=null?d[s]:null,typeof d=="function"&&t.removeEventListener(a,d,r),typeof n=="function")){typeof d!="function"&&d!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(a,n,r);break e}s in t?t[s]=n:n===!0?t.setAttribute(s,""):ur(t,s,n)}}}function aa(t,a,s){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":st("error",t),st("load",t);var n=!1,r=!1,d;for(d in s)if(s.hasOwnProperty(d)){var h=s[d];if(h!=null)switch(d){case"src":n=!0;break;case"srcSet":r=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(c(137,a));default:St(t,a,d,h,s,null)}}r&&St(t,a,"srcSet",s.srcSet,s,null),n&&St(t,a,"src",s.src,s,null);return;case"input":st("invalid",t);var b=d=h=r=null,R=null,ie=null;for(n in s)if(s.hasOwnProperty(n)){var fe=s[n];if(fe!=null)switch(n){case"name":r=fe;break;case"type":h=fe;break;case"checked":R=fe;break;case"defaultChecked":ie=fe;break;case"value":d=fe;break;case"defaultValue":b=fe;break;case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(c(137,a));break;default:St(t,a,n,fe,s,null)}}pd(t,d,b,R,ie,h,r,!1);return;case"select":st("invalid",t),n=h=d=null;for(r in s)if(s.hasOwnProperty(r)&&(b=s[r],b!=null))switch(r){case"value":d=b;break;case"defaultValue":h=b;break;case"multiple":n=b;default:St(t,a,r,b,s,null)}a=d,s=h,t.multiple=!!n,a!=null?Cn(t,!!n,a,!1):s!=null&&Cn(t,!!n,s,!0);return;case"textarea":st("invalid",t),d=r=n=null;for(h in s)if(s.hasOwnProperty(h)&&(b=s[h],b!=null))switch(h){case"value":n=b;break;case"defaultValue":r=b;break;case"children":d=b;break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(c(91));break;default:St(t,a,h,b,s,null)}xd(t,n,r,d);return;case"option":for(R in s)if(s.hasOwnProperty(R)&&(n=s[R],n!=null))switch(R){case"selected":t.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:St(t,a,R,n,s,null)}return;case"dialog":st("beforetoggle",t),st("toggle",t),st("cancel",t),st("close",t);break;case"iframe":case"object":st("load",t);break;case"video":case"audio":for(n=0;n<Vl.length;n++)st(Vl[n],t);break;case"image":st("error",t),st("load",t);break;case"details":st("toggle",t);break;case"embed":case"source":case"link":st("error",t),st("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ie in s)if(s.hasOwnProperty(ie)&&(n=s[ie],n!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":throw Error(c(137,a));default:St(t,a,ie,n,s,null)}return;default:if(Oi(a)){for(fe in s)s.hasOwnProperty(fe)&&(n=s[fe],n!==void 0&&No(t,a,fe,n,s,void 0));return}}for(b in s)s.hasOwnProperty(b)&&(n=s[b],n!=null&&St(t,a,b,n,s,null))}function qg(t,a,s,n){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,d=null,h=null,b=null,R=null,ie=null,fe=null;for(me in s){var ve=s[me];if(s.hasOwnProperty(me)&&ve!=null)switch(me){case"checked":break;case"value":break;case"defaultValue":R=ve;default:n.hasOwnProperty(me)||St(t,a,me,null,n,ve)}}for(var oe in n){var me=n[oe];if(ve=s[oe],n.hasOwnProperty(oe)&&(me!=null||ve!=null))switch(oe){case"type":d=me;break;case"name":r=me;break;case"checked":ie=me;break;case"defaultChecked":fe=me;break;case"value":h=me;break;case"defaultValue":b=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(c(137,a));break;default:me!==ve&&St(t,a,oe,me,n,ve)}}zi(t,h,b,R,ie,fe,d,r);return;case"select":me=h=b=oe=null;for(d in s)if(R=s[d],s.hasOwnProperty(d)&&R!=null)switch(d){case"value":break;case"multiple":me=R;default:n.hasOwnProperty(d)||St(t,a,d,null,n,R)}for(r in n)if(d=n[r],R=s[r],n.hasOwnProperty(r)&&(d!=null||R!=null))switch(r){case"value":oe=d;break;case"defaultValue":b=d;break;case"multiple":h=d;default:d!==R&&St(t,a,r,d,n,R)}a=b,s=h,n=me,oe!=null?Cn(t,!!s,oe,!1):!!n!=!!s&&(a!=null?Cn(t,!!s,a,!0):Cn(t,!!s,s?[]:"",!1));return;case"textarea":me=oe=null;for(b in s)if(r=s[b],s.hasOwnProperty(b)&&r!=null&&!n.hasOwnProperty(b))switch(b){case"value":break;case"children":break;default:St(t,a,b,null,n,r)}for(h in n)if(r=n[h],d=s[h],n.hasOwnProperty(h)&&(r!=null||d!=null))switch(h){case"value":oe=r;break;case"defaultValue":me=r;break;case"children":break;case"dangerouslySetInnerHTML":if(r!=null)throw Error(c(91));break;default:r!==d&&St(t,a,h,r,n,d)}gd(t,oe,me);return;case"option":for(var qe in s)if(oe=s[qe],s.hasOwnProperty(qe)&&oe!=null&&!n.hasOwnProperty(qe))switch(qe){case"selected":t.selected=!1;break;default:St(t,a,qe,null,n,oe)}for(R in n)if(oe=n[R],me=s[R],n.hasOwnProperty(R)&&oe!==me&&(oe!=null||me!=null))switch(R){case"selected":t.selected=oe&&typeof oe!="function"&&typeof oe!="symbol";break;default:St(t,a,R,oe,n,me)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ge in s)oe=s[Ge],s.hasOwnProperty(Ge)&&oe!=null&&!n.hasOwnProperty(Ge)&&St(t,a,Ge,null,n,oe);for(ie in n)if(oe=n[ie],me=s[ie],n.hasOwnProperty(ie)&&oe!==me&&(oe!=null||me!=null))switch(ie){case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(c(137,a));break;default:St(t,a,ie,oe,n,me)}return;default:if(Oi(a)){for(var Ct in s)oe=s[Ct],s.hasOwnProperty(Ct)&&oe!==void 0&&!n.hasOwnProperty(Ct)&&No(t,a,Ct,void 0,n,oe);for(fe in n)oe=n[fe],me=s[fe],!n.hasOwnProperty(fe)||oe===me||oe===void 0&&me===void 0||No(t,a,fe,oe,n,me);return}}for(var W in s)oe=s[W],s.hasOwnProperty(W)&&oe!=null&&!n.hasOwnProperty(W)&&St(t,a,W,null,n,oe);for(ve in n)oe=n[ve],me=s[ve],!n.hasOwnProperty(ve)||oe===me||oe==null&&me==null||St(t,a,ve,oe,n,me)}function yh(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Og(){if(typeof performance.getEntriesByType=="function"){for(var t=0,a=0,s=performance.getEntriesByType("resource"),n=0;n<s.length;n++){var r=s[n],d=r.transferSize,h=r.initiatorType,b=r.duration;if(d&&b&&yh(h)){for(h=0,b=r.responseEnd,n+=1;n<s.length;n++){var R=s[n],ie=R.startTime;if(ie>b)break;var fe=R.transferSize,ve=R.initiatorType;fe&&yh(ve)&&(R=R.responseEnd,h+=fe*(R<b?1:(b-ie)/(R-ie)))}if(--n,a+=8*(d+h)/(r.duration/1e3),t++,10<t)break}}if(0<t)return a/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var So=null,Co=null;function oi(t){return t.nodeType===9?t:t.ownerDocument}function bh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _h(t,a){if(t===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&a==="foreignObject"?0:t}function wo(t,a){return t==="textarea"||t==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var ko=null;function Ug(){var t=window.event;return t&&t.type==="popstate"?t===ko?!1:(ko=t,!0):(ko=null,!1)}var Nh=typeof setTimeout=="function"?setTimeout:void 0,Lg=typeof clearTimeout=="function"?clearTimeout:void 0,Sh=typeof Promise=="function"?Promise:void 0,Bg=typeof queueMicrotask=="function"?queueMicrotask:typeof Sh<"u"?function(t){return Sh.resolve(null).then(t).catch(Fg)}:Nh;function Fg(t){setTimeout(function(){throw t})}function Us(t){return t==="head"}function Ch(t,a){var s=a,n=0;do{var r=s.nextSibling;if(t.removeChild(s),r&&r.nodeType===8)if(s=r.data,s==="/$"||s==="/&"){if(n===0){t.removeChild(r),sl(a);return}n--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")n++;else if(s==="html")Yl(t.ownerDocument.documentElement);else if(s==="head"){s=t.ownerDocument.head,Yl(s);for(var d=s.firstChild;d;){var h=d.nextSibling,b=d.nodeName;d[Js]||b==="SCRIPT"||b==="STYLE"||b==="LINK"&&d.rel.toLowerCase()==="stylesheet"||s.removeChild(d),d=h}}else s==="body"&&Yl(t.ownerDocument.body);s=r}while(s);sl(a)}function wh(t,a){var s=t;t=0;do{var n=s.nextSibling;if(s.nodeType===1?a?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(a?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),n&&n.nodeType===8)if(s=n.data,s==="/$"){if(t===0)break;t--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||t++;s=n}while(s)}function Eo(t){var a=t.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var s=a;switch(a=a.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":Eo(s),Nn(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function Hg(t,a,s,n){for(;t.nodeType===1;){var r=s;if(t.nodeName.toLowerCase()!==a.toLowerCase()){if(!n&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(n){if(!t[Js])switch(a){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(d=t.getAttribute("rel"),d==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(d!==r.rel||t.getAttribute("href")!==(r.href==null||r.href===""?null:r.href)||t.getAttribute("crossorigin")!==(r.crossOrigin==null?null:r.crossOrigin)||t.getAttribute("title")!==(r.title==null?null:r.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(d=t.getAttribute("src"),(d!==(r.src==null?null:r.src)||t.getAttribute("type")!==(r.type==null?null:r.type)||t.getAttribute("crossorigin")!==(r.crossOrigin==null?null:r.crossOrigin))&&d&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(a==="input"&&t.type==="hidden"){var d=r.name==null?null:""+r.name;if(r.type==="hidden"&&t.getAttribute("name")===d)return t}else return t;if(t=Ta(t.nextSibling),t===null)break}return null}function $g(t,a,s){if(a==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=Ta(t.nextSibling),t===null))return null;return t}function kh(t,a){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!a||(t=Ta(t.nextSibling),t===null))return null;return t}function Do(t){return t.data==="$?"||t.data==="$~"}function Mo(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function Vg(t,a){var s=t.ownerDocument;if(t.data==="$~")t._reactRetry=a;else if(t.data!=="$?"||s.readyState!=="loading")a();else{var n=function(){a(),s.removeEventListener("DOMContentLoaded",n)};s.addEventListener("DOMContentLoaded",n),t._reactRetry=n}}function Ta(t){for(;t!=null;t=t.nextSibling){var a=t.nodeType;if(a===1||a===3)break;if(a===8){if(a=t.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return t}var To=null;function Eh(t){t=t.nextSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"||s==="/&"){if(a===0)return Ta(t.nextSibling);a--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||a++}t=t.nextSibling}return null}function Dh(t){t=t.previousSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(a===0)return t;a--}else s!=="/$"&&s!=="/&"||a++}t=t.previousSibling}return null}function Mh(t,a,s){switch(a=oi(s),t){case"html":if(t=a.documentElement,!t)throw Error(c(452));return t;case"head":if(t=a.head,!t)throw Error(c(453));return t;case"body":if(t=a.body,!t)throw Error(c(454));return t;default:throw Error(c(451))}}function Yl(t){for(var a=t.attributes;a.length;)t.removeAttributeNode(a[0]);Nn(t)}var Aa=new Map,Th=new Set;function di(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var hs=k.d;k.d={f:Gg,r:Yg,D:Qg,C:Xg,L:Zg,m:Pg,X:Ig,S:Jg,M:Kg};function Gg(){var t=hs.f(),a=ti();return t||a}function Yg(t){var a=Fa(t);a!==null&&a.tag===5&&a.type==="form"?Zu(a):hs.r(t)}var el=typeof document>"u"?null:document;function Ah(t,a,s){var n=el;if(n&&typeof a=="string"&&a){var r=Sa(a);r='link[rel="'+t+'"][href="'+r+'"]',typeof s=="string"&&(r+='[crossorigin="'+s+'"]'),Th.has(r)||(Th.add(r),t={rel:t,crossOrigin:s,href:a},n.querySelector(r)===null&&(a=n.createElement("link"),aa(a,"link",t),_t(a),n.head.appendChild(a)))}}function Qg(t){hs.D(t),Ah("dns-prefetch",t,null)}function Xg(t,a){hs.C(t,a),Ah("preconnect",t,a)}function Zg(t,a,s){hs.L(t,a,s);var n=el;if(n&&t&&a){var r='link[rel="preload"][as="'+Sa(a)+'"]';a==="image"&&s&&s.imageSrcSet?(r+='[imagesrcset="'+Sa(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(r+='[imagesizes="'+Sa(s.imageSizes)+'"]')):r+='[href="'+Sa(t)+'"]';var d=r;switch(a){case"style":d=tl(t);break;case"script":d=al(t)}Aa.has(d)||(t=A({rel:"preload",href:a==="image"&&s&&s.imageSrcSet?void 0:t,as:a},s),Aa.set(d,t),n.querySelector(r)!==null||a==="style"&&n.querySelector(Ql(d))||a==="script"&&n.querySelector(Xl(d))||(a=n.createElement("link"),aa(a,"link",t),_t(a),n.head.appendChild(a)))}}function Pg(t,a){hs.m(t,a);var s=el;if(s&&t){var n=a&&typeof a.as=="string"?a.as:"script",r='link[rel="modulepreload"][as="'+Sa(n)+'"][href="'+Sa(t)+'"]',d=r;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=al(t)}if(!Aa.has(d)&&(t=A({rel:"modulepreload",href:t},a),Aa.set(d,t),s.querySelector(r)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(Xl(d)))return}n=s.createElement("link"),aa(n,"link",t),_t(n),s.head.appendChild(n)}}}function Jg(t,a,s){hs.S(t,a,s);var n=el;if(n&&t){var r=vs(n).hoistableStyles,d=tl(t);a=a||"default";var h=r.get(d);if(!h){var b={loading:0,preload:null};if(h=n.querySelector(Ql(d)))b.loading=5;else{t=A({rel:"stylesheet",href:t,"data-precedence":a},s),(s=Aa.get(d))&&Ao(t,s);var R=h=n.createElement("link");_t(R),aa(R,"link",t),R._p=new Promise(function(ie,fe){R.onload=ie,R.onerror=fe}),R.addEventListener("load",function(){b.loading|=1}),R.addEventListener("error",function(){b.loading|=2}),b.loading|=4,ui(h,a,n)}h={type:"stylesheet",instance:h,count:1,state:b},r.set(d,h)}}}function Ig(t,a){hs.X(t,a);var s=el;if(s&&t){var n=vs(s).hoistableScripts,r=al(t),d=n.get(r);d||(d=s.querySelector(Xl(r)),d||(t=A({src:t,async:!0},a),(a=Aa.get(r))&&Ro(t,a),d=s.createElement("script"),_t(d),aa(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(r,d))}}function Kg(t,a){hs.M(t,a);var s=el;if(s&&t){var n=vs(s).hoistableScripts,r=al(t),d=n.get(r);d||(d=s.querySelector(Xl(r)),d||(t=A({src:t,async:!0,type:"module"},a),(a=Aa.get(r))&&Ro(t,a),d=s.createElement("script"),_t(d),aa(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(r,d))}}function Rh(t,a,s,n){var r=(r=Fe.current)?di(r):null;if(!r)throw Error(c(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(a=tl(s.href),s=vs(r).hoistableStyles,n=s.get(a),n||(n={type:"style",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=tl(s.href);var d=vs(r).hoistableStyles,h=d.get(t);if(h||(r=r.ownerDocument||r,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(t,h),(d=r.querySelector(Ql(t)))&&!d._p&&(h.instance=d,h.state.loading=5),Aa.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},Aa.set(t,s),d||Wg(r,t,s,h.state))),a&&n===null)throw Error(c(528,""));return h}if(a&&n!==null)throw Error(c(529,""));return null;case"script":return a=s.async,s=s.src,typeof s=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=al(s),s=vs(r).hoistableScripts,n=s.get(a),n||(n={type:"script",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(c(444,t))}}function tl(t){return'href="'+Sa(t)+'"'}function Ql(t){return'link[rel="stylesheet"]['+t+"]"}function zh(t){return A({},t,{"data-precedence":t.precedence,precedence:null})}function Wg(t,a,s,n){t.querySelector('link[rel="preload"][as="style"]['+a+"]")?n.loading=1:(a=t.createElement("link"),n.preload=a,a.addEventListener("load",function(){return n.loading|=1}),a.addEventListener("error",function(){return n.loading|=2}),aa(a,"link",s),_t(a),t.head.appendChild(a))}function al(t){return'[src="'+Sa(t)+'"]'}function Xl(t){return"script[async]"+t}function qh(t,a,s){if(a.count++,a.instance===null)switch(a.type){case"style":var n=t.querySelector('style[data-href~="'+Sa(s.href)+'"]');if(n)return a.instance=n,_t(n),n;var r=A({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return n=(t.ownerDocument||t).createElement("style"),_t(n),aa(n,"style",r),ui(n,s.precedence,t),a.instance=n;case"stylesheet":r=tl(s.href);var d=t.querySelector(Ql(r));if(d)return a.state.loading|=4,a.instance=d,_t(d),d;n=zh(s),(r=Aa.get(r))&&Ao(n,r),d=(t.ownerDocument||t).createElement("link"),_t(d);var h=d;return h._p=new Promise(function(b,R){h.onload=b,h.onerror=R}),aa(d,"link",n),a.state.loading|=4,ui(d,s.precedence,t),a.instance=d;case"script":return d=al(s.src),(r=t.querySelector(Xl(d)))?(a.instance=r,_t(r),r):(n=s,(r=Aa.get(d))&&(n=A({},s),Ro(n,r)),t=t.ownerDocument||t,r=t.createElement("script"),_t(r),aa(r,"link",n),t.head.appendChild(r),a.instance=r);case"void":return null;default:throw Error(c(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(n=a.instance,a.state.loading|=4,ui(n,s.precedence,t));return a.instance}function ui(t,a,s){for(var n=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=n.length?n[n.length-1]:null,d=r,h=0;h<n.length;h++){var b=n[h];if(b.dataset.precedence===a)d=b;else if(d!==r)break}d?d.parentNode.insertBefore(t,d.nextSibling):(a=s.nodeType===9?s.head:s,a.insertBefore(t,a.firstChild))}function Ao(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.title==null&&(t.title=a.title)}function Ro(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.integrity==null&&(t.integrity=a.integrity)}var mi=null;function Oh(t,a,s){if(mi===null){var n=new Map,r=mi=new Map;r.set(s,n)}else r=mi,n=r.get(s),n||(n=new Map,r.set(s,n));if(n.has(t))return n;for(n.set(t,null),s=s.getElementsByTagName(t),r=0;r<s.length;r++){var d=s[r];if(!(d[Js]||d[Ie]||t==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var h=d.getAttribute(a)||"";h=t+h;var b=n.get(h);b?b.push(d):n.set(h,[d])}}return n}function Uh(t,a,s){t=t.ownerDocument||t,t.head.insertBefore(s,a==="title"?t.querySelector("head > title"):null)}function ex(t,a,s){if(s===1||a.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return t=a.disabled,typeof a.precedence=="string"&&t==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Lh(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function tx(t,a,s,n){if(s.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var r=tl(n.href),d=a.querySelector(Ql(r));if(d){a=d._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(t.count++,t=hi.bind(t),a.then(t,t)),s.state.loading|=4,s.instance=d,_t(d);return}d=a.ownerDocument||a,n=zh(n),(r=Aa.get(r))&&Ao(n,r),d=d.createElement("link"),_t(d);var h=d;h._p=new Promise(function(b,R){h.onload=b,h.onerror=R}),aa(d,"link",n),s.instance=d}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(s,a),(a=s.state.preload)&&(s.state.loading&3)===0&&(t.count++,s=hi.bind(t),a.addEventListener("load",s),a.addEventListener("error",s))}}var zo=0;function ax(t,a){return t.stylesheets&&t.count===0&&pi(t,t.stylesheets),0<t.count||0<t.imgCount?function(s){var n=setTimeout(function(){if(t.stylesheets&&pi(t,t.stylesheets),t.unsuspend){var d=t.unsuspend;t.unsuspend=null,d()}},6e4+a);0<t.imgBytes&&zo===0&&(zo=62500*Og());var r=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&pi(t,t.stylesheets),t.unsuspend)){var d=t.unsuspend;t.unsuspend=null,d()}},(t.imgBytes>zo?50:800)+a);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(n),clearTimeout(r)}}:null}function hi(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)pi(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var fi=null;function pi(t,a){t.stylesheets=null,t.unsuspend!==null&&(t.count++,fi=new Map,a.forEach(sx,t),fi=null,hi.call(t))}function sx(t,a){if(!(a.state.loading&4)){var s=fi.get(t);if(s)var n=s.get(null);else{s=new Map,fi.set(t,s);for(var r=t.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<r.length;d++){var h=r[d];(h.nodeName==="LINK"||h.getAttribute("media")!=="not all")&&(s.set(h.dataset.precedence,h),n=h)}n&&s.set(null,n)}r=a.instance,h=r.getAttribute("data-precedence"),d=s.get(h)||n,d===n&&s.set(null,r),s.set(h,r),this.count++,n=hi.bind(this),r.addEventListener("load",n),r.addEventListener("error",n),d?d.parentNode.insertBefore(r,d.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(r,t.firstChild)),a.state.loading|=4}}var Zl={$$typeof:D,Provider:null,Consumer:null,_currentValue:M,_currentValue2:M,_threadCount:0};function nx(t,a,s,n,r,d,h,b,R){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=lt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lt(0),this.hiddenUpdates=lt(null),this.identifierPrefix=n,this.onUncaughtError=r,this.onCaughtError=d,this.onRecoverableError=h,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=R,this.incompleteTransitions=new Map}function Bh(t,a,s,n,r,d,h,b,R,ie,fe,ve){return t=new nx(t,a,s,h,R,ie,fe,ve,b),a=1,d===!0&&(a|=24),d=ga(3,null,null,a),t.current=d,d.stateNode=t,a=mc(),a.refCount++,t.pooledCache=a,a.refCount++,d.memoizedState={element:n,isDehydrated:s,cache:a},gc(d),t}function Fh(t){return t?(t=Rn,t):Rn}function Hh(t,a,s,n,r,d){r=Fh(r),n.context===null?n.context=r:n.pendingContext=r,n=ws(a),n.payload={element:s},d=d===void 0?null:d,d!==null&&(n.callback=d),s=ks(t,n,a),s!==null&&(ha(s,t,a),wl(s,t,a))}function $h(t,a){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<a?s:a}}function qo(t,a){$h(t,a),(t=t.alternate)&&$h(t,a)}function Vh(t){if(t.tag===13||t.tag===31){var a=tn(t,67108864);a!==null&&ha(a,t,67108864),qo(t,67108864)}}function Gh(t){if(t.tag===13||t.tag===31){var a=ba();a=Ze(a);var s=tn(t,a);s!==null&&ha(s,t,a),qo(t,a)}}var gi=!0;function lx(t,a,s,n){var r=w.T;w.T=null;var d=k.p;try{k.p=2,Oo(t,a,s,n)}finally{k.p=d,w.T=r}}function rx(t,a,s,n){var r=w.T;w.T=null;var d=k.p;try{k.p=8,Oo(t,a,s,n)}finally{k.p=d,w.T=r}}function Oo(t,a,s,n){if(gi){var r=Uo(n);if(r===null)_o(t,a,n,xi,s),Qh(t,n);else if(cx(r,t,a,s,n))n.stopPropagation();else if(Qh(t,n),a&4&&-1<ix.indexOf(t)){for(;r!==null;){var d=Fa(r);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var h=ue(d.pendingLanes);if(h!==0){var b=d;for(b.pendingLanes|=2,b.entangledLanes|=2;h;){var R=1<<31-jt(h);b.entanglements[1]|=R,h&=~R}Ga(d),(gt&6)===0&&(Wr=Se()+500,$l(0))}}break;case 31:case 13:b=tn(d,2),b!==null&&ha(b,d,2),ti(),qo(d,2)}if(d=Uo(n),d===null&&_o(t,a,n,xi,s),d===r)break;r=d}r!==null&&n.stopPropagation()}else _o(t,a,n,null,s)}}function Uo(t){return t=Li(t),Lo(t)}var xi=null;function Lo(t){if(xi=null,t=Pa(t),t!==null){var a=u(t);if(a===null)t=null;else{var s=a.tag;if(s===13){if(t=x(a),t!==null)return t;t=null}else if(s===31){if(t=g(a),t!==null)return t;t=null}else if(s===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;t=null}else a!==t&&(t=null)}}return xi=t,null}function Yh(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ct()){case Pe:return 2;case Ut:return 8;case Rt:case ut:return 32;case Gt:return 268435456;default:return 32}default:return 32}}var Bo=!1,Ls=null,Bs=null,Fs=null,Pl=new Map,Jl=new Map,Hs=[],ix="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Qh(t,a){switch(t){case"focusin":case"focusout":Ls=null;break;case"dragenter":case"dragleave":Bs=null;break;case"mouseover":case"mouseout":Fs=null;break;case"pointerover":case"pointerout":Pl.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jl.delete(a.pointerId)}}function Il(t,a,s,n,r,d){return t===null||t.nativeEvent!==d?(t={blockedOn:a,domEventName:s,eventSystemFlags:n,nativeEvent:d,targetContainers:[r]},a!==null&&(a=Fa(a),a!==null&&Vh(a)),t):(t.eventSystemFlags|=n,a=t.targetContainers,r!==null&&a.indexOf(r)===-1&&a.push(r),t)}function cx(t,a,s,n,r){switch(a){case"focusin":return Ls=Il(Ls,t,a,s,n,r),!0;case"dragenter":return Bs=Il(Bs,t,a,s,n,r),!0;case"mouseover":return Fs=Il(Fs,t,a,s,n,r),!0;case"pointerover":var d=r.pointerId;return Pl.set(d,Il(Pl.get(d)||null,t,a,s,n,r)),!0;case"gotpointercapture":return d=r.pointerId,Jl.set(d,Il(Jl.get(d)||null,t,a,s,n,r)),!0}return!1}function Xh(t){var a=Pa(t.target);if(a!==null){var s=u(a);if(s!==null){if(a=s.tag,a===13){if(a=x(s),a!==null){t.blockedOn=a,Ye(t.priority,function(){Gh(s)});return}}else if(a===31){if(a=g(s),a!==null){t.blockedOn=a,Ye(t.priority,function(){Gh(s)});return}}else if(a===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ji(t){if(t.blockedOn!==null)return!1;for(var a=t.targetContainers;0<a.length;){var s=Uo(t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);Ui=n,s.target.dispatchEvent(n),Ui=null}else return a=Fa(s),a!==null&&Vh(a),t.blockedOn=s,!1;a.shift()}return!0}function Zh(t,a,s){ji(t)&&s.delete(a)}function ox(){Bo=!1,Ls!==null&&ji(Ls)&&(Ls=null),Bs!==null&&ji(Bs)&&(Bs=null),Fs!==null&&ji(Fs)&&(Fs=null),Pl.forEach(Zh),Jl.forEach(Zh)}function vi(t,a){t.blockedOn===a&&(t.blockedOn=null,Bo||(Bo=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,ox)))}var yi=null;function Ph(t){yi!==t&&(yi=t,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){yi===t&&(yi=null);for(var a=0;a<t.length;a+=3){var s=t[a],n=t[a+1],r=t[a+2];if(typeof n!="function"){if(Lo(n||s)===null)continue;break}var d=Fa(s);d!==null&&(t.splice(a,3),a-=3,Oc(d,{pending:!0,data:r,method:s.method,action:n},n,r))}}))}function sl(t){function a(R){return vi(R,t)}Ls!==null&&vi(Ls,t),Bs!==null&&vi(Bs,t),Fs!==null&&vi(Fs,t),Pl.forEach(a),Jl.forEach(a);for(var s=0;s<Hs.length;s++){var n=Hs[s];n.blockedOn===t&&(n.blockedOn=null)}for(;0<Hs.length&&(s=Hs[0],s.blockedOn===null);)Xh(s),s.blockedOn===null&&Hs.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(n=0;n<s.length;n+=3){var r=s[n],d=s[n+1],h=r[Mt]||null;if(typeof d=="function")h||Ph(s);else if(h){var b=null;if(d&&d.hasAttribute("formAction")){if(r=d,h=d[Mt]||null)b=h.formAction;else if(Lo(r)!==null)continue}else b=h.action;typeof b=="function"?s[n+1]=b:(s.splice(n,3),n-=3),Ph(s)}}}function Jh(){function t(d){d.canIntercept&&d.info==="react-transition"&&d.intercept({handler:function(){return new Promise(function(h){return r=h})},focusReset:"manual",scroll:"manual"})}function a(){r!==null&&(r(),r=null),n||setTimeout(s,20)}function s(){if(!n&&!navigation.transition){var d=navigation.currentEntry;d&&d.url!=null&&navigation.navigate(d.url,{state:d.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,r=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(s,100),function(){n=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),r!==null&&(r(),r=null)}}}function Fo(t){this._internalRoot=t}bi.prototype.render=Fo.prototype.render=function(t){var a=this._internalRoot;if(a===null)throw Error(c(409));var s=a.current,n=ba();Hh(s,n,t,a,null,null)},bi.prototype.unmount=Fo.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var a=t.containerInfo;Hh(t.current,2,null,t,null,null),ti(),a[Jt]=null}};function bi(t){this._internalRoot=t}bi.prototype.unstable_scheduleHydration=function(t){if(t){var a=Ue();t={blockedOn:null,target:t,priority:a};for(var s=0;s<Hs.length&&a!==0&&a<Hs[s].priority;s++);Hs.splice(s,0,t),s===0&&Xh(t)}};var Ih=i.version;if(Ih!=="19.2.0")throw Error(c(527,Ih,"19.2.0"));k.findDOMNode=function(t){var a=t._reactInternals;if(a===void 0)throw typeof t.render=="function"?Error(c(188)):(t=Object.keys(t).join(","),Error(c(268,t)));return t=v(a),t=t!==null?y(t):null,t=t===null?null:t.stateNode,t};var dx={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:w,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _i=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_i.isDisabled&&_i.supportsFiber)try{et=_i.inject(dx),tt=_i}catch{}}return Wl.createRoot=function(t,a){if(!m(t))throw Error(c(299));var s=!1,n="",r=nm,d=lm,h=rm;return a!=null&&(a.unstable_strictMode===!0&&(s=!0),a.identifierPrefix!==void 0&&(n=a.identifierPrefix),a.onUncaughtError!==void 0&&(r=a.onUncaughtError),a.onCaughtError!==void 0&&(d=a.onCaughtError),a.onRecoverableError!==void 0&&(h=a.onRecoverableError)),a=Bh(t,1,!1,null,null,s,n,null,r,d,h,Jh),t[Jt]=a.current,bo(t),new Fo(a)},Wl.hydrateRoot=function(t,a,s){if(!m(t))throw Error(c(299));var n=!1,r="",d=nm,h=lm,b=rm,R=null;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(r=s.identifierPrefix),s.onUncaughtError!==void 0&&(d=s.onUncaughtError),s.onCaughtError!==void 0&&(h=s.onCaughtError),s.onRecoverableError!==void 0&&(b=s.onRecoverableError),s.formState!==void 0&&(R=s.formState)),a=Bh(t,1,!0,a,s??null,n,r,R,d,h,b,Jh),a.context=Fh(null),s=a.current,n=ba(),n=Ze(n),r=ws(n),r.callback=null,ks(s,r,n),s=n,a.current.lanes=s,pt(a,s),Ga(a),t[Jt]=a.current,bo(t),new bi(a)},Wl.version="19.2.0",Wl}var sf;function _x(){if(sf)return $o.exports;sf=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(i){console.error(i)}}return l(),$o.exports=bx(),$o.exports}var Nx=_x();const Sx=Af(Nx),Cx="fieldsync-offline",wx=1,$t={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let jn=null;const xs=()=>new Promise((l,i)=>{if(jn){l(jn);return}const o=indexedDB.open(Cx,wx);o.onerror=()=>{console.error("Failed to open offline database"),i(o.error)},o.onsuccess=()=>{jn=o.result,console.log("Offline database initialized"),l(jn)},o.onupgradeneeded=c=>{const m=c.target.result;if(m.objectStoreNames.contains($t.PROJECTS)||m.createObjectStore($t.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),m.objectStoreNames.contains($t.AREAS)||m.createObjectStore($t.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),m.objectStoreNames.contains($t.CREW_CHECKINS)||m.createObjectStore($t.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!m.objectStoreNames.contains($t.PENDING_ACTIONS)){const u=m.createObjectStore($t.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});u.createIndex("type","type",{unique:!1}),u.createIndex("created_at","created_at",{unique:!1})}m.objectStoreNames.contains($t.CACHED_DATA)||m.createObjectStore($t.CACHED_DATA,{keyPath:"key"})}}),vn=(l,i="readonly")=>{if(!jn)throw new Error("Database not initialized");return jn.transaction(l,i).objectStore(l)},kx=async(l,i)=>(await xs(),new Promise((o,c)=>{const u=vn(l,"readwrite").put(i);u.onsuccess=()=>o(u.result),u.onerror=()=>c(u.error)})),Rf=async(l,i)=>(await xs(),new Promise((o,c)=>{const m=jn.transaction(l,"readwrite"),u=m.objectStore(l);i.forEach(x=>u.put(x)),m.oncomplete=()=>o(),m.onerror=()=>c(m.error)})),Ex=async(l,i)=>(await xs(),new Promise((o,c)=>{const u=vn(l).get(i);u.onsuccess=()=>o(u.result),u.onerror=()=>c(u.error)})),zf=async l=>(await xs(),new Promise((i,o)=>{const m=vn(l).getAll();m.onsuccess=()=>i(m.result||[]),m.onerror=()=>o(m.error)})),qf=async(l,i,o)=>(await xs(),new Promise((c,m)=>{const g=vn(l).index(i).getAll(o);g.onsuccess=()=>c(g.result||[]),g.onerror=()=>m(g.error)})),Dx=async(l,i)=>(await xs(),new Promise((o,c)=>{const u=vn(l,"readwrite").delete(i);u.onsuccess=()=>o(),u.onerror=()=>c(u.error)})),Xs={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},nf=async(l,i,o={})=>{await xs();const c={type:l,payload:i,metadata:o,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((m,u)=>{const g=vn($t.PENDING_ACTIONS,"readwrite").add(c);g.onsuccess=()=>{console.log(`Queued offline action: ${l}`),m(g.result)},g.onerror=()=>u(g.error)})},Of=async()=>zf($t.PENDING_ACTIONS),Yo=async()=>(await Of()).length,Mx=async l=>Dx($t.PENDING_ACTIONS,l),Tx=async(l,i)=>(await xs(),new Promise((o,c)=>{const m=vn($t.PENDING_ACTIONS,"readwrite"),u=m.get(l);u.onsuccess=()=>{const x=u.result;if(x){const g={...x,...i},f=m.put(g);f.onsuccess=()=>o(g),f.onerror=()=>c(f.error)}else c(new Error("Action not found"))},u.onerror=()=>c(u.error)})),Ax=async l=>Rf($t.PROJECTS,l),lf=async l=>l?qf($t.PROJECTS,"company_id",l):zf($t.PROJECTS),Rx=async l=>Rf($t.AREAS,l),rf=async l=>qf($t.AREAS,"project_id",l),Qo=async(l,i)=>{const o=await Ex($t.AREAS,l);return o&&(o.status=i,o.updated_at=new Date().toISOString(),await kx($t.AREAS,o)),o};let cd=navigator.onLine;const ld=new Set,Uf=l=>(ld.add(l),()=>ld.delete(l)),ar=()=>cd,cf=l=>{cd=l,ld.forEach(i=>i(l))};typeof window<"u"&&(window.addEventListener("online",()=>{console.log("Connection restored"),cf(!0)}),window.addEventListener("offline",()=>{console.log("Connection lost"),cf(!1)}));let Xo=!1;const zx=async l=>{if(Xo||!cd)return{synced:0,failed:0};Xo=!0;const i={synced:0,failed:0};try{const o=await Of();console.log(`Syncing ${o.length} pending actions...`);for(const c of o)try{await qx(c,l),await Mx(c.id),i.synced++,console.log(`Synced action: ${c.type}`)}catch(m){console.error(`Failed to sync action ${c.type}:`,m),i.failed++,await Tx(c.id,{attempts:(c.attempts||0)+1,last_error:m.message,last_attempt:new Date().toISOString()})}}finally{Xo=!1}return i},qx=async(l,i)=>{const{type:o,payload:c}=l;switch(o){case Xs.UPDATE_AREA_STATUS:return i.updateAreaStatus(c.areaId,c.status);case Xs.CREATE_TM_TICKET:const m=await i.createTMTicket(c.ticket);return c.workers?.length>0&&await i.addTMWorkers(m.id,c.workers),c.items?.length>0&&await i.addTMItems(m.id,c.items),m;case Xs.SAVE_CREW_CHECKIN:return i.saveCrewCheckin(c.projectId,c.workers,c.checkInDate);case Xs.SUBMIT_DAILY_REPORT:return await i.saveDailyReport(c.projectId,c.reportData),i.submitDailyReport(c.projectId,c.submittedBy);case Xs.SEND_MESSAGE:return i.sendMessage(c.projectId,c.senderType,c.senderName,c.content);case Xs.CREATE_MATERIAL_REQUEST:return i.createMaterialRequest(c.projectId,c.items,c.requestedBy,c.neededBy,c.priority,c.notes);default:throw new Error(`Unknown action type: ${o}`)}},Ox="https://cegifnrcwdilromcyouq.supabase.co",Lf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlZ2lmbnJjd2RpbHJvbWN5b3VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTQ5OTAsImV4cCI6MjA4MDIzMDk5MH0.qAiBG5XaB0C1E0U2tQbQkrhpm1iUhM6A2MXngEHhX4A",J=!!Lf;xs().catch(l=>console.error("Failed to init offline DB:",l));const O=J?hx(Ox,Lf):null,Bf="fieldsync_data",rd="fieldsync_user",Be=()=>{const l=localStorage.getItem(Bf);return l?JSON.parse(l):{projects:[],areas:[],users:[],assignments:[]}},dt=l=>{localStorage.setItem(Bf,JSON.stringify(l))},Ni=()=>{const l=localStorage.getItem(rd);return l?JSON.parse(l):null},Si=l=>{l?localStorage.setItem(rd,JSON.stringify(l)):localStorage.removeItem(rd)},Ux={async signUp(l,i,o,c){if(J){const{data:m,error:u}=await O.auth.signUp({email:l,password:i,options:{data:{name:o,role:c}}});if(u)throw u;return m}else{const m=Be(),u={id:crypto.randomUUID(),email:l,name:o,role:c,created_at:new Date().toISOString()};return m.users.push(u),dt(m),Si(u),{user:u}}},async signIn(l,i){if(J){const{data:o,error:c}=await O.auth.signInWithPassword({email:l,password:i});if(c)throw c;return o}else{const c=Be().users.find(m=>m.email===l);if(!c)throw new Error("User not found");return Si(c),{user:c}}},async signOut(){if(J){const{error:l}=await O.auth.signOut();if(l)throw l}else Si(null)},async getUser(){if(J){const{data:{user:l}}=await O.auth.getUser();return l}else return Ni()},async getProfile(){if(J){const{data:{user:l}}=await O.auth.getUser();if(!l)return null;const{data:i,error:o}=await O.from("users").select("*").eq("id",l.id).single();return o?{id:l.id,email:l.email,name:l.user_metadata?.name||"",role:l.user_metadata?.role||"foreman"}:i}else return Ni()},async updateRole(l,i){if(J){const{data:o,error:c}=await O.from("users").update({role:i}).eq("id",l).select().single();if(c)throw c;return o}else{const o=Be(),c=o.users.find(m=>m.id===l);return c&&(c.role=i,dt(o),Ni()?.id===l&&Si(c)),c}},onAuthStateChange(l){if(J)return O.auth.onAuthStateChange(l);{const i=Ni();return l(i?"SIGNED_IN":"SIGNED_OUT",{user:i}),{data:{subscription:{unsubscribe:()=>{}}}}}}},de={async getProjects(l=null,i=!1){if(J){if(!ar()){console.log("Offline: returning cached projects");const u=await lf(l);return i?u:u.filter(x=>x.status!=="archived")}let o=O.from("projects").select("*").order("created_at",{ascending:!1});l&&(o=o.eq("company_id",l)),i||(o=o.eq("status","active"));const{data:c,error:m}=await o;if(m){console.log("Error fetching projects, trying cache:",m.message);const u=await lf(l);if(u.length>0)return u;throw m}return c?.length>0&&Ax(c).catch(u=>console.error("Failed to cache projects:",u)),c}else{const o=Be().projects;return i?o:o.filter(c=>c.status!=="archived")}},async getArchivedProjects(l){if(J){const{data:i,error:o}=await O.from("projects").select("*").eq("company_id",l).eq("status","archived").order("archived_at",{ascending:!1});if(o)throw o;return i}else return Be().projects.filter(i=>i.status==="archived")},async getProjectCount(l){if(J){const{count:i,error:o}=await O.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",l).in("status",["active","archived"]);if(o)throw o;return i||0}else return Be().projects.filter(o=>o.company_id===l&&o.status!=="deleted").length},async archiveProject(l){if(J){const{data:i,error:o}=await O.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",l).select().single();if(o)throw o;return i}else{const i=Be(),o=i.projects.find(c=>c.id===l);return o&&(o.status="archived",o.archived_at=new Date().toISOString(),dt(i)),o}},async restoreProject(l){if(J){const{data:i,error:o}=await O.from("projects").update({status:"active",archived_at:null}).eq("id",l).select().single();if(o)throw o;return i}else{const i=Be(),o=i.projects.find(c=>c.id===l);return o&&(o.status="active",o.archived_at=null,dt(i)),o}},async getProject(l){if(J){const{data:i,error:o}=await O.from("projects").select("*").eq("id",l).single();if(o)throw o;return i}else return Be().projects.find(i=>i.id===l)},async createProject(l){if(J){console.log("Creating project with data:",l);const{data:i,error:o}=await O.from("projects").insert({...l,status:"active"}).select().single();if(o)throw console.error("Supabase createProject error:",o.message,o.details,o.hint),o;return i}else{const i=Be(),o={...l,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return i.projects.push(o),dt(i),o}},async getProjectByPin(l){if(J){const{data:i,error:o}=await O.from("projects").select("*").eq("pin",l).eq("status","active").single();return o?null:i}else return Be().projects.find(o=>o.pin===l&&o.status==="active")||null},async getProjectByPinAndCompany(l,i){if(J){const{data:o,error:c}=await O.from("projects").select("*").eq("pin",l).eq("company_id",i).eq("status","active").single();return c?null:o}else return Be().projects.find(c=>c.pin===l&&c.company_id===i&&c.status==="active")||null},async isPinAvailable(l,i=null){if(J){let o=O.from("projects").select("id").eq("pin",l);i&&(o=o.neq("id",i));const{data:c,error:m}=await o;if(m)throw m;return c.length===0}else return!Be().projects.some(c=>c.pin===l&&c.id!==i)},async updateProjectPin(l,i){if(J){const{data:o,error:c}=await O.from("projects").update({pin:i}).eq("id",l).select().single();if(c)throw c;return o}else{const o=Be(),c=o.projects.find(m=>m.id===l);return c&&(c.pin=i,dt(o)),c}},async updateProject(l,i){if(J){const{data:o,error:c}=await O.from("projects").update(i).eq("id",l).select().single();if(c)throw console.error("Error updating project:",c),c;return o}else{const o=Be(),c=o.projects.find(m=>m.id===l);return c&&(Object.assign(c,i),dt(o)),c}},async deleteProject(l){if(J){const{error:i}=await O.from("projects").delete().eq("id",l);if(i)throw i}else{const i=Be();i.projects=i.projects.filter(o=>o.id!==l),i.areas=i.areas.filter(o=>o.project_id!==l),dt(i)}},async getAreas(l){if(J){if(!ar())return console.log("Offline: returning cached areas"),rf(l);const{data:i,error:o}=await O.from("areas").select("*").eq("project_id",l).order("sort_order",{ascending:!0});if(o){console.log("Error fetching areas, trying cache:",o.message);const c=await rf(l);if(c.length>0)return c;throw o}return i?.length>0&&Rx(i).catch(c=>console.error("Failed to cache areas:",c)),i}else return Be().areas.filter(i=>i.project_id===l)},async createArea(l){if(J){const{data:i,error:o}=await O.from("areas").insert(l).select().single();if(o)throw o;return i}else{const i=Be(),o={...l,id:crypto.randomUUID(),created_at:new Date().toISOString()};return i.areas.push(o),dt(i),o}},async updateAreaStatus(l,i){if(J){if(!ar()){console.log("Offline: queuing area status update");const m=await Qo(l,i);return await nf(Xs.UPDATE_AREA_STATUS,{areaId:l,status:i}),m}const{data:o,error:c}=await O.from("areas").update({status:i}).eq("id",l).select().single();if(c){if(c.message?.includes("fetch")||c.message?.includes("network")){console.log("Network error: queuing area status update");const m=await Qo(l,i);return await nf(Xs.UPDATE_AREA_STATUS,{areaId:l,status:i}),m}throw c}return o&&Qo(l,i).catch(m=>console.error("Failed to update cached area:",m)),o}else{const o=Be(),c=o.areas.find(m=>m.id===l);return c&&(c.status=i,c.updated_at=new Date().toISOString()),dt(o),c}},async updateArea(l,i){if(J){const{data:o,error:c}=await O.from("areas").update(i).eq("id",l).select().single();if(c)throw c;return o}else{const o=Be(),c=o.areas.find(m=>m.id===l);return c&&(Object.assign(c,i),c.updated_at=new Date().toISOString()),dt(o),c}},async deleteArea(l){if(J){const{error:i}=await O.from("areas").delete().eq("id",l);if(i)throw i}else{const i=Be();i.areas=i.areas.filter(o=>o.id!==l),dt(i)}},subscribeToAreas(l,i){return J?O.channel(`areas:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${l}`},i).subscribe():null},subscribeToMessages(l,i){return J?O.channel(`messages:${l}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${l}`},i).subscribe():null},subscribeToMaterialRequests(l,i){return J?O.channel(`material_requests:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${l}`},i).subscribe():null},subscribeToDailyReports(l,i){return J?O.channel(`daily_reports:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${l}`},i).subscribe():null},subscribeToCrewCheckins(l,i){return J?O.channel(`crew_checkins:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${l}`},i).subscribe():null},subscribeToInjuryReports(l,i){return J?O.channel(`injury_reports:${l}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${l}`},i).subscribe():null},subscribeToTMTickets(l,i){return J?O.channel(`tm_tickets:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${l}`},i).subscribe():null},subscribeToCompanyActivity(l,i,o){if(!J||!i||i.length===0)return null;const c=O.channel(`company_activity:${l}`);return i.forEach(m=>{c.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${m}`},u=>o.onMessage?.(u)),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"material_requests",filter:`project_id=eq.${m}`},u=>o.onMaterialRequest?.(u)),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${m}`},u=>o.onTMTicket?.(u))}),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${l}`},m=>o.onInjuryReport?.(m)),c.subscribe()},unsubscribe(l){l&&J&&O.removeChannel(l)},async getAssignedProjects(l){if(J){const{data:i,error:o}=await O.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",l);if(o)throw o;return i.map(c=>c.projects)}else{const i=Be();return(i.assignments?.filter(c=>c.user_id===l)||[]).map(c=>i.projects.find(m=>m.id===c.project_id)).filter(Boolean)}},async assignUserToProject(l,i,o){if(J){const{data:c,error:m}=await O.from("project_assignments").insert({project_id:l,user_id:i,assigned_by:o}).select().single();if(m)throw m;return c}else{const c=Be();c.assignments||(c.assignments=[]);const m={id:crypto.randomUUID(),project_id:l,user_id:i,assigned_by:o,assigned_at:new Date().toISOString()};return c.assignments.push(m),dt(c),m}},async removeUserFromProject(l,i){if(J){const{error:o}=await O.from("project_assignments").delete().eq("project_id",l).eq("user_id",i);if(o)throw o}else{const o=Be();o.assignments=o.assignments?.filter(c=>!(c.project_id===l&&c.user_id===i))||[],dt(o)}},async getProjectAssignments(l){if(J){const{data:i,error:o}=await O.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",l);if(o)throw o;return i.map(c=>c.users)}else{const i=Be();return(i.assignments?.filter(c=>c.project_id===l)||[]).map(c=>i.users.find(m=>m.id===c.user_id)).filter(Boolean)}},async getAllUsers(){if(J){const{data:l,error:i}=await O.from("users").select("*").order("name");if(i)throw i;return l}else return Be().users||[]},async getForemen(){if(J){const{data:l,error:i}=await O.from("users").select("*").eq("role","foreman").order("name");if(i)throw i;return l}else return(Be().users||[]).filter(l=>l.role==="foreman")},async logActivity(l,i,o,c,m,u){if(J){const{error:x}=await O.from("activity_log").insert({user_id:l,project_id:i,area_id:o,action:c,old_value:m,new_value:u});x&&console.error("Error logging activity:",x)}},async getProjectActivity(l,i=50){if(J){const{data:o,error:c}=await O.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",l).order("created_at",{ascending:!1}).limit(i);if(c)throw c;return o}return[]},async getMaterialsEquipment(l){if(J){const{data:i,error:o}=await O.from("materials_equipment").select("*").eq("company_id",l).eq("active",!0).order("category").order("name");if(o)throw o;return i}return[]},async getMaterialsEquipmentByCategory(l,i){if(J){const{data:o,error:c}=await O.from("materials_equipment").select("*").eq("company_id",l).eq("category",i).eq("active",!0).order("name");if(c)throw c;return o}return[]},async getAllMaterialsEquipment(l){if(J){const{data:i,error:o}=await O.from("materials_equipment").select("*").eq("company_id",l).order("category").order("name");if(o)throw o;return i}return[]},async createMaterialEquipment(l){if(J){const{data:i,error:o}=await O.from("materials_equipment").insert(l).select().single();if(o)throw o;return i}return null},async updateMaterialEquipment(l,i){if(J){const{data:o,error:c}=await O.from("materials_equipment").update(i).eq("id",l).select().single();if(c)throw c;return o}return null},async deleteMaterialEquipment(l){if(J){const{error:i}=await O.from("materials_equipment").update({active:!1}).eq("id",l);if(i)throw i}},async getTMTickets(l){if(J){const{data:i,error:o}=await O.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",l).order("created_at",{ascending:!1});if(o)throw o;return i}return[]},async getChangeOrderTotals(l){if(J){const{data:i,error:o}=await O.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",l).not("ce_pco_number","is",null).neq("ce_pco_number","");if(o)throw o;const c={};let m=0,u=0;return i?.forEach(x=>{const g=x.ce_pco_number;if(c[g]||(c[g]={approved:0,pending:0,count:0}),c[g].count++,x.status==="approved"||x.status==="billed"){const f=parseFloat(x.change_order_value)||0;c[g].approved+=f,m+=f}else x.status==="pending"&&u++}),{changeOrders:c,totalApprovedValue:m,pendingCount:u}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(l,i){if(J){const{data:o,error:c}=await O.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",l).eq("status",i).order("created_at",{ascending:!1});if(c)throw c;return o}return[]},async getCORTickets(l){if(J){const{data:i,error:o}=await O.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",l).order("work_date",{ascending:!0});if(o)throw o;return i||[]}return[]},async createTMTicket(l){if(J){const{data:i,error:o}=await O.from("t_and_m_tickets").insert({project_id:l.project_id,work_date:l.work_date,ce_pco_number:l.ce_pco_number||null,assigned_cor_id:l.assigned_cor_id||null,notes:l.notes,photos:l.photos||[],status:"pending",created_by_name:l.created_by_name||"Field User"}).select().single();if(o)throw o;return i}return null},async addTMWorkers(l,i){if(J){const o=i.map(m=>({ticket_id:l,name:m.name,hours:m.hours,overtime_hours:m.overtime_hours||0,time_started:m.time_started||null,time_ended:m.time_ended||null,role:m.role||"Laborer"})),{error:c}=await O.from("t_and_m_workers").insert(o);if(c)throw c}},async addTMItems(l,i){if(J){const o=i.map(m=>({ticket_id:l,material_equipment_id:m.material_equipment_id||null,custom_name:m.custom_name||null,custom_category:m.custom_category||null,quantity:m.quantity})),{error:c}=await O.from("t_and_m_items").insert(o);if(c)throw c}},async updateTMTicketStatus(l,i){if(J){const{data:o,error:c}=await O.from("t_and_m_tickets").update({status:i}).eq("id",l).select().single();if(c)throw c;return o}return null},async approveTMTicket(l,i,o,c=null){if(J){const m={status:"approved",approved_by_user_id:i,approved_by_name:o,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};c!==null&&(m.change_order_value=parseFloat(c)||0);const{data:u,error:x}=await O.from("t_and_m_tickets").update(m).eq("id",l).select().single();if(x)throw x;return u}return null},async rejectTMTicket(l,i,o,c=""){if(J){const{data:m,error:u}=await O.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:i,rejected_by_name:o,rejected_at:new Date().toISOString(),rejection_reason:c,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",l).select().single();if(u)throw u;return m}return null},canApproveTickets(l){return["owner","admin","manager"].includes(l)},async updateTMTicketPhotos(l,i){if(J){const{data:o,error:c}=await O.from("t_and_m_tickets").update({photos:i}).eq("id",l).select().single();if(c)throw c;return o}return null},async deleteTMTicket(l){if(J){const{error:i}=await O.from("t_and_m_tickets").delete().eq("id",l);if(i)throw i}},async isTicketEditable(l){if(!l?.assigned_cor_id)return{editable:!0};if(J)try{const{data:i,error:o}=await O.from("change_orders").select("id, status, cor_number").eq("id",l.assigned_cor_id).single();if(o||!i)return{editable:!0};const m=["draft","pending_approval"].includes(i.status);return{editable:m,lockedBy:m?null:i,reason:m?null:`This ticket is linked to ${i.cor_number} which has been ${i.status==="approved"?"approved":i.status}`}}catch(i){return console.error("Error checking ticket editability:",i),{editable:!0}}return{editable:!0}},async getCompanyByCode(l){if(J){const{data:i,error:o}=await O.from("companies").select("*").eq("code",l).single();return o?null:i}return null},async getCompany(l){if(J){const{data:i,error:o}=await O.from("companies").select("*").eq("id",l).single();if(o)throw o;return i}return null},async getUserCompanies(l){if(J){const{data:i,error:o}=await O.from("user_companies").select(`
          id,
          role,
          company_id,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",l).order("created_at",{ascending:!0});return o?(console.error("Error fetching user companies:",o),[]):i.map(c=>({id:c.companies.id,name:c.companies.name,code:c.companies.code,role:c.role}))}return[]},async uploadPhoto(l,i,o,c){if(!J)return null;const m=Date.now(),u=Math.random().toString(36).substring(7),x=c.name?.split(".").pop()||"jpg",g=`${m}-${u}.${x}`,f=`${l}/${i}/${o}/${g}`,{data:v,error:y}=await O.storage.from("tm-photos").upload(f,c,{cacheControl:"3600",upsert:!1});if(y)throw y;const{data:A}=O.storage.from("tm-photos").getPublicUrl(f);return A.publicUrl},async uploadPhotoBase64(l,i,o,c,m="photo.jpg"){if(!J)return null;const x=await(await fetch(c)).blob(),g=Date.now(),f=Math.random().toString(36).substring(7),v=m.split(".").pop()||"jpg",y=`${g}-${f}.${v}`,A=`${l}/${i}/${o}/${y}`,{data:Y,error:B}=await O.storage.from("tm-photos").upload(A,x,{cacheControl:"3600",upsert:!1,contentType:x.type});if(B)throw B;const{data:H}=O.storage.from("tm-photos").getPublicUrl(A);return H.publicUrl},async deletePhoto(l){if(!J)return;const o=new URL(l).pathname.match(/\/tm-photos\/(.+)$/);if(!o)return;const c=o[1],{error:m}=await O.storage.from("tm-photos").remove([c]);if(m)throw m},async getCrewCheckin(l,i=null){if(!J)return null;const o=i||new Date().toISOString().split("T")[0],{data:c,error:m}=await O.from("crew_checkins").select("*").eq("project_id",l).eq("check_in_date",o).single();return m&&m.code!=="PGRST116"&&console.error("Error fetching crew checkin:",m),c},async saveCrewCheckin(l,i,o=null,c=null){if(!J)return null;const m=c||new Date().toISOString().split("T")[0],{data:u,error:x}=await O.from("crew_checkins").upsert({project_id:l,check_in_date:m,workers:i,created_by:o,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(x)throw console.error("Error saving crew checkin:",x),x;return u},async addCrewMember(l,i,o=null){if(!J)return null;const c=await this.getCrewCheckin(l),m=c?.workers||[];return m.find(u=>u.name.toLowerCase()===i.name.toLowerCase())?c:(m.push(i),await this.saveCrewCheckin(l,m,o))},async removeCrewMember(l,i){if(!J)return null;const o=await this.getCrewCheckin(l);if(!o)return null;const c=o.workers.filter(m=>m.name.toLowerCase()!==i.toLowerCase());return await this.saveCrewCheckin(l,c,o.created_by)},async getCrewCheckinHistory(l,i=30){if(!J)return[];const{data:o,error:c}=await O.from("crew_checkins").select("*").eq("project_id",l).order("check_in_date",{ascending:!1}).limit(i);return c?(console.error("Error fetching crew history:",c),[]):o||[]},async getLaborRates(l,i=null,o=null){if(!J)return[];let c=O.from("labor_rates").select("*").eq("company_id",l);i&&(c=c.eq("work_type",i)),o&&(c=c.eq("job_type",o));const{data:m,error:u}=await c;return u?(console.error("Error fetching labor rates:",u),[]):m||[]},async calculateManDayCosts(l,i,o,c){if(!J)return{totalCost:0,totalManDays:0,breakdown:[]};const m=await this.getCrewCheckinHistory(l,365),u=await this.getLaborRates(i,o,c),x={};u.forEach(A=>{x[A.role.toLowerCase()]=parseFloat(A.regular_rate)||0});let g=0,f=0;const v={},y=[];return m.forEach(A=>{const Y=A.workers||[];let B=0;const H={};Y.forEach(U=>{const z=(U.role||"laborer").toLowerCase(),K=x[z]||0;H[z]||(H[z]={count:0,cost:0}),H[z].count++,H[z].cost+=K,B+=K,v[z]||(v[z]={count:0,cost:0,rate:K}),v[z].count++,v[z].cost+=K}),g+=B,f+=Y.length,y.push({date:A.check_in_date,workers:Y.length,cost:B,breakdown:H})}),{totalCost:g,totalManDays:f,byRole:v,byDate:y,daysWorked:m.length}},async getDailyReport(l,i=null){if(!J)return null;const o=i||new Date().toISOString().split("T")[0],{data:c,error:m}=await O.from("daily_reports").select("*").eq("project_id",l).eq("report_date",o).single();return m&&m.code!=="PGRST116"&&console.error("Error fetching daily report:",m),c},async compileDailyReport(l,i=null){if(!J)return null;const o=i||new Date().toISOString().split("T")[0],c=await this.getCrewCheckin(l,o),{data:m}=await O.from("areas").select("*").eq("project_id",l),u=m?.filter(f=>f.status==="done"&&f.completed_at?.startsWith(o))||[],{data:x}=await O.from("t_and_m_tickets").select("*").eq("project_id",l).eq("work_date",o),g=x?.reduce((f,v)=>f+(v.photos?.length||0),0)||0;return{crew_count:c?.workers?.length||0,crew_list:c?.workers||[],tasks_completed:u.length,tasks_total:m?.length||0,completed_tasks:u.map(f=>({name:f.name,group:f.group_name})),tm_tickets_count:x?.length||0,photos_count:g}},async saveDailyReport(l,i,o=null){if(!J)return null;const c=o||new Date().toISOString().split("T")[0],{data:m,error:u}=await O.from("daily_reports").upsert({project_id:l,report_date:c,...i,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(u)throw console.error("Error saving daily report:",u),u;return m},async submitDailyReport(l,i,o=null){if(!J)return null;const c=o||new Date().toISOString().split("T")[0],m=await this.compileDailyReport(l,c),{data:u,error:x}=await O.from("daily_reports").upsert({project_id:l,report_date:c,...m,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:i,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(x)throw console.error("Error submitting daily report:",x),x;return u},async getDailyReports(l,i=30){if(!J)return[];const{data:o,error:c}=await O.from("daily_reports").select("*").eq("project_id",l).order("report_date",{ascending:!1}).limit(i);return c?(console.error("Error fetching daily reports:",c),[]):o||[]},async sendMessage(l,i,o,c,m=null,u=null,x="general",g=null){if(!J)return null;const{data:f,error:v}=await O.from("messages").insert({project_id:l,sender_type:o,sender_name:c,sender_user_id:m,message:i,photo_url:u,message_type:x,parent_message_id:g}).select().single();if(v)throw console.error("Error sending message:",v),v;return f},async getMessages(l,i=50){if(!J)return[];const{data:o,error:c}=await O.from("messages").select("*").eq("project_id",l).order("created_at",{ascending:!1}).limit(i);return c?(console.error("Error fetching messages:",c),[]):o||[]},async getUnreadCount(l,i){if(!J)return 0;const o=i==="field"?"office":"field",{count:c,error:m}=await O.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",l).eq("sender_type",o).eq("is_read",!1);return m?(console.error("Error getting unread count:",m),0):c||0},async markMessagesRead(l,i){if(!J)return;const o=i==="field"?"office":"field",{error:c}=await O.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",l).eq("sender_type",o).eq("is_read",!1);c&&console.error("Error marking messages read:",c)},async createMaterialRequest(l,i,o,c=null,m="normal",u=null){if(!J)return null;const{data:x,error:g}=await O.from("material_requests").insert({project_id:l,items:i,requested_by:o,needed_by:c,priority:m,notes:u}).select().single();if(g)throw console.error("Error creating material request:",g),g;return x},async getMaterialRequests(l,i=null){if(!J)return[];let o=O.from("material_requests").select("*").eq("project_id",l).order("created_at",{ascending:!1});i&&(o=o.eq("status",i));const{data:c,error:m}=await o;return m?(console.error("Error fetching material requests:",m),[]):c||[]},async getPendingRequestsCount(l){if(!J)return 0;const{count:i,error:o}=await O.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",l).eq("status","pending");return o?0:i||0},async updateMaterialRequest(l,i,o,c=null,m=null){if(!J)return null;const u={status:i,responded_by:o,responded_at:new Date().toISOString(),response_notes:c,updated_at:new Date().toISOString()};m&&(u.expected_delivery=m),i==="delivered"&&(u.delivered_at=new Date().toISOString());const{data:x,error:g}=await O.from("material_requests").update(u).eq("id",l).select().single();if(g)throw console.error("Error updating material request:",g),g;return x},generateShareToken(){const l="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let i="";for(let o=0;o<12;o++)i+=l.charAt(Math.floor(Math.random()*l.length));return i},async createProjectShare(l,i,o,c=null){if(!J){const f=Be();f.projectShares||(f.projectShares=[]);const v={id:crypto.randomUUID(),project_id:l,share_token:this.generateShareToken(),created_by:i,expires_at:c,is_active:!0,permissions:o,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return f.projectShares.push(v),dt(f),v}const{data:m,error:u}=await O.rpc("generate_share_token");if(u)throw console.error("Error generating share token:",u),u;const{data:x,error:g}=await O.from("project_shares").insert({project_id:l,share_token:m,created_by:i,expires_at:c,permissions:o}).select().single();if(g)throw console.error("Error creating project share:",g),g;return x},async getShareByToken(l){if(!J){const c=Be();if(!c.projectShares)return null;const m=c.projectShares.find(u=>u.share_token===l&&u.is_active&&(!u.expires_at||new Date(u.expires_at)>new Date));return m&&(m.view_count++,m.last_viewed_at=new Date().toISOString(),dt(c)),m}const{data:i,error:o}=await O.from("project_shares").select("*, projects(*)").eq("share_token",l).eq("is_active",!0).single();return o?(console.error("Error fetching share by token:",o),null):i.expires_at&&new Date(i.expires_at)<new Date?null:(await O.rpc("increment_share_view_count",{token:l}),i)},async getProjectShares(l){if(!J){const c=Be();return c.projectShares?c.projectShares.filter(m=>m.project_id===l):[]}const{data:i,error:o}=await O.from("project_shares").select("*, users(name, email)").eq("project_id",l).order("created_at",{ascending:!1});return o?(console.error("Error fetching project shares:",o),[]):i||[]},async updateProjectShare(l,i){if(!J){const m=Be();if(!m.projectShares)return null;const u=m.projectShares.findIndex(x=>x.id===l);return u===-1?null:(m.projectShares[u]={...m.projectShares[u],...i,updated_at:new Date().toISOString()},dt(m),m.projectShares[u])}const{data:o,error:c}=await O.from("project_shares").update(i).eq("id",l).select().single();if(c)throw console.error("Error updating project share:",c),c;return o},async revokeProjectShare(l){return this.updateProjectShare(l,{is_active:!1})},async deleteProjectShare(l){if(!J){const o=Be();if(!o.projectShares)return;o.projectShares=o.projectShares.filter(c=>c.id!==l),dt(o);return}const{error:i}=await O.from("project_shares").delete().eq("id",l);if(i)throw console.error("Error deleting project share:",i),i},async getPublicProjectData(l){const i=await this.getShareByToken(l);if(!i)return null;const o=i.project_id||i.projects?.id;if(!J){const u=Be(),x=u.projects.find(A=>A.id===o);if(!x)return null;const g=u.areas.filter(A=>A.project_id===o),f=g.reduce((A,Y)=>A+parseFloat(Y.weight||0),0),v=g.filter(A=>A.status==="done").reduce((A,Y)=>A+parseFloat(Y.weight||0),0),y=f>0?Math.round(v/f*100):0;return{share:i,project:x,progress:y,areas:i.permissions.progress?g:[],photos:[],dailyReports:[],tmTickets:[]}}const c=i.projects||await this.getProject(o);if(!c)return null;const m={share:i,project:c,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(i.permissions.progress){m.areas=await this.getAreas(o);const u=m.areas.reduce((g,f)=>g+parseFloat(f.weight||0),0),x=m.areas.filter(g=>g.status==="done").reduce((g,f)=>g+parseFloat(f.weight||0),0);m.progress=u>0?Math.round(x/u*100):0}if(i.permissions.photos){const{data:u}=await O.from("t_and_m_tickets").select("photos, work_date").eq("project_id",o).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);m.photos=u?.flatMap(x=>(x.photos||[]).map(g=>({url:g,date:x.work_date})))||[]}if(i.permissions.daily_reports){const{data:u}=await O.from("daily_reports").select("*").eq("project_id",o).order("report_date",{ascending:!1}).limit(10);m.dailyReports=u||[]}return i.permissions.tm_tickets&&(m.tmTickets=await this.getTMTickets(o)),m},async createInjuryReport(l){if(!J){const c=Be();c.injuryReports||(c.injuryReports=[]);const m={id:crypto.randomUUID(),...l,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return c.injuryReports.push(m),dt(c),m}const{data:i,error:o}=await O.from("injury_reports").insert(l).select().single();if(o)throw console.error("Error creating injury report:",o),o;return i},async getInjuryReports(l){if(!J){const c=Be();return c.injuryReports?c.injuryReports.filter(m=>m.project_id===l).sort((m,u)=>new Date(u.incident_date)-new Date(m.incident_date)):[]}const{data:i,error:o}=await O.from("injury_reports").select("*").eq("project_id",l).order("incident_date",{ascending:!1});return o?(console.error("Error fetching injury reports:",o),[]):i||[]},async getCompanyInjuryReports(l,i=null){if(!J){const u=Be();if(!u.injuryReports)return[];let x=u.injuryReports.filter(g=>g.company_id===l);return i&&(x=x.filter(g=>g.status===i)),x.sort((g,f)=>new Date(f.incident_date)-new Date(g.incident_date))}let o=O.from("injury_reports").select("*, projects(name)").eq("company_id",l).order("incident_date",{ascending:!1});i&&(o=o.eq("status",i));const{data:c,error:m}=await o;return m?(console.error("Error fetching company injury reports:",m),[]):c||[]},async getInjuryReport(l){if(!J){const c=Be();return c.injuryReports?c.injuryReports.find(m=>m.id===l):null}const{data:i,error:o}=await O.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",l).single();return o?(console.error("Error fetching injury report:",o),null):i},async updateInjuryReport(l,i){if(!J){const m=Be();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(x=>x.id===l);return u===-1?null:(m.injuryReports[u]={...m.injuryReports[u],...i,updated_at:new Date().toISOString()},dt(m),m.injuryReports[u])}const{data:o,error:c}=await O.from("injury_reports").update(i).eq("id",l).select().single();if(c)throw console.error("Error updating injury report:",c),c;return o},async closeInjuryReport(l,i){return this.updateInjuryReport(l,{status:"closed",closed_at:new Date().toISOString(),closed_by:i})},async deleteInjuryReport(l){if(!J){const o=Be();if(!o.injuryReports)return;o.injuryReports=o.injuryReports.filter(c=>c.id!==l),dt(o);return}const{error:i}=await O.from("injury_reports").delete().eq("id",l);if(i)throw console.error("Error deleting injury report:",i),i},async getInjuryStatistics(l,i=null,o=null){if(!J){const u=Be();if(!u.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let x=u.injuryReports.filter(g=>g.company_id===l);return i&&(x=x.filter(g=>new Date(g.incident_date)>=new Date(i))),o&&(x=x.filter(g=>new Date(g.incident_date)<=new Date(o))),{total_incidents:x.length,minor_injuries:x.filter(g=>g.injury_type==="minor").length,serious_injuries:x.filter(g=>g.injury_type==="serious").length,critical_injuries:x.filter(g=>g.injury_type==="critical").length,near_misses:x.filter(g=>g.injury_type==="near_miss").length,osha_recordable:x.filter(g=>g.osha_recordable).length,total_days_away:x.reduce((g,f)=>g+(f.days_away_from_work||0),0),total_restricted_days:x.reduce((g,f)=>g+(f.restricted_work_days||0),0)}}const{data:c,error:m}=await O.rpc("get_injury_statistics",{comp_id:l,start_date:i,end_date:o});return m?(console.error("Error fetching injury statistics:",m),null):c[0]||null},async addWitness(l,i){if(!J){const m=Be();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(f=>f.id===l);if(u===-1)return null;const x=m.injuryReports[u],g=x.witnesses||[];return g.push(i),m.injuryReports[u]={...x,witnesses:g,updated_at:new Date().toISOString()},dt(m),m.injuryReports[u]}const o=await this.getInjuryReport(l);if(!o)return null;const c=o.witnesses||[];return c.push(i),this.updateInjuryReport(l,{witnesses:c})},async removeWitness(l,i){if(!J){const m=Be();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(f=>f.id===l);if(u===-1)return null;const x=m.injuryReports[u],g=x.witnesses||[];return g.splice(i,1),m.injuryReports[u]={...x,witnesses:g,updated_at:new Date().toISOString()},dt(m),m.injuryReports[u]}const o=await this.getInjuryReport(l);if(!o)return null;const c=o.witnesses||[];return c.splice(i,1),this.updateInjuryReport(l,{witnesses:c})},async getCompanyUsers(l){if(J){const{data:i,error:o}=await O.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",l);return o?(console.error("Error fetching company users:",o),[]):i?.map(c=>({id:c.user_id,name:c.users?.name||c.users?.email,email:c.users?.email,role:c.role}))||[]}return[]},async getProjectNotificationPreferences(l){if(J){const{data:o,error:c}=await O.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",l);return c?(console.error("Error fetching notification preferences:",c),[]):o||[]}const i=Be();return i.notificationPreferences?i.notificationPreferences.filter(o=>o.project_id===l):[]},async getUserNotificationPreferences(l){if(J){const{data:o,error:c}=await O.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",l);return c?(console.error("Error fetching user notification preferences:",c),[]):o||[]}const i=Be();return i.notificationPreferences?i.notificationPreferences.filter(o=>o.user_id===l):[]},async setNotificationPreference(l,i,o){if(J){const{data:x,error:g}=await O.from("notification_preferences").upsert({project_id:l,user_id:i,notification_types:o,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(g)throw console.error("Error setting notification preference:",g),g;return x}const c=Be();c.notificationPreferences||(c.notificationPreferences=[]);const m=c.notificationPreferences.findIndex(x=>x.project_id===l&&x.user_id===i),u={id:m>=0?c.notificationPreferences[m].id:crypto.randomUUID(),project_id:l,user_id:i,notification_types:o,created_at:m>=0?c.notificationPreferences[m].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return m>=0?c.notificationPreferences[m]=u:c.notificationPreferences.push(u),dt(c),u},async removeNotificationPreference(l,i){if(J){const{error:c}=await O.from("notification_preferences").delete().eq("project_id",l).eq("user_id",i);if(c)throw console.error("Error removing notification preference:",c),c;return!0}const o=Be();return o.notificationPreferences&&(o.notificationPreferences=o.notificationPreferences.filter(c=>!(c.project_id===l&&c.user_id===i)),dt(o)),!0},async setProjectNotificationPreferences(l,i){const o=[];for(const c of i)if(c.notificationTypes&&c.notificationTypes.length>0){const m=await this.setNotificationPreference(l,c.userId,c.notificationTypes);o.push(m)}else await this.removeNotificationPreference(l,c.userId);return o},async getNotificationPresets(l){if(J){const{data:o,error:c}=await O.from("notification_presets").select("*").eq("company_id",l).order("name");return c?(console.error("Error fetching notification presets:",c),[]):o||[]}const i=Be();return i.notificationPresets?i.notificationPresets.filter(o=>o.company_id===l):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:l},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:l},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:l},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:l}]},async createNotificationPreset(l,i,o){if(J){const{data:u,error:x}=await O.from("notification_presets").insert({company_id:l,name:i,notification_types:o}).select().single();if(x)throw console.error("Error creating notification preset:",x),x;return u}const c=Be();c.notificationPresets||(c.notificationPresets=[]);const m={id:crypto.randomUUID(),company_id:l,name:i,notification_types:o,created_at:new Date().toISOString()};return c.notificationPresets.push(m),dt(c),m},async updateNotificationPreset(l,i,o){if(J){const{data:u,error:x}=await O.from("notification_presets").update({name:i,notification_types:o,updated_at:new Date().toISOString()}).eq("id",l).select().single();if(x)throw console.error("Error updating notification preset:",x),x;return u}const c=Be();if(!c.notificationPresets)return null;const m=c.notificationPresets.findIndex(u=>u.id===l);return m===-1?null:(c.notificationPresets[m]={...c.notificationPresets[m],name:i,notification_types:o,updated_at:new Date().toISOString()},dt(c),c.notificationPresets[m])},async deleteNotificationPreset(l){if(J){const{error:o}=await O.from("notification_presets").delete().eq("id",l);if(o)throw console.error("Error deleting notification preset:",o),o;return!0}const i=Be();return i.notificationPresets&&(i.notificationPresets=i.notificationPresets.filter(o=>o.id!==l),dt(i)),!0},async getDumpSites(l){if(J){const{data:o,error:c}=await O.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",l).eq("active",!0).order("name");return c?(console.error("Error fetching dump sites:",c),[]):o||[]}return(Be().dumpSites||[]).filter(o=>o.company_id===l&&o.active)},async createDumpSite(l,i,o="",c=""){if(J){const{data:x,error:g}=await O.from("dump_sites").insert({company_id:l,name:i,address:o,notes:c,active:!0}).select().single();if(g)throw console.error("Error creating dump site:",g),g;return x}const m=Be();m.dumpSites||(m.dumpSites=[]);const u={id:crypto.randomUUID(),company_id:l,name:i,address:o,notes:c,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return m.dumpSites.push(u),dt(m),u},async updateDumpSite(l,i){if(J){const{data:m,error:u}=await O.from("dump_sites").update({...i,updated_at:new Date().toISOString()}).eq("id",l).select().single();if(u)throw console.error("Error updating dump site:",u),u;return m}const o=Be();if(!o.dumpSites)return null;const c=o.dumpSites.findIndex(m=>m.id===l);return c===-1?null:(o.dumpSites[c]={...o.dumpSites[c],...i},dt(o),o.dumpSites[c])},async deleteDumpSite(l){return this.updateDumpSite(l,{active:!1})},async setDumpSiteRate(l,i,o,c="load"){if(J){const{data:g}=await O.from("dump_site_rates").select("id").eq("dump_site_id",l).eq("waste_type",i).maybeSingle();if(g){const{data:f,error:v}=await O.from("dump_site_rates").update({estimated_cost_per_load:o,unit:c}).eq("id",g.id).select().single();if(v)throw console.error("Error updating dump site rate:",v),v;return f}else{const{data:f,error:v}=await O.from("dump_site_rates").insert({dump_site_id:l,waste_type:i,estimated_cost_per_load:o,unit:c}).select().single();if(v)throw console.error("Error inserting dump site rate:",v),v;return f}}const m=Be();m.dumpSiteRates||(m.dumpSiteRates=[]);const u=m.dumpSiteRates.findIndex(g=>g.dump_site_id===l&&g.waste_type===i),x={id:u>=0?m.dumpSiteRates[u].id:crypto.randomUUID(),dump_site_id:l,waste_type:i,estimated_cost_per_load:o,unit:c,created_at:new Date().toISOString()};return u>=0?m.dumpSiteRates[u]=x:m.dumpSiteRates.push(x),dt(m),x},async getDumpSiteRates(l){if(J){const{data:o,error:c}=await O.from("dump_site_rates").select("*").eq("dump_site_id",l);return c?(console.error("Error fetching dump site rates:",c),[]):o||[]}return(Be().dumpSiteRates||[]).filter(o=>o.dump_site_id===l)},async getHaulOffs(l){if(J){const{data:o,error:c}=await O.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",l).order("work_date",{ascending:!1});return c?(console.error("Error fetching haul-offs:",c),[]):o||[]}return(Be().haulOffs||[]).filter(o=>o.project_id===l).sort((o,c)=>new Date(c.work_date)-new Date(o.work_date))},async createHaulOff(l,i){const o={project_id:l,dump_site_id:i.dumpSiteId,waste_type:i.wasteType,loads:i.loads,hauling_company:i.haulingCompany||"",work_date:i.workDate,notes:i.notes||"",estimated_cost:i.estimatedCost||0,created_by:i.createdBy||""};if(J){const{data:u,error:x}=await O.from("haul_offs").insert(o).select().single();if(x)throw console.error("Error creating haul-off:",x),x;return u}const c=Be();c.haulOffs||(c.haulOffs=[]);const m={...o,id:crypto.randomUUID(),created_at:new Date().toISOString()};return c.haulOffs.push(m),dt(c),m},async calculateHaulOffCosts(l){const i=await this.getHaulOffs(l);let o=0,c=0;const m={},u=[],x={};i.forEach(f=>{const v=parseFloat(f.estimated_cost)||0,y=parseInt(f.loads)||0;o+=v,c+=y,m[f.waste_type]||(m[f.waste_type]={loads:0,cost:0}),m[f.waste_type].loads+=y,m[f.waste_type].cost+=v,x[f.work_date]||(x[f.work_date]={date:f.work_date,loads:0,cost:0}),x[f.work_date].loads+=y,x[f.work_date].cost+=v}),Object.values(x).sort((f,v)=>new Date(v.date)-new Date(f.date)).forEach(f=>u.push(f));const g=u.length;return{totalCost:o,totalLoads:c,byWasteType:m,byDate:u,daysWithHaulOff:g,avgDailyHaulOffCost:g>0?o/g:0}},subscribeToHaulOffs(l,i){return J?O.channel(`haul_offs:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${l}`},i).subscribe():null},async createCOR(l){if(J){const{data:i,error:o}=await O.from("change_orders").insert({company_id:l.company_id,project_id:l.project_id,area_id:l.area_id||null,cor_number:l.cor_number,title:l.title,description:l.description||"",scope_of_work:l.scope_of_work,period_start:l.period_start,period_end:l.period_end,status:"draft",labor_markup_percent:l.labor_markup_percent??1500,materials_markup_percent:l.materials_markup_percent??1500,equipment_markup_percent:l.equipment_markup_percent??1500,subcontractors_markup_percent:l.subcontractors_markup_percent??500,liability_insurance_percent:l.liability_insurance_percent??144,bond_percent:l.bond_percent??100,license_fee_percent:l.license_fee_percent??10,created_by:l.created_by||null}).select().single();if(o)throw o;return i}return null},async updateCOR(l,i){if(J){const{data:o,error:c}=await O.from("change_orders").update({...i,updated_at:new Date().toISOString()}).eq("id",l).select().single();if(c)throw c;return o}return null},async deleteCOR(l){if(J){const{error:i}=await O.from("change_orders").delete().eq("id",l);if(i)throw i}},async getCORs(l,i={}){if(J){let o=O.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",l);i.status&&(o=o.eq("status",i.status)),i.area_id&&(o=o.eq("area_id",i.area_id)),i.date_start&&(o=o.gte("period_start",i.date_start)),i.date_end&&(o=o.lte("period_end",i.date_end)),o=o.order("created_at",{ascending:!1});const{data:c,error:m}=await o;if(m)throw m;return c}return[]},async getCORById(l){if(J){const{data:i,error:o}=await O.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              id, work_date, ce_pco_number, status, notes
            )
          )
        `).eq("id",l).single();if(o)throw o;return i}return null},async getCORsByArea(l,i){if(J){const{data:o,error:c}=await O.from("change_orders").select("*").eq("project_id",l).eq("area_id",i).order("created_at",{ascending:!1});if(c)throw c;return o}return[]},async getAssignableCORs(l){if(J){const{data:i,error:o}=await O.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",l).in("status",["draft","pending_approval"]).order("cor_number",{ascending:!0});if(o)throw o;return i||[]}return[]},async getNextCORNumber(l){if(J){const{data:i,error:o}=await O.from("change_orders").select("cor_number").eq("project_id",l).order("created_at",{ascending:!1}).limit(1);if(o)throw o;if(i&&i.length>0){const c=i[0].cor_number.match(/COR #(\d+)/);if(c)return`COR #${parseInt(c[1])+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(l,i){if(J){const o=Math.round(i.regular_hours*i.regular_rate),c=Math.round(i.overtime_hours*i.overtime_rate),m=o+c,{data:u,error:x}=await O.from("change_order_labor").insert({change_order_id:l,labor_class:i.labor_class,wage_type:i.wage_type||"standard",regular_hours:i.regular_hours||0,overtime_hours:i.overtime_hours||0,regular_rate:i.regular_rate||0,overtime_rate:i.overtime_rate||0,regular_total:o,overtime_total:c,total:m,sort_order:i.sort_order||0,source_ticket_id:i.source_ticket_id||null}).select().single();if(x)throw x;return u}return null},async updateCORLaborItem(l,i){if(J){let o={...i};if(i.regular_hours!==void 0||i.regular_rate!==void 0||i.overtime_hours!==void 0||i.overtime_rate!==void 0){const{data:u}=await O.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",l).single(),x=i.regular_hours??u?.regular_hours??0,g=i.overtime_hours??u?.overtime_hours??0,f=i.regular_rate??u?.regular_rate??0,v=i.overtime_rate??u?.overtime_rate??0;o.regular_total=Math.round(x*f),o.overtime_total=Math.round(g*v),o.total=o.regular_total+o.overtime_total}const{data:c,error:m}=await O.from("change_order_labor").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async deleteCORLaborItem(l){if(J){const{error:i}=await O.from("change_order_labor").delete().eq("id",l);if(i)throw i}},async addCORMaterialItem(l,i){if(J){const o=Math.round(i.quantity*i.unit_cost),{data:c,error:m}=await O.from("change_order_materials").insert({change_order_id:l,description:i.description,quantity:i.quantity||1,unit:i.unit||"each",unit_cost:i.unit_cost||0,total:o,source_type:i.source_type||"custom",source_reference:i.source_reference||null,source_ticket_id:i.source_ticket_id||null,sort_order:i.sort_order||0}).select().single();if(m)throw m;return c}return null},async updateCORMaterialItem(l,i){if(J){let o={...i};if(i.quantity!==void 0||i.unit_cost!==void 0){const{data:u}=await O.from("change_order_materials").select("quantity, unit_cost").eq("id",l).single(),x=i.quantity??u?.quantity??1,g=i.unit_cost??u?.unit_cost??0;o.total=Math.round(x*g)}const{data:c,error:m}=await O.from("change_order_materials").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async deleteCORMaterialItem(l){if(J){const{error:i}=await O.from("change_order_materials").delete().eq("id",l);if(i)throw i}},async addCOREquipmentItem(l,i){if(J){const o=Math.round(i.quantity*i.unit_cost),{data:c,error:m}=await O.from("change_order_equipment").insert({change_order_id:l,description:i.description,quantity:i.quantity||1,unit:i.unit||"day",unit_cost:i.unit_cost||0,total:o,source_type:i.source_type||"custom",source_reference:i.source_reference||null,source_ticket_id:i.source_ticket_id||null,sort_order:i.sort_order||0}).select().single();if(m)throw m;return c}return null},async updateCOREquipmentItem(l,i){if(J){let o={...i};if(i.quantity!==void 0||i.unit_cost!==void 0){const{data:u}=await O.from("change_order_equipment").select("quantity, unit_cost").eq("id",l).single(),x=i.quantity??u?.quantity??1,g=i.unit_cost??u?.unit_cost??0;o.total=Math.round(x*g)}const{data:c,error:m}=await O.from("change_order_equipment").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async deleteCOREquipmentItem(l){if(J){const{error:i}=await O.from("change_order_equipment").delete().eq("id",l);if(i)throw i}},async addCORSubcontractorItem(l,i){if(J){const o=Math.round(i.quantity*i.unit_cost),{data:c,error:m}=await O.from("change_order_subcontractors").insert({change_order_id:l,description:i.description,quantity:i.quantity||1,unit:i.unit||"lump sum",unit_cost:i.unit_cost||0,total:o,source_type:i.source_type||"custom",source_reference:i.source_reference||null,sort_order:i.sort_order||0}).select().single();if(m)throw m;return c}return null},async updateCORSubcontractorItem(l,i){if(J){let o={...i};if(i.quantity!==void 0||i.unit_cost!==void 0){const{data:u}=await O.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",l).single(),x=i.quantity??u?.quantity??1,g=i.unit_cost??u?.unit_cost??0;o.total=Math.round(x*g)}const{data:c,error:m}=await O.from("change_order_subcontractors").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async deleteCORSubcontractorItem(l){if(J){const{error:i}=await O.from("change_order_subcontractors").delete().eq("id",l);if(i)throw i}},async addBulkLaborItems(l,i){if(J&&i.length>0){const o=i.map((u,x)=>{const g=Math.round(u.regular_hours*u.regular_rate),f=Math.round(u.overtime_hours*u.overtime_rate);return{change_order_id:l,labor_class:u.labor_class,wage_type:u.wage_type||"standard",regular_hours:u.regular_hours||0,overtime_hours:u.overtime_hours||0,regular_rate:u.regular_rate||0,overtime_rate:u.overtime_rate||0,regular_total:g,overtime_total:f,total:g+f,sort_order:u.sort_order??x,source_ticket_id:u.source_ticket_id||null}}),{data:c,error:m}=await O.from("change_order_labor").insert(o).select();if(m)throw m;return c}return[]},async addBulkMaterialItems(l,i){if(J&&i.length>0){const o=i.map((u,x)=>({change_order_id:l,description:u.description,quantity:u.quantity||1,unit:u.unit||"each",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,source_ticket_id:u.source_ticket_id||null,sort_order:u.sort_order??x})),{data:c,error:m}=await O.from("change_order_materials").insert(o).select();if(m)throw m;return c}return[]},async addBulkEquipmentItems(l,i){if(J&&i.length>0){const o=i.map((u,x)=>({change_order_id:l,description:u.description,quantity:u.quantity||1,unit:u.unit||"day",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,source_ticket_id:u.source_ticket_id||null,sort_order:u.sort_order??x})),{data:c,error:m}=await O.from("change_order_equipment").insert(o).select();if(m)throw m;return c}return[]},async addBulkSubcontractorItems(l,i){if(J&&i.length>0){const o=i.map((u,x)=>({change_order_id:l,description:u.description,quantity:u.quantity||1,unit:u.unit||"lump sum",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,sort_order:u.sort_order??x})),{data:c,error:m}=await O.from("change_order_subcontractors").insert(o).select();if(m)throw m;return c}return[]},async clearCORLineItems(l){J&&(await O.from("change_order_labor").delete().eq("change_order_id",l),await O.from("change_order_materials").delete().eq("change_order_id",l),await O.from("change_order_equipment").delete().eq("change_order_id",l),await O.from("change_order_subcontractors").delete().eq("change_order_id",l))},async saveCORLineItems(l,{laborItems:i,materialItems:o,equipmentItems:c,subcontractorItems:m}){if(J){await this.clearCORLineItems(l);const u=await Promise.all([i?.length>0?this.addBulkLaborItems(l,i):[],o?.length>0?this.addBulkMaterialItems(l,o):[],c?.length>0?this.addBulkEquipmentItems(l,c):[],m?.length>0?this.addBulkSubcontractorItems(l,m):[]]);return{labor:u[0],materials:u[1],equipment:u[2],subcontractors:u[3]}}return null},async assignTicketToCOR(l,i){if(J){const{data:o,error:c}=await O.from("change_order_ticket_associations").insert({change_order_id:i,ticket_id:l,data_imported:!1}).select().single();if(c)throw c;const{error:m}=await O.from("t_and_m_tickets").update({assigned_cor_id:i}).eq("id",l);if(m)throw m;return o}return null},async unassignTicketFromCOR(l,i){if(J){const{error:o}=await O.from("change_order_ticket_associations").delete().eq("ticket_id",l).eq("change_order_id",i);if(o)throw o;const{error:c}=await O.from("t_and_m_tickets").update({assigned_cor_id:null}).eq("id",l);if(c)throw c}},async getTicketsForCOR(l){if(J){const{data:i,error:o}=await O.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",l);if(o)throw o;return i}return[]},async getUnassignedTickets(l){if(J){const{data:i,error:o}=await O.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",l).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(o)throw o;return i}return[]},async importTicketDataToCOR(l,i,o,c,m){if(J){const{data:u,error:x}=await O.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",l).single();if(x)throw x;const{data:g,error:f}=await O.from("labor_rates").select("*").eq("company_id",o).eq("work_type",c||"demolition").eq("job_type",m||"standard");if(f)throw f;const v={};g?.forEach(U=>{v[U.role.toLowerCase()]=U});const y={};u.t_and_m_workers?.forEach(U=>{const z=(U.role||"laborer").toLowerCase();y[z]||(y[z]={regular_hours:0,overtime_hours:0}),y[z].regular_hours+=parseFloat(U.hours)||0,y[z].overtime_hours+=parseFloat(U.overtime_hours)||0});const A=Object.entries(y).map(([U,z])=>{const K=v[U]||{regular_rate:0,overtime_rate:0},E=Math.round((parseFloat(K.regular_rate)||0)*100),D=Math.round((parseFloat(K.overtime_rate)||0)*100);return{labor_class:U.charAt(0).toUpperCase()+U.slice(1),wage_type:m||"standard",regular_hours:z.regular_hours,overtime_hours:z.overtime_hours,regular_rate:E,overtime_rate:D,source_ticket_id:l}});A.length>0&&await this.addBulkLaborItems(i,A);const Y=[],B=[];u.t_and_m_items?.forEach(U=>{const z=U.custom_name||U.materials_equipment?.name||"Unknown Item",K=U.custom_category||U.materials_equipment?.category||"Other",E=U.materials_equipment?.unit||"each",D=Math.round((parseFloat(U.materials_equipment?.cost_per_unit)||0)*100),S={description:z,quantity:U.quantity||1,unit:E,unit_cost:D,source_type:"backup_sheet",source_ticket_id:l};K==="Equipment"?B.push(S):Y.push(S)}),Y.length>0&&await this.addBulkMaterialItems(i,Y),B.length>0&&await this.addBulkEquipmentItems(i,B);const{error:H}=await O.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString()}).eq("change_order_id",i).eq("ticket_id",l);if(H)throw H;return{laborItems:A,materialItems:Y,equipmentItems:B}}return null},async reimportTicketDataToCOR(l,i,o,c,m){return J?(await O.from("change_order_labor").delete().eq("change_order_id",i).eq("source_ticket_id",l),await O.from("change_order_materials").delete().eq("change_order_id",i).eq("source_ticket_id",l),await O.from("change_order_equipment").delete().eq("change_order_id",i).eq("source_ticket_id",l),this.importTicketDataToCOR(l,i,o,c,m)):null},async recalculateCOR(l){if(J){const{error:i}=await O.rpc("recalculate_cor_totals",{cor_id:l});if(i)throw i;return this.getCORById(l)}return null},async updateCORMarkupPercentages(l,i){if(J){const o={};i.labor!==void 0&&(o.labor_markup_percent=i.labor),i.materials!==void 0&&(o.materials_markup_percent=i.materials),i.equipment!==void 0&&(o.equipment_markup_percent=i.equipment),i.subcontractors!==void 0&&(o.subcontractors_markup_percent=i.subcontractors);const{data:c,error:m}=await O.from("change_orders").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async updateCORFeePercentages(l,i){if(J){const o={};i.liabilityInsurance!==void 0&&(o.liability_insurance_percent=i.liabilityInsurance),i.bond!==void 0&&(o.bond_percent=i.bond),i.licenseFee!==void 0&&(o.license_fee_percent=i.licenseFee);const{data:c,error:m}=await O.from("change_orders").update(o).eq("id",l).select().single();if(m)throw m;return c}return null},async submitCORForApproval(l){if(J){const{data:i,error:o}=await O.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",l).select().single();if(o)throw o;return i}return null},async approveCOR(l,i){if(J){const{data:o,error:c}=await O.from("change_orders").update({status:"approved",approved_by:i,approved_at:new Date().toISOString()}).eq("id",l).select().single();if(c)throw c;return o}return null},async rejectCOR(l,i=null){if(J){const{data:o,error:c}=await O.from("change_orders").update({status:"rejected",rejection_reason:i}).eq("id",l).select().single();if(c)throw c;return o}return null},async markCORAsBilled(l){if(J){const{data:i,error:o}=await O.from("change_orders").update({status:"billed"}).eq("id",l).select().single();if(o)throw o;return i}return null},async closeCOR(l){if(J){const{data:i,error:o}=await O.from("change_orders").update({status:"closed"}).eq("id",l).select().single();if(o)throw o;return i}return null},async saveCORSignature(l,i,o){if(J){const{data:c,error:m}=await O.from("change_orders").update({gc_signature_data:i,gc_signature_name:o,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",l).select().single();if(m)throw m;return c}return null},async getCORStats(l){if(J){const{data:i,error:o}=await O.from("change_orders").select("status, cor_total").eq("project_id",l);if(o)throw o;const c={total_cors:i.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return i.forEach(m=>{switch(m.status){case"draft":c.draft_count++;break;case"pending_approval":c.pending_count++,c.total_pending_value+=m.cor_total||0;break;case"approved":c.approved_count++,c.total_approved_value+=m.cor_total||0;break;case"rejected":c.rejected_count++;break;case"billed":case"closed":c.billed_count++,c.total_billed_value+=m.cor_total||0;break}}),c}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(l,i){return J?O.channel(`change_orders:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${l}`},i).subscribe():null},subscribeToCorTickets(l,i){return J?O.channel(`cor-tickets:${l}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${l}`},i).subscribe():null},async createSignatureRequest(l,i,o,c,m=null,u=null){if(J){const{data:x,error:g}=await O.rpc("generate_signature_token");if(g)throw g;const{data:f,error:v}=await O.from("signature_requests").insert({document_type:l,document_id:i,company_id:o,project_id:c,signature_token:x,expires_at:u,created_by:m}).select().single();if(v)throw v;return f}return null},async getSignatureRequestByToken(l){if(J){await O.rpc("increment_signature_view_count",{token:l});const{data:i,error:o}=await O.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",l).single();if(o)throw o;return i}return null},async getSignatureRequestsForDocument(l,i){if(J){const{data:o,error:c}=await O.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",l).eq("document_id",i).order("created_at",{ascending:!1});if(c)throw c;return o||[]}return[]},async addSignature(l,i,o){if(J){const{data:c,error:m}=await O.from("signatures").insert({signature_request_id:l,signature_slot:i,signature_image:o.signature,signer_name:o.signerName,signer_title:o.signerTitle||null,signer_company:o.signerCompany||null,signed_at:o.signedAt||new Date().toISOString(),ip_address:o.ipAddress||null,user_agent:o.userAgent||null}).select().single();if(m)throw m;return c}return null},async syncSignatureToDocument(l,i){if(!J)return null;const{document_type:o,document_id:c}=i,m=l.signature_slot,u={};m===1?(u.gc_signature_data=l.signature_image,u.gc_signature_name=l.signer_name,u.gc_signature_title=l.signer_title,u.gc_signature_company=l.signer_company,u.gc_signature_date=l.signed_at,u.gc_signature_ip=l.ip_address):m===2&&(u.client_signature_data=l.signature_image,u.client_signature_name=l.signer_name,u.client_signature_title=l.signer_title,u.client_signature_company=l.signer_company,u.client_signature_date=l.signed_at,u.client_signature_ip=l.ip_address);const x=o==="cor"?"change_orders":"t_and_m_tickets",{data:g,error:f}=await O.from(x).update(u).eq("id",c).select().single();if(f)throw f;return g},async revokeSignatureRequest(l){if(J){const{data:i,error:o}=await O.from("signature_requests").update({status:"revoked"}).eq("id",l).select().single();if(o)throw o;return i}return null},async getDocumentForSigning(l,i){if(!J)return null;if(l==="cor"){const{data:o,error:c}=await O.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",i).single();if(c)throw c;return o}else if(l==="tm_ticket"){const{data:o,error:c}=await O.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (*)
        `).eq("id",i).single();if(c)throw c;return o}return null},async getProjectCosts(l){if(J){const{data:o,error:c}=await O.from("project_costs").select("*").eq("project_id",l).order("cost_date",{ascending:!1});return c?(console.error("Error fetching project costs:",c),[]):o||[]}return(Be().projectCosts||[]).filter(o=>o.project_id===l).sort((o,c)=>new Date(c.cost_date)-new Date(o.cost_date))},async addProjectCost(l,i,o){const c={project_id:l,company_id:i,category:o.category,description:o.description,amount:parseFloat(o.amount),cost_date:o.cost_date||new Date().toISOString().split("T")[0],notes:o.notes||null,created_by:o.created_by||null};if(J){const{data:x,error:g}=await O.from("project_costs").insert(c).select().single();if(g)throw console.error("Error adding project cost:",g),g;return x}const m=Be();m.projectCosts||(m.projectCosts=[]);const u={...c,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return m.projectCosts.push(u),dt(m),u},async updateProjectCost(l,i){const o={category:i.category,description:i.description,amount:parseFloat(i.amount),cost_date:i.cost_date,notes:i.notes||null,updated_at:new Date().toISOString()};if(J){const{data:u,error:x}=await O.from("project_costs").update(o).eq("id",l).select().single();if(x)throw console.error("Error updating project cost:",x),x;return u}const c=Be();if(!c.projectCosts)return null;const m=c.projectCosts.findIndex(u=>u.id===l);return m===-1?null:(c.projectCosts[m]={...c.projectCosts[m],...o},dt(c),c.projectCosts[m])},async deleteProjectCost(l){if(J){const{error:o}=await O.from("project_costs").delete().eq("id",l);if(o)throw console.error("Error deleting project cost:",o),o;return!0}const i=Be();return i.projectCosts&&(i.projectCosts=i.projectCosts.filter(o=>o.id!==l),dt(i)),!0},async getProjectCostsSummary(l){const i=await this.getProjectCosts(l),o={};let c=0;return i.forEach(m=>{const u=parseFloat(m.amount)||0;c+=u,o[m.category]||(o[m.category]={category:m.category,total:0,count:0,items:[]}),o[m.category].total+=u,o[m.category].count++,o[m.category].items.push(m)}),Object.values(o).forEach(m=>{m.percentage=c>0?m.total/c*100:0}),{totalCost:c,byCategory:o,itemCount:i.length}}};Uf(async l=>{if(l&&J){console.log("Back online - syncing pending actions...");try{const i=await zx(de);i.synced>0&&console.log(`Synced ${i.synced} pending actions`),i.failed>0&&console.warn(`Failed to sync ${i.failed} actions`)}catch(i){console.error("Error syncing pending actions:",i)}}});const Ff=p.createContext(),_a={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function nl({children:l,companyId:i}){const[o,c]=p.useState(_a),[m,u]=p.useState(!0);p.useEffect(()=>{i?x(i):g()},[i]),p.useEffect(()=>{y(o)},[o]);const x=async B=>{try{if(u(!0),!J){c(_a),u(!1);return}const{data:H,error:U}=await O.from("company_branding").select("*").eq("company_id",B).single();U?(U.code==="PGRST116"?await f(B):console.error("Error loading branding:",U),c(_a)):c({..._a,...H})}catch(H){console.error("Error in loadBranding:",H),c(_a)}finally{u(!1)}},g=async()=>{try{u(!0);const B=window.location.hostname;if(B==="localhost"||B==="127.0.0.1"){c(_a),u(!1);return}if(!J){c(_a),u(!1);return}const{data:H,error:U}=await O.rpc("get_branding_by_domain",{domain_name:B});U||!H||H.length===0?c(_a):c({..._a,...H[0]})}catch(B){console.error("Error loading branding by domain:",B),c(_a)}finally{u(!1)}},f=async B=>{try{const{data:H,error:U}=await O.from("company_branding").insert({company_id:B,..._a}).select().single();U&&console.error("Error creating default branding:",U)}catch(H){console.error("Error in createDefaultBranding:",H)}},v=async B=>{try{if(!J)return c(S=>({...S,...B})),{success:!0};if(!i)return{success:!1,error:"No company ID"};const H={},U=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const S of U)B[S]!==void 0&&(H[S]=B[S]);const{data:z,error:K}=await O.from("company_branding").select("id").eq("company_id",i).single();if(K&&K.code==="PGRST116"){const{data:S,error:te}=await O.from("company_branding").insert({company_id:i,...H}).select().single();return te?(console.error("Error creating branding:",te),{success:!1,error:te.message}):(c({..._a,...S}),{success:!0,data:S})}const{data:E,error:D}=await O.from("company_branding").update(H).eq("company_id",i).select().single();return D?(console.error("Error updating branding:",D),{success:!1,error:D.message}):(c({..._a,...E}),{success:!0,data:E})}catch(H){return console.error("Error in updateBranding:",H),{success:!1,error:H.message}}},y=B=>{const H=document.documentElement;if(H.style.setProperty("--primary-color",B.primary_color),H.style.setProperty("--secondary-color",B.secondary_color),B.favicon_url){let U=document.querySelector("link[rel*='icon']");U||(U=document.createElement("link"),U.rel="icon",document.head.appendChild(U)),U.href=B.favicon_url}document.title=B.custom_app_name||"FieldSync"},Y={branding:o,loading:m,updateBranding:v,uploadBrandingImage:async(B,H)=>{try{if(!J)return{success:!0,url:URL.createObjectURL(B)};const U=B.name.split(".").pop(),K=`branding/${`${i}/${H}-${Date.now()}.${U}`}`,{data:E,error:D}=await O.storage.from("public").upload(K,B,{cacheControl:"3600",upsert:!0});if(D)return console.error("Error uploading image:",D),{success:!1,error:D.message};const{data:{publicUrl:S}}=O.storage.from("public").getPublicUrl(K);return{success:!0,url:S}}catch(U){return console.error("Error in uploadBrandingImage:",U),{success:!1,error:U.message}}},refreshBranding:()=>i?x(i):g()};return e.jsx(Ff.Provider,{value:Y,children:l})}function il(){const l=p.useContext(Ff);if(!l)throw new Error("useBranding must be used within a BrandingProvider");return l}const Lx=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Bx=l=>l.replace(/^([A-Z])|[\s-_]+(\w)/g,(i,o,c)=>c?c.toUpperCase():o.toLowerCase()),of=l=>{const i=Bx(l);return i.charAt(0).toUpperCase()+i.slice(1)},Hf=(...l)=>l.filter((i,o,c)=>!!i&&i.trim()!==""&&c.indexOf(i)===o).join(" ").trim(),Fx=l=>{for(const i in l)if(i.startsWith("aria-")||i==="role"||i==="title")return!0};var Hx={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const $x=p.forwardRef(({color:l="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:c,className:m="",children:u,iconNode:x,...g},f)=>p.createElement("svg",{ref:f,...Hx,width:i,height:i,stroke:l,strokeWidth:c?Number(o)*24/Number(i):o,className:Hf("lucide",m),...!u&&!Fx(g)&&{"aria-hidden":"true"},...g},[...x.map(([v,y])=>p.createElement(v,y)),...Array.isArray(u)?u:[u]]));const He=(l,i)=>{const o=p.forwardRef(({className:c,...m},u)=>p.createElement($x,{ref:u,iconNode:i,className:Hf(`lucide-${Lx(of(l))}`,`lucide-${l}`,c),...m}));return o.displayName=of(l),o};const Vx=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Gx=He("bell",Vx);const Yx=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],rl=He("briefcase",Yx);const Qx=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Di=He("building-2",Qx);const Xx=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],rr=He("calendar",Xx);const Zx=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],sr=He("camera",Zx);const Px=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],nr=He("check",Px);const Jx=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Ps=He("chevron-down",Jx);const Ix=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Kx=He("chevron-left",Ix);const Wx=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],yn=He("chevron-right",Wx);const ej=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],$f=He("chevron-up",ej);const tj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],cl=He("circle-alert",tj);const aj=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Qa=He("circle-check-big",aj);const sj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],df=He("circle-x",sj);const nj=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],Ra=He("clipboard-list",nj);const lj=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],lr=He("clock",lj);const rj=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],uf=He("copy",rj);const ij=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],ll=He("dollar-sign",ij);const cj=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Vf=He("download",cj);const oj=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Gf=He("ellipsis",oj);const dj=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],mf=He("external-link",dj);const uj=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],mj=He("eye",uj);const hj=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],za=He("file-text",hj);const fj=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],pj=He("flame",fj);const gj=[["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["rect",{x:"2",y:"15",width:"20",height:"4",rx:"1",key:"g3x8cw"}]],na=He("hard-hat",gj);const xj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],id=He("info",xj);const jj=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],hf=He("layout-grid",jj);const vj=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],od=He("link",vj);const yj=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ff=He("lock",yj);const bj=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],_j=He("map-pin",bj);const Nj=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],fs=He("message-square",Nj);const Sj=[["path",{d:"M5 12h14",key:"1ays0h"}]],Cj=He("minus",Sj);const wj=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Za=He("package",wj);const kj=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],dd=He("pen-line",kj);const Ej=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Dj=He("pen-tool",Ej);const Mj=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Yf=He("pen",Mj);const Tj=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Qf=He("pencil",Tj);const Aj=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],Rj=He("percent",Aj);const zj=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],qj=He("phone",zj);const Oj=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],La=He("plus",Oj);const Uj=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Xf=He("rotate-ccw",Uj);const Lj=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],pf=He("save",Lj);const Bj=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Fj=He("search",Bj);const Hj=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Zf=He("send",Hj);const $j=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Pf=He("shield",$j);const Vj=[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]],Gj=He("stamp",Vj);const Yj=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],gs=He("trash-2",Yj);const Qj=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Jf=He("trending-down",Qj);const Xj=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Zj=He("trending-up",Xj);const Pj=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ti=He("triangle-alert",Pj);const Jj=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],bn=He("truck",Jj);const Ij=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Kj=He("upload",Ij);const Wj=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ev=He("user-check",Wj);const tv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ir=He("users",tv);const av=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],cr=He("wrench",av);const sv=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],_n=He("x",sv);const nv=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],lv=He("zap",nv);function Ya({className:l="",showPoweredBy:i=!1}){const{branding:o}=il();return e.jsxs("div",{className:`app-logo ${l}`,children:[o.logo_url?e.jsx("img",{src:o.logo_url,alt:o.custom_app_name||"Logo",className:"custom-logo"}):e.jsxs("div",{className:"logo",children:[o.custom_app_name||"Field",e.jsx("span",{children:"Sync"})]}),i&&!o.hide_fieldsync_branding&&e.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function rv({onForemanAccess:l,onOfficeLogin:i,onShowToast:o}){const[c,m]=p.useState(null),[u,x]=p.useState(""),[g,f]=p.useState(null),[v,y]=p.useState(""),[A,Y]=p.useState(!1),[B,H]=p.useState(""),[U,z]=p.useState(""),[K,E]=p.useState(1),[D,S]=p.useState(null),[te,se]=p.useState(""),[Z,Q]=p.useState(""),[F,I]=p.useState(""),[P,j]=p.useState(""),_=$=>{const xe=$.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);x(xe)},C=async()=>{if(u.length<2){o("Enter company code","error");return}Y(!0);try{const $=await de.getCompanyByCode(u);$?f($):(o("Invalid company code","error"),x(""))}catch{o("Error checking code","error")}finally{Y(!1)}},ee=async $=>{if($.length===4){Y(!0);try{const xe=await de.getProjectByPinAndCompany($,g.id);xe?l(xe):(o("Invalid PIN","error"),y(""))}catch{o("Error checking PIN","error")}finally{Y(!1)}}},w=$=>{if(v.length<4){const xe=v+$;y(xe),xe.length===4&&setTimeout(()=>ee(xe),200)}},k=()=>{y($=>$.slice(0,-1))},M=()=>{f(null),y("")},he=()=>{if(!B.trim()||!U.trim()){o("Enter email and password","error");return}i(B,U)},V=async()=>{if(u.length<2){o("Enter company code","error");return}Y(!0);try{const $=await de.getCompanyByCode(u);$?(S($),E(2)):(o("Invalid company code","error"),x(""))}catch{o("Error checking code","error")}finally{Y(!1)}},q=async()=>{if(!te.trim()){o("Enter office code","error");return}Y(!0);try{const{data:$,error:xe}=await O.rpc("verify_office_code",{company_id:D.id,code:te.trim()});if(xe)throw xe;$===!0?E(3):(o("Invalid office code","error"),se(""))}catch{o("Error verifying code","error")}finally{Y(!1)}},L=async()=>{if(!Z.trim()){o("Enter your name","error");return}if(!F.trim()||!F.includes("@")){o("Enter valid email","error");return}if(P.length<6){o("Password must be 6+ characters","error");return}Y(!0);try{const{data:$,error:xe}=await O.auth.signUp({email:F,password:P});if(xe)throw xe;const be=$.user?.id;if(!be)throw new Error("Failed to create user");const{error:Fe}=await O.from("users").insert({id:be,email:F,password_hash:"managed_by_supabase_auth",name:Z.trim(),company_id:D.id,role:"member",is_active:!0});if(Fe)throw Fe;const{error:ye}=await O.from("user_companies").insert({user_id:be,company_id:D.id,role:"member"});ye&&console.error("Error adding to user_companies:",ye),o("Account created! Logging you in...","success"),setTimeout(()=>{window.location.reload()},1e3)}catch($){console.error("Join error:",$),o($.message||"Error creating account","error")}finally{Y(!1)}};if(c===null)return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx(Ya,{className:"entry-logo",showPoweredBy:!1}),e.jsxs("div",{className:"entry-buttons",children:[e.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>m("foreman"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(na,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Foreman"}),e.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),e.jsxs("button",{className:"entry-mode-btn office",onClick:()=>m("office"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(rl,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Office"}),e.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(c==="foreman")return g?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:M,children:""}),e.jsx(Ya,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:g.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),e.jsx("div",{className:"pin-display",children:[0,1,2,3].map($=>e.jsx("div",{className:`pin-dot ${v.length>$?"filled":""}`,children:v.length>$?"":""},$))}),e.jsxs("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map($=>e.jsx("button",{className:"num-btn",onClick:()=>w($.toString()),disabled:A,children:$},$)),e.jsx("button",{className:"num-btn empty",disabled:!0}),e.jsx("button",{className:"num-btn",onClick:()=>w("0"),disabled:A,children:"0"}),e.jsx("button",{className:"num-btn backspace",onClick:k,disabled:A||v.length===0,children:""})]}),A&&e.jsx("div",{className:"entry-loading",children:e.jsx("div",{className:"spinner"})})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m(null),children:""}),e.jsx(Ya,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:u,onChange:$=>_($.target.value),placeholder:"Company Code",disabled:A,autoFocus:!0,onKeyDown:$=>{$.key==="Enter"&&C()}}),e.jsx("button",{className:"entry-submit-btn",onClick:C,disabled:A||u.length<2,children:A?"...":""})]})]})});if(c==="office")return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m(null),children:""}),e.jsx(Ya,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"email",value:B,onChange:$=>H($.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:$=>{$.key==="Enter"&&he()}}),e.jsx("input",{type:"password",value:U,onChange:$=>z($.target.value),placeholder:"Password",onKeyDown:$=>{$.key==="Enter"&&he()}}),e.jsx("button",{className:"entry-login-btn",onClick:he,children:"Sign In"})]}),e.jsxs("div",{className:"entry-signup-hint",children:[e.jsx("p",{children:"New employee?"}),e.jsx("button",{className:"entry-join-link",onClick:()=>m("join"),children:"Join your company"})]})]})});if(c==="join")return K===1?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m("office"),children:""}),e.jsx(Ya,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),e.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:u,onChange:$=>_($.target.value),placeholder:"Company Code",disabled:A,autoFocus:!0,onKeyDown:$=>{$.key==="Enter"&&V()}}),e.jsx("button",{className:"entry-submit-btn",onClick:V,disabled:A||u.length<2,children:A?"...":""})]})]})}):K===2?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{E(1),S(null),se("")},children:""}),e.jsx(Ya,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:D?.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),e.jsx("p",{className:"entry-hint",children:"This code is only for office staff"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"password",value:te,onChange:$=>se($.target.value),placeholder:"Office Code",disabled:A,autoFocus:!0,onKeyDown:$=>{$.key==="Enter"&&q()}}),e.jsx("button",{className:"entry-submit-btn",onClick:q,disabled:A||!te.trim(),children:A?"...":""})]})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{E(2),se("")},children:""}),e.jsx(Ya,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:D?.name}),e.jsx("p",{className:"entry-subtitle",children:"Create your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"text",value:Z,onChange:$=>Q($.target.value),placeholder:"Your Name",autoFocus:!0}),e.jsx("input",{type:"email",value:F,onChange:$=>I($.target.value),placeholder:"Email"}),e.jsx("input",{type:"password",value:P,onChange:$=>j($.target.value),placeholder:"Password (6+ characters)",onKeyDown:$=>{$.key==="Enter"&&L()}}),e.jsx("button",{className:"entry-login-btn",onClick:L,disabled:A,children:A?"Creating...":"Join Company"})]}),e.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})})}function Dt(l){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)}function iv(l){if(!l||l.length===0)return 0;let i=0;return l.forEach(o=>{o.status==="done"&&(i+=o.weight)}),Math.round(i)}function gf(l){if(!l||l.length===0)return{progress:0,earnedValue:0,totalValue:0,isValueBased:!1};if(l.some(c=>c.scheduled_value>0)){const c=l.reduce((x,g)=>x+(g.scheduled_value||0),0),m=l.filter(x=>x.status==="done").reduce((x,g)=>x+(g.scheduled_value||0),0);return{progress:c>0?Math.round(m/c*100):0,earnedValue:m,totalValue:c,isValueBased:!0}}const o=l.filter(c=>c.status==="done").reduce((c,m)=>c+(m.weight||0),0);return{progress:Math.round(o),earnedValue:0,totalValue:0,isValueBased:!1}}function If(l){if(!l||l.length===0)return"not_started";const i=l.some(m=>m.status==="working"),o=l.some(m=>m.status==="done");return l.every(m=>m.status==="done")?"done":i||o?"working":"not_started"}function cv(l){const i=If(l);return i==="done"?"Complete":i==="working"?"In Progress":"Not Started"}async function ov(l,i=1920,o=.8){return!l.type.startsWith("image/")||l.size<500*1024?l:new Promise(c=>{const m=document.createElement("canvas"),u=m.getContext("2d"),x=new Image;x.onload=()=>{let{width:g,height:f}=x;g>i&&(f=Math.round(f*i/g),g=i);const v=1920;f>v&&(g=Math.round(g*v/f),f=v),m.width=g,m.height=f,u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.drawImage(x,0,0,g,f),m.toBlob(y=>{if(y){const A=l.name.replace(/\.[^/.]+$/,""),Y=new File([y],`${A}.jpg`,{type:"image/jpeg",lastModified:Date.now()}),B=((1-y.size/l.size)*100).toFixed(1);console.log(`Image compressed: ${l.name} - ${(l.size/1024).toFixed(0)}KB  ${(y.size/1024).toFixed(0)}KB (${B}% smaller)`),c(Y)}else console.warn("Image compression failed, using original"),c(l)},"image/jpeg",o),URL.revokeObjectURL(x.src)},x.onerror=()=>{console.warn("Failed to load image for compression, using original"),URL.revokeObjectURL(x.src),c(l)},x.src=URL.createObjectURL(l)})}const xf=["Containment","PPE","Disposal","Equipment"];function dv({project:l,companyId:i,maxPhotos:o=10,onSubmit:c,onCancel:m,onShowToast:u}){const[x,g]=p.useState(1),[f,v]=p.useState(new Date().toISOString().split("T")[0]),[y,A]=p.useState(""),[Y,B]=p.useState(""),[H,U]=p.useState(""),[z,K]=p.useState([]),[E,D]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}]),[S,te]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[se,Z]=p.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[Q,F]=p.useState([]),[I,P]=p.useState(""),[j,_]=p.useState([]),[C,ee]=p.useState(!1),[w,k]=p.useState(""),[M,he]=p.useState([]),[V,q]=p.useState(!1),[L,$]=p.useState(null),[xe,be]=p.useState([]),[Fe,ye]=p.useState(!1),[We,Ve]=p.useState(!1),[De,nt]=p.useState({name:"",category:"",quantity:""});p.useEffect(()=>{ke(),Vt()},[l.id]);const Vt=async()=>{try{const N=await de.getAssignableCORs(l.id);K(N||[])}catch(N){console.error("Error loading assignable CORs:",N)}},ke=async()=>{try{const N=await de.getCrewCheckin(l.id);N?.workers&&he(N.workers)}catch(N){console.error("Error loading crew:",N)}};p.useEffect(()=>{L&&i&&ze(L)},[L,i]);const ze=async N=>{ye(!0);try{const re=await de.getMaterialsEquipmentByCategory(i,N);be(re)}catch(re){console.error("Error loading items:",re),u("Error loading items","error")}finally{ye(!1)}},Ae=()=>{D([...E,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},Me=(N,re,ce)=>{D(E.map((ue,Oe)=>Oe===N?{...ue,[re]:ce}:ue))},Ce=N=>{E.length>1?D(E.filter((re,ce)=>ce!==N)):D([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},Xe=()=>{Z([...se,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},X=(N,re,ce)=>{Z(se.map((ue,Oe)=>Oe===N?{...ue,[re]:ce}:ue))},T=N=>{se.length>1?Z(se.filter((re,ce)=>ce!==N)):Z([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},_e=()=>{te([...S,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Ee=(N,re,ce)=>{te(S.map((ue,Oe)=>Oe===N?{...ue,[re]:ce}:ue))},ae=N=>{S.length>1?te(S.filter((re,ce)=>ce!==N)):te([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Se=N=>{const re=Q.findIndex(ce=>ce.material_equipment_id===N.id);re>=0?F(Q.map((ce,ue)=>ue===re?{...ce,quantity:ce.quantity+1}:ce)):F([...Q,{material_equipment_id:N.id,name:N.name,unit:N.unit,category:N.category,quantity:1,isCustom:!1}]),u(`Added ${N.name}`,"success")},ct=()=>{if(!De.name||!De.category||!De.quantity){u("Fill in all fields","error");return}F([...Q,{material_equipment_id:null,custom_name:De.name,custom_category:De.category,name:De.name,category:De.category,quantity:parseFloat(De.quantity),unit:"each",isCustom:!0}]),nt({name:"",category:"",quantity:""}),Ve(!1),$(null),u("Custom item added","success")},Pe=(N,re)=>{const ce=parseFloat(re)||0;ce<=0?Ut(N):F(Q.map((ue,Oe)=>Oe===N?{...ue,quantity:ce}:ue))},Ut=N=>{F(Q.filter((re,ce)=>ce!==N))},Rt=N=>{const re=Array.from(N.target.files);if(re.length===0)return;const ce=o===-1?1/0:o-j.length;if(ce<=0){u(`Photo limit reached (${o} max)`,"error"),N.target.value="";return}const ue=re.slice(0,ce);ue.length<re.length&&u(`Only ${ue.length} photo(s) added (${o} max)`,"error"),ue.forEach(Oe=>{if(!Oe.type.startsWith("image/")){u("Please select an image file","error");return}const Qe=URL.createObjectURL(Oe);_(Te=>[...Te,{id:Date.now()+Math.random(),file:Oe,previewUrl:Qe,name:Oe.name}])}),N.target.value=""},ut=N=>{const re=j.find(ce=>ce.id===N);re?.previewUrl&&URL.revokeObjectURL(re.previewUrl),_(j.filter(ce=>ce.id!==N))},Gt=()=>{if(x===1){const N=E.some(ue=>ue.name.trim()&&(parseFloat(ue.hours)>0||parseFloat(ue.overtimeHours)>0)),re=S.some(ue=>ue.name.trim()&&(parseFloat(ue.hours)>0||parseFloat(ue.overtimeHours)>0)),ce=se.some(ue=>ue.name.trim()&&(parseFloat(ue.hours)>0||parseFloat(ue.overtimeHours)>0));return N||re||ce}return!0},Lt=()=>{x<3&&g(x+1)},Et=()=>{L?($(null),Ve(!1)):We?Ve(!1):x>1?g(x-1):m()},et=async()=>{if(!Y.trim()){u("Enter your name to submit","error");return}const N=E.filter(ue=>ue.name.trim()&&(parseFloat(ue.hours)>0||parseFloat(ue.overtimeHours)>0)),re=S.filter(ue=>ue.name.trim()&&(parseFloat(ue.hours)>0||parseFloat(ue.overtimeHours)>0)),ce=se.filter(ue=>ue.name.trim()&&(parseFloat(ue.hours)>0||parseFloat(ue.overtimeHours)>0));if(N.length===0&&re.length===0&&ce.length===0){u("Add at least one worker","error");return}ee(!0),k("Creating ticket...");try{const ue=await de.createTMTicket({project_id:l.id,work_date:f,ce_pco_number:y.trim()||null,assigned_cor_id:H||null,notes:I.trim()||null,photos:[],created_by_name:Y.trim()});let Oe=[];if(j.length>0){k(`Compressing ${j.length} photo${j.length>1?"s":""}...`);const Te=await Promise.all(j.map(async(Bt,la)=>{try{const vt=await ov(Bt.file);return{...Bt,file:vt}}catch(vt){return console.warn(`Failed to compress photo ${la+1}, using original:`,vt),Bt}}));k(`Uploading ${j.length} photo${j.length>1?"s":""}...`);let je=0;const lt=Te.map(async(Bt,la)=>{try{const vt=await de.uploadPhoto(i,l.id,ue.id,Bt.file);return je++,k(`Uploading ${je}/${j.length} photos...`),console.log(`Photo ${la+1} uploaded successfully:`,vt),vt}catch(vt){return console.error(`Photo ${la+1} upload failed:`,vt),u(`Photo ${la+1} failed to upload`,"error"),null}});Oe=(await Promise.all(lt)).filter(Bt=>Bt!==null),Oe.length<j.length&&Oe.length>0&&u(`${Oe.length}/${j.length} photos uploaded`,"warning")}Oe.length>0&&(k("Saving photos..."),await de.updateTMTicketPhotos(ue.id,Oe));const Qe=[...N.map(Te=>({name:Te.name.trim(),hours:parseFloat(Te.hours)||0,overtime_hours:parseFloat(Te.overtimeHours)||0,time_started:Te.timeStarted||null,time_ended:Te.timeEnded||null,role:Te.role})),...re.map(Te=>({name:Te.name.trim(),hours:parseFloat(Te.hours)||0,overtime_hours:parseFloat(Te.overtimeHours)||0,time_started:Te.timeStarted||null,time_ended:Te.timeEnded||null,role:"Operator"})),...ce.map(Te=>({name:Te.name.trim(),hours:parseFloat(Te.hours)||0,overtime_hours:parseFloat(Te.overtimeHours)||0,time_started:Te.timeStarted||null,time_ended:Te.timeEnded||null,role:"Laborer"}))];if(k("Saving workers..."),await de.addTMWorkers(ue.id,Qe),Q.length>0&&(k("Saving materials..."),await de.addTMItems(ue.id,Q.map(Te=>({material_equipment_id:Te.material_equipment_id,custom_name:Te.custom_name||null,custom_category:Te.custom_category||null,quantity:Te.quantity})))),H){k("Importing to COR...");try{await de.importTicketDataToCOR(ue.id,H,i,l.work_type||"demolition",l.job_type||"standard")}catch(Te){console.error("Error importing to COR:",Te),u("T&M saved, but COR import failed","warning")}}j.forEach(Te=>{Te.previewUrl&&URL.revokeObjectURL(Te.previewUrl)}),u("T&M submitted!","success"),c()}catch(ue){console.error("Error submitting T&M:",ue),u("Error submitting T&M","error")}finally{ee(!1),k("")}},tt=E.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),xt=S.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),jt=se.filter(N=>N.name.trim()&&(parseFloat(N.hours)>0||parseFloat(N.overtimeHours)>0)),ne=tt.length+xt.length+jt.length,Ne=[...tt,...xt,...jt].reduce((N,re)=>N+parseFloat(re.hours||0),0),pe=[...tt,...xt,...jt].reduce((N,re)=>N+parseFloat(re.overtimeHours||0),0);return Q.reduce((N,re)=>N+re.quantity,0),x===2&&(L||We)?e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[e.jsx("button",{className:"tm-back-btn",onClick:Et,children:""}),e.jsx("h2",{children:We?"Add Custom Item":L}),e.jsxs("div",{className:"tm-item-count",children:[Q.length," items"]})]}),We?e.jsxs("div",{className:"tm-custom-form",children:[e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Item Name"}),e.jsx("input",{type:"text",placeholder:"What did you use?",value:De.name,onChange:N=>nt({...De,name:N.target.value}),autoFocus:!0})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Category"}),e.jsx("div",{className:"tm-category-select",children:xf.map(N=>e.jsx("button",{className:`tm-cat-chip ${De.category===N?"active":""}`,onClick:()=>nt({...De,category:N}),children:N},N))})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",placeholder:"How many?",value:De.quantity,onChange:N=>nt({...De,quantity:N.target.value})})]}),e.jsx("button",{className:"tm-big-btn primary",onClick:ct,children:"Add Custom Item"})]}):e.jsx("div",{className:"tm-item-grid",children:Fe?e.jsx("div",{className:"tm-loading",children:"Loading..."}):e.jsxs(e.Fragment,{children:[xe.map(N=>{const re=Q.find(ce=>ce.material_equipment_id===N.id);return e.jsxs("button",{className:`tm-item-card ${re?"added":""}`,onClick:()=>Se(N),children:[e.jsx("span",{className:"tm-item-name",children:N.name}),e.jsx("span",{className:"tm-item-unit",children:N.unit}),re&&e.jsx("span",{className:"tm-item-badge",children:re.quantity})]},N.id)}),e.jsxs("button",{className:"tm-item-card custom",onClick:()=>Ve(!0),children:[e.jsx("span",{className:"tm-item-name",children:"+ Add Other"}),e.jsx("span",{className:"tm-item-unit",children:"Not on list"})]})]})}),!We&&Q.length>0&&e.jsx("div",{className:"tm-wizard-footer",children:e.jsxs("button",{className:"tm-big-btn primary",onClick:()=>$(null),children:["Done Adding (",Q.length," items)"]})})]}):e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[e.jsx("button",{className:"tm-back-btn",onClick:Et,children:""}),e.jsxs("h2",{children:[x===1&&"Workers",x===2&&"Materials & Equipment",x===3&&"Review"]}),e.jsxs("div",{className:"tm-step-dots",children:[e.jsx("span",{className:`tm-dot ${x>=1?"active":""}`}),e.jsx("span",{className:`tm-dot ${x>=2?"active":""}`}),e.jsx("span",{className:`tm-dot ${x>=3?"active":""}`})]})]}),x===1&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-project-info",children:[l.job_number&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Job #"}),e.jsx("span",{className:"tm-project-value",children:l.job_number})]}),e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Project"}),e.jsx("span",{className:"tm-project-value",children:l.name})]}),l.address&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Address"}),e.jsx("span",{className:"tm-project-value",children:l.address})]}),l.general_contractor&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"GC"}),e.jsx("span",{className:"tm-project-value",children:l.general_contractor})]})]}),e.jsxs("div",{className:"tm-field-row",children:[e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:f,onChange:N=>v(N.target.value),className:"tm-date"})]}),e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"CE / PCO #"}),e.jsx("input",{type:"text",placeholder:"Change Event / PCO",value:y,onChange:N=>A(N.target.value),className:"tm-input"})]})]}),z.length>0&&e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Link to Change Order Request (Optional)"}),e.jsxs("select",{value:H,onChange:N=>U(N.target.value),className:"tm-input tm-select",children:[e.jsx("option",{value:"",children:"-- No COR --"}),z.map(N=>e.jsxs("option",{value:N.id,children:[N.cor_number,": ",N.title||"Untitled"," (",N.status,")"]},N.id))]}),e.jsx("span",{className:"tm-field-hint",children:"T&M data will be imported into the selected COR"})]}),M.length>0&&e.jsxs("div",{className:"tm-crew-picker",children:[e.jsxs("button",{className:"tm-crew-picker-btn",onClick:()=>q(!V),children:[e.jsx(na,{size:16})," ",V?"Hide":"Select from"," Today's Crew (",M.length,")"]}),V&&e.jsx("div",{className:"tm-crew-list",children:M.map((N,re)=>{const ce=E.some(ue=>ue.name.toLowerCase()===N.name.toLowerCase())||S.some(ue=>ue.name.toLowerCase()===N.name.toLowerCase())||se.some(ue=>ue.name.toLowerCase()===N.name.toLowerCase());return e.jsxs("button",{className:`tm-crew-item ${ce?"added":""}`,onClick:()=>{if(!ce){if(N.role==="Foreman"||N.role==="Supervisor"){const ue=E.findIndex(Oe=>!Oe.name.trim());ue>=0?Me(ue,"name",N.name):D([...E,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:N.role==="Supervisor"?"Superintendent":"Foreman"}])}else if(N.role==="Operator"){const ue=S.findIndex(Oe=>!Oe.name.trim());ue>=0?Ee(ue,"name",N.name):te([...S,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}else{const ue=se.findIndex(Oe=>!Oe.name.trim());ue>=0?X(ue,"name",N.name):Z([...se,{name:N.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}u(`Added ${N.name}`,"success")}},disabled:ce,children:[e.jsx("span",{className:"tm-crew-item-name",children:N.name}),e.jsx("span",{className:`tm-crew-item-role ${(N.role||"laborer").toLowerCase()}`,children:N.role||"Laborer"}),ce&&e.jsx("span",{className:"tm-crew-item-check",children:""})]},re)})})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Supervision"}),e.jsx("div",{className:"tm-workers-list",children:E.map((N,re)=>e.jsxs("div",{className:"tm-worker-card-expanded",children:[e.jsxs("div",{className:"tm-worker-row-top",children:[e.jsx("div",{className:"tm-role-select",children:e.jsxs("select",{value:N.role,onChange:ce=>Me(re,"role",ce.target.value),children:[e.jsx("option",{value:"Foreman",children:"Foreman"}),e.jsx("option",{value:"Superintendent",children:"Superintendent"})]})}),e.jsx("input",{type:"text",placeholder:"First & Last Name",value:N.name,onChange:ce=>Me(re,"name",ce.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>Ce(re),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:ce=>Me(re,"timeStarted",ce.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:ce=>Me(re,"timeEnded",ce.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Reg Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:ce=>Me(re,"hours",ce.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"OT Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:ce=>Me(re,"overtimeHours",ce.target.value)})]})]})]},re))}),e.jsx("button",{className:"tm-add-btn",onClick:Ae,children:"+ Add Supervision"})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Operators"}),e.jsx("div",{className:"tm-workers-list",children:S.map((N,re)=>e.jsxs("div",{className:"tm-worker-card-expanded",children:[e.jsxs("div",{className:"tm-worker-row-top",children:[e.jsx("input",{type:"text",placeholder:"First & Last Name",value:N.name,onChange:ce=>Ee(re,"name",ce.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>ae(re),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:ce=>Ee(re,"timeStarted",ce.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:ce=>Ee(re,"timeEnded",ce.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Reg Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:ce=>Ee(re,"hours",ce.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"OT Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:ce=>Ee(re,"overtimeHours",ce.target.value)})]})]})]},re))}),e.jsx("button",{className:"tm-add-btn",onClick:_e,children:"+ Add Operator"})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Laborers"}),e.jsx("div",{className:"tm-workers-list",children:se.map((N,re)=>e.jsxs("div",{className:"tm-worker-card-expanded",children:[e.jsxs("div",{className:"tm-worker-row-top",children:[e.jsx("input",{type:"text",placeholder:"First & Last Name",value:N.name,onChange:ce=>X(re,"name",ce.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>T(re),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"time",value:N.timeStarted,onChange:ce=>X(re,"timeStarted",ce.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"time",value:N.timeEnded,onChange:ce=>X(re,"timeEnded",ce.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"Reg Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.hours,onChange:ce=>X(re,"hours",ce.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:"OT Hrs"}),e.jsx("input",{type:"number",placeholder:"0",value:N.overtimeHours,onChange:ce=>X(re,"overtimeHours",ce.target.value)})]})]})]},re))}),e.jsx("button",{className:"tm-add-btn",onClick:Xe,children:"+ Add Laborer"})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Description of Work"}),e.jsx("textarea",{placeholder:"What work was performed today?",value:I,onChange:N=>P(N.target.value),rows:3,className:"tm-description"})]}),e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:[e.jsx(sr,{size:16,className:"inline-icon"})," Photos",o!==-1&&e.jsxs("span",{className:"tm-photo-count",children:["(",j.length,"/",o,")"]})]}),j.length>0&&e.jsx("div",{className:"tm-photo-grid",children:j.map(N=>e.jsxs("div",{className:"tm-photo-item",children:[e.jsx("img",{src:N.previewUrl,alt:N.name}),e.jsx("button",{className:"tm-photo-remove",onClick:()=>ut(N.id),children:""})]},N.id))}),(o===-1||j.length<o)&&e.jsxs("label",{className:"tm-photo-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:Rt,style:{display:"none"}}),e.jsx(sr,{size:16,className:"inline-icon"})," ",j.length>0?"Add More Photos":"Add Photos"]}),o!==-1&&j.length>=o&&e.jsxs("div",{className:"tm-photo-limit-reached",children:["Photo limit reached (",o," max)"]})]})]}),x===2&&!L&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"What was used?"}),e.jsx("div",{className:"tm-category-grid",children:xf.map(N=>{const re=Q.filter(ce=>ce.category===N);return e.jsxs("button",{className:"tm-category-card",onClick:()=>$(N),children:[e.jsx("span",{className:"tm-cat-name",children:N}),re.length>0&&e.jsx("span",{className:"tm-cat-count",children:re.length})]},N)})})]}),Q.length>0&&e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:["Added Items (",Q.length,")"]}),e.jsx("div",{className:"tm-added-list",children:Q.map((N,re)=>e.jsxs("div",{className:"tm-added-item",children:[e.jsxs("div",{className:"tm-added-info",children:[N.isCustom&&e.jsx("span",{className:"tm-custom-badge",children:"Custom"}),e.jsx("span",{className:"tm-added-name",children:N.name})]}),e.jsxs("div",{className:"tm-added-qty",children:[e.jsx("button",{onClick:()=>Pe(re,N.quantity-1),children:""}),e.jsx("span",{children:N.quantity}),e.jsx("button",{onClick:()=>Pe(re,N.quantity+1),children:"+"})]})]},re))})]})]}),x===3&&e.jsxs("div",{className:"tm-step-content",children:[e.jsx("div",{className:"tm-review-section",children:e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Date"}),e.jsx("span",{children:new Date(f).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]})}),I&&e.jsxs("div",{className:"tm-review-section",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(za,{size:16,className:"inline-icon"})," Description"]})}),e.jsx("div",{className:"tm-review-notes",children:I})]}),j.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(sr,{size:16,className:"inline-icon"})," Photos"]}),e.jsx("span",{children:j.length})]}),e.jsx("div",{className:"tm-review-photos",children:j.map(N=>e.jsx("img",{src:N.previewUrl,alt:N.name},N.id))})]}),tt.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(ev,{size:16,className:"inline-icon"})," Supervision"]}),e.jsxs("span",{children:[tt.reduce((N,re)=>N+parseFloat(re.hours||0)+parseFloat(re.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:tt.map((N,re)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsxs("div",{className:"tm-review-worker-name",children:[e.jsx("span",{className:"tm-role-badge",children:N.role})," ",N.name]}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},re))})]}),xt.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Operators"}),e.jsxs("span",{children:[xt.reduce((N,re)=>N+parseFloat(re.hours||0)+parseFloat(re.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:xt.map((N,re)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:N.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},re))})]}),jt.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(na,{size:16,className:"inline-icon"})," Laborers"]}),e.jsxs("span",{children:[jt.reduce((N,re)=>N+parseFloat(re.hours||0)+parseFloat(re.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:jt.map((N,re)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:N.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[N.timeStarted&&N.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[N.timeStarted," - ",N.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[N.hours||0," reg",parseFloat(N.overtimeHours)>0?` + ${N.overtimeHours} OT`:""]})]})]},re))})]}),Q.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(cr,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsxs("span",{children:[Q.length," items"]})]}),e.jsx("div",{className:"tm-review-list",children:Q.map((N,re)=>e.jsxs("div",{className:"tm-review-row",children:[e.jsxs("span",{children:[N.isCustom&&e.jsxs(e.Fragment,{children:[e.jsx(lv,{size:14,className:"inline-icon"})," "]}),N.name]}),e.jsxs("span",{children:[N.quantity," ",N.unit]})]},re))})]}),e.jsxs("div",{className:"tm-review-section tm-certification",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(dd,{size:16,className:"inline-icon"})," Submitted By"]})}),e.jsx("input",{type:"text",className:"tm-certification-input",placeholder:"Enter your name",value:Y,onChange:N=>B(N.target.value)}),e.jsx("p",{className:"tm-certification-note",children:"By submitting, you certify this T&M is accurate."})]})]}),e.jsxs("div",{className:"tm-wizard-footer",children:[x<3?e.jsx("button",{className:"tm-big-btn primary",onClick:Lt,disabled:x===1&&!Gt(),children:x===1?`Next: Materials (${ne} workers, ${Ne+pe} hrs)`:x===2?`Review (${Q.length} items)`:"Next"}):e.jsx("button",{className:"tm-big-btn submit",onClick:et,disabled:C,children:C?w||"Submitting...":" Submit T&M"}),x===2&&e.jsx("button",{className:"tm-skip-btn",onClick:Lt,children:"Skip (no materials)"})]})]})}function uv({project:l,onShowToast:i}){const[o,c]=p.useState([]),[m,u]=p.useState(!0),[x,g]=p.useState(!1),[f,v]=p.useState(!1),[y,A]=p.useState({name:"",role:"Laborer"});p.useEffect(()=>{Y()},[l.id]);const Y=async()=>{try{const z=await de.getCrewCheckin(l.id);z?.workers&&c(z.workers)}catch(z){console.error("Error loading crew:",z)}finally{u(!1)}},B=async()=>{if(!y.name.trim()){i("Enter worker name","error");return}if(o.find(z=>z.name.toLowerCase()===y.name.trim().toLowerCase())){i("Worker already added","error");return}g(!0);try{const z=[...o,{name:y.name.trim(),role:y.role}];await de.saveCrewCheckin(l.id,z),c(z),A({name:"",role:"Laborer"}),v(!1),i("Crew member added","success")}catch(z){console.error("Error adding worker:",z),i("Error adding crew member","error")}finally{g(!1)}},H=async z=>{g(!0);try{const K=o.filter(E=>E.name.toLowerCase()!==z.toLowerCase());await de.saveCrewCheckin(l.id,K),c(K),i("Crew member removed","success")}catch(K){console.error("Error removing worker:",K),i("Error removing crew member","error")}finally{g(!1)}},U=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"});return m?e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(na,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:U})]}),e.jsx("div",{className:"crew-loading",children:"Loading..."})]}):e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(na,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:U})]}),o.length===0?e.jsxs("div",{className:"crew-empty",children:[e.jsx("p",{children:"No crew checked in yet"}),e.jsx("p",{className:"crew-empty-hint",children:"Add your crew for the day"})]}):e.jsx("div",{className:"crew-list",children:o.map(z=>e.jsxs("div",{className:"crew-member",children:[e.jsxs("div",{className:"crew-member-info",children:[e.jsx("span",{className:"crew-member-name",children:z.name}),e.jsx("span",{className:`crew-member-role ${z.role.toLowerCase()}`,children:z.role})]}),e.jsx("button",{className:"crew-remove-btn",onClick:()=>H(z.name),disabled:x,children:""})]},z.name))}),f?e.jsxs("div",{className:"crew-add-form",children:[e.jsx("input",{type:"text",value:y.name,onChange:z=>A({...y,name:z.target.value}),placeholder:"Name",autoFocus:!0}),e.jsxs("select",{value:y.role,onChange:z=>A({...y,role:z.target.value}),children:[e.jsx("option",{value:"Foreman",children:"Foreman"}),e.jsx("option",{value:"Laborer",children:"Laborer"}),e.jsx("option",{value:"Supervisor",children:"Supervisor"}),e.jsx("option",{value:"Operator",children:"Operator"})]}),e.jsxs("div",{className:"crew-add-buttons",children:[e.jsx("button",{className:"crew-add-confirm",onClick:B,disabled:x,children:x?"...":"Add"}),e.jsx("button",{className:"crew-add-cancel",onClick:()=>{v(!1),A({name:"",role:"Laborer"})},children:"Cancel"})]})]}):e.jsx("button",{className:"crew-add-btn",onClick:()=>v(!0),children:"+ Add Crew Member"}),e.jsxs("div",{className:"crew-count",children:[o.length," ",o.length===1?"person":"people"," on site"]})]})}function mv({project:l,onShowToast:i,onClose:o}){const[c,m]=p.useState(!0),[u,x]=p.useState(!1),[g,f]=p.useState(null),[v,y]=p.useState(""),[A,Y]=p.useState("");p.useEffect(()=>{B()},[l.id]);const B=async()=>{try{const K=await de.getDailyReport(l.id);if(K)f(K),y(K.field_notes||""),Y(K.issues||"");else{const E=await de.compileDailyReport(l.id);f({...E,status:"draft"})}}catch(K){console.error("Error loading report:",K),i("Error loading report","error")}finally{m(!1)}},H=async()=>{if(!J){i("Demo Mode: Report saved locally only - won't reach office","info"),o();return}x(!0);try{await de.saveDailyReport(l.id,{field_notes:v,issues:A}),await de.submitDailyReport(l.id,"Field")?(i("Daily report submitted!","success"),o()):i("Report not sent - check connection","error")}catch(K){console.error("Error submitting report:",K),i("Error submitting report","error")}finally{x(!1)}},U=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});if(c)return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),e.jsx("h2",{children:"Daily Report"})]}),e.jsx("div",{className:"daily-report-loading",children:"Compiling report..."})]});const z=g?.status==="submitted";return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),e.jsxs("div",{children:[e.jsx("h2",{children:"Daily Report"}),e.jsx("p",{className:"daily-report-date",children:U})]})]}),z&&e.jsxs("div",{className:"daily-report-submitted-banner",children:[" Submitted ",new Date(g.submitted_at).toLocaleTimeString()]}),e.jsxs("div",{className:"daily-report-content",children:[e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.crew_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.tasks_completed||0}),e.jsx("div",{className:"daily-report-card-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.tm_tickets_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:g.photos_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Photos"})]})]}),g.crew_list?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(na,{size:18,className:"inline-icon"})," Crew"]}),e.jsx("div",{className:"daily-report-crew",children:g.crew_list.map((K,E)=>e.jsxs("div",{className:"daily-report-crew-item",children:[e.jsx("span",{children:K.name}),e.jsx("span",{className:"daily-report-crew-role",children:K.role})]},E))})]}),g.completed_tasks?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Qa,{size:18,className:"inline-icon"})," Completed Today"]}),e.jsx("ul",{className:"daily-report-tasks",children:g.completed_tasks.map((K,E)=>e.jsxs("li",{children:[K.name,K.group&&e.jsx("span",{className:"daily-report-task-group",children:K.group})]},E))})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(za,{size:18,className:"inline-icon"})," Notes"]}),e.jsx("textarea",{value:v,onChange:K=>y(K.target.value),placeholder:"Any notes about today's work...",rows:3,disabled:z})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Ti,{size:18,className:"inline-icon"})," Issues / Concerns"]}),e.jsx("textarea",{value:A,onChange:K=>Y(K.target.value),placeholder:"Any problems, delays, or concerns...",rows:3,disabled:z})]})]}),!z&&e.jsxs("div",{className:"daily-report-footer",children:[e.jsx("button",{className:"btn btn-primary daily-report-submit",onClick:H,disabled:u,children:u?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(Kj,{size:16,className:"inline-icon"})," Submit Report"]})}),e.jsx("p",{className:"daily-report-hint",children:"This will be sent to the office"})]})]})}function hv({project:l,viewerType:i,viewerName:o,onShowToast:c,onClose:m}){const[u,x]=p.useState([]),[g,f]=p.useState(!0),[v,y]=p.useState(!1),[A,Y]=p.useState(""),B=p.useRef(null);p.useEffect(()=>{H(),de.markMessagesRead(l.id,i)},[l.id]),p.useEffect(()=>{B.current?.scrollIntoView({behavior:"smooth"})},[u]);const H=async()=>{try{const E=await de.getMessages(l.id);x(E.reverse())}catch(E){console.error("Error loading messages:",E)}finally{f(!1)}},U=async()=>{if(A.trim()){if(!J){c("Demo Mode: Messages won't sync to other users","info");const E={id:Date.now(),project_id:l.id,message:A.trim(),sender_type:i,sender_name:o,created_at:new Date().toISOString()};x([...u,E]),Y("");return}y(!0);try{const E=await de.sendMessage(l.id,A.trim(),i,o);E?(x([...u,E]),Y("")):c("Message not sent - check connection","error")}catch(E){console.error("Error sending message:",E),c("Error sending message","error")}finally{y(!1)}}},z=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),U())},K=E=>{const D=new Date(E),S=new Date;return D.toDateString()===S.toDateString()?D.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):D.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})};return e.jsxs("div",{className:"messages-container",children:[e.jsxs("div",{className:"messages-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:m,children:""}),e.jsxs("div",{children:[e.jsx("h2",{children:"Messages"}),e.jsx("p",{className:"messages-project",children:l.name})]})]}),e.jsxs("div",{className:"messages-list",children:[g?e.jsx("div",{className:"messages-loading",children:"Loading..."}):u.length===0?e.jsxs("div",{className:"messages-empty",children:[e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"messages-empty-hint",children:i==="field"?"Messages from the office will appear here":"Send a message to the field crew"})]}):u.map(E=>e.jsx("div",{className:`message ${E.sender_type===i?"sent":"received"}`,children:e.jsxs("div",{className:"message-bubble",children:[e.jsxs("div",{className:"message-sender",children:[E.sender_type==="office"?e.jsx(rl,{size:14,className:"inline-icon"}):e.jsx(na,{size:14,className:"inline-icon"})," ",E.sender_name]}),e.jsx("div",{className:"message-text",children:E.message}),E.photo_url&&e.jsx("img",{src:E.photo_url,alt:"Attached",className:"message-photo"}),e.jsx("div",{className:"message-time",children:K(E.created_at)})]})},E.id)),e.jsx("div",{ref:B})]}),e.jsxs("div",{className:"messages-input-container",children:[e.jsx("textarea",{value:A,onChange:E=>Y(E.target.value),onKeyDown:z,placeholder:"Type a message...",rows:1,disabled:v}),e.jsx("button",{className:"messages-send-btn",onClick:U,disabled:v||!A.trim(),children:v?"...":""})]})]})}function fv({project:l,requestedBy:i,onShowToast:o,onClose:c}){const[m,u]=p.useState([{name:"",quantity:"",unit:"each"}]),[x,g]=p.useState(""),[f,v]=p.useState("normal"),[y,A]=p.useState(""),[Y,B]=p.useState(!1),H=()=>{u([...m,{name:"",quantity:"",unit:"each"}])},U=(E,D,S)=>{u(m.map((te,se)=>se===E?{...te,[D]:S}:te))},z=E=>{m.length>1&&u(m.filter((D,S)=>S!==E))},K=async()=>{const E=m.filter(D=>D.name.trim()&&parseFloat(D.quantity)>0);if(E.length===0){o("Add at least one item with quantity","error");return}if(!J){o("Demo Mode: Request saved locally only - won't reach office","info"),c();return}B(!0);try{await de.createMaterialRequest(l.id,E,i,x||null,f,y||null)?(o("Request submitted!","success"),c()):o("Request not sent - check connection","error")}catch(D){console.error("Error submitting request:",D),o("Error submitting request","error")}finally{B(!1)}};return e.jsxs("div",{className:"material-request",children:[e.jsxs("div",{className:"material-request-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsx("h2",{children:"Request Materials"})]}),e.jsxs("div",{className:"material-request-content",children:[e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"What do you need?"}),m.map((E,D)=>e.jsxs("div",{className:"material-request-item",children:[e.jsx("input",{type:"text",placeholder:"Item name",value:E.name,onChange:S=>U(D,"name",S.target.value),className:"material-request-name"}),e.jsx("input",{type:"number",placeholder:"Qty",value:E.quantity,onChange:S=>U(D,"quantity",S.target.value),className:"material-request-qty"}),e.jsxs("select",{value:E.unit,onChange:S=>U(D,"unit",S.target.value),className:"material-request-unit",children:[e.jsx("option",{value:"each",children:"each"}),e.jsx("option",{value:"rolls",children:"rolls"}),e.jsx("option",{value:"boxes",children:"boxes"}),e.jsx("option",{value:"bags",children:"bags"}),e.jsx("option",{value:"sheets",children:"sheets"}),e.jsx("option",{value:"gallons",children:"gal"}),e.jsx("option",{value:"feet",children:"ft"}),e.jsx("option",{value:"lbs",children:"lbs"})]}),e.jsx("button",{className:"material-request-remove",onClick:()=>z(D),children:""})]},D)),e.jsx("button",{className:"material-request-add",onClick:H,children:"+ Add Another Item"})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Priority"}),e.jsx("div",{className:"material-request-priority",children:["low","normal","urgent"].map(E=>e.jsxs("button",{className:`priority-btn ${f===E?"active":""} ${E}`,onClick:()=>v(E),children:[E==="urgent"&&" ",E==="normal"&&" ",E==="low"&&" ",E.charAt(0).toUpperCase()+E.slice(1)]},E))})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Needed By (optional)"}),e.jsx("input",{type:"date",value:x,onChange:E=>g(E.target.value),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Notes (optional)"}),e.jsx("textarea",{value:y,onChange:E=>A(E.target.value),placeholder:"Any additional details...",rows:2})]})]}),e.jsx("div",{className:"material-request-footer",children:e.jsx("button",{className:"btn btn-primary",onClick:K,disabled:Y,children:Y?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(Za,{size:16,className:"inline-icon"})," Submit Request"]})})})]})}const pv=p.createContext({}),Kf=()=>p.useContext(pv);function Zs({message:l,type:i="",onClose:o}){return p.useEffect(()=>{const c=setTimeout(o,3e3);return()=>clearTimeout(c)},[o]),e.jsx("div",{className:"toast-container",children:e.jsx("div",{className:`toast ${i}`,children:l})})}function Wf({project:l,companyId:i,onClose:o,onReportCreated:c}){const{user:m}=Kf(),[u,x]=p.useState(!1),[g,f]=p.useState(null),[v,y]=p.useState(1),[A,Y]=p.useState(new Date().toISOString().split("T")[0]),[B,H]=p.useState(new Date().toTimeString().split(" ")[0].substring(0,5)),[U,z]=p.useState(""),[K,E]=p.useState(""),[D,S]=p.useState("minor"),[te,se]=p.useState(""),[Z,Q]=p.useState(""),[F,I]=p.useState(""),[P,j]=p.useState(""),[_,C]=p.useState(""),[ee,w]=p.useState(""),[k,M]=p.useState(""),[he,V]=p.useState(m?.name||""),[q,L]=p.useState(""),[$,xe]=p.useState(""),[be,Fe]=p.useState(m?.email||""),[ye,We]=p.useState([]),[Ve,De]=p.useState(""),[nt,Vt]=p.useState(""),[ke,ze]=p.useState(""),[Ae,Me]=p.useState(""),[Ce,Xe]=p.useState(!1),[X,T]=p.useState(""),[_e,Ee]=p.useState(""),[ae,Se]=p.useState(!1),[ct,Pe]=p.useState(""),[Ut,Rt]=p.useState(""),[ut,Gt]=p.useState(""),[Lt,Et]=p.useState(""),[et,tt]=p.useState(!1),[xt,jt]=p.useState(!1),[ne,Ne]=p.useState(0),[pe,N]=p.useState(0),re=()=>{if(!Ve.trim()){f({type:"error",message:"Please enter witness name"});return}const je={name:Ve,phone:nt,email:ke,testimony:Ae};We([...ye,je]),De(""),Vt(""),ze(""),Me(""),f({type:"success",message:"Witness added"})},ce=je=>{We(ye.filter((lt,pt)=>pt!==je))},ue=je=>{switch(je){case 1:if(!U.trim()||!K.trim())return f({type:"error",message:"Please fill in all incident details"}),!1;break;case 2:if(!Z.trim()||!ee.trim())return f({type:"error",message:"Please fill in employee name and job title"}),!1;break;case 3:if(!he.trim()||!q.trim())return f({type:"error",message:"Please fill in supervisor name and title"}),!1;break}return!0},Oe=()=>{ue(v)&&y(v+1)},Qe=()=>{y(v-1)},Te=async()=>{if(ue(v)){if(!J){f({type:"info",message:"Demo Mode: Report saved locally only - won't reach office"}),setTimeout(()=>{o()},1500);return}x(!0);try{const je={project_id:l.id,company_id:i,incident_date:A,incident_time:B,incident_location:U,incident_description:K,injury_type:D,body_part_affected:te||null,employee_name:Z,employee_phone:F||null,employee_email:P||null,employee_address:_||null,employee_job_title:ee,employee_hire_date:k||null,medical_treatment_required:Ce,medical_facility_name:X||null,medical_facility_address:_e||null,hospitalized:ae,reported_by_name:he,reported_by_title:q,reported_by_phone:$||null,reported_by_email:be||null,witnesses:ye,immediate_actions_taken:ct||null,corrective_actions_planned:Ut||null,safety_equipment_used:ut||null,safety_equipment_failed:Lt||null,osha_recordable:et,workers_comp_claim:xt,days_away_from_work:parseInt(ne)||0,restricted_work_days:parseInt(pe)||0,status:"reported",created_by:m?.id},lt=await de.createInjuryReport(je);f({type:"success",message:"Injury report submitted successfully"}),c&&c(lt),setTimeout(()=>{o()},1500)}catch(je){console.error("Error submitting injury report:",je),f({type:"error",message:"Failed to submit injury report"})}finally{x(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:o,children:e.jsxs("div",{className:"modal-content injury-report-modal",onClick:je=>je.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Workplace Injury/Incident Report"}),e.jsx("button",{className:"close-btn",onClick:o,children:""})]}),e.jsxs("div",{className:"progress-steps",children:[e.jsx("div",{className:`step ${v>=1?"active":""}`,children:"1. Incident"}),e.jsx("div",{className:`step ${v>=2?"active":""}`,children:"2. Employee"}),e.jsx("div",{className:`step ${v>=3?"active":""}`,children:"3. Supervisor"}),e.jsx("div",{className:`step ${v>=4?"active":""}`,children:"4. Witnesses"}),e.jsx("div",{className:`step ${v>=5?"active":""}`,children:"5. Medical & Safety"})]}),e.jsxs("div",{className:"modal-body",children:[v===1&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Incident Details"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date of Incident *"}),e.jsx("input",{type:"date",value:A,onChange:je=>Y(je.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Time of Incident *"}),e.jsx("input",{type:"time",value:B,onChange:je=>H(je.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Location on Site *"}),e.jsx("input",{type:"text",value:U,onChange:je=>z(je.target.value),placeholder:"e.g., Floor 2, near elevator shaft"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Incident Description *"}),e.jsx("textarea",{value:K,onChange:je=>E(je.target.value),rows:4,placeholder:"Describe what happened in detail..."})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Injury Type *"}),e.jsxs("select",{value:D,onChange:je=>S(je.target.value),children:[e.jsx("option",{value:"minor",children:"Minor Injury"}),e.jsx("option",{value:"serious",children:"Serious Injury"}),e.jsx("option",{value:"critical",children:"Critical Injury"}),e.jsx("option",{value:"near_miss",children:"Near Miss (No Injury)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("input",{type:"text",value:te,onChange:je=>se(je.target.value),placeholder:"e.g., Left hand, lower back"})]})]})]}),v===2&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Injured Employee Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:Z,onChange:je=>Q(je.target.value),placeholder:"First and last name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:F,onChange:je=>I(je.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:P,onChange:je=>j(je.target.value),placeholder:"email@example.com"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Home Address"}),e.jsx("input",{type:"text",value:_,onChange:je=>C(je.target.value),placeholder:"Street address, city, state, zip"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Title *"}),e.jsx("input",{type:"text",value:ee,onChange:je=>w(je.target.value),placeholder:"e.g., Carpenter, Electrician"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Hire Date"}),e.jsx("input",{type:"date",value:k,onChange:je=>M(je.target.value)})]})]})]}),v===3&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Foreman/Supervisor Making Report"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Name *"}),e.jsx("input",{type:"text",value:he,onChange:je=>V(je.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Title *"}),e.jsx("input",{type:"text",value:q,onChange:je=>L(je.target.value),placeholder:"e.g., Site Foreman, Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Phone Number"}),e.jsx("input",{type:"tel",value:$,onChange:je=>xe(je.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Email Address"}),e.jsx("input",{type:"email",value:be,onChange:je=>Fe(je.target.value),placeholder:"email@example.com"})]})]}),v===4&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Witness Testimonies (Optional)"}),ye.length>0&&e.jsx("div",{className:"witnesses-list",children:ye.map((je,lt)=>e.jsxs("div",{className:"witness-item",children:[e.jsxs("div",{className:"witness-info",children:[e.jsx("strong",{children:je.name}),je.phone&&e.jsxs("span",{children:["  ",je.phone]}),je.testimony&&e.jsxs("p",{className:"witness-testimony",children:['"',je.testimony,'"']})]}),e.jsx("button",{className:"btn-danger btn-small",onClick:()=>ce(lt),children:"Remove"})]},lt))}),e.jsxs("div",{className:"add-witness-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Name"}),e.jsx("input",{type:"text",value:Ve,onChange:je=>De(je.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:nt,onChange:je=>Vt(je.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:ke,onChange:je=>ze(je.target.value),placeholder:"email@example.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Testimony"}),e.jsx("textarea",{value:Ae,onChange:je=>Me(je.target.value),rows:3,placeholder:"What did the witness see or hear?"})]}),e.jsx("button",{className:"btn-secondary",onClick:re,children:"+ Add Witness"})]})]}),v===5&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Medical Treatment & Safety"}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Ce,onChange:je=>Xe(je.target.checked)}),"Medical treatment required"]})}),Ce&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Name"}),e.jsx("input",{type:"text",value:X,onChange:je=>T(je.target.value),placeholder:"Hospital or clinic name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Address"}),e.jsx("input",{type:"text",value:_e,onChange:je=>Ee(je.target.value),placeholder:"Street address"})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:ae,onChange:je=>Se(je.target.checked)}),"Employee was hospitalized"]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("textarea",{value:ct,onChange:je=>Pe(je.target.value),rows:2,placeholder:"What was done immediately after the incident?"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("textarea",{value:Ut,onChange:je=>Rt(je.target.value),rows:2,placeholder:"What will be done to prevent this in the future?"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("input",{type:"text",value:ut,onChange:je=>Gt(je.target.value),placeholder:"e.g., Hard hat, gloves, harness"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("input",{type:"text",value:Lt,onChange:je=>Et(je.target.value),placeholder:"Equipment that failed, if any"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("input",{type:"number",min:"0",value:ne,onChange:je=>Ne(je.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("input",{type:"number",min:"0",value:pe,onChange:je=>N(je.target.value)})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:et,onChange:je=>tt(je.target.checked)}),"OSHA Recordable Incident"]})}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:xt,onChange:je=>jt(je.target.checked)}),"Workers' Compensation Claim Filed"]})})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"form-actions",children:[v>1&&e.jsx("button",{className:"btn-secondary",onClick:Qe,children:" Back"}),e.jsx("button",{className:"btn-secondary",onClick:o,children:"Cancel"}),v<5?e.jsx("button",{className:"btn-primary",onClick:Oe,children:"Next "}):e.jsx("button",{className:"btn-primary",onClick:Te,disabled:u,children:u?"Submitting...":"Submit Report"})]})})]})}),g&&e.jsx(Zs,{message:g.message,type:g.type,onClose:()=>f(null)}),e.jsx("style",{children:`
        .injury-report-modal {
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid var(--border-color);
          background-color: var(--bg-elevated);
          overflow-x: auto;
        }

        .progress-steps .step {
          font-size: 0.875rem;
          color: var(--text-muted);
          font-weight: 500;
          white-space: nowrap;
          padding: 0.5rem;
        }

        .progress-steps .step.active {
          color: var(--accent-primary);
          font-weight: 600;
        }

        .form-step h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          color: var(--text-primary);
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 1rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-group textarea {
          resize: vertical;
        }

        .checkbox-group label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: normal;
          cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
          width: auto;
          margin: 0;
        }

        .witnesses-list {
          margin-bottom: 1.5rem;
        }

        .witness-item {
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .witness-info {
          flex: 1;
          color: var(--text-primary);
        }

        .witness-testimony {
          margin-top: 0.5rem;
          color: var(--text-secondary);
          font-style: italic;
          font-size: 0.875rem;
        }

        .add-witness-form {
          border: 2px dashed var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          background-color: var(--bg-elevated);
        }

        .modal-footer {
          border-top: 1px solid var(--border-color);
          padding: 1rem 1.5rem;
        }

        .form-actions {
          display: flex;
          justify-content: space-between;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
        }

        @media (max-width: 768px) {
          .injury-report-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }

          .form-row {
            grid-template-columns: 1fr;
          }

          .progress-steps .step {
            font-size: 0.75rem;
            padding: 0.25rem;
          }
        }
      `})]})}const jf=[{id:"trash",label:"Trash",description:"General debris"},{id:"metal",label:"Metal",description:"Scrap metal (recyclable)"},{id:"copper",label:"Copper",description:"Copper scrap (recyclable)"},{id:"concrete",label:"Concrete",description:"Concrete/masonry"},{id:"hazardous",label:"Hazardous",description:"Hazardous materials"}];function gv({project:l,companyId:i,onClose:o,onSubmit:c,onShowToast:m}){const[u,x]=p.useState(!1),[g,f]=p.useState([]),[v,y]=p.useState(!0),[A,Y]=p.useState(new Date().toISOString().split("T")[0]),[B,H]=p.useState("trash"),[U,z]=p.useState(1),[K,E]=p.useState(""),[D,S]=p.useState(l.default_dump_site_id||""),[te,se]=p.useState(""),[Z,Q]=p.useState(null),[F,I]=p.useState(null);p.useEffect(()=>{P()},[i]),p.useEffect(()=>{j()},[D,B,U,g]);const P=async()=>{try{const k=await de.getDumpSites(i);f(k||[]),l.default_dump_site_id?S(l.default_dump_site_id):k&&k.length>0&&S(k[0].id)}catch(k){console.error("Error loading dump sites:",k)}finally{y(!1)}},j=()=>{if(!D||!B||!U){Q(null),I(null);return}const k=g.find(he=>he.id===D);if(!k||!k.dump_site_rates){Q(null),I(null);return}const M=k.dump_site_rates.find(he=>he.waste_type===B);if(M&&M.estimated_cost_per_load!==null){const he=parseFloat(M.estimated_cost_per_load);I(he),Q(he*parseInt(U))}else Q(null),I(null)},_=k=>k==null?"--":k<0?`-$${Math.abs(k).toFixed(0)}`:`$${k.toFixed(0)}`,C=async k=>{if(k.preventDefault(),!D){m("Please select a dump site","error");return}if(!U||U<1){m("Please enter number of loads","error");return}x(!0);try{await de.createHaulOff(l.id,{dump_site_id:D,waste_type:B,loads:parseInt(U),hauling_company:K.trim()||null,work_date:A,notes:te.trim()||null,estimated_cost:Z,created_by:"Field"}),m("Haul-off logged successfully","success"),c&&c(),o()}catch(M){console.error("Error logging haul-off:",M),m("Error logging haul-off","error")}finally{x(!1)}},ee=g.find(k=>k.id===D),w=jf.find(k=>k.id===B);return e.jsxs("div",{className:"hauloff-form-container",children:[e.jsxs("div",{className:"hauloff-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),e.jsx("h2",{children:"Log Haul-Off"})]}),e.jsxs("form",{onSubmit:C,className:"hauloff-form",children:[e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:A,onChange:k=>Y(k.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Waste Type"}),e.jsx("div",{className:"waste-type-grid",children:jf.map(k=>e.jsxs("button",{type:"button",className:`waste-type-btn ${B===k.id?"active":""} ${k.id==="metal"||k.id==="copper"?"recyclable":""}`,onClick:()=>H(k.id),children:[e.jsx("span",{className:"waste-label",children:k.label}),(k.id==="metal"||k.id==="copper")&&e.jsx("span",{className:"waste-badge",children:"$"})]},k.id))})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Number of Loads"}),e.jsxs("div",{className:"loads-input-row",children:[e.jsx("button",{type:"button",className:"loads-btn",onClick:()=>z(Math.max(1,U-1)),children:""}),e.jsx("input",{type:"number",value:U,onChange:k=>z(Math.max(1,parseInt(k.target.value)||1)),min:"1",className:"loads-input"}),e.jsx("button",{type:"button",className:"loads-btn",onClick:()=>z(U+1),children:"+"})]})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Dump Site"}),v?e.jsx("div",{className:"loading-inline",children:"Loading sites..."}):g.length===0?e.jsx("div",{className:"no-sites-warning",children:"No dump sites configured. Ask office to add dump sites."}):e.jsxs("select",{value:D,onChange:k=>S(k.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),g.map(k=>e.jsx("option",{value:k.id,children:k.name},k.id))]}),ee?.address&&e.jsx("span",{className:"field-hint",children:ee.address})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Hauling Company (Optional)"}),e.jsx("input",{type:"text",value:K,onChange:k=>E(k.target.value),placeholder:"e.g., ABC Trucking"})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Notes (Optional)"}),e.jsx("textarea",{value:te,onChange:k=>se(k.target.value),placeholder:"Any additional notes...",rows:2})]}),e.jsxs("div",{className:"hauloff-estimate",children:[e.jsx("div",{className:"estimate-header",children:"Estimated Cost"}),Z!==null?e.jsxs("div",{className:`estimate-value ${Z<0?"revenue":""}`,children:[e.jsx("span",{className:"estimate-amount",children:_(Z)}),e.jsxs("span",{className:"estimate-breakdown",children:[_(F),"/load  ",U," load",U>1?"s":""]}),Z<0&&e.jsx("span",{className:"estimate-note revenue-note",children:"Revenue from recyclables"})]}):e.jsxs("div",{className:"estimate-value",children:[e.jsx("span",{className:"estimate-amount",children:"--"}),e.jsx("span",{className:"estimate-breakdown",children:D?ee?.dump_site_rates?.find(k=>k.waste_type===B)?"Unable to calculate":`No rate set for ${w?.label||B}`:"Select a dump site"})]}),e.jsx("div",{className:"estimate-disclaimer",children:"This is an estimate for burn rate tracking, not an invoice amount."})]}),e.jsxs("div",{className:"hauloff-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:o,disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:u||!D,children:u?"Saving...":"Log Haul-Off"})]})]})]})}function xv({project:l,companyId:i,onShowToast:o,onExit:c}){const[m,u]=p.useState([]),[x,g]=p.useState(!0),[f,v]=p.useState(null),[y,A]=p.useState({}),[Y,B]=p.useState(!1),[H,U]=p.useState(!0),[z,K]=p.useState(!1),[E,D]=p.useState(!1),[S,te]=p.useState(!1),[se,Z]=p.useState(!1),[Q,F]=p.useState(!1),[I,P]=p.useState(!1),[j,_]=p.useState(0);p.useEffect(()=>{C(),ee()},[l.id]);const C=async()=>{try{const be=await de.getAreas(l.id);u(be);const Fe=[...new Set(be.map(We=>We.group_name||"General"))],ye={};Fe.forEach(We=>ye[We]=!1),A(ye)}catch(be){console.error("Error loading areas:",be),o("Error loading areas","error")}finally{g(!1)}},ee=async()=>{const be=await de.getUnreadCount(l.id,"field");_(be)},w=async(be,Fe)=>{const ye=m.find(Ve=>Ve.id===be);if(!ye)return;const We=ye.status===Fe?"not_started":Fe;v(be);try{await de.updateAreaStatus(be,We),u(Ve=>Ve.map(De=>De.id===be?{...De,status:We}:De)),o("Updated","success")}catch(Ve){console.error("Error updating status:",Ve),o("Error updating","error")}finally{v(null)}},k=be=>{A(Fe=>({...Fe,[be]:!Fe[be]}))};if(x)return e.jsx("div",{className:"foreman-container",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading..."]})});if(Y)return e.jsx("div",{className:"foreman-container",children:e.jsx(dv,{project:l,companyId:i,onSubmit:()=>B(!1),onCancel:()=>B(!1),onShowToast:o})});if(z)return e.jsx(mv,{project:l,onShowToast:o,onClose:()=>K(!1)});if(E)return e.jsx(hv,{project:l,viewerType:"field",viewerName:"Field",onShowToast:o,onClose:()=>{D(!1),ee()}});if(S)return e.jsx(fv,{project:l,requestedBy:"Field",onShowToast:o,onClose:()=>te(!1)});if(se)return e.jsx("div",{className:"foreman-container",children:e.jsx(Wf,{project:l,companyId:i,onClose:()=>Z(!1),onReportCreated:()=>{Z(!1),o("Injury report submitted","success")}})});if(Q)return e.jsx("div",{className:"foreman-container",children:e.jsx(gv,{project:l,companyId:i,onClose:()=>F(!1),onSubmit:()=>F(!1),onShowToast:o})});const M=iv(m),he=m.reduce((be,Fe)=>{const ye=Fe.group_name||"General";return be[ye]||(be[ye]=[]),be[ye].push(Fe),be},{}),V=Object.keys(he).length>1||Object.keys(he).length===1&&!he.General,q=be=>`${be.filter(ye=>ye.status==="done").length}/${be.length}`,L=m.filter(be=>be.status==="done").length,$=m.filter(be=>be.status==="working").length,xe=m.length-L;return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsxs("div",{className:"foreman-header-info",children:[e.jsx("div",{className:"foreman-project-name",children:l.name}),e.jsxs("div",{className:"foreman-progress",children:[M,"% Complete"]})]}),e.jsx("button",{className:"foreman-info-btn",onClick:()=>P(!I),children:e.jsx(id,{size:20})})]}),I&&e.jsxs("div",{className:"foreman-project-info",children:[l.job_number&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Job #"}),e.jsx("span",{className:"foreman-info-value",children:l.job_number})]}),l.address&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Address"}),e.jsx("span",{className:"foreman-info-value",children:l.address})]}),l.general_contractor&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"GC / Client"}),e.jsx("span",{className:"foreman-info-value",children:l.general_contractor})]}),l.client_contact&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Contact"}),e.jsx("span",{className:"foreman-info-value",children:l.client_contact})]}),l.client_phone&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Phone"}),e.jsx("a",{href:`tel:${l.client_phone}`,className:"foreman-info-value foreman-info-link",children:l.client_phone})]})]}),e.jsxs("div",{className:"foreman-stats",children:[e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value working",children:$}),e.jsx("div",{className:"foreman-stat-label",children:"Working"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value done",children:L}),e.jsx("div",{className:"foreman-stat-label",children:"Done"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value remaining",children:xe}),e.jsx("div",{className:"foreman-stat-label",children:"Remaining"})]})]}),e.jsxs("div",{className:"field-actions",children:[e.jsxs("button",{className:"field-action-btn",onClick:()=>B(!0),children:[e.jsx(za,{size:20,className:"icon"}),"T&M Ticket"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>D(!0),children:[e.jsx(fs,{size:20,className:"icon"}),"Messages",j>0&&e.jsx("span",{className:"badge",children:j})]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>te(!0),children:[e.jsx(Za,{size:20,className:"icon"}),"Materials"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>K(!0),children:[e.jsx(Ra,{size:20,className:"icon"}),"Daily Report"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>F(!0),children:[e.jsx(bn,{size:20,className:"icon"}),"Haul-Off"]}),e.jsxs("button",{className:"field-action-btn danger",onClick:()=>Z(!0),children:[e.jsx(Ti,{size:20,className:"icon"}),"Report Injury"]})]}),e.jsx(uv,{project:l,onShowToast:o}),e.jsx("div",{className:"foreman-areas",children:V?Object.entries(he).map(([be,Fe])=>e.jsxs("div",{className:"foreman-group",children:[e.jsxs("div",{className:"foreman-group-header",onClick:()=>k(be),children:[e.jsxs("div",{className:"foreman-group-title",children:[e.jsx("span",{className:"foreman-group-arrow",children:y[be]?"":""}),e.jsx("span",{className:"foreman-group-name",children:be})]}),e.jsx("span",{className:"foreman-group-progress",children:q(Fe)})]}),y[be]&&e.jsx("div",{className:"foreman-group-tasks",children:Fe.map(ye=>e.jsxs("div",{className:`foreman-area-card ${ye.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:ye.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${ye.status==="working"?"active":""}`,onClick:()=>w(ye.id,"working"),disabled:f===ye.id,children:f===ye.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${ye.status==="done"?"active":""}`,onClick:()=>w(ye.id,"done"),disabled:f===ye.id,children:f===ye.id?"...":"Done"})]})]},ye.id))})]},be)):m.map(be=>e.jsxs("div",{className:`foreman-area-card ${be.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:be.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${be.status==="working"?"active":""}`,onClick:()=>w(be.id,"working"),disabled:f===be.id,children:f===be.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${be.status==="done"?"active":""}`,onClick:()=>w(be.id,"done"),disabled:f===be.id,children:f===be.id?"...":"Done"})]})]},be.id))}),m.length===0&&e.jsxs("div",{className:"foreman-empty",children:[e.jsx(Ra,{size:48,className:"foreman-empty-icon"}),e.jsx("div",{className:"foreman-empty-text",children:"No areas yet"}),e.jsx("div",{className:"foreman-empty-subtext",children:"Office needs to add areas to this project"})]})]})}const vf=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";function ep({documentType:l,documentId:i,companyId:o,projectId:c,documentTitle:m="",onClose:u,onShowToast:x}){const[g,f]=p.useState(!0),[v,y]=p.useState(!1),[A,Y]=p.useState([]),[B,H]=p.useState(null),[U,z]=p.useState(!1),[K,E]=p.useState("never");p.useEffect(()=>{D()},[l,i]);const D=async()=>{try{f(!0);const F=await de.getSignatureRequestsForDocument(l,i);Y(F||[])}catch(F){console.error("Error loading signature requests:",F)}finally{f(!1)}},S=async()=>{try{y(!0);let F=null;if(K!=="never"){const P=parseInt(K);F=new Date,F.setDate(F.getDate()+P),F=F.toISOString()}const I=await de.createSignatureRequest(l,i,o,c,null,F);if(I){const P=`${window.location.origin}/sign/${I.signature_token}`;H(P),await D(),x?.("Signature link created","success")}}catch(F){console.error("Error generating signature link:",F),x?.("Failed to create signature link","error")}finally{y(!1)}},te=async F=>{try{await navigator.clipboard.writeText(F),z(!0),x?.("Link copied to clipboard","success"),setTimeout(()=>z(!1),2e3)}catch(I){console.error("Error copying to clipboard:",I)}},se=async F=>{if(confirm("Are you sure you want to revoke this signature link? It will no longer be usable."))try{await de.revokeSignatureRequest(F),await D(),x?.("Signature link revoked","success")}catch(I){console.error("Error revoking signature request:",I),x?.("Failed to revoke link","error")}},Z=F=>{switch(F){case"pending":return{label:"Awaiting Signatures",color:"#f59e0b",bg:"#fef3c7"};case"partially_signed":return{label:"1 of 2 Signed",color:"#3b82f6",bg:"#dbeafe"};case"completed":return{label:"Fully Signed",color:"#10b981",bg:"#d1fae5"};case"revoked":return{label:"Revoked",color:"#ef4444",bg:"#fee2e2"};case"expired":return{label:"Expired",color:"#6b7280",bg:"#f3f4f6"};default:return{label:F,color:"#6b7280",bg:"#f3f4f6"}}},Q=l==="cor"?"Change Order":"T&M Ticket";return e.jsx("div",{className:"modal-overlay",onClick:u,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content signature-link-modal",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Get Signature Link"}),m&&e.jsx("span",{className:"modal-subtitle",children:m})]}),e.jsx("button",{className:"close-btn",onClick:u,"aria-label":"Close",children:e.jsx(_n,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(od,{size:16}),"Create New Signature Link"]}),e.jsxs("p",{className:"section-description",children:["Generate a secure link that allows GC/Client to sign this ",Q," without logging in."]}),e.jsxs("div",{className:"link-options",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("select",{value:K,onChange:F=>E(F.target.value),disabled:v,children:[e.jsx("option",{value:"never",children:"Never expires"}),e.jsx("option",{value:"7",children:"7 days"}),e.jsx("option",{value:"30",children:"30 days"}),e.jsx("option",{value:"90",children:"90 days"})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:S,disabled:v,children:v?"Generating...":"Generate Link"})]}),B&&e.jsxs("div",{className:"new-link-box",children:[e.jsxs("div",{className:"link-display",children:[e.jsx("input",{type:"text",value:B,readOnly:!0,className:"link-input"}),e.jsxs("button",{className:"btn btn-secondary copy-btn",onClick:()=>te(B),children:[U?e.jsx(nr,{size:16}):e.jsx(uf,{size:16}),U?"Copied!":"Copy"]})]}),e.jsxs("a",{href:B,target:"_blank",rel:"noopener noreferrer",className:"preview-link",children:[e.jsx(mf,{size:14}),"Preview link"]})]})]}),e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(lr,{size:16}),"Existing Signature Links"]}),g?e.jsx("div",{className:"loading-inline",children:"Loading..."}):A.length===0?e.jsxs("p",{className:"empty-state",children:["No signature links have been created for this ",Q,"."]}):e.jsx("div",{className:"existing-links-list",children:A.map(F=>{const I=Z(F.status),P=`${window.location.origin}/sign/${F.signature_token}`,j=F.signatures?.length||0;return e.jsxs("div",{className:"existing-link-card",children:[e.jsxs("div",{className:"link-card-header",children:[e.jsx("span",{className:"status-badge",style:{color:I.color,backgroundColor:I.bg},children:I.label}),e.jsxs("span",{className:"link-created",children:["Created ",vf(F.created_at)]})]}),e.jsxs("div",{className:"link-card-body",children:[e.jsxs("div",{className:"link-info",children:[e.jsxs("span",{className:"link-token",children:["...",F.signature_token.slice(-8)]}),F.expires_at&&e.jsxs("span",{className:"link-expires",children:["Expires ",vf(F.expires_at)]}),e.jsxs("span",{className:"link-views",children:[F.view_count," view",F.view_count!==1?"s":""]})]}),j>0&&e.jsx("div",{className:"signatures-summary",children:F.signatures.map(_=>e.jsxs("div",{className:"sig-item",children:[e.jsx(nr,{size:12}),e.jsxs("span",{children:["Slot ",_.signature_slot,": ",_.signer_name,_.signer_company&&` (${_.signer_company})`]})]},_.id))})]}),e.jsxs("div",{className:"link-card-actions",children:[F.status!=="revoked"&&F.status!=="expired"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>te(P),children:[e.jsx(uf,{size:14})," Copy"]}),e.jsxs("a",{href:P,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-small",children:[e.jsx(mf,{size:14})," Open"]})]}),F.status!=="completed"&&F.status!=="revoked"&&e.jsxs("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>se(F.id),children:[e.jsx(gs,{size:14})," Revoke"]})]})]},F.id)})})]}),e.jsxs("div",{className:"signature-info-box",children:[e.jsx(cl,{size:16}),e.jsxs("div",{children:[e.jsx("strong",{children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Share the link with your GC or Client"}),e.jsx("li",{children:"They can view the document and sign without logging in"}),e.jsx("li",{children:"Supports 2 signatures (GC + Client)"}),e.jsx("li",{children:"Signatures are recorded with name, title, company, date, and IP"})]})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:u,children:"Close"})})]})})}const yf=l=>{const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:[30,41,59]},jv=l=>new Promise(i=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),i(c.toDataURL("image/png"))},o.onerror=()=>i(null),o.src=l});function vv({project:l,company:i,onShowToast:o}){const{branding:c}=il(),[m,u]=p.useState([]),[x,g]=p.useState(!0),[f,v]=p.useState("all"),[y,A]=p.useState(null),[Y,B]=p.useState(new Set),[H,U]=p.useState("recent"),[z,K]=p.useState(new Set),[E,D]=p.useState({start:"",end:""}),[S,te]=p.useState(!1),[se,Z]=p.useState(null),[Q,F]=p.useState(""),[I,P]=p.useState(!1),[j,_]=p.useState(null),[C,ee]=p.useState({});p.useEffect(()=>{w();const X=de.subscribeToTMTickets?.(l.id,()=>{w()});return()=>{X&&de.unsubscribe?.(X)}},[l.id]);const w=async()=>{try{const X=await de.getTMTickets(l.id);u(X);const T=X.filter(_e=>_e.assigned_cor_id);if(T.length>0){const _e={};await Promise.all(T.map(async Ee=>{const ae=await de.isTicketEditable(Ee);ae.editable||(_e[Ee.id]=ae)})),ee(_e)}}catch(X){console.error("Error loading tickets:",X),o("Error loading T&M tickets","error")}finally{g(!1)}},k=async(X,T)=>{if(C[X]){o(C[X].reason||"This ticket is locked (COR approved)","error");return}try{await de.updateTMTicketStatus(X,T),u(m.map(_e=>_e.id===X?{..._e,status:T}:_e)),o(`Ticket ${T}`,"success")}catch(_e){console.error("Error updating status:",_e),o("Error updating status","error")}},M=X=>{if(C[X.id]){o(C[X.id].reason||"This ticket is locked (COR approved)","error");return}X.ce_pco_number?(Z(X),F(""),te(!0)):k(X.id,"approved")},he=async()=>{if(se)try{const X=parseFloat(Q)||0;await de.approveTMTicket(se.id,null,null,X),u(m.map(T=>T.id===se.id?{...T,status:"approved",change_order_value:X}:T)),o(`Ticket approved with $${X.toLocaleString()} change order`,"success"),te(!1),Z(null),F("")}catch(X){console.error("Error approving ticket:",X),o("Error approving ticket","error")}},V=async X=>{if(C[X]){o(C[X].reason||"This ticket is locked (COR approved)","error");return}if(confirm("Delete this T&M ticket?"))try{await de.deleteTMTicket(X),u(m.filter(T=>T.id!==X)),o("Ticket deleted","success")}catch(T){console.error("Error deleting ticket:",T),o("Error deleting ticket","error")}},q=X=>{let T=0;return X.t_and_m_items&&X.t_and_m_items.forEach(_e=>{_e.materials_equipment?.cost_per_unit&&(T+=_e.quantity*_e.materials_equipment.cost_per_unit)}),T},L=X=>X.t_and_m_workers?X.t_and_m_workers.reduce((T,_e)=>{const Ee=parseFloat(_e.hours)||0,ae=parseFloat(_e.overtime_hours)||0;return T+Ee+ae},0):0,$=X=>new Date(X).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),xe=(X,T)=>{T.stopPropagation(),B(_e=>{const Ee=new Set(_e);return Ee.has(X)?Ee.delete(X):Ee.add(X),Ee})},be=()=>{const X=f==="all"?m:m.filter(_e=>_e.status===f),T=X.every(_e=>Y.has(_e.id));B(T?new Set:new Set(X.map(_e=>_e.id)))},Fe=()=>{B(new Set)},ye=()=>{const X=f==="all"?m:m.filter(T=>T.status===f);return Y.size>0?X.filter(T=>Y.has(T.id)):X},We=()=>{const X=ye();if(X.length===0){o("No tickets to export","error");return}const T=[],_e=[],Ee=[];X.forEach(Pe=>{const Ut=$(Pe.work_date),Rt=Pe.status;Pe.t_and_m_workers&&Pe.t_and_m_workers.forEach(ut=>{const Gt=parseFloat(ut.hours)||0,Lt=parseFloat(ut.overtime_hours)||0;T.push({Date:Ut,Status:Rt,"Worker Name":ut.name,Role:ut.role||"Laborer","Regular Hours":Gt,"OT Hours":Lt,"Total Hours":Gt+Lt})}),Pe.t_and_m_items&&Pe.t_and_m_items.forEach(ut=>{const Gt=ut.custom_name||ut.materials_equipment?.name||"Unknown",Lt=ut.custom_category||ut.materials_equipment?.category||"Unknown",Et=ut.materials_equipment?.unit||"each",et=ut.materials_equipment?.cost_per_unit||0,tt=ut.quantity*et;_e.push({Date:Ut,Status:Rt,Category:Lt,Item:Gt,Quantity:ut.quantity,Unit:Et,"Cost/Unit":et,Total:tt})}),Ee.push({Date:Ut,Status:Rt,Workers:Pe.t_and_m_workers?.length||0,"Total Hours":L(Pe),Items:Pe.t_and_m_items?.length||0,"Materials Cost":q(Pe),Notes:Pe.notes||""})});const ae=Gs.book_new(),Se=Gs.json_to_sheet(Ee);if(Gs.book_append_sheet(ae,Se,"Summary"),T.length>0){const Pe=Gs.json_to_sheet(T);Gs.book_append_sheet(ae,Pe,"Workers")}if(_e.length>0){const Pe=Gs.json_to_sheet(_e);Gs.book_append_sheet(ae,Pe,"Materials & Equipment")}const ct=`${l.name}_TM_${new Date().toISOString().split("T")[0]}.xlsx`;fx(ae,ct),o("Export downloaded!","success")},Ve=async()=>{const X=ye();if(X.length===0){o("No tickets to export","error");return}o("Generating PDF...","info");const T=new Mi,_e=T.internal.pageSize.getWidth(),Ee=T.internal.pageSize.getHeight(),ae=20;let Se=ae;const ct=yf(c?.primary_color||"#3B82F6"),Pe=yf(c?.secondary_color||"#1E40AF");T.setFillColor(...ct),T.rect(0,0,_e,45,"F"),T.setFillColor(...Pe),T.rect(0,42,_e,3,"F");let Ut=ae;if(c?.logo_url)try{const Ue=await jv(c.logo_url);Ue&&(T.addImage(Ue,"PNG",ae,7,30,30),Ut=ae+30+10)}catch(Ue){console.error("Error adding logo:",Ue)}T.setTextColor(255,255,255),T.setFontSize(22),T.setFont("helvetica","bold"),T.text(i?.name||"Company Name",Ut,20),T.setFontSize(10),T.setFont("helvetica","normal"),T.text("TIME & MATERIALS REPORT",Ut,30),T.setFontSize(9),T.text(`Report Date: ${new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,_e-ae,18,{align:"right"}),l.job_number&&T.text(`Job #: ${l.job_number}`,_e-ae,26,{align:"right"}),T.text(`Status: ${f.charAt(0).toUpperCase()+f.slice(1)}`,_e-ae,34,{align:"right"}),Se=55,T.setFillColor(248,250,252),T.rect(ae,Se-5,_e-ae*2,30,"F"),T.setDrawColor(...ct),T.setLineWidth(.5),T.rect(ae,Se-5,_e-ae*2,30,"S"),T.setTextColor(...ct),T.setFontSize(14),T.setFont("helvetica","bold"),T.text(`Project: ${l.name}`,ae+5,Se+7),T.setFontSize(10),T.setFont("helvetica","normal"),T.setTextColor(51,65,85);const Rt=X.map(Ue=>new Date(Ue.work_date)).sort((Ue,Ye)=>Ue-Ye),ut=Rt[0]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Gt=Rt[Rt.length-1]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});T.text(`Date Range: ${ut} - ${Gt}`,ae+5,Se+17),T.text(`Total Tickets: ${X.length}`,_e-ae-5,Se+7,{align:"right"}),Se+=40;const Lt=X.reduce((Ue,Ye)=>Ue+L(Ye),0),Et=X.reduce((Ue,Ye)=>Ue+q(Ye),0),et=new Set(X.flatMap(Ue=>Ue.t_and_m_workers?.map(Ye=>Ye.name)||[])).size;T.setTextColor(...ct),T.setFontSize(12),T.setFont("helvetica","bold"),T.text("SUMMARY",ae,Se),Se+=8;const tt=(_e-ae*2-20)/3,xt=[{label:"Total Labor Hours",value:Lt.toFixed(1)},{label:"Unique Workers",value:et.toString()},{label:"Materials Cost",value:`$${Et.toFixed(2)}`}],jt=ct.map(Ue=>Math.min(255,Ue+180));xt.forEach((Ue,Ye)=>{const mt=ae+Ye*(tt+10);T.setFillColor(...jt),T.rect(mt,Se,tt,25,"F"),T.setDrawColor(...ct),T.setLineWidth(.5),T.rect(mt,Se,tt,25,"S"),T.setTextColor(...ct),T.setFontSize(16),T.setFont("helvetica","bold"),T.text(Ue.value,mt+tt/2,Se+12,{align:"center"}),T.setTextColor(100,116,139),T.setFontSize(8),T.setFont("helvetica","normal"),T.text(Ue.label,mt+tt/2,Se+20,{align:"center"})}),Se+=35;const ne=[],Ne=[],pe=[];let N=0,re=0,ce=0,ue=0,Oe=0,Qe=0;X.forEach(Ue=>{Ue.t_and_m_workers&&Ue.t_and_m_workers.forEach(Ye=>{const mt=parseFloat(Ye.hours)||0,Ie=parseFloat(Ye.overtime_hours)||0,Mt=Ye.role||"Laborer",Jt=[$(Ue.work_date),Ye.name,mt.toString(),Ie>0?Ie.toString():"-",(mt+Ie).toString()];Mt==="Foreman"||Mt==="Superintendent"?(ne.push(Jt),N+=mt,re+=Ie):Mt==="Operator"?(Ne.push(Jt),ce+=mt,ue+=Ie):(pe.push(Jt),Oe+=mt,Qe+=Ie)})});const Te=(Ue,Ye,mt,Ie)=>{Ye.length!==0&&(Se>Ee-80&&(T.addPage(),Se=ae),T.setTextColor(...ct),T.setFontSize(11),T.setFont("helvetica","bold"),T.text(Ue,ae,Se),Se+=5,Qs(T,{startY:Se,head:[["Date","Name","Reg Hrs","OT Hrs","Total"]],body:Ye,margin:{left:ae,right:ae},headStyles:{fillColor:ct,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:30},2:{halign:"center",cellWidth:22},3:{halign:"center",cellWidth:22},4:{halign:"center",cellWidth:22}},foot:[["","SUBTOTAL:",mt.toString(),Ie>0?Ie.toString():"-",(mt+Ie).toString()]],footStyles:{fillColor:Pe,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),Se=T.lastAutoTable.finalY+10)};if(ne.length>0||Ne.length>0||pe.length>0){T.setTextColor(...ct),T.setFontSize(12),T.setFont("helvetica","bold"),T.text("LABOR",ae,Se),Se+=8,Te("SUPERVISION",ne,N,re),Te("OPERATORS",Ne,ce,ue),Te("LABORERS",pe,Oe,Qe);const Ue=N+ce+Oe,Ye=re+ue+Qe;T.setFillColor(...ct),T.rect(ae,Se,_e-ae*2,12,"F"),T.setTextColor(255,255,255),T.setFontSize(10),T.setFont("helvetica","bold"),T.text("LABOR TOTAL:",ae+5,Se+8),T.text(`${Ue} Reg + ${Ye} OT = ${Ue+Ye} Hours`,_e-ae-5,Se+8,{align:"right"}),Se+=20}Se>Ee-100&&(T.addPage(),Se=ae);const je={},lt={},pt=["Containment","PPE","Disposal","Equipment","Other"];X.forEach(Ue=>{Ue.t_and_m_items&&Ue.t_and_m_items.forEach(Ye=>{const mt=Ye.custom_name||Ye.materials_equipment?.name||"Unknown",Ie=Ye.custom_category||Ye.materials_equipment?.category||"Other",Mt=Ye.materials_equipment?.unit||"each",Jt=Ye.materials_equipment?.cost_per_unit||0,fa=Ye.quantity*Jt;je[Ie]||(je[Ie]=[],lt[Ie]=0),je[Ie].push([$(Ue.work_date),mt,Ye.quantity.toString(),Mt,`$${Jt.toFixed(2)}`,`$${fa.toFixed(2)}`]),lt[Ie]+=fa})});const Bt=(Ue,Ye,mt)=>{!Ye||Ye.length===0||(Se>Ee-80&&(T.addPage(),Se=ae),T.setTextColor(...ct),T.setFontSize(11),T.setFont("helvetica","bold"),T.text(Ue.toUpperCase(),ae,Se),Se+=5,Qs(T,{startY:Se,head:[["Date","Item","Qty","Unit","Rate","Total"]],body:Ye,margin:{left:ae,right:ae},headStyles:{fillColor:ct,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{2:{halign:"center",cellWidth:20},3:{halign:"center",cellWidth:25},4:{halign:"right",cellWidth:25},5:{halign:"right",cellWidth:30}},foot:[["","","","","Subtotal:",`$${mt.toFixed(2)}`]],footStyles:{fillColor:Pe,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),Se=T.lastAutoTable.finalY+10)};Object.keys(je).length>0&&(T.setTextColor(...ct),T.setFontSize(12),T.setFont("helvetica","bold"),T.text("MATERIALS & EQUIPMENT",ae,Se),Se+=8,pt.forEach(Ue=>{je[Ue]&&Bt(Ue,je[Ue],lt[Ue])}),Object.keys(je).forEach(Ue=>{pt.includes(Ue)||Bt(Ue,je[Ue],lt[Ue])}),T.setFillColor(...ct),T.rect(ae,Se,_e-ae*2,12,"F"),T.setTextColor(255,255,255),T.setFontSize(10),T.setFont("helvetica","bold"),T.text("MATERIALS TOTAL:",ae+5,Se+8),T.text(`$${Et.toFixed(2)}`,_e-ae-5,Se+8,{align:"right"}),Se+=20),Se>Ee-80&&(T.addPage(),Se=ae),Se+=10,T.setDrawColor(...ct),T.setLineWidth(1),T.line(ae,Se,_e-ae,Se),Se+=15,T.setTextColor(...ct),T.setFontSize(12),T.setFont("helvetica","bold"),T.text("AUTHORIZATION",ae,Se),Se+=10,T.setFontSize(10),T.setFont("helvetica","normal"),T.setTextColor(71,85,105),T.text("I hereby authorize the above time and materials charges as accurate and approved for billing.",ae,Se),Se+=20;const vt=ticketsToExport[0]||{},Re=(Ue,Ye,mt,Ie,Mt,Jt,fa)=>{T.setFont("helvetica","bold"),T.setFontSize(8),T.setTextColor(...ct),T.text(Ye,ae,Ue),T.setFont("helvetica","normal"),T.setFontSize(9),T.setTextColor(100,116,139);const Yt=Ue+18;if(T.setDrawColor(...Pe),T.setLineWidth(.5),T.line(ae,Yt,ae+70,Yt),T.text("Signature",ae,Yt+8),T.line(ae+85,Yt,ae+145,Yt),T.text("Title / Company",ae+85,Yt+8),T.line(_e-ae-40,Yt,_e-ae,Yt),T.text("Date",_e-ae-40,Yt+8),mt)try{if(T.addImage(mt,"PNG",ae,Yt-16,60,16),Ie&&(T.setFontSize(8),T.text(Ie,ae,Yt+15)),Mt||Jt){const Ba=[Mt,Jt].filter(Boolean).join(" - ");T.text(Ba,ae+85,Yt-5)}if(fa){const Ba=new Date(fa).toLocaleDateString();T.text(Ba,_e-ae-40,Yt-5)}}catch(Ba){console.error("Error adding signature to PDF:",Ba)}return Yt+25};Se=Re(Se,"GC AUTHORIZATION",vt.gc_signature_data,vt.gc_signature_name,vt.gc_signature_title,vt.gc_signature_company,vt.gc_signature_date),Se+=8,Se=Re(Se,"CLIENT AUTHORIZATION",vt.client_signature_data,vt.client_signature_name,vt.client_signature_title,vt.client_signature_company,vt.client_signature_date);const Ze=T.internal.getNumberOfPages();for(let Ue=1;Ue<=Ze;Ue++){T.setPage(Ue);const Ye=Ee-15;T.setFontSize(8),T.setTextColor(148,163,184),T.text(`${i?.name||"Company"} - T&M Report - ${l.name}`,ae,Ye),T.text(`Page ${Ue} of ${Ze}`,_e-ae,Ye,{align:"right"})}const ra=`${l.name}_TM_Report_${new Date().toISOString().split("T")[0]}.pdf`;T.save(ra),o("PDF exported!","success")},De=p.useMemo(()=>{let X=f==="all"?[...m]:m.filter(T=>T.status===f);if(E.start){const T=new Date(E.start);T.setHours(0,0,0,0),X=X.filter(_e=>new Date(_e.work_date)>=T)}if(E.end){const T=new Date(E.end);T.setHours(23,59,59,999),X=X.filter(_e=>new Date(_e.work_date)<=T)}if(H==="recent"){const T=new Date;T.setDate(T.getDate()-7),T.setHours(0,0,0,0),X=X.filter(_e=>new Date(_e.work_date)>=T)}return X},[m,f,H,E]),nt=p.useMemo(()=>{if(H!=="all")return null;const X={};return De.forEach(T=>{const _e=new Date(T.work_date),Ee=`${_e.getFullYear()}-${String(_e.getMonth()+1).padStart(2,"0")}`,ae=_e.toLocaleDateString("en-US",{month:"long",year:"numeric"});X[Ee]||(X[Ee]={label:ae,tickets:[],hours:0,cost:0}),X[Ee].tickets.push(T),X[Ee].hours+=L(T),X[Ee].cost+=q(T)}),Object.entries(X).sort((T,_e)=>_e[0].localeCompare(T[0]))},[De,H]);p.useEffect(()=>{if(nt&&nt.length>0){const X=nt[0][0];K(new Set([X]))}},[nt]);const Vt=X=>{const T=new Set(z);T.has(X)?T.delete(X):T.add(X),K(T)},ke=De.reduce((X,T)=>X+L(T),0),ze=De.reduce((X,T)=>X+q(T),0),Ae=f==="all"?m.length:m.filter(X=>X.status===f).length;if(x)return e.jsx("div",{className:"loading",children:"Loading T&M tickets..."});const Me=De.length>0&&De.every(X=>Y.has(X.id)),Ce=Y.size>0,Xe=X=>{const T=!!C[X.id],_e=C[X.id];return e.jsxs("div",{className:`tm-ticket-card ${X.status} ${Y.has(X.id)?"selected":""} ${T?"locked":""}`,children:[e.jsxs("div",{className:"tm-ticket-header",onClick:()=>A(y===X.id?null:X.id),children:[e.jsx("input",{type:"checkbox",checked:Y.has(X.id),onChange:Ee=>xe(X.id,Ee),onClick:Ee=>Ee.stopPropagation(),className:"tm-checkbox"}),e.jsxs("div",{className:"tm-ticket-info",children:[e.jsx("span",{className:"tm-ticket-date",children:$(X.work_date)}),X.ce_pco_number&&e.jsx("span",{className:"tm-ce-badge",children:X.ce_pco_number}),X.assigned_cor_id&&_e?.lockedBy&&e.jsxs("span",{className:`tm-cor-badge ${T?"locked":""}`,title:_e.reason,children:[T&&e.jsx(ff,{size:10}),_e.lockedBy.cor_number]}),X.photos?.length>0&&e.jsxs("span",{className:"tm-photo-badge",title:`${X.photos.length} photo${X.photos.length>1?"s":""}`,children:[e.jsx(sr,{size:12})," ",X.photos.length]}),e.jsx("span",{className:`tm-ticket-status ${X.status}`,children:X.status})]}),e.jsxs("div",{className:"tm-ticket-summary",children:[e.jsxs("span",{className:"tm-ticket-hours",children:[L(X)," hrs"]}),e.jsxs("span",{className:"tm-ticket-total",children:["$",q(X).toFixed(2)]}),e.jsx("span",{className:"tm-expand-arrow",children:y===X.id?"":""})]})]}),y===X.id&&e.jsxs("div",{className:"tm-ticket-details",children:[X.t_and_m_workers?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(na,{size:16,className:"inline-icon"})," Workers"]}),e.jsx("div",{className:"tm-detail-list",children:X.t_and_m_workers.map(Ee=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsxs("span",{children:[Ee.role&&Ee.role!=="Laborer"&&e.jsx("span",{className:"tm-role-badge",children:Ee.role}),Ee.name]}),e.jsxs("span",{children:[Ee.hours," hrs",parseFloat(Ee.overtime_hours)>0&&e.jsxs("span",{className:"tm-ot-badge",children:[" +",Ee.overtime_hours," OT"]})]})]},Ee.id))})]}),X.t_and_m_items?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(cr,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsx("div",{className:"tm-detail-list",children:X.t_and_m_items.map(Ee=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsx("span",{children:Ee.custom_name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"tm-custom-badge",children:"Custom"})," ",Ee.custom_name]}):Ee.materials_equipment?.name}),e.jsxs("span",{className:"tm-detail-qty",children:[Ee.quantity," ",Ee.materials_equipment?.unit||"each",Ee.materials_equipment?.cost_per_unit>0&&e.jsxs("span",{className:"tm-item-cost",children:["$",(Ee.quantity*Ee.materials_equipment.cost_per_unit).toFixed(2)]})]})]},Ee.id))})]}),X.notes&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(za,{size:16,className:"inline-icon"})," Description"]}),e.jsx("p",{className:"tm-notes-text",children:X.notes})]}),X.photos&&X.photos.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(sr,{size:16,className:"inline-icon"})," Photos (",X.photos.length,")"]}),e.jsx("div",{className:"tm-photos-grid",children:X.photos.map((Ee,ae)=>e.jsx("a",{href:Ee,target:"_blank",rel:"noopener noreferrer",className:"tm-photo-thumb",children:e.jsx("img",{src:Ee,alt:`Photo ${ae+1}`,onError:Se=>{Se.target.onerror=null,Se.target.classList.add("photo-error"),Se.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg==",console.error("Failed to load photo:",Ee)}})},ae))})]}),X.ce_pco_number&&X.change_order_value>0&&e.jsxs("div",{className:"tm-change-order-value",children:[e.jsx("span",{className:"tm-co-label",children:"Change Order Value:"}),e.jsxs("span",{className:"tm-co-amount",children:["$",X.change_order_value.toLocaleString()]})]}),T&&e.jsxs("div",{className:"tm-lock-notice",children:[e.jsx(ff,{size:14}),e.jsx("span",{children:_e?.reason||"This ticket is locked (COR approved)"})]}),e.jsxs("div",{className:"tm-ticket-actions",children:[X.status==="pending"&&!T&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-success btn-small",onClick:Ee=>{Ee.stopPropagation(),M(X)},children:["Approve ",X.ce_pco_number?"+ CO":""]}),e.jsx("button",{className:"btn btn-warning btn-small",onClick:Ee=>{Ee.stopPropagation(),k(X.id,"rejected")},children:"Reject"})]}),X.status==="approved"&&!T&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary btn-small",onClick:Ee=>{Ee.stopPropagation(),k(X.id,"billed")},children:"Mark Billed"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:Ee=>{Ee.stopPropagation(),_(X),P(!0)},children:[e.jsx(od,{size:14})," Signature Link"]})]}),X.status==="rejected"&&!T&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Ee=>{Ee.stopPropagation(),k(X.id,"pending")},children:"Restore"}),!T&&e.jsx("button",{className:"btn btn-danger btn-small",onClick:Ee=>{Ee.stopPropagation(),V(X.id)},children:"Delete"})]})]})]},X.id)};return e.jsxs("div",{className:"tm-list",children:[e.jsxs("div",{className:"tm-list-header",children:[e.jsxs("div",{className:"tm-list-title",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("div",{className:"tm-export-buttons",children:[Ce&&e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:Fe,children:["Clear (",Y.size,")"]}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:We,children:["Excel ",Ce?`(${Y.size})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:Ve,children:["PDF ",Ce?`(${Y.size})`:""]})]})]}),e.jsx("div",{className:"tm-filter-tabs",children:["all","pending","approved","billed","rejected"].map(X=>e.jsxs("button",{className:`tm-filter-tab ${f===X?"active":""}`,onClick:()=>{v(X),Fe()},children:[X.charAt(0).toUpperCase()+X.slice(1),e.jsx("span",{className:"tm-filter-count",children:X==="all"?m.length:m.filter(T=>T.status===X).length})]},X))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${H==="recent"?"active":""}`,onClick:()=>{U("recent"),D({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${H==="all"?"active":""}`,onClick:()=>U("all"),children:["All (",Ae,")"]})]}),H==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(rr,{size:16}),e.jsx("input",{type:"date",value:E.start,onChange:X=>D(T=>({...T,start:X.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:E.end,onChange:X=>D(T=>({...T,end:X.target.value})),placeholder:"End date"}),(E.start||E.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>D({start:"",end:""}),children:"Clear"})]})]})]}),De.length>0&&e.jsxs("div",{className:"tm-summary-bar",children:[e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Tickets"}),e.jsx("span",{className:"tm-summary-value",children:De.length})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Total Hours"}),e.jsx("span",{className:"tm-summary-value",children:ke.toFixed(1)})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Materials Cost"}),e.jsxs("span",{className:"tm-summary-value",children:["$",ze.toFixed(2)]})]})]}),De.length===0?e.jsxs("div",{className:"tm-empty-state",children:[e.jsxs("p",{children:["No ",f==="all"?"":f," T&M tickets",H==="recent"?" in the last 7 days":""]}),H==="recent"&&Ae>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>U("all"),children:"View All Tickets"})]}):e.jsxs("div",{className:"tm-tickets",children:[e.jsx("div",{className:"tm-select-all-row",children:e.jsxs("label",{className:"tm-checkbox-label",onClick:be,children:[e.jsx("input",{type:"checkbox",checked:Me,onChange:be,className:"tm-checkbox"}),e.jsxs("span",{children:["Select All (",De.length,")"]})]})}),H==="all"&&nt?nt.map(([X,T])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>Vt(X),children:[e.jsxs("div",{className:"month-header-left",children:[z.has(X)?e.jsx(Ps,{size:18}):e.jsx(yn,{size:18}),e.jsx("span",{className:"month-label",children:T.label}),e.jsxs("span",{className:"month-count",children:[T.tickets.length," tickets"]})]}),e.jsxs("div",{className:"month-header-right",children:[e.jsxs("span",{className:"month-stat",children:[T.hours.toFixed(1)," hrs"]}),e.jsxs("span",{className:"month-stat",children:["$",T.cost.toFixed(2)]})]})]}),z.has(X)&&e.jsx("div",{className:"month-tickets",children:T.tickets.map(_e=>Xe(_e))})]},X)):De.map(X=>Xe(X))]}),S&&se&&e.jsx("div",{className:"modal-overlay",onClick:()=>te(!1),children:e.jsxs("div",{className:"modal change-order-modal",onClick:X=>X.stopPropagation(),children:[e.jsx("h3",{children:"Approve Change Order Work"}),e.jsxs("p",{className:"modal-subtitle",children:["This T&M ticket is associated with ",e.jsx("strong",{children:se.ce_pco_number})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Change Order Value ($)"}),e.jsx("input",{type:"number",value:Q,onChange:X=>F(X.target.value),placeholder:"Enter the change order amount",autoFocus:!0}),e.jsx("p",{className:"form-help",children:"This amount will be added to the project's total contract value."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>te(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:he,children:["Approve with $",parseFloat(Q||0).toLocaleString()]})]})]})}),I&&j&&e.jsx(ep,{documentType:"tm_ticket",documentId:j.id,companyId:i?.id,projectId:l?.id,documentTitle:`T&M Ticket - ${new Date(j.work_date).toLocaleDateString()}${j.ce_pco_number?` (${j.ce_pco_number})`:""}`,onClose:()=>{P(!1),_(null)},onShowToast:o})]})}function yv({project:l,onClose:i,onShareCreated:o}){const{user:c}=Kf(),[m,u]=p.useState(!1),[x,g]=p.useState(null),[f,v]=p.useState([]),[y,A]=p.useState(!1),[Y,B]=p.useState({progress:!0,photos:!0,daily_reports:!0,tm_tickets:!1,crew_info:!1}),[H,U]=p.useState("never"),[z,K]=p.useState("");p.useEffect(()=>{E()},[l.id]);const E=async()=>{try{const j=await de.getProjectShares(l.id);v(j)}catch(j){console.error("Error loading shares:",j)}},D=j=>{B(_=>({..._,[j]:!_[j]}))},S=()=>{if(H==="never")return null;const j=new Date;if(H==="30days")j.setDate(j.getDate()+30);else if(H==="90days")j.setDate(j.getDate()+90);else if(H==="custom"&&z)return new Date(z).toISOString();return j.toISOString()},te=async()=>{u(!0);try{const j=S(),_=await de.createProjectShare(l.id,c.id,Y,j);g({type:"success",message:"Share link created!"}),A(!1),E(),o&&o(_)}catch(j){console.error("Error creating share:",j),g({type:"error",message:"Failed to create share link"})}finally{u(!1)}},se=j=>{const _=`${window.location.origin}/view/${j}`;navigator.clipboard.writeText(_),g({type:"success",message:"Link copied to clipboard!"})},Z=async j=>{if(confirm("Are you sure you want to revoke this share link?"))try{await de.revokeProjectShare(j),g({type:"success",message:"Share link revoked"}),E()}catch(_){console.error("Error revoking share:",_),g({type:"error",message:"Failed to revoke share link"})}},Q=async j=>{if(confirm("Are you sure you want to permanently delete this share link?"))try{await de.deleteProjectShare(j),g({type:"success",message:"Share link deleted"}),E()}catch(_){console.error("Error deleting share:",_),g({type:"error",message:"Failed to delete share link"})}},F=j=>j?new Date(j).toLocaleDateString():"Never",I=j=>j?new Date(j)<new Date:!1,P=j=>{const _=[];return j.progress&&_.push("Progress"),j.photos&&_.push("Photos"),j.daily_reports&&_.push("Reports"),j.tm_tickets&&_.push("T&M"),j.crew_info&&_.push("Crew"),_.join(", ")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:i,children:e.jsxs("div",{className:"modal-content share-modal",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Share Project: ",l.name]}),e.jsx("button",{className:"close-btn",onClick:i,children:""})]}),e.jsxs("div",{className:"modal-body",children:[f.length>0&&e.jsxs("div",{className:"existing-shares",children:[e.jsx("h3",{children:"Active Share Links"}),e.jsx("div",{className:"shares-list",children:f.map(j=>e.jsxs("div",{className:`share-item ${!j.is_active||I(j.expires_at)?"inactive":""}`,children:[e.jsxs("div",{className:"share-info",children:[e.jsxs("div",{className:"share-token",children:[e.jsxs("code",{children:[window.location.origin,"/view/",j.share_token]}),e.jsx("button",{className:"btn-small",onClick:()=>se(j.share_token),disabled:!j.is_active||I(j.expires_at),children:"Copy"})]}),e.jsxs("div",{className:"share-meta",children:[e.jsx("span",{className:"permissions",children:P(j.permissions)}),e.jsxs("span",{className:"expiry",children:["Expires: ",F(j.expires_at)]}),e.jsxs("span",{className:"views",children:["Views: ",j.view_count||0,j.last_viewed_at&&` (Last: ${F(j.last_viewed_at)})`]})]}),!j.is_active&&e.jsx("div",{className:"status-badge revoked",children:"Revoked"}),I(j.expires_at)&&j.is_active&&e.jsx("div",{className:"status-badge expired",children:"Expired"})]}),e.jsxs("div",{className:"share-actions",children:[j.is_active&&!I(j.expires_at)&&e.jsx("button",{className:"btn-secondary",onClick:()=>Z(j.id),children:"Revoke"}),e.jsx("button",{className:"btn-danger",onClick:()=>Q(j.id),children:"Delete"})]})]},j.id))})]}),!y&&e.jsx("button",{className:"btn-primary",onClick:()=>A(!0),children:"+ Create New Share Link"}),y&&e.jsxs("div",{className:"new-share-form",children:[e.jsx("h3",{children:"Create New Share Link"}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Permissions"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Y.progress,onChange:()=>D("progress")}),"Progress/completion status"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Y.photos,onChange:()=>D("photos")}),"Photos feed"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Y.daily_reports,onChange:()=>D("daily_reports")}),"Daily reports"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Y.tm_tickets,onChange:()=>D("tm_tickets")}),"T&M tickets"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Y.crew_info,onChange:()=>D("crew_info")}),"Crew information"]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"never",checked:H==="never",onChange:j=>U(j.target.value)}),"Never expires"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"30days",checked:H==="30days",onChange:j=>U(j.target.value)}),"30 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"90days",checked:H==="90days",onChange:j=>U(j.target.value)}),"90 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"custom",checked:H==="custom",onChange:j=>U(j.target.value)}),"Custom date"]})]}),H==="custom"&&e.jsx("input",{type:"date",value:z,onChange:j=>K(j.target.value),min:new Date().toISOString().split("T")[0],className:"date-input"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>A(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:te,disabled:m,children:m?"Generating...":"Generate Share Link"})]})]})]})]})}),x&&e.jsx(Zs,{message:x.message,type:x.type,onClose:()=>g(null)}),e.jsx("style",{children:`
        .share-modal {
          max-width: 700px;
          max-height: 80vh;
          overflow-y: auto;
        }

        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1.5rem;
          border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .close-btn {
          background: none;
          border: none;
          font-size: 2rem;
          cursor: pointer;
          color: var(--text-secondary);
          padding: 0;
          width: 2rem;
          height: 2rem;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .close-btn:hover {
          color: var(--text-primary);
        }

        .modal-body {
          padding: 1.5rem;
        }

        .existing-shares {
          margin-bottom: 2rem;
        }

        .existing-shares h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .shares-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .share-item {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          gap: 1rem;
          background: var(--bg-card);
        }

        .share-item.inactive {
          opacity: 0.6;
          background-color: var(--bg-elevated);
        }

        .share-info {
          flex: 1;
        }

        .share-token {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-bottom: 0.5rem;
        }

        .share-token code {
          background-color: var(--bg-elevated);
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.875rem;
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          color: var(--text-primary);
        }

        .share-meta {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .status-badge {
          display: inline-block;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 500;
          margin-top: 0.5rem;
        }

        .status-badge.revoked {
          background-color: #fee2e2;
          color: #991b1b;
        }

        .status-badge.expired {
          background-color: #fef3c7;
          color: #92400e;
        }

        .share-actions {
          display: flex;
          gap: 0.5rem;
          flex-shrink: 0;
        }

        .new-share-form {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          background-color: var(--bg-elevated);
        }

        .new-share-form h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .form-section {
          margin-bottom: 1.5rem;
        }

        .form-section label {
          display: block;
          font-weight: 500;
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .checkbox-group,
        .radio-group {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .checkbox-group label,
        .radio-group label {
          font-weight: normal;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .checkbox-group input[type="checkbox"],
        .radio-group input[type="radio"] {
          margin: 0;
        }

        .date-input {
          margin-top: 0.5rem;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          width: 100%;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-actions {
          display: flex;
          justify-content: flex-end;
          gap: 0.5rem;
          margin-top: 1.5rem;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
          border: 1px solid var(--border-color);
          background-color: var(--bg-card);
          color: var(--text-primary);
          border-radius: 4px;
          cursor: pointer;
        }

        .btn-small:hover:not(:disabled) {
          background-color: var(--bg-elevated);
        }

        .btn-small:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }
      `})]})}const Zo=l=>{const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:[30,41,59]},bv=l=>new Promise(i=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),i(c.toDataURL("image/png"))},o.onerror=()=>i(null),o.src=l});function _v({project:l,companyId:i,company:o,onShowToast:c}){const{branding:m}=il(),[u,x]=p.useState([]),[g,f]=p.useState(null),[v,y]=p.useState(!1),[A,Y]=p.useState(!0),[B,H]=p.useState(null),[U,z]=p.useState("recent"),[K,E]=p.useState(new Set),[D,S]=p.useState({start:"",end:""});p.useEffect(()=>{te();const M=i||l?.company_id,he=M?de.subscribeToInjuryReports?.(M,()=>{te()}):null;return()=>{he&&de.unsubscribe?.(he)}},[l?.id,i]);const te=async()=>{Y(!0);try{const M=l?await de.getInjuryReports(l.id):await de.getCompanyInjuryReports(i);x(M)}catch(M){console.error("Error loading injury reports:",M),H({type:"error",message:"Failed to load injury reports"})}finally{Y(!1)}},se=()=>{te(),y(!1),H({type:"success",message:"Injury report created successfully"})},Z=M=>{f(M)},Q=()=>{f(null)},F=M=>M?new Date(M).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",I=M=>M?new Date(`2000-01-01T${M}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",P=M=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[M]||M,j=M=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[M]||"#9ca3af",_=M=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[M]||"#9ca3af",C=p.useMemo(()=>{let M=[...u];if(D.start){const he=new Date(D.start);he.setHours(0,0,0,0),M=M.filter(V=>new Date(V.incident_date)>=he)}if(D.end){const he=new Date(D.end);he.setHours(23,59,59,999),M=M.filter(V=>new Date(V.incident_date)<=he)}if(U==="recent"){const he=new Date;he.setDate(he.getDate()-7),he.setHours(0,0,0,0),M=M.filter(V=>new Date(V.incident_date)>=he)}return M},[u,U,D]),ee=p.useMemo(()=>{if(U!=="all")return null;const M={};return C.forEach(he=>{const V=new Date(he.incident_date),q=`${V.getFullYear()}-${String(V.getMonth()+1).padStart(2,"0")}`,L=V.toLocaleDateString("en-US",{month:"long",year:"numeric"});M[q]||(M[q]={label:L,reports:[]}),M[q].reports.push(he)}),Object.entries(M).sort((he,V)=>V[0].localeCompare(he[0]))},[C,U]);p.useEffect(()=>{if(ee&&ee.length>0){const M=ee[0][0];E(new Set([M]))}},[ee]);const w=M=>{const he=new Set(K);he.has(M)?he.delete(M):he.add(M),E(he)},k=async()=>{if(u.length===0){H({type:"error",message:"No reports to export"});return}H({type:"info",message:"Generating PDF..."});const M=new Mi,he=M.internal.pageSize.getWidth(),V=20;let q=V;const L=Zo(m?.primary_color||"#3B82F6"),$=Zo(m?.secondary_color||"#1E40AF");M.setFillColor(...L),M.rect(0,0,he,45,"F"),M.setFillColor(...$),M.rect(0,42,he,3,"F");let xe=V;if(m?.logo_url)try{const ye=await bv(m.logo_url);ye&&(M.addImage(ye,"PNG",V,7,30,30),xe=V+40)}catch(ye){console.error("Error adding logo:",ye)}M.setTextColor(255,255,255),M.setFontSize(22),M.setFont("helvetica","bold"),M.text(o?.name||"Company",xe,20),M.setFontSize(10),M.setFont("helvetica","normal"),M.text("INJURY & INCIDENT REPORTS",xe,30),M.setFontSize(9),M.text(`Generated: ${new Date().toLocaleDateString()}`,he-V,20,{align:"right"}),M.text(`Total Reports: ${u.length}`,he-V,28,{align:"right"}),q=55,l&&(M.setFillColor(248,250,252),M.rect(V,q-5,he-V*2,15,"F"),M.setTextColor(...L),M.setFontSize(12),M.setFont("helvetica","bold"),M.text(`Project: ${l.name}`,V+5,q+5),q+=20),u.forEach(ye=>{q>200&&(M.addPage(),q=V);const We=Zo(_(ye.injury_type));M.setFillColor(...We),M.rect(V,q,he-V*2,12,"F"),M.setTextColor(255,255,255),M.setFontSize(11),M.setFont("helvetica","bold"),M.text(`${ye.employee_name} - ${P(ye.injury_type)}`,V+5,q+8),M.text(F(ye.incident_date),he-V-5,q+8,{align:"right"}),q+=17,M.setTextColor(50,50,50),M.setFontSize(9),M.setFont("helvetica","normal"),M.text(`Location: ${ye.incident_location}`,V+5,q),ye.incident_time&&M.text(`Time: ${I(ye.incident_time)}`,V+100,q),q+=6,M.setFont("helvetica","bold"),M.text("Description:",V+5,q),M.setFont("helvetica","normal"),q+=5;const Ve=M.splitTextToSize(ye.incident_description,he-V*2-10);M.text(Ve,V+5,q),q+=Ve.length*4+3;const De=[];ye.body_part_affected&&De.push(`Body Part: ${ye.body_part_affected}`),ye.osha_recordable&&De.push("OSHA Recordable"),ye.workers_comp_claim&&De.push("Workers' Comp Filed"),ye.medical_treatment_required&&De.push("Medical Treatment Required"),De.length>0&&(M.setFontSize(8),M.setTextColor(100,100,100),M.text(De.join("  |  "),V+5,q),q+=5),M.setFontSize(8),M.text(`Reported by: ${ye.reported_by_name} (${ye.reported_by_title})`,V+5,q),q+=12});const be=M.internal.getNumberOfPages();for(let ye=1;ye<=be;ye++)M.setPage(ye),M.setFontSize(8),M.setTextColor(150,150,150),M.text(`Page ${ye} of ${be}`,he/2,M.internal.pageSize.getHeight()-10,{align:"center"}),M.text("CONFIDENTIAL - Injury Report",V,M.internal.pageSize.getHeight()-10);const Fe=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;M.save(Fe),H({type:"success",message:"PDF exported!"})};return A?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[u.length>0&&e.jsx("button",{className:"btn-secondary",onClick:k,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>y(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${U==="recent"?"active":""}`,onClick:()=>{z("recent"),S({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${U==="all"?"active":""}`,onClick:()=>z("all"),children:["All (",u.length,")"]})]}),U==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(rr,{size:16}),e.jsx("input",{type:"date",value:D.start,onChange:M=>S(he=>({...he,start:M.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:D.end,onChange:M=>S(he=>({...he,end:M.target.value})),placeholder:"End date"}),(D.start||D.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>S({start:"",end:""}),children:"Clear"})]})]}),C.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:""}),e.jsxs("h4",{children:["No Injury Reports",U==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),U==="recent"&&u.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>z("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:U==="all"&&ee?ee.map(([M,he])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>w(M),children:e.jsxs("div",{className:"month-header-left",children:[K.has(M)?e.jsx(Ps,{size:18}):e.jsx(yn,{size:18}),e.jsx("span",{className:"month-label",children:he.label}),e.jsxs("span",{className:"month-count",children:[he.reports.length," reports"]})]})}),K.has(M)&&e.jsx("div",{className:"month-reports",children:he.reports.map(V=>e.jsxs("div",{className:"report-card",onClick:()=>Z(V),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[F(V.incident_date)," at ",I(V.incident_time)]}),e.jsx("div",{className:"employee-name",children:V.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:_(V.injury_type)},children:P(V.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:j(V.status)},children:V.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",V.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",V.reported_by_name," (",V.reported_by_title,")"]}),V.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",V.body_part_affected]}),V.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[V.incident_description.substring(0,150),V.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},V.id))})]},M)):C.map(M=>e.jsxs("div",{className:"report-card",onClick:()=>Z(M),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[F(M.incident_date)," at ",I(M.incident_time)]}),e.jsx("div",{className:"employee-name",children:M.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:_(M.injury_type)},children:P(M.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:j(M.status)},children:M.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",M.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",M.reported_by_name," (",M.reported_by_title,")"]}),M.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",M.body_part_affected]}),M.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[M.incident_description.substring(0,150),M.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},M.id))}),g&&e.jsx("div",{className:"modal-overlay",onClick:Q,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:Q,children:""})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[F(g.incident_date)," at ",I(g.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:g.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:_(g.injury_type)},children:P(g.injury_type)})})]}),g.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:g.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:g.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:g.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:g.employee_job_title})]}),g.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:g.employee_phone})]}),g.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:g.employee_email})]}),g.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:g.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:g.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:g.reported_by_title})]}),g.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:g.reported_by_phone})]}),g.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:g.reported_by_email})]})]})]}),g.witnesses&&g.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),g.witnesses.map((M,he)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:M.name}),M.phone&&e.jsxs("span",{children:["  ",M.phone]}),M.email&&e.jsxs("span",{children:["  ",M.email]})]}),M.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',M.testimony,'"']})})]},he))]}),g.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[g.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:g.medical_facility_name})]}),g.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:g.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:g.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),g.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:g.immediate_actions_taken})]}),g.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:g.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[g.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:g.safety_equipment_used})]}),g.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:g.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:g.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:g.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:g.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:g.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",F(g.created_at)]})]})]})}),v&&e.jsx(Wf,{project:l,companyId:i,onClose:()=>y(!1),onReportCreated:se}),B&&e.jsx(Zs,{message:B.message,type:B.type,onClose:()=>H(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const Po=[{id:"message",label:"Messages",Icon:fs,description:"Chat messages from field"},{id:"material_request",label:"Material Requests",Icon:Za,description:"Equipment and material requests"},{id:"injury_report",label:"Safety Reports",Icon:cl,description:"Injury and safety incident reports"},{id:"tm_ticket",label:"T&M Tickets",Icon:Ra,description:"Time and materials tickets"}];function Nv({project:l,company:i,onShowToast:o,onClose:c}){const[m,u]=p.useState([]),[x,g]=p.useState({}),[f,v]=p.useState([]),[y,A]=p.useState(!0),[Y,B]=p.useState(!1);p.useEffect(()=>{H()},[l?.id,i?.id]);const H=async()=>{if(!(!l?.id||!i?.id))try{A(!0);const D=await de.getCompanyUsers(i.id);u(D);const S=await de.getProjectNotificationPreferences(l.id),te={};S.forEach(Z=>{te[Z.user_id]={types:Z.notification_types||[],presetId:null}}),g(te);const se=await de.getNotificationPresets(i.id);v(se)}catch(D){console.error("Error loading notification settings:",D),o?.("Error loading notification settings","error")}finally{A(!1)}},U=(D,S)=>{g(te=>{const se=te[D]||{types:[]},Z=se.types.includes(S)?se.types.filter(Q=>Q!==S):[...se.types,S];return{...te,[D]:{types:Z,presetId:null}}})},z=(D,S)=>{const te=f.find(se=>se.id===S);te&&g(se=>({...se,[D]:{types:[...te.notification_types],presetId:S}}))},K=(D,S)=>{g(te=>({...te,[D]:{types:S?Po.map(se=>se.id):[],presetId:null}}))},E=async()=>{try{B(!0);const D=Object.entries(x).map(([S,te])=>({userId:S,notificationTypes:te.types}));await de.setProjectNotificationPreferences(l.id,D),o?.("Notification settings saved","success"),c?.()}catch(D){console.error("Error saving notification settings:",D),o?.("Error saving notification settings","error")}finally{B(!1)}};return y?e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsx("button",{className:"close-btn",onClick:c,children:""})]}),e.jsx("div",{className:"loading-message",children:"Loading..."})]}):e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsxs("h3",{children:["Notification Settings for ",l?.name]}),e.jsx("button",{className:"close-btn",onClick:c,children:""})]}),e.jsx("p",{className:"settings-description",children:"Choose who receives notifications when field workers send messages, request materials, submit safety reports, or create T&M tickets for this project."}),m.length===0?e.jsxs("div",{className:"no-users-message",children:[e.jsx("p",{children:"No users found in this company."}),e.jsx("small",{children:"Users need to be added to the company to receive notifications."})]}):e.jsx("div",{className:"notification-users-list",children:m.map(D=>{const S=x[D.id]||{types:[],presetId:null},te=S.types.length===Po.length,se=S.types.length>0&&!te;return e.jsxs("div",{className:"notification-user-row",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:D.name?.charAt(0).toUpperCase()||D.email?.charAt(0).toUpperCase()}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:D.name||D.email}),D.role&&e.jsx("span",{className:"user-role",children:D.role})]})]}),e.jsxs("div",{className:"notification-controls",children:[e.jsxs("select",{className:"preset-select",value:S.presetId||"",onChange:Z=>Z.target.value&&z(D.id,Z.target.value),children:[e.jsx("option",{value:"",children:"Apply preset..."}),f.map(Z=>e.jsx("option",{value:Z.id,children:Z.name},Z.id))]}),e.jsx("button",{className:`toggle-all-btn ${te?"all-on":se?"some-on":""}`,onClick:()=>K(D.id,!te),title:te?"Disable all":"Enable all",children:te?"All On":se?"Some":"None"})]}),e.jsx("div",{className:"notification-types",children:Po.map(Z=>e.jsxs("label",{className:`notification-type-toggle ${S.types.includes(Z.id)?"active":""}`,title:Z.description,children:[e.jsx("input",{type:"checkbox",checked:S.types.includes(Z.id),onChange:()=>U(D.id,Z.id)}),e.jsx("span",{className:"type-icon",children:e.jsx(Z.Icon,{size:16})}),e.jsx("span",{className:"type-label",children:Z.label})]},Z.id))})]},D.id)})}),e.jsxs("div",{className:"notification-settings-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:c,children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:E,disabled:Y,children:Y?"Saving...":"Save Settings"})]})]})}function Sv({project:l,company:i,onShowToast:o}){const[c,m]=p.useState([]),[u,x]=p.useState(!0),[g,f]=p.useState("all"),[v,y]=p.useState(null),[A,Y]=p.useState("recent"),[B,H]=p.useState(new Set),[U,z]=p.useState({start:"",end:""});p.useEffect(()=>{K();const _=de.subscribeToMaterialRequests?.(l.id,()=>{K()});return()=>{_&&de.unsubscribe?.(_)}},[l.id]);const K=async()=>{try{const _=await de.getMaterialRequests(l.id);m(_||[])}catch(_){console.error("Error loading material requests:",_),o?.("Error loading material requests","error")}finally{x(!1)}},E=async(_,C)=>{try{await de.updateMaterialRequest(_,C,"Office"),m(c.map(ee=>ee.id===_?{...ee,status:C}:ee)),o?.(`Request ${C}`,"success")}catch(ee){console.error("Error updating status:",ee),o?.("Error updating status","error")}},D=_=>new Date(_).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),S=_=>new Date(_).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),te=_=>{switch(_){case"urgent":return"priority-urgent";case"low":return"priority-low";default:return"priority-normal"}},se=_=>{switch(_){case"urgent":return"";case"low":return"";default:return""}},Z=p.useMemo(()=>{let _=g==="all"?[...c]:c.filter(C=>C.status===g);if(U.start){const C=new Date(U.start);C.setHours(0,0,0,0),_=_.filter(ee=>new Date(ee.created_at)>=C)}if(U.end){const C=new Date(U.end);C.setHours(23,59,59,999),_=_.filter(ee=>new Date(ee.created_at)<=C)}if(A==="recent"){const C=new Date;C.setDate(C.getDate()-7),C.setHours(0,0,0,0),_=_.filter(ee=>new Date(ee.created_at)>=C)}return _},[c,g,A,U]),Q=p.useMemo(()=>{if(A!=="all")return null;const _={};return Z.forEach(C=>{const ee=new Date(C.created_at),w=`${ee.getFullYear()}-${String(ee.getMonth()+1).padStart(2,"0")}`,k=ee.toLocaleDateString("en-US",{month:"long",year:"numeric"});_[w]||(_[w]={label:k,requests:[],itemCount:0}),_[w].requests.push(C),_[w].itemCount+=C.items?.length||0}),Object.entries(_).sort((C,ee)=>ee[0].localeCompare(C[0]))},[Z,A]);p.useEffect(()=>{if(Q&&Q.length>0){const _=Q[0][0];H(new Set([_]))}},[Q]);const F=_=>{const C=new Set(B);C.has(_)?C.delete(_):C.add(_),H(C)},I={all:c.length,pending:c.filter(_=>_.status==="pending").length,ordered:c.filter(_=>_.status==="ordered").length,delivered:c.filter(_=>_.status==="delivered").length,cancelled:c.filter(_=>_.status==="cancelled").length},P=g==="all"?c.length:c.filter(_=>_.status===g).length;if(u)return e.jsx("div",{className:"loading",children:"Loading material requests..."});const j=_=>e.jsxs("div",{className:`material-request-card ${_.status} ${_.priority==="urgent"?"urgent":""}`,children:[e.jsxs("div",{className:"material-request-header-row",onClick:()=>y(v===_.id?null:_.id),children:[e.jsxs("div",{className:"material-request-info",children:[e.jsxs("span",{className:`material-priority-badge ${te(_.priority)}`,children:[se(_.priority)," ",_.priority]}),e.jsx("span",{className:"material-request-date",children:D(_.created_at)}),e.jsx("span",{className:"material-request-time",children:S(_.created_at)})]}),e.jsxs("div",{className:"material-request-summary",children:[e.jsxs("span",{className:"material-items-count",children:[_.items?.length||0," item",(_.items?.length||0)!==1?"s":""]}),e.jsx("span",{className:`material-status ${_.status}`,children:_.status}),e.jsx("span",{className:"material-expand-arrow",children:v===_.id?"":""})]})]}),v===_.id&&e.jsxs("div",{className:"material-request-details",children:[e.jsxs("div",{className:"material-detail-section",children:[e.jsxs("div",{className:"material-requester",children:[e.jsx("span",{className:"requester-label",children:"Requested by:"}),e.jsx("span",{className:"requester-name",children:_.requested_by||"Field"})]}),_.needed_by&&e.jsxs("div",{className:"material-needed-by",children:[e.jsx("span",{className:"needed-label",children:"Needed by:"}),e.jsx("span",{className:"needed-date",children:D(_.needed_by)})]})]}),_.items?.length>0&&e.jsxs("div",{className:"material-detail-section",children:[e.jsx("h4",{children:"Items Requested"}),e.jsx("div",{className:"material-items-list",children:_.items.map((C,ee)=>e.jsxs("div",{className:"material-item-row",children:[e.jsx("span",{className:"item-name",children:C.name}),e.jsxs("span",{className:"item-quantity",children:[C.quantity," ",C.unit]})]},ee))})]}),_.notes&&e.jsxs("div",{className:"material-detail-section",children:[e.jsx("h4",{children:"Notes"}),e.jsx("p",{className:"material-notes",children:_.notes})]}),e.jsxs("div",{className:"material-request-actions",children:[_.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:C=>{C.stopPropagation(),E(_.id,"ordered")},children:"Mark Ordered"}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:C=>{C.stopPropagation(),E(_.id,"cancelled")},children:"Cancel"})]}),_.status==="ordered"&&e.jsx("button",{className:"btn btn-success btn-small",onClick:C=>{C.stopPropagation(),E(_.id,"delivered")},children:"Mark Delivered"}),_.status==="cancelled"&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:C=>{C.stopPropagation(),E(_.id,"pending")},children:"Restore"})]})]})]},_.id);return e.jsxs("div",{className:"material-requests-list card",children:[e.jsxs("div",{className:"material-requests-header",children:[e.jsxs("div",{className:"material-requests-title",children:[e.jsx("h3",{children:"Material Requests"}),I.pending>0&&e.jsxs("span",{className:"pending-badge",children:[I.pending," pending"]})]}),e.jsx("div",{className:"material-filter-tabs",children:["all","pending","ordered","delivered","cancelled"].map(_=>e.jsxs("button",{className:`material-filter-tab ${g===_?"active":""}`,onClick:()=>f(_),children:[_.charAt(0).toUpperCase()+_.slice(1),e.jsx("span",{className:"material-filter-count",children:I[_]})]},_))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${A==="recent"?"active":""}`,onClick:()=>{Y("recent"),z({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${A==="all"?"active":""}`,onClick:()=>Y("all"),children:["All (",P,")"]})]}),A==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(rr,{size:16}),e.jsx("input",{type:"date",value:U.start,onChange:_=>z(C=>({...C,start:_.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:U.end,onChange:_=>z(C=>({...C,end:_.target.value})),placeholder:"End date"}),(U.start||U.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>z({start:"",end:""}),children:"Clear"})]})]})]}),Z.length===0?e.jsxs("div",{className:"material-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Za,{size:32})}),e.jsxs("p",{children:["No ",g==="all"?"":g," material requests",A==="recent"?" in the last 7 days":""]}),A==="recent"&&P>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>Y("all"),children:"View All Requests"})]}):e.jsx("div",{className:"material-requests",children:A==="all"&&Q?Q.map(([_,C])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>F(_),children:[e.jsxs("div",{className:"month-header-left",children:[B.has(_)?e.jsx(Ps,{size:18}):e.jsx(yn,{size:18}),e.jsx("span",{className:"month-label",children:C.label}),e.jsxs("span",{className:"month-count",children:[C.requests.length," requests"]})]}),e.jsx("div",{className:"month-header-right",children:e.jsxs("span",{className:"month-stat",children:[C.itemCount," items"]})})]}),B.has(_)&&e.jsx("div",{className:"month-requests",children:C.requests.map(ee=>j(ee))})]},_)):Z.map(_=>j(_))})]})}const bf=l=>{const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:[30,41,59]},Cv=l=>new Promise(i=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),i(c.toDataURL("image/png"))},o.onerror=()=>i(null),o.src=l});function wv({project:l,company:i,onShowToast:o}){const{branding:c}=il(),[m,u]=p.useState([]),[x,g]=p.useState(!0),[f,v]=p.useState(null),[y,A]=p.useState(new Set),[Y,B]=p.useState(!1),[H,U]=p.useState("recent"),[z,K]=p.useState(new Set),[E,D]=p.useState({start:"",end:""});p.useEffect(()=>{S();const V=de.subscribeToDailyReports?.(l.id,()=>{S()});return()=>{V&&de.unsubscribe?.(V)}},[l.id]);const S=async()=>{try{const V=await de.getDailyReports(l.id,365);u(V||[])}catch(V){console.error("Error loading daily reports:",V),o?.("Error loading daily reports","error")}finally{g(!1)}},te=p.useMemo(()=>{let V=[...m];if(E.start){const q=new Date(E.start);q.setHours(0,0,0,0),V=V.filter(L=>new Date(L.report_date||L.created_at)>=q)}if(E.end){const q=new Date(E.end);q.setHours(23,59,59,999),V=V.filter(L=>new Date(L.report_date||L.created_at)<=q)}if(H==="recent"){const q=new Date;q.setDate(q.getDate()-7),q.setHours(0,0,0,0),V=V.filter(L=>new Date(L.report_date||L.created_at)>=q)}return V},[m,H,E]),se=p.useMemo(()=>{if(H!=="all")return null;const V={};return te.forEach(q=>{const L=new Date(q.report_date||q.created_at),$=`${L.getFullYear()}-${String(L.getMonth()+1).padStart(2,"0")}`,xe=L.toLocaleDateString("en-US",{month:"long",year:"numeric"});V[$]||(V[$]={label:xe,reports:[]}),V[$].reports.push(q)}),Object.entries(V).sort((q,L)=>L[0].localeCompare(q[0]))},[te,H]);p.useEffect(()=>{if(se&&se.length>0){const V=se[0][0];K(new Set([V]))}},[se]);const Z=()=>{B(!Y),Y&&A(new Set)},Q=V=>{const q=new Set(y);q.has(V)?q.delete(V):q.add(V),A(q)},F=()=>{y.size===te.length?A(new Set):A(new Set(te.map(V=>V.id)))},I=V=>{const q=new Set(z);q.has(V)?q.delete(V):q.add(V),K(q)},P=()=>y.size>0?te.filter(V=>y.has(V.id)):te,j=V=>new Date(V).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),_=V=>new Date(V).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),C=V=>{switch(V){case"submitted":return"";case"reviewed":return"";case"draft":return"";default:return""}},ee=V=>{switch(V){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return V}},w=async()=>{const V=P();if(V.length===0){o?.("No reports to export","error");return}o?.("Generating PDF...","info");const q=new Mi,L=q.internal.pageSize.getWidth(),$=20;let xe=$;const be=bf(c?.primary_color||"#3B82F6"),Fe=bf(c?.secondary_color||"#1E40AF");q.setFillColor(...be),q.rect(0,0,L,45,"F"),q.setFillColor(...Fe),q.rect(0,42,L,3,"F");let ye=$;if(c?.logo_url)try{const De=await Cv(c.logo_url);De&&(q.addImage(De,"PNG",$,7,30,30),ye=$+40)}catch(De){console.error("Error adding logo:",De)}q.setTextColor(255,255,255),q.setFontSize(22),q.setFont("helvetica","bold"),q.text(i?.name||"Company Name",ye,20),q.setFontSize(10),q.setFont("helvetica","normal"),q.text("DAILY REPORTS SUMMARY",ye,30),q.setFontSize(9),q.text(`Generated: ${new Date().toLocaleDateString()}`,L-$,20,{align:"right"}),l.job_number&&q.text(`Job #: ${l.job_number}`,L-$,28,{align:"right"}),xe=55,q.setFillColor(248,250,252),q.rect($,xe-5,L-$*2,20,"F"),q.setTextColor(...be),q.setFontSize(14),q.setFont("helvetica","bold"),q.text(`Project: ${l.name}`,$+5,xe+7),q.setFontSize(10),q.setTextColor(100,100,100),q.text(`${V.length} Report${V.length!==1?"s":""}`,L-$-5,xe+7,{align:"right"}),xe+=25,V.forEach((De,nt)=>{xe>250&&(q.addPage(),xe=$),q.setFillColor(...be),q.setTextColor(255,255,255),q.rect($,xe,L-$*2,10,"F"),q.setFontSize(11),q.setFont("helvetica","bold"),q.text(j(De.report_date||De.created_at),$+5,xe+7),q.text(ee(De.status),L-$-5,xe+7,{align:"right"}),xe+=15,q.setTextColor(50,50,50),q.setFontSize(10),q.setFont("helvetica","normal");const Vt=`Crew: ${De.crew_count||0}  |  Tasks: ${De.tasks_completed||0}  |  T&M: ${De.tm_tickets_count||0}  |  Photos: ${De.photos_count||0}`;if(q.text(Vt,$+5,xe),xe+=8,De.crew_list?.length>0){q.setFont("helvetica","bold"),q.text("Crew:",$+5,xe),q.setFont("helvetica","normal");const ke=De.crew_list.map(Ae=>`${Ae.name} (${Ae.role})`).join(", "),ze=q.splitTextToSize(ke,L-$*2-30);q.text(ze,$+25,xe),xe+=ze.length*5+3}if(De.field_notes){q.setFont("helvetica","bold"),q.text("Notes:",$+5,xe),q.setFont("helvetica","normal");const ke=q.splitTextToSize(De.field_notes,L-$*2-30);q.text(ke,$+25,xe),xe+=ke.length*5+3}if(De.issues){q.setTextColor(180,50,50),q.setFont("helvetica","bold"),q.text("Issues:",$+5,xe),q.setFont("helvetica","normal");const ke=q.splitTextToSize(De.issues,L-$*2-30);q.text(ke,$+25,xe),q.setTextColor(50,50,50),xe+=ke.length*5+3}xe+=10});const We=q.internal.getNumberOfPages();for(let De=1;De<=We;De++)q.setPage(De),q.setFontSize(8),q.setTextColor(150,150,150),q.text(`Page ${De} of ${We}`,L/2,q.internal.pageSize.getHeight()-10,{align:"center"});const Ve=`${l.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;q.save(Ve),o?.("PDF exported!","success")},k=V=>e.jsxs("div",{className:`daily-report-card ${V.status} ${y.has(V.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>v(f===V.id?null:V.id),children:[Y&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:y.has(V.id),onChange:q=>{q.stopPropagation(),Q(V.id)},onClick:q=>q.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:j(V.report_date||V.created_at)}),e.jsxs("span",{className:`report-status ${V.status}`,children:[C(V.status)," ",ee(V.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[V.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[V.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:f===V.id?"":""})]})]}),f===V.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:V.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:V.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:V.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:V.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),V.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:V.crew_list.map((q,L)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:q.name}),e.jsx("span",{className:"crew-role",children:q.role})]},L))})]}),V.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:V.completed_tasks.map((q,L)=>e.jsxs("li",{children:[q.name,q.group&&e.jsx("span",{className:"task-group",children:q.group})]},L))})]}),V.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:V.field_notes})]}),V.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:V.issues})]}),V.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",V.submitted_by||"Field"," at ",_(V.submitted_at)]})})]})]},V.id);if(x)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});const M=m.length,he=te.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${Y?"btn-primary":"btn-secondary"}`,onClick:Z,children:Y?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:w,children:["PDF",y.size>0?` (${y.size})`:""]})]})})]}),m.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${H==="recent"?"active":""}`,onClick:()=>U("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${H==="all"?"active":""}`,onClick:()=>U("all"),children:["All (",M,")"]})]}),H==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(rr,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:E.start,onChange:V=>D(q=>({...q,start:V.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:E.end,onChange:V=>D(q=>({...q,end:V.target.value})),className:"date-input"}),(E.start||E.end)&&e.jsx("button",{className:"date-clear",onClick:()=>D({start:"",end:""}),children:"Clear"})]})]}),Y&&te.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:y.size===te.length&&te.length>0,onChange:F}),"Select All (",te.length,")"]}),y.size>0&&e.jsxs("span",{className:"selected-count",children:[y.size," selected"]})]}),m.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Ra,{size:32})}),e.jsx("p",{children:"No daily reports yet"}),e.jsx("small",{children:"Reports from the field will appear here"})]}):te.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Ra,{size:32})}),e.jsx("p",{children:"No reports in this time period"}),e.jsx("small",{children:H==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"})]}):H==="recent"?e.jsxs("div",{className:"daily-reports",children:[te.map(V=>k(V)),M>he&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>U("all"),children:["View All ",M," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:se?.map(([V,{label:q,reports:L}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>I(V),children:[z.has(V)?e.jsx(Ps,{size:18,className:"month-chevron"}):e.jsx(yn,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:q}),e.jsxs("span",{className:"month-count",children:[L.length," report",L.length!==1?"s":""]})]}),z.has(V)&&e.jsx("div",{className:"month-reports",children:L.map($=>k($))})]},V))})]})}function kv({project:l,company:i,userName:o,onShowToast:c}){const[m,u]=p.useState([]),[x,g]=p.useState(!0),[f,v]=p.useState(!1),[y,A]=p.useState(""),[Y,B]=p.useState(0),[H,U]=p.useState(!1),z=p.useRef(null);p.useEffect(()=>{K();const se=de.subscribeToMessages?.(l.id,Z=>{Z.new&&(u(Q=>[...Q,Z.new]),Z.new.sender_type==="field"&&B(Q=>Q+1))});return()=>{se&&de.unsubscribe?.(se)}},[l.id]),p.useEffect(()=>{H&&(z.current?.scrollIntoView({behavior:"smooth"}),de.markMessagesRead?.(l.id,"office"),B(0))},[m,H]);const K=async()=>{try{const Z=(await de.getMessages(l.id,50)||[]).sort((F,I)=>new Date(F.created_at)-new Date(I.created_at));u(Z);const Q=Z.filter(F=>F.sender_type==="field"&&!F.is_read).length;B(Q)}catch(se){console.error("Error loading messages:",se)}finally{g(!1)}},E=async()=>{if(y.trim()){v(!0);try{const se=await de.sendMessage(l.id,y.trim(),"office",o||"Office");u(Z=>[...Z,se]),A("")}catch(se){console.error("Error sending message:",se),c?.("Error sending message","error")}finally{v(!1)}}},D=se=>{se.key==="Enter"&&!se.shiftKey&&(se.preventDefault(),E())},S=se=>{const Z=new Date(se),Q=new Date;return Z.toDateString()===Q.toDateString()?Z.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):Z.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})},te=m.slice(-3);return x?e.jsxs("div",{className:"project-messages card",children:[e.jsx("div",{className:"project-messages-header",children:e.jsx("h3",{children:"Messages"})}),e.jsx("div",{className:"loading",children:"Loading messages..."})]}):e.jsxs("div",{className:`project-messages card ${H?"expanded":""}`,children:[e.jsxs("div",{className:"project-messages-header",onClick:()=>U(!H),children:[e.jsxs("div",{className:"messages-title-row",children:[e.jsx("h3",{children:"Messages"}),Y>0&&e.jsxs("span",{className:"messages-unread-badge",children:[Y," new"]})]}),e.jsx("button",{className:"messages-toggle-btn",children:H?" Collapse":" Expand"})]}),!H&&m.length>0&&e.jsxs("div",{className:"messages-preview",children:[te.map(se=>e.jsxs("div",{className:`preview-message ${se.sender_type}`,children:[e.jsxs("span",{className:"preview-sender",children:[se.sender_type==="office"?e.jsx(rl,{size:12,className:"inline-icon"}):e.jsx(na,{size:12,className:"inline-icon"})," ",se.sender_name,":"]}),e.jsxs("span",{className:"preview-text",children:[se.message?.slice(0,50),se.message?.length>50?"...":""]})]},se.id)),m.length===0&&e.jsx("p",{className:"no-messages-hint",children:"No messages yet. Click to start chatting."})]}),H&&e.jsxs("div",{className:"messages-full",children:[e.jsxs("div",{className:"messages-list-container",children:[m.length===0?e.jsxs("div",{className:"messages-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(fs,{size:32})}),e.jsx("p",{children:"No messages yet"}),e.jsx("small",{children:"Send a message to the field crew"})]}):m.map(se=>e.jsxs("div",{className:`message-bubble ${se.sender_type==="office"?"sent":"received"}`,children:[e.jsxs("div",{className:"message-sender",children:[se.sender_type==="office"?e.jsx(rl,{size:14,className:"inline-icon"}):e.jsx(na,{size:14,className:"inline-icon"})," ",se.sender_name]}),e.jsx("div",{className:"message-text",children:se.message}),se.photo_url&&e.jsx("img",{src:se.photo_url,alt:"Attached",className:"message-photo"}),e.jsx("div",{className:"message-time",children:S(se.created_at)})]},se.id)),e.jsx("div",{ref:z})]}),e.jsxs("div",{className:"messages-input-row",children:[e.jsx("textarea",{value:y,onChange:se=>A(se.target.value),onKeyDown:D,placeholder:"Type a message...",rows:1,disabled:f}),e.jsx("button",{className:"btn btn-primary send-btn",onClick:E,disabled:f||!y.trim(),children:f?"...":"Send"})]})]})]})}function Ev({project:l,company:i,onShowToast:o}){const[c,m]=p.useState(null),[u,x]=p.useState(!0),[g,f]=p.useState(!1);p.useEffect(()=>{if(l?.id&&i?.id){v();const H=de.subscribeToCrewCheckins?.(l.id,()=>{v()});return()=>{H&&de.unsubscribe?.(H)}}},[l?.id,i?.id]);const v=async()=>{try{const H=await de.calculateManDayCosts(l.id,i.id,l.work_type||"demolition",l.job_type||"standard");m(H)}catch(H){console.error("Error loading man day costs:",H)}finally{x(!1)}},y=H=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(H),A=H=>new Date(H).toLocaleDateString("en-US",{month:"short",day:"numeric"}),Y=H=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[H]||H.charAt(0).toUpperCase()+H.slice(1);if(u)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!c||c.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(na,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const B=Object.entries(c.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>f(!g),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:y(c.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:g?" Collapse":" Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:c.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:c.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:y(c.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:c.daysWorked>0?y(c.totalCost/c.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),g&&e.jsxs("div",{className:"man-day-details",children:[B.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:B.map(([H,U])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:Y(H)}),e.jsxs("span",{className:"role-rate",children:[y(U.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[U.count," days"]}),e.jsx("span",{className:"role-cost",children:y(U.cost)})]})]},H))})]}),c.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:c.byDate.slice(0,7).map((H,U)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:A(H.date)}),e.jsxs("span",{className:"date-workers",children:[H.workers," crew"]}),e.jsx("span",{className:"date-cost",children:y(H.cost)})]},U))}),c.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",c.byDate.length-7," more days"]})]})]})]})}const sa=l=>((l||0)/100).toFixed(2),we=l=>{const i=(l||0)/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(i)},ps=l=>Math.round((parseFloat(l)||0)*100),Ys=l=>((l||0)/100).toFixed(2),wt=l=>`${Ys(l)}%`,pn=l=>Math.round((parseFloat(l)||0)*100),Dv=(l,i,o,c)=>{const m=parseFloat(l)||0,u=parseFloat(i)||0,x=parseInt(o)||0,g=parseInt(c)||0,f=Math.round(m*x),v=Math.round(u*g),y=f+v;return{regularTotal:f,overtimeTotal:v,total:y}},_f=(l,i)=>{const o=parseFloat(l)||0,c=parseInt(i)||0;return Math.round(o*c)},Ci=(l,i)=>{const o=parseInt(l)||0,c=parseInt(i)||0;return Math.round(o*c/1e4)},Jo=(l,i)=>{const o=parseInt(l)||0,c=parseInt(i)||0;return Math.round(o*c/1e4)},or=l=>{const i=(l.change_order_labor||[]).reduce((U,z)=>U+(parseInt(z.total)||0),0),o=(l.change_order_materials||[]).reduce((U,z)=>U+(parseInt(z.total)||0),0),c=(l.change_order_equipment||[]).reduce((U,z)=>U+(parseInt(z.total)||0),0),m=(l.change_order_subcontractors||[]).reduce((U,z)=>U+(parseInt(z.total)||0),0),u=Ci(i,l.labor_markup_percent||1500),x=Ci(o,l.materials_markup_percent||1500),g=Ci(c,l.equipment_markup_percent||1500),f=Ci(m,l.subcontractors_markup_percent||500),v=i+o+c+m+u+x+g+f,y=Jo(v,l.liability_insurance_percent||144),A=Jo(v,l.bond_percent||100),Y=Jo(v,l.license_fee_percent||10),B=y+A+Y,H=v+B;return{labor_subtotal:i,materials_subtotal:o,equipment_subtotal:c,subcontractors_subtotal:m,labor_markup_amount:u,materials_markup_amount:x,equipment_markup_amount:g,subcontractors_markup_amount:f,liability_insurance_amount:y,bond_amount:A,license_fee_amount:Y,additional_fees_total:B,cor_subtotal:v,cor_total:H}},Io=l=>{const i=[];if(l.title?.trim()||i.push("Title is required"),l.scope_of_work?.trim()||i.push("Scope of work is required"),l.period_start||i.push("Start date is required"),l.period_end||i.push("End date is required"),l.period_start&&l.period_end){const f=new Date(l.period_start);new Date(l.period_end)<f&&i.push("End date must be after start date")}const o=(l.change_order_labor||[]).length>0,c=(l.change_order_materials||[]).length>0,m=(l.change_order_equipment||[]).length>0,u=(l.change_order_subcontractors||[]).length>0;!o&&!c&&!m&&!u&&i.push("At least one line item (labor, materials, equipment, or subcontractor) is required"),or(l).cor_total<=0&&i.push("COR total must be greater than zero");const g=5e3;return l.labor_markup_percent>g&&i.push("Labor markup percentage seems too high (>50%)"),l.materials_markup_percent>g&&i.push("Materials markup percentage seems too high (>50%)"),l.equipment_markup_percent>g&&i.push("Equipment markup percentage seems too high (>50%)"),l.subcontractors_markup_percent>g&&i.push("Subcontractors markup percentage seems too high (>50%)"),{valid:i.length===0,errors:i}},tp=l=>{const i={draft:{label:"Draft",color:"#6b7280",bgColor:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bgColor:"#fef3c7"},approved:{label:"Approved",color:"#059669",bgColor:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bgColor:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bgColor:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bgColor:"#e5e7eb"}};return i[l]||i.draft},Xa=l=>l?new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",Ai=(l,i)=>{const o=Xa(l),c=Xa(i);return o&&c?`${o} - ${c}`:o||c||""},gn={labor_markup:1500,materials_markup:1500,equipment_markup:1500,subcontractors_markup:500,liability_insurance:144,bond:100,license_fee:10},Nf=["Foreman","Superintendent","Operator","Laborer"],Mv=[{value:"standard",label:"Standard"},{value:"pla",label:"PLA (Project Labor Agreement)"},{value:"prevailing",label:"Prevailing Wage"}],Ko={materials:[{value:"backup_sheet",label:"Backup Sheet"},{value:"invoice",label:"Invoice"},{value:"mobilization",label:"Mobilization"},{value:"custom",label:"Custom Entry"}],equipment:[{value:"backup_sheet",label:"Backup Sheet"},{value:"invoice",label:"Invoice"},{value:"custom",label:"Custom Entry"}],subcontractors:[{value:"invoice",label:"Invoice"},{value:"quote",label:"Quote"},{value:"custom",label:"Custom Entry"}]},Sf=["each","day","week","month","hour","sqft","lf","gallon","pound","ton","cy","lump sum"];function Tv({project:l,company:i,areas:o,refreshKey:c,onShowToast:m,onCreateCOR:u,onViewCOR:x,onEditCOR:g}){const[f,v]=p.useState([]),[y,A]=p.useState(!0),[Y,B]=p.useState("all"),[H,U]=p.useState("all"),[z,K]=p.useState(null),[E,D]=p.useState(new Set),[S,te]=p.useState("recent"),[se,Z]=p.useState(new Set),[Q,F]=p.useState({start:"",end:""}),[I,P]=p.useState(null);p.useEffect(()=>{j(),_();const L=de.subscribeToCORs?.(l.id,()=>{j(),_()});return()=>{L&&de.unsubscribe?.(L)}},[l.id,c]);const j=async()=>{try{const L=await de.getCORs(l.id);v(L||[])}catch(L){console.error("Error loading CORs:",L),m?.("Error loading change order requests","error")}finally{A(!1)}},_=async()=>{try{const L=await de.getCORStats?.(l.id);P(L)}catch(L){console.error("Error loading COR stats:",L)}},C=async(L,$)=>{if($?.stopPropagation(),!!confirm("Are you sure you want to delete this COR? This action cannot be undone."))try{await de.deleteCOR(L),v(f.filter(xe=>xe.id!==L)),m?.("COR deleted","success"),_()}catch(xe){console.error("Error deleting COR:",xe),m?.("Error deleting COR","error")}},ee=async(L,$)=>{$?.stopPropagation();try{await de.submitCORForApproval(L),await j(),m?.("COR submitted for approval","success"),_()}catch(xe){console.error("Error submitting COR:",xe?.message||xe),m?.(xe?.message||"Error submitting COR","error")}},w=p.useMemo(()=>{let L=[...f];if(Y!=="all"&&(L=L.filter($=>$.status===Y)),H!=="all"&&(L=L.filter($=>$.area_id===H)),Q.start){const $=new Date(Q.start);$.setHours(0,0,0,0),L=L.filter(xe=>new Date(xe.created_at)>=$)}if(Q.end){const $=new Date(Q.end);$.setHours(23,59,59,999),L=L.filter(xe=>new Date(xe.created_at)<=$)}if(S==="recent"){const $=new Date;$.setDate($.getDate()-7),$.setHours(0,0,0,0),L=L.filter(xe=>new Date(xe.created_at)>=$)}return L.sort(($,xe)=>new Date(xe.created_at)-new Date($.created_at)),L},[f,Y,H,S,Q]),k=p.useMemo(()=>{if(S!=="all")return null;const L={};return w.forEach($=>{const xe=new Date($.created_at),be=`${xe.getFullYear()}-${String(xe.getMonth()+1).padStart(2,"0")}`,Fe=xe.toLocaleDateString("en-US",{month:"long",year:"numeric"});L[be]||(L[be]={label:Fe,cors:[],totalAmount:0}),L[be].cors.push($),L[be].totalAmount+=$.cor_total||0}),Object.entries(L).sort(($,xe)=>xe[0].localeCompare($[0]))},[w,S]);p.useEffect(()=>{if(k&&k.length>0){const L=k[0][0];Z(new Set([L]))}},[k]);const M=L=>{const $=new Set(se);$.has(L)?$.delete(L):$.add(L),Z($)},he=p.useMemo(()=>({all:f.length,draft:f.filter(L=>L.status==="draft").length,pending_approval:f.filter(L=>L.status==="pending_approval").length,approved:f.filter(L=>L.status==="approved").length,rejected:f.filter(L=>L.status==="rejected").length,billed:f.filter(L=>L.status==="billed").length,closed:f.filter(L=>L.status==="closed").length}),[f]);Y==="all"?f.length:f.filter(L=>L.status===Y).length;const V=L=>o?.find(xe=>xe.id===L)?.name||"No Area",q=L=>{const $=tp(L.status);L.id;const xe=L.status==="draft",be=["draft","pending_approval","rejected"].includes(L.status),Fe=L.status==="draft";return e.jsxs("div",{className:`cor-card ${L.status}`,onClick:()=>x?.(L),onKeyDown:ye=>{(ye.key==="Enter"||ye.key===" ")&&(ye.preventDefault(),x?.(L))},tabIndex:0,role:"button","aria-label":`View COR ${L.cor_number}: ${L.title||"Untitled"}, ${$.label}, ${we(L.cor_total||0)}`,children:[e.jsxs("div",{className:"cor-card-header",children:[e.jsxs("div",{className:"cor-card-left",children:[e.jsx("span",{className:"cor-number",children:L.cor_number}),e.jsx("span",{className:"cor-status-badge",style:{backgroundColor:$.bgColor,color:$.color},children:$.label})]}),e.jsx("div",{className:"cor-card-right",children:e.jsx("span",{className:"cor-total",children:we(L.cor_total||0)})})]}),e.jsxs("div",{className:"cor-card-body",children:[e.jsx("h4",{className:"cor-title",children:L.title||"Untitled COR"}),e.jsxs("div",{className:"cor-meta",children:[L.area_id&&e.jsx("span",{className:"cor-area",children:V(L.area_id)}),e.jsx("span",{className:"cor-period",children:Ai(L.period_start,L.period_end)})]})]}),e.jsxs("div",{className:"cor-card-footer",children:[e.jsx("span",{className:"cor-created",children:Xa(L.created_at)}),e.jsxs("div",{className:"cor-actions",onClick:ye=>ye.stopPropagation(),children:[Fe&&e.jsx("button",{className:"cor-action-btn submit",onClick:ye=>ee(L.id,ye),title:"Submit for Approval","aria-label":`Submit COR ${L.cor_number} for approval`,children:e.jsx(Zf,{size:14,"aria-hidden":"true"})}),xe&&e.jsx("button",{className:"cor-action-btn edit",onClick:ye=>{ye.stopPropagation(),g?.(L)},title:"Edit","aria-label":`Edit COR ${L.cor_number}`,children:e.jsx(dd,{size:14,"aria-hidden":"true"})}),e.jsx("button",{className:"cor-action-btn view",onClick:ye=>{ye.stopPropagation(),x?.(L)},title:"View Details","aria-label":`View COR ${L.cor_number} details`,children:e.jsx(mj,{size:14,"aria-hidden":"true"})}),be&&e.jsx("button",{className:"cor-action-btn delete",onClick:ye=>C(L.id,ye),title:"Delete","aria-label":`Delete COR ${L.cor_number}`,children:e.jsx(gs,{size:14,"aria-hidden":"true"})})]})]})]},L.id)};return y?e.jsx("div",{className:"loading",children:"Loading change order requests..."}):e.jsxs("div",{className:"cor-list",children:[e.jsxs("div",{className:"cor-list-header",children:[e.jsxs("div",{className:"cor-list-info",children:[e.jsx("h3",{children:"Change Orders"}),e.jsxs("div",{className:"cor-stats-inline",children:[e.jsxs("span",{className:"cor-stat-item",children:[he.all," total"]}),he.pending_approval>0&&e.jsxs("span",{className:"cor-stat-item pending",children:[he.pending_approval," pending"]}),I?.totalApproved>0&&e.jsx("span",{className:"cor-stat-item approved",children:we(I.totalApproved)})]})]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:u,children:[e.jsx(La,{size:14})," New COR"]})]}),e.jsxs("div",{className:"cor-controls",children:[e.jsx("div",{className:"cor-filter-pills",role:"tablist",children:[{id:"all",label:"All"},{id:"draft",label:"Draft"},{id:"pending_approval",label:"Pending"},{id:"approved",label:"Approved"}].map(L=>e.jsxs("button",{role:"tab","aria-selected":Y===L.id,className:`cor-pill ${Y===L.id?"active":""}`,onClick:()=>B(L.id),children:[L.label,he[L.id]>0&&e.jsx("span",{className:"cor-pill-count",children:he[L.id]})]},L.id))}),e.jsxs("div",{className:"cor-view-toggle",children:[e.jsx("button",{className:`cor-toggle-btn ${S==="recent"?"active":""}`,onClick:()=>{te("recent"),F({start:"",end:""})},children:"Recent"}),e.jsx("button",{className:`cor-toggle-btn ${S==="all"?"active":""}`,onClick:()=>te("all"),children:"All"})]})]}),S==="all"&&e.jsxs("div",{className:"cor-date-filter",children:[e.jsx(rr,{size:14}),e.jsx("input",{type:"date",value:Q.start,onChange:L=>F($=>({...$,start:L.target.value}))}),e.jsx("span",{className:"cor-date-sep",children:"to"}),e.jsx("input",{type:"date",value:Q.end,onChange:L=>F($=>({...$,end:L.target.value}))}),(Q.start||Q.end)&&e.jsx("button",{className:"cor-clear-btn",onClick:()=>F({start:"",end:""}),children:"Clear"})]}),w.length===0?e.jsxs("div",{className:"cor-empty",children:[e.jsx(za,{size:24,className:"cor-empty-icon"}),e.jsxs("p",{children:["No change orders ",Y!=="all"?`(${Y.replace("_"," ")})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:u,children:[e.jsx(La,{size:14})," Create COR"]})]}):e.jsx("div",{className:"cor-cards",children:S==="all"&&k?k.map(([L,$])=>e.jsxs("div",{className:"cor-month-group",children:[e.jsxs("button",{className:"cor-month-header",onClick:()=>M(L),children:[e.jsxs("div",{className:"cor-month-left",children:[se.has(L)?e.jsx(Ps,{size:16}):e.jsx(yn,{size:16}),e.jsx("span",{children:$.label}),e.jsx("span",{className:"cor-month-count",children:$.cors.length})]}),e.jsx("span",{className:"cor-month-total",children:we($.totalAmount)})]}),se.has(L)&&e.jsx("div",{className:"cor-month-items",children:$.cors.map(xe=>q(xe))})]},L)):w.map(L=>q(L))})]})}function Av({projectId:l,corId:i,onImport:o,onClose:c,onShowToast:m}){const[u,x]=p.useState([]),[g,f]=p.useState(!0),[v,y]=p.useState(new Set),[A,Y]=p.useState(null),[B,H]=p.useState(""),[U,z]=p.useState("unassigned");p.useEffect(()=>{K()},[l]);const K=async()=>{try{const Q=await de.getTMTickets(l);x(Q||[])}catch(Q){console.error("Error loading tickets:",Q),m?.("Error loading tickets","error")}finally{f(!1)}},E=p.useMemo(()=>{let Q=[...u];if(U==="unassigned"?Q=Q.filter(F=>!F.assigned_cor_id):U==="approved"&&(Q=Q.filter(F=>F.status==="approved")),B){const F=B.toLowerCase();Q=Q.filter(I=>I.work_description?.toLowerCase().includes(F)||I.ce_pco_number?.toLowerCase().includes(F)||I.ticket_date?.includes(F))}return Q.sort((F,I)=>new Date(I.ticket_date)-new Date(F.ticket_date)),Q},[u,U,B]),D=Q=>{const F=new Set(v);F.has(Q)?F.delete(Q):F.add(Q),y(F)},S=()=>{v.size===E.length?y(new Set):y(new Set(E.map(Q=>Q.id)))},te=Q=>new Date(Q).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),se=Q=>{const F=Q.workers?.length||0,I=Q.items?.length||0,P=Q.materials_equipment?.filter(_=>_.type==="equipment")?.length||0;let j=0;return Q.workers?.forEach(_=>{j+=(parseFloat(_.regular_hours)||0)+(parseFloat(_.overtime_hours)||0)}),{workerCount:F,itemCount:I,equipmentCount:P,laborHours:j}},Z=()=>{if(v.size===0){m?.("Please select at least one ticket","error");return}const Q=u.filter(j=>v.has(j.id)),F=[],I=[],P=[];Q.forEach(j=>{j.workers?.forEach(_=>{F.push({id:`import-${j.id}-${_.id||Date.now()}`,labor_class:_.role||"Laborer",wage_type:"standard",regular_hours:parseFloat(_.regular_hours)||0,overtime_hours:parseFloat(_.overtime_hours)||0,regular_rate:0,overtime_rate:0,total:0,source_ticket_id:j.id,source_ticket_date:j.ticket_date})}),j.items?.forEach(_=>{I.push({id:`import-${j.id}-${_.id||Date.now()}`,description:_.description||_.name,source_type:"backup_sheet",source_reference:`Ticket ${te(j.ticket_date)}`,quantity:parseFloat(_.quantity)||1,unit:_.unit||"each",unit_cost:ps(_.unit_cost||0),total:ps((_.quantity||1)*(_.unit_cost||0)),source_ticket_id:j.id})}),j.materials_equipment?.filter(_=>_.type==="equipment").forEach(_=>{P.push({id:`import-${j.id}-${_.id||Date.now()}`,description:_.description||_.name,source_type:"backup_sheet",source_reference:`Ticket ${te(j.ticket_date)}`,quantity:parseFloat(_.quantity)||1,unit:_.unit||"day",unit_cost:ps(_.unit_cost||_.cost||0),total:ps((_.quantity||1)*(_.unit_cost||_.cost||0)),source_ticket_id:j.id})})}),o?.({ticketIds:Array.from(v),laborItems:F,materialsItems:I,equipmentItems:P}),c?.()};return g?e.jsx("div",{className:"modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-label":"Loading tickets",children:e.jsx("div",{className:"modal-content ticket-selector-modal",onClick:Q=>Q.stopPropagation(),children:e.jsx("div",{className:"loading",role:"status","aria-live":"polite",children:"Loading tickets..."})})}):e.jsx("div",{className:"modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-labelledby":"ticket-selector-title",children:e.jsxs("div",{className:"modal-content ticket-selector-modal",onClick:Q=>Q.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"ticket-selector-title",children:"Import from T&M Tickets"}),e.jsx("button",{className:"close-btn",onClick:c,"aria-label":"Close ticket selector",children:e.jsx(_n,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"ticket-selector-controls",children:[e.jsxs("div",{className:"ticket-search",children:[e.jsx(Fj,{size:16,"aria-hidden":"true"}),e.jsx("input",{type:"text",placeholder:"Search tickets...",value:B,onChange:Q=>H(Q.target.value),"aria-label":"Search tickets"})]}),e.jsxs("div",{className:"ticket-filters",role:"group","aria-label":"Filter tickets by status",children:[e.jsx("button",{className:`filter-btn ${U==="unassigned"?"active":""}`,onClick:()=>z("unassigned"),"aria-pressed":U==="unassigned",children:"Unassigned"}),e.jsx("button",{className:`filter-btn ${U==="approved"?"active":""}`,onClick:()=>z("approved"),"aria-pressed":U==="approved",children:"Approved"}),e.jsx("button",{className:`filter-btn ${U==="all"?"active":""}`,onClick:()=>z("all"),"aria-pressed":U==="all",children:"All"})]})]}),e.jsxs("div",{className:"ticket-selector-header",children:[e.jsxs("label",{className:"select-all",children:[e.jsx("input",{type:"checkbox",checked:v.size===E.length&&E.length>0,onChange:S,"aria-label":`Select all ${E.length} tickets`}),e.jsxs("span",{children:["Select All (",E.length,")"]})]}),e.jsxs("span",{className:"selected-count",children:[v.size," selected"]})]}),e.jsx("div",{className:"modal-body ticket-selector-body",children:E.length===0?e.jsxs("div",{className:"ticket-empty",children:[e.jsx(za,{size:32}),e.jsx("p",{children:"No tickets found"}),U==="unassigned"&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>z("all"),children:"Show all tickets"})]}):e.jsx("div",{className:"ticket-list",children:E.map(Q=>{const F=se(Q),I=v.has(Q.id),P=A===Q.id;return e.jsxs("div",{className:`ticket-item ${I?"selected":""} ${Q.assigned_cor_id?"assigned":""}`,children:[e.jsxs("div",{className:"ticket-item-main",children:[e.jsx("label",{className:"ticket-checkbox",children:e.jsx("input",{type:"checkbox",checked:I,onChange:()=>D(Q.id),disabled:Q.assigned_cor_id&&Q.assigned_cor_id!==i})}),e.jsxs("div",{className:"ticket-item-info",onClick:()=>Y(P?null:Q.id),children:[e.jsxs("div",{className:"ticket-item-header",children:[e.jsx("span",{className:"ticket-date",children:te(Q.ticket_date)}),e.jsx("span",{className:`ticket-status ${Q.status}`,children:Q.status}),Q.ce_pco_number&&e.jsxs("span",{className:"ticket-pco",children:["CE/PCO: ",Q.ce_pco_number]})]}),e.jsx("div",{className:"ticket-item-desc",children:Q.work_description||"No description"}),e.jsxs("div",{className:"ticket-item-summary",children:[F.workerCount>0&&e.jsxs("span",{children:[e.jsx(ir,{size:12})," ",F.workerCount," workers"]}),F.itemCount>0&&e.jsxs("span",{children:[e.jsx(Za,{size:12})," ",F.itemCount," items"]}),F.equipmentCount>0&&e.jsxs("span",{children:[e.jsx(bn,{size:12})," ",F.equipmentCount," equipment"]}),F.laborHours>0&&e.jsxs("span",{children:[F.laborHours," hrs"]})]})]}),e.jsx("button",{className:"ticket-expand-btn",onClick:()=>Y(P?null:Q.id),children:P?e.jsx(Ps,{size:16}):e.jsx(yn,{size:16})})]}),P&&e.jsxs("div",{className:"ticket-item-details",children:[Q.workers?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Workers"}),e.jsx("ul",{children:Q.workers.map((j,_)=>e.jsxs("li",{children:[j.name||j.role," - ",j.regular_hours||0," reg hrs",j.overtime_hours>0&&`, ${j.overtime_hours} OT hrs`]},_))})]}),Q.items?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Materials"}),e.jsx("ul",{children:Q.items.map((j,_)=>e.jsxs("li",{children:[j.description||j.name," - ",j.quantity," ",j.unit]},_))})]}),Q.materials_equipment?.filter(j=>j.type==="equipment").length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Equipment"}),e.jsx("ul",{children:Q.materials_equipment.filter(j=>j.type==="equipment").map((j,_)=>e.jsx("li",{children:j.description||j.name},_))})]})]})]},Q.id)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:c,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:Z,disabled:v.size===0,children:[e.jsx(nr,{size:16})," Import ",v.size," Ticket",v.size!==1?"s":""]})]})]})})}const wi=[{id:1,label:"Title & Info",shortLabel:"Info"},{id:2,label:"Period",shortLabel:"Period"},{id:3,label:"Labor",shortLabel:"Labor"},{id:4,label:"Materials",shortLabel:"Materials"},{id:5,label:"Equipment",shortLabel:"Equipment"},{id:6,label:"Subcontractors",shortLabel:"Subs"},{id:7,label:"Markups & Fees",shortLabel:"Markups"},{id:8,label:"Summary",shortLabel:"Summary"},{id:9,label:"Submit",shortLabel:"Submit"}];function Rv({project:l,company:i,areas:o,existingCOR:c,onClose:m,onSaved:u,onShowToast:x}){const[g,f]=p.useState(1),[v,y]=p.useState(!1),[A,Y]=p.useState([]),[B,H]=p.useState(!1),[U,z]=p.useState(c?.title||""),[K,E]=p.useState(c?.scope_of_work||""),[D,S]=p.useState(c?.area_id||""),[te,se]=p.useState(c?.cor_number||""),[Z,Q]=p.useState(c?.period_start||""),[F,I]=p.useState(c?.period_end||""),[P,j]=p.useState(c?.change_order_labor||[]),[_,C]=p.useState(c?.change_order_materials||[]),[ee,w]=p.useState(c?.change_order_equipment||[]),[k,M]=p.useState(c?.change_order_subcontractors||[]),[he,V]=p.useState(c?.labor_markup_percent??gn.labor_markup),[q,L]=p.useState(c?.materials_markup_percent??gn.materials_markup),[$,xe]=p.useState(c?.equipment_markup_percent??gn.equipment_markup),[be,Fe]=p.useState(c?.subcontractors_markup_percent??gn.subcontractors_markup),[ye,We]=p.useState(c?.liability_insurance_percent??gn.liability_insurance),[Ve,De]=p.useState(c?.bond_percent??gn.bond),[nt,Vt]=p.useState(c?.license_fee_percent??gn.license_fee);p.useEffect(()=>{ke(),c||Ae()},[]);const ke=async()=>{try{const ne=await de.getLaborRates?.(i?.id,l?.work_type,l?.job_type);Y(ne||[])}catch(ne){console.error("Error loading labor rates:",ne)}},ze=ne=>{const Ne=ne?.toLowerCase()||"";return A.find(pe=>pe.role?.toLowerCase()===Ne)||null},Ae=async()=>{try{const ne=await de.getNextCORNumber?.(l.id);se(ne||`COR-${Date.now()}`)}catch(ne){console.error("Error generating COR number:",ne),se(`COR-${Date.now()}`)}},Me=p.useMemo(()=>({title:U,scope_of_work:K,area_id:D||null,cor_number:te,period_start:Z,period_end:F,change_order_labor:P,change_order_materials:_,change_order_equipment:ee,change_order_subcontractors:k,labor_markup_percent:he,materials_markup_percent:q,equipment_markup_percent:$,subcontractors_markup_percent:be,liability_insurance_percent:ye,bond_percent:Ve,license_fee_percent:nt}),[U,K,D,te,Z,F,P,_,ee,k,he,q,$,be,ye,Ve,nt]),Ce=p.useMemo(()=>or(Me),[Me]),Xe=ne=>{switch(ne){case 1:return U.trim()?K.trim()?!0:(x?.("Scope of work is required","error"),!1):(x?.("Title is required","error"),!1);case 2:return Z?F?new Date(F)<new Date(Z)?(x?.("End date must be after start date","error"),!1):!0:(x?.("End date is required","error"),!1):(x?.("Start date is required","error"),!1);default:return!0}},X=()=>{Xe(g)&&f(Math.min(g+1,wi.length))},T=()=>{f(Math.max(g-1,1))},_e=ne=>{if(ne<g)f(ne);else if(ne>g){for(let Ne=g;Ne<ne;Ne++)if(!Xe(Ne))return;f(ne)}},Ee=()=>{const ne=Nf[0],Ne=ze(ne);j([...P,{id:`temp-${Date.now()}`,labor_class:ne,wage_type:"standard",regular_hours:0,overtime_hours:0,regular_rate:Ne?Math.round((parseFloat(Ne.regular_rate)||0)*100):0,overtime_rate:Ne?Math.round((parseFloat(Ne.overtime_rate)||0)*100):0,total:0}])},ae=(ne,Ne,pe)=>{const N=[...P];if(N[ne]={...N[ne],[Ne]:pe},Ne==="labor_class"){const ce=ze(pe);ce&&(N[ne].regular_rate=Math.round((parseFloat(ce.regular_rate)||0)*100),N[ne].overtime_rate=Math.round((parseFloat(ce.overtime_rate)||0)*100))}const{total:re}=Dv(N[ne].regular_hours,N[ne].overtime_hours,N[ne].regular_rate,N[ne].overtime_rate);N[ne].total=re,j(N)},Se=ne=>{j(P.filter((Ne,pe)=>pe!==ne))},ct=()=>{C([..._,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"each",unit_cost:0,total:0}])},Pe=(ne,Ne,pe)=>{const N=[..._];N[ne]={...N[ne],[Ne]:pe},N[ne].total=_f(N[ne].quantity,N[ne].unit_cost),C(N)},Ut=ne=>{C(_.filter((Ne,pe)=>pe!==ne))},Rt=()=>{w([...ee,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"day",unit_cost:0,total:0}])},ut=(ne,Ne,pe)=>{const N=[...ee];N[ne]={...N[ne],[Ne]:pe},N[ne].total=_f(N[ne].quantity,N[ne].unit_cost),w(N)},Gt=ne=>{w(ee.filter((Ne,pe)=>pe!==ne))},Lt=()=>{M([...k,{id:`temp-${Date.now()}`,company_name:"",description:"",source_type:"invoice",source_reference:"",amount:0,total:0}])},Et=(ne,Ne,pe)=>{const N=[...k];N[ne]={...N[ne],[Ne]:pe},Ne==="amount"&&(N[ne].total=parseInt(pe)||0),M(N)},et=ne=>{M(k.filter((Ne,pe)=>pe!==ne))},tt=ne=>{ne.laborItems?.length>0&&j([...P,...ne.laborItems]),ne.materialsItems?.length>0&&C([..._,...ne.materialsItems]),ne.equipmentItems?.length>0&&w([...ee,...ne.equipmentItems]),x?.(`Imported data from ${ne.ticketIds.length} ticket(s)`,"success")},xt=async()=>{y(!0);try{const ne={company_id:i.id,project_id:l.id,...Me,...Ce,status:"draft"};let Ne;c?.id?Ne=await de.updateCOR(c.id,ne):Ne=await de.createCOR(ne),Ne?.id&&await de.saveCORLineItems(Ne.id,{laborItems:P,materialItems:_,equipmentItems:ee,subcontractorItems:k}),x?.("COR saved as draft","success"),u?.(Ne),m?.()}catch(ne){console.error("Error saving COR:",ne),x?.("Error saving COR","error")}finally{y(!1)}},jt=async()=>{const ne=Io(Me);if(!ne.valid){x?.(ne.errors[0],"error");return}y(!0);try{const Ne={company_id:i.id,project_id:l.id,...Me,...Ce,status:"pending_approval"};let pe;c?.id?(pe=await de.updateCOR(c.id,{...Ne,status:"draft"}),await de.saveCORLineItems(c.id,{laborItems:P,materialItems:_,equipmentItems:ee,subcontractorItems:k}),await de.submitCORForApproval(c.id)):(pe=await de.createCOR({...Ne,status:"draft"}),pe?.id&&(await de.saveCORLineItems(pe.id,{laborItems:P,materialItems:_,equipmentItems:ee,subcontractorItems:k}),await de.submitCORForApproval(pe.id))),x?.("COR submitted for approval","success"),u?.(pe),m?.()}catch(Ne){console.error("Error submitting COR:",Ne),x?.("Error submitting COR","error")}finally{y(!1)}};return e.jsxs("div",{className:"modal-overlay",onClick:m,children:[e.jsxs("div",{className:"modal-content cor-form-modal",onClick:ne=>ne.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:c?"Edit Change Order Request":"New Change Order Request"}),e.jsx("button",{className:"close-btn",onClick:m,children:e.jsx(_n,{size:20})})]}),e.jsx("div",{className:"cor-progress-steps",children:wi.map(ne=>e.jsxs("div",{className:`cor-step ${g>=ne.id?"active":""} ${g===ne.id?"current":""}`,onClick:()=>_e(ne.id),children:[e.jsx("span",{className:"cor-step-number",children:ne.id}),e.jsx("span",{className:"cor-step-label",children:ne.shortLabel})]},ne.id))}),e.jsxs("div",{className:"modal-body cor-form-body",children:[g===1&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Basic Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"COR Number"}),e.jsx("input",{type:"text",value:te,onChange:ne=>se(ne.target.value),placeholder:"Auto-generated",className:"input-readonly",readOnly:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title *"}),e.jsx("input",{type:"text",value:U,onChange:ne=>z(ne.target.value),placeholder:"e.g., Additional Demolition Work - Building A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Scope of Work *"}),e.jsx("textarea",{value:K,onChange:ne=>E(ne.target.value),rows:4,placeholder:"Describe the scope of work covered by this change order..."})]}),o&&o.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Area (Optional)"}),e.jsxs("select",{value:D,onChange:ne=>S(ne.target.value),children:[e.jsx("option",{value:"",children:"No specific area"}),o.map(ne=>e.jsx("option",{value:ne.id,children:ne.name},ne.id))]})]})]}),g===2&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Work Period"}),e.jsx("p",{className:"step-description",children:"Specify the date range for this change order work."}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Start Date *"}),e.jsx("input",{type:"date",value:Z,onChange:ne=>Q(ne.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"End Date *"}),e.jsx("input",{type:"date",value:F,onChange:ne=>I(ne.target.value),min:Z})]})]})]}),g===3&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Labor"}),e.jsx("p",{className:"step-description",children:"Add labor costs for this change order."})]}),e.jsxs("div",{className:"step-header-actions",children:[e.jsxs("button",{className:"btn btn-ghost",onClick:()=>H(!0),children:[e.jsx(za,{size:16})," Import from Tickets"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:Ee,children:[e.jsx(La,{size:16})," Add Labor"]})]})]}),P.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No labor items added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:Ee,children:[e.jsx(La,{size:16})," Add First Labor Item"]})]}):e.jsx("div",{className:"line-items-list",children:P.map((ne,Ne)=>e.jsxs("div",{className:"line-item labor-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",Ne+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>Se(Ne),children:e.jsx(gs,{size:14})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Labor Class"}),e.jsx("select",{value:ne.labor_class,onChange:pe=>ae(Ne,"labor_class",pe.target.value),children:Nf.map(pe=>e.jsx("option",{value:pe,children:pe},pe))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Wage Type"}),e.jsx("select",{value:ne.wage_type,onChange:pe=>ae(Ne,"wage_type",pe.target.value),children:Mv.map(pe=>e.jsx("option",{value:pe.value,children:pe.label},pe.value))})]})]}),e.jsxs("div",{className:"form-row four-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reg Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:ne.regular_hours,onChange:pe=>ae(Ne,"regular_hours",pe.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reg Rate ($/hr)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:sa(ne.regular_rate),onChange:pe=>ae(Ne,"regular_rate",ps(pe.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"OT Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:ne.overtime_hours,onChange:pe=>ae(Ne,"overtime_hours",pe.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"OT Rate ($/hr)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:sa(ne.overtime_rate),onChange:pe=>ae(Ne,"overtime_rate",ps(pe.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:we(ne.total)})]})]},ne.id||Ne))}),e.jsxs("div",{className:"section-subtotal",children:["Labor Subtotal: ",e.jsx("strong",{children:we(Ce.labor_subtotal)})]})]}),g===4&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Materials"}),e.jsx("p",{className:"step-description",children:"Add material costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:ct,children:[e.jsx(La,{size:16})," Add Material"]})]}),_.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No materials added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:ct,children:[e.jsx(La,{size:16})," Add First Material"]})]}):e.jsx("div",{className:"line-items-list",children:_.map((ne,Ne)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",Ne+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>Ut(Ne),children:e.jsx(gs,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{type:"text",value:ne.description,onChange:pe=>Pe(Ne,"description",pe.target.value),placeholder:"Material description"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:ne.source_type,onChange:pe=>Pe(Ne,"source_type",pe.target.value),children:Ko.materials.map(pe=>e.jsx("option",{value:pe.value,children:pe.label},pe.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:ne.source_reference,onChange:pe=>Pe(Ne,"source_reference",pe.target.value),placeholder:"Ticket #, Invoice #"})]})]}),e.jsxs("div",{className:"form-row three-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ne.quantity,onChange:pe=>Pe(Ne,"quantity",pe.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit"}),e.jsx("select",{value:ne.unit,onChange:pe=>Pe(Ne,"unit",pe.target.value),children:Sf.map(pe=>e.jsx("option",{value:pe,children:pe},pe))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit Cost ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:sa(ne.unit_cost),onChange:pe=>Pe(Ne,"unit_cost",ps(pe.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:we(ne.total)})]})]},ne.id||Ne))}),e.jsxs("div",{className:"section-subtotal",children:["Materials Subtotal: ",e.jsx("strong",{children:we(Ce.materials_subtotal)})]})]}),g===5&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Equipment"}),e.jsx("p",{className:"step-description",children:"Add equipment rental costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:Rt,children:[e.jsx(La,{size:16})," Add Equipment"]})]}),ee.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No equipment added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:Rt,children:[e.jsx(La,{size:16})," Add First Equipment"]})]}):e.jsx("div",{className:"line-items-list",children:ee.map((ne,Ne)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",Ne+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>Gt(Ne),children:e.jsx(gs,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{type:"text",value:ne.description,onChange:pe=>ut(Ne,"description",pe.target.value),placeholder:"Equipment description"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:ne.source_type,onChange:pe=>ut(Ne,"source_type",pe.target.value),children:Ko.equipment.map(pe=>e.jsx("option",{value:pe.value,children:pe.label},pe.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:ne.source_reference,onChange:pe=>ut(Ne,"source_reference",pe.target.value),placeholder:"Ticket #, Invoice #"})]})]}),e.jsxs("div",{className:"form-row three-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:ne.quantity,onChange:pe=>ut(Ne,"quantity",pe.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit"}),e.jsx("select",{value:ne.unit,onChange:pe=>ut(Ne,"unit",pe.target.value),children:Sf.map(pe=>e.jsx("option",{value:pe,children:pe},pe))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit Cost ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:sa(ne.unit_cost),onChange:pe=>ut(Ne,"unit_cost",ps(pe.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:we(ne.total)})]})]},ne.id||Ne))}),e.jsxs("div",{className:"section-subtotal",children:["Equipment Subtotal: ",e.jsx("strong",{children:we(Ce.equipment_subtotal)})]})]}),g===6&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Subcontractors"}),e.jsx("p",{className:"step-description",children:"Add subcontractor costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:Lt,children:[e.jsx(La,{size:16})," Add Subcontractor"]})]}),k.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No subcontractors added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:Lt,children:[e.jsx(La,{size:16})," Add First Subcontractor"]})]}):e.jsx("div",{className:"line-items-list",children:k.map((ne,Ne)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",Ne+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>et(Ne),children:e.jsx(gs,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Company Name"}),e.jsx("input",{type:"text",value:ne.company_name,onChange:pe=>Et(Ne,"company_name",pe.target.value),placeholder:"Subcontractor company name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description of Work"}),e.jsx("input",{type:"text",value:ne.description,onChange:pe=>Et(Ne,"description",pe.target.value),placeholder:"Work performed"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:ne.source_type,onChange:pe=>Et(Ne,"source_type",pe.target.value),children:Ko.subcontractors.map(pe=>e.jsx("option",{value:pe.value,children:pe.label},pe.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:ne.source_reference,onChange:pe=>Et(Ne,"source_reference",pe.target.value),placeholder:"Invoice #, Quote #"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Amount ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:sa(ne.amount),onChange:pe=>Et(Ne,"amount",ps(pe.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:we(ne.total)})]})]},ne.id||Ne))}),e.jsxs("div",{className:"section-subtotal",children:["Subcontractors Subtotal: ",e.jsx("strong",{children:we(Ce.subcontractors_subtotal)})]})]}),g===7&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Markups & Fees"}),e.jsx("p",{className:"step-description",children:"Configure markup percentages and additional fees."}),e.jsxs("div",{className:"markups-section",children:[e.jsx("h4",{children:"Markups"}),e.jsxs("div",{className:"markups-grid",children:[e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Labor Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Ys(he),onChange:ne=>V(pn(ne.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",we(Ce.labor_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Materials Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Ys(q),onChange:ne=>L(pn(ne.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",we(Ce.materials_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Equipment Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Ys($),onChange:ne=>xe(pn(ne.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",we(Ce.equipment_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Subcontractors Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Ys(be),onChange:ne=>Fe(pn(ne.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",we(Ce.subcontractors_markup_amount)]})]})]})]}),e.jsxs("div",{className:"fees-section",children:[e.jsx("h4",{children:"Additional Fees"}),e.jsxs("div",{className:"fees-grid",children:[e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"Liability Insurance"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Ys(ye),onChange:ne=>We(pn(ne.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",we(Ce.liability_insurance_amount)]})]}),e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"Bond"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:Ys(Ve),onChange:ne=>De(pn(ne.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",we(Ce.bond_amount)]})]}),e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"City License Fee"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.001",min:"0",max:"100",value:Ys(nt),onChange:ne=>Vt(pn(ne.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",we(Ce.license_fee_amount)]})]})]})]})]}),g===8&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Summary"}),e.jsxs("div",{className:"cor-summary",children:[e.jsxs("div",{className:"summary-header",children:[e.jsx("div",{className:"summary-title",children:U||"Untitled COR"}),e.jsx("div",{className:"summary-number",children:te})]}),e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"Costs Breakdown"}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Labor (",P.length," items)"]}),e.jsx("span",{children:we(Ce.labor_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",wt(he),")"]}),e.jsx("span",{children:we(Ce.labor_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Materials (",_.length," items)"]}),e.jsx("span",{children:we(Ce.materials_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",wt(q),")"]}),e.jsx("span",{children:we(Ce.materials_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Equipment (",ee.length," items)"]}),e.jsx("span",{children:we(Ce.equipment_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",wt($),")"]}),e.jsx("span",{children:we(Ce.equipment_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Subcontractors (",k.length," items)"]}),e.jsx("span",{children:we(Ce.subcontractors_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",wt(be),")"]}),e.jsx("span",{children:we(Ce.subcontractors_markup_amount)})]})]}),e.jsxs("div",{className:"summary-subtotal",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:we(Ce.cor_subtotal)})]}),e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"Additional Fees"}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Liability Insurance (",wt(ye),")"]}),e.jsx("span",{children:we(Ce.liability_insurance_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Bond (",wt(Ve),")"]}),e.jsx("span",{children:we(Ce.bond_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["City License Fee (",wt(nt),")"]}),e.jsx("span",{children:we(Ce.license_fee_amount)})]})]}),e.jsxs("div",{className:"summary-total",children:[e.jsx("span",{children:"COR Total"}),e.jsx("span",{children:we(Ce.cor_total)})]})]})]}),g===9&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Submit Change Order Request"}),e.jsxs("div",{className:"submit-preview",children:[e.jsxs("div",{className:"preview-card",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx("span",{className:"preview-number",children:te}),e.jsx("span",{className:"preview-total",children:we(Ce.cor_total)})]}),e.jsx("div",{className:"preview-title",children:U}),e.jsx("div",{className:"preview-scope",children:K})]}),(()=>{const ne=Io(Me);return ne.valid?e.jsx("div",{className:"validation-success",children:"Ready to submit for approval!"}):e.jsxs("div",{className:"validation-errors",children:[e.jsx(cl,{size:20}),e.jsxs("div",{children:[e.jsx("strong",{children:"Please fix the following issues:"}),e.jsx("ul",{children:ne.errors.map((Ne,pe)=>e.jsx("li",{children:Ne},pe))})]})]})})(),e.jsxs("div",{className:"submit-actions",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:xt,disabled:v,children:[e.jsx(pf,{size:16})," Save as Draft"]}),e.jsxs("button",{className:"btn btn-primary",onClick:jt,disabled:v||!Io(Me).valid,children:[e.jsx(Zf,{size:16})," Submit for Approval"]})]})]})]})]}),e.jsxs("div",{className:"modal-footer cor-form-footer",children:[e.jsx("div",{className:"footer-left",children:g>1&&e.jsxs("button",{className:"btn btn-secondary",onClick:T,disabled:v,children:[e.jsx(Kx,{size:16})," Back"]})}),e.jsx("div",{className:"footer-center",children:e.jsxs("span",{className:"step-indicator",children:["Step ",g," of ",wi.length]})}),e.jsxs("div",{className:"footer-right",children:[g<wi.length&&e.jsxs("button",{className:"btn btn-primary",onClick:X,disabled:v,children:["Next ",e.jsx(yn,{size:16})]}),g>1&&g<9&&e.jsxs("button",{className:"btn btn-ghost",onClick:xt,disabled:v,children:[e.jsx(pf,{size:14})," Save Draft"]})]})]})]}),B&&e.jsx(Av,{projectId:l.id,corId:c?.id,onImport:tt,onClose:()=>H(!1),onShowToast:x})]})}const zv=l=>{const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:[30,41,59]},Cf=l=>new Promise(i=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),i(c.toDataURL("image/png"))},o.onerror=()=>i(null),o.src=l});async function ap(l,i,o,c={},m=null){const u=new Mi,x=u.internal.pageSize.getWidth(),g=u.internal.pageSize.getHeight(),f=20;let v=f;const y=or(l),A=c.primaryColor?zv(c.primaryColor):[30,58,138],Y=[241,245,249];let B=null;if(c.logoUrl)try{B=await Cf(c.logoUrl)}catch(Z){console.error("Error loading logo:",Z)}if(B)try{u.addImage(B,"PNG",f,v,40,15),v+=20}catch{u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...A),u.text(o?.name||"Company Name",f,v+10),v+=20}else u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...A),u.text(o?.name||"Company Name",f,v+10),v+=20;u.setFontSize(20),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("CHANGE ORDER REQUEST",f,v),v+=10,u.setFontSize(12),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(l.cor_number||"COR-XXXX",f,v);const H=l.status?.replace("_"," ").toUpperCase()||"DRAFT";u.setTextColor(...A),u.text(H,x-f-u.getTextWidth(H),v),v+=12,u.setDrawColor(...A),u.setLineWidth(.5),u.line(f,v,x-f,v),v+=10,u.setFontSize(10),u.setTextColor(0,0,0);const U=f,z=x/2;u.setFont("helvetica","bold"),u.text("Project:",U,v),u.setFont("helvetica","normal"),u.text(i?.name||"Project Name",U+25,v),u.setFont("helvetica","bold"),u.text("Job #:",z,v),u.setFont("helvetica","normal"),u.text(i?.job_number||"N/A",z+25,v),v+=6,u.setFont("helvetica","bold"),u.text("Period:",U,v),u.setFont("helvetica","normal"),u.text(Ai(l.period_start,l.period_end),U+25,v),u.setFont("helvetica","bold"),u.text("Date:",z,v),u.setFont("helvetica","normal"),u.text(Xa(l.created_at),z+25,v),v+=10,u.setFont("helvetica","bold"),u.setFontSize(12),u.text(l.title||"Untitled Change Order",f,v),v+=8,u.setFont("helvetica","normal"),u.setFontSize(10),u.setTextColor(80,80,80);const K=u.splitTextToSize(l.scope_of_work||"No scope of work provided.",x-f*2);u.text(K,f,v),v+=K.length*5+10,l.change_order_labor?.length>0&&(u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("LABOR",f,v),v+=6,Qs(u,{startY:v,head:[["Class","Type","Reg Hrs","Reg Rate","OT Hrs","OT Rate","Total"]],body:l.change_order_labor.map(Z=>[Z.labor_class,Z.wage_type,Z.regular_hours.toString(),`$${sa(Z.regular_rate)}/hr`,Z.overtime_hours?.toString()||"-",Z.overtime_hours?`$${sa(Z.overtime_rate)}/hr`:"-",we(Z.total)]),foot:[[{content:`Subtotal: ${we(y.labor_subtotal)}`,colSpan:5,styles:{halign:"right",fontStyle:"bold"}},{content:`+${wt(l.labor_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:we(y.labor_subtotal+y.labor_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:f,right:f},headStyles:{fillColor:A,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:Y,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),l.change_order_materials?.length>0&&(v>g-80&&(u.addPage(),v=f),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("MATERIALS",f,v),v+=6,Qs(u,{startY:v,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:l.change_order_materials.map(Z=>[Z.description,Z.source_reference||Z.source_type,Z.quantity.toString(),Z.unit,`$${sa(Z.unit_cost)}`,we(Z.total)]),foot:[[{content:`Subtotal: ${we(y.materials_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${wt(l.materials_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:we(y.materials_subtotal+y.materials_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:f,right:f},headStyles:{fillColor:A,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:Y,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),l.change_order_equipment?.length>0&&(v>g-80&&(u.addPage(),v=f),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("EQUIPMENT",f,v),v+=6,Qs(u,{startY:v,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:l.change_order_equipment.map(Z=>[Z.description,Z.source_reference||Z.source_type,Z.quantity.toString(),Z.unit,`$${sa(Z.unit_cost)}`,we(Z.total)]),foot:[[{content:`Subtotal: ${we(y.equipment_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${wt(l.equipment_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:we(y.equipment_subtotal+y.equipment_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:f,right:f},headStyles:{fillColor:A,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:Y,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),l.change_order_subcontractors?.length>0&&(v>g-80&&(u.addPage(),v=f),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("SUBCONTRACTORS",f,v),v+=6,Qs(u,{startY:v,head:[["Company","Description","Source","Amount"]],body:l.change_order_subcontractors.map(Z=>[Z.company_name,Z.description,Z.source_reference||Z.source_type,we(Z.total)]),foot:[[{content:`Subtotal: ${we(y.subcontractors_subtotal)}`,colSpan:2,styles:{halign:"right",fontStyle:"bold"}},{content:`+${wt(l.subcontractors_markup_percent||500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:we(y.subcontractors_subtotal+y.subcontractors_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:f,right:f},headStyles:{fillColor:A,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:Y,textColor:[0,0,0],fontSize:8},theme:"striped"}),v=u.lastAutoTable.finalY+10),v>g-100&&(u.addPage(),v=f),u.setFillColor(...Y),u.roundedRect(f,v,x-f*2,70,3,3,"F"),v+=10,u.setFontSize(10),u.setFont("helvetica","normal"),u.setTextColor(0,0,0);const E=f+10,D=x-f-60;u.text("COR Subtotal:",E,v),u.setFont("helvetica","bold"),u.text(we(y.cor_subtotal),D,v,{align:"right"}),v+=8,u.setFont("helvetica","normal"),u.setFontSize(9),u.text(`Liability Insurance (${wt(l.liability_insurance_percent||144)}):`,E,v),u.text(we(y.liability_insurance_amount),D,v,{align:"right"}),v+=6,u.text(`Bond (${wt(l.bond_percent||100)}):`,E,v),u.text(we(y.bond_amount),D,v,{align:"right"}),v+=6,u.text(`City License Fee (${wt(l.license_fee_percent||10)}):`,E,v),u.text(we(y.license_fee_amount),D,v,{align:"right"}),v+=10,u.setFillColor(...A),u.roundedRect(E-5,v-3,x-f*2-10,16,2,2,"F"),u.setTextColor(255,255,255),u.setFontSize(12),u.setFont("helvetica","bold"),u.text("COR TOTAL:",E,v+8),u.text(we(y.cor_total),D,v+8,{align:"right"}),v+=25,v>g-120&&(u.addPage(),v=f),v+=10,u.setTextColor(0,0,0),u.setFontSize(10),u.setFont("helvetica","bold"),u.text("AUTHORIZATION",f,v),v+=15,u.setFont("helvetica","normal"),u.setFontSize(9),u.setDrawColor(0,0,0);const S=(Z,Q,F,I,P,j,_)=>{u.setFont("helvetica","bold"),u.setFontSize(8),u.text(Q,f,Z),u.setFont("helvetica","normal"),u.setFontSize(9);const C=Z+20;if(u.line(f,C,f+70,C),u.text("Signature",f,C+8),u.line(f+85,C,f+145,C),u.text("Title / Company",f+85,C+8),u.line(x-f-40,C,x-f,C),u.text("Date",x-f-40,C+8),F)try{if(u.addImage(F,"PNG",f,C-18,60,18),I&&(u.setFontSize(8),u.text(I,f,C+15)),P||j){const ee=[P,j].filter(Boolean).join(" - ");u.text(ee,f+85,C-5)}_&&u.text(Xa(_),x-f-40,C-5)}catch(ee){console.error("Error adding signature:",ee)}return C+25};if(v=S(v,"GC AUTHORIZATION",l.gc_signature_data||l.gc_signature,l.gc_signature_name||l.gc_signer_name,l.gc_signature_title,l.gc_signature_company,l.gc_signature_date||l.signed_at),v+=10,v=S(v,"CLIENT AUTHORIZATION",l.client_signature_data,l.client_signature_name,l.client_signature_title,l.client_signature_company,l.client_signature_date),m&&m.length>0){u.addPage(),v=f,u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...A),u.text("T&M BACKUP DOCUMENTATION",f,v),v+=8,u.setFontSize(10),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(`${m.length} T&M ticket${m.length>1?"s":""} associated with this COR`,f,v),v+=12,u.setDrawColor(...A),u.setLineWidth(.5),u.line(f,v,x-f,v),v+=10;for(const Z of m){v>g-100&&(u.addPage(),v=f),u.setFillColor(245,247,250),u.roundedRect(f,v,x-f*2,18,2,2,"F"),u.setFontSize(11),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text(`T&M Ticket  ${Xa(Z.work_date)}`,f+5,v+7),Z.ce_pco_number&&(u.setFontSize(9),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(`CE/PCO: ${Z.ce_pco_number}`,f+5,v+14));const F={pending:[217,119,6],approved:[5,150,105],billed:[37,99,235]}[Z.status]||[100,100,100];if(u.setFontSize(8),u.setTextColor(...F),u.text(Z.status?.toUpperCase()||"PENDING",x-f-30,v+10),v+=24,Z.notes){u.setFontSize(9),u.setFont("helvetica","italic"),u.setTextColor(80,80,80);const I=u.splitTextToSize(Z.notes,x-f*2-10);u.text(I,f+5,v),v+=I.length*4+6}if(Z.t_and_m_workers?.length>0&&(u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("Labor:",f+5,v),v+=4,Qs(u,{startY:v,head:[["Worker","Class","Hours","Rate","OT Hrs","OT Rate"]],body:Z.t_and_m_workers.map(I=>[I.name,I.labor_class||"-",I.hours?.toString()||"0",I.rate?`$${I.rate}/hr`:"-",I.overtime_hours?.toString()||"-",I.overtime_rate?`$${I.overtime_rate}/hr`:"-"]),margin:{left:f+5,right:f},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),v=u.lastAutoTable.finalY+8),Z.t_and_m_items?.length>0&&(v>g-60&&(u.addPage(),v=f),u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("Materials/Equipment:",f+5,v),v+=4,Qs(u,{startY:v,head:[["Item","Qty","Unit","Unit Cost","Total"]],body:Z.t_and_m_items.map(I=>[I.materials_equipment?.name||I.description||"Item",I.quantity?.toString()||"1",I.materials_equipment?.unit||"ea",I.materials_equipment?.cost_per_unit?`$${I.materials_equipment.cost_per_unit}`:"-",I.materials_equipment?.cost_per_unit&&I.quantity?`$${(I.quantity*I.materials_equipment.cost_per_unit).toFixed(2)}`:"-"]),margin:{left:f+5,right:f},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),v=u.lastAutoTable.finalY+8),Z.photos?.length>0){v>g-80&&(u.addPage(),v=f),u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text(`Photos (${Z.photos.length}):`,f+5,v),v+=6;let I=f+5;const P=45,j=35,_=3;for(let C=0;C<Z.photos.length;C++){C>0&&C%_===0&&(I=f+5,v+=j+5),v+j>g-20&&(u.addPage(),v=f,I=f+5);try{const ee=await Cf(Z.photos[C]);ee?u.addImage(ee,"JPEG",I,v,P,j):(u.setFillColor(240,240,240),u.rect(I,v,P,j,"F"),u.setFontSize(7),u.setTextColor(150,150,150),u.text("Photo unavailable",I+5,v+j/2))}catch{u.setFillColor(240,240,240),u.rect(I,v,P,j,"F"),u.setFontSize(7),u.setTextColor(150,150,150),u.text("Photo unavailable",I+5,v+j/2)}I+=P+5}v+=j+10}v+=5,u.setDrawColor(200,200,200),u.setLineWidth(.2),u.line(f,v,x-f,v),v+=10}}const te=u.internal.getNumberOfPages();for(let Z=1;Z<=te;Z++){u.setPage(Z);const Q=g-10;u.setFontSize(8),u.setTextColor(150,150,150),u.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,f,Q),u.text(`Page ${Z} of ${te}`,x-f,Q,{align:"right"})}const se=`${l.cor_number||"COR"}_${i?.job_number||"export"}${m?.length?"_with_backup":""}.pdf`;u.save(se)}function qv({onSave:l,onClose:i,signerName:o=""}){const c=p.useRef(null),[m,u]=p.useState(o),[x,g]=p.useState(!1),[f,v]=p.useState(!1),y=()=>{const E=c.current;return E?E.getContext("2d"):null},A=E=>{const D=c.current;if(!D)return{x:0,y:0};const S=D.getBoundingClientRect(),te=D.width/S.width,se=D.height/S.height,Z=E.touches?E.touches[0].clientX:E.clientX,Q=E.touches?E.touches[0].clientY:E.clientY;return{x:(Z-S.left)*te,y:(Q-S.top)*se}},Y=E=>{E.preventDefault();const D=y();if(!D)return;const{x:S,y:te}=A(E);D.beginPath(),D.moveTo(S,te),v(!0),g(!0)},B=E=>{if(!f)return;E.preventDefault();const D=y();if(!D)return;const{x:S,y:te}=A(E);D.lineTo(S,te),D.stroke()},H=()=>{v(!1)},U=()=>{const E=c.current,D=y();!E||!D||(D.clearRect(0,0,E.width,E.height),g(!1))},z=E=>{if(!E)return;c.current=E;const D=E.getContext("2d");D.strokeStyle="#1e293b",D.lineWidth=2,D.lineCap="round",D.lineJoin="round"},K=()=>{if(!x||!m.trim())return;const E=c.current;if(!E)return;const D=E.toDataURL("image/png");l({signature:D,signerName:m.trim(),signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:i,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal",onClick:E=>E.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"signature-title",children:"GC Signature"}),e.jsx("button",{className:"close-btn",onClick:i,"aria-label":"Close signature modal",children:e.jsx(_n,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Signer Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:m,onChange:E=>u(E.target.value),placeholder:"Enter full name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(Yf,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Sign below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:z,width:500,height:200,className:"signature-canvas",onMouseDown:Y,onMouseMove:B,onMouseUp:H,onMouseLeave:H,onTouchStart:Y,onTouchMove:B,onTouchEnd:H,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!x&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:U,disabled:!x,"aria-label":"Clear signature",children:[e.jsx(Xf,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("p",{className:"signature-legal",role:"note",children:"By signing above, I acknowledge that I have reviewed and approve this Change Order Request."})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:i,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:K,disabled:!x||!m.trim(),"aria-label":"Save signature",children:[e.jsx(nr,{size:16,"aria-hidden":"true"})," Save Signature"]})]})]})})}function Ov({cor:l,project:i,company:o,areas:c,onClose:m,onEdit:u,onShowToast:x,onStatusChange:g}){const[f,v]=p.useState(!0),[y,A]=p.useState(l),[Y,B]=p.useState(!1),[H,U]=p.useState(!1),z=p.useCallback(async()=>{try{const j=await de.getCORById(l.id);j&&A(j)}catch(j){console.error("Error fetching COR details:",j),x?.("Error loading COR details","error")}finally{v(!1)}},[l.id,x]);p.useEffect(()=>{z()},[z]),p.useEffect(()=>{const j=de.subscribeToCorTickets?.(l.id,()=>{z()});return()=>{j&&de.unsubscribe?.(j)}},[l.id,z]);const K=p.useMemo(()=>or(y),[y]),E=tp(y.status),D=y.status==="pending_approval",S=y.status==="draft",te=j=>c?.find(C=>C.id===j)?.name||null,se=async()=>{if(confirm("Approve this change order request?")){v(!0);try{await de.approveCOR(y.id),A({...y,status:"approved",approved_at:new Date().toISOString()}),x?.("COR approved","success"),g?.()}catch(j){console.error("Error approving COR:",j),x?.("Error approving COR","error")}finally{v(!1)}}},Z=async()=>{const j=prompt("Enter rejection reason (optional):");if(j!==null){v(!0);try{await de.rejectCOR(y.id,j),A({...y,status:"rejected",rejection_reason:j}),x?.("COR rejected","success"),g?.()}catch(_){console.error("Error rejecting COR:",_),x?.("Error rejecting COR","error")}finally{v(!1)}}},Q=async()=>{if(confirm("Mark this COR as billed?")){v(!0);try{await de.markCORAsBilled(y.id),A({...y,status:"billed"}),x?.("COR marked as billed","success"),g?.()}catch(j){console.error("Error marking COR as billed:",j),x?.("Error updating status","error")}finally{v(!1)}}},F=async j=>{v(!0);try{await de.saveCORSignature?.(y.id,{gc_signature:j.signature,gc_signer_name:j.signerName,signed_at:j.signedAt}),A({...y,gc_signature:j.signature,gc_signer_name:j.signerName,signed_at:j.signedAt}),B(!1),x?.("Signature saved","success"),g?.()}catch(_){console.error("Error saving signature:",_),x?.("Error saving signature","error")}finally{v(!1)}},I=y.status==="approved"&&!y.gc_signature,P=async()=>{try{x?.("Generating PDF...","info"),await ap(y,i,o),x?.("PDF downloaded","success")}catch(j){console.error("Error exporting PDF:",j),x?.("Error generating PDF","error")}};return f?e.jsx("div",{className:"modal-overlay",onClick:m,children:e.jsx("div",{className:"modal-content cor-detail-modal",onClick:j=>j.stopPropagation(),children:e.jsx("div",{className:"cor-detail-loading",children:"Loading COR details..."})})}):e.jsxs("div",{className:"modal-overlay",onClick:m,role:"dialog","aria-modal":"true","aria-labelledby":"cor-detail-title",children:[e.jsxs("div",{className:"modal-content cor-detail-modal",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"modal-header cor-detail-header",children:[e.jsxs("div",{className:"cor-detail-title-row",children:[e.jsxs("div",{children:[e.jsx("div",{className:"cor-detail-number",children:y.cor_number}),e.jsx("h2",{id:"cor-detail-title",children:y.title||"Untitled COR"})]}),e.jsx("button",{className:"close-btn",onClick:m,"aria-label":"Close COR details",children:e.jsx(_n,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"cor-detail-meta",children:[e.jsx("span",{className:"cor-detail-status",style:{backgroundColor:E.bgColor,color:E.color},children:E.label}),te(y.area_id)&&e.jsx("span",{className:"cor-detail-area",children:te(y.area_id)}),e.jsxs("span",{className:"cor-detail-period",children:[e.jsx(lr,{size:14})," ",Ai(y.period_start,y.period_end)]})]})]}),e.jsxs("div",{className:"modal-body cor-detail-body",children:[e.jsxs("div",{className:"cor-detail-section",children:[e.jsxs("h3",{children:[e.jsx(za,{size:18})," Scope of Work"]}),e.jsx("p",{className:"cor-scope-text",children:y.scope_of_work||"No scope of work provided."})]}),e.jsxs("div",{className:"cor-detail-section pricing-breakdown",children:[e.jsxs("h3",{children:[e.jsx(ll,{size:18})," Pricing Breakdown"]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(ir,{size:16}),e.jsx("span",{children:"Labor"})]}),e.jsx("span",{className:"category-subtotal",children:we(K.labor_subtotal)})]}),y.change_order_labor?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"Reg Rate"}),e.jsx("th",{children:"OT Hrs"}),e.jsx("th",{children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:y.change_order_labor.map((j,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:j.labor_class}),e.jsx("td",{children:j.wage_type}),e.jsx("td",{children:j.regular_hours}),e.jsxs("td",{children:["$",sa(j.regular_rate),"/hr"]}),e.jsx("td",{children:j.overtime_hours||"-"}),e.jsx("td",{children:j.overtime_hours?`$${sa(j.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:we(j.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No labor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",wt(y.labor_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",we(K.labor_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Za,{size:16}),e.jsx("span",{children:"Materials"})]}),e.jsx("span",{className:"category-subtotal",children:we(K.materials_subtotal)})]}),y.change_order_materials?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:y.change_order_materials.map((j,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:j.description}),e.jsx("td",{children:j.source_reference||j.source_type}),e.jsx("td",{children:j.quantity}),e.jsx("td",{children:j.unit}),e.jsxs("td",{children:["$",sa(j.unit_cost)]}),e.jsx("td",{className:"text-right",children:we(j.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No material items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",wt(y.materials_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",we(K.materials_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(bn,{size:16}),e.jsx("span",{children:"Equipment"})]}),e.jsx("span",{className:"category-subtotal",children:we(K.equipment_subtotal)})]}),y.change_order_equipment?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:y.change_order_equipment.map((j,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:j.description}),e.jsx("td",{children:j.source_reference||j.source_type}),e.jsx("td",{children:j.quantity}),e.jsx("td",{children:j.unit}),e.jsxs("td",{children:["$",sa(j.unit_cost)]}),e.jsx("td",{className:"text-right",children:we(j.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No equipment items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",wt(y.equipment_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",we(K.equipment_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(rl,{size:16}),e.jsx("span",{children:"Subcontractors"})]}),e.jsx("span",{className:"category-subtotal",children:we(K.subcontractors_subtotal)})]}),y.change_order_subcontractors?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:y.change_order_subcontractors.map((j,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:j.company_name}),e.jsx("td",{children:j.description}),e.jsx("td",{children:j.source_reference||j.source_type}),e.jsx("td",{className:"text-right",children:we(j.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No subcontractor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",wt(y.subcontractors_markup_percent||500),")"]}),e.jsxs("span",{children:["+",we(K.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"cor-subtotal-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:we(K.cor_subtotal)})]}),e.jsxs("div",{className:"pricing-category fees-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Rj,{size:16}),e.jsx("span",{children:"Additional Fees"})]}),e.jsx("span",{className:"category-subtotal",children:we(K.additional_fees_total)})]}),e.jsxs("div",{className:"fees-list",children:[e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Pf,{size:14}),e.jsxs("span",{children:["Liability Insurance (",wt(y.liability_insurance_percent||144),")"]})]}),e.jsx("span",{className:"fee-amount",children:we(K.liability_insurance_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(za,{size:14}),e.jsxs("span",{children:["Bond (",wt(y.bond_percent||100),")"]})]}),e.jsx("span",{className:"fee-amount",children:we(K.bond_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Di,{size:14}),e.jsxs("span",{children:["City License Fee (",wt(y.license_fee_percent||10),")"]})]}),e.jsx("span",{className:"fee-amount",children:we(K.license_fee_amount)})]})]})]}),e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:we(K.cor_total)})]})]}),(y.gc_signature_data||y.gc_signature||y.client_signature_data)&&e.jsxs("div",{className:"cor-detail-section signature-section",children:[e.jsxs("h3",{children:[e.jsx(Gj,{size:18})," Signatures"]}),e.jsxs("div",{className:"dual-signatures",children:[(y.gc_signature_data||y.gc_signature)&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"GC Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:y.gc_signature_data||y.gc_signature,alt:"GC Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:y.gc_signature_name||y.gc_signer_name}),(y.gc_signature_title||y.gc_signature_company)&&e.jsxs("span",{className:"signer-org",children:[y.gc_signature_title,y.gc_signature_title&&y.gc_signature_company&&" - ",y.gc_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",Xa(y.gc_signature_date||y.signed_at)]})]})]})]}),y.client_signature_data&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"Client Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:y.client_signature_data,alt:"Client Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:y.client_signature_name}),(y.client_signature_title||y.client_signature_company)&&e.jsxs("span",{className:"signer-org",children:[y.client_signature_title,y.client_signature_title&&y.client_signature_company&&" - ",y.client_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",Xa(y.client_signature_date)]})]})]})]})]})]}),y.status==="rejected"&&y.rejection_reason&&e.jsxs("div",{className:"cor-detail-section rejection-section",children:[e.jsxs("h3",{children:[e.jsx(df,{size:18})," Rejection Reason"]}),e.jsx("p",{className:"rejection-text",children:y.rejection_reason})]})]}),e.jsxs("div",{className:"modal-footer cor-detail-footer",children:[e.jsxs("div",{className:"footer-info",children:[e.jsxs("span",{children:["Created: ",Xa(y.created_at)]}),y.approved_at&&e.jsxs("span",{children:["Approved: ",Xa(y.approved_at)]})]}),e.jsxs("div",{className:"footer-actions",role:"group","aria-label":"COR actions",children:[S&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>u?.(y),disabled:f,"aria-label":"Edit this COR",children:[e.jsx(dd,{size:16,"aria-hidden":"true"})," Edit"]}),D&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-danger",onClick:Z,disabled:f,"aria-label":"Reject this COR",children:[e.jsx(df,{size:16,"aria-hidden":"true"})," Reject"]}),e.jsxs("button",{className:"btn btn-success",onClick:se,disabled:f,"aria-label":"Approve this COR",children:[e.jsx(Qa,{size:16,"aria-hidden":"true"})," Approve"]})]}),I&&e.jsxs("button",{className:"btn btn-success",onClick:()=>B(!0),disabled:f,"aria-label":"Get GC signature for this COR",children:[e.jsx(Dj,{size:16,"aria-hidden":"true"})," Get GC Signature"]}),(y.status==="approved"||y.status==="pending_approval")&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>U(!0),disabled:f,"aria-label":"Get shareable signature link",children:[e.jsx(od,{size:16,"aria-hidden":"true"})," Get Signature Link"]}),y.status==="approved"&&e.jsxs("button",{className:"btn btn-primary",onClick:Q,disabled:f,"aria-label":"Mark this COR as billed",children:[e.jsx(ll,{size:16,"aria-hidden":"true"})," Mark Billed"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:P,"aria-label":"Export COR to PDF",children:[e.jsx(Vf,{size:16,"aria-hidden":"true"})," Export PDF"]})]})]})]}),Y&&e.jsx(qv,{onSave:F,onClose:()=>B(!1),signerName:""}),H&&e.jsx(ep,{documentType:"cor",documentId:y.id,companyId:o?.id,projectId:i?.id,documentTitle:`COR ${y.cor_number}: ${y.title||"Untitled"}`,onClose:()=>U(!1),onShowToast:x})]})}const Vs=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l||0),Uv=l=>new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric"});function Lv({dailyBurn:l,totalBurn:i,daysWorked:o,laborCost:c,haulOffCost:m,progress:u,contractValue:x,laborByDate:g=[],haulOffByDate:f=[]}){const[v,y]=p.useState(!1),A=x*(u/100)*.6,Y=i<=A?"on-budget":i<=A*1.2?"warning":"over-budget",B={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[Y],H=Y==="on-budget"?Jf:Y==="warning"?Cj:Zj,z=u>0?i/(u/100):0,K=[],E={};g.forEach(S=>{E[S.date]||(E[S.date]={date:S.date,labor:0,haulOff:0,total:0}),E[S.date].labor=S.cost||0,E[S.date].total+=S.cost||0}),f.forEach(S=>{E[S.date]||(E[S.date]={date:S.date,labor:0,haulOff:0,total:0}),E[S.date].haulOff=S.cost||0,E[S.date].total+=S.cost||0}),Object.values(E).sort((S,te)=>new Date(te.date)-new Date(S.date)).slice(0,10).forEach(S=>K.push(S));const D=Math.max(...K.map(S=>S.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(pj,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${Y}`,children:[e.jsx(H,{size:14}),e.jsx("span",{children:B})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:Vs(l)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),o>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",o," work day",o!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:Vs(i)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:Vs(c)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Disposal"}),e.jsx("span",{className:"burn-summary-value",children:Vs(m)})]})]}),u>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${z>x*.7?"warning":""}`,children:Vs(z)})]}),K.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>y(!v),children:[v?e.jsx($f,{size:16}):e.jsx(Ps,{size:16}),e.jsxs("span",{children:[v?"Hide":"View"," Daily Breakdown"]})]}),v&&K.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Disposal"}),e.jsx("span",{children:"Total"})]}),K.map(S=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:Uv(S.date)}),e.jsx("span",{className:"burn-labor",children:S.labor>0?Vs(S.labor):"-"}),e.jsx("span",{className:"burn-hauloff",children:S.haulOff>0?Vs(S.haulOff):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${S.total/D*100}%`}}),e.jsx("span",{className:"burn-amount",children:Vs(S.total)})]})]},S.date))]})]})}const Wo=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l||0),ki={labor:{label:"Labor",Icon:na,color:"#3b82f6"},disposal:{label:"Disposal",Icon:bn,color:"#10b981"},equipment:{label:"Equipment",Icon:cr,color:"#f59e0b"},materials:{label:"Materials",Icon:Za,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:ir,color:"#ec4899"},other:{label:"Other",Icon:Gf,color:"#6b7280"}};function Bv({laborCost:l=0,haulOffCost:i=0,customCosts:o=[],onAddCost:c,onDeleteCost:m}){const[u,x]=p.useState(!1),[g,f]=p.useState(null),v=[];l>0&&v.push({category:"labor",label:"Labor",amount:l,source:"auto",description:"From crew check-ins"}),i>0&&v.push({category:"disposal",label:"Disposal",amount:i,source:"auto",description:"From haul-off logs"});const y={};o.forEach(B=>{y[B.category]||(y[B.category]={category:B.category,items:[],total:0}),y[B.category].items.push(B),y[B.category].total+=parseFloat(B.amount)||0}),Object.values(y).forEach(B=>{const H=ki[B.category]||ki.other;v.push({category:B.category,label:H.label,amount:B.total,source:"manual",items:B.items})});const A=v.reduce((B,H)=>B+H.amount,0);v.forEach(B=>{B.percentage=A>0?B.amount/A*100:0}),v.sort((B,H)=>H.amount-B.amount);const Y=B=>{f(g===B?null:B)};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:Wo(A)})]}),v.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):e.jsx("div",{className:"cost-breakdown",children:v.map(B=>{const H=ki[B.category]||ki.other,U=H.Icon,z=B.items&&B.items.length>0,K=g===B.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${z?"expandable":""}`,onClick:()=>z&&Y(B.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(B.percentage,2)}%`,backgroundColor:H.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(U,{size:14,style:{color:H.color}}),e.jsx("span",{children:B.label}),B.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),z&&(K?e.jsx($f,{size:14}):e.jsx(Ps,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:Wo(B.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(B.percentage),"%"]})]})]})]}),K&&z&&e.jsx("div",{className:"cost-category-items",children:B.items.map(E=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:E.description}),e.jsx("span",{className:"cost-item-date",children:new Date(E.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:Wo(E.amount)}),m&&e.jsx("button",{className:"cost-item-delete",onClick:D=>{D.stopPropagation(),confirm("Delete this cost entry?")&&m(E.id)},children:e.jsx(gs,{size:14})})]})]},E.id))})]},B.category)})}),c&&e.jsxs("button",{className:"cost-add-btn",onClick:c,children:[e.jsx(La,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const xn=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l||0);function Fv({revenue:l,totalCosts:i,contractValue:o,progress:c}){const m=l-i,u=l>0?m/l*100:0,x=o,g=c>0?i/(c/100):i,f=x-g,v=x>0?f/x*100:0,y=u>=20,A=u>=0&&u<20,Y=u<0,B=y?"healthy":A?"warning":"loss",H=y?"On Track":A?"Watch Margin":"Over Cost",U=y?Qa:A?cl:Jf;return e.jsxs("div",{className:`profitability-card ${B}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${B}`,children:[e.jsx(U,{size:14}),e.jsx("span",{children:H})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${u<0?"negative":""}`,children:[Math.round(u),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${u<0?"negative":u<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(u),100)}%`}})})]}),c>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${v<0?"negative":""}`,children:[Math.round(v),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${v<0?"negative":v<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(v),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:xn(l)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",xn(i)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${m<0?"negative":"positive"}`,children:[m>=0?"":"-",xn(Math.abs(m))]})]})]}),c>10&&e.jsxs("div",{className:"profitability-insight",children:[y&&e.jsxs("p",{children:["At ",Math.round(c),"% complete, you're at ",xn(m)," profit.",f>0&&` Projected final profit: ${xn(f)}`]}),A&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",f<0&&` Trending toward ${xn(f)} loss.`]}),Y&&e.jsxs("p",{children:["Currently over cost by ",xn(Math.abs(m)),". Immediate review recommended."]})]})]})}const Hv=[{value:"labor",label:"Labor",Icon:na,description:"Additional labor costs"},{value:"materials",label:"Materials",Icon:Za,description:"Materials and supplies"},{value:"equipment",label:"Equipment",Icon:cr,description:"Equipment rental or purchase"},{value:"subcontractor",label:"Subcontractor",Icon:ir,description:"Subcontractor work"},{value:"disposal",label:"Disposal",Icon:bn,description:"Additional disposal costs"},{value:"other",label:"Other",Icon:Gf,description:"Miscellaneous costs"}];function $v({onClose:l,onSave:i,saving:o=!1}){const[c,m]=p.useState({category:"materials",description:"",amount:"",cost_date:new Date().toISOString().split("T")[0],notes:""}),[u,x]=p.useState({}),g=(y,A)=>{m(Y=>({...Y,[y]:A})),u[y]&&x(Y=>({...Y,[y]:null}))},f=()=>{const y={};c.description.trim()||(y.description="Description is required");const A=parseFloat(c.amount);return(isNaN(A)||A<=0)&&(y.amount="Enter a valid amount"),c.cost_date||(y.cost_date="Date is required"),x(y),Object.keys(y).length===0},v=y=>{y.preventDefault(),f()&&i(c)};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content add-cost-modal",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(ll,{size:20}),"Add Cost"]}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close",children:e.jsx(_n,{size:20})})]}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category *"}),e.jsx("div",{className:"category-grid",children:Hv.map(y=>{const A=y.Icon,Y=c.category===y.value;return e.jsxs("button",{type:"button",className:`category-option ${Y?"selected":""}`,onClick:()=>g("category",y.value),children:[e.jsx(A,{size:18}),e.jsx("span",{className:"category-label",children:y.label})]},y.value)})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-description",children:"Description *"}),e.jsx("input",{id:"cost-description",type:"text",value:c.description,onChange:y=>g("description",y.target.value),placeholder:"e.g., Excavator rental - Week 1",className:u.description?"error":""}),u.description&&e.jsx("span",{className:"form-error",children:u.description})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-amount",children:"Amount *"}),e.jsxs("div",{className:"input-with-prefix",children:[e.jsx("span",{className:"input-prefix",children:"$"}),e.jsx("input",{id:"cost-amount",type:"number",step:"0.01",min:"0",value:c.amount,onChange:y=>g("amount",y.target.value),placeholder:"0.00",className:u.amount?"error":""})]}),u.amount&&e.jsx("span",{className:"form-error",children:u.amount})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-date",children:"Date *"}),e.jsx("input",{id:"cost-date",type:"date",value:c.cost_date,onChange:y=>g("cost_date",y.target.value),className:u.cost_date?"error":""}),u.cost_date&&e.jsx("span",{className:"form-error",children:u.cost_date})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-notes",children:"Notes (optional)"}),e.jsx("textarea",{id:"cost-notes",value:c.notes,onChange:y=>g("notes",y.target.value),placeholder:"Additional details...",rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:l,disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?"Saving...":"Add Cost"})]})]})]})})}function Vv({company:l,onShowToast:i,navigateToProjectId:o,onProjectNavigated:c}){const[m,u]=p.useState([]),[x,g]=p.useState([]),[f,v]=p.useState(null),[y,A]=p.useState([]),[Y,B]=p.useState(!0),[H,U]=p.useState(!1),[z,K]=p.useState(null),[E,D]=p.useState(!1),[S,te]=p.useState(!1),[se,Z]=p.useState(!1),[Q,F]=p.useState("overview"),[I,P]=p.useState([]),[j,_]=p.useState(!1),[C,ee]=p.useState(null),[w,k]=p.useState(!1),[M,he]=p.useState(null),[V,q]=p.useState(0),[L,$]=p.useState(!1),[xe,be]=p.useState(!1),Fe=p.useRef(null),ye=p.useRef(!1),We=p.useRef(!1),Ve=p.useCallback((N={})=>{const{refreshAreas:re=!1,refreshCOR:ce=!1,projectId:ue=null}=N;re&&ue&&(ye.current=ue),ce&&(We.current=!0),Fe.current&&clearTimeout(Fe.current),Fe.current=setTimeout(async()=>{ye.current&&(await Vt(ye.current),ye.current=!1),We.current&&(q(Oe=>Oe+1),We.current=!1),await nt()},150)},[]);p.useEffect(()=>()=>{Fe.current&&clearTimeout(Fe.current)},[]),p.useEffect(()=>{if(l?.id){nt(),De();const N=m.map(ce=>ce.id),re=N.length>0?de.subscribeToCompanyActivity?.(l.id,N,{onMessage:()=>Ve(),onMaterialRequest:()=>Ve(),onTMTicket:()=>Ve(),onInjuryReport:()=>Ve()}):null;return()=>{re&&de.unsubscribe?.(re)}}},[l?.id,m.length,Ve]);const De=async()=>{try{const N=await de.getDumpSites(l.id);P(N||[])}catch(N){console.error("Error loading dump sites:",N)}};p.useEffect(()=>{if(o&&m.length>0){const N=m.find(re=>re.id===o);N&&(v(N),c?.())}},[o,m]),p.useEffect(()=>{if(f){Vt(f.id);const N=[],re=f.id,ce=de.subscribeToAreas?.(re,()=>{Ve({refreshAreas:!0,projectId:re})});ce&&N.push(ce);const ue=de.subscribeToDailyReports?.(re,()=>{Ve()});ue&&N.push(ue);const Oe=de.subscribeToCrewCheckins?.(re,()=>{Ve()});Oe&&N.push(Oe);const Qe=de.subscribeToHaulOffs?.(re,()=>{Ve()});Qe&&N.push(Qe);const Te=de.subscribeToCORs?.(re,()=>{Ve({refreshCOR:!0})});return Te&&N.push(Te),()=>{N.forEach(je=>de.unsubscribe?.(je))}}},[f,Ve]);const nt=async()=>{try{const N=await de.getProjects(l?.id);u(N);const re=await Promise.all(N.map(async ce=>{try{const[ue,Oe,Qe,Te,je,lt,pt,Bt,la,vt]=await Promise.all([de.getAreas(ce.id).catch(()=>[]),de.getTMTickets(ce.id).catch(()=>[]),de.getChangeOrderTotals(ce.id).catch(()=>null),de.getDailyReports(ce.id,100).catch(()=>[]),de.getInjuryReports(ce.id).catch(()=>[]),de.getMaterialRequests(ce.id).catch(()=>[]),de.calculateManDayCosts(ce.id,l?.id,ce.work_type||"demolition",ce.job_type||"standard").catch(()=>null),de.calculateHaulOffCosts(ce.id).catch(()=>null),de.getProjectCosts(ce.id).catch(()=>[]),de.getCORStats(ce.id).catch(()=>null)]),Re=gf(ue),Ze=Re.progress,ra=Qe?.totalApprovedValue||0,Ue=ce.contract_value+ra,Ye=Re.isValueBased?Re.earnedValue:Ze/100*Ue,mt=Oe.filter(_t=>_t.status==="pending").length,Ie=new Date;Ie.setDate(Ie.getDate()-7);const Mt=Te.filter(_t=>new Date(_t.report_date)>=Ie).length,Jt=la.reduce((_t,dr)=>{const dl=parseFloat(dr.amount);return _t+(isNaN(dl)?0:dl)},0),fa=pt?.totalCost||0,Yt=Bt?.totalCost||0,Ba=fa+Yt+Jt,ol=Ye-Ba,Js=Ye>0?ol/Ye*100:0,Nn=pt?.byDate?.length||0,Pa=Bt?.daysWithHaulOff||0,Fa=Math.max(Nn,Pa),js=fa+Yt,vs=Fa>0?js/Fa:0;return{...ce,areas:ue,progress:Ze,billable:Ye,changeOrderValue:ra,revisedContractValue:Ue,changeOrderPending:Qe?.pendingCount||0,totalTickets:Oe.length,pendingTickets:mt,approvedTickets:Oe.filter(_t=>_t.status==="approved").length,dailyReportsCount:Te.length,recentDailyReports:Mt,injuryReportsCount:je.length,lastDailyReport:Te[0]?.report_date||null,pendingMaterialRequests:lt.filter(_t=>_t.status==="pending").length,totalMaterialRequests:lt.length,isValueBased:Re.isValueBased,earnedValue:Re.earnedValue,totalSOVValue:Re.totalValue,laborCost:fa,laborDaysWorked:Nn,laborManDays:pt?.totalManDays||0,laborByDate:pt?.byDate||[],dailyBurn:vs,haulOffCost:Yt,haulOffLoads:Bt?.totalLoads||0,haulOffDays:Pa,haulOffByType:Bt?.byWasteType||{},haulOffByDate:Bt?.byDate||[],customCosts:la,customCostTotal:Jt,totalBurn:js,totalBurnDays:Fa,allCostsTotal:Ba,currentProfit:ol,profitMargin:Js,corPendingValue:vt?.total_pending_value||0,corPendingCount:vt?.pending_count||0,corApprovedValue:vt?.total_approved_value||0,corBilledValue:vt?.total_billed_value||0,corTotalCount:vt?.total_cors||0,hasError:!1}}catch(ue){return console.error(`Error loading data for project ${ce.id}:`,ue),{...ce,areas:[],progress:0,billable:0,changeOrderValue:0,revisedContractValue:ce.contract_value,changeOrderPending:0,totalTickets:0,pendingTickets:0,approvedTickets:0,dailyReportsCount:0,recentDailyReports:0,injuryReportsCount:0,lastDailyReport:null,pendingMaterialRequests:0,totalMaterialRequests:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corTotalCount:0,hasError:!0}}}));g(re)}catch(N){console.error("Error loading projects:",N),i("Error loading projects","error")}finally{B(!1)}},Vt=async N=>{try{const re=await de.getAreas(N);A(re)}catch(re){console.error("Error loading areas:",re)}},ke=N=>{v(N)},ze=()=>{v(null),A([]),U(!1),K(null),F("overview"),nt()},Ae=()=>{K({name:f.name,job_number:f.job_number||"",address:f.address||"",general_contractor:f.general_contractor||"",client_contact:f.client_contact||"",client_phone:f.client_phone||"",contract_value:f.contract_value,work_type:f.work_type||"demolition",job_type:f.job_type||"standard",pin:f.pin||"",default_dump_site_id:f.default_dump_site_id||"",areas:y.map(N=>({id:N.id,name:N.name,weight:N.weight,isNew:!1}))}),U(!0)},Me=()=>{U(!1),K(null)},Ce=(N,re)=>{K(ce=>({...ce,[N]:re}))},Xe=(N,re,ce)=>{K(ue=>({...ue,areas:ue.areas.map((Oe,Qe)=>Qe===N?{...Oe,[re]:ce}:Oe)}))},X=()=>{K(N=>({...N,areas:[...N.areas,{id:null,name:"",weight:"",isNew:!0}]}))},T=N=>{z.areas.length>1&&K(re=>({...re,areas:re.areas.filter((ce,ue)=>ue!==N)}))},_e=async()=>{if(!z.name.trim()){i("Please enter a project name","error");return}const N=parseFloat(z.contract_value);if(!N||N<=0){i("Please enter a valid contract value","error");return}if(z.pin&&z.pin.length!==4){i("PIN must be 4 digits","error");return}if(z.pin&&z.pin!==f.pin&&!await de.isPinAvailable(z.pin,f.id)){i("This PIN is already in use","error");return}const re=z.areas.filter(ue=>ue.name.trim()&&parseFloat(ue.weight)>0);if(re.length===0){i("Please add at least one area","error");return}if(re.reduce((ue,Oe)=>ue+parseFloat(Oe.weight),0)!==100){i("Area weights must total 100%","error");return}D(!0);try{await de.updateProject(f.id,{name:z.name.trim(),job_number:z.job_number?.trim()||null,address:z.address?.trim()||null,general_contractor:z.general_contractor?.trim()||null,client_contact:z.client_contact?.trim()||null,client_phone:z.client_phone?.trim()||null,contract_value:N,work_type:z.work_type||"demolition",job_type:z.job_type||"standard",pin:z.pin||null,default_dump_site_id:z.default_dump_site_id||null});const ue=y.map(Te=>Te.id),Oe=z.areas.filter(Te=>Te.id).map(Te=>Te.id);for(const Te of ue)Oe.includes(Te)||await de.deleteArea(Te);for(let Te=0;Te<re.length;Te++){const je=re[Te];je.id?await de.updateArea(je.id,{name:je.name.trim(),weight:parseFloat(je.weight),sort_order:Te}):await de.createArea({project_id:f.id,name:je.name.trim(),weight:parseFloat(je.weight),status:"not_started",sort_order:Te})}const Qe=await de.getProject(f.id);v(Qe),await Vt(f.id),U(!1),K(null),i("Project updated!","success")}catch(ue){console.error("Error saving project:",ue?.message||ue),i(ue?.message||"Error saving changes","error")}finally{D(!1)}},Ee=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await de.deleteProject(f.id),i("Project deleted","success"),ze()}catch(N){console.error("Error deleting project:",N),i("Error deleting project","error")}},ae=p.useMemo(()=>f?x.find(N=>N.id===f.id):null,[f,x]),Se=p.useMemo(()=>{if(!f)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const N=gf(y),re=N.progress,ce=ae?.changeOrderValue||0,ue=f.contract_value+ce,Oe=N.isValueBased?N.earnedValue:re/100*ue;return{progress:re,billable:Oe,changeOrderValue:ce,revisedContractValue:ue,isValueBased:N.isValueBased,earnedValue:N.earnedValue,totalSOVValue:N.totalValue}},[f,y,ae]),ct=p.useMemo(()=>{const N=x.reduce((lt,pt)=>lt+(pt.contract_value||0),0),re=x.reduce((lt,pt)=>lt+(pt.changeOrderValue||0),0),ce=N+re,ue=x.reduce((lt,pt)=>lt+(pt.billable||0),0),Oe=ce-ue,Qe=ce>0?Math.round(ue/ce*100):0,Te=x.reduce((lt,pt)=>lt+(pt.corPendingValue||0),0),je=x.reduce((lt,pt)=>lt+(pt.corPendingCount||0),0);return{totalOriginalContract:N,totalChangeOrders:re,totalPortfolioValue:ce,totalEarned:ue,totalRemaining:Oe,weightedCompletion:Qe,totalPendingCORValue:Te,totalPendingCORCount:je}},[x]),Pe=p.useMemo(()=>{let N=0,re=0,ce=0,ue=0,Oe=0;for(const Qe of x){const Te=Qe.revisedContractValue||Qe.contract_value;Qe.progress>=100&&N++,Qe.progress<100&&Qe.billable<=Te*(Qe.progress/100)*1.1&&re++,Qe.billable>Te*.9&&Qe.progress<90&&ce++,Qe.billable>Te&&ue++,(Qe.changeOrderValue||0)>0&&Oe++}return{projectsComplete:N,projectsOnTrack:re,projectsAtRisk:ce,projectsOverBudget:ue,projectsWithChangeOrders:Oe}},[x]),{totalOriginalContract:Ut,totalChangeOrders:Rt,totalPortfolioValue:ut,totalEarned:Gt,totalRemaining:Lt,weightedCompletion:Et,totalPendingCORValue:et,totalPendingCORCount:tt}=ct,{projectsComplete:xt,projectsOnTrack:jt,projectsAtRisk:ne,projectsOverBudget:Ne,projectsWithChangeOrders:pe}=Pe;if(Y)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(f){const{progress:N,billable:re,changeOrderValue:ce,revisedContractValue:ue,isValueBased:Oe,earnedValue:Qe,totalSOVValue:Te}=Se;if(H&&z){const Re=z.areas.reduce((Ze,ra)=>Ze+(parseFloat(ra.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Me,style:{marginBottom:"1.5rem"},children:" Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:z.name,onChange:Ze=>Ce("name",Ze.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:z.job_number,onChange:Ze=>Ce("job_number",Ze.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:z.address,onChange:Ze=>Ce("address",Ze.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:z.general_contractor,onChange:Ze=>Ce("general_contractor",Ze.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:z.client_contact,onChange:Ze=>Ce("client_contact",Ze.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:z.client_phone,onChange:Ze=>Ce("client_phone",Ze.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:z.contract_value,onChange:Ze=>Ce("contract_value",Ze.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:z.pin,onChange:Ze=>Ce("pin",Ze.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:z.work_type,onChange:Ze=>Ce("work_type",Ze.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:z.job_type,onChange:Ze=>Ce("job_type",Ze.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:z.default_dump_site_id,onChange:Ze=>Ce("default_dump_site_id",Ze.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),I.map(Ze=>e.jsx("option",{value:Ze.id,children:Ze.name},Ze.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),z.areas.map((Ze,ra)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:Ze.name,onChange:Ue=>Xe(ra,"name",Ue.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:Ze.weight,onChange:Ue=>Xe(ra,"weight",Ue.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>T(ra),children:""})]},ra)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Re===100?"valid":"invalid"}`,children:[Re,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:X,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:_e,disabled:E,style:{flex:1},children:E?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:Ee,children:"Delete Project"})]})}const je=y.filter(Re=>Re.status==="done").length,lt=y.filter(Re=>Re.status==="working").length,pt=y.filter(Re=>Re.status==="not_started").length,Bt=ue>0?Math.round(re/ue*100):0,la=ce>0,vt=[{id:"overview",label:"Overview",Icon:hf},{id:"financials",label:"Financials",Icon:ll},{id:"reports",label:"Reports",Icon:Ra},{id:"activity",label:"Activity",Icon:fs},{id:"info",label:"Info",Icon:id}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:ze,children:[e.jsx("span",{children:""}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>te(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>Z(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:Ae,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:f.name}),(f.job_number||f.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[f.job_number&&`Job #${f.job_number}`,f.job_number&&f.work_type&&"  ",f.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[N,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:Dt(re)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:Dt(ue-re)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:vt.map(Re=>e.jsxs("button",{className:`pv-tab ${Q===Re.id?"active":""}`,onClick:()=>F(Re.id),children:[e.jsx(Re.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:Re.label})]},Re.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[Q==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab",children:[e.jsx("div",{className:"overview-hero",children:e.jsxs("div",{className:"overview-hero-grid",children:[e.jsxs("div",{className:"overview-metric primary",children:[e.jsxs("div",{className:"overview-metric-value",children:[N,"%"]}),e.jsx("div",{className:"overview-metric-label",children:"Complete"}),e.jsx("div",{className:"overview-metric-bar",children:e.jsx("div",{className:"overview-metric-fill",style:{width:`${N}%`}})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsxs("div",{className:"overview-metric-value",children:[je,"/",y.length]}),e.jsx("div",{className:"overview-metric-label",children:"Areas Done"}),e.jsx("div",{className:"overview-metric-detail",children:lt>0&&e.jsxs("span",{className:"working",children:[lt," active"]})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value",children:Dt(ue)}),e.jsx("div",{className:"overview-metric-label",children:"Contract"}),la&&e.jsxs("div",{className:"overview-metric-detail green",children:["+",Dt(ce)," COs"]})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value green",children:Dt(re)}),e.jsx("div",{className:"overview-metric-label",children:"Earned"}),e.jsx("div",{className:"overview-metric-detail",children:Oe?e.jsxs("span",{children:["of ",Dt(Te)," SOV"]}):e.jsxs("span",{children:[Bt,"% billed"]})})]})]})}),(ae?.pendingTickets>0||ae?.pendingMaterialRequests>0||ae?.changeOrderPending>0)&&e.jsxs("div",{className:"overview-attention-card",children:[e.jsxs("div",{className:"attention-header",children:[e.jsx("h3",{children:"Needs Attention"}),e.jsxs("span",{className:"attention-count",children:[(ae?.pendingTickets||0)+(ae?.pendingMaterialRequests||0)+(ae?.changeOrderPending||0)," items"]})]}),e.jsxs("div",{className:"attention-items",children:[ae?.pendingTickets>0&&e.jsxs("div",{className:"attention-item",onClick:()=>F("financials"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(Ra,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[ae.pendingTickets," T&M ticket",ae.pendingTickets!==1?"s":""," awaiting approval"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]}),ae?.changeOrderPending>0&&e.jsxs("div",{className:"attention-item",onClick:()=>F("financials"),children:[e.jsx("div",{className:"attention-item-icon info",children:e.jsx(za,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[ae.changeOrderPending," change order",ae.changeOrderPending!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]}),ae?.pendingMaterialRequests>0&&e.jsxs("div",{className:"attention-item",onClick:()=>F("activity"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(fs,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[ae.pendingMaterialRequests," material request",ae.pendingMaterialRequests!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Activity"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]})]})]}),e.jsxs("div",{className:"overview-section-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[je>0&&e.jsxs("span",{className:"section-badge done",children:[je," Complete"]}),lt>0&&e.jsxs("span",{className:"section-badge working",children:[lt," Active"]}),pt>0&&e.jsxs("span",{className:"section-badge pending",children:[pt," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list",children:y.map(Re=>e.jsxs("div",{className:`work-area-item ${Re.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[Re.status==="done"&&e.jsx("span",{className:"status-icon done",children:""}),Re.status==="working"&&e.jsx("span",{className:"status-icon working",children:""}),Re.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:""})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:Re.name}),e.jsx("span",{className:"work-area-weight",children:Re.scheduled_value?Dt(Re.scheduled_value):`${Re.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${Re.status}`,style:{width:Re.status==="done"?"100%":Re.status==="working"?"50%":"0%"}})})]},Re.id))})]}),e.jsxs("div",{className:"overview-stats-row",children:[e.jsxs("div",{className:"quick-stat-card",onClick:()=>F("reports"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(Ra,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:ae?.dailyReportsCount||0}),e.jsx("span",{className:"quick-stat-label",children:"Daily Reports"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>F("financials"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(ll,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:ae?.totalTickets||0}),e.jsx("span",{className:"quick-stat-label",children:"T&M Tickets"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>F("activity"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(fs,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:ae?.totalMaterialRequests||0}),e.jsx("span",{className:"quick-stat-label",children:"Material Requests"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]})]})]}),Q==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsx("div",{className:"financials-hero",children:e.jsxs("div",{className:"financials-hero-grid",children:[e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Contract"}),e.jsx("div",{className:"fin-metric-value",children:Dt(ue)}),la&&e.jsxs("div",{className:"fin-metric-detail green",children:["+",Dt(ce)," COs"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Earned"}),e.jsx("div",{className:"fin-metric-value",children:Dt(re)}),e.jsx("div",{className:"fin-metric-bar",children:e.jsx("div",{className:"fin-metric-fill",style:{width:`${Bt}%`}})})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Costs"}),e.jsx("div",{className:"fin-metric-value",children:Dt(ae?.allCostsTotal||0)}),re>0&&e.jsxs("div",{className:`fin-metric-detail ${(ae?.allCostsTotal||0)/re>.6?"warning":""}`,children:[Math.round((ae?.allCostsTotal||0)/re*100),"% of revenue"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Profit"}),e.jsx("div",{className:`fin-metric-value ${(ae?.currentProfit||0)<0?"negative":"positive"}`,children:Dt(ae?.currentProfit||0)}),e.jsxs("div",{className:`fin-metric-detail ${(ae?.profitMargin||0)<20?"warning":""}`,children:[Math.round(ae?.profitMargin||0),"% margin"]})]})]})}),e.jsxs("div",{className:"financials-analysis-row",children:[e.jsx(Lv,{dailyBurn:ae?.dailyBurn||0,totalBurn:ae?.totalBurn||0,daysWorked:ae?.totalBurnDays||0,laborCost:ae?.laborCost||0,haulOffCost:ae?.haulOffCost||0,progress:N,contractValue:ue,laborByDate:ae?.laborByDate||[],haulOffByDate:ae?.haulOffByDate||[]}),e.jsx(Fv,{revenue:re,totalCosts:ae?.allCostsTotal||0,contractValue:ue,progress:N})]}),e.jsx(Bv,{laborCost:ae?.laborCost||0,haulOffCost:ae?.haulOffCost||0,customCosts:ae?.customCosts||[],onAddCost:()=>$(!0),onDeleteCost:async Re=>{try{await de.deleteProjectCost(Re),nt(),i("Cost deleted","success")}catch{i("Error deleting cost","error")}}}),e.jsxs("div",{className:"financials-pipeline",children:[e.jsxs("div",{className:"pipeline-header",children:[e.jsx("h2",{children:"Extra Work"}),e.jsxs("div",{className:"pipeline-flow",children:[e.jsx("span",{className:"pipeline-step",children:"T&M Tickets"}),e.jsx("span",{className:"pipeline-arrow",children:""}),e.jsx("span",{className:"pipeline-step active",children:"Change Orders"})]})]}),e.jsxs("div",{className:"pipeline-content",children:[e.jsxs("div",{className:"pipeline-section",children:[e.jsxs("div",{className:"pipeline-section-header",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("span",{className:"pipeline-badge",children:[ae?.totalTickets||0," total",ae?.pendingTickets>0&&`  ${ae.pendingTickets} pending`]})]}),e.jsx(vv,{project:f,company:l,onShowToast:i})]}),e.jsx("div",{className:"pipeline-section",children:e.jsx(Tv,{project:f,company:l,areas:y,refreshKey:V,onShowToast:i,onCreateCOR:()=>{ee(null),_(!0)},onViewCOR:Re=>{he(Re),k(!0)},onEditCOR:Re=>{ee(Re),_(!0)}})})]})]}),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(na,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:Dt(ae?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(Ev,{project:f,company:l,onShowToast:i})})]})]}),Q==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(Ra,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:ae?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:ae?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((ae?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:`reports-metric ${(ae?.injuryReportsCount||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"reports-metric-value",children:ae?.injuryReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Injuries"}),e.jsx("div",{className:"reports-metric-status",children:(ae?.injuryReportsCount||0)===0?"No incidents":"Review required"})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value small",children:ae?.lastDailyReport?new Date(ae.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"None"}),e.jsx("div",{className:"reports-metric-label",children:"Last Filed"}),ae?.lastDailyReport&&e.jsxs("div",{className:"reports-metric-detail",children:[Math.floor((new Date-new Date(ae.lastDailyReport))/(1e3*60*60*24))," days ago"]})]})]})}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(Ra,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[ae?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(wv,{project:f,company:l,onShowToast:i})})]}),e.jsxs("div",{className:`reports-section-card ${(ae?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(ae?.injuryReportsCount||0)>0?"warning":"success"}`,children:(ae?.injuryReportsCount||0)>0?"":""}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(ae?.injuryReportsCount||0)>0?"warning":"success"}`,children:(ae?.injuryReportsCount||0)>0?`${ae.injuryReportsCount} incident${ae.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(_v,{project:f,companyId:l?.id||f?.company_id,company:l,onShowToast:i})})]})]}),Q==="activity"&&e.jsxs("div",{className:"pv-tab-panel activity-tab",children:[e.jsx("div",{className:"activity-hero",children:e.jsxs("div",{className:"activity-hero-grid",children:[e.jsxs("div",{className:`activity-metric ${(ae?.pendingMaterialRequests||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"activity-metric-icon",children:(ae?.pendingMaterialRequests||0)>0?"!":""}),e.jsxs("div",{className:"activity-metric-content",children:[e.jsx("div",{className:"activity-metric-value",children:ae?.pendingMaterialRequests||0}),e.jsx("div",{className:"activity-metric-label",children:"Pending"})]})]}),e.jsxs("div",{className:"activity-metric",children:[e.jsx("div",{className:"activity-metric-value",children:ae?.totalMaterialRequests||0}),e.jsx("div",{className:"activity-metric-label",children:"Total Requests"})]}),e.jsxs("div",{className:"activity-metric",children:[e.jsxs("div",{className:"activity-metric-value",children:[ae?.totalMaterialRequests>0?Math.round((ae.totalMaterialRequests-(ae.pendingMaterialRequests||0))/ae.totalMaterialRequests*100):100,"%"]}),e.jsx("div",{className:"activity-metric-label",children:"Fulfilled"}),e.jsx("div",{className:"activity-metric-bar",children:e.jsx("div",{className:"activity-metric-fill",style:{width:`${ae?.totalMaterialRequests>0?(ae.totalMaterialRequests-(ae.pendingMaterialRequests||0))/ae.totalMaterialRequests*100:100}%`}})})]}),e.jsxs("div",{className:"activity-metric status",children:[e.jsx("div",{className:"activity-metric-status-icon",children:e.jsx(fs,{size:20})}),e.jsx("div",{className:"activity-metric-label",children:"Messages Active"})]})]})}),(ae?.pendingMaterialRequests||0)>0&&e.jsxs("div",{className:"activity-attention-banner",children:[e.jsx("span",{className:"attention-icon",children:"!"}),e.jsxs("span",{className:"attention-text",children:[ae.pendingMaterialRequests," material request",ae.pendingMaterialRequests!==1?"s":""," awaiting response"]})]}),e.jsxs("div",{className:`activity-section-card ${(ae?.pendingMaterialRequests||0)>0?"has-pending":""}`,children:[e.jsxs("div",{className:"activity-section-header",children:[e.jsxs("div",{className:"activity-section-title",children:[e.jsx(na,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("div",{className:"activity-section-badges",children:[(ae?.pendingMaterialRequests||0)>0&&e.jsxs("span",{className:"activity-badge pending",children:[ae.pendingMaterialRequests," pending"]}),e.jsxs("span",{className:"activity-badge total",children:[ae?.totalMaterialRequests||0," total"]})]})]}),e.jsx("div",{className:"activity-section-content",children:e.jsx(Sv,{project:f,company:l,onShowToast:i})})]}),e.jsxs("div",{className:"activity-section-card messages",children:[e.jsx("div",{className:"activity-section-header",children:e.jsxs("div",{className:"activity-section-title",children:[e.jsx(fs,{size:18}),e.jsx("h3",{children:"Project Messages"})]})}),e.jsx("div",{className:"activity-section-content",children:e.jsx(kv,{project:f,company:l,userName:l?.name||"Office",onShowToast:i})})]})]}),Q==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:f.name}),f.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",f.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:Ae,children:e.jsx("span",{children:"Edit Project"})})]}),f.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(_j,{size:14}),e.jsx("span",{children:f.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(na,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:f.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(za,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:f.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ll,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:Dt(ue)}),e.jsx("span",{className:"info-quick-label",children:ce>0?`Incl. +${Dt(ce)} COs`:"Contract Value"})]})]}),f.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:f.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Di,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[f.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:f.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),f.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:f.client_contact})]}),f.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(qj,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${f.client_phone}`,className:"info-detail-value link",children:f.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(hf,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[je>0&&e.jsxs("span",{className:"info-badge done",children:[je," Done"]}),lt>0&&e.jsxs("span",{className:"info-badge working",children:[lt," Active"]}),pt>0&&e.jsxs("span",{className:"info-badge pending",children:[pt," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:y.map(Re=>e.jsxs("div",{className:`info-area-item ${Re.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[Re.status==="done"&&e.jsx("span",{className:"status-dot done",children:""}),Re.status==="working"&&e.jsx("span",{className:"status-dot working",children:""}),Re.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:""})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:Re.name}),e.jsx("span",{className:`info-area-status-label ${Re.status}`,children:Re.status==="done"?"Complete":Re.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[Re.weight,"%"]})]},Re.id))})]}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(id,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:Dt(f.contract_value)})]}),ce>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",Dt(ce)]})]}),f.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:I.find(Re=>Re.id===f.default_dump_site_id)?.name||"Unknown"})]})]})]})]})]}),S&&e.jsx(yv,{project:f,onClose:()=>te(!1),onShareCreated:Re=>{i("Share link created successfully!","success")}}),se&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(Nv,{project:f,company:l,onShowToast:i,onClose:()=>Z(!1)})}),j&&e.jsx(Rv,{project:f,company:l,areas:y,existingCOR:C,onClose:()=>{_(!1),ee(null)},onSaved:()=>{_(!1),ee(null),q(Re=>Re+1)},onShowToast:i}),w&&M&&e.jsx(Ov,{cor:M,project:f,company:l,areas:y,onClose:()=>{k(!1),he(null)},onEdit:Re=>{k(!1),he(null),ee(Re),_(!0)},onShowToast:i,onStatusChange:()=>{}}),L&&e.jsx($v,{onClose:()=>$(!1),saving:xe,onSave:async Re=>{try{be(!0),await de.addProjectCost(f.id,l.id,Re),$(!1),nt(),i("Cost added successfully","success")}catch(Ze){console.error("Error adding cost:",Ze),i("Error adding cost","error")}finally{be(!1)}}})]})}return m.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Ra,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("div",{className:"bo-project-count",children:[m.length," Active Project",m.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(Et,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Dt(Gt)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Dt(ut)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:Dt(Lt)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Rt>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:Dt(Ut)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",pe," project",pe!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",Dt(Rt)]})]})]}),tt>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:Dt(et)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",tt," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[xt>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:xt}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),jt>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:jt}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),ne>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:ne}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),Ne>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:Ne}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[m.length," active"]})]}),e.jsx("div",{className:"project-list",children:x.map(N=>e.jsx(Gv,{project:N,onClick:()=>ke(N)},N.id))})]})}function Gv({project:l,onClick:i}){const o=If(l.areas||[]),c=cv(l.areas||[]),m=l.contract_value-l.billable,u=l.billable>l.contract_value*.9&&l.progress<90;return e.jsxs("div",{className:`project-card enhanced ${u?"at-risk":""}`,onClick:i,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:l.name}),e.jsx("div",{className:"project-card-value",children:Dt(l.contract_value)})]}),e.jsx("span",{className:`status-badge ${o}`,children:c})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[l.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:Dt(l.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${m<0?"negative":""}`,children:Dt(Math.abs(m))}),e.jsx("span",{className:"stat-label",children:m>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${l.progress}%`}})}),(l.pendingTickets>0||l.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[l.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[l.pendingTickets," Pending T&M"]}),l.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[l.approvedTickets," Approved T&M"]})]})]})}const ed=l=>{if(l==null||l==="")return"";const i=parseFloat(l);return isNaN(i)?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(i)},wf=l=>{if(!l)return null;const i=String(l).replace(/[$,\s]/g,""),o=parseFloat(i);return isNaN(o)?null:o};function Yv({company:l,user:i,onProjectCreated:o,onShowToast:c}){const[m,u]=p.useState(""),[x,g]=p.useState(""),[f,v]=p.useState(""),[y,A]=p.useState(""),[Y,B]=p.useState(""),[H,U]=p.useState(""),[z,K]=p.useState("demolition"),[E,D]=p.useState("standard"),[S,te]=p.useState([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),[se,Z]=p.useState(!1),[Q,F]=p.useState(!1),[I,P]=p.useState(!1),[j,_]=p.useState([]),[C,ee]=p.useState(!1),w=p.useRef(null),k=S.reduce((ke,ze)=>ke+(parseFloat(ze.weight)||0),0),M=ke=>{const ze=ke.replace(/\D/g,"").slice(0,4);U(ze)},he=()=>{const ke=Math.floor(1e3+Math.random()*9e3).toString();U(ke)},V=(ke,ze,Ae)=>{te(Me=>Me.map((Ce,Xe)=>Xe===ke?{...Ce,[ze]:Ae}:Ce))},q=()=>{te(ke=>[...ke,{name:"",weight:"",group:"",scheduledValue:null}])},L=ke=>{S.length>1&&te(ze=>ze.filter((Ae,Me)=>Me!==ke))},$=(ke="value")=>{const ze=S.filter(X=>X.name.trim());if(ze.length===0){c("Add tasks first","error");return}let Ae=[...S];const Me=S.map((X,T)=>X.name.trim()?T:-1).filter(X=>X>=0);if(ke==="value"){const X=ze.reduce((T,_e)=>T+(parseFloat(_e.scheduledValue)||0),0);if(X===0)c("No scheduled values - using equal distribution","info"),ke="equal";else{let T=0;Me.forEach((_e,Ee)=>{const ae=parseFloat(S[_e].scheduledValue)||0;let Se;Ee===Me.length-1?Se=100-T:(Se=Math.round(ae/X*1e4)/100,T+=Se),Ae[_e]={...Ae[_e],weight:Se.toFixed(2)}}),te(Ae),ee(!1),c("Weights calculated by value","success");return}}const Ce=Math.round(100/Me.length*100)/100;let Xe=0;Me.forEach((X,T)=>{let _e;T===Me.length-1?_e=100-Xe:(_e=Ce,Xe+=_e),Ae[X]={...Ae[X],weight:_e.toFixed(2)}}),te(Ae),ee(!1),c("Weights distributed equally","success")},xe=()=>{u(""),g(""),v(""),A(""),B(""),U(""),K("demolition"),D("standard"),te([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),P(!1),_([])},be=()=>{w.current?.click()},Fe=ke=>new Promise((ze,Ae)=>{const Me=new FileReader;Me.onload=Ce=>{try{const Xe=new Uint8Array(Ce.target.result),X=px(Xe,{type:"array"}),T=X.SheetNames[0],_e=X.Sheets[T],Ee=Gs.sheet_to_json(_e,{header:1}),ae=[];let Se="General";const ct=/^\$?\d{1,3}(,\d{3})*(\.\d{2})?$/,Pe=/^(\d+\.?\d*|[A-Z]\.?\d*)$/i,Ut=/^(SF|LF|EA|LS|Days?|MD|Load|CY|SY|GAL|TON)$/i,Rt=/^\d{1,3}(,\d{3})*$|^\d+$/,ut=/^(Item|#|No\.?|Description|Scheduled|Value|Amount|Quantity|Unit|Total|Application|Balance|Completed|Stored|Retainage)/i;for(const Et of Ee){if(!Et||Et.length===0)continue;const et=Et.map(ce=>ce==null?"":String(ce).trim()).filter(ce=>ce.length>0);if(et.length===0)continue;const tt=et.join(" ");if(ut.test(et[0])||et.length>1&&ut.test(et[1])||/^(Total|Subtotal|Grand Total|Base Bid|Contract Sum)/i.test(tt))continue;const xt=et.some(ce=>ct.test(ce.replace(/[$,]/g,"")+(ce.includes(".")?"":".00")));if((!xt&&et.length<=3&&/^(L\d|Level|Floor|\d+(?:st|nd|rd|th)|Plaza|Street|Basement|Roof|Penthouse|Site|Exterior|Interior|Misc|MEP|ABATEMENT|DEMOLITION|UNIVERSAL|SOFT|TRASH|DEMO|Phase|Division|Section|Area|Building|Wing)/i.test(et[0])||et.length===2&&Pe.test(et[0])&&!xt&&!/^\d+\.\d+$/.test(et[0]))&&!xt){Se=(et.find(ue=>!Pe.test(ue)&&ue.length>1)||et.join(" ")).replace(/\s*\(\d{1,3}(?:,\d{3})*\s*SF\)\s*$/i,"").replace(/\s*[-:]\s*$/,"").trim();continue}let ne="",Ne=!1,pe="",N=null;const re=[];for(let ce=0;ce<et.length;ce++){const ue=et[ce];if(ce===0&&Pe.test(ue)){pe=ue;continue}if(!/^ID-\d+$/i.test(ue)&&!/^KN\s*\d+$/i.test(ue)){if(ct.test(ue.replace(/[$,]/g,"")+(ue.includes(".")?"":".00"))||/^\$/.test(ue)){const Oe=ue.replace(/[$,]/g,""),Qe=parseFloat(Oe);!isNaN(Qe)&&Qe>100&&(N===null||Qe>N)&&(N=Qe),Ne=!0;continue}if(Rt.test(ue.replace(/,/g,""))){Ne=!0;continue}Ut.test(ue)||/^\d+\.?\d*%$/.test(ue)||ue.length>1&&!Pe.test(ue)&&re.push(ue)}}ne=re.join(" ").trim(),ne=ne.replace(/\s+/g," ").replace(/^[-]\s*/,"").trim(),!(ne.length<3)&&(/^(Plan|Page|Total|Base Bid|Payment|Condition|Exclusion|Subtotal)/i.test(ne)||Ne&&ne.length>=3&&ae.push({name:ne,group:Se,itemNumber:pe,scheduledValue:N,selected:!0}))}const Gt=new Set,Lt=ae.filter(Et=>{const et=`${Et.group}:${Et.name}`;return Gt.has(et)?!1:(Gt.add(et),!0)});ze(Lt)}catch(Xe){Ae(Xe)}},Me.onerror=()=>Ae(new Error("Failed to read file")),Me.readAsArrayBuffer(ke)}),ye=async ke=>{const ze=ke.target.files?.[0];if(!ze)return;const Ae=ze.name.split(".").pop().toLowerCase();if(!["xlsx","xls","csv"].includes(Ae)){c("Please upload an Excel file (.xlsx, .xls, or .csv)","error");return}F(!0);try{const Me=await Fe(ze);if(Me.length===0){c("No tasks found. Check Excel format.","error"),F(!1);return}_(Me),P(!0),c(`Found ${Me.length} tasks`,"success")}catch(Me){console.error("Excel import error:",Me),c("Error reading Excel file","error")}finally{F(!1),w.current&&(w.current.value="")}},We=ke=>{_(ze=>ze.map((Ae,Me)=>Me===ke?{...Ae,selected:!Ae.selected}:Ae))},Ve=()=>{const ke=j.filter(Ce=>Ce.selected);if(ke.length===0){c("Please select at least one task","error");return}const ze=ke.reduce((Ce,Xe)=>Ce+(Xe.scheduledValue||0),0),Ae=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});let Me;if(ze>0){let Ce=0;Me=ke.map((Xe,X)=>{const T=Xe.scheduledValue||0;let _e;return X===ke.length-1?_e=100-Ce:(_e=Math.round(T/ze*1e4)/100,Ce+=_e),{name:Xe.name,weight:_e.toFixed(2),group:Xe.group,scheduledValue:Xe.scheduledValue||null}}),c(`Tasks imported with value-based weights! Total SOV: ${Ae.format(ze)}`,"success")}else{const Ce=Math.round(100/ke.length*100)/100;Me=ke.map((Xe,X)=>({name:Xe.name,weight:X===ke.length-1?(100-Ce*(ke.length-1)).toFixed(2):Ce.toFixed(2),group:Xe.group,scheduledValue:Xe.scheduledValue||null})),c("Tasks imported with equal weights","success")}te(Me),P(!1)},De=async()=>{if(!l?.id){c("No company selected. Please log in again.","error");return}if(!m.trim()){c("Please enter a project name","error");return}const ke=parseFloat(Y);if(!ke||ke<=0){c("Please enter a valid contract value","error");return}if(H.length!==4){c("Please enter a 4-digit PIN","error");return}if(!await de.isPinAvailable(H)){c("This PIN is already in use. Try another.","error");return}const Ae=S.filter(Me=>Me.name.trim()&&parseFloat(Me.weight)>0);if(Ae.length===0){c("Please add at least one area","error");return}if(Math.abs(k-100)>.1){c("Area weights must total 100%","error");return}Z(!0);try{const Me=await de.createProject({name:m.trim(),job_number:x.trim()||null,address:f.trim()||null,general_contractor:y.trim()||null,contract_value:ke,pin:H,work_type:z,job_type:E,company_id:l?.id,created_by:i?.id});for(let Ce=0;Ce<Ae.length;Ce++)await de.createArea({project_id:Me.id,name:Ae[Ce].name.trim(),weight:parseFloat(Ae[Ce].weight),scheduled_value:Ae[Ce].scheduledValue||null,group_name:Ae[Ce].group||null,status:"not_started",sort_order:Ce});c("Project created!","success"),xe(),o()}catch(Me){console.error("Error creating project:",Me),c("Error creating project","error")}finally{Z(!1)}};if(I){const ke=[...new Set(j.map(Ce=>Ce.group))],ze=j.filter(Ce=>Ce.selected).length,Ae=j.reduce((Ce,Xe)=>Ce+(Xe.scheduledValue||0),0),Me=j.filter(Ce=>Ce.selected).reduce((Ce,Xe)=>Ce+(Xe.scheduledValue||0),0);return e.jsxs("div",{children:[e.jsx("h1",{children:"Review Imported Tasks"}),e.jsx("p",{className:"subtitle",children:"Select the tasks to include in your project"}),e.jsxs("div",{className:"import-summary",children:[e.jsxs("span",{children:[ze," of ",j.length," tasks selected"]}),Ae>0&&e.jsxs("span",{className:"import-sov-total",children:[" Total SOV: ",new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(Me)]})]}),ke.map(Ce=>{const Xe=j.filter(T=>T.group===Ce),X=Xe.filter(T=>T.selected).length;return e.jsxs("div",{className:"card import-group",children:[e.jsxs("div",{className:"import-group-header",children:[e.jsx("h3",{children:Ce}),e.jsxs("span",{className:"import-group-count",children:[X,"/",Xe.length]})]}),e.jsx("div",{className:"import-task-list",children:Xe.map(T=>{const _e=j.indexOf(T);return e.jsxs("label",{className:"import-task-item",children:[e.jsx("input",{type:"checkbox",checked:T.selected,onChange:()=>We(_e)}),e.jsx("span",{className:"import-task-name",children:T.name}),T.scheduledValue>0&&e.jsx("span",{className:"import-task-value",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(T.scheduledValue)})]},_e)})})]},Ce)}),e.jsxs("div",{className:"import-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>P(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:Ve,children:["Use Selected Tasks (",ze,")"]})]})]})}const nt=S.reduce((ke,ze,Ae)=>{const Me=ze.group||"General";return ke[Me]||(ke[Me]=[]),ke[Me].push({...ze,originalIndex:Ae}),ke},{}),Vt=Object.keys(nt).length>1||Object.keys(nt).length===1&&!nt.General;return e.jsxs("div",{children:[e.jsx("h1",{children:"New Project"}),e.jsx("p",{className:"subtitle",children:"Set up a new project to track"}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Name"}),e.jsx("input",{type:"text",placeholder:"e.g., Sunrise Apartments",value:m,onChange:ke=>u(ke.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",placeholder:"e.g., 4032",value:x,onChange:ke=>g(ke.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($)"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"e.g., 365000",value:Y,onChange:ke=>{const ze=ke.target.value.replace(/[^0-9.]/g,"");B(ze)},className:"currency-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",placeholder:"e.g., 123 Main St, Los Angeles, CA 90001",value:f,onChange:ke=>v(ke.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",placeholder:"e.g., ABC Construction Inc.",value:y,onChange:ke=>A(ke.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${z==="demolition"?"active":""}`,onClick:()=>K("demolition"),children:"Demolition"}),e.jsx("button",{type:"button",className:`toggle-btn ${z==="abatement"?"active":""}`,onClick:()=>K("abatement"),children:"Abatement"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${E==="standard"?"active":""}`,onClick:()=>D("standard"),children:"Standard"}),e.jsx("button",{type:"button",className:`toggle-btn ${E==="pla"?"active":""}`,onClick:()=>D("pla"),children:"PLA"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN (4 digits)"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Foremen will enter this PIN to access this project"}),e.jsxs("div",{className:"pin-input-row",children:[e.jsx("input",{type:"text",placeholder:"e.g., 2847",value:H,onChange:ke=>M(ke.target.value),maxLength:4,className:"pin-input"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:he,children:"Generate"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"areas-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Areas / Tasks"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginTop:"0.25rem"},children:"Define the areas for this project. Weights must total 100%."})]}),e.jsxs("div",{className:"import-btn-container",children:[e.jsx("input",{ref:w,type:"file",accept:".xlsx,.xls,.csv",onChange:ye,style:{display:"none"}}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:be,disabled:Q,children:Q?"Reading...":" Import Excel"})]})]}),Vt?Object.entries(nt).map(([ke,ze])=>e.jsxs("div",{className:"area-group",children:[e.jsx("div",{className:"area-group-header",children:ke}),ze.map(Ae=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Task name",value:Ae.name,onChange:Me=>V(Ae.originalIndex,"name",Me.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:Ae.scheduledValue?ed(Ae.scheduledValue):"",onChange:Me=>V(Ae.originalIndex,"scheduledValue",wf(Me.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:Ae.weight,onChange:Me=>V(Ae.originalIndex,"weight",Me.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>L(Ae.originalIndex),children:""})]},Ae.originalIndex))]},ke)):S.map((ke,ze)=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Area name (e.g., Level 1)",value:ke.name,onChange:Ae=>V(ze,"name",Ae.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:ke.scheduledValue?ed(ke.scheduledValue):"",onChange:Ae=>V(ze,"scheduledValue",wf(Ae.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:ke.weight,onChange:Ae=>V(ze,"weight",Ae.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>L(ze),children:""})]},ze)),e.jsxs("div",{className:"weight-total-row",children:[e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Math.abs(k-100)<.1?"valid":"invalid"}`,children:[k.toFixed(1),"%"]}),S.some(ke=>ke.scheduledValue>0)&&e.jsxs("span",{className:"sov-total",children:[" SOV: ",ed(S.reduce((ke,ze)=>ke+(parseFloat(ze.scheduledValue)||0),0))]})]}),e.jsxs("div",{className:"auto-weight-dropdown",children:[e.jsx("button",{type:"button",className:"btn btn-secondary btn-small",onClick:()=>ee(!C),children:"Auto-Calculate "}),C&&e.jsxs("div",{className:"weight-dropdown-menu",children:[e.jsxs("button",{onClick:()=>$("value"),children:["By Value ",e.jsx("span",{className:"dropdown-hint",children:"(Recommended)"})]}),e.jsx("button",{onClick:()=>$("equal"),children:"Equal Distribution"})]})]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:q,children:"+ Add Area"})]}),e.jsx("button",{className:"btn btn-primary btn-full",onClick:De,disabled:se,children:se?"Creating...":"Create Project"})]})}function Qv({company:l,onShowToast:i}){const{branding:o,updateBranding:c,uploadBrandingImage:m,loading:u}=il(),[x,g]=p.useState(!1),[f,v]=p.useState(!1),[y,A]=p.useState(o),[Y,B]=p.useState(""),[H,U]=p.useState(!1),z=p.useRef(null),K=p.useRef(null),E=p.useRef(null);p.useEffect(()=>{l?.id&&D()},[l?.id]);const D=async()=>{try{const{data:C,error:ee}=await O.from("companies").select("office_code").eq("id",l.id).single();!ee&&C?.office_code&&B(C.office_code)}catch(C){console.error("Error loading office code:",C)}},S=async()=>{if(confirm("Regenerate office code? Current code will stop working immediately.")){U(!0);try{const C=Math.random().toString(36).substring(2,8).toUpperCase(),{error:ee}=await O.from("companies").update({office_code:C}).eq("id",l.id);if(ee)throw ee;B(C),i?.("Office code regenerated","success")}catch(C){console.error("Error regenerating code:",C),i?.("Error regenerating code","error")}finally{U(!1)}}},te=()=>{navigator.clipboard.writeText(Y),i?.("Office code copied to clipboard","success")},se=l?.subscription_tier||"free",Z=["pro","business","enterprise"].includes(se),Q=["business","enterprise"].includes(se),F=se==="enterprise",I=(C,ee)=>{A(w=>({...w,[C]:ee}))},P=async(C,ee)=>{if(C){if(C.size>5*1024*1024){i?.("Image must be smaller than 5MB","error");return}if(!C.type.startsWith("image/")){i?.("Please upload an image file","error");return}try{const w=await m(C,ee);w.success?(I(`${ee}_url`,w.url),i?.(`${ee.charAt(0).toUpperCase()+ee.slice(1)} uploaded successfully`,"success")):i?.(w.error||"Failed to upload image","error")}catch(w){console.error("Upload error:",w),i?.("Failed to upload image","error")}}},j=async()=>{try{g(!0);const C=/^#[0-9A-F]{6}$/i;if(!C.test(y.primary_color)){i?.("Primary color must be a valid hex color (e.g., #3B82F6)","error");return}if(!C.test(y.secondary_color)){i?.("Secondary color must be a valid hex color (e.g., #1E40AF)","error");return}const ee=await c(y);ee.success?i?.("Branding settings saved successfully!","success"):i?.(ee.error||"Failed to save branding settings","error")}catch(C){console.error("Save error:",C),i?.("Failed to save branding settings","error")}finally{g(!1)}},_=()=>{f?(document.documentElement.style.setProperty("--primary-color",o.primary_color),document.documentElement.style.setProperty("--secondary-color",o.secondary_color),document.title=o.custom_app_name||"FieldSync"):(document.documentElement.style.setProperty("--primary-color",y.primary_color),document.documentElement.style.setProperty("--secondary-color",y.secondary_color),document.title=y.custom_app_name||"FieldSync"),v(!f)};return u?e.jsxs("div",{className:"settings-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading branding settings..."})]}):e.jsxs("div",{className:"branding-settings",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("h2",{children:" Branding Settings"}),se==="free"&&e.jsx("div",{className:"tier-badge tier-free",children:"Free Plan - Upgrade for branding options"}),se==="pro"&&e.jsx("div",{className:"tier-badge tier-pro",children:"Pro Plan"}),se==="business"&&e.jsx("div",{className:"tier-badge tier-business",children:"Business Plan"}),se==="enterprise"&&e.jsx("div",{className:"tier-badge tier-enterprise",children:"Enterprise Plan"})]}),e.jsxs("div",{className:"settings-section security-section",children:[e.jsx("h3",{children:"Security"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Office Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Share this code with office staff only. Required to create new office accounts."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:Y||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:te,disabled:!Y,children:"Copy"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:S,disabled:H,children:H?"...":"Regenerate"})]}),e.jsx("p",{className:"help-text",style:{marginTop:"0.5rem",color:"var(--accent-amber)"},children:"Field workers should NOT have this code - they use project PINs only."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Company Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Public code for employees to find your company."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:l?.code||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:()=>{navigator.clipboard.writeText(l?.code||""),i?.("Company code copied","success")},disabled:!l?.code,children:"Copy"})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Visual Identity"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Logo"}),Z?e.jsxs(e.Fragment,{children:[y.logo_url&&e.jsx("div",{className:"logo-preview",children:e.jsx("img",{src:y.logo_url,alt:"Logo preview"})}),e.jsx("input",{ref:z,type:"file",accept:"image/*",style:{display:"none"},onChange:C=>P(C.target.files[0],"logo")}),e.jsx("button",{className:"btn-secondary",onClick:()=>z.current?.click(),children:y.logo_url?"Change Logo":"Upload Logo"}),e.jsx("p",{className:"help-text",children:"Recommended: 200x60px, PNG with transparent background"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your logo"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"app-name",children:"App Name"}),Z?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"app-name",type:"text",className:"input",value:y.custom_app_name||"",onChange:C=>I("custom_app_name",C.target.value),placeholder:"FieldSync",maxLength:50}),e.jsx("p",{className:"help-text",children:"This name appears in the browser tab and throughout the app"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your app name"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"primary-color",children:"Primary Color"}),Z?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"primary-color",type:"color",value:y.primary_color||"#3B82F6",onChange:C=>I("primary_color",C.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:y.primary_color||"#3B82F6",onChange:C=>I("primary_color",C.target.value),placeholder:"#3B82F6",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"secondary-color",children:"Secondary Color"}),Z?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"secondary-color",type:"color",value:y.secondary_color||"#1E40AF",onChange:C=>I("secondary_color",C.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:y.secondary_color||"#1E40AF",onChange:C=>I("secondary_color",C.target.value),placeholder:"#1E40AF",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Favicon"}),Z?e.jsxs(e.Fragment,{children:[y.favicon_url&&e.jsx("div",{className:"favicon-preview",children:e.jsx("img",{src:y.favicon_url,alt:"Favicon preview"})}),e.jsx("input",{ref:K,type:"file",accept:"image/*",style:{display:"none"},onChange:C=>P(C.target.files[0],"favicon")}),e.jsx("button",{className:"btn-secondary",onClick:()=>K.current?.click(),children:y.favicon_url?"Change Favicon":"Upload Favicon"}),e.jsx("p",{className:"help-text",children:"Recommended: 32x32px or 64x64px, PNG or ICO format"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your favicon"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Login Background"}),Q?e.jsxs(e.Fragment,{children:[y.login_background_url&&e.jsx("div",{className:"background-preview",children:e.jsx("img",{src:y.login_background_url,alt:"Background preview"})}),e.jsx("input",{ref:E,type:"file",accept:"image/*",style:{display:"none"},onChange:C=>P(C.target.files[0],"login_background")}),e.jsx("button",{className:"btn-secondary",onClick:()=>E.current?.click(),children:y.login_background_url?"Change Background":"Upload Background"}),e.jsx("p",{className:"help-text",children:"Recommended: 1920x1080px, JPG or PNG"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Business or Enterprise to customize login background"})})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"White-Label Options"}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:y.hide_fieldsync_branding||!1,onChange:C=>I("hide_fieldsync_branding",C.target.checked),disabled:!Q}),e.jsx("span",{children:'Hide "Powered by FieldSync"'})]}),!Q&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Email Branding"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-name",children:"From Name"}),e.jsx("input",{id:"email-from-name",type:"text",className:"input",value:y.email_from_name||"",onChange:C=>I("email_from_name",C.target.value),placeholder:"Your Company Name",disabled:!Q}),!Q&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-address",children:"From Email"}),e.jsx("input",{id:"email-from-address",type:"email",className:"input",value:y.email_from_address||"",onChange:C=>I("email_from_address",C.target.value),placeholder:"noreply@yourcompany.com",disabled:!Q}),!Q&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Custom Domain"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"custom-domain",children:"Domain"}),F?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"custom-domain",type:"text",className:"input",value:y.custom_domain||"",onChange:C=>I("custom_domain",C.target.value),placeholder:"app.yourcompany.com"}),y.custom_domain&&e.jsx("div",{className:`domain-status ${y.domain_verified?"verified":"pending"}`,children:y.domain_verified?e.jsx(e.Fragment,{children:" Connected"}):e.jsx(e.Fragment,{children:" DNS setup required"})}),e.jsx("p",{className:"help-text",children:"Contact support to configure DNS and SSL certificate for your custom domain"})]}):e.jsxs("div",{className:"upgrade-notice",children:[e.jsx("p",{children:" Enterprise plan required for custom domain support"}),e.jsx("p",{className:"help-text",children:"Custom domains allow you to host the app at your own URL (e.g., app.yourcompany.com)"})]})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:_,children:f?"Exit Preview":"Preview Changes"}),e.jsx("button",{className:"btn-primary",onClick:j,disabled:x||!Z,children:x?"Saving...":"Save Changes"})]}),f&&e.jsx("div",{className:"preview-banner",children:"Preview Mode Active - Your changes are not yet saved"})]})}const td=["foreman","operator","laborer"],ad=["demolition","abatement"],sd=["standard","pla"];function Xv({company:l,onShowToast:i}){const[o,c]=p.useState({}),[m,u]=p.useState(!1),[x,g]=p.useState(!1),[f,v]=p.useState("demolition"),[y,A]=p.useState(!0);p.useEffect(()=>{l?.id&&B()},[l?.id]);const Y=()=>{const D={};return ad.forEach(S=>{D[S]={},sd.forEach(te=>{D[S][te]={},td.forEach(se=>{D[S][te][se]={regular:"",overtime:""}})})}),D},B=async()=>{if(!J){c(Y()),A(!1);return}const D=Y();try{const{data:S,error:te}=await O.from("labor_rates").select("*").eq("company_id",l.id);if(te){c(D),A(!1);return}S&&S.length>0&&S.forEach(se=>{D[se.work_type]&&D[se.work_type][se.job_type]&&D[se.work_type][se.job_type][se.role]&&(D[se.work_type][se.job_type][se.role]={regular:se.regular_rate||"",overtime:se.overtime_rate||""})}),c(D)}catch(S){console.error("Error loading labor rates:",S),c(D)}finally{A(!1)}},H=async()=>{if(!J){i("Labor rates require database connection","error");return}g(!0);try{await O.from("labor_rates").delete().eq("company_id",l.id);const D=[];ad.forEach(te=>{sd.forEach(se=>{td.forEach(Z=>{const Q=o[te]?.[se]?.[Z]||{regular:0,overtime:0};D.push({company_id:l.id,role:Z,work_type:te,job_type:se,regular_rate:parseFloat(Q.regular)||0,overtime_rate:parseFloat(Q.overtime)||0})})})});const{error:S}=await O.from("labor_rates").insert(D);if(S)throw S;i("Labor rates saved","success"),u(!1)}catch(D){console.error("Error saving labor rates:",D),i("Error saving rates: "+(D.message||"Unknown error"),"error")}finally{g(!1)}},U=(D,S,te,se,Z)=>{c(Q=>({...Q,[D]:{...Q[D],[S]:{...Q[D]?.[S],[te]:{...Q[D]?.[S]?.[te],[se]:Z}}}}))},z=D=>D.charAt(0).toUpperCase()+D.slice(1),K=D=>D.charAt(0).toUpperCase()+D.slice(1),E=D=>D==="pla"?"PLA (Prevailing Wage)":"Standard (Private)";return y?e.jsx("div",{className:"loading",children:"Loading labor rates..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"pricing-section-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Labor Rates"}),e.jsx("p",{className:"section-desc",children:"Configure hourly rates by role, work type, and job classification"})]}),m?e.jsxs("div",{className:"rate-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>{u(!1),B()},children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:H,disabled:x,children:x?"Saving...":"Save All Rates"})]}):e.jsx("button",{className:"btn btn-primary",onClick:()=>u(!0),children:"Edit Rates"})]}),e.jsx("div",{className:"work-type-tabs",children:ad.map(D=>e.jsx("button",{className:`work-type-tab ${f===D?"active":""}`,onClick:()=>v(D),children:K(D)},D))}),e.jsx("div",{className:"labor-rates-container",children:sd.map(D=>e.jsxs("div",{className:"job-type-section",children:[e.jsx("h3",{className:"job-type-header",children:E(D)}),e.jsxs("div",{className:"rates-table",children:[e.jsxs("div",{className:"rates-table-header",children:[e.jsx("div",{className:"rate-cell role-cell",children:"Role"}),e.jsx("div",{className:"rate-cell",children:"Regular"}),e.jsx("div",{className:"rate-cell",children:"Overtime"})]}),td.map(S=>{const te=o[f]?.[D]?.[S]||{regular:"",overtime:""};return e.jsxs("div",{className:"rates-table-row",children:[e.jsx("div",{className:"rate-cell role-cell",children:z(S)}),e.jsx("div",{className:"rate-cell",children:m?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"number",value:te.regular,onChange:se=>U(f,D,S,"regular",se.target.value),placeholder:"0.00",step:"0.01"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value",children:["$",(parseFloat(te.regular)||0).toFixed(2),"/hr"]})}),e.jsx("div",{className:"rate-cell",children:m?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"number",value:te.overtime,onChange:se=>U(f,D,S,"overtime",se.target.value),placeholder:"0.00",step:"0.01"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value ot",children:["$",(parseFloat(te.overtime)||0).toFixed(2),"/hr"]})})]},S)})]})]},D))})]})}const Ei=["Containment","PPE","Disposal","Equipment"];function Zv({company:l,onShowToast:i}){const[o,c]=p.useState([]),[m,u]=p.useState(!0),[x,g]=p.useState("all"),[f,v]=p.useState(null),[y,A]=p.useState(!1),[Y,B]=p.useState({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),[H,U]=p.useState([]),[z,K]=p.useState(!1);p.useEffect(()=>{l?.id&&E()},[l?.id]);const E=async()=>{u(!0);try{const P=await de.getAllMaterialsEquipment(l.id);c(P||[]),D(P||[])}catch(P){console.error("Error loading items:",P),i("Error loading materials","error")}finally{u(!1)}},D=P=>{const j={},_=[];P.filter(ee=>ee.active!==!1).forEach(ee=>{const w=ee.name.toLowerCase().trim();j[w]||(j[w]=[]),j[w].push(ee)}),Object.entries(j).forEach(([ee,w])=>{w.length>1&&_.push({name:ee,items:w})}),U(_)},S=async P=>{try{const j=P.items.filter(ee=>ee.cost_per_unit>0),_=j.length>0?j[0]:P.items[0],C=P.items.filter(ee=>ee.id!==_.id);for(const ee of C)await de.deleteMaterialEquipment(ee.id);i(`Merged ${P.items.length} items into one`,"success"),E()}catch(j){console.error("Error merging duplicates:",j),i("Error merging duplicates","error")}},te=async()=>{if(confirm(`Merge all ${H.length} duplicate groups?`))try{for(const P of H){const j=P.items.filter(ee=>ee.cost_per_unit>0),_=j.length>0?j[0]:P.items[0],C=P.items.filter(ee=>ee.id!==_.id);for(const ee of C)await de.deleteMaterialEquipment(ee.id)}i("All duplicates merged!","success"),E(),K(!1)}catch(P){console.error("Error merging all duplicates:",P),i("Error merging duplicates","error")}},se=async()=>{if(!Y.name.trim()){i("Enter item name","error");return}try{await de.createMaterialEquipment({company_id:l.id,name:Y.name.trim(),category:Y.category,unit:Y.unit||"each",cost_per_unit:parseFloat(Y.cost_per_unit)||0,active:!0}),i("Item added","success"),B({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),A(!1),E()}catch(P){console.error("Error adding item:",P),i("Error adding item","error")}},Z=async P=>{try{await de.updateMaterialEquipment(P.id,{name:P.name,category:P.category,unit:P.unit,cost_per_unit:parseFloat(P.cost_per_unit)||0}),i("Item updated","success"),v(null),E()}catch(j){console.error("Error updating item:",j),i("Error updating item","error")}},Q=async P=>{if(confirm("Delete this item?"))try{await de.deleteMaterialEquipment(P),i("Item deleted","success"),E()}catch(j){console.error("Error deleting item:",j),i("Error deleting item","error")}},F=x==="all"?o.filter(P=>P.active!==!1):o.filter(P=>P.category===x&&P.active!==!1),I=F.reduce((P,j)=>{const _=j.category||"Other";return P[_]||(P[_]=[]),P[_].push(j),P},{});return m?e.jsx("div",{className:"loading",children:"Loading materials..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"materials-header",children:[e.jsxs("div",{className:"materials-title",children:[e.jsx("h2",{children:"Materials & Equipment"}),e.jsxs("span",{className:"materials-count",children:[o.filter(P=>P.active!==!1).length," items"]})]}),e.jsxs("div",{className:"materials-actions",children:[H.length>0&&e.jsxs("button",{className:`btn btn-warning ${z?"active":""}`,onClick:()=>K(!z),children:[H.length," Duplicates"]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>A(!0),children:"+ Add Item"})]})]}),z&&H.length>0&&e.jsxs("div",{className:"duplicates-panel",children:[e.jsxs("div",{className:"duplicates-header",children:[e.jsx("h3",{children:"Duplicate Items Found"}),e.jsxs("button",{className:"btn btn-success btn-small",onClick:te,children:["Merge All (",H.length,")"]})]}),e.jsx("div",{className:"duplicates-list",children:H.map((P,j)=>e.jsxs("div",{className:"duplicate-group",children:[e.jsxs("div",{className:"duplicate-name",children:['"',P.name,'" x ',P.items.length]}),e.jsx("div",{className:"duplicate-items",children:P.items.map(_=>e.jsxs("span",{className:"duplicate-item",children:[_.category," - $",_.cost_per_unit||0]},_.id))}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>S(P),children:"Merge"})]},j))})]}),y&&e.jsxs("div",{className:"add-item-form",children:[e.jsx("h3",{children:"Add New Item"}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Item Name",value:Y.name,onChange:P=>B({...Y,name:P.target.value}),autoFocus:!0}),e.jsx("select",{value:Y.category,onChange:P=>B({...Y,category:P.target.value}),children:Ei.map(P=>e.jsx("option",{value:P,children:P},P))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Unit (e.g., each, day, hour)",value:Y.unit,onChange:P=>B({...Y,unit:P.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per unit",value:Y.cost_per_unit,onChange:P=>B({...Y,cost_per_unit:P.target.value}),step:"0.01"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>A(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:se,children:"Add Item"})]})]}),e.jsxs("div",{className:"materials-filter",children:[e.jsx("button",{className:`filter-tab ${x==="all"?"active":""}`,onClick:()=>g("all"),children:"All"}),Ei.map(P=>e.jsxs("button",{className:`filter-tab ${x===P?"active":""}`,onClick:()=>g(P),children:[P,e.jsx("span",{className:"filter-count",children:o.filter(j=>j.category===P&&j.active!==!1).length})]},P))]}),e.jsxs("div",{className:"materials-list",children:[x==="all"?Object.entries(I).map(([P,j])=>e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:P}),e.jsx("div",{className:"category-items",children:j.map(_=>e.jsx(kf,{item:_,editingItem:f,setEditingItem:v,handleUpdateItem:Z,handleDeleteItem:Q,categories:Ei},_.id))})]},P)):e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:x}),e.jsx("div",{className:"category-items",children:F.map(P=>e.jsx(kf,{item:P,editingItem:f,setEditingItem:v,handleUpdateItem:Z,handleDeleteItem:Q,categories:Ei},P.id))})]}),F.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No items in this category"})})]})]})}function kf({item:l,editingItem:i,setEditingItem:o,handleUpdateItem:c,handleDeleteItem:m,categories:u}){return i?.id===l.id?e.jsx("div",{className:"material-item",children:e.jsxs("div",{className:"item-edit-form",children:[e.jsx("input",{type:"text",value:i.name,onChange:x=>o({...i,name:x.target.value})}),e.jsx("select",{value:i.category,onChange:x=>o({...i,category:x.target.value}),children:u.map(x=>e.jsx("option",{value:x,children:x},x))}),e.jsx("input",{type:"text",value:i.unit,onChange:x=>o({...i,unit:x.target.value}),placeholder:"Unit"}),e.jsx("input",{type:"number",value:i.cost_per_unit,onChange:x=>o({...i,cost_per_unit:x.target.value}),placeholder:"Cost",step:"0.01"}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>c(i),children:"Save"}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>o(null),children:"Cancel"})]})]})}):e.jsxs("div",{className:"material-item",children:[e.jsxs("div",{className:"item-info",children:[e.jsx("span",{className:"item-name",children:l.name}),e.jsx("span",{className:"item-unit",children:l.unit||"each"})]}),e.jsxs("div",{className:"item-cost",children:["$",(l.cost_per_unit||0).toFixed(2)]}),e.jsxs("div",{className:"item-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>o({...l}),title:"Edit",children:e.jsx(Qf,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:()=>m(l.id),title:"Delete",children:e.jsx(gs,{size:16})})]})]})}const Pv=[{id:"trash",label:"Trash",description:"General debris"},{id:"metal",label:"Metal",description:"Scrap metal (recyclable)"},{id:"copper",label:"Copper",description:"Copper scrap (recyclable)"},{id:"concrete",label:"Concrete",description:"Concrete/masonry"},{id:"hazardous",label:"Hazardous",description:"Hazardous materials"}];function Jv({company:l,onShowToast:i}){const[o,c]=p.useState([]),[m,u]=p.useState(!0),[x,g]=p.useState(!1),[f,v]=p.useState(null),[y,A]=p.useState({name:"",address:"",notes:""}),[Y,B]=p.useState(!1),[H,U]=p.useState({}),z=p.useRef({});p.useEffect(()=>{l?.id&&K()},[l?.id]),p.useEffect(()=>()=>{Object.values(z.current).forEach(F=>clearTimeout(F))},[]);const K=async()=>{u(!0);try{const F=await de.getDumpSites(l.id);c(F||[])}catch(F){console.error("Error loading dump sites:",F),i("Error loading dump sites","error")}finally{u(!1)}},E=async()=>{if(!y.name.trim()){i("Please enter a site name","error");return}B(!0);try{await de.createDumpSite(l.id,y.name,y.address,y.notes),i("Dump site added","success"),A({name:"",address:"",notes:""}),g(!1),K()}catch(F){console.error("Error adding dump site:",F),i("Error adding dump site","error")}finally{B(!1)}},D=async()=>{if(!f?.name.trim()){i("Please enter a site name","error");return}B(!0);try{await de.updateDumpSite(f.id,{name:f.name,address:f.address,notes:f.notes}),i("Dump site updated","success"),v(null),K()}catch(F){console.error("Error updating dump site:",F),i("Error updating dump site","error")}finally{B(!1)}},S=async F=>{if(confirm("Are you sure you want to delete this dump site?"))try{await de.deleteDumpSite(F),i("Dump site deleted","success"),K()}catch(I){console.error("Error deleting dump site:",I),i("Error deleting dump site","error")}},te=p.useCallback(async(F,I,P)=>{try{await de.setDumpSiteRate(F,I,P),c(j=>j.map(_=>{if(_.id===F){const C=[..._.dump_site_rates||[]],ee=C.findIndex(w=>w.waste_type===I);return ee>=0?C[ee]={...C[ee],estimated_cost_per_load:P}:C.push({waste_type:I,estimated_cost_per_load:P}),{..._,dump_site_rates:C}}return _})),U(j=>{const _={...j};return delete _[`${F}-${I}`],_})}catch(j){console.error("Error saving rate:",j?.message||j),i("Error saving rate","error")}},[i]),se=(F,I,P)=>{const j=`${F}-${I}`;U(_=>({..._,[j]:P})),z.current[j]&&clearTimeout(z.current[j]),z.current[j]=setTimeout(()=>{const _=parseFloat(P)||0;te(F,I,_)},500)},Z=(F,I)=>{const P=`${F.id}-${I}`;return H[P]!==void 0?H[P]:F.dump_site_rates?.find(_=>_.waste_type===I)?.estimated_cost_per_load??""},Q=F=>{if(F===""||F===null||F===void 0)return"";const I=parseFloat(F);return I<0?`-$${Math.abs(I).toFixed(0)}`:`$${I.toFixed(0)}`};return m?e.jsx("div",{className:"loading",children:"Loading dump sites..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"dump-site-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Disposal & Haul-Off"}),e.jsx("p",{className:"section-desc",children:"Configure dump sites and estimated costs per load for each waste type. Use negative values for recyclables (metal, copper) to indicate revenue."})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>g(!0),children:"+ Add Dump Site"})]}),x&&e.jsxs("div",{className:"dump-site-form card",children:[e.jsx("h4",{children:"Add Dump Site"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:y.name,onChange:F=>A({...y,name:F.target.value}),placeholder:"e.g., Metro Landfill"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:y.address,onChange:F=>A({...y,address:F.target.value}),placeholder:"123 Main St, City"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:y.notes,onChange:F=>A({...y,notes:F.target.value}),placeholder:"Operating hours, contact, etc."})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>g(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:E,disabled:Y,children:Y?"Adding...":"Add Site"})]})]}),o.length===0?e.jsxs("div",{className:"dump-site-empty",children:[e.jsx("p",{children:"No dump sites configured yet."}),e.jsx("p",{children:"Add a dump site to start tracking haul-off costs."})]}):e.jsx("div",{className:"dump-sites-list",children:o.map(F=>e.jsxs("div",{className:"dump-site-card card",children:[f?.id===F.id?e.jsxs("div",{className:"dump-site-edit",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:f.name,onChange:I=>v({...f,name:I.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:f.address||"",onChange:I=>v({...f,address:I.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:f.notes||"",onChange:I=>v({...f,notes:I.target.value})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>v(null),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:D,disabled:Y,children:Y?"Saving...":"Save"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dump-site-info",children:[e.jsx("div",{className:"dump-site-name",children:F.name}),F.address&&e.jsx("div",{className:"dump-site-address",children:F.address}),F.notes&&e.jsx("div",{className:"dump-site-notes",children:F.notes})]}),e.jsxs("div",{className:"dump-site-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>v({...F}),title:"Edit",children:e.jsx(Qf,{size:16})}),e.jsx("button",{className:"btn-icon",onClick:()=>S(F.id),title:"Delete",children:e.jsx(gs,{size:16})})]})]}),e.jsxs("div",{className:"dump-site-rates",children:[e.jsx("div",{className:"rates-header",children:"Estimated Cost per Load"}),e.jsx("div",{className:"rates-grid",children:Pv.map(I=>e.jsxs("div",{className:"rate-item",children:[e.jsxs("label",{children:[e.jsx("span",{className:"rate-label",children:I.label}),e.jsx("span",{className:"rate-desc",children:I.description})]}),e.jsxs("div",{className:"rate-input-wrapper",children:[e.jsx("span",{className:"rate-prefix",children:"$"}),e.jsx("input",{type:"number",className:"rate-input",value:Z(F,I.id),onChange:P=>se(F.id,I.id,P.target.value),placeholder:"0"})]}),Z(F,I.id)!==""&&e.jsxs("span",{className:`rate-preview ${parseFloat(Z(F,I.id))<0?"revenue":"cost"}`,children:[Q(Z(F,I.id)),"/load"]})]},I.id))}),e.jsx("div",{className:"rates-note",children:"Tip: Use negative values for recyclables that generate revenue (e.g., -50 for metal)"})]})]},F.id))})]})}const Iv=[{id:"labor",label:"Labor Rates",Icon:na},{id:"materials",label:"Materials & Equipment",Icon:cr},{id:"disposal",label:"Disposal & Haul-Off",Icon:bn}];function Kv({company:l,onShowToast:i}){const[o,c]=p.useState("labor");return e.jsxs("div",{className:"pricing-manager",children:[e.jsxs("div",{className:"pricing-header",children:[e.jsx("h1",{children:"Pricing Configuration"}),e.jsx("p",{className:"pricing-subtitle",children:"Set up labor rates, materials pricing, and disposal costs"})]}),e.jsx("div",{className:"pricing-tabs",children:Iv.map(m=>e.jsxs("button",{className:`pricing-tab ${o===m.id?"active":""}`,onClick:()=>c(m.id),children:[e.jsx(m.Icon,{size:18,className:"pricing-tab-icon"}),e.jsx("span",{className:"pricing-tab-label",children:m.label})]},m.id))}),e.jsxs("div",{className:"pricing-content",children:[o==="labor"&&e.jsx(Xv,{company:l,onShowToast:i}),o==="materials"&&e.jsx(Zv,{company:l,onShowToast:i}),o==="disposal"&&e.jsx(Jv,{company:l,onShowToast:i})]})]})}function Wv({shareToken:l}){const[i,o]=p.useState(!0),[c,m]=p.useState(null),[u,x]=p.useState(null),[g,f]=p.useState(0),{branding:v}=il();p.useEffect(()=>{y()},[l]);const y=async()=>{o(!0),m(null);try{const S=await de.getPublicProjectData(l);if(!S){m("This share link is invalid or has expired.");return}x(S)}catch(S){console.error("Error loading public data:",S),m("Failed to load project data.")}finally{o(!1)}},A=S=>S?new Date(S).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",Y=S=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(S);if(i)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading project..."})]}),e.jsx("style",{children:nd})]});if(c)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx(Ti,{size:48})}),e.jsx("h2",{children:c}),e.jsx("p",{children:"Please contact the project owner for a valid link."})]}),e.jsx("style",{children:nd})]});const{share:B,project:H,progress:U,areas:z,photos:K,dailyReports:E,tmTickets:D}=u;return e.jsxs("div",{className:"public-view",children:[e.jsx("header",{className:"public-header",children:e.jsxs("div",{className:"container",children:[e.jsx(Ya,{size:"large"}),e.jsx("div",{className:"header-meta",children:e.jsxs("span",{className:"last-updated",children:["Last updated: ",A(H.updated_at||H.created_at)]})})]})}),e.jsx("main",{className:"public-main",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"project-header",children:[e.jsx("h1",{children:H.name}),H.address&&e.jsx("p",{className:"project-address",children:H.address})]}),B.permissions.progress&&e.jsxs("div",{className:"public-card progress-card",children:[e.jsx("h2",{children:"Project Progress"}),e.jsxs("div",{className:"progress-visual",children:[e.jsxs("div",{className:"progress-circle",children:[e.jsxs("svg",{viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"var(--primary-color, #3b82f6)",strokeWidth:"8",strokeDasharray:`${U*2.827} 282.7`,strokeLinecap:"round",transform:"rotate(-90 50 50)"})]}),e.jsxs("div",{className:"progress-percentage",children:[U,"%"]})]}),e.jsxs("div",{className:"progress-details",children:[e.jsx("div",{className:"progress-label",children:"Complete"}),z&&z.length>0&&e.jsxs("div",{className:"areas-summary",children:[z.filter(S=>S.status==="done").length," of ",z.length," areas completed"]})]})]}),z&&z.length>0&&e.jsxs("div",{className:"areas-list",children:[e.jsx("h3",{children:"Work Areas"}),z.map(S=>e.jsxs("div",{className:"area-item",children:[e.jsxs("div",{className:"area-info",children:[e.jsx("span",{className:"area-name",children:S.name}),e.jsxs("span",{className:"area-weight",children:[S.weight,"%"]})]}),e.jsx("div",{className:`area-status status-${S.status}`,children:S.status==="done"?" Complete":S.status==="working"?" In Progress":" Not Started"})]},S.id))]})]}),B.permissions.photos&&K&&K.length>0&&e.jsxs("div",{className:"public-card photos-card",children:[e.jsx("h2",{children:"Recent Photos"}),e.jsxs("div",{className:"photos-carousel",children:[e.jsxs("div",{className:"carousel-main",children:[K[g]&&e.jsx("img",{src:K[g].url,alt:`Project photo from ${A(K[g].date)}`,className:"carousel-image"}),e.jsx("div",{className:"carousel-date",children:A(K[g]?.date)})]}),e.jsx("div",{className:"carousel-thumbnails",children:K.slice(0,10).map((S,te)=>e.jsx("div",{className:`thumbnail ${te===g?"active":""}`,onClick:()=>f(te),children:e.jsx("img",{src:S.url,alt:`Thumbnail ${te+1}`})},te))}),K.length>1&&e.jsxs("div",{className:"carousel-controls",children:[e.jsx("button",{onClick:()=>f(S=>S>0?S-1:K.length-1),className:"carousel-btn",children:""}),e.jsxs("span",{className:"carousel-counter",children:[g+1," / ",K.length]}),e.jsx("button",{onClick:()=>f(S=>S<K.length-1?S+1:0),className:"carousel-btn",children:""})]})]})]}),B.permissions.daily_reports&&E&&E.length>0&&e.jsxs("div",{className:"public-card reports-card",children:[e.jsx("h2",{children:"Daily Reports"}),e.jsx("div",{className:"reports-list",children:E.map((S,te)=>e.jsxs("div",{className:"report-item",children:[e.jsx("div",{className:"report-date",children:A(S.report_date)}),e.jsxs("div",{className:"report-content",children:[S.crew_count&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Crew:"})," ",S.crew_count," workers"]}),S.tasks_completed&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Tasks Completed:"})," ",S.tasks_completed]}),S.weather&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Weather:"})," ",S.weather]}),S.notes&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Notes:"})," ",S.notes]})]})]},te))})]}),B.permissions.tm_tickets&&D&&D.length>0&&e.jsxs("div",{className:"public-card tm-card",children:[e.jsx("h2",{children:"Time & Materials Tickets"}),e.jsx("div",{className:"tm-list",children:D.map((S,te)=>e.jsxs("div",{className:"tm-item",children:[e.jsxs("div",{className:"tm-header",children:[e.jsx("span",{className:"tm-date",children:A(S.work_date)}),e.jsx("span",{className:`tm-status status-${S.status}`,children:S.status})]}),S.description&&e.jsx("div",{className:"tm-description",children:S.description}),S.total_amount&&e.jsxs("div",{className:"tm-amount",children:["Total: ",Y(S.total_amount)]})]},te))})]})]})}),e.jsx("footer",{className:"public-footer",children:e.jsx("div",{className:"container",children:!v?.hide_fieldsync_branding&&e.jsx("p",{children:"Powered by FieldSync"})})}),e.jsx("style",{children:nd})]})}const nd=`
  .public-view {
    min-height: 100vh;
    background-color: #f9fafb;
    display: flex;
    flex-direction: column;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 1rem;
    width: 100%;
  }

  /* Header */
  .public-header {
    background-color: white;
    border-bottom: 1px solid #e5e7eb;
    padding: 1.5rem 0;
  }

  .public-header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header-meta {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Main Content */
  .public-main {
    flex: 1;
    padding: 2rem 0;
  }

  .project-header {
    margin-bottom: 2rem;
  }

  .project-header h1 {
    font-size: 2rem;
    margin: 0 0 0.5rem 0;
    color: #111827;
  }

  .project-address {
    font-size: 1rem;
    color: #6b7280;
    margin: 0;
  }

  /* Cards */
  .public-card {
    background-color: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .public-card h2 {
    font-size: 1.5rem;
    margin: 0 0 1.5rem 0;
    color: #111827;
  }

  .public-card h3 {
    font-size: 1.125rem;
    margin: 1.5rem 0 1rem 0;
    color: #374151;
  }

  /* Progress Card */
  .progress-visual {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .progress-circle {
    position: relative;
    width: 150px;
    height: 150px;
    flex-shrink: 0;
  }

  .progress-circle svg {
    width: 100%;
    height: 100%;
  }

  .progress-percentage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary-color, #3b82f6);
  }

  .progress-details {
    flex: 1;
  }

  .progress-label {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.5rem;
  }

  .areas-summary {
    font-size: 1rem;
    color: #6b7280;
  }

  /* Areas List */
  .areas-list {
    border-top: 1px solid #e5e7eb;
    padding-top: 1rem;
  }

  .area-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f3f4f6;
  }

  .area-item:last-child {
    border-bottom: none;
  }

  .area-info {
    flex: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-right: 1rem;
  }

  .area-name {
    font-weight: 500;
    color: #374151;
  }

  .area-weight {
    color: #6b7280;
    font-size: 0.875rem;
  }

  .area-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
  }

  .area-status.status-done {
    background-color: #d1fae5;
    color: #065f46;
  }

  .area-status.status-working {
    background-color: #fef3c7;
    color: #92400e;
  }

  .area-status.status-not_started {
    background-color: #f3f4f6;
    color: #6b7280;
  }

  /* Photos Carousel */
  .photos-carousel {
    position: relative;
  }

  .carousel-main {
    position: relative;
    width: 100%;
    height: 400px;
    background-color: #111827;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .carousel-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .carousel-date {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
    color: white;
    padding: 1rem;
    text-align: center;
  }

  .carousel-thumbnails {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
  }

  .thumbnail {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s;
  }

  .thumbnail:hover {
    border-color: #d1d5db;
  }

  .thumbnail.active {
    border-color: var(--primary-color, #3b82f6);
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .carousel-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
  }

  .carousel-btn {
    background-color: white;
    border: 1px solid #d1d5db;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.25rem;
    transition: background-color 0.2s;
  }

  .carousel-btn:hover {
    background-color: #f3f4f6;
  }

  .carousel-counter {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Daily Reports */
  .reports-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .report-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .report-date {
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.75rem;
    font-size: 1.125rem;
  }

  .report-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .report-field {
    color: #374151;
    line-height: 1.5;
  }

  .report-field strong {
    color: #111827;
  }

  /* T&M Tickets */
  .tm-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .tm-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .tm-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .tm-date {
    font-weight: 600;
    color: #111827;
  }

  .tm-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: capitalize;
  }

  .tm-status.status-approved {
    background-color: #d1fae5;
    color: #065f46;
  }

  .tm-status.status-pending {
    background-color: #fef3c7;
    color: #92400e;
  }

  .tm-status.status-rejected {
    background-color: #fee2e2;
    color: #991b1b;
  }

  .tm-description {
    color: #374151;
    margin-bottom: 0.5rem;
  }

  .tm-amount {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--primary-color, #3b82f6);
  }

  /* Footer */
  .public-footer {
    background-color: white;
    border-top: 1px solid #e5e7eb;
    padding: 2rem 0;
    margin-top: auto;
  }

  .public-footer p {
    text-align: center;
    color: #6b7280;
    margin: 0;
    font-size: 0.875rem;
  }

  /* Loading & Error States */
  .loading-container,
  .error-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 2rem;
  }

  .spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #e5e7eb;
    border-top-color: var(--primary-color, #3b82f6);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .loading-container p {
    margin-top: 1rem;
    color: #6b7280;
  }

  .error-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .error-container h2 {
    color: #111827;
    margin: 0 0 0.5rem 0;
  }

  .error-container p {
    color: #6b7280;
    margin: 0;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .project-header h1 {
      font-size: 1.5rem;
    }

    .public-card {
      padding: 1.5rem;
    }

    .progress-visual {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .progress-circle {
      width: 120px;
      height: 120px;
    }

    .progress-percentage {
      font-size: 1.5rem;
    }

    .carousel-main {
      height: 300px;
    }

    .area-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .area-info {
      width: 100%;
      margin-right: 0;
    }
  }
`;function Ef({onSave:l,onClose:i,slot:o=1,documentType:c="cor",documentTitle:m="",signerName:u="",signerTitle:x="",signerCompany:g=""}){const f=p.useRef(null),[v,y]=p.useState(u),[A,Y]=p.useState(x),[B,H]=p.useState(g),[U,z]=p.useState(!1),[K,E]=p.useState(!1),[D,S]=p.useState(!1),te=o===1?"GC Authorization":"Client Authorization",se=c==="cor"?"Change Order Request":"T&M Work Order",Z=()=>{const w=f.current;return w?w.getContext("2d"):null},Q=w=>{const k=f.current;if(!k)return{x:0,y:0};const M=k.getBoundingClientRect(),he=k.width/M.width,V=k.height/M.height,q=w.touches?w.touches[0].clientX:w.clientX,L=w.touches?w.touches[0].clientY:w.clientY;return{x:(q-M.left)*he,y:(L-M.top)*V}},F=w=>{w.preventDefault();const k=Z();if(!k)return;const{x:M,y:he}=Q(w);k.beginPath(),k.moveTo(M,he),E(!0),z(!0)},I=w=>{if(!K)return;w.preventDefault();const k=Z();if(!k)return;const{x:M,y:he}=Q(w);k.lineTo(M,he),k.stroke()},P=()=>{E(!1)},j=()=>{const w=f.current,k=Z();!w||!k||(k.clearRect(0,0,w.width,w.height),z(!1))},_=w=>{if(!w)return;f.current=w;const k=w.getContext("2d");k.strokeStyle="#1e293b",k.lineWidth=2,k.lineCap="round",k.lineJoin="round"},C=U&&v.trim()&&D,ee=()=>{if(!C)return;const w=f.current;if(!w)return;const k=w.toDataURL("image/png");l({signature:k,signerName:v.trim(),signerTitle:A.trim()||null,signerCompany:B.trim()||null,signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:i,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal enhanced",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"signature-header-info",children:[e.jsx("h2",{id:"signature-title",children:te}),m&&e.jsx("span",{className:"signature-doc-ref",children:m})]}),e.jsx("button",{className:"close-btn",onClick:i,"aria-label":"Close signature modal",children:e.jsx(_n,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"signature-slot-badge",children:[e.jsx(Pf,{size:14}),e.jsxs("span",{children:["Signature ",o," of 2"]})]}),e.jsxs("div",{className:"signature-fields",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Print Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:v,onChange:w=>y(w.target.value),placeholder:"Enter your full legal name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-fields-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-title",children:"Title"}),e.jsx("input",{id:"signer-title",type:"text",value:A,onChange:w=>Y(w.target.value),placeholder:"e.g., Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-company",children:"Company"}),e.jsx("input",{id:"signer-company",type:"text",value:B,onChange:w=>H(w.target.value),placeholder:"e.g., ABC Construction"})]})]})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(Yf,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Draw your signature below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:_,width:500,height:180,className:"signature-canvas",onMouseDown:F,onMouseMove:I,onMouseUp:P,onMouseLeave:P,onTouchStart:F,onTouchMove:I,onTouchEnd:P,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!U&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:j,disabled:!U,"aria-label":"Clear signature",children:[e.jsx(Xf,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("div",{className:"signature-acknowledgment",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:w=>S(w.target.checked)}),e.jsxs("span",{children:["I acknowledge that this electronic signature is legally binding and that I have reviewed and approve this ",se,". I understand that my signature, name, and IP address will be recorded for verification purposes."]})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:i,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:ee,disabled:!C,"aria-label":"Submit signature",children:[e.jsx(nr,{size:16,"aria-hidden":"true"})," Submit Signature"]})]})]})})}const tr=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",ey=({status:l})=>{const i={draft:{label:"Draft",color:"#6b7280",bg:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bg:"#fef3c7"},approved:{label:"Approved",color:"#059669",bg:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bg:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bg:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bg:"#e5e7eb"}},o=i[l]||i.draft;return e.jsx("span",{className:"cor-status-badge",style:{color:o.color,backgroundColor:o.bg},children:o.label})};function ty({signatureToken:l}){const[i,o]=p.useState(!0),[c,m]=p.useState(null),[u,x]=p.useState(null),[g,f]=p.useState(null),[v,y]=p.useState(!1),[A,Y]=p.useState(null),[B,H]=p.useState(!1),[U,z]=p.useState(null),[K,E]=p.useState(!1);p.useEffect(()=>{D()},[l]);const D=async()=>{try{o(!0),m(null);const k=await de.getSignatureRequestByToken(l);if(!k){m("This signature link is invalid or has expired.");return}if(k.status==="completed"){m("This document has already been fully signed.");return}if(k.status==="revoked"){m("This signature link has been revoked.");return}if(k.status==="expired"){m("This signature link has expired.");return}x(k);const M=await de.getDocumentForSigning(k.document_type,k.document_id);if(!M){m("The document associated with this link could not be found.");return}f(M)}catch(k){console.error("Error loading signature data:",k),m("Unable to load signature request. Please try again.")}finally{o(!1)}},S=p.useMemo(()=>!g||u?.document_type!=="cor"?null:or(g),[g,u]),te=()=>{if(!u)return{slot1:null,slot2:null,availableSlots:[]};const k=u.signatures||[],M=k.find(q=>q.signature_slot===1),he=k.find(q=>q.signature_slot===2),V=[];return M||V.push(1),he||V.push(2),{slot1:M,slot2:he,availableSlots:V}},se=async()=>{try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return null}},Z=async k=>{if(!(!u||!A))try{H(!0);const M=await se(),he=await de.addSignature(u.id,A,{...k,ipAddress:M,userAgent:navigator.userAgent});await de.syncSignatureToDocument(he,u),await D(),y(!1),Y(null),z(`Signature ${A} has been recorded successfully.`),setTimeout(()=>z(null),5e3)}catch(M){console.error("Error submitting signature:",M),m("Failed to submit signature. Please try again.")}finally{H(!1)}},Q=k=>{Y(k),y(!0)},F=async()=>{if(!(!g||!u))try{E(!0);let k=null;if(C)try{k=await de.getCORTickets(g.id)}catch(he){console.warn("Failed to fetch T&M tickets for backup:",he)}const M={logoUrl:ee?.logo_url,primaryColor:ee?.branding_color};await ap(g,w,ee,M,k),z("PDF downloaded successfully!"),setTimeout(()=>z(null),3e3)}catch(k){console.error("Download failed:",k),m("Failed to generate PDF. Please try again.")}finally{E(!1)}};if(i)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading document..."})]})});if(c)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-error",children:[e.jsx(cl,{size:48}),e.jsx("h2",{children:"Unable to Load Document"}),e.jsx("p",{children:c})]})});const{slot1:I,slot2:P,availableSlots:j}=te(),_=j.length===0,C=u?.document_type==="cor",ee=g?.projects?.companies,w=g?.projects;if(!C){const k=g.t_and_m_workers?.length||0,M=g.t_and_m_workers?.reduce((he,V)=>he+(V.hours||0),0)||0;return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[ee?.logo_url?e.jsx("img",{src:ee.logo_url,alt:ee.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Di,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:ee?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"T&M Ticket Signature"})]})]}),U&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(Qa,{size:18}),U]}),e.jsxs("main",{className:"signature-page-content",children:[e.jsxs("div",{className:"signature-document-card",children:[e.jsxs("div",{className:"document-card-header",children:[e.jsx(za,{size:20}),e.jsxs("div",{className:"document-card-title",children:[e.jsx("h2",{children:"T&M Ticket"}),e.jsx("span",{className:"document-subtitle",children:g.ce_pco_number?`CE/PCO: ${g.ce_pco_number}`:"Time & Materials"})]})]}),e.jsxs("div",{className:"document-card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Project"}),e.jsx("span",{className:"detail-value",children:w?.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Work Date"}),e.jsx("span",{className:"detail-value",children:tr(g.work_date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Workers"}),e.jsxs("span",{className:"detail-value",children:[k," (",M," hrs)"]})]}),g.notes&&e.jsxs("div",{className:"detail-row full-width",children:[e.jsx("span",{className:"detail-label",children:"Description"}),e.jsx("span",{className:"detail-value",children:g.notes})]})]})]}),e.jsxs("div",{className:"signature-status-section",children:[e.jsx("h3",{children:"Signatures Required"}),Df(1,I,"GC Authorization",Q,B),Df(2,P,"Client Authorization",Q,B),_&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Qa,{size:24}),e.jsx("p",{children:"This document has been fully signed by all parties."})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),v&&A&&e.jsx(Ef,{slot:A,documentType:"tm_ticket",documentTitle:"T&M Ticket",onSave:Z,onClose:()=>{y(!1),Y(null)}})]})}return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[ee?.logo_url?e.jsx("img",{src:ee.logo_url,alt:ee.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Di,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:ee?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"Change Order Request"})]})]}),U&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(Qa,{size:18}),U]}),e.jsxs("main",{className:"signature-page-content cor-full-document",children:[e.jsxs("div",{className:"cor-header-card",children:[e.jsxs("div",{className:"cor-header-top",children:[e.jsxs("div",{className:"cor-title-section",children:[e.jsx("h2",{className:"cor-number",children:g.cor_number}),e.jsx(ey,{status:g.status})]}),e.jsxs("div",{className:"cor-date",children:["Created ",tr(g.created_at)]})]}),e.jsx("h3",{className:"cor-title",children:g.title||"Untitled Change Order"}),e.jsxs("div",{className:"cor-info-grid",children:[e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Project"}),e.jsx("span",{className:"cor-info-value",children:w?.name})]}),w?.job_number&&e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Job #"}),e.jsx("span",{className:"cor-info-value",children:w.job_number})]}),e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Period"}),e.jsx("span",{className:"cor-info-value",children:Ai(g.period_start,g.period_end)})]})]}),g.scope_of_work&&e.jsxs("div",{className:"cor-scope",children:[e.jsx("h4",{children:"Scope of Work"}),e.jsx("p",{children:g.scope_of_work})]})]}),g.change_order_labor?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(ir,{size:18}),e.jsx("h4",{children:"Labor"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{className:"text-right",children:"Reg Hrs"}),e.jsx("th",{className:"text-right",children:"Reg Rate"}),e.jsx("th",{className:"text-right",children:"OT Hrs"}),e.jsx("th",{className:"text-right",children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_labor.map((k,M)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.labor_class}),e.jsx("td",{children:k.wage_type}),e.jsx("td",{className:"text-right",children:k.regular_hours}),e.jsxs("td",{className:"text-right",children:["$",sa(k.regular_rate),"/hr"]}),e.jsx("td",{className:"text-right",children:k.overtime_hours||"-"}),e.jsx("td",{className:"text-right",children:k.overtime_hours?`$${sa(k.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:we(k.total)})]},M))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(S.labor_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"5",className:"text-right",children:["+ ",wt(g.labor_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(S.labor_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"5",className:"text-right",children:e.jsx("strong",{children:"Labor Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:we(S.labor_subtotal+S.labor_markup_amount)})})]})]})]})})]}),g.change_order_materials?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Za,{size:18}),e.jsx("h4",{children:"Materials"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_materials.map((k,M)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.description}),e.jsx("td",{children:k.source_reference||k.source_type}),e.jsx("td",{className:"text-right",children:k.quantity}),e.jsx("td",{children:k.unit}),e.jsxs("td",{className:"text-right",children:["$",sa(k.unit_cost)]}),e.jsx("td",{className:"text-right",children:we(k.total)})]},M))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(S.materials_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",wt(g.materials_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(S.materials_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Materials Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:we(S.materials_subtotal+S.materials_markup_amount)})})]})]})]})})]}),g.change_order_equipment?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(bn,{size:18}),e.jsx("h4",{children:"Equipment"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_equipment.map((k,M)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.description}),e.jsx("td",{children:k.source_reference||k.source_type}),e.jsx("td",{className:"text-right",children:k.quantity}),e.jsx("td",{children:k.unit}),e.jsxs("td",{className:"text-right",children:["$",sa(k.unit_cost)]}),e.jsx("td",{className:"text-right",children:we(k.total)})]},M))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(S.equipment_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",wt(g.equipment_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(S.equipment_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Equipment Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:we(S.equipment_subtotal+S.equipment_markup_amount)})})]})]})]})})]}),g.change_order_subcontractors?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(rl,{size:18}),e.jsx("h4",{children:"Subcontractors"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:g.change_order_subcontractors.map((k,M)=>e.jsxs("tr",{children:[e.jsx("td",{children:k.company_name}),e.jsx("td",{children:k.description}),e.jsx("td",{children:k.source_reference||k.source_type}),e.jsx("td",{className:"text-right",children:we(k.total)})]},M))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(S.subcontractors_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"2",className:"text-right",children:["+ ",wt(g.subcontractors_markup_percent||500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:we(S.subcontractors_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"2",className:"text-right",children:e.jsx("strong",{children:"Subcontractors Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:we(S.subcontractors_subtotal+S.subcontractors_markup_amount)})})]})]})]})})]}),e.jsxs("div",{className:"cor-totals-card",children:[e.jsx("h4",{children:"COR Summary"}),e.jsxs("div",{className:"cor-totals-grid",children:[e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:we(S.cor_subtotal)})]}),e.jsxs("div",{className:"cor-fees-section",children:[e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Liability Insurance (",wt(g.liability_insurance_percent||144),")"]}),e.jsx("span",{children:we(S.liability_insurance_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Bond (",wt(g.bond_percent||100),")"]}),e.jsx("span",{children:we(S.bond_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["City License Fee (",wt(g.license_fee_percent||10),")"]}),e.jsx("span",{children:we(S.license_fee_amount)})]})]}),e.jsxs("div",{className:"cor-grand-total",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:we(S.cor_total)})]})]})]}),e.jsxs("div",{className:"cor-signature-section",children:[e.jsx("h4",{children:"Authorization"}),e.jsx("p",{className:"signature-instruction",children:"By signing below, you authorize the above change order request and agree to the terms and costs outlined."}),e.jsxs("div",{className:"signature-slots-grid",children:[e.jsxs("div",{className:`signature-slot-card ${I?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[I?e.jsx(Qa,{size:20,className:"status-icon signed"}):e.jsx(lr,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Signature 1  GC Authorization"})]}),I?e.jsxs("div",{className:"slot-signed-info",children:[I.signature_data&&e.jsx("img",{src:I.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:I.signer_name}),(I.signer_title||I.signer_company)&&e.jsxs("span",{className:"signer-org",children:[I.signer_title,I.signer_title&&I.signer_company&&"  ",I.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",tr(I.signed_at)]})]}):e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>Q(1),disabled:B,children:"Sign as GC"})]}),e.jsxs("div",{className:`signature-slot-card ${P?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[P?e.jsx(Qa,{size:20,className:"status-icon signed"}):e.jsx(lr,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Signature 2  Client Authorization"})]}),P?e.jsxs("div",{className:"slot-signed-info",children:[P.signature_data&&e.jsx("img",{src:P.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:P.signer_name}),(P.signer_title||P.signer_company)&&e.jsxs("span",{className:"signer-org",children:[P.signer_title,P.signer_title&&P.signer_company&&"  ",P.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",tr(P.signed_at)]})]}):e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>Q(2),disabled:B,children:"Sign as Client"})]})]}),_&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Qa,{size:24}),e.jsx("p",{children:"This change order request has been fully signed by all parties."})]}),_&&e.jsxs("div",{className:"cor-download-section",children:[e.jsx("h4",{children:"Download Your Copy"}),e.jsx("p",{className:"download-description",children:"Download a PDF copy of this signed COR including all T&M backup documentation."}),e.jsx("button",{className:"btn btn-primary download-btn",onClick:F,disabled:K,children:K?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"download-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Vf,{size:18}),"Download COR + Backup"]})})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),v&&A&&e.jsx(Ef,{slot:A,documentType:u.document_type,documentTitle:`${g.cor_number} - ${g.title}`,onSave:Z,onClose:()=>{y(!1),Y(null)}})]})}function Df(l,i,o,c,m){return e.jsxs("div",{className:`signature-slot-card ${i?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[i?e.jsx(Qa,{size:20,className:"status-icon signed"}):e.jsx(lr,{size:20,className:"status-icon pending"}),e.jsxs("span",{className:"slot-label",children:["Signature ",l,"  ",o]})]}),i?e.jsxs("div",{className:"slot-signed-info",children:[e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:i.signer_name}),(i.signer_title||i.signer_company)&&e.jsxs("span",{className:"signer-org",children:[i.signer_title,i.signer_title&&i.signer_company&&"  ",i.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",tr(i.signed_at)]})]}):e.jsxs("button",{className:"btn btn-primary sign-btn",onClick:()=>c(l),disabled:m,children:["Sign as ",l===1?"GC":"Client"]})]})}function ay({company:l,projects:i,userId:o,onNotificationClick:c,onShowToast:m}){const[u,x]=p.useState([]),[g,f]=p.useState(0),[v,y]=p.useState(!1),[A,Y]=p.useState(!1),[B,H]=p.useState({}),U=p.useRef(null);p.useRef(null);const z=p.useRef(null);p.useEffect(()=>{o&&K()},[o]);const K=async()=>{try{const j=await de.getUserNotificationPreferences(o),_={};j.forEach(C=>{_[C.project_id]=C.notification_types||[]}),H(_)}catch(j){console.error("Error loading user preferences:",j)}},E=(j,_)=>B[j]?B[j].length===0?!1:B[j].includes(_):!0;p.useEffect(()=>{if(!l?.id||!i||i.length===0)return;D();const j=S();return()=>{j&&de.unsubscribe(j)}},[l?.id,i,B]),p.useEffect(()=>()=>{z.current&&(z.current.close().catch(()=>{}),z.current=null)},[]),p.useEffect(()=>{function j(_){U.current&&!U.current.contains(_.target)&&y(!1)}return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]);const D=async()=>{if(!i||i.length===0)return;const j=[];for(const _ of i)try{E(_.id,"message")&&(await de.getMessages(_.id,20)).filter(w=>w.sender_type==="field"&&!w.is_read).forEach(w=>{j.push({id:`msg-${w.id}`,type:"message",title:"New Message",message:w.message?.slice(0,50)+(w.message?.length>50?"...":""),projectId:_.id,projectName:_.name,senderName:w.sender_name,createdAt:w.created_at,isRead:w.is_read,data:w})}),E(_.id,"material_request")&&(await de.getMaterialRequests(_.id,"pending")).forEach(ee=>{j.push({id:`req-${ee.id}`,type:"material_request",title:"Material Request",message:`${ee.items?.length||0} items requested`,projectId:_.id,projectName:_.name,senderName:ee.requested_by,priority:ee.priority,createdAt:ee.created_at,isRead:!1,data:ee})})}catch(C){console.error("Error loading notifications for project:",_.id,C)}try{(await de.getCompanyInjuryReports(l.id,"open")).slice(0,5).forEach(C=>{if(E(C.project_id,"injury_report")){const ee=i.find(w=>w.id===C.project_id);j.push({id:`injury-${C.id}`,type:"injury_report",title:"Safety Report",message:`${C.injury_type} - ${C.injured_person_name}`,projectId:C.project_id,projectName:ee?.name||"Unknown Project",senderName:C.reported_by_name,createdAt:C.created_at,isRead:C.status!=="open",data:C})}})}catch(_){console.error("Error loading injury reports:",_)}j.sort((_,C)=>new Date(C.createdAt)-new Date(_.createdAt)),x(j.slice(0,50)),f(j.filter(_=>!_.isRead).length)},S=()=>{if(!l?.id||!i||i.length===0)return null;const j=i.map(C=>C.id),_=de.subscribeToCompanyActivity(l.id,j,{onMessage:C=>{if(C.new?.sender_type==="field"){if(!E(C.new.project_id,"message"))return;te({id:`msg-${C.new.id}`,type:"message",title:"New Message",message:C.new.message?.slice(0,50)+(C.new.message?.length>50?"...":""),projectId:C.new.project_id,projectName:i.find(ee=>ee.id===C.new.project_id)?.name||"Project",senderName:C.new.sender_name,createdAt:C.new.created_at,isRead:!1,data:C.new})}},onMaterialRequest:C=>{E(C.new.project_id,"material_request")&&te({id:`req-${C.new.id}`,type:"material_request",title:"Material Request",message:`${C.new.items?.length||0} items requested`,projectId:C.new.project_id,projectName:i.find(ee=>ee.id===C.new.project_id)?.name||"Project",senderName:C.new.requested_by,priority:C.new.priority,createdAt:C.new.created_at,isRead:!1,data:C.new})},onTMTicket:C=>{if(C.eventType==="INSERT"){if(!E(C.new.project_id,"tm_ticket"))return;te({id:`tm-${C.new.id}`,type:"tm_ticket",title:"New T&M Ticket",message:`Submitted by ${C.new.created_by_name||"Field"}`,projectId:C.new.project_id,projectName:i.find(ee=>ee.id===C.new.project_id)?.name||"Project",senderName:C.new.created_by_name,createdAt:C.new.created_at,isRead:!1,data:C.new})}},onInjuryReport:C=>{E(C.new.project_id,"injury_report")&&te({id:`injury-${C.new.id}`,type:"injury_report",title:"Safety Report",message:`${C.new.injury_type} - ${C.new.injured_person_name}`,projectId:C.new.project_id,projectName:i.find(ee=>ee.id===C.new.project_id)?.name||"Project",senderName:C.new.reported_by_name,createdAt:C.new.created_at,isRead:!1,data:C.new})}});return _&&Y(!0),_},te=j=>{x(C=>[j,...C.slice(0,49)]),f(C=>C+1),se();const _=Z(j.type);m?.(`${_} ${j.title}: ${j.message}`,"info")},se=()=>{try{(!z.current||z.current.state==="closed")&&(z.current=new(window.AudioContext||window.webkitAudioContext));const j=z.current;j.state==="suspended"&&j.resume();const _=j.createOscillator(),C=j.createGain();_.connect(C),C.connect(j.destination),_.frequency.value=800,_.type="sine",C.gain.value=.3,_.start(),_.stop(j.currentTime+.15),setTimeout(()=>{if(!z.current||z.current.state==="closed")return;const ee=z.current.createOscillator(),w=z.current.createGain();ee.connect(w),w.connect(z.current.destination),ee.frequency.value=1e3,ee.type="sine",w.gain.value=.3,ee.start(),ee.stop(z.current.currentTime+.15)},150)}catch{}},Z=j=>{switch(j){case"message":return e.jsx(fs,{size:16});case"material_request":return e.jsx(Za,{size:16});case"injury_report":return e.jsx(cl,{size:16});case"tm_ticket":return e.jsx(Ra,{size:16});default:return e.jsx(Gx,{size:16})}},Q=j=>{switch(j){case"message":return"blue";case"material_request":return"orange";case"injury_report":return"red";case"tm_ticket":return"green";default:return"gray"}},F=j=>{x(_=>_.map(C=>C.id===j.id?{...C,isRead:!0}:C)),f(_=>Math.max(0,_-1)),y(!1),c?.(j)},I=async()=>{for(const j of i)try{await de.markMessagesRead(j.id,"office")}catch{}x(j=>j.map(_=>({..._,isRead:!0}))),f(0)},P=j=>{const _=new Date(j),ee=new Date-_,w=Math.floor(ee/6e4),k=Math.floor(ee/36e5),M=Math.floor(ee/864e5);return w<1?"Just now":w<60?`${w}m ago`:k<24?`${k}h ago`:M<7?`${M}d ago`:_.toLocaleDateString()};return e.jsxs("div",{className:"notification-center",ref:U,children:[e.jsxs("button",{className:`notification-bell ${g>0?"has-notifications":""}`,onClick:()=>y(!v),title:`${g} unread notifications`,children:[e.jsx("span",{className:"bell-icon",children:""}),g>0&&e.jsx("span",{className:"notification-badge",children:g>99?"99+":g}),A&&e.jsx("span",{className:"connection-dot"})]}),v&&e.jsxs("div",{className:"notification-dropdown",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h4",{children:"Notifications"}),g>0&&e.jsx("button",{className:"mark-all-read",onClick:I,children:"Mark all read"})]}),e.jsx("div",{className:"notification-list",children:u.length===0?e.jsxs("div",{className:"notification-empty",children:[e.jsx("span",{className:"empty-icon",children:""}),e.jsx("p",{children:"No notifications yet"}),e.jsx("small",{children:"You'll see updates from the field here"})]}):u.map(j=>e.jsxs("div",{className:`notification-item ${j.isRead?"read":"unread"} ${Q(j.type)}`,onClick:()=>F(j),children:[e.jsx("div",{className:"notification-icon",children:Z(j.type)}),e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"notification-title",children:[j.title,j.priority==="urgent"&&e.jsx("span",{className:"priority-badge urgent",children:"URGENT"})]}),e.jsx("div",{className:"notification-message",children:j.message}),e.jsxs("div",{className:"notification-meta",children:[e.jsx("span",{className:"notification-project",children:j.projectName}),e.jsx("span",{className:"notification-time",children:P(j.createdAt)})]})]}),!j.isRead&&e.jsx("div",{className:"unread-dot"})]},j.id))}),u.length>0&&e.jsx("div",{className:"notification-footer",children:e.jsx("button",{className:"view-all-btn",onClick:()=>{y(!1),c?.({type:"view_all"})},children:"View All Activity"})})]})]})}class er extends p.Component{constructor(i){super(i),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(i){return{hasError:!0}}componentDidCatch(i,o){this.setState({error:i,errorInfo:o}),console.error("ErrorBoundary caught an error:",i,o)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("div",{className:"error-icon",children:e.jsx(Ti,{size:48})}),e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),e.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function Mf(){const[l,i]=p.useState(ar()),[o,c]=p.useState(0),[m,u]=p.useState(!1),[x,g]=p.useState(!1);return p.useEffect(()=>{const f=Uf(async y=>{i(y),y&&x&&(u(!0),setTimeout(()=>u(!1),3e3)),y||g(!0);const A=await Yo();c(A)});Yo().then(c);const v=setInterval(async()=>{if(!ar()){const y=await Yo();c(y)}},5e3);return()=>{f(),clearInterval(v)}},[x]),l&&o===0&&!m?null:e.jsxs("div",{className:`offline-indicator ${l?"online":"offline"} ${m?"synced":""}`,children:[e.jsx("div",{className:"offline-indicator-content",children:l?m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"online-icon",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):o>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"syncing-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),e.jsxs("span",{className:"offline-text",children:["Syncing ",o,"..."]})]}):null:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"offline-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),e.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),e.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),e.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),e.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),e.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),e.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),e.jsxs("span",{className:"offline-text",children:["Offline",o>0&&e.jsxs("span",{className:"pending-badge",children:[o," pending"]})]})]})}),e.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function sy(){const[l,i]=p.useState("entry"),[o,c]=p.useState(null),[m,u]=p.useState(null),[x,g]=p.useState([]),[f,v]=p.useState([]),[y,A]=p.useState(null),[Y,B]=p.useState(null),[H,U]=p.useState(null),[z,K]=p.useState(!0),[E,D]=p.useState("dashboard"),[S,te]=p.useState(null),[se,Z]=p.useState(!1),[Q,F]=p.useState(null);p.useEffect(()=>{const q=window.location.pathname,L=q.match(/^\/view\/([a-zA-Z0-9_-]+)$/),$=q.match(/^\/sign\/([a-zA-Z0-9_-]+)$/);L?(B(L[1]),i("public"),K(!1)):$?(U($[1]),i("signature"),K(!1)):I()},[]);const I=async()=>{try{const{data:{user:q}}=await O.auth.getUser();if(!q){K(!1);return}const{data:L,error:$}=await O.from("users").select("*").eq("id",q.id).single();if(L){c(L);const xe=await de.getUserCompanies(q.id);g(xe);const be=localStorage.getItem("selectedCompanyId");let Fe=null;if(be&&xe.find(ye=>ye.id===be))Fe=xe.find(ye=>ye.id===be);else if(xe.length>0)Fe=xe[0];else if(L.company_id){const{data:ye}=await O.from("companies").select("*").eq("id",L.company_id).single();Fe=ye}if(Fe){const{data:ye}=await O.from("companies").select("*").eq("id",Fe.id).single();u(ye),i("office")}}}catch(q){console.error("Auth check error:",q)}finally{K(!1)}},P=q=>{A(q),i("foreman")},j=async(q,L)=>{try{const{data:$,error:xe}=await O.auth.signInWithPassword({email:q,password:L});if(xe){w(xe.message||"Invalid credentials","error");return}const{data:be,error:Fe}=await O.from("users").select("*").eq("id",$.user.id).single();if(Fe){console.error("User fetch error:",Fe),w("Error loading profile","error");return}if(be){c(be);const ye=await de.getUserCompanies($.user.id);g(ye);const We=localStorage.getItem("selectedCompanyId");let Ve=null;if(We&&ye.find(De=>De.id===We))Ve=ye.find(De=>De.id===We);else if(ye.length>0)Ve=ye[0];else if(be.company_id){const{data:De}=await O.from("companies").select("*").eq("id",be.company_id).single();Ve=De}if(Ve){const{data:De}=await O.from("companies").select("*").eq("id",Ve.id).single();u(De),i("office")}else w("No company access. Please contact admin.","error")}else w("Profile not found. Please contact admin.","error")}catch($){console.error("Login error:",$),w("Login failed","error")}},_=async q=>{try{const{data:L}=await O.from("companies").select("*").eq("id",q).single();L&&(u(L),localStorage.setItem("selectedCompanyId",q),Z(!1),D("dashboard"),w(`Switched to ${L.name}`,"success"))}catch(L){console.error("Switch company error:",L),w("Error switching company","error")}},C=async()=>{try{await Ux.signOut(),c(null),u(null),g([]),i("entry"),D("dashboard"),localStorage.removeItem("selectedCompanyId")}catch(q){console.error("Logout error:",q),w("Error signing out","error")}},ee=()=>{A(null),i("entry")},w=(q,L="")=>{te({message:q,type:L})},k=()=>{D("dashboard"),m?.id&&M()},M=async()=>{if(m?.id)try{const q=await de.getProjects(m.id);v(q)}catch(q){console.error("Error loading projects:",q)}};p.useEffect(()=>{m?.id&&l==="office"&&M()},[m?.id,l]);const he=q=>{if(q.type==="view_all"){D("dashboard"),F(null);return}D("dashboard"),q.projectId&&F(q.projectId)},V=()=>{F(null)};return z?e.jsx(nl,{companyId:m?.id,children:e.jsxs("div",{className:"loading-screen",children:[e.jsx(Ya,{className:"loading-logo"}),e.jsx("div",{className:"spinner"})]})}):l==="entry"?e.jsxs(nl,{children:[e.jsx(er,{children:e.jsx(rv,{onForemanAccess:P,onOfficeLogin:j,onShowToast:w})}),S&&e.jsx(Zs,{message:S.message,type:S.type,onClose:()=>te(null)})]}):l==="public"&&Y?e.jsxs(nl,{children:[e.jsx(er,{children:e.jsx(Wv,{shareToken:Y})}),S&&e.jsx(Zs,{message:S.message,type:S.type,onClose:()=>te(null)})]}):l==="signature"&&H?e.jsxs(nl,{children:[e.jsx(er,{children:e.jsx(ty,{signatureToken:H})}),S&&e.jsx(Zs,{message:S.message,type:S.type,onClose:()=>te(null)})]}):l==="foreman"&&y?e.jsxs(nl,{companyId:y.company_id,children:[e.jsx(er,{children:e.jsx(xv,{project:y,companyId:y.company_id,onShowToast:w,onExit:ee})}),e.jsx(Mf,{}),S&&e.jsx(Zs,{message:S.message,type:S.type,onClose:()=>te(null)})]}):e.jsx(nl,{companyId:m?.id,children:e.jsxs("div",{children:[!J&&e.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),e.jsx("nav",{className:"nav",children:e.jsxs("div",{className:"nav-content",children:[e.jsx(Ya,{}),e.jsxs("div",{className:"nav-tabs",children:[e.jsx("button",{className:`nav-tab ${E==="dashboard"?"active":""}`,onClick:()=>D("dashboard"),children:"Dashboard"}),e.jsx("button",{className:`nav-tab ${E==="setup"?"active":""}`,onClick:()=>D("setup"),children:"+ New Project"}),e.jsx("button",{className:`nav-tab ${E==="pricing"?"active":""}`,onClick:()=>D("pricing"),children:"Pricing"}),e.jsx("button",{className:`nav-tab ${E==="branding"?"active":""}`,onClick:()=>D("branding"),children:"Branding"})]}),e.jsxs("div",{className:"nav-user",children:[e.jsx(ay,{company:m,projects:f,userId:o?.id,onNotificationClick:he,onShowToast:w}),x.length>1&&e.jsxs("div",{className:"company-switcher",children:[e.jsxs("button",{className:"company-switcher-btn",onClick:()=>Z(!se),children:[m?.name||"Select Company",e.jsx("span",{className:"switcher-arrow",children:""})]}),se&&e.jsx("div",{className:"company-dropdown",children:x.map(q=>e.jsxs("button",{className:`company-option ${q.id===m?.id?"active":""}`,onClick:()=>_(q.id),children:[q.name,q.id===m?.id&&e.jsx("span",{className:"check",children:""})]},q.id))})]}),x.length<=1&&m&&e.jsx("span",{className:"nav-company-name",children:m.name}),e.jsx("span",{className:"nav-user-name",children:o?.name||o?.email}),e.jsx("button",{className:"nav-logout",onClick:C,children:"Sign Out"})]})]})}),e.jsx(er,{children:e.jsxs("div",{className:"container",children:[E==="dashboard"&&e.jsx(Vv,{company:m,onShowToast:w,navigateToProjectId:Q,onProjectNavigated:V}),E==="setup"&&e.jsx(Yv,{company:m,user:o,onProjectCreated:k,onShowToast:w}),E==="pricing"&&e.jsx(Kv,{company:m,onShowToast:w}),E==="branding"&&e.jsx(Qv,{company:m,onShowToast:w})]},m?.id)}),e.jsx(Mf,{}),S&&e.jsx(Zs,{message:S.message,type:S.type,onClose:()=>te(null)})]})})}Sx.createRoot(document.getElementById("root")).render(e.jsx(jx.StrictMode,{children:e.jsx(sy,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(l=>{console.log("SW registered:",l.scope),setInterval(()=>{l.update()},6e4)}).catch(l=>{console.log("SW registration failed:",l)})});
