import{ar as c,as as s}from"./index-AKXILsuC.js";import{r as d,N as Y,T as B,a as _,au as L,B as I,q as x,U as J,av as V,ak as W}from"./icons-D1pGYcxw.js";import"./react-DXGY7bZi.js";import"./pdf-aQqpMATS.js";import"./supabase-VuevzHjS.js";const N=[{value:"member",label:"Member",icon:L,description:"Standard access to projects"},{value:"administrator",label:"Administrator",icon:_,description:"Full control, can manage team"}],R=[{value:"Project Manager",label:"Project Manager"},{value:"Superintendent",label:"Superintendent"},{value:"Job Costing",label:"Job Costing"},{value:"Accounting",label:"Accounting"}];function Z({company:g,user:o,onShowToast:l}){const[i,h]=d.useState("pending"),[j,A]=d.useState([]),[z,f]=d.useState(!0),[t,n]=d.useState(null),[b,y]=d.useState({}),[C,M]=d.useState({});d.useEffect(()=>{g?.id&&u()},[g?.id]);const u=async()=>{try{f(!0);const e=await c.getCompanyMemberships(g.id);A(e)}catch(e){console.error("Error loading members:",e),l("Error loading team members","error")}finally{f(!1)}},F=async e=>{const a=C[e.id];if(!a){l("Please select a role for this member","error");return}try{n(e.id);const r=b[e.id]||"member";await c.approveMembershipWithRole(e.id,o.id,r),await c.updateMemberCompanyRole(e.id,a),l(`${e.users?.name||e.users?.email} approved as ${a}`,"success"),y(v=>{const m={...v};return delete m[e.id],m}),M(v=>{const m={...v};return delete m[e.id],m}),u()}catch(r){console.error("Error approving membership:",r),l("Error approving request","error")}finally{n(null)}},U=(e,a)=>{y(r=>({...r,[e]:a}))},$=(e,a)=>{M(r=>({...r,[e]:a}))},k=async(e,a)=>{try{n(e.id),await c.updateMemberCompanyRole(e.id,a),l(`${e.users?.name||"User"} role updated to ${a}`,"success"),u()}catch(r){console.error("Error updating company role:",r),l("Error updating role","error")}finally{n(null)}},D=async(e,a)=>{if(e.users?.id===o.id&&a!=="administrator"){l("You cannot demote yourself","error");return}try{n(e.id),await c.updateMemberAccessLevel(e.id,a);const r=N.find(v=>v.value===a)?.label||a;l(`${e.users?.name||"User"} is now ${r}`,"success"),u()}catch(r){console.error("Error updating access level:",r),l("Error updating access level","error")}finally{n(null)}},S=async e=>{try{n(e.id),await c.rejectMembership(e.id),l("Request rejected","success"),u()}catch(a){console.error("Error rejecting membership:",a),l("Error rejecting request","error")}finally{n(null)}},q=async e=>{if(e.users?.id===o.id){l("You cannot remove yourself","error");return}try{n(e.id),await c.removeMember(e.id,o.id),l(`${e.users?.name||e.users?.email} removed`,"success"),u()}catch(a){console.error("Error removing member:",a),l("Error removing member","error")}finally{n(null)}},E=j.filter(e=>i==="all"?!0:e.status===i),p=j.filter(e=>e.status==="pending").length,P=j.filter(e=>e.status==="active").length,O=j.filter(e=>e.status==="removed").length;return z?s.jsx("div",{className:"membership-manager",children:s.jsxs("div",{className:"loading",children:[s.jsx("div",{className:"spinner"}),"Loading team members..."]})}):s.jsxs("div",{className:"membership-manager",children:[s.jsxs("div",{className:"membership-header",children:[s.jsxs("h2",{children:[s.jsx(Y,{size:24})," Team Members"]}),s.jsxs("p",{className:"membership-subtitle",children:["Manage who has access to ",g?.name]})]}),p>0&&s.jsxs("div",{className:"pending-alert",children:[s.jsx(B,{size:20}),s.jsxs("span",{children:[p," pending request",p>1?"s":""," awaiting approval"]})]}),s.jsxs("div",{className:"tm-filter-tabs",children:[s.jsxs("button",{className:`tm-filter-tab ${i==="pending"?"active":""}`,onClick:()=>h("pending"),children:["Pending",s.jsx("span",{className:"tm-filter-count",children:p})]}),s.jsxs("button",{className:`tm-filter-tab ${i==="active"?"active":""}`,onClick:()=>h("active"),children:["Active",s.jsx("span",{className:"tm-filter-count",children:P})]}),s.jsxs("button",{className:`tm-filter-tab ${i==="removed"?"active":""}`,onClick:()=>h("removed"),children:["Removed",s.jsx("span",{className:"tm-filter-count",children:O})]})]}),s.jsx("div",{className:"member-list",children:E.length===0?s.jsxs("div",{className:"member-empty",children:[i==="pending"&&"No pending requests",i==="active"&&"No active members",i==="removed"&&"No removed members"]}):E.map(e=>s.jsxs("div",{className:`member-card ${e.status}`,children:[s.jsxs("div",{className:"member-info",children:[s.jsxs("div",{className:"member-name",children:[e.users?.name||"Unknown",e.users?.id===o.id&&s.jsx("span",{className:"member-you",children:"(You)"})]}),s.jsx("div",{className:"member-email",children:e.users?.email}),s.jsxs("div",{className:"member-meta",children:[e.status==="pending"&&s.jsxs(s.Fragment,{children:["Requested ",new Date(e.created_at).toLocaleDateString()]}),e.status==="active"&&e.approved_at&&s.jsxs(s.Fragment,{children:["Approved ",new Date(e.approved_at).toLocaleDateString()]}),e.status==="active"&&!e.approved_at&&s.jsxs(s.Fragment,{children:["Member since ",new Date(e.created_at).toLocaleDateString()]}),e.status==="removed"&&e.removed_at&&s.jsxs(s.Fragment,{children:["Removed ",new Date(e.removed_at).toLocaleDateString()]})]}),e.status==="active"&&s.jsxs("div",{className:"member-badges",children:[e.access_level==="administrator"?s.jsxs("span",{className:"access-badge admin",children:[s.jsx(_,{size:12})," Administrator"]}):s.jsxs("span",{className:"access-badge member",children:[s.jsx(L,{size:12})," Member"]}),e.company_role&&s.jsxs("span",{className:"access-badge role",children:[s.jsx(I,{size:12})," ",e.company_role]})]})]}),s.jsxs("div",{className:"member-actions",children:[e.status==="pending"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"role-selector",children:[s.jsxs("select",{value:C[e.id]||"",onChange:a=>$(e.id,a.target.value),disabled:t===e.id,className:"role-select",children:[s.jsx("option",{value:"",children:"Select Role..."}),R.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))]}),s.jsx(x,{size:14,className:"role-select-icon"})]}),s.jsxs("div",{className:"role-selector",children:[s.jsx("select",{value:b[e.id]||"member",onChange:a=>U(e.id,a.target.value),disabled:t===e.id,className:"role-select",children:N.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))}),s.jsx(x,{size:14,className:"role-select-icon"})]}),s.jsx("button",{className:"btn btn-success btn-small",onClick:()=>F(e),disabled:t===e.id,children:t===e.id?"...":s.jsxs(s.Fragment,{children:[s.jsx(J,{size:16})," Approve"]})}),s.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>S(e),disabled:t===e.id,children:t===e.id?"...":s.jsxs(s.Fragment,{children:[s.jsx(V,{size:16})," Reject"]})})]}),e.status==="active"&&e.users?.id!==o.id&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"role-selector",children:[s.jsxs("select",{value:e.company_role||"",onChange:a=>k(e,a.target.value),disabled:t===e.id,className:"role-select",children:[s.jsx("option",{value:"",children:"No Role"}),R.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))]}),s.jsx(x,{size:14,className:"role-select-icon"})]}),s.jsxs("div",{className:"role-selector",children:[s.jsx("select",{value:e.access_level||"member",onChange:a=>D(e,a.target.value),disabled:t===e.id,className:"role-select",children:N.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))}),s.jsx(x,{size:14,className:"role-select-icon"})]}),s.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>q(e),disabled:t===e.id,children:t===e.id?"...":s.jsxs(s.Fragment,{children:[s.jsx(W,{size:16})," Remove"]})})]})]})]},e.id))})]})}export{Z as default};
//# sourceMappingURL=MembershipManager-C8DAP1nR.js.map
