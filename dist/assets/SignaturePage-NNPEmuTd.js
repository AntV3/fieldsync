import{r as I,j as e,d as oe,H as pe,B as ke}from"./index-BqaJgZWc.js";import{e as Ce,a as Fe,b as te,f as b,m as B,l as ne,B as je,D as ue,P as me,C as Pe}from"./corCalculations-D3yQyDMA.js";import{E as Te,a as ae}from"./pdf-ChZ1zkDw.js";import{h as we,l as ie,R as De,b as Z,F as _e,C as be,T as Ie,a as ge}from"./imageUtils-ZisjP09f.js";import{X as $e,P as Re,C as Oe,a as fe}from"./x-DFpqJIi-.js";import{S as Ae,U as Ee}from"./users-3AbznTiT.js";import{C as Ne}from"./chevron-down-BguxgKmE.js";import{C as ve}from"./chevron-right-DyiEyia5.js";import"./react-DXGY7bZi.js";import"./supabase-VuevzHjS.js";const Se=l=>{if(!l)return"";const[j,y]=l.split(":"),C=parseInt(j),a=C>=12?"pm":"am";return`${C%12||12}:${y}${a}`},ze=l=>l.time_started&&l.time_ended?`${Se(l.time_started)} - ${Se(l.time_ended)}`:"-";async function Me(l){if(!l||l.length===0)return{totalPhotos:0,verified:0,failed:0,issues:[],manifest:[]};const j=[];let y=0,C=0;const a=[];for(const p of l)if(!(!p.photos||p.photos.length===0))for(const R of p.photos){const r={ticketId:p.id,workDate:p.work_date,url:R,verified:!1,error:null};try{await ie(R)?(r.verified=!0,y++):(r.error="Failed to load image",C++,a.push({ticketId:p.id,workDate:p.work_date,url:R,error:"Failed to load image"}))}catch(o){r.error=o.message||"Unknown error",C++,a.push({ticketId:p.id,workDate:p.work_date,url:R,error:r.error})}j.push(r)}return{totalPhotos:y+C,verified:y,failed:C,issues:a,manifest:j,allVerified:C===0,verifiedAt:new Date().toISOString()}}function qe(l,j,y,C){const a=JSON.stringify({cor:l,tmTickets:j,photoManifest:y,totals:C});let p=0;for(let r=0;r<a.length;r++){const o=a.charCodeAt(r);p=(p<<5)-p+o,p=p&p}const R=Math.abs(p).toString(16).padStart(16,"0");return{cor_data:{id:l.id,cor_number:l.cor_number,title:l.title,description:l.description,status:l.status,created_at:l.created_at,submitted_at:l.submitted_at,labor_items:l.labor_items,material_items:l.material_items,equipment_items:l.equipment_items,gc_markup_percent:l.gc_markup_percent,profit_markup_percent:l.profit_markup_percent},tickets_data:(j||[]).map(r=>({id:r.id,work_date:r.work_date,ce_pco_number:r.ce_pco_number,notes:r.notes,status:r.status,created_at:r.created_at,workers:r.t_and_m_workers||[],items:r.t_and_m_items||[],photos:r.photos||[],client_signature_name:r.client_signature_name,client_signature_date:r.client_signature_date})),photos_manifest:y,totals_snapshot:C,checksum:R}}async function Le(l,j,y,C={},a=null,p={}){const{verifyPhotos:R=!1,createSnapshot:r=!1}=p;let o=null;R&&a?.length>0&&(o=await Me(a));const t=new Te,N=t.internal.pageSize.getWidth(),D=t.internal.pageSize.getHeight(),n=20;let s=n;const k=Ce(l),c=C.primaryColor?we(C.primaryColor):[30,58,138],T=[241,245,249];let F=null;if(C.logoUrl)try{F=await ie(C.logoUrl)}catch(x){console.error("Error loading logo:",x)}if(F)try{t.addImage(F,"PNG",n,s,40,15),s+=20}catch{t.setFontSize(16),t.setFont("helvetica","bold"),t.setTextColor(...c),t.text(y?.name||"Company Name",n,s+10),s+=20}else t.setFontSize(16),t.setFont("helvetica","bold"),t.setTextColor(...c),t.text(y?.name||"Company Name",n,s+10),s+=20;t.setFontSize(20),t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("CHANGE ORDER REQUEST",n,s),s+=10,t.setFontSize(12),t.setFont("helvetica","normal"),t.setTextColor(100,100,100),t.text(l.cor_number||"COR-XXXX",n,s);const M=l.status?.replace("_"," ").toUpperCase()||"DRAFT";t.setTextColor(...c),t.text(M,N-n-t.getTextWidth(M),s),s+=12,t.setDrawColor(...c),t.setLineWidth(.5),t.line(n,s,N-n,s),s+=10,t.setFontSize(10),t.setTextColor(0,0,0);const $=n,E=N/2;t.setFont("helvetica","bold"),t.text("Project:",$,s),t.setFont("helvetica","normal"),t.text(j?.name||"Project Name",$+25,s),t.setFont("helvetica","bold"),t.text("Job #:",E,s),t.setFont("helvetica","normal"),t.text(j?.job_number||"N/A",E+25,s),s+=6,t.setFont("helvetica","bold"),t.text("Period:",$,s),t.setFont("helvetica","normal"),t.text(Fe(l.period_start,l.period_end),$+25,s),t.setFont("helvetica","bold"),t.text("Date:",E,s),t.setFont("helvetica","normal"),t.text(te(l.created_at),E+25,s),s+=10,t.setFont("helvetica","bold"),t.setFontSize(12),t.text(l.title||"Untitled Change Order",n,s),s+=8,t.setFont("helvetica","normal"),t.setFontSize(10),t.setTextColor(80,80,80);const U=t.splitTextToSize(l.scope_of_work||"No scope of work provided.",N-n*2);t.text(U,n,s),s+=U.length*5+10,l.change_order_labor?.length>0&&(t.setFont("helvetica","bold"),t.setFontSize(11),t.setTextColor(0,0,0),t.text("LABOR",n,s),s+=6,ae(t,{startY:s,head:[["Class","Type","Reg Hrs","Reg Rate","OT Hrs","OT Rate","Total"]],body:l.change_order_labor.map(x=>[x.labor_class,x.wage_type,x.regular_hours.toString(),`$${ne(x.regular_rate)}/hr`,x.overtime_hours?.toString()||"-",x.overtime_hours?`$${ne(x.overtime_rate)}/hr`:"-",b(x.total)]),foot:[[{content:`Subtotal: ${b(k.labor_subtotal)}`,colSpan:5,styles:{halign:"right",fontStyle:"bold"}},{content:`+${B(l.labor_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:b(k.labor_subtotal+k.labor_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:T,textColor:[0,0,0],fontSize:8},theme:"striped"}),s=t.lastAutoTable.finalY+10),l.change_order_materials?.length>0&&(s>D-80&&(t.addPage(),s=n),t.setFont("helvetica","bold"),t.setFontSize(11),t.setTextColor(0,0,0),t.text("MATERIALS",n,s),s+=6,ae(t,{startY:s,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:l.change_order_materials.map(x=>[x.description,x.source_reference||x.source_type,x.quantity.toString(),x.unit,`$${ne(x.unit_cost)}`,b(x.total)]),foot:[[{content:`Subtotal: ${b(k.materials_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${B(l.materials_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:b(k.materials_subtotal+k.materials_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:T,textColor:[0,0,0],fontSize:8},theme:"striped"}),s=t.lastAutoTable.finalY+10),l.change_order_equipment?.length>0&&(s>D-80&&(t.addPage(),s=n),t.setFont("helvetica","bold"),t.setFontSize(11),t.setTextColor(0,0,0),t.text("EQUIPMENT",n,s),s+=6,ae(t,{startY:s,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:l.change_order_equipment.map(x=>[x.description,x.source_reference||x.source_type,x.quantity.toString(),x.unit,`$${ne(x.unit_cost)}`,b(x.total)]),foot:[[{content:`Subtotal: ${b(k.equipment_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${B(l.equipment_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:b(k.equipment_subtotal+k.equipment_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:T,textColor:[0,0,0],fontSize:8},theme:"striped"}),s=t.lastAutoTable.finalY+10),l.change_order_subcontractors?.length>0&&(s>D-80&&(t.addPage(),s=n),t.setFont("helvetica","bold"),t.setFontSize(11),t.setTextColor(0,0,0),t.text("SUBCONTRACTORS",n,s),s+=6,ae(t,{startY:s,head:[["Company","Description","Source","Amount"]],body:l.change_order_subcontractors.map(x=>[x.company_name,x.description,x.source_reference||x.source_type,b(x.total)]),foot:[[{content:`Subtotal: ${b(k.subcontractors_subtotal)}`,colSpan:2,styles:{halign:"right",fontStyle:"bold"}},{content:`+${B(l.subcontractors_markup_percent||500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:b(k.subcontractors_subtotal+k.subcontractors_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:T,textColor:[0,0,0],fontSize:8},theme:"striped"}),s=t.lastAutoTable.finalY+10),s>D-100&&(t.addPage(),s=n),t.setFillColor(...T),t.roundedRect(n,s,N-n*2,70,3,3,"F"),s+=10,t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(0,0,0);const H=n+10,q=N-n-60;t.text("COR Subtotal:",H,s),t.setFont("helvetica","bold"),t.text(b(k.cor_subtotal),q,s,{align:"right"}),s+=8,t.setFont("helvetica","normal"),t.setFontSize(9),t.text(`Liability Insurance (${B(l.liability_insurance_percent||144)}):`,H,s),t.text(b(k.liability_insurance_amount),q,s,{align:"right"}),s+=6,t.text(`Bond (${B(l.bond_percent||100)}):`,H,s),t.text(b(k.bond_amount),q,s,{align:"right"}),s+=6,t.text(`City License Fee (${B(l.license_fee_percent||10)}):`,H,s),t.text(b(k.license_fee_amount),q,s,{align:"right"}),s+=10,t.setFillColor(...c),t.roundedRect(H-5,s-3,N-n*2-10,16,2,2,"F"),t.setTextColor(255,255,255),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("COR TOTAL:",H,s+8),t.text(b(k.cor_total),q,s+8,{align:"right"}),s+=25,s>D-120&&(t.addPage(),s=n),s+=10,t.setTextColor(0,0,0),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("AUTHORIZATION",n,s),s+=15,t.setFont("helvetica","normal"),t.setFontSize(9),t.setDrawColor(0,0,0);const K=(x,G,W,V,g,u,S)=>{t.setFont("helvetica","bold"),t.setFontSize(8),t.text(G,n,x),t.setFont("helvetica","normal"),t.setFontSize(9);const z=x+20;if(t.line(n,z,n+70,z),t.text("Signature",n,z+8),t.line(n+85,z,n+145,z),t.text("Title / Company",n+85,z+8),t.line(N-n-40,z,N-n,z),t.text("Date",N-n-40,z+8),W)try{if(t.addImage(W,"PNG",n,z-18,60,18),V&&(t.setFontSize(8),t.text(V,n,z+15)),g||u){const O=[g,u].filter(Boolean).join(" - ");t.text(O,n+85,z-5)}S&&t.text(te(S),N-n-40,z-5)}catch(O){console.error("Error adding signature:",O)}else t.setFont("helvetica","italic"),t.setFontSize(9),t.setTextColor(150,150,150),t.text("Awaiting Signature",n+5,z-5),t.setTextColor(0,0,0),t.setFont("helvetica","normal");return z+25};if(s=K(s,"GC AUTHORIZATION",l.gc_signature_data||l.gc_signature,l.gc_signature_name||l.gc_signer_name,l.gc_signature_title,l.gc_signature_company,l.gc_signature_date||l.signed_at),s+=10,s=K(s,"CLIENT AUTHORIZATION",l.client_signature_data,l.client_signature_name,l.client_signature_title,l.client_signature_company,l.client_signature_date),a&&a.length>0){const x=a.reduce((m,i)=>m+(i.t_and_m_workers?.reduce((f,_)=>f+(parseFloat(_.hours)||0),0)||0),0),G=a.reduce((m,i)=>m+(i.t_and_m_workers?.reduce((f,_)=>f+(parseFloat(_.overtime_hours)||0),0)||0),0),W=a.reduce((m,i)=>m+(i.photos?.length||0),0),V=a.filter(m=>m.client_signature_data).length,g=a.length>0?{start:a.reduce((m,i)=>!m||i.work_date<m?i.work_date:m,null),end:a.reduce((m,i)=>!m||i.work_date>m?i.work_date:m,null)}:null,u=new Uint8Array(3);crypto.getRandomValues(u);const S=Array.from(u,m=>m.toString(36)).join("").toUpperCase().substring(0,4),z=`FS-${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}-${S}`;if(t.addPage(),s=n,F)try{t.addImage(F,"PNG",n,s,50,18)}catch{t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(...c),t.text(y?.name||"Company Name",n,s+10)}else t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(...c),t.text(y?.name||"Company Name",n,s+10);s+=35,t.setDrawColor(...c),t.setLineWidth(.8),t.line(n,s,N-n,s),t.setLineWidth(.3),t.line(n,s+3,N-n,s+3),s+=15,t.setFontSize(22),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("SUPPORTING DOCUMENTATION",N/2,s,{align:"center"}),s+=8,t.setFontSize(12),t.setFont("helvetica","normal"),t.setTextColor(100,116,139),t.text("Change Order Request Backup",N/2,s,{align:"center"}),s+=8,t.setDrawColor(...c),t.setLineWidth(.3),t.line(n,s,N-n,s),t.setLineWidth(.8),t.line(n,s+3,N-n,s+3),s+=20,t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("COR Reference:",n,s),t.setFont("helvetica","normal"),t.text(l.cor_number||"N/A",n+35,s),t.setFont("helvetica","bold"),t.text("Project:",N/2,s),t.setFont("helvetica","normal"),t.text(j?.name||"N/A",N/2+20,s),s+=7,t.setFont("helvetica","bold"),t.text("Job #:",n,s),t.setFont("helvetica","normal"),t.text(j?.job_number||"N/A",n+35,s),s+=20,t.setFillColor(248,250,252),t.setDrawColor(203,213,225),t.roundedRect(n,s,N-n*2,65,4,4,"FD"),s+=10,t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("DOCUMENTATION SUMMARY",n+10,s),t.setDrawColor(203,213,225),t.setLineWidth(.3),t.line(n+10,s+3,n+80,s+3),s+=12,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(71,85,105);const O=n+15,Q=n+70;t.text("T&M Tickets:",O,s),t.setFont("helvetica","bold"),t.text(String(a.length),Q,s),t.setFont("helvetica","normal"),s+=7,t.text("Total Labor:",O,s),t.setFont("helvetica","bold"),t.text(`${x.toFixed(1)} hrs`,Q,s),t.setFont("helvetica","normal"),s+=7,G>0&&(t.text("Total OT:",O,s),t.setFont("helvetica","bold"),t.text(`${G.toFixed(1)} hrs`,Q,s),t.setFont("helvetica","normal"),s+=7),t.text("Photo Evidence:",O,s),t.setFont("helvetica","bold"),t.text(`${W} photos`,Q,s),t.setFont("helvetica","normal"),s+=7,t.text("Client Verified:",O,s),t.setFont("helvetica","bold"),t.setTextColor(V>0?16:71,V>0?185:85,V>0?129:105),t.text(`${V} of ${a.length} tickets`,Q,s),t.setTextColor(71,85,105),t.setFont("helvetica","normal"),s+=7,g?.start&&g?.end&&(t.text("Date Range:",O,s),t.setFont("helvetica","bold"),t.text(`${te(g.start)} - ${te(g.end)}`,Q,s)),s+=30,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(100,116,139);const L=new Date;t.text(`Generated: ${L.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})} at ${L.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`,n,s),s+=6,t.text(`Document ID: ${z}`,n,s);for(const m of a){t.addPage(),s=n;const i=!!m.client_signature_data,f=22,_=i?[16,185,129]:m.status==="approved"?[16,185,129]:[245,158,11];if(t.setFillColor(..._),t.rect(n,s,4,f,"F"),t.setFillColor(248,250,252),t.rect(n+4,s,N-n*2-4,f,"F"),t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text(`T&M TICKET — ${te(m.work_date)}`,n+10,s+8),m.ce_pco_number&&(t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(59,130,246),t.text(`CE/PCO: ${m.ce_pco_number}`,n+10,s+16)),i&&(t.setFontSize(8),t.setFont("helvetica","bold"),t.setTextColor(16,185,129),t.text("✓ CLIENT VERIFIED",N-n-35,s+12)),s+=f+8,m.notes){t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("DESCRIPTION",n,s),s+=6,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(51,65,85);const h=t.splitTextToSize(m.notes,N-n*2);t.text(h,n,s),s+=h.length*4+10}if(m.t_and_m_workers?.length>0&&(t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("LABOR",n,s),s+=6,ae(t,{startY:s,head:[["Worker","Time Period","Class","Reg Hrs","OT Hrs"]],body:m.t_and_m_workers.map(h=>[h.name,ze(h),h.role||h.labor_class||"Laborer",h.hours?.toString()||"0",h.overtime_hours?.toString()||"-"]),margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),s=t.lastAutoTable.finalY+10),m.t_and_m_items?.length>0&&(s>D-60&&(t.addPage(),s=n),t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("MATERIALS / EQUIPMENT",n,s),t.setFontSize(7),t.setFont("helvetica","normal"),t.setTextColor(100,116,139),t.text("Source: T&M Ticket",n+55,s),s+=6,ae(t,{startY:s,head:[["Item","Qty","Unit","Unit Cost","Total"]],body:m.t_and_m_items.map(h=>[h.materials_equipment?.name||h.description||"Item",h.quantity?.toString()||"1",h.materials_equipment?.unit||"ea",h.materials_equipment?.cost_per_unit?`$${h.materials_equipment.cost_per_unit}`:"-",h.materials_equipment?.cost_per_unit&&h.quantity?`$${(h.quantity*h.materials_equipment.cost_per_unit).toFixed(2)}`:"-"]),margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),s=t.lastAutoTable.finalY+10),m.photos?.length>0){s>D-80&&(t.addPage(),s=n),t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("PHOTO DOCUMENTATION",n,s),t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(59,130,246),t.text(`${m.photos.length} photo${m.photos.length!==1?"s":""}`,n+50,s),s+=8;let h=n;const d=55,P=45,X=6,ee=3,J=1;for(let v=0;v<m.photos.length;v++){v>0&&v%ee===0&&(h=n,s+=P+X+4),s+P>D-20&&(t.addPage(),s=n,h=n);try{const A=await ie(m.photos[v]);A?(t.setDrawColor(200,200,200),t.setLineWidth(J),t.rect(h-J,s-J,d+J*2,P+J*2,"S"),t.setFillColor(230,230,230),t.rect(h+2,s+2,d,P,"F"),t.addImage(A,"JPEG",h,s,d,P)):(t.setFillColor(245,245,245),t.rect(h,s,d,P,"F"),t.setDrawColor(200,200,200),t.rect(h,s,d,P,"S"),t.setFontSize(7),t.setTextColor(150,150,150),t.text("Photo unavailable",h+8,s+P/2))}catch{t.setFillColor(245,245,245),t.rect(h,s,d,P,"F"),t.setDrawColor(200,200,200),t.rect(h,s,d,P,"S"),t.setFontSize(7),t.setTextColor(150,150,150),t.text("Photo unavailable",h+8,s+P/2)}h+=d+X}s+=P+12}if(m.client_signature_data){s>D-50&&(t.addPage(),s=n);const h=32,d=N-n*2;t.setFillColor(240,253,244),t.roundedRect(n,s,d,h,3,3,"F"),t.setFillColor(16,185,129),t.rect(n,s,4,h,"F"),t.setDrawColor(187,247,208),t.setLineWidth(.5),t.line(n+4,s,n+d,s);const P=n+14,X=s+h/2;t.setFillColor(16,185,129),t.circle(P,X,6,"F"),t.setFontSize(9),t.setTextColor(255,255,255),t.text("✓",P-2.5,X+3),t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(16,185,129),t.text("CLIENT VERIFIED",n+26,s+10);try{t.addImage(m.client_signature_data,"PNG",n+26,s+13,50,16);const v=m.client_signature_name||"Client",A=m.client_signature_title||"",le=m.client_signature_company||"",xe=m.client_signature_date?te(m.client_signature_date):"",he=n+85;t.setFont("helvetica","bold"),t.setFontSize(9),t.setTextColor(30,41,59),t.text(v,he,s+12),t.setFont("helvetica","normal"),t.setFontSize(8),t.setTextColor(71,85,105),(A||le)&&t.text(`${A}${A&&le?", ":""}${le}`,he,s+18),xe&&(t.setTextColor(100,116,139),t.text(`Verified: ${xe}`,he,s+24))}catch{const J=m.client_signature_name||"Client";t.setFont("helvetica","normal"),t.setFontSize(9),t.setTextColor(30,41,59),t.text(`Signed by: ${J}`,n+26,s+20)}s+=h+8}s+=5,t.setDrawColor(200,200,200),t.setLineWidth(.2),t.line(n,s,N-n,s),s+=10}}const Y=t.internal.getNumberOfPages();for(let x=1;x<=Y;x++){t.setPage(x);const G=D-10;t.setFontSize(8),t.setTextColor(150,150,150),t.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,n,G),t.text(`Page ${x} of ${Y}`,N-n,G,{align:"right"})}const w=`${l.cor_number||"COR"}_${j?.job_number||"export"}${a?.length?"_with_backup":""}.pdf`;t.save(w);const se={success:!0,fileName:w,exportedAt:new Date().toISOString(),photoManifest:o};return r&&(se.snapshot=qe(l,a,o,k)),se}async function Ue(l,j,y,C={}){const a=new Te("p","mm","letter"),p=a.internal.pageSize.getWidth(),R=a.internal.pageSize.getHeight(),r=20;let o=r;const t=C.primaryColor?we(C.primaryColor):[30,58,95];if(C.logoUrl)try{const c=await ie(C.logoUrl);c&&a.addImage(c,"PNG",r,o,40,15)}catch{y?.name&&(a.setFontSize(14),a.setFont("helvetica","bold"),a.setTextColor(...t),a.text(y.name,r,o+8))}else y?.name&&(a.setFontSize(14),a.setFont("helvetica","bold"),a.setTextColor(...t),a.text(y.name,r,o+8));if(a.setFontSize(16),a.setFont("helvetica","bold"),a.setTextColor(30,41,59),a.text("T&M TICKET",p-r,o+8,{align:"right"}),o+=25,a.setDrawColor(...t),a.setLineWidth(.5),a.line(r,o,p-r,o),o+=10,!!l.client_signature_data&&(a.setFillColor(240,253,244),a.roundedRect(p-r-45,o-5,45,12,2,2,"F"),a.setFontSize(9),a.setFont("helvetica","bold"),a.setTextColor(16,185,129),a.text("✓ CLIENT VERIFIED",p-r-42,o+3)),a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("Project:",r,o),a.setFont("helvetica","normal"),a.setTextColor(30,41,59),a.text(j?.name||"N/A",r+20,o),o+=6,j?.job_number&&(a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("Job #:",r,o),a.setFont("helvetica","normal"),a.setTextColor(30,41,59),a.text(j.job_number,r+20,o),o+=6),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("Work Date:",r,o),a.setFont("helvetica","normal"),a.setTextColor(30,41,59),a.text(te(l.work_date||l.ticket_date),r+26,o),l.ce_pco_number&&(a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("CE/PCO:",r+70,o),a.setFont("helvetica","normal"),a.setTextColor(59,130,246),a.text(l.ce_pco_number,r+88,o)),o+=12,l.notes){a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("DESCRIPTION",r,o),o+=6,a.setFontSize(9),a.setFont("helvetica","normal"),a.setTextColor(51,65,85);const c=a.splitTextToSize(l.notes,p-r*2);a.text(c,r,o),o+=c.length*4+10}l.t_and_m_workers?.length>0&&(a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("LABOR",r,o),o+=6,ae(a,{startY:o,head:[["Worker","Time Period","Class","Reg Hrs","OT Hrs"]],body:l.t_and_m_workers.map(c=>[c.name,ze(c),c.role||c.labor_class||"Laborer",c.hours?.toString()||"0",c.overtime_hours?.toString()||"-"]),margin:{left:r,right:r},headStyles:{fillColor:t,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),o=a.lastAutoTable.finalY+10);const D=l.t_and_m_items||l.materials_equipment?.filter(c=>c.type==="material")||[];if(D.length>0&&(o>R-60&&(a.addPage(),o=r),a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("MATERIALS / EQUIPMENT",r,o),o+=6,ae(a,{startY:o,head:[["Item","Qty","Unit"]],body:D.map(c=>[c.materials_equipment?.name||c.description||c.name||"Item",c.quantity?.toString()||"1",c.materials_equipment?.unit||c.unit||"ea"]),margin:{left:r,right:r},headStyles:{fillColor:t,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),o=a.lastAutoTable.finalY+10),l.photos?.length>0){o>R-80&&(a.addPage(),o=r),a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("PHOTO DOCUMENTATION",r,o),a.setFontSize(8),a.setFont("helvetica","normal"),a.setTextColor(59,130,246),a.text(`${l.photos.length} photo${l.photos.length!==1?"s":""}`,r+50,o),o+=8;let c=r;const T=55,F=45,M=6,$=3;for(let E=0;E<l.photos.length;E++){E>0&&E%$===0&&(c=r,o+=F+M+4),o+F>R-20&&(a.addPage(),o=r,c=r);try{const U=await ie(l.photos[E]);U?(a.setDrawColor(200,200,200),a.setLineWidth(1),a.rect(c-1,o-1,T+2,F+2,"S"),a.setFillColor(230,230,230),a.rect(c+2,o+2,T,F,"F"),a.addImage(U,"JPEG",c,o,T,F)):(a.setFillColor(245,245,245),a.rect(c,o,T,F,"F"),a.setDrawColor(200,200,200),a.rect(c,o,T,F,"S"),a.setFontSize(7),a.setTextColor(150,150,150),a.text("Photo unavailable",c+8,o+F/2))}catch{a.setFillColor(245,245,245),a.rect(c,o,T,F,"F"),a.setDrawColor(200,200,200),a.rect(c,o,T,F,"S"),a.setFontSize(7),a.setTextColor(150,150,150),a.text("Photo unavailable",c+8,o+F/2)}c+=T+M}o+=F+12}if(l.client_signature_data){o>R-50&&(a.addPage(),o=r);const c=32,T=p-r*2;a.setFillColor(240,253,244),a.roundedRect(r,o,T,c,3,3,"F"),a.setFillColor(16,185,129),a.rect(r,o,4,c,"F"),a.setDrawColor(187,247,208),a.setLineWidth(.5),a.line(r+4,o,r+T,o);const F=r+14,M=o+c/2;a.setFillColor(16,185,129),a.circle(F,M,6,"F"),a.setFontSize(9),a.setTextColor(255,255,255),a.text("✓",F-2.5,M+3),a.setFontSize(9),a.setFont("helvetica","bold"),a.setTextColor(16,185,129),a.text("CLIENT VERIFIED",r+26,o+10);try{a.addImage(l.client_signature_data,"PNG",r+26,o+13,50,16);const U=l.client_signature_name||"Client",H=l.client_signature_title||"",q=l.client_signature_company||"",K=l.client_signature_date?te(l.client_signature_date):"",Y=r+85;a.setFont("helvetica","bold"),a.setFontSize(9),a.setTextColor(30,41,59),a.text(U,Y,o+12),a.setFont("helvetica","normal"),a.setFontSize(8),a.setTextColor(71,85,105),(H||q)&&a.text(`${H}${H&&q?", ":""}${q}`,Y,o+18),K&&(a.setTextColor(100,116,139),a.text(`Verified: ${K}`,Y,o+24))}catch{const E=l.client_signature_name||"Client";a.setFont("helvetica","normal"),a.setFontSize(9),a.setTextColor(30,41,59),a.text(`Signed by: ${E}`,r+26,o+20)}o+=c+8}const n=a.internal.getNumberOfPages();for(let c=1;c<=n;c++){a.setPage(c);const T=R-10;a.setFontSize(8),a.setTextColor(150,150,150),a.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,r,T),a.text(`Page ${c} of ${n}`,p-r,T,{align:"right"})}const k=`TM_Ticket_${te(l.work_date||l.ticket_date).replace(/\//g,"-")}${l.ce_pco_number?"_"+l.ce_pco_number:""}.pdf`;return a.save(k),{success:!0,fileName:k}}function ye({onSave:l,onClose:j,slot:y=1,documentType:C="cor",documentTitle:a="",signerName:p="",signerTitle:R="",signerCompany:r=""}){const o=I.useRef(null),[t,N]=I.useState(p),[D,n]=I.useState(R),[s,k]=I.useState(r),[c,T]=I.useState(!1),[F,M]=I.useState(!1),[$,E]=I.useState(!1),U=y===1?"GC Authorization":"Client Authorization",H=C==="cor"?"Change Order Request":"T&M Work Order";I.useEffect(()=>{const g=document.body.style.overflow,u=document.body.style.position,S=document.body.style.top,z=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${z}px`,document.body.style.width="100%",()=>{document.body.style.overflow=g,document.body.style.position=u,document.body.style.top=S,document.body.style.width="",window.scrollTo(0,z)}},[]);const q=()=>{const g=o.current;return g?g.getContext("2d"):null},K=g=>{const u=o.current;if(!u)return{x:0,y:0};const S=u.getBoundingClientRect(),z=u.width/S.width,O=u.height/S.height,Q=g.touches?g.touches[0].clientX:g.clientX,L=g.touches?g.touches[0].clientY:g.clientY;return{x:(Q-S.left)*z,y:(L-S.top)*O}},Y=g=>{g.preventDefault();const u=q();if(!u)return;const{x:S,y:z}=K(g);u.beginPath(),u.moveTo(S,z),M(!0),T(!0)},w=g=>{if(!F)return;g.preventDefault();const u=q();if(!u)return;const{x:S,y:z}=K(g);u.lineTo(S,z),u.stroke()},se=()=>{M(!1)},x=()=>{const g=o.current,u=q();!g||!u||(u.clearRect(0,0,g.width,g.height),T(!1))},G=g=>{if(!g)return;o.current=g;const u=g.getContext("2d");u.strokeStyle="#1e293b",u.lineWidth=2,u.lineCap="round",u.lineJoin="round"},W=c&&t.trim()&&$,V=()=>{if(!W)return;const g=o.current;if(!g)return;const u=g.toDataURL("image/png");l({signature:u,signerName:t.trim(),signerTitle:D.trim()||null,signerCompany:s.trim()||null,signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:j,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal enhanced",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"signature-header-info",children:[e.jsx("h2",{id:"signature-title",children:U}),a&&e.jsx("span",{className:"signature-doc-ref",children:a})]}),e.jsx("button",{className:"close-btn",onClick:j,"aria-label":"Close signature modal",children:e.jsx($e,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"signature-slot-badge",children:[e.jsx(Ae,{size:14}),e.jsxs("span",{children:["Signature ",y," of 2"]})]}),e.jsxs("div",{className:"signature-fields",children:[e.jsxs("div",{className:"form-group required",children:[e.jsx("label",{htmlFor:"signer-name",children:"Print Name"}),e.jsx("input",{id:"signer-name",type:"text",value:t,onChange:g=>N(g.target.value),placeholder:"Enter your full legal name","aria-required":"true",className:"input-required"})]}),e.jsxs("div",{className:"signature-fields-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-title",children:"Title"}),e.jsx("input",{id:"signer-title",type:"text",value:D,onChange:g=>n(g.target.value),placeholder:"e.g., Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-company",children:"Company"}),e.jsx("input",{id:"signer-company",type:"text",value:s,onChange:g=>k(g.target.value),placeholder:"e.g., ABC Construction"})]})]})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(Re,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Draw your signature below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:G,width:500,height:180,className:"signature-canvas",onMouseDown:Y,onMouseMove:w,onMouseUp:se,onMouseLeave:se,onTouchStart:Y,onTouchMove:w,onTouchEnd:se,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!c&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:x,disabled:!c,"aria-label":"Clear signature",children:[e.jsx(De,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("div",{className:"signature-acknowledgment",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:g=>E(g.target.checked)}),e.jsxs("span",{children:["I acknowledge that this electronic signature is legally binding and that I have reviewed and approve this ",H,". I understand that my signature, name, and IP address will be recorded for verification purposes."]})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:j,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:V,disabled:!W,"aria-label":"Submit signature",children:[e.jsx(Oe,{size:16,"aria-hidden":"true"})," Submit Signature"]})]})]})})}const re=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",ce=l=>{if(!l)return"";const[j,y]=l.split(":"),C=parseInt(j),a=C>=12?"pm":"am";return`${C%12||12}:${y}${a}`},He=({status:l})=>{const j={draft:{label:"Draft",color:"#6b7280",bg:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bg:"#fef3c7"},approved:{label:"Approved",color:"#059669",bg:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bg:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bg:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bg:"#e5e7eb"}},y=j[l]||j.draft;return e.jsx("span",{className:"cor-status-badge",style:{color:y.color,backgroundColor:y.bg},children:y.label})};function et({signatureToken:l}){const[j,y]=I.useState(!0),[C,a]=I.useState(null),[p,R]=I.useState(null),[r,o]=I.useState(null),[t,N]=I.useState(!1),[D,n]=I.useState(null),[s,k]=I.useState(!1),[c,T]=I.useState(null),[F,M]=I.useState(!1),[$,E]=I.useState([]),[U,H]=I.useState(!1),[q,K]=I.useState(new Set);I.useEffect(()=>{Y()},[l]);const Y=async()=>{try{y(!0),a(null);const i=await oe.getSignatureRequestByToken(l);if(!i){a("This signature link is invalid or has expired.");return}if(i.status==="completed"){a("This document has already been fully signed.");return}if(i.status==="revoked"){a("This signature link has been revoked.");return}if(i.status==="expired"){a("This signature link has expired.");return}R(i);const f=await oe.getDocumentForSigning(i.document_type,i.document_id);if(!f){a("The document associated with this link could not be found.");return}if(o(f),i.document_type==="cor"&&f?.id)try{const _=await oe.getCORTickets(f.id);E(_||[])}catch(_){console.warn("Failed to load backup tickets:",_)}}catch(i){console.error("Error loading signature data:",i),a("Unable to load signature request. Please try again.")}finally{y(!1)}},w=I.useMemo(()=>!r||p?.document_type!=="cor"?null:Ce(r),[r,p]),se=()=>{if(!p)return{slot1:null,slot2:null,availableSlots:[]};const i=p.signatures||[],f=i.find(d=>d.signature_slot===1),_=i.find(d=>d.signature_slot===2),h=[];return f||h.push(1),_||h.push(2),{slot1:f,slot2:_,availableSlots:h}},x=async()=>{try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return null}},G=async i=>{if(!(!p||!D))try{k(!0);const f=await x(),_=await oe.addSignature(p.id,D,{...i,ipAddress:f,userAgent:navigator.userAgent});await oe.syncSignatureToDocument(_,p),await Y(),N(!1),n(null),T("signed")}catch(f){console.error("Error submitting signature:",f),a("Failed to submit signature. Please try again.")}finally{k(!1)}},W=i=>{n(i),N(!0)},V=async()=>{if(!(!r||!p))try{M(!0);let i=null;if(Q)try{i=await oe.getCORTickets(r.id)}catch(_){console.warn("Failed to fetch T&M tickets for backup:",_)}const f={logoUrl:L?.logo_url,primaryColor:L?.branding_color};await Le(r,m,L,f,i),T("PDF downloaded successfully!"),setTimeout(()=>T(null),3e3)}catch(i){console.error("Download failed:",i),a("Failed to generate PDF. Please try again.")}finally{M(!1)}},g=async()=>{if(!(!r||!p))try{M(!0);const i=r?.projects?.companies,f=r?.projects,_={logoUrl:i?.logo_url,primaryColor:i?.branding_color};await Ue(r,f,i,_),T("PDF downloaded successfully!"),setTimeout(()=>T(null),3e3)}catch(i){console.error("Download failed:",i),a("Failed to generate PDF. Please try again.")}finally{M(!1)}};if(j)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading document..."})]})});if(C)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-error",children:[e.jsx(fe,{size:48}),e.jsx("h2",{children:"Unable to Load Document"}),e.jsx("p",{children:C})]})});const{slot1:u,slot2:S,availableSlots:z}=se(),O=u||S,Q=p?.document_type==="cor",L=r?.projects?.companies,m=r?.projects;if(!Q){const i=r.t_and_m_workers?.length||0,f=r.t_and_m_workers?.reduce((_,h)=>_+(h.hours||0),0)||0;return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[L?.logo_url?e.jsx("img",{src:L.logo_url,alt:L.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(je,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:L?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"T&M Ticket Signature"})]})]}),c==="signed"&&e.jsx("div",{className:"signature-signed-overlay",children:e.jsxs("div",{className:"signature-signed-content",children:[e.jsx(Z,{size:48}),e.jsx("h2",{children:"Document Signed Successfully"}),e.jsx("p",{children:"This document has been signed and submitted."}),e.jsx("button",{className:"btn btn-primary download-copy-btn",onClick:g,disabled:F,children:F?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"btn-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:18}),"Save a Copy for Your Records"]})}),e.jsx("p",{className:"close-prompt",children:"You may close this page when done."})]})}),e.jsxs("main",{className:"signature-page-content",children:[e.jsxs("div",{className:"signature-document-card",children:[e.jsxs("div",{className:"document-card-header",children:[e.jsx(_e,{size:20}),e.jsxs("div",{className:"document-card-title",children:[e.jsx("h2",{children:"T&M Ticket"}),e.jsx("span",{className:"document-subtitle",children:r.ce_pco_number?`CE/PCO: ${r.ce_pco_number}`:"Time & Materials"})]})]}),e.jsxs("div",{className:"document-card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Project"}),e.jsx("span",{className:"detail-value",children:m?.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Work Date"}),e.jsx("span",{className:"detail-value",children:re(r.work_date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Workers"}),e.jsxs("span",{className:"detail-value",children:[i," (",f," hrs)"]})]}),r.notes&&e.jsxs("div",{className:"detail-row full-width",children:[e.jsx("span",{className:"detail-label",children:"Description"}),e.jsx("span",{className:"detail-value",children:r.notes})]})]}),r.t_and_m_workers?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx(pe,{size:16})," Workers"]}),e.jsxs("table",{className:"signature-detail-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"OT"})]})}),e.jsx("tbody",{children:r.t_and_m_workers.map((_,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:_.name}),e.jsx("td",{children:_.role||"Laborer"}),e.jsx("td",{children:_.time_started&&_.time_ended?`${ce(_.time_started)} - ${ce(_.time_ended)}`:"-"}),e.jsx("td",{children:_.hours||0}),e.jsx("td",{children:_.overtime_hours||"-"})]},h))})]})]}),r.t_and_m_items?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx(me,{size:16})," Materials & Equipment"]}),e.jsxs("table",{className:"signature-detail-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"})]})}),e.jsx("tbody",{children:r.t_and_m_items.map((_,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:_.custom_name||_.materials_equipment?.name||"Item"}),e.jsx("td",{children:_.quantity}),e.jsx("td",{children:_.materials_equipment?.unit||"each"})]},h))})]})]}),r.photos?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx(be,{size:16})," Photos (",r.photos.length,")"]}),e.jsx("div",{className:"signature-photo-grid",children:r.photos.map((_,h)=>e.jsx("div",{className:"signature-photo-thumb",children:e.jsx("img",{src:typeof _=="string"?_:_.url,alt:`Photo ${h+1}`,onError:d=>{d.target.style.display="none"}})},h))})]})]}),e.jsxs("div",{className:"signature-status-section",children:[e.jsx("h3",{children:"Signature"}),O?e.jsxs(e.Fragment,{children:[u&&de(1,u,"GC Authorization",W,s),S&&de(2,S,"Client Authorization",W,s)]}):e.jsxs(e.Fragment,{children:[de(1,u,"GC Authorization",W,s),!u&&e.jsx("p",{className:"or-divider",children:"— or —"}),de(2,S,"Client Authorization",W,s)]}),O&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Z,{size:24}),e.jsx("p",{children:"This document has been signed."})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),t&&D&&e.jsx(ye,{slot:D,documentType:"tm_ticket",documentTitle:"T&M Ticket",onSave:G,onClose:()=>{N(!1),n(null)}})]})}return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[L?.logo_url?e.jsx("img",{src:L.logo_url,alt:L.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(je,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:L?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"Change Order Request"})]})]}),c==="signed"&&e.jsx("div",{className:"signature-signed-overlay",children:e.jsxs("div",{className:"signature-signed-content",children:[e.jsx(Z,{size:48}),e.jsx("h2",{children:"Document Signed Successfully"}),e.jsx("p",{children:"This document has been signed and submitted."}),e.jsx("button",{className:"btn btn-primary download-copy-btn",onClick:V,disabled:F,children:F?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"btn-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:18}),"Save a Copy for Your Records"]})}),e.jsx("p",{className:"close-prompt",children:"You may close this page when done."})]})}),e.jsxs("main",{className:"signature-page-content cor-full-document",children:[e.jsxs("div",{className:"cor-header-card",children:[e.jsxs("div",{className:"cor-header-top",children:[e.jsxs("div",{className:"cor-title-section",children:[e.jsx("h2",{className:"cor-number",children:r.cor_number}),e.jsx(He,{status:r.status})]}),e.jsxs("div",{className:"cor-date",children:["Created ",re(r.created_at)]})]}),e.jsx("h3",{className:"cor-title",children:r.title||"Untitled Change Order"}),e.jsxs("div",{className:"cor-info-grid",children:[e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Project"}),e.jsx("span",{className:"cor-info-value",children:m?.name})]}),m?.job_number&&e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Job #"}),e.jsx("span",{className:"cor-info-value",children:m.job_number})]}),e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Period"}),e.jsx("span",{className:"cor-info-value",children:Fe(r.period_start,r.period_end)})]})]}),r.scope_of_work&&e.jsxs("div",{className:"cor-scope",children:[e.jsx("h4",{children:"Scope of Work"}),e.jsx("p",{children:r.scope_of_work})]})]}),r.change_order_labor?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Ee,{size:18}),e.jsx("h4",{children:"Labor"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{className:"text-right",children:"Reg Hrs"}),e.jsx("th",{className:"text-right",children:"Reg Rate"}),e.jsx("th",{className:"text-right",children:"OT Hrs"}),e.jsx("th",{className:"text-right",children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:r.change_order_labor.map((i,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.labor_class}),e.jsx("td",{children:i.wage_type}),e.jsx("td",{className:"text-right",children:i.regular_hours}),e.jsxs("td",{className:"text-right",children:["$",ne(i.regular_rate),"/hr"]}),e.jsx("td",{className:"text-right",children:i.overtime_hours||"-"}),e.jsx("td",{className:"text-right",children:i.overtime_hours?`$${ne(i.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:b(i.total)})]},f))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.labor_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"5",className:"text-right",children:["+ ",B(r.labor_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.labor_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"5",className:"text-right",children:e.jsx("strong",{children:"Labor Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:b(w.labor_subtotal+w.labor_markup_amount)})})]})]})]})})]}),r.change_order_materials?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(me,{size:18}),e.jsx("h4",{children:"Materials"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:r.change_order_materials.map((i,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.description}),e.jsx("td",{children:i.source_reference||i.source_type}),e.jsx("td",{className:"text-right",children:i.quantity}),e.jsx("td",{children:i.unit}),e.jsxs("td",{className:"text-right",children:["$",ne(i.unit_cost)]}),e.jsx("td",{className:"text-right",children:b(i.total)})]},f))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.materials_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",B(r.materials_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.materials_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Materials Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:b(w.materials_subtotal+w.materials_markup_amount)})})]})]})]})})]}),r.change_order_equipment?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Ie,{size:18}),e.jsx("h4",{children:"Equipment"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:r.change_order_equipment.map((i,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.description}),e.jsx("td",{children:i.source_reference||i.source_type}),e.jsx("td",{className:"text-right",children:i.quantity}),e.jsx("td",{children:i.unit}),e.jsxs("td",{className:"text-right",children:["$",ne(i.unit_cost)]}),e.jsx("td",{className:"text-right",children:b(i.total)})]},f))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.equipment_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",B(r.equipment_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.equipment_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Equipment Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:b(w.equipment_subtotal+w.equipment_markup_amount)})})]})]})]})})]}),r.change_order_subcontractors?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(ke,{size:18}),e.jsx("h4",{children:"Subcontractors"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:r.change_order_subcontractors.map((i,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.company_name}),e.jsx("td",{children:i.description}),e.jsx("td",{children:i.source_reference||i.source_type}),e.jsx("td",{className:"text-right",children:b(i.total)})]},f))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.subcontractors_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"2",className:"text-right",children:["+ ",B(r.subcontractors_markup_percent||500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.subcontractors_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"2",className:"text-right",children:e.jsx("strong",{children:"Subcontractors Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:b(w.subcontractors_subtotal+w.subcontractors_markup_amount)})})]})]})]})})]}),$.length>0&&(()=>{const i=$.reduce((d,P)=>d+(P.t_and_m_workers?.reduce((X,ee)=>X+(parseFloat(ee.hours)||0),0)||0),0),f=$.reduce((d,P)=>d+(P.t_and_m_workers?.reduce((X,ee)=>X+(parseFloat(ee.overtime_hours)||0),0)||0),0),_=$.reduce((d,P)=>d+(P.photos?.length||0),0),h=$.filter(d=>d.client_signature_data).length;return e.jsxs("div",{className:"cor-section cor-backup-section",children:[e.jsxs("div",{className:"backup-official-header",children:[e.jsxs("div",{className:"backup-official-badge",children:[e.jsx(_e,{size:16}),e.jsx("span",{children:"Supporting Documentation"})]}),e.jsxs("div",{className:"backup-summary-bar",children:[e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:$.length}),e.jsx("span",{className:"backup-stat-label",children:"Tickets"})]}),e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:i.toFixed(1)}),e.jsx("span",{className:"backup-stat-label",children:"Labor Hrs"})]}),f>0&&e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:f.toFixed(1)}),e.jsx("span",{className:"backup-stat-label",children:"OT Hrs"})]}),e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:_}),e.jsx("span",{className:"backup-stat-label",children:"Photos"})]}),h>0&&e.jsxs("div",{className:"backup-stat verified",children:[e.jsx("span",{className:"backup-stat-value",children:h}),e.jsx("span",{className:"backup-stat-label",children:"Verified"})]})]})]}),e.jsxs("div",{className:"cor-section-header cor-backup-header",onClick:()=>H(!U),style:{cursor:"pointer",marginBottom:U?"1rem":0},children:[e.jsx("div",{className:"backup-header-left",children:e.jsx("span",{children:"View All T&M Tickets"})}),e.jsx("div",{className:"backup-header-toggle",children:U?e.jsx(Ne,{size:20}):e.jsx(ve,{size:20})})]}),U&&e.jsx("div",{className:"backup-tickets-list",style:{padding:"0 0.5rem"},children:$.map(d=>{const P=q.has(d.id),X=d.t_and_m_workers?.reduce((v,A)=>v+(parseFloat(A.hours)||0),0)||0,ee=d.t_and_m_workers?.reduce((v,A)=>v+(parseFloat(A.overtime_hours)||0),0)||0,J=!!d.client_signature_data;return e.jsxs("div",{className:"backup-ticket-pro","data-verified":J,"data-status":d.status||"pending",children:[e.jsxs("div",{className:"ticket-pro-header",onClick:()=>{const v=new Set(q);P?v.delete(d.id):v.add(d.id),K(v)},style:{cursor:"pointer"},children:[e.jsxs("div",{className:"ticket-date-badge",children:[e.jsx(Pe,{size:14}),e.jsx("span",{children:re(d.work_date)})]}),d.ce_pco_number&&e.jsx("span",{className:"ticket-pco-badge",children:d.ce_pco_number}),J&&e.jsxs("span",{className:"ticket-verified-seal",children:[e.jsx(Z,{size:12})," Verified"]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-muted)"},children:[d.t_and_m_workers?.length||0," workers • ",X+ee," hrs"]}),P?e.jsx(Ne,{size:16}):e.jsx(ve,{size:16})]})]}),P&&e.jsxs("div",{className:"ticket-pro-body",children:[d.notes&&e.jsx("div",{className:"ticket-description-box",children:e.jsx("p",{children:d.notes})}),d.t_and_m_workers?.length>0&&e.jsxs("div",{className:"ticket-section-pro",children:[e.jsxs("div",{className:"ticket-section-header",children:[e.jsx(pe,{size:14}),e.jsx("span",{children:"Labor"}),e.jsxs("span",{className:"section-count",children:[X+ee," hrs total"]})]}),e.jsx("div",{className:"worker-pro-grid",children:d.t_and_m_workers.map((v,A)=>e.jsxs("div",{className:"worker-pro-row",children:[e.jsxs("div",{children:[e.jsx("span",{className:"worker-name",children:v.name}),v.role&&e.jsxs("span",{className:"worker-role",children:[" • ",v.role]})]}),e.jsx("span",{className:"worker-time",children:v.time_started&&v.time_ended?`${ce(v.time_started)} - ${ce(v.time_ended)}`:"-"}),e.jsxs("span",{className:"worker-hours",children:[v.hours||0," hrs"]}),e.jsx("span",{className:"worker-ot",children:parseFloat(v.overtime_hours)>0?`+${v.overtime_hours} OT`:"-"})]},A))})]}),d.t_and_m_items?.length>0&&e.jsxs("div",{className:"ticket-section-pro",children:[e.jsxs("div",{className:"ticket-section-header",children:[e.jsx(me,{size:14}),e.jsx("span",{children:"Materials / Equipment"}),e.jsxs("span",{className:"section-count",children:[d.t_and_m_items.length," items"]})]}),e.jsx("div",{className:"materials-pro-list",children:d.t_and_m_items.map((v,A)=>e.jsxs("div",{className:"material-pro-row",children:[e.jsx("span",{className:"material-name",children:v.materials_equipment?.name||v.description||"Item"}),e.jsxs("span",{className:"material-qty",children:[v.quantity||1," ",v.materials_equipment?.unit||"ea"]}),e.jsx("span",{className:"material-source",children:"T&M Ticket"})]},A))})]}),d.photos?.length>0&&e.jsxs("div",{className:"ticket-section-pro",children:[e.jsxs("div",{className:"ticket-section-header",children:[e.jsx(be,{size:14}),e.jsx("span",{children:"Photo Evidence"}),e.jsx("span",{className:"section-count",children:d.photos.length})]}),e.jsx("div",{className:"photo-evidence-grid",children:d.photos.map((v,A)=>e.jsx("a",{href:v,target:"_blank",rel:"noopener noreferrer",className:"photo-evidence-item",children:e.jsx("img",{src:v,alt:`Evidence ${A+1}`,onError:le=>{le.target.onerror=null,le.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiI+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=="}})},A))})]}),J&&e.jsxs("div",{className:"ticket-verification-footer",children:[e.jsx("div",{className:"verification-seal-icon",children:e.jsx(Z,{size:22})}),d.client_signature_data&&e.jsx("img",{src:d.client_signature_data,alt:"Client Signature",className:"verification-signature-img"}),e.jsxs("div",{className:"verification-info",children:[e.jsx("span",{className:"signer-name",children:d.client_signature_name||"Client"}),(d.client_signature_title||d.client_signature_company)&&e.jsx("span",{className:"signer-title",children:[d.client_signature_title,d.client_signature_company].filter(Boolean).join(", ")}),d.client_signature_date&&e.jsxs("span",{className:"verify-date",children:["Verified ",re(d.client_signature_date)]})]})]})]})]},d.id)})}),e.jsxs("div",{className:"backup-note",children:[e.jsx(fe,{size:14}),e.jsx("span",{children:"This documentation supports the work described in this Change Order Request."})]})]})})(),e.jsxs("div",{className:"cor-totals-card",children:[e.jsx("h4",{children:"COR Summary"}),e.jsxs("div",{className:"cor-totals-grid",children:[e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:b(w.cor_subtotal)})]}),e.jsxs("div",{className:"cor-fees-section",children:[e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Liability Insurance (",B(r.liability_insurance_percent||144),")"]}),e.jsx("span",{children:b(w.liability_insurance_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Bond (",B(r.bond_percent||100),")"]}),e.jsx("span",{children:b(w.bond_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["City License Fee (",B(r.license_fee_percent||10),")"]}),e.jsx("span",{children:b(w.license_fee_amount)})]})]}),e.jsxs("div",{className:"cor-grand-total",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:b(w.cor_total)})]})]})]}),e.jsxs("div",{className:"cor-signature-section",children:[e.jsx("h4",{children:"Authorization"}),e.jsx("p",{className:"signature-instruction",children:"By signing below, you authorize the above change order request and agree to the terms and costs outlined."}),e.jsx("div",{className:"signature-slots-grid",children:O?e.jsxs(e.Fragment,{children:[u&&e.jsxs("div",{className:"signature-slot-card signed",children:[e.jsxs("div",{className:"slot-header",children:[e.jsx(Z,{size:20,className:"status-icon signed"}),e.jsx("span",{className:"slot-label",children:"GC Authorization"})]}),e.jsxs("div",{className:"slot-signed-info",children:[u.signature_data&&e.jsx("img",{src:u.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:u.signer_name}),(u.signer_title||u.signer_company)&&e.jsxs("span",{className:"signer-org",children:[u.signer_title,u.signer_title&&u.signer_company&&" — ",u.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",re(u.signed_at)]})]})]}),S&&e.jsxs("div",{className:"signature-slot-card signed",children:[e.jsxs("div",{className:"slot-header",children:[e.jsx(Z,{size:20,className:"status-icon signed"}),e.jsx("span",{className:"slot-label",children:"Client Authorization"})]}),e.jsxs("div",{className:"slot-signed-info",children:[S.signature_data&&e.jsx("img",{src:S.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:S.signer_name}),(S.signer_title||S.signer_company)&&e.jsxs("span",{className:"signer-org",children:[S.signer_title,S.signer_title&&S.signer_company&&" — ",S.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",re(S.signed_at)]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`signature-slot-card ${u?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[u?e.jsx(Z,{size:20,className:"status-icon signed"}):e.jsx(ge,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"GC Authorization"})]}),e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>W(1),disabled:s,children:"Sign as GC"})]}),e.jsx("p",{className:"or-divider",children:"— or —"}),e.jsxs("div",{className:`signature-slot-card ${S?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[S?e.jsx(Z,{size:20,className:"status-icon signed"}):e.jsx(ge,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Client Authorization"})]}),e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>W(2),disabled:s,children:"Sign as Client"})]})]})}),O&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Z,{size:24}),e.jsx("p",{children:"This change order request has been signed."})]}),e.jsxs("div",{className:"cor-download-section",children:[e.jsx("h4",{children:"Download Your Copy"}),e.jsx("p",{className:"download-description",children:O?"Download a PDF copy of this fully signed COR including all T&M backup documentation.":"Download a PDF copy of this COR for your records. Signature status will be included."}),e.jsx("button",{className:"btn btn-primary download-btn",onClick:V,disabled:F,children:F?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"download-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:18}),"Download COR + Backup"]})})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),t&&D&&e.jsx(ye,{slot:D,documentType:p.document_type,documentTitle:`${r.cor_number} - ${r.title}`,onSave:G,onClose:()=>{N(!1),n(null)}})]})}function de(l,j,y,C,a){return e.jsxs("div",{className:`signature-slot-card ${j?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[j?e.jsx(Z,{size:20,className:"status-icon signed"}):e.jsx(ge,{size:20,className:"status-icon pending"}),e.jsxs("span",{className:"slot-label",children:["Signature ",l," — ",y]})]}),j?e.jsxs("div",{className:"slot-signed-info",children:[e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:j.signer_name}),(j.signer_title||j.signer_company)&&e.jsxs("span",{className:"signer-org",children:[j.signer_title,j.signer_title&&j.signer_company&&" — ",j.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",re(j.signed_at)]})]}):e.jsxs("button",{className:"btn btn-primary sign-btn",onClick:()=>C(l),disabled:a,children:["Sign as ",l===1?"GC":"Client"]})]})}export{et as default};
