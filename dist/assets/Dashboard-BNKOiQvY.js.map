{"version":3,"mappings":"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","names":["ErrorSeverity","ErrorCategory","categorizeError","error","message","code","getUserMessage","category","context","handleError","options","operation","severity","showToast","userMessage","companyId","projectId","userId","silent","rethrow","observe","toastType","safeAsync","fn","fallback","DEFAULT_THRESHOLDS","FACTOR_WEIGHTS","calculateFactorScore","value","thresholds","range","getFactorStatus","score","calculateBudgetFactor","totalCosts","earnedRevenue","ratio","status","label","calculateScheduleFactor","actualProgress","expectedProgress","variance","absVariance","calculateCORExposureFactor","pendingCORValue","contractValue","exposure","formatNumber","calculateActivityFactor","lastReportDate","lastDate","daysSince","calculateSafetyFactor","injuryCount","count","calculateRiskScore","project","weights","budgetFactor","scheduleFactor","corFactor","activityFactor","safetyFactor","compositeScore","overallStatus","summaryLabel","generateSmartAlerts","riskResult","alerts","factors","priorityOrder","a","b","calculateProjections","costPerPercent","estimatedCompletionCost","estimatedFinalMargin","estimatedCompletionDate","startDate","now","daysElapsed","progressPerDay","daysRemaining","num","usePortfolioMetrics","projectsData","portfolioMetrics","useMemo","totalOriginalContract","sum","p","totalChangeOrders","totalPortfolioValue","totalEarned","totalRemaining","weightedCompletion","totalPendingCORValue","totalPendingCORCount","projectHealth","complete","onTrack","atRisk","overBudget","withChangeOrders","contractVal","scheduleMetrics","ahead","behind","overLabor","underLabor","onTrackLabor","riskAnalysis","projectRisks","riskInput","projections","alertsWithProject","allAlerts","priority","useProjectEdit","selectedProject","areas","company","onShowToast","loadAreas","setSelectedProject","editMode","setEditMode","useState","editData","setEditData","saving","setSaving","field","prev","index","area","i","_","db","validAreas","existingAreaIds","editAreaIds","areaId","updatedProject","loadProjects","loadJsPDF","__vitePreload","n","PAGE_WIDTH","MARGIN","CONTENT_WIDTH","formatDate","dateStr","checkPage","doc","y","needed","exportDailyReportsPDF","reports","jsPDF","report","idx","statusText","metrics","crewNames","w","crewLines","noteLines","issueLines","fileName","exportIncidentReportsPDF","color","typeLabel","lines","exportCrewCheckinsPDF","checkins","checkin","workers","exportAllFieldDocumentsPDF","dailyReports","incidentReports","crewCheckins","workerList","downloadFile","content","filename","mimeType","blob","url","escapeCSV","str","toCSV","headers","rows","headerLine","h","dataLines","row","exportProjectFinancials","financialData","cor","d","c","totalRevenue","r","s","csv","exportCORDetail","item","regHrs","otHrs","exportTMTicketsCSV","tickets","t","items","totalHours","otHours","materialsCost","exportToQuickBooksIIF","txnDate","totalLabor","totalDisposal","UniversalSearch","isOpen","onClose","onSelectProject","onSelectTicket","onSelectCOR","query","setQuery","results","setResults","loading","setLoading","selectedIndex","setSelectedIndex","inputRef","useRef","searchTimeoutRef","focusTimeoutRef","useEffect","performSearch","useCallback","searchQuery","searchResults","handleInputChange","e","allResults","all","hasResults","handleKeyDown","handleSelect","jsx","jsxs","Search","X","Fragment","FolderOpen","globalIdx","ChevronRight","FileText","ticket","ClipboardList","Users","worker","Command","useUniversalSearch","setIsOpen","SmartAlerts","onAction","onDismiss","maxVisible","className","dismissedIds","setDismissedIds","visibleAlerts","alert","handleDismiss","alertId","SmartAlertCard","type","title","description","action","actionTarget","projectName","Icon","XCircle","AlertTriangle","Info","handleAction","ArrowRight","OverviewProgressGauge","memo","progress","areasComplete","totalAreas","areasWorking","size","strokeWidth","animatedProgress","setAnimatedProgress","animationRef","startValue","endValue","duration","startTime","animate","currentTime","elapsed","progressRatio","eased","current","radius","circumference","offset","getProgressColor","chartColors","animationConfig","tooltipStyle","costCategories","timeRanges","formatChartCurrency","formatChartDate","gradientDefs","OverviewFinancialCard","laborCost","disposalCost","equipmentCost","otherCost","profit","margin","isPositive","formatCurrency","costBreakdown","hasBreakdown","widthPercent","CREW_COLORS","TIME_RANGES","OverviewCrewMetrics","crewHistory","setCrewHistory","tmTickets","setTmTickets","selectedDate","setSelectedDate","timeRange","setTimeRange","exporting","setExporting","loadData","history","tmWorkersByDate","map","date","crewByDate","selectedDayWorkers","selectedDayTmNames","todayMetrics","contract","tm","chartData","rangeDays","data","today","tmNames","contractCount","tmCount","changeDate","direction","isToday","handleBarClick","CustomTooltip","active","payload","total","exportCrewPDF","pageWidth","day","footerY","Download","ChevronLeft","Calendar","HardHat","Wrench","ResponsiveContainer","BarChart","CartesianGrid","XAxis","YAxis","Tooltip","Legend","Bar","Skeleton","width","height","borderRadius","variant","variantStyles","showProgress","CardSkeleton","showHeader","showAction","showAvatar","TicketSkeleton","HeroMetricsSkeleton","ErrorState","onRetry","retryLabel","CustomIcon","WifiOff","RefreshCw","EmptyState","actionLabel","required","hint","children","AlertCircle","onChange","onBlur","placeholder","disabled","min","max","step","pattern","autoComplete","name","id","ariaLabel","ariaDescribedBy","inputId","errorId","selectId","maxLength","textareaId","CountBadge","pulse","prevCount","setPrevCount","animating","setAnimating","timer","MiniProgress","showLabel","animated","percentage","autoVariant","TrendIndicator","previousValue","format","inverted","showValue","diff","percentChange","TrendingUp","TrendingDown","Minus","formatValue","absChange","showArea","points","x","areaPoints","icons","Check","Clock","previous","delta","isNegative","val","showCloseButton","closeOnOverlayClick","closeOnEscape","footer","modalRef","previousActiveElement","titleId","originalOverflow","focusableElements","firstElement","lastElement","handleOverlayClick","sizeClasses","amount","MetricCard","formattedValue","subLabel","progressLabel","trend","variantColors","HeroMetrics","corApprovedValue","previousData","revisedContract","profitMargin","costRatio","revenueProgress","costProgress","profitVariant","costVariant","DollarSign","Receipt","PiggyBank","NAV_ITEMS","BarChart3","FinancialsNav","activeSection","onSectionChange","collapsed","onToggleCollapse","onMobileClose","stats","corCount","ticketCount","corPending","ticketPending","billableCount","invoiceCount","getBadge","itemId","PanelLeftOpen","isActive","badge","showConnector","buildFinancialTimeSeries","projectData","corStats","laborByDate","haulOffByDate","materialsEquipmentByDate","customCosts","dateSet","sortedDates","revenueByDate","totalWeight","completionDate","areaWeight","areaValue","cumulativeCost","cumulativeTMValue","tmByDate","ticketValue","regHours","regRate","otRate","qty","unitCost","customByDate","cost","materialsEquipmentByDateMap","cumulativeRevenue","haulOffCost","materialsEquipmentCost","customCost","dailyTotalCost","tmDayValue","dailyRevenue","revenue","filterByTimeRange","days","cutoff","buildCostDistribution","segments","grouped","cat","catConfig","calculateTrend","key","recent","first","last","change","ChartTooltip","FinancialTrendChart","onDrillDown","hoveredLine","setHoveredLine","allData","selectedRange","costsTrend","revenueTrend","handleClick","point","TrendIcon","AreaChart","grad","ReferenceLine","Area","CostDonut","onSegmentClick","activeIndex","setActiveIndex","totalCost","handleMouseEnter","handleMouseLeave","renderLegend","props","entry","PieChart","Pie","Cell","ProfitabilityCard","currentProfit","currentMargin","projectedRevenue","projectedCosts","projectedProfit","projectedMargin","isHealthy","isWarning","isLoss","statusLabel","StatusIcon","CheckCircle","categoryInfo","Truck","Package","MoreHorizontal","CostContributorsCard","onAddCost","onDeleteCost","showChart","setShowChart","expandedCategory","setExpandedCategory","customByCategory","group","info","toggleCategory","handleSegmentClick","segment","hasItems","isExpanded","ChevronUp","ChevronDown","Trash2","Plus","LOAD_TYPES","getLoadTypeInfo","DisposalSummary","period","loads","setLoads","expanded","setExpanded","err","loadsByType","acc","load","loadsByDate","totalLoads","l","hasLoads","formattedDate","dayLoadsByType","typeInfo","ProjectEquipmentCard","onAddEquipment","onEditEquipment","projectEquipment","setProjectEquipment","setTotalCost","loadEquipment","equipmentOps","handleMarkReturned","equipmentItem","handleDelete","activeEquipment","returnedEquipment","RotateCcw","Edit2","ProgressBillingCard","onCreateDraw","onViewDraw","drawRequests","setDrawRequests","originalContract","approvedCOs","loadDrawRequests","drawRequestOps","billingTotals","completedDraws","dr","billedToDate","retentionHeld","nextDrawNumber","getStatusBadge","FileSpreadsheet","ManDayCosts","costData","setCostData","loadCostData","subscription","getRoleLabel","role","roleEntries","BurnRateCard","dailyBurn","totalBurn","daysWorked","expectedBurnAtProgress","burnStatus","projectedTotalCost","combinedByDate","dateMap","maxDailyCost","Flame","DailyReportsList","branding","useBranding","setReports","setError","expandedReport","setExpandedReport","selectedReports","setSelectedReports","selectMode","setSelectMode","viewMode","setViewMode","expandedMonths","setExpandedMonths","dateFilter","setDateFilter","loadReports","filteredReports","filtered","endDate","sevenDaysAgo","reportsByMonth","groups","monthKey","monthLabel","currentMonthKey","toggleSelectMode","toggleReportSelection","reportId","newSelection","toggleSelectAll","toggleMonthExpand","newExpanded","getExportReports","formatTime","getStatusIcon","getStatusLabel","exportToPDF","exportReports","yPos","primaryColor","hexToRgb","secondaryColor","logoOffset","logoBase64","loadImageAsBase64","pageCount","renderReportCard","task","totalReports","recentCount","monthReports","InjuryReportCard","getInjuryTypeColor","getInjuryTypeLabel","getStatusColor","onViewDetails","InjuryReportsList","user","selectedReport","setSelectedReport","showForm","setShowForm","toast","setToast","effectiveCompanyId","handleReportCreated","handleViewDetails","handleCloseDetails","dateString","timeString","typeColor","descLines","details","monthData","witness","InjuryReportForm","Toast","PROJECT_ROLE_OPTIONS","ProjectTeam","isAdmin","teamMembers","setTeamMembers","companyMembers","setCompanyMembers","showAddModal","setShowAddModal","selectedUser","setSelectedUser","selectedRole","setSelectedRole","actionLoading","setActionLoading","loadProjectTeam","loadCompanyMembers","existingUserIds","available","m","handleAddMember","handleUpdateRole","member","newRole","handleRemoveMember","UserPlus","UserMinus","MFASetup","setStep","setFactors","qrCode","setQrCode","secret","setSecret","factorId","setFactorId","verifyCode","setVerifyCode","verifying","setVerifying","copied","setCopied","loadFactors","supabase","totpFactors","f","startEnrollment","verifyEnrollment","challenge","challengeError","verifyError","unenroll","copySecret","isEnabled","ShieldCheck","Shield","Loader2","ShieldOff","Copy","calculateEarnedValue","changeOrderValue","progressPercent","actualCosts","bac","earnedValue","plannedValue","calculatePlannedValue","actualCost","cpi","spi","costVariance","scheduleVariance","eac","etc","vac","remainingWork","remainingBudget","tcpi","projectedEndDate","calculateProjectedEndDate","healthStatus","getHealthStatus","roundTo","calculatePercentScheduled","getCPILabel","getSPILabel","start","end","totalDuration","adjustedDays","decimals","factor","generateSCurveData","totalDays","numPoints","fraction","pointDate","pv","isPast","isCurrent","timePercent","EarnedValueCard","ev","sCurveData","statusColors","statusColor","Target","LineChart","Line","ShareModal","lazy","NotificationSettings","CORForm","CORDetail","CORLog","DrawRequestModal","EquipmentModal","AddCostModal","DocumentsTab","CORLogPreview","CORList","TMList","BillingCenter","PhotoTimeline","PunchList","Dashboard","navigateToProjectId","onProjectNavigated","projects","setProjects","setProjectsData","setAreas","showShareModal","setShowShareModal","showNotificationSettings","setShowNotificationSettings","activeProjectTab","setActiveProjectTab","financialsSection","setFinancialsSection","financialsSidebarCollapsed","setFinancialsSidebarCollapsed","financialsSidebarMobileOpen","setFinancialsSidebarMobileOpen","corListExpanded","setCORListExpanded","corDisplayMode","setCORDisplayMode","tmViewMode","setTMViewMode","dumpSites","setDumpSites","showCORForm","setShowCORForm","editingCOR","setEditingCOR","showCORDetail","setShowCORDetail","viewingCOR","setViewingCOR","corRefreshKey","setCORRefreshKey","showAddCostModal","setShowAddCostModal","savingCost","setSavingCost","showEquipmentModal","setShowEquipmentModal","editingEquipment","setEditingEquipment","equipmentRefreshKey","setEquipmentRefreshKey","showDrawRequestModal","setShowDrawRequestModal","editingDrawRequest","setEditingDrawRequest","drawRequestRefreshKey","setDrawRequestRefreshKey","isSearchOpen","setSearchOpen","closeSearch","handleEditClick","handleCancelEdit","handleEditChange","handleAreaEditChange","handleAddArea","handleRemoveArea","handleSaveEdit","handleDeleteProject","refreshTimeoutRef","pendingAreasRefreshRef","pendingCORRefreshRef","projectDetailsCacheRef","CACHE_TTL_MS","debouncedRefresh","refreshAreas","refreshCOR","loadDumpSites","projectIdsRef","projectIdsKey","currentIds","sites","lastNavigatedIdRef","subscriptions","areasSub","dailyReportsSub","checkinsSub","haulOffsSub","corsSub","sub","loadProjectDetails","forceRefresh","cacheKey","cached","projectAreas","changeOrderData","injuryReports","laborCosts","haulOffCosts","materialRequests","weeklyDisposal","progressData","calculateValueProgress","revisedContractValue","billable","pendingTickets","oneWeekAgo","recentDailyReports","customCostTotal","ticketDate","ticketMaterialsCost","materialsEquipmentByDateArray","allCostsTotal","laborDays","materialsDays","totalBurnDays","scheduleInsights","calculateScheduleInsights","uniqueWorkers","crewDates","avgCrewSize","peakCrewSize","recentCrewDates","priorCrewDates","recentCrewAvg","priorCrewAvg","pendingMaterialRequests","orderedMaterialRequests","deliveredMaterialRequests","urgentMaterialRequests","reportsWithIssues","totalPhotosFromTickets","disposalTotalLoads","lastInjuryDate","daysSinceLastInjury","completedAreas","enhancedData","enhanced","handleSelectProject","detailedProject","handleBack","progressCalculations","handleAlertAction","target","checkAutoArchive","shouldAutoArchive","handleAddEquipment","handleEditEquipment","handleCreateDraw","handleViewDraw","drawRequest","handleViewAllTickets","handleToggleFinancialsSidebar","handleToggleMobileSidebar","handleCloseMobileSidebar","handleToggleCORList","handleExportFieldDocuments","handleBackToTMPreview","handleViewFullCORLog","handleCreateCOR","handleViewCOR","handleEditCOR","handleAddCost","handleDeleteCost","costId","financialsNavStats","projectsComplete","projectsOnTrack","projectsAtRisk","projectsOverBudget","projectsWithChangeOrders","scheduleAhead","scheduleOnTrack","scheduleBehind","laborOver","laborUnder","laborOnTrack","hasAnyScheduleData","hasAnyLaborData","isValueBased","totalSOVValue","site","areasNotStarted","pendingCount","tabs","LayoutGrid","tab","Suspense","Menu","section","CheckCircle2","req","week","maxWeek","Camera","MapPin","Building2","Phone","share","projectRisk","EnhancedProjectCard","riskScore","riskStatus","onClick","getOverallStatus","getOverallStatusLabel","isAtRisk","riskColors","riskStyle"],"ignoreList":[],"sources":["../../src/lib/errorHandler.js","../../src/lib/riskCalculations.js","../../src/hooks/usePortfolioMetrics.js","../../src/hooks/useProjectEdit.js","../../src/lib/fieldDocumentExport.js","../../src/lib/financialExport.js","../../src/components/UniversalSearch.jsx","../../src/components/dashboard/SmartAlerts.jsx","../../src/components/overview/OverviewProgressGauge.jsx","../../src/components/charts/chartConfig.js","../../src/components/overview/OverviewFinancialCard.jsx","../../src/components/overview/OverviewCrewMetrics.jsx","../../src/components/ui/Skeleton.jsx","../../src/components/ui/ErrorState.jsx","../../src/components/ui/FormField.jsx","../../src/components/ui/MicroVis.jsx","../../src/components/ui/Modal.jsx","../../src/components/HeroMetrics.jsx","../../src/components/FinancialsNav.jsx","../../src/lib/chartDataTransforms.js","../../src/components/charts/ChartTooltip.jsx","../../src/components/charts/FinancialTrendChart.jsx","../../src/components/charts/CostDonut.jsx","../../src/components/ProfitabilityCard.jsx","../../src/components/CostContributorsCard.jsx","../../src/components/DisposalSummary.jsx","../../src/components/equipment/ProjectEquipmentCard.jsx","../../src/components/billing/ProgressBillingCard.jsx","../../src/components/ManDayCosts.jsx","../../src/components/BurnRateCard.jsx","../../src/components/DailyReportsList.jsx","../../src/components/InjuryReportCard.jsx","../../src/components/InjuryReportsList.jsx","../../src/components/ProjectTeam.jsx","../../src/components/MFASetup.jsx","../../src/lib/earnedValueCalculations.js","../../src/components/charts/EarnedValueCard.jsx","../../src/components/Dashboard.jsx"],"sourcesContent":["/**\n * FieldSync Error Handling Utility\n *\n * Centralized error handling with proper logging, user feedback, and recovery.\n * Eliminates silent failures and provides consistent error handling patterns.\n *\n * Usage:\n *   import { handleError, withErrorHandling, safeAsync } from './errorHandler'\n *\n *   // Wrap async operations\n *   const data = await safeAsync(\n *     () => db.getTMTickets(projectId),\n *     { fallback: [], context: { operation: 'getTMTickets', projectId } }\n *   )\n *\n *   // Handle errors with toast\n *   try { ... } catch (error) {\n *     handleError(error, { operation: 'saveTicket', showToast: onShowToast })\n *   }\n */\n\nimport { observe } from './observability'\n\n// Error severity levels\nexport const ErrorSeverity = {\n  INFO: 'info',\n  WARNING: 'warning',\n  ERROR: 'error',\n  CRITICAL: 'critical'\n}\n\n// Error categories\nexport const ErrorCategory = {\n  DATABASE: 'database',\n  NETWORK: 'network',\n  AUTH: 'auth',\n  VALIDATION: 'validation',\n  STORAGE: 'storage',\n  SYNC: 'sync',\n  GENERAL: 'general'\n}\n\n/**\n * Determine error category from error object\n */\nfunction categorizeError(error) {\n  const message = error?.message?.toLowerCase() || ''\n  const code = error?.code?.toLowerCase() || ''\n\n  if (message.includes('fetch') || message.includes('network') || message.includes('offline')) {\n    return ErrorCategory.NETWORK\n  }\n  if (message.includes('auth') || message.includes('unauthorized') || code.includes('auth')) {\n    return ErrorCategory.AUTH\n  }\n  if (message.includes('storage') || message.includes('bucket') || message.includes('upload')) {\n    return ErrorCategory.STORAGE\n  }\n  if (message.includes('validation') || message.includes('invalid') || message.includes('required')) {\n    return ErrorCategory.VALIDATION\n  }\n  if (message.includes('sync') || message.includes('conflict')) {\n    return ErrorCategory.SYNC\n  }\n  if (error?.code || message.includes('database') || message.includes('supabase')) {\n    return ErrorCategory.DATABASE\n  }\n\n  return ErrorCategory.GENERAL\n}\n\n/**\n * Get user-friendly error message\n */\nfunction getUserMessage(error, category, context) {\n  // Custom message provided\n  if (context?.userMessage) {\n    return context.userMessage\n  }\n\n  // Network errors\n  if (category === ErrorCategory.NETWORK) {\n    return 'Network connection issue. Your changes will sync when back online.'\n  }\n\n  // Auth errors\n  if (category === ErrorCategory.AUTH) {\n    return 'Session expired. Please sign in again.'\n  }\n\n  // Storage errors\n  if (category === ErrorCategory.STORAGE) {\n    return 'Failed to upload file. Please try again.'\n  }\n\n  // Validation errors - show actual message\n  if (category === ErrorCategory.VALIDATION) {\n    return error?.message || 'Please check your input and try again.'\n  }\n\n  // Sync errors\n  if (category === ErrorCategory.SYNC) {\n    return 'Sync conflict detected. Please refresh and try again.'\n  }\n\n  // Database/general errors with operation context\n  if (context?.operation) {\n    const operation = context.operation.replace(/([A-Z])/g, ' $1').toLowerCase().trim()\n    return `Failed to ${operation}. Please try again.`\n  }\n\n  return 'Something went wrong. Please try again.'\n}\n\n/**\n * Main error handler\n *\n * @param {Error} error - The error object\n * @param {Object} options - Error handling options\n * @param {string} options.operation - Name of the operation that failed\n * @param {string} options.category - Error category (auto-detected if not provided)\n * @param {string} options.severity - Error severity (default: 'error')\n * @param {Function} options.showToast - Toast function to show user feedback\n * @param {string} options.userMessage - Custom user-facing message\n * @param {string} options.companyId - Company ID for context\n * @param {string} options.projectId - Project ID for context\n * @param {string} options.userId - User ID for context\n * @param {boolean} options.silent - If true, don't show toast (still logs)\n * @param {boolean} options.rethrow - If true, rethrow the error after handling\n */\nexport function handleError(error, options = {}) {\n  const {\n    operation = 'unknown',\n    category = categorizeError(error),\n    severity = ErrorSeverity.ERROR,\n    showToast,\n    userMessage,\n    companyId,\n    projectId,\n    userId,\n    silent = false,\n    rethrow = false\n  } = options\n\n  // Log to observability system\n  observe.error(category, {\n    message: error?.message || 'Unknown error',\n    code: error?.code,\n    severity,\n    operation,\n    company_id: companyId,\n    project_id: projectId,\n    user_id: userId,\n    extra: {\n      stack: error?.stack,\n      name: error?.name\n    }\n  })\n\n  // Show user feedback unless silent\n  if (!silent && showToast) {\n    const message = getUserMessage(error, category, { operation, userMessage })\n    const toastType = severity === ErrorSeverity.WARNING ? 'warning' : 'error'\n    showToast(message, toastType)\n  }\n\n  // Rethrow if requested\n  if (rethrow) {\n    throw error\n  }\n\n  return null\n}\n\n/**\n * Safe async wrapper - executes async function with error handling\n * Returns fallback value on error instead of throwing\n *\n * @param {Function} fn - Async function to execute\n * @param {Object} options - Options\n * @param {any} options.fallback - Value to return on error (default: null)\n * @param {Object} options.context - Context for error logging\n * @param {Function} options.showToast - Toast function\n * @param {boolean} options.silent - Don't show toast on error\n */\nexport async function safeAsync(fn, options = {}) {\n  const { fallback = null, context = {}, showToast, silent = true } = options\n\n  try {\n    return await fn()\n  } catch (error) {\n    handleError(error, {\n      ...context,\n      showToast,\n      silent\n    })\n    return fallback\n  }\n}\n\n/**\n * Higher-order function to wrap async functions with error handling\n *\n * @param {Function} fn - Async function to wrap\n * @param {Object} defaultOptions - Default error handling options\n */\nexport function withErrorHandling(fn, defaultOptions = {}) {\n  return async function(...args) {\n    try {\n      return await fn.apply(this, args)\n    } catch (error) {\n      handleError(error, defaultOptions)\n      return defaultOptions.fallback ?? null\n    }\n  }\n}\n\n/**\n * Create a safe version of a database operation\n * Logs errors and returns fallback instead of throwing\n *\n * @param {string} operation - Operation name for logging\n * @param {any} fallback - Fallback value on error\n */\nexport function createSafeOperation(operation, fallback = null) {\n  return (fn) => async (...args) => {\n    try {\n      return await fn(...args)\n    } catch (error) {\n      observe.error(ErrorCategory.DATABASE, {\n        message: error?.message || 'Unknown error',\n        operation,\n        severity: ErrorSeverity.ERROR\n      })\n      return fallback\n    }\n  }\n}\n\n/**\n * Batch multiple async operations with individual error handling\n * Returns results array with nulls for failed operations\n *\n * @param {Array<{fn: Function, fallback: any, context: Object}>} operations\n */\nexport async function safeBatch(operations) {\n  return Promise.all(\n    operations.map(({ fn, fallback = null, context = {} }) =>\n      safeAsync(fn, { fallback, context, silent: true })\n    )\n  )\n}\n\n/**\n * Retry wrapper for flaky operations\n *\n * @param {Function} fn - Async function to retry\n * @param {Object} options - Retry options\n * @param {number} options.maxRetries - Max retry attempts (default: 3)\n * @param {number} options.baseDelay - Base delay in ms (default: 1000)\n * @param {Function} options.shouldRetry - Function to determine if error is retryable\n */\nexport async function withRetry(fn, options = {}) {\n  const {\n    maxRetries = 3,\n    baseDelay = 1000,\n    shouldRetry = (error) => {\n      const message = error?.message?.toLowerCase() || ''\n      return message.includes('network') || message.includes('fetch') || message.includes('timeout')\n    }\n  } = options\n\n  let lastError\n\n  for (let attempt = 0; attempt < maxRetries; attempt++) {\n    try {\n      return await fn()\n    } catch (error) {\n      lastError = error\n\n      if (!shouldRetry(error) || attempt === maxRetries - 1) {\n        throw error\n      }\n\n      // Exponential backoff\n      const delay = baseDelay * Math.pow(2, attempt)\n      await new Promise(resolve => setTimeout(resolve, delay))\n    }\n  }\n\n  throw lastError\n}\n\nexport default {\n  handleError,\n  safeAsync,\n  withErrorHandling,\n  createSafeOperation,\n  safeBatch,\n  withRetry,\n  ErrorSeverity,\n  ErrorCategory\n}\n","/**\n * Risk Score Calculation Engine\n *\n * Calculates a composite risk score (0-100) for projects\n * based on multiple factors. Lower score = healthier project.\n *\n * Factors and weights:\n * - Budget Health: 30% - Cost ratio vs earned revenue\n * - Schedule Health: 25% - Progress vs expected progress\n * - COR Exposure: 20% - Pending COR value as % of contract\n * - Activity Cadence: 15% - Days since last daily report\n * - Safety Status: 10% - Recent injury reports\n */\n\n// Default thresholds (can be overridden per company)\nexport const DEFAULT_THRESHOLDS = {\n  budget: {\n    healthy: 0.60,   // Green if costs < 60% of revenue\n    warning: 0.75,   // Yellow if 60-75%\n    critical: 0.85   // Red if > 85%\n  },\n  schedule: {\n    healthy: 0.05,   // Green if within 5% of plan\n    warning: 0.15,   // Yellow if 5-15% behind\n    critical: 0.25   // Red if > 25% behind\n  },\n  corExposure: {\n    healthy: 0.05,   // Green if pending CORs < 5% of contract\n    warning: 0.15,   // Yellow if 5-15%\n    critical: 0.25   // Red if > 25%\n  },\n  activity: {\n    healthy: 1,      // Green if report within 1 day\n    warning: 3,      // Yellow if 2-3 days\n    critical: 5      // Red if > 5 days\n  },\n  safety: {\n    healthy: 0,      // Green if 0 incidents in 30 days\n    warning: 1,      // Yellow if 1 incident\n    critical: 2      // Red if 2+ incidents\n  }\n}\n\n// Factor weights (must sum to 1.0)\nexport const FACTOR_WEIGHTS = {\n  budget: 0.30,\n  schedule: 0.25,\n  corExposure: 0.20,\n  activity: 0.15,\n  safety: 0.10\n}\n\n/**\n * Calculate individual factor score (0-100)\n * 0 = healthy, 100 = critical\n */\nfunction calculateFactorScore(value, thresholds) {\n  if (value <= thresholds.healthy) return 0\n  if (value >= thresholds.critical) return 100\n\n  // Linear interpolation between healthy and critical\n  const range = thresholds.critical - thresholds.healthy\n  const excess = value - thresholds.healthy\n  return (excess / range) * 100\n}\n\n/**\n * Get status label for a factor score\n */\nfunction getFactorStatus(score) {\n  if (score <= 25) return 'healthy'\n  if (score <= 60) return 'warning'\n  return 'critical'\n}\n\n/**\n * Calculate budget health factor\n *\n * @param {number} totalCosts - Total costs to date\n * @param {number} earnedRevenue - Earned revenue to date\n * @param {object} thresholds - Custom thresholds (optional)\n */\nexport function calculateBudgetFactor(totalCosts, earnedRevenue, thresholds = DEFAULT_THRESHOLDS.budget) {\n  if (!earnedRevenue || earnedRevenue <= 0) {\n    // No revenue yet - can't calculate ratio\n    return { score: 0, status: 'healthy', ratio: 0, label: 'No revenue yet' }\n  }\n\n  const ratio = totalCosts / earnedRevenue\n\n  const score = calculateFactorScore(ratio, thresholds)\n  const status = getFactorStatus(score)\n\n  let label\n  if (ratio < thresholds.healthy) {\n    label = `Costs at ${(ratio * 100).toFixed(0)}% of revenue`\n  } else if (ratio < thresholds.warning) {\n    label = `Costs at ${(ratio * 100).toFixed(0)}% - monitor closely`\n  } else {\n    label = `Costs at ${(ratio * 100).toFixed(0)}% - review immediately`\n  }\n\n  return { score, status, ratio, label }\n}\n\n/**\n * Calculate schedule health factor\n *\n * @param {number} actualProgress - Actual completion percentage (0-100)\n * @param {number} expectedProgress - Expected completion percentage (0-100)\n * @param {object} thresholds - Custom thresholds (optional)\n */\nexport function calculateScheduleFactor(actualProgress, expectedProgress, thresholds = DEFAULT_THRESHOLDS.schedule) {\n  if (!expectedProgress || expectedProgress <= 0) {\n    // No schedule baseline - assume on track\n    return { score: 0, status: 'healthy', variance: 0, label: 'No schedule baseline' }\n  }\n\n  // Variance as a ratio (negative = behind)\n  const variance = (expectedProgress - actualProgress) / expectedProgress\n  const absVariance = Math.max(0, variance) // Only penalize being behind\n\n  const score = calculateFactorScore(absVariance, thresholds)\n  const status = getFactorStatus(score)\n\n  let label\n  if (variance <= 0) {\n    label = actualProgress >= 100 ? 'Complete' : 'On or ahead of schedule'\n  } else if (variance < thresholds.warning) {\n    label = `${(variance * 100).toFixed(0)}% behind schedule`\n  } else {\n    label = `${(variance * 100).toFixed(0)}% behind - needs attention`\n  }\n\n  return { score, status, variance, label }\n}\n\n/**\n * Calculate COR exposure factor\n *\n * @param {number} pendingCORValue - Total value of pending CORs\n * @param {number} contractValue - Total contract value\n * @param {object} thresholds - Custom thresholds (optional)\n */\nexport function calculateCORExposureFactor(pendingCORValue, contractValue, thresholds = DEFAULT_THRESHOLDS.corExposure) {\n  if (!contractValue || contractValue <= 0) {\n    return { score: 0, status: 'healthy', exposure: 0, label: 'No contract value' }\n  }\n\n  const exposure = pendingCORValue / contractValue\n\n  const score = calculateFactorScore(exposure, thresholds)\n  const status = getFactorStatus(score)\n\n  let label\n  if (exposure < thresholds.healthy) {\n    label = pendingCORValue > 0 ? `$${formatNumber(pendingCORValue)} pending` : 'No pending CORs'\n  } else if (exposure < thresholds.warning) {\n    label = `$${formatNumber(pendingCORValue)} pending (${(exposure * 100).toFixed(0)}% of contract)`\n  } else {\n    label = `High exposure: $${formatNumber(pendingCORValue)} (${(exposure * 100).toFixed(0)}%)`\n  }\n\n  return { score, status, exposure, label }\n}\n\n/**\n * Calculate activity cadence factor\n *\n * @param {Date|string} lastReportDate - Date of last daily report\n * @param {object} thresholds - Custom thresholds (optional)\n */\nexport function calculateActivityFactor(lastReportDate, thresholds = DEFAULT_THRESHOLDS.activity) {\n  if (!lastReportDate) {\n    return { score: 100, status: 'critical', daysSince: null, label: 'No reports filed' }\n  }\n\n  const lastDate = new Date(lastReportDate)\n  const now = new Date()\n  const daysSince = Math.floor((now - lastDate) / (1000 * 60 * 60 * 24))\n\n  const score = calculateFactorScore(daysSince, thresholds)\n  const status = getFactorStatus(score)\n\n  let label\n  if (daysSince === 0) {\n    label = 'Report filed today'\n  } else if (daysSince === 1) {\n    label = 'Report filed yesterday'\n  } else if (daysSince <= thresholds.warning) {\n    label = `Last report ${daysSince} days ago`\n  } else {\n    label = `No report in ${daysSince} days - may be stalled`\n  }\n\n  return { score, status, daysSince, label }\n}\n\n/**\n * Calculate safety factor\n *\n * @param {number} injuryCount - Number of injury reports in last 30 days\n * @param {object} thresholds - Custom thresholds (optional)\n */\nexport function calculateSafetyFactor(injuryCount, thresholds = DEFAULT_THRESHOLDS.safety) {\n  const count = injuryCount || 0\n\n  const score = calculateFactorScore(count, thresholds)\n  const status = getFactorStatus(score)\n\n  let label\n  if (count === 0) {\n    label = 'No incidents'\n  } else if (count === 1) {\n    label = '1 incident in last 30 days'\n  } else {\n    label = `${count} incidents - safety review needed`\n  }\n\n  return { score, status, count, label }\n}\n\n/**\n * Calculate composite risk score\n *\n * @param {object} project - Project data object\n * @param {object} options - Optional custom thresholds and weights\n * @returns {object} Risk score result with breakdown\n */\nexport function calculateRiskScore(project, options = {}) {\n  const thresholds = { ...DEFAULT_THRESHOLDS, ...options.thresholds }\n  const weights = { ...FACTOR_WEIGHTS, ...options.weights }\n\n  // Calculate individual factors\n  const budgetFactor = calculateBudgetFactor(\n    project.totalCosts,\n    project.earnedRevenue,\n    thresholds.budget\n  )\n\n  const scheduleFactor = calculateScheduleFactor(\n    project.actualProgress,\n    project.expectedProgress,\n    thresholds.schedule\n  )\n\n  const corFactor = calculateCORExposureFactor(\n    project.pendingCORValue,\n    project.contractValue,\n    thresholds.corExposure\n  )\n\n  const activityFactor = calculateActivityFactor(\n    project.lastReportDate,\n    thresholds.activity\n  )\n\n  const safetyFactor = calculateSafetyFactor(\n    project.recentInjuryCount,\n    thresholds.safety\n  )\n\n  // Calculate weighted composite score\n  const compositeScore = Math.round(\n    budgetFactor.score * weights.budget +\n    scheduleFactor.score * weights.schedule +\n    corFactor.score * weights.corExposure +\n    activityFactor.score * weights.activity +\n    safetyFactor.score * weights.safety\n  )\n\n  // Determine overall status\n  let overallStatus\n  if (compositeScore <= 25) {\n    overallStatus = 'healthy'\n  } else if (compositeScore <= 60) {\n    overallStatus = 'warning'\n  } else {\n    overallStatus = 'critical'\n  }\n\n  // Generate summary label\n  let summaryLabel\n  if (overallStatus === 'healthy') {\n    summaryLabel = 'Project is on track'\n  } else if (overallStatus === 'warning') {\n    summaryLabel = 'Some factors need attention'\n  } else {\n    summaryLabel = 'Immediate review recommended'\n  }\n\n  return {\n    score: compositeScore,\n    status: overallStatus,\n    label: summaryLabel,\n    factors: {\n      budget: { ...budgetFactor, weight: weights.budget },\n      schedule: { ...scheduleFactor, weight: weights.schedule },\n      corExposure: { ...corFactor, weight: weights.corExposure },\n      activity: { ...activityFactor, weight: weights.activity },\n      safety: { ...safetyFactor, weight: weights.safety }\n    }\n  }\n}\n\n/**\n * Generate smart alerts based on risk factors\n *\n * @param {object} riskResult - Result from calculateRiskScore\n * @param {object} project - Project data for context\n * @returns {array} Array of alert objects\n */\nexport function generateSmartAlerts(riskResult, project) {\n  const alerts = []\n\n  const { factors } = riskResult\n\n  // Critical alerts (priority 1)\n  if (factors.budget.status === 'critical') {\n    alerts.push({\n      type: 'critical',\n      title: 'Budget Alert',\n      description: factors.budget.label,\n      action: 'Review costs immediately',\n      actionTarget: 'financials',\n      projectId: project.id\n    })\n  }\n\n  if (factors.activity.status === 'critical') {\n    alerts.push({\n      type: 'critical',\n      title: 'Activity Alert',\n      description: factors.activity.label,\n      action: 'Check project status',\n      actionTarget: 'overview',\n      projectId: project.id\n    })\n  }\n\n  if (factors.safety.status === 'critical') {\n    alerts.push({\n      type: 'critical',\n      title: 'Safety Alert',\n      description: factors.safety.label,\n      action: 'Review safety reports',\n      actionTarget: 'reports',\n      projectId: project.id\n    })\n  }\n\n  // Warning alerts (priority 2)\n  if (factors.budget.status === 'warning') {\n    alerts.push({\n      type: 'warning',\n      title: 'Budget Watch',\n      description: factors.budget.label,\n      action: 'Monitor costs',\n      actionTarget: 'financials',\n      projectId: project.id\n    })\n  }\n\n  if (factors.schedule.status === 'critical' || factors.schedule.status === 'warning') {\n    alerts.push({\n      type: factors.schedule.status === 'critical' ? 'critical' : 'warning',\n      title: 'Schedule Alert',\n      description: factors.schedule.label,\n      action: 'Review progress',\n      actionTarget: 'overview',\n      projectId: project.id\n    })\n  }\n\n  if (factors.corExposure.status === 'warning' || factors.corExposure.status === 'critical') {\n    alerts.push({\n      type: factors.corExposure.status === 'critical' ? 'critical' : 'warning',\n      title: 'COR Exposure',\n      description: factors.corExposure.label,\n      action: 'Review pending CORs',\n      actionTarget: 'cors',\n      projectId: project.id\n    })\n  }\n\n  // Info alerts (priority 3)\n  if (factors.activity.status === 'warning') {\n    alerts.push({\n      type: 'info',\n      title: 'Activity Notice',\n      description: factors.activity.label,\n      action: 'File daily report',\n      actionTarget: 'reports',\n      projectId: project.id\n    })\n  }\n\n  // Sort by priority\n  const priorityOrder = { critical: 0, warning: 1, info: 2 }\n  alerts.sort((a, b) => priorityOrder[a.type] - priorityOrder[b.type])\n\n  return alerts\n}\n\n/**\n * Calculate projections based on current trends\n */\nexport function calculateProjections(project) {\n  const { actualProgress, totalCosts, earnedRevenue, contractValue } = project\n\n  // Guard against division by zero\n  if (!actualProgress || actualProgress <= 0) {\n    return {\n      estimatedCompletionCost: null,\n      estimatedFinalMargin: null,\n      estimatedCompletionDate: null\n    }\n  }\n\n  // Project final cost based on current burn rate\n  const costPerPercent = totalCosts / actualProgress\n  const estimatedCompletionCost = Math.round(costPerPercent * 100)\n\n  // Calculate projected margin\n  const estimatedFinalMargin = contractValue > 0\n    ? ((contractValue - estimatedCompletionCost) / contractValue) * 100\n    : 0\n\n  // If we have start date and progress, estimate completion\n  // (This is simplified - real implementation would use more sophisticated projection)\n  let estimatedCompletionDate = null\n  if (project.startDate && actualProgress > 0 && actualProgress < 100) {\n    const startDate = new Date(project.startDate)\n    const now = new Date()\n    const daysElapsed = Math.max(1, (now - startDate) / (1000 * 60 * 60 * 24))\n    const progressPerDay = actualProgress / daysElapsed\n    const remainingProgress = 100 - actualProgress\n    const daysRemaining = remainingProgress / progressPerDay\n\n    estimatedCompletionDate = new Date(now.getTime() + daysRemaining * 24 * 60 * 60 * 1000)\n  }\n\n  return {\n    estimatedCompletionCost,\n    estimatedFinalMargin,\n    estimatedCompletionDate,\n    costPerPercent\n  }\n}\n\n// Helper function\nfunction formatNumber(num) {\n  if (num >= 1000000) {\n    return (num / 1000000).toFixed(1) + 'M'\n  }\n  if (num >= 1000) {\n    return (num / 1000).toFixed(0) + 'K'\n  }\n  return num.toFixed(0)\n}\n\nexport default {\n  calculateRiskScore,\n  generateSmartAlerts,\n  calculateProjections,\n  calculateBudgetFactor,\n  calculateScheduleFactor,\n  calculateCORExposureFactor,\n  calculateActivityFactor,\n  calculateSafetyFactor,\n  DEFAULT_THRESHOLDS,\n  FACTOR_WEIGHTS\n}\n","import { useMemo } from 'react'\nimport { calculateRiskScore, generateSmartAlerts, calculateProjections } from '../lib/riskCalculations'\n\n/**\n * Computes portfolio-level financial metrics, project health, schedule metrics,\n * and risk analysis from enhanced project data.\n * Extracted from Dashboard.jsx for maintainability.\n */\nexport default function usePortfolioMetrics(projectsData) {\n  const portfolioMetrics = useMemo(() => {\n    const totalOriginalContract = projectsData.reduce((sum, p) => sum + (p.contract_value || 0), 0)\n    const totalChangeOrders = projectsData.reduce((sum, p) => sum + (p.changeOrderValue || 0), 0)\n    const totalPortfolioValue = totalOriginalContract + totalChangeOrders\n    const totalEarned = projectsData.reduce((sum, p) => sum + (p.billable || 0), 0)\n    const totalRemaining = totalPortfolioValue - totalEarned\n\n    const weightedCompletion = totalPortfolioValue > 0\n      ? Math.round((totalEarned / totalPortfolioValue) * 100)\n      : 0\n\n    const totalPendingCORValue = projectsData.reduce((sum, p) => sum + (p.corPendingValue || 0), 0)\n    const totalPendingCORCount = projectsData.reduce((sum, p) => sum + (p.corPendingCount || 0), 0)\n\n    return {\n      totalOriginalContract,\n      totalChangeOrders,\n      totalPortfolioValue,\n      totalEarned,\n      totalRemaining,\n      weightedCompletion,\n      totalPendingCORValue,\n      totalPendingCORCount\n    }\n  }, [projectsData])\n\n  const projectHealth = useMemo(() => {\n    let complete = 0\n    let onTrack = 0\n    let atRisk = 0\n    let overBudget = 0\n    let withChangeOrders = 0\n\n    for (const p of projectsData) {\n      const contractVal = p.revisedContractValue || p.contract_value\n      if (p.progress >= 100) complete++\n      if (p.progress < 100 && p.billable <= contractVal * (p.progress / 100) * 1.1) onTrack++\n      if (p.billable > contractVal * 0.9 && p.progress < 90) atRisk++\n      if (p.billable > contractVal) overBudget++\n      if ((p.changeOrderValue || 0) > 0) withChangeOrders++\n    }\n\n    return {\n      projectsComplete: complete,\n      projectsOnTrack: onTrack,\n      projectsAtRisk: atRisk,\n      projectsOverBudget: overBudget,\n      projectsWithChangeOrders: withChangeOrders\n    }\n  }, [projectsData])\n\n  const scheduleMetrics = useMemo(() => {\n    let ahead = 0\n    let onTrack = 0\n    let behind = 0\n    let overLabor = 0\n    let underLabor = 0\n    let onTrackLabor = 0\n\n    for (const p of projectsData) {\n      if (p.hasScheduleData) {\n        if (p.scheduleStatus === 'ahead') ahead++\n        else if (p.scheduleStatus === 'behind') behind++\n        else onTrack++\n      }\n      if (p.hasLaborData) {\n        if (p.laborStatus === 'over') overLabor++\n        else if (p.laborStatus === 'under') underLabor++\n        else onTrackLabor++\n      }\n    }\n\n    return {\n      scheduleAhead: ahead,\n      scheduleOnTrack: onTrack,\n      scheduleBehind: behind,\n      laborOver: overLabor,\n      laborUnder: underLabor,\n      laborOnTrack: onTrackLabor,\n      hasAnyScheduleData: ahead + onTrack + behind > 0,\n      hasAnyLaborData: overLabor + underLabor + onTrackLabor > 0\n    }\n  }, [projectsData])\n\n  const riskAnalysis = useMemo(() => {\n    const projectRisks = projectsData.map(p => {\n      const riskInput = {\n        id: p.id,\n        name: p.name,\n        totalCosts: p.totalCosts || 0,\n        earnedRevenue: p.billable || 0,\n        actualProgress: p.progress || 0,\n        expectedProgress: p.expectedProgress || p.progress,\n        pendingCORValue: p.corPendingValue || 0,\n        contractValue: p.revisedContractValue || p.contract_value || 0,\n        lastReportDate: p.lastDailyReport,\n        recentInjuryCount: p.recentInjuryCount || 0,\n        startDate: p.start_date\n      }\n\n      const riskResult = calculateRiskScore(riskInput)\n      const alerts = generateSmartAlerts(riskResult, { ...riskInput, name: p.name })\n      const projections = calculateProjections(riskInput)\n\n      const alertsWithProject = alerts.map(a => ({\n        ...a,\n        projectName: p.name,\n        projectId: p.id\n      }))\n\n      return {\n        projectId: p.id,\n        projectName: p.name,\n        riskScore: riskResult.score,\n        riskStatus: riskResult.status,\n        riskLabel: riskResult.label,\n        factors: riskResult.factors,\n        alerts: alertsWithProject,\n        projections\n      }\n    })\n\n    const allAlerts = projectRisks\n      .flatMap(p => p.alerts)\n      .sort((a, b) => {\n        const priority = { critical: 0, warning: 1, info: 2 }\n        return priority[a.type] - priority[b.type]\n      })\n\n    return {\n      projectRisks,\n      allAlerts,\n      criticalCount: allAlerts.filter(a => a.type === 'critical').length,\n      warningCount: allAlerts.filter(a => a.type === 'warning').length\n    }\n  }, [projectsData])\n\n  return { portfolioMetrics, projectHealth, scheduleMetrics, riskAnalysis }\n}\n","import { useState } from 'react'\nimport { db } from '../lib/supabase'\n\n/**\n * Manages project edit mode state and handlers.\n * Extracted from Dashboard.jsx for maintainability.\n */\nexport default function useProjectEdit({ selectedProject, areas, company, onShowToast, loadAreas, setSelectedProject }) {\n  const [editMode, setEditMode] = useState(false)\n  const [editData, setEditData] = useState(null)\n  const [saving, setSaving] = useState(false)\n\n  const handleEditClick = () => {\n    setEditData({\n      name: selectedProject.name,\n      job_number: selectedProject.job_number || '',\n      address: selectedProject.address || '',\n      general_contractor: selectedProject.general_contractor || '',\n      client_contact: selectedProject.client_contact || '',\n      client_phone: selectedProject.client_phone || '',\n      contract_value: selectedProject.contract_value,\n      work_type: selectedProject.work_type || 'demolition',\n      job_type: selectedProject.job_type || 'standard',\n      pin: selectedProject.pin || '',\n      default_dump_site_id: selectedProject.default_dump_site_id || '',\n      areas: areas.map(a => ({\n        id: a.id,\n        name: a.name,\n        weight: a.weight,\n        isNew: false\n      }))\n    })\n    setEditMode(true)\n  }\n\n  const handleCancelEdit = () => {\n    setEditMode(false)\n    setEditData(null)\n  }\n\n  const handleEditChange = (field, value) => {\n    setEditData(prev => ({ ...prev, [field]: value }))\n  }\n\n  const handleAreaEditChange = (index, field, value) => {\n    setEditData(prev => ({\n      ...prev,\n      areas: prev.areas.map((area, i) =>\n        i === index ? { ...area, [field]: value } : area\n      )\n    }))\n  }\n\n  const handleAddArea = () => {\n    setEditData(prev => ({\n      ...prev,\n      areas: [...prev.areas, { id: null, name: '', weight: '', isNew: true }]\n    }))\n  }\n\n  const handleRemoveArea = (index) => {\n    if (editData.areas.length > 1) {\n      setEditData(prev => ({\n        ...prev,\n        areas: prev.areas.filter((_, i) => i !== index)\n      }))\n    }\n  }\n\n  const handleSaveEdit = async () => {\n    if (!editData.name.trim()) {\n      onShowToast('Please enter a project name', 'error')\n      return\n    }\n\n    const contractVal = parseFloat(editData.contract_value)\n    if (!contractVal || contractVal <= 0) {\n      onShowToast('Please enter a valid contract value', 'error')\n      return\n    }\n\n    if (editData.pin && editData.pin.length !== 4) {\n      onShowToast('PIN must be 4 digits', 'error')\n      return\n    }\n\n    if (editData.pin && editData.pin !== selectedProject.pin) {\n      const pinAvailable = await db.isPinAvailable(editData.pin, selectedProject.id)\n      if (!pinAvailable) {\n        onShowToast('This PIN is already in use', 'error')\n        return\n      }\n    }\n\n    const validAreas = editData.areas.filter(a => a.name.trim() && parseFloat(a.weight) > 0)\n    if (validAreas.length === 0) {\n      onShowToast('Please add at least one area', 'error')\n      return\n    }\n\n    const totalWeight = validAreas.reduce((sum, a) => sum + parseFloat(a.weight), 0)\n    if (totalWeight !== 100) {\n      onShowToast('Area weights must total 100%', 'error')\n      return\n    }\n\n    setSaving(true)\n\n    try {\n      await db.updateProject(selectedProject.id, {\n        name: editData.name.trim(),\n        job_number: editData.job_number?.trim() || null,\n        address: editData.address?.trim() || null,\n        general_contractor: editData.general_contractor?.trim() || null,\n        client_contact: editData.client_contact?.trim() || null,\n        client_phone: editData.client_phone?.trim() || null,\n        contract_value: contractVal,\n        work_type: editData.work_type || 'demolition',\n        job_type: editData.job_type || 'standard',\n        pin: editData.pin || null,\n        default_dump_site_id: editData.default_dump_site_id || null\n      }, company?.id)\n\n      const existingAreaIds = areas.map(a => a.id)\n      const editAreaIds = editData.areas.filter(a => a.id).map(a => a.id)\n\n      for (const areaId of existingAreaIds) {\n        if (!editAreaIds.includes(areaId)) {\n          await db.deleteArea(areaId)\n        }\n      }\n\n      for (let i = 0; i < validAreas.length; i++) {\n        const area = validAreas[i]\n        if (area.id) {\n          await db.updateArea(area.id, {\n            name: area.name.trim(),\n            weight: parseFloat(area.weight),\n            sort_order: i\n          })\n        } else {\n          await db.createArea({\n            project_id: selectedProject.id,\n            name: area.name.trim(),\n            weight: parseFloat(area.weight),\n            status: 'not_started',\n            sort_order: i\n          })\n        }\n      }\n\n      const updatedProject = await db.getProject(selectedProject.id)\n      setSelectedProject(updatedProject)\n      await loadAreas(selectedProject.id)\n\n      setEditMode(false)\n      setEditData(null)\n      onShowToast('Project updated!', 'success')\n    } catch (error) {\n      console.error('Error saving project:', error?.message || error)\n      onShowToast(error?.message || 'Error saving changes', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleDeleteProject = async (loadProjects) => {\n    if (!confirm('Are you sure you want to delete this project? This cannot be undone.')) {\n      return\n    }\n\n    try {\n      await db.deleteProject(selectedProject.id)\n      setSelectedProject(null)\n      onShowToast('Project deleted', 'success')\n      loadProjects()\n    } catch (error) {\n      console.error('Error deleting project:', error)\n      onShowToast('Error deleting project', 'error')\n    }\n  }\n\n  return {\n    editMode,\n    editData,\n    saving,\n    handleEditClick,\n    handleCancelEdit,\n    handleEditChange,\n    handleAreaEditChange,\n    handleAddArea,\n    handleRemoveArea,\n    handleSaveEdit,\n    handleDeleteProject\n  }\n}\n","/**\n * Field Document PDF Export\n * Exports field-submitted documents (daily reports, incident reports, crew check-ins)\n * as a consolidated or individual PDF report.\n */\n\nconst loadJsPDF = () => import('jspdf')\n\nconst PAGE_WIDTH = 210 // A4 width in mm\nconst MARGIN = 14\nconst CONTENT_WIDTH = PAGE_WIDTH - MARGIN * 2\n\n/**\n * Format currency for display\n */\nconst formatCurrency = (value) => {\n  return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value || 0)\n}\n\n/**\n * Format date for display\n */\nconst formatDate = (dateStr) => {\n  if (!dateStr) return ''\n  const d = new Date(dateStr + (dateStr.includes('T') ? '' : 'T12:00:00'))\n  return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' })\n}\n\n/**\n * Add page footer\n */\nconst addFooter = (doc, pageNum, totalPages) => {\n  const y = doc.internal.pageSize.height - 8\n  doc.setFontSize(7)\n  doc.setTextColor(128, 128, 128)\n  doc.text(`Page ${pageNum} of ${totalPages}`, PAGE_WIDTH / 2, y, { align: 'center' })\n  doc.text(`Generated ${new Date().toLocaleString()}  FieldSync`, PAGE_WIDTH - MARGIN, y, { align: 'right' })\n}\n\n/**\n * Check if we need a new page\n */\nconst checkPage = (doc, y, needed = 30) => {\n  if (y + needed > doc.internal.pageSize.height - 20) {\n    doc.addPage()\n    return 20\n  }\n  return y\n}\n\n/**\n * Export daily reports as PDF\n * @param {Array} reports - Daily report objects\n * @param {Object} project - Project info\n * @returns {Promise<void>}\n */\nexport async function exportDailyReportsPDF(reports, project) {\n  const jsPDFModule = await loadJsPDF()\n  const jsPDF = jsPDFModule.default\n  const doc = new jsPDF()\n\n  let y = 20\n\n  // Title\n  doc.setFontSize(18)\n  doc.setFont(undefined, 'bold')\n  doc.text('Daily Reports', PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 8\n\n  doc.setFontSize(11)\n  doc.setFont(undefined, 'normal')\n  doc.text(`Project: ${project.name}`, PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 6\n  doc.text(`${reports.length} report${reports.length !== 1 ? 's' : ''}`, PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 12\n\n  // Each report\n  reports.forEach((report, idx) => {\n    y = checkPage(doc, y, 60)\n\n    // Report header\n    doc.setDrawColor(200, 200, 200)\n    doc.setFillColor(245, 247, 250)\n    doc.roundedRect(MARGIN, y - 2, CONTENT_WIDTH, 10, 2, 2, 'F')\n\n    doc.setFontSize(11)\n    doc.setFont(undefined, 'bold')\n    doc.setTextColor(30, 30, 30)\n    doc.text(`${formatDate(report.report_date)}`, MARGIN + 4, y + 5)\n\n    const statusText = report.status === 'submitted' ? 'Submitted' : 'Draft'\n    doc.setFontSize(9)\n    doc.setFont(undefined, 'normal')\n    doc.text(statusText, PAGE_WIDTH - MARGIN - 4, y + 5, { align: 'right' })\n    y += 14\n\n    doc.setTextColor(0, 0, 0)\n\n    // Metrics row\n    doc.setFontSize(9)\n    const metrics = [\n      `Crew: ${report.crew_count || 0}`,\n      `Tasks: ${report.tasks_completed || 0}/${report.tasks_total || 0}`,\n      `T&M Tickets: ${report.tm_tickets_count || 0}`,\n      `Photos: ${report.photos_count || 0}`\n    ]\n    doc.text(metrics.join('    |    '), MARGIN + 4, y)\n    y += 7\n\n    // Crew list\n    if (report.crew_list?.length > 0) {\n      doc.setFont(undefined, 'bold')\n      doc.text('Crew:', MARGIN + 4, y)\n      doc.setFont(undefined, 'normal')\n      const crewNames = report.crew_list.map(w => `${w.name} (${w.role || 'Laborer'})`).join(', ')\n      const crewLines = doc.splitTextToSize(crewNames, CONTENT_WIDTH - 8)\n      y += 4\n      doc.text(crewLines, MARGIN + 4, y)\n      y += crewLines.length * 4 + 2\n    }\n\n    // Field notes\n    if (report.field_notes) {\n      y = checkPage(doc, y, 15)\n      doc.setFont(undefined, 'bold')\n      doc.text('Field Notes:', MARGIN + 4, y)\n      doc.setFont(undefined, 'normal')\n      y += 4\n      const noteLines = doc.splitTextToSize(report.field_notes, CONTENT_WIDTH - 8)\n      doc.text(noteLines, MARGIN + 4, y)\n      y += noteLines.length * 4 + 2\n    }\n\n    // Issues\n    if (report.issues) {\n      y = checkPage(doc, y, 15)\n      doc.setFont(undefined, 'bold')\n      doc.text('Issues:', MARGIN + 4, y)\n      doc.setFont(undefined, 'normal')\n      y += 4\n      const issueLines = doc.splitTextToSize(report.issues, CONTENT_WIDTH - 8)\n      doc.text(issueLines, MARGIN + 4, y)\n      y += issueLines.length * 4 + 2\n    }\n\n    y += 8\n\n    // Divider\n    if (idx < reports.length - 1) {\n      doc.setDrawColor(220, 220, 220)\n      doc.line(MARGIN, y, PAGE_WIDTH - MARGIN, y)\n      y += 6\n    }\n  })\n\n  const fileName = `${project.name}_Daily_Reports_${new Date().toISOString().split('T')[0]}.pdf`\n  doc.save(fileName)\n}\n\n/**\n * Export incident/injury reports as PDF\n * @param {Array} reports - Injury report objects\n * @param {Object} project - Project info\n * @returns {Promise<void>}\n */\nexport async function exportIncidentReportsPDF(reports, project) {\n  const jsPDFModule = await loadJsPDF()\n  const jsPDF = jsPDFModule.default\n  const doc = new jsPDF()\n\n  let y = 20\n\n  // Title\n  doc.setFontSize(18)\n  doc.setFont(undefined, 'bold')\n  doc.text('Incident / Injury Reports', PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 8\n\n  doc.setFontSize(11)\n  doc.setFont(undefined, 'normal')\n  doc.text(`Project: ${project.name}`, PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 6\n  doc.text(`${reports.length} report${reports.length !== 1 ? 's' : ''}`, PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 12\n\n  reports.forEach((report, idx) => {\n    y = checkPage(doc, y, 50)\n\n    // Header bar\n    const severityColors = {\n      minor: [34, 197, 94],\n      serious: [245, 158, 11],\n      critical: [239, 68, 68],\n      near_miss: [59, 130, 246]\n    }\n    const color = severityColors[report.injury_type] || [128, 128, 128]\n\n    doc.setFillColor(...color)\n    doc.roundedRect(MARGIN, y - 2, 3, 14, 1, 1, 'F')\n\n    doc.setFontSize(11)\n    doc.setFont(undefined, 'bold')\n    doc.setTextColor(30, 30, 30)\n    doc.text(`${formatDate(report.incident_date)}`, MARGIN + 8, y + 4)\n\n    doc.setFontSize(9)\n    const typeLabel = (report.injury_type || '').replace('_', ' ').toUpperCase()\n    doc.text(typeLabel, MARGIN + 8, y + 10)\n\n    doc.setFont(undefined, 'normal')\n    doc.text(report.status === 'open' ? 'OPEN' : 'CLOSED', PAGE_WIDTH - MARGIN - 4, y + 4, { align: 'right' })\n    y += 16\n\n    doc.setTextColor(0, 0, 0)\n\n    // Description\n    if (report.description) {\n      doc.setFontSize(9)\n      doc.setFont(undefined, 'bold')\n      doc.text('Description:', MARGIN + 4, y)\n      doc.setFont(undefined, 'normal')\n      y += 4\n      const lines = doc.splitTextToSize(report.description, CONTENT_WIDTH - 8)\n      doc.text(lines, MARGIN + 4, y)\n      y += lines.length * 4 + 2\n    }\n\n    // Location\n    if (report.location) {\n      doc.setFont(undefined, 'bold')\n      doc.text('Location: ', MARGIN + 4, y)\n      doc.setFont(undefined, 'normal')\n      doc.text(report.location, MARGIN + 30, y)\n      y += 6\n    }\n\n    y += 6\n\n    if (idx < reports.length - 1) {\n      doc.setDrawColor(220, 220, 220)\n      doc.line(MARGIN, y, PAGE_WIDTH - MARGIN, y)\n      y += 6\n    }\n  })\n\n  const fileName = `${project.name}_Incident_Reports_${new Date().toISOString().split('T')[0]}.pdf`\n  doc.save(fileName)\n}\n\n/**\n * Export crew check-in history as PDF\n * @param {Array} checkins - Crew check-in objects\n * @param {Object} project - Project info\n * @returns {Promise<void>}\n */\nexport async function exportCrewCheckinsPDF(checkins, project) {\n  const jsPDFModule = await loadJsPDF()\n  const jsPDF = jsPDFModule.default\n  const doc = new jsPDF()\n\n  let y = 20\n\n  doc.setFontSize(18)\n  doc.setFont(undefined, 'bold')\n  doc.text('Crew Check-In History', PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 8\n\n  doc.setFontSize(11)\n  doc.setFont(undefined, 'normal')\n  doc.text(`Project: ${project.name}`, PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 6\n  doc.text(`${checkins.length} check-in${checkins.length !== 1 ? 's' : ''}`, PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 12\n\n  checkins.forEach((checkin, idx) => {\n    y = checkPage(doc, y, 30)\n    const workers = checkin.workers || []\n\n    // Date header\n    doc.setFillColor(245, 247, 250)\n    doc.roundedRect(MARGIN, y - 2, CONTENT_WIDTH, 9, 2, 2, 'F')\n\n    doc.setFontSize(10)\n    doc.setFont(undefined, 'bold')\n    doc.setTextColor(30, 30, 30)\n    doc.text(formatDate(checkin.check_in_date), MARGIN + 4, y + 4)\n    doc.setFont(undefined, 'normal')\n    doc.text(`${workers.length} workers`, PAGE_WIDTH - MARGIN - 4, y + 4, { align: 'right' })\n    y += 12\n\n    doc.setTextColor(0, 0, 0)\n    doc.setFontSize(9)\n\n    // Worker list as table\n    if (workers.length > 0) {\n      doc.setFont(undefined, 'bold')\n      doc.text('Name', MARGIN + 4, y)\n      doc.text('Role', 110, y)\n      y += 5\n\n      doc.setFont(undefined, 'normal')\n      workers.forEach(w => {\n        y = checkPage(doc, y, 6)\n        doc.text(w.name || '', MARGIN + 4, y)\n        doc.text(w.role || 'Laborer', 110, y)\n        y += 4.5\n      })\n    }\n\n    y += 6\n\n    if (idx < checkins.length - 1) {\n      doc.setDrawColor(220, 220, 220)\n      doc.line(MARGIN, y, PAGE_WIDTH - MARGIN, y)\n      y += 5\n    }\n  })\n\n  const fileName = `${project.name}_Crew_Checkins_${new Date().toISOString().split('T')[0]}.pdf`\n  doc.save(fileName)\n}\n\n/**\n * Export ALL field documents as a single consolidated PDF\n * @param {Object} params\n * @param {Array} params.dailyReports\n * @param {Array} params.incidentReports\n * @param {Array} params.crewCheckins\n * @param {Object} params.project\n * @returns {Promise<void>}\n */\nexport async function exportAllFieldDocumentsPDF({ dailyReports = [], incidentReports = [], crewCheckins = [], project }) {\n  const jsPDFModule = await loadJsPDF()\n  const jsPDF = jsPDFModule.default\n  const doc = new jsPDF()\n\n  let y = 20\n\n  // Cover page\n  doc.setFontSize(22)\n  doc.setFont(undefined, 'bold')\n  doc.text('Field Documents Report', PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 10\n\n  doc.setFontSize(13)\n  doc.setFont(undefined, 'normal')\n  doc.text(`Project: ${project.name}`, PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 8\n\n  doc.setFontSize(10)\n  doc.text(`Generated: ${new Date().toLocaleDateString()}`, PAGE_WIDTH / 2, y, { align: 'center' })\n  y += 16\n\n  // Summary table\n  doc.setFontSize(11)\n  doc.setFont(undefined, 'bold')\n  doc.text('Document Summary', MARGIN, y)\n  y += 8\n\n  doc.setFontSize(10)\n  doc.setFont(undefined, 'normal')\n  const summaryItems = [\n    [`Daily Reports`, `${dailyReports.length}`],\n    [`Incident Reports`, `${incidentReports.length}`],\n    [`Crew Check-Ins`, `${crewCheckins.length}`]\n  ]\n  summaryItems.forEach(([label, count]) => {\n    doc.text(label, MARGIN + 4, y)\n    doc.text(count, 100, y)\n    y += 6\n  })\n\n  // Daily Reports Section\n  if (dailyReports.length > 0) {\n    doc.addPage()\n    y = 20\n\n    doc.setFontSize(16)\n    doc.setFont(undefined, 'bold')\n    doc.text('Daily Reports', MARGIN, y)\n    y += 10\n\n    dailyReports.forEach((report, idx) => {\n      y = checkPage(doc, y, 40)\n\n      doc.setFontSize(10)\n      doc.setFont(undefined, 'bold')\n      doc.setTextColor(30, 30, 30)\n      doc.text(formatDate(report.report_date), MARGIN + 2, y)\n      doc.setFont(undefined, 'normal')\n      doc.setFontSize(8)\n      doc.text(`Crew: ${report.crew_count || 0} | Tasks: ${report.tasks_completed || 0}/${report.tasks_total || 0} | T&M: ${report.tm_tickets_count || 0}`, MARGIN + 60, y)\n      y += 6\n\n      doc.setTextColor(0, 0, 0)\n      doc.setFontSize(9)\n\n      if (report.field_notes) {\n        const lines = doc.splitTextToSize(report.field_notes, CONTENT_WIDTH - 4)\n        doc.text(lines, MARGIN + 2, y)\n        y += lines.length * 4 + 2\n      }\n\n      if (report.issues) {\n        doc.setFont(undefined, 'bold')\n        doc.text('Issues: ', MARGIN + 2, y)\n        doc.setFont(undefined, 'normal')\n        const issueLines = doc.splitTextToSize(report.issues, CONTENT_WIDTH - 20)\n        doc.text(issueLines, MARGIN + 20, y)\n        y += issueLines.length * 4 + 2\n      }\n\n      y += 4\n      if (idx < dailyReports.length - 1) {\n        doc.setDrawColor(220, 220, 220)\n        doc.line(MARGIN, y, PAGE_WIDTH - MARGIN, y)\n        y += 4\n      }\n    })\n  }\n\n  // Incident Reports Section\n  if (incidentReports.length > 0) {\n    doc.addPage()\n    y = 20\n\n    doc.setFontSize(16)\n    doc.setFont(undefined, 'bold')\n    doc.text('Incident / Injury Reports', MARGIN, y)\n    y += 10\n\n    incidentReports.forEach((report, idx) => {\n      y = checkPage(doc, y, 35)\n\n      doc.setFontSize(10)\n      doc.setFont(undefined, 'bold')\n      doc.setTextColor(30, 30, 30)\n      doc.text(formatDate(report.incident_date), MARGIN + 2, y)\n      doc.setFontSize(8)\n      doc.setFont(undefined, 'normal')\n      const typeLabel = (report.injury_type || '').replace('_', ' ').toUpperCase()\n      doc.text(`${typeLabel}  ${report.status?.toUpperCase() || ''}`, MARGIN + 60, y)\n      y += 6\n\n      doc.setTextColor(0, 0, 0)\n      doc.setFontSize(9)\n\n      if (report.description) {\n        const lines = doc.splitTextToSize(report.description, CONTENT_WIDTH - 4)\n        doc.text(lines, MARGIN + 2, y)\n        y += lines.length * 4 + 2\n      }\n\n      if (report.location) {\n        doc.text(`Location: ${report.location}`, MARGIN + 2, y)\n        y += 5\n      }\n\n      y += 4\n      if (idx < incidentReports.length - 1) {\n        doc.setDrawColor(220, 220, 220)\n        doc.line(MARGIN, y, PAGE_WIDTH - MARGIN, y)\n        y += 4\n      }\n    })\n  }\n\n  // Crew Check-Ins Section\n  if (crewCheckins.length > 0) {\n    doc.addPage()\n    y = 20\n\n    doc.setFontSize(16)\n    doc.setFont(undefined, 'bold')\n    doc.text('Crew Check-In History', MARGIN, y)\n    y += 10\n\n    crewCheckins.forEach((checkin, idx) => {\n      y = checkPage(doc, y, 20)\n      const workers = checkin.workers || []\n\n      doc.setFontSize(10)\n      doc.setFont(undefined, 'bold')\n      doc.setTextColor(30, 30, 30)\n      doc.text(formatDate(checkin.check_in_date), MARGIN + 2, y)\n      doc.setFont(undefined, 'normal')\n      doc.setFontSize(8)\n      doc.text(`${workers.length} workers`, MARGIN + 60, y)\n      y += 6\n\n      doc.setTextColor(0, 0, 0)\n      doc.setFontSize(8)\n\n      if (workers.length > 0) {\n        const workerList = workers.map(w => `${w.name} (${w.role || 'Laborer'})`).join(', ')\n        const lines = doc.splitTextToSize(workerList, CONTENT_WIDTH - 4)\n        doc.text(lines, MARGIN + 2, y)\n        y += lines.length * 3.5 + 3\n      }\n\n      if (idx < crewCheckins.length - 1) {\n        doc.setDrawColor(230, 230, 230)\n        doc.line(MARGIN, y, PAGE_WIDTH - MARGIN, y)\n        y += 3\n      }\n    })\n  }\n\n  const fileName = `${project.name}_Field_Documents_${new Date().toISOString().split('T')[0]}.pdf`\n  doc.save(fileName)\n}\n","/**\n * Financial Export Module\n * Generates CSV/IIF exports for accounting integration\n */\n\n// Helper to trigger file download\nfunction downloadFile(content, filename, mimeType = 'text/csv') {\n  const blob = new Blob([content], { type: mimeType })\n  const url = URL.createObjectURL(blob)\n  const a = document.createElement('a')\n  a.href = url\n  a.download = filename\n  document.body.appendChild(a)\n  a.click()\n  document.body.removeChild(a)\n  URL.revokeObjectURL(url)\n}\n\n// Escape CSV field (handle commas, quotes, newlines)\nexport function escapeCSV(value) {\n  if (value == null) return ''\n  const str = String(value)\n  if (str.includes(',') || str.includes('\"') || str.includes('\\n')) {\n    return `\"${str.replace(/\"/g, '\"\"')}\"`\n  }\n  return str\n}\n\n// Convert array of objects to CSV string\nexport function toCSV(headers, rows) {\n  const headerLine = headers.map(h => escapeCSV(h.label)).join(',')\n  const dataLines = rows.map(row =>\n    headers.map(h => escapeCSV(row[h.key])).join(',')\n  )\n  return [headerLine, ...dataLines].join('\\n')\n}\n\n/**\n * Export project financial summary as CSV\n */\nexport function exportProjectFinancials(project, financialData) {\n  const headers = [\n    { key: 'category', label: 'Category' },\n    { key: 'description', label: 'Description' },\n    { key: 'amount', label: 'Amount' },\n    { key: 'date', label: 'Date' },\n    { key: 'type', label: 'Type' }\n  ]\n\n  const rows = []\n\n  // Contract value\n  rows.push({ category: 'Revenue', description: 'Original Contract Value', amount: project.contract_value || 0, date: project.start_date || '', type: 'Contract' })\n\n  // Earned revenue\n  if (financialData?.earnedRevenue) {\n    rows.push({ category: 'Revenue', description: 'Earned Revenue (Progress)', amount: financialData.earnedRevenue, date: new Date().toISOString().split('T')[0], type: 'Earned' })\n  }\n\n  // Approved CORs\n  if (financialData?.approvedCORs) {\n    financialData.approvedCORs.forEach(cor => {\n      rows.push({ category: 'Revenue', description: `COR: ${cor.cor_number} - ${cor.title}`, amount: (cor.cor_total || 0) / 100, date: cor.approved_at?.split('T')[0] || '', type: 'Change Order' })\n    })\n  }\n\n  // Labor costs\n  if (financialData?.laborByDate) {\n    financialData.laborByDate.forEach(d => {\n      rows.push({ category: 'Cost', description: 'Labor', amount: d.cost, date: d.date, type: 'Labor' })\n    })\n  }\n\n  // Disposal costs\n  if (financialData?.haulOffByDate) {\n    financialData.haulOffByDate.forEach(d => {\n      rows.push({ category: 'Cost', description: 'Disposal/Haul-off', amount: d.cost, date: d.date, type: 'Disposal' })\n    })\n  }\n\n  // Custom costs\n  if (financialData?.customCosts) {\n    financialData.customCosts.forEach(c => {\n      rows.push({ category: 'Cost', description: c.description || c.category || 'Other', amount: parseFloat(c.amount) || 0, date: c.cost_date || '', type: c.category || 'Other' })\n    })\n  }\n\n  // Summary row\n  const totalRevenue = rows.filter(r => r.category === 'Revenue').reduce((s, r) => s + (parseFloat(r.amount) || 0), 0)\n  const totalCosts = rows.filter(r => r.category === 'Cost').reduce((s, r) => s + (parseFloat(r.amount) || 0), 0)\n  rows.push({ category: '', description: '', amount: '', date: '', type: '' })\n  rows.push({ category: 'Summary', description: 'Total Revenue', amount: totalRevenue, date: '', type: '' })\n  rows.push({ category: 'Summary', description: 'Total Costs', amount: totalCosts, date: '', type: '' })\n  rows.push({ category: 'Summary', description: 'Gross Profit', amount: totalRevenue - totalCosts, date: '', type: '' })\n  rows.push({ category: 'Summary', description: 'Margin %', amount: totalRevenue > 0 ? ((totalRevenue - totalCosts) / totalRevenue * 100).toFixed(1) + '%' : 'N/A', date: '', type: '' })\n\n  const csv = toCSV(headers, rows)\n  const filename = `${project.name.replace(/[^a-zA-Z0-9]/g, '_')}_Financials_${new Date().toISOString().split('T')[0]}.csv`\n  downloadFile(csv, filename)\n}\n\n/**\n * Export COR detail as CSV\n */\nexport function exportCORDetail(cor, project) {\n  const rows = []\n  const headers = [\n    { key: 'section', label: 'Section' },\n    { key: 'description', label: 'Description' },\n    { key: 'quantity', label: 'Quantity' },\n    { key: 'unit', label: 'Unit' },\n    { key: 'rate', label: 'Rate' },\n    { key: 'total', label: 'Total' }\n  ]\n\n  // COR header info\n  rows.push({ section: 'COR Info', description: `${cor.cor_number} - ${cor.title}`, quantity: '', unit: '', rate: '', total: '' })\n  rows.push({ section: 'Status', description: cor.status, quantity: '', unit: '', rate: '', total: '' })\n  rows.push({ section: 'Period', description: `${cor.period_start || ''} to ${cor.period_end || ''}`, quantity: '', unit: '', rate: '', total: '' })\n  rows.push({ section: '', description: '', quantity: '', unit: '', rate: '', total: '' })\n\n  // Labor\n  if (cor.change_order_labor?.length > 0) {\n    rows.push({ section: 'LABOR', description: '', quantity: '', unit: '', rate: '', total: '' })\n    cor.change_order_labor.forEach(item => {\n      const regHrs = parseFloat(item.regular_hours) || 0\n      const otHrs = parseFloat(item.overtime_hours) || 0\n      rows.push({ section: '', description: item.description || item.classification, quantity: regHrs + otHrs, unit: 'hours', rate: (parseInt(item.regular_rate) || 0) / 100, total: (parseInt(item.total) || 0) / 100 })\n    })\n  }\n\n  // Materials\n  if (cor.change_order_materials?.length > 0) {\n    rows.push({ section: 'MATERIALS', description: '', quantity: '', unit: '', rate: '', total: '' })\n    cor.change_order_materials.forEach(item => {\n      rows.push({ section: '', description: item.description, quantity: parseFloat(item.quantity) || 0, unit: item.unit || 'each', rate: (parseInt(item.unit_cost) || 0) / 100, total: (parseInt(item.total) || 0) / 100 })\n    })\n  }\n\n  // Equipment\n  if (cor.change_order_equipment?.length > 0) {\n    rows.push({ section: 'EQUIPMENT', description: '', quantity: '', unit: '', rate: '', total: '' })\n    cor.change_order_equipment.forEach(item => {\n      rows.push({ section: '', description: item.description, quantity: parseFloat(item.quantity) || 0, unit: item.unit || 'day', rate: (parseInt(item.unit_cost) || 0) / 100, total: (parseInt(item.total) || 0) / 100 })\n    })\n  }\n\n  // Subcontractors\n  if (cor.change_order_subcontractors?.length > 0) {\n    rows.push({ section: 'SUBCONTRACTORS', description: '', quantity: '', unit: '', rate: '', total: '' })\n    cor.change_order_subcontractors.forEach(item => {\n      rows.push({ section: '', description: item.description, quantity: parseFloat(item.quantity) || 0, unit: item.unit || 'lump sum', rate: (parseInt(item.unit_cost) || 0) / 100, total: (parseInt(item.total) || 0) / 100 })\n    })\n  }\n\n  const csv = toCSV(headers, rows)\n  const filename = `COR_${cor.cor_number || cor.id}_${new Date().toISOString().split('T')[0]}.csv`\n  downloadFile(csv, filename)\n}\n\n/**\n * Export T&M tickets as CSV\n */\nexport function exportTMTicketsCSV(tickets, project) {\n  const headers = [\n    { key: 'date', label: 'Date' },\n    { key: 'status', label: 'Status' },\n    { key: 'workers', label: 'Worker Count' },\n    { key: 'totalHours', label: 'Total Hours' },\n    { key: 'otHours', label: 'OT Hours' },\n    { key: 'materialsCost', label: 'Materials Cost' },\n    { key: 'corNumber', label: 'COR #' },\n    { key: 'notes', label: 'Notes' }\n  ]\n\n  const rows = tickets.map(t => {\n    const workers = t.t_and_m_workers || []\n    const items = t.t_and_m_items || []\n    const totalHours = workers.reduce((s, w) => s + (parseFloat(w.hours) || 0), 0)\n    const otHours = workers.reduce((s, w) => s + (parseFloat(w.overtime_hours) || 0), 0)\n    const materialsCost = items.reduce((s, i) => s + ((parseFloat(i.quantity) || 0) * (i.materials_equipment?.cost_per_unit || 0)), 0)\n\n    return {\n      date: t.work_date,\n      status: t.status,\n      workers: workers.length,\n      totalHours: (totalHours + otHours).toFixed(1),\n      otHours: otHours.toFixed(1),\n      materialsCost: materialsCost.toFixed(2),\n      corNumber: t.assigned_cor_id ? 'Linked' : '',\n      notes: t.notes || ''\n    }\n  })\n\n  const csv = toCSV(headers, rows)\n  const filename = `${project.name.replace(/[^a-zA-Z0-9]/g, '_')}_TM_Tickets_${new Date().toISOString().split('T')[0]}.csv`\n  downloadFile(csv, filename)\n}\n\n/**\n * Export to QuickBooks IIF format (General Journal Entry)\n * IIF = Intuit Interchange Format - importable by QuickBooks Desktop\n */\nexport function exportToQuickBooksIIF(project, financialData) {\n  const lines = []\n  const txnDate = new Date().toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' })\n\n  // IIF Header\n  lines.push('!TRNS\\tTRNSTYPE\\tDATE\\tACCNT\\tNAME\\tAMOUNT\\tMEMO')\n  lines.push('!SPL\\tTRNSTYPE\\tDATE\\tACCNT\\tNAME\\tAMOUNT\\tMEMO')\n  lines.push('!ENDTRNS')\n\n  // Revenue entry\n  const totalRevenue = (project.contract_value || 0)\n  lines.push(`TRNS\\tGENERAL JOURNAL\\t${txnDate}\\tAccounts Receivable\\t${project.name}\\t${totalRevenue.toFixed(2)}\\tFieldSync - Contract Revenue`)\n  lines.push(`SPL\\tGENERAL JOURNAL\\t${txnDate}\\tConstruction Revenue\\t${project.name}\\t${(-totalRevenue).toFixed(2)}\\tContract: ${project.name}`)\n  lines.push('ENDTRNS')\n\n  // Cost entries\n  const totalLabor = financialData?.totalLaborCost || 0\n  if (totalLabor > 0) {\n    lines.push(`TRNS\\tGENERAL JOURNAL\\t${txnDate}\\tDirect Labor\\t${project.name}\\t${totalLabor.toFixed(2)}\\tLabor costs - ${project.name}`)\n    lines.push(`SPL\\tGENERAL JOURNAL\\t${txnDate}\\tAccounts Payable\\t${project.name}\\t${(-totalLabor).toFixed(2)}\\tLabor costs`)\n    lines.push('ENDTRNS')\n  }\n\n  const totalDisposal = financialData?.totalDisposalCost || 0\n  if (totalDisposal > 0) {\n    lines.push(`TRNS\\tGENERAL JOURNAL\\t${txnDate}\\tDisposal Expense\\t${project.name}\\t${totalDisposal.toFixed(2)}\\tDisposal costs - ${project.name}`)\n    lines.push(`SPL\\tGENERAL JOURNAL\\t${txnDate}\\tAccounts Payable\\t${project.name}\\t${(-totalDisposal).toFixed(2)}\\tDisposal costs`)\n    lines.push('ENDTRNS')\n  }\n\n  const content = lines.join('\\n')\n  const filename = `${project.name.replace(/[^a-zA-Z0-9]/g, '_')}_QB_${new Date().toISOString().split('T')[0]}.iif`\n  downloadFile(content, filename, 'application/x-iif')\n}\n\n/**\n * Export multi-project summary as CSV\n */\nexport function exportPortfolioSummary(projects, projectDataMap) {\n  const headers = [\n    { key: 'name', label: 'Project Name' },\n    { key: 'jobNumber', label: 'Job #' },\n    { key: 'status', label: 'Status' },\n    { key: 'contractValue', label: 'Contract Value' },\n    { key: 'progress', label: 'Progress %' },\n    { key: 'earnedRevenue', label: 'Earned Revenue' },\n    { key: 'totalCosts', label: 'Total Costs' },\n    { key: 'profit', label: 'Profit' },\n    { key: 'margin', label: 'Margin %' }\n  ]\n\n  const rows = projects.map(p => {\n    const data = projectDataMap?.[p.id] || {}\n    const earned = data.earnedRevenue || 0\n    const costs = data.totalCosts || 0\n    const profit = earned - costs\n    return {\n      name: p.name,\n      jobNumber: p.job_number || '',\n      status: p.status || 'active',\n      contractValue: (p.contract_value || 0).toFixed(2),\n      progress: (data.progress || 0).toFixed(1),\n      earnedRevenue: earned.toFixed(2),\n      totalCosts: costs.toFixed(2),\n      profit: profit.toFixed(2),\n      margin: earned > 0 ? ((profit / earned) * 100).toFixed(1) : '0.0'\n    }\n  })\n\n  const csv = toCSV(headers, rows)\n  const filename = `Portfolio_Summary_${new Date().toISOString().split('T')[0]}.csv`\n  downloadFile(csv, filename)\n}\n","import { useState, useEffect, useRef, useCallback } from 'react'\nimport { Search, X, FolderOpen, FileText, Users, ClipboardList, ChevronRight, Command } from 'lucide-react'\nimport { db } from '../lib/supabase'\n\nexport default function UniversalSearch({\n  isOpen,\n  onClose,\n  companyId,\n  onSelectProject,\n  onSelectTicket,\n  onSelectCOR,\n  onShowToast\n}) {\n  const [query, setQuery] = useState('')\n  const [results, setResults] = useState({ projects: [], tickets: [], cors: [], workers: [] })\n  const [loading, setLoading] = useState(false)\n  const [selectedIndex, setSelectedIndex] = useState(0)\n  const inputRef = useRef(null)\n  const searchTimeoutRef = useRef(null)\n  const focusTimeoutRef = useRef(null)\n\n  // Cleanup timers on unmount\n  useEffect(() => {\n    return () => {\n      if (searchTimeoutRef.current) clearTimeout(searchTimeoutRef.current)\n      if (focusTimeoutRef.current) clearTimeout(focusTimeoutRef.current)\n    }\n  }, [])\n\n  // Focus input when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      setQuery('')\n      setResults({ projects: [], tickets: [], cors: [], workers: [] })\n      setSelectedIndex(0)\n      focusTimeoutRef.current = setTimeout(() => inputRef.current?.focus(), 50)\n    }\n  }, [isOpen])\n\n  // Debounced search\n  const performSearch = useCallback(async (searchQuery) => {\n    if (!searchQuery.trim() || searchQuery.length < 2) {\n      setResults({ projects: [], tickets: [], cors: [], workers: [] })\n      return\n    }\n\n    setLoading(true)\n    try {\n      const searchResults = await db.universalSearch(companyId, searchQuery.trim())\n      setResults(searchResults)\n      setSelectedIndex(0)\n    } catch (error) {\n      console.error('Search error:', error)\n      onShowToast?.('Search failed', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }, [companyId, onShowToast])\n\n  // Handle input change with debounce\n  const handleInputChange = (e) => {\n    const value = e.target.value\n    setQuery(value)\n\n    // Clear previous timeout\n    if (searchTimeoutRef.current) {\n      clearTimeout(searchTimeoutRef.current)\n    }\n\n    // Debounce search\n    searchTimeoutRef.current = setTimeout(() => {\n      performSearch(value)\n    }, 200)\n  }\n\n  // Get all results as flat array for keyboard navigation\n  const getAllResults = () => {\n    const all = []\n    results.projects.forEach(p => all.push({ type: 'project', data: p }))\n    results.tickets.forEach(t => all.push({ type: 'ticket', data: t }))\n    results.cors.forEach(c => all.push({ type: 'cor', data: c }))\n    results.workers.forEach(w => all.push({ type: 'worker', data: w }))\n    return all\n  }\n\n  const allResults = getAllResults()\n  const hasResults = allResults.length > 0\n\n  // Handle keyboard navigation\n  const handleKeyDown = (e) => {\n    if (e.key === 'Escape') {\n      onClose()\n    } else if (e.key === 'ArrowDown') {\n      e.preventDefault()\n      setSelectedIndex(prev => Math.min(prev + 1, allResults.length - 1))\n    } else if (e.key === 'ArrowUp') {\n      e.preventDefault()\n      setSelectedIndex(prev => Math.max(prev - 1, 0))\n    } else if (e.key === 'Enter' && hasResults) {\n      e.preventDefault()\n      handleSelect(allResults[selectedIndex])\n    }\n  }\n\n  // Handle selection\n  const handleSelect = (item) => {\n    if (!item) return\n\n    switch (item.type) {\n      case 'project':\n        onSelectProject?.(item.data)\n        break\n      case 'ticket':\n        onSelectTicket?.(item.data)\n        break\n      case 'cor':\n        onSelectCOR?.(item.data)\n        break\n      case 'worker':\n        // Navigate to project where worker was last seen\n        if (item.data.lastProject) {\n          onSelectProject?.(item.data.lastProject)\n        }\n        break\n    }\n    onClose()\n  }\n\n  // Get icon for result type\n  const getIcon = (type) => {\n    switch (type) {\n      case 'project': return FolderOpen\n      case 'ticket': return FileText\n      case 'cor': return ClipboardList\n      case 'worker': return Users\n      default: return FileText\n    }\n  }\n\n  // Get label for result type\n  const getTypeLabel = (type) => {\n    switch (type) {\n      case 'project': return 'Project'\n      case 'ticket': return 'T&M Ticket'\n      case 'cor': return 'Change Order'\n      case 'worker': return 'Worker'\n      default: return type\n    }\n  }\n\n  if (!isOpen) return null\n\n  return (\n    <div className=\"universal-search-overlay\" onClick={onClose}>\n      <div className=\"universal-search-modal\" onClick={e => e.stopPropagation()}>\n        {/* Search Input */}\n        <div className=\"universal-search-input-wrapper\">\n          <Search size={20} className=\"universal-search-icon\" />\n          <input\n            ref={inputRef}\n            type=\"text\"\n            value={query}\n            onChange={handleInputChange}\n            onKeyDown={handleKeyDown}\n            placeholder=\"Search projects, tickets, CORs, workers...\"\n            className=\"universal-search-input\"\n            autoComplete=\"off\"\n            autoCorrect=\"off\"\n            spellCheck=\"false\"\n          />\n          {query && (\n            <button className=\"universal-search-clear\" onClick={() => setQuery('')}>\n              <X size={16} />\n            </button>\n          )}\n          <div className=\"universal-search-shortcut\">\n            <span>esc</span>\n          </div>\n        </div>\n\n        {/* Results */}\n        <div className=\"universal-search-results\">\n          {loading ? (\n            <div className=\"universal-search-loading\">\n              <div className=\"spinner-small\"></div>\n              <span>Searching...</span>\n            </div>\n          ) : !query.trim() ? (\n            <div className=\"universal-search-empty\">\n              <div className=\"universal-search-tip\">\n                <Command size={14} />\n                <span>Type to search across all data</span>\n              </div>\n              <div className=\"universal-search-hints\">\n                <span>Projects</span>\n                <span>T&M Tickets</span>\n                <span>Change Orders</span>\n                <span>Workers</span>\n              </div>\n            </div>\n          ) : !hasResults ? (\n            <div className=\"universal-search-no-results\">\n              <span>No results for \"{query}\"</span>\n            </div>\n          ) : (\n            <>\n              {/* Projects */}\n              {results.projects.length > 0 && (\n                <div className=\"universal-search-section\">\n                  <div className=\"universal-search-section-header\">\n                    <FolderOpen size={14} />\n                    <span>Projects</span>\n                  </div>\n                  {results.projects.map((project, idx) => {\n                    const globalIdx = idx\n                    return (\n                      <button\n                        key={project.id}\n                        className={`universal-search-item ${selectedIndex === globalIdx ? 'selected' : ''}`}\n                        onClick={() => handleSelect({ type: 'project', data: project })}\n                        onMouseEnter={() => setSelectedIndex(globalIdx)}\n                      >\n                        <FolderOpen size={18} />\n                        <div className=\"universal-search-item-content\">\n                          <span className=\"universal-search-item-title\">{project.name}</span>\n                          {project.job_number && (\n                            <span className=\"universal-search-item-meta\">#{project.job_number}</span>\n                          )}\n                        </div>\n                        <ChevronRight size={16} className=\"universal-search-item-arrow\" />\n                      </button>\n                    )\n                  })}\n                </div>\n              )}\n\n              {/* T&M Tickets */}\n              {results.tickets.length > 0 && (\n                <div className=\"universal-search-section\">\n                  <div className=\"universal-search-section-header\">\n                    <FileText size={14} />\n                    <span>T&M Tickets</span>\n                  </div>\n                  {results.tickets.map((ticket, idx) => {\n                    const globalIdx = results.projects.length + idx\n                    return (\n                      <button\n                        key={ticket.id}\n                        className={`universal-search-item ${selectedIndex === globalIdx ? 'selected' : ''}`}\n                        onClick={() => handleSelect({ type: 'ticket', data: ticket })}\n                        onMouseEnter={() => setSelectedIndex(globalIdx)}\n                      >\n                        <FileText size={18} />\n                        <div className=\"universal-search-item-content\">\n                          <span className=\"universal-search-item-title\">\n                            {ticket.description?.substring(0, 50) || 'T&M Ticket'}\n                            {ticket.description?.length > 50 && '...'}\n                          </span>\n                          <span className=\"universal-search-item-meta\">\n                            {ticket.projectName}  {ticket.work_date}\n                          </span>\n                        </div>\n                        <span className={`universal-search-item-badge ${ticket.status}`}>\n                          {ticket.status}\n                        </span>\n                      </button>\n                    )\n                  })}\n                </div>\n              )}\n\n              {/* Change Orders */}\n              {results.cors.length > 0 && (\n                <div className=\"universal-search-section\">\n                  <div className=\"universal-search-section-header\">\n                    <ClipboardList size={14} />\n                    <span>Change Orders</span>\n                  </div>\n                  {results.cors.map((cor, idx) => {\n                    const globalIdx = results.projects.length + results.tickets.length + idx\n                    return (\n                      <button\n                        key={cor.id}\n                        className={`universal-search-item ${selectedIndex === globalIdx ? 'selected' : ''}`}\n                        onClick={() => handleSelect({ type: 'cor', data: cor })}\n                        onMouseEnter={() => setSelectedIndex(globalIdx)}\n                      >\n                        <ClipboardList size={18} />\n                        <div className=\"universal-search-item-content\">\n                          <span className=\"universal-search-item-title\">\n                            {cor.cor_number ? `COR #${cor.cor_number}: ` : ''}{cor.title}\n                          </span>\n                          <span className=\"universal-search-item-meta\">\n                            {cor.projectName}\n                          </span>\n                        </div>\n                        <span className={`universal-search-item-badge ${cor.status}`}>\n                          {cor.status}\n                        </span>\n                      </button>\n                    )\n                  })}\n                </div>\n              )}\n\n              {/* Workers */}\n              {results.workers.length > 0 && (\n                <div className=\"universal-search-section\">\n                  <div className=\"universal-search-section-header\">\n                    <Users size={14} />\n                    <span>Workers</span>\n                  </div>\n                  {results.workers.map((worker, idx) => {\n                    const globalIdx = results.projects.length + results.tickets.length + results.cors.length + idx\n                    return (\n                      <button\n                        key={`${worker.name}-${idx}`}\n                        className={`universal-search-item ${selectedIndex === globalIdx ? 'selected' : ''}`}\n                        onClick={() => handleSelect({ type: 'worker', data: worker })}\n                        onMouseEnter={() => setSelectedIndex(globalIdx)}\n                      >\n                        <Users size={18} />\n                        <div className=\"universal-search-item-content\">\n                          <span className=\"universal-search-item-title\">{worker.name}</span>\n                          <span className=\"universal-search-item-meta\">\n                            {worker.role}  {worker.projectName}\n                          </span>\n                        </div>\n                        <ChevronRight size={16} className=\"universal-search-item-arrow\" />\n                      </button>\n                    )\n                  })}\n                </div>\n              )}\n            </>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"universal-search-footer\">\n          <div className=\"universal-search-footer-hint\">\n            <span className=\"key\"></span> navigate\n          </div>\n          <div className=\"universal-search-footer-hint\">\n            <span className=\"key\"></span> select\n          </div>\n          <div className=\"universal-search-footer-hint\">\n            <span className=\"key\">esc</span> close\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// Hook for keyboard shortcut\nexport function useUniversalSearch() {\n  const [isOpen, setIsOpen] = useState(false)\n\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      // Cmd+K (Mac) or Ctrl+K (Windows/Linux)\n      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {\n        e.preventDefault()\n        setIsOpen(prev => !prev)\n      }\n    }\n\n    document.addEventListener('keydown', handleKeyDown)\n    return () => document.removeEventListener('keydown', handleKeyDown)\n  }, [])\n\n  return { isOpen, setIsOpen, open: () => setIsOpen(true), close: () => setIsOpen(false) }\n}\n","import React, { useState, useCallback } from 'react'\nimport { AlertTriangle, XCircle, Info, X, ArrowRight } from 'lucide-react'\n\n/**\n * SmartAlerts\n *\n * Container for displaying prioritized actionable alerts.\n * Alerts can be dismissed and are sorted by priority.\n *\n * @param {array} alerts - Array of alert objects\n * @param {function} onAction - Callback when alert action is clicked\n * @param {function} onDismiss - Callback when alert is dismissed\n * @param {number} maxVisible - Maximum alerts to show (default: 3)\n */\nexport function SmartAlerts({\n  alerts = [],\n  onAction,\n  onDismiss,\n  maxVisible = 3,\n  className = ''\n}) {\n  const [dismissedIds, setDismissedIds] = useState(new Set())\n\n  const visibleAlerts = alerts\n    .filter(alert => !dismissedIds.has(alert.id || `${alert.projectId}-${alert.type}-${alert.title}`))\n    .slice(0, maxVisible)\n\n  const handleDismiss = useCallback((alert) => {\n    const alertId = alert.id || `${alert.projectId}-${alert.type}-${alert.title}`\n    setDismissedIds(prev => new Set([...prev, alertId]))\n    onDismiss?.(alert)\n  }, [onDismiss])\n\n  if (visibleAlerts.length === 0) {\n    return null\n  }\n\n  return (\n    <div\n      className={`smart-alerts ${className}`}\n      role=\"region\"\n      aria-label=\"Project alerts\"\n      aria-live=\"polite\"\n    >\n      {visibleAlerts.map((alert, index) => (\n        <SmartAlertCard\n          key={alert.id || `${alert.projectId}-${alert.type}-${index}`}\n          alert={alert}\n          onAction={onAction}\n          onDismiss={() => handleDismiss(alert)}\n        />\n      ))}\n\n      {alerts.length > maxVisible && (\n        <div className=\"smart-alerts__overflow\">\n          <span className=\"smart-alerts__overflow-text\">\n            +{alerts.length - maxVisible} more alerts\n          </span>\n        </div>\n      )}\n    </div>\n  )\n}\n\n/**\n * SmartAlertCard\n *\n * Individual alert card with icon, message, action, and dismiss.\n *\n * @param {object} alert - Alert object\n * @param {function} onAction - Action button click handler\n * @param {function} onDismiss - Dismiss button click handler\n */\nexport function SmartAlertCard({\n  alert,\n  onAction,\n  onDismiss\n}) {\n  const {\n    type = 'info',\n    title,\n    description,\n    action,\n    actionTarget,\n    projectId,\n    projectName\n  } = alert\n\n  const icons = {\n    critical: XCircle,\n    warning: AlertTriangle,\n    info: Info\n  }\n\n  const Icon = icons[type] || Info\n\n  const handleAction = () => {\n    onAction?.({\n      target: actionTarget,\n      projectId,\n      alert\n    })\n  }\n\n  return (\n    <div\n      className={`smart-alert smart-alert--${type}`}\n      role=\"alert\"\n      aria-live={type === 'critical' ? 'assertive' : 'polite'}\n    >\n      <Icon className=\"smart-alert__icon\" aria-hidden=\"true\" />\n\n      <div className=\"smart-alert__content\">\n        <div className=\"smart-alert__title\">\n          {projectName && <span className=\"smart-alert__project\">{projectName}: </span>}\n          {title}\n        </div>\n\n        {description && (\n          <div className=\"smart-alert__description\">{description}</div>\n        )}\n\n        {action && (\n          <div className=\"smart-alert__action\">\n            <button\n              type=\"button\"\n              className=\"smart-alert__action-btn\"\n              onClick={handleAction}\n            >\n              {action}\n              <ArrowRight size={14} aria-hidden=\"true\" />\n            </button>\n          </div>\n        )}\n      </div>\n\n      {onDismiss && (\n        <button\n          type=\"button\"\n          className=\"smart-alert__dismiss\"\n          onClick={onDismiss}\n          aria-label=\"Dismiss alert\"\n        >\n          <X size={18} aria-hidden=\"true\" />\n        </button>\n      )}\n    </div>\n  )\n}\n\n/**\n * AlertSummaryBanner\n *\n * Compact banner showing alert counts by type.\n * Useful when space is limited.\n *\n * @param {array} alerts - Array of alert objects\n * @param {function} onClick - Click handler to expand alerts\n */\nexport function AlertSummaryBanner({ alerts = [], onClick, className = '' }) {\n  const counts = {\n    critical: alerts.filter(a => a.type === 'critical').length,\n    warning: alerts.filter(a => a.type === 'warning').length,\n    info: alerts.filter(a => a.type === 'info').length\n  }\n\n  const total = alerts.length\n\n  if (total === 0) return null\n\n  return (\n    <button\n      type=\"button\"\n      className={`alert-summary-banner ${className}`}\n      onClick={onClick}\n      aria-label={`${total} alerts: ${counts.critical} critical, ${counts.warning} warnings, ${counts.info} info. Click to view.`}\n    >\n      {counts.critical > 0 && (\n        <span className=\"alert-summary-banner__item alert-summary-banner__item--critical\">\n          <XCircle size={14} aria-hidden=\"true\" />\n          {counts.critical}\n        </span>\n      )}\n      {counts.warning > 0 && (\n        <span className=\"alert-summary-banner__item alert-summary-banner__item--warning\">\n          <AlertTriangle size={14} aria-hidden=\"true\" />\n          {counts.warning}\n        </span>\n      )}\n      {counts.info > 0 && (\n        <span className=\"alert-summary-banner__item alert-summary-banner__item--info\">\n          <Info size={14} aria-hidden=\"true\" />\n          {counts.info}\n        </span>\n      )}\n      <ArrowRight size={14} className=\"alert-summary-banner__arrow\" aria-hidden=\"true\" />\n    </button>\n  )\n}\n\n/**\n * NoAlertsMessage\n *\n * Positive message when there are no alerts.\n */\nexport function NoAlertsMessage({ className = '' }) {\n  return (\n    <div className={`no-alerts-message ${className}`}>\n      <span className=\"no-alerts-message__icon\" aria-hidden=\"true\"></span>\n      <span className=\"no-alerts-message__text\">All projects on track</span>\n    </div>\n  )\n}\n\n/**\n * Helper to aggregate alerts from multiple projects\n */\nexport function aggregateAlerts(projectAlerts) {\n  // Flatten all alerts from all projects\n  const allAlerts = projectAlerts.flatMap(p => p.alerts || [])\n\n  // Sort by priority\n  const priorityOrder = { critical: 0, warning: 1, info: 2 }\n  allAlerts.sort((a, b) => {\n    const priorityDiff = priorityOrder[a.type] - priorityOrder[b.type]\n    if (priorityDiff !== 0) return priorityDiff\n    // Secondary sort by project name\n    return (a.projectName || '').localeCompare(b.projectName || '')\n  })\n\n  return allAlerts\n}\n\nexport default SmartAlerts\n","import { memo, useEffect, useState, useRef } from 'react'\n\n/**\n * OverviewProgressGauge - Large circular progress indicator for project overview\n * Shows completion percentage with animated stroke and areas status\n */\nexport const OverviewProgressGauge = memo(function OverviewProgressGauge({\n  progress = 0,\n  areasComplete = 0,\n  totalAreas = 0,\n  areasWorking = 0,\n  size = 110,\n  strokeWidth = 9\n}) {\n  const [animatedProgress, setAnimatedProgress] = useState(0)\n  const animationRef = useRef(null)\n\n  // Animate progress on mount/change\n  useEffect(() => {\n    const startValue = animatedProgress\n    const endValue = Math.min(100, Math.max(0, progress))\n    const duration = 800\n    const startTime = performance.now()\n\n    const animate = (currentTime) => {\n      const elapsed = currentTime - startTime\n      const progressRatio = Math.min(elapsed / duration, 1)\n\n      // Ease out cubic\n      const eased = 1 - Math.pow(1 - progressRatio, 3)\n      const current = startValue + (endValue - startValue) * eased\n\n      setAnimatedProgress(current)\n\n      if (progressRatio < 1) {\n        animationRef.current = requestAnimationFrame(animate)\n      }\n    }\n\n    animationRef.current = requestAnimationFrame(animate)\n\n    return () => {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current)\n      }\n    }\n  }, [progress])\n\n  const radius = (size - strokeWidth) / 2\n  const circumference = radius * 2 * Math.PI\n  const offset = circumference - (animatedProgress / 100) * circumference\n\n  // Color based on progress\n  const getProgressColor = () => {\n    if (animatedProgress >= 80) return 'var(--accent-green)'\n    if (animatedProgress >= 50) return 'var(--accent-blue)'\n    if (animatedProgress >= 25) return 'var(--accent-blue)'\n    return 'var(--text-muted)'\n  }\n\n  return (\n    <div className=\"overview-progress-gauge\">\n      <div className=\"progress-gauge-circle\" style={{ width: size, height: size }}>\n        <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>\n          {/* Background track */}\n          <circle\n            className=\"gauge-track\"\n            cx={size / 2}\n            cy={size / 2}\n            r={radius}\n            fill=\"none\"\n            strokeWidth={strokeWidth}\n            stroke=\"var(--bg-tertiary)\"\n          />\n          {/* Progress arc */}\n          <circle\n            className=\"gauge-fill\"\n            cx={size / 2}\n            cy={size / 2}\n            r={radius}\n            fill=\"none\"\n            stroke={getProgressColor()}\n            strokeWidth={strokeWidth}\n            strokeDasharray={circumference}\n            strokeDashoffset={offset}\n            strokeLinecap=\"round\"\n            transform={`rotate(-90 ${size / 2} ${size / 2})`}\n            style={{ transition: 'stroke 0.3s ease' }}\n          />\n        </svg>\n        {/* Center content */}\n        <div className=\"gauge-center\">\n          <span className=\"gauge-value\">{Math.round(animatedProgress)}%</span>\n          <span className=\"gauge-label\">Complete</span>\n        </div>\n      </div>\n\n      {/* Areas status below */}\n      <div className=\"gauge-areas-status\">\n        <span className=\"areas-count\">\n          <strong>{areasComplete}</strong>/{totalAreas} Areas Done\n        </span>\n        {areasWorking > 0 && (\n          <span className=\"areas-active\">{areasWorking} active</span>\n        )}\n      </div>\n    </div>\n  )\n})\n\nexport default OverviewProgressGauge\n","// ============================================\n// Chart Configuration\n// ============================================\n// Centralized theme colors, animations, and styles\n// for all financial dashboard charts.\n// ============================================\n\n// Chart color palette - matches app theme\nexport const chartColors = {\n  // Financial lines\n  contract: '#3b82f6',     // Blue - contract ceiling\n  revenue: '#10b981',      // Green - earned revenue\n  costs: '#f59e0b',        // Amber - spending\n  profit: '#22c55e',       // Emerald - positive profit\n  loss: '#ef4444',         // Red - negative/loss\n\n  // Extra work\n  tmValue: '#8b5cf6',      // Purple - T&M ticket value\n  corValue: '#14b8a6',     // Teal - COR approved value\n\n  // Cost categories\n  labor: '#6366f1',        // Indigo\n  disposal: '#14b8a6',     // Teal\n  equipment: '#f97316',    // Orange\n  materials: '#a855f7',    // Purple\n  subcontractor: '#ec4899', // Pink\n  other: '#6b7280',        // Gray\n\n  // UI\n  grid: 'var(--border-color)',\n  text: 'var(--text-secondary)',\n  background: 'var(--bg-card)',\n}\n\n// Animation configuration\nexport const animationConfig = {\n  duration: 800,\n  easing: 'ease-out',\n}\n\n// Common tooltip styles\nexport const tooltipStyle = {\n  contentStyle: {\n    background: 'var(--bg-card)',\n    border: '1px solid var(--border-color)',\n    borderRadius: '8px',\n    boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\n    padding: '12px 16px',\n  },\n  labelStyle: {\n    color: 'var(--text-primary)',\n    fontWeight: 600,\n    marginBottom: '8px',\n  },\n  itemStyle: {\n    color: 'var(--text-secondary)',\n    padding: '2px 0',\n  },\n}\n\n// Cost category configuration\nexport const costCategories = {\n  labor: {\n    label: 'Labor',\n    color: chartColors.labor,\n    icon: 'HardHat',\n  },\n  disposal: {\n    label: 'Disposal',\n    color: chartColors.disposal,\n    icon: 'Trash2',\n  },\n  equipment: {\n    label: 'Equipment',\n    color: chartColors.equipment,\n    icon: 'Truck',\n  },\n  materials: {\n    label: 'Materials',\n    color: chartColors.materials,\n    icon: 'Package',\n  },\n  subcontractor: {\n    label: 'Subcontractor',\n    color: chartColors.subcontractor,\n    icon: 'Users',\n  },\n  other: {\n    label: 'Other',\n    color: chartColors.other,\n    icon: 'MoreHorizontal',\n  },\n}\n\n// Time range options for charts\nexport const timeRanges = [\n  { id: '7d', label: '7D', days: 7 },\n  { id: '30d', label: '30D', days: 30 },\n  { id: '90d', label: '90D', days: 90 },\n  { id: 'all', label: 'All', days: null },\n]\n\n// Format currency for chart labels\nexport const formatChartCurrency = (value) => {\n  if (value >= 1000000) {\n    return `$${(value / 1000000).toFixed(1)}M`\n  }\n  if (value >= 1000) {\n    return `$${(value / 1000).toFixed(0)}K`\n  }\n  return `$${value.toFixed(0)}`\n}\n\n// Format date for chart axis\nexport const formatChartDate = (dateStr) => {\n  const date = new Date(dateStr)\n  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\n}\n\n// Gradient definitions for area charts\nexport const gradientDefs = {\n  revenue: {\n    id: 'revenueGradient',\n    color: chartColors.revenue,\n    startOpacity: 0.3,\n    endOpacity: 0,\n  },\n  costs: {\n    id: 'costsGradient',\n    color: chartColors.costs,\n    startOpacity: 0.3,\n    endOpacity: 0,\n  },\n  tmValue: {\n    id: 'tmValueGradient',\n    color: chartColors.tmValue,\n    startOpacity: 0.2,\n    endOpacity: 0,\n  },\n}\n","import { memo } from 'react'\nimport { chartColors } from '../charts/chartConfig'\n\n/**\n * OverviewFinancialCard - Compact financial snapshot for project overview\n * Shows earned, costs, profit with mini cost breakdown bar\n */\nexport const OverviewFinancialCard = memo(function OverviewFinancialCard({\n  earnedRevenue = 0,\n  totalCosts = 0,\n  laborCost = 0,\n  disposalCost = 0,\n  equipmentCost = 0,\n  materialsCost = 0,\n  otherCost = 0,\n  contractValue = 0\n}) {\n  const profit = earnedRevenue - totalCosts\n  const margin = earnedRevenue > 0 ? (profit / earnedRevenue) * 100 : 0\n  const isPositive = profit >= 0\n\n  // Format currency\n  const formatCurrency = (value) => {\n    if (value >= 1000000) {\n      return `$${(value / 1000000).toFixed(1)}M`\n    }\n    if (value >= 1000) {\n      return `$${(value / 1000).toFixed(1)}K`\n    }\n    return `$${value.toFixed(0)}`\n  }\n\n  // Calculate cost breakdown percentages for the stacked bar\n  const costBreakdown = [\n    { key: 'labor', value: laborCost, color: chartColors.labor, label: 'Labor' },\n    { key: 'disposal', value: disposalCost, color: chartColors.disposal, label: 'Disposal' },\n    { key: 'equipment', value: equipmentCost, color: chartColors.equipment, label: 'Equipment' },\n    { key: 'materials', value: materialsCost, color: chartColors.materials, label: 'Materials' },\n    { key: 'other', value: otherCost, color: chartColors.other, label: 'Other' }\n  ].filter(item => item.value > 0)\n\n  const hasBreakdown = costBreakdown.length > 0 && totalCosts > 0\n\n  return (\n    <div className=\"overview-financial-card animate-fade-in-up\">\n      {/* Main metrics row */}\n      <div className=\"financial-metrics-row\">\n        {/* Earned */}\n        <div className=\"financial-metric\">\n          <span className=\"financial-metric-value green\">{formatCurrency(earnedRevenue)}</span>\n          <span className=\"financial-metric-label\">Earned</span>\n        </div>\n\n        {/* Costs */}\n        <div className=\"financial-metric\">\n          <span className=\"financial-metric-value amber\">{formatCurrency(totalCosts)}</span>\n          <span className=\"financial-metric-label\">Costs</span>\n        </div>\n\n        {/* Profit */}\n        <div className=\"financial-metric\">\n          <span className={`financial-metric-value ${isPositive ? 'green' : 'red'}`}>\n            {isPositive ? '' : '-'}{formatCurrency(Math.abs(profit))}\n          </span>\n          <span className=\"financial-metric-label\">\n            Profit\n            <span className={`margin-badge ${isPositive ? 'positive' : 'negative'}`}>\n              {margin >= 0 ? '+' : ''}{margin.toFixed(0)}%\n            </span>\n          </span>\n        </div>\n      </div>\n\n      {/* Cost breakdown bar */}\n      {hasBreakdown && (\n        <div className=\"cost-breakdown-section\">\n          <div className=\"cost-breakdown-bar\">\n            {costBreakdown.map((item, index) => {\n              const widthPercent = (item.value / totalCosts) * 100\n              return (\n                <div\n                  key={item.key}\n                  className=\"cost-segment\"\n                  style={{\n                    width: `${widthPercent}%`,\n                    backgroundColor: item.color,\n                    animationDelay: `${index * 100}ms`\n                  }}\n                  title={`${item.label}: ${formatCurrency(item.value)} (${widthPercent.toFixed(0)}%)`}\n                />\n              )\n            })}\n          </div>\n          <div className=\"cost-breakdown-legend\">\n            {costBreakdown.slice(0, 4).map(item => (\n              <span key={item.key} className=\"legend-item\">\n                <span className=\"legend-dot\" style={{ backgroundColor: item.color }} />\n                <span className=\"legend-label\">{item.label}</span>\n              </span>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n})\n\nexport default OverviewFinancialCard\n","import { memo, useState, useEffect, useMemo, useCallback } from 'react'\nimport { Users, HardHat, Wrench, Calendar, Download, ChevronLeft, ChevronRight } from 'lucide-react'\nimport {\n  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer\n} from 'recharts'\nimport { db } from '../../lib/supabase'\nimport { chartColors, tooltipStyle, formatChartDate } from '../charts/chartConfig'\n\n/**\n * OverviewCrewMetrics - Crew on-site metrics for project overview\n * Shows total crew count, contract vs T&M worker breakdown by day\n * Includes a day-by-day stacked bar chart timeline\n */\n\nconst loadJsPDF = () => import('jspdf')\n\n// Colors for contract vs T&M\nconst CREW_COLORS = {\n  contract: chartColors.contract,  // Blue\n  tm: chartColors.costs,           // Amber\n  total: chartColors.labor         // Indigo\n}\n\nconst TIME_RANGES = [\n  { id: '7d', label: '7D', days: 7 },\n  { id: '14d', label: '14D', days: 14 },\n  { id: '30d', label: '30D', days: 30 },\n]\n\nexport const OverviewCrewMetrics = memo(function OverviewCrewMetrics({\n  project,\n  onShowToast\n}) {\n  const [crewHistory, setCrewHistory] = useState([])\n  const [tmTickets, setTmTickets] = useState([])\n  const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0])\n  const [timeRange, setTimeRange] = useState('14d')\n  const [loading, setLoading] = useState(true)\n  const [exporting, setExporting] = useState(false)\n\n  // Load all crew check-in history and T&M tickets\n  useEffect(() => {\n    if (!project?.id) return\n    loadData()\n  }, [project?.id])\n\n  const loadData = async () => {\n    setLoading(true)\n    try {\n      const [history, tickets] = await Promise.all([\n        db.getCrewCheckinHistory(project.id, 365),\n        db.getTMTickets(project.id)\n      ])\n      setCrewHistory(history || [])\n      setTmTickets(tickets || [])\n    } catch (error) {\n      console.error('Error loading crew metrics:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Build a lookup: date -> Set of T&M worker names\n  const tmWorkersByDate = useMemo(() => {\n    const map = {}\n    tmTickets.forEach(ticket => {\n      const date = ticket.work_date\n      if (!date) return\n      if (!map[date]) map[date] = new Set()\n      ;(ticket.t_and_m_workers || []).forEach(w => {\n        map[date].add(w.name.toLowerCase().trim())\n      })\n    })\n    return map\n  }, [tmTickets])\n\n  // Build crew lookup: date -> workers array\n  const crewByDate = useMemo(() => {\n    const map = {}\n    crewHistory.forEach(checkin => {\n      map[checkin.check_in_date] = checkin.workers || []\n    })\n    return map\n  }, [crewHistory])\n\n  // Selected date metrics\n  const selectedDayWorkers = crewByDate[selectedDate] || []\n  const selectedDayTmNames = tmWorkersByDate[selectedDate] || new Set()\n\n  const todayMetrics = useMemo(() => {\n    const contract = []\n    const tm = []\n    selectedDayWorkers.forEach(w => {\n      if (selectedDayTmNames.has(w.name.toLowerCase().trim())) {\n        tm.push(w)\n      } else {\n        contract.push(w)\n      }\n    })\n    return { total: selectedDayWorkers.length, contract, tm }\n  }, [selectedDayWorkers, selectedDayTmNames])\n\n  // Build chart data for time range\n  const chartData = useMemo(() => {\n    const rangeDays = TIME_RANGES.find(r => r.id === timeRange)?.days || 14\n    const data = []\n    const today = new Date()\n\n    for (let i = rangeDays - 1; i >= 0; i--) {\n      const d = new Date(today)\n      d.setDate(d.getDate() - i)\n      const dateStr = d.toISOString().split('T')[0]\n\n      const workers = crewByDate[dateStr] || []\n      const tmNames = tmWorkersByDate[dateStr] || new Set()\n\n      let contractCount = 0\n      let tmCount = 0\n      workers.forEach(w => {\n        if (tmNames.has(w.name.toLowerCase().trim())) {\n          tmCount++\n        } else {\n          contractCount++\n        }\n      })\n\n      data.push({\n        date: dateStr,\n        displayDate: formatChartDate(dateStr),\n        contract: contractCount,\n        tm: tmCount,\n        total: workers.length\n      })\n    }\n\n    return data\n  }, [crewByDate, tmWorkersByDate, timeRange])\n\n  // Navigate dates\n  const changeDate = useCallback((direction) => {\n    const d = new Date(selectedDate + 'T12:00:00')\n    d.setDate(d.getDate() + direction)\n    setSelectedDate(d.toISOString().split('T')[0])\n  }, [selectedDate])\n\n  const isToday = selectedDate === new Date().toISOString().split('T')[0]\n\n  const formatDate = (dateStr) => {\n    const d = new Date(dateStr + 'T12:00:00')\n    return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })\n  }\n\n  // Click a bar in the chart to select that date\n  const handleBarClick = useCallback((data) => {\n    if (data?.date) {\n      setSelectedDate(data.date)\n    }\n  }, [])\n\n  // Custom tooltip for the chart\n  const CustomTooltip = ({ active, payload, label }) => {\n    if (!active || !payload?.length) return null\n    const total = (payload[0]?.value || 0) + (payload[1]?.value || 0)\n    return (\n      <div style={{\n        ...tooltipStyle.contentStyle,\n        fontSize: '0.8rem'\n      }}>\n        <p style={{ ...tooltipStyle.labelStyle, fontSize: '0.85rem', marginBottom: 6 }}>{label}</p>\n        <p style={{ margin: '3px 0', color: CREW_COLORS.contract }}>\n          Contract: <strong>{payload[0]?.value || 0}</strong>\n        </p>\n        <p style={{ margin: '3px 0', color: CREW_COLORS.tm }}>\n          T&M: <strong>{payload[1]?.value || 0}</strong>\n        </p>\n        <p style={{ margin: '3px 0', color: 'var(--text-primary)', borderTop: '1px solid var(--border-color)', paddingTop: 4 }}>\n          Total: <strong>{total}</strong>\n        </p>\n      </div>\n    )\n  }\n\n  // PDF Export\n  const exportCrewPDF = useCallback(async () => {\n    setExporting(true)\n    onShowToast?.('Generating crew report PDF...', 'info')\n\n    try {\n      const jsPDFModule = await loadJsPDF()\n      const jsPDF = jsPDFModule.default\n      const doc = new jsPDF()\n\n      const pageWidth = doc.internal.pageSize.width\n      let y = 20\n\n      // Header\n      doc.setFontSize(18)\n      doc.setFont(undefined, 'bold')\n      doc.text('Crew On-Site Report', pageWidth / 2, y, { align: 'center' })\n      y += 8\n\n      doc.setFontSize(11)\n      doc.setFont(undefined, 'normal')\n      doc.text(`Project: ${project.name}`, pageWidth / 2, y, { align: 'center' })\n      y += 6\n      doc.text(`Date: ${formatDate(selectedDate)}`, pageWidth / 2, y, { align: 'center' })\n      y += 12\n\n      // Summary stats\n      doc.setFontSize(12)\n      doc.setFont(undefined, 'bold')\n      doc.text('Selected Day Summary', 14, y)\n      y += 7\n\n      doc.setFontSize(10)\n      doc.setFont(undefined, 'normal')\n      doc.text(`Total Crew On-Site: ${todayMetrics.total}`, 14, y); y += 5\n      doc.text(`Contract Workers: ${todayMetrics.contract.length}`, 14, y); y += 5\n      doc.text(`T&M Workers: ${todayMetrics.tm.length}`, 14, y); y += 10\n\n      // Contract Workers\n      if (todayMetrics.contract.length > 0) {\n        doc.setFontSize(12)\n        doc.setFont(undefined, 'bold')\n        doc.text('Contract Workers', 14, y); y += 7\n\n        doc.setFontSize(9)\n        doc.setFont(undefined, 'bold')\n        doc.text('Name', 14, y)\n        doc.text('Role', 100, y); y += 5\n\n        doc.setFont(undefined, 'normal')\n        todayMetrics.contract.forEach(w => {\n          if (y > 270) { doc.addPage(); y = 20 }\n          doc.text(w.name, 14, y)\n          doc.text(w.role || '', 100, y); y += 5\n        })\n        y += 8\n      }\n\n      // T&M Workers\n      if (todayMetrics.tm.length > 0) {\n        if (y > 240) { doc.addPage(); y = 20 }\n        doc.setFontSize(12)\n        doc.setFont(undefined, 'bold')\n        doc.text('T&M Workers (Extra Work)', 14, y); y += 7\n\n        doc.setFontSize(9)\n        doc.setFont(undefined, 'bold')\n        doc.text('Name', 14, y)\n        doc.text('Role', 100, y); y += 5\n\n        doc.setFont(undefined, 'normal')\n        todayMetrics.tm.forEach(w => {\n          if (y > 270) { doc.addPage(); y = 20 }\n          doc.text(w.name, 14, y)\n          doc.text(w.role || '', 100, y); y += 5\n        })\n        y += 8\n      }\n\n      // Timeline table\n      if (y > 200) { doc.addPage(); y = 20 }\n      doc.setFontSize(12)\n      doc.setFont(undefined, 'bold')\n      doc.text('Daily Timeline', 14, y); y += 7\n\n      doc.setFontSize(8)\n      doc.setFont(undefined, 'bold')\n      doc.text('Date', 14, y)\n      doc.text('Total', 70, y)\n      doc.text('Contract', 95, y)\n      doc.text('T&M', 125, y); y += 5\n\n      doc.setFont(undefined, 'normal')\n      chartData.forEach(day => {\n        if (y > 275) { doc.addPage(); y = 20 }\n        doc.text(day.displayDate, 14, y)\n        doc.text(String(day.total), 70, y)\n        doc.text(String(day.contract), 95, y)\n        doc.text(String(day.tm), 125, y)\n        y += 4.5\n      })\n\n      // Footer\n      const footerY = doc.internal.pageSize.height - 10\n      doc.setFontSize(8)\n      doc.setTextColor(128, 128, 128)\n      doc.text(`Generated ${new Date().toLocaleString()}  FieldSync`, pageWidth / 2, footerY, { align: 'center' })\n\n      const fileName = `${project.name}_Crew_Report_${selectedDate}.pdf`\n      doc.save(fileName)\n      onShowToast?.('PDF exported!', 'success')\n    } catch (error) {\n      console.error('Error exporting crew PDF:', error)\n      onShowToast?.('Error generating PDF', 'error')\n    } finally {\n      setExporting(false)\n    }\n  }, [project, selectedDate, todayMetrics, chartData, onShowToast])\n\n  if (loading) {\n    return (\n      <div className=\"crew-metrics-card animate-fade-in-up\">\n        <div className=\"crew-metrics-header\">\n          <h3><Users size={18} /> Crew On-Site</h3>\n        </div>\n        <div className=\"crew-metrics-loading\">\n          <div className=\"skeleton-stat\"></div>\n          <div className=\"skeleton-stat\"></div>\n          <div className=\"skeleton-stat\"></div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"crew-metrics-card animate-fade-in-up\">\n      {/* Header with export */}\n      <div className=\"crew-metrics-header\">\n        <h3><Users size={18} /> Crew On-Site</h3>\n        <div className=\"crew-metrics-actions\">\n          <button\n            className=\"btn btn-secondary btn-small\"\n            onClick={exportCrewPDF}\n            disabled={exporting}\n            title=\"Export crew report as PDF\"\n          >\n            <Download size={14} /> {exporting ? 'Exporting...' : 'PDF'}\n          </button>\n        </div>\n      </div>\n\n      {/* Date navigator */}\n      <div className=\"crew-date-nav\">\n        <button className=\"crew-date-btn\" onClick={() => changeDate(-1)}>\n          <ChevronLeft size={16} />\n        </button>\n        <span className=\"crew-date-label\">\n          <Calendar size={14} />\n          {isToday ? 'Today' : formatDate(selectedDate)}\n        </span>\n        <button className=\"crew-date-btn\" onClick={() => changeDate(1)} disabled={isToday}>\n          <ChevronRight size={16} />\n        </button>\n      </div>\n\n      {/* Stats row for selected day */}\n      <div className=\"crew-stats-row\">\n        <div className=\"crew-stat total\">\n          <div className=\"crew-stat-icon\"><Users size={20} /></div>\n          <div className=\"crew-stat-content\">\n            <span className=\"crew-stat-value\">{todayMetrics.total}</span>\n            <span className=\"crew-stat-label\">Total On-Site</span>\n          </div>\n        </div>\n\n        <div className=\"crew-stat contract\">\n          <div className=\"crew-stat-icon\"><HardHat size={20} /></div>\n          <div className=\"crew-stat-content\">\n            <span className=\"crew-stat-value\">{todayMetrics.contract.length}</span>\n            <span className=\"crew-stat-label\">Contract</span>\n          </div>\n        </div>\n\n        <div className=\"crew-stat tm\">\n          <div className=\"crew-stat-icon\"><Wrench size={20} /></div>\n          <div className=\"crew-stat-content\">\n            <span className=\"crew-stat-value\">{todayMetrics.tm.length}</span>\n            <span className=\"crew-stat-label\">T&M</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Breakdown bar for selected day */}\n      {todayMetrics.total > 0 && (\n        <div className=\"crew-breakdown-bar\">\n          <div\n            className=\"crew-bar-segment contract\"\n            style={{ width: `${(todayMetrics.contract.length / todayMetrics.total) * 100}%` }}\n            title={`${todayMetrics.contract.length} Contract`}\n          />\n          <div\n            className=\"crew-bar-segment tm\"\n            style={{ width: `${(todayMetrics.tm.length / todayMetrics.total) * 100}%` }}\n            title={`${todayMetrics.tm.length} T&M`}\n          />\n        </div>\n      )}\n\n      {/* Worker name lists */}\n      {todayMetrics.total > 0 && (\n        <div className=\"crew-name-lists\">\n          {todayMetrics.contract.length > 0 && (\n            <div className=\"crew-name-group\">\n              <div className=\"crew-name-group-header contract\">\n                <HardHat size={13} />\n                <span>Contract ({todayMetrics.contract.length})</span>\n              </div>\n              <div className=\"crew-name-tags\">\n                {todayMetrics.contract.map((w, i) => (\n                  <span key={i} className=\"crew-name-tag contract\">\n                    {w.name}\n                    {w.role && w.role !== 'Laborer' && (\n                      <span className=\"crew-name-role\">{w.role}</span>\n                    )}\n                  </span>\n                ))}\n              </div>\n            </div>\n          )}\n          {todayMetrics.tm.length > 0 && (\n            <div className=\"crew-name-group\">\n              <div className=\"crew-name-group-header tm\">\n                <Wrench size={13} />\n                <span>T&M ({todayMetrics.tm.length})</span>\n              </div>\n              <div className=\"crew-name-tags\">\n                {todayMetrics.tm.map((w, i) => (\n                  <span key={i} className=\"crew-name-tag tm\">\n                    {w.name}\n                    {w.role && w.role !== 'Laborer' && (\n                      <span className=\"crew-name-role\">{w.role}</span>\n                    )}\n                  </span>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Day-by-day timeline chart */}\n      <div className=\"crew-timeline-section\">\n        <div className=\"crew-timeline-header\">\n          <span className=\"crew-timeline-title\">Daily Breakdown</span>\n          <div className=\"crew-time-range-pills\">\n            {TIME_RANGES.map(range => (\n              <button\n                key={range.id}\n                className={`crew-range-pill ${timeRange === range.id ? 'active' : ''}`}\n                onClick={() => setTimeRange(range.id)}\n              >\n                {range.label}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        <div className=\"crew-chart-container\">\n          <ResponsiveContainer width=\"100%\" height={140}>\n            <BarChart\n              data={chartData}\n              onClick={(e) => e?.activePayload?.[0] && handleBarClick(e.activePayload[0].payload)}\n              style={{ cursor: 'pointer' }}\n            >\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"var(--border-color)\" vertical={false} />\n              <XAxis\n                dataKey=\"displayDate\"\n                tick={{ fontSize: 10, fill: 'var(--text-muted)' }}\n                axisLine={{ stroke: 'var(--border-color)' }}\n                tickLine={false}\n                interval={timeRange === '30d' ? 4 : timeRange === '14d' ? 1 : 0}\n              />\n              <YAxis\n                tick={{ fontSize: 10, fill: 'var(--text-muted)' }}\n                axisLine={false}\n                tickLine={false}\n                allowDecimals={false}\n                width={30}\n              />\n              <Tooltip content={<CustomTooltip />} />\n              <Legend\n                wrapperStyle={{ fontSize: '0.75rem', paddingTop: 4 }}\n                iconType=\"circle\"\n                iconSize={8}\n              />\n              <Bar\n                dataKey=\"contract\"\n                name=\"Contract\"\n                stackId=\"crew\"\n                fill={CREW_COLORS.contract}\n                radius={[0, 0, 0, 0]}\n              />\n              <Bar\n                dataKey=\"tm\"\n                name=\"T&M (Extra Work)\"\n                stackId=\"crew\"\n                fill={CREW_COLORS.tm}\n                radius={[3, 3, 0, 0]}\n              />\n            </BarChart>\n          </ResponsiveContainer>\n        </div>\n      </div>\n\n      {/* Empty state */}\n      {todayMetrics.total === 0 && (\n        <div className=\"crew-empty\">\n          <p>No crew checked in for this date</p>\n        </div>\n      )}\n    </div>\n  )\n})\n\nexport default OverviewCrewMetrics\n","import { memo } from 'react'\n\n/**\n * Skeleton - Loading placeholder component\n * Follows progressive disclosure principle - shows structure before content\n */\n\n// Base skeleton with shimmer animation\nexport const Skeleton = memo(function Skeleton({\n  width,\n  height,\n  borderRadius = '8px',\n  className = '',\n  variant = 'default' // 'default' | 'text' | 'circular' | 'rectangular'\n}) {\n  const getVariantStyles = () => {\n    switch (variant) {\n      case 'text':\n        return { height: '1em', borderRadius: '4px' }\n      case 'circular':\n        return { borderRadius: '50%' }\n      case 'rectangular':\n        return { borderRadius: '0' }\n      default:\n        return { borderRadius }\n    }\n  }\n\n  const variantStyles = getVariantStyles()\n\n  return (\n    <div\n      className={`skeleton ${className}`}\n      style={{\n        width: width || '100%',\n        height: height || variantStyles.height || '1rem',\n        borderRadius: variantStyles.borderRadius,\n      }}\n      aria-hidden=\"true\"\n    />\n  )\n})\n\n// Skeleton for metric cards (value + label)\nexport const MetricSkeleton = memo(function MetricSkeleton({ showProgress = false }) {\n  return (\n    <div className=\"metric-skeleton\">\n      <Skeleton width=\"60%\" height=\"0.75rem\" className=\"skeleton-label\" />\n      <Skeleton width=\"80%\" height=\"1.75rem\" className=\"skeleton-value\" />\n      {showProgress && (\n        <Skeleton width=\"100%\" height=\"6px\" className=\"skeleton-progress\" />\n      )}\n    </div>\n  )\n})\n\n// Skeleton for cards (header + content)\nexport const CardSkeleton = memo(function CardSkeleton({\n  lines = 3,\n  showHeader = true,\n  showAction = false\n}) {\n  return (\n    <div className=\"card-skeleton\" aria-busy=\"true\" aria-label=\"Loading content\">\n      {showHeader && (\n        <div className=\"card-skeleton-header\">\n          <Skeleton width=\"40%\" height=\"1.25rem\" />\n          {showAction && <Skeleton width=\"80px\" height=\"32px\" />}\n        </div>\n      )}\n      <div className=\"card-skeleton-body\">\n        {Array.from({ length: lines }).map((_, i) => (\n          <Skeleton\n            key={i}\n            width={`${100 - (i * 15)}%`}\n            height=\"1rem\"\n            className=\"skeleton-line\"\n          />\n        ))}\n      </div>\n    </div>\n  )\n})\n\n// Skeleton for list items\nexport const ListItemSkeleton = memo(function ListItemSkeleton({\n  count = 3,\n  showAvatar = false,\n  showAction = false\n}) {\n  return (\n    <div className=\"list-skeleton\" aria-busy=\"true\" aria-label=\"Loading list\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"list-item-skeleton\">\n          {showAvatar && <Skeleton width=\"40px\" height=\"40px\" variant=\"circular\" />}\n          <div className=\"list-item-skeleton-content\">\n            <Skeleton width=\"60%\" height=\"1rem\" />\n            <Skeleton width=\"40%\" height=\"0.75rem\" />\n          </div>\n          {showAction && <Skeleton width=\"60px\" height=\"28px\" />}\n        </div>\n      ))}\n    </div>\n  )\n})\n\n// Skeleton for financial analysis row (3 cards)\nexport const FinancialRowSkeleton = memo(function FinancialRowSkeleton() {\n  return (\n    <div className=\"financial-row-skeleton\" aria-busy=\"true\" aria-label=\"Loading financial data\">\n      {[1, 2, 3].map(i => (\n        <div key={i} className=\"financial-card-skeleton\">\n          <div className=\"financial-card-skeleton-header\">\n            <Skeleton width=\"24px\" height=\"24px\" variant=\"circular\" />\n            <Skeleton width=\"60%\" height=\"1rem\" />\n          </div>\n          <Skeleton width=\"50%\" height=\"2rem\" className=\"skeleton-hero-value\" />\n          <div className=\"financial-card-skeleton-details\">\n            <Skeleton width=\"100%\" height=\"0.875rem\" />\n            <Skeleton width=\"80%\" height=\"0.875rem\" />\n          </div>\n        </div>\n      ))}\n    </div>\n  )\n})\n\n// Skeleton for chart placeholder\nexport const ChartSkeleton = memo(function ChartSkeleton({ height = '200px' }) {\n  return (\n    <div className=\"chart-skeleton\" style={{ height }} aria-busy=\"true\" aria-label=\"Loading chart\">\n      <div className=\"chart-skeleton-bars\">\n        {[40, 65, 45, 80, 55, 70, 50, 75, 60, 85].map((h, i) => (\n          <div\n            key={i}\n            className=\"chart-skeleton-bar\"\n            style={{ height: `${h}%` }}\n          />\n        ))}\n      </div>\n      <Skeleton width=\"100%\" height=\"1px\" className=\"chart-skeleton-axis\" />\n    </div>\n  )\n})\n\n// Skeleton for COR/Ticket items\nexport const TicketSkeleton = memo(function TicketSkeleton({ count = 3 }) {\n  return (\n    <div className=\"ticket-skeleton-list\" aria-busy=\"true\" aria-label=\"Loading tickets\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"ticket-skeleton-item\">\n          <div className=\"ticket-skeleton-header\">\n            <Skeleton width=\"100px\" height=\"0.875rem\" />\n            <Skeleton width=\"80px\" height=\"24px\" borderRadius=\"12px\" />\n          </div>\n          <Skeleton width=\"90%\" height=\"1rem\" />\n          <div className=\"ticket-skeleton-footer\">\n            <Skeleton width=\"60px\" height=\"0.75rem\" />\n            <Skeleton width=\"60px\" height=\"0.75rem\" />\n            <Skeleton width=\"60px\" height=\"0.75rem\" />\n          </div>\n        </div>\n      ))}\n    </div>\n  )\n})\n\n// Skeleton for hero metrics row\nexport const HeroMetricsSkeleton = memo(function HeroMetricsSkeleton() {\n  return (\n    <div className=\"hero-metrics-skeleton\" aria-busy=\"true\" aria-label=\"Loading metrics\">\n      {[1, 2, 3, 4].map(i => (\n        <div key={i} className=\"hero-metric-skeleton\">\n          <Skeleton width=\"80px\" height=\"0.75rem\" className=\"skeleton-label\" />\n          <Skeleton width=\"120px\" height=\"1.75rem\" className=\"skeleton-value\" />\n          <Skeleton width=\"100%\" height=\"4px\" className=\"skeleton-bar\" />\n        </div>\n      ))}\n    </div>\n  )\n})\n\nexport default Skeleton\n","import { memo } from 'react'\nimport { AlertTriangle, RefreshCw, WifiOff } from 'lucide-react'\n\n/**\n * ErrorState - Reusable error display component for list/data components\n * Provides user-friendly error messages with retry functionality\n */\nexport const ErrorState = memo(function ErrorState({\n  title = 'Unable to load data',\n  message = 'Something went wrong. Please try again.',\n  error = null,\n  onRetry = null,\n  retryLabel = 'Try Again',\n  variant = 'default', // 'default' | 'inline' | 'compact'\n  icon: CustomIcon = null\n}) {\n  // Determine icon based on error type\n  const getIcon = () => {\n    if (CustomIcon) return CustomIcon\n    if (error?.message?.includes('network') || error?.message?.includes('offline')) {\n      return WifiOff\n    }\n    return AlertTriangle\n  }\n\n  const Icon = getIcon()\n\n  if (variant === 'compact') {\n    return (\n      <div className=\"error-state error-state-compact\" role=\"alert\">\n        <Icon size={16} className=\"error-state-icon\" aria-hidden=\"true\" />\n        <span className=\"error-state-message\">{message}</span>\n        {onRetry && (\n          <button\n            className=\"btn btn-ghost btn-small\"\n            onClick={onRetry}\n            aria-label={retryLabel}\n          >\n            <RefreshCw size={14} />\n          </button>\n        )}\n      </div>\n    )\n  }\n\n  if (variant === 'inline') {\n    return (\n      <div className=\"error-state error-state-inline\" role=\"alert\">\n        <div className=\"error-state-content\">\n          <Icon size={20} className=\"error-state-icon\" aria-hidden=\"true\" />\n          <div className=\"error-state-text\">\n            <span className=\"error-state-title\">{title}</span>\n            <span className=\"error-state-message\">{message}</span>\n          </div>\n        </div>\n        {onRetry && (\n          <button className=\"btn btn-secondary btn-small\" onClick={onRetry}>\n            <RefreshCw size={14} /> {retryLabel}\n          </button>\n        )}\n      </div>\n    )\n  }\n\n  // Default variant - centered with full details\n  return (\n    <div className=\"error-state\" role=\"alert\" aria-live=\"polite\">\n      <div className=\"error-state-icon-wrapper\">\n        <Icon size={32} className=\"error-state-icon\" aria-hidden=\"true\" />\n      </div>\n      <h4 className=\"error-state-title\">{title}</h4>\n      <p className=\"error-state-message\">{message}</p>\n\n      {/* Show error details in development */}\n      {import.meta.env.DEV && error && (\n        <details className=\"error-state-details\">\n          <summary>Error Details</summary>\n          <pre>{error.message || String(error)}</pre>\n        </details>\n      )}\n\n      {onRetry && (\n        <button className=\"btn btn-primary\" onClick={onRetry}>\n          <RefreshCw size={16} /> {retryLabel}\n        </button>\n      )}\n    </div>\n  )\n})\n\n/**\n * EmptyState - Reusable empty state component\n * Shows when a list/data is empty (no error, just no data)\n */\nexport const EmptyState = memo(function EmptyState({\n  title = 'No data yet',\n  message = 'Items will appear here once added.',\n  icon: Icon = null,\n  action = null,\n  actionLabel = 'Get Started',\n  onAction = null\n}) {\n  return (\n    <div className=\"empty-state\" role=\"status\">\n      {Icon && (\n        <div className=\"empty-state-icon-wrapper\">\n          <Icon size={32} className=\"empty-state-icon\" aria-hidden=\"true\" />\n        </div>\n      )}\n      <h4 className=\"empty-state-title\">{title}</h4>\n      <p className=\"empty-state-message\">{message}</p>\n      {onAction && (\n        <button className=\"btn btn-primary btn-small\" onClick={onAction}>\n          {actionLabel}\n        </button>\n      )}\n      {action && !onAction && action}\n    </div>\n  )\n})\n\nexport default ErrorState\n","import { memo } from 'react'\nimport { AlertCircle } from 'lucide-react'\n\n/**\n * FormField - Reusable form field wrapper with validation display\n * Provides consistent styling and error handling for form inputs\n */\nexport const FormField = memo(function FormField({\n  label,\n  error,\n  required = false,\n  hint,\n  children,\n  className = ''\n}) {\n  return (\n    <div className={`form-field ${error ? 'has-error' : ''} ${className}`}>\n      {label && (\n        <label className=\"form-field-label\">\n          {label}\n          {required && <span className=\"form-field-required\">*</span>}\n        </label>\n      )}\n      <div className=\"form-field-input\">\n        {children}\n      </div>\n      {error && (\n        <div className=\"form-field-error\" role=\"alert\">\n          <AlertCircle size={14} aria-hidden=\"true\" />\n          <span>{error}</span>\n        </div>\n      )}\n      {hint && !error && (\n        <div className=\"form-field-hint\">{hint}</div>\n      )}\n    </div>\n  )\n})\n\n/**\n * ValidatedInput - Input with built-in validation styling\n */\nexport const ValidatedInput = memo(function ValidatedInput({\n  type = 'text',\n  value,\n  onChange,\n  onBlur,\n  error,\n  placeholder,\n  disabled,\n  min,\n  max,\n  step,\n  pattern,\n  required,\n  autoComplete,\n  name,\n  id,\n  className = '',\n  'aria-label': ariaLabel,\n  'aria-describedby': ariaDescribedBy\n}) {\n  const inputId = id || name\n  const errorId = error ? `${inputId}-error` : undefined\n\n  return (\n    <>\n      <input\n        type={type}\n        id={inputId}\n        name={name}\n        value={value}\n        onChange={onChange}\n        onBlur={onBlur}\n        placeholder={placeholder}\n        disabled={disabled}\n        min={min}\n        max={max}\n        step={step}\n        pattern={pattern}\n        required={required}\n        autoComplete={autoComplete}\n        className={`validated-input ${error ? 'has-error' : ''} ${className}`}\n        aria-label={ariaLabel}\n        aria-invalid={!!error}\n        aria-describedby={error ? errorId : ariaDescribedBy}\n      />\n      {error && (\n        <div id={errorId} className=\"input-error-inline\" role=\"alert\">\n          <AlertCircle size={12} aria-hidden=\"true\" />\n          <span>{error}</span>\n        </div>\n      )}\n    </>\n  )\n})\n\n/**\n * ValidatedSelect - Select with built-in validation styling\n */\nexport const ValidatedSelect = memo(function ValidatedSelect({\n  value,\n  onChange,\n  onBlur,\n  error,\n  disabled,\n  required,\n  name,\n  id,\n  className = '',\n  children,\n  'aria-label': ariaLabel\n}) {\n  const selectId = id || name\n  const errorId = error ? `${selectId}-error` : undefined\n\n  return (\n    <>\n      <select\n        id={selectId}\n        name={name}\n        value={value}\n        onChange={onChange}\n        onBlur={onBlur}\n        disabled={disabled}\n        required={required}\n        className={`validated-select ${error ? 'has-error' : ''} ${className}`}\n        aria-label={ariaLabel}\n        aria-invalid={!!error}\n        aria-describedby={error ? errorId : undefined}\n      >\n        {children}\n      </select>\n      {error && (\n        <div id={errorId} className=\"input-error-inline\" role=\"alert\">\n          <AlertCircle size={12} aria-hidden=\"true\" />\n          <span>{error}</span>\n        </div>\n      )}\n    </>\n  )\n})\n\n/**\n * ValidatedTextarea - Textarea with built-in validation styling\n */\nexport const ValidatedTextarea = memo(function ValidatedTextarea({\n  value,\n  onChange,\n  onBlur,\n  error,\n  placeholder,\n  disabled,\n  required,\n  rows = 3,\n  maxLength,\n  name,\n  id,\n  className = '',\n  'aria-label': ariaLabel\n}) {\n  const textareaId = id || name\n  const errorId = error ? `${textareaId}-error` : undefined\n\n  return (\n    <>\n      <textarea\n        id={textareaId}\n        name={name}\n        value={value}\n        onChange={onChange}\n        onBlur={onBlur}\n        placeholder={placeholder}\n        disabled={disabled}\n        required={required}\n        rows={rows}\n        maxLength={maxLength}\n        className={`validated-textarea ${error ? 'has-error' : ''} ${className}`}\n        aria-label={ariaLabel}\n        aria-invalid={!!error}\n        aria-describedby={error ? errorId : undefined}\n      />\n      {maxLength && (\n        <div className=\"textarea-counter\">\n          {value?.length || 0} / {maxLength}\n        </div>\n      )}\n      {error && (\n        <div id={errorId} className=\"input-error-inline\" role=\"alert\">\n          <AlertCircle size={12} aria-hidden=\"true\" />\n          <span>{error}</span>\n        </div>\n      )}\n    </>\n  )\n})\n\nexport default FormField\n","import { memo, useEffect, useState } from 'react'\nimport { TrendingUp, TrendingDown, Minus, Check, AlertTriangle, Clock } from 'lucide-react'\n\n/**\n * Micro-Visualizations - Small, informative visual elements\n * Designed to replace mental calculation and clarify status at a glance\n */\n\n// Animated count badge with optional pulse for new items\nexport const CountBadge = memo(function CountBadge({\n  count,\n  label,\n  variant = 'default', // 'default' | 'primary' | 'success' | 'warning' | 'danger'\n  size = 'medium', // 'small' | 'medium' | 'large'\n  pulse = false,\n  icon: Icon\n}) {\n  const [prevCount, setPrevCount] = useState(count)\n  const [animating, setAnimating] = useState(false)\n\n  useEffect(() => {\n    if (count !== prevCount) {\n      setAnimating(true)\n      const timer = setTimeout(() => {\n        setAnimating(false)\n        setPrevCount(count)\n      }, 400)\n      return () => clearTimeout(timer)\n    }\n  }, [count, prevCount])\n\n  return (\n    <span\n      className={`count-badge count-badge-${variant} count-badge-${size} ${pulse ? 'badge-new' : ''} ${animating ? 'animate-count-up' : ''}`}\n      title={label}\n    >\n      {Icon && <Icon size={size === 'small' ? 12 : size === 'large' ? 18 : 14} />}\n      <span className=\"count-badge-value\">{count}</span>\n      {label && <span className=\"count-badge-label\">{label}</span>}\n    </span>\n  )\n})\n\n// Mini progress bar for inline usage\nexport const MiniProgress = memo(function MiniProgress({\n  value,\n  max = 100,\n  showLabel = false,\n  size = 'medium', // 'small' | 'medium' | 'large'\n  variant = 'default', // 'default' | 'success' | 'warning' | 'danger'\n  animated = true\n}) {\n  const percentage = Math.min(100, Math.max(0, (value / max) * 100))\n  const height = size === 'small' ? '4px' : size === 'large' ? '8px' : '6px'\n\n  // Auto-determine variant based on percentage if not specified\n  const autoVariant = variant === 'default'\n    ? percentage >= 80 ? 'danger' : percentage >= 60 ? 'warning' : 'success'\n    : variant\n\n  return (\n    <div className={`mini-progress mini-progress-${size}`}>\n      <div className=\"mini-progress-track\" style={{ height }}>\n        <div\n          className={`mini-progress-fill mini-progress-${autoVariant} ${animated ? 'progress-animate' : ''}`}\n          style={{ width: `${percentage}%` }}\n        />\n      </div>\n      {showLabel && (\n        <span className=\"mini-progress-label\">{Math.round(percentage)}%</span>\n      )}\n    </div>\n  )\n})\n\n// Trend indicator with direction and value\nexport const TrendIndicator = memo(function TrendIndicator({\n  value,\n  previousValue,\n  format = 'percent', // 'percent' | 'number' | 'currency'\n  inverted = false, // If true, down is good (e.g., costs)\n  showValue = true\n}) {\n  const diff = value - previousValue\n  const percentChange = previousValue !== 0 ? ((diff / previousValue) * 100) : 0\n\n  let direction = diff === 0 ? 'neutral' : diff > 0 ? 'up' : 'down'\n  let status = 'neutral'\n\n  if (diff !== 0) {\n    if (inverted) {\n      status = diff > 0 ? 'negative' : 'positive'\n    } else {\n      status = diff > 0 ? 'positive' : 'negative'\n    }\n  }\n\n  const Icon = direction === 'up' ? TrendingUp : direction === 'down' ? TrendingDown : Minus\n\n  const formatValue = () => {\n    const absChange = Math.abs(diff)\n    switch (format) {\n      case 'percent':\n        return `${Math.abs(percentChange).toFixed(1)}%`\n      case 'currency':\n        return new Intl.NumberFormat('en-US', {\n          style: 'currency',\n          currency: 'USD',\n          minimumFractionDigits: 0,\n          maximumFractionDigits: 0\n        }).format(absChange)\n      default:\n        return absChange.toLocaleString()\n    }\n  }\n\n  return (\n    <span className={`trend-indicator trend-${status}`}>\n      <Icon size={14} />\n      {showValue && <span className=\"trend-value\">{formatValue()}</span>}\n    </span>\n  )\n})\n\n// Status dot with optional label\nexport const StatusDot = memo(function StatusDot({\n  status = 'default', // 'default' | 'success' | 'warning' | 'danger' | 'info'\n  label,\n  size = 'medium', // 'small' | 'medium' | 'large'\n  pulse = false\n}) {\n  return (\n    <span className={`status-dot-container status-dot-${size}`}>\n      <span className={`status-dot status-dot-${status} ${pulse ? 'status-dot-pulse' : ''}`} />\n      {label && <span className=\"status-dot-label\">{label}</span>}\n    </span>\n  )\n})\n\n// Sparkline - mini line chart\nexport const Sparkline = memo(function Sparkline({\n  data = [],\n  width = 80,\n  height = 24,\n  strokeWidth = 2,\n  color = 'var(--accent-blue)',\n  showArea = true\n}) {\n  if (!data.length) return null\n\n  const max = Math.max(...data)\n  const min = Math.min(...data)\n  const range = max - min || 1\n\n  const points = data.map((value, index) => {\n    const x = (index / (data.length - 1)) * width\n    const y = height - ((value - min) / range) * (height - strokeWidth * 2) - strokeWidth\n    return `${x},${y}`\n  }).join(' ')\n\n  const areaPoints = `0,${height} ${points} ${width},${height}`\n\n  return (\n    <svg\n      width={width}\n      height={height}\n      className=\"sparkline\"\n      viewBox={`0 0 ${width} ${height}`}\n    >\n      {showArea && (\n        <polygon\n          points={areaPoints}\n          fill={color}\n          fillOpacity=\"0.15\"\n        />\n      )}\n      <polyline\n        points={points}\n        fill=\"none\"\n        stroke={color}\n        strokeWidth={strokeWidth}\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </svg>\n  )\n})\n\n// Quick stats row (e.g., \"3 workers  2.5 hrs  $450\")\nexport const QuickStats = memo(function QuickStats({ items = [] }) {\n  return (\n    <div className=\"quick-stats\">\n      {items.map((item, index) => (\n        <span key={index} className=\"quick-stat-item\">\n          {item.icon && <item.icon size={12} />}\n          <span className=\"quick-stat-value\">{item.value}</span>\n          {item.label && <span className=\"quick-stat-label\">{item.label}</span>}\n        </span>\n      ))}\n    </div>\n  )\n})\n\n// Status indicator with icon\nexport const StatusIndicator = memo(function StatusIndicator({\n  status, // 'success' | 'warning' | 'danger' | 'info' | 'pending'\n  label,\n  size = 'medium'\n}) {\n  const icons = {\n    success: Check,\n    warning: AlertTriangle,\n    danger: AlertTriangle,\n    info: Clock,\n    pending: Clock\n  }\n\n  const Icon = icons[status] || icons.info\n\n  return (\n    <span className={`status-indicator status-indicator-${status} status-indicator-${size}`}>\n      <Icon size={size === 'small' ? 12 : size === 'large' ? 18 : 14} />\n      {label && <span className=\"status-indicator-label\">{label}</span>}\n    </span>\n  )\n})\n\n// Metric delta (change from previous)\nexport const MetricDelta = memo(function MetricDelta({\n  current,\n  previous,\n  format = 'number', // 'number' | 'currency' | 'percent'\n  label,\n  inverted = false\n}) {\n  const delta = current - previous\n  const isPositive = inverted ? delta < 0 : delta > 0\n  const isNegative = inverted ? delta > 0 : delta < 0\n\n  const formatValue = (val) => {\n    switch (format) {\n      case 'currency':\n        return new Intl.NumberFormat('en-US', {\n          style: 'currency',\n          currency: 'USD',\n          minimumFractionDigits: 0\n        }).format(Math.abs(val))\n      case 'percent':\n        return `${Math.abs(val).toFixed(1)}%`\n      default:\n        return Math.abs(val).toLocaleString()\n    }\n  }\n\n  return (\n    <div className={`metric-delta ${isPositive ? 'positive' : isNegative ? 'negative' : 'neutral'}`}>\n      <span className=\"metric-delta-arrow\">\n        {delta > 0 ? '' : delta < 0 ? '' : ''}\n      </span>\n      <span className=\"metric-delta-value\">{formatValue(delta)}</span>\n      {label && <span className=\"metric-delta-label\">{label}</span>}\n    </div>\n  )\n})\n\n// Circular progress (donut style)\nexport const CircularProgress = memo(function CircularProgress({\n  value,\n  max = 100,\n  size = 40,\n  strokeWidth = 4,\n  showValue = true,\n  color = 'var(--accent-blue)'\n}) {\n  const percentage = Math.min(100, Math.max(0, (value / max) * 100))\n  const radius = (size - strokeWidth) / 2\n  const circumference = radius * 2 * Math.PI\n  const offset = circumference - (percentage / 100) * circumference\n\n  return (\n    <div className=\"circular-progress\" style={{ width: size, height: size }}>\n      <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>\n        <circle\n          className=\"circular-progress-track\"\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          fill=\"none\"\n          strokeWidth={strokeWidth}\n        />\n        <circle\n          className=\"circular-progress-fill\"\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          fill=\"none\"\n          stroke={color}\n          strokeWidth={strokeWidth}\n          strokeDasharray={circumference}\n          strokeDashoffset={offset}\n          strokeLinecap=\"round\"\n          transform={`rotate(-90 ${size / 2} ${size / 2})`}\n          style={{ transition: 'stroke-dashoffset 0.5s ease' }}\n        />\n      </svg>\n      {showValue && (\n        <span className=\"circular-progress-value\">\n          {Math.round(percentage)}%\n        </span>\n      )}\n    </div>\n  )\n})\n\nexport default {\n  CountBadge,\n  MiniProgress,\n  TrendIndicator,\n  StatusDot,\n  Sparkline,\n  QuickStats,\n  StatusIndicator,\n  MetricDelta,\n  CircularProgress\n}\n","import { useEffect, useRef, useCallback, memo } from 'react'\nimport { X } from 'lucide-react'\n\n/**\n * Accessible Modal Component\n *\n * Features:\n * - Proper ARIA attributes (role=\"dialog\", aria-modal, aria-labelledby)\n * - Focus trap within modal\n * - Escape key to close\n * - Click outside to close\n * - Focus restoration on close\n *\n * Usage:\n *   <Modal\n *     isOpen={showModal}\n *     onClose={() => setShowModal(false)}\n *     title=\"Modal Title\"\n *     size=\"medium\"\n *   >\n *     <p>Modal content here</p>\n *   </Modal>\n */\nconst Modal = memo(function Modal({\n  isOpen,\n  onClose,\n  title,\n  children,\n  size = 'medium', // 'small' | 'medium' | 'large' | 'full'\n  className = '',\n  showCloseButton = true,\n  closeOnOverlayClick = true,\n  closeOnEscape = true,\n  footer,\n  ariaDescribedBy\n}) {\n  const modalRef = useRef(null)\n  const previousActiveElement = useRef(null)\n  const titleId = useRef(`modal-title-${Math.random().toString(36).substr(2, 9)}`)\n\n  // Store the previously focused element and focus the modal when it opens\n  useEffect(() => {\n    if (isOpen) {\n      previousActiveElement.current = document.activeElement\n      // Focus the modal container after a brief delay to ensure it's rendered\n      const timer = setTimeout(() => {\n        modalRef.current?.focus()\n      }, 10)\n      return () => clearTimeout(timer)\n    }\n  }, [isOpen])\n\n  // Restore focus when modal closes\n  useEffect(() => {\n    if (!isOpen && previousActiveElement.current) {\n      previousActiveElement.current.focus()\n    }\n  }, [isOpen])\n\n  // Handle escape key\n  useEffect(() => {\n    if (!isOpen || !closeOnEscape) return\n\n    const handleKeyDown = (e) => {\n      if (e.key === 'Escape') {\n        e.preventDefault()\n        onClose()\n      }\n    }\n\n    document.addEventListener('keydown', handleKeyDown)\n    return () => document.removeEventListener('keydown', handleKeyDown)\n  }, [isOpen, closeOnEscape, onClose])\n\n  // Prevent body scroll when modal is open\n  useEffect(() => {\n    if (isOpen) {\n      const originalOverflow = document.body.style.overflow\n      document.body.style.overflow = 'hidden'\n      return () => {\n        document.body.style.overflow = originalOverflow\n      }\n    }\n  }, [isOpen])\n\n  // Focus trap\n  const handleKeyDown = useCallback((e) => {\n    if (e.key !== 'Tab') return\n\n    const focusableElements = modalRef.current?.querySelectorAll(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    )\n\n    if (!focusableElements || focusableElements.length === 0) return\n\n    const firstElement = focusableElements[0]\n    const lastElement = focusableElements[focusableElements.length - 1]\n\n    if (e.shiftKey) {\n      if (document.activeElement === firstElement) {\n        e.preventDefault()\n        lastElement.focus()\n      }\n    } else {\n      if (document.activeElement === lastElement) {\n        e.preventDefault()\n        firstElement.focus()\n      }\n    }\n  }, [])\n\n  const handleOverlayClick = (e) => {\n    if (closeOnOverlayClick && e.target === e.currentTarget) {\n      onClose()\n    }\n  }\n\n  if (!isOpen) return null\n\n  const sizeClasses = {\n    small: 'modal-small',\n    medium: 'modal-medium',\n    large: 'modal-large',\n    full: 'modal-full'\n  }\n\n  return (\n    <div\n      className=\"modal-overlay\"\n      onClick={handleOverlayClick}\n      role=\"presentation\"\n    >\n      <div\n        ref={modalRef}\n        className={`modal-content ${sizeClasses[size] || ''} ${className}`}\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-labelledby={title ? titleId.current : undefined}\n        aria-describedby={ariaDescribedBy}\n        tabIndex={-1}\n        onKeyDown={handleKeyDown}\n        onClick={(e) => e.stopPropagation()}\n      >\n        {title && (\n          <div className=\"modal-header\">\n            <h2 id={titleId.current}>{title}</h2>\n            {showCloseButton && (\n              <button\n                className=\"close-btn\"\n                onClick={onClose}\n                aria-label=\"Close modal\"\n                type=\"button\"\n              >\n                <X size={20} />\n              </button>\n            )}\n          </div>\n        )}\n\n        <div className=\"modal-body\">\n          {children}\n        </div>\n\n        {footer && (\n          <div className=\"modal-footer\">\n            {footer}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n})\n\nexport default Modal\n","import { memo, useMemo } from 'react'\nimport { DollarSign, TrendingUp, Receipt, PiggyBank } from 'lucide-react'\nimport { HeroMetricsSkeleton, MiniProgress, TrendIndicator } from './ui'\n\n/**\n * HeroMetrics - Top-level financial summary for project dashboard\n * Designed for instant comprehension of project financial health\n */\n\nconst formatCurrency = (amount) => {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0\n  }).format(amount || 0)\n}\n\nconst MetricCard = memo(function MetricCard({\n  icon: Icon,\n  label,\n  value,\n  formattedValue,\n  subLabel,\n  progress,\n  progressLabel,\n  variant = 'default', // 'default' | 'success' | 'warning' | 'danger'\n  trend,\n  previousValue\n}) {\n  const variantColors = {\n    default: 'var(--accent-blue)',\n    success: 'var(--accent-green)',\n    warning: 'var(--accent-amber)',\n    danger: 'var(--accent-red)'\n  }\n\n  return (\n    <div className={`hero-metric-card hover-lift animate-fade-in-up`}>\n      <div className=\"hero-metric-header\">\n        <div className=\"hero-metric-icon\" style={{ color: variantColors[variant] }}>\n          <Icon size={18} />\n        </div>\n        <span className=\"hero-metric-label\">{label}</span>\n      </div>\n\n      <div className=\"hero-metric-value-row\">\n        <span className={`hero-metric-value hero-metric-${variant}`}>\n          {formattedValue}\n        </span>\n        {trend !== undefined && previousValue !== undefined && (\n          <TrendIndicator\n            value={value}\n            previousValue={previousValue}\n            format=\"currency\"\n            inverted={label.toLowerCase().includes('cost')}\n          />\n        )}\n      </div>\n\n      {subLabel && (\n        <span className=\"hero-metric-sublabel\">{subLabel}</span>\n      )}\n\n      {progress !== undefined && (\n        <div className=\"hero-metric-progress\">\n          <MiniProgress\n            value={progress}\n            max={100}\n            size=\"small\"\n            variant={variant}\n            showLabel\n          />\n          {progressLabel && (\n            <span className=\"hero-metric-progress-label\">{progressLabel}</span>\n          )}\n        </div>\n      )}\n    </div>\n  )\n})\n\nexport default memo(function HeroMetrics({\n  contractValue = 0,\n  earnedRevenue = 0,\n  totalCosts = 0,\n  profit = 0,\n  progress = 0,\n  corApprovedValue = 0,\n  loading = false,\n  previousData // Optional: for trend indicators\n}) {\n  // Calculate derived values\n  const revisedContract = contractValue + corApprovedValue\n  const profitMargin = earnedRevenue > 0 ? ((profit / earnedRevenue) * 100) : 0\n  const costRatio = earnedRevenue > 0 ? ((totalCosts / earnedRevenue) * 100) : 0\n  const revenueProgress = revisedContract > 0 ? ((earnedRevenue / revisedContract) * 100) : 0\n  const costProgress = revisedContract > 0 ? ((totalCosts / revisedContract) * 100) : 0\n\n  // Determine profit status\n  const profitVariant = useMemo(() => {\n    if (profitMargin >= 20) return 'success'\n    if (profitMargin >= 10) return 'warning'\n    if (profitMargin < 0) return 'danger'\n    return 'default'\n  }, [profitMargin])\n\n  // Determine cost status\n  const costVariant = useMemo(() => {\n    if (costRatio <= 60) return 'success'\n    if (costRatio <= 80) return 'warning'\n    return 'danger'\n  }, [costRatio])\n\n  if (loading) {\n    return <HeroMetricsSkeleton />\n  }\n\n  return (\n    <div className=\"hero-metrics stagger-children\">\n      {/* Contract Value */}\n      <MetricCard\n        icon={DollarSign}\n        label=\"Contract Value\"\n        value={revisedContract}\n        formattedValue={formatCurrency(revisedContract)}\n        subLabel={corApprovedValue > 0 ? `+${formatCurrency(corApprovedValue)} CORs` : null}\n        variant=\"default\"\n      />\n\n      {/* Earned Revenue */}\n      <MetricCard\n        icon={TrendingUp}\n        label=\"Earned Revenue\"\n        value={earnedRevenue}\n        formattedValue={formatCurrency(earnedRevenue)}\n        progress={revenueProgress}\n        progressLabel={`${Math.round(revenueProgress)}% of contract`}\n        variant=\"success\"\n        previousValue={previousData?.earnedRevenue}\n        trend={previousData ? earnedRevenue : undefined}\n      />\n\n      {/* Total Costs */}\n      <MetricCard\n        icon={Receipt}\n        label=\"Total Costs\"\n        value={totalCosts}\n        formattedValue={formatCurrency(totalCosts)}\n        progress={costProgress}\n        progressLabel={`${Math.round(costRatio)}% of revenue`}\n        variant={costVariant}\n        previousValue={previousData?.totalCosts}\n        trend={previousData ? totalCosts : undefined}\n      />\n\n      {/* Profit */}\n      <MetricCard\n        icon={PiggyBank}\n        label=\"Profit\"\n        value={profit}\n        formattedValue={formatCurrency(profit)}\n        subLabel={`${profitMargin >= 0 ? '+' : ''}${profitMargin.toFixed(1)}% margin`}\n        variant={profitVariant}\n        previousValue={previousData?.profit}\n        trend={previousData ? profit : undefined}\n      />\n    </div>\n  )\n})\n","import { memo } from 'react'\nimport { BarChart3, FileText, ClipboardList, Receipt, ChevronRight, ChevronLeft, PanelLeftOpen, X } from 'lucide-react'\nimport { CountBadge } from './ui'\n\n/**\n * FinancialsNav - Collapsible sidebar navigation for Financials tab\n *\n * Design principles:\n * - Workflow order: Overview  CORs  T&M (reflects natural process)\n * - Collapsible to maximize content real estate\n * - Clear visual hierarchy with active states\n * - Badges show pending items requiring attention\n */\n\nconst NAV_ITEMS = [\n  {\n    id: 'overview',\n    label: 'Overview',\n    shortLabel: 'Overview',\n    icon: BarChart3,\n    description: 'Metrics & trends',\n    step: null\n  },\n  {\n    id: 'cors',\n    label: 'Change Orders',\n    shortLabel: 'CORs',\n    icon: FileText,\n    description: 'CORs & approvals',\n    step: 1\n  },\n  {\n    id: 'tickets',\n    label: 'T&M Tickets',\n    shortLabel: 'Tickets',\n    icon: ClipboardList,\n    description: 'Field data',\n    step: 2\n  },\n  {\n    id: 'billing',\n    label: 'Billing',\n    shortLabel: 'Billing',\n    icon: Receipt,\n    description: 'Invoices & billing',\n    step: 3\n  }\n]\n\nexport default memo(function FinancialsNav({\n  activeSection = 'overview',\n  onSectionChange,\n  collapsed = false,\n  onToggleCollapse,\n  onMobileClose,\n  stats = {}\n}) {\n  const {\n    corCount = 0,\n    ticketCount = 0,\n    corPending = 0,\n    ticketPending = 0,\n    billableCount = 0,\n    invoiceCount = 0\n  } = stats\n\n  // Get badge config for each section\n  const getBadge = (itemId) => {\n    if (itemId === 'cors' && corCount > 0) {\n      return {\n        count: corCount,\n        variant: corPending > 0 ? 'warning' : 'default',\n        pending: corPending\n      }\n    }\n    if (itemId === 'tickets' && ticketCount > 0) {\n      return {\n        count: ticketCount,\n        variant: ticketPending > 0 ? 'warning' : 'default',\n        pending: ticketPending\n      }\n    }\n    if (itemId === 'billing' && billableCount > 0) {\n      return {\n        count: billableCount,\n        variant: 'success', // Green to indicate money ready to collect\n        pending: billableCount\n      }\n    }\n    return null\n  }\n\n  return (\n    <nav\n      className={`financials-nav ${collapsed ? 'collapsed' : ''}`}\n      aria-label=\"Financials sections\"\n    >\n      {/* Mobile Header with Close Button */}\n      {onMobileClose && (\n        <div className=\"financials-nav-mobile-header\">\n          <span className=\"financials-nav-mobile-title\">Financials</span>\n          <button\n            className=\"financials-nav-mobile-close\"\n            onClick={onMobileClose}\n            aria-label=\"Close menu\"\n          >\n            <X size={20} />\n          </button>\n        </div>\n      )}\n\n      {/* Collapse Toggle - hidden on mobile */}\n      <button\n        className=\"financials-nav-toggle\"\n        onClick={onToggleCollapse}\n        aria-label={collapsed ? 'Expand sidebar' : 'Collapse sidebar'}\n        title={collapsed ? 'Expand sidebar' : 'Collapse sidebar'}\n      >\n        {collapsed ? (\n          <PanelLeftOpen size={18} />\n        ) : (\n          <ChevronLeft size={18} />\n        )}\n        {!collapsed && <span>Collapse</span>}\n      </button>\n\n      {/* Navigation Items */}\n      <div className=\"financials-nav-items\">\n        {NAV_ITEMS.map((item, index) => {\n          const isActive = activeSection === item.id\n          const Icon = item.icon\n          const badge = getBadge(item.id)\n          const showConnector = index < NAV_ITEMS.length - 1 && item.step !== null\n\n          return (\n            <div key={item.id} className=\"financials-nav-item-wrapper\">\n              <button\n                className={`financials-nav-item ${isActive ? 'active' : ''}`}\n                onClick={() => onSectionChange?.(item.id)}\n                aria-current={isActive ? 'page' : undefined}\n                title={`${item.label}${badge ? ` (${badge.count})` : ''}`}\n              >\n                {/* Step indicator for workflow items - only in expanded mode */}\n                {item.step && !collapsed && (\n                  <span className=\"financials-nav-step\">{item.step}</span>\n                )}\n\n                {/* Icon with optional badge dot */}\n                <div className=\"financials-nav-icon\">\n                  <Icon size={collapsed ? 22 : 20} />\n                  {/* Badge dot for pending items */}\n                  {badge && badge.pending > 0 && (\n                    <span className=\"financials-nav-dot\" />\n                  )}\n                </div>\n\n                {/* Collapsed mode: show short label below icon */}\n                {collapsed && (\n                  <span className=\"financials-nav-short-label\">{item.shortLabel}</span>\n                )}\n\n                {/* Expanded mode: show full content */}\n                {!collapsed && (\n                  <>\n                    <div className=\"financials-nav-content\">\n                      <span className=\"financials-nav-label\">{item.label}</span>\n                      <span className=\"financials-nav-desc\">{item.description}</span>\n                    </div>\n\n                    {/* Badge */}\n                    {badge && (\n                      <CountBadge\n                        count={badge.count}\n                        size=\"small\"\n                        variant={badge.variant}\n                      />\n                    )}\n\n                    {/* Arrow */}\n                    <ChevronRight size={16} className=\"financials-nav-arrow\" />\n                  </>\n                )}\n              </button>\n\n              {/* Workflow connector line */}\n              {showConnector && !collapsed && (\n                <div className=\"financials-nav-connector\">\n                  <div className=\"connector-line\" />\n                </div>\n              )}\n            </div>\n          )\n        })}\n      </div>\n\n      {/* Toggle label when collapsed */}\n      {collapsed && (\n        <button\n          className=\"financials-nav-expand-btn\"\n          onClick={onToggleCollapse}\n          aria-label=\"Expand sidebar\"\n        >\n          <ChevronRight size={14} />\n          <span>Expand</span>\n        </button>\n      )}\n    </nav>\n  )\n})\n","// ============================================\n// Chart Data Transformations\n// ============================================\n// Utilities to transform Dashboard.jsx data into\n// chart-friendly formats for Recharts.\n// ============================================\n\nimport { chartColors, costCategories } from '../components/charts/chartConfig'\n\n/**\n * Build cumulative time-series for the Financial Trend Chart\n * Merges labor, disposal, materials/equipment, T&M, and COR data by date\n * Uses actual area completion dates for revenue tracking\n *\n * @param {Object} projectData - Computed project data from Dashboard\n * @param {Object} project - Selected project\n * @param {Array} tmTickets - T&M tickets for the project\n * @param {Object} corStats - COR statistics\n * @param {Array} areas - Project areas with completion dates\n * @returns {Array} Chart-ready data points\n */\nexport function buildFinancialTimeSeries(projectData, project, tmTickets = [], corStats = null, areas = []) {\n  const contractValue = project?.contract_value || 0\n  const laborByDate = projectData?.laborByDate || []\n  const haulOffByDate = projectData?.haulOffByDate || []\n  const materialsEquipmentByDate = projectData?.materialsEquipmentByDate || []\n  const customCosts = projectData?.customCosts || []\n\n  // Collect all unique dates from all sources\n  const dateSet = new Set()\n\n  laborByDate.forEach(d => dateSet.add(d.date))\n  haulOffByDate.forEach(d => dateSet.add(d.date))\n  materialsEquipmentByDate.forEach(d => dateSet.add(d.date))\n  customCosts.forEach(c => {\n    if (c.cost_date) dateSet.add(c.cost_date)\n  })\n\n  // Add T&M ticket dates\n  tmTickets.forEach(t => {\n    if (t.work_date) dateSet.add(t.work_date)\n    if (t.ticket_date) dateSet.add(t.ticket_date)\n    if (t.created_at) dateSet.add(t.created_at.split('T')[0])\n  })\n\n  // Add area completion dates (for revenue tracking)\n  areas.forEach(area => {\n    if (area.status === 'done' && area.updated_at) {\n      dateSet.add(area.updated_at.split('T')[0])\n    }\n  })\n\n  // Sort dates chronologically\n  const sortedDates = [...dateSet].sort((a, b) => new Date(a) - new Date(b))\n\n  if (sortedDates.length === 0) {\n    return []\n  }\n\n  // Build revenue by date based on completed areas\n  // Each completed area contributes its weight/value to revenue on its completion date\n  const revenueByDate = {}\n  const totalWeight = areas.reduce((sum, a) => sum + (parseFloat(a.weight) || 0), 0)\n\n  areas.forEach(area => {\n    if (area.status === 'done' && area.updated_at) {\n      const completionDate = area.updated_at.split('T')[0]\n      const areaWeight = parseFloat(area.weight) || 0\n      // Calculate area's contribution to revenue\n      // If scheduled_value exists (SOV), use that; otherwise calculate from weight\n      const areaValue = area.scheduled_value\n        ? parseFloat(area.scheduled_value)\n        : (totalWeight > 0 ? (areaWeight / totalWeight) * contractValue : 0)\n\n      if (!revenueByDate[completionDate]) {\n        revenueByDate[completionDate] = 0\n      }\n      revenueByDate[completionDate] += areaValue\n    }\n  })\n\n  // Build cumulative data\n  let cumulativeCost = 0\n  let cumulativeTMValue = 0\n  let cumulativeCORValue = 0\n\n  // Pre-calculate T&M values by date\n  // Use the actual property names from the database: t_and_m_workers, t_and_m_items\n  const tmByDate = {}\n  tmTickets.forEach(ticket => {\n    const date = ticket.work_date || ticket.ticket_date || ticket.created_at?.split('T')[0]\n    if (!date) return\n\n    // Calculate ticket value (labor + materials + equipment)\n    let ticketValue = 0\n\n    // Labor value - handles both property name variations\n    const workers = ticket.t_and_m_workers || ticket.workers || []\n    if (Array.isArray(workers)) {\n      workers.forEach(w => {\n        // Handle both naming conventions: hours/regular_hours, overtime_hours\n        const regHours = parseFloat(w.hours) || parseFloat(w.regular_hours) || 0\n        const otHours = parseFloat(w.overtime_hours) || 0\n        // Use rates if available, otherwise default billing rates\n        const regRate = parseFloat(w.regular_rate) || parseFloat(w.rate) || 65\n        const otRate = parseFloat(w.overtime_rate) || regRate * 1.5\n        ticketValue += (regHours * regRate) + (otHours * otRate)\n      })\n    }\n\n    // Materials and equipment - handles both property name variations\n    const items = ticket.t_and_m_items || ticket.items || []\n    if (Array.isArray(items)) {\n      items.forEach(item => {\n        const qty = parseFloat(item.quantity) || 1\n        // Handle different cost property locations\n        const unitCost = parseFloat(item.unit_cost) ||\n                         parseFloat(item.materials_equipment?.cost_per_unit) || 0\n        ticketValue += qty * unitCost\n      })\n    }\n\n    if (!tmByDate[date]) {\n      tmByDate[date] = 0\n    }\n    tmByDate[date] += ticketValue\n  })\n\n  // Pre-calculate custom costs by date\n  const customByDate = {}\n  customCosts.forEach(cost => {\n    const date = cost.cost_date\n    if (!date) return\n    if (!customByDate[date]) {\n      customByDate[date] = 0\n    }\n    customByDate[date] += parseFloat(cost.amount) || 0\n  })\n\n  // Pre-calculate materials/equipment costs by date (for quick lookup)\n  const materialsEquipmentByDateMap = {}\n  materialsEquipmentByDate.forEach(d => {\n    if (d.date) {\n      materialsEquipmentByDateMap[d.date] = d.cost || 0\n    }\n  })\n\n  // Track cumulative revenue based on actual area completions\n  let cumulativeRevenue = 0\n\n  // Build the time series\n  const timeSeries = sortedDates.map((date) => {\n    // Find labor cost for this date\n    const laborDay = laborByDate.find(d => d.date === date)\n    const laborCost = laborDay?.cost || 0\n\n    // Find haul-off cost for this date\n    const haulOffDay = haulOffByDate.find(d => d.date === date)\n    const haulOffCost = haulOffDay?.cost || 0\n\n    // Materials/equipment cost for this date (from T&M tickets)\n    const materialsEquipmentCost = materialsEquipmentByDateMap[date] || 0\n\n    // Custom costs for this date\n    const customCost = customByDate[date] || 0\n\n    // Accumulate all costs (labor + materials/equipment + disposal + custom)\n    const dailyTotalCost = laborCost + materialsEquipmentCost + haulOffCost + customCost\n    cumulativeCost += dailyTotalCost\n\n    // Accumulate T&M billing value (what we charge client)\n    const tmDayValue = tmByDate[date] || 0\n    cumulativeTMValue += tmDayValue\n\n    // Accumulate revenue based on actual area completions\n    // Revenue increases only when areas are marked complete\n    const dailyRevenue = revenueByDate[date] || 0\n    cumulativeRevenue += dailyRevenue\n\n    // If we have area completion data, use actual revenue\n    // Otherwise fall back to billable (for projects without detailed tracking)\n    const hasAreaData = Object.keys(revenueByDate).length > 0\n    const revenue = hasAreaData\n      ? cumulativeRevenue\n      : (projectData?.billable || 0) // Fall back to current billable for projects without area dates\n\n    return {\n      date,\n      contract: contractValue,\n      revenue: Math.round(revenue),\n      costs: Math.round(cumulativeCost),\n      tmValue: Math.round(cumulativeTMValue),\n      corValue: Math.round(corStats?.total_approved_value || 0),\n      profit: Math.round(revenue - cumulativeCost),\n      // Daily values for tooltips\n      dailyLabor: Math.round(laborCost),\n      dailyRevenue: Math.round(dailyRevenue),\n      dailyMaterials: Math.round(materialsEquipmentCost),\n      dailyHaulOff: Math.round(haulOffCost),\n      dailyCustom: Math.round(customCost),\n      dailyTM: Math.round(tmDayValue),\n      dailyTotal: Math.round(dailyTotalCost),\n    }\n  })\n\n  return timeSeries\n}\n\n/**\n * Filter time series by date range\n *\n * @param {Array} data - Full time series data\n * @param {number|null} days - Number of days to include (null = all)\n * @returns {Array} Filtered data\n */\nexport function filterByTimeRange(data, days) {\n  if (!days || !data.length) return data\n\n  const now = new Date()\n  const cutoff = new Date()\n  cutoff.setDate(now.getDate() - days)\n\n  return data.filter(d => new Date(d.date) >= cutoff)\n}\n\n/**\n * Build cost distribution data for donut chart\n *\n * @param {number} laborCost - Total labor cost\n * @param {number} haulOffCost - Total disposal cost\n * @param {Array} customCosts - Array of custom cost entries\n * @returns {Array} Chart-ready segments\n */\nexport function buildCostDistribution(laborCost = 0, haulOffCost = 0, customCosts = []) {\n  const segments = []\n\n  // Add labor if present\n  if (laborCost > 0) {\n    segments.push({\n      name: 'Labor',\n      value: laborCost,\n      color: chartColors.labor,\n      category: 'labor',\n    })\n  }\n\n  // Add disposal if present\n  if (haulOffCost > 0) {\n    segments.push({\n      name: 'Disposal',\n      value: haulOffCost,\n      color: chartColors.disposal,\n      category: 'disposal',\n    })\n  }\n\n  // Group custom costs by category\n  const grouped = {}\n  customCosts.forEach(cost => {\n    const cat = cost.category || 'other'\n    if (!grouped[cat]) {\n      grouped[cat] = {\n        items: [],\n        total: 0,\n      }\n    }\n    grouped[cat].items.push(cost)\n    grouped[cat].total += parseFloat(cost.amount) || 0\n  })\n\n  // Add grouped custom costs\n  Object.entries(grouped).forEach(([category, data]) => {\n    if (data.total > 0) {\n      const catConfig = costCategories[category] || costCategories.other\n      segments.push({\n        name: catConfig.label,\n        value: data.total,\n        color: catConfig.color,\n        category,\n        items: data.items,\n      })\n    }\n  })\n\n  // Calculate percentages\n  const total = segments.reduce((sum, s) => sum + s.value, 0)\n  segments.forEach(s => {\n    s.percentage = total > 0 ? Math.round((s.value / total) * 100) : 0\n  })\n\n  // Sort by value descending\n  segments.sort((a, b) => b.value - a.value)\n\n  return segments\n}\n\n/**\n * Build COR funnel data\n *\n * @param {Object} corStats - COR statistics from database\n * @returns {Array} Funnel stages\n */\nexport function buildCORFunnel(corStats) {\n  if (!corStats) return []\n\n  return [\n    {\n      stage: 'Draft',\n      count: corStats.draft_count || 0,\n      value: 0, // Draft CORs typically don't have values yet\n      color: chartColors.other,\n    },\n    {\n      stage: 'Pending',\n      count: corStats.pending_count || 0,\n      value: corStats.total_pending_value || 0,\n      color: chartColors.costs,\n    },\n    {\n      stage: 'Approved',\n      count: corStats.approved_count || 0,\n      value: corStats.total_approved_value || 0,\n      color: chartColors.revenue,\n    },\n    {\n      stage: 'Billed',\n      count: corStats.billed_count || 0,\n      value: corStats.total_billed_value || 0,\n      color: chartColors.profit,\n    },\n  ]\n}\n\n/**\n * Build daily burn data for sparkline\n *\n * @param {Array} laborByDate - Daily labor costs\n * @param {Array} haulOffByDate - Daily haul-off costs\n * @param {number} limit - Max number of days to include\n * @returns {Array} Sparkline data points\n */\nexport function buildBurnSparkline(laborByDate = [], haulOffByDate = [], limit = 14) {\n  // Merge and sort by date\n  const dateMap = {}\n\n  laborByDate.forEach(d => {\n    if (!dateMap[d.date]) {\n      dateMap[d.date] = { date: d.date, labor: 0, haulOff: 0 }\n    }\n    dateMap[d.date].labor = d.cost || 0\n  })\n\n  haulOffByDate.forEach(d => {\n    if (!dateMap[d.date]) {\n      dateMap[d.date] = { date: d.date, labor: 0, haulOff: 0 }\n    }\n    dateMap[d.date].haulOff = d.cost || 0\n  })\n\n  // Convert to array and sort\n  const data = Object.values(dateMap)\n    .map(d => ({\n      date: d.date,\n      total: d.labor + d.haulOff,\n      labor: d.labor,\n      haulOff: d.haulOff,\n    }))\n    .sort((a, b) => new Date(a.date) - new Date(b.date))\n\n  // Return last N days\n  return data.slice(-limit)\n}\n\n/**\n * Calculate trend direction from time series\n *\n * @param {Array} data - Time series data\n * @param {string} key - Data key to analyze\n * @returns {Object} Trend info { direction, percentage }\n */\nexport function calculateTrend(data, key) {\n  if (!data || data.length < 2) {\n    return { direction: 'flat', percentage: 0 }\n  }\n\n  const recent = data.slice(-7)\n  if (recent.length < 2) {\n    return { direction: 'flat', percentage: 0 }\n  }\n\n  const first = recent[0][key] || 0\n  const last = recent[recent.length - 1][key] || 0\n\n  if (first === 0) {\n    return { direction: last > 0 ? 'up' : 'flat', percentage: 0 }\n  }\n\n  const change = ((last - first) / first) * 100\n\n  return {\n    direction: change > 5 ? 'up' : change < -5 ? 'down' : 'flat',\n    percentage: Math.abs(Math.round(change)),\n  }\n}\n","import { formatChartDate, chartColors } from './chartConfig'\n\n/**\n * Custom tooltip for financial charts\n * Displays detailed breakdown on hover\n */\nexport default function ChartTooltip({ active, payload, label }) {\n  if (!active || !payload || !payload.length) {\n    return null\n  }\n\n  // Format currency\n  const formatCurrency = (value) => {\n    if (value >= 1000000) {\n      return `$${(value / 1000000).toFixed(2)}M`\n    }\n    if (value >= 1000) {\n      return `$${(value / 1000).toFixed(1)}K`\n    }\n    return `$${value.toFixed(0)}`\n  }\n\n  // Get the data point\n  const data = payload[0]?.payload || {}\n\n  return (\n    <div className=\"chart-tooltip\">\n      <div className=\"chart-tooltip-date\">\n        {formatChartDate(label)}\n      </div>\n\n      <div className=\"chart-tooltip-rows\">\n        {/* Contract */}\n        {data.contract !== undefined && (\n          <div className=\"chart-tooltip-row\">\n            <span className=\"chart-tooltip-label\">\n              <span\n                className=\"chart-tooltip-dot\"\n                style={{ backgroundColor: chartColors.contract }}\n              />\n              Contract\n            </span>\n            <span className=\"chart-tooltip-value\">\n              {formatCurrency(data.contract)}\n            </span>\n          </div>\n        )}\n\n        {/* Revenue */}\n        {data.revenue !== undefined && (\n          <div className=\"chart-tooltip-row\">\n            <span className=\"chart-tooltip-label\">\n              <span\n                className=\"chart-tooltip-dot\"\n                style={{ backgroundColor: chartColors.revenue }}\n              />\n              Revenue\n            </span>\n            <span className=\"chart-tooltip-value\">\n              {formatCurrency(data.revenue)}\n            </span>\n          </div>\n        )}\n\n        {/* Costs */}\n        {data.costs !== undefined && (\n          <div className=\"chart-tooltip-row\">\n            <span className=\"chart-tooltip-label\">\n              <span\n                className=\"chart-tooltip-dot\"\n                style={{ backgroundColor: chartColors.costs }}\n              />\n              Costs\n            </span>\n            <span className=\"chart-tooltip-value\">\n              {formatCurrency(data.costs)}\n            </span>\n          </div>\n        )}\n\n        {/* T&M Value */}\n        {data.tmValue !== undefined && data.tmValue > 0 && (\n          <div className=\"chart-tooltip-row\">\n            <span className=\"chart-tooltip-label\">\n              <span\n                className=\"chart-tooltip-dot\"\n                style={{ backgroundColor: chartColors.tmValue }}\n              />\n              T&M Value\n            </span>\n            <span className=\"chart-tooltip-value\">\n              {formatCurrency(data.tmValue)}\n            </span>\n          </div>\n        )}\n\n        {/* COR Value */}\n        {data.corValue !== undefined && data.corValue > 0 && (\n          <div className=\"chart-tooltip-row\">\n            <span className=\"chart-tooltip-label\">\n              <span\n                className=\"chart-tooltip-dot\"\n                style={{ backgroundColor: chartColors.corValue }}\n              />\n              COR Approved\n            </span>\n            <span className=\"chart-tooltip-value\">\n              {formatCurrency(data.corValue)}\n            </span>\n          </div>\n        )}\n\n        {/* Profit/Loss */}\n        {data.profit !== undefined && (\n          <div className=\"chart-tooltip-row\">\n            <span className=\"chart-tooltip-label\">\n              <span\n                className=\"chart-tooltip-dot\"\n                style={{\n                  backgroundColor: data.profit >= 0\n                    ? chartColors.profit\n                    : chartColors.loss\n                }}\n              />\n              {data.profit >= 0 ? 'Profit' : 'Loss'}\n            </span>\n            <span\n              className=\"chart-tooltip-value\"\n              style={{\n                color: data.profit >= 0\n                  ? chartColors.profit\n                  : chartColors.loss\n              }}\n            >\n              {formatCurrency(Math.abs(data.profit))}\n            </span>\n          </div>\n        )}\n      </div>\n\n      {/* Daily breakdown if available */}\n      {(data.dailyRevenue > 0 || data.dailyLabor > 0 || data.dailyMaterials > 0 || data.dailyHaulOff > 0 || data.dailyTM > 0) && (\n        <div className=\"chart-tooltip-daily\">\n          <div className=\"chart-tooltip-daily-label\">Today's Activity</div>\n          {data.dailyRevenue > 0 && (\n            <div className=\"chart-tooltip-daily-row earned\">\n              <span style={{ color: chartColors.revenue }}>\n                Areas Completed: {formatCurrency(data.dailyRevenue)}\n              </span>\n            </div>\n          )}\n          {data.dailyLabor > 0 && (\n            <div className=\"chart-tooltip-daily-row\">\n              Labor: {formatCurrency(data.dailyLabor)}\n            </div>\n          )}\n          {data.dailyMaterials > 0 && (\n            <div className=\"chart-tooltip-daily-row\">\n              Materials: {formatCurrency(data.dailyMaterials)}\n            </div>\n          )}\n          {data.dailyHaulOff > 0 && (\n            <div className=\"chart-tooltip-daily-row\">\n              Disposal: {formatCurrency(data.dailyHaulOff)}\n            </div>\n          )}\n          {data.dailyTM > 0 && (\n            <div className=\"chart-tooltip-daily-row\">\n              T&M Added: {formatCurrency(data.dailyTM)}\n            </div>\n          )}\n          {data.dailyTotal > 0 && (\n            <div className=\"chart-tooltip-daily-row total\">\n              <strong>Day Costs: {formatCurrency(data.dailyTotal)}</strong>\n            </div>\n          )}\n        </div>\n      )}\n\n      <div className=\"chart-tooltip-hint\">\n        Click to see details\n      </div>\n    </div>\n  )\n}\n","import { useState, useMemo } from 'react'\nimport {\n  AreaChart,\n  Area,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  Legend,\n  ReferenceLine,\n} from 'recharts'\nimport { TrendingUp, TrendingDown, Minus } from 'lucide-react'\nimport {\n  chartColors,\n  animationConfig,\n  timeRanges,\n  formatChartCurrency,\n  formatChartDate,\n  gradientDefs,\n} from './chartConfig'\nimport { buildFinancialTimeSeries, filterByTimeRange, calculateTrend } from '../../lib/chartDataTransforms'\nimport ChartTooltip from './ChartTooltip'\n\n/**\n * Financial Trend Chart\n * Multi-line area chart showing contract, revenue, costs, T&M, and COR values over time\n * Uses actual area completion dates for revenue tracking\n */\nexport default function FinancialTrendChart({\n  projectData,\n  project,\n  tmTickets = [],\n  corStats = null,\n  areas = [],\n  onDrillDown,\n}) {\n  const [timeRange, setTimeRange] = useState('30d')\n  const [hoveredLine, setHoveredLine] = useState(null)\n\n  // Build the time series data using actual area completions for revenue\n  const chartData = useMemo(() => {\n    const allData = buildFinancialTimeSeries(projectData, project, tmTickets, corStats, areas)\n    const selectedRange = timeRanges.find(r => r.id === timeRange)\n    return filterByTimeRange(allData, selectedRange?.days)\n  }, [projectData, project, tmTickets, corStats, areas, timeRange])\n\n  // Calculate trend indicators\n  const costsTrend = useMemo(() => calculateTrend(chartData, 'costs'), [chartData])\n  const revenueTrend = useMemo(() => calculateTrend(chartData, 'revenue'), [chartData])\n\n  // Handle click on data point\n  const handleClick = (data) => {\n    if (data?.activePayload?.[0]) {\n      const point = data.activePayload[0].payload\n      onDrillDown?.(point.date, point)\n    }\n  }\n\n  // Trend icon component\n  const TrendIcon = ({ trend }) => {\n    if (trend.direction === 'up') {\n      return <TrendingUp size={14} className=\"trend-icon up\" />\n    }\n    if (trend.direction === 'down') {\n      return <TrendingDown size={14} className=\"trend-icon down\" />\n    }\n    return <Minus size={14} className=\"trend-icon flat\" />\n  }\n\n  if (!chartData.length) {\n    return (\n      <div className=\"financial-trend-chart empty\">\n        <div className=\"chart-empty-state\">\n          <p>No financial data available yet.</p>\n          <span>Start tracking labor and costs to see trends.</span>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"financial-trend-chart\">\n      <div className=\"chart-header\">\n        <div className=\"chart-title-section\">\n          <h3>Financial Trend</h3>\n          <div className=\"chart-trend-indicators\">\n            <span className=\"trend-badge\">\n              <span style={{ color: chartColors.revenue }}>Revenue</span>\n              <TrendIcon trend={revenueTrend} />\n              {revenueTrend.percentage > 0 && (\n                <span className=\"trend-pct\">{revenueTrend.percentage}%</span>\n              )}\n            </span>\n            <span className=\"trend-badge\">\n              <span style={{ color: chartColors.costs }}>Costs</span>\n              <TrendIcon trend={costsTrend} />\n              {costsTrend.percentage > 0 && (\n                <span className=\"trend-pct\">{costsTrend.percentage}%</span>\n              )}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"time-range-selector\">\n          {timeRanges.map(range => (\n            <button\n              key={range.id}\n              className={timeRange === range.id ? 'active' : ''}\n              onClick={() => setTimeRange(range.id)}\n            >\n              {range.label}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"chart-container\">\n        <ResponsiveContainer width=\"100%\" height={300}>\n          <AreaChart\n            data={chartData}\n            onClick={handleClick}\n            margin={{ top: 10, right: 10, left: 0, bottom: 0 }}\n          >\n            {/* Gradient definitions */}\n            <defs>\n              {Object.values(gradientDefs).map(grad => (\n                <linearGradient\n                  key={grad.id}\n                  id={grad.id}\n                  x1=\"0\"\n                  y1=\"0\"\n                  x2=\"0\"\n                  y2=\"1\"\n                >\n                  <stop\n                    offset=\"5%\"\n                    stopColor={grad.color}\n                    stopOpacity={grad.startOpacity}\n                  />\n                  <stop\n                    offset=\"95%\"\n                    stopColor={grad.color}\n                    stopOpacity={grad.endOpacity}\n                  />\n                </linearGradient>\n              ))}\n            </defs>\n\n            <CartesianGrid\n              strokeDasharray=\"3 3\"\n              stroke=\"var(--border-color)\"\n              vertical={false}\n            />\n\n            <XAxis\n              dataKey=\"date\"\n              tickFormatter={formatChartDate}\n              stroke=\"var(--text-secondary)\"\n              tick={{ fontSize: 11 }}\n              tickLine={false}\n              axisLine={{ stroke: 'var(--border-color)' }}\n            />\n\n            <YAxis\n              tickFormatter={formatChartCurrency}\n              stroke=\"var(--text-secondary)\"\n              tick={{ fontSize: 11 }}\n              tickLine={false}\n              axisLine={false}\n              width={60}\n            />\n\n            <Tooltip content={<ChartTooltip />} />\n\n            <Legend\n              verticalAlign=\"top\"\n              height={36}\n              iconType=\"circle\"\n              iconSize={8}\n              formatter={(value) => (\n                <span style={{ color: 'var(--text-secondary)', fontSize: '12px' }}>\n                  {value}\n                </span>\n              )}\n            />\n\n            {/* Contract ceiling - dashed reference line */}\n            {chartData[0]?.contract > 0 && (\n              <ReferenceLine\n                y={chartData[0].contract}\n                stroke={chartColors.contract}\n                strokeDasharray=\"5 5\"\n                strokeWidth={2}\n                label={{\n                  value: 'Contract',\n                  position: 'right',\n                  fill: chartColors.contract,\n                  fontSize: 11,\n                }}\n              />\n            )}\n\n            {/* Revenue area */}\n            <Area\n              type=\"monotone\"\n              dataKey=\"revenue\"\n              name=\"Revenue\"\n              stroke={chartColors.revenue}\n              strokeWidth={2}\n              fill=\"url(#revenueGradient)\"\n              animationDuration={animationConfig.duration}\n              onMouseEnter={() => setHoveredLine('revenue')}\n              onMouseLeave={() => setHoveredLine(null)}\n              style={{\n                opacity: hoveredLine && hoveredLine !== 'revenue' ? 0.3 : 1,\n              }}\n            />\n\n            {/* Costs area */}\n            <Area\n              type=\"monotone\"\n              dataKey=\"costs\"\n              name=\"Costs\"\n              stroke={chartColors.costs}\n              strokeWidth={2}\n              fill=\"url(#costsGradient)\"\n              animationDuration={animationConfig.duration}\n              onMouseEnter={() => setHoveredLine('costs')}\n              onMouseLeave={() => setHoveredLine(null)}\n              style={{\n                opacity: hoveredLine && hoveredLine !== 'costs' ? 0.3 : 1,\n              }}\n            />\n\n            {/* T&M Value area */}\n            {chartData.some(d => d.tmValue > 0) && (\n              <Area\n                type=\"monotone\"\n                dataKey=\"tmValue\"\n                name=\"T&M Value\"\n                stroke={chartColors.tmValue}\n                strokeWidth={2}\n                fill=\"url(#tmValueGradient)\"\n                animationDuration={animationConfig.duration}\n                onMouseEnter={() => setHoveredLine('tmValue')}\n                onMouseLeave={() => setHoveredLine(null)}\n                style={{\n                  opacity: hoveredLine && hoveredLine !== 'tmValue' ? 0.3 : 1,\n                }}\n              />\n            )}\n\n            {/* COR Value line (no fill, just line) */}\n            {chartData.some(d => d.corValue > 0) && (\n              <Area\n                type=\"monotone\"\n                dataKey=\"corValue\"\n                name=\"COR Approved\"\n                stroke={chartColors.corValue}\n                strokeWidth={2}\n                strokeDasharray=\"4 2\"\n                fill=\"transparent\"\n                animationDuration={animationConfig.duration}\n                onMouseEnter={() => setHoveredLine('corValue')}\n                onMouseLeave={() => setHoveredLine(null)}\n                style={{\n                  opacity: hoveredLine && hoveredLine !== 'corValue' ? 0.3 : 1,\n                }}\n              />\n            )}\n          </AreaChart>\n        </ResponsiveContainer>\n      </div>\n\n      {/* Quick stats below chart */}\n      <div className=\"chart-quick-stats\">\n        <div className=\"quick-stat\">\n          <span className=\"stat-label\">Current Revenue</span>\n          <span className=\"stat-value\" style={{ color: chartColors.revenue }}>\n            {formatChartCurrency(chartData[chartData.length - 1]?.revenue || 0)}\n          </span>\n        </div>\n        <div className=\"quick-stat\">\n          <span className=\"stat-label\">Total Costs</span>\n          <span className=\"stat-value\" style={{ color: chartColors.costs }}>\n            {formatChartCurrency(chartData[chartData.length - 1]?.costs || 0)}\n          </span>\n        </div>\n        <div className=\"quick-stat\">\n          <span className=\"stat-label\">Margin</span>\n          <span\n            className=\"stat-value\"\n            style={{\n              color: (chartData[chartData.length - 1]?.profit || 0) >= 0\n                ? chartColors.profit\n                : chartColors.loss\n            }}\n          >\n            {(() => {\n              const last = chartData[chartData.length - 1]\n              if (!last || !last.revenue) return '0%'\n              const margin = ((last.revenue - last.costs) / last.revenue) * 100\n              return `${margin.toFixed(1)}%`\n            })()}\n          </span>\n        </div>\n        {chartData[chartData.length - 1]?.tmValue > 0 && (\n          <div className=\"quick-stat\">\n            <span className=\"stat-label\">T&M Pending</span>\n            <span className=\"stat-value\" style={{ color: chartColors.tmValue }}>\n              {formatChartCurrency(chartData[chartData.length - 1]?.tmValue || 0)}\n            </span>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","import { useState, useMemo } from 'react'\nimport {\n  PieChart,\n  Pie,\n  Cell,\n  ResponsiveContainer,\n  Tooltip,\n  Legend,\n} from 'recharts'\nimport { animationConfig, formatChartCurrency } from './chartConfig'\nimport { buildCostDistribution } from '../../lib/chartDataTransforms'\n\n/**\n * Cost Distribution Donut Chart\n * Shows breakdown of costs by category with interactive segments\n */\nexport default function CostDonut({\n  laborCost = 0,\n  haulOffCost = 0,\n  customCosts = [],\n  onSegmentClick,\n}) {\n  const [activeIndex, setActiveIndex] = useState(null)\n\n  // Build the donut segments\n  const segments = useMemo(() => {\n    return buildCostDistribution(laborCost, haulOffCost, customCosts)\n  }, [laborCost, haulOffCost, customCosts])\n\n  // Calculate total\n  const totalCost = useMemo(() => {\n    return segments.reduce((sum, s) => sum + s.value, 0)\n  }, [segments])\n\n  // Handle segment hover\n  const handleMouseEnter = (_, index) => {\n    setActiveIndex(index)\n  }\n\n  const handleMouseLeave = () => {\n    setActiveIndex(null)\n  }\n\n  // Handle segment click\n  const handleClick = (data, index) => {\n    if (onSegmentClick) {\n      onSegmentClick(segments[index])\n    }\n  }\n\n  // Custom tooltip\n  const CustomTooltip = ({ active, payload }) => {\n    if (!active || !payload || !payload.length) {\n      return null\n    }\n\n    const data = payload[0].payload\n    return (\n      <div className=\"chart-tooltip donut-tooltip\">\n        <div className=\"chart-tooltip-row\">\n          <span className=\"chart-tooltip-label\">\n            <span\n              className=\"chart-tooltip-dot\"\n              style={{ backgroundColor: data.color }}\n            />\n            {data.name}\n          </span>\n          <span className=\"chart-tooltip-value\">\n            {formatChartCurrency(data.value)}\n          </span>\n        </div>\n        <div className=\"donut-tooltip-pct\">\n          {data.percentage}% of total costs\n        </div>\n        {data.items && data.items.length > 0 && (\n          <div className=\"donut-tooltip-items\">\n            <div className=\"donut-tooltip-items-label\">\n              {data.items.length} item{data.items.length > 1 ? 's' : ''}\n            </div>\n          </div>\n        )}\n        {onSegmentClick && (\n          <div className=\"chart-tooltip-hint\">\n            Click to view details\n          </div>\n        )}\n      </div>\n    )\n  }\n\n  // Custom legend\n  const renderLegend = (props) => {\n    const { payload } = props\n    return (\n      <div className=\"donut-legend\">\n        {payload.map((entry, index) => (\n          <div\n            key={`legend-${index}`}\n            className={`donut-legend-item ${activeIndex === index ? 'active' : ''}`}\n            onMouseEnter={() => setActiveIndex(index)}\n            onMouseLeave={() => setActiveIndex(null)}\n            onClick={() => handleClick(null, index)}\n          >\n            <span\n              className=\"donut-legend-color\"\n              style={{ backgroundColor: entry.payload.color }}\n            />\n            <span className=\"donut-legend-name\">{entry.value}</span>\n            <span className=\"donut-legend-value\">\n              {formatChartCurrency(entry.payload.value)}\n            </span>\n          </div>\n        ))}\n      </div>\n    )\n  }\n\n  if (!segments.length || totalCost === 0) {\n    return (\n      <div className=\"cost-donut empty\">\n        <div className=\"chart-empty-state\">\n          <p>No cost data available.</p>\n          <span>Add labor, disposal, or custom costs to see breakdown.</span>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"cost-donut\">\n      <div className=\"donut-chart-container\">\n        <ResponsiveContainer width=\"100%\" height={200}>\n          <PieChart>\n            <Pie\n              data={segments}\n              cx=\"50%\"\n              cy=\"50%\"\n              innerRadius={50}\n              outerRadius={80}\n              paddingAngle={2}\n              dataKey=\"value\"\n              onMouseEnter={handleMouseEnter}\n              onMouseLeave={handleMouseLeave}\n              onClick={handleClick}\n              animationDuration={animationConfig.duration}\n              animationEasing=\"ease-out\"\n            >\n              {segments.map((entry, index) => (\n                <Cell\n                  key={`cell-${index}`}\n                  fill={entry.color}\n                  stroke=\"var(--card-bg)\"\n                  strokeWidth={2}\n                  style={{\n                    filter: activeIndex === index ? 'brightness(1.1)' : 'none',\n                    cursor: onSegmentClick ? 'pointer' : 'default',\n                    transform: activeIndex === index ? 'scale(1.05)' : 'scale(1)',\n                    transformOrigin: 'center',\n                    transition: 'all 0.2s ease',\n                  }}\n                />\n              ))}\n            </Pie>\n            <Tooltip content={<CustomTooltip />} />\n            <Legend content={renderLegend} />\n          </PieChart>\n        </ResponsiveContainer>\n\n        {/* Center label showing total */}\n        <div className=\"donut-center-label\">\n          <span className=\"donut-center-value\">\n            {formatChartCurrency(totalCost)}\n          </span>\n          <span className=\"donut-center-text\">Total</span>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { TrendingDown, AlertCircle, CheckCircle } from 'lucide-react'\n\n// Helper to format currency\nconst formatCurrency = (amount) => {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0\n  }).format(amount || 0)\n}\n\nexport default function ProfitabilityCard({\n  revenue,      // billable amount (earned based on progress)\n  totalCosts,   // all costs combined\n  contractValue, // total contract value\n  progress      // completion percentage\n}) {\n  // Current profit and margin\n  const currentProfit = revenue - totalCosts\n  const currentMargin = revenue > 0 ? (currentProfit / revenue) * 100 : 0\n\n  // Projected final values (extrapolate based on current progress)\n  const projectedRevenue = contractValue\n  const projectedCosts = progress > 0 ? (totalCosts / (progress / 100)) : totalCosts\n  const projectedProfit = projectedRevenue - projectedCosts\n  const projectedMargin = projectedRevenue > 0 ? (projectedProfit / projectedRevenue) * 100 : 0\n\n  // Determine status\n  const isHealthy = currentMargin >= 20\n  const isWarning = currentMargin >= 0 && currentMargin < 20\n  const isLoss = currentMargin < 0\n\n  const status = isHealthy ? 'healthy' : isWarning ? 'warning' : 'loss'\n  const statusLabel = isHealthy ? 'On Track' : isWarning ? 'Watch Margin' : 'Over Cost'\n  const StatusIcon = isHealthy ? CheckCircle : isWarning ? AlertCircle : TrendingDown\n\n  return (\n    <div className={`profitability-card ${status}`}>\n      <div className=\"profitability-header\">\n        <h3>Profitability</h3>\n        <div className={`profitability-status ${status}`}>\n          <StatusIcon size={14} />\n          <span>{statusLabel}</span>\n        </div>\n      </div>\n\n      <div className=\"profitability-metrics\">\n        {/* Current Margin */}\n        <div className=\"profit-metric\">\n          <div className=\"profit-metric-header\">\n            <span className=\"profit-metric-label\">Current Margin</span>\n            <span className={`profit-metric-value ${currentMargin < 0 ? 'negative' : ''}`}>\n              {Math.round(currentMargin)}%\n            </span>\n          </div>\n          <div className=\"profit-bar-container\">\n            <div\n              className={`profit-bar ${currentMargin < 0 ? 'negative' : currentMargin < 20 ? 'warning' : 'healthy'}`}\n              style={{ width: `${Math.min(Math.abs(currentMargin), 100)}%` }}\n            ></div>\n          </div>\n        </div>\n\n        {/* Projected Final Margin */}\n        {progress > 10 && (\n          <div className=\"profit-metric\">\n            <div className=\"profit-metric-header\">\n              <span className=\"profit-metric-label\">Projected Final</span>\n              <span className={`profit-metric-value ${projectedMargin < 0 ? 'negative' : ''}`}>\n                {Math.round(projectedMargin)}%\n              </span>\n            </div>\n            <div className=\"profit-bar-container\">\n              <div\n                className={`profit-bar ${projectedMargin < 0 ? 'negative' : projectedMargin < 20 ? 'warning' : 'healthy'}`}\n                style={{ width: `${Math.min(Math.abs(projectedMargin), 100)}%` }}\n              ></div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      <div className=\"profitability-summary\">\n        <div className=\"profit-row\">\n          <span className=\"profit-label\">Revenue Earned</span>\n          <span className=\"profit-value\">{formatCurrency(revenue)}</span>\n        </div>\n        <div className=\"profit-row\">\n          <span className=\"profit-label\">Total Costs</span>\n          <span className=\"profit-value negative\">- {formatCurrency(totalCosts)}</span>\n        </div>\n        <div className=\"profit-row profit-total\">\n          <span className=\"profit-label\">Current Profit</span>\n          <span className={`profit-value ${currentProfit < 0 ? 'negative' : 'positive'}`}>\n            {currentProfit >= 0 ? '' : '-'}{formatCurrency(Math.abs(currentProfit))}\n          </span>\n        </div>\n      </div>\n\n      {progress > 10 && (\n        <div className=\"profitability-insight\">\n          {isHealthy && (\n            <p>\n              At {Math.round(progress)}% complete, you're at {formatCurrency(currentProfit)} profit.\n              {projectedProfit > 0 && ` Projected final profit: ${formatCurrency(projectedProfit)}`}\n            </p>\n          )}\n          {isWarning && (\n            <p>\n              Margins are thin. Consider reviewing costs or scope.\n              {projectedProfit < 0 && ` Trending toward ${formatCurrency(projectedProfit)} loss.`}\n            </p>\n          )}\n          {isLoss && (\n            <p>\n              Currently over cost by {formatCurrency(Math.abs(currentProfit))}.\n              Immediate review recommended.\n            </p>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState } from 'react'\nimport { ChevronDown, ChevronUp, Plus, HardHat, Truck, Wrench, Package, Users, MoreHorizontal, Trash2 } from 'lucide-react'\nimport { CostDonut } from './charts'\n\n// Helper to format currency\nconst formatCurrency = (amount) => {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0\n  }).format(amount || 0)\n}\n\n// Category display info\nconst categoryInfo = {\n  labor: { label: 'Labor', Icon: HardHat, color: '#3b82f6' },\n  disposal: { label: 'Disposal', Icon: Truck, color: '#10b981' },\n  equipment: { label: 'Equipment', Icon: Wrench, color: '#f59e0b' },\n  materials: { label: 'Materials', Icon: Package, color: '#8b5cf6' },\n  subcontractor: { label: 'Subcontractor', Icon: Users, color: '#ec4899' },\n  other: { label: 'Other', Icon: MoreHorizontal, color: '#6b7280' }\n}\n\nexport default function CostContributorsCard({\n  laborCost = 0,\n  haulOffCost = 0,\n  customCosts = [],\n  onAddCost,\n  onDeleteCost\n}) {\n  const [showChart, setShowChart] = useState(true)\n  const [expandedCategory, setExpandedCategory] = useState(null)\n\n  // Build cost breakdown combining auto-tracked and custom costs\n  const costBreakdown = []\n\n  // Labor (auto-tracked from crew check-ins)\n  if (laborCost > 0) {\n    costBreakdown.push({\n      category: 'labor',\n      label: 'Labor',\n      amount: laborCost,\n      source: 'auto',\n      description: 'From crew check-ins'\n    })\n  }\n\n  // Disposal (auto-tracked from haul-offs)\n  if (haulOffCost > 0) {\n    costBreakdown.push({\n      category: 'disposal',\n      label: 'Disposal',\n      amount: haulOffCost,\n      source: 'auto',\n      description: 'From haul-off logs'\n    })\n  }\n\n  // Group custom costs by category\n  const customByCategory = {}\n  customCosts.forEach(cost => {\n    if (!customByCategory[cost.category]) {\n      customByCategory[cost.category] = {\n        category: cost.category,\n        items: [],\n        total: 0\n      }\n    }\n    customByCategory[cost.category].items.push(cost)\n    customByCategory[cost.category].total += parseFloat(cost.amount) || 0\n  })\n\n  // Add custom cost categories\n  Object.values(customByCategory).forEach(group => {\n    const info = categoryInfo[group.category] || categoryInfo.other\n    costBreakdown.push({\n      category: group.category,\n      label: info.label,\n      amount: group.total,\n      source: 'manual',\n      items: group.items\n    })\n  })\n\n  // Calculate total\n  const totalCost = costBreakdown.reduce((sum, cat) => sum + cat.amount, 0)\n\n  // Calculate percentages and sort by amount\n  costBreakdown.forEach(cat => {\n    cat.percentage = totalCost > 0 ? (cat.amount / totalCost) * 100 : 0\n  })\n  costBreakdown.sort((a, b) => b.amount - a.amount)\n\n  // Toggle category expansion\n  const toggleCategory = (category) => {\n    setExpandedCategory(expandedCategory === category ? null : category)\n  }\n\n  // Handle donut segment click\n  const handleSegmentClick = (segment) => {\n    if (segment.items && segment.items.length > 0) {\n      setShowChart(false)\n      setExpandedCategory(segment.category)\n    }\n  }\n\n  return (\n    <div className=\"cost-contributors-card\">\n      <div className=\"cost-contributors-header\">\n        <div className=\"cost-contributors-title\">\n          <h3>Cost Contributors</h3>\n          <span className=\"cost-total\">{formatCurrency(totalCost)}</span>\n        </div>\n        {costBreakdown.length > 0 && (\n          <div className=\"cost-view-toggle\">\n            <button\n              className={showChart ? 'active' : ''}\n              onClick={() => setShowChart(true)}\n            >\n              Chart\n            </button>\n            <button\n              className={!showChart ? 'active' : ''}\n              onClick={() => setShowChart(false)}\n            >\n              List\n            </button>\n          </div>\n        )}\n      </div>\n\n      {costBreakdown.length === 0 ? (\n        <div className=\"cost-empty\">\n          <p>No costs recorded yet</p>\n          <small>Costs will appear as crew checks in and haul-offs are logged</small>\n        </div>\n      ) : showChart ? (\n        <CostDonut\n          laborCost={laborCost}\n          haulOffCost={haulOffCost}\n          customCosts={customCosts}\n          onSegmentClick={handleSegmentClick}\n        />\n      ) : (\n        <div className=\"cost-breakdown\">\n          {costBreakdown.map(category => {\n            const info = categoryInfo[category.category] || categoryInfo.other\n            const Icon = info.Icon\n            const hasItems = category.items && category.items.length > 0\n            const isExpanded = expandedCategory === category.category\n\n            return (\n              <div key={category.category} className=\"cost-category\">\n                <div\n                  className={`cost-category-row ${hasItems ? 'expandable' : ''}`}\n                  onClick={() => hasItems && toggleCategory(category.category)}\n                >\n                  <div className=\"cost-category-bar-container\">\n                    <div\n                      className=\"cost-category-bar\"\n                      style={{\n                        width: `${Math.max(category.percentage, 2)}%`,\n                        backgroundColor: info.color\n                      }}\n                    ></div>\n                  </div>\n                  <div className=\"cost-category-info\">\n                    <div className=\"cost-category-label\">\n                      <Icon size={14} style={{ color: info.color }} />\n                      <span>{category.label}</span>\n                      {category.source === 'auto' && (\n                        <span className=\"cost-auto-badge\">Auto</span>\n                      )}\n                      {hasItems && (\n                        isExpanded ? <ChevronUp size={14} /> : <ChevronDown size={14} />\n                      )}\n                    </div>\n                    <div className=\"cost-category-values\">\n                      <span className=\"cost-amount\">{formatCurrency(category.amount)}</span>\n                      <span className=\"cost-percent\">{Math.round(category.percentage)}%</span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Expanded items for manual costs */}\n                {isExpanded && hasItems && (\n                  <div className=\"cost-category-items\">\n                    {category.items.map(item => (\n                      <div key={item.id} className=\"cost-item\">\n                        <div className=\"cost-item-info\">\n                          <span className=\"cost-item-desc\">{item.description}</span>\n                          <span className=\"cost-item-date\">\n                            {new Date(item.cost_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\n                          </span>\n                        </div>\n                        <div className=\"cost-item-actions\">\n                          <span className=\"cost-item-amount\">{formatCurrency(item.amount)}</span>\n                          {onDeleteCost && (\n                            <button\n                              className=\"cost-item-delete\"\n                              onClick={(e) => {\n                                e.stopPropagation()\n                                if (confirm('Delete this cost entry?')) {\n                                  onDeleteCost(item.id)\n                                }\n                              }}\n                            >\n                              <Trash2 size={14} />\n                            </button>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      )}\n\n      {onAddCost && (\n        <button className=\"cost-add-btn\" onClick={onAddCost}>\n          <Plus size={16} />\n          <span>Add Cost</span>\n        </button>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { Truck, ChevronDown, ChevronUp } from 'lucide-react'\nimport { db } from '../lib/supabase'\n\nconst LOAD_TYPES = [\n  { value: 'concrete', label: 'Concrete', icon: '' },\n  { value: 'trash', label: 'Trash', icon: '' },\n  { value: 'metals', label: 'Metals', icon: '' },\n  { value: 'hazardous_waste', label: 'Hazardous', icon: '' }\n]\n\nconst getLoadTypeInfo = (type) => LOAD_TYPES.find(t => t.value === type) || { label: type, icon: '' }\n\nexport default function DisposalSummary({ project, period = 'week' }) {\n  const [loads, setLoads] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [expanded, setExpanded] = useState(false)\n\n  useEffect(() => {\n    if (project?.id) {\n      loadData()\n    }\n  }, [project?.id, period])\n\n  const loadData = async () => {\n    try {\n      setLoading(true)\n      const days = period === 'week' ? 7 : period === 'month' ? 30 : 14\n      const data = await db.getDisposalLoadsHistory(project.id, days)\n      setLoads(data || [])\n    } catch (err) {\n      console.error('Error loading disposal summary:', err)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Group loads by type for totals\n  const loadsByType = loads.reduce((acc, load) => {\n    const type = load.load_type\n    if (!acc[type]) {\n      acc[type] = 0\n    }\n    acc[type] += load.load_count\n    return acc\n  }, {})\n\n  // Group by date for breakdown\n  const loadsByDate = loads.reduce((acc, load) => {\n    const date = load.load_date || load.work_date\n    if (!acc[date]) {\n      acc[date] = { date, loads: [], total: 0 }\n    }\n    acc[date].loads.push(load)\n    acc[date].total += load.load_count\n    return acc\n  }, {})\n\n  const sortedDates = Object.values(loadsByDate)\n    .sort((a, b) => new Date(b.date) - new Date(a.date))\n    .slice(0, 7)\n\n  const totalLoads = loads.reduce((sum, l) => sum + l.load_count, 0)\n  const hasLoads = totalLoads > 0\n\n  if (loading) {\n    return (\n      <div className=\"disposal-summary-card\">\n        <div className=\"card-header\">\n          <div className=\"header-left\">\n            <Truck size={18} />\n            <span>Disposal Loads</span>\n          </div>\n        </div>\n        <div className=\"card-loading\">Loading...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"disposal-summary-card\">\n      <div className=\"card-header\">\n        <div className=\"header-left\">\n          <Truck size={18} />\n          <span>Disposal Loads</span>\n        </div>\n        <span className=\"period-badge\">\n          {period === 'week' ? 'Last 7 days' : period === 'month' ? 'Last 30 days' : 'Last 14 days'}\n        </span>\n      </div>\n\n      {!hasLoads ? (\n        <div className=\"disposal-empty-state\">\n          <Truck size={32} />\n          <p>No disposal loads recorded</p>\n          <span className=\"text-muted\">Loads will appear here when logged by field crews</span>\n        </div>\n      ) : (\n        <>\n          {/* Total */}\n          <div className=\"disposal-total\">\n            <span className=\"disposal-total-value\">{totalLoads}</span>\n            <span className=\"disposal-total-label\">Total Loads</span>\n          </div>\n\n          {/* By Type Breakdown */}\n          <div className=\"disposal-breakdown\">\n            {LOAD_TYPES.map(type => {\n              const count = loadsByType[type.value] || 0\n              if (count === 0) return null\n              const percentage = Math.round((count / totalLoads) * 100)\n\n              return (\n                <div key={type.value} className=\"disposal-type-row\">\n                  <div className=\"disposal-type-info\">\n                    <span className=\"disposal-type-icon\">{type.icon}</span>\n                    <span className=\"disposal-type-label\">{type.label}</span>\n                  </div>\n                  <div className=\"disposal-type-stats\">\n                    <span className=\"disposal-type-count\">{count}</span>\n                    <div className=\"disposal-type-bar\">\n                      <div\n                        className=\"disposal-type-bar-fill\"\n                        style={{ width: `${percentage}%` }}\n                      />\n                    </div>\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n\n          {/* Daily Breakdown Toggle */}\n          {sortedDates.length > 0 && (\n            <button\n              className=\"disposal-expand-btn\"\n              onClick={() => setExpanded(!expanded)}\n            >\n              {expanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\n              <span>{expanded ? 'Hide' : 'View'} Daily Breakdown</span>\n            </button>\n          )}\n\n          {/* Daily Breakdown */}\n          {expanded && sortedDates.length > 0 && (\n            <div className=\"disposal-daily-breakdown\">\n              {sortedDates.map(day => {\n                const formattedDate = new Date(day.date).toLocaleDateString('en-US', {\n                  weekday: 'short',\n                  month: 'short',\n                  day: 'numeric'\n                })\n\n                // Group by type for this day\n                const dayLoadsByType = day.loads.reduce((acc, load) => {\n                  if (!acc[load.load_type]) acc[load.load_type] = 0\n                  acc[load.load_type] += load.load_count\n                  return acc\n                }, {})\n\n                return (\n                  <div key={day.date} className=\"disposal-daily-row\">\n                    <div className=\"disposal-daily-header\">\n                      <span className=\"disposal-daily-date\">{formattedDate}</span>\n                      <span className=\"disposal-daily-total\">{day.total} loads</span>\n                    </div>\n                    <div className=\"disposal-daily-types\">\n                      {Object.entries(dayLoadsByType).map(([type, count]) => {\n                        const typeInfo = getLoadTypeInfo(type)\n                        return (\n                          <span key={type} className=\"disposal-daily-type\">\n                            {typeInfo.icon} {count}\n                          </span>\n                        )\n                      })}\n                    </div>\n                  </div>\n                )\n              })}\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect, useCallback, useMemo, memo } from 'react'\nimport { Truck, Plus, Calendar, RotateCcw, ChevronDown, ChevronUp, Edit2, Trash2 } from 'lucide-react'\nimport { equipmentOps } from '../../lib/supabase'\nimport { formatCurrency } from '../../lib/corCalculations'\n\n// Helper function - defined outside component to avoid recreation\nconst formatDate = (dateStr) => {\n  if (!dateStr) return ''\n  return new Date(dateStr).toLocaleDateString('en-US', {\n    month: 'short',\n    day: 'numeric'\n  })\n}\n\n/**\n * ProjectEquipmentCard - Equipment tracking card for Financials Overview\n *\n * Shows equipment currently on site with daily rates and costs.\n * Allows adding new equipment and marking equipment as returned.\n */\nexport default memo(function ProjectEquipmentCard({\n  project,\n  onAddEquipment,\n  onEditEquipment,\n  onShowToast\n}) {\n  const [projectEquipment, setProjectEquipment] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [expanded, setExpanded] = useState(true)\n  const [totalCost, setTotalCost] = useState(0)\n\n  // Memoized load function to avoid stale closures\n  const loadEquipment = useCallback(async () => {\n    if (!project?.id) return\n\n    try {\n      setLoading(true)\n      const data = await equipmentOps.getProjectEquipment(project.id)\n      setProjectEquipment(data || [])\n\n      // Calculate total cost\n      const cost = equipmentOps.calculateProjectEquipmentCost(data || [])\n      setTotalCost(cost)\n    } catch (error) {\n      console.error('Error loading equipment:', error)\n      onShowToast?.('Failed to load equipment', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }, [project?.id]) // onShowToast is stable (memoized in App.jsx)\n\n  // Load project equipment when project changes\n  useEffect(() => {\n    loadEquipment()\n  }, [loadEquipment])\n\n  const handleMarkReturned = useCallback(async (equipmentItem) => {\n    try {\n      await equipmentOps.markEquipmentReturned(equipmentItem.id)\n      onShowToast?.(`${equipmentItem.equipment_name} marked as returned`, 'success')\n      loadEquipment()\n    } catch (error) {\n      console.error('Error marking equipment returned:', error)\n      onShowToast?.('Failed to update equipment', 'error')\n    }\n  }, [loadEquipment]) // onShowToast is stable\n\n  const handleDelete = useCallback(async (equipmentItem) => {\n    if (!confirm(`Remove ${equipmentItem.equipment_name} from this project?`)) {\n      return\n    }\n\n    try {\n      await equipmentOps.removeEquipmentFromProject(equipmentItem.id)\n      onShowToast?.('Equipment removed', 'success')\n      loadEquipment()\n    } catch (error) {\n      console.error('Error removing equipment:', error)\n      onShowToast?.('Failed to remove equipment', 'error')\n    }\n  }, [loadEquipment]) // onShowToast is stable\n\n  // Memoize derived state to avoid recalculating on every render\n  const activeEquipment = useMemo(\n    () => projectEquipment.filter(e => !e.end_date),\n    [projectEquipment]\n  )\n\n  const returnedEquipment = useMemo(\n    () => projectEquipment.filter(e => e.end_date),\n    [projectEquipment]\n  )\n\n  return (\n    <div className=\"project-equipment-card\">\n      <div className=\"project-equipment-header\">\n        <div className=\"project-equipment-title\">\n          <Truck size={18} />\n          <h3>Equipment on Site</h3>\n          {projectEquipment.length > 0 && (\n            <span className=\"equipment-count\">{activeEquipment.length} active</span>\n          )}\n        </div>\n        <div className=\"project-equipment-actions\">\n          <button\n            className=\"btn btn-sm btn-primary\"\n            onClick={() => onAddEquipment?.()}\n            title=\"Add equipment\"\n          >\n            <Plus size={14} />\n            <span>Add</span>\n          </button>\n          {projectEquipment.length > 0 && (\n            <button\n              className=\"btn btn-sm btn-ghost\"\n              onClick={() => setExpanded(!expanded)}\n            >\n              {expanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {loading ? (\n        <div className=\"equipment-loading\">\n          <div className=\"loading-spinner small\" />\n        </div>\n      ) : projectEquipment.length === 0 ? (\n        <div className=\"equipment-empty\">\n          <p>No equipment tracked on this project</p>\n          <button\n            className=\"btn btn-sm btn-outline\"\n            onClick={() => onAddEquipment?.()}\n          >\n            <Plus size={14} />\n            Track Equipment\n          </button>\n        </div>\n      ) : expanded ? (\n        <>\n          {/* Active Equipment */}\n          {activeEquipment.length > 0 && (\n            <div className=\"equipment-list\">\n              {activeEquipment.map(item => {\n                const days = equipmentOps.calculateDaysOnSite(item.start_date, item.end_date)\n                const cost = item.daily_rate * days\n\n                return (\n                  <div key={item.id} className=\"equipment-item active\">\n                    <div className=\"equipment-item-main\">\n                      <div className=\"equipment-item-info\">\n                        <span className=\"equipment-name\">{item.equipment_name}</span>\n                        <span className=\"equipment-meta\">\n                          <Calendar size={12} />\n                          On-site since {formatDate(item.start_date)}\n                        </span>\n                      </div>\n                      <div className=\"equipment-item-cost\">\n                        <span className=\"equipment-rate\">\n                          {formatCurrency(item.daily_rate)}/day\n                        </span>\n                        <span className=\"equipment-days\">{days} days</span>\n                        <span className=\"equipment-total\">{formatCurrency(cost)}</span>\n                      </div>\n                    </div>\n                    <div className=\"equipment-item-actions\">\n                      <button\n                        className=\"btn btn-xs btn-outline\"\n                        onClick={() => handleMarkReturned(item)}\n                        title=\"Mark as returned\"\n                      >\n                        <RotateCcw size={12} />\n                        Returned\n                      </button>\n                      <button\n                        className=\"btn btn-xs btn-ghost\"\n                        onClick={() => onEditEquipment?.(item)}\n                        title=\"Edit\"\n                      >\n                        <Edit2 size={12} />\n                      </button>\n                      <button\n                        className=\"btn btn-xs btn-ghost text-danger\"\n                        onClick={() => handleDelete(item)}\n                        title=\"Remove\"\n                      >\n                        <Trash2 size={12} />\n                      </button>\n                    </div>\n                  </div>\n                )\n              })}\n            </div>\n          )}\n\n          {/* Returned Equipment (collapsed by default) */}\n          {returnedEquipment.length > 0 && (\n            <details className=\"equipment-returned-section\">\n              <summary className=\"equipment-returned-toggle\">\n                <span>Returned Equipment ({returnedEquipment.length})</span>\n              </summary>\n              <div className=\"equipment-list returned\">\n                {returnedEquipment.map(item => {\n                  const days = equipmentOps.calculateDaysOnSite(item.start_date, item.end_date)\n                  const cost = item.daily_rate * days\n\n                  return (\n                    <div key={item.id} className=\"equipment-item returned\">\n                      <div className=\"equipment-item-main\">\n                        <div className=\"equipment-item-info\">\n                          <span className=\"equipment-name\">{item.equipment_name}</span>\n                          <span className=\"equipment-meta\">\n                            {formatDate(item.start_date)} - {formatDate(item.end_date)}\n                          </span>\n                        </div>\n                        <div className=\"equipment-item-cost\">\n                          <span className=\"equipment-days\">{days} days</span>\n                          <span className=\"equipment-total\">{formatCurrency(cost)}</span>\n                        </div>\n                      </div>\n                    </div>\n                  )\n                })}\n              </div>\n            </details>\n          )}\n\n          {/* Total */}\n          <div className=\"equipment-total-row\">\n            <span>Total Equipment Cost</span>\n            <span className=\"equipment-grand-total\">{formatCurrency(totalCost)}</span>\n          </div>\n        </>\n      ) : (\n        <div className=\"equipment-summary-collapsed\">\n          <span>{activeEquipment.length} active, {returnedEquipment.length} returned</span>\n          <span className=\"equipment-grand-total\">{formatCurrency(totalCost)}</span>\n        </div>\n      )}\n    </div>\n  )\n})\n","import { useState, useEffect, useCallback, useMemo, memo } from 'react'\nimport { FileSpreadsheet, Plus, ChevronRight } from 'lucide-react'\nimport { drawRequestOps } from '../../lib/supabase'\nimport { formatCurrency } from '../../lib/corCalculations'\n\n/**\n * ProgressBillingCard - Summary card for progress billing / draw requests\n *\n * Shows:\n * - Contract summary (original + COs = revised)\n * - Billing progress (billed to date, retention held)\n * - Quick action to create new draw request\n * - Recent draw requests\n */\nexport default memo(function ProgressBillingCard({\n  project,\n  areas = [],\n  corStats = {},\n  onCreateDraw,\n  onViewDraw,\n  onShowToast\n}) {\n  const [drawRequests, setDrawRequests] = useState([])\n  const [loading, setLoading] = useState(true)\n\n  // Calculate contract values\n  const originalContract = useMemo(() => {\n    return areas.reduce((sum, area) => {\n      const value = (area.square_footage || 0) * (area.price_per_sqft || 0)\n      return sum + Math.round(value * 100) // Convert to cents\n    }, 0)\n  }, [areas])\n\n  const approvedCOs = useMemo(() => {\n    return (corStats?.approvedTotal || 0)\n  }, [corStats?.approvedTotal])\n\n  const revisedContract = originalContract + approvedCOs\n\n  // Load draw requests\n  const loadDrawRequests = useCallback(async () => {\n    if (!project?.id) return\n\n    try {\n      setLoading(true)\n      const data = await drawRequestOps.getProjectDrawRequests(project.id)\n      setDrawRequests(data || [])\n    } catch (error) {\n      console.error('Error loading draw requests:', error)\n    } finally {\n      setLoading(false)\n    }\n  }, [project?.id])\n\n  useEffect(() => {\n    loadDrawRequests()\n  }, [loadDrawRequests])\n\n  // Calculate billing totals from draw requests\n  const billingTotals = useMemo(() => {\n    const completedDraws = drawRequests.filter(dr =>\n      ['submitted', 'approved', 'paid'].includes(dr.status)\n    )\n\n    const billedToDate = completedDraws.reduce((sum, dr) =>\n      sum + (dr.previous_billings || 0) + (dr.current_billing || 0), 0\n    )\n\n    // Get the most recent retention amount\n    const latestDraw = completedDraws[0]\n    const retentionHeld = latestDraw?.retention_held || 0\n\n    return { billedToDate, retentionHeld }\n  }, [drawRequests])\n\n  const progress = revisedContract > 0\n    ? Math.round((billingTotals.billedToDate / revisedContract) * 100)\n    : 0\n\n  const nextDrawNumber = drawRequests.length > 0\n    ? Math.max(...drawRequests.map(dr => dr.draw_number)) + 1\n    : 1\n\n  const formatDate = (dateStr) => {\n    if (!dateStr) return ''\n    return new Date(dateStr).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric'\n    })\n  }\n\n  const getStatusBadge = (status) => {\n    switch (status) {\n      case 'draft':\n        return <span className=\"badge badge-muted\">Draft</span>\n      case 'submitted':\n        return <span className=\"badge badge-warning\">Submitted</span>\n      case 'approved':\n        return <span className=\"badge badge-success\">Approved</span>\n      case 'paid':\n        return <span className=\"badge badge-info\">Paid</span>\n      case 'rejected':\n        return <span className=\"badge badge-danger\">Rejected</span>\n      default:\n        return null\n    }\n  }\n\n  return (\n    <div className=\"progress-billing-card\">\n      <div className=\"progress-billing-header\">\n        <div className=\"progress-billing-title\">\n          <FileSpreadsheet size={18} />\n          <h3>Progress Billing</h3>\n        </div>\n        <button\n          className=\"btn btn-sm btn-primary\"\n          onClick={() => onCreateDraw?.()}\n          disabled={originalContract === 0}\n          title={originalContract === 0 ? 'Add areas with contract values first' : `Create Draw #${nextDrawNumber}`}\n        >\n          <Plus size={14} />\n          <span>Draw #{nextDrawNumber}</span>\n        </button>\n      </div>\n\n      {/* Contract Summary */}\n      <div className=\"progress-billing-contract\">\n        <div className=\"contract-row\">\n          <span className=\"contract-label\">Original Contract</span>\n          <span className=\"contract-value\">{formatCurrency(originalContract)}</span>\n        </div>\n        {approvedCOs > 0 && (\n          <div className=\"contract-row co\">\n            <span className=\"contract-label\">Approved COs</span>\n            <span className=\"contract-value positive\">+{formatCurrency(approvedCOs)}</span>\n          </div>\n        )}\n        <div className=\"contract-row revised\">\n          <span className=\"contract-label\">Revised Contract</span>\n          <span className=\"contract-value\">{formatCurrency(revisedContract)}</span>\n        </div>\n      </div>\n\n      {/* Billing Progress */}\n      <div className=\"progress-billing-status\">\n        <div className=\"billing-progress-bar\">\n          <div\n            className=\"billing-progress-fill\"\n            style={{ width: `${Math.min(progress, 100)}%` }}\n          />\n        </div>\n        <div className=\"billing-stats\">\n          <div className=\"billing-stat\">\n            <span className=\"billing-stat-value\">{formatCurrency(billingTotals.billedToDate)}</span>\n            <span className=\"billing-stat-label\">Billed to Date ({progress}%)</span>\n          </div>\n          {billingTotals.retentionHeld > 0 && (\n            <div className=\"billing-stat retention\">\n              <span className=\"billing-stat-value\">-{formatCurrency(billingTotals.retentionHeld)}</span>\n              <span className=\"billing-stat-label\">Retention Held</span>\n            </div>\n          )}\n          <div className=\"billing-stat remaining\">\n            <span className=\"billing-stat-value\">{formatCurrency(revisedContract - billingTotals.billedToDate)}</span>\n            <span className=\"billing-stat-label\">Balance to Finish</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Recent Draw Requests */}\n      {loading ? (\n        <div className=\"progress-billing-loading\">\n          <div className=\"loading-spinner small\" />\n        </div>\n      ) : drawRequests.length === 0 ? (\n        <div className=\"progress-billing-empty\">\n          <p>No draw requests yet</p>\n          {originalContract > 0 && (\n            <button\n              className=\"btn btn-sm btn-outline\"\n              onClick={() => onCreateDraw?.()}\n            >\n              <Plus size={14} />\n              Create First Draw Request\n            </button>\n          )}\n        </div>\n      ) : (\n        <div className=\"progress-billing-draws\">\n          <div className=\"draws-header\">\n            <span>Recent Draws</span>\n          </div>\n          <div className=\"draws-list\">\n            {drawRequests.slice(0, 3).map(dr => (\n              <button\n                key={dr.id}\n                className=\"draw-item\"\n                onClick={() => onViewDraw?.(dr)}\n              >\n                <div className=\"draw-item-info\">\n                  <span className=\"draw-number\">Draw #{dr.draw_number}</span>\n                  <span className=\"draw-date\">{formatDate(dr.period_end || dr.created_at)}</span>\n                </div>\n                <div className=\"draw-item-amount\">\n                  {formatCurrency(dr.current_billing || 0)}\n                </div>\n                {getStatusBadge(dr.status)}\n                <ChevronRight size={16} className=\"draw-item-arrow\" />\n              </button>\n            ))}\n          </div>\n          {drawRequests.length > 3 && (\n            <button className=\"btn btn-sm btn-ghost view-all-draws\">\n              View all {drawRequests.length} draws\n            </button>\n          )}\n        </div>\n      )}\n    </div>\n  )\n})\n","import { useState, useEffect } from 'react'\nimport { HardHat } from 'lucide-react'\nimport { db } from '../lib/supabase'\n\nexport default function ManDayCosts({ project, company, onShowToast }) {\n  const [costData, setCostData] = useState(null)\n  const [loading, setLoading] = useState(true)\n  const [expanded, setExpanded] = useState(false)\n\n  useEffect(() => {\n    if (project?.id && company?.id) {\n      loadCostData()\n\n      // Subscribe to crew check-in updates for real-time cost updates\n      const subscription = db.subscribeToCrewCheckins?.(project.id, () => {\n        loadCostData()\n      })\n\n      return () => {\n        if (subscription) db.unsubscribe?.(subscription)\n      }\n    }\n  }, [project?.id, company?.id])\n\n  const loadCostData = async () => {\n    try {\n      const data = await db.calculateManDayCosts(\n        project.id,\n        company.id,\n        project.work_type || 'demolition',\n        project.job_type || 'standard'\n      )\n      setCostData(data)\n    } catch (error) {\n      console.error('Error loading man day costs:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const formatCurrency = (amount) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0\n    }).format(amount)\n  }\n\n  const formatDate = (dateStr) => {\n    return new Date(dateStr).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric'\n    })\n  }\n\n  const getRoleLabel = (role) => {\n    const labels = {\n      foreman: 'Foreman',\n      supervisor: 'Supervisor',\n      operator: 'Operator',\n      laborer: 'Laborer'\n    }\n    return labels[role] || role.charAt(0).toUpperCase() + role.slice(1)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"man-day-costs card\">\n        <div className=\"man-day-header\">\n          <h3>Man Day Costs</h3>\n        </div>\n        <div className=\"loading\">Loading...</div>\n      </div>\n    )\n  }\n\n  if (!costData || costData.totalManDays === 0) {\n    return (\n      <div className=\"man-day-costs card\">\n        <div className=\"man-day-header\">\n          <h3>Man Day Costs</h3>\n        </div>\n        <div className=\"man-day-empty\">\n          <span className=\"empty-icon\"><HardHat size={32} /></span>\n          <p>No crew check-ins yet</p>\n          <small>Costs will appear as crew checks in from the field</small>\n        </div>\n      </div>\n    )\n  }\n\n  const roleEntries = Object.entries(costData.byRole || {})\n\n  return (\n    <div className=\"man-day-costs card\">\n      <div className=\"man-day-header\" onClick={() => setExpanded(!expanded)}>\n        <div className=\"man-day-title-row\">\n          <h3>Man Day Costs</h3>\n          <span className=\"man-day-total\">{formatCurrency(costData.totalCost)}</span>\n        </div>\n        <button className=\"man-day-toggle\">\n          {expanded ? ' Collapse' : ' Details'}\n        </button>\n      </div>\n\n      {/* Summary Stats */}\n      <div className=\"man-day-summary\">\n        <div className=\"man-day-stat\">\n          <span className=\"stat-value\">{costData.daysWorked}</span>\n          <span className=\"stat-label\">Days Worked</span>\n        </div>\n        <div className=\"man-day-stat\">\n          <span className=\"stat-value\">{costData.totalManDays}</span>\n          <span className=\"stat-label\">Total Man Days</span>\n        </div>\n        <div className=\"man-day-stat\">\n          <span className=\"stat-value\">{formatCurrency(costData.totalCost)}</span>\n          <span className=\"stat-label\">Total Labor Cost</span>\n        </div>\n        <div className=\"man-day-stat\">\n          <span className=\"stat-value\">\n            {costData.daysWorked > 0\n              ? formatCurrency(costData.totalCost / costData.daysWorked)\n              : '$0'\n            }\n          </span>\n          <span className=\"stat-label\">Avg Cost/Day</span>\n        </div>\n      </div>\n\n      {/* Expanded Details */}\n      {expanded && (\n        <div className=\"man-day-details\">\n          {/* By Role Breakdown */}\n          {roleEntries.length > 0 && (\n            <div className=\"man-day-section\">\n              <h4>By Role</h4>\n              <div className=\"man-day-role-list\">\n                {roleEntries.map(([role, data]) => (\n                  <div key={role} className=\"man-day-role-row\">\n                    <div className=\"role-info\">\n                      <span className=\"role-name\">{getRoleLabel(role)}</span>\n                      <span className=\"role-rate\">{formatCurrency(data.rate)}/day</span>\n                    </div>\n                    <div className=\"role-stats\">\n                      <span className=\"role-count\">{data.count} days</span>\n                      <span className=\"role-cost\">{formatCurrency(data.cost)}</span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Recent Days */}\n          {costData.byDate?.length > 0 && (\n            <div className=\"man-day-section\">\n              <h4>Recent Activity</h4>\n              <div className=\"man-day-date-list\">\n                {costData.byDate.slice(0, 7).map((day, idx) => (\n                  <div key={idx} className=\"man-day-date-row\">\n                    <span className=\"date-label\">{formatDate(day.date)}</span>\n                    <span className=\"date-workers\">{day.workers} crew</span>\n                    <span className=\"date-cost\">{formatCurrency(day.cost)}</span>\n                  </div>\n                ))}\n              </div>\n              {costData.byDate.length > 7 && (\n                <p className=\"man-day-more\">\n                  + {costData.byDate.length - 7} more days\n                </p>\n              )}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState } from 'react'\nimport { TrendingUp, TrendingDown, Minus, ChevronDown, ChevronUp, Flame } from 'lucide-react'\n\n// Helper to format currency\nconst formatCurrency = (amount) => {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0\n  }).format(amount || 0)\n}\n\n// Helper to format date\nconst formatDate = (dateStr) => {\n  return new Date(dateStr).toLocaleDateString('en-US', {\n    month: 'short',\n    day: 'numeric'\n  })\n}\n\nexport default function BurnRateCard({\n  dailyBurn,\n  totalBurn,\n  daysWorked,\n  laborCost,\n  materialsEquipmentCost = 0,\n  progress,\n  contractValue,\n  laborByDate = [],\n  materialsEquipmentByDate = []\n}) {\n  const [expanded, setExpanded] = useState(false)\n\n  // Calculate burn status relative to progress\n  const expectedBurnAtProgress = contractValue * (progress / 100) * 0.6 // Assume 60% cost ratio as healthy\n  const burnStatus = totalBurn <= expectedBurnAtProgress ? 'on-budget' : totalBurn <= expectedBurnAtProgress * 1.2 ? 'warning' : 'over-budget'\n\n  const statusLabel = {\n    'on-budget': 'On Budget',\n    'warning': 'Watch Closely',\n    'over-budget': 'Over Budget'\n  }[burnStatus]\n\n  const StatusIcon = burnStatus === 'on-budget' ? TrendingDown : burnStatus === 'warning' ? Minus : TrendingUp\n\n  // Calculate projected total cost at completion\n  const burnPerProgress = progress > 0 ? totalBurn / (progress / 100) : 0\n  const projectedTotalCost = burnPerProgress\n\n  // Merge labor and materials/equipment by date for combined view\n  const combinedByDate = []\n  const dateMap = {}\n\n  laborByDate.forEach(day => {\n    if (!dateMap[day.date]) {\n      dateMap[day.date] = { date: day.date, labor: 0, materialsEquipment: 0, total: 0 }\n    }\n    dateMap[day.date].labor = day.cost || 0\n    dateMap[day.date].total += day.cost || 0\n  })\n\n  materialsEquipmentByDate.forEach(day => {\n    if (!dateMap[day.date]) {\n      dateMap[day.date] = { date: day.date, labor: 0, materialsEquipment: 0, total: 0 }\n    }\n    dateMap[day.date].materialsEquipment = day.cost || 0\n    dateMap[day.date].total += day.cost || 0\n  })\n\n  Object.values(dateMap)\n    .sort((a, b) => new Date(b.date) - new Date(a.date))\n    .slice(0, 10)\n    .forEach(d => combinedByDate.push(d))\n\n  // Max daily cost for bar sizing\n  const maxDailyCost = Math.max(...combinedByDate.map(d => d.total), 1)\n\n  return (\n    <div className=\"burn-rate-card\">\n      <div className=\"burn-rate-header\">\n        <div className=\"burn-rate-title\">\n          <Flame size={18} className=\"burn-icon\" />\n          <h3>Burn Rate</h3>\n        </div>\n        <div className={`burn-status ${burnStatus}`}>\n          <StatusIcon size={14} />\n          <span>{statusLabel}</span>\n        </div>\n      </div>\n\n      <div className=\"burn-rate-hero\">\n        <div className=\"burn-rate-main\">\n          <span className=\"burn-rate-value\">{formatCurrency(dailyBurn)}</span>\n          <span className=\"burn-rate-unit\">/day</span>\n        </div>\n        {daysWorked > 0 && (\n          <div className=\"burn-rate-context\">\n            Based on {daysWorked} work day{daysWorked !== 1 ? 's' : ''}\n          </div>\n        )}\n      </div>\n\n      <div className=\"burn-rate-summary\">\n        <div className=\"burn-summary-item\">\n          <span className=\"burn-summary-label\">Total Spent</span>\n          <span className=\"burn-summary-value\">{formatCurrency(totalBurn)}</span>\n        </div>\n        <div className=\"burn-summary-divider\"></div>\n        <div className=\"burn-summary-item\">\n          <span className=\"burn-summary-label\">Labor</span>\n          <span className=\"burn-summary-value\">{formatCurrency(laborCost)}</span>\n        </div>\n        <div className=\"burn-summary-divider\"></div>\n        <div className=\"burn-summary-item\">\n          <span className=\"burn-summary-label\">Materials</span>\n          <span className=\"burn-summary-value\">{formatCurrency(materialsEquipmentCost)}</span>\n        </div>\n      </div>\n\n      {progress > 0 && (\n        <div className=\"burn-projection\">\n          <span className=\"projection-label\">Projected at completion:</span>\n          <span className={`projection-value ${projectedTotalCost > contractValue * 0.7 ? 'warning' : ''}`}>\n            {formatCurrency(projectedTotalCost)}\n          </span>\n        </div>\n      )}\n\n      {combinedByDate.length > 0 && (\n        <button\n          className=\"burn-rate-expand\"\n          onClick={() => setExpanded(!expanded)}\n        >\n          {expanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\n          <span>{expanded ? 'Hide' : 'View'} Daily Breakdown</span>\n        </button>\n      )}\n\n      {expanded && combinedByDate.length > 0 && (\n        <div className=\"burn-rate-details\">\n          <div className=\"burn-details-header\">\n            <span>Date</span>\n            <span>Labor</span>\n            <span>Materials</span>\n            <span>Total</span>\n          </div>\n          {combinedByDate.map(day => (\n            <div key={day.date} className=\"burn-details-row\">\n              <span className=\"burn-date\">{formatDate(day.date)}</span>\n              <span className=\"burn-labor\">{day.labor > 0 ? formatCurrency(day.labor) : '-'}</span>\n              <span className=\"burn-materials\">{day.materialsEquipment > 0 ? formatCurrency(day.materialsEquipment) : '-'}</span>\n              <span className=\"burn-total\">\n                <span className=\"burn-bar\" style={{ width: `${(day.total / maxDailyCost) * 100}%` }}></span>\n                <span className=\"burn-amount\">{formatCurrency(day.total)}</span>\n              </span>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect, useMemo, useCallback } from 'react'\nimport { ClipboardList, ChevronDown, ChevronRight, Calendar } from 'lucide-react'\nimport { db } from '../lib/supabase'\nimport { useBranding } from '../lib/BrandingContext'\nimport { hexToRgb, loadImageAsBase64 } from '../lib/imageUtils'\nimport { ErrorState, EmptyState } from './ui'\n// Dynamic import for jsPDF (loaded on-demand to reduce initial bundle)\nconst loadJsPDF = () => import('jspdf')\n\nexport default function DailyReportsList({ project, company, onShowToast }) {\n  const { branding } = useBranding()\n  const [reports, setReports] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState(null)\n  const [expandedReport, setExpandedReport] = useState(null)\n\n  // Multi-select state\n  const [selectedReports, setSelectedReports] = useState(new Set())\n  const [selectMode, setSelectMode] = useState(false)\n\n  // View mode state\n  const [viewMode, setViewMode] = useState('recent') // 'recent' | 'all'\n  const [expandedMonths, setExpandedMonths] = useState(new Set())\n\n  // Date filter state\n  const [dateFilter, setDateFilter] = useState({ start: '', end: '' })\n\n  useEffect(() => {\n    loadReports()\n\n    // Subscribe to realtime updates\n    const subscription = db.subscribeToDailyReports?.(project.id, () => {\n      loadReports()\n    })\n\n    return () => {\n      if (subscription) db.unsubscribe?.(subscription)\n    }\n  }, [project.id])\n\n  const loadReports = useCallback(async () => {\n    try {\n      setError(null)\n      // Load more reports to support month grouping\n      const data = await db.getDailyReports(project.id, 365)\n      setReports(data || [])\n    } catch (err) {\n      console.error('Error loading daily reports:', err)\n      setError(err)\n      onShowToast?.('Error loading daily reports', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }, [project.id]) // onShowToast is stable (memoized in App.jsx)\n\n  // Filter reports based on view mode and date filter\n  const filteredReports = useMemo(() => {\n    let filtered = [...reports]\n\n    // Apply date filter if set\n    if (dateFilter.start) {\n      const startDate = new Date(dateFilter.start)\n      startDate.setHours(0, 0, 0, 0)\n      filtered = filtered.filter(r => {\n        const reportDate = new Date(r.report_date || r.created_at)\n        return reportDate >= startDate\n      })\n    }\n    if (dateFilter.end) {\n      const endDate = new Date(dateFilter.end)\n      endDate.setHours(23, 59, 59, 999)\n      filtered = filtered.filter(r => {\n        const reportDate = new Date(r.report_date || r.created_at)\n        return reportDate <= endDate\n      })\n    }\n\n    // In recent mode, show only last 7 days\n    if (viewMode === 'recent') {\n      const sevenDaysAgo = new Date()\n      sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7)\n      sevenDaysAgo.setHours(0, 0, 0, 0)\n      filtered = filtered.filter(r => {\n        const reportDate = new Date(r.report_date || r.created_at)\n        return reportDate >= sevenDaysAgo\n      })\n    }\n\n    return filtered\n  }, [reports, viewMode, dateFilter])\n\n  // Group reports by month for 'all' view\n  const reportsByMonth = useMemo(() => {\n    if (viewMode !== 'all') return null\n\n    const groups = {}\n    filteredReports.forEach(report => {\n      const date = new Date(report.report_date || report.created_at)\n      const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`\n      const monthLabel = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })\n\n      if (!groups[monthKey]) {\n        groups[monthKey] = { label: monthLabel, reports: [] }\n      }\n      groups[monthKey].reports.push(report)\n    })\n\n    // Sort by month (newest first)\n    return Object.entries(groups).sort((a, b) => b[0].localeCompare(a[0]))\n  }, [filteredReports, viewMode])\n\n  // Auto-expand current month\n  useEffect(() => {\n    if (reportsByMonth && reportsByMonth.length > 0) {\n      const currentMonthKey = reportsByMonth[0][0]\n      setExpandedMonths(new Set([currentMonthKey]))\n    }\n  }, [reportsByMonth])\n\n  // Selection handlers\n  const toggleSelectMode = () => {\n    setSelectMode(!selectMode)\n    if (selectMode) {\n      setSelectedReports(new Set())\n    }\n  }\n\n  const toggleReportSelection = (reportId) => {\n    const newSelection = new Set(selectedReports)\n    if (newSelection.has(reportId)) {\n      newSelection.delete(reportId)\n    } else {\n      newSelection.add(reportId)\n    }\n    setSelectedReports(newSelection)\n  }\n\n  const toggleSelectAll = () => {\n    if (selectedReports.size === filteredReports.length) {\n      setSelectedReports(new Set())\n    } else {\n      setSelectedReports(new Set(filteredReports.map(r => r.id)))\n    }\n  }\n\n  const toggleMonthExpand = (monthKey) => {\n    const newExpanded = new Set(expandedMonths)\n    if (newExpanded.has(monthKey)) {\n      newExpanded.delete(monthKey)\n    } else {\n      newExpanded.add(monthKey)\n    }\n    setExpandedMonths(newExpanded)\n  }\n\n  // Get reports for export (selected or all filtered)\n  const getExportReports = () => {\n    if (selectedReports.size > 0) {\n      return filteredReports.filter(r => selectedReports.has(r.id))\n    }\n    return filteredReports\n  }\n\n  const formatDate = (dateStr) => {\n    const date = new Date(dateStr)\n    return date.toLocaleDateString('en-US', {\n      weekday: 'short',\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric'\n    })\n  }\n\n  const formatTime = (dateStr) => {\n    return new Date(dateStr).toLocaleTimeString('en-US', {\n      hour: 'numeric',\n      minute: '2-digit'\n    })\n  }\n\n  const getStatusIcon = (status) => {\n    switch (status) {\n      case 'submitted': return ''\n      case 'reviewed': return ''\n      case 'draft': return ''\n      default: return ''\n    }\n  }\n\n  const getStatusLabel = (status) => {\n    switch (status) {\n      case 'submitted': return 'Submitted'\n      case 'reviewed': return 'Reviewed'\n      case 'draft': return 'Draft'\n      default: return status\n    }\n  }\n\n  // Export to PDF with company branding\n  const exportToPDF = async () => {\n    const exportReports = getExportReports()\n    if (exportReports.length === 0) {\n      onShowToast?.('No reports to export', 'error')\n      return\n    }\n\n    onShowToast?.('Generating PDF...', 'info')\n\n    // Dynamic import - only loads jsPDF when user actually exports\n    const jsPDFModule = await loadJsPDF()\n    const jsPDF = jsPDFModule.default\n\n    const doc = new jsPDF()\n    const pageWidth = doc.internal.pageSize.getWidth()\n    const margin = 20\n    let yPos = margin\n\n    const primaryColor = hexToRgb(branding?.primary_color || '#3B82F6')\n    const secondaryColor = hexToRgb(branding?.secondary_color || '#1E40AF')\n\n    // Header with branding\n    doc.setFillColor(...primaryColor)\n    doc.rect(0, 0, pageWidth, 45, 'F')\n    doc.setFillColor(...secondaryColor)\n    doc.rect(0, 42, pageWidth, 3, 'F')\n\n    // Add logo if available\n    let logoOffset = margin\n    if (branding?.logo_url) {\n      try {\n        const logoBase64 = await loadImageAsBase64(branding.logo_url)\n        if (logoBase64) {\n          doc.addImage(logoBase64, 'PNG', margin, 7, 30, 30)\n          logoOffset = margin + 40\n        }\n      } catch (e) {\n        console.error('Error adding logo:', e)\n      }\n    }\n\n    doc.setTextColor(255, 255, 255)\n    doc.setFontSize(22)\n    doc.setFont('helvetica', 'bold')\n    doc.text(company?.name || 'Company Name', logoOffset, 20)\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'normal')\n    doc.text('DAILY REPORTS SUMMARY', logoOffset, 30)\n\n    doc.setFontSize(9)\n    doc.text(`Generated: ${new Date().toLocaleDateString()}`, pageWidth - margin, 20, { align: 'right' })\n    if (project.job_number) {\n      doc.text(`Job #: ${project.job_number}`, pageWidth - margin, 28, { align: 'right' })\n    }\n\n    yPos = 55\n\n    // Project info\n    doc.setFillColor(248, 250, 252)\n    doc.rect(margin, yPos - 5, pageWidth - margin * 2, 20, 'F')\n    doc.setTextColor(...primaryColor)\n    doc.setFontSize(14)\n    doc.setFont('helvetica', 'bold')\n    doc.text(`Project: ${project.name}`, margin + 5, yPos + 7)\n    doc.setFontSize(10)\n    doc.setTextColor(100, 100, 100)\n    doc.text(`${exportReports.length} Report${exportReports.length !== 1 ? 's' : ''}`, pageWidth - margin - 5, yPos + 7, { align: 'right' })\n\n    yPos += 25\n\n    // Reports\n    exportReports.forEach((report, index) => {\n      // Check if we need a new page\n      if (yPos > 250) {\n        doc.addPage()\n        yPos = margin\n      }\n\n      // Report header\n      doc.setFillColor(...primaryColor)\n      doc.setTextColor(255, 255, 255)\n      doc.rect(margin, yPos, pageWidth - margin * 2, 10, 'F')\n      doc.setFontSize(11)\n      doc.setFont('helvetica', 'bold')\n      doc.text(formatDate(report.report_date || report.created_at), margin + 5, yPos + 7)\n      doc.text(getStatusLabel(report.status), pageWidth - margin - 5, yPos + 7, { align: 'right' })\n      yPos += 15\n\n      // Stats row\n      doc.setTextColor(50, 50, 50)\n      doc.setFontSize(10)\n      doc.setFont('helvetica', 'normal')\n      const stats = `Crew: ${report.crew_count || 0}  |  Tasks: ${report.tasks_completed || 0}  |  T&M: ${report.tm_tickets_count || 0}  |  Photos: ${report.photos_count || 0}`\n      doc.text(stats, margin + 5, yPos)\n      yPos += 8\n\n      // Crew list\n      if (report.crew_list?.length > 0) {\n        doc.setFont('helvetica', 'bold')\n        doc.text('Crew:', margin + 5, yPos)\n        doc.setFont('helvetica', 'normal')\n        const crewNames = report.crew_list.map(w => `${w.name} (${w.role})`).join(', ')\n        const crewLines = doc.splitTextToSize(crewNames, pageWidth - margin * 2 - 30)\n        doc.text(crewLines, margin + 25, yPos)\n        yPos += crewLines.length * 5 + 3\n      }\n\n      // Field notes\n      if (report.field_notes) {\n        doc.setFont('helvetica', 'bold')\n        doc.text('Notes:', margin + 5, yPos)\n        doc.setFont('helvetica', 'normal')\n        const noteLines = doc.splitTextToSize(report.field_notes, pageWidth - margin * 2 - 30)\n        doc.text(noteLines, margin + 25, yPos)\n        yPos += noteLines.length * 5 + 3\n      }\n\n      // Issues\n      if (report.issues) {\n        doc.setTextColor(180, 50, 50)\n        doc.setFont('helvetica', 'bold')\n        doc.text('Issues:', margin + 5, yPos)\n        doc.setFont('helvetica', 'normal')\n        const issueLines = doc.splitTextToSize(report.issues, pageWidth - margin * 2 - 30)\n        doc.text(issueLines, margin + 25, yPos)\n        doc.setTextColor(50, 50, 50)\n        yPos += issueLines.length * 5 + 3\n      }\n\n      yPos += 10\n    })\n\n    // Footer\n    const pageCount = doc.internal.getNumberOfPages()\n    for (let i = 1; i <= pageCount; i++) {\n      doc.setPage(i)\n      doc.setFontSize(8)\n      doc.setTextColor(150, 150, 150)\n      doc.text(`Page ${i} of ${pageCount}`, pageWidth / 2, doc.internal.pageSize.getHeight() - 10, { align: 'center' })\n    }\n\n    const fileName = `${project.name}_Daily_Reports_${new Date().toISOString().split('T')[0]}.pdf`\n    doc.save(fileName)\n    onShowToast?.('PDF exported!', 'success')\n  }\n\n  // Render a single report card\n  const renderReportCard = (report) => (\n    <div\n      key={report.id}\n      className={`daily-report-card ${report.status} ${selectedReports.has(report.id) ? 'selected' : ''}`}\n    >\n      <div\n        className=\"daily-report-header-row\"\n        onClick={() => setExpandedReport(expandedReport === report.id ? null : report.id)}\n      >\n        {selectMode && (\n          <input\n            type=\"checkbox\"\n            className=\"report-checkbox\"\n            checked={selectedReports.has(report.id)}\n            onChange={(e) => {\n              e.stopPropagation()\n              toggleReportSelection(report.id)\n            }}\n            onClick={(e) => e.stopPropagation()}\n          />\n        )}\n        <div className=\"daily-report-info\">\n          <span className=\"report-date\">{formatDate(report.report_date || report.created_at)}</span>\n          <span className={`report-status ${report.status}`}>\n            {getStatusIcon(report.status)} {getStatusLabel(report.status)}\n          </span>\n        </div>\n        <div className=\"daily-report-summary\">\n          <span className=\"report-crew\">{report.crew_count || 0} crew</span>\n          <span className=\"report-tasks\">{report.tasks_completed || 0} tasks</span>\n          <span className=\"report-expand\">{expandedReport === report.id ? '' : ''}</span>\n        </div>\n      </div>\n\n      {expandedReport === report.id && (\n        <div className=\"daily-report-details\">\n          {/* Summary Stats */}\n          <div className=\"report-stats-grid\">\n            <div className=\"report-stat\">\n              <span className=\"stat-value\">{report.crew_count || 0}</span>\n              <span className=\"stat-label\">Crew on Site</span>\n            </div>\n            <div className=\"report-stat\">\n              <span className=\"stat-value\">{report.tasks_completed || 0}</span>\n              <span className=\"stat-label\">Tasks Done</span>\n            </div>\n            <div className=\"report-stat\">\n              <span className=\"stat-value\">{report.tm_tickets_count || 0}</span>\n              <span className=\"stat-label\">T&M Tickets</span>\n            </div>\n            <div className=\"report-stat\">\n              <span className=\"stat-value\">{report.photos_count || 0}</span>\n              <span className=\"stat-label\">Photos</span>\n            </div>\n          </div>\n\n          {/* Crew List */}\n          {report.crew_list?.length > 0 && (\n            <div className=\"report-section\">\n              <h4>Crew</h4>\n              <div className=\"report-crew-list\">\n                {report.crew_list.map((worker, i) => (\n                  <div key={i} className=\"crew-member\">\n                    <span className=\"crew-name\">{worker.name}</span>\n                    <span className=\"crew-role\">{worker.role}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Completed Tasks */}\n          {report.completed_tasks?.length > 0 && (\n            <div className=\"report-section\">\n              <h4>Completed Today</h4>\n              <ul className=\"report-tasks-list\">\n                {report.completed_tasks.map((task, i) => (\n                  <li key={i}>\n                    {task.name}\n                    {task.group && <span className=\"task-group\">{task.group}</span>}\n                  </li>\n                ))}\n              </ul>\n            </div>\n          )}\n\n          {/* Field Notes */}\n          {report.field_notes && (\n            <div className=\"report-section\">\n              <h4>Field Notes</h4>\n              <p className=\"report-notes\">{report.field_notes}</p>\n            </div>\n          )}\n\n          {/* Issues */}\n          {report.issues && (\n            <div className=\"report-section issues\">\n              <h4>Issues / Concerns</h4>\n              <p className=\"report-issues\">{report.issues}</p>\n            </div>\n          )}\n\n          {/* Submitted Info */}\n          {report.submitted_at && (\n            <div className=\"report-meta\">\n              <span>Submitted by {report.submitted_by || 'Field'} at {formatTime(report.submitted_at)}</span>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n\n  if (loading) {\n    return <div className=\"loading\">Loading daily reports...</div>\n  }\n\n  if (error) {\n    return (\n      <div className=\"daily-reports-list card\">\n        <ErrorState\n          title=\"Unable to load reports\"\n          message=\"There was a problem loading daily reports. Please try again.\"\n          error={error}\n          onRetry={loadReports}\n        />\n      </div>\n    )\n  }\n\n  const totalReports = reports.length\n  const recentCount = filteredReports.length\n\n  return (\n    <div className=\"daily-reports-list card\">\n      {/* Header */}\n      <div className=\"daily-reports-header\">\n        <h3>Daily Reports</h3>\n        <div className=\"daily-reports-actions\">\n          {reports.length > 0 && (\n            <>\n              <button\n                className={`btn btn-small ${selectMode ? 'btn-primary' : 'btn-secondary'}`}\n                onClick={toggleSelectMode}\n              >\n                {selectMode ? 'Cancel' : 'Select'}\n              </button>\n              <button className=\"btn btn-secondary btn-small\" onClick={exportToPDF}>\n                PDF{selectedReports.size > 0 ? ` (${selectedReports.size})` : ''}\n              </button>\n            </>\n          )}\n        </div>\n      </div>\n\n      {/* View Mode Toggle */}\n      {reports.length > 0 && (\n        <div className=\"view-mode-bar\">\n          <div className=\"view-mode-tabs\">\n            <button\n              className={`view-mode-tab ${viewMode === 'recent' ? 'active' : ''}`}\n              onClick={() => setViewMode('recent')}\n            >\n              Recent (7 days)\n            </button>\n            <button\n              className={`view-mode-tab ${viewMode === 'all' ? 'active' : ''}`}\n              onClick={() => setViewMode('all')}\n            >\n              All ({totalReports})\n            </button>\n          </div>\n\n          {/* Date Filter (only in 'all' mode) */}\n          {viewMode === 'all' && (\n            <div className=\"date-filter\">\n              <Calendar size={14} className=\"date-filter-icon\" />\n              <input\n                type=\"date\"\n                value={dateFilter.start}\n                onChange={(e) => setDateFilter(prev => ({ ...prev, start: e.target.value }))}\n                className=\"date-input\"\n              />\n              <span className=\"date-separator\">to</span>\n              <input\n                type=\"date\"\n                value={dateFilter.end}\n                onChange={(e) => setDateFilter(prev => ({ ...prev, end: e.target.value }))}\n                className=\"date-input\"\n              />\n              {(dateFilter.start || dateFilter.end) && (\n                <button\n                  className=\"date-clear\"\n                  onClick={() => setDateFilter({ start: '', end: '' })}\n                >\n                  Clear\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Select All (when in select mode) */}\n      {selectMode && filteredReports.length > 0 && (\n        <div className=\"select-all-bar\">\n          <label className=\"select-all-label\">\n            <input\n              type=\"checkbox\"\n              checked={selectedReports.size === filteredReports.length && filteredReports.length > 0}\n              onChange={toggleSelectAll}\n            />\n            Select All ({filteredReports.length})\n          </label>\n          {selectedReports.size > 0 && (\n            <span className=\"selected-count\">{selectedReports.size} selected</span>\n          )}\n        </div>\n      )}\n\n      {/* Reports List */}\n      {reports.length === 0 ? (\n        <EmptyState\n          icon={ClipboardList}\n          title=\"No daily reports yet\"\n          message=\"Reports from the field will appear here\"\n        />\n      ) : filteredReports.length === 0 ? (\n        <EmptyState\n          icon={ClipboardList}\n          title=\"No reports in this time period\"\n          message={viewMode === 'recent' ? 'No reports in the last 7 days' : 'Try adjusting your date filter'}\n        />\n      ) : viewMode === 'recent' ? (\n        // Recent view - flat list\n        <div className=\"daily-reports\">\n          {filteredReports.map(report => renderReportCard(report))}\n          {totalReports > recentCount && (\n            <div className=\"view-all-prompt\">\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => setViewMode('all')}\n              >\n                View All {totalReports} Reports\n              </button>\n            </div>\n          )}\n        </div>\n      ) : (\n        // All view - grouped by month\n        <div className=\"daily-reports grouped\">\n          {reportsByMonth?.map(([monthKey, { label, reports: monthReports }]) => (\n            <div key={monthKey} className=\"month-group\">\n              <div\n                className=\"month-header\"\n                onClick={() => toggleMonthExpand(monthKey)}\n              >\n                {expandedMonths.has(monthKey) ? (\n                  <ChevronDown size={18} className=\"month-chevron\" />\n                ) : (\n                  <ChevronRight size={18} className=\"month-chevron\" />\n                )}\n                <span className=\"month-label\">{label}</span>\n                <span className=\"month-count\">{monthReports.length} report{monthReports.length !== 1 ? 's' : ''}</span>\n              </div>\n              {expandedMonths.has(monthKey) && (\n                <div className=\"month-reports\">\n                  {monthReports.map(report => renderReportCard(report))}\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n}\n","import { memo } from 'react'\n\n/**\n * Memoized Injury Report Card component\n * Prevents unnecessary re-renders when parent list updates\n */\nconst InjuryReportCard = memo(function InjuryReportCard({\n  report,\n  formatDate,\n  formatTime,\n  getInjuryTypeColor,\n  getInjuryTypeLabel,\n  getStatusColor,\n  onViewDetails\n}) {\n  const handleClick = () => onViewDetails(report)\n\n  const handleKeyDown = (e) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault()\n      onViewDetails(report)\n    }\n  }\n\n  return (\n    <div\n      className=\"report-card\"\n      onClick={handleClick}\n      onKeyDown={handleKeyDown}\n      role=\"button\"\n      tabIndex={0}\n      aria-label={`Injury report for ${report.employee_name} on ${formatDate(report.incident_date)}`}\n    >\n      <div className=\"report-header\">\n        <div>\n          <div className=\"report-date\">\n            {formatDate(report.incident_date)} at {formatTime(report.incident_time)}\n          </div>\n          <div className=\"employee-name\">{report.employee_name}</div>\n        </div>\n        <div className=\"report-badges\">\n          <span\n            className=\"badge\"\n            style={{ backgroundColor: getInjuryTypeColor(report.injury_type) }}\n          >\n            {getInjuryTypeLabel(report.injury_type)}\n          </span>\n          <span\n            className=\"badge\"\n            style={{ backgroundColor: getStatusColor(report.status) }}\n          >\n            {report.status.replace('_', ' ')}\n          </span>\n        </div>\n      </div>\n\n      <div className=\"report-summary\">\n        <div className=\"summary-item\">\n          <strong>Location:</strong> {report.incident_location}\n        </div>\n        <div className=\"summary-item\">\n          <strong>Reported by:</strong> {report.reported_by_name} ({report.reported_by_title})\n        </div>\n        {report.body_part_affected && (\n          <div className=\"summary-item\">\n            <strong>Body Part:</strong> {report.body_part_affected}\n          </div>\n        )}\n        {report.osha_recordable && (\n          <div className=\"summary-item\">\n            <span className=\"osha-badge\">OSHA Recordable</span>\n          </div>\n        )}\n      </div>\n\n      <div className=\"report-description\">\n        {report.incident_description.substring(0, 150)}\n        {report.incident_description.length > 150 && '...'}\n      </div>\n\n      <div className=\"report-footer\">\n        <span>Click to view full details</span>\n      </div>\n    </div>\n  )\n})\n\nexport default InjuryReportCard\n","import { useState, useEffect, useMemo, useCallback } from 'react'\nimport { ChevronDown, ChevronRight, Calendar } from 'lucide-react'\nimport { db } from '../lib/supabase'\nimport { useBranding } from '../lib/BrandingContext'\nimport { hexToRgb, loadImageAsBase64 } from '../lib/imageUtils'\nimport { ErrorState } from './ui'\nimport InjuryReportForm from './InjuryReportForm'\nimport InjuryReportCard from './InjuryReportCard'\nimport Toast from './Toast'\n// Dynamic import for jsPDF (loaded on-demand to reduce initial bundle)\nconst loadJsPDF = () => import('jspdf')\n\nexport default function InjuryReportsList({ project, companyId, company, user, onShowToast }) {\n  const { branding } = useBranding()\n  const [reports, setReports] = useState([])\n  const [selectedReport, setSelectedReport] = useState(null)\n  const [showForm, setShowForm] = useState(false)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState(null)\n  const [toast, setToast] = useState(null)\n\n  // View mode state\n  const [viewMode, setViewMode] = useState('recent') // 'recent' | 'all'\n  const [expandedMonths, setExpandedMonths] = useState(new Set())\n  const [dateFilter, setDateFilter] = useState({ start: '', end: '' })\n\n  useEffect(() => {\n    loadReports()\n\n    // Subscribe to real-time updates for injury reports\n    const effectiveCompanyId = companyId || project?.company_id\n    const subscription = effectiveCompanyId\n      ? db.subscribeToInjuryReports?.(effectiveCompanyId, () => {\n          loadReports()\n        })\n      : null\n\n    return () => {\n      if (subscription) db.unsubscribe?.(subscription)\n    }\n  }, [project?.id, companyId])\n\n  const loadReports = useCallback(async () => {\n    setLoading(true)\n    setError(null)\n    try {\n      const data = project\n        ? await db.getInjuryReports(project.id)\n        : await db.getCompanyInjuryReports(companyId)\n      setReports(data)\n    } catch (err) {\n      console.error('Error loading injury reports:', err)\n      setError(err)\n      setToast({ type: 'error', message: 'Failed to load injury reports' })\n    } finally {\n      setLoading(false)\n    }\n  }, [project?.id, companyId])\n\n  const handleReportCreated = () => {\n    loadReports()\n    setShowForm(false)\n    setToast({ type: 'success', message: 'Injury report created successfully' })\n  }\n\n  const handleViewDetails = (report) => {\n    setSelectedReport(report)\n  }\n\n  const handleCloseDetails = () => {\n    setSelectedReport(null)\n  }\n\n  const formatDate = (dateString) => {\n    if (!dateString) return ''\n    const date = new Date(dateString)\n    return date.toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    })\n  }\n\n  const formatTime = (timeString) => {\n    if (!timeString) return ''\n    return new Date(`2000-01-01T${timeString}`).toLocaleTimeString('en-US', {\n      hour: 'numeric',\n      minute: '2-digit',\n      hour12: true\n    })\n  }\n\n  const getInjuryTypeLabel = (type) => {\n    const labels = {\n      minor: 'Minor Injury',\n      serious: 'Serious Injury',\n      critical: 'Critical Injury',\n      near_miss: 'Near Miss'\n    }\n    return labels[type] || type\n  }\n\n  const getStatusColor = (status) => {\n    const colors = {\n      reported: '#fbbf24',\n      under_investigation: '#3b82f6',\n      closed: '#10b981'\n    }\n    return colors[status] || '#9ca3af'\n  }\n\n  const getInjuryTypeColor = (type) => {\n    const colors = {\n      minor: '#10b981',\n      serious: '#f59e0b',\n      critical: '#ef4444',\n      near_miss: '#6b7280'\n    }\n    return colors[type] || '#9ca3af'\n  }\n\n  // Filter reports by view mode and date range\n  const filteredReports = useMemo(() => {\n    let filtered = [...reports]\n\n    // Apply date filter if set\n    if (dateFilter.start) {\n      const startDate = new Date(dateFilter.start)\n      startDate.setHours(0, 0, 0, 0)\n      filtered = filtered.filter(r => {\n        const reportDate = new Date(r.incident_date)\n        return reportDate >= startDate\n      })\n    }\n    if (dateFilter.end) {\n      const endDate = new Date(dateFilter.end)\n      endDate.setHours(23, 59, 59, 999)\n      filtered = filtered.filter(r => {\n        const reportDate = new Date(r.incident_date)\n        return reportDate <= endDate\n      })\n    }\n\n    // In recent mode, show only last 7 days\n    if (viewMode === 'recent') {\n      const sevenDaysAgo = new Date()\n      sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7)\n      sevenDaysAgo.setHours(0, 0, 0, 0)\n      filtered = filtered.filter(r => {\n        const reportDate = new Date(r.incident_date)\n        return reportDate >= sevenDaysAgo\n      })\n    }\n\n    return filtered\n  }, [reports, viewMode, dateFilter])\n\n  // Group reports by month for 'all' view\n  const reportsByMonth = useMemo(() => {\n    if (viewMode !== 'all') return null\n\n    const groups = {}\n    filteredReports.forEach(report => {\n      const date = new Date(report.incident_date)\n      const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`\n      const monthLabel = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })\n\n      if (!groups[monthKey]) {\n        groups[monthKey] = { label: monthLabel, reports: [] }\n      }\n      groups[monthKey].reports.push(report)\n    })\n\n    return Object.entries(groups).sort((a, b) => b[0].localeCompare(a[0]))\n  }, [filteredReports, viewMode])\n\n  // Auto-expand current month\n  useEffect(() => {\n    if (reportsByMonth && reportsByMonth.length > 0) {\n      const currentMonthKey = reportsByMonth[0][0]\n      setExpandedMonths(new Set([currentMonthKey]))\n    }\n  }, [reportsByMonth])\n\n  const toggleMonthExpand = (monthKey) => {\n    const newExpanded = new Set(expandedMonths)\n    if (newExpanded.has(monthKey)) {\n      newExpanded.delete(monthKey)\n    } else {\n      newExpanded.add(monthKey)\n    }\n    setExpandedMonths(newExpanded)\n  }\n\n  // Export to PDF with company branding\n  const exportToPDF = async () => {\n    if (reports.length === 0) {\n      setToast({ type: 'error', message: 'No reports to export' })\n      return\n    }\n\n    setToast({ type: 'info', message: 'Generating PDF...' })\n\n    // Dynamic import - only loads jsPDF when user actually exports\n    const jsPDFModule = await loadJsPDF()\n    const jsPDF = jsPDFModule.default\n\n    const doc = new jsPDF()\n    const pageWidth = doc.internal.pageSize.getWidth()\n    const margin = 20\n    let yPos = margin\n\n    const primaryColor = hexToRgb(branding?.primary_color || '#3B82F6')\n    const secondaryColor = hexToRgb(branding?.secondary_color || '#1E40AF')\n\n    // Header with branding\n    doc.setFillColor(...primaryColor)\n    doc.rect(0, 0, pageWidth, 45, 'F')\n    doc.setFillColor(...secondaryColor)\n    doc.rect(0, 42, pageWidth, 3, 'F')\n\n    // Add logo if available\n    let logoOffset = margin\n    if (branding?.logo_url) {\n      try {\n        const logoBase64 = await loadImageAsBase64(branding.logo_url)\n        if (logoBase64) {\n          doc.addImage(logoBase64, 'PNG', margin, 7, 30, 30)\n          logoOffset = margin + 40\n        }\n      } catch (e) {\n        console.error('Error adding logo:', e)\n      }\n    }\n\n    doc.setTextColor(255, 255, 255)\n    doc.setFontSize(22)\n    doc.setFont('helvetica', 'bold')\n    doc.text(company?.name || 'Company', logoOffset, 20)\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'normal')\n    doc.text('INJURY & INCIDENT REPORTS', logoOffset, 30)\n\n    doc.setFontSize(9)\n    doc.text(`Generated: ${new Date().toLocaleDateString()}`, pageWidth - margin, 20, { align: 'right' })\n    doc.text(`Total Reports: ${reports.length}`, pageWidth - margin, 28, { align: 'right' })\n\n    yPos = 55\n\n    // Project info if available\n    if (project) {\n      doc.setFillColor(248, 250, 252)\n      doc.rect(margin, yPos - 5, pageWidth - margin * 2, 15, 'F')\n      doc.setTextColor(...primaryColor)\n      doc.setFontSize(12)\n      doc.setFont('helvetica', 'bold')\n      doc.text(`Project: ${project.name}`, margin + 5, yPos + 5)\n      yPos += 20\n    }\n\n    // Reports\n    reports.forEach((report) => {\n      // Check if we need a new page (injury reports need more space)\n      if (yPos > 200) {\n        doc.addPage()\n        yPos = margin\n      }\n\n      // Report header with injury type color\n      const typeColor = hexToRgb(getInjuryTypeColor(report.injury_type))\n      doc.setFillColor(...typeColor)\n      doc.rect(margin, yPos, pageWidth - margin * 2, 12, 'F')\n      doc.setTextColor(255, 255, 255)\n      doc.setFontSize(11)\n      doc.setFont('helvetica', 'bold')\n      doc.text(`${report.employee_name} - ${getInjuryTypeLabel(report.injury_type)}`, margin + 5, yPos + 8)\n      doc.text(formatDate(report.incident_date), pageWidth - margin - 5, yPos + 8, { align: 'right' })\n      yPos += 17\n\n      doc.setTextColor(50, 50, 50)\n      doc.setFontSize(9)\n      doc.setFont('helvetica', 'normal')\n\n      // Location and time\n      doc.text(`Location: ${report.incident_location}`, margin + 5, yPos)\n      if (report.incident_time) {\n        doc.text(`Time: ${formatTime(report.incident_time)}`, margin + 100, yPos)\n      }\n      yPos += 6\n\n      // Description\n      doc.setFont('helvetica', 'bold')\n      doc.text('Description:', margin + 5, yPos)\n      doc.setFont('helvetica', 'normal')\n      yPos += 5\n      const descLines = doc.splitTextToSize(report.incident_description, pageWidth - margin * 2 - 10)\n      doc.text(descLines, margin + 5, yPos)\n      yPos += descLines.length * 4 + 3\n\n      // Key details\n      const details = []\n      if (report.body_part_affected) details.push(`Body Part: ${report.body_part_affected}`)\n      if (report.osha_recordable) details.push('OSHA Recordable')\n      if (report.workers_comp_claim) details.push('Workers\\' Comp Filed')\n      if (report.medical_treatment_required) details.push('Medical Treatment Required')\n\n      if (details.length > 0) {\n        doc.setFontSize(8)\n        doc.setTextColor(100, 100, 100)\n        doc.text(details.join('  |  '), margin + 5, yPos)\n        yPos += 5\n      }\n\n      // Reported by\n      doc.setFontSize(8)\n      doc.text(`Reported by: ${report.reported_by_name} (${report.reported_by_title})`, margin + 5, yPos)\n      yPos += 12\n    })\n\n    // Footer\n    const pageCount = doc.internal.getNumberOfPages()\n    for (let i = 1; i <= pageCount; i++) {\n      doc.setPage(i)\n      doc.setFontSize(8)\n      doc.setTextColor(150, 150, 150)\n      doc.text(`Page ${i} of ${pageCount}`, pageWidth / 2, doc.internal.pageSize.getHeight() - 10, { align: 'center' })\n      doc.text('CONFIDENTIAL - Injury Report', margin, doc.internal.pageSize.getHeight() - 10)\n    }\n\n    const fileName = `Injury_Reports_${new Date().toISOString().split('T')[0]}.pdf`\n    doc.save(fileName)\n    setToast({ type: 'success', message: 'PDF exported!' })\n  }\n\n  if (loading) {\n    return (\n      <div className=\"loading-container\">\n        <div className=\"spinner\"></div>\n        <p>Loading injury reports...</p>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"injury-reports-section card\">\n        <ErrorState\n          title=\"Unable to load reports\"\n          message=\"There was a problem loading injury reports. Please try again.\"\n          error={error}\n          onRetry={loadReports}\n        />\n      </div>\n    )\n  }\n\n  return (\n    <>\n      <div className=\"injury-reports-section\">\n        <div className=\"section-header\">\n          <h3>Injury & Incident Reports</h3>\n          <div className=\"section-header-actions\">\n            {reports.length > 0 && (\n              <button className=\"btn-secondary\" onClick={exportToPDF}>\n                PDF\n              </button>\n            )}\n            <button className=\"btn-primary\" onClick={() => setShowForm(true)}>\n              + File Injury Report\n            </button>\n          </div>\n        </div>\n\n        {/* View Mode Bar */}\n        <div className=\"view-mode-bar\">\n          <div className=\"view-mode-tabs\">\n            <button\n              className={`view-mode-tab ${viewMode === 'recent' ? 'active' : ''}`}\n              onClick={() => { setViewMode('recent'); setDateFilter({ start: '', end: '' }); }}\n            >\n              Recent (7 days)\n            </button>\n            <button\n              className={`view-mode-tab ${viewMode === 'all' ? 'active' : ''}`}\n              onClick={() => setViewMode('all')}\n            >\n              All ({reports.length})\n            </button>\n          </div>\n\n          {viewMode === 'all' && (\n            <div className=\"date-filter\">\n              <Calendar size={16} />\n              <input\n                type=\"date\"\n                value={dateFilter.start}\n                onChange={(e) => setDateFilter(prev => ({ ...prev, start: e.target.value }))}\n                placeholder=\"Start date\"\n              />\n              <span>to</span>\n              <input\n                type=\"date\"\n                value={dateFilter.end}\n                onChange={(e) => setDateFilter(prev => ({ ...prev, end: e.target.value }))}\n                placeholder=\"End date\"\n              />\n              {(dateFilter.start || dateFilter.end) && (\n                <button\n                  className=\"btn-ghost\"\n                  onClick={() => setDateFilter({ start: '', end: '' })}\n                >\n                  Clear\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n\n        {filteredReports.length === 0 ? (\n          <div className=\"empty-state\">\n            <div className=\"empty-state-icon\"></div>\n            <h4>No Injury Reports{viewMode === 'recent' ? ' in the last 7 days' : ''}</h4>\n            <p>Click \"File Injury Report\" to document a workplace incident</p>\n            {viewMode === 'recent' && reports.length > 0 && (\n              <button className=\"btn-secondary\" onClick={() => setViewMode('all')}>\n                View All Reports\n              </button>\n            )}\n          </div>\n        ) : (\n          <div className=\"reports-list\">\n            {/* Render reports - with month grouping in 'all' mode */}\n            {viewMode === 'all' && reportsByMonth ? (\n              reportsByMonth.map(([monthKey, monthData]) => (\n                <div key={monthKey} className=\"month-group\">\n                  <div\n                    className=\"month-header\"\n                    onClick={() => toggleMonthExpand(monthKey)}\n                  >\n                    <div className=\"month-header-left\">\n                      {expandedMonths.has(monthKey) ? (\n                        <ChevronDown size={18} />\n                      ) : (\n                        <ChevronRight size={18} />\n                      )}\n                      <span className=\"month-label\">{monthData.label}</span>\n                      <span className=\"month-count\">{monthData.reports.length} reports</span>\n                    </div>\n                  </div>\n                  {expandedMonths.has(monthKey) && (\n                    <div className=\"month-reports\">\n                      {monthData.reports.map(report => (\n                        <InjuryReportCard\n                          key={report.id}\n                          report={report}\n                          formatDate={formatDate}\n                          formatTime={formatTime}\n                          getInjuryTypeColor={getInjuryTypeColor}\n                          getInjuryTypeLabel={getInjuryTypeLabel}\n                          getStatusColor={getStatusColor}\n                          onViewDetails={handleViewDetails}\n                        />\n                      ))}\n                    </div>\n                  )}\n                </div>\n              ))\n            ) : (\n              // Recent view - simple list\n              filteredReports.map(report => (\n                <InjuryReportCard\n                  key={report.id}\n                  report={report}\n                  formatDate={formatDate}\n                  formatTime={formatTime}\n                  getInjuryTypeColor={getInjuryTypeColor}\n                  getInjuryTypeLabel={getInjuryTypeLabel}\n                  getStatusColor={getStatusColor}\n                  onViewDetails={handleViewDetails}\n                />\n              ))\n            )}\n          </div>\n        )}\n\n        {/* Report Details Modal */}\n        {selectedReport && (\n          <div className=\"modal-overlay\" onClick={handleCloseDetails}>\n            <div className=\"modal-content report-details-modal\" onClick={e => e.stopPropagation()}>\n              <div className=\"modal-header\">\n                <h2>Injury Report Details</h2>\n                <button className=\"close-btn\" onClick={handleCloseDetails}>&times;</button>\n              </div>\n\n              <div className=\"modal-body\">\n                {/* Incident Information */}\n                <section className=\"details-section\">\n                  <h3>Incident Information</h3>\n                  <div className=\"detail-grid\">\n                    <div className=\"detail-item\">\n                      <label>Date & Time</label>\n                      <div>{formatDate(selectedReport.incident_date)} at {formatTime(selectedReport.incident_time)}</div>\n                    </div>\n                    <div className=\"detail-item\">\n                      <label>Location</label>\n                      <div>{selectedReport.incident_location}</div>\n                    </div>\n                    <div className=\"detail-item\">\n                      <label>Injury Type</label>\n                      <div>\n                        <span\n                          className=\"badge\"\n                          style={{ backgroundColor: getInjuryTypeColor(selectedReport.injury_type) }}\n                        >\n                          {getInjuryTypeLabel(selectedReport.injury_type)}\n                        </span>\n                      </div>\n                    </div>\n                    {selectedReport.body_part_affected && (\n                      <div className=\"detail-item\">\n                        <label>Body Part Affected</label>\n                        <div>{selectedReport.body_part_affected}</div>\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"detail-item full-width\">\n                    <label>Description</label>\n                    <div className=\"description-box\">{selectedReport.incident_description}</div>\n                  </div>\n                </section>\n\n                {/* Employee Information */}\n                <section className=\"details-section\">\n                  <h3>Injured Employee</h3>\n                  <div className=\"detail-grid\">\n                    <div className=\"detail-item\">\n                      <label>Name</label>\n                      <div>{selectedReport.employee_name}</div>\n                    </div>\n                    <div className=\"detail-item\">\n                      <label>Job Title</label>\n                      <div>{selectedReport.employee_job_title}</div>\n                    </div>\n                    {selectedReport.employee_phone && (\n                      <div className=\"detail-item\">\n                        <label>Phone</label>\n                        <div>{selectedReport.employee_phone}</div>\n                      </div>\n                    )}\n                    {selectedReport.employee_email && (\n                      <div className=\"detail-item\">\n                        <label>Email</label>\n                        <div>{selectedReport.employee_email}</div>\n                      </div>\n                    )}\n                    {selectedReport.employee_address && (\n                      <div className=\"detail-item full-width\">\n                        <label>Address</label>\n                        <div>{selectedReport.employee_address}</div>\n                      </div>\n                    )}\n                  </div>\n                </section>\n\n                {/* Supervisor Information */}\n                <section className=\"details-section\">\n                  <h3>Reported By</h3>\n                  <div className=\"detail-grid\">\n                    <div className=\"detail-item\">\n                      <label>Name</label>\n                      <div>{selectedReport.reported_by_name}</div>\n                    </div>\n                    <div className=\"detail-item\">\n                      <label>Title</label>\n                      <div>{selectedReport.reported_by_title}</div>\n                    </div>\n                    {selectedReport.reported_by_phone && (\n                      <div className=\"detail-item\">\n                        <label>Phone</label>\n                        <div>{selectedReport.reported_by_phone}</div>\n                      </div>\n                    )}\n                    {selectedReport.reported_by_email && (\n                      <div className=\"detail-item\">\n                        <label>Email</label>\n                        <div>{selectedReport.reported_by_email}</div>\n                      </div>\n                    )}\n                  </div>\n                </section>\n\n                {/* Witnesses */}\n                {selectedReport.witnesses && selectedReport.witnesses.length > 0 && (\n                  <section className=\"details-section\">\n                    <h3>Witnesses</h3>\n                    {selectedReport.witnesses.map((witness, index) => (\n                      <div key={index} className=\"witness-card\">\n                        <div className=\"witness-header\">\n                          <strong>{witness.name}</strong>\n                          {witness.phone && <span>  {witness.phone}</span>}\n                          {witness.email && <span>  {witness.email}</span>}\n                        </div>\n                        {witness.testimony && (\n                          <div className=\"witness-testimony\">\n                            <em>\"{witness.testimony}\"</em>\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </section>\n                )}\n\n                {/* Medical Information */}\n                {selectedReport.medical_treatment_required && (\n                  <section className=\"details-section\">\n                    <h3>Medical Treatment</h3>\n                    <div className=\"detail-grid\">\n                      {selectedReport.medical_facility_name && (\n                        <div className=\"detail-item\">\n                          <label>Facility</label>\n                          <div>{selectedReport.medical_facility_name}</div>\n                        </div>\n                      )}\n                      {selectedReport.medical_facility_address && (\n                        <div className=\"detail-item\">\n                          <label>Address</label>\n                          <div>{selectedReport.medical_facility_address}</div>\n                        </div>\n                      )}\n                      <div className=\"detail-item\">\n                        <label>Hospitalized</label>\n                        <div>{selectedReport.hospitalized ? 'Yes' : 'No'}</div>\n                      </div>\n                    </div>\n                  </section>\n                )}\n\n                {/* Actions & Safety */}\n                <section className=\"details-section\">\n                  <h3>Actions & Safety</h3>\n                  {selectedReport.immediate_actions_taken && (\n                    <div className=\"detail-item full-width\">\n                      <label>Immediate Actions Taken</label>\n                      <div className=\"description-box\">{selectedReport.immediate_actions_taken}</div>\n                    </div>\n                  )}\n                  {selectedReport.corrective_actions_planned && (\n                    <div className=\"detail-item full-width\">\n                      <label>Corrective Actions Planned</label>\n                      <div className=\"description-box\">{selectedReport.corrective_actions_planned}</div>\n                    </div>\n                  )}\n                  <div className=\"detail-grid\">\n                    {selectedReport.safety_equipment_used && (\n                      <div className=\"detail-item\">\n                        <label>Safety Equipment Used</label>\n                        <div>{selectedReport.safety_equipment_used}</div>\n                      </div>\n                    )}\n                    {selectedReport.safety_equipment_failed && (\n                      <div className=\"detail-item\">\n                        <label>Safety Equipment Failed</label>\n                        <div>{selectedReport.safety_equipment_failed}</div>\n                      </div>\n                    )}\n                  </div>\n                </section>\n\n                {/* Regulatory Information */}\n                <section className=\"details-section\">\n                  <h3>Regulatory & Work Impact</h3>\n                  <div className=\"detail-grid\">\n                    <div className=\"detail-item\">\n                      <label>OSHA Recordable</label>\n                      <div>{selectedReport.osha_recordable ? 'Yes' : 'No'}</div>\n                    </div>\n                    <div className=\"detail-item\">\n                      <label>Workers' Comp Claim</label>\n                      <div>{selectedReport.workers_comp_claim ? 'Yes' : 'No'}</div>\n                    </div>\n                    <div className=\"detail-item\">\n                      <label>Days Away From Work</label>\n                      <div>{selectedReport.days_away_from_work || 0}</div>\n                    </div>\n                    <div className=\"detail-item\">\n                      <label>Restricted Work Days</label>\n                      <div>{selectedReport.restricted_work_days || 0}</div>\n                    </div>\n                  </div>\n                </section>\n\n                <div className=\"report-meta\">\n                  Filed on {formatDate(selectedReport.created_at)}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* New Report Form */}\n        {showForm && (\n          <InjuryReportForm\n            project={project}\n            companyId={companyId}\n            user={user}\n            onClose={() => setShowForm(false)}\n            onReportCreated={handleReportCreated}\n          />\n        )}\n\n        {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}\n      </div>\n\n      <style>{`\n        .injury-reports-section {\n          margin-top: 2rem;\n        }\n\n        .section-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 1.5rem;\n        }\n\n        .section-header h3 {\n          margin: 0;\n          font-size: 1.25rem;\n          color: var(--text-primary);\n        }\n\n        .view-mode-bar {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          gap: 1rem;\n          margin-bottom: 1rem;\n          padding: 0.75rem;\n          background: var(--bg-elevated);\n          border-radius: 8px;\n          flex-wrap: wrap;\n        }\n\n        .view-mode-tabs {\n          display: flex;\n          gap: 0.5rem;\n        }\n\n        .view-mode-tab {\n          padding: 0.5rem 1rem;\n          border: none;\n          border-radius: 6px;\n          font-size: 0.875rem;\n          cursor: pointer;\n          background: transparent;\n          color: var(--text-secondary);\n          transition: all 0.2s;\n        }\n\n        .view-mode-tab:hover {\n          background: var(--bg-tertiary);\n        }\n\n        .view-mode-tab.active {\n          background: var(--primary-color, #3b82f6);\n          color: white;\n        }\n\n        .date-filter {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          color: var(--text-secondary);\n        }\n\n        .date-filter input[type=\"date\"] {\n          padding: 0.4rem 0.5rem;\n          border: 1px solid var(--border-color);\n          border-radius: 4px;\n          font-size: 0.875rem;\n          background: var(--bg-card);\n          color: var(--text-primary);\n        }\n\n        .btn-ghost {\n          background: transparent;\n          border: none;\n          padding: 0.4rem 0.75rem;\n          color: var(--text-secondary);\n          cursor: pointer;\n          border-radius: 4px;\n          font-size: 0.875rem;\n        }\n\n        .btn-ghost:hover {\n          background: var(--bg-tertiary);\n        }\n\n        .month-group {\n          margin-bottom: 0.5rem;\n        }\n\n        .month-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 0.75rem 1rem;\n          background: var(--bg-elevated);\n          border-radius: 8px;\n          cursor: pointer;\n          transition: background 0.2s;\n        }\n\n        .month-header:hover {\n          background: var(--bg-tertiary);\n        }\n\n        .month-header-left {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n        }\n\n        .month-label {\n          font-weight: 600;\n          color: var(--text-primary);\n        }\n\n        .month-count {\n          font-size: 0.875rem;\n          color: var(--text-secondary);\n        }\n\n        .month-reports {\n          margin-top: 0.5rem;\n          padding-left: 0.5rem;\n        }\n\n        .reports-list {\n          display: flex;\n          flex-direction: column;\n          gap: 1rem;\n        }\n\n        .report-card {\n          background: var(--bg-card);\n          border: 1px solid var(--border-color);\n          border-radius: 8px;\n          padding: 1.5rem;\n          cursor: pointer;\n          transition: all 0.2s;\n        }\n\n        .report-card:hover {\n          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);\n          border-color: var(--accent-primary);\n        }\n\n        .report-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          margin-bottom: 1rem;\n        }\n\n        .report-date {\n          font-size: 0.875rem;\n          color: var(--text-secondary);\n          margin-bottom: 0.25rem;\n        }\n\n        .employee-name {\n          font-size: 1.125rem;\n          font-weight: 600;\n          color: var(--text-primary);\n        }\n\n        .report-badges {\n          display: flex;\n          gap: 0.5rem;\n          flex-wrap: wrap;\n        }\n\n        .badge {\n          padding: 0.25rem 0.75rem;\n          border-radius: 12px;\n          font-size: 0.75rem;\n          font-weight: 500;\n          color: white;\n          text-transform: capitalize;\n        }\n\n        .osha-badge {\n          background-color: #dc2626;\n          color: white;\n          padding: 0.25rem 0.5rem;\n          border-radius: 4px;\n          font-size: 0.75rem;\n          font-weight: 600;\n        }\n\n        .report-summary {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n          gap: 0.75rem;\n          margin-bottom: 1rem;\n          padding: 1rem;\n          background-color: var(--bg-elevated);\n          border-radius: 6px;\n        }\n\n        .summary-item {\n          font-size: 0.875rem;\n          color: var(--text-secondary);\n        }\n\n        .summary-item strong {\n          color: var(--text-primary);\n        }\n\n        .report-description {\n          color: var(--text-secondary);\n          line-height: 1.6;\n          margin-bottom: 1rem;\n        }\n\n        .report-footer {\n          text-align: right;\n          font-size: 0.875rem;\n          color: var(--primary-color, #3b82f6);\n        }\n\n        .report-details-modal {\n          max-width: 900px;\n          max-height: 90vh;\n          overflow-y: auto;\n        }\n\n        .details-section {\n          margin-bottom: 2rem;\n          padding-bottom: 2rem;\n          border-bottom: 1px solid var(--border-color);\n        }\n\n        .details-section:last-child {\n          border-bottom: none;\n        }\n\n        .details-section h3 {\n          margin-top: 0;\n          margin-bottom: 1rem;\n          font-size: 1.125rem;\n          color: var(--text-primary);\n        }\n\n        .detail-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n          gap: 1rem;\n        }\n\n        .detail-item label {\n          display: block;\n          font-size: 0.875rem;\n          font-weight: 600;\n          color: var(--text-secondary);\n          margin-bottom: 0.25rem;\n        }\n\n        .detail-item div {\n          color: var(--text-primary);\n        }\n\n        .detail-item.full-width {\n          grid-column: 1 / -1;\n        }\n\n        .description-box {\n          background-color: var(--bg-elevated);\n          border: 1px solid var(--border-color);\n          border-radius: 6px;\n          padding: 1rem;\n          white-space: pre-wrap;\n          line-height: 1.6;\n          color: var(--text-primary);\n        }\n\n        .witness-card {\n          background-color: var(--bg-elevated);\n          border-radius: 6px;\n          padding: 1rem;\n          margin-bottom: 0.5rem;\n        }\n\n        .witness-header {\n          margin-bottom: 0.5rem;\n          color: var(--text-primary);\n        }\n\n        .witness-testimony {\n          color: var(--text-secondary);\n          font-size: 0.875rem;\n          padding-left: 1rem;\n          border-left: 3px solid var(--border-color);\n        }\n\n        .report-meta {\n          text-align: center;\n          font-size: 0.875rem;\n          color: var(--text-secondary);\n          padding-top: 1rem;\n          border-top: 1px solid var(--border-color);\n        }\n\n        .empty-state {\n          text-align: center;\n          padding: 3rem 1rem;\n        }\n\n        .empty-state-icon {\n          font-size: 3rem;\n          margin-bottom: 1rem;\n        }\n\n        .empty-state h4 {\n          margin: 0 0 0.5rem 0;\n          color: var(--text-primary);\n        }\n\n        .empty-state p {\n          margin: 0;\n          color: var(--text-secondary);\n        }\n\n        .section-header-actions {\n          display: flex;\n          gap: 0.5rem;\n          align-items: center;\n        }\n\n        .btn-primary, .btn-secondary {\n          padding: 0.5rem 1rem;\n          border-radius: 6px;\n          font-weight: 500;\n          cursor: pointer;\n          border: none;\n        }\n\n        .btn-primary {\n          background-color: var(--primary-color, #3b82f6);\n          color: white;\n        }\n\n        .btn-secondary {\n          background-color: var(--bg-elevated);\n          color: var(--text-primary);\n          border: 1px solid var(--border-color);\n        }\n\n        .btn-primary:hover, .btn-secondary:hover {\n          opacity: 0.9;\n        }\n\n        .loading-container {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          padding: 3rem;\n        }\n\n        .spinner {\n          width: 40px;\n          height: 40px;\n          border: 4px solid var(--border-color);\n          border-top-color: var(--accent-primary);\n          border-radius: 50%;\n          animation: spin 1s linear infinite;\n        }\n\n        @keyframes spin {\n          to { transform: rotate(360deg); }\n        }\n\n        @media (max-width: 768px) {\n          .report-header {\n            flex-direction: column;\n            gap: 0.5rem;\n          }\n\n          .report-summary {\n            grid-template-columns: 1fr;\n          }\n\n          .detail-grid {\n            grid-template-columns: 1fr;\n          }\n\n          .report-details-modal {\n            max-width: 100%;\n            height: 100vh;\n            max-height: 100vh;\n            border-radius: 0;\n          }\n        }\n      `}</style>\n    </>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { db } from '../lib/supabase'\nimport { Users, UserPlus, UserMinus, ChevronDown, X } from 'lucide-react'\n\nconst PROJECT_ROLE_OPTIONS = [\n  'Project Manager',\n  'Superintendent',\n  'Foreman',\n  'Office Support',\n  'Engineer',\n  'Inspector',\n  'Team Member'\n]\n\nexport default function ProjectTeam({ project, company, user, isAdmin, onShowToast }) {\n  const [teamMembers, setTeamMembers] = useState([])\n  const [companyMembers, setCompanyMembers] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [showAddModal, setShowAddModal] = useState(false)\n  const [selectedUser, setSelectedUser] = useState('')\n  const [selectedRole, setSelectedRole] = useState('Team Member')\n  const [actionLoading, setActionLoading] = useState(null)\n\n  useEffect(() => {\n    if (project?.id) {\n      loadProjectTeam()\n    }\n  }, [project?.id])\n\n  useEffect(() => {\n    if (showAddModal && company?.id) {\n      loadCompanyMembers()\n    }\n  }, [showAddModal, company?.id])\n\n  const loadProjectTeam = async () => {\n    try {\n      setLoading(true)\n      const data = await db.getProjectTeam(project.id)\n      setTeamMembers(data)\n    } catch (error) {\n      console.error('Error loading project team:', error)\n      onShowToast('Error loading project team', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const loadCompanyMembers = async () => {\n    try {\n      const data = await db.getCompanyMembers(company.id)\n      // Filter out users already on the project\n      const existingUserIds = teamMembers.map(tm => tm.users?.id)\n      const available = data.filter(m => !existingUserIds.includes(m.users?.id))\n      setCompanyMembers(available)\n    } catch (error) {\n      console.error('Error loading company members:', error)\n      onShowToast('Error loading company members', 'error')\n    }\n  }\n\n  const handleAddMember = async () => {\n    if (!selectedUser) {\n      onShowToast('Select a team member', 'error')\n      return\n    }\n\n    try {\n      setActionLoading('add')\n      await db.addProjectMember(project.id, selectedUser, selectedRole, user.id)\n      onShowToast('Team member added', 'success')\n      setShowAddModal(false)\n      setSelectedUser('')\n      setSelectedRole('Team Member')\n      loadProjectTeam()\n    } catch (error) {\n      console.error('Error adding team member:', error)\n      onShowToast('Error adding team member', 'error')\n    } finally {\n      setActionLoading(null)\n    }\n  }\n\n  const handleUpdateRole = async (member, newRole) => {\n    try {\n      setActionLoading(member.id)\n      await db.updateProjectMemberRole(project.id, member.users?.id, newRole)\n      onShowToast('Role updated', 'success')\n      loadProjectTeam()\n    } catch (error) {\n      console.error('Error updating role:', error)\n      onShowToast('Error updating role', 'error')\n    } finally {\n      setActionLoading(null)\n    }\n  }\n\n  const handleRemoveMember = async (member) => {\n    try {\n      setActionLoading(member.id)\n      await db.removeProjectMember(project.id, member.users?.id)\n      onShowToast('Team member removed', 'success')\n      loadProjectTeam()\n    } catch (error) {\n      console.error('Error removing team member:', error)\n      onShowToast('Error removing team member', 'error')\n    } finally {\n      setActionLoading(null)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"project-team\">\n        <div className=\"project-team-header\">\n          <h3><Users size={18} /> Project Team</h3>\n        </div>\n        <div className=\"loading-small\">Loading...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"project-team\">\n      <div className=\"project-team-header\">\n        <h3><Users size={18} /> Project Team</h3>\n        {isAdmin && (\n          <button\n            className=\"btn btn-small btn-primary\"\n            onClick={() => setShowAddModal(true)}\n          >\n            <UserPlus size={14} /> Add\n          </button>\n        )}\n      </div>\n\n      {teamMembers.length === 0 ? (\n        <div className=\"project-team-empty\">\n          No team members assigned yet\n          {isAdmin && <p>Click \"Add\" to assign team members to this project</p>}\n        </div>\n      ) : (\n        <div className=\"project-team-list\">\n          {teamMembers.map(member => (\n            <div key={member.id} className=\"project-team-member\">\n              <div className=\"team-member-info\">\n                <div className=\"team-member-name\">{member.users?.name || 'Unknown'}</div>\n                <div className=\"team-member-email\">{member.users?.email}</div>\n              </div>\n              <div className=\"team-member-role\">\n                {isAdmin ? (\n                  <div className=\"role-selector compact\">\n                    <select\n                      value={member.project_role}\n                      onChange={(e) => handleUpdateRole(member, e.target.value)}\n                      disabled={actionLoading === member.id}\n                      className=\"role-select\"\n                    >\n                      {PROJECT_ROLE_OPTIONS.map(role => (\n                        <option key={role} value={role}>{role}</option>\n                      ))}\n                    </select>\n                    <ChevronDown size={12} className=\"role-select-icon\" />\n                  </div>\n                ) : (\n                  <span className=\"role-badge\">{member.project_role}</span>\n                )}\n              </div>\n              {isAdmin && (\n                <button\n                  className=\"btn-icon btn-danger-subtle\"\n                  onClick={() => handleRemoveMember(member)}\n                  disabled={actionLoading === member.id}\n                  title=\"Remove from project\"\n                >\n                  <UserMinus size={14} />\n                </button>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Add Member Modal */}\n      {showAddModal && (\n        <div className=\"modal-overlay\" onClick={() => setShowAddModal(false)}>\n          <div className=\"modal-content small\" onClick={e => e.stopPropagation()}>\n            <div className=\"modal-header\">\n              <h3>Add Team Member</h3>\n              <button className=\"modal-close\" onClick={() => setShowAddModal(false)}>\n                <X size={20} />\n              </button>\n            </div>\n            <div className=\"modal-body\">\n              <div className=\"form-group\">\n                <label>Select Team Member</label>\n                <select\n                  value={selectedUser}\n                  onChange={(e) => setSelectedUser(e.target.value)}\n                  className=\"form-select\"\n                >\n                  <option value=\"\">Choose a team member...</option>\n                  {companyMembers.map(member => (\n                    <option key={member.users?.id} value={member.users?.id}>\n                      {member.users?.name || member.users?.email}\n                    </option>\n                  ))}\n                </select>\n                {companyMembers.length === 0 && (\n                  <p className=\"form-hint\">All company members are already assigned to this project</p>\n                )}\n              </div>\n              <div className=\"form-group\">\n                <label>Project Role</label>\n                <select\n                  value={selectedRole}\n                  onChange={(e) => setSelectedRole(e.target.value)}\n                  className=\"form-select\"\n                >\n                  {PROJECT_ROLE_OPTIONS.map(role => (\n                    <option key={role} value={role}>{role}</option>\n                  ))}\n                </select>\n                <p className=\"form-hint\">This is for visibility only - it doesn't affect permissions</p>\n              </div>\n            </div>\n            <div className=\"modal-footer\">\n              <button\n                className=\"btn btn-secondary\"\n                onClick={() => setShowAddModal(false)}\n              >\n                Cancel\n              </button>\n              <button\n                className=\"btn btn-primary\"\n                onClick={handleAddMember}\n                disabled={!selectedUser || actionLoading === 'add'}\n              >\n                {actionLoading === 'add' ? 'Adding...' : 'Add to Project'}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { Shield, ShieldCheck, ShieldOff, Copy, Check, X, Loader2 } from 'lucide-react'\nimport { supabase } from '../lib/supabase'\n\nexport default function MFASetup({ onShowToast, onClose }) {\n  const [step, setStep] = useState('loading')\n  const [factors, setFactors] = useState([])\n  const [qrCode, setQrCode] = useState(null)\n  const [secret, setSecret] = useState(null)\n  const [factorId, setFactorId] = useState(null)\n  const [verifyCode, setVerifyCode] = useState('')\n  const [verifying, setVerifying] = useState(false)\n  const [copied, setCopied] = useState(false)\n  const [error, setError] = useState(null)\n\n  useEffect(() => {\n    loadFactors()\n  }, [])\n\n  const loadFactors = async () => {\n    try {\n      const { data, error } = await supabase.auth.mfa.listFactors()\n      if (error) throw error\n      const totpFactors = (data?.totp || []).filter(f => f.status === 'verified')\n      setFactors(totpFactors)\n      setStep('overview')\n    } catch {\n      setStep('overview')\n    }\n  }\n\n  const startEnrollment = async () => {\n    setError(null)\n    try {\n      const { data, error } = await supabase.auth.mfa.enroll({\n        factorType: 'totp',\n        friendlyName: 'FieldSync Authenticator'\n      })\n      if (error) throw error\n      if (!data?.totp) throw new Error('MFA enrollment response missing TOTP data')\n      setQrCode(data.totp.qr_code)\n      setSecret(data.totp.secret)\n      setFactorId(data.id)\n      setStep('enroll')\n    } catch (err) {\n      setError(err.message)\n      onShowToast?.('Failed to start MFA enrollment', 'error')\n    }\n  }\n\n  const verifyEnrollment = async () => {\n    if (verifyCode.length !== 6) return\n    setVerifying(true)\n    setError(null)\n    try {\n      const { data: challenge, error: challengeError } = await supabase.auth.mfa.challenge({ factorId })\n      if (challengeError) throw challengeError\n\n      const { error: verifyError } = await supabase.auth.mfa.verify({\n        factorId,\n        challengeId: challenge.id,\n        code: verifyCode\n      })\n      if (verifyError) throw verifyError\n\n      setStep('success')\n      onShowToast?.('MFA enabled successfully!', 'success')\n      await loadFactors()\n    } catch {\n      setError('Invalid code. Please try again.')\n      setVerifyCode('')\n    } finally {\n      setVerifying(false)\n    }\n  }\n\n  const unenroll = async (id) => {\n    try {\n      const { error } = await supabase.auth.mfa.unenroll({ factorId: id })\n      if (error) throw error\n      onShowToast?.('MFA disabled', 'success')\n      await loadFactors()\n    } catch {\n      onShowToast?.('Failed to disable MFA', 'error')\n    }\n  }\n\n  const copySecret = () => {\n    navigator.clipboard.writeText(secret)\n    setCopied(true)\n    setTimeout(() => setCopied(false), 2000)\n  }\n\n  const isEnabled = factors.length > 0\n\n  return (\n    <div className=\"mfa-setup\">\n      <div className=\"mfa-header\">\n        <div className=\"mfa-title\">\n          {isEnabled ? <ShieldCheck size={20} className=\"text-success\" /> : <Shield size={20} />}\n          <h3>Two-Factor Authentication</h3>\n        </div>\n        {onClose && (\n          <button className=\"close-btn\" onClick={onClose} aria-label=\"Close\">\n            <X size={20} />\n          </button>\n        )}\n      </div>\n\n      {step === 'loading' && (\n        <div className=\"mfa-loading\"><Loader2 size={24} className=\"spinner\" /> Loading...</div>\n      )}\n\n      {step === 'overview' && (\n        <div className=\"mfa-overview\">\n          <p className=\"mfa-description\">\n            Add an extra layer of security to your account. When enabled, you will need to enter\n            a code from your authenticator app each time you sign in.\n          </p>\n          {isEnabled ? (\n            <div className=\"mfa-status mfa-status-enabled\">\n              <ShieldCheck size={18} />\n              <span>MFA is enabled</span>\n              <button className=\"btn btn-ghost btn-small\" onClick={() => unenroll(factors[0].id)}>\n                <ShieldOff size={14} /> Disable\n              </button>\n            </div>\n          ) : (\n            <div className=\"mfa-status mfa-status-disabled\">\n              <ShieldOff size={18} />\n              <span>MFA is not enabled</span>\n              <button className=\"btn btn-primary btn-small\" onClick={startEnrollment}>\n                <Shield size={14} /> Enable MFA\n              </button>\n            </div>\n          )}\n        </div>\n      )}\n\n      {step === 'enroll' && (\n        <div className=\"mfa-enroll\">\n          <p>Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):</p>\n          {qrCode && (\n            <div className=\"mfa-qr-container\">\n              <img src={qrCode} alt=\"MFA QR Code\" className=\"mfa-qr\" />\n            </div>\n          )}\n          <div className=\"mfa-secret\">\n            <span className=\"mfa-secret-label\">Or enter this key manually:</span>\n            <div className=\"mfa-secret-value\">\n              <code>{secret}</code>\n              <button className=\"btn btn-ghost btn-small\" onClick={copySecret} aria-label=\"Copy secret key\">\n                {copied ? <Check size={14} /> : <Copy size={14} />}\n              </button>\n            </div>\n          </div>\n          <div className=\"mfa-verify-section\">\n            <label htmlFor=\"mfa-verify-code\">Enter the 6-digit code from your app:</label>\n            <div className=\"mfa-code-input\">\n              <input\n                id=\"mfa-verify-code\"\n                type=\"text\"\n                value={verifyCode}\n                onChange={(e) => setVerifyCode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\n                placeholder=\"000000\"\n                maxLength={6}\n                autoFocus\n                inputMode=\"numeric\"\n                pattern=\"[0-9]*\"\n              />\n              <button\n                className=\"btn btn-primary\"\n                onClick={verifyEnrollment}\n                disabled={verifyCode.length !== 6 || verifying}\n              >\n                {verifying ? <><Loader2 size={14} className=\"spinner\" /> Verifying...</> : 'Verify & Enable'}\n              </button>\n            </div>\n            {error && <p className=\"mfa-error\">{error}</p>}\n          </div>\n          <button className=\"btn btn-ghost btn-small\" onClick={() => setStep('overview')}>Cancel</button>\n        </div>\n      )}\n\n      {step === 'success' && (\n        <div className=\"mfa-success\">\n          <ShieldCheck size={48} className=\"text-success\" />\n          <h4>MFA Enabled</h4>\n          <p>Your account is now protected with two-factor authentication.</p>\n          <button className=\"btn btn-primary\" onClick={() => setStep('overview')}>Done</button>\n        </div>\n      )}\n    </div>\n  )\n}\n","/**\n * Earned Value Management (EVM) calculations\n *\n * Standard construction industry metrics:\n * - BCWP (Budgeted Cost of Work Performed) = Earned Value\n * - BCWS (Budgeted Cost of Work Scheduled) = Planned Value\n * - ACWP (Actual Cost of Work Performed) = Actual Cost\n * - CPI (Cost Performance Index) = EV / AC\n * - SPI (Schedule Performance Index) = EV / PV\n * - EAC (Estimate at Completion) = BAC / CPI\n * - ETC (Estimate to Complete) = EAC - AC\n * - VAC (Variance at Completion) = BAC - EAC\n */\n\n/**\n * Calculate earned value metrics for a project\n * @param {Object} params\n * @param {number} params.contractValue - Original contract value (BAC)\n * @param {number} params.changeOrderValue - Approved change order value\n * @param {number} params.progressPercent - Overall completion percentage (0-100)\n * @param {number} params.actualCosts - Total actual costs to date\n * @param {string} params.startDate - Project start date\n * @param {string} params.endDate - Planned end date\n * @param {Array} params.areas - Work areas with status, weight, scheduled_value\n * @returns {Object} Earned value metrics\n */\nexport function calculateEarnedValue({\n  contractValue = 0,\n  changeOrderValue = 0,\n  progressPercent = 0,\n  actualCosts = 0,\n  startDate,\n  endDate,\n  areas = []\n}) {\n  // BAC = Budget at Completion (revised with change orders)\n  const bac = contractValue + changeOrderValue\n\n  // EV = Earned Value (what we've earned based on completion)\n  const earnedValue = (progressPercent / 100) * bac\n\n  // PV = Planned Value (what we should have earned by now based on schedule)\n  const plannedValue = calculatePlannedValue(bac, startDate, endDate)\n\n  // AC = Actual Cost\n  const actualCost = actualCosts\n\n  // CPI = Cost Performance Index (> 1 = under budget, < 1 = over budget)\n  const cpi = actualCost > 0 ? earnedValue / actualCost : 1\n\n  // SPI = Schedule Performance Index (> 1 = ahead, < 1 = behind)\n  const spi = plannedValue > 0 ? earnedValue / plannedValue : 1\n\n  // CV = Cost Variance (positive = under budget)\n  const costVariance = earnedValue - actualCost\n\n  // SV = Schedule Variance (positive = ahead)\n  const scheduleVariance = earnedValue - plannedValue\n\n  // EAC = Estimate at Completion\n  const eac = cpi > 0 ? bac / cpi : bac * 2\n\n  // ETC = Estimate to Complete\n  const etc = Math.max(0, eac - actualCost)\n\n  // VAC = Variance at Completion (positive = under budget)\n  const vac = bac - eac\n\n  // TCPI = To-Complete Performance Index (CPI needed to finish on budget)\n  const remainingWork = bac - earnedValue\n  const remainingBudget = bac - actualCost\n  const tcpi = remainingBudget > 0 ? remainingWork / remainingBudget : 999\n\n  // Projected completion date\n  const projectedEndDate = calculateProjectedEndDate(startDate, endDate, spi)\n\n  // Health status based on CPI and SPI\n  const healthStatus = getHealthStatus(cpi, spi)\n\n  return {\n    // Core EV metrics\n    bac,\n    earnedValue,\n    plannedValue,\n    actualCost,\n\n    // Performance indices\n    cpi: roundTo(cpi, 2),\n    spi: roundTo(spi, 2),\n\n    // Variances\n    costVariance,\n    scheduleVariance,\n\n    // Forecasts\n    eac: Math.round(eac),\n    etc: Math.round(etc),\n    vac: Math.round(vac),\n    tcpi: roundTo(tcpi, 2),\n\n    // Projections\n    projectedEndDate,\n    percentScheduled: calculatePercentScheduled(startDate, endDate),\n    percentComplete: progressPercent,\n\n    // Status\n    healthStatus,\n    cpiLabel: getCPILabel(cpi),\n    spiLabel: getSPILabel(spi),\n\n    // For charting\n    budgetUtilization: bac > 0 ? roundTo((actualCost / bac) * 100, 1) : 0,\n    earnedPercent: bac > 0 ? roundTo((earnedValue / bac) * 100, 1) : 0\n  }\n}\n\n/**\n * Calculate planned value based on linear schedule\n */\nfunction calculatePlannedValue(bac, startDate, endDate) {\n  if (!startDate || !endDate) return 0\n\n  const start = new Date(startDate)\n  const end = new Date(endDate)\n  const now = new Date()\n\n  const totalDuration = end - start\n  if (totalDuration <= 0) return bac\n\n  const elapsed = now - start\n  const percentElapsed = Math.min(1, Math.max(0, elapsed / totalDuration))\n\n  return percentElapsed * bac\n}\n\n/**\n * Calculate what percent of the schedule has elapsed\n */\nfunction calculatePercentScheduled(startDate, endDate) {\n  if (!startDate || !endDate) return 0\n\n  const start = new Date(startDate)\n  const end = new Date(endDate)\n  const now = new Date()\n\n  const totalDuration = end - start\n  if (totalDuration <= 0) return 100\n\n  const elapsed = now - start\n  return roundTo(Math.min(100, Math.max(0, (elapsed / totalDuration) * 100)), 1)\n}\n\n/**\n * Project the end date based on SPI\n */\nfunction calculateProjectedEndDate(startDate, endDate, spi) {\n  if (!startDate || !endDate || spi <= 0) return null\n\n  const start = new Date(startDate)\n  const end = new Date(endDate)\n  const totalDays = (end - start) / (1000 * 60 * 60 * 24)\n\n  // Adjusted duration = original duration / SPI\n  const adjustedDays = totalDays / spi\n  const projected = new Date(start.getTime() + adjustedDays * 24 * 60 * 60 * 1000)\n\n  return projected.toISOString().split('T')[0]\n}\n\nfunction getHealthStatus(cpi, spi) {\n  if (cpi >= 0.95 && spi >= 0.95) return 'healthy'\n  if (cpi >= 0.85 && spi >= 0.85) return 'watch'\n  if (cpi >= 0.70 && spi >= 0.70) return 'warning'\n  return 'critical'\n}\n\nfunction getCPILabel(cpi) {\n  if (cpi >= 1.05) return 'Under Budget'\n  if (cpi >= 0.95) return 'On Budget'\n  if (cpi >= 0.85) return 'Slightly Over'\n  return 'Over Budget'\n}\n\nfunction getSPILabel(spi) {\n  if (spi >= 1.05) return 'Ahead of Schedule'\n  if (spi >= 0.95) return 'On Schedule'\n  if (spi >= 0.85) return 'Slightly Behind'\n  return 'Behind Schedule'\n}\n\nfunction roundTo(value, decimals) {\n  const factor = Math.pow(10, decimals)\n  return Math.round(value * factor) / factor\n}\n\n/**\n * Generate S-curve data points for chart\n * Shows Planned Value, Earned Value, and Actual Cost over time\n */\nexport function generateSCurveData({\n  contractValue = 0,\n  changeOrderValue = 0,\n  progressPercent = 0,\n  actualCosts = 0,\n  startDate,\n  endDate\n}) {\n  if (!startDate || !endDate) return []\n\n  const bac = contractValue + changeOrderValue\n  const start = new Date(startDate)\n  const end = new Date(endDate)\n  const now = new Date()\n  const totalDays = Math.max(1, (end - start) / (1000 * 60 * 60 * 24))\n\n  const points = []\n  const numPoints = Math.min(12, Math.ceil(totalDays / 7)) // Weekly points, max 12\n\n  for (let i = 0; i <= numPoints; i++) {\n    const fraction = i / numPoints\n    const pointDate = new Date(start.getTime() + fraction * (end - start))\n    const label = pointDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\n\n    // Planned value follows linear schedule\n    const pv = Math.round(fraction * bac)\n\n    // Only show EV and AC for past dates\n    const isPast = pointDate <= now\n    const isCurrent = i === numPoints || (isPast && i === numPoints - 1)\n\n    const point = {\n      date: label,\n      plannedValue: pv,\n    }\n\n    if (isPast || isCurrent) {\n      // Interpolate EV and AC to current point\n      const timePercent = Math.min(1, (pointDate - start) / (now - start))\n      point.earnedValue = Math.round(timePercent * (progressPercent / 100) * bac)\n      point.actualCost = Math.round(timePercent * actualCosts)\n    }\n\n    points.push(point)\n  }\n\n  return points\n}\n","import { useMemo } from 'react'\nimport { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, Legend } from 'recharts'\nimport { TrendingUp, TrendingDown, DollarSign, Clock, Target, AlertTriangle } from 'lucide-react'\nimport { formatCurrency } from '../../lib/utils'\nimport { calculateEarnedValue, generateSCurveData } from '../../lib/earnedValueCalculations'\nimport { chartColors, tooltipStyle, formatChartCurrency } from './chartConfig'\n\n/**\n * Earned Value Management card for project dashboard.\n * Shows CPI, SPI, EAC, ETC, and S-curve chart.\n */\nexport default function EarnedValueCard({\n  contractValue = 0,\n  changeOrderValue = 0,\n  progressPercent = 0,\n  actualCosts = 0,\n  startDate,\n  endDate,\n  areas = []\n}) {\n  const ev = useMemo(() =>\n    calculateEarnedValue({\n      contractValue,\n      changeOrderValue,\n      progressPercent,\n      actualCosts,\n      startDate,\n      endDate,\n      areas\n    }),\n    [contractValue, changeOrderValue, progressPercent, actualCosts, startDate, endDate, areas]\n  )\n\n  const sCurveData = useMemo(() =>\n    generateSCurveData({\n      contractValue,\n      changeOrderValue,\n      progressPercent,\n      actualCosts,\n      startDate,\n      endDate\n    }),\n    [contractValue, changeOrderValue, progressPercent, actualCosts, startDate, endDate]\n  )\n\n  const statusColors = {\n    healthy: '#10b981',\n    watch: '#f59e0b',\n    warning: '#f97316',\n    critical: '#ef4444'\n  }\n\n  const statusColor = statusColors[ev.healthStatus] || statusColors.watch\n\n  return (\n    <div className=\"ev-card\">\n      <div className=\"ev-card-header\">\n        <div className=\"ev-card-title\">\n          <Target size={18} />\n          <h3>Earned Value Analysis</h3>\n        </div>\n        <span className=\"ev-health-badge\" style={{ background: `${statusColor}18`, color: statusColor, borderColor: `${statusColor}40` }}>\n          {ev.healthStatus === 'healthy' ? 'Healthy' :\n           ev.healthStatus === 'watch' ? 'Watch' :\n           ev.healthStatus === 'warning' ? 'Warning' : 'Critical'}\n        </span>\n      </div>\n\n      {/* Performance Indices */}\n      <div className=\"ev-indices-row\">\n        <div className=\"ev-index-card\">\n          <div className=\"ev-index-header\">\n            <DollarSign size={14} />\n            <span>CPI</span>\n          </div>\n          <div className=\"ev-index-value\" style={{ color: ev.cpi >= 0.95 ? '#10b981' : ev.cpi >= 0.85 ? '#f59e0b' : '#ef4444' }}>\n            {ev.cpi.toFixed(2)}\n          </div>\n          <div className=\"ev-index-label\">{ev.cpiLabel}</div>\n        </div>\n\n        <div className=\"ev-index-card\">\n          <div className=\"ev-index-header\">\n            <Clock size={14} />\n            <span>SPI</span>\n          </div>\n          <div className=\"ev-index-value\" style={{ color: ev.spi >= 0.95 ? '#10b981' : ev.spi >= 0.85 ? '#f59e0b' : '#ef4444' }}>\n            {ev.spi.toFixed(2)}\n          </div>\n          <div className=\"ev-index-label\">{ev.spiLabel}</div>\n        </div>\n\n        <div className=\"ev-index-card\">\n          <div className=\"ev-index-header\">\n            {ev.vac >= 0 ? <TrendingUp size={14} /> : <TrendingDown size={14} />}\n            <span>EAC</span>\n          </div>\n          <div className=\"ev-index-value\">\n            {formatCurrency(ev.eac)}\n          </div>\n          <div className=\"ev-index-label\">Est. at Completion</div>\n        </div>\n\n        <div className=\"ev-index-card\">\n          <div className=\"ev-index-header\">\n            <Target size={14} />\n            <span>ETC</span>\n          </div>\n          <div className=\"ev-index-value\">\n            {formatCurrency(ev.etc)}\n          </div>\n          <div className=\"ev-index-label\">Est. to Complete</div>\n        </div>\n      </div>\n\n      {/* Variance Summary */}\n      <div className=\"ev-variance-row\">\n        <div className={`ev-variance-item ${ev.costVariance >= 0 ? 'positive' : 'negative'}`}>\n          <span className=\"ev-variance-label\">Cost Variance</span>\n          <span className=\"ev-variance-value\">\n            {ev.costVariance >= 0 ? '+' : ''}{formatCurrency(ev.costVariance)}\n          </span>\n        </div>\n        <div className={`ev-variance-item ${ev.scheduleVariance >= 0 ? 'positive' : 'negative'}`}>\n          <span className=\"ev-variance-label\">Schedule Variance</span>\n          <span className=\"ev-variance-value\">\n            {ev.scheduleVariance >= 0 ? '+' : ''}{formatCurrency(ev.scheduleVariance)}\n          </span>\n        </div>\n        <div className={`ev-variance-item ${ev.vac >= 0 ? 'positive' : 'negative'}`}>\n          <span className=\"ev-variance-label\">Variance at Completion</span>\n          <span className=\"ev-variance-value\">\n            {ev.vac >= 0 ? '+' : ''}{formatCurrency(ev.vac)}\n          </span>\n        </div>\n      </div>\n\n      {/* S-Curve Chart */}\n      {sCurveData.length > 0 && (\n        <div className=\"ev-chart-container\">\n          <ResponsiveContainer width=\"100%\" height={220}>\n            <LineChart data={sCurveData} margin={{ top: 8, right: 8, left: 0, bottom: 0 }}>\n              <XAxis\n                dataKey=\"date\"\n                tick={{ fontSize: 11, fill: 'var(--text-secondary)' }}\n                tickLine={false}\n                axisLine={{ stroke: 'var(--border-color)' }}\n              />\n              <YAxis\n                tickFormatter={formatChartCurrency}\n                tick={{ fontSize: 11, fill: 'var(--text-secondary)' }}\n                tickLine={false}\n                axisLine={false}\n                width={55}\n              />\n              <Tooltip\n                formatter={(value) => formatCurrency(value)}\n                contentStyle={tooltipStyle.contentStyle}\n                labelStyle={tooltipStyle.labelStyle}\n              />\n              <Legend\n                iconType=\"line\"\n                wrapperStyle={{ fontSize: 11, paddingTop: 4 }}\n              />\n              <Line\n                type=\"monotone\"\n                dataKey=\"plannedValue\"\n                stroke={chartColors.contract}\n                strokeDasharray=\"5 5\"\n                strokeWidth={2}\n                dot={false}\n                name=\"Planned Value\"\n              />\n              <Line\n                type=\"monotone\"\n                dataKey=\"earnedValue\"\n                stroke={chartColors.revenue}\n                strokeWidth={2}\n                dot={false}\n                name=\"Earned Value\"\n                connectNulls={false}\n              />\n              <Line\n                type=\"monotone\"\n                dataKey=\"actualCost\"\n                stroke={chartColors.costs}\n                strokeWidth={2}\n                dot={false}\n                name=\"Actual Cost\"\n                connectNulls={false}\n              />\n            </LineChart>\n          </ResponsiveContainer>\n        </div>\n      )}\n\n      {/* Projected End Date */}\n      {ev.projectedEndDate && endDate && (\n        <div className=\"ev-projection-row\">\n          <div className=\"ev-projection-item\">\n            <span className=\"ev-projection-label\">Planned End</span>\n            <span className=\"ev-projection-value\">{new Date(endDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>\n          </div>\n          <div className=\"ev-projection-item\">\n            <span className=\"ev-projection-label\">Projected End</span>\n            <span className=\"ev-projection-value\" style={{ color: ev.spi >= 0.95 ? '#10b981' : '#f59e0b' }}>\n              {new Date(ev.projectedEndDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}\n            </span>\n          </div>\n          {ev.tcpi > 1.1 && (\n            <div className=\"ev-projection-alert\">\n              <AlertTriangle size={14} />\n              <span>Need CPI of {ev.tcpi.toFixed(2)} to finish on budget</span>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect, useRef, useCallback, useMemo, lazy, Suspense } from 'react'\nimport { db } from '../lib/supabase'\nimport { safeAsync } from '../lib/errorHandler'\nimport { formatCurrency, calculateProgress, calculateValueProgress, getOverallStatus, getOverallStatusLabel, calculateScheduleInsights, shouldAutoArchive } from '../lib/utils'\nimport usePortfolioMetrics from '../hooks/usePortfolioMetrics'\nimport useProjectEdit from '../hooks/useProjectEdit'\nimport { exportAllFieldDocumentsPDF, exportDailyReportsPDF, exportIncidentReportsPDF, exportCrewCheckinsPDF } from '../lib/fieldDocumentExport'\nimport { exportProjectFinancials, exportToQuickBooksIIF } from '../lib/financialExport'\nimport { LayoutGrid, DollarSign, ClipboardList, HardHat, Truck, Info, FolderOpen, Search, Download, FileText, Menu, AlertTriangle, Package, Users, Shield, TrendingUp, TrendingDown, CheckCircle2, Camera, MapPin, Building2, Phone, ArrowRight } from 'lucide-react'\nimport UniversalSearch, { useUniversalSearch } from './UniversalSearch'\nimport { SmartAlerts } from './dashboard/SmartAlerts'\nimport OverviewProgressGauge from './overview/OverviewProgressGauge'\nimport OverviewFinancialCard from './overview/OverviewFinancialCard'\nimport OverviewCrewMetrics from './overview/OverviewCrewMetrics'\nimport HeroMetrics from './HeroMetrics'\nimport { TicketSkeleton } from './ui'\n\n// Financials components\nimport FinancialsNav from './FinancialsNav'\nimport { FinancialTrendChart } from './charts'\nimport ProfitabilityCard from './ProfitabilityCard'\nimport CostContributorsCard from './CostContributorsCard'\nimport DisposalSummary from './DisposalSummary'\nimport ProjectEquipmentCard from './equipment/ProjectEquipmentCard'\nimport ProgressBillingCard from './billing/ProgressBillingCard'\nimport ManDayCosts from './ManDayCosts'\nimport BurnRateCard from './BurnRateCard'\n\n// Reports components\nimport DailyReportsList from './DailyReportsList'\nimport InjuryReportsList from './InjuryReportsList'\n\n// Settings components\nimport ProjectTeam from './ProjectTeam'\nimport MFASetup from './MFASetup'\n\n// Lazy load modals and conditionally rendered heavy components\nconst ShareModal = lazy(() => import('./ShareModal'))\nconst NotificationSettings = lazy(() => import('./NotificationSettings'))\nconst CORForm = lazy(() => import('./cor/CORForm'))\nconst CORDetail = lazy(() => import('./cor/CORDetail'))\nconst CORLog = lazy(() => import('./cor/CORLog'))\nconst DrawRequestModal = lazy(() => import('./billing/DrawRequestModal'))\nconst EquipmentModal = lazy(() => import('./equipment/EquipmentModal'))\nconst AddCostModal = lazy(() => import('./AddCostModal'))\nconst DocumentsTab = lazy(() => import('./documents/DocumentsTab'))\nconst CORLogPreview = lazy(() => import('./cor/CORLogPreview'))\nconst CORList = lazy(() => import('./cor/CORList'))\nconst TMList = lazy(() => import('./TMList'))\nconst BillingCenter = lazy(() => import('./billing/BillingCenter'))\nconst PhotoTimeline = lazy(() => import('./PhotoTimeline'))\nconst PunchList = lazy(() => import('./PunchList'))\nimport EarnedValueCard from './charts/EarnedValueCard'\n\nexport default function Dashboard({ company, user, isAdmin, onShowToast, navigateToProjectId, onProjectNavigated }) {\n  const [projects, setProjects] = useState([])\n  const [projectsData, setProjectsData] = useState([]) // Enhanced data with areas/tickets\n  const [selectedProject, setSelectedProject] = useState(null)\n  const [areas, setAreas] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [showShareModal, setShowShareModal] = useState(false)\n  const [showNotificationSettings, setShowNotificationSettings] = useState(false)\n  const [activeProjectTab, setActiveProjectTab] = useState('overview')\n  const [financialsSection, setFinancialsSection] = useState('overview') // 'overview' | 'cors' | 'tickets'\n  const [financialsSidebarCollapsed, setFinancialsSidebarCollapsed] = useState(true) // Start collapsed for more real estate\n  const [financialsSidebarMobileOpen, setFinancialsSidebarMobileOpen] = useState(false) // For mobile sidebar overlay\n  const [corListExpanded, setCORListExpanded] = useState(false) // Whether the full card list is shown below the log\n  const [corDisplayMode, setCORDisplayMode] = useState('list') // 'list' | 'log' - for layout expansion\n  const [tmViewMode, setTMViewMode] = useState('preview') // 'preview' | 'full'\n  const [dumpSites, setDumpSites] = useState([])\n  const [showCORForm, setShowCORForm] = useState(false)\n  const [editingCOR, setEditingCOR] = useState(null)\n  const [showCORDetail, setShowCORDetail] = useState(false)\n  const [viewingCOR, setViewingCOR] = useState(null)\n  const [corRefreshKey, setCORRefreshKey] = useState(0)\n  const [showAddCostModal, setShowAddCostModal] = useState(false)\n  const [savingCost, setSavingCost] = useState(false)\n  const [showEquipmentModal, setShowEquipmentModal] = useState(false)\n  const [editingEquipment, setEditingEquipment] = useState(null)\n  const [equipmentRefreshKey, setEquipmentRefreshKey] = useState(0)\n  const [showDrawRequestModal, setShowDrawRequestModal] = useState(false)\n  const [editingDrawRequest, setEditingDrawRequest] = useState(null)\n  const [drawRequestRefreshKey, setDrawRequestRefreshKey] = useState(0)\n\n  // Universal Search (Cmd+K)\n  const { isOpen: isSearchOpen, setIsOpen: setSearchOpen, close: closeSearch } = useUniversalSearch()\n\n  // Portfolio metrics (extracted hook)\n  const { portfolioMetrics, projectHealth, scheduleMetrics, riskAnalysis } = usePortfolioMetrics(projectsData)\n\n  // Project edit mode (extracted hook)\n  const {\n    editMode, editData, saving,\n    handleEditClick, handleCancelEdit, handleEditChange,\n    handleAreaEditChange, handleAddArea, handleRemoveArea,\n    handleSaveEdit, handleDeleteProject\n  } = useProjectEdit({ selectedProject, areas, company, onShowToast, loadAreas, setSelectedProject })\n\n  // Debounce ref to prevent cascading refreshes from multiple subscription callbacks\n  // When multiple real-time events fire rapidly, this coalesces them into a single refresh\n  const refreshTimeoutRef = useRef(null)\n  const pendingAreasRefreshRef = useRef(false)\n  const pendingCORRefreshRef = useRef(false)\n\n  // Cache for project details to avoid re-fetching when switching between projects\n  // Key: projectId, Value: { data: enhancedProjectData, timestamp: Date.now() }\n  const projectDetailsCacheRef = useRef(new Map())\n  const CACHE_TTL_MS = 5 * 60 * 1000 // 5 minute cache TTL\n\n  // Debounced refresh function that coalesces multiple rapid refresh requests\n  // This prevents 5+ loadProjects() calls when multiple subscriptions fire at once\n  const debouncedRefresh = useCallback((options = {}) => {\n    const { refreshAreas = false, refreshCOR = false, projectId = null } = options\n\n    // Track what needs refreshing\n    if (refreshAreas && projectId) pendingAreasRefreshRef.current = projectId\n    if (refreshCOR) pendingCORRefreshRef.current = true\n\n    // Clear any pending refresh\n    if (refreshTimeoutRef.current) {\n      clearTimeout(refreshTimeoutRef.current)\n    }\n\n    // Schedule a single refresh after debounce period (150ms)\n    // This is fast enough to feel \"live\" but prevents cascading calls\n    refreshTimeoutRef.current = setTimeout(async () => {\n      // Execute pending refreshes\n      if (pendingAreasRefreshRef.current) {\n        await loadAreas(pendingAreasRefreshRef.current)\n        pendingAreasRefreshRef.current = false\n      }\n      if (pendingCORRefreshRef.current) {\n        setCORRefreshKey(prev => prev + 1)\n        pendingCORRefreshRef.current = false\n      }\n      // Always refresh projects to update metrics\n      await loadProjects()\n    }, 150)\n  }, [])\n\n  // Cleanup debounce timeout on unmount\n  useEffect(() => {\n    return () => {\n      if (refreshTimeoutRef.current) {\n        clearTimeout(refreshTimeoutRef.current)\n      }\n    }\n  }, [])\n\n  // Initial load\n  useEffect(() => {\n    if (company?.id) {\n      loadProjects()\n      loadDumpSites()\n    }\n  }, [company?.id])\n\n  // Track project IDs for subscription stability (avoids re-subscribing on every projects array change)\n  const projectIdsRef = useRef([])\n  const projectIdsKey = projects.map(p => p.id).sort().join(',')\n\n  // Real-time subscription - runs after projects are loaded\n  useEffect(() => {\n    if (!company?.id || projects.length === 0) return\n\n    // Only update ref if project IDs actually changed\n    const currentIds = projects.map(p => p.id).sort()\n    projectIdsRef.current = currentIds\n\n    // Subscribe to company-wide activity to refresh metrics in real-time\n    // Uses debounced refresh to coalesce rapid updates from multiple sources\n    const subscription = db.subscribeToCompanyActivity?.(company.id, currentIds, {\n      onMessage: () => debouncedRefresh(),\n      onMaterialRequest: () => debouncedRefresh(),\n      onTMTicket: () => debouncedRefresh(),\n      onCrewCheckin: () => debouncedRefresh(), // Crew check-ins affect labor costs\n      onAreaUpdate: () => debouncedRefresh(), // Area updates affect progress\n      onCORChange: () => debouncedRefresh({ refreshCOR: true }), // COR changes\n      onInjuryReport: () => debouncedRefresh(),\n      onProjectChange: () => debouncedRefresh(), // Project details changed\n      onMaterialsEquipmentChange: () => debouncedRefresh(), // Pricing updates\n      onLaborRateChange: () => debouncedRefresh() // Labor rate updates\n    })\n\n    return () => {\n      if (subscription) {\n        db.unsubscribe?.(subscription)\n      }\n    }\n  }, [company?.id, projectIdsKey, debouncedRefresh])\n\n  // Prevent body scroll when mobile sidebar is open\n  useEffect(() => {\n    if (financialsSidebarMobileOpen) {\n      document.body.style.overflow = 'hidden'\n    } else {\n      document.body.style.overflow = ''\n    }\n\n    return () => {\n      document.body.style.overflow = ''\n    }\n  }, [financialsSidebarMobileOpen])\n\n  const loadDumpSites = async () => {\n    try {\n      const sites = await db.getDumpSites(company.id)\n      setDumpSites(sites || [])\n    } catch (error) {\n      console.error('Error loading dump sites:', error)\n    }\n  }\n\n  // Handle navigation from notifications\n  // Use a ref to prevent re-running this effect when projects data refreshes\n  const lastNavigatedIdRef = useRef(null)\n  useEffect(() => {\n    if (navigateToProjectId && navigateToProjectId !== lastNavigatedIdRef.current && projects.length > 0) {\n      const project = projects.find(p => p.id === navigateToProjectId)\n      if (project) {\n        lastNavigatedIdRef.current = navigateToProjectId\n        setSelectedProject(project)\n        onProjectNavigated?.() // Clear the navigation request\n      }\n    }\n  }, [navigateToProjectId, projects, onProjectNavigated])\n\n  useEffect(() => {\n    if (selectedProject) {\n      loadAreas(selectedProject.id)\n\n      // Subscribe to real-time updates for the selected project\n      // All callbacks use debouncedRefresh to prevent cascading refreshes\n      const subscriptions = []\n      const projectId = selectedProject.id\n\n      // Areas subscription - also refreshes areas list\n      const areasSub = db.subscribeToAreas?.(projectId, () => {\n        debouncedRefresh({ refreshAreas: true, projectId })\n      })\n      if (areasSub) subscriptions.push(areasSub)\n\n      // Daily reports subscription\n      const dailyReportsSub = db.subscribeToDailyReports?.(projectId, () => {\n        debouncedRefresh()\n      })\n      if (dailyReportsSub) subscriptions.push(dailyReportsSub)\n\n      // Crew checkins subscription (affects labor costs)\n      const checkinsSub = db.subscribeToCrewCheckins?.(projectId, () => {\n        debouncedRefresh()\n      })\n      if (checkinsSub) subscriptions.push(checkinsSub)\n\n      // Haul offs subscription\n      const haulOffsSub = db.subscribeToHaulOffs?.(projectId, () => {\n        debouncedRefresh()\n      })\n      if (haulOffsSub) subscriptions.push(haulOffsSub)\n\n      // CORs subscription - also refreshes COR list\n      const corsSub = db.subscribeToCORs?.(projectId, () => {\n        debouncedRefresh({ refreshCOR: true })\n      })\n      if (corsSub) subscriptions.push(corsSub)\n\n      return () => {\n        subscriptions.forEach(sub => db.unsubscribe?.(sub))\n      }\n    }\n  }, [selectedProject, debouncedRefresh])\n\n  // When navigating to tickets section, switch to full mode to show dashboard\n  useEffect(() => {\n    if (financialsSection === 'tickets') {\n      setTMViewMode('full')\n    }\n  }, [financialsSection])\n\n  // Load detailed data for a single project (on-demand, with caching)\n  // This replaces the previous N+1 pattern where ALL project details were loaded upfront\n  const loadProjectDetails = async (project, forceRefresh = false) => {\n    const cacheKey = project.id\n    const cached = projectDetailsCacheRef.current.get(cacheKey)\n\n    // Return cached data if valid and not forcing refresh\n    if (cached && !forceRefresh && (Date.now() - cached.timestamp) < CACHE_TTL_MS) {\n      return cached.data\n    }\n\n    try {\n      // Fetch detailed project data in parallel (12 queries for 1 project, not 12N)\n      const [\n        projectAreas,\n        tickets,\n        changeOrderData,\n        dailyReports,\n        injuryReports,\n        laborCosts,\n        haulOffCosts,\n        customCosts,\n        corStats,\n        crewHistory,\n        materialRequests,\n        weeklyDisposal\n      ] = await Promise.all([\n        safeAsync(() => db.getAreas(project.id), { fallback: [], context: { operation: 'getAreas', projectId: project.id } }),\n        safeAsync(() => db.getTMTickets(project.id), { fallback: [], context: { operation: 'getTMTickets', projectId: project.id } }),\n        safeAsync(() => db.getChangeOrderTotals(project.id), { fallback: null, context: { operation: 'getChangeOrderTotals', projectId: project.id } }),\n        safeAsync(() => db.getDailyReports(project.id, 100), { fallback: [], context: { operation: 'getDailyReports', projectId: project.id } }),\n        safeAsync(() => db.getInjuryReports(project.id), { fallback: [], context: { operation: 'getInjuryReports', projectId: project.id } }),\n        safeAsync(() => db.calculateManDayCosts(project.id, company?.id, project.work_type || 'demolition', project.job_type || 'standard'), { fallback: null, context: { operation: 'calculateManDayCosts', projectId: project.id } }),\n        safeAsync(() => db.calculateHaulOffCosts(project.id), { fallback: null, context: { operation: 'calculateHaulOffCosts', projectId: project.id } }),\n        safeAsync(() => db.getProjectCosts(project.id), { fallback: [], context: { operation: 'getProjectCosts', projectId: project.id } }),\n        safeAsync(() => db.getCORStats(project.id), { fallback: null, context: { operation: 'getCORStats', projectId: project.id } }),\n        safeAsync(() => db.getCrewCheckinHistory(project.id, 60), { fallback: [], context: { operation: 'getCrewCheckinHistory', projectId: project.id } }),\n        safeAsync(() => db.getMaterialRequests(project.id), { fallback: [], context: { operation: 'getMaterialRequests', projectId: project.id } }),\n        safeAsync(() => db.getWeeklyDisposalSummary(project.id, 4), { fallback: [], context: { operation: 'getWeeklyDisposalSummary', projectId: project.id } })\n      ])\n\n      // Calculate progress - use SOV values if available\n      const progressData = calculateValueProgress(projectAreas)\n      const progress = progressData.progress\n\n      // Calculate revised contract value\n      const changeOrderValue = changeOrderData?.totalApprovedValue || 0\n      const revisedContractValue = project.contract_value + changeOrderValue\n\n      // Billable calculation\n      const billable = progressData.isValueBased\n        ? progressData.earnedValue\n        : (progress / 100) * revisedContractValue\n      const pendingTickets = tickets.filter(t => t.status === 'pending').length\n\n      // Recent activity\n      const oneWeekAgo = new Date()\n      oneWeekAgo.setDate(oneWeekAgo.getDate() - 7)\n      const recentDailyReports = dailyReports.filter(r => new Date(r.report_date) >= oneWeekAgo).length\n\n      // Custom costs\n      const customCostTotal = customCosts.reduce((sum, c) => {\n        const amount = parseFloat(c.amount)\n        return sum + (isNaN(amount) ? 0 : amount)\n      }, 0)\n\n      // Materials/equipment costs from T&M\n      let materialsEquipmentCost = 0\n      const materialsEquipmentByDate = {}\n      tickets.forEach(ticket => {\n        const ticketDate = ticket.work_date || ticket.ticket_date || ticket.created_at?.split('T')[0]\n        const items = ticket.t_and_m_items || ticket.items || []\n        let ticketMaterialsCost = 0\n        items.forEach(item => {\n          const qty = parseFloat(item.quantity) || 1\n          const cost = parseFloat(item.unit_cost) || parseFloat(item.materials_equipment?.cost_per_unit) || 0\n          ticketMaterialsCost += qty * cost\n        })\n        if (ticketMaterialsCost > 0 && ticketDate) {\n          materialsEquipmentCost += ticketMaterialsCost\n          if (!materialsEquipmentByDate[ticketDate]) {\n            materialsEquipmentByDate[ticketDate] = { date: ticketDate, cost: 0 }\n          }\n          materialsEquipmentByDate[ticketDate].cost += ticketMaterialsCost\n        }\n      })\n      const materialsEquipmentByDateArray = Object.values(materialsEquipmentByDate)\n        .sort((a, b) => new Date(b.date) - new Date(a.date))\n\n      // Total costs\n      const laborCost = laborCosts?.totalCost || 0\n      const haulOffCost = haulOffCosts?.totalCost || 0\n      const allCostsTotal = laborCost + materialsEquipmentCost + customCostTotal\n\n      // Profit calculations\n      const currentProfit = billable - allCostsTotal\n      const profitMargin = billable > 0 ? (currentProfit / billable) * 100 : 0\n\n      // Burn rate\n      const laborDays = laborCosts?.byDate?.length || 0\n      const materialsDays = materialsEquipmentByDateArray.length\n      const totalBurnDays = Math.max(laborDays, materialsDays)\n      const totalBurn = laborCost + materialsEquipmentCost\n      const dailyBurn = totalBurnDays > 0 ? totalBurn / totalBurnDays : 0\n\n      // Schedule insights\n      const scheduleInsights = calculateScheduleInsights(\n        { ...project, progress },\n        laborCosts?.totalManDays || 0\n      )\n\n      // Crew analytics from check-in history\n      const crewByDate = {}\n      const uniqueWorkers = new Set()\n      ;(crewHistory || []).forEach(checkin => {\n        const workers = checkin.workers || []\n        crewByDate[checkin.check_in_date] = workers.length\n        workers.forEach(w => uniqueWorkers.add(w.name?.toLowerCase()))\n      })\n      const crewDates = Object.keys(crewByDate).sort()\n      const avgCrewSize = crewDates.length > 0\n        ? Math.round(crewDates.reduce((sum, d) => sum + crewByDate[d], 0) / crewDates.length * 10) / 10\n        : 0\n      const peakCrewSize = crewDates.length > 0\n        ? Math.max(...crewDates.map(d => crewByDate[d]))\n        : 0\n      // Crew trend: compare last 7 days avg to prior 7 days avg\n      const recentCrewDates = crewDates.slice(-7)\n      const priorCrewDates = crewDates.slice(-14, -7)\n      const recentCrewAvg = recentCrewDates.length > 0\n        ? recentCrewDates.reduce((s, d) => s + crewByDate[d], 0) / recentCrewDates.length\n        : 0\n      const priorCrewAvg = priorCrewDates.length > 0\n        ? priorCrewDates.reduce((s, d) => s + crewByDate[d], 0) / priorCrewDates.length\n        : 0\n\n      // Material request analytics\n      const pendingMaterialRequests = (materialRequests || []).filter(r => r.status === 'pending').length\n      const orderedMaterialRequests = (materialRequests || []).filter(r => r.status === 'ordered').length\n      const deliveredMaterialRequests = (materialRequests || []).filter(r => r.status === 'delivered').length\n      const urgentMaterialRequests = (materialRequests || []).filter(r => r.priority === 'urgent' && r.status === 'pending').length\n\n      // Daily report field notes analysis\n      const reportsWithIssues = dailyReports.filter(r => r.issues && r.issues.trim().length > 0).length\n      const totalPhotosFromTickets = tickets.reduce((sum, t) => sum + (t.photos?.length || 0), 0)\n\n      // Disposal totals from weekly data\n      const disposalTotalLoads = (weeklyDisposal || []).reduce((sum, w) => {\n        return sum + (w.concrete || 0) + (w.trash || 0) + (w.metals || 0) + (w.hazardous_waste || 0)\n      }, 0)\n\n      // Days since last injury\n      const lastInjuryDate = injuryReports.length > 0\n        ? new Date(injuryReports[0]?.incident_date || injuryReports[0]?.created_at)\n        : null\n      const daysSinceLastInjury = lastInjuryDate\n        ? Math.floor((new Date() - lastInjuryDate) / (1000 * 60 * 60 * 24))\n        : null\n\n      // Task completion velocity: areas completed in last 14 days vs prior 14 days\n      const completedAreas = projectAreas.filter(a => a.status === 'done')\n\n      const enhancedData = {\n        ...project,\n        areas: projectAreas,\n        progress,\n        billable,\n        changeOrderValue,\n        revisedContractValue,\n        changeOrderPending: changeOrderData?.pendingCount || 0,\n        totalTickets: tickets.length,\n        pendingTickets,\n        approvedTickets: tickets.filter(t => t.status === 'approved').length,\n        tmTickets: tickets,\n        dailyReportsCount: dailyReports.length,\n        recentDailyReports,\n        injuryReportsCount: injuryReports.length,\n        lastDailyReport: dailyReports[0]?.report_date || null,\n        isValueBased: progressData.isValueBased,\n        earnedValue: progressData.earnedValue,\n        totalSOVValue: progressData.totalValue,\n        laborCost,\n        laborDaysWorked: laborDays,\n        laborManDays: laborCosts?.totalManDays || 0,\n        laborByDate: laborCosts?.byDate || [],\n        dailyBurn,\n        materialsEquipmentCost,\n        materialsEquipmentByDate: materialsEquipmentByDateArray,\n        haulOffCost,\n        haulOffLoads: haulOffCosts?.totalLoads || 0,\n        haulOffDays: haulOffCosts?.daysWithHaulOff || 0,\n        haulOffByType: haulOffCosts?.byWasteType || {},\n        haulOffByDate: haulOffCosts?.byDate || [],\n        customCosts,\n        customCostTotal,\n        totalBurn,\n        totalBurnDays,\n        allCostsTotal,\n        currentProfit,\n        profitMargin,\n        corPendingValue: corStats?.total_pending_value || 0,\n        corPendingCount: corStats?.pending_count || 0,\n        corApprovedValue: corStats?.total_approved_value || 0,\n        corBilledValue: corStats?.total_billed_value || 0,\n        corTotalCount: corStats?.total_cors || 0,\n        corStats: corStats,\n        scheduleStatus: scheduleInsights.scheduleStatus,\n        scheduleVariance: scheduleInsights.scheduleVariance,\n        scheduleLabel: scheduleInsights.scheduleLabel,\n        laborStatus: scheduleInsights.laborStatus,\n        laborVariance: scheduleInsights.laborVariance,\n        laborLabel: scheduleInsights.laborLabel,\n        hasScheduleData: scheduleInsights.hasScheduleData,\n        hasLaborData: scheduleInsights.hasLaborData,\n        actualManDays: laborCosts?.totalManDays || 0,\n        // Crew analytics\n        crewHistory: crewHistory || [],\n        crewByDate,\n        uniqueWorkerCount: uniqueWorkers.size,\n        avgCrewSize,\n        peakCrewSize,\n        crewDaysTracked: crewDates.length,\n        crewTrend: priorCrewAvg > 0 ? ((recentCrewAvg - priorCrewAvg) / priorCrewAvg * 100) : 0,\n        recentCrewAvg,\n        // Material requests\n        materialRequests: materialRequests || [],\n        pendingMaterialRequests,\n        orderedMaterialRequests,\n        deliveredMaterialRequests,\n        urgentMaterialRequests,\n        totalMaterialRequests: (materialRequests || []).length,\n        // Field activity insights\n        reportsWithIssues,\n        totalPhotosFromTickets,\n        dailyReports,\n        // Disposal trends\n        weeklyDisposal: weeklyDisposal || [],\n        disposalTotalLoads,\n        // Safety analytics\n        daysSinceLastInjury,\n        injuryReports,\n        oshaRecordable: injuryReports.filter(r => r.osha_recordable).length,\n        // Completion\n        completedAreasCount: completedAreas.length,\n        hasError: false,\n        _detailsLoaded: true\n      }\n\n      // Cache the enhanced data\n      projectDetailsCacheRef.current.set(cacheKey, {\n        data: enhancedData,\n        timestamp: Date.now()\n      })\n\n      return enhancedData\n    } catch (error) {\n      console.error(`Error loading details for project ${project.id}:`, error)\n      return { ...project, hasError: true, _detailsLoaded: false }\n    }\n  }\n\n  // OPTIMIZED: Load projects with summary data only (1 query instead of 9N)\n  // Detailed data is loaded on-demand when a project is selected\n  const loadProjects = async () => {\n    try {\n      // Single optimized query for all project summaries\n      const data = await db.getProjectDashboardSummary(company?.id)\n      setProjects(data)\n\n      // Create lightweight enhanced data using ONLY summary metrics from the RPC\n      // This uses data already returned from getProjectDashboardSummary (no additional queries!)\n      // Detailed data is loaded on-demand via loadProjectDetails when a project is selected\n      const enhanced = data.map(project => {\n        // Check if we have cached detailed data for this project\n        const cached = projectDetailsCacheRef.current.get(project.id)\n        if (cached && (Date.now() - cached.timestamp) < CACHE_TTL_MS) {\n          // Use cached detailed data if still valid\n          return cached.data\n        }\n\n        // Use summary data from RPC (no additional queries needed)\n        // Progress is estimated from area counts in the summary\n        const totalAreas = project.areaCount || 0\n        const completedAreas = project.completedAreas || 0\n        const progress = totalAreas > 0 ? Math.round((completedAreas / totalAreas) * 100) : 0\n\n        return {\n          ...project,\n          // Basic metrics from summary (already loaded)\n          progress,\n          areas: [], // Loaded on-demand when project selected\n          totalTickets: project.ticketCount || 0,\n          pendingTickets: project.pendingTicketCount || 0,\n          approvedTickets: project.approvedTicketCount || 0,\n          dailyReportsCount: project.dailyReportsThisWeek || 0,\n          recentDailyReports: project.dailyReportsThisWeek || 0,\n          corTotalCount: project.corCount || 0,\n          // Placeholder values - loaded on-demand when selected\n          billable: 0,\n          changeOrderValue: 0,\n          revisedContractValue: project.contract_value || 0,\n          changeOrderPending: 0,\n          tmTickets: [],\n          injuryReportsCount: 0,\n          lastDailyReport: null,\n          isValueBased: false,\n          earnedValue: 0,\n          totalSOVValue: 0,\n          laborCost: 0,\n          laborDaysWorked: 0,\n          laborManDays: 0,\n          laborByDate: [],\n          dailyBurn: 0,\n          materialsEquipmentCost: 0,\n          materialsEquipmentByDate: [],\n          haulOffCost: 0,\n          haulOffLoads: 0,\n          haulOffDays: 0,\n          haulOffByType: {},\n          haulOffByDate: [],\n          customCosts: [],\n          customCostTotal: 0,\n          totalBurn: 0,\n          totalBurnDays: 0,\n          allCostsTotal: 0,\n          currentProfit: 0,\n          profitMargin: 0,\n          corPendingValue: 0,\n          corPendingCount: 0,\n          corApprovedValue: 0,\n          corBilledValue: 0,\n          corStats: null,\n          scheduleStatus: 'on_track',\n          scheduleVariance: 0,\n          scheduleLabel: 'On Track',\n          laborStatus: 'on_track',\n          laborVariance: 0,\n          laborLabel: null,\n          hasScheduleData: false,\n          hasLaborData: false,\n          actualManDays: 0,\n          hasError: false,\n          _detailsLoaded: false // Flag to indicate detailed data needs loading\n        }\n      })\n      setProjectsData(enhanced)\n    } catch (error) {\n      console.error('Error loading projects:', error)\n      onShowToast('Error loading projects', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function loadAreas(projectId) {\n    try {\n      const data = await db.getAreas(projectId)\n      setAreas(data)\n    } catch (error) {\n      console.error('Error loading areas:', error)\n    }\n  }\n\n  const handleSelectProject = async (project) => {\n    // Set the project immediately for responsive UI\n    setSelectedProject(project)\n\n    // If detailed data hasn't been loaded yet, load it now (lazy loading)\n    if (!project._detailsLoaded) {\n      const detailedProject = await loadProjectDetails(project)\n\n      // Update projectsData with the detailed version\n      setProjectsData(prev => prev.map(p =>\n        p.id === project.id ? detailedProject : p\n      ))\n\n      // Update selectedProject with detailed data\n      setSelectedProject(detailedProject)\n    }\n  }\n\n  const handleBack = () => {\n    setSelectedProject(null)\n    setAreas([])\n    handleCancelEdit()\n    setActiveProjectTab('overview')\n    loadProjects()\n  }\n\n  // Edit handlers provided by useProjectEdit hook\n\n  // Memoize selected project data lookup to avoid repeated finds\n  // NOTE: All hooks must be before any conditional returns (React rules of hooks)\n  const projectData = useMemo(() => {\n    if (!selectedProject) return null\n    return projectsData.find(p => p.id === selectedProject.id)\n  }, [selectedProject, projectsData])\n\n  // Memoize progress calculations - these are expensive and only change when areas change\n  const progressCalculations = useMemo(() => {\n    if (!selectedProject) {\n      return { progress: 0, billable: 0, isValueBased: false, earnedValue: 0, totalSOVValue: 0, changeOrderValue: 0, revisedContractValue: 0 }\n    }\n\n    // Calculate progress - use SOV values if available\n    const progressData = calculateValueProgress(areas)\n    const progress = progressData.progress\n\n    // Get change order data from enhanced project data\n    const changeOrderValue = projectData?.changeOrderValue || 0\n    const revisedContractValue = selectedProject.contract_value + changeOrderValue\n\n    // Billable: use actual earned value from SOV if available\n    const billable = progressData.isValueBased\n      ? progressData.earnedValue\n      : (progress / 100) * revisedContractValue\n\n    return {\n      progress,\n      billable,\n      changeOrderValue,\n      revisedContractValue,\n      isValueBased: progressData.isValueBased,\n      earnedValue: progressData.earnedValue,\n      totalSOVValue: progressData.totalValue\n    }\n  }, [selectedProject, areas, projectData])\n\n  // Portfolio metrics, project health, schedule metrics, and risk analysis\n  // provided by usePortfolioMetrics hook\n\n  // Handler for alert actions\n  const handleAlertAction = useCallback(({ target, projectId, alert }) => {\n    const project = projects.find(p => p.id === projectId)\n    if (project) {\n      setSelectedProject(project)\n      // Navigate to appropriate tab based on action target\n      if (target === 'financials') {\n        setActiveProjectTab('financials')\n      } else if (target === 'reports') {\n        setActiveProjectTab('reports')\n      } else if (target === 'cors') {\n        setActiveProjectTab('financials')\n        setFinancialsSection('cors')\n      } else {\n        setActiveProjectTab('overview')\n      }\n    }\n  }, [projects])\n\n  // Auto-archive projects that have been complete for 30+ days\n  useEffect(() => {\n    const checkAutoArchive = async () => {\n      for (const project of projectsData) {\n        if (shouldAutoArchive(project, 30)) {\n          try {\n            await db.archiveProject(project.id)\n            onShowToast(`Project \"${project.name}\" has been auto-archived after 30 days of completion`, 'info')\n          } catch (error) {\n            console.error('Failed to auto-archive project:', error)\n          }\n        }\n      }\n    }\n\n    if (projectsData.length > 0) {\n      checkAutoArchive()\n    }\n  }, []) // Only run on mount\n\n  // Memoized callbacks for child components to prevent unnecessary re-renders\n  const handleAddEquipment = useCallback(() => {\n    setEditingEquipment(null)\n    setShowEquipmentModal(true)\n  }, [])\n\n  const handleEditEquipment = useCallback((item) => {\n    setEditingEquipment(item)\n    setShowEquipmentModal(true)\n  }, [])\n\n  const handleCreateDraw = useCallback(() => {\n    setEditingDrawRequest(null)\n    setShowDrawRequestModal(true)\n  }, [])\n\n  const handleViewDraw = useCallback((drawRequest) => {\n    setEditingDrawRequest(drawRequest)\n    setShowDrawRequestModal(true)\n  }, [])\n\n  const handleViewAllTickets = useCallback(() => {\n    setTMViewMode('full')\n  }, [])\n\n  const handleToggleFinancialsSidebar = useCallback(() => {\n    setFinancialsSidebarCollapsed(prev => !prev)\n  }, [])\n\n  const handleToggleMobileSidebar = useCallback(() => {\n    setFinancialsSidebarMobileOpen(prev => !prev)\n  }, [])\n\n  const handleCloseMobileSidebar = useCallback(() => {\n    setFinancialsSidebarMobileOpen(false)\n  }, [])\n\n  const handleToggleCORList = useCallback(() => {\n    setCORListExpanded(prev => !prev)\n  }, [])\n\n  // Field document export handler\n  const handleExportFieldDocuments = useCallback(async (type = 'all') => {\n    if (!selectedProject) return\n    onShowToast('Gathering field data...', 'info')\n    try {\n      const [dailyReports, injuryReports, crewCheckins] = await Promise.all([\n        db.getDailyReports(selectedProject.id, 365),\n        db.getInjuryReports(selectedProject.id),\n        db.getCrewCheckinHistory(selectedProject.id, 365)\n      ])\n\n      if (type === 'daily') {\n        await exportDailyReportsPDF(dailyReports || [], selectedProject)\n      } else if (type === 'incidents') {\n        await exportIncidentReportsPDF(injuryReports || [], selectedProject)\n      } else if (type === 'crew') {\n        await exportCrewCheckinsPDF(crewCheckins || [], selectedProject)\n      } else {\n        await exportAllFieldDocumentsPDF({\n          dailyReports: dailyReports || [],\n          incidentReports: injuryReports || [],\n          crewCheckins: crewCheckins || [],\n          project: selectedProject\n        })\n      }\n      onShowToast('PDF exported!', 'success')\n    } catch (error) {\n      console.error('Error exporting field documents:', error)\n      onShowToast('Error generating PDF', 'error')\n    }\n  }, [selectedProject, onShowToast])\n\n  const handleBackToTMPreview = useCallback(() => {\n    setTMViewMode('preview')\n  }, [])\n\n  const handleViewFullCORLog = useCallback(() => {\n    setCORDisplayMode('log')\n  }, [])\n\n  const handleCreateCOR = useCallback(() => {\n    setEditingCOR(null)\n    setShowCORForm(true)\n  }, [])\n\n  const handleViewCOR = useCallback((cor) => {\n    setViewingCOR(cor)\n    setShowCORDetail(true)\n  }, [])\n\n  const handleEditCOR = useCallback((cor) => {\n    setEditingCOR(cor)\n    setShowCORForm(true)\n  }, [])\n\n  const handleAddCost = useCallback(() => {\n    setShowAddCostModal(true)\n  }, [])\n\n  const handleDeleteCost = useCallback(async (costId) => {\n    try {\n      await db.deleteProjectCost(costId)\n      loadProjects()\n      onShowToast?.('Cost deleted', 'success')\n    } catch (err) {\n      onShowToast?.('Error deleting cost', 'error')\n    }\n  }, []) // onShowToast is stable (memoized in App.jsx)\n\n  // Memoize stats for FinancialsNav to prevent re-renders from inline object creation\n  const financialsNavStats = useMemo(() => ({\n    corCount: projectData?.corStats?.total || 0,\n    ticketCount: projectData?.totalTickets || 0,\n    corPending: projectData?.corStats?.pending || 0,\n    ticketPending: projectData?.pendingTickets || 0\n  }), [projectData?.corStats?.total, projectData?.totalTickets, projectData?.corStats?.pending, projectData?.pendingTickets])\n\n  // Destructure memoized values for cleaner usage below\n  const { totalOriginalContract, totalChangeOrders, totalPortfolioValue, totalEarned, totalRemaining, weightedCompletion, totalPendingCORValue, totalPendingCORCount } = portfolioMetrics\n  const { projectsComplete, projectsOnTrack, projectsAtRisk, projectsOverBudget, projectsWithChangeOrders } = projectHealth\n  const { scheduleAhead, scheduleOnTrack, scheduleBehind, laborOver, laborUnder, laborOnTrack, hasAnyScheduleData, hasAnyLaborData } = scheduleMetrics\n\n  if (loading) {\n    return (\n      <div className=\"loading\">\n        <div className=\"spinner\"></div>\n        Loading projects...\n      </div>\n    )\n  }\n\n  // Project Detail View\n  if (selectedProject) {\n    // Extract memoized values\n    const { progress, billable, changeOrderValue, revisedContractValue, isValueBased, earnedValue, totalSOVValue } = progressCalculations\n\n    // Edit Mode\n    if (editMode && editData) {\n      const totalWeight = editData.areas.reduce((sum, a) => sum + (parseFloat(a.weight) || 0), 0)\n\n      return (\n        <div>\n          <button className=\"btn btn-secondary btn-small\" onClick={handleCancelEdit} style={{ marginBottom: '1.5rem' }}>\n             Cancel\n          </button>\n\n          <h1>Edit Project</h1>\n          <p className=\"subtitle\">Update project details</p>\n\n          {/* Basic Info */}\n          <div className=\"card\">\n            <h3>Basic Info</h3>\n            <div className=\"form-row\">\n              <div className=\"form-group\" style={{ flex: 2 }}>\n                <label>Project Name *</label>\n                <input\n                  type=\"text\"\n                  value={editData.name}\n                  onChange={(e) => handleEditChange('name', e.target.value)}\n                  placeholder=\"e.g., Downtown Office Demolition\"\n                />\n              </div>\n              <div className=\"form-group\" style={{ flex: 1 }}>\n                <label>Job Number</label>\n                <input\n                  type=\"text\"\n                  value={editData.job_number}\n                  onChange={(e) => handleEditChange('job_number', e.target.value)}\n                  placeholder=\"e.g., 2024-001\"\n                />\n              </div>\n            </div>\n\n            <div className=\"form-group\">\n              <label>Project Address</label>\n              <input\n                type=\"text\"\n                value={editData.address}\n                onChange={(e) => handleEditChange('address', e.target.value)}\n                placeholder=\"123 Main St, City, State 12345\"\n              />\n            </div>\n          </div>\n\n          {/* Client & Contractor Info */}\n          <div className=\"card\">\n            <h3>Client & Contractor</h3>\n            <div className=\"form-group\">\n              <label>General Contractor</label>\n              <input\n                type=\"text\"\n                value={editData.general_contractor}\n                onChange={(e) => handleEditChange('general_contractor', e.target.value)}\n                placeholder=\"e.g., ABC Construction\"\n              />\n            </div>\n\n            <div className=\"form-row\">\n              <div className=\"form-group\">\n                <label>Client Contact</label>\n                <input\n                  type=\"text\"\n                  value={editData.client_contact}\n                  onChange={(e) => handleEditChange('client_contact', e.target.value)}\n                  placeholder=\"Contact name\"\n                />\n              </div>\n              <div className=\"form-group\">\n                <label>Client Phone</label>\n                <input\n                  type=\"tel\"\n                  value={editData.client_phone}\n                  onChange={(e) => handleEditChange('client_phone', e.target.value)}\n                  placeholder=\"(555) 123-4567\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Financial & Project Settings */}\n          <div className=\"card\">\n            <h3>Financials & Settings</h3>\n            <div className=\"form-row\">\n              <div className=\"form-group\">\n                <label>Contract Value ($) *</label>\n                <input\n                  type=\"number\"\n                  value={editData.contract_value}\n                  onChange={(e) => handleEditChange('contract_value', e.target.value)}\n                  placeholder=\"0\"\n                />\n              </div>\n              <div className=\"form-group\">\n                <label>Foreman PIN</label>\n                <input\n                  type=\"text\"\n                  value={editData.pin}\n                  onChange={(e) => handleEditChange('pin', e.target.value.replace(/\\D/g, '').slice(0, 4))}\n                  placeholder=\"4 digits\"\n                  maxLength={4}\n                />\n                <span className=\"form-hint\">Used for field crew access</span>\n              </div>\n            </div>\n\n            <div className=\"form-row\">\n              <div className=\"form-group\">\n                <label>Work Type</label>\n                <select\n                  value={editData.work_type}\n                  onChange={(e) => handleEditChange('work_type', e.target.value)}\n                >\n                  <option value=\"demolition\">Demolition</option>\n                  <option value=\"environmental\">Environmental</option>\n                </select>\n                <span className=\"form-hint\">Affects labor rate calculations</span>\n              </div>\n              <div className=\"form-group\">\n                <label>Job Type</label>\n                <select\n                  value={editData.job_type}\n                  onChange={(e) => handleEditChange('job_type', e.target.value)}\n                >\n                  <option value=\"standard\">Standard</option>\n                  <option value=\"prevailing_wage\">Prevailing Wage</option>\n                </select>\n              </div>\n            </div>\n\n            <div className=\"form-group\">\n              <label>Default Dump Site</label>\n              <select\n                value={editData.default_dump_site_id}\n                onChange={(e) => handleEditChange('default_dump_site_id', e.target.value)}\n              >\n                <option value=\"\">-- Select Dump Site --</option>\n                {dumpSites.map(site => (\n                  <option key={site.id} value={site.id}>{site.name}</option>\n                ))}\n              </select>\n              <span className=\"form-hint\">Used for haul-off tracking and cost estimates</span>\n            </div>\n          </div>\n\n          <div className=\"card\">\n            <h3>Areas</h3>\n            <p style={{ color: 'var(--text-secondary)', fontSize: '0.9rem', marginBottom: '1rem' }}>\n              Weights must total 100%.\n            </p>\n\n            {editData.areas.map((area, index) => (\n              <div key={index} className=\"area-row\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Area name\"\n                  value={area.name}\n                  onChange={(e) => handleAreaEditChange(index, 'name', e.target.value)}\n                />\n                <input\n                  type=\"number\"\n                  placeholder=\"%\"\n                  value={area.weight}\n                  onChange={(e) => handleAreaEditChange(index, 'weight', e.target.value)}\n                />\n                <button className=\"remove-btn\" onClick={() => handleRemoveArea(index)}>\n                  \n                </button>\n              </div>\n            ))}\n\n            <div className=\"weight-total\">\n              <span className=\"weight-total-label\">Total Weight:</span>\n              <span className={`weight-total-value ${totalWeight === 100 ? 'valid' : 'invalid'}`}>\n                {totalWeight}%\n              </span>\n            </div>\n\n            <button className=\"btn btn-secondary\" onClick={handleAddArea}>\n              + Add Area\n            </button>\n          </div>\n\n          <div style={{ display: 'flex', gap: '1rem', marginBottom: '1rem' }}>\n            <button \n              className=\"btn btn-primary\" \n              onClick={handleSaveEdit}\n              disabled={saving}\n              style={{ flex: 1 }}\n            >\n              {saving ? 'Saving...' : 'Save Changes'}\n            </button>\n          </div>\n\n          <button \n            className=\"btn btn-danger btn-full\" \n            onClick={handleDeleteProject}\n          >\n            Delete Project\n          </button>\n        </div>\n      )\n    }\n\n    // View Mode - Calculate additional metrics for context\n    const areasComplete = areas.filter(a => a.status === 'done').length\n    const areasWorking = areas.filter(a => a.status === 'working').length\n    const areasNotStarted = areas.filter(a => a.status === 'not_started').length\n    const percentBilled = revisedContractValue > 0\n      ? Math.round((billable / revisedContractValue) * 100)\n      : 0\n    const hasChangeOrders = changeOrderValue > 0\n\n    // Tab definitions with pending badges\n    const pendingCount = (projectData?.pendingTickets || 0) + (projectData?.changeOrderPending || 0)\n    const tabs = [\n      { id: 'overview', label: 'Overview', Icon: LayoutGrid },\n      { id: 'financials', label: 'Financials', Icon: DollarSign, badge: pendingCount },\n      { id: 'reports', label: 'Reports', Icon: ClipboardList },\n      { id: 'documents', label: 'Documents', Icon: FolderOpen },\n      { id: 'info', label: 'Info', Icon: Info }\n    ]\n\n    return (\n      <div className=\"project-view tabbed\">\n        {/* Sticky Header */}\n        <div className=\"pv-sticky-header\">\n          {/* Top Row - Back + Actions */}\n          <div className=\"pv-header-row\">\n            <button className=\"pv-back\" onClick={handleBack}>\n              <span></span>\n              <span>Back</span>\n            </button>\n            <div className=\"pv-actions\">\n              <button className=\"pv-action\" onClick={() => setShowShareModal(true)}>Share</button>\n              <button className=\"pv-action\" onClick={() => setShowNotificationSettings(true)}>Alerts</button>\n              <button className=\"pv-action\" onClick={handleEditClick}>Edit</button>\n            </div>\n          </div>\n\n          {/* Project Title */}\n          <div className=\"pv-header-title\">\n            <h1>{selectedProject.name}</h1>\n            {(selectedProject.job_number || selectedProject.work_type) && (\n              <span className=\"pv-header-meta\">\n                {selectedProject.job_number && `Job #${selectedProject.job_number}`}\n                {selectedProject.job_number && selectedProject.work_type && '  '}\n                {selectedProject.work_type}\n              </span>\n            )}\n          </div>\n\n          {/* Key Metrics Bar */}\n          <div className=\"pv-metrics-bar\">\n            <div className=\"pv-metric\">\n              <span className=\"pv-metric-value\">{progress}%</span>\n              <span className=\"pv-metric-label\">Complete</span>\n            </div>\n            <div className=\"pv-metric-divider\"></div>\n            <div className=\"pv-metric\">\n              <span className=\"pv-metric-value\">{formatCurrency(billable)}</span>\n              <span className=\"pv-metric-label\">Billed</span>\n            </div>\n            <div className=\"pv-metric-divider\"></div>\n            <div className=\"pv-metric\">\n              <span className=\"pv-metric-value highlight\">{formatCurrency(revisedContractValue - billable)}</span>\n              <span className=\"pv-metric-label\">Remaining</span>\n            </div>\n          </div>\n\n          {/* Tab Navigation */}\n          <div className=\"pv-tabs\">\n            {tabs.map(tab => (\n              <button\n                key={tab.id}\n                className={`pv-tab ${activeProjectTab === tab.id ? 'active' : ''} ${tab.badge > 0 ? 'has-badge' : ''}`}\n                onClick={() => setActiveProjectTab(tab.id)}\n              >\n                <tab.Icon size={16} className=\"pv-tab-icon\" />\n                <span className=\"pv-tab-label\">{tab.label}</span>\n                {tab.badge > 0 && (\n                  <span className=\"pv-tab-badge\">{tab.badge}</span>\n                )}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Tab Content */}\n        <div className=\"pv-tab-content\">\n          {/* OVERVIEW TAB */}\n          {activeProjectTab === 'overview' && (\n            <div className=\"pv-tab-panel overview-tab animate-fade-in\">\n              {/* Row 1: Hero - Progress + Financials */}\n              <div className=\"overview-hero-split\">\n                <OverviewProgressGauge\n                  progress={progress}\n                  areasComplete={areasComplete}\n                  totalAreas={areas.length}\n                  areasWorking={areasWorking}\n                />\n                <OverviewFinancialCard\n                  earnedRevenue={billable}\n                  totalCosts={projectData?.allCostsTotal || 0}\n                  laborCost={projectData?.laborCost || 0}\n                  disposalCost={projectData?.haulOffCost || 0}\n                  equipmentCost={projectData?.materialsEquipmentCost || 0}\n                  materialsCost={0}\n                  otherCost={projectData?.customCostTotal || 0}\n                  contractValue={revisedContractValue}\n                />\n              </div>\n\n              {/* Row 2: Two-column grid - Crew Metrics | Work Areas */}\n              <div className=\"overview-two-col\">\n                {/* Left: Crew On-Site */}\n                <OverviewCrewMetrics\n                  project={selectedProject}\n                  onShowToast={onShowToast}\n                />\n\n                {/* Right: Work Areas */}\n                <div className=\"overview-section-card overview-work-areas-card\">\n                  <div className=\"section-card-header\">\n                    <h3>Work Areas</h3>\n                    <div className=\"section-card-badges\">\n                      {areasComplete > 0 && <span className=\"section-badge done\">{areasComplete} Done</span>}\n                      {areasWorking > 0 && <span className=\"section-badge working\">{areasWorking} Active</span>}\n                      {areasNotStarted > 0 && <span className=\"section-badge pending\">{areasNotStarted} Pending</span>}\n                    </div>\n                  </div>\n                  <div className=\"work-areas-list work-areas-scroll stagger-areas\">\n                    {areas.map(area => (\n                      <div key={area.id} className={`work-area-item ${area.status}`}>\n                        <div className=\"work-area-status\">\n                          {area.status === 'done' && <span className=\"status-icon done\"></span>}\n                          {area.status === 'working' && <span className=\"status-icon working\"></span>}\n                          {area.status === 'not_started' && <span className=\"status-icon pending\"></span>}\n                        </div>\n                        <div className=\"work-area-info\">\n                          <span className=\"work-area-name\">{area.name}</span>\n                          <span className=\"work-area-weight\">\n                            {area.scheduled_value ? formatCurrency(area.scheduled_value) : `${area.weight}%`}\n                          </span>\n                        </div>\n                        <div className=\"work-area-bar\">\n                          <div\n                            className={`work-area-fill ${area.status}`}\n                            style={{ width: area.status === 'done' ? '100%' : area.status === 'working' ? '50%' : '0%' }}\n                          ></div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n\n              {/* Row 3: Earned Value Analysis */}\n              {selectedProject?.contract_value > 0 && (\n                <EarnedValueCard\n                  contractValue={selectedProject.contract_value}\n                  changeOrderValue={changeOrderValue}\n                  progressPercent={progress}\n                  actualCosts={projectData?.allCostsTotal || 0}\n                  startDate={selectedProject.start_date}\n                  endDate={selectedProject.end_date}\n                  areas={areas}\n                />\n              )}\n\n              {/* Row 4: Needs Attention (only shown when there are items) */}\n              {(projectData?.pendingTickets > 0 || projectData?.changeOrderPending > 0 || projectData?.pendingMaterialRequests > 0 || projectData?.urgentMaterialRequests > 0) && (\n                <div className=\"overview-needs-attention\">\n                  <div className=\"overview-needs-attention__header\">\n                    <AlertTriangle size={15} className=\"overview-needs-attention__icon\" />\n                    <span className=\"overview-needs-attention__title\">Needs Attention</span>\n                    <span className=\"overview-needs-attention__count\">\n                      {[projectData?.urgentMaterialRequests > 0, !projectData?.urgentMaterialRequests && projectData?.pendingMaterialRequests > 0, projectData?.pendingTickets > 0, projectData?.changeOrderPending > 0].filter(Boolean).length}\n                    </span>\n                  </div>\n                  <div className=\"overview-needs-attention__items\">\n                    {projectData?.urgentMaterialRequests > 0 && (\n                      <button className=\"overview-needs-attention__item overview-needs-attention__item--warning\" onClick={() => setActiveProjectTab('reports')}>\n                        <AlertTriangle size={14} className=\"overview-needs-attention__item-icon\" />\n                        <span className=\"overview-needs-attention__item-label\">{projectData.urgentMaterialRequests} urgent material request{projectData.urgentMaterialRequests !== 1 ? 's' : ''}</span>\n                        <ArrowRight size={13} className=\"overview-needs-attention__item-arrow\" />\n                      </button>\n                    )}\n                    {projectData?.pendingMaterialRequests > 0 && !projectData?.urgentMaterialRequests && (\n                      <button className=\"overview-needs-attention__item overview-needs-attention__item--info\" onClick={() => setActiveProjectTab('reports')}>\n                        <Package size={14} className=\"overview-needs-attention__item-icon\" />\n                        <span className=\"overview-needs-attention__item-label\">{projectData.pendingMaterialRequests} material request{projectData.pendingMaterialRequests !== 1 ? 's' : ''} pending</span>\n                        <ArrowRight size={13} className=\"overview-needs-attention__item-arrow\" />\n                      </button>\n                    )}\n                    {projectData?.pendingTickets > 0 && (\n                      <button className=\"overview-needs-attention__item overview-needs-attention__item--warning\" onClick={() => setActiveProjectTab('financials')}>\n                        <ClipboardList size={14} className=\"overview-needs-attention__item-icon\" />\n                        <span className=\"overview-needs-attention__item-label\">{projectData.pendingTickets} T&M ticket{projectData.pendingTickets !== 1 ? 's' : ''} need approval</span>\n                        <ArrowRight size={13} className=\"overview-needs-attention__item-arrow\" />\n                      </button>\n                    )}\n                    {projectData?.changeOrderPending > 0 && (\n                      <button className=\"overview-needs-attention__item overview-needs-attention__item--info\" onClick={() => setActiveProjectTab('financials')}>\n                        <FileText size={14} className=\"overview-needs-attention__item-icon\" />\n                        <span className=\"overview-needs-attention__item-label\">{projectData.changeOrderPending} change order{projectData.changeOrderPending !== 1 ? 's' : ''} pending</span>\n                        <ArrowRight size={13} className=\"overview-needs-attention__item-arrow\" />\n                      </button>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* Row 5: Photo Timeline + Punch List */}\n              <div className=\"overview-two-col\">\n                <Suspense fallback={<div style={{ padding: '20px', textAlign: 'center', color: 'var(--text-secondary)' }}>Loading photos...</div>}>\n                  <PhotoTimeline\n                    projectId={selectedProject?.id}\n                    areas={areas}\n                    onShowToast={onShowToast}\n                  />\n                </Suspense>\n                <Suspense fallback={<div style={{ padding: '20px', textAlign: 'center', color: 'var(--text-secondary)' }}>Loading punch list...</div>}>\n                  <PunchList\n                    projectId={selectedProject?.id}\n                    areas={areas}\n                    companyId={company?.id}\n                    onShowToast={onShowToast}\n                  />\n                </Suspense>\n              </div>\n\n              {/* Row 6: Quick Nav + Exports */}\n              <div className=\"overview-bottom-strip\">\n                <div className=\"overview-quick-actions\">\n                  <button className=\"overview-action-btn\" onClick={() => setActiveProjectTab('reports')}>\n                    <ClipboardList size={15} />\n                    <span>{projectData?.dailyReportsCount || 0} Reports</span>\n                  </button>\n                  <button className=\"overview-action-btn\" onClick={() => setActiveProjectTab('financials')}>\n                    <DollarSign size={15} />\n                    <span>{projectData?.totalTickets || 0} T&M Tickets</span>\n                  </button>\n                  <span className=\"overview-action-divider\" />\n                  <button className=\"overview-action-btn export\" onClick={() => handleExportFieldDocuments('all')}>\n                    <Download size={15} />\n                    <span>Export All</span>\n                  </button>\n                  <button className=\"overview-action-btn export\" onClick={() => handleExportFieldDocuments('daily')}>\n                    <Download size={14} />\n                    <span>Daily</span>\n                  </button>\n                  <button className=\"overview-action-btn export\" onClick={() => handleExportFieldDocuments('incidents')}>\n                    <Download size={14} />\n                    <span>Incidents</span>\n                  </button>\n                  <button className=\"overview-action-btn export\" onClick={() => handleExportFieldDocuments('crew')}>\n                    <Download size={14} />\n                    <span>Crew</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* FINANCIALS TAB */}\n          {activeProjectTab === 'financials' && (\n            <div className=\"pv-tab-panel financials-tab\">\n              {/* Export Actions */}\n              <div className=\"export-actions\" style={{ display: 'flex', gap: '8px', marginLeft: 'auto', marginBottom: '12px', justifyContent: 'flex-end' }}>\n                <button\n                  className=\"btn btn-ghost btn-small\"\n                  onClick={() => exportProjectFinancials(selectedProject, {\n                    earnedRevenue: billable,\n                    approvedCORs: projectData?.cors?.filter(c => c.status === 'approved'),\n                    laborByDate: projectData?.laborByDate,\n                    haulOffByDate: projectData?.haulOffByDate,\n                    customCosts: projectData?.customCosts\n                  })}\n                >\n                  <Download size={14} /> Export CSV\n                </button>\n                <button\n                  className=\"btn btn-ghost btn-small\"\n                  onClick={() => exportToQuickBooksIIF(selectedProject, {\n                    totalLaborCost: projectData?.totalLaborCost || 0,\n                    totalDisposalCost: projectData?.totalDisposalCost || 0\n                  })}\n                >\n                  <Download size={14} /> QuickBooks\n                </button>\n              </div>\n              {/* Key Metrics - Hero Section (Always visible) */}\n              <HeroMetrics\n                contractValue={selectedProject?.contract_value || 0}\n                earnedRevenue={billable}\n                totalCosts={projectData?.allCostsTotal || 0}\n                profit={projectData?.currentProfit || 0}\n                progress={progress}\n                corApprovedValue={changeOrderValue}\n                loading={!projectData}\n              />\n\n              {/* Split Layout with Collapsible Navigation */}\n              <div className={`financials-layout ${financialsSidebarCollapsed ? 'sidebar-collapsed' : ''}`}>\n                {/* Mobile Menu Toggle Button */}\n                <button\n                  className=\"financials-mobile-menu-toggle\"\n                  onClick={handleToggleMobileSidebar}\n                  aria-label=\"Open navigation menu\"\n                  title=\"Open navigation menu\"\n                >\n                  <Menu size={20} />\n                  <span>Menu</span>\n                </button>\n\n                {/* Mobile Overlay/Backdrop */}\n                {financialsSidebarMobileOpen && (\n                  <div\n                    className=\"financials-sidebar-overlay\"\n                    onClick={handleCloseMobileSidebar}\n                    aria-hidden=\"true\"\n                  />\n                )}\n\n                {/* Sidebar Navigation - Always visible, collapsible */}\n                <div className={`financials-sidebar ${financialsSidebarCollapsed ? 'collapsed' : ''} ${financialsSidebarMobileOpen ? 'mobile-open' : ''}`}>\n                  <FinancialsNav\n                    activeSection={financialsSection}\n                    onSectionChange={(section) => {\n                      setFinancialsSection(section)\n                      setFinancialsSidebarMobileOpen(false) // Close mobile sidebar when section changes\n                    }}\n                    collapsed={financialsSidebarCollapsed}\n                    onToggleCollapse={handleToggleFinancialsSidebar}\n                    onMobileClose={handleCloseMobileSidebar}\n                    stats={financialsNavStats}\n                  />\n                </div>\n\n                {/* Main Content Area */}\n                <div className=\"financials-main\">\n                  {/* OVERVIEW SECTION */}\n                  {financialsSection === 'overview' && (\n                    <div className=\"financials-overview animate-fade-in\">\n                      {/* Financial Trend Chart */}\n                      <FinancialTrendChart\n                        projectData={projectData}\n                        project={selectedProject}\n                        tmTickets={projectData?.tmTickets || []}\n                        corStats={projectData?.corStats}\n                        areas={areas}\n                      />\n\n                      {/* Burn Rate & Profitability Row */}\n                      <div className=\"financials-analysis-row stagger-children\">\n                        <BurnRateCard\n                          dailyBurn={projectData?.dailyBurn || 0}\n                          totalBurn={projectData?.totalBurn || 0}\n                          daysWorked={projectData?.totalBurnDays || 0}\n                          laborCost={projectData?.laborCost || 0}\n                          materialsEquipmentCost={projectData?.materialsEquipmentCost || 0}\n                          progress={progress}\n                          contractValue={revisedContractValue}\n                          laborByDate={projectData?.laborByDate || []}\n                          materialsEquipmentByDate={projectData?.materialsEquipmentByDate || []}\n                        />\n\n                        <ProfitabilityCard\n                          revenue={billable}\n                          totalCosts={projectData?.allCostsTotal || 0}\n                          contractValue={revisedContractValue}\n                          progress={progress}\n                        />\n                      </div>\n\n                      {/* Cost Contributors & Disposal Summary Side-by-Side */}\n                      <div className=\"cost-disposal-row\">\n                        <CostContributorsCard\n                          laborCost={projectData?.laborCost || 0}\n                          haulOffCost={projectData?.haulOffCost || 0}\n                          customCosts={projectData?.customCosts || []}\n                          onAddCost={handleAddCost}\n                          onDeleteCost={handleDeleteCost}\n                        />\n\n                        <DisposalSummary\n                          project={selectedProject}\n                          period=\"week\"\n                        />\n                      </div>\n\n                      {/* Equipment Tracking */}\n                      <ProjectEquipmentCard\n                        key={equipmentRefreshKey}\n                        project={selectedProject}\n                        onAddEquipment={handleAddEquipment}\n                        onEditEquipment={handleEditEquipment}\n                        onShowToast={onShowToast}\n                      />\n\n                      {/* Progress Billing / Draw Requests */}\n                      <ProgressBillingCard\n                        key={drawRequestRefreshKey}\n                        project={selectedProject}\n                        areas={areas}\n                        corStats={projectData?.corStats}\n                        onCreateDraw={handleCreateDraw}\n                        onViewDraw={handleViewDraw}\n                        onShowToast={onShowToast}\n                      />\n\n                      {/* Labor Details - Collapsible */}\n                      <details className=\"financials-details\">\n                        <summary className=\"financials-details-summary\">\n                          <HardHat size={16} />\n                          <span>Labor Details</span>\n                          <span className=\"financials-details-value\">{formatCurrency(projectData?.laborCost || 0)}</span>\n                        </summary>\n                        <div className=\"financials-details-content\">\n                          <ManDayCosts project={selectedProject} company={company} onShowToast={onShowToast} />\n                        </div>\n                      </details>\n                    </div>\n                  )}\n\n                  {/* CHANGE ORDERS SECTION */}\n                  {financialsSection === 'cors' && (\n                    <div className=\"financials-cors animate-fade-in\">\n                      {/* COR Log - Always visible first */}\n                      <div className=\"financials-section cor-section-primary\">\n                        <Suspense fallback={<TicketSkeleton />}>\n                          <CORLogPreview\n                            project={selectedProject}\n                            onShowToast={onShowToast}\n                            onToggleList={handleToggleCORList}\n                            showingList={corListExpanded}\n                            onViewFullLog={handleViewFullCORLog}\n                            onCreateCOR={handleCreateCOR}\n                          />\n                        </Suspense>\n                      </div>\n\n                      {/* Full COR Card List - Expands below the log when toggled */}\n                      {corListExpanded && (\n                        <div className=\"financials-section cor-section-list animate-fade-in\" style={{ marginTop: '1rem' }}>\n                          <Suspense fallback={<TicketSkeleton />}>\n                            <CORList\n                              project={selectedProject}\n                              company={company}\n                              areas={areas}\n                              refreshKey={corRefreshKey}\n                              onShowToast={onShowToast}\n                              previewMode={false}\n                              onViewAll={handleToggleCORList}\n                              onDisplayModeChange={setCORDisplayMode}\n                              onCreateCOR={handleCreateCOR}\n                              onViewCOR={handleViewCOR}\n                              onEditCOR={handleEditCOR}\n                            />\n                          </Suspense>\n                        </div>\n                      )}\n                    </div>\n                  )}\n\n                  {/* T&M TICKETS SECTION */}\n                  {financialsSection === 'tickets' && (\n                    <div className=\"financials-tickets animate-fade-in\">\n                      <div className=\"financials-section tm-section\">\n                        {tmViewMode === 'full' && (\n                          <button\n                            className=\"section-back-btn\"\n                            onClick={handleBackToTMPreview}\n                          >\n                             Back to summary\n                          </button>\n                        )}\n                        <Suspense fallback={<TicketSkeleton />}>\n                          <TMList\n                            project={selectedProject}\n                            company={company}\n                            onShowToast={onShowToast}\n                            compact={tmViewMode === 'preview'}\n                            previewMode={tmViewMode === 'preview'}\n                            onViewAll={handleViewAllTickets}\n                          />\n                        </Suspense>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* BILLING SECTION */}\n                  {financialsSection === 'billing' && (\n                    <div className=\"financials-billing animate-fade-in\">\n                      <Suspense fallback={<TicketSkeleton />}>\n                        <BillingCenter\n                          project={selectedProject}\n                          company={company}\n                          user={user}\n                          onShowToast={onShowToast}\n                        />\n                      </Suspense>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* REPORTS TAB */}\n          {activeProjectTab === 'reports' && (\n            <div className=\"pv-tab-panel reports-tab\">\n              {/* Hero Metrics - High Level Project Pulse */}\n              <div className=\"reports-hero\">\n                <div className=\"reports-hero-grid\">\n                  {/* Total Reports */}\n                  <div className=\"reports-metric primary\">\n                    <div className=\"reports-metric-icon\">\n                      <ClipboardList size={24} />\n                    </div>\n                    <div className=\"reports-metric-content\">\n                      <div className=\"reports-metric-value\">{projectData?.dailyReportsCount || 0}</div>\n                      <div className=\"reports-metric-label\">Daily Reports</div>\n                    </div>\n                  </div>\n\n                  {/* This Week */}\n                  <div className=\"reports-metric\">\n                    <div className=\"reports-metric-value\">{projectData?.recentDailyReports || 0}</div>\n                    <div className=\"reports-metric-label\">This Week</div>\n                    <div className=\"reports-metric-bar\">\n                      <div\n                        className=\"reports-metric-fill\"\n                        style={{ width: `${Math.min((projectData?.recentDailyReports || 0) / 7 * 100, 100)}%` }}\n                      ></div>\n                    </div>\n                  </div>\n\n                  {/* T&M Tickets */}\n                  <div className=\"reports-metric\">\n                    <div className=\"reports-metric-value\">{projectData?.totalTickets || 0}</div>\n                    <div className=\"reports-metric-label\">T&M Tickets</div>\n                    {(projectData?.pendingTickets || 0) > 0 && (\n                      <div className=\"reports-metric-status\" style={{ background: '#fef3c7', color: '#92400e' }}>\n                        {projectData.pendingTickets} pending\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Photo Evidence */}\n                  <div className=\"reports-metric\">\n                    <div className=\"reports-metric-value\">{projectData?.totalPhotosFromTickets || 0}</div>\n                    <div className=\"reports-metric-label\">Photos Captured</div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Two-Column Layout: Crew + Safety */}\n              <div className=\"reports-two-col\">\n                {/* Crew Analytics Card */}\n                <div className=\"reports-insight-card\">\n                  <div className=\"reports-insight-header\">\n                    <div className=\"reports-insight-title\">\n                      <Users size={18} />\n                      <h3>Crew Analytics</h3>\n                    </div>\n                  </div>\n                  <div className=\"reports-insight-body\">\n                    <div className=\"reports-stat-grid\">\n                      <div className=\"reports-stat\">\n                        <span className=\"reports-stat-value\">{projectData?.uniqueWorkerCount || 0}</span>\n                        <span className=\"reports-stat-label\">Total Workers</span>\n                      </div>\n                      <div className=\"reports-stat\">\n                        <span className=\"reports-stat-value\">{projectData?.avgCrewSize || 0}</span>\n                        <span className=\"reports-stat-label\">Avg Crew / Day</span>\n                      </div>\n                      <div className=\"reports-stat\">\n                        <span className=\"reports-stat-value\">{projectData?.peakCrewSize || 0}</span>\n                        <span className=\"reports-stat-label\">Peak Crew Size</span>\n                      </div>\n                      <div className=\"reports-stat\">\n                        <span className=\"reports-stat-value\">{projectData?.crewDaysTracked || 0}</span>\n                        <span className=\"reports-stat-label\">Days Tracked</span>\n                      </div>\n                    </div>\n                    {(projectData?.crewTrend || 0) !== 0 && (\n                      <div className={`reports-trend-badge ${projectData.crewTrend > 0 ? 'up' : 'down'}`}>\n                        {projectData.crewTrend > 0 ? <TrendingUp size={14} /> : <TrendingDown size={14} />}\n                        <span>{Math.abs(Math.round(projectData.crewTrend))}% {projectData.crewTrend > 0 ? 'increase' : 'decrease'} vs prior week</span>\n                      </div>\n                    )}\n                    {/* Mini crew size bar chart */}\n                    {projectData?.crewByDate && Object.keys(projectData.crewByDate).length > 0 && (\n                      <div className=\"reports-mini-chart\">\n                        <div className=\"reports-mini-chart-label\">Recent Crew Size</div>\n                        <div className=\"reports-mini-bars\">\n                          {Object.keys(projectData.crewByDate).sort().slice(-14).map(date => {\n                            const count = projectData.crewByDate[date]\n                            const max = projectData.peakCrewSize || 1\n                            return (\n                              <div key={date} className=\"reports-mini-bar-wrap\" title={`${new Date(date + 'T12:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}: ${count} workers`}>\n                                <div className=\"reports-mini-bar\" style={{ height: `${(count / max) * 100}%` }}></div>\n                              </div>\n                            )\n                          })}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Safety Dashboard Card */}\n                <div className=\"reports-insight-card\">\n                  <div className=\"reports-insight-header\">\n                    <div className=\"reports-insight-title\">\n                      <Shield size={18} />\n                      <h3>Safety Dashboard</h3>\n                    </div>\n                    <span className={`reports-section-badge ${(projectData?.injuryReportsCount || 0) > 0 ? 'warning' : 'success'}`}>\n                      {(projectData?.injuryReportsCount || 0) > 0\n                        ? `${projectData.injuryReportsCount} incident${projectData.injuryReportsCount !== 1 ? 's' : ''}`\n                        : 'No incidents'\n                      }\n                    </span>\n                  </div>\n                  <div className=\"reports-insight-body\">\n                    {/* Days Since Last Injury - prominent */}\n                    <div className=\"reports-safety-hero\">\n                      <div className={`reports-safety-days ${(projectData?.daysSinceLastInjury === null || projectData?.daysSinceLastInjury > 30) ? 'excellent' : projectData?.daysSinceLastInjury > 7 ? 'good' : 'caution'}`}>\n                        <span className=\"reports-safety-days-value\">\n                          {projectData?.daysSinceLastInjury !== null ? projectData.daysSinceLastInjury : '--'}\n                        </span>\n                        <span className=\"reports-safety-days-label\">\n                          {projectData?.daysSinceLastInjury !== null ? 'Days Since Last Incident' : 'No Incidents Recorded'}\n                        </span>\n                      </div>\n                    </div>\n                    <div className=\"reports-stat-grid\">\n                      <div className=\"reports-stat\">\n                        <span className=\"reports-stat-value\">{projectData?.injuryReportsCount || 0}</span>\n                        <span className=\"reports-stat-label\">Total Incidents</span>\n                      </div>\n                      <div className=\"reports-stat\">\n                        <span className=\"reports-stat-value\">{projectData?.oshaRecordable || 0}</span>\n                        <span className=\"reports-stat-label\">OSHA Recordable</span>\n                      </div>\n                      <div className=\"reports-stat\">\n                        <span className=\"reports-stat-value\">{projectData?.reportsWithIssues || 0}</span>\n                        <span className=\"reports-stat-label\">Reports w/ Issues</span>\n                      </div>\n                      <div className=\"reports-stat\">\n                        <span className=\"reports-stat-value\">{projectData?.laborManDays || 0}</span>\n                        <span className=\"reports-stat-label\">Total Man-Days</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Material Requests + Disposal Summary Row */}\n              <div className=\"reports-two-col\">\n                {/* Material Requests */}\n                <div className=\"reports-insight-card\">\n                  <div className=\"reports-insight-header\">\n                    <div className=\"reports-insight-title\">\n                      <Package size={18} />\n                      <h3>Material Requests</h3>\n                    </div>\n                    <span className=\"reports-section-count\">{projectData?.totalMaterialRequests || 0} total</span>\n                  </div>\n                  <div className=\"reports-insight-body\">\n                    {(projectData?.totalMaterialRequests || 0) === 0 ? (\n                      <div className=\"reports-empty-state\">\n                        <Package size={32} />\n                        <p>No material requests yet</p>\n                        <span>Requests from the field will appear here</span>\n                      </div>\n                    ) : (\n                      <>\n                        <div className=\"reports-material-pipeline\">\n                          {projectData?.urgentMaterialRequests > 0 && (\n                            <div className=\"reports-material-status urgent\">\n                              <AlertTriangle size={14} />\n                              <span>{projectData.urgentMaterialRequests} Urgent</span>\n                            </div>\n                          )}\n                          <div className=\"reports-material-status pending\">\n                            <span className=\"reports-material-dot\"></span>\n                            <span>{projectData?.pendingMaterialRequests || 0} Pending</span>\n                          </div>\n                          <div className=\"reports-material-status ordered\">\n                            <span className=\"reports-material-dot\"></span>\n                            <span>{projectData?.orderedMaterialRequests || 0} Ordered</span>\n                          </div>\n                          <div className=\"reports-material-status delivered\">\n                            <CheckCircle2 size={14} />\n                            <span>{projectData?.deliveredMaterialRequests || 0} Delivered</span>\n                          </div>\n                        </div>\n                        {/* Recent requests */}\n                        <div className=\"reports-recent-list\">\n                          {(projectData?.materialRequests || []).slice(0, 3).map(req => (\n                            <div key={req.id} className={`reports-recent-item ${req.status}`}>\n                              <div className=\"reports-recent-item-main\">\n                                <span className={`reports-recent-item-status ${req.status}`}>{req.status}</span>\n                                <span className=\"reports-recent-item-date\">\n                                  {new Date(req.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\n                                </span>\n                              </div>\n                              <div className=\"reports-recent-item-detail\">\n                                {(req.items || []).slice(0, 2).map((item, i) => (\n                                  <span key={i}>{item.name}{item.quantity ? ` (${item.quantity})` : ''}</span>\n                                ))}\n                                {(req.items || []).length > 2 && (\n                                  <span className=\"reports-recent-more\">+{(req.items || []).length - 2} more</span>\n                                )}\n                              </div>\n                              {req.priority === 'urgent' && (\n                                <span className=\"reports-urgent-tag\">URGENT</span>\n                              )}\n                            </div>\n                          ))}\n                        </div>\n                      </>\n                    )}\n                  </div>\n                </div>\n\n                {/* Disposal Trends */}\n                <div className=\"reports-insight-card\">\n                  <div className=\"reports-insight-header\">\n                    <div className=\"reports-insight-title\">\n                      <Truck size={18} />\n                      <h3>Disposal Trends</h3>\n                    </div>\n                    <span className=\"reports-section-count\">{projectData?.disposalTotalLoads || 0} loads</span>\n                  </div>\n                  <div className=\"reports-insight-body\">\n                    {(projectData?.weeklyDisposal || []).length === 0 ? (\n                      <div className=\"reports-empty-state\">\n                        <Truck size={32} />\n                        <p>No disposal data yet</p>\n                        <span>Disposal loads from the field will appear here</span>\n                      </div>\n                    ) : (\n                      <>\n                        {/* Stacked weekly bar chart */}\n                        <div className=\"reports-disposal-chart\">\n                          <div className=\"reports-disposal-bars\">\n                            {(projectData?.weeklyDisposal || []).map((week, i) => {\n                              const total = (week.concrete || 0) + (week.trash || 0) + (week.metals || 0) + (week.hazardous_waste || 0)\n                              const maxWeek = Math.max(...(projectData?.weeklyDisposal || []).map(w => (w.concrete || 0) + (w.trash || 0) + (w.metals || 0) + (w.hazardous_waste || 0))) || 1\n                              return (\n                                <div key={i} className=\"reports-disposal-bar-col\">\n                                  <div className=\"reports-disposal-bar-stack\" style={{ height: `${(total / maxWeek) * 100}%` }}>\n                                    {week.concrete > 0 && <div className=\"reports-disposal-seg concrete\" style={{ flex: week.concrete }} title={`Concrete: ${week.concrete}`}></div>}\n                                    {week.trash > 0 && <div className=\"reports-disposal-seg trash\" style={{ flex: week.trash }} title={`Trash: ${week.trash}`}></div>}\n                                    {week.metals > 0 && <div className=\"reports-disposal-seg metals\" style={{ flex: week.metals }} title={`Metals: ${week.metals}`}></div>}\n                                    {week.hazardous_waste > 0 && <div className=\"reports-disposal-seg hazardous\" style={{ flex: week.hazardous_waste }} title={`Hazardous: ${week.hazardous_waste}`}></div>}\n                                  </div>\n                                  <span className=\"reports-disposal-bar-label\">\n                                    {new Date(week.week + 'T12:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\n                                  </span>\n                                </div>\n                              )\n                            })}\n                          </div>\n                          <div className=\"reports-disposal-legend\">\n                            <span className=\"reports-disposal-legend-item\"><span className=\"reports-disposal-dot concrete\"></span>Concrete</span>\n                            <span className=\"reports-disposal-legend-item\"><span className=\"reports-disposal-dot trash\"></span>Trash</span>\n                            <span className=\"reports-disposal-legend-item\"><span className=\"reports-disposal-dot metals\"></span>Metals</span>\n                            <span className=\"reports-disposal-legend-item\"><span className=\"reports-disposal-dot hazardous\"></span>Hazardous</span>\n                          </div>\n                        </div>\n                        {/* Haul-off cost summary */}\n                        {(projectData?.haulOffCost || 0) > 0 && (\n                          <div className=\"reports-disposal-cost\">\n                            <span>Total Disposal Cost</span>\n                            <strong>{formatCurrency(projectData.haulOffCost)}</strong>\n                          </div>\n                        )}\n                      </>\n                    )}\n                  </div>\n                </div>\n              </div>\n\n              {/* Field Activity Summary */}\n              <div className=\"reports-insight-card reports-activity-summary\">\n                <div className=\"reports-insight-header\">\n                  <div className=\"reports-insight-title\">\n                    <ClipboardList size={18} />\n                    <h3>Field Activity Summary</h3>\n                  </div>\n                  <div className=\"reports-activity-badges\">\n                    {projectData?.lastDailyReport && (\n                      <span className=\"reports-last-filed\">\n                        Last report: {new Date(projectData.lastDailyReport).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\n                        {' '}({Math.floor((new Date() - new Date(projectData.lastDailyReport)) / (1000 * 60 * 60 * 24))}d ago)\n                      </span>\n                    )}\n                  </div>\n                </div>\n                <div className=\"reports-insight-body\">\n                  <div className=\"reports-activity-grid\">\n                    <div className=\"reports-activity-stat\">\n                      <div className=\"reports-activity-stat-icon\"><ClipboardList size={16} /></div>\n                      <div className=\"reports-activity-stat-info\">\n                        <strong>{projectData?.dailyReportsCount || 0}</strong>\n                        <span>Daily Reports Filed</span>\n                      </div>\n                    </div>\n                    <div className=\"reports-activity-stat\">\n                      <div className=\"reports-activity-stat-icon\"><FileText size={16} /></div>\n                      <div className=\"reports-activity-stat-info\">\n                        <strong>{projectData?.totalTickets || 0}</strong>\n                        <span>T&M Tickets Created</span>\n                      </div>\n                    </div>\n                    <div className=\"reports-activity-stat\">\n                      <div className=\"reports-activity-stat-icon\"><Camera size={16} /></div>\n                      <div className=\"reports-activity-stat-info\">\n                        <strong>{projectData?.totalPhotosFromTickets || 0}</strong>\n                        <span>Photos Documented</span>\n                      </div>\n                    </div>\n                    <div className=\"reports-activity-stat\">\n                      <div className=\"reports-activity-stat-icon\"><HardHat size={16} /></div>\n                      <div className=\"reports-activity-stat-info\">\n                        <strong>{projectData?.completedAreasCount || 0}/{areas.length}</strong>\n                        <span>Work Areas Complete</span>\n                      </div>\n                    </div>\n                    <div className=\"reports-activity-stat\">\n                      <div className=\"reports-activity-stat-icon\"><DollarSign size={16} /></div>\n                      <div className=\"reports-activity-stat-info\">\n                        <strong>{formatCurrency(projectData?.allCostsTotal || 0)}</strong>\n                        <span>Total Costs Tracked</span>\n                      </div>\n                    </div>\n                    <div className=\"reports-activity-stat\">\n                      <div className=\"reports-activity-stat-icon\"><Users size={16} /></div>\n                      <div className=\"reports-activity-stat-info\">\n                        <strong>{projectData?.laborManDays || 0}</strong>\n                        <span>Total Man-Days</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Daily Reports Section */}\n              <div className=\"reports-section-card\">\n                <div className=\"reports-section-header\">\n                  <div className=\"reports-section-title\">\n                    <ClipboardList size={18} />\n                    <h3>Daily Reports</h3>\n                  </div>\n                  <span className=\"reports-section-count\">{projectData?.dailyReportsCount || 0} total</span>\n                </div>\n                <div className=\"reports-section-content\">\n                  <Suspense fallback={<TicketSkeleton />}>\n                    <DailyReportsList project={selectedProject} company={company} onShowToast={onShowToast} />\n                  </Suspense>\n                </div>\n              </div>\n\n              {/* Injury Reports Section */}\n              <div className={`reports-section-card ${(projectData?.injuryReportsCount || 0) > 0 ? 'has-warning' : ''}`}>\n                <div className=\"reports-section-header\">\n                  <div className=\"reports-section-title\">\n                    <span className={`reports-section-icon ${(projectData?.injuryReportsCount || 0) > 0 ? 'warning' : 'success'}`}>\n                      {(projectData?.injuryReportsCount || 0) > 0 ? '' : ''}\n                    </span>\n                    <h3>Safety & Injury Reports</h3>\n                  </div>\n                  <span className={`reports-section-badge ${(projectData?.injuryReportsCount || 0) > 0 ? 'warning' : 'success'}`}>\n                    {(projectData?.injuryReportsCount || 0) > 0\n                      ? `${projectData.injuryReportsCount} incident${projectData.injuryReportsCount !== 1 ? 's' : ''}`\n                      : 'No incidents'\n                    }\n                  </span>\n                </div>\n                <div className=\"reports-section-content\">\n                  <Suspense fallback={<TicketSkeleton />}>\n                    <InjuryReportsList\n                      project={selectedProject}\n                      companyId={company?.id || selectedProject?.company_id}\n                      company={company}\n                      user={user}\n                      onShowToast={onShowToast}\n                    />\n                  </Suspense>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* DOCUMENTS TAB */}\n          {activeProjectTab === 'documents' && (\n            <div className=\"pv-tab-panel documents-tab\">\n              <Suspense fallback={<TicketSkeleton />}>\n                <DocumentsTab\n                  project={selectedProject}\n                  companyId={company?.id || selectedProject?.company_id}\n                  onShowToast={onShowToast}\n                  userRole={user?.access_level || 'office'}\n                />\n              </Suspense>\n            </div>\n          )}\n\n          {/* INFO TAB */}\n          {activeProjectTab === 'info' && (\n            <div className=\"pv-tab-panel info-tab\">\n              {/* Hero Header */}\n              <div className=\"info-hero\">\n                <div className=\"info-hero-content\">\n                  <div className=\"info-hero-main\">\n                    <h2 className=\"info-hero-title\">{selectedProject.name}</h2>\n                    {selectedProject.job_number && (\n                      <span className=\"info-hero-job\">Job #{selectedProject.job_number}</span>\n                    )}\n                  </div>\n                  <button className=\"btn btn-primary btn-with-icon\" onClick={handleEditClick}>\n                    <span>Edit Project</span>\n                  </button>\n                </div>\n                {selectedProject.address && (\n                  <div className=\"info-hero-address\">\n                    <MapPin size={14} />\n                    <span>{selectedProject.address}</span>\n                  </div>\n                )}\n              </div>\n\n              {/* Quick Info Cards */}\n              <div className=\"info-quick-grid\">\n                {/* Work Type */}\n                <div className=\"info-quick-card\">\n                  <div className=\"info-quick-icon\">\n                    <HardHat size={20} />\n                  </div>\n                  <div className=\"info-quick-content\">\n                    <span className=\"info-quick-value\">\n                      {selectedProject.work_type === 'environmental' ? 'Environmental' : 'Demolition'}\n                    </span>\n                    <span className=\"info-quick-label\">Work Type</span>\n                  </div>\n                </div>\n\n                {/* Job Type */}\n                <div className=\"info-quick-card\">\n                  <div className=\"info-quick-icon\">\n                    <FileText size={20} />\n                  </div>\n                  <div className=\"info-quick-content\">\n                    <span className=\"info-quick-value\">\n                      {selectedProject.job_type === 'prevailing_wage' ? 'Prevailing Wage' : 'Standard'}\n                    </span>\n                    <span className=\"info-quick-label\">Job Type</span>\n                  </div>\n                </div>\n\n                {/* Contract Value */}\n                <div className=\"info-quick-card highlight\">\n                  <div className=\"info-quick-icon\">\n                    <DollarSign size={20} />\n                  </div>\n                  <div className=\"info-quick-content\">\n                    <span className=\"info-quick-value\">{formatCurrency(revisedContractValue)}</span>\n                    <span className=\"info-quick-label\">\n                      {changeOrderValue > 0 ? `Incl. +${formatCurrency(changeOrderValue)} COs` : 'Contract Value'}\n                    </span>\n                  </div>\n                </div>\n\n                {/* Foreman PIN */}\n                {selectedProject.pin && (\n                  <div className=\"info-quick-card\">\n                    <div className=\"info-quick-icon\">\n                      <span className=\"info-pin-icon\">#</span>\n                    </div>\n                    <div className=\"info-quick-content\">\n                      <span className=\"info-quick-value mono\">{selectedProject.pin}</span>\n                      <span className=\"info-quick-label\">Foreman PIN</span>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Client & Contractor Card */}\n              <div className=\"info-section-card\">\n                <div className=\"info-section-header\">\n                  <Building2 size={18} />\n                  <h3>Client & Contractor</h3>\n                </div>\n                <div className=\"info-section-content\">\n                  {selectedProject.general_contractor ? (\n                    <div className=\"info-detail-row\">\n                      <span className=\"info-detail-label\">General Contractor</span>\n                      <span className=\"info-detail-value\">{selectedProject.general_contractor}</span>\n                    </div>\n                  ) : (\n                    <div className=\"info-detail-row empty\">\n                      <span className=\"info-detail-value\">No general contractor specified</span>\n                    </div>\n                  )}\n                  {selectedProject.client_contact && (\n                    <div className=\"info-detail-row\">\n                      <span className=\"info-detail-label\">Client Contact</span>\n                      <span className=\"info-detail-value\">{selectedProject.client_contact}</span>\n                    </div>\n                  )}\n                  {selectedProject.client_phone && (\n                    <div className=\"info-detail-row clickable\">\n                      <span className=\"info-detail-label\">\n                        <Phone size={14} />\n                        Phone\n                      </span>\n                      <a href={`tel:${selectedProject.client_phone}`} className=\"info-detail-value link\">\n                        {selectedProject.client_phone}\n                      </a>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {/* Work Areas Card */}\n              <div className=\"info-section-card\">\n                <div className=\"info-section-header\">\n                  <LayoutGrid size={18} />\n                  <h3>Work Areas</h3>\n                  <div className=\"info-section-badges\">\n                    {areasComplete > 0 && <span className=\"info-badge done\">{areasComplete} Done</span>}\n                    {areasWorking > 0 && <span className=\"info-badge working\">{areasWorking} Active</span>}\n                    {areasNotStarted > 0 && <span className=\"info-badge pending\">{areasNotStarted} Pending</span>}\n                  </div>\n                </div>\n                <div className=\"info-areas-list\">\n                  {areas.map(area => (\n                    <div key={area.id} className={`info-area-item ${area.status}`}>\n                      <div className=\"info-area-status\">\n                        {area.status === 'done' && <span className=\"status-dot done\"></span>}\n                        {area.status === 'working' && <span className=\"status-dot working\"></span>}\n                        {area.status === 'not_started' && <span className=\"status-dot pending\"></span>}\n                      </div>\n                      <div className=\"info-area-details\">\n                        <span className=\"info-area-name\">{area.name}</span>\n                        <span className={`info-area-status-label ${area.status}`}>\n                          {area.status === 'done' ? 'Complete' : area.status === 'working' ? 'In Progress' : 'Not Started'}\n                        </span>\n                      </div>\n                      <span className=\"info-area-weight\">{area.weight}%</span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Project Team */}\n              <ProjectTeam\n                project={selectedProject}\n                company={company}\n                user={user}\n                isAdmin={isAdmin}\n                onShowToast={onShowToast}\n              />\n\n              {/* Project Settings - Collapsible */}\n              <details className=\"info-details-section\">\n                <summary className=\"info-details-summary\">\n                  <Info size={16} />\n                  <span>Additional Settings</span>\n                </summary>\n                <div className=\"info-details-content\">\n                  <div className=\"info-detail-row\">\n                    <span className=\"info-detail-label\">Original Contract</span>\n                    <span className=\"info-detail-value\">{formatCurrency(selectedProject.contract_value)}</span>\n                  </div>\n                  {changeOrderValue > 0 && (\n                    <div className=\"info-detail-row\">\n                      <span className=\"info-detail-label\">Approved Change Orders</span>\n                      <span className=\"info-detail-value positive\">+{formatCurrency(changeOrderValue)}</span>\n                    </div>\n                  )}\n                  {selectedProject.default_dump_site_id && (\n                    <div className=\"info-detail-row\">\n                      <span className=\"info-detail-label\">Default Dump Site</span>\n                      <span className=\"info-detail-value\">\n                        {dumpSites.find(s => s.id === selectedProject.default_dump_site_id)?.name || 'Unknown'}\n                      </span>\n                    </div>\n                  )}\n                </div>\n              </details>\n\n              {/* Account Security */}\n              <div className=\"info-section-card\">\n                <MFASetup onShowToast={onShowToast} />\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Share Modal */}\n        {showShareModal && (\n          <Suspense fallback={null}>\n            <ShareModal\n              project={selectedProject}\n              user={user}\n              onClose={() => setShowShareModal(false)}\n              onShareCreated={(share) => {\n                onShowToast('Share link created successfully!', 'success')\n              }}\n            />\n          </Suspense>\n        )}\n\n        {/* Notification Settings Modal */}\n        {showNotificationSettings && (\n          <div className=\"notification-settings-modal\">\n            <Suspense fallback={null}>\n              <NotificationSettings\n                project={selectedProject}\n                company={company}\n                onShowToast={onShowToast}\n                onClose={() => setShowNotificationSettings(false)}\n              />\n            </Suspense>\n          </div>\n        )}\n\n        {/* COR Form Modal */}\n        {showCORForm && (\n          <Suspense fallback={null}>\n            <CORForm\n              project={selectedProject}\n              company={company}\n              areas={areas}\n              existingCOR={editingCOR}\n              onClose={() => {\n                setShowCORForm(false)\n                setEditingCOR(null)\n              }}\n              onSaved={() => {\n                setShowCORForm(false)\n                setEditingCOR(null)\n                setCORRefreshKey(prev => prev + 1)\n              }}\n              onShowToast={onShowToast}\n            />\n          </Suspense>\n        )}\n\n        {/* COR Detail Modal */}\n        {showCORDetail && viewingCOR && (\n          <Suspense fallback={null}>\n            <CORDetail\n              cor={viewingCOR}\n              project={selectedProject}\n              company={company}\n              areas={areas}\n              onClose={() => {\n                setShowCORDetail(false)\n                setViewingCOR(null)\n              }}\n              onEdit={(cor) => {\n                setShowCORDetail(false)\n                setViewingCOR(null)\n                setEditingCOR(cor)\n                setShowCORForm(true)\n              }}\n              onShowToast={onShowToast}\n              onStatusChange={() => {\n                // Trigger a refresh of the COR list\n              }}\n            />\n          </Suspense>\n        )}\n\n        {/* COR Log Modal */}\n        {corDisplayMode === 'log' && selectedProject && (\n          <div className=\"cor-log-modal-overlay\" onClick={() => setCORDisplayMode('list')}>\n            <div className=\"cor-log-modal\" onClick={(e) => e.stopPropagation()}>\n              <div className=\"cor-log-modal-header\">\n                <h2>Change Order Log</h2>\n                <button\n                  className=\"cor-log-modal-close\"\n                  onClick={() => setCORDisplayMode('list')}\n                  title=\"Close\"\n                >\n                  \n                </button>\n              </div>\n              <div className=\"cor-log-modal-content\">\n                <Suspense fallback={<div style={{ padding: '2rem', textAlign: 'center' }}>Loading...</div>}>\n                  <CORLog project={selectedProject} company={company} onShowToast={onShowToast} />\n                </Suspense>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Add Cost Modal */}\n        {showAddCostModal && (\n          <Suspense fallback={null}>\n            <AddCostModal\n              onClose={() => setShowAddCostModal(false)}\n              saving={savingCost}\n              onSave={async (costData) => {\n                try {\n                  setSavingCost(true)\n                  await db.addProjectCost(selectedProject.id, company.id, costData)\n                  setShowAddCostModal(false)\n                  loadProjects()\n                  onShowToast('Cost added successfully', 'success')\n                } catch (err) {\n                  console.error('Error adding cost:', err)\n                  onShowToast('Error adding cost', 'error')\n                } finally {\n                  setSavingCost(false)\n                }\n              }}\n            />\n          </Suspense>\n        )}\n\n        {/* Equipment Modal */}\n        {showEquipmentModal && (\n          <Suspense fallback={null}>\n            <EquipmentModal\n              project={selectedProject}\n              company={company}\n              user={user}\n              editItem={editingEquipment}\n              onSave={() => {\n                setShowEquipmentModal(false)\n                setEditingEquipment(null)\n                setEquipmentRefreshKey(prev => prev + 1)\n                onShowToast(editingEquipment ? 'Equipment updated' : 'Equipment added', 'success')\n              }}\n              onClose={() => {\n                setShowEquipmentModal(false)\n                setEditingEquipment(null)\n              }}\n            />\n          </Suspense>\n        )}\n\n        {/* Draw Request Modal */}\n        {showDrawRequestModal && (\n          <Suspense fallback={null}>\n            <DrawRequestModal\n              project={selectedProject}\n              company={company}\n              areas={areas}\n              corStats={projectsData.find(p => p.id === selectedProject?.id)?.corStats}\n              editDrawRequest={editingDrawRequest}\n              onSave={() => {\n                setShowDrawRequestModal(false)\n                setEditingDrawRequest(null)\n                setDrawRequestRefreshKey(prev => prev + 1)\n                onShowToast(editingDrawRequest ? 'Draw request updated' : 'Draw request created', 'success')\n              }}\n              onClose={() => {\n                setShowDrawRequestModal(false)\n                setEditingDrawRequest(null)\n              }}\n            />\n          </Suspense>\n        )}\n      </div>\n    )\n  }\n\n  // Project List View - empty state\n  if (projects.length === 0) {\n    return (\n      <div className=\"empty-state\">\n        <ClipboardList size={48} className=\"empty-state-icon\" />\n        <h3>No Projects Yet</h3>\n        <p>Create your first project to get started</p>\n      </div>\n    )\n  }\n\n  // Portfolio overview - uses memoized values from above\n  return (\n    <div>\n      {/* Business Overview - High Level Portfolio Health */}\n      <div className=\"business-overview\">\n        <div className=\"bo-header\">\n          <h2 className=\"bo-title\">Portfolio Overview</h2>\n          <button className=\"search-trigger-btn\" onClick={() => setSearchOpen(true)}>\n            <Search size={16} />\n            <span>Search</span>\n            <span className=\"shortcut\">K</span>\n          </button>\n          <div className=\"bo-project-count\">{projects.length} Active Project{projects.length !== 1 ? 's' : ''}</div>\n        </div>\n\n        {/* Main Financial Bar */}\n        <div className=\"bo-financial\">\n          <div className=\"bo-progress-bar\">\n            <div\n              className=\"bo-progress-fill\"\n              style={{ width: `${Math.min(weightedCompletion, 100)}%` }}\n            ></div>\n          </div>\n          <div className=\"bo-financial-row\">\n            <div className=\"bo-metric primary\">\n              <span className=\"bo-metric-value\">{formatCurrency(totalEarned)}</span>\n              <span className=\"bo-metric-label\">Earned Revenue</span>\n            </div>\n            <div className=\"bo-metric-separator\">of</div>\n            <div className=\"bo-metric primary\">\n              <span className=\"bo-metric-value\">{formatCurrency(totalPortfolioValue)}</span>\n              <span className=\"bo-metric-label\">Total Portfolio</span>\n            </div>\n            <div className=\"bo-metric highlight\">\n              <span className=\"bo-metric-value\">{formatCurrency(totalRemaining)}</span>\n              <span className=\"bo-metric-label\">Remaining to Bill</span>\n            </div>\n          </div>\n\n          {/* Change Orders Summary - Only show if there are change orders */}\n          {totalChangeOrders > 0 && (\n            <div className=\"bo-change-orders\">\n              <div className=\"bo-co-item\">\n                <span className=\"bo-co-label\">Original Contracts</span>\n                <span className=\"bo-co-value\">{formatCurrency(totalOriginalContract)}</span>\n              </div>\n              <div className=\"bo-co-item bo-co-added\">\n                <span className=\"bo-co-label\">+ Change Orders ({projectsWithChangeOrders} project{projectsWithChangeOrders !== 1 ? 's' : ''})</span>\n                <span className=\"bo-co-value\">+{formatCurrency(totalChangeOrders)}</span>\n              </div>\n            </div>\n          )}\n\n          {/* Pending CORs - Unapproved extra work (not yet part of contract value) */}\n          {totalPendingCORCount > 0 && (\n            <div className=\"bo-pending-cors\">\n              <div className=\"bo-pending-cor-item\">\n                <span className=\"bo-pending-cor-icon\">!</span>\n                <span className=\"bo-pending-cor-label\">Pending CORs</span>\n                <span className=\"bo-pending-cor-value\">{formatCurrency(totalPendingCORValue)}</span>\n                <span className=\"bo-pending-cor-count\">({totalPendingCORCount} pending)</span>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Project Health Summary */}\n        <div className=\"bo-health\">\n          <div className=\"bo-health-title\">Project Health</div>\n          <div className=\"bo-health-pills\">\n            {projectsComplete > 0 && (\n              <div className=\"bo-pill complete\">\n                <span className=\"bo-pill-count\">{projectsComplete}</span>\n                <span className=\"bo-pill-label\">Complete</span>\n              </div>\n            )}\n            {projectsOnTrack > 0 && (\n              <div className=\"bo-pill on-track\">\n                <span className=\"bo-pill-count\">{projectsOnTrack}</span>\n                <span className=\"bo-pill-label\">On Track</span>\n              </div>\n            )}\n            {projectsAtRisk > 0 && (\n              <div className=\"bo-pill at-risk\">\n                <span className=\"bo-pill-count\">{projectsAtRisk}</span>\n                <span className=\"bo-pill-label\">At Risk</span>\n              </div>\n            )}\n            {projectsOverBudget > 0 && (\n              <div className=\"bo-pill over-budget\">\n                <span className=\"bo-pill-count\">{projectsOverBudget}</span>\n                <span className=\"bo-pill-label\">Over Budget</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Schedule Performance Summary */}\n        {hasAnyScheduleData && (\n          <div className=\"bo-schedule\">\n            <div className=\"bo-schedule-title\">Schedule Performance</div>\n            <div className=\"bo-schedule-pills\">\n              {scheduleAhead > 0 && (\n                <div className=\"bo-pill ahead\">\n                  <span className=\"bo-pill-count\">{scheduleAhead}</span>\n                  <span className=\"bo-pill-label\">Ahead</span>\n                </div>\n              )}\n              {scheduleOnTrack > 0 && (\n                <div className=\"bo-pill schedule-on-track\">\n                  <span className=\"bo-pill-count\">{scheduleOnTrack}</span>\n                  <span className=\"bo-pill-label\">On Track</span>\n                </div>\n              )}\n              {scheduleBehind > 0 && (\n                <div className=\"bo-pill behind\">\n                  <span className=\"bo-pill-count\">{scheduleBehind}</span>\n                  <span className=\"bo-pill-label\">Behind</span>\n                </div>\n              )}\n            </div>\n\n            {/* Labor Performance (if any projects have planned man-days) */}\n            {hasAnyLaborData && (\n              <div className=\"bo-labor-summary\">\n                <span className=\"bo-labor-label\">Man-Days:</span>\n                {laborUnder > 0 && (\n                  <span className=\"bo-labor-badge under\">{laborUnder} under</span>\n                )}\n                {laborOnTrack > 0 && (\n                  <span className=\"bo-labor-badge on-track\">{laborOnTrack} on track</span>\n                )}\n                {laborOver > 0 && (\n                  <span className=\"bo-labor-badge over\">{laborOver} over</span>\n                )}\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Smart Alerts - Actionable insights requiring attention */}\n      {riskAnalysis.allAlerts.length > 0 && (\n        <div className={`smart-alerts-section${riskAnalysis.criticalCount > 0 ? ' smart-alerts-section--has-critical' : riskAnalysis.allAlerts.some(a => a.type === 'warning') ? ' smart-alerts-section--has-warning' : ''}`}>\n          <div className=\"smart-alerts-header\">\n            <div className=\"smart-alerts-header__left\">\n              <AlertTriangle className=\"smart-alerts-header__icon\" size={18} />\n              <h3 className=\"smart-alerts-header__title\">Needs Attention</h3>\n            </div>\n            {riskAnalysis.criticalCount > 0 ? (\n              <span className=\"smart-alerts-count-badge smart-alerts-count-badge--critical\">\n                {riskAnalysis.criticalCount} critical\n              </span>\n            ) : (\n              <span className=\"smart-alerts-count-badge smart-alerts-count-badge--warning\">\n                {riskAnalysis.allAlerts.length} item{riskAnalysis.allAlerts.length !== 1 ? 's' : ''}\n              </span>\n            )}\n          </div>\n          <SmartAlerts\n            alerts={riskAnalysis.allAlerts}\n            onAction={handleAlertAction}\n            maxVisible={3}\n          />\n        </div>\n      )}\n\n      {/* Projects Header */}\n      <div className=\"dashboard-header\">\n        <h2>Projects</h2>\n        <span className=\"project-count\">{projects.length} active</span>\n      </div>\n\n      {/* Project Grid */}\n      <div className=\"project-list\">\n        {projectsData.map(project => {\n          const projectRisk = riskAnalysis.projectRisks.find(r => r.projectId === project.id)\n          return (\n            <EnhancedProjectCard\n              key={project.id}\n              project={project}\n              riskScore={projectRisk?.riskScore}\n              riskStatus={projectRisk?.riskStatus}\n              onClick={() => handleSelectProject(project)}\n            />\n          )\n        })}\n      </div>\n\n      {/* Universal Search Modal */}\n      <UniversalSearch\n        isOpen={isSearchOpen}\n        onClose={closeSearch}\n        companyId={company?.id}\n        onSelectProject={(project) => {\n          handleSelectProject(project)\n        }}\n        onSelectTicket={(ticket) => {\n          // Navigate to project and open T&M tab\n          const project = projects.find(p => p.id === ticket.project_id)\n          if (project) {\n            handleSelectProject(project)\n            setActiveProjectTab('financials')\n            setFinancialsSection('tickets')\n          }\n        }}\n        onSelectCOR={(cor) => {\n          // Navigate to project and open COR\n          const project = projects.find(p => p.id === cor.project_id)\n          if (project) {\n            handleSelectProject(project)\n            setActiveProjectTab('financials')\n            setFinancialsSection('cors')\n            setViewingCOR(cor)\n            setShowCORDetail(true)\n          }\n        }}\n        onShowToast={onShowToast}\n      />\n    </div>\n  )\n}\n\nfunction ProjectCard({ project, onClick }) {\n  const [areas, setAreas] = useState([])\n\n  useEffect(() => {\n    db.getAreas(project.id).then(setAreas)\n  }, [project.id])\n\n  const progress = calculateProgress(areas)\n  const status = getOverallStatus(areas)\n  const statusLabel = getOverallStatusLabel(areas)\n\n  return (\n    <div className=\"project-card\" onClick={onClick}>\n      <div className=\"project-card-header\">\n        <div>\n          <div className=\"project-card-name\">{project.name}</div>\n          <div className=\"project-card-value\">{formatCurrency(project.contract_value)}</div>\n        </div>\n        <span className={`status-badge ${status}`}>{statusLabel}</span>\n      </div>\n      <div className=\"project-card-progress\">\n        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.9rem' }}>\n          <span style={{ color: 'var(--text-secondary)' }}>Progress</span>\n          <span style={{ fontWeight: 600 }}>{progress}%</span>\n        </div>\n        <div className=\"mini-progress-bar\">\n          <div className=\"mini-progress-fill\" style={{ width: `${progress}%` }}></div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// Enhanced Project Card with more details\nfunction EnhancedProjectCard({ project, riskScore, riskStatus, onClick }) {\n  const status = getOverallStatus(project.areas || [])\n  const statusLabel = getOverallStatusLabel(project.areas || [])\n  const profit = project.contract_value - project.billable\n  const isAtRisk = project.billable > project.contract_value * 0.9 && project.progress < 90\n\n  // Risk badge colors\n  const riskColors = {\n    healthy: { bg: 'var(--status-success-bg, #064e3b)', color: 'var(--status-success, #059669)' },\n    warning: { bg: 'var(--status-warning-bg, #78350f)', color: 'var(--status-warning, #d97706)' },\n    critical: { bg: 'var(--status-danger-bg, #7f1d1d)', color: 'var(--status-danger, #dc2626)' }\n  }\n  const riskStyle = riskColors[riskStatus] || riskColors.healthy\n\n  return (\n    <div className={`project-card enhanced ${isAtRisk ? 'at-risk' : ''}`} onClick={onClick}>\n      <div className=\"project-card-header\">\n        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n          {/* Risk Score Badge */}\n          {typeof riskScore === 'number' && (\n            <span\n              style={{\n                display: 'inline-flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                width: '32px',\n                height: '32px',\n                borderRadius: '50%',\n                fontSize: '0.75rem',\n                fontWeight: 700,\n                background: riskStyle.bg,\n                color: riskStyle.color\n              }}\n              title={`Risk Score: ${riskScore}`}\n              aria-label={`Risk score ${riskScore}, ${riskStatus}`}\n            >\n              {riskScore}\n            </span>\n          )}\n          <div>\n            <div className=\"project-card-name\">{project.name}</div>\n            <div className=\"project-card-value\">{formatCurrency(project.contract_value)}</div>\n          </div>\n        </div>\n        <span className={`status-badge ${status}`}>{statusLabel}</span>\n      </div>\n\n      {/* Stats Row */}\n      <div className=\"project-stats-row\">\n        <div className=\"project-stat\">\n          <span className=\"stat-value\">{project.progress}%</span>\n          <span className=\"stat-label\">Complete</span>\n        </div>\n        <div className=\"project-stat\">\n          <span className=\"stat-value\">{formatCurrency(project.billable)}</span>\n          <span className=\"stat-label\">Billable</span>\n        </div>\n        <div className=\"project-stat\">\n          <span className={`stat-value ${profit < 0 ? 'negative' : ''}`}>\n            {formatCurrency(Math.abs(profit))}\n          </span>\n          <span className=\"stat-label\">{profit >= 0 ? 'Remaining' : 'Over Budget'}</span>\n        </div>\n      </div>\n\n      {/* Progress Bar */}\n      <div className=\"mini-progress-bar\">\n        <div className=\"mini-progress-fill\" style={{ width: `${project.progress}%` }}></div>\n      </div>\n\n      {/* Badges Row */}\n      {(project.pendingTickets > 0 || project.totalTickets > 0) && (\n        <div className=\"project-badges\">\n          {project.pendingTickets > 0 && (\n            <span className=\"badge pending\">{project.pendingTickets} Pending T&M</span>\n          )}\n          {project.approvedTickets > 0 && (\n            <span className=\"badge approved\">{project.approvedTickets} Approved T&M</span>\n          )}\n        </div>\n      )}\n\n      {/* Schedule Badge */}\n      {project.hasScheduleData && (\n        <div className=\"project-schedule-badge\">\n          <span className={`schedule-indicator ${project.scheduleStatus}`}>\n            {project.scheduleLabel}\n          </span>\n          {project.hasLaborData && project.laborLabel && (\n            <span className={`labor-indicator ${project.laborStatus}`}>\n              {project.laborLabel}\n            </span>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n\n\n"],"file":"Dashboard-BNKOiQvY.js"}