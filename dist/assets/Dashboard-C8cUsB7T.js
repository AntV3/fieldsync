const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TMList-9H73zOWg.js","assets/pdf-aQqpMATS.js","assets/index-Cv-cBSFm.js","assets/icons-HD9y4hwp.js","assets/react-DXGY7bZi.js","assets/supabase-VuevzHjS.js","assets/index-Ct9GPi7W.css","assets/SignatureLinkGenerator-BeKAkFR4.js","assets/CORLogPreview-CMTf55h4.js","assets/CORList-CtzQ3B02.js","assets/CORLog-LZUKM3gX.js","assets/BillingCenter-DefLlnfb.js","assets/ShareModal-CdQ5wayl.js","assets/NotificationSettings-BpBq8Jk_.js","assets/CORForm-mtBqWCk2.js","assets/CORDetail-DfIWX7vv.js","assets/SignatureCanvas-Bu9Ujqt1.js","assets/DrawRequestModal-B2jfuedi.js","assets/EquipmentModal-BE8sB1ZM.js","assets/AddCostModal-DTu1i7Uw.js","assets/DocumentsTab-DC8uRaWy.js"])))=>i.map(i=>d[i]);
import{_ as ce}from"./pdf-aQqpMATS.js";import{r as ys,c as Nt,a as Fr,S as Or,b as Ar,u as ss,s as Mr,d as $r,e as Ir,f as Lr,g as zr,h as qr,i as Vr,j as Ye,k as wt,l as Br,m as xa,n as Wr,o as Ur,p as Hr,D as Ua,q as Ct,t as Gr,v as Kr,w as Yr,x as va,y as Jr,z as Xr,A as Ha,Z as Ga,L as gs,C as Qr,B as Zr,E as Ie,F as ja,G as kt,H as ei,I as Ks,J as _t,K as Ka,M as Ya,N as si,O as ti,P as St,Q as Dt,R as ai,T as ni,U as Ja,V as fa,W as ri,X as ii,Y as li,_ as oi,$ as ci,a0 as di,a1 as Xa,a2 as ui,a3 as mi,a4 as hi,a5 as pi,a6 as xi,a7 as vi,a8 as ji,a9 as fi,aa as ga,ab as ba,ac as ya,ad as gi,ae as bi,af as yi,ag as Ze,ah as Ni,ai as wi,aj as Ci,ak as Qa,al as mt,am as ki,an as _i,ao as Si,ap as Di,aq as Ei,ar as W,as as e,at as Et,au as Pi,av as Za,aw as en,ax as sn,ay as Pt,az as Na,aA as Ri,aB as Ti,aC as Fi,aD as es,aE as Ne,aF as Oi,aG as tn,aH as fs,aI as an,aJ as Ai,aK as Mi,aL as hs,aM as wa,aN as xe,aO as $i,aP as Ii,aQ as Li,aR as zi}from"./index-Cv-cBSFm.js";import{r as o,e as nn,X as ls,a8 as qi,_ as ft,y as Le,F as as,s as ge,N as Re,a6 as Ws,T as rs,a5 as Vi,a9 as Bi,D as We,aa as rn,O as Ys,H as He,W as gt,ab as ht,ac as Wi,c as Ns,K as ws,ad as Cs,m as Rt,b as Ca,C as ln,Q as xs,Y as on,ae as Ui,af as Hi,ag as Gi,j as Ki,ah as Yi,a3 as Bs,l as Ge,p as Js,q as Je,ai as cn,n as bs,R as Ji,aj as Xi,z as Qi,ak as Zi,i as el,al as sl,am as pt,a as bt,L as ka,an as _a,d as tl,ao as Sa,ap as al,h as nl,f as rl,aq as il,ar as ll,as as ol}from"./icons-HD9y4hwp.js";function Us(){return Us=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},Us.apply(null,arguments)}function Da(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function cl(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Da(Object(n),!0).forEach(function(a){dl(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Da(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function dl(s,t,n){return(t=ul(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function ul(s){var t=ml(s,"string");return typeof t=="symbol"?t:t+""}function ml(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}var ye=32,hl={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function pl(s){var{data:t,iconType:n,inactiveColor:a}=s,r=ye/2,i=ye/6,l=ye/3,c=t.inactive?a:t.color,u=n??t.type;if(u==="none")return null;if(u==="plainline"){var m;return o.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:(m=t.payload)===null||m===void 0?void 0:m.strokeDasharray,x1:0,y1:r,x2:ye,y2:r,className:"recharts-legend-icon"})}if(u==="line")return o.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(r,"h").concat(l,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(2*l,",").concat(r,`
            H`).concat(ye,"M").concat(2*l,",").concat(r,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(l,",").concat(r),className:"recharts-legend-icon"});if(u==="rect")return o.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(ye/8,"h").concat(ye,"v").concat(ye*3/4,"h").concat(-ye,"z"),className:"recharts-legend-icon"});if(o.isValidElement(t.legendIcon)){var d=cl({},t);return delete d.legendIcon,o.cloneElement(t.legendIcon,d)}return o.createElement(Ar,{fill:c,cx:r,cy:r,size:ye,sizeType:"diameter",type:u})}function xl(s){var{payload:t,iconSize:n,layout:a,formatter:r,inactiveColor:i,iconType:l}=s,c={x:0,y:0,width:ye,height:ye},u={display:a==="horizontal"?"inline-block":"block",marginRight:10},m={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((d,j)=>{var v=d.formatter||r,y=Nt({"recharts-legend-item":!0,["legend-item-".concat(j)]:!0,inactive:d.inactive});if(d.type==="none")return null;var h=d.inactive?i:d.color,p=v?v(d.value,d,j):d.value;return o.createElement("li",Us({className:y,style:u,key:"legend-item-".concat(j)},Fr(s,d,j)),o.createElement(Or,{width:n,height:n,viewBox:c,style:m,"aria-label":"".concat(p," legend icon")},o.createElement(pl,{data:d,iconType:l,inactiveColor:i})),o.createElement("span",{className:"recharts-legend-item-text",style:{color:h}},p))})}var vl=s=>{var t=ys(s,hl),{payload:n,layout:a,align:r}=t;if(!n||!n.length)return null;var i={padding:0,margin:0,textAlign:a==="horizontal"?r:"left"};return o.createElement("ul",{className:"recharts-default-legend",style:i},o.createElement(xl,Us({},t,{payload:n})))};function jl(){return ss(Mr)}var fl=["contextPayload"];function yt(){return yt=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},yt.apply(null,arguments)}function Ea(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function is(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ea(Object(n),!0).forEach(function(a){gl(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Ea(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function gl(s,t,n){return(t=bl(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function bl(s){var t=yl(s,"string");return typeof t=="symbol"?t:t+""}function yl(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Nl(s,t){if(s==null)return{};var n,a,r=wl(s,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(s,n)&&(r[n]=s[n])}return r}function wl(s,t){if(s==null)return{};var n={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(t.indexOf(a)!==-1)continue;n[a]=s[a]}return n}function Cl(s){return s.value}function kl(s){var{contextPayload:t}=s,n=Nl(s,fl),a=Wr(t,s.payloadUniqBy,Cl),r=is(is({},n),{},{payload:a});return o.isValidElement(s.content)?o.cloneElement(s.content,r):typeof s.content=="function"?o.createElement(s.content,r):o.createElement(vl,r)}function _l(s,t,n,a,r,i){var{layout:l,align:c,verticalAlign:u}=t,m,d;return(!s||(s.left===void 0||s.left===null)&&(s.right===void 0||s.right===null))&&(c==="center"&&l==="vertical"?m={left:((a||0)-i.width)/2}:m=c==="right"?{right:n&&n.right||0}:{left:n&&n.left||0}),(!s||(s.top===void 0||s.top===null)&&(s.bottom===void 0||s.bottom===null))&&(u==="middle"?d={top:((r||0)-i.height)/2}:d=u==="bottom"?{bottom:n&&n.bottom||0}:{top:n&&n.top||0}),is(is({},m),d)}function Sl(s){var t=wt();return o.useEffect(()=>{t(Br(s))},[t,s]),null}function Dl(s){var t=wt();return o.useEffect(()=>(t(xa(s)),()=>{t(xa({width:0,height:0}))}),[t,s]),null}function El(s,t,n,a){return s==="vertical"&&Ye(t)?{height:t}:s==="horizontal"?{width:n||a}:null}var Pl={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function Xs(s){var t=ys(s,Pl),n=jl(),a=$r(),r=Ir(),{width:i,height:l,wrapperStyle:c,portal:u}=t,[m,d]=Lr([n]),j=zr(),v=qr();if(j==null||v==null)return null;var y=j-(r?.left||0)-(r?.right||0),h=El(t.layout,l,i,y),p=u?c:is(is({position:"absolute",width:h?.width||i||"auto",height:h?.height||l||"auto"},_l(c,t,r,j,v,m)),c),k=u??a;if(k==null||n==null)return null;var R=o.createElement("div",{className:"recharts-legend-wrapper",style:p,ref:d},o.createElement(Sl,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),!u&&o.createElement(Dl,{width:m.width,height:m.height}),o.createElement(kl,yt({},t,h,{margin:r,chartWidth:j,chartHeight:v,contextPayload:n})));return Vr.createPortal(R,k)}Xs.displayName="Legend";function Pa(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function Ra(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Pa(Object(n),!0).forEach(function(a){Rl(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Pa(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function Rl(s,t,n){return(t=Tl(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function Tl(s){var t=Fl(s,"string");return typeof t=="symbol"?t:t+""}function Fl(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Hs(){return Hs=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},Hs.apply(null,arguments)}var Ol=(s,t)=>{var n;if(o.isValidElement(s))n=o.cloneElement(s,t);else if(typeof s=="function")n=s(t);else{if(!Ie(t.x1)||!Ie(t.y1)||!Ie(t.x2)||!Ie(t.y2))return null;n=o.createElement("line",Hs({},t,{className:"recharts-reference-line-line"}))}return n},Al=(s,t,n,a,r,i)=>{var{x:l,width:c}=i,u=r.y.apply(s,{position:n});if(kt(u)||t==="discard"&&!r.y.isInRange(u))return null;var m=[{x:l+c,y:u},{x:l,y:u}];return a==="left"?m.reverse():m},Ml=(s,t,n,a,r,i)=>{var{y:l,height:c}=i,u=r.x.apply(s,{position:n});if(kt(u)||t==="discard"&&!r.x.isInRange(u))return null;var m=[{x:u,y:l+c},{x:u,y:l}];return a==="top"?m.reverse():m},$l=(s,t,n,a)=>{var r=s.map(i=>a.apply(i,{position:n}));return t==="discard"&&r.some(i=>!a.isInRange(i))?null:r},Il=(s,t,n,a,r,i)=>{var{x:l,y:c,segment:u,ifOverflow:m}=i,d=ja(l),j=ja(c);return j?Al(c,m,n,r,s,t):d?Ml(l,m,n,a,s,t):u!=null&&u.length===2?$l(u,m,n,s):null};function Ll(s){var t=wt();return o.useEffect(()=>(t(Ur(s)),()=>{t(Hr(s))})),null}function zl(s){var{xAxisId:t,yAxisId:n,shape:a,className:r,ifOverflow:i}=s,l=Ct(),c=Gr(),u=ss(L=>Kr(L,t)),m=ss(L=>Yr(L,n)),d=ss(L=>va(L,"xAxis",t,l)),j=ss(L=>va(L,"yAxis",n,l)),v=Jr();if(!c||!v||u==null||m==null||d==null||j==null)return null;var y=Xr({x:d,y:j}),h=Il(y,v,s.position,u.orientation,m.orientation,s);if(!h)return null;var[{x:p,y:k},{x:R,y:x}]=h,F=i==="hidden"?"url(#".concat(c,")"):void 0,g=Ra(Ra({clipPath:F},Ha(s)),{},{x1:p,y1:k,x2:R,y2:x}),C=ei({x1:p,y1:k,x2:R,y2:x});return o.createElement(Ga,{zIndex:s.zIndex},o.createElement(gs,{className:Nt("recharts-reference-line",r)},Ol(a,g),o.createElement(Qr,Hs({},C,{lowerWidth:C.width,upperWidth:C.width}),o.createElement(Zr,{label:s.label}),s.children)))}var ql={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:Ua.line};function dn(s){var t=ys(s,ql);return o.createElement(o.Fragment,null,o.createElement(Ll,{yAxisId:t.yAxisId,xAxisId:t.xAxisId,ifOverflow:t.ifOverflow,x:t.x,y:t.y,segment:t.segment}),o.createElement(zl,t))}dn.displayName="ReferenceLine";var un=(s,t,n)=>Ka(s,"xAxis",St(s,t),n),mn=(s,t,n)=>Ya(s,"xAxis",St(s,t),n),hn=(s,t,n)=>Ka(s,"yAxis",Dt(s,t),n),pn=(s,t,n)=>Ya(s,"yAxis",Dt(s,t),n),Vl=Ks([_t,un,hn,mn,pn],(s,t,n,a,r)=>Ja(s,"xAxis")?fa(t,a,!1):fa(n,r,!1)),Bl=(s,t)=>t,xn=Ks([ri,Bl],(s,t)=>s.filter(n=>n.type==="area").find(n=>n.id===t)),vn=s=>{var t=_t(s),n=Ja(t,"xAxis");return n?"yAxis":"xAxis"},Wl=(s,t)=>{var n=vn(s);return n==="yAxis"?Dt(s,t):St(s,t)},Ul=(s,t,n)=>ai(s,vn(s),Wl(s,t),n),Hl=Ks([xn,Ul],(s,t)=>{var n;if(!(s==null||t==null)){var{stackId:a}=s,r=ni(s);if(!(a==null||r==null)){var i=(n=t[a])===null||n===void 0?void 0:n.stackedData,l=i?.find(c=>c.key===r);if(l!=null)return l.map(c=>[c[0],c[1]])}}}),Gl=Ks([_t,un,hn,mn,pn,Hl,si,Vl,xn,ti],(s,t,n,a,r,i,l,c,u,m)=>{var{chartData:d,dataStartIndex:j,dataEndIndex:v}=l;if(!(u==null||s!=="horizontal"&&s!=="vertical"||t==null||n==null||a==null||r==null||a.length===0||r.length===0||c==null)){var{data:y}=u,h;if(y&&y.length>0?h=y:h=d?.slice(j,v+1),h!=null)return ho({layout:s,xAxis:t,yAxis:n,xAxisTicks:a,yAxisTicks:r,dataStartIndex:j,areaSettings:u,stackedData:i,displayedData:h,chartBaseValue:m,bandSize:c})}}),Kl=["id"],Yl=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function Ke(){return Ke=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},Ke.apply(null,arguments)}function jn(s,t){if(s==null)return{};var n,a,r=Jl(s,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(s,n)&&(r[n]=s[n])}return r}function Jl(s,t){if(s==null)return{};var n={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(t.indexOf(a)!==-1)continue;n[a]=s[a]}return n}function Ta(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function ts(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ta(Object(n),!0).forEach(function(a){Xl(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Ta(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function Xl(s,t,n){return(t=Ql(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function Ql(s){var t=Zl(s,"string");return typeof t=="symbol"?t:t+""}function Zl(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Gs(s,t){return s&&s!=="none"?s:t}var eo=s=>{var{dataKey:t,name:n,stroke:a,fill:r,legendType:i,hide:l}=s;return[{inactive:l,dataKey:t,type:i,color:Gs(a,r),value:Xa(n,t),payload:s}]},so=o.memo(s=>{var{dataKey:t,data:n,stroke:a,strokeWidth:r,fill:i,name:l,hide:c,unit:u,tooltipType:m,id:d}=s,j={dataDefinedOnItem:n,positions:void 0,settings:{stroke:a,strokeWidth:r,fill:i,dataKey:t,nameKey:void 0,name:Xa(l,t),hide:c,type:m,color:Gs(a,i),unit:u,graphicalItemId:d}};return o.createElement(ui,{tooltipEntrySettings:j})});function to(s){var{clipPathId:t,points:n,props:a}=s,{needClip:r,dot:i,dataKey:l}=a,c=Qa(a);return o.createElement(ki,{points:n,dot:i,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:l,baseProps:c,needClip:r,clipPathId:t})}function ao(s){var{showLabels:t,children:n,points:a}=s,r=a.map(i=>{var l,c,u={x:(l=i.x)!==null&&l!==void 0?l:0,y:(c=i.y)!==null&&c!==void 0?c:0,width:0,lowerWidth:0,upperWidth:0,height:0};return ts(ts({},u),{},{value:i.value,payload:i.payload,parentViewBox:void 0,viewBox:u,fill:void 0})});return o.createElement(Ci,{value:t?r:void 0},n)}function Fa(s){var{points:t,baseLine:n,needClip:a,clipPathId:r,props:i}=s,{layout:l,type:c,stroke:u,connectNulls:m,isRange:d}=i,{id:j}=i,v=jn(i,Kl),y=Qa(v),h=Ha(v);return o.createElement(o.Fragment,null,t?.length>1&&o.createElement(gs,{clipPath:a?"url(#clipPath-".concat(r,")"):void 0},o.createElement(mt,Ke({},h,{id:j,points:t,connectNulls:m,type:c,baseLine:n,layout:l,stroke:"none",className:"recharts-area-area"})),u!=="none"&&o.createElement(mt,Ke({},y,{className:"recharts-area-curve",layout:l,type:c,connectNulls:m,fill:"none",points:t})),u!=="none"&&d&&o.createElement(mt,Ke({},y,{className:"recharts-area-curve",layout:l,type:c,connectNulls:m,fill:"none",points:n}))),o.createElement(to,{points:t,props:v,clipPathId:r}))}function no(s){var t,n,{alpha:a,baseLine:r,points:i,strokeWidth:l}=s,c=(t=i[0])===null||t===void 0?void 0:t.y,u=(n=i[i.length-1])===null||n===void 0?void 0:n.y;if(!Ie(c)||!Ie(u))return null;var m=a*Math.abs(c-u),d=Math.max(...i.map(j=>j.x||0));return Ye(r)?d=Math.max(r,d):r&&Array.isArray(r)&&r.length&&(d=Math.max(...r.map(j=>j.x||0),d)),Ye(d)?o.createElement("rect",{x:0,y:c<u?c:c-m,width:d+(l?parseInt("".concat(l),10):1),height:Math.floor(m)}):null}function ro(s){var t,n,{alpha:a,baseLine:r,points:i,strokeWidth:l}=s,c=(t=i[0])===null||t===void 0?void 0:t.x,u=(n=i[i.length-1])===null||n===void 0?void 0:n.x;if(!Ie(c)||!Ie(u))return null;var m=a*Math.abs(c-u),d=Math.max(...i.map(j=>j.y||0));return Ye(r)?d=Math.max(r,d):r&&Array.isArray(r)&&r.length&&(d=Math.max(...r.map(j=>j.y||0),d)),Ye(d)?o.createElement("rect",{x:c<u?c:c-m,y:0,width:m,height:Math.floor(d+(l?parseInt("".concat(l),10):1))}):null}function io(s){var{alpha:t,layout:n,points:a,baseLine:r,strokeWidth:i}=s;return n==="vertical"?o.createElement(no,{alpha:t,points:a,baseLine:r,strokeWidth:i}):o.createElement(ro,{alpha:t,points:a,baseLine:r,strokeWidth:i})}function lo(s){var{needClip:t,clipPathId:n,props:a,previousPointsRef:r,previousBaselineRef:i}=s,{points:l,baseLine:c,isAnimationActive:u,animationBegin:m,animationDuration:d,animationEasing:j,onAnimationStart:v,onAnimationEnd:y}=a,h=o.useMemo(()=>({points:l,baseLine:c}),[l,c]),p=gi(h,"recharts-area-"),k=bi(),[R,x]=o.useState(!1),F=!R,g=o.useCallback(()=>{typeof y=="function"&&y(),x(!1)},[y]),C=o.useCallback(()=>{typeof v=="function"&&v(),x(!0)},[v]);if(k==null)return null;var L=r.current,B=i.current;return o.createElement(ao,{showLabels:F,points:l},a.children,o.createElement(yi,{animationId:p,begin:m,duration:d,isActive:u,easing:j,onAnimationEnd:g,onAnimationStart:C,key:p},P=>{if(L){var S=L.length/l.length,A=P===1?l:l.map((O,V)=>{var D=Math.floor(V*S);if(L[D]){var te=L[D];return ts(ts({},O),{},{x:Ze(te.x,O.x,P),y:Ze(te.y,O.y,P)})}return O}),z;return Ye(c)?z=Ze(B,c,P):Ni(c)||kt(c)?z=Ze(B,0,P):z=c.map((O,V)=>{var D=Math.floor(V*S);if(Array.isArray(B)&&B[D]){var te=B[D];return ts(ts({},O),{},{x:Ze(te.x,O.x,P),y:Ze(te.y,O.y,P)})}return O}),P>0&&(r.current=A,i.current=z),o.createElement(Fa,{points:A,baseLine:z,needClip:t,clipPathId:n,props:a})}return P>0&&(r.current=l,i.current=c),o.createElement(gs,null,u&&o.createElement("defs",null,o.createElement("clipPath",{id:"animationClipPath-".concat(n)},o.createElement(io,{alpha:P,points:l,baseLine:c,layout:k,strokeWidth:a.strokeWidth}))),o.createElement(gs,{clipPath:"url(#animationClipPath-".concat(n,")")},o.createElement(Fa,{points:l,baseLine:c,needClip:t,clipPathId:n,props:a})))}),o.createElement(wi,{label:a.label}))}function oo(s){var{needClip:t,clipPathId:n,props:a}=s,r=o.useRef(null),i=o.useRef();return o.createElement(lo,{needClip:t,clipPathId:n,props:a,previousPointsRef:r,previousBaselineRef:i})}class co extends o.PureComponent{render(){var{hide:t,dot:n,points:a,className:r,top:i,left:l,needClip:c,xAxisId:u,yAxisId:m,width:d,height:j,id:v,baseLine:y,zIndex:h}=this.props;if(t)return null;var p=Nt("recharts-area",r),k=v,{r:R,strokeWidth:x}=vi(n),F=ji(n),g=R*2+x,C=c?"url(#clipPath-".concat(F?"":"dots-").concat(k,")"):void 0;return o.createElement(Ga,{zIndex:h},o.createElement(gs,{className:p},c&&o.createElement("defs",null,o.createElement(fi,{clipPathId:k,xAxisId:u,yAxisId:m}),!F&&o.createElement("clipPath",{id:"clipPath-dots-".concat(k)},o.createElement("rect",{x:l-g/2,y:i-g/2,width:d+g,height:j+g}))),o.createElement(oo,{needClip:c,clipPathId:k,props:this.props})),o.createElement(ga,{points:a,mainColor:Gs(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:C}),this.props.isRange&&Array.isArray(y)&&o.createElement(ga,{points:y,mainColor:Gs(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:C}))}}var fn={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:Ua.area};function uo(s){var t,n=ys(s,fn),{activeDot:a,animationBegin:r,animationDuration:i,animationEasing:l,connectNulls:c,dot:u,fill:m,fillOpacity:d,hide:j,isAnimationActive:v,legendType:y,stroke:h,xAxisId:p,yAxisId:k}=n,R=jn(n,Yl),x=mi(),F=hi(),{needClip:g}=pi(p,k),C=Ct(),{points:L,isRange:B,baseLine:P}=(t=ss(D=>Gl(D,s.id,C)))!==null&&t!==void 0?t:{},S=xi();if(x!=="horizontal"&&x!=="vertical"||S==null||F!=="AreaChart"&&F!=="ComposedChart")return null;var{height:A,width:z,x:O,y:V}=S;return!L||!L.length?null:o.createElement(co,Ke({},R,{activeDot:a,animationBegin:r,animationDuration:i,animationEasing:l,baseLine:P,connectNulls:c,dot:u,fill:m,fillOpacity:d,height:A,hide:j,layout:x,isAnimationActive:v==="auto"?!_i.isSsr:v,isRange:B,legendType:y,needClip:g,points:L,stroke:h,width:z,left:O,top:V,xAxisId:p,yAxisId:k}))}var mo=(s,t,n,a,r)=>{var i=n??t;if(Ye(i))return i;var l=s==="horizontal"?r:a,c=l.scale.domain();if(l.type==="number"){var u=Math.max(c[0],c[1]),m=Math.min(c[0],c[1]);return i==="dataMin"?m:i==="dataMax"||u<0?u:Math.max(Math.min(c[0],c[1]),0)}return i==="dataMin"?c[0]:i==="dataMax"?c[1]:c[0]};function ho(s){var{areaSettings:{connectNulls:t,baseValue:n,dataKey:a},stackedData:r,layout:i,chartBaseValue:l,xAxis:c,yAxis:u,displayedData:m,dataStartIndex:d,xAxisTicks:j,yAxisTicks:v,bandSize:y}=s,h=r&&r.length,p=mo(i,l,n,c,u),k=i==="horizontal",R=!1,x=m.map((g,C)=>{var L,B,P;if(h)P=r[d+C];else{var S=ba(g,a);Array.isArray(S)?(P=S,R=!0):P=[p,S]}var A=(L=(B=P)===null||B===void 0?void 0:B[1])!==null&&L!==void 0?L:null,z=A==null||h&&!t&&ba(g,a)==null;return k?{x:ya({axis:c,ticks:j,bandSize:y,entry:g,index:C}),y:z?null:u.scale(A),value:P,payload:g}:{x:z?null:c.scale(A),y:ya({axis:u,ticks:v,bandSize:y,entry:g,index:C}),value:P,payload:g}}),F;return h||R?F=x.map(g=>{var C=Array.isArray(g.value)?g.value[0]:null;return k?{x:g.x,y:C!=null&&g.y!=null?u.scale(C):null,payload:g.payload}:{x:C!=null?c.scale(C):null,y:g.y,payload:g.payload}}):F=k?u.scale(p):c.scale(p),{points:x,baseLine:F,isRange:R}}function po(s){var t=ys(s,fn),n=Ct();return o.createElement(li,{id:t.id,type:"area"},a=>o.createElement(o.Fragment,null,o.createElement(oi,{legendPayload:eo(t)}),o.createElement(so,{dataKey:t.dataKey,data:t.data,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,unit:t.unit,tooltipType:t.tooltipType,id:a}),o.createElement(ci,{type:"area",id:a,data:t.data,dataKey:t.dataKey,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,stackId:di(t.stackId),hide:t.hide,barSize:void 0,baseValue:t.baseValue,isPanorama:n,connectNulls:t.connectNulls}),o.createElement(uo,Ke({},t,{id:a}))))}var vs=o.memo(po,ii);vs.displayName="Area";var xo=["axis"],vo=o.forwardRef((s,t)=>o.createElement(Si,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:xo,tooltipPayloadSearcher:Di,categoricalChartProps:s,ref:t}));const Oa={WARNING:"warning",ERROR:"error"},we={DATABASE:"database",NETWORK:"network",AUTH:"auth",VALIDATION:"validation",STORAGE:"storage",SYNC:"sync",GENERAL:"general"};function jo(s){const t=s?.message?.toLowerCase()||"",n=s?.code?.toLowerCase()||"";return t.includes("fetch")||t.includes("network")||t.includes("offline")?we.NETWORK:t.includes("auth")||t.includes("unauthorized")||n.includes("auth")?we.AUTH:t.includes("storage")||t.includes("bucket")||t.includes("upload")?we.STORAGE:t.includes("validation")||t.includes("invalid")||t.includes("required")?we.VALIDATION:t.includes("sync")||t.includes("conflict")?we.SYNC:s?.code||t.includes("database")||t.includes("supabase")?we.DATABASE:we.GENERAL}function fo(s,t,n){return n?.userMessage?n.userMessage:t===we.NETWORK?"Network connection issue. Your changes will sync when back online.":t===we.AUTH?"Session expired. Please sign in again.":t===we.STORAGE?"Failed to upload file. Please try again.":t===we.VALIDATION?s?.message||"Please check your input and try again.":t===we.SYNC?"Sync conflict detected. Please refresh and try again.":n?.operation?`Failed to ${n.operation.replace(/([A-Z])/g," $1").toLowerCase().trim()}. Please try again.`:"Something went wrong. Please try again."}function go(s,t={}){const{operation:n="unknown",category:a=jo(s),severity:r=Oa.ERROR,showToast:i,userMessage:l,companyId:c,projectId:u,userId:m,silent:d=!1,rethrow:j=!1}=t;if(Ei.error(a,{message:s?.message||"Unknown error",code:s?.code,severity:r,operation:n,company_id:c,project_id:u,user_id:m,extra:{stack:s?.stack,name:s?.name}}),!d&&i){const v=fo(s,a,{operation:n,userMessage:l}),y=r===Oa.WARNING?"warning":"error";i(v,y)}if(j)throw s;return null}async function be(s,t={}){const{fallback:n=null,context:a={},showToast:r,silent:i=!0}=t;try{return await s()}catch(l){return go(l,{...a,showToast:r,silent:i}),n}}const os={budget:{healthy:.6,warning:.75,critical:.85},schedule:{healthy:.05,warning:.15,critical:.25},corExposure:{healthy:.05,warning:.15,critical:.25},activity:{healthy:1,warning:3,critical:5},safety:{healthy:0,warning:1,critical:2}},bo={budget:.3,schedule:.25,corExposure:.2,activity:.15,safety:.1};function ks(s,t){if(s<=t.healthy)return 0;if(s>=t.critical)return 100;const n=t.critical-t.healthy;return(s-t.healthy)/n*100}function _s(s){return s<=25?"healthy":s<=60?"warning":"critical"}function yo(s,t,n=os.budget){if(!t||t<=0)return{score:0,status:"healthy",ratio:0,label:"No revenue yet"};const a=s/t,r=ks(a,n),i=_s(r);let l;return a<n.healthy?l=`Costs at ${(a*100).toFixed(0)}% of revenue`:a<n.warning?l=`Costs at ${(a*100).toFixed(0)}% - monitor closely`:l=`Costs at ${(a*100).toFixed(0)}% - review immediately`,{score:r,status:i,ratio:a,label:l}}function No(s,t,n=os.schedule){if(!t||t<=0)return{score:0,status:"healthy",variance:0,label:"No schedule baseline"};const a=(t-s)/t,r=Math.max(0,a),i=ks(r,n),l=_s(i);let c;return a<=0?c=s>=100?"Complete":"On or ahead of schedule":a<n.warning?c=`${(a*100).toFixed(0)}% behind schedule`:c=`${(a*100).toFixed(0)}% behind - needs attention`,{score:i,status:l,variance:a,label:c}}function wo(s,t,n=os.corExposure){if(!t||t<=0)return{score:0,status:"healthy",exposure:0,label:"No contract value"};const a=s/t,r=ks(a,n),i=_s(r);let l;return a<n.healthy?l=s>0?`$${xt(s)} pending`:"No pending CORs":a<n.warning?l=`$${xt(s)} pending (${(a*100).toFixed(0)}% of contract)`:l=`High exposure: $${xt(s)} (${(a*100).toFixed(0)}%)`,{score:r,status:i,exposure:a,label:l}}function Co(s,t=os.activity){if(!s)return{score:100,status:"critical",daysSince:null,label:"No reports filed"};const n=new Date(s),r=Math.floor((new Date-n)/(1e3*60*60*24)),i=ks(r,t),l=_s(i);let c;return r===0?c="Report filed today":r===1?c="Report filed yesterday":r<=t.warning?c=`Last report ${r} days ago`:c=`No report in ${r} days - may be stalled`,{score:i,status:l,daysSince:r,label:c}}function ko(s,t=os.safety){const n=s||0,a=ks(n,t),r=_s(a);let i;return n===0?i="No incidents":n===1?i="1 incident in last 30 days":i=`${n} incidents - safety review needed`,{score:a,status:r,count:n,label:i}}function _o(s,t={}){const n={...os,...t.thresholds},a={...bo,...t.weights},r=yo(s.totalCosts,s.earnedRevenue,n.budget),i=No(s.actualProgress,s.expectedProgress,n.schedule),l=wo(s.pendingCORValue,s.contractValue,n.corExposure),c=Co(s.lastReportDate,n.activity),u=ko(s.recentInjuryCount,n.safety),m=Math.round(r.score*a.budget+i.score*a.schedule+l.score*a.corExposure+c.score*a.activity+u.score*a.safety);let d;m<=25?d="healthy":m<=60?d="warning":d="critical";let j;return d==="healthy"?j="Project is on track":d==="warning"?j="Some factors need attention":j="Immediate review recommended",{score:m,status:d,label:j,factors:{budget:{...r,weight:a.budget},schedule:{...i,weight:a.schedule},corExposure:{...l,weight:a.corExposure},activity:{...c,weight:a.activity},safety:{...u,weight:a.safety}}}}function So(s,t){const n=[],{factors:a}=s;a.budget.status==="critical"&&n.push({type:"critical",title:"Budget Alert",description:a.budget.label,action:"Review costs immediately",actionTarget:"financials",projectId:t.id}),a.activity.status==="critical"&&n.push({type:"critical",title:"Activity Alert",description:a.activity.label,action:"Check project status",actionTarget:"overview",projectId:t.id}),a.safety.status==="critical"&&n.push({type:"critical",title:"Safety Alert",description:a.safety.label,action:"Review safety reports",actionTarget:"reports",projectId:t.id}),a.budget.status==="warning"&&n.push({type:"warning",title:"Budget Watch",description:a.budget.label,action:"Monitor costs",actionTarget:"financials",projectId:t.id}),(a.schedule.status==="critical"||a.schedule.status==="warning")&&n.push({type:a.schedule.status==="critical"?"critical":"warning",title:"Schedule Alert",description:a.schedule.label,action:"Review progress",actionTarget:"overview",projectId:t.id}),(a.corExposure.status==="warning"||a.corExposure.status==="critical")&&n.push({type:a.corExposure.status==="critical"?"critical":"warning",title:"COR Exposure",description:a.corExposure.label,action:"Review pending CORs",actionTarget:"cors",projectId:t.id}),a.activity.status==="warning"&&n.push({type:"info",title:"Activity Notice",description:a.activity.label,action:"File daily report",actionTarget:"reports",projectId:t.id});const r={critical:0,warning:1,info:2};return n.sort((i,l)=>r[i.type]-r[l.type]),n}function Do(s){const{actualProgress:t,totalCosts:n,earnedRevenue:a,contractValue:r}=s;if(!t||t<=0)return{estimatedCompletionCost:null,estimatedFinalMargin:null,estimatedCompletionDate:null};const i=n/t,l=Math.round(i*100),c=r>0?(r-l)/r*100:0;let u=null;if(s.startDate&&t>0&&t<100){const m=new Date(s.startDate),d=new Date,j=Math.max(1,(d-m)/(1e3*60*60*24)),v=t/j,h=(100-t)/v;u=new Date(d.getTime()+h*24*60*60*1e3)}return{estimatedCompletionCost:l,estimatedFinalMargin:c,estimatedCompletionDate:u,costPerPercent:i}}function xt(s){return s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toFixed(0)}const Qs=()=>ce(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),ue=210,U=14,Pe=ue-U*2,ns=s=>s?new Date(s+(s.includes("T")?"":"T12:00:00")).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"—",Te=(s,t,n=30)=>t+n>s.internal.pageSize.height-20?(s.addPage(),20):t;async function Eo(s,t){const a=(await Qs()).default,r=new a;let i=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Daily Reports",ue/2,i,{align:"center"}),i+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${t.name}`,ue/2,i,{align:"center"}),i+=6,r.text(`${s.length} report${s.length!==1?"s":""}`,ue/2,i,{align:"center"}),i+=12,s.forEach((c,u)=>{i=Te(r,i,60),r.setDrawColor(200,200,200),r.setFillColor(245,247,250),r.roundedRect(U,i-2,Pe,10,2,2,"F"),r.setFontSize(11),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(`${ns(c.report_date)}`,U+4,i+5);const m=c.status==="submitted"?"Submitted":"Draft";r.setFontSize(9),r.setFont(void 0,"normal"),r.text(m,ue-U-4,i+5,{align:"right"}),i+=14,r.setTextColor(0,0,0),r.setFontSize(9);const d=[`Crew: ${c.crew_count||0}`,`Tasks: ${c.tasks_completed||0}/${c.tasks_total||0}`,`T&M Tickets: ${c.tm_tickets_count||0}`,`Photos: ${c.photos_count||0}`];if(r.text(d.join("    |    "),U+4,i),i+=7,c.crew_list?.length>0){r.setFont(void 0,"bold"),r.text("Crew:",U+4,i),r.setFont(void 0,"normal");const j=c.crew_list.map(y=>`${y.name} (${y.role||"Laborer"})`).join(", "),v=r.splitTextToSize(j,Pe-8);i+=4,r.text(v,U+4,i),i+=v.length*4+2}if(c.field_notes){i=Te(r,i,15),r.setFont(void 0,"bold"),r.text("Field Notes:",U+4,i),r.setFont(void 0,"normal"),i+=4;const j=r.splitTextToSize(c.field_notes,Pe-8);r.text(j,U+4,i),i+=j.length*4+2}if(c.issues){i=Te(r,i,15),r.setFont(void 0,"bold"),r.text("Issues:",U+4,i),r.setFont(void 0,"normal"),i+=4;const j=r.splitTextToSize(c.issues,Pe-8);r.text(j,U+4,i),i+=j.length*4+2}i+=8,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(U,i,ue-U,i),i+=6)});const l=`${t.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;r.save(l)}async function Po(s,t){const a=(await Qs()).default,r=new a;let i=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Incident / Injury Reports",ue/2,i,{align:"center"}),i+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${t.name}`,ue/2,i,{align:"center"}),i+=6,r.text(`${s.length} report${s.length!==1?"s":""}`,ue/2,i,{align:"center"}),i+=12,s.forEach((c,u)=>{i=Te(r,i,50);const d={minor:[34,197,94],serious:[245,158,11],critical:[239,68,68],near_miss:[59,130,246]}[c.injury_type]||[128,128,128];r.setFillColor(...d),r.roundedRect(U,i-2,3,14,1,1,"F"),r.setFontSize(11),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(`${ns(c.incident_date)}`,U+8,i+4),r.setFontSize(9);const j=(c.injury_type||"").replace("_"," ").toUpperCase();if(r.text(j,U+8,i+10),r.setFont(void 0,"normal"),r.text(c.status==="open"?"OPEN":"CLOSED",ue-U-4,i+4,{align:"right"}),i+=16,r.setTextColor(0,0,0),c.description){r.setFontSize(9),r.setFont(void 0,"bold"),r.text("Description:",U+4,i),r.setFont(void 0,"normal"),i+=4;const v=r.splitTextToSize(c.description,Pe-8);r.text(v,U+4,i),i+=v.length*4+2}c.location&&(r.setFont(void 0,"bold"),r.text("Location: ",U+4,i),r.setFont(void 0,"normal"),r.text(c.location,U+30,i),i+=6),i+=6,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(U,i,ue-U,i),i+=6)});const l=`${t.name}_Incident_Reports_${new Date().toISOString().split("T")[0]}.pdf`;r.save(l)}async function Ro(s,t){const a=(await Qs()).default,r=new a;let i=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Crew Check-In History",ue/2,i,{align:"center"}),i+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${t.name}`,ue/2,i,{align:"center"}),i+=6,r.text(`${s.length} check-in${s.length!==1?"s":""}`,ue/2,i,{align:"center"}),i+=12,s.forEach((c,u)=>{i=Te(r,i,30);const m=c.workers||[];r.setFillColor(245,247,250),r.roundedRect(U,i-2,Pe,9,2,2,"F"),r.setFontSize(10),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(ns(c.check_in_date),U+4,i+4),r.setFont(void 0,"normal"),r.text(`${m.length} workers`,ue-U-4,i+4,{align:"right"}),i+=12,r.setTextColor(0,0,0),r.setFontSize(9),m.length>0&&(r.setFont(void 0,"bold"),r.text("Name",U+4,i),r.text("Role",110,i),i+=5,r.setFont(void 0,"normal"),m.forEach(d=>{i=Te(r,i,6),r.text(d.name||"—",U+4,i),r.text(d.role||"Laborer",110,i),i+=4.5})),i+=6,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(U,i,ue-U,i),i+=5)});const l=`${t.name}_Crew_Checkins_${new Date().toISOString().split("T")[0]}.pdf`;r.save(l)}async function To({dailyReports:s=[],incidentReports:t=[],crewCheckins:n=[],project:a}){const i=(await Qs()).default,l=new i;let c=20;l.setFontSize(22),l.setFont(void 0,"bold"),l.text("Field Documents Report",ue/2,c,{align:"center"}),c+=10,l.setFontSize(13),l.setFont(void 0,"normal"),l.text(`Project: ${a.name}`,ue/2,c,{align:"center"}),c+=8,l.setFontSize(10),l.text(`Generated: ${new Date().toLocaleDateString()}`,ue/2,c,{align:"center"}),c+=16,l.setFontSize(11),l.setFont(void 0,"bold"),l.text("Document Summary",U,c),c+=8,l.setFontSize(10),l.setFont(void 0,"normal"),[["Daily Reports",`${s.length}`],["Incident Reports",`${t.length}`],["Crew Check-Ins",`${n.length}`]].forEach(([d,j])=>{l.text(d,U+4,c),l.text(j,100,c),c+=6}),s.length>0&&(l.addPage(),c=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Daily Reports",U,c),c+=10,s.forEach((d,j)=>{if(c=Te(l,c,40),l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(ns(d.report_date),U+2,c),l.setFont(void 0,"normal"),l.setFontSize(8),l.text(`Crew: ${d.crew_count||0} | Tasks: ${d.tasks_completed||0}/${d.tasks_total||0} | T&M: ${d.tm_tickets_count||0}`,U+60,c),c+=6,l.setTextColor(0,0,0),l.setFontSize(9),d.field_notes){const v=l.splitTextToSize(d.field_notes,Pe-4);l.text(v,U+2,c),c+=v.length*4+2}if(d.issues){l.setFont(void 0,"bold"),l.text("Issues: ",U+2,c),l.setFont(void 0,"normal");const v=l.splitTextToSize(d.issues,Pe-20);l.text(v,U+20,c),c+=v.length*4+2}c+=4,j<s.length-1&&(l.setDrawColor(220,220,220),l.line(U,c,ue-U,c),c+=4)})),t.length>0&&(l.addPage(),c=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Incident / Injury Reports",U,c),c+=10,t.forEach((d,j)=>{c=Te(l,c,35),l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(ns(d.incident_date),U+2,c),l.setFontSize(8),l.setFont(void 0,"normal");const v=(d.injury_type||"").replace("_"," ").toUpperCase();if(l.text(`${v} — ${d.status?.toUpperCase()||""}`,U+60,c),c+=6,l.setTextColor(0,0,0),l.setFontSize(9),d.description){const y=l.splitTextToSize(d.description,Pe-4);l.text(y,U+2,c),c+=y.length*4+2}d.location&&(l.text(`Location: ${d.location}`,U+2,c),c+=5),c+=4,j<t.length-1&&(l.setDrawColor(220,220,220),l.line(U,c,ue-U,c),c+=4)})),n.length>0&&(l.addPage(),c=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Crew Check-In History",U,c),c+=10,n.forEach((d,j)=>{c=Te(l,c,20);const v=d.workers||[];if(l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(ns(d.check_in_date),U+2,c),l.setFont(void 0,"normal"),l.setFontSize(8),l.text(`${v.length} workers`,U+60,c),c+=6,l.setTextColor(0,0,0),l.setFontSize(8),v.length>0){const y=v.map(p=>`${p.name} (${p.role||"Laborer"})`).join(", "),h=l.splitTextToSize(y,Pe-4);l.text(h,U+2,c),c+=h.length*3.5+3}j<n.length-1&&(l.setDrawColor(230,230,230),l.line(U,c,ue-U,c),c+=3)}));const m=`${a.name}_Field_Documents_${new Date().toISOString().split("T")[0]}.pdf`;l.save(m)}function Zs(s,t,n="text/csv"){const a=new Blob([s],{type:n}),r=URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}function Aa(s){if(s==null)return"";const t=String(s);return t.includes(",")||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t}function Tt(s,t){const n=s.map(r=>Aa(r.label)).join(","),a=t.map(r=>s.map(i=>Aa(r[i.key])).join(","));return[n,...a].join(`
`)}function Fo(s,t){const n=[{key:"category",label:"Category"},{key:"description",label:"Description"},{key:"amount",label:"Amount"},{key:"date",label:"Date"},{key:"type",label:"Type"}],a=[];a.push({category:"Revenue",description:"Original Contract Value",amount:s.contract_value||0,date:s.start_date||"",type:"Contract"}),t?.earnedRevenue&&a.push({category:"Revenue",description:"Earned Revenue (Progress)",amount:t.earnedRevenue,date:new Date().toISOString().split("T")[0],type:"Earned"}),t?.approvedCORs&&t.approvedCORs.forEach(u=>{a.push({category:"Revenue",description:`COR: ${u.cor_number} - ${u.title}`,amount:(u.cor_total||0)/100,date:u.approved_at?.split("T")[0]||"",type:"Change Order"})}),t?.laborByDate&&t.laborByDate.forEach(u=>{a.push({category:"Cost",description:"Labor",amount:u.cost,date:u.date,type:"Labor"})}),t?.haulOffByDate&&t.haulOffByDate.forEach(u=>{a.push({category:"Cost",description:"Disposal/Haul-off",amount:u.cost,date:u.date,type:"Disposal"})}),t?.customCosts&&t.customCosts.forEach(u=>{a.push({category:"Cost",description:u.description||u.category||"Other",amount:parseFloat(u.amount)||0,date:u.cost_date||"",type:u.category||"Other"})});const r=a.filter(u=>u.category==="Revenue").reduce((u,m)=>u+(parseFloat(m.amount)||0),0),i=a.filter(u=>u.category==="Cost").reduce((u,m)=>u+(parseFloat(m.amount)||0),0);a.push({category:"",description:"",amount:"",date:"",type:""}),a.push({category:"Summary",description:"Total Revenue",amount:r,date:"",type:""}),a.push({category:"Summary",description:"Total Costs",amount:i,date:"",type:""}),a.push({category:"Summary",description:"Gross Profit",amount:r-i,date:"",type:""}),a.push({category:"Summary",description:"Margin %",amount:r>0?((r-i)/r*100).toFixed(1)+"%":"N/A",date:"",type:""});const l=Tt(n,a),c=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_Financials_${new Date().toISOString().split("T")[0]}.csv`;Zs(l,c)}function Ac(s,t){const n=[],a=[{key:"section",label:"Section"},{key:"description",label:"Description"},{key:"quantity",label:"Quantity"},{key:"unit",label:"Unit"},{key:"rate",label:"Rate"},{key:"total",label:"Total"}];n.push({section:"COR Info",description:`${s.cor_number} - ${s.title}`,quantity:"",unit:"",rate:"",total:""}),n.push({section:"Status",description:s.status,quantity:"",unit:"",rate:"",total:""}),n.push({section:"Period",description:`${s.period_start||""} to ${s.period_end||""}`,quantity:"",unit:"",rate:"",total:""}),n.push({section:"",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor?.length>0&&(n.push({section:"LABOR",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor.forEach(l=>{const c=parseFloat(l.regular_hours)||0,u=parseFloat(l.overtime_hours)||0;n.push({section:"",description:l.description||l.classification,quantity:c+u,unit:"hours",rate:(parseInt(l.regular_rate)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_materials?.length>0&&(n.push({section:"MATERIALS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_materials.forEach(l=>{n.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"each",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_equipment?.length>0&&(n.push({section:"EQUIPMENT",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_equipment.forEach(l=>{n.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"day",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})})),s.change_order_subcontractors?.length>0&&(n.push({section:"SUBCONTRACTORS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_subcontractors.forEach(l=>{n.push({section:"",description:l.description,quantity:parseFloat(l.quantity)||0,unit:l.unit||"lump sum",rate:(parseInt(l.unit_cost)||0)/100,total:(parseInt(l.total)||0)/100})}));const r=Tt(a,n),i=`COR_${s.cor_number||s.id}_${new Date().toISOString().split("T")[0]}.csv`;Zs(r,i)}function Mc(s,t){const n=[{key:"date",label:"Date"},{key:"status",label:"Status"},{key:"workers",label:"Worker Count"},{key:"totalHours",label:"Total Hours"},{key:"otHours",label:"OT Hours"},{key:"materialsCost",label:"Materials Cost"},{key:"corNumber",label:"COR #"},{key:"notes",label:"Notes"}],a=s.map(l=>{const c=l.t_and_m_workers||[],u=l.t_and_m_items||[],m=c.reduce((v,y)=>v+(parseFloat(y.hours)||0),0),d=c.reduce((v,y)=>v+(parseFloat(y.overtime_hours)||0),0),j=u.reduce((v,y)=>v+(parseFloat(y.quantity)||0)*(y.materials_equipment?.cost_per_unit||0),0);return{date:l.work_date,status:l.status,workers:c.length,totalHours:(m+d).toFixed(1),otHours:d.toFixed(1),materialsCost:j.toFixed(2),corNumber:l.assigned_cor_id?"Linked":"",notes:l.notes||""}}),r=Tt(n,a),i=`${t.name.replace(/[^a-zA-Z0-9]/g,"_")}_TM_Tickets_${new Date().toISOString().split("T")[0]}.csv`;Zs(r,i)}function Oo(s,t){const n=[],a=new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"});n.push("!TRNS	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),n.push("!SPL	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),n.push("!ENDTRNS");const r=s.contract_value||0;n.push(`TRNS	GENERAL JOURNAL	${a}	Accounts Receivable	${s.name}	${r.toFixed(2)}	FieldSync - Contract Revenue`),n.push(`SPL	GENERAL JOURNAL	${a}	Construction Revenue	${s.name}	${(-r).toFixed(2)}	Contract: ${s.name}`),n.push("ENDTRNS");const i=t?.totalLaborCost||0;i>0&&(n.push(`TRNS	GENERAL JOURNAL	${a}	Direct Labor	${s.name}	${i.toFixed(2)}	Labor costs - ${s.name}`),n.push(`SPL	GENERAL JOURNAL	${a}	Accounts Payable	${s.name}	${(-i).toFixed(2)}	Labor costs`),n.push("ENDTRNS"));const l=t?.totalDisposalCost||0;l>0&&(n.push(`TRNS	GENERAL JOURNAL	${a}	Disposal Expense	${s.name}	${l.toFixed(2)}	Disposal costs - ${s.name}`),n.push(`SPL	GENERAL JOURNAL	${a}	Accounts Payable	${s.name}	${(-l).toFixed(2)}	Disposal costs`),n.push("ENDTRNS"));const c=n.join(`
`),u=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_QB_${new Date().toISOString().split("T")[0]}.iif`;Zs(c,u,"application/x-iif")}function Ao({isOpen:s,onClose:t,companyId:n,onSelectProject:a,onSelectTicket:r,onSelectCOR:i,onShowToast:l}){const[c,u]=o.useState(""),[m,d]=o.useState({projects:[],tickets:[],cors:[],workers:[]}),[j,v]=o.useState(!1),[y,h]=o.useState(0),p=o.useRef(null),k=o.useRef(null),R=o.useRef(null);o.useEffect(()=>()=>{k.current&&clearTimeout(k.current),R.current&&clearTimeout(R.current)},[]),o.useEffect(()=>{s&&(u(""),d({projects:[],tickets:[],cors:[],workers:[]}),h(0),R.current=setTimeout(()=>p.current?.focus(),50))},[s]);const x=o.useCallback(async S=>{if(!S.trim()||S.length<2){d({projects:[],tickets:[],cors:[],workers:[]});return}v(!0);try{const A=await W.universalSearch(n,S.trim());d(A),h(0)}catch(A){console.error("Search error:",A),l?.("Search failed","error")}finally{v(!1)}},[n,l]),F=S=>{const A=S.target.value;u(A),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{x(A)},200)},C=(()=>{const S=[];return m.projects.forEach(A=>S.push({type:"project",data:A})),m.tickets.forEach(A=>S.push({type:"ticket",data:A})),m.cors.forEach(A=>S.push({type:"cor",data:A})),m.workers.forEach(A=>S.push({type:"worker",data:A})),S})(),L=C.length>0,B=S=>{S.key==="Escape"?t():S.key==="ArrowDown"?(S.preventDefault(),h(A=>Math.min(A+1,C.length-1))):S.key==="ArrowUp"?(S.preventDefault(),h(A=>Math.max(A-1,0))):S.key==="Enter"&&L&&(S.preventDefault(),P(C[y]))},P=S=>{if(S){switch(S.type){case"project":a?.(S.data);break;case"ticket":r?.(S.data);break;case"cor":i?.(S.data);break;case"worker":S.data.lastProject&&a?.(S.data.lastProject);break}t()}};return s?e.jsx("div",{className:"universal-search-overlay",onClick:t,children:e.jsxs("div",{className:"universal-search-modal",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"universal-search-input-wrapper",children:[e.jsx(nn,{size:20,className:"universal-search-icon"}),e.jsx("input",{ref:p,type:"text",value:c,onChange:F,onKeyDown:B,placeholder:"Search projects, tickets, CORs, workers...",className:"universal-search-input",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),c&&e.jsx("button",{className:"universal-search-clear",onClick:()=>u(""),children:e.jsx(ls,{size:16})}),e.jsx("div",{className:"universal-search-shortcut",children:e.jsx("span",{children:"esc"})})]}),e.jsx("div",{className:"universal-search-results",children:j?e.jsxs("div",{className:"universal-search-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Searching..."})]}):c.trim()?L?e.jsxs(e.Fragment,{children:[m.projects.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(ft,{size:14}),e.jsx("span",{children:"Projects"})]}),m.projects.map((S,A)=>{const z=A;return e.jsxs("button",{className:`universal-search-item ${y===z?"selected":""}`,onClick:()=>P({type:"project",data:S}),onMouseEnter:()=>h(z),children:[e.jsx(ft,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:S.name}),S.job_number&&e.jsxs("span",{className:"universal-search-item-meta",children:["#",S.job_number]})]}),e.jsx(Le,{size:16,className:"universal-search-item-arrow"})]},S.id)})]}),m.tickets.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(as,{size:14}),e.jsx("span",{children:"T&M Tickets"})]}),m.tickets.map((S,A)=>{const z=m.projects.length+A;return e.jsxs("button",{className:`universal-search-item ${y===z?"selected":""}`,onClick:()=>P({type:"ticket",data:S}),onMouseEnter:()=>h(z),children:[e.jsx(as,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[S.description?.substring(0,50)||"T&M Ticket",S.description?.length>50&&"..."]}),e.jsxs("span",{className:"universal-search-item-meta",children:[S.projectName," • ",S.work_date]})]}),e.jsx("span",{className:`universal-search-item-badge ${S.status}`,children:S.status})]},S.id)})]}),m.cors.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(ge,{size:14}),e.jsx("span",{children:"Change Orders"})]}),m.cors.map((S,A)=>{const z=m.projects.length+m.tickets.length+A;return e.jsxs("button",{className:`universal-search-item ${y===z?"selected":""}`,onClick:()=>P({type:"cor",data:S}),onMouseEnter:()=>h(z),children:[e.jsx(ge,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[S.cor_number?`COR #${S.cor_number}: `:"",S.title]}),e.jsx("span",{className:"universal-search-item-meta",children:S.projectName})]}),e.jsx("span",{className:`universal-search-item-badge ${S.status}`,children:S.status})]},S.id)})]}),m.workers.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(Re,{size:14}),e.jsx("span",{children:"Workers"})]}),m.workers.map((S,A)=>{const z=m.projects.length+m.tickets.length+m.cors.length+A;return e.jsxs("button",{className:`universal-search-item ${y===z?"selected":""}`,onClick:()=>P({type:"worker",data:S}),onMouseEnter:()=>h(z),children:[e.jsx(Re,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:S.name}),e.jsxs("span",{className:"universal-search-item-meta",children:[S.role," • ",S.projectName]})]}),e.jsx(Le,{size:16,className:"universal-search-item-arrow"})]},`${S.name}-${A}`)})]})]}):e.jsx("div",{className:"universal-search-no-results",children:e.jsxs("span",{children:['No results for "',c,'"']})}):e.jsxs("div",{className:"universal-search-empty",children:[e.jsxs("div",{className:"universal-search-tip",children:[e.jsx(qi,{size:14}),e.jsx("span",{children:"Type to search across all data"})]}),e.jsxs("div",{className:"universal-search-hints",children:[e.jsx("span",{children:"Projects"}),e.jsx("span",{children:"T&M Tickets"}),e.jsx("span",{children:"Change Orders"}),e.jsx("span",{children:"Workers"})]})]})}),e.jsxs("div",{className:"universal-search-footer",children:[e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↑↓"})," navigate"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↵"})," select"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"esc"})," close"]})]})]})}):null}function Mo(){const[s,t]=o.useState(!1);return o.useEffect(()=>{const n=a=>{(a.metaKey||a.ctrlKey)&&a.key==="k"&&(a.preventDefault(),t(r=>!r))};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]),{isOpen:s,setIsOpen:t,open:()=>t(!0),close:()=>t(!1)}}function $o({alerts:s=[],onAction:t,onDismiss:n,maxVisible:a=3,className:r=""}){const[i,l]=o.useState(new Set),c=s.filter(m=>!i.has(m.id||`${m.projectId}-${m.type}-${m.title}`)).slice(0,a),u=o.useCallback(m=>{const d=m.id||`${m.projectId}-${m.type}-${m.title}`;l(j=>new Set([...j,d])),n?.(m)},[n]);return c.length===0?null:e.jsxs("div",{className:`smart-alerts ${r}`,role:"region","aria-label":"Project alerts","aria-live":"polite",children:[c.map((m,d)=>e.jsx(Io,{alert:m,onAction:t,onDismiss:()=>u(m)},m.id||`${m.projectId}-${m.type}-${d}`)),s.length>a&&e.jsx("div",{className:"smart-alerts__overflow",children:e.jsxs("span",{className:"smart-alerts__overflow-text",children:["+",s.length-a," more alerts"]})})]})}function Io({alert:s,onAction:t,onDismiss:n}){const{type:a="info",title:r,description:i,action:l,actionTarget:c,projectId:u,projectName:m}=s,j={critical:Vi,warning:rs,info:Ws}[a]||Ws,v=()=>{t?.({target:c,projectId:u,alert:s})};return e.jsxs("div",{className:`smart-alert smart-alert--${a}`,role:"alert","aria-live":a==="critical"?"assertive":"polite",children:[e.jsx(j,{className:"smart-alert__icon","aria-hidden":"true"}),e.jsxs("div",{className:"smart-alert__content",children:[e.jsxs("div",{className:"smart-alert__title",children:[m&&e.jsxs("span",{className:"smart-alert__project",children:[m,": "]}),r]}),i&&e.jsx("div",{className:"smart-alert__description",children:i}),l&&e.jsx("div",{className:"smart-alert__action",children:e.jsxs("button",{type:"button",className:"smart-alert__action-btn",onClick:v,children:[l,e.jsx(Bi,{size:14,"aria-hidden":"true"})]})})]}),n&&e.jsx("button",{type:"button",className:"smart-alert__dismiss",onClick:n,"aria-label":"Dismiss alert",children:e.jsx(ls,{size:18,"aria-hidden":"true"})})]})}const Lo=o.memo(function({progress:t=0,areasComplete:n=0,totalAreas:a=0,areasWorking:r=0,size:i=110,strokeWidth:l=9}){const[c,u]=o.useState(0),m=o.useRef(null);o.useEffect(()=>{const h=c,p=Math.min(100,Math.max(0,t)),k=800,R=performance.now(),x=F=>{const g=F-R,C=Math.min(g/k,1),L=1-Math.pow(1-C,3),B=h+(p-h)*L;u(B),C<1&&(m.current=requestAnimationFrame(x))};return m.current=requestAnimationFrame(x),()=>{m.current&&cancelAnimationFrame(m.current)}},[t]);const d=(i-l)/2,j=d*2*Math.PI,v=j-c/100*j,y=()=>c>=80?"var(--accent-green)":c>=50||c>=25?"var(--accent-blue)":"var(--text-muted)";return e.jsxs("div",{className:"overview-progress-gauge",children:[e.jsxs("div",{className:"progress-gauge-circle",style:{width:i,height:i},children:[e.jsxs("svg",{width:i,height:i,viewBox:`0 0 ${i} ${i}`,children:[e.jsx("circle",{className:"gauge-track",cx:i/2,cy:i/2,r:d,fill:"none",strokeWidth:l,stroke:"var(--bg-tertiary)"}),e.jsx("circle",{className:"gauge-fill",cx:i/2,cy:i/2,r:d,fill:"none",stroke:y(),strokeWidth:l,strokeDasharray:j,strokeDashoffset:v,strokeLinecap:"round",transform:`rotate(-90 ${i/2} ${i/2})`,style:{transition:"stroke 0.3s ease"}})]}),e.jsxs("div",{className:"gauge-center",children:[e.jsxs("span",{className:"gauge-value",children:[Math.round(c),"%"]}),e.jsx("span",{className:"gauge-label",children:"Complete"})]})]}),e.jsxs("div",{className:"gauge-areas-status",children:[e.jsxs("span",{className:"areas-count",children:[e.jsx("strong",{children:n}),"/",a," Areas Done"]}),r>0&&e.jsxs("span",{className:"areas-active",children:[r," active"]})]})]})}),J={contract:"#3b82f6",revenue:"#10b981",costs:"#f59e0b",profit:"#22c55e",loss:"#ef4444",tmValue:"#8b5cf6",corValue:"#14b8a6",labor:"#6366f1",disposal:"#14b8a6",equipment:"#f97316",materials:"#a855f7",subcontractor:"#ec4899",other:"#6b7280"},js={duration:800},Ma={contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"12px 16px"},labelStyle:{color:"var(--text-primary)",fontWeight:600,marginBottom:"8px"}},$a={labor:{label:"Labor",color:J.labor,icon:"HardHat"},disposal:{label:"Disposal",color:J.disposal,icon:"Trash2"},equipment:{label:"Equipment",color:J.equipment,icon:"Truck"},materials:{label:"Materials",color:J.materials,icon:"Package"},subcontractor:{label:"Subcontractor",color:J.subcontractor,icon:"Users"},other:{label:"Other",color:J.other,icon:"MoreHorizontal"}},Ia=[{id:"7d",label:"7D",days:7},{id:"30d",label:"30D",days:30},{id:"90d",label:"90D",days:90},{id:"all",label:"All",days:null}],Ue=s=>s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(0)}K`:`$${s.toFixed(0)}`,Ft=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}),zo={revenue:{id:"revenueGradient",color:J.revenue,startOpacity:.3,endOpacity:0},costs:{id:"costsGradient",color:J.costs,startOpacity:.3,endOpacity:0},tmValue:{id:"tmValueGradient",color:J.tmValue,startOpacity:.2,endOpacity:0}},qo=o.memo(function({earnedRevenue:t=0,totalCosts:n=0,laborCost:a=0,disposalCost:r=0,equipmentCost:i=0,materialsCost:l=0,otherCost:c=0,contractValue:u=0}){const m=t-n,d=t>0?m/t*100:0,j=m>=0,v=p=>p>=1e6?`$${(p/1e6).toFixed(1)}M`:p>=1e3?`$${(p/1e3).toFixed(1)}K`:`$${p.toFixed(0)}`,y=[{key:"labor",value:a,color:J.labor,label:"Labor"},{key:"disposal",value:r,color:J.disposal,label:"Disposal"},{key:"equipment",value:i,color:J.equipment,label:"Equipment"},{key:"materials",value:l,color:J.materials,label:"Materials"},{key:"other",value:c,color:J.other,label:"Other"}].filter(p=>p.value>0),h=y.length>0&&n>0;return e.jsxs("div",{className:"overview-financial-card animate-fade-in-up",children:[e.jsxs("div",{className:"financial-metrics-row",children:[e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value green",children:v(t)}),e.jsx("span",{className:"financial-metric-label",children:"Earned"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value amber",children:v(n)}),e.jsx("span",{className:"financial-metric-label",children:"Costs"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsxs("span",{className:`financial-metric-value ${j?"green":"red"}`,children:[j?"":"-",v(Math.abs(m))]}),e.jsxs("span",{className:"financial-metric-label",children:["Profit",e.jsxs("span",{className:`margin-badge ${j?"positive":"negative"}`,children:[d>=0?"+":"",d.toFixed(0),"%"]})]})]})]}),h&&e.jsxs("div",{className:"cost-breakdown-section",children:[e.jsx("div",{className:"cost-breakdown-bar",children:y.map((p,k)=>{const R=p.value/n*100;return e.jsx("div",{className:"cost-segment",style:{width:`${R}%`,backgroundColor:p.color,animationDelay:`${k*100}ms`},title:`${p.label}: ${v(p.value)} (${R.toFixed(0)}%)`},p.key)})}),e.jsx("div",{className:"cost-breakdown-legend",children:y.slice(0,4).map(p=>e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot",style:{backgroundColor:p.color}}),e.jsx("span",{className:"legend-label",children:p.label})]},p.key))})]})]})}),Vo=()=>ce(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),zs={contract:J.contract,tm:J.costs},La=[{id:"7d",label:"7D",days:7},{id:"14d",label:"14D",days:14},{id:"30d",label:"30D",days:30}],Bo=o.memo(function({project:t,onShowToast:n}){const[a,r]=o.useState([]),[i,l]=o.useState([]),[c,u]=o.useState(new Date().toISOString().split("T")[0]),[m,d]=o.useState("14d"),[j,v]=o.useState(!0),[y,h]=o.useState(!1);o.useEffect(()=>{t?.id&&p()},[t?.id]);const p=async()=>{v(!0);try{const[O,V]=await Promise.all([W.getCrewCheckinHistory(t.id,365),W.getTMTickets(t.id)]);r(O||[]),l(V||[])}catch(O){console.error("Error loading crew metrics:",O)}finally{v(!1)}},k=o.useMemo(()=>{const O={};return i.forEach(V=>{const D=V.work_date;D&&(O[D]||(O[D]=new Set),(V.t_and_m_workers||[]).forEach(te=>{O[D].add(te.name.toLowerCase().trim())}))}),O},[i]),R=o.useMemo(()=>{const O={};return a.forEach(V=>{O[V.check_in_date]=V.workers||[]}),O},[a]),x=R[c]||[],F=k[c]||new Set,g=o.useMemo(()=>{const O=[],V=[];return x.forEach(D=>{F.has(D.name.toLowerCase().trim())?V.push(D):O.push(D)}),{total:x.length,contract:O,tm:V}},[x,F]),C=o.useMemo(()=>{const O=La.find(te=>te.id===m)?.days||14,V=[],D=new Date;for(let te=O-1;te>=0;te--){const I=new Date(D);I.setDate(I.getDate()-te);const de=I.toISOString().split("T")[0],je=R[de]||[],he=k[de]||new Set;let De=0,$=0;je.forEach(b=>{he.has(b.name.toLowerCase().trim())?$++:De++}),V.push({date:de,displayDate:Ft(de),contract:De,tm:$,total:je.length})}return V},[R,k,m]),L=o.useCallback(O=>{const V=new Date(c+"T12:00:00");V.setDate(V.getDate()+O),u(V.toISOString().split("T")[0])},[c]),B=c===new Date().toISOString().split("T")[0],P=O=>new Date(O+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),S=o.useCallback(O=>{O?.date&&u(O.date)},[]),A=({active:O,payload:V,label:D})=>{if(!O||!V?.length)return null;const te=(V[0]?.value||0)+(V[1]?.value||0);return e.jsxs("div",{style:{...Ma.contentStyle,fontSize:"0.8rem"},children:[e.jsx("p",{style:{...Ma.labelStyle,fontSize:"0.85rem",marginBottom:6},children:D}),e.jsxs("p",{style:{margin:"3px 0",color:zs.contract},children:["Contract: ",e.jsx("strong",{children:V[0]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:zs.tm},children:["T&M: ",e.jsx("strong",{children:V[1]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:"var(--text-primary)",borderTop:"1px solid var(--border-color)",paddingTop:4},children:["Total: ",e.jsx("strong",{children:te})]})]})},z=o.useCallback(async()=>{h(!0),n?.("Generating crew report PDF...","info");try{const V=(await Vo()).default,D=new V,te=D.internal.pageSize.width;let I=20;D.setFontSize(18),D.setFont(void 0,"bold"),D.text("Crew On-Site Report",te/2,I,{align:"center"}),I+=8,D.setFontSize(11),D.setFont(void 0,"normal"),D.text(`Project: ${t.name}`,te/2,I,{align:"center"}),I+=6,D.text(`Date: ${P(c)}`,te/2,I,{align:"center"}),I+=12,D.setFontSize(12),D.setFont(void 0,"bold"),D.text("Selected Day Summary",14,I),I+=7,D.setFontSize(10),D.setFont(void 0,"normal"),D.text(`Total Crew On-Site: ${g.total}`,14,I),I+=5,D.text(`Contract Workers: ${g.contract.length}`,14,I),I+=5,D.text(`T&M Workers: ${g.tm.length}`,14,I),I+=10,g.contract.length>0&&(D.setFontSize(12),D.setFont(void 0,"bold"),D.text("Contract Workers",14,I),I+=7,D.setFontSize(9),D.setFont(void 0,"bold"),D.text("Name",14,I),D.text("Role",100,I),I+=5,D.setFont(void 0,"normal"),g.contract.forEach(he=>{I>270&&(D.addPage(),I=20),D.text(he.name,14,I),D.text(he.role||"—",100,I),I+=5}),I+=8),g.tm.length>0&&(I>240&&(D.addPage(),I=20),D.setFontSize(12),D.setFont(void 0,"bold"),D.text("T&M Workers (Extra Work)",14,I),I+=7,D.setFontSize(9),D.setFont(void 0,"bold"),D.text("Name",14,I),D.text("Role",100,I),I+=5,D.setFont(void 0,"normal"),g.tm.forEach(he=>{I>270&&(D.addPage(),I=20),D.text(he.name,14,I),D.text(he.role||"—",100,I),I+=5}),I+=8),I>200&&(D.addPage(),I=20),D.setFontSize(12),D.setFont(void 0,"bold"),D.text("Daily Timeline",14,I),I+=7,D.setFontSize(8),D.setFont(void 0,"bold"),D.text("Date",14,I),D.text("Total",70,I),D.text("Contract",95,I),D.text("T&M",125,I),I+=5,D.setFont(void 0,"normal"),C.forEach(he=>{I>275&&(D.addPage(),I=20),D.text(he.displayDate,14,I),D.text(String(he.total),70,I),D.text(String(he.contract),95,I),D.text(String(he.tm),125,I),I+=4.5});const de=D.internal.pageSize.height-10;D.setFontSize(8),D.setTextColor(128,128,128),D.text(`Generated ${new Date().toLocaleString()} — FieldSync`,te/2,de,{align:"center"});const je=`${t.name}_Crew_Report_${c}.pdf`;D.save(je),n?.("PDF exported!","success")}catch(O){console.error("Error exporting crew PDF:",O),n?.("Error generating PDF","error")}finally{h(!1)}},[t,c,g,C,n]);return j?e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsx("div",{className:"crew-metrics-header",children:e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Crew On-Site"]})}),e.jsxs("div",{className:"crew-metrics-loading",children:[e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"})]})]}):e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsxs("div",{className:"crew-metrics-header",children:[e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Crew On-Site"]}),e.jsx("div",{className:"crew-metrics-actions",children:e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:z,disabled:y,title:"Export crew report as PDF",children:[e.jsx(We,{size:14})," ",y?"Exporting...":"PDF"]})})]}),e.jsxs("div",{className:"crew-date-nav",children:[e.jsx("button",{className:"crew-date-btn",onClick:()=>L(-1),children:e.jsx(rn,{size:16})}),e.jsxs("span",{className:"crew-date-label",children:[e.jsx(Ys,{size:14}),B?"Today":P(c)]}),e.jsx("button",{className:"crew-date-btn",onClick:()=>L(1),disabled:B,children:e.jsx(Le,{size:16})})]}),e.jsxs("div",{className:"crew-stats-row",children:[e.jsxs("div",{className:"crew-stat total",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(Re,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.total}),e.jsx("span",{className:"crew-stat-label",children:"Total On-Site"})]})]}),e.jsxs("div",{className:"crew-stat contract",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(He,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.contract.length}),e.jsx("span",{className:"crew-stat-label",children:"Contract"})]})]}),e.jsxs("div",{className:"crew-stat tm",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(gt,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.tm.length}),e.jsx("span",{className:"crew-stat-label",children:"T&M"})]})]})]}),g.total>0&&e.jsxs("div",{className:"crew-breakdown-bar",children:[e.jsx("div",{className:"crew-bar-segment contract",style:{width:`${g.contract.length/g.total*100}%`},title:`${g.contract.length} Contract`}),e.jsx("div",{className:"crew-bar-segment tm",style:{width:`${g.tm.length/g.total*100}%`},title:`${g.tm.length} T&M`})]}),g.total>0&&e.jsxs("div",{className:"crew-name-lists",children:[g.contract.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header contract",children:[e.jsx(He,{size:13}),e.jsxs("span",{children:["Contract (",g.contract.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:g.contract.map((O,V)=>e.jsxs("span",{className:"crew-name-tag contract",children:[O.name,O.role&&O.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:O.role})]},V))})]}),g.tm.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header tm",children:[e.jsx(gt,{size:13}),e.jsxs("span",{children:["T&M (",g.tm.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:g.tm.map((O,V)=>e.jsxs("span",{className:"crew-name-tag tm",children:[O.name,O.role&&O.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:O.role})]},V))})]})]}),e.jsxs("div",{className:"crew-timeline-section",children:[e.jsxs("div",{className:"crew-timeline-header",children:[e.jsx("span",{className:"crew-timeline-title",children:"Daily Breakdown"}),e.jsx("div",{className:"crew-time-range-pills",children:La.map(O=>e.jsx("button",{className:`crew-range-pill ${m===O.id?"active":""}`,onClick:()=>d(O.id),children:O.label},O.id))})]}),e.jsx("div",{className:"crew-chart-container",children:e.jsx(Et,{width:"100%",height:140,children:e.jsxs(Pi,{data:C,onClick:O=>O?.activePayload?.[0]&&S(O.activePayload[0].payload),style:{cursor:"pointer"},children:[e.jsx(Za,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(en,{dataKey:"displayDate",tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:{stroke:"var(--border-color)"},tickLine:!1,interval:m==="30d"?4:m==="14d"?1:0}),e.jsx(sn,{tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:!1,tickLine:!1,allowDecimals:!1,width:30}),e.jsx(Pt,{content:e.jsx(A,{})}),e.jsx(Xs,{wrapperStyle:{fontSize:"0.75rem",paddingTop:4},iconType:"circle",iconSize:8}),e.jsx(Na,{dataKey:"contract",name:"Contract",stackId:"crew",fill:zs.contract,radius:[0,0,0,0]}),e.jsx(Na,{dataKey:"tm",name:"T&M (Extra Work)",stackId:"crew",fill:zs.tm,radius:[3,3,0,0]})]})})})]}),g.total===0&&e.jsx("div",{className:"crew-empty",children:e.jsx("p",{children:"No crew checked in for this date"})})]})}),ie=o.memo(function({width:t,height:n,borderRadius:a="8px",className:r="",variant:i="default"}){const c=(()=>{switch(i){case"text":return{height:"1em",borderRadius:"4px"};case"circular":return{borderRadius:"50%"};case"rectangular":return{borderRadius:"0"};default:return{borderRadius:a}}})();return e.jsx("div",{className:`skeleton ${r}`,style:{width:t||"100%",height:n||c.height||"1rem",borderRadius:c.borderRadius},"aria-hidden":"true"})});o.memo(function({showProgress:t=!1}){return e.jsxs("div",{className:"metric-skeleton",children:[e.jsx(ie,{width:"60%",height:"0.75rem",className:"skeleton-label"}),e.jsx(ie,{width:"80%",height:"1.75rem",className:"skeleton-value"}),t&&e.jsx(ie,{width:"100%",height:"6px",className:"skeleton-progress"})]})});const $c=o.memo(function({lines:t=3,showHeader:n=!0,showAction:a=!1}){return e.jsxs("div",{className:"card-skeleton","aria-busy":"true","aria-label":"Loading content",children:[n&&e.jsxs("div",{className:"card-skeleton-header",children:[e.jsx(ie,{width:"40%",height:"1.25rem"}),a&&e.jsx(ie,{width:"80px",height:"32px"})]}),e.jsx("div",{className:"card-skeleton-body",children:Array.from({length:t}).map((r,i)=>e.jsx(ie,{width:`${100-i*15}%`,height:"1rem",className:"skeleton-line"},i))})]})});o.memo(function({count:t=3,showAvatar:n=!1,showAction:a=!1}){return e.jsx("div",{className:"list-skeleton","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:t}).map((r,i)=>e.jsxs("div",{className:"list-item-skeleton",children:[n&&e.jsx(ie,{width:"40px",height:"40px",variant:"circular"}),e.jsxs("div",{className:"list-item-skeleton-content",children:[e.jsx(ie,{width:"60%",height:"1rem"}),e.jsx(ie,{width:"40%",height:"0.75rem"})]}),a&&e.jsx(ie,{width:"60px",height:"28px"})]},i))})});o.memo(function(){return e.jsx("div",{className:"financial-row-skeleton","aria-busy":"true","aria-label":"Loading financial data",children:[1,2,3].map(t=>e.jsxs("div",{className:"financial-card-skeleton",children:[e.jsxs("div",{className:"financial-card-skeleton-header",children:[e.jsx(ie,{width:"24px",height:"24px",variant:"circular"}),e.jsx(ie,{width:"60%",height:"1rem"})]}),e.jsx(ie,{width:"50%",height:"2rem",className:"skeleton-hero-value"}),e.jsxs("div",{className:"financial-card-skeleton-details",children:[e.jsx(ie,{width:"100%",height:"0.875rem"}),e.jsx(ie,{width:"80%",height:"0.875rem"})]})]},t))})});o.memo(function({height:t="200px"}){return e.jsxs("div",{className:"chart-skeleton",style:{height:t},"aria-busy":"true","aria-label":"Loading chart",children:[e.jsx("div",{className:"chart-skeleton-bars",children:[40,65,45,80,55,70,50,75,60,85].map((n,a)=>e.jsx("div",{className:"chart-skeleton-bar",style:{height:`${n}%`}},a))}),e.jsx(ie,{width:"100%",height:"1px",className:"chart-skeleton-axis"})]})});const Ve=o.memo(function({count:t=3}){return e.jsx("div",{className:"ticket-skeleton-list","aria-busy":"true","aria-label":"Loading tickets",children:Array.from({length:t}).map((n,a)=>e.jsxs("div",{className:"ticket-skeleton-item",children:[e.jsxs("div",{className:"ticket-skeleton-header",children:[e.jsx(ie,{width:"100px",height:"0.875rem"}),e.jsx(ie,{width:"80px",height:"24px",borderRadius:"12px"})]}),e.jsx(ie,{width:"90%",height:"1rem"}),e.jsxs("div",{className:"ticket-skeleton-footer",children:[e.jsx(ie,{width:"60px",height:"0.75rem"}),e.jsx(ie,{width:"60px",height:"0.75rem"}),e.jsx(ie,{width:"60px",height:"0.75rem"})]})]},a))})}),Wo=o.memo(function(){return e.jsx("div",{className:"hero-metrics-skeleton","aria-busy":"true","aria-label":"Loading metrics",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"hero-metric-skeleton",children:[e.jsx(ie,{width:"80px",height:"0.75rem",className:"skeleton-label"}),e.jsx(ie,{width:"120px",height:"1.75rem",className:"skeleton-value"}),e.jsx(ie,{width:"100%",height:"4px",className:"skeleton-bar"})]},t))})}),gn=o.memo(function({title:t="Unable to load data",message:n="Something went wrong. Please try again.",error:a=null,onRetry:r=null,retryLabel:i="Try Again",variant:l="default",icon:c=null}){const m=c||(a?.message?.includes("network")||a?.message?.includes("offline")?Wi:rs);return l==="compact"?e.jsxs("div",{className:"error-state error-state-compact",role:"alert",children:[e.jsx(m,{size:16,className:"error-state-icon","aria-hidden":"true"}),e.jsx("span",{className:"error-state-message",children:n}),r&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:r,"aria-label":i,children:e.jsx(ht,{size:14})})]}):l==="inline"?e.jsxs("div",{className:"error-state error-state-inline",role:"alert",children:[e.jsxs("div",{className:"error-state-content",children:[e.jsx(m,{size:20,className:"error-state-icon","aria-hidden":"true"}),e.jsxs("div",{className:"error-state-text",children:[e.jsx("span",{className:"error-state-title",children:t}),e.jsx("span",{className:"error-state-message",children:n})]})]}),r&&e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:r,children:[e.jsx(ht,{size:14})," ",i]})]}):e.jsxs("div",{className:"error-state",role:"alert","aria-live":"polite",children:[e.jsx("div",{className:"error-state-icon-wrapper",children:e.jsx(m,{size:32,className:"error-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"error-state-title",children:t}),e.jsx("p",{className:"error-state-message",children:n}),!1,r&&e.jsxs("button",{className:"btn btn-primary",onClick:r,children:[e.jsx(ht,{size:16})," ",i]})]})}),za=o.memo(function({title:t="No data yet",message:n="Items will appear here once added.",icon:a=null,action:r=null,actionLabel:i="Get Started",onAction:l=null}){return e.jsxs("div",{className:"empty-state",role:"status",children:[a&&e.jsx("div",{className:"empty-state-icon-wrapper",children:e.jsx(a,{size:32,className:"empty-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"empty-state-title",children:t}),e.jsx("p",{className:"empty-state-message",children:n}),l&&e.jsx("button",{className:"btn btn-primary btn-small",onClick:l,children:i}),r&&!l&&r]})});o.memo(function({label:t,error:n,required:a=!1,hint:r,children:i,className:l=""}){return e.jsxs("div",{className:`form-field ${n?"has-error":""} ${l}`,children:[t&&e.jsxs("label",{className:"form-field-label",children:[t,a&&e.jsx("span",{className:"form-field-required",children:"*"})]}),e.jsx("div",{className:"form-field-input",children:i}),n&&e.jsxs("div",{className:"form-field-error",role:"alert",children:[e.jsx(Ns,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:n})]}),r&&!n&&e.jsx("div",{className:"form-field-hint",children:r})]})});o.memo(function({type:t="text",value:n,onChange:a,onBlur:r,error:i,placeholder:l,disabled:c,min:u,max:m,step:d,pattern:j,required:v,autoComplete:y,name:h,id:p,className:k="","aria-label":R,"aria-describedby":x}){const F=p||h,g=i?`${F}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:t,id:F,name:h,value:n,onChange:a,onBlur:r,placeholder:l,disabled:c,min:u,max:m,step:d,pattern:j,required:v,autoComplete:y,className:`validated-input ${i?"has-error":""} ${k}`,"aria-label":R,"aria-invalid":!!i,"aria-describedby":i?g:x}),i&&e.jsxs("div",{id:g,className:"input-error-inline",role:"alert",children:[e.jsx(Ns,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:i})]})]})});o.memo(function({value:t,onChange:n,onBlur:a,error:r,disabled:i,required:l,name:c,id:u,className:m="",children:d,"aria-label":j}){const v=u||c,y=r?`${v}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("select",{id:v,name:c,value:t,onChange:n,onBlur:a,disabled:i,required:l,className:`validated-select ${r?"has-error":""} ${m}`,"aria-label":j,"aria-invalid":!!r,"aria-describedby":r?y:void 0,children:d}),r&&e.jsxs("div",{id:y,className:"input-error-inline",role:"alert",children:[e.jsx(Ns,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});o.memo(function({value:t,onChange:n,onBlur:a,error:r,placeholder:i,disabled:l,required:c,rows:u=3,maxLength:m,name:d,id:j,className:v="","aria-label":y}){const h=j||d,p=r?`${h}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("textarea",{id:h,name:d,value:t,onChange:n,onBlur:a,placeholder:i,disabled:l,required:c,rows:u,maxLength:m,className:`validated-textarea ${r?"has-error":""} ${v}`,"aria-label":y,"aria-invalid":!!r,"aria-describedby":r?p:void 0}),m&&e.jsxs("div",{className:"textarea-counter",children:[t?.length||0," / ",m]}),r&&e.jsxs("div",{id:p,className:"input-error-inline",role:"alert",children:[e.jsx(Ns,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});const Uo=o.memo(function({count:t,label:n,variant:a="default",size:r="medium",pulse:i=!1,icon:l}){const[c,u]=o.useState(t),[m,d]=o.useState(!1);return o.useEffect(()=>{if(t!==c){d(!0);const j=setTimeout(()=>{d(!1),u(t)},400);return()=>clearTimeout(j)}},[t,c]),e.jsxs("span",{className:`count-badge count-badge-${a} count-badge-${r} ${i?"badge-new":""} ${m?"animate-count-up":""}`,title:n,children:[l&&e.jsx(l,{size:r==="small"?12:r==="large"?18:14}),e.jsx("span",{className:"count-badge-value",children:t}),n&&e.jsx("span",{className:"count-badge-label",children:n})]})}),Ho=o.memo(function({value:t,max:n=100,showLabel:a=!1,size:r="medium",variant:i="default",animated:l=!0}){const c=Math.min(100,Math.max(0,t/n*100)),u=r==="small"?"4px":r==="large"?"8px":"6px",m=i==="default"?c>=80?"danger":c>=60?"warning":"success":i;return e.jsxs("div",{className:`mini-progress mini-progress-${r}`,children:[e.jsx("div",{className:"mini-progress-track",style:{height:u},children:e.jsx("div",{className:`mini-progress-fill mini-progress-${m} ${l?"progress-animate":""}`,style:{width:`${c}%`}})}),a&&e.jsxs("span",{className:"mini-progress-label",children:[Math.round(c),"%"]})]})}),Go=o.memo(function({value:t,previousValue:n,format:a="percent",inverted:r=!1,showValue:i=!0}){const l=t-n,c=n!==0?l/n*100:0;let u=l===0?"neutral":l>0?"up":"down",m="neutral";l!==0&&(r?m=l>0?"negative":"positive":m=l>0?"positive":"negative");const d=u==="up"?ws:u==="down"?Cs:Rt,j=()=>{const v=Math.abs(l);switch(a){case"percent":return`${Math.abs(c).toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(v);default:return v.toLocaleString()}};return e.jsxs("span",{className:`trend-indicator trend-${m}`,children:[e.jsx(d,{size:14}),i&&e.jsx("span",{className:"trend-value",children:j()})]})});o.memo(function({status:t="default",label:n,size:a="medium",pulse:r=!1}){return e.jsxs("span",{className:`status-dot-container status-dot-${a}`,children:[e.jsx("span",{className:`status-dot status-dot-${t} ${r?"status-dot-pulse":""}`}),n&&e.jsx("span",{className:"status-dot-label",children:n})]})});o.memo(function({data:t=[],width:n=80,height:a=24,strokeWidth:r=2,color:i="var(--accent-blue)",showArea:l=!0}){if(!t.length)return null;const c=Math.max(...t),u=Math.min(...t),m=c-u||1,d=t.map((v,y)=>{const h=y/(t.length-1)*n,p=a-(v-u)/m*(a-r*2)-r;return`${h},${p}`}).join(" "),j=`0,${a} ${d} ${n},${a}`;return e.jsxs("svg",{width:n,height:a,className:"sparkline",viewBox:`0 0 ${n} ${a}`,children:[l&&e.jsx("polygon",{points:j,fill:i,fillOpacity:"0.15"}),e.jsx("polyline",{points:d,fill:"none",stroke:i,strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]})});o.memo(function({items:t=[]}){return e.jsx("div",{className:"quick-stats",children:t.map((n,a)=>e.jsxs("span",{className:"quick-stat-item",children:[n.icon&&e.jsx(n.icon,{size:12}),e.jsx("span",{className:"quick-stat-value",children:n.value}),n.label&&e.jsx("span",{className:"quick-stat-label",children:n.label})]},a))})});o.memo(function({status:t,label:n,size:a="medium"}){const r={success:ln,warning:rs,danger:rs,info:Ca,pending:Ca},i=r[t]||r.info;return e.jsxs("span",{className:`status-indicator status-indicator-${t} status-indicator-${a}`,children:[e.jsx(i,{size:a==="small"?12:a==="large"?18:14}),n&&e.jsx("span",{className:"status-indicator-label",children:n})]})});o.memo(function({current:t,previous:n,format:a="number",label:r,inverted:i=!1}){const l=t-n,c=i?l<0:l>0,u=i?l>0:l<0,m=d=>{switch(a){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(Math.abs(d));case"percent":return`${Math.abs(d).toFixed(1)}%`;default:return Math.abs(d).toLocaleString()}};return e.jsxs("div",{className:`metric-delta ${c?"positive":u?"negative":"neutral"}`,children:[e.jsx("span",{className:"metric-delta-arrow",children:l>0?"↑":l<0?"↓":"→"}),e.jsx("span",{className:"metric-delta-value",children:m(l)}),r&&e.jsx("span",{className:"metric-delta-label",children:r})]})});o.memo(function({value:t,max:n=100,size:a=40,strokeWidth:r=4,showValue:i=!0,color:l="var(--accent-blue)"}){const c=Math.min(100,Math.max(0,t/n*100)),u=(a-r)/2,m=u*2*Math.PI,d=m-c/100*m;return e.jsxs("div",{className:"circular-progress",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,viewBox:`0 0 ${a} ${a}`,children:[e.jsx("circle",{className:"circular-progress-track",cx:a/2,cy:a/2,r:u,fill:"none",strokeWidth:r}),e.jsx("circle",{className:"circular-progress-fill",cx:a/2,cy:a/2,r:u,fill:"none",stroke:l,strokeWidth:r,strokeDasharray:m,strokeDashoffset:d,strokeLinecap:"round",transform:`rotate(-90 ${a/2} ${a/2})`,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),i&&e.jsxs("span",{className:"circular-progress-value",children:[Math.round(c),"%"]})]})});o.memo(function({isOpen:t,onClose:n,title:a,children:r,size:i="medium",className:l="",showCloseButton:c=!0,closeOnOverlayClick:u=!0,closeOnEscape:m=!0,footer:d,ariaDescribedBy:j}){const v=o.useRef(null),y=o.useRef(null),h=o.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`);o.useEffect(()=>{if(t){y.current=document.activeElement;const x=setTimeout(()=>{v.current?.focus()},10);return()=>clearTimeout(x)}},[t]),o.useEffect(()=>{!t&&y.current&&y.current.focus()},[t]),o.useEffect(()=>{if(!t||!m)return;const x=F=>{F.key==="Escape"&&(F.preventDefault(),n())};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[t,m,n]),o.useEffect(()=>{if(t){const x=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=x}}},[t]);const p=o.useCallback(x=>{if(x.key!=="Tab")return;const F=v.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!F||F.length===0)return;const g=F[0],C=F[F.length-1];x.shiftKey?document.activeElement===g&&(x.preventDefault(),C.focus()):document.activeElement===C&&(x.preventDefault(),g.focus())},[]),k=x=>{u&&x.target===x.currentTarget&&n()};if(!t)return null;const R={small:"modal-small",medium:"modal-medium",large:"modal-large",full:"modal-full"};return e.jsx("div",{className:"modal-overlay",onClick:k,role:"presentation",children:e.jsxs("div",{ref:v,className:`modal-content ${R[i]||""} ${l}`,role:"dialog","aria-modal":"true","aria-labelledby":a?h.current:void 0,"aria-describedby":j,tabIndex:-1,onKeyDown:p,onClick:x=>x.stopPropagation(),children:[a&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:h.current,children:a}),c&&e.jsx("button",{className:"close-btn",onClick:n,"aria-label":"Close modal",type:"button",children:e.jsx(ls,{size:20})})]}),e.jsx("div",{className:"modal-body",children:r}),d&&e.jsx("div",{className:"modal-footer",children:d})]})})});const ps=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),qs=o.memo(function({icon:t,label:n,value:a,formattedValue:r,subLabel:i,progress:l,progressLabel:c,variant:u="default",trend:m,previousValue:d}){const j={default:"var(--accent-blue)",success:"var(--accent-green)",warning:"var(--accent-amber)",danger:"var(--accent-red)"};return e.jsxs("div",{className:"hero-metric-card hover-lift animate-fade-in-up",children:[e.jsxs("div",{className:"hero-metric-header",children:[e.jsx("div",{className:"hero-metric-icon",style:{color:j[u]},children:e.jsx(t,{size:18})}),e.jsx("span",{className:"hero-metric-label",children:n})]}),e.jsxs("div",{className:"hero-metric-value-row",children:[e.jsx("span",{className:`hero-metric-value hero-metric-${u}`,children:r}),m!==void 0&&d!==void 0&&e.jsx(Go,{value:a,previousValue:d,format:"currency",inverted:n.toLowerCase().includes("cost")})]}),i&&e.jsx("span",{className:"hero-metric-sublabel",children:i}),l!==void 0&&e.jsxs("div",{className:"hero-metric-progress",children:[e.jsx(Ho,{value:l,max:100,size:"small",variant:u,showLabel:!0}),c&&e.jsx("span",{className:"hero-metric-progress-label",children:c})]})]})}),Ko=o.memo(function({contractValue:t=0,earnedRevenue:n=0,totalCosts:a=0,profit:r=0,progress:i=0,corApprovedValue:l=0,loading:c=!1,previousData:u}){const m=t+l,d=n>0?r/n*100:0,j=n>0?a/n*100:0,v=m>0?n/m*100:0,y=m>0?a/m*100:0,h=o.useMemo(()=>d>=20?"success":d>=10?"warning":d<0?"danger":"default",[d]),p=o.useMemo(()=>j<=60?"success":j<=80?"warning":"danger",[j]);return c?e.jsx(Wo,{}):e.jsxs("div",{className:"hero-metrics stagger-children",children:[e.jsx(qs,{icon:xs,label:"Contract Value",value:m,formattedValue:ps(m),subLabel:l>0?`+${ps(l)} CORs`:null,variant:"default"}),e.jsx(qs,{icon:ws,label:"Earned Revenue",value:n,formattedValue:ps(n),progress:v,progressLabel:`${Math.round(v)}% of contract`,variant:"success",previousValue:u?.earnedRevenue,trend:u?n:void 0}),e.jsx(qs,{icon:on,label:"Total Costs",value:a,formattedValue:ps(a),progress:y,progressLabel:`${Math.round(j)}% of revenue`,variant:p,previousValue:u?.totalCosts,trend:u?a:void 0}),e.jsx(qs,{icon:Ui,label:"Profit",value:r,formattedValue:ps(r),subLabel:`${d>=0?"+":""}${d.toFixed(1)}% margin`,variant:h,previousValue:u?.profit,trend:u?r:void 0})]})}),qa=[{id:"overview",label:"Overview",shortLabel:"Overview",icon:Gi,description:"Metrics & trends",step:null},{id:"cors",label:"Change Orders",shortLabel:"CORs",icon:as,description:"CORs & approvals",step:1},{id:"tickets",label:"T&M Tickets",shortLabel:"Tickets",icon:ge,description:"Field data",step:2},{id:"billing",label:"Billing",shortLabel:"Billing",icon:on,description:"Invoices & billing",step:3}],Yo=o.memo(function({activeSection:t="overview",onSectionChange:n,collapsed:a=!1,onToggleCollapse:r,onMobileClose:i,stats:l={}}){const{corCount:c=0,ticketCount:u=0,corPending:m=0,ticketPending:d=0,billableCount:j=0,invoiceCount:v=0}=l,y=h=>h==="cors"&&c>0?{count:c,variant:m>0?"warning":"default",pending:m}:h==="tickets"&&u>0?{count:u,variant:d>0?"warning":"default",pending:d}:h==="billing"&&j>0?{count:j,variant:"success",pending:j}:null;return e.jsxs("nav",{className:`financials-nav ${a?"collapsed":""}`,"aria-label":"Financials sections",children:[i&&e.jsxs("div",{className:"financials-nav-mobile-header",children:[e.jsx("span",{className:"financials-nav-mobile-title",children:"Financials"}),e.jsx("button",{className:"financials-nav-mobile-close",onClick:i,"aria-label":"Close menu",children:e.jsx(ls,{size:20})})]}),e.jsxs("button",{className:"financials-nav-toggle",onClick:r,"aria-label":a?"Expand sidebar":"Collapse sidebar",title:a?"Expand sidebar":"Collapse sidebar",children:[a?e.jsx(Hi,{size:18}):e.jsx(rn,{size:18}),!a&&e.jsx("span",{children:"Collapse"})]}),e.jsx("div",{className:"financials-nav-items",children:qa.map((h,p)=>{const k=t===h.id,R=h.icon,x=y(h.id),F=p<qa.length-1&&h.step!==null;return e.jsxs("div",{className:"financials-nav-item-wrapper",children:[e.jsxs("button",{className:`financials-nav-item ${k?"active":""}`,onClick:()=>n?.(h.id),"aria-current":k?"page":void 0,title:`${h.label}${x?` (${x.count})`:""}`,children:[h.step&&!a&&e.jsx("span",{className:"financials-nav-step",children:h.step}),e.jsxs("div",{className:"financials-nav-icon",children:[e.jsx(R,{size:a?22:20}),x&&x.pending>0&&e.jsx("span",{className:"financials-nav-dot"})]}),a&&e.jsx("span",{className:"financials-nav-short-label",children:h.shortLabel}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"financials-nav-content",children:[e.jsx("span",{className:"financials-nav-label",children:h.label}),e.jsx("span",{className:"financials-nav-desc",children:h.description})]}),x&&e.jsx(Uo,{count:x.count,size:"small",variant:x.variant}),e.jsx(Le,{size:16,className:"financials-nav-arrow"})]})]}),F&&!a&&e.jsx("div",{className:"financials-nav-connector",children:e.jsx("div",{className:"connector-line"})})]},h.id)})}),a&&e.jsxs("button",{className:"financials-nav-expand-btn",onClick:r,"aria-label":"Expand sidebar",children:[e.jsx(Le,{size:14}),e.jsx("span",{children:"Expand"})]})]})});function Jo(s,t,n=[],a=null,r=[]){const i=t?.contract_value||0,l=s?.laborByDate||[],c=s?.haulOffByDate||[],u=s?.materialsEquipmentByDate||[],m=s?.customCosts||[],d=new Set;l.forEach(C=>d.add(C.date)),c.forEach(C=>d.add(C.date)),u.forEach(C=>d.add(C.date)),m.forEach(C=>{C.cost_date&&d.add(C.cost_date)}),n.forEach(C=>{C.work_date&&d.add(C.work_date),C.ticket_date&&d.add(C.ticket_date),C.created_at&&d.add(C.created_at.split("T")[0])}),r.forEach(C=>{C.status==="done"&&C.updated_at&&d.add(C.updated_at.split("T")[0])});const j=[...d].sort((C,L)=>new Date(C)-new Date(L));if(j.length===0)return[];const v={},y=r.reduce((C,L)=>C+(parseFloat(L.weight)||0),0);r.forEach(C=>{if(C.status==="done"&&C.updated_at){const L=C.updated_at.split("T")[0],B=parseFloat(C.weight)||0,P=C.scheduled_value?parseFloat(C.scheduled_value):y>0?B/y*i:0;v[L]||(v[L]=0),v[L]+=P}});let h=0,p=0;const k={};n.forEach(C=>{const L=C.work_date||C.ticket_date||C.created_at?.split("T")[0];if(!L)return;let B=0;const P=C.t_and_m_workers||C.workers||[];Array.isArray(P)&&P.forEach(A=>{const z=parseFloat(A.hours)||parseFloat(A.regular_hours)||0,O=parseFloat(A.overtime_hours)||0,V=parseFloat(A.regular_rate)||parseFloat(A.rate)||65,D=parseFloat(A.overtime_rate)||V*1.5;B+=z*V+O*D});const S=C.t_and_m_items||C.items||[];Array.isArray(S)&&S.forEach(A=>{const z=parseFloat(A.quantity)||1,O=parseFloat(A.unit_cost)||parseFloat(A.materials_equipment?.cost_per_unit)||0;B+=z*O}),k[L]||(k[L]=0),k[L]+=B});const R={};m.forEach(C=>{const L=C.cost_date;L&&(R[L]||(R[L]=0),R[L]+=parseFloat(C.amount)||0)});const x={};u.forEach(C=>{C.date&&(x[C.date]=C.cost||0)});let F=0;return j.map(C=>{const B=l.find(de=>de.date===C)?.cost||0,S=c.find(de=>de.date===C)?.cost||0,A=x[C]||0,z=R[C]||0,O=B+A+S+z;h+=O;const V=k[C]||0;p+=V;const D=v[C]||0;F+=D;const I=Object.keys(v).length>0?F:s?.billable||0;return{date:C,contract:i,revenue:Math.round(I),costs:Math.round(h),tmValue:Math.round(p),corValue:Math.round(a?.total_approved_value||0),profit:Math.round(I-h),dailyLabor:Math.round(B),dailyRevenue:Math.round(D),dailyMaterials:Math.round(A),dailyHaulOff:Math.round(S),dailyCustom:Math.round(z),dailyTM:Math.round(V),dailyTotal:Math.round(O)}})}function Xo(s,t){if(!t||!s.length)return s;const n=new Date,a=new Date;return a.setDate(n.getDate()-t),s.filter(r=>new Date(r.date)>=a)}function Qo(s=0,t=0,n=[]){const a=[];s>0&&a.push({name:"Labor",value:s,color:J.labor,category:"labor"}),t>0&&a.push({name:"Disposal",value:t,color:J.disposal,category:"disposal"});const r={};n.forEach(l=>{const c=l.category||"other";r[c]||(r[c]={items:[],total:0}),r[c].items.push(l),r[c].total+=parseFloat(l.amount)||0}),Object.entries(r).forEach(([l,c])=>{if(c.total>0){const u=$a[l]||$a.other;a.push({name:u.label,value:c.total,color:u.color,category:l,items:c.items})}});const i=a.reduce((l,c)=>l+c.value,0);return a.forEach(l=>{l.percentage=i>0?Math.round(l.value/i*100):0}),a.sort((l,c)=>c.value-l.value),a}function Va(s,t){if(!s||s.length<2)return{direction:"flat",percentage:0};const n=s.slice(-7);if(n.length<2)return{direction:"flat",percentage:0};const a=n[0][t]||0,r=n[n.length-1][t]||0;if(a===0)return{direction:r>0?"up":"flat",percentage:0};const i=(r-a)/a*100;return{direction:i>5?"up":i<-5?"down":"flat",percentage:Math.abs(Math.round(i))}}function Zo({active:s,payload:t,label:n}){if(!s||!t||!t.length)return null;const a=i=>i>=1e6?`$${(i/1e6).toFixed(2)}M`:i>=1e3?`$${(i/1e3).toFixed(1)}K`:`$${i.toFixed(0)}`,r=t[0]?.payload||{};return e.jsxs("div",{className:"chart-tooltip",children:[e.jsx("div",{className:"chart-tooltip-date",children:Ft(n)}),e.jsxs("div",{className:"chart-tooltip-rows",children:[r.contract!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:J.contract}}),"Contract"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.contract)})]}),r.revenue!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:J.revenue}}),"Revenue"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.revenue)})]}),r.costs!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:J.costs}}),"Costs"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.costs)})]}),r.tmValue!==void 0&&r.tmValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:J.tmValue}}),"T&M Value"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.tmValue)})]}),r.corValue!==void 0&&r.corValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:J.corValue}}),"COR Approved"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.corValue)})]}),r.profit!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:r.profit>=0?J.profit:J.loss}}),r.profit>=0?"Profit":"Loss"]}),e.jsx("span",{className:"chart-tooltip-value",style:{color:r.profit>=0?J.profit:J.loss},children:a(Math.abs(r.profit))})]})]}),(r.dailyRevenue>0||r.dailyLabor>0||r.dailyMaterials>0||r.dailyHaulOff>0||r.dailyTM>0)&&e.jsxs("div",{className:"chart-tooltip-daily",children:[e.jsx("div",{className:"chart-tooltip-daily-label",children:"Today's Activity"}),r.dailyRevenue>0&&e.jsx("div",{className:"chart-tooltip-daily-row earned",children:e.jsxs("span",{style:{color:J.revenue},children:["Areas Completed: ",a(r.dailyRevenue)]})}),r.dailyLabor>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Labor: ",a(r.dailyLabor)]}),r.dailyMaterials>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Materials: ",a(r.dailyMaterials)]}),r.dailyHaulOff>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Disposal: ",a(r.dailyHaulOff)]}),r.dailyTM>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["T&M Added: ",a(r.dailyTM)]}),r.dailyTotal>0&&e.jsx("div",{className:"chart-tooltip-daily-row total",children:e.jsxs("strong",{children:["Day Costs: ",a(r.dailyTotal)]})})]}),e.jsx("div",{className:"chart-tooltip-hint",children:"Click to see details"})]})}function ec({projectData:s,project:t,tmTickets:n=[],corStats:a=null,areas:r=[],onDrillDown:i}){const[l,c]=o.useState("30d"),[u,m]=o.useState(null),d=o.useMemo(()=>{const p=Jo(s,t,n,a,r),k=Ia.find(R=>R.id===l);return Xo(p,k?.days)},[s,t,n,a,r,l]),j=o.useMemo(()=>Va(d,"costs"),[d]),v=o.useMemo(()=>Va(d,"revenue"),[d]),y=p=>{if(p?.activePayload?.[0]){const k=p.activePayload[0].payload;i?.(k.date,k)}},h=({trend:p})=>p.direction==="up"?e.jsx(ws,{size:14,className:"trend-icon up"}):p.direction==="down"?e.jsx(Cs,{size:14,className:"trend-icon down"}):e.jsx(Rt,{size:14,className:"trend-icon flat"});return d.length?e.jsxs("div",{className:"financial-trend-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[e.jsx("h3",{children:"Financial Trend"}),e.jsxs("div",{className:"chart-trend-indicators",children:[e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:J.revenue},children:"Revenue"}),e.jsx(h,{trend:v}),v.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[v.percentage,"%"]})]}),e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:J.costs},children:"Costs"}),e.jsx(h,{trend:j}),j.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[j.percentage,"%"]})]})]})]}),e.jsx("div",{className:"time-range-selector",children:Ia.map(p=>e.jsx("button",{className:l===p.id?"active":"",onClick:()=>c(p.id),children:p.label},p.id))})]}),e.jsx("div",{className:"chart-container",children:e.jsx(Et,{width:"100%",height:300,children:e.jsxs(vo,{data:d,onClick:y,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:Object.values(zo).map(p=>e.jsxs("linearGradient",{id:p.id,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:p.color,stopOpacity:p.startOpacity}),e.jsx("stop",{offset:"95%",stopColor:p.color,stopOpacity:p.endOpacity})]},p.id))}),e.jsx(Za,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(en,{dataKey:"date",tickFormatter:Ft,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(sn,{tickFormatter:Ue,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:!1,width:60}),e.jsx(Pt,{content:e.jsx(Zo,{})}),e.jsx(Xs,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,formatter:p=>e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:p})}),d[0]?.contract>0&&e.jsx(dn,{y:d[0].contract,stroke:J.contract,strokeDasharray:"5 5",strokeWidth:2,label:{value:"Contract",position:"right",fill:J.contract,fontSize:11}}),e.jsx(vs,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:J.revenue,strokeWidth:2,fill:"url(#revenueGradient)",animationDuration:js.duration,onMouseEnter:()=>m("revenue"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="revenue"?.3:1}}),e.jsx(vs,{type:"monotone",dataKey:"costs",name:"Costs",stroke:J.costs,strokeWidth:2,fill:"url(#costsGradient)",animationDuration:js.duration,onMouseEnter:()=>m("costs"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="costs"?.3:1}}),d.some(p=>p.tmValue>0)&&e.jsx(vs,{type:"monotone",dataKey:"tmValue",name:"T&M Value",stroke:J.tmValue,strokeWidth:2,fill:"url(#tmValueGradient)",animationDuration:js.duration,onMouseEnter:()=>m("tmValue"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="tmValue"?.3:1}}),d.some(p=>p.corValue>0)&&e.jsx(vs,{type:"monotone",dataKey:"corValue",name:"COR Approved",stroke:J.corValue,strokeWidth:2,strokeDasharray:"4 2",fill:"transparent",animationDuration:js.duration,onMouseEnter:()=>m("corValue"),onMouseLeave:()=>m(null),style:{opacity:u&&u!=="corValue"?.3:1}})]})})}),e.jsxs("div",{className:"chart-quick-stats",children:[e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Current Revenue"}),e.jsx("span",{className:"stat-value",style:{color:J.revenue},children:Ue(d[d.length-1]?.revenue||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Total Costs"}),e.jsx("span",{className:"stat-value",style:{color:J.costs},children:Ue(d[d.length-1]?.costs||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Margin"}),e.jsx("span",{className:"stat-value",style:{color:(d[d.length-1]?.profit||0)>=0?J.profit:J.loss},children:(()=>{const p=d[d.length-1];return!p||!p.revenue?"0%":`${((p.revenue-p.costs)/p.revenue*100).toFixed(1)}%`})()})]}),d[d.length-1]?.tmValue>0&&e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"T&M Pending"}),e.jsx("span",{className:"stat-value",style:{color:J.tmValue},children:Ue(d[d.length-1]?.tmValue||0)})]})]})]}):e.jsx("div",{className:"financial-trend-chart empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No financial data available yet."}),e.jsx("span",{children:"Start tracking labor and costs to see trends."})]})})}function sc({laborCost:s=0,haulOffCost:t=0,customCosts:n=[],onSegmentClick:a}){const[r,i]=o.useState(null),l=o.useMemo(()=>Qo(s,t,n),[s,t,n]),c=o.useMemo(()=>l.reduce((y,h)=>y+h.value,0),[l]),u=(y,h)=>{i(h)},m=()=>{i(null)},d=(y,h)=>{a&&a(l[h])},j=({active:y,payload:h})=>{if(!y||!h||!h.length)return null;const p=h[0].payload;return e.jsxs("div",{className:"chart-tooltip donut-tooltip",children:[e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:p.color}}),p.name]}),e.jsx("span",{className:"chart-tooltip-value",children:Ue(p.value)})]}),e.jsxs("div",{className:"donut-tooltip-pct",children:[p.percentage,"% of total costs"]}),p.items&&p.items.length>0&&e.jsx("div",{className:"donut-tooltip-items",children:e.jsxs("div",{className:"donut-tooltip-items-label",children:[p.items.length," item",p.items.length>1?"s":""]})}),a&&e.jsx("div",{className:"chart-tooltip-hint",children:"Click to view details"})]})},v=y=>{const{payload:h}=y;return e.jsx("div",{className:"donut-legend",children:h.map((p,k)=>e.jsxs("div",{className:`donut-legend-item ${r===k?"active":""}`,onMouseEnter:()=>i(k),onMouseLeave:()=>i(null),onClick:()=>d(null,k),children:[e.jsx("span",{className:"donut-legend-color",style:{backgroundColor:p.payload.color}}),e.jsx("span",{className:"donut-legend-name",children:p.value}),e.jsx("span",{className:"donut-legend-value",children:Ue(p.payload.value)})]},`legend-${k}`))})};return!l.length||c===0?e.jsx("div",{className:"cost-donut empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No cost data available."}),e.jsx("span",{children:"Add labor, disposal, or custom costs to see breakdown."})]})}):e.jsx("div",{className:"cost-donut",children:e.jsxs("div",{className:"donut-chart-container",children:[e.jsx(Et,{width:"100%",height:200,children:e.jsxs(Ri,{children:[e.jsx(Ti,{data:l,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",onMouseEnter:u,onMouseLeave:m,onClick:d,animationDuration:js.duration,animationEasing:"ease-out",children:l.map((y,h)=>e.jsx(Fi,{fill:y.color,stroke:"var(--card-bg)",strokeWidth:2,style:{filter:r===h?"brightness(1.1)":"none",cursor:a?"pointer":"default",transform:r===h?"scale(1.05)":"scale(1)",transformOrigin:"center",transition:"all 0.2s ease"}},`cell-${h}`))}),e.jsx(Pt,{content:e.jsx(j,{})}),e.jsx(Xs,{content:v})]})}),e.jsxs("div",{className:"donut-center-label",children:[e.jsx("span",{className:"donut-center-value",children:Ue(c)}),e.jsx("span",{className:"donut-center-text",children:"Total"})]})]})})}const Be=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0);function tc({revenue:s,totalCosts:t,contractValue:n,progress:a}){const r=s-t,i=s>0?r/s*100:0,l=n,c=a>0?t/(a/100):t,u=l-c,m=l>0?u/l*100:0,d=i>=20,j=i>=0&&i<20,v=i<0,y=d?"healthy":j?"warning":"loss",h=d?"On Track":j?"Watch Margin":"Over Cost",p=d?Ki:j?Ns:Cs;return e.jsxs("div",{className:`profitability-card ${y}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${y}`,children:[e.jsx(p,{size:14}),e.jsx("span",{children:h})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${i<0?"negative":""}`,children:[Math.round(i),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${i<0?"negative":i<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(i),100)}%`}})})]}),a>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${m<0?"negative":""}`,children:[Math.round(m),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${m<0?"negative":m<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(m),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:Be(s)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",Be(t)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${r<0?"negative":"positive"}`,children:[r>=0?"":"-",Be(Math.abs(r))]})]})]}),a>10&&e.jsxs("div",{className:"profitability-insight",children:[d&&e.jsxs("p",{children:["At ",Math.round(a),"% complete, you're at ",Be(r)," profit.",u>0&&` Projected final profit: ${Be(u)}`]}),j&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",u<0&&` Trending toward ${Be(u)} loss.`]}),v&&e.jsxs("p",{children:["Currently over cost by ",Be(Math.abs(r)),". Immediate review recommended."]})]})]})}const vt=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Vs={labor:{label:"Labor",Icon:He,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Ge,color:"#10b981"},equipment:{label:"Equipment",Icon:gt,color:"#f59e0b"},materials:{label:"Materials",Icon:Bs,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:Re,color:"#ec4899"},other:{label:"Other",Icon:Yi,color:"#6b7280"}};function ac({laborCost:s=0,haulOffCost:t=0,customCosts:n=[],onAddCost:a,onDeleteCost:r}){const[i,l]=o.useState(!0),[c,u]=o.useState(null),m=[];s>0&&m.push({category:"labor",label:"Labor",amount:s,source:"auto",description:"From crew check-ins"}),t>0&&m.push({category:"disposal",label:"Disposal",amount:t,source:"auto",description:"From haul-off logs"});const d={};n.forEach(h=>{d[h.category]||(d[h.category]={category:h.category,items:[],total:0}),d[h.category].items.push(h),d[h.category].total+=parseFloat(h.amount)||0}),Object.values(d).forEach(h=>{const p=Vs[h.category]||Vs.other;m.push({category:h.category,label:p.label,amount:h.total,source:"manual",items:h.items})});const j=m.reduce((h,p)=>h+p.amount,0);m.forEach(h=>{h.percentage=j>0?h.amount/j*100:0}),m.sort((h,p)=>p.amount-h.amount);const v=h=>{u(c===h?null:h)},y=h=>{h.items&&h.items.length>0&&(l(!1),u(h.category))};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsxs("div",{className:"cost-contributors-title",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:vt(j)})]}),m.length>0&&e.jsxs("div",{className:"cost-view-toggle",children:[e.jsx("button",{className:i?"active":"",onClick:()=>l(!0),children:"Chart"}),e.jsx("button",{className:i?"":"active",onClick:()=>l(!1),children:"List"})]})]}),m.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):i?e.jsx(sc,{laborCost:s,haulOffCost:t,customCosts:n,onSegmentClick:y}):e.jsx("div",{className:"cost-breakdown",children:m.map(h=>{const p=Vs[h.category]||Vs.other,k=p.Icon,R=h.items&&h.items.length>0,x=c===h.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${R?"expandable":""}`,onClick:()=>R&&v(h.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(h.percentage,2)}%`,backgroundColor:p.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(k,{size:14,style:{color:p.color}}),e.jsx("span",{children:h.label}),h.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),R&&(x?e.jsx(Js,{size:14}):e.jsx(Je,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:vt(h.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(h.percentage),"%"]})]})]})]}),x&&R&&e.jsx("div",{className:"cost-category-items",children:h.items.map(F=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:F.description}),e.jsx("span",{className:"cost-item-date",children:new Date(F.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:vt(F.amount)}),r&&e.jsx("button",{className:"cost-item-delete",onClick:g=>{g.stopPropagation(),confirm("Delete this cost entry?")&&r(F.id)},children:e.jsx(cn,{size:14})})]})]},F.id))})]},h.category)})}),a&&e.jsxs("button",{className:"cost-add-btn",onClick:a,children:[e.jsx(bs,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const bn=[{value:"concrete",label:"Concrete",icon:"🧱"},{value:"trash",label:"Trash",icon:"🗑️"},{value:"metals",label:"Metals",icon:"🔩"},{value:"hazardous_waste",label:"Hazardous",icon:"☣️"}],nc=s=>bn.find(t=>t.value===s)||{label:s,icon:"📦"};function rc({project:s,period:t="week"}){const[n,a]=o.useState([]),[r,i]=o.useState(!0),[l,c]=o.useState(!1);o.useEffect(()=>{s?.id&&u()},[s?.id,t]);const u=async()=>{try{i(!0);const h=t==="week"?7:t==="month"?30:14,p=await W.getDisposalLoadsHistory(s.id,h);a(p||[])}catch(h){console.error("Error loading disposal summary:",h)}finally{i(!1)}},m=n.reduce((h,p)=>{const k=p.load_type;return h[k]||(h[k]=0),h[k]+=p.load_count,h},{}),d=n.reduce((h,p)=>{const k=p.load_date||p.work_date;return h[k]||(h[k]={date:k,loads:[],total:0}),h[k].loads.push(p),h[k].total+=p.load_count,h},{}),j=Object.values(d).sort((h,p)=>new Date(p.date)-new Date(h.date)).slice(0,7),v=n.reduce((h,p)=>h+p.load_count,0),y=v>0;return r?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Ge,{size:18}),e.jsx("span",{children:"Disposal Loads"})]})}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Ge,{size:18}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("span",{className:"period-badge",children:t==="week"?"Last 7 days":t==="month"?"Last 30 days":"Last 14 days"})]}),y?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"disposal-total-value",children:v}),e.jsx("span",{className:"disposal-total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:bn.map(h=>{const p=m[h.value]||0;if(p===0)return null;const k=Math.round(p/v*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"disposal-type-info",children:[e.jsx("span",{className:"disposal-type-icon",children:h.icon}),e.jsx("span",{className:"disposal-type-label",children:h.label})]}),e.jsxs("div",{className:"disposal-type-stats",children:[e.jsx("span",{className:"disposal-type-count",children:p}),e.jsx("div",{className:"disposal-type-bar",children:e.jsx("div",{className:"disposal-type-bar-fill",style:{width:`${k}%`}})})]})]},h.value)})}),j.length>0&&e.jsxs("button",{className:"disposal-expand-btn",onClick:()=>c(!l),children:[l?e.jsx(Js,{size:16}):e.jsx(Je,{size:16}),e.jsxs("span",{children:[l?"Hide":"View"," Daily Breakdown"]})]}),l&&j.length>0&&e.jsx("div",{className:"disposal-daily-breakdown",children:j.map(h=>{const p=new Date(h.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),k=h.loads.reduce((R,x)=>(R[x.load_type]||(R[x.load_type]=0),R[x.load_type]+=x.load_count,R),{});return e.jsxs("div",{className:"disposal-daily-row",children:[e.jsxs("div",{className:"disposal-daily-header",children:[e.jsx("span",{className:"disposal-daily-date",children:p}),e.jsxs("span",{className:"disposal-daily-total",children:[h.total," loads"]})]}),e.jsx("div",{className:"disposal-daily-types",children:Object.entries(k).map(([R,x])=>{const F=nc(R);return e.jsxs("span",{className:"disposal-daily-type",children:[F.icon," ",x]},R)})})]},h.date)})})]}):e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx(Ge,{size:32}),e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("span",{className:"text-muted",children:"Loads will appear here when logged by field crews"})]})]})}const jt=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",ic=o.memo(function({project:t,onAddEquipment:n,onEditEquipment:a,onShowToast:r}){const[i,l]=o.useState([]),[c,u]=o.useState(!0),[m,d]=o.useState(!0),[j,v]=o.useState(0),y=o.useCallback(async()=>{if(t?.id)try{u(!0);const x=await es.getProjectEquipment(t.id);l(x||[]);const F=es.calculateProjectEquipmentCost(x||[]);v(F)}catch(x){console.error("Error loading equipment:",x),r?.("Failed to load equipment","error")}finally{u(!1)}},[t?.id]);o.useEffect(()=>{y()},[y]);const h=o.useCallback(async x=>{try{await es.markEquipmentReturned(x.id),r?.(`${x.equipment_name} marked as returned`,"success"),y()}catch(F){console.error("Error marking equipment returned:",F),r?.("Failed to update equipment","error")}},[y]),p=o.useCallback(async x=>{if(confirm(`Remove ${x.equipment_name} from this project?`))try{await es.removeEquipmentFromProject(x.id),r?.("Equipment removed","success"),y()}catch(F){console.error("Error removing equipment:",F),r?.("Failed to remove equipment","error")}},[y]),k=o.useMemo(()=>i.filter(x=>!x.end_date),[i]),R=o.useMemo(()=>i.filter(x=>x.end_date),[i]);return e.jsxs("div",{className:"project-equipment-card",children:[e.jsxs("div",{className:"project-equipment-header",children:[e.jsxs("div",{className:"project-equipment-title",children:[e.jsx(Ge,{size:18}),e.jsx("h3",{children:"Equipment on Site"}),i.length>0&&e.jsxs("span",{className:"equipment-count",children:[k.length," active"]})]}),e.jsxs("div",{className:"project-equipment-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>n?.(),title:"Add equipment",children:[e.jsx(bs,{size:14}),e.jsx("span",{children:"Add"})]}),i.length>0&&e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>d(!m),children:m?e.jsx(Js,{size:16}):e.jsx(Je,{size:16})})]})]}),c?e.jsx("div",{className:"equipment-loading",children:e.jsx("div",{className:"loading-spinner small"})}):i.length===0?e.jsxs("div",{className:"equipment-empty",children:[e.jsx("p",{children:"No equipment tracked on this project"}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>n?.(),children:[e.jsx(bs,{size:14}),"Track Equipment"]})]}):m?e.jsxs(e.Fragment,{children:[k.length>0&&e.jsx("div",{className:"equipment-list",children:k.map(x=>{const F=es.calculateDaysOnSite(x.start_date,x.end_date),g=x.daily_rate*F;return e.jsxs("div",{className:"equipment-item active",children:[e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:x.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[e.jsx(Ys,{size:12}),"On-site since ",jt(x.start_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-rate",children:[Ne(x.daily_rate),"/day"]}),e.jsxs("span",{className:"equipment-days",children:[F," days"]}),e.jsx("span",{className:"equipment-total",children:Ne(g)})]})]}),e.jsxs("div",{className:"equipment-item-actions",children:[e.jsxs("button",{className:"btn btn-xs btn-outline",onClick:()=>h(x),title:"Mark as returned",children:[e.jsx(Ji,{size:12}),"Returned"]}),e.jsx("button",{className:"btn btn-xs btn-ghost",onClick:()=>a?.(x),title:"Edit",children:e.jsx(Xi,{size:12})}),e.jsx("button",{className:"btn btn-xs btn-ghost text-danger",onClick:()=>p(x),title:"Remove",children:e.jsx(cn,{size:12})})]})]},x.id)})}),R.length>0&&e.jsxs("details",{className:"equipment-returned-section",children:[e.jsx("summary",{className:"equipment-returned-toggle",children:e.jsxs("span",{children:["Returned Equipment (",R.length,")"]})}),e.jsx("div",{className:"equipment-list returned",children:R.map(x=>{const F=es.calculateDaysOnSite(x.start_date,x.end_date),g=x.daily_rate*F;return e.jsx("div",{className:"equipment-item returned",children:e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:x.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[jt(x.start_date)," - ",jt(x.end_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-days",children:[F," days"]}),e.jsx("span",{className:"equipment-total",children:Ne(g)})]})]})},x.id)})})]}),e.jsxs("div",{className:"equipment-total-row",children:[e.jsx("span",{children:"Total Equipment Cost"}),e.jsx("span",{className:"equipment-grand-total",children:Ne(j)})]})]}):e.jsxs("div",{className:"equipment-summary-collapsed",children:[e.jsxs("span",{children:[k.length," active, ",R.length," returned"]}),e.jsx("span",{className:"equipment-grand-total",children:Ne(j)})]})]})}),lc=o.memo(function({project:t,areas:n=[],corStats:a={},onCreateDraw:r,onViewDraw:i,onShowToast:l}){const[c,u]=o.useState([]),[m,d]=o.useState(!0),j=o.useMemo(()=>n.reduce((g,C)=>{const L=(C.square_footage||0)*(C.price_per_sqft||0);return g+Math.round(L*100)},0),[n]),v=o.useMemo(()=>a?.approvedTotal||0,[a?.approvedTotal]),y=j+v,h=o.useCallback(async()=>{if(t?.id)try{d(!0);const g=await Oi.getProjectDrawRequests(t.id);u(g||[])}catch(g){console.error("Error loading draw requests:",g)}finally{d(!1)}},[t?.id]);o.useEffect(()=>{h()},[h]);const p=o.useMemo(()=>{const g=c.filter(P=>["submitted","approved","paid"].includes(P.status)),C=g.reduce((P,S)=>P+(S.previous_billings||0)+(S.current_billing||0),0),B=g[0]?.retention_held||0;return{billedToDate:C,retentionHeld:B}},[c]),k=y>0?Math.round(p.billedToDate/y*100):0,R=c.length>0?Math.max(...c.map(g=>g.draw_number))+1:1,x=g=>g?new Date(g).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",F=g=>{switch(g){case"draft":return e.jsx("span",{className:"badge badge-muted",children:"Draft"});case"submitted":return e.jsx("span",{className:"badge badge-warning",children:"Submitted"});case"approved":return e.jsx("span",{className:"badge badge-success",children:"Approved"});case"paid":return e.jsx("span",{className:"badge badge-info",children:"Paid"});case"rejected":return e.jsx("span",{className:"badge badge-danger",children:"Rejected"});default:return null}};return e.jsxs("div",{className:"progress-billing-card",children:[e.jsxs("div",{className:"progress-billing-header",children:[e.jsxs("div",{className:"progress-billing-title",children:[e.jsx(Qi,{size:18}),e.jsx("h3",{children:"Progress Billing"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>r?.(),disabled:j===0,title:j===0?"Add areas with contract values first":`Create Draw #${R}`,children:[e.jsx(bs,{size:14}),e.jsxs("span",{children:["Draw #",R]})]})]}),e.jsxs("div",{className:"progress-billing-contract",children:[e.jsxs("div",{className:"contract-row",children:[e.jsx("span",{className:"contract-label",children:"Original Contract"}),e.jsx("span",{className:"contract-value",children:Ne(j)})]}),v>0&&e.jsxs("div",{className:"contract-row co",children:[e.jsx("span",{className:"contract-label",children:"Approved COs"}),e.jsxs("span",{className:"contract-value positive",children:["+",Ne(v)]})]}),e.jsxs("div",{className:"contract-row revised",children:[e.jsx("span",{className:"contract-label",children:"Revised Contract"}),e.jsx("span",{className:"contract-value",children:Ne(y)})]})]}),e.jsxs("div",{className:"progress-billing-status",children:[e.jsx("div",{className:"billing-progress-bar",children:e.jsx("div",{className:"billing-progress-fill",style:{width:`${Math.min(k,100)}%`}})}),e.jsxs("div",{className:"billing-stats",children:[e.jsxs("div",{className:"billing-stat",children:[e.jsx("span",{className:"billing-stat-value",children:Ne(p.billedToDate)}),e.jsxs("span",{className:"billing-stat-label",children:["Billed to Date (",k,"%)"]})]}),p.retentionHeld>0&&e.jsxs("div",{className:"billing-stat retention",children:[e.jsxs("span",{className:"billing-stat-value",children:["-",Ne(p.retentionHeld)]}),e.jsx("span",{className:"billing-stat-label",children:"Retention Held"})]}),e.jsxs("div",{className:"billing-stat remaining",children:[e.jsx("span",{className:"billing-stat-value",children:Ne(y-p.billedToDate)}),e.jsx("span",{className:"billing-stat-label",children:"Balance to Finish"})]})]})]}),m?e.jsx("div",{className:"progress-billing-loading",children:e.jsx("div",{className:"loading-spinner small"})}):c.length===0?e.jsxs("div",{className:"progress-billing-empty",children:[e.jsx("p",{children:"No draw requests yet"}),j>0&&e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>r?.(),children:[e.jsx(bs,{size:14}),"Create First Draw Request"]})]}):e.jsxs("div",{className:"progress-billing-draws",children:[e.jsx("div",{className:"draws-header",children:e.jsx("span",{children:"Recent Draws"})}),e.jsx("div",{className:"draws-list",children:c.slice(0,3).map(g=>e.jsxs("button",{className:"draw-item",onClick:()=>i?.(g),children:[e.jsxs("div",{className:"draw-item-info",children:[e.jsxs("span",{className:"draw-number",children:["Draw #",g.draw_number]}),e.jsx("span",{className:"draw-date",children:x(g.period_end||g.created_at)})]}),e.jsx("div",{className:"draw-item-amount",children:Ne(g.current_billing||0)}),F(g.status),e.jsx(Le,{size:16,className:"draw-item-arrow"})]},g.id))}),c.length>3&&e.jsxs("button",{className:"btn btn-sm btn-ghost view-all-draws",children:["View all ",c.length," draws"]})]})]})});function oc({project:s,company:t,onShowToast:n}){const[a,r]=o.useState(null),[i,l]=o.useState(!0),[c,u]=o.useState(!1);o.useEffect(()=>{if(s?.id&&t?.id){m();const h=W.subscribeToCrewCheckins?.(s.id,()=>{m()});return()=>{h&&W.unsubscribe?.(h)}}},[s?.id,t?.id]);const m=async()=>{try{const h=await W.calculateManDayCosts(s.id,t.id,s.work_type||"demolition",s.job_type||"standard");r(h)}catch(h){console.error("Error loading man day costs:",h)}finally{l(!1)}},d=h=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(h),j=h=>new Date(h).toLocaleDateString("en-US",{month:"short",day:"numeric"}),v=h=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[h]||h.charAt(0).toUpperCase()+h.slice(1);if(i)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!a||a.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(He,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const y=Object.entries(a.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>u(!c),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:d(a.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:c?"▼ Collapse":"▶ Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:d(a.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.daysWorked>0?d(a.totalCost/a.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),c&&e.jsxs("div",{className:"man-day-details",children:[y.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:y.map(([h,p])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:v(h)}),e.jsxs("span",{className:"role-rate",children:[d(p.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[p.count," days"]}),e.jsx("span",{className:"role-cost",children:d(p.cost)})]})]},h))})]}),a.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:a.byDate.slice(0,7).map((h,p)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:j(h.date)}),e.jsxs("span",{className:"date-workers",children:[h.workers," crew"]}),e.jsx("span",{className:"date-cost",children:d(h.cost)})]},p))}),a.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",a.byDate.length-7," more days"]})]})]})]})}const $e=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),cc=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"});function dc({dailyBurn:s,totalBurn:t,daysWorked:n,laborCost:a,materialsEquipmentCost:r=0,progress:i,contractValue:l,laborByDate:c=[],materialsEquipmentByDate:u=[]}){const[m,d]=o.useState(!1),j=l*(i/100)*.6,v=t<=j?"on-budget":t<=j*1.2?"warning":"over-budget",y={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[v],h=v==="on-budget"?Cs:v==="warning"?Rt:ws,k=i>0?t/(i/100):0,R=[],x={};c.forEach(g=>{x[g.date]||(x[g.date]={date:g.date,labor:0,materialsEquipment:0,total:0}),x[g.date].labor=g.cost||0,x[g.date].total+=g.cost||0}),u.forEach(g=>{x[g.date]||(x[g.date]={date:g.date,labor:0,materialsEquipment:0,total:0}),x[g.date].materialsEquipment=g.cost||0,x[g.date].total+=g.cost||0}),Object.values(x).sort((g,C)=>new Date(C.date)-new Date(g.date)).slice(0,10).forEach(g=>R.push(g));const F=Math.max(...R.map(g=>g.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(Zi,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${v}`,children:[e.jsx(h,{size:14}),e.jsx("span",{children:y})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:$e(s)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),n>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",n," work day",n!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:$e(t)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:$e(a)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Materials"}),e.jsx("span",{className:"burn-summary-value",children:$e(r)})]})]}),i>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${k>l*.7?"warning":""}`,children:$e(k)})]}),R.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>d(!m),children:[m?e.jsx(Js,{size:16}):e.jsx(Je,{size:16}),e.jsxs("span",{children:[m?"Hide":"View"," Daily Breakdown"]})]}),m&&R.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Materials"}),e.jsx("span",{children:"Total"})]}),R.map(g=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:cc(g.date)}),e.jsx("span",{className:"burn-labor",children:g.labor>0?$e(g.labor):"-"}),e.jsx("span",{className:"burn-materials",children:g.materialsEquipment>0?$e(g.materialsEquipment):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${g.total/F*100}%`}}),e.jsx("span",{className:"burn-amount",children:$e(g.total)})]})]},g.date))]})]})}const uc=()=>ce(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]);function yn({project:s,company:t,onShowToast:n}){const{branding:a}=tn(),[r,i]=o.useState([]),[l,c]=o.useState(!0),[u,m]=o.useState(null),[d,j]=o.useState(null),[v,y]=o.useState(new Set),[h,p]=o.useState(!1),[k,R]=o.useState("recent"),[x,F]=o.useState(new Set),[g,C]=o.useState({start:"",end:""});o.useEffect(()=>{L();const b=W.subscribeToDailyReports?.(s.id,()=>{L()});return()=>{b&&W.unsubscribe?.(b)}},[s.id]);const L=o.useCallback(async()=>{try{m(null);const b=await W.getDailyReports(s.id,365);i(b||[])}catch(b){console.error("Error loading daily reports:",b),m(b),n?.("Error loading daily reports","error")}finally{c(!1)}},[s.id]),B=o.useMemo(()=>{let b=[...r];if(g.start){const w=new Date(g.start);w.setHours(0,0,0,0),b=b.filter(G=>new Date(G.report_date||G.created_at)>=w)}if(g.end){const w=new Date(g.end);w.setHours(23,59,59,999),b=b.filter(G=>new Date(G.report_date||G.created_at)<=w)}if(k==="recent"){const w=new Date;w.setDate(w.getDate()-7),w.setHours(0,0,0,0),b=b.filter(G=>new Date(G.report_date||G.created_at)>=w)}return b},[r,k,g]),P=o.useMemo(()=>{if(k!=="all")return null;const b={};return B.forEach(w=>{const G=new Date(w.report_date||w.created_at),E=`${G.getFullYear()}-${String(G.getMonth()+1).padStart(2,"0")}`,X=G.toLocaleDateString("en-US",{month:"long",year:"numeric"});b[E]||(b[E]={label:X,reports:[]}),b[E].reports.push(w)}),Object.entries(b).sort((w,G)=>G[0].localeCompare(w[0]))},[B,k]);o.useEffect(()=>{if(P&&P.length>0){const b=P[0][0];F(new Set([b]))}},[P]);const S=()=>{p(!h),h&&y(new Set)},A=b=>{const w=new Set(v);w.has(b)?w.delete(b):w.add(b),y(w)},z=()=>{v.size===B.length?y(new Set):y(new Set(B.map(b=>b.id)))},O=b=>{const w=new Set(x);w.has(b)?w.delete(b):w.add(b),F(w)},V=()=>v.size>0?B.filter(b=>v.has(b.id)):B,D=b=>new Date(b).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),te=b=>new Date(b).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),I=b=>{switch(b){case"submitted":return"✓";case"reviewed":return"✓✓";case"draft":return"○";default:return"○"}},de=b=>{switch(b){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return b}},je=async()=>{const b=V();if(b.length===0){n?.("No reports to export","error");return}n?.("Generating PDF...","info");const G=(await uc()).default,E=new G,X=E.internal.pageSize.getWidth(),ee=20;let ne=ee;const fe=fs(a?.primary_color||"#3B82F6"),Xe=fs(a?.secondary_color||"#1E40AF");E.setFillColor(...fe),E.rect(0,0,X,45,"F"),E.setFillColor(...Xe),E.rect(0,42,X,3,"F");let Ee=ee;if(a?.logo_url)try{const ae=await an(a.logo_url);ae&&(E.addImage(ae,"PNG",ee,7,30,30),Ee=ee+40)}catch(ae){console.error("Error adding logo:",ae)}E.setTextColor(255,255,255),E.setFontSize(22),E.setFont("helvetica","bold"),E.text(t?.name||"Company Name",Ee,20),E.setFontSize(10),E.setFont("helvetica","normal"),E.text("DAILY REPORTS SUMMARY",Ee,30),E.setFontSize(9),E.text(`Generated: ${new Date().toLocaleDateString()}`,X-ee,20,{align:"right"}),s.job_number&&E.text(`Job #: ${s.job_number}`,X-ee,28,{align:"right"}),ne=55,E.setFillColor(248,250,252),E.rect(ee,ne-5,X-ee*2,20,"F"),E.setTextColor(...fe),E.setFontSize(14),E.setFont("helvetica","bold"),E.text(`Project: ${s.name}`,ee+5,ne+7),E.setFontSize(10),E.setTextColor(100,100,100),E.text(`${b.length} Report${b.length!==1?"s":""}`,X-ee-5,ne+7,{align:"right"}),ne+=25,b.forEach((ae,Ce)=>{ne>250&&(E.addPage(),ne=ee),E.setFillColor(...fe),E.setTextColor(255,255,255),E.rect(ee,ne,X-ee*2,10,"F"),E.setFontSize(11),E.setFont("helvetica","bold"),E.text(D(ae.report_date||ae.created_at),ee+5,ne+7),E.text(de(ae.status),X-ee-5,ne+7,{align:"right"}),ne+=15,E.setTextColor(50,50,50),E.setFontSize(10),E.setFont("helvetica","normal");const et=`Crew: ${ae.crew_count||0}  |  Tasks: ${ae.tasks_completed||0}  |  T&M: ${ae.tm_tickets_count||0}  |  Photos: ${ae.photos_count||0}`;if(E.text(et,ee+5,ne),ne+=8,ae.crew_list?.length>0){E.setFont("helvetica","bold"),E.text("Crew:",ee+5,ne),E.setFont("helvetica","normal");const ke=ae.crew_list.map(cs=>`${cs.name} (${cs.role})`).join(", "),Ss=E.splitTextToSize(ke,X-ee*2-30);E.text(Ss,ee+25,ne),ne+=Ss.length*5+3}if(ae.field_notes){E.setFont("helvetica","bold"),E.text("Notes:",ee+5,ne),E.setFont("helvetica","normal");const ke=E.splitTextToSize(ae.field_notes,X-ee*2-30);E.text(ke,ee+25,ne),ne+=ke.length*5+3}if(ae.issues){E.setTextColor(180,50,50),E.setFont("helvetica","bold"),E.text("Issues:",ee+5,ne),E.setFont("helvetica","normal");const ke=E.splitTextToSize(ae.issues,X-ee*2-30);E.text(ke,ee+25,ne),E.setTextColor(50,50,50),ne+=ke.length*5+3}ne+=10});const se=E.internal.getNumberOfPages();for(let ae=1;ae<=se;ae++)E.setPage(ae),E.setFontSize(8),E.setTextColor(150,150,150),E.text(`Page ${ae} of ${se}`,X/2,E.internal.pageSize.getHeight()-10,{align:"center"});const Fe=`${s.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;E.save(Fe),n?.("PDF exported!","success")},he=b=>e.jsxs("div",{className:`daily-report-card ${b.status} ${v.has(b.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>j(d===b.id?null:b.id),children:[h&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:v.has(b.id),onChange:w=>{w.stopPropagation(),A(b.id)},onClick:w=>w.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:D(b.report_date||b.created_at)}),e.jsxs("span",{className:`report-status ${b.status}`,children:[I(b.status)," ",de(b.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[b.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[b.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:d===b.id?"▼":"▶"})]})]}),d===b.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:b.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),b.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:b.crew_list.map((w,G)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:w.name}),e.jsx("span",{className:"crew-role",children:w.role})]},G))})]}),b.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:b.completed_tasks.map((w,G)=>e.jsxs("li",{children:[w.name,w.group&&e.jsx("span",{className:"task-group",children:w.group})]},G))})]}),b.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:b.field_notes})]}),b.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:b.issues})]}),b.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",b.submitted_by||"Field"," at ",te(b.submitted_at)]})})]})]},b.id);if(l)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});if(u)return e.jsx("div",{className:"daily-reports-list card",children:e.jsx(gn,{title:"Unable to load reports",message:"There was a problem loading daily reports. Please try again.",error:u,onRetry:L})});const De=r.length,$=B.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:r.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${h?"btn-primary":"btn-secondary"}`,onClick:S,children:h?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:je,children:["PDF",v.size>0?` (${v.size})`:""]})]})})]}),r.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${k==="recent"?"active":""}`,onClick:()=>R("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${k==="all"?"active":""}`,onClick:()=>R("all"),children:["All (",De,")"]})]}),k==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Ys,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:g.start,onChange:b=>C(w=>({...w,start:b.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:g.end,onChange:b=>C(w=>({...w,end:b.target.value})),className:"date-input"}),(g.start||g.end)&&e.jsx("button",{className:"date-clear",onClick:()=>C({start:"",end:""}),children:"Clear"})]})]}),h&&B.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:v.size===B.length&&B.length>0,onChange:z}),"Select All (",B.length,")"]}),v.size>0&&e.jsxs("span",{className:"selected-count",children:[v.size," selected"]})]}),r.length===0?e.jsx(za,{icon:ge,title:"No daily reports yet",message:"Reports from the field will appear here"}):B.length===0?e.jsx(za,{icon:ge,title:"No reports in this time period",message:k==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"}):k==="recent"?e.jsxs("div",{className:"daily-reports",children:[B.map(b=>he(b)),De>$&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>R("all"),children:["View All ",De," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:P?.map(([b,{label:w,reports:G}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>O(b),children:[x.has(b)?e.jsx(Je,{size:18,className:"month-chevron"}):e.jsx(Le,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:w}),e.jsxs("span",{className:"month-count",children:[G.length," report",G.length!==1?"s":""]})]}),x.has(b)&&e.jsx("div",{className:"month-reports",children:G.map(E=>he(E))})]},b))})]})}const mc=Object.freeze(Object.defineProperty({__proto__:null,default:yn},Symbol.toStringTag,{value:"Module"})),Ba=o.memo(function({report:t,formatDate:n,formatTime:a,getInjuryTypeColor:r,getInjuryTypeLabel:i,getStatusColor:l,onViewDetails:c}){const u=()=>c(t),m=d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),c(t))};return e.jsxs("div",{className:"report-card",onClick:u,onKeyDown:m,role:"button",tabIndex:0,"aria-label":`Injury report for ${t.employee_name} on ${n(t.incident_date)}`,children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[n(t.incident_date)," at ",a(t.incident_time)]}),e.jsx("div",{className:"employee-name",children:t.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:r(t.injury_type)},children:i(t.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:l(t.status)},children:t.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",t.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",t.reported_by_name," (",t.reported_by_title,")"]}),t.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",t.body_part_affected]}),t.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[t.incident_description.substring(0,150),t.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]})}),hc=()=>ce(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]);function Nn({project:s,companyId:t,company:n,user:a,onShowToast:r}){const{branding:i}=tn(),[l,c]=o.useState([]),[u,m]=o.useState(null),[d,j]=o.useState(!1),[v,y]=o.useState(!0),[h,p]=o.useState(null),[k,R]=o.useState(null),[x,F]=o.useState("recent"),[g,C]=o.useState(new Set),[L,B]=o.useState({start:"",end:""});o.useEffect(()=>{P();const $=t||s?.company_id,b=$?W.subscribeToInjuryReports?.($,()=>{P()}):null;return()=>{b&&W.unsubscribe?.(b)}},[s?.id,t]);const P=o.useCallback(async()=>{y(!0),p(null);try{const $=s?await W.getInjuryReports(s.id):await W.getCompanyInjuryReports(t);c($)}catch($){console.error("Error loading injury reports:",$),p($),R({type:"error",message:"Failed to load injury reports"})}finally{y(!1)}},[s?.id,t]),S=()=>{P(),j(!1),R({type:"success",message:"Injury report created successfully"})},A=$=>{m($)},z=()=>{m(null)},O=$=>$?new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",V=$=>$?new Date(`2000-01-01T${$}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",D=$=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[$]||$,te=$=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[$]||"#9ca3af",I=$=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[$]||"#9ca3af",de=o.useMemo(()=>{let $=[...l];if(L.start){const b=new Date(L.start);b.setHours(0,0,0,0),$=$.filter(w=>new Date(w.incident_date)>=b)}if(L.end){const b=new Date(L.end);b.setHours(23,59,59,999),$=$.filter(w=>new Date(w.incident_date)<=b)}if(x==="recent"){const b=new Date;b.setDate(b.getDate()-7),b.setHours(0,0,0,0),$=$.filter(w=>new Date(w.incident_date)>=b)}return $},[l,x,L]),je=o.useMemo(()=>{if(x!=="all")return null;const $={};return de.forEach(b=>{const w=new Date(b.incident_date),G=`${w.getFullYear()}-${String(w.getMonth()+1).padStart(2,"0")}`,E=w.toLocaleDateString("en-US",{month:"long",year:"numeric"});$[G]||($[G]={label:E,reports:[]}),$[G].reports.push(b)}),Object.entries($).sort((b,w)=>w[0].localeCompare(b[0]))},[de,x]);o.useEffect(()=>{if(je&&je.length>0){const $=je[0][0];C(new Set([$]))}},[je]);const he=$=>{const b=new Set(g);b.has($)?b.delete($):b.add($),C(b)},De=async()=>{if(l.length===0){R({type:"error",message:"No reports to export"});return}R({type:"info",message:"Generating PDF..."});const b=(await hc()).default,w=new b,G=w.internal.pageSize.getWidth(),E=20;let X=E;const ee=fs(i?.primary_color||"#3B82F6"),ne=fs(i?.secondary_color||"#1E40AF");w.setFillColor(...ee),w.rect(0,0,G,45,"F"),w.setFillColor(...ne),w.rect(0,42,G,3,"F");let fe=E;if(i?.logo_url)try{const se=await an(i.logo_url);se&&(w.addImage(se,"PNG",E,7,30,30),fe=E+40)}catch(se){console.error("Error adding logo:",se)}w.setTextColor(255,255,255),w.setFontSize(22),w.setFont("helvetica","bold"),w.text(n?.name||"Company",fe,20),w.setFontSize(10),w.setFont("helvetica","normal"),w.text("INJURY & INCIDENT REPORTS",fe,30),w.setFontSize(9),w.text(`Generated: ${new Date().toLocaleDateString()}`,G-E,20,{align:"right"}),w.text(`Total Reports: ${l.length}`,G-E,28,{align:"right"}),X=55,s&&(w.setFillColor(248,250,252),w.rect(E,X-5,G-E*2,15,"F"),w.setTextColor(...ee),w.setFontSize(12),w.setFont("helvetica","bold"),w.text(`Project: ${s.name}`,E+5,X+5),X+=20),l.forEach(se=>{X>200&&(w.addPage(),X=E);const Fe=fs(I(se.injury_type));w.setFillColor(...Fe),w.rect(E,X,G-E*2,12,"F"),w.setTextColor(255,255,255),w.setFontSize(11),w.setFont("helvetica","bold"),w.text(`${se.employee_name} - ${D(se.injury_type)}`,E+5,X+8),w.text(O(se.incident_date),G-E-5,X+8,{align:"right"}),X+=17,w.setTextColor(50,50,50),w.setFontSize(9),w.setFont("helvetica","normal"),w.text(`Location: ${se.incident_location}`,E+5,X),se.incident_time&&w.text(`Time: ${V(se.incident_time)}`,E+100,X),X+=6,w.setFont("helvetica","bold"),w.text("Description:",E+5,X),w.setFont("helvetica","normal"),X+=5;const ae=w.splitTextToSize(se.incident_description,G-E*2-10);w.text(ae,E+5,X),X+=ae.length*4+3;const Ce=[];se.body_part_affected&&Ce.push(`Body Part: ${se.body_part_affected}`),se.osha_recordable&&Ce.push("OSHA Recordable"),se.workers_comp_claim&&Ce.push("Workers' Comp Filed"),se.medical_treatment_required&&Ce.push("Medical Treatment Required"),Ce.length>0&&(w.setFontSize(8),w.setTextColor(100,100,100),w.text(Ce.join("  |  "),E+5,X),X+=5),w.setFontSize(8),w.text(`Reported by: ${se.reported_by_name} (${se.reported_by_title})`,E+5,X),X+=12});const Xe=w.internal.getNumberOfPages();for(let se=1;se<=Xe;se++)w.setPage(se),w.setFontSize(8),w.setTextColor(150,150,150),w.text(`Page ${se} of ${Xe}`,G/2,w.internal.pageSize.getHeight()-10,{align:"center"}),w.text("CONFIDENTIAL - Injury Report",E,w.internal.pageSize.getHeight()-10);const Ee=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;w.save(Ee),R({type:"success",message:"PDF exported!"})};return v?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):h?e.jsx("div",{className:"injury-reports-section card",children:e.jsx(gn,{title:"Unable to load reports",message:"There was a problem loading injury reports. Please try again.",error:h,onRetry:P})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[l.length>0&&e.jsx("button",{className:"btn-secondary",onClick:De,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>j(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${x==="recent"?"active":""}`,onClick:()=>{F("recent"),B({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${x==="all"?"active":""}`,onClick:()=>F("all"),children:["All (",l.length,")"]})]}),x==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Ys,{size:16}),e.jsx("input",{type:"date",value:L.start,onChange:$=>B(b=>({...b,start:$.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:L.end,onChange:$=>B(b=>({...b,end:$.target.value})),placeholder:"End date"}),(L.start||L.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>B({start:"",end:""}),children:"Clear"})]})]}),de.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:"🏥"}),e.jsxs("h4",{children:["No Injury Reports",x==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),x==="recent"&&l.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>F("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:x==="all"&&je?je.map(([$,b])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>he($),children:e.jsxs("div",{className:"month-header-left",children:[g.has($)?e.jsx(Je,{size:18}):e.jsx(Le,{size:18}),e.jsx("span",{className:"month-label",children:b.label}),e.jsxs("span",{className:"month-count",children:[b.reports.length," reports"]})]})}),g.has($)&&e.jsx("div",{className:"month-reports",children:b.reports.map(w=>e.jsx(Ba,{report:w,formatDate:O,formatTime:V,getInjuryTypeColor:I,getInjuryTypeLabel:D,getStatusColor:te,onViewDetails:A},w.id))})]},$)):de.map($=>e.jsx(Ba,{report:$,formatDate:O,formatTime:V,getInjuryTypeColor:I,getInjuryTypeLabel:D,getStatusColor:te,onViewDetails:A},$.id))}),u&&e.jsx("div",{className:"modal-overlay",onClick:z,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:$=>$.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:z,children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[O(u.incident_date)," at ",V(u.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:u.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:I(u.injury_type)},children:D(u.injury_type)})})]}),u.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:u.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:u.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:u.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:u.employee_job_title})]}),u.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:u.employee_phone})]}),u.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:u.employee_email})]}),u.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:u.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:u.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:u.reported_by_title})]}),u.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:u.reported_by_phone})]}),u.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:u.reported_by_email})]})]})]}),u.witnesses&&u.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),u.witnesses.map(($,b)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:$.name}),$.phone&&e.jsxs("span",{children:[" • ",$.phone]}),$.email&&e.jsxs("span",{children:[" • ",$.email]})]}),$.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',$.testimony,'"']})})]},b))]}),u.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[u.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:u.medical_facility_name})]}),u.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:u.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:u.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),u.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:u.immediate_actions_taken})]}),u.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:u.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[u.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:u.safety_equipment_used})]}),u.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:u.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:u.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:u.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:u.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:u.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",O(u.created_at)]})]})]})}),d&&e.jsx(Ai,{project:s,companyId:t,user:a,onClose:()=>j(!1),onReportCreated:S}),k&&e.jsx(Mi,{message:k.message,type:k.type,onClose:()=>R(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const pc=Object.freeze(Object.defineProperty({__proto__:null,default:Nn},Symbol.toStringTag,{value:"Module"})),Wa=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function xc({project:s,company:t,user:n,isAdmin:a,onShowToast:r}){const[i,l]=o.useState([]),[c,u]=o.useState([]),[m,d]=o.useState(!0),[j,v]=o.useState(!1),[y,h]=o.useState(""),[p,k]=o.useState("Team Member"),[R,x]=o.useState(null);o.useEffect(()=>{s?.id&&F()},[s?.id]),o.useEffect(()=>{j&&t?.id&&g()},[j,t?.id]);const F=async()=>{try{d(!0);const P=await W.getProjectTeam(s.id);l(P)}catch(P){console.error("Error loading project team:",P)}finally{d(!1)}},g=async()=>{try{const P=await W.getCompanyMembers(t.id),S=i.map(z=>z.users?.id),A=P.filter(z=>!S.includes(z.users?.id));u(A)}catch(P){console.error("Error loading company members:",P)}},C=async()=>{if(!y){r("Select a team member","error");return}try{x("add"),await W.addProjectMember(s.id,y,p,n.id),r("Team member added","success"),v(!1),h(""),k("Team Member"),F()}catch(P){console.error("Error adding team member:",P),r("Error adding team member","error")}finally{x(null)}},L=async(P,S)=>{try{x(P.id),await W.updateProjectMemberRole(s.id,P.users?.id,S),r("Role updated","success"),F()}catch(A){console.error("Error updating role:",A),r("Error updating role","error")}finally{x(null)}},B=async P=>{try{x(P.id),await W.removeProjectMember(s.id,P.users?.id),r("Team member removed","success"),F()}catch(S){console.error("Error removing team member:",S),r("Error removing team member","error")}finally{x(null)}};return m?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Project Team"]}),a&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>v(!0),children:[e.jsx(el,{size:14})," Add"]})]}),i.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",a&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:i.map(P=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:P.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:P.users?.email})]}),e.jsx("div",{className:"team-member-role",children:a?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:P.project_role,onChange:S=>L(P,S.target.value),disabled:R===P.id,className:"role-select",children:Wa.map(S=>e.jsx("option",{value:S,children:S},S))}),e.jsx(Je,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:P.project_role})}),a&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>B(P),disabled:R===P.id,title:"Remove from project",children:e.jsx(sl,{size:14})})]},P.id))}),j&&e.jsx("div",{className:"modal-overlay",onClick:()=>v(!1),children:e.jsxs("div",{className:"modal-content small",onClick:P=>P.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>v(!1),children:e.jsx(ls,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:y,onChange:P=>h(P.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),c.map(P=>e.jsx("option",{value:P.users?.id,children:P.users?.name||P.users?.email},P.users?.id))]}),c.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:p,onChange:P=>k(P.target.value),className:"form-select",children:Wa.map(P=>e.jsx("option",{value:P,children:P},P))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>v(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:C,disabled:!y||R==="add",children:R==="add"?"Adding...":"Add to Project"})]})]})})]})}function vc({onShowToast:s,onClose:t}){const[n,a]=o.useState("loading"),[r,i]=o.useState([]),[l,c]=o.useState(null),[u,m]=o.useState(null),[d,j]=o.useState(null),[v,y]=o.useState(""),[h,p]=o.useState(!1),[k,R]=o.useState(!1),[x,F]=o.useState(null);o.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:A,error:z}=await hs.auth.mfa.listFactors();if(z)throw z;const O=(A?.totp||[]).filter(V=>V.status==="verified");i(O),a("overview")}catch{a("overview")}},C=async()=>{F(null);try{const{data:A,error:z}=await hs.auth.mfa.enroll({factorType:"totp",friendlyName:"FieldSync Authenticator"});if(z)throw z;c(A.totp.qr_code),m(A.totp.secret),j(A.id),a("enroll")}catch(A){F(A.message),s?.("Failed to start MFA enrollment","error")}},L=async()=>{if(v.length===6){p(!0),F(null);try{const{data:A,error:z}=await hs.auth.mfa.challenge({factorId:d});if(z)throw z;const{error:O}=await hs.auth.mfa.verify({factorId:d,challengeId:A.id,code:v});if(O)throw O;a("success"),s?.("MFA enabled successfully!","success"),await g()}catch{F("Invalid code. Please try again."),y("")}finally{p(!1)}}},B=async A=>{try{const{error:z}=await hs.auth.mfa.unenroll({factorId:A});if(z)throw z;s?.("MFA disabled","success"),await g()}catch{s?.("Failed to disable MFA","error")}},P=()=>{navigator.clipboard.writeText(u),R(!0),setTimeout(()=>R(!1),2e3)},S=r.length>0;return e.jsxs("div",{className:"mfa-setup",children:[e.jsxs("div",{className:"mfa-header",children:[e.jsxs("div",{className:"mfa-title",children:[S?e.jsx(pt,{size:20,className:"text-success"}):e.jsx(bt,{size:20}),e.jsx("h3",{children:"Two-Factor Authentication"})]}),t&&e.jsx("button",{className:"close-btn",onClick:t,"aria-label":"Close",children:e.jsx(ls,{size:20})})]}),n==="loading"&&e.jsxs("div",{className:"mfa-loading",children:[e.jsx(ka,{size:24,className:"spinner"})," Loading..."]}),n==="overview"&&e.jsxs("div",{className:"mfa-overview",children:[e.jsx("p",{className:"mfa-description",children:"Add an extra layer of security to your account. When enabled, you will need to enter a code from your authenticator app each time you sign in."}),S?e.jsxs("div",{className:"mfa-status mfa-status-enabled",children:[e.jsx(pt,{size:18}),e.jsx("span",{children:"MFA is enabled"}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>B(r[0].id),children:[e.jsx(_a,{size:14})," Disable"]})]}):e.jsxs("div",{className:"mfa-status mfa-status-disabled",children:[e.jsx(_a,{size:18}),e.jsx("span",{children:"MFA is not enabled"}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:C,children:[e.jsx(bt,{size:14})," Enable MFA"]})]})]}),n==="enroll"&&e.jsxs("div",{className:"mfa-enroll",children:[e.jsx("p",{children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):"}),l&&e.jsx("div",{className:"mfa-qr-container",children:e.jsx("img",{src:l,alt:"MFA QR Code",className:"mfa-qr"})}),e.jsxs("div",{className:"mfa-secret",children:[e.jsx("span",{className:"mfa-secret-label",children:"Or enter this key manually:"}),e.jsxs("div",{className:"mfa-secret-value",children:[e.jsx("code",{children:u}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:P,"aria-label":"Copy secret key",children:k?e.jsx(ln,{size:14}):e.jsx(tl,{size:14})})]})]}),e.jsxs("div",{className:"mfa-verify-section",children:[e.jsx("label",{htmlFor:"mfa-verify-code",children:"Enter the 6-digit code from your app:"}),e.jsxs("div",{className:"mfa-code-input",children:[e.jsx("input",{id:"mfa-verify-code",type:"text",value:v,onChange:A=>y(A.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,autoFocus:!0,inputMode:"numeric",pattern:"[0-9]*"}),e.jsx("button",{className:"btn btn-primary",onClick:L,disabled:v.length!==6||h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(ka,{size:14,className:"spinner"})," Verifying..."]}):"Verify & Enable"})]}),x&&e.jsx("p",{className:"mfa-error",children:x})]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>a("overview"),children:"Cancel"})]}),n==="success"&&e.jsxs("div",{className:"mfa-success",children:[e.jsx(pt,{size:48,className:"text-success"}),e.jsx("h4",{children:"MFA Enabled"}),e.jsx("p",{children:"Your account is now protected with two-factor authentication."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>a("overview"),children:"Done"})]})]})}o.lazy(()=>ce(()=>import("./TMList-9H73zOWg.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])));o.lazy(()=>ce(()=>import("./CORLogPreview-CMTf55h4.js"),__vite__mapDeps([8,2,3,4,1,5,6])));o.lazy(()=>ce(()=>import("./CORList-CtzQ3B02.js"),__vite__mapDeps([9,1,2,3,4,5,6,10])));o.lazy(()=>ce(()=>import("./BillingCenter-DefLlnfb.js"),__vite__mapDeps([11,2,3,4,1,5,6])));o.lazy(()=>ce(()=>Promise.resolve().then(()=>mc),void 0));o.lazy(()=>ce(()=>Promise.resolve().then(()=>pc),void 0));const jc=o.lazy(()=>ce(()=>import("./ShareModal-CdQ5wayl.js"),__vite__mapDeps([12,2,3,4,1,5,6]))),fc=o.lazy(()=>ce(()=>import("./NotificationSettings-BpBq8Jk_.js"),__vite__mapDeps([13,2,3,4,1,5,6]))),gc=o.lazy(()=>ce(()=>import("./CORForm-mtBqWCk2.js"),__vite__mapDeps([14,2,3,4,1,5,6]))),bc=o.lazy(()=>ce(()=>import("./CORDetail-DfIWX7vv.js"),__vite__mapDeps([15,2,3,4,1,5,6,16,7]))),yc=o.lazy(()=>ce(()=>import("./CORLog-LZUKM3gX.js").then(s=>s.a),__vite__mapDeps([10,1,2,3,4,5,6]))),Nc=o.lazy(()=>ce(()=>import("./DrawRequestModal-B2jfuedi.js"),__vite__mapDeps([17,2,3,4,1,5,6]))),wc=o.lazy(()=>ce(()=>import("./EquipmentModal-BE8sB1ZM.js"),__vite__mapDeps([18,2,3,4,1,5,6]))),Cc=o.lazy(()=>ce(()=>import("./AddCostModal-DTu1i7Uw.js"),__vite__mapDeps([19,2,3,4,1,5,6]))),kc=o.lazy(()=>ce(()=>import("./DocumentsTab-DC8uRaWy.js"),__vite__mapDeps([20,2,3,4,1,5,6]))),_c=o.lazy(()=>ce(()=>import("./CORLogPreview-CMTf55h4.js"),__vite__mapDeps([8,2,3,4,1,5,6]))),Sc=o.lazy(()=>ce(()=>import("./CORList-CtzQ3B02.js"),__vite__mapDeps([9,1,2,3,4,5,6,10]))),Dc=o.lazy(()=>ce(()=>import("./TMList-9H73zOWg.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Ec=o.lazy(()=>ce(()=>import("./BillingCenter-DefLlnfb.js"),__vite__mapDeps([11,2,3,4,1,5,6])));function Pc({company:s,user:t,isAdmin:n,onShowToast:a,navigateToProjectId:r,onProjectNavigated:i}){const[l,c]=o.useState([]),[u,m]=o.useState([]),[d,j]=o.useState(null),[v,y]=o.useState([]),[h,p]=o.useState(!0),[k,R]=o.useState(!1),[x,F]=o.useState(null),[g,C]=o.useState(!1),[L,B]=o.useState(!1),[P,S]=o.useState(!1),[A,z]=o.useState("overview"),[O,V]=o.useState("overview"),[D,te]=o.useState(!0),[I,de]=o.useState(!1),[je,he]=o.useState(!1),[De,$]=o.useState("list"),[b,w]=o.useState("preview"),[G,E]=o.useState([]),[X,ee]=o.useState(!1),[ne,fe]=o.useState(null),[Xe,Ee]=o.useState(!1),[se,Fe]=o.useState(null),[ae,Ce]=o.useState(0),[et,ke]=o.useState(!1),[Ss,cs]=o.useState(!1),[wn,Ds]=o.useState(!1),[Ot,Es]=o.useState(null),[Cn,kn]=o.useState(0),[_n,Ps]=o.useState(!1),[At,Rs]=o.useState(null),[Sn,Dn]=o.useState(0),{isOpen:En,setIsOpen:Pn,close:Rn}=Mo(),ds=o.useRef(null),Ts=o.useRef(!1),st=o.useRef(!1),tt=o.useRef(new Map),Mt=300*1e3,ve=o.useCallback((f={})=>{const{refreshAreas:M=!1,refreshCOR:T=!1,projectId:q=null}=f;M&&q&&(Ts.current=q),T&&(st.current=!0),ds.current&&clearTimeout(ds.current),ds.current=setTimeout(async()=>{Ts.current&&(await at(Ts.current),Ts.current=!1),st.current&&(Ce(Y=>Y+1),st.current=!1),await us()},150)},[]);o.useEffect(()=>()=>{ds.current&&clearTimeout(ds.current)},[]),o.useEffect(()=>{s?.id&&(us(),On())},[s?.id]);const Tn=o.useRef([]),Fn=l.map(f=>f.id).sort().join(",");o.useEffect(()=>{if(!s?.id||l.length===0)return;const f=l.map(T=>T.id).sort();Tn.current=f;const M=W.subscribeToCompanyActivity?.(s.id,f,{onMessage:()=>ve(),onMaterialRequest:()=>ve(),onTMTicket:()=>ve(),onCrewCheckin:()=>ve(),onAreaUpdate:()=>ve(),onCORChange:()=>ve({refreshCOR:!0}),onInjuryReport:()=>ve(),onProjectChange:()=>ve(),onMaterialsEquipmentChange:()=>ve(),onLaborRateChange:()=>ve()});return()=>{M&&W.unsubscribe?.(M)}},[s?.id,Fn,ve]),o.useEffect(()=>(I?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[I]);const On=async()=>{try{const f=await W.getDumpSites(s.id);E(f||[])}catch(f){console.error("Error loading dump sites:",f)}},$t=o.useRef(null);o.useEffect(()=>{if(r&&r!==$t.current&&l.length>0){const f=l.find(M=>M.id===r);f&&($t.current=r,j(f),i?.())}},[r,l,i]),o.useEffect(()=>{if(d){at(d.id);const f=[],M=d.id,T=W.subscribeToAreas?.(M,()=>{ve({refreshAreas:!0,projectId:M})});T&&f.push(T);const q=W.subscribeToDailyReports?.(M,()=>{ve()});q&&f.push(q);const Y=W.subscribeToCrewCheckins?.(M,()=>{ve()});Y&&f.push(Y);const Z=W.subscribeToHaulOffs?.(M,()=>{ve()});Z&&f.push(Z);const Q=W.subscribeToCORs?.(M,()=>{ve({refreshCOR:!0})});return Q&&f.push(Q),()=>{f.forEach(le=>W.unsubscribe?.(le))}}},[d,ve]),o.useEffect(()=>{O==="tickets"&&w("full")},[O]);const An=async(f,M=!1)=>{const T=f.id,q=tt.current.get(T);if(q&&!M&&Date.now()-q.timestamp<Mt)return q.data;try{const[Y,Z,Q,le,oe,me,ze,As,_,K,pe,Oe]=await Promise.all([be(()=>W.getAreas(f.id),{fallback:[],context:{operation:"getAreas",projectId:f.id}}),be(()=>W.getTMTickets(f.id),{fallback:[],context:{operation:"getTMTickets",projectId:f.id}}),be(()=>W.getChangeOrderTotals(f.id),{fallback:null,context:{operation:"getChangeOrderTotals",projectId:f.id}}),be(()=>W.getDailyReports(f.id,100),{fallback:[],context:{operation:"getDailyReports",projectId:f.id}}),be(()=>W.getInjuryReports(f.id),{fallback:[],context:{operation:"getInjuryReports",projectId:f.id}}),be(()=>W.calculateManDayCosts(f.id,s?.id,f.work_type||"demolition",f.job_type||"standard"),{fallback:null,context:{operation:"calculateManDayCosts",projectId:f.id}}),be(()=>W.calculateHaulOffCosts(f.id),{fallback:null,context:{operation:"calculateHaulOffCosts",projectId:f.id}}),be(()=>W.getProjectCosts(f.id),{fallback:[],context:{operation:"getProjectCosts",projectId:f.id}}),be(()=>W.getCORStats(f.id),{fallback:null,context:{operation:"getCORStats",projectId:f.id}}),be(()=>W.getCrewCheckinHistory(f.id,60),{fallback:[],context:{operation:"getCrewCheckinHistory",projectId:f.id}}),be(()=>W.getMaterialRequests(f.id),{fallback:[],context:{operation:"getMaterialRequests",projectId:f.id}}),be(()=>W.getWeeklyDisposalSummary(f.id,4),{fallback:[],context:{operation:"getWeeklyDisposalSummary",projectId:f.id}})]),Se=wa(Y),nt=Se.progress,aa=Q?.totalApprovedValue||0,na=f.contract_value+aa,Ms=Se.isValueBased?Se.earnedValue:nt/100*na,pr=Z.filter(H=>H.status==="pending").length,rt=new Date;rt.setDate(rt.getDate()-7);const xr=le.filter(H=>new Date(H.report_date)>=rt).length,ra=As.reduce((H,re)=>{const Qe=parseFloat(re.amount);return H+(isNaN(Qe)?0:Qe)},0);let $s=0;const Is={};Z.forEach(H=>{const re=H.work_date||H.ticket_date||H.created_at?.split("T")[0],Qe=H.t_and_m_items||H.items||[];let Ls=0;Qe.forEach(ut=>{const Rr=parseFloat(ut.quantity)||1,Tr=parseFloat(ut.unit_cost)||parseFloat(ut.materials_equipment?.cost_per_unit)||0;Ls+=Rr*Tr}),Ls>0&&re&&($s+=Ls,Is[re]||(Is[re]={date:re,cost:0}),Is[re].cost+=Ls)});const ia=Object.values(Is).sort((H,re)=>new Date(re.date)-new Date(H.date)),it=me?.totalCost||0,vr=ze?.totalCost||0,la=it+$s+ra,oa=Ms-la,jr=Ms>0?oa/Ms*100:0,ca=me?.byDate?.length||0,fr=ia.length,lt=Math.max(ca,fr),da=it+$s,gr=lt>0?da/lt:0,Ae=zi({...f,progress:nt},me?.totalManDays||0),qe={},ua=new Set;(K||[]).forEach(H=>{const re=H.workers||[];qe[H.check_in_date]=re.length,re.forEach(Qe=>ua.add(Qe.name?.toLowerCase()))});const Me=Object.keys(qe).sort(),br=Me.length>0?Math.round(Me.reduce((H,re)=>H+qe[re],0)/Me.length*10)/10:0,yr=Me.length>0?Math.max(...Me.map(H=>qe[H])):0,ot=Me.slice(-7),ct=Me.slice(-14,-7),ma=ot.length>0?ot.reduce((H,re)=>H+qe[re],0)/ot.length:0,dt=ct.length>0?ct.reduce((H,re)=>H+qe[re],0)/ct.length:0,Nr=(pe||[]).filter(H=>H.status==="pending").length,wr=(pe||[]).filter(H=>H.status==="ordered").length,Cr=(pe||[]).filter(H=>H.status==="delivered").length,kr=(pe||[]).filter(H=>H.priority==="urgent"&&H.status==="pending").length,_r=le.filter(H=>H.issues&&H.issues.trim().length>0).length,Sr=Z.reduce((H,re)=>H+(re.photos?.length||0),0),Dr=(Oe||[]).reduce((H,re)=>H+(re.concrete||0)+(re.trash||0)+(re.metals||0)+(re.hazardous_waste||0),0),ha=oe.length>0?new Date(oe[0]?.incident_date||oe[0]?.created_at):null,Er=ha?Math.floor((new Date-ha)/(1e3*60*60*24)):null,Pr=Y.filter(H=>H.status==="done"),pa={...f,areas:Y,progress:nt,billable:Ms,changeOrderValue:aa,revisedContractValue:na,changeOrderPending:Q?.pendingCount||0,totalTickets:Z.length,pendingTickets:pr,approvedTickets:Z.filter(H=>H.status==="approved").length,tmTickets:Z,dailyReportsCount:le.length,recentDailyReports:xr,injuryReportsCount:oe.length,lastDailyReport:le[0]?.report_date||null,isValueBased:Se.isValueBased,earnedValue:Se.earnedValue,totalSOVValue:Se.totalValue,laborCost:it,laborDaysWorked:ca,laborManDays:me?.totalManDays||0,laborByDate:me?.byDate||[],dailyBurn:gr,materialsEquipmentCost:$s,materialsEquipmentByDate:ia,haulOffCost:vr,haulOffLoads:ze?.totalLoads||0,haulOffDays:ze?.daysWithHaulOff||0,haulOffByType:ze?.byWasteType||{},haulOffByDate:ze?.byDate||[],customCosts:As,customCostTotal:ra,totalBurn:da,totalBurnDays:lt,allCostsTotal:la,currentProfit:oa,profitMargin:jr,corPendingValue:_?.total_pending_value||0,corPendingCount:_?.pending_count||0,corApprovedValue:_?.total_approved_value||0,corBilledValue:_?.total_billed_value||0,corTotalCount:_?.total_cors||0,corStats:_,scheduleStatus:Ae.scheduleStatus,scheduleVariance:Ae.scheduleVariance,scheduleLabel:Ae.scheduleLabel,laborStatus:Ae.laborStatus,laborVariance:Ae.laborVariance,laborLabel:Ae.laborLabel,hasScheduleData:Ae.hasScheduleData,hasLaborData:Ae.hasLaborData,actualManDays:me?.totalManDays||0,crewHistory:K||[],crewByDate:qe,uniqueWorkerCount:ua.size,avgCrewSize:br,peakCrewSize:yr,crewDaysTracked:Me.length,crewTrend:dt>0?(ma-dt)/dt*100:0,recentCrewAvg:ma,materialRequests:pe||[],pendingMaterialRequests:Nr,orderedMaterialRequests:wr,deliveredMaterialRequests:Cr,urgentMaterialRequests:kr,totalMaterialRequests:(pe||[]).length,reportsWithIssues:_r,totalPhotosFromTickets:Sr,dailyReports:le,weeklyDisposal:Oe||[],disposalTotalLoads:Dr,daysSinceLastInjury:Er,injuryReports:oe,oshaRecordable:oe.filter(H=>H.osha_recordable).length,completedAreasCount:Pr.length,hasError:!1,_detailsLoaded:!0};return tt.current.set(T,{data:pa,timestamp:Date.now()}),pa}catch(Y){return console.error(`Error loading details for project ${f.id}:`,Y),{...f,hasError:!0,_detailsLoaded:!1}}},us=async()=>{try{const f=await W.getProjectDashboardSummary(s?.id);c(f);const M=f.map(T=>{const q=tt.current.get(T.id);if(q&&Date.now()-q.timestamp<Mt)return q.data;const Y=T.areaCount||0,Z=T.completedAreas||0,Q=Y>0?Math.round(Z/Y*100):0;return{...T,progress:Q,areas:[],totalTickets:T.ticketCount||0,pendingTickets:T.pendingTicketCount||0,approvedTickets:T.approvedTicketCount||0,dailyReportsCount:T.dailyReportsThisWeek||0,recentDailyReports:T.dailyReportsThisWeek||0,corTotalCount:T.corCount||0,billable:0,changeOrderValue:0,revisedContractValue:T.contract_value||0,changeOrderPending:0,tmTickets:[],injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,materialsEquipmentCost:0,materialsEquipmentByDate:[],haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corStats:null,scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1,actualManDays:0,hasError:!1,_detailsLoaded:!1}});m(M)}catch(f){console.error("Error loading projects:",f),a("Error loading projects","error")}finally{p(!1)}},at=async f=>{try{const M=await W.getAreas(f);y(M)}catch(M){console.error("Error loading areas:",M)}},Fs=async f=>{if(j(f),!f._detailsLoaded){const M=await An(f);m(T=>T.map(q=>q.id===f.id?M:q)),j(M)}},It=()=>{j(null),y([]),R(!1),F(null),z("overview"),us()},Lt=()=>{F({name:d.name,job_number:d.job_number||"",address:d.address||"",general_contractor:d.general_contractor||"",client_contact:d.client_contact||"",client_phone:d.client_phone||"",contract_value:d.contract_value,work_type:d.work_type||"demolition",job_type:d.job_type||"standard",pin:d.pin||"",default_dump_site_id:d.default_dump_site_id||"",areas:v.map(f=>({id:f.id,name:f.name,weight:f.weight,isNew:!1}))}),R(!0)},Mn=()=>{R(!1),F(null)},_e=(f,M)=>{F(T=>({...T,[f]:M}))},zt=(f,M,T)=>{F(q=>({...q,areas:q.areas.map((Y,Z)=>Z===f?{...Y,[M]:T}:Y)}))},$n=()=>{F(f=>({...f,areas:[...f.areas,{id:null,name:"",weight:"",isNew:!0}]}))},In=f=>{x.areas.length>1&&F(M=>({...M,areas:M.areas.filter((T,q)=>q!==f)}))},Ln=async()=>{if(!x.name.trim()){a("Please enter a project name","error");return}const f=parseFloat(x.contract_value);if(!f||f<=0){a("Please enter a valid contract value","error");return}if(x.pin&&x.pin.length!==4){a("PIN must be 4 digits","error");return}if(x.pin&&x.pin!==d.pin&&!await W.isPinAvailable(x.pin,d.id)){a("This PIN is already in use","error");return}const M=x.areas.filter(q=>q.name.trim()&&parseFloat(q.weight)>0);if(M.length===0){a("Please add at least one area","error");return}if(M.reduce((q,Y)=>q+parseFloat(Y.weight),0)!==100){a("Area weights must total 100%","error");return}C(!0);try{await W.updateProject(d.id,{name:x.name.trim(),job_number:x.job_number?.trim()||null,address:x.address?.trim()||null,general_contractor:x.general_contractor?.trim()||null,client_contact:x.client_contact?.trim()||null,client_phone:x.client_phone?.trim()||null,contract_value:f,work_type:x.work_type||"demolition",job_type:x.job_type||"standard",pin:x.pin||null,default_dump_site_id:x.default_dump_site_id||null},s?.id);const q=v.map(Q=>Q.id),Y=x.areas.filter(Q=>Q.id).map(Q=>Q.id);for(const Q of q)Y.includes(Q)||await W.deleteArea(Q);for(let Q=0;Q<M.length;Q++){const le=M[Q];le.id?await W.updateArea(le.id,{name:le.name.trim(),weight:parseFloat(le.weight),sort_order:Q}):await W.createArea({project_id:d.id,name:le.name.trim(),weight:parseFloat(le.weight),status:"not_started",sort_order:Q})}const Z=await W.getProject(d.id);j(Z),await at(d.id),R(!1),F(null),a("Project updated!","success")}catch(q){console.error("Error saving project:",q?.message||q),a(q?.message||"Error saving changes","error")}finally{C(!1)}},zn=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await W.deleteProject(d.id),a("Project deleted","success"),It()}catch(f){console.error("Error deleting project:",f),a("Error deleting project","error")}},N=o.useMemo(()=>d?u.find(f=>f.id===d.id):null,[d,u]),qn=o.useMemo(()=>{if(!d)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const f=wa(v),M=f.progress,T=N?.changeOrderValue||0,q=d.contract_value+T,Y=f.isValueBased?f.earnedValue:M/100*q;return{progress:M,billable:Y,changeOrderValue:T,revisedContractValue:q,isValueBased:f.isValueBased,earnedValue:f.earnedValue,totalSOVValue:f.totalValue}},[d,v,N]),Vn=o.useMemo(()=>{const f=u.reduce((oe,me)=>oe+(me.contract_value||0),0),M=u.reduce((oe,me)=>oe+(me.changeOrderValue||0),0),T=f+M,q=u.reduce((oe,me)=>oe+(me.billable||0),0),Y=T-q,Z=T>0?Math.round(q/T*100):0,Q=u.reduce((oe,me)=>oe+(me.corPendingValue||0),0),le=u.reduce((oe,me)=>oe+(me.corPendingCount||0),0);return{totalOriginalContract:f,totalChangeOrders:M,totalPortfolioValue:T,totalEarned:q,totalRemaining:Y,weightedCompletion:Z,totalPendingCORValue:Q,totalPendingCORCount:le}},[u]),Bn=o.useMemo(()=>{let f=0,M=0,T=0,q=0,Y=0;for(const Z of u){const Q=Z.revisedContractValue||Z.contract_value;Z.progress>=100&&f++,Z.progress<100&&Z.billable<=Q*(Z.progress/100)*1.1&&M++,Z.billable>Q*.9&&Z.progress<90&&T++,Z.billable>Q&&q++,(Z.changeOrderValue||0)>0&&Y++}return{projectsComplete:f,projectsOnTrack:M,projectsAtRisk:T,projectsOverBudget:q,projectsWithChangeOrders:Y}},[u]),Wn=o.useMemo(()=>{let f=0,M=0,T=0,q=0,Y=0,Z=0;for(const Q of u)Q.hasScheduleData&&(Q.scheduleStatus==="ahead"?f++:Q.scheduleStatus==="behind"?T++:M++),Q.hasLaborData&&(Q.laborStatus==="over"?q++:Q.laborStatus==="under"?Y++:Z++);return{scheduleAhead:f,scheduleOnTrack:M,scheduleBehind:T,laborOver:q,laborUnder:Y,laborOnTrack:Z,hasAnyScheduleData:f+M+T>0,hasAnyLaborData:q+Y+Z>0}},[u]),ms=o.useMemo(()=>{const f=u.map(T=>{const q={id:T.id,name:T.name,totalCosts:T.totalCosts||0,earnedRevenue:T.billable||0,actualProgress:T.progress||0,expectedProgress:T.expectedProgress||T.progress,pendingCORValue:T.corPendingValue||0,contractValue:T.revisedContractValue||T.contract_value||0,lastReportDate:T.lastDailyReport,recentInjuryCount:T.recentInjuryCount||0,startDate:T.start_date},Y=_o(q),Z=So(Y,{...q,name:T.name}),Q=Do(q),le=Z.map(oe=>({...oe,projectName:T.name,projectId:T.id}));return{projectId:T.id,projectName:T.name,riskScore:Y.score,riskStatus:Y.status,riskLabel:Y.label,factors:Y.factors,alerts:le,projections:Q}}),M=f.flatMap(T=>T.alerts).sort((T,q)=>{const Y={critical:0,warning:1,info:2};return Y[T.type]-Y[q.type]});return{projectRisks:f,allAlerts:M,criticalCount:M.filter(T=>T.type==="critical").length,warningCount:M.filter(T=>T.type==="warning").length}},[u]),Un=o.useCallback(({target:f,projectId:M,alert:T})=>{const q=l.find(Y=>Y.id===M);q&&(j(q),f==="financials"?z("financials"):f==="reports"?z("reports"):f==="cors"?(z("financials"),V("cors"),he(!0)):z("overview"))},[l]);o.useEffect(()=>{const f=async()=>{for(const M of u)if($i(M,30))try{await W.archiveProject(M.id),a(`Project "${M.name}" has been auto-archived after 30 days of completion`,"info")}catch(T){console.error("Failed to auto-archive project:",T)}};u.length>0&&f()},[]);const Hn=o.useCallback(()=>{Es(null),Ds(!0)},[]),Gn=o.useCallback(f=>{Es(f),Ds(!0)},[]),Kn=o.useCallback(()=>{Rs(null),Ps(!0)},[]),Yn=o.useCallback(f=>{Rs(f),Ps(!0)},[]),Jn=o.useCallback(()=>{w("full")},[]),Xn=o.useCallback(()=>{te(f=>!f)},[]),Qn=o.useCallback(()=>{de(f=>!f)},[]),qt=o.useCallback(()=>{de(!1)},[]),Vt=o.useCallback(()=>{he(f=>!f)},[]),Os=o.useCallback(async(f="all")=>{if(d){a("Gathering field data...","info");try{const[M,T,q]=await Promise.all([W.getDailyReports(d.id,365),W.getInjuryReports(d.id),W.getCrewCheckinHistory(d.id,365)]);f==="daily"?await Eo(M||[],d):f==="incidents"?await Po(T||[],d):f==="crew"?await Ro(q||[],d):await To({dailyReports:M||[],incidentReports:T||[],crewCheckins:q||[],project:d}),a("PDF exported!","success")}catch(M){console.error("Error exporting field documents:",M),a("Error generating PDF","error")}}},[d,a]),Zn=o.useCallback(()=>{w("preview")},[]),er=o.useCallback(()=>{$("log")},[]),Bt=o.useCallback(()=>{fe(null),ee(!0)},[]),sr=o.useCallback(f=>{Fe(f),Ee(!0)},[]),tr=o.useCallback(f=>{fe(f),ee(!0)},[]),ar=o.useCallback(()=>{ke(!0)},[]),nr=o.useCallback(async f=>{try{await W.deleteProjectCost(f),us(),a?.("Cost deleted","success")}catch{a?.("Error deleting cost","error")}},[]),rr=o.useMemo(()=>({corCount:N?.corStats?.total||0,ticketCount:N?.totalTickets||0,corPending:N?.corStats?.pending||0,ticketPending:N?.pendingTickets||0}),[N?.corStats?.total,N?.totalTickets,N?.corStats?.pending,N?.pendingTickets]),{totalOriginalContract:ir,totalChangeOrders:Wt,totalPortfolioValue:lr,totalEarned:or,totalRemaining:cr,weightedCompletion:dr,totalPendingCORValue:ur,totalPendingCORCount:Ut}=Vn,{projectsComplete:Ht,projectsOnTrack:Gt,projectsAtRisk:Kt,projectsOverBudget:Yt,projectsWithChangeOrders:Jt}=Bn,{scheduleAhead:Xt,scheduleOnTrack:Qt,scheduleBehind:Zt,laborOver:ea,laborUnder:sa,laborOnTrack:ta,hasAnyScheduleData:mr,hasAnyLaborData:hr}=Wn;if(h)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(d){const{progress:f,billable:M,changeOrderValue:T,revisedContractValue:q,isValueBased:Y,earnedValue:Z,totalSOVValue:Q}=qn;if(k&&x){const _=x.areas.reduce((K,pe)=>K+(parseFloat(pe.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Mn,style:{marginBottom:"1.5rem"},children:"← Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:x.name,onChange:K=>_e("name",K.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:x.job_number,onChange:K=>_e("job_number",K.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:x.address,onChange:K=>_e("address",K.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:x.general_contractor,onChange:K=>_e("general_contractor",K.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:x.client_contact,onChange:K=>_e("client_contact",K.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:x.client_phone,onChange:K=>_e("client_phone",K.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:x.contract_value,onChange:K=>_e("contract_value",K.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:x.pin,onChange:K=>_e("pin",K.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:x.work_type,onChange:K=>_e("work_type",K.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:x.job_type,onChange:K=>_e("job_type",K.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:x.default_dump_site_id,onChange:K=>_e("default_dump_site_id",K.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),G.map(K=>e.jsx("option",{value:K.id,children:K.name},K.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),x.areas.map((K,pe)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:K.name,onChange:Oe=>zt(pe,"name",Oe.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:K.weight,onChange:Oe=>zt(pe,"weight",Oe.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>In(pe),children:"×"})]},pe)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${_===100?"valid":"invalid"}`,children:[_,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:$n,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:Ln,disabled:g,style:{flex:1},children:g?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:zn,children:"Delete Project"})]})}const le=v.filter(_=>_.status==="done").length,oe=v.filter(_=>_.status==="working").length,me=v.filter(_=>_.status==="not_started").length,ze=(N?.pendingTickets||0)+(N?.changeOrderPending||0),As=[{id:"overview",label:"Overview",Icon:Sa},{id:"financials",label:"Financials",Icon:xs,badge:ze},{id:"reports",label:"Reports",Icon:ge},{id:"documents",label:"Documents",Icon:ft},{id:"info",label:"Info",Icon:Ws}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:It,children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>B(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>S(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:Lt,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:d.name}),(d.job_number||d.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[d.job_number&&`Job #${d.job_number}`,d.job_number&&d.work_type&&" • ",d.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[f,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:xe(M)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:xe(q-M)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:As.map(_=>e.jsxs("button",{className:`pv-tab ${A===_.id?"active":""} ${_.badge>0?"has-badge":""}`,onClick:()=>z(_.id),children:[e.jsx(_.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:_.label}),_.badge>0&&e.jsx("span",{className:"pv-tab-badge",children:_.badge})]},_.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[A==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab animate-fade-in",children:[e.jsxs("div",{className:"overview-hero-split",children:[e.jsx(Lo,{progress:f,areasComplete:le,totalAreas:v.length,areasWorking:oe}),e.jsx(qo,{earnedRevenue:M,totalCosts:N?.allCostsTotal||0,laborCost:N?.laborCost||0,disposalCost:N?.haulOffCost||0,equipmentCost:N?.materialsEquipmentCost||0,materialsCost:0,otherCost:N?.customCostTotal||0,contractValue:q})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(Bo,{project:d,onShowToast:a}),e.jsxs("div",{className:"overview-section-card overview-work-areas-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[le>0&&e.jsxs("span",{className:"section-badge done",children:[le," Done"]}),oe>0&&e.jsxs("span",{className:"section-badge working",children:[oe," Active"]}),me>0&&e.jsxs("span",{className:"section-badge pending",children:[me," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list work-areas-scroll stagger-areas",children:v.map(_=>e.jsxs("div",{className:`work-area-item ${_.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[_.status==="done"&&e.jsx("span",{className:"status-icon done",children:"✓"}),_.status==="working"&&e.jsx("span",{className:"status-icon working",children:"●"}),_.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:"○"})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:_.name}),e.jsx("span",{className:"work-area-weight",children:_.scheduled_value?xe(_.scheduled_value):`${_.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${_.status}`,style:{width:_.status==="done"?"100%":_.status==="working"?"50%":"0%"}})})]},_.id))})]})]}),e.jsxs("div",{className:"overview-bottom-strip",children:[(N?.pendingTickets>0||N?.changeOrderPending>0||N?.pendingMaterialRequests>0||N?.urgentMaterialRequests>0)&&e.jsxs("div",{className:"overview-attention-inline",children:[N?.urgentMaterialRequests>0&&e.jsxs("div",{className:"attention-chip warning",onClick:()=>z("reports"),children:[e.jsx(rs,{size:14}),e.jsxs("span",{children:[N.urgentMaterialRequests," urgent material request",N.urgentMaterialRequests!==1?"s":""]})]}),N?.pendingMaterialRequests>0&&!N?.urgentMaterialRequests&&e.jsxs("div",{className:"attention-chip info",onClick:()=>z("reports"),children:[e.jsx(Bs,{size:14}),e.jsxs("span",{children:[N.pendingMaterialRequests," material request",N.pendingMaterialRequests!==1?"s":""," pending"]})]}),N?.pendingTickets>0&&e.jsxs("div",{className:"attention-chip warning",onClick:()=>z("financials"),children:[e.jsx(ge,{size:14}),e.jsxs("span",{children:[N.pendingTickets," T&M pending"]})]}),N?.changeOrderPending>0&&e.jsxs("div",{className:"attention-chip info",onClick:()=>z("financials"),children:[e.jsx(as,{size:14}),e.jsxs("span",{children:[N.changeOrderPending," CO pending"]})]})]}),e.jsxs("div",{className:"overview-quick-actions",children:[e.jsxs("button",{className:"overview-action-btn",onClick:()=>z("reports"),children:[e.jsx(ge,{size:15}),e.jsxs("span",{children:[N?.dailyReportsCount||0," Reports"]})]}),e.jsxs("button",{className:"overview-action-btn",onClick:()=>z("financials"),children:[e.jsx(xs,{size:15}),e.jsxs("span",{children:[N?.totalTickets||0," T&M Tickets"]})]}),e.jsx("span",{className:"overview-action-divider"}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Os("all"),children:[e.jsx(We,{size:15}),e.jsx("span",{children:"Export All Docs"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Os("daily"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Daily"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Os("incidents"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Incidents"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Os("crew"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Crew"})]})]})]})]}),A==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsxs("div",{className:"export-actions",style:{display:"flex",gap:"8px",marginLeft:"auto",marginBottom:"12px",justifyContent:"flex-end"},children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>Fo(d,{earnedRevenue:M,approvedCORs:N?.cors?.filter(_=>_.status==="approved"),laborByDate:N?.laborByDate,haulOffByDate:N?.haulOffByDate,customCosts:N?.customCosts}),children:[e.jsx(We,{size:14})," Export CSV"]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>Oo(d,{totalLaborCost:N?.totalLaborCost||0,totalDisposalCost:N?.totalDisposalCost||0}),children:[e.jsx(We,{size:14})," QuickBooks"]})]}),e.jsx(Ko,{contractValue:d?.contract_value||0,earnedRevenue:M,totalCosts:N?.allCostsTotal||0,profit:N?.currentProfit||0,progress:f,corApprovedValue:T,loading:!N}),e.jsxs("div",{className:`financials-layout ${D?"sidebar-collapsed":""}`,children:[e.jsxs("button",{className:"financials-mobile-menu-toggle",onClick:Qn,"aria-label":"Open navigation menu",title:"Open navigation menu",children:[e.jsx(al,{size:20}),e.jsx("span",{children:"Menu"})]}),I&&e.jsx("div",{className:"financials-sidebar-overlay",onClick:qt,"aria-hidden":"true"}),e.jsx("div",{className:`financials-sidebar ${D?"collapsed":""} ${I?"mobile-open":""}`,children:e.jsx(Yo,{activeSection:O,onSectionChange:_=>{V(_),de(!1)},collapsed:D,onToggleCollapse:Xn,onMobileClose:qt,stats:rr})}),e.jsxs("div",{className:"financials-main",children:[O==="overview"&&e.jsxs("div",{className:"financials-overview animate-fade-in",children:[e.jsx(ec,{projectData:N,project:d,tmTickets:N?.tmTickets||[],corStats:N?.corStats,areas:v}),e.jsxs("div",{className:"financials-analysis-row stagger-children",children:[e.jsx(dc,{dailyBurn:N?.dailyBurn||0,totalBurn:N?.totalBurn||0,daysWorked:N?.totalBurnDays||0,laborCost:N?.laborCost||0,materialsEquipmentCost:N?.materialsEquipmentCost||0,progress:f,contractValue:q,laborByDate:N?.laborByDate||[],materialsEquipmentByDate:N?.materialsEquipmentByDate||[]}),e.jsx(tc,{revenue:M,totalCosts:N?.allCostsTotal||0,contractValue:q,progress:f})]}),e.jsxs("div",{className:"cost-disposal-row",children:[e.jsx(ac,{laborCost:N?.laborCost||0,haulOffCost:N?.haulOffCost||0,customCosts:N?.customCosts||[],onAddCost:ar,onDeleteCost:nr}),e.jsx(rc,{project:d,period:"week"})]}),e.jsx(ic,{project:d,onAddEquipment:Hn,onEditEquipment:Gn,onShowToast:a},Cn),e.jsx(lc,{project:d,areas:v,corStats:N?.corStats,onCreateDraw:Kn,onViewDraw:Yn,onShowToast:a},Sn),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(He,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:xe(N?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(oc,{project:d,company:s,onShowToast:a})})]})]}),O==="cors"&&e.jsxs("div",{className:"financials-cors animate-fade-in",children:[e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(_c,{project:d,onShowToast:a,onToggleList:Vt,showingList:je,onViewFullLog:er,onCreateCOR:Bt})})}),je&&e.jsx("div",{className:"financials-section cor-section-list animate-fade-in",style:{marginTop:"1rem"},children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(Sc,{project:d,company:s,areas:v,refreshKey:ae,onShowToast:a,previewMode:!1,onViewAll:Vt,onDisplayModeChange:$,onCreateCOR:Bt,onViewCOR:sr,onEditCOR:tr})})})]}),O==="tickets"&&e.jsx("div",{className:"financials-tickets animate-fade-in",children:e.jsxs("div",{className:"financials-section tm-section",children:[b==="full"&&e.jsx("button",{className:"section-back-btn",onClick:Zn,children:"← Back to summary"}),e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(Dc,{project:d,company:s,onShowToast:a,compact:b==="preview",previewMode:b==="preview",onViewAll:Jn})})]})}),O==="billing"&&e.jsx("div",{className:"financials-billing animate-fade-in",children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(Ec,{project:d,company:s,user:t,onShowToast:a})})})]})]})]}),A==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(ge,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:N?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:N?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((N?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:N?.totalTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"T&M Tickets"}),(N?.pendingTickets||0)>0&&e.jsxs("div",{className:"reports-metric-status",style:{background:"#fef3c7",color:"#92400e"},children:[N.pendingTickets," pending"]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:N?.totalPhotosFromTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"Photos Captured"})]})]})}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsx("div",{className:"reports-insight-header",children:e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Re,{size:18}),e.jsx("h3",{children:"Crew Analytics"})]})}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.uniqueWorkerCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Workers"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.avgCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Avg Crew / Day"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.peakCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Peak Crew Size"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.crewDaysTracked||0}),e.jsx("span",{className:"reports-stat-label",children:"Days Tracked"})]})]}),(N?.crewTrend||0)!==0&&e.jsxs("div",{className:`reports-trend-badge ${N.crewTrend>0?"up":"down"}`,children:[N.crewTrend>0?e.jsx(ws,{size:14}):e.jsx(Cs,{size:14}),e.jsxs("span",{children:[Math.abs(Math.round(N.crewTrend)),"% ",N.crewTrend>0?"increase":"decrease"," vs prior week"]})]}),N?.crewByDate&&Object.keys(N.crewByDate).length>0&&e.jsxs("div",{className:"reports-mini-chart",children:[e.jsx("div",{className:"reports-mini-chart-label",children:"Recent Crew Size"}),e.jsx("div",{className:"reports-mini-bars",children:Object.keys(N.crewByDate).sort().slice(-14).map(_=>{const K=N.crewByDate[_],pe=N.peakCrewSize||1;return e.jsx("div",{className:"reports-mini-bar-wrap",title:`${new Date(_+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}: ${K} workers`,children:e.jsx("div",{className:"reports-mini-bar",style:{height:`${K/pe*100}%`}})},_)})})]})]})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(bt,{size:18}),e.jsx("h3",{children:"Safety Dashboard"})]}),e.jsx("span",{className:`reports-section-badge ${(N?.injuryReportsCount||0)>0?"warning":"success"}`,children:(N?.injuryReportsCount||0)>0?`${N.injuryReportsCount} incident${N.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsx("div",{className:"reports-safety-hero",children:e.jsxs("div",{className:`reports-safety-days ${N?.daysSinceLastInjury===null||N?.daysSinceLastInjury>30?"excellent":N?.daysSinceLastInjury>7?"good":"caution"}`,children:[e.jsx("span",{className:"reports-safety-days-value",children:N?.daysSinceLastInjury!==null?N.daysSinceLastInjury:"--"}),e.jsx("span",{className:"reports-safety-days-label",children:N?.daysSinceLastInjury!==null?"Days Since Last Incident":"No Incidents Recorded"})]})}),e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.injuryReportsCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Incidents"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.oshaRecordable||0}),e.jsx("span",{className:"reports-stat-label",children:"OSHA Recordable"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.reportsWithIssues||0}),e.jsx("span",{className:"reports-stat-label",children:"Reports w/ Issues"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:N?.laborManDays||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Man-Days"})]})]})]})]})]}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Bs,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("span",{className:"reports-section-count",children:[N?.totalMaterialRequests||0," total"]})]}),e.jsx("div",{className:"reports-insight-body",children:(N?.totalMaterialRequests||0)===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Bs,{size:32}),e.jsx("p",{children:"No material requests yet"}),e.jsx("span",{children:"Requests from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-material-pipeline",children:[N?.urgentMaterialRequests>0&&e.jsxs("div",{className:"reports-material-status urgent",children:[e.jsx(rs,{size:14}),e.jsxs("span",{children:[N.urgentMaterialRequests," Urgent"]})]}),e.jsxs("div",{className:"reports-material-status pending",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[N?.pendingMaterialRequests||0," Pending"]})]}),e.jsxs("div",{className:"reports-material-status ordered",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[N?.orderedMaterialRequests||0," Ordered"]})]}),e.jsxs("div",{className:"reports-material-status delivered",children:[e.jsx(nl,{size:14}),e.jsxs("span",{children:[N?.deliveredMaterialRequests||0," Delivered"]})]})]}),e.jsx("div",{className:"reports-recent-list",children:(N?.materialRequests||[]).slice(0,3).map(_=>e.jsxs("div",{className:`reports-recent-item ${_.status}`,children:[e.jsxs("div",{className:"reports-recent-item-main",children:[e.jsx("span",{className:`reports-recent-item-status ${_.status}`,children:_.status}),e.jsx("span",{className:"reports-recent-item-date",children:new Date(_.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"reports-recent-item-detail",children:[(_.items||[]).slice(0,2).map((K,pe)=>e.jsxs("span",{children:[K.name,K.quantity?` (${K.quantity})`:""]},pe)),(_.items||[]).length>2&&e.jsxs("span",{className:"reports-recent-more",children:["+",(_.items||[]).length-2," more"]})]}),_.priority==="urgent"&&e.jsx("span",{className:"reports-urgent-tag",children:"URGENT"})]},_.id))})]})})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Ge,{size:18}),e.jsx("h3",{children:"Disposal Trends"})]}),e.jsxs("span",{className:"reports-section-count",children:[N?.disposalTotalLoads||0," loads"]})]}),e.jsx("div",{className:"reports-insight-body",children:(N?.weeklyDisposal||[]).length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Ge,{size:32}),e.jsx("p",{children:"No disposal data yet"}),e.jsx("span",{children:"Disposal loads from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-disposal-chart",children:[e.jsx("div",{className:"reports-disposal-bars",children:(N?.weeklyDisposal||[]).map((_,K)=>{const pe=(_.concrete||0)+(_.trash||0)+(_.metals||0)+(_.hazardous_waste||0),Oe=Math.max(...(N?.weeklyDisposal||[]).map(Se=>(Se.concrete||0)+(Se.trash||0)+(Se.metals||0)+(Se.hazardous_waste||0)))||1;return e.jsxs("div",{className:"reports-disposal-bar-col",children:[e.jsxs("div",{className:"reports-disposal-bar-stack",style:{height:`${pe/Oe*100}%`},children:[_.concrete>0&&e.jsx("div",{className:"reports-disposal-seg concrete",style:{flex:_.concrete},title:`Concrete: ${_.concrete}`}),_.trash>0&&e.jsx("div",{className:"reports-disposal-seg trash",style:{flex:_.trash},title:`Trash: ${_.trash}`}),_.metals>0&&e.jsx("div",{className:"reports-disposal-seg metals",style:{flex:_.metals},title:`Metals: ${_.metals}`}),_.hazardous_waste>0&&e.jsx("div",{className:"reports-disposal-seg hazardous",style:{flex:_.hazardous_waste},title:`Hazardous: ${_.hazardous_waste}`})]}),e.jsx("span",{className:"reports-disposal-bar-label",children:new Date(_.week+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},K)})}),e.jsxs("div",{className:"reports-disposal-legend",children:[e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot concrete"}),"Concrete"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot trash"}),"Trash"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot metals"}),"Metals"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot hazardous"}),"Hazardous"]})]})]}),(N?.haulOffCost||0)>0&&e.jsxs("div",{className:"reports-disposal-cost",children:[e.jsx("span",{children:"Total Disposal Cost"}),e.jsx("strong",{children:xe(N.haulOffCost)})]})]})})]})]}),e.jsxs("div",{className:"reports-insight-card reports-activity-summary",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(ge,{size:18}),e.jsx("h3",{children:"Field Activity Summary"})]}),e.jsx("div",{className:"reports-activity-badges",children:N?.lastDailyReport&&e.jsxs("span",{className:"reports-last-filed",children:["Last report: ",new Date(N.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ","(",Math.floor((new Date-new Date(N.lastDailyReport))/(1e3*60*60*24)),"d ago)"]})})]}),e.jsx("div",{className:"reports-insight-body",children:e.jsxs("div",{className:"reports-activity-grid",children:[e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(ge,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:N?.dailyReportsCount||0}),e.jsx("span",{children:"Daily Reports Filed"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(as,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:N?.totalTickets||0}),e.jsx("span",{children:"T&M Tickets Created"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(rl,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:N?.totalPhotosFromTickets||0}),e.jsx("span",{children:"Photos Documented"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(He,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsxs("strong",{children:[N?.completedAreasCount||0,"/",v.length]}),e.jsx("span",{children:"Work Areas Complete"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(xs,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:xe(N?.allCostsTotal||0)}),e.jsx("span",{children:"Total Costs Tracked"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Re,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:N?.laborManDays||0}),e.jsx("span",{children:"Total Man-Days"})]})]})]})})]}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(ge,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[N?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(yn,{project:d,company:s,onShowToast:a})})})]}),e.jsxs("div",{className:`reports-section-card ${(N?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(N?.injuryReportsCount||0)>0?"warning":"success"}`,children:(N?.injuryReportsCount||0)>0?"⚠":"✓"}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(N?.injuryReportsCount||0)>0?"warning":"success"}`,children:(N?.injuryReportsCount||0)>0?`${N.injuryReportsCount} incident${N.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(Nn,{project:d,companyId:s?.id||d?.company_id,company:s,user:t,onShowToast:a})})})]})]}),A==="documents"&&e.jsx("div",{className:"pv-tab-panel documents-tab",children:e.jsx(o.Suspense,{fallback:e.jsx(Ve,{}),children:e.jsx(kc,{project:d,companyId:s?.id||d?.company_id,onShowToast:a,userRole:t?.access_level||"office"})})}),A==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:d.name}),d.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",d.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:Lt,children:e.jsx("span",{children:"Edit Project"})})]}),d.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(il,{size:14}),e.jsx("span",{children:d.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(He,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:d.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(as,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:d.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(xs,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:xe(q)}),e.jsx("span",{className:"info-quick-label",children:T>0?`Incl. +${xe(T)} COs`:"Contract Value"})]})]}),d.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:d.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(ll,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[d.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:d.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),d.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:d.client_contact})]}),d.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(ol,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${d.client_phone}`,className:"info-detail-value link",children:d.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Sa,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[le>0&&e.jsxs("span",{className:"info-badge done",children:[le," Done"]}),oe>0&&e.jsxs("span",{className:"info-badge working",children:[oe," Active"]}),me>0&&e.jsxs("span",{className:"info-badge pending",children:[me," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:v.map(_=>e.jsxs("div",{className:`info-area-item ${_.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[_.status==="done"&&e.jsx("span",{className:"status-dot done",children:"✓"}),_.status==="working"&&e.jsx("span",{className:"status-dot working",children:"●"}),_.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:"○"})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:_.name}),e.jsx("span",{className:`info-area-status-label ${_.status}`,children:_.status==="done"?"Complete":_.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[_.weight,"%"]})]},_.id))})]}),e.jsx(xc,{project:d,company:s,user:t,isAdmin:n,onShowToast:a}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(Ws,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:xe(d.contract_value)})]}),T>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",xe(T)]})]}),d.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:G.find(_=>_.id===d.default_dump_site_id)?.name||"Unknown"})]})]})]}),e.jsx("div",{className:"info-section-card",children:e.jsx(vc,{onShowToast:a})})]})]}),L&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(jc,{project:d,user:t,onClose:()=>B(!1),onShareCreated:_=>{a("Share link created successfully!","success")}})}),P&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(o.Suspense,{fallback:null,children:e.jsx(fc,{project:d,company:s,onShowToast:a,onClose:()=>S(!1)})})}),X&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(gc,{project:d,company:s,areas:v,existingCOR:ne,onClose:()=>{ee(!1),fe(null)},onSaved:()=>{ee(!1),fe(null),Ce(_=>_+1)},onShowToast:a})}),Xe&&se&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(bc,{cor:se,project:d,company:s,areas:v,onClose:()=>{Ee(!1),Fe(null)},onEdit:_=>{Ee(!1),Fe(null),fe(_),ee(!0)},onShowToast:a,onStatusChange:()=>{Ce(_=>_+1)}})}),De==="log"&&d&&e.jsx("div",{className:"cor-log-modal-overlay",onClick:()=>$("list"),children:e.jsxs("div",{className:"cor-log-modal",onClick:_=>_.stopPropagation(),children:[e.jsxs("div",{className:"cor-log-modal-header",children:[e.jsx("h2",{children:"Change Order Log"}),e.jsx("button",{className:"cor-log-modal-close",onClick:()=>$("list"),title:"Close",children:"✕"})]}),e.jsx("div",{className:"cor-log-modal-content",children:e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:e.jsx(yc,{project:d,company:s,onShowToast:a})})})]})}),et&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Cc,{onClose:()=>ke(!1),saving:Ss,onSave:async _=>{try{cs(!0),await W.addProjectCost(d.id,s.id,_),ke(!1),us(),a("Cost added successfully","success")}catch(K){console.error("Error adding cost:",K),a("Error adding cost","error")}finally{cs(!1)}}})}),wn&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(wc,{project:d,company:s,user:t,editItem:Ot,onSave:()=>{Ds(!1),Es(null),kn(_=>_+1),a(Ot?"Equipment updated":"Equipment added","success")},onClose:()=>{Ds(!1),Es(null)}})}),_n&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Nc,{project:d,company:s,areas:v,corStats:u.find(_=>_.id===d?.id)?.corStats,editDrawRequest:At,onSave:()=>{Ps(!1),Rs(null),Dn(_=>_+1),a(At?"Draw request updated":"Draw request created","success")},onClose:()=>{Ps(!1),Rs(null)}})})]})}return l.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(ge,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("button",{className:"search-trigger-btn",onClick:()=>Pn(!0),children:[e.jsx(nn,{size:16}),e.jsx("span",{children:"Search"}),e.jsx("span",{className:"shortcut",children:"⌘K"})]}),e.jsxs("div",{className:"bo-project-count",children:[l.length," Active Project",l.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(dr,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:xe(or)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:xe(lr)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:xe(cr)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Wt>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:xe(ir)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",Jt," project",Jt!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",xe(Wt)]})]})]}),Ut>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:xe(ur)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",Ut," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[Ht>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:Ht}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),Gt>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Gt}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Kt>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:Kt}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),Yt>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:Yt}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),mr&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[Xt>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:Xt}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),Qt>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Qt}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Zt>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:Zt}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),hr&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),sa>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[sa," under"]}),ta>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[ta," on track"]}),ea>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[ea," over"]})]})]})]}),ms.allAlerts.length>0&&e.jsxs("div",{className:"smart-alerts-section",style:{marginBottom:"var(--space-lg, 1.5rem)"},children:[e.jsx("div",{className:"smart-alerts-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"var(--space-sm, 0.5rem)"},children:e.jsxs("h3",{style:{fontSize:"var(--font-size-md, 1rem)",fontWeight:"var(--font-weight-semibold, 600)",color:"var(--text-primary)",margin:0},children:["Needs Attention",ms.criticalCount>0&&e.jsxs("span",{style:{marginLeft:"0.5rem",padding:"2px 8px",fontSize:"0.75rem",fontWeight:600,borderRadius:"9999px",background:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"},children:[ms.criticalCount," critical"]})]})}),e.jsx($o,{alerts:ms.allAlerts,onAction:Un,maxVisible:3})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[l.length," active"]})]}),e.jsx("div",{className:"project-list",children:u.map(f=>{const M=ms.projectRisks.find(T=>T.projectId===f.id);return e.jsx(Rc,{project:f,riskScore:M?.riskScore,riskStatus:M?.riskStatus,onClick:()=>Fs(f)},f.id)})}),e.jsx(Ao,{isOpen:En,onClose:Rn,companyId:s?.id,onSelectProject:f=>{Fs(f)},onSelectTicket:f=>{const M=l.find(T=>T.id===f.project_id);M&&(Fs(M),z("financials"),V("tickets"))},onSelectCOR:f=>{const M=l.find(T=>T.id===f.project_id);M&&(Fs(M),z("financials"),V("cors"),Fe(f),Ee(!0))},onShowToast:a})]})}function Rc({project:s,riskScore:t,riskStatus:n,onClick:a}){const r=Ii(s.areas||[]),i=Li(s.areas||[]),l=s.contract_value-s.billable,c=s.billable>s.contract_value*.9&&s.progress<90,u={healthy:{bg:"var(--status-success-bg, #064e3b)",color:"var(--status-success, #059669)"},warning:{bg:"var(--status-warning-bg, #78350f)",color:"var(--status-warning, #d97706)"},critical:{bg:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"}},m=u[n]||u.healthy;return e.jsxs("div",{className:`project-card enhanced ${c?"at-risk":""}`,onClick:a,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[typeof t=="number"&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,background:m.bg,color:m.color},title:`Risk Score: ${t}`,"aria-label":`Risk score ${t}, ${n}`,children:t}),e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:s.name}),e.jsx("div",{className:"project-card-value",children:xe(s.contract_value)})]})]}),e.jsx("span",{className:`status-badge ${r}`,children:i})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[s.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:xe(s.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${l<0?"negative":""}`,children:xe(Math.abs(l))}),e.jsx("span",{className:"stat-label",children:l>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${s.progress}%`}})}),(s.pendingTickets>0||s.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[s.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[s.pendingTickets," Pending T&M"]}),s.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[s.approvedTickets," Approved T&M"]})]}),s.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${s.scheduleStatus}`,children:s.scheduleLabel}),s.hasLaborData&&s.laborLabel&&e.jsx("span",{className:`labor-indicator ${s.laborStatus}`,children:s.laborLabel})]})]})}const Ic=Object.freeze(Object.defineProperty({__proto__:null,default:Pc},Symbol.toStringTag,{value:"Module"}));export{vo as A,$c as C,Ic as D,Ve as T,Uo as a,vs as b,Mc as c,Ac as e};
//# sourceMappingURL=Dashboard-C8cUsB7T.js.map
