const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TMList-kfqzDz4n.js","assets/pdf-aQqpMATS.js","assets/index-DffI6H_y.js","assets/icons-B-oSmWeD.js","assets/react-DXGY7bZi.js","assets/supabase-VuevzHjS.js","assets/index-BL-rOEPq.css","assets/SignatureLinkGenerator-DlIp_9TX.js","assets/corCalculations-D9qkkIbo.js","assets/ShareModal-DDMCJvz0.js","assets/InjuryReportsList-DM0eYzGa.js","assets/NotificationSettings-B7kOXw94.js","assets/DailyReportsList-JukE7RVP.js","assets/CORList-85xlWopU.js","assets/CORLog-DFq6b9QJ.js","assets/CORForm-BcudIanW.js","assets/CORDetail-C1Q9Y9KF.js","assets/CORLogPreview-B1pIsifF.js","assets/BillingCenter-CdErthfA.js","assets/DrawRequestModal-JmkT4rb-.js","assets/EquipmentModal-D0s2xQH0.js","assets/AddCostModal-DRmCQi8k.js","assets/DocumentsTab-CdRbXjYG.js"])))=>i.map(i=>d[i]);
import{_ as ne}from"./pdf-aQqpMATS.js";import{r as as,c as na,a as xr,S as vr,b as fr,u as Fe,s as jr,d as gr,e as br,f as yr,g as Nr,h as wr,i as Cr,j as Te,k as ra,l as kr,m as et,n as Dr,o as Sr,p as _r,D as kt,q as ia,t as Er,v as Pr,w as Or,x as st,y as Tr,z as Ar,A as Dt,Z as St,L as es,C as Rr,B as Mr,E as ye,F as at,G as la,H as Fr,I as As,J as ca,K as _t,M as Et,N as Ir,O as $r,P as oa,Q as da,R as Lr,T as zr,U as Pt,V as tt,W as qr,X as Vr,Y as Br,_ as Wr,$ as Hr,a0 as Ur,a1 as Ot,a2 as Kr,a3 as Gr,a4 as Yr,a5 as Xr,a6 as Jr,a7 as Zr,a8 as Qr,a9 as ei,aa as nt,ab as rt,ac as it,ad as si,ae as ai,af as ti,ag as Re,ah as ni,ai as ri,aj as ii,ak as Tt,al as Xs,am as li,an as ci,ao as oi,ap as di,aq as ui,ar as L,as as e,at as mi,au as Me,av as ua,aw as At,ax as Rt,ay as Mt,az as ma,aA as hi,aB as pi,aC as xi,aD as vi,aE as lt,aF as ct,aG as se,aH as fi,aI as ji,aJ as gi,aK as bi}from"./index-DffI6H_y.js";import{r as d,e as Ft,X as ts,a4 as yi,Y as sa,y as ze,F as $e,s as he,N as xe,a2 as _s,T as Es,a5 as Ni,a6 as wi,H as Ee,z as Ci,n as ss,l as Pe,p as Rs,q as ns,O as It,R as ki,a7 as Di,a8 as $t,a9 as Si,aa as rs,m as ha,K as is,ab as _i,ac as Ei,W as aa,j as Pi,a as ls,i as Oi,ad as Ti,ae as Js,af as Ai,c as ot,d as Ri,Q as Xe,ag as Lt,ah as Mi,ai as Fi,aj as zt,ak as Ii,D as Je,al as dt,am as $i,v as Li,f as zi,an as qi,ao as Vi,ap as Bi}from"./icons-B-oSmWeD.js";import{f as oe}from"./corCalculations-D9qkkIbo.js";function Ps(){return Ps=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var t in r)({}).hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},Ps.apply(null,arguments)}function ut(s,a){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,t)}return r}function Wi(s){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?ut(Object(r),!0).forEach(function(t){Hi(s,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):ut(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}function Hi(s,a,r){return(a=Ui(a))in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function Ui(s){var a=Ki(s,"string");return typeof a=="symbol"?a:a+""}function Ki(s,a){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var t=r.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}var ce=32,Gi={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function Yi(s){var{data:a,iconType:r,inactiveColor:t}=s,n=ce/2,i=ce/6,l=ce/3,c=a.inactive?t:a.color,h=r??a.type;if(h==="none")return null;if(h==="plainline"){var u;return d.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:(u=a.payload)===null||u===void 0?void 0:u.strokeDasharray,x1:0,y1:n,x2:ce,y2:n,className:"recharts-legend-icon"})}if(h==="line")return d.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(n,"h").concat(l,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(2*l,",").concat(n,`
            H`).concat(ce,"M").concat(2*l,",").concat(n,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(l,",").concat(n),className:"recharts-legend-icon"});if(h==="rect")return d.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(ce/8,"h").concat(ce,"v").concat(ce*3/4,"h").concat(-ce,"z"),className:"recharts-legend-icon"});if(d.isValidElement(a.legendIcon)){var o=Wi({},a);return delete o.legendIcon,d.cloneElement(a.legendIcon,o)}return d.createElement(fr,{fill:c,cx:n,cy:n,size:ce,sizeType:"diameter",type:h})}function Xi(s){var{payload:a,iconSize:r,layout:t,formatter:n,inactiveColor:i,iconType:l}=s,c={x:0,y:0,width:ce,height:ce},h={display:t==="horizontal"?"inline-block":"block",marginRight:10},u={display:"inline-block",verticalAlign:"middle",marginRight:4};return a.map((o,x)=>{var j=o.formatter||n,b=na({"recharts-legend-item":!0,["legend-item-".concat(x)]:!0,inactive:o.inactive});if(o.type==="none")return null;var m=o.inactive?i:o.color,p=j?j(o.value,o,x):o.value;return d.createElement("li",Ps({className:b,style:h,key:"legend-item-".concat(x)},xr(s,o,x)),d.createElement(vr,{width:r,height:r,viewBox:c,style:u,"aria-label":"".concat(p," legend icon")},d.createElement(Yi,{data:o,iconType:l,inactiveColor:i})),d.createElement("span",{className:"recharts-legend-item-text",style:{color:m}},p))})}var Ji=s=>{var a=as(s,Gi),{payload:r,layout:t,align:n}=a;if(!r||!r.length)return null;var i={padding:0,margin:0,textAlign:t==="horizontal"?n:"left"};return d.createElement("ul",{className:"recharts-default-legend",style:i},d.createElement(Xi,Ps({},a,{payload:r})))};function Zi(){return Fe(jr)}var Qi=["contextPayload"];function ta(){return ta=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var t in r)({}).hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},ta.apply(null,arguments)}function mt(s,a){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,t)}return r}function qe(s){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?mt(Object(r),!0).forEach(function(t){el(s,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):mt(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}function el(s,a,r){return(a=sl(a))in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function sl(s){var a=al(s,"string");return typeof a=="symbol"?a:a+""}function al(s,a){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var t=r.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function tl(s,a){if(s==null)return{};var r,t,n=nl(s,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(t=0;t<i.length;t++)r=i[t],a.indexOf(r)===-1&&{}.propertyIsEnumerable.call(s,r)&&(n[r]=s[r])}return n}function nl(s,a){if(s==null)return{};var r={};for(var t in s)if({}.hasOwnProperty.call(s,t)){if(a.indexOf(t)!==-1)continue;r[t]=s[t]}return r}function rl(s){return s.value}function il(s){var{contextPayload:a}=s,r=tl(s,Qi),t=Dr(a,s.payloadUniqBy,rl),n=qe(qe({},r),{},{payload:t});return d.isValidElement(s.content)?d.cloneElement(s.content,n):typeof s.content=="function"?d.createElement(s.content,n):d.createElement(Ji,n)}function ll(s,a,r,t,n,i){var{layout:l,align:c,verticalAlign:h}=a,u,o;return(!s||(s.left===void 0||s.left===null)&&(s.right===void 0||s.right===null))&&(c==="center"&&l==="vertical"?u={left:((t||0)-i.width)/2}:u=c==="right"?{right:r&&r.right||0}:{left:r&&r.left||0}),(!s||(s.top===void 0||s.top===null)&&(s.bottom===void 0||s.bottom===null))&&(h==="middle"?o={top:((n||0)-i.height)/2}:o=h==="bottom"?{bottom:r&&r.bottom||0}:{top:r&&r.top||0}),qe(qe({},u),o)}function cl(s){var a=ra();return d.useEffect(()=>{a(kr(s))},[a,s]),null}function ol(s){var a=ra();return d.useEffect(()=>(a(et(s)),()=>{a(et({width:0,height:0}))}),[a,s]),null}function dl(s,a,r,t){return s==="vertical"&&Te(a)?{height:a}:s==="horizontal"?{width:r||t}:null}var ul={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function Ms(s){var a=as(s,ul),r=Zi(),t=gr(),n=br(),{width:i,height:l,wrapperStyle:c,portal:h}=a,[u,o]=yr([r]),x=Nr(),j=wr();if(x==null||j==null)return null;var b=x-(n?.left||0)-(n?.right||0),m=dl(a.layout,l,i,b),p=h?c:qe(qe({position:"absolute",width:m?.width||i||"auto",height:m?.height||l||"auto"},ll(c,a,n,x,j,u)),c),k=h??t;if(k==null||r==null)return null;var P=d.createElement("div",{className:"recharts-legend-wrapper",style:p,ref:o},d.createElement(cl,{layout:a.layout,align:a.align,verticalAlign:a.verticalAlign,itemSorter:a.itemSorter}),!h&&d.createElement(ol,{width:u.width,height:u.height}),d.createElement(il,ta({},a,m,{margin:n,chartWidth:x,chartHeight:j,contextPayload:r})));return Cr.createPortal(P,k)}Ms.displayName="Legend";function ht(s,a){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,t)}return r}function pt(s){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?ht(Object(r),!0).forEach(function(t){ml(s,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}function ml(s,a,r){return(a=hl(a))in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function hl(s){var a=pl(s,"string");return typeof a=="symbol"?a:a+""}function pl(s,a){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var t=r.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function Os(){return Os=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var t in r)({}).hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},Os.apply(null,arguments)}var xl=(s,a)=>{var r;if(d.isValidElement(s))r=d.cloneElement(s,a);else if(typeof s=="function")r=s(a);else{if(!ye(a.x1)||!ye(a.y1)||!ye(a.x2)||!ye(a.y2))return null;r=d.createElement("line",Os({},a,{className:"recharts-reference-line-line"}))}return r},vl=(s,a,r,t,n,i)=>{var{x:l,width:c}=i,h=n.y.apply(s,{position:r});if(la(h)||a==="discard"&&!n.y.isInRange(h))return null;var u=[{x:l+c,y:h},{x:l,y:h}];return t==="left"?u.reverse():u},fl=(s,a,r,t,n,i)=>{var{y:l,height:c}=i,h=n.x.apply(s,{position:r});if(la(h)||a==="discard"&&!n.x.isInRange(h))return null;var u=[{x:h,y:l+c},{x:h,y:l}];return t==="top"?u.reverse():u},jl=(s,a,r,t)=>{var n=s.map(i=>t.apply(i,{position:r}));return a==="discard"&&n.some(i=>!t.isInRange(i))?null:n},gl=(s,a,r,t,n,i)=>{var{x:l,y:c,segment:h,ifOverflow:u}=i,o=at(l),x=at(c);return x?vl(c,u,r,n,s,a):o?fl(l,u,r,t,s,a):h!=null&&h.length===2?jl(h,u,r,s):null};function bl(s){var a=ra();return d.useEffect(()=>(a(Sr(s)),()=>{a(_r(s))})),null}function yl(s){var{xAxisId:a,yAxisId:r,shape:t,className:n,ifOverflow:i}=s,l=ia(),c=Er(),h=Fe(F=>Pr(F,a)),u=Fe(F=>Or(F,r)),o=Fe(F=>st(F,"xAxis",a,l)),x=Fe(F=>st(F,"yAxis",r,l)),j=Tr();if(!c||!j||h==null||u==null||o==null||x==null)return null;var b=Ar({x:o,y:x}),m=gl(b,j,s.position,h.orientation,u.orientation,s);if(!m)return null;var[{x:p,y:k},{x:P,y:v}]=m,O=i==="hidden"?"url(#".concat(c,")"):void 0,g=pt(pt({clipPath:O},Dt(s)),{},{x1:p,y1:k,x2:P,y2:v}),N=Fr({x1:p,y1:k,x2:P,y2:v});return d.createElement(St,{zIndex:s.zIndex},d.createElement(es,{className:na("recharts-reference-line",n)},xl(t,g),d.createElement(Rr,Os({},N,{lowerWidth:N.width,upperWidth:N.width}),d.createElement(Mr,{label:s.label}),s.children)))}var Nl={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:kt.line};function qt(s){var a=as(s,Nl);return d.createElement(d.Fragment,null,d.createElement(bl,{yAxisId:a.yAxisId,xAxisId:a.xAxisId,ifOverflow:a.ifOverflow,x:a.x,y:a.y,segment:a.segment}),d.createElement(yl,a))}qt.displayName="ReferenceLine";var Vt=(s,a,r)=>_t(s,"xAxis",oa(s,a),r),Bt=(s,a,r)=>Et(s,"xAxis",oa(s,a),r),Wt=(s,a,r)=>_t(s,"yAxis",da(s,a),r),Ht=(s,a,r)=>Et(s,"yAxis",da(s,a),r),wl=As([ca,Vt,Wt,Bt,Ht],(s,a,r,t,n)=>Pt(s,"xAxis")?tt(a,t,!1):tt(r,n,!1)),Cl=(s,a)=>a,Ut=As([qr,Cl],(s,a)=>s.filter(r=>r.type==="area").find(r=>r.id===a)),Kt=s=>{var a=ca(s),r=Pt(a,"xAxis");return r?"yAxis":"xAxis"},kl=(s,a)=>{var r=Kt(s);return r==="yAxis"?da(s,a):oa(s,a)},Dl=(s,a,r)=>Lr(s,Kt(s),kl(s,a),r),Sl=As([Ut,Dl],(s,a)=>{var r;if(!(s==null||a==null)){var{stackId:t}=s,n=zr(s);if(!(t==null||n==null)){var i=(r=a[t])===null||r===void 0?void 0:r.stackedData,l=i?.find(c=>c.key===n);if(l!=null)return l.map(c=>[c[0],c[1]])}}}),_l=As([ca,Vt,Wt,Bt,Ht,Sl,Ir,wl,Ut,$r],(s,a,r,t,n,i,l,c,h,u)=>{var{chartData:o,dataStartIndex:x,dataEndIndex:j}=l;if(!(h==null||s!=="horizontal"&&s!=="vertical"||a==null||r==null||t==null||n==null||t.length===0||n.length===0||c==null)){var{data:b}=h,m;if(b&&b.length>0?m=b:m=o?.slice(x,j+1),m!=null)return Kl({layout:s,xAxis:a,yAxis:r,xAxisTicks:t,yAxisTicks:n,dataStartIndex:x,areaSettings:h,stackedData:i,displayedData:m,chartBaseValue:u,bandSize:c})}}),El=["id"],Pl=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function Oe(){return Oe=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var t in r)({}).hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},Oe.apply(null,arguments)}function Gt(s,a){if(s==null)return{};var r,t,n=Ol(s,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(t=0;t<i.length;t++)r=i[t],a.indexOf(r)===-1&&{}.propertyIsEnumerable.call(s,r)&&(n[r]=s[r])}return n}function Ol(s,a){if(s==null)return{};var r={};for(var t in s)if({}.hasOwnProperty.call(s,t)){if(a.indexOf(t)!==-1)continue;r[t]=s[t]}return r}function xt(s,a){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),r.push.apply(r,t)}return r}function Ie(s){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?xt(Object(r),!0).forEach(function(t){Tl(s,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):xt(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}function Tl(s,a,r){return(a=Al(a))in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function Al(s){var a=Rl(s,"string");return typeof a=="symbol"?a:a+""}function Rl(s,a){if(typeof s!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var t=r.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function Ts(s,a){return s&&s!=="none"?s:a}var Ml=s=>{var{dataKey:a,name:r,stroke:t,fill:n,legendType:i,hide:l}=s;return[{inactive:l,dataKey:a,type:i,color:Ts(t,n),value:Ot(r,a),payload:s}]},Fl=d.memo(s=>{var{dataKey:a,data:r,stroke:t,strokeWidth:n,fill:i,name:l,hide:c,unit:h,tooltipType:u,id:o}=s,x={dataDefinedOnItem:r,positions:void 0,settings:{stroke:t,strokeWidth:n,fill:i,dataKey:a,nameKey:void 0,name:Ot(l,a),hide:c,type:u,color:Ts(t,i),unit:h,graphicalItemId:o}};return d.createElement(Kr,{tooltipEntrySettings:x})});function Il(s){var{clipPathId:a,points:r,props:t}=s,{needClip:n,dot:i,dataKey:l}=t,c=Tt(t);return d.createElement(li,{points:r,dot:i,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:l,baseProps:c,needClip:n,clipPathId:a})}function $l(s){var{showLabels:a,children:r,points:t}=s,n=t.map(i=>{var l,c,h={x:(l=i.x)!==null&&l!==void 0?l:0,y:(c=i.y)!==null&&c!==void 0?c:0,width:0,lowerWidth:0,upperWidth:0,height:0};return Ie(Ie({},h),{},{value:i.value,payload:i.payload,parentViewBox:void 0,viewBox:h,fill:void 0})});return d.createElement(ii,{value:a?n:void 0},r)}function vt(s){var{points:a,baseLine:r,needClip:t,clipPathId:n,props:i}=s,{layout:l,type:c,stroke:h,connectNulls:u,isRange:o}=i,{id:x}=i,j=Gt(i,El),b=Tt(j),m=Dt(j);return d.createElement(d.Fragment,null,a?.length>1&&d.createElement(es,{clipPath:t?"url(#clipPath-".concat(n,")"):void 0},d.createElement(Xs,Oe({},m,{id:x,points:a,connectNulls:u,type:c,baseLine:r,layout:l,stroke:"none",className:"recharts-area-area"})),h!=="none"&&d.createElement(Xs,Oe({},b,{className:"recharts-area-curve",layout:l,type:c,connectNulls:u,fill:"none",points:a})),h!=="none"&&o&&d.createElement(Xs,Oe({},b,{className:"recharts-area-curve",layout:l,type:c,connectNulls:u,fill:"none",points:r}))),d.createElement(Il,{points:a,props:j,clipPathId:n}))}function Ll(s){var a,r,{alpha:t,baseLine:n,points:i,strokeWidth:l}=s,c=(a=i[0])===null||a===void 0?void 0:a.y,h=(r=i[i.length-1])===null||r===void 0?void 0:r.y;if(!ye(c)||!ye(h))return null;var u=t*Math.abs(c-h),o=Math.max(...i.map(x=>x.x||0));return Te(n)?o=Math.max(n,o):n&&Array.isArray(n)&&n.length&&(o=Math.max(...n.map(x=>x.x||0),o)),Te(o)?d.createElement("rect",{x:0,y:c<h?c:c-u,width:o+(l?parseInt("".concat(l),10):1),height:Math.floor(u)}):null}function zl(s){var a,r,{alpha:t,baseLine:n,points:i,strokeWidth:l}=s,c=(a=i[0])===null||a===void 0?void 0:a.x,h=(r=i[i.length-1])===null||r===void 0?void 0:r.x;if(!ye(c)||!ye(h))return null;var u=t*Math.abs(c-h),o=Math.max(...i.map(x=>x.y||0));return Te(n)?o=Math.max(n,o):n&&Array.isArray(n)&&n.length&&(o=Math.max(...n.map(x=>x.y||0),o)),Te(o)?d.createElement("rect",{x:c<h?c:c-u,y:0,width:u,height:Math.floor(o+(l?parseInt("".concat(l),10):1))}):null}function ql(s){var{alpha:a,layout:r,points:t,baseLine:n,strokeWidth:i}=s;return r==="vertical"?d.createElement(Ll,{alpha:a,points:t,baseLine:n,strokeWidth:i}):d.createElement(zl,{alpha:a,points:t,baseLine:n,strokeWidth:i})}function Vl(s){var{needClip:a,clipPathId:r,props:t,previousPointsRef:n,previousBaselineRef:i}=s,{points:l,baseLine:c,isAnimationActive:h,animationBegin:u,animationDuration:o,animationEasing:x,onAnimationStart:j,onAnimationEnd:b}=t,m=d.useMemo(()=>({points:l,baseLine:c}),[l,c]),p=si(m,"recharts-area-"),k=ai(),[P,v]=d.useState(!1),O=!P,g=d.useCallback(()=>{typeof b=="function"&&b(),v(!1)},[b]),N=d.useCallback(()=>{typeof j=="function"&&j(),v(!0)},[j]);if(k==null)return null;var F=n.current,K=i.current;return d.createElement($l,{showLabels:O,points:l},t.children,d.createElement(ti,{animationId:p,begin:u,duration:o,isActive:h,easing:x,onAnimationEnd:g,onAnimationStart:N,key:p},_=>{if(F){var w=F.length/l.length,M=_===1?l:l.map((T,z)=>{var C=Math.floor(z*w);if(F[C]){var Z=F[C];return Ie(Ie({},T),{},{x:Re(Z.x,T.x,_),y:Re(Z.y,T.y,_)})}return T}),$;return Te(c)?$=Re(K,c,_):ni(c)||la(c)?$=Re(K,0,_):$=c.map((T,z)=>{var C=Math.floor(z*w);if(Array.isArray(K)&&K[C]){var Z=K[C];return Ie(Ie({},T),{},{x:Re(Z.x,T.x,_),y:Re(Z.y,T.y,_)})}return T}),_>0&&(n.current=M,i.current=$),d.createElement(vt,{points:M,baseLine:$,needClip:a,clipPathId:r,props:t})}return _>0&&(n.current=l,i.current=c),d.createElement(es,null,h&&d.createElement("defs",null,d.createElement("clipPath",{id:"animationClipPath-".concat(r)},d.createElement(ql,{alpha:_,points:l,baseLine:c,layout:k,strokeWidth:t.strokeWidth}))),d.createElement(es,{clipPath:"url(#animationClipPath-".concat(r,")")},d.createElement(vt,{points:l,baseLine:c,needClip:a,clipPathId:r,props:t})))}),d.createElement(ri,{label:t.label}))}function Bl(s){var{needClip:a,clipPathId:r,props:t}=s,n=d.useRef(null),i=d.useRef();return d.createElement(Vl,{needClip:a,clipPathId:r,props:t,previousPointsRef:n,previousBaselineRef:i})}class Wl extends d.PureComponent{render(){var{hide:a,dot:r,points:t,className:n,top:i,left:l,needClip:c,xAxisId:h,yAxisId:u,width:o,height:x,id:j,baseLine:b,zIndex:m}=this.props;if(a)return null;var p=na("recharts-area",n),k=j,{r:P,strokeWidth:v}=Zr(r),O=Qr(r),g=P*2+v,N=c?"url(#clipPath-".concat(O?"":"dots-").concat(k,")"):void 0;return d.createElement(St,{zIndex:m},d.createElement(es,{className:p},c&&d.createElement("defs",null,d.createElement(ei,{clipPathId:k,xAxisId:h,yAxisId:u}),!O&&d.createElement("clipPath",{id:"clipPath-dots-".concat(k)},d.createElement("rect",{x:l-g/2,y:i-g/2,width:o+g,height:x+g}))),d.createElement(Bl,{needClip:c,clipPathId:k,props:this.props})),d.createElement(nt,{points:t,mainColor:Ts(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:N}),this.props.isRange&&Array.isArray(b)&&d.createElement(nt,{points:b,mainColor:Ts(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:N}))}}var Yt={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:kt.area};function Hl(s){var a,r=as(s,Yt),{activeDot:t,animationBegin:n,animationDuration:i,animationEasing:l,connectNulls:c,dot:h,fill:u,fillOpacity:o,hide:x,isAnimationActive:j,legendType:b,stroke:m,xAxisId:p,yAxisId:k}=r,P=Gt(r,Pl),v=Gr(),O=Yr(),{needClip:g}=Xr(p,k),N=ia(),{points:F,isRange:K,baseLine:_}=(a=Fe(C=>_l(C,s.id,N)))!==null&&a!==void 0?a:{},w=Jr();if(v!=="horizontal"&&v!=="vertical"||w==null||O!=="AreaChart"&&O!=="ComposedChart")return null;var{height:M,width:$,x:T,y:z}=w;return!F||!F.length?null:d.createElement(Wl,Oe({},P,{activeDot:t,animationBegin:n,animationDuration:i,animationEasing:l,baseLine:_,connectNulls:c,dot:h,fill:u,fillOpacity:o,height:M,hide:x,layout:v,isAnimationActive:j==="auto"?!ci.isSsr:j,isRange:K,legendType:b,needClip:g,points:F,stroke:m,width:$,left:T,top:z,xAxisId:p,yAxisId:k}))}var Ul=(s,a,r,t,n)=>{var i=r??a;if(Te(i))return i;var l=s==="horizontal"?n:t,c=l.scale.domain();if(l.type==="number"){var h=Math.max(c[0],c[1]),u=Math.min(c[0],c[1]);return i==="dataMin"?u:i==="dataMax"||h<0?h:Math.max(Math.min(c[0],c[1]),0)}return i==="dataMin"?c[0]:i==="dataMax"?c[1]:c[0]};function Kl(s){var{areaSettings:{connectNulls:a,baseValue:r,dataKey:t},stackedData:n,layout:i,chartBaseValue:l,xAxis:c,yAxis:h,displayedData:u,dataStartIndex:o,xAxisTicks:x,yAxisTicks:j,bandSize:b}=s,m=n&&n.length,p=Ul(i,l,r,c,h),k=i==="horizontal",P=!1,v=u.map((g,N)=>{var F,K,_;if(m)_=n[o+N];else{var w=rt(g,t);Array.isArray(w)?(_=w,P=!0):_=[p,w]}var M=(F=(K=_)===null||K===void 0?void 0:K[1])!==null&&F!==void 0?F:null,$=M==null||m&&!a&&rt(g,t)==null;return k?{x:it({axis:c,ticks:x,bandSize:b,entry:g,index:N}),y:$?null:h.scale(M),value:_,payload:g}:{x:$?null:c.scale(M),y:it({axis:h,ticks:j,bandSize:b,entry:g,index:N}),value:_,payload:g}}),O;return m||P?O=v.map(g=>{var N=Array.isArray(g.value)?g.value[0]:null;return k?{x:g.x,y:N!=null&&g.y!=null?h.scale(N):null,payload:g.payload}:{x:N!=null?c.scale(N):null,y:g.y,payload:g.payload}}):O=k?h.scale(p):c.scale(p),{points:v,baseLine:O,isRange:P}}function Gl(s){var a=as(s,Yt),r=ia();return d.createElement(Br,{id:a.id,type:"area"},t=>d.createElement(d.Fragment,null,d.createElement(Wr,{legendPayload:Ml(a)}),d.createElement(Fl,{dataKey:a.dataKey,data:a.data,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,name:a.name,hide:a.hide,unit:a.unit,tooltipType:a.tooltipType,id:t}),d.createElement(Hr,{type:"area",id:t,data:a.data,dataKey:a.dataKey,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,stackId:Ur(a.stackId),hide:a.hide,barSize:void 0,baseValue:a.baseValue,isPanorama:r,connectNulls:a.connectNulls}),d.createElement(Hl,Oe({},a,{id:t}))))}var Ze=d.memo(Gl,Vr);Ze.displayName="Area";var Yl=["axis"],Xl=d.forwardRef((s,a)=>d.createElement(oi,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:Yl,tooltipPayloadSearcher:di,categoricalChartProps:s,ref:a}));const ft={WARNING:"warning",ERROR:"error"},de={DATABASE:"database",NETWORK:"network",AUTH:"auth",VALIDATION:"validation",STORAGE:"storage",SYNC:"sync",GENERAL:"general"};function Jl(s){const a=s?.message?.toLowerCase()||"",r=s?.code?.toLowerCase()||"";return a.includes("fetch")||a.includes("network")||a.includes("offline")?de.NETWORK:a.includes("auth")||a.includes("unauthorized")||r.includes("auth")?de.AUTH:a.includes("storage")||a.includes("bucket")||a.includes("upload")?de.STORAGE:a.includes("validation")||a.includes("invalid")||a.includes("required")?de.VALIDATION:a.includes("sync")||a.includes("conflict")?de.SYNC:s?.code||a.includes("database")||a.includes("supabase")?de.DATABASE:de.GENERAL}function Zl(s,a,r){return r?.userMessage?r.userMessage:a===de.NETWORK?"Network connection issue. Your changes will sync when back online.":a===de.AUTH?"Session expired. Please sign in again.":a===de.STORAGE?"Failed to upload file. Please try again.":a===de.VALIDATION?s?.message||"Please check your input and try again.":a===de.SYNC?"Sync conflict detected. Please refresh and try again.":r?.operation?`Failed to ${r.operation.replace(/([A-Z])/g," $1").toLowerCase().trim()}. Please try again.`:"Something went wrong. Please try again."}function Ql(s,a={}){const{operation:r="unknown",category:t=Jl(s),severity:n=ft.ERROR,showToast:i,userMessage:l,companyId:c,projectId:h,userId:u,silent:o=!1,rethrow:x=!1}=a;if(ui.error(t,{message:s?.message||"Unknown error",code:s?.code,severity:n,operation:r,company_id:c,project_id:h,user_id:u,extra:{stack:s?.stack,name:s?.name}}),!o&&i){const j=Zl(s,t,{operation:r,userMessage:l}),b=n===ft.WARNING?"warning":"error";i(j,b)}if(x)throw s;return null}async function le(s,a={}){const{fallback:r=null,context:t={},showToast:n,silent:i=!0}=a;try{return await s()}catch(l){return Ql(l,{...t,showToast:n,silent:i}),r}}const Ve={budget:{healthy:.6,warning:.75,critical:.85},schedule:{healthy:.05,warning:.15,critical:.25},corExposure:{healthy:.05,warning:.15,critical:.25},activity:{healthy:1,warning:3,critical:5},safety:{healthy:0,warning:1,critical:2}},ec={budget:.3,schedule:.25,corExposure:.2,activity:.15,safety:.1};function cs(s,a){if(s<=a.healthy)return 0;if(s>=a.critical)return 100;const r=a.critical-a.healthy;return(s-a.healthy)/r*100}function os(s){return s<=25?"healthy":s<=60?"warning":"critical"}function sc(s,a,r=Ve.budget){if(!a||a<=0)return{score:0,status:"healthy",ratio:0,label:"No revenue yet"};const t=s/a,n=cs(t,r),i=os(n);let l;return t<r.healthy?l=`Costs at ${(t*100).toFixed(0)}% of revenue`:t<r.warning?l=`Costs at ${(t*100).toFixed(0)}% - monitor closely`:l=`Costs at ${(t*100).toFixed(0)}% - review immediately`,{score:n,status:i,ratio:t,label:l}}function ac(s,a,r=Ve.schedule){if(!a||a<=0)return{score:0,status:"healthy",variance:0,label:"No schedule baseline"};const t=(a-s)/a,n=Math.max(0,t),i=cs(n,r),l=os(i);let c;return t<=0?c=s>=100?"Complete":"On or ahead of schedule":t<r.warning?c=`${(t*100).toFixed(0)}% behind schedule`:c=`${(t*100).toFixed(0)}% behind - needs attention`,{score:i,status:l,variance:t,label:c}}function tc(s,a,r=Ve.corExposure){if(!a||a<=0)return{score:0,status:"healthy",exposure:0,label:"No contract value"};const t=s/a,n=cs(t,r),i=os(n);let l;return t<r.healthy?l=s>0?`$${Zs(s)} pending`:"No pending CORs":t<r.warning?l=`$${Zs(s)} pending (${(t*100).toFixed(0)}% of contract)`:l=`High exposure: $${Zs(s)} (${(t*100).toFixed(0)}%)`,{score:n,status:i,exposure:t,label:l}}function nc(s,a=Ve.activity){if(!s)return{score:100,status:"critical",daysSince:null,label:"No reports filed"};const r=new Date(s),n=Math.floor((new Date-r)/(1e3*60*60*24)),i=cs(n,a),l=os(i);let c;return n===0?c="Report filed today":n===1?c="Report filed yesterday":n<=a.warning?c=`Last report ${n} days ago`:c=`No report in ${n} days - may be stalled`,{score:i,status:l,daysSince:n,label:c}}function rc(s,a=Ve.safety){const r=s||0,t=cs(r,a),n=os(t);let i;return r===0?i="No incidents":r===1?i="1 incident in last 30 days":i=`${r} incidents - safety review needed`,{score:t,status:n,count:r,label:i}}function ic(s,a={}){const r={...Ve,...a.thresholds},t={...ec,...a.weights},n=sc(s.totalCosts,s.earnedRevenue,r.budget),i=ac(s.actualProgress,s.expectedProgress,r.schedule),l=tc(s.pendingCORValue,s.contractValue,r.corExposure),c=nc(s.lastReportDate,r.activity),h=rc(s.recentInjuryCount,r.safety),u=Math.round(n.score*t.budget+i.score*t.schedule+l.score*t.corExposure+c.score*t.activity+h.score*t.safety);let o;u<=25?o="healthy":u<=60?o="warning":o="critical";let x;return o==="healthy"?x="Project is on track":o==="warning"?x="Some factors need attention":x="Immediate review recommended",{score:u,status:o,label:x,factors:{budget:{...n,weight:t.budget},schedule:{...i,weight:t.schedule},corExposure:{...l,weight:t.corExposure},activity:{...c,weight:t.activity},safety:{...h,weight:t.safety}}}}function lc(s,a){const r=[],{factors:t}=s;t.budget.status==="critical"&&r.push({type:"critical",title:"Budget Alert",description:t.budget.label,action:"Review costs immediately",actionTarget:"financials",projectId:a.id}),t.activity.status==="critical"&&r.push({type:"critical",title:"Activity Alert",description:t.activity.label,action:"Check project status",actionTarget:"overview",projectId:a.id}),t.safety.status==="critical"&&r.push({type:"critical",title:"Safety Alert",description:t.safety.label,action:"Review safety reports",actionTarget:"reports",projectId:a.id}),t.budget.status==="warning"&&r.push({type:"warning",title:"Budget Watch",description:t.budget.label,action:"Monitor costs",actionTarget:"financials",projectId:a.id}),(t.schedule.status==="critical"||t.schedule.status==="warning")&&r.push({type:t.schedule.status==="critical"?"critical":"warning",title:"Schedule Alert",description:t.schedule.label,action:"Review progress",actionTarget:"overview",projectId:a.id}),(t.corExposure.status==="warning"||t.corExposure.status==="critical")&&r.push({type:t.corExposure.status==="critical"?"critical":"warning",title:"COR Exposure",description:t.corExposure.label,action:"Review pending CORs",actionTarget:"cors",projectId:a.id}),t.activity.status==="warning"&&r.push({type:"info",title:"Activity Notice",description:t.activity.label,action:"File daily report",actionTarget:"reports",projectId:a.id});const n={critical:0,warning:1,info:2};return r.sort((i,l)=>n[i.type]-n[l.type]),r}function cc(s){const{actualProgress:a,totalCosts:r,earnedRevenue:t,contractValue:n}=s;if(!a||a<=0)return{estimatedCompletionCost:null,estimatedFinalMargin:null,estimatedCompletionDate:null};const i=r/a,l=Math.round(i*100),c=n>0?(n-l)/n*100:0;let h=null;if(s.startDate&&a>0&&a<100){const u=new Date(s.startDate),o=new Date,x=Math.max(1,(o-u)/(1e3*60*60*24)),j=a/x,m=(100-a)/j;h=new Date(o.getTime()+m*24*60*60*1e3)}return{estimatedCompletionCost:l,estimatedFinalMargin:c,estimatedCompletionDate:h,costPerPercent:i}}function Zs(s){return s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toFixed(0)}const Fs=()=>ne(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),Q=210,I=14,pe=Q-I*2,Le=s=>s?new Date(s+(s.includes("T")?"":"T12:00:00")).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"—",ve=(s,a,r=30)=>a+r>s.internal.pageSize.height-20?(s.addPage(),20):a;async function oc(s,a){const t=(await Fs()).default,n=new t;let i=20;n.setFontSize(18),n.setFont(void 0,"bold"),n.text("Daily Reports",Q/2,i,{align:"center"}),i+=8,n.setFontSize(11),n.setFont(void 0,"normal"),n.text(`Project: ${a.name}`,Q/2,i,{align:"center"}),i+=6,n.text(`${s.length} report${s.length!==1?"s":""}`,Q/2,i,{align:"center"}),i+=12,s.forEach((c,h)=>{i=ve(n,i,60),n.setDrawColor(200,200,200),n.setFillColor(245,247,250),n.roundedRect(I,i-2,pe,10,2,2,"F"),n.setFontSize(11),n.setFont(void 0,"bold"),n.setTextColor(30,30,30),n.text(`${Le(c.report_date)}`,I+4,i+5);const u=c.status==="submitted"?"Submitted":"Draft";n.setFontSize(9),n.setFont(void 0,"normal"),n.text(u,Q-I-4,i+5,{align:"right"}),i+=14,n.setTextColor(0,0,0),n.setFontSize(9);const o=[`Crew: ${c.crew_count||0}`,`Tasks: ${c.tasks_completed||0}/${c.tasks_total||0}`,`T&M Tickets: ${c.tm_tickets_count||0}`,`Photos: ${c.photos_count||0}`];if(n.text(o.join("    |    "),I+4,i),i+=7,c.crew_list?.length>0){n.setFont(void 0,"bold"),n.text("Crew:",I+4,i),n.setFont(void 0,"normal");const x=c.crew_list.map(b=>`${b.name} (${b.role||"Laborer"})`).join(", "),j=n.splitTextToSize(x,pe-8);i+=4,n.text(j,I+4,i),i+=j.length*4+2}if(c.field_notes){i=ve(n,i,15),n.setFont(void 0,"bold"),n.text("Field Notes:",I+4,i),n.setFont(void 0,"normal"),i+=4;const x=n.splitTextToSize(c.field_notes,pe-8);n.text(x,I+4,i),i+=x.length*4+2}if(c.issues){i=ve(n,i,15),n.setFont(void 0,"bold"),n.text("Issues:",I+4,i),n.setFont(void 0,"normal"),i+=4;const x=n.splitTextToSize(c.issues,pe-8);n.text(x,I+4,i),i+=x.length*4+2}i+=8,h<s.length-1&&(n.setDrawColor(220,220,220),n.line(I,i,Q-I,i),i+=6)});const l=`${a.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;n.save(l)}async function dc(s,a){const t=(await Fs()).default,n=new t;let i=20;n.setFontSize(18),n.setFont(void 0,"bold"),n.text("Incident / Injury Reports",Q/2,i,{align:"center"}),i+=8,n.setFontSize(11),n.setFont(void 0,"normal"),n.text(`Project: ${a.name}`,Q/2,i,{align:"center"}),i+=6,n.text(`${s.length} report${s.length!==1?"s":""}`,Q/2,i,{align:"center"}),i+=12,s.forEach((c,h)=>{i=ve(n,i,50);const o={minor:[34,197,94],serious:[245,158,11],critical:[239,68,68],near_miss:[59,130,246]}[c.injury_type]||[128,128,128];n.setFillColor(...o),n.roundedRect(I,i-2,3,14,1,1,"F"),n.setFontSize(11),n.setFont(void 0,"bold"),n.setTextColor(30,30,30),n.text(`${Le(c.incident_date)}`,I+8,i+4),n.setFontSize(9);const x=(c.injury_type||"").replace("_"," ").toUpperCase();if(n.text(x,I+8,i+10),n.setFont(void 0,"normal"),n.text(c.status==="open"?"OPEN":"CLOSED",Q-I-4,i+4,{align:"right"}),i+=16,n.setTextColor(0,0,0),c.description){n.setFontSize(9),n.setFont(void 0,"bold"),n.text("Description:",I+4,i),n.setFont(void 0,"normal"),i+=4;const j=n.splitTextToSize(c.description,pe-8);n.text(j,I+4,i),i+=j.length*4+2}c.location&&(n.setFont(void 0,"bold"),n.text("Location: ",I+4,i),n.setFont(void 0,"normal"),n.text(c.location,I+30,i),i+=6),i+=6,h<s.length-1&&(n.setDrawColor(220,220,220),n.line(I,i,Q-I,i),i+=6)});const l=`${a.name}_Incident_Reports_${new Date().toISOString().split("T")[0]}.pdf`;n.save(l)}async function uc(s,a){const t=(await Fs()).default,n=new t;let i=20;n.setFontSize(18),n.setFont(void 0,"bold"),n.text("Crew Check-In History",Q/2,i,{align:"center"}),i+=8,n.setFontSize(11),n.setFont(void 0,"normal"),n.text(`Project: ${a.name}`,Q/2,i,{align:"center"}),i+=6,n.text(`${s.length} check-in${s.length!==1?"s":""}`,Q/2,i,{align:"center"}),i+=12,s.forEach((c,h)=>{i=ve(n,i,30);const u=c.workers||[];n.setFillColor(245,247,250),n.roundedRect(I,i-2,pe,9,2,2,"F"),n.setFontSize(10),n.setFont(void 0,"bold"),n.setTextColor(30,30,30),n.text(Le(c.check_in_date),I+4,i+4),n.setFont(void 0,"normal"),n.text(`${u.length} workers`,Q-I-4,i+4,{align:"right"}),i+=12,n.setTextColor(0,0,0),n.setFontSize(9),u.length>0&&(n.setFont(void 0,"bold"),n.text("Name",I+4,i),n.text("Role",110,i),i+=5,n.setFont(void 0,"normal"),u.forEach(o=>{i=ve(n,i,6),n.text(o.name||"—",I+4,i),n.text(o.role||"Laborer",110,i),i+=4.5})),i+=6,h<s.length-1&&(n.setDrawColor(220,220,220),n.line(I,i,Q-I,i),i+=5)});const l=`${a.name}_Crew_Checkins_${new Date().toISOString().split("T")[0]}.pdf`;n.save(l)}async function mc({dailyReports:s=[],incidentReports:a=[],crewCheckins:r=[],project:t}){const i=(await Fs()).default,l=new i;let c=20;l.setFontSize(22),l.setFont(void 0,"bold"),l.text("Field Documents Report",Q/2,c,{align:"center"}),c+=10,l.setFontSize(13),l.setFont(void 0,"normal"),l.text(`Project: ${t.name}`,Q/2,c,{align:"center"}),c+=8,l.setFontSize(10),l.text(`Generated: ${new Date().toLocaleDateString()}`,Q/2,c,{align:"center"}),c+=16,l.setFontSize(11),l.setFont(void 0,"bold"),l.text("Document Summary",I,c),c+=8,l.setFontSize(10),l.setFont(void 0,"normal"),[["Daily Reports",`${s.length}`],["Incident Reports",`${a.length}`],["Crew Check-Ins",`${r.length}`]].forEach(([o,x])=>{l.text(o,I+4,c),l.text(x,100,c),c+=6}),s.length>0&&(l.addPage(),c=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Daily Reports",I,c),c+=10,s.forEach((o,x)=>{if(c=ve(l,c,40),l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(Le(o.report_date),I+2,c),l.setFont(void 0,"normal"),l.setFontSize(8),l.text(`Crew: ${o.crew_count||0} | Tasks: ${o.tasks_completed||0}/${o.tasks_total||0} | T&M: ${o.tm_tickets_count||0}`,I+60,c),c+=6,l.setTextColor(0,0,0),l.setFontSize(9),o.field_notes){const j=l.splitTextToSize(o.field_notes,pe-4);l.text(j,I+2,c),c+=j.length*4+2}if(o.issues){l.setFont(void 0,"bold"),l.text("Issues: ",I+2,c),l.setFont(void 0,"normal");const j=l.splitTextToSize(o.issues,pe-20);l.text(j,I+20,c),c+=j.length*4+2}c+=4,x<s.length-1&&(l.setDrawColor(220,220,220),l.line(I,c,Q-I,c),c+=4)})),a.length>0&&(l.addPage(),c=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Incident / Injury Reports",I,c),c+=10,a.forEach((o,x)=>{c=ve(l,c,35),l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(Le(o.incident_date),I+2,c),l.setFontSize(8),l.setFont(void 0,"normal");const j=(o.injury_type||"").replace("_"," ").toUpperCase();if(l.text(`${j} — ${o.status?.toUpperCase()||""}`,I+60,c),c+=6,l.setTextColor(0,0,0),l.setFontSize(9),o.description){const b=l.splitTextToSize(o.description,pe-4);l.text(b,I+2,c),c+=b.length*4+2}o.location&&(l.text(`Location: ${o.location}`,I+2,c),c+=5),c+=4,x<a.length-1&&(l.setDrawColor(220,220,220),l.line(I,c,Q-I,c),c+=4)})),r.length>0&&(l.addPage(),c=20,l.setFontSize(16),l.setFont(void 0,"bold"),l.text("Crew Check-In History",I,c),c+=10,r.forEach((o,x)=>{c=ve(l,c,20);const j=o.workers||[];if(l.setFontSize(10),l.setFont(void 0,"bold"),l.setTextColor(30,30,30),l.text(Le(o.check_in_date),I+2,c),l.setFont(void 0,"normal"),l.setFontSize(8),l.text(`${j.length} workers`,I+60,c),c+=6,l.setTextColor(0,0,0),l.setFontSize(8),j.length>0){const b=j.map(p=>`${p.name} (${p.role||"Laborer"})`).join(", "),m=l.splitTextToSize(b,pe-4);l.text(m,I+2,c),c+=m.length*3.5+3}x<r.length-1&&(l.setDrawColor(230,230,230),l.line(I,c,Q-I,c),c+=3)}));const u=`${t.name}_Field_Documents_${new Date().toISOString().split("T")[0]}.pdf`;l.save(u)}function hc({isOpen:s,onClose:a,companyId:r,onSelectProject:t,onSelectTicket:n,onSelectCOR:i,onShowToast:l}){const[c,h]=d.useState(""),[u,o]=d.useState({projects:[],tickets:[],cors:[],workers:[]}),[x,j]=d.useState(!1),[b,m]=d.useState(0),p=d.useRef(null),k=d.useRef(null),P=d.useRef(null);d.useEffect(()=>()=>{k.current&&clearTimeout(k.current),P.current&&clearTimeout(P.current)},[]),d.useEffect(()=>{s&&(h(""),o({projects:[],tickets:[],cors:[],workers:[]}),m(0),P.current=setTimeout(()=>p.current?.focus(),50))},[s]);const v=d.useCallback(async w=>{if(!w.trim()||w.length<2){o({projects:[],tickets:[],cors:[],workers:[]});return}j(!0);try{const M=await L.universalSearch(r,w.trim());o(M),m(0)}catch(M){console.error("Search error:",M),l?.("Search failed","error")}finally{j(!1)}},[r,l]),O=w=>{const M=w.target.value;h(M),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{v(M)},200)},N=(()=>{const w=[];return u.projects.forEach(M=>w.push({type:"project",data:M})),u.tickets.forEach(M=>w.push({type:"ticket",data:M})),u.cors.forEach(M=>w.push({type:"cor",data:M})),u.workers.forEach(M=>w.push({type:"worker",data:M})),w})(),F=N.length>0,K=w=>{w.key==="Escape"?a():w.key==="ArrowDown"?(w.preventDefault(),m(M=>Math.min(M+1,N.length-1))):w.key==="ArrowUp"?(w.preventDefault(),m(M=>Math.max(M-1,0))):w.key==="Enter"&&F&&(w.preventDefault(),_(N[b]))},_=w=>{if(w){switch(w.type){case"project":t?.(w.data);break;case"ticket":n?.(w.data);break;case"cor":i?.(w.data);break;case"worker":w.data.lastProject&&t?.(w.data.lastProject);break}a()}};return s?e.jsx("div",{className:"universal-search-overlay",onClick:a,children:e.jsxs("div",{className:"universal-search-modal",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"universal-search-input-wrapper",children:[e.jsx(Ft,{size:20,className:"universal-search-icon"}),e.jsx("input",{ref:p,type:"text",value:c,onChange:O,onKeyDown:K,placeholder:"Search projects, tickets, CORs, workers...",className:"universal-search-input",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),c&&e.jsx("button",{className:"universal-search-clear",onClick:()=>h(""),children:e.jsx(ts,{size:16})}),e.jsx("div",{className:"universal-search-shortcut",children:e.jsx("span",{children:"esc"})})]}),e.jsx("div",{className:"universal-search-results",children:x?e.jsxs("div",{className:"universal-search-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Searching..."})]}):c.trim()?F?e.jsxs(e.Fragment,{children:[u.projects.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(sa,{size:14}),e.jsx("span",{children:"Projects"})]}),u.projects.map((w,M)=>{const $=M;return e.jsxs("button",{className:`universal-search-item ${b===$?"selected":""}`,onClick:()=>_({type:"project",data:w}),onMouseEnter:()=>m($),children:[e.jsx(sa,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:w.name}),w.job_number&&e.jsxs("span",{className:"universal-search-item-meta",children:["#",w.job_number]})]}),e.jsx(ze,{size:16,className:"universal-search-item-arrow"})]},w.id)})]}),u.tickets.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx($e,{size:14}),e.jsx("span",{children:"T&M Tickets"})]}),u.tickets.map((w,M)=>{const $=u.projects.length+M;return e.jsxs("button",{className:`universal-search-item ${b===$?"selected":""}`,onClick:()=>_({type:"ticket",data:w}),onMouseEnter:()=>m($),children:[e.jsx($e,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[w.description?.substring(0,50)||"T&M Ticket",w.description?.length>50&&"..."]}),e.jsxs("span",{className:"universal-search-item-meta",children:[w.projectName," • ",w.work_date]})]}),e.jsx("span",{className:`universal-search-item-badge ${w.status}`,children:w.status})]},w.id)})]}),u.cors.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(he,{size:14}),e.jsx("span",{children:"Change Orders"})]}),u.cors.map((w,M)=>{const $=u.projects.length+u.tickets.length+M;return e.jsxs("button",{className:`universal-search-item ${b===$?"selected":""}`,onClick:()=>_({type:"cor",data:w}),onMouseEnter:()=>m($),children:[e.jsx(he,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[w.cor_number?`COR #${w.cor_number}: `:"",w.title]}),e.jsx("span",{className:"universal-search-item-meta",children:w.projectName})]}),e.jsx("span",{className:`universal-search-item-badge ${w.status}`,children:w.status})]},w.id)})]}),u.workers.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(xe,{size:14}),e.jsx("span",{children:"Workers"})]}),u.workers.map((w,M)=>{const $=u.projects.length+u.tickets.length+u.cors.length+M;return e.jsxs("button",{className:`universal-search-item ${b===$?"selected":""}`,onClick:()=>_({type:"worker",data:w}),onMouseEnter:()=>m($),children:[e.jsx(xe,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:w.name}),e.jsxs("span",{className:"universal-search-item-meta",children:[w.role," • ",w.projectName]})]}),e.jsx(ze,{size:16,className:"universal-search-item-arrow"})]},`${w.name}-${M}`)})]})]}):e.jsx("div",{className:"universal-search-no-results",children:e.jsxs("span",{children:['No results for "',c,'"']})}):e.jsxs("div",{className:"universal-search-empty",children:[e.jsxs("div",{className:"universal-search-tip",children:[e.jsx(yi,{size:14}),e.jsx("span",{children:"Type to search across all data"})]}),e.jsxs("div",{className:"universal-search-hints",children:[e.jsx("span",{children:"Projects"}),e.jsx("span",{children:"T&M Tickets"}),e.jsx("span",{children:"Change Orders"}),e.jsx("span",{children:"Workers"})]})]})}),e.jsxs("div",{className:"universal-search-footer",children:[e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↑↓"})," navigate"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↵"})," select"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"esc"})," close"]})]})]})}):null}function pc(){const[s,a]=d.useState(!1);return d.useEffect(()=>{const r=t=>{(t.metaKey||t.ctrlKey)&&t.key==="k"&&(t.preventDefault(),a(n=>!n))};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]),{isOpen:s,setIsOpen:a,open:()=>a(!0),close:()=>a(!1)}}function xc({alerts:s=[],onAction:a,onDismiss:r,maxVisible:t=3,className:n=""}){const[i,l]=d.useState(new Set),c=s.filter(u=>!i.has(u.id||`${u.projectId}-${u.type}-${u.title}`)).slice(0,t),h=d.useCallback(u=>{const o=u.id||`${u.projectId}-${u.type}-${u.title}`;l(x=>new Set([...x,o])),r?.(u)},[r]);return c.length===0?null:e.jsxs("div",{className:`smart-alerts ${n}`,role:"region","aria-label":"Project alerts","aria-live":"polite",children:[c.map((u,o)=>e.jsx(vc,{alert:u,onAction:a,onDismiss:()=>h(u)},u.id||`${u.projectId}-${u.type}-${o}`)),s.length>t&&e.jsx("div",{className:"smart-alerts__overflow",children:e.jsxs("span",{className:"smart-alerts__overflow-text",children:["+",s.length-t," more alerts"]})})]})}function vc({alert:s,onAction:a,onDismiss:r}){const{type:t="info",title:n,description:i,action:l,actionTarget:c,projectId:h,projectName:u}=s,x={critical:Ni,warning:Es,info:_s}[t]||_s,j=()=>{a?.({target:c,projectId:h,alert:s})};return e.jsxs("div",{className:`smart-alert smart-alert--${t}`,role:"alert","aria-live":t==="critical"?"assertive":"polite",children:[e.jsx(x,{className:"smart-alert__icon","aria-hidden":"true"}),e.jsxs("div",{className:"smart-alert__content",children:[e.jsxs("div",{className:"smart-alert__title",children:[u&&e.jsxs("span",{className:"smart-alert__project",children:[u,": "]}),n]}),i&&e.jsx("div",{className:"smart-alert__description",children:i}),l&&e.jsx("div",{className:"smart-alert__action",children:e.jsxs("button",{type:"button",className:"smart-alert__action-btn",onClick:j,children:[l,e.jsx(wi,{size:14,"aria-hidden":"true"})]})})]}),r&&e.jsx("button",{type:"button",className:"smart-alert__dismiss",onClick:r,"aria-label":"Dismiss alert",children:e.jsx(ts,{size:18,"aria-hidden":"true"})})]})}function fc({project:s,company:a,onShowToast:r}){const[t,n]=d.useState(null),[i,l]=d.useState(!0),[c,h]=d.useState(!1);d.useEffect(()=>{if(s?.id&&a?.id){u();const m=L.subscribeToCrewCheckins?.(s.id,()=>{u()});return()=>{m&&L.unsubscribe?.(m)}}},[s?.id,a?.id]);const u=async()=>{try{const m=await L.calculateManDayCosts(s.id,a.id,s.work_type||"demolition",s.job_type||"standard");n(m)}catch(m){console.error("Error loading man day costs:",m)}finally{l(!1)}},o=m=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),x=m=>new Date(m).toLocaleDateString("en-US",{month:"short",day:"numeric"}),j=m=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[m]||m.charAt(0).toUpperCase()+m.slice(1);if(i)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!t||t.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Ee,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const b=Object.entries(t.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>h(!c),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:o(t.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:c?"▼ Collapse":"▶ Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:o(t.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.daysWorked>0?o(t.totalCost/t.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),c&&e.jsxs("div",{className:"man-day-details",children:[b.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:b.map(([m,p])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:j(m)}),e.jsxs("span",{className:"role-rate",children:[o(p.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[p.count," days"]}),e.jsx("span",{className:"role-cost",children:o(p.cost)})]})]},m))})]}),t.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:t.byDate.slice(0,7).map((m,p)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:x(m.date)}),e.jsxs("span",{className:"date-workers",children:[m.workers," crew"]}),e.jsx("span",{className:"date-cost",children:o(m.cost)})]},p))}),t.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",t.byDate.length-7," more days"]})]})]})]})}const jc=d.memo(function({project:a,areas:r=[],corStats:t={},onCreateDraw:n,onViewDraw:i,onShowToast:l}){const[c,h]=d.useState([]),[u,o]=d.useState(!0),x=d.useMemo(()=>r.reduce((g,N)=>{const F=(N.square_footage||0)*(N.price_per_sqft||0);return g+Math.round(F*100)},0),[r]),j=d.useMemo(()=>t?.approvedTotal||0,[t?.approvedTotal]),b=x+j,m=d.useCallback(async()=>{if(a?.id)try{o(!0);const g=await mi.getProjectDrawRequests(a.id);h(g||[])}catch(g){console.error("Error loading draw requests:",g)}finally{o(!1)}},[a?.id]);d.useEffect(()=>{m()},[m]);const p=d.useMemo(()=>{const g=c.filter(_=>["submitted","approved","paid"].includes(_.status)),N=g.reduce((_,w)=>_+(w.previous_billings||0)+(w.current_billing||0),0),K=g[0]?.retention_held||0;return{billedToDate:N,retentionHeld:K}},[c]),k=b>0?Math.round(p.billedToDate/b*100):0,P=c.length>0?Math.max(...c.map(g=>g.draw_number))+1:1,v=g=>g?new Date(g).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",O=g=>{switch(g){case"draft":return e.jsx("span",{className:"badge badge-muted",children:"Draft"});case"submitted":return e.jsx("span",{className:"badge badge-warning",children:"Submitted"});case"approved":return e.jsx("span",{className:"badge badge-success",children:"Approved"});case"paid":return e.jsx("span",{className:"badge badge-info",children:"Paid"});case"rejected":return e.jsx("span",{className:"badge badge-danger",children:"Rejected"});default:return null}};return e.jsxs("div",{className:"progress-billing-card",children:[e.jsxs("div",{className:"progress-billing-header",children:[e.jsxs("div",{className:"progress-billing-title",children:[e.jsx(Ci,{size:18}),e.jsx("h3",{children:"Progress Billing"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>n?.(),disabled:x===0,title:x===0?"Add areas with contract values first":`Create Draw #${P}`,children:[e.jsx(ss,{size:14}),e.jsxs("span",{children:["Draw #",P]})]})]}),e.jsxs("div",{className:"progress-billing-contract",children:[e.jsxs("div",{className:"contract-row",children:[e.jsx("span",{className:"contract-label",children:"Original Contract"}),e.jsx("span",{className:"contract-value",children:oe(x)})]}),j>0&&e.jsxs("div",{className:"contract-row co",children:[e.jsx("span",{className:"contract-label",children:"Approved COs"}),e.jsxs("span",{className:"contract-value positive",children:["+",oe(j)]})]}),e.jsxs("div",{className:"contract-row revised",children:[e.jsx("span",{className:"contract-label",children:"Revised Contract"}),e.jsx("span",{className:"contract-value",children:oe(b)})]})]}),e.jsxs("div",{className:"progress-billing-status",children:[e.jsx("div",{className:"billing-progress-bar",children:e.jsx("div",{className:"billing-progress-fill",style:{width:`${Math.min(k,100)}%`}})}),e.jsxs("div",{className:"billing-stats",children:[e.jsxs("div",{className:"billing-stat",children:[e.jsx("span",{className:"billing-stat-value",children:oe(p.billedToDate)}),e.jsxs("span",{className:"billing-stat-label",children:["Billed to Date (",k,"%)"]})]}),p.retentionHeld>0&&e.jsxs("div",{className:"billing-stat retention",children:[e.jsxs("span",{className:"billing-stat-value",children:["-",oe(p.retentionHeld)]}),e.jsx("span",{className:"billing-stat-label",children:"Retention Held"})]}),e.jsxs("div",{className:"billing-stat remaining",children:[e.jsx("span",{className:"billing-stat-value",children:oe(b-p.billedToDate)}),e.jsx("span",{className:"billing-stat-label",children:"Balance to Finish"})]})]})]}),u?e.jsx("div",{className:"progress-billing-loading",children:e.jsx("div",{className:"loading-spinner small"})}):c.length===0?e.jsxs("div",{className:"progress-billing-empty",children:[e.jsx("p",{children:"No draw requests yet"}),x>0&&e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>n?.(),children:[e.jsx(ss,{size:14}),"Create First Draw Request"]})]}):e.jsxs("div",{className:"progress-billing-draws",children:[e.jsx("div",{className:"draws-header",children:e.jsx("span",{children:"Recent Draws"})}),e.jsx("div",{className:"draws-list",children:c.slice(0,3).map(g=>e.jsxs("button",{className:"draw-item",onClick:()=>i?.(g),children:[e.jsxs("div",{className:"draw-item-info",children:[e.jsxs("span",{className:"draw-number",children:["Draw #",g.draw_number]}),e.jsx("span",{className:"draw-date",children:v(g.period_end||g.created_at)})]}),e.jsx("div",{className:"draw-item-amount",children:oe(g.current_billing||0)}),O(g.status),e.jsx(ze,{size:16,className:"draw-item-arrow"})]},g.id))}),c.length>3&&e.jsxs("button",{className:"btn btn-sm btn-ghost view-all-draws",children:["View all ",c.length," draws"]})]})]})}),Qs=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",gc=d.memo(function({project:a,onAddEquipment:r,onEditEquipment:t,onShowToast:n}){const[i,l]=d.useState([]),[c,h]=d.useState(!0),[u,o]=d.useState(!0),[x,j]=d.useState(0),b=d.useCallback(async()=>{if(a?.id)try{h(!0);const v=await Me.getProjectEquipment(a.id);l(v||[]);const O=Me.calculateProjectEquipmentCost(v||[]);j(O)}catch(v){console.error("Error loading equipment:",v),n?.("Failed to load equipment","error")}finally{h(!1)}},[a?.id]);d.useEffect(()=>{b()},[b]);const m=d.useCallback(async v=>{try{await Me.markEquipmentReturned(v.id),n?.(`${v.equipment_name} marked as returned`,"success"),b()}catch(O){console.error("Error marking equipment returned:",O),n?.("Failed to update equipment","error")}},[b]),p=d.useCallback(async v=>{if(confirm(`Remove ${v.equipment_name} from this project?`))try{await Me.removeEquipmentFromProject(v.id),n?.("Equipment removed","success"),b()}catch(O){console.error("Error removing equipment:",O),n?.("Failed to remove equipment","error")}},[b]),k=d.useMemo(()=>i.filter(v=>!v.end_date),[i]),P=d.useMemo(()=>i.filter(v=>v.end_date),[i]);return e.jsxs("div",{className:"project-equipment-card",children:[e.jsxs("div",{className:"project-equipment-header",children:[e.jsxs("div",{className:"project-equipment-title",children:[e.jsx(Pe,{size:18}),e.jsx("h3",{children:"Equipment on Site"}),i.length>0&&e.jsxs("span",{className:"equipment-count",children:[k.length," active"]})]}),e.jsxs("div",{className:"project-equipment-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>r?.(),title:"Add equipment",children:[e.jsx(ss,{size:14}),e.jsx("span",{children:"Add"})]}),i.length>0&&e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>o(!u),children:u?e.jsx(Rs,{size:16}):e.jsx(ns,{size:16})})]})]}),c?e.jsx("div",{className:"equipment-loading",children:e.jsx("div",{className:"loading-spinner small"})}):i.length===0?e.jsxs("div",{className:"equipment-empty",children:[e.jsx("p",{children:"No equipment tracked on this project"}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>r?.(),children:[e.jsx(ss,{size:14}),"Track Equipment"]})]}):u?e.jsxs(e.Fragment,{children:[k.length>0&&e.jsx("div",{className:"equipment-list",children:k.map(v=>{const O=Me.calculateDaysOnSite(v.start_date,v.end_date),g=v.daily_rate*O;return e.jsxs("div",{className:"equipment-item active",children:[e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:v.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[e.jsx(It,{size:12}),"On-site since ",Qs(v.start_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-rate",children:[oe(v.daily_rate),"/day"]}),e.jsxs("span",{className:"equipment-days",children:[O," days"]}),e.jsx("span",{className:"equipment-total",children:oe(g)})]})]}),e.jsxs("div",{className:"equipment-item-actions",children:[e.jsxs("button",{className:"btn btn-xs btn-outline",onClick:()=>m(v),title:"Mark as returned",children:[e.jsx(ki,{size:12}),"Returned"]}),e.jsx("button",{className:"btn btn-xs btn-ghost",onClick:()=>t?.(v),title:"Edit",children:e.jsx(Di,{size:12})}),e.jsx("button",{className:"btn btn-xs btn-ghost text-danger",onClick:()=>p(v),title:"Remove",children:e.jsx($t,{size:12})})]})]},v.id)})}),P.length>0&&e.jsxs("details",{className:"equipment-returned-section",children:[e.jsx("summary",{className:"equipment-returned-toggle",children:e.jsxs("span",{children:["Returned Equipment (",P.length,")"]})}),e.jsx("div",{className:"equipment-list returned",children:P.map(v=>{const O=Me.calculateDaysOnSite(v.start_date,v.end_date),g=v.daily_rate*O;return e.jsx("div",{className:"equipment-item returned",children:e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:v.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[Qs(v.start_date)," - ",Qs(v.end_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-days",children:[O," days"]}),e.jsx("span",{className:"equipment-total",children:oe(g)})]})]})},v.id)})})]}),e.jsxs("div",{className:"equipment-total-row",children:[e.jsx("span",{children:"Total Equipment Cost"}),e.jsx("span",{className:"equipment-grand-total",children:oe(x)})]})]}):e.jsxs("div",{className:"equipment-summary-collapsed",children:[e.jsxs("span",{children:[k.length," active, ",P.length," returned"]}),e.jsx("span",{className:"equipment-grand-total",children:oe(x)})]})]})}),be=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),bc=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"});function yc({dailyBurn:s,totalBurn:a,daysWorked:r,laborCost:t,materialsEquipmentCost:n=0,progress:i,contractValue:l,laborByDate:c=[],materialsEquipmentByDate:h=[]}){const[u,o]=d.useState(!1),x=l*(i/100)*.6,j=a<=x?"on-budget":a<=x*1.2?"warning":"over-budget",b={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[j],m=j==="on-budget"?rs:j==="warning"?ha:is,k=i>0?a/(i/100):0,P=[],v={};c.forEach(g=>{v[g.date]||(v[g.date]={date:g.date,labor:0,materialsEquipment:0,total:0}),v[g.date].labor=g.cost||0,v[g.date].total+=g.cost||0}),h.forEach(g=>{v[g.date]||(v[g.date]={date:g.date,labor:0,materialsEquipment:0,total:0}),v[g.date].materialsEquipment=g.cost||0,v[g.date].total+=g.cost||0}),Object.values(v).sort((g,N)=>new Date(N.date)-new Date(g.date)).slice(0,10).forEach(g=>P.push(g));const O=Math.max(...P.map(g=>g.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(Si,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${j}`,children:[e.jsx(m,{size:14}),e.jsx("span",{children:b})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:be(s)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),r>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",r," work day",r!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:be(a)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:be(t)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Materials"}),e.jsx("span",{className:"burn-summary-value",children:be(n)})]})]}),i>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${k>l*.7?"warning":""}`,children:be(k)})]}),P.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>o(!u),children:[u?e.jsx(Rs,{size:16}):e.jsx(ns,{size:16}),e.jsxs("span",{children:[u?"Hide":"View"," Daily Breakdown"]})]}),u&&P.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Materials"}),e.jsx("span",{children:"Total"})]}),P.map(g=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:bc(g.date)}),e.jsx("span",{className:"burn-labor",children:g.labor>0?be(g.labor):"-"}),e.jsx("span",{className:"burn-materials",children:g.materialsEquipment>0?be(g.materialsEquipment):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${g.total/O*100}%`}}),e.jsx("span",{className:"burn-amount",children:be(g.total)})]})]},g.date))]})]})}const B={contract:"#3b82f6",revenue:"#10b981",costs:"#f59e0b",profit:"#22c55e",loss:"#ef4444",tmValue:"#8b5cf6",corValue:"#14b8a6",labor:"#6366f1",disposal:"#14b8a6",equipment:"#f97316",materials:"#a855f7",subcontractor:"#ec4899",other:"#6b7280"},Qe={duration:800},jt={contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"12px 16px"},labelStyle:{color:"var(--text-primary)",fontWeight:600,marginBottom:"8px"}},gt={labor:{label:"Labor",color:B.labor,icon:"HardHat"},disposal:{label:"Disposal",color:B.disposal,icon:"Trash2"},equipment:{label:"Equipment",color:B.equipment,icon:"Truck"},materials:{label:"Materials",color:B.materials,icon:"Package"},subcontractor:{label:"Subcontractor",color:B.subcontractor,icon:"Users"},other:{label:"Other",color:B.other,icon:"MoreHorizontal"}},bt=[{id:"7d",label:"7D",days:7},{id:"30d",label:"30D",days:30},{id:"90d",label:"90D",days:90},{id:"all",label:"All",days:null}],_e=s=>s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(0)}K`:`$${s.toFixed(0)}`,pa=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}),Nc={revenue:{id:"revenueGradient",color:B.revenue,startOpacity:.3,endOpacity:0},costs:{id:"costsGradient",color:B.costs,startOpacity:.3,endOpacity:0},tmValue:{id:"tmValueGradient",color:B.tmValue,startOpacity:.2,endOpacity:0}};function wc(s,a,r=[],t=null,n=[]){const i=a?.contract_value||0,l=s?.laborByDate||[],c=s?.haulOffByDate||[],h=s?.materialsEquipmentByDate||[],u=s?.customCosts||[],o=new Set;l.forEach(N=>o.add(N.date)),c.forEach(N=>o.add(N.date)),h.forEach(N=>o.add(N.date)),u.forEach(N=>{N.cost_date&&o.add(N.cost_date)}),r.forEach(N=>{N.work_date&&o.add(N.work_date),N.ticket_date&&o.add(N.ticket_date),N.created_at&&o.add(N.created_at.split("T")[0])}),n.forEach(N=>{N.status==="done"&&N.updated_at&&o.add(N.updated_at.split("T")[0])});const x=[...o].sort((N,F)=>new Date(N)-new Date(F));if(x.length===0)return[];const j={},b=n.reduce((N,F)=>N+(parseFloat(F.weight)||0),0);n.forEach(N=>{if(N.status==="done"&&N.updated_at){const F=N.updated_at.split("T")[0],K=parseFloat(N.weight)||0,_=N.scheduled_value?parseFloat(N.scheduled_value):b>0?K/b*i:0;j[F]||(j[F]=0),j[F]+=_}});let m=0,p=0;const k={};r.forEach(N=>{const F=N.work_date||N.ticket_date||N.created_at?.split("T")[0];if(!F)return;let K=0;const _=N.t_and_m_workers||N.workers||[];Array.isArray(_)&&_.forEach(M=>{const $=parseFloat(M.hours)||parseFloat(M.regular_hours)||0,T=parseFloat(M.overtime_hours)||0,z=parseFloat(M.regular_rate)||parseFloat(M.rate)||65,C=parseFloat(M.overtime_rate)||z*1.5;K+=$*z+T*C});const w=N.t_and_m_items||N.items||[];Array.isArray(w)&&w.forEach(M=>{const $=parseFloat(M.quantity)||1,T=parseFloat(M.unit_cost)||parseFloat(M.materials_equipment?.cost_per_unit)||0;K+=$*T}),k[F]||(k[F]=0),k[F]+=K});const P={};u.forEach(N=>{const F=N.cost_date;F&&(P[F]||(P[F]=0),P[F]+=parseFloat(N.amount)||0)});const v={};h.forEach(N=>{N.date&&(v[N.date]=N.cost||0)});let O=0;return x.map(N=>{const K=l.find(re=>re.date===N)?.cost||0,w=c.find(re=>re.date===N)?.cost||0,M=v[N]||0,$=P[N]||0,T=K+M+w+$;m+=T;const z=k[N]||0;p+=z;const C=j[N]||0;O+=C;const A=Object.keys(j).length>0?O:s?.billable||0;return{date:N,contract:i,revenue:Math.round(A),costs:Math.round(m),tmValue:Math.round(p),corValue:Math.round(t?.total_approved_value||0),profit:Math.round(A-m),dailyLabor:Math.round(K),dailyRevenue:Math.round(C),dailyMaterials:Math.round(M),dailyHaulOff:Math.round(w),dailyCustom:Math.round($),dailyTM:Math.round(z),dailyTotal:Math.round(T)}})}function Cc(s,a){if(!a||!s.length)return s;const r=new Date,t=new Date;return t.setDate(r.getDate()-a),s.filter(n=>new Date(n.date)>=t)}function kc(s=0,a=0,r=[]){const t=[];s>0&&t.push({name:"Labor",value:s,color:B.labor,category:"labor"}),a>0&&t.push({name:"Disposal",value:a,color:B.disposal,category:"disposal"});const n={};r.forEach(l=>{const c=l.category||"other";n[c]||(n[c]={items:[],total:0}),n[c].items.push(l),n[c].total+=parseFloat(l.amount)||0}),Object.entries(n).forEach(([l,c])=>{if(c.total>0){const h=gt[l]||gt.other;t.push({name:h.label,value:c.total,color:h.color,category:l,items:c.items})}});const i=t.reduce((l,c)=>l+c.value,0);return t.forEach(l=>{l.percentage=i>0?Math.round(l.value/i*100):0}),t.sort((l,c)=>c.value-l.value),t}function yt(s,a){if(!s||s.length<2)return{direction:"flat",percentage:0};const r=s.slice(-7);if(r.length<2)return{direction:"flat",percentage:0};const t=r[0][a]||0,n=r[r.length-1][a]||0;if(t===0)return{direction:n>0?"up":"flat",percentage:0};const i=(n-t)/t*100;return{direction:i>5?"up":i<-5?"down":"flat",percentage:Math.abs(Math.round(i))}}function Dc({active:s,payload:a,label:r}){if(!s||!a||!a.length)return null;const t=i=>i>=1e6?`$${(i/1e6).toFixed(2)}M`:i>=1e3?`$${(i/1e3).toFixed(1)}K`:`$${i.toFixed(0)}`,n=a[0]?.payload||{};return e.jsxs("div",{className:"chart-tooltip",children:[e.jsx("div",{className:"chart-tooltip-date",children:pa(r)}),e.jsxs("div",{className:"chart-tooltip-rows",children:[n.contract!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:B.contract}}),"Contract"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(n.contract)})]}),n.revenue!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:B.revenue}}),"Revenue"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(n.revenue)})]}),n.costs!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:B.costs}}),"Costs"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(n.costs)})]}),n.tmValue!==void 0&&n.tmValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:B.tmValue}}),"T&M Value"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(n.tmValue)})]}),n.corValue!==void 0&&n.corValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:B.corValue}}),"COR Approved"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(n.corValue)})]}),n.profit!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:n.profit>=0?B.profit:B.loss}}),n.profit>=0?"Profit":"Loss"]}),e.jsx("span",{className:"chart-tooltip-value",style:{color:n.profit>=0?B.profit:B.loss},children:t(Math.abs(n.profit))})]})]}),(n.dailyRevenue>0||n.dailyLabor>0||n.dailyMaterials>0||n.dailyHaulOff>0||n.dailyTM>0)&&e.jsxs("div",{className:"chart-tooltip-daily",children:[e.jsx("div",{className:"chart-tooltip-daily-label",children:"Today's Activity"}),n.dailyRevenue>0&&e.jsx("div",{className:"chart-tooltip-daily-row earned",children:e.jsxs("span",{style:{color:B.revenue},children:["Areas Completed: ",t(n.dailyRevenue)]})}),n.dailyLabor>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Labor: ",t(n.dailyLabor)]}),n.dailyMaterials>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Materials: ",t(n.dailyMaterials)]}),n.dailyHaulOff>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Disposal: ",t(n.dailyHaulOff)]}),n.dailyTM>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["T&M Added: ",t(n.dailyTM)]}),n.dailyTotal>0&&e.jsx("div",{className:"chart-tooltip-daily-row total",children:e.jsxs("strong",{children:["Day Costs: ",t(n.dailyTotal)]})})]}),e.jsx("div",{className:"chart-tooltip-hint",children:"Click to see details"})]})}function Sc({projectData:s,project:a,tmTickets:r=[],corStats:t=null,areas:n=[],onDrillDown:i}){const[l,c]=d.useState("30d"),[h,u]=d.useState(null),o=d.useMemo(()=>{const p=wc(s,a,r,t,n),k=bt.find(P=>P.id===l);return Cc(p,k?.days)},[s,a,r,t,n,l]),x=d.useMemo(()=>yt(o,"costs"),[o]),j=d.useMemo(()=>yt(o,"revenue"),[o]),b=p=>{if(p?.activePayload?.[0]){const k=p.activePayload[0].payload;i?.(k.date,k)}},m=({trend:p})=>p.direction==="up"?e.jsx(is,{size:14,className:"trend-icon up"}):p.direction==="down"?e.jsx(rs,{size:14,className:"trend-icon down"}):e.jsx(ha,{size:14,className:"trend-icon flat"});return o.length?e.jsxs("div",{className:"financial-trend-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[e.jsx("h3",{children:"Financial Trend"}),e.jsxs("div",{className:"chart-trend-indicators",children:[e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:B.revenue},children:"Revenue"}),e.jsx(m,{trend:j}),j.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[j.percentage,"%"]})]}),e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:B.costs},children:"Costs"}),e.jsx(m,{trend:x}),x.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[x.percentage,"%"]})]})]})]}),e.jsx("div",{className:"time-range-selector",children:bt.map(p=>e.jsx("button",{className:l===p.id?"active":"",onClick:()=>c(p.id),children:p.label},p.id))})]}),e.jsx("div",{className:"chart-container",children:e.jsx(ua,{width:"100%",height:300,children:e.jsxs(Xl,{data:o,onClick:b,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:Object.values(Nc).map(p=>e.jsxs("linearGradient",{id:p.id,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:p.color,stopOpacity:p.startOpacity}),e.jsx("stop",{offset:"95%",stopColor:p.color,stopOpacity:p.endOpacity})]},p.id))}),e.jsx(At,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Rt,{dataKey:"date",tickFormatter:pa,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(Mt,{tickFormatter:_e,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:!1,width:60}),e.jsx(ma,{content:e.jsx(Dc,{})}),e.jsx(Ms,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,formatter:p=>e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:p})}),o[0]?.contract>0&&e.jsx(qt,{y:o[0].contract,stroke:B.contract,strokeDasharray:"5 5",strokeWidth:2,label:{value:"Contract",position:"right",fill:B.contract,fontSize:11}}),e.jsx(Ze,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:B.revenue,strokeWidth:2,fill:"url(#revenueGradient)",animationDuration:Qe.duration,onMouseEnter:()=>u("revenue"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="revenue"?.3:1}}),e.jsx(Ze,{type:"monotone",dataKey:"costs",name:"Costs",stroke:B.costs,strokeWidth:2,fill:"url(#costsGradient)",animationDuration:Qe.duration,onMouseEnter:()=>u("costs"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="costs"?.3:1}}),o.some(p=>p.tmValue>0)&&e.jsx(Ze,{type:"monotone",dataKey:"tmValue",name:"T&M Value",stroke:B.tmValue,strokeWidth:2,fill:"url(#tmValueGradient)",animationDuration:Qe.duration,onMouseEnter:()=>u("tmValue"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="tmValue"?.3:1}}),o.some(p=>p.corValue>0)&&e.jsx(Ze,{type:"monotone",dataKey:"corValue",name:"COR Approved",stroke:B.corValue,strokeWidth:2,strokeDasharray:"4 2",fill:"transparent",animationDuration:Qe.duration,onMouseEnter:()=>u("corValue"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="corValue"?.3:1}})]})})}),e.jsxs("div",{className:"chart-quick-stats",children:[e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Current Revenue"}),e.jsx("span",{className:"stat-value",style:{color:B.revenue},children:_e(o[o.length-1]?.revenue||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Total Costs"}),e.jsx("span",{className:"stat-value",style:{color:B.costs},children:_e(o[o.length-1]?.costs||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Margin"}),e.jsx("span",{className:"stat-value",style:{color:(o[o.length-1]?.profit||0)>=0?B.profit:B.loss},children:(()=>{const p=o[o.length-1];return!p||!p.revenue?"0%":`${((p.revenue-p.costs)/p.revenue*100).toFixed(1)}%`})()})]}),o[o.length-1]?.tmValue>0&&e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"T&M Pending"}),e.jsx("span",{className:"stat-value",style:{color:B.tmValue},children:_e(o[o.length-1]?.tmValue||0)})]})]})]}):e.jsx("div",{className:"financial-trend-chart empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No financial data available yet."}),e.jsx("span",{children:"Start tracking labor and costs to see trends."})]})})}function _c({laborCost:s=0,haulOffCost:a=0,customCosts:r=[],onSegmentClick:t}){const[n,i]=d.useState(null),l=d.useMemo(()=>kc(s,a,r),[s,a,r]),c=d.useMemo(()=>l.reduce((b,m)=>b+m.value,0),[l]),h=(b,m)=>{i(m)},u=()=>{i(null)},o=(b,m)=>{t&&t(l[m])},x=({active:b,payload:m})=>{if(!b||!m||!m.length)return null;const p=m[0].payload;return e.jsxs("div",{className:"chart-tooltip donut-tooltip",children:[e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:p.color}}),p.name]}),e.jsx("span",{className:"chart-tooltip-value",children:_e(p.value)})]}),e.jsxs("div",{className:"donut-tooltip-pct",children:[p.percentage,"% of total costs"]}),p.items&&p.items.length>0&&e.jsx("div",{className:"donut-tooltip-items",children:e.jsxs("div",{className:"donut-tooltip-items-label",children:[p.items.length," item",p.items.length>1?"s":""]})}),t&&e.jsx("div",{className:"chart-tooltip-hint",children:"Click to view details"})]})},j=b=>{const{payload:m}=b;return e.jsx("div",{className:"donut-legend",children:m.map((p,k)=>e.jsxs("div",{className:`donut-legend-item ${n===k?"active":""}`,onMouseEnter:()=>i(k),onMouseLeave:()=>i(null),onClick:()=>o(null,k),children:[e.jsx("span",{className:"donut-legend-color",style:{backgroundColor:p.payload.color}}),e.jsx("span",{className:"donut-legend-name",children:p.value}),e.jsx("span",{className:"donut-legend-value",children:_e(p.payload.value)})]},`legend-${k}`))})};return!l.length||c===0?e.jsx("div",{className:"cost-donut empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No cost data available."}),e.jsx("span",{children:"Add labor, disposal, or custom costs to see breakdown."})]})}):e.jsx("div",{className:"cost-donut",children:e.jsxs("div",{className:"donut-chart-container",children:[e.jsx(ua,{width:"100%",height:200,children:e.jsxs(hi,{children:[e.jsx(pi,{data:l,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",onMouseEnter:h,onMouseLeave:u,onClick:o,animationDuration:Qe.duration,animationEasing:"ease-out",children:l.map((b,m)=>e.jsx(xi,{fill:b.color,stroke:"var(--card-bg)",strokeWidth:2,style:{filter:n===m?"brightness(1.1)":"none",cursor:t?"pointer":"default",transform:n===m?"scale(1.05)":"scale(1)",transformOrigin:"center",transition:"all 0.2s ease"}},`cell-${m}`))}),e.jsx(ma,{content:e.jsx(x,{})}),e.jsx(Ms,{content:j})]})}),e.jsxs("div",{className:"donut-center-label",children:[e.jsx("span",{className:"donut-center-value",children:_e(c)}),e.jsx("span",{className:"donut-center-text",children:"Total"})]})]})})}const ea=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),ks={labor:{label:"Labor",Icon:Ee,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Pe,color:"#10b981"},equipment:{label:"Equipment",Icon:aa,color:"#f59e0b"},materials:{label:"Materials",Icon:Ei,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:xe,color:"#ec4899"},other:{label:"Other",Icon:_i,color:"#6b7280"}};function Ec({laborCost:s=0,haulOffCost:a=0,customCosts:r=[],onAddCost:t,onDeleteCost:n}){const[i,l]=d.useState(!0),[c,h]=d.useState(null),u=[];s>0&&u.push({category:"labor",label:"Labor",amount:s,source:"auto",description:"From crew check-ins"}),a>0&&u.push({category:"disposal",label:"Disposal",amount:a,source:"auto",description:"From haul-off logs"});const o={};r.forEach(m=>{o[m.category]||(o[m.category]={category:m.category,items:[],total:0}),o[m.category].items.push(m),o[m.category].total+=parseFloat(m.amount)||0}),Object.values(o).forEach(m=>{const p=ks[m.category]||ks.other;u.push({category:m.category,label:p.label,amount:m.total,source:"manual",items:m.items})});const x=u.reduce((m,p)=>m+p.amount,0);u.forEach(m=>{m.percentage=x>0?m.amount/x*100:0}),u.sort((m,p)=>p.amount-m.amount);const j=m=>{h(c===m?null:m)},b=m=>{m.items&&m.items.length>0&&(l(!1),h(m.category))};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsxs("div",{className:"cost-contributors-title",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:ea(x)})]}),u.length>0&&e.jsxs("div",{className:"cost-view-toggle",children:[e.jsx("button",{className:i?"active":"",onClick:()=>l(!0),children:"Chart"}),e.jsx("button",{className:i?"":"active",onClick:()=>l(!1),children:"List"})]})]}),u.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):i?e.jsx(_c,{laborCost:s,haulOffCost:a,customCosts:r,onSegmentClick:b}):e.jsx("div",{className:"cost-breakdown",children:u.map(m=>{const p=ks[m.category]||ks.other,k=p.Icon,P=m.items&&m.items.length>0,v=c===m.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${P?"expandable":""}`,onClick:()=>P&&j(m.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(m.percentage,2)}%`,backgroundColor:p.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(k,{size:14,style:{color:p.color}}),e.jsx("span",{children:m.label}),m.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),P&&(v?e.jsx(Rs,{size:14}):e.jsx(ns,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:ea(m.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(m.percentage),"%"]})]})]})]}),v&&P&&e.jsx("div",{className:"cost-category-items",children:m.items.map(O=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:O.description}),e.jsx("span",{className:"cost-item-date",children:new Date(O.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:ea(O.amount)}),n&&e.jsx("button",{className:"cost-item-delete",onClick:g=>{g.stopPropagation(),confirm("Delete this cost entry?")&&n(O.id)},children:e.jsx($t,{size:14})})]})]},O.id))})]},m.category)})}),t&&e.jsxs("button",{className:"cost-add-btn",onClick:t,children:[e.jsx(ss,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const De=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0);function Pc({revenue:s,totalCosts:a,contractValue:r,progress:t}){const n=s-a,i=s>0?n/s*100:0,l=r,c=t>0?a/(t/100):a,h=l-c,u=l>0?h/l*100:0,o=i>=20,x=i>=0&&i<20,j=i<0,b=o?"healthy":x?"warning":"loss",m=o?"On Track":x?"Watch Margin":"Over Cost",p=o?Pi:x?ls:rs;return e.jsxs("div",{className:`profitability-card ${b}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${b}`,children:[e.jsx(p,{size:14}),e.jsx("span",{children:m})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${i<0?"negative":""}`,children:[Math.round(i),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${i<0?"negative":i<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(i),100)}%`}})})]}),t>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${u<0?"negative":""}`,children:[Math.round(u),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${u<0?"negative":u<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(u),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:De(s)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",De(a)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${n<0?"negative":"positive"}`,children:[n>=0?"":"-",De(Math.abs(n))]})]})]}),t>10&&e.jsxs("div",{className:"profitability-insight",children:[o&&e.jsxs("p",{children:["At ",Math.round(t),"% complete, you're at ",De(n)," profit.",h>0&&` Projected final profit: ${De(h)}`]}),x&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",h<0&&` Trending toward ${De(h)} loss.`]}),j&&e.jsxs("p",{children:["Currently over cost by ",De(Math.abs(n)),". Immediate review recommended."]})]})]})}const Xt=[{value:"concrete",label:"Concrete",icon:"🧱"},{value:"trash",label:"Trash",icon:"🗑️"},{value:"metals",label:"Metals",icon:"🔩"},{value:"hazardous_waste",label:"Hazardous",icon:"☣️"}],Oc=s=>Xt.find(a=>a.value===s)||{label:s,icon:"📦"};function Tc({project:s,period:a="week"}){const[r,t]=d.useState([]),[n,i]=d.useState(!0),[l,c]=d.useState(!1);d.useEffect(()=>{s?.id&&h()},[s?.id,a]);const h=async()=>{try{i(!0);const m=a==="week"?7:a==="month"?30:14,p=await L.getDisposalLoadsHistory(s.id,m);t(p||[])}catch(m){console.error("Error loading disposal summary:",m)}finally{i(!1)}},u=r.reduce((m,p)=>{const k=p.load_type;return m[k]||(m[k]=0),m[k]+=p.load_count,m},{}),o=r.reduce((m,p)=>{const k=p.load_date||p.work_date;return m[k]||(m[k]={date:k,loads:[],total:0}),m[k].loads.push(p),m[k].total+=p.load_count,m},{}),x=Object.values(o).sort((m,p)=>new Date(p.date)-new Date(m.date)).slice(0,7),j=r.reduce((m,p)=>m+p.load_count,0),b=j>0;return n?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Pe,{size:18}),e.jsx("span",{children:"Disposal Loads"})]})}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Pe,{size:18}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("span",{className:"period-badge",children:a==="week"?"Last 7 days":a==="month"?"Last 30 days":"Last 14 days"})]}),b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"disposal-total-value",children:j}),e.jsx("span",{className:"disposal-total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:Xt.map(m=>{const p=u[m.value]||0;if(p===0)return null;const k=Math.round(p/j*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"disposal-type-info",children:[e.jsx("span",{className:"disposal-type-icon",children:m.icon}),e.jsx("span",{className:"disposal-type-label",children:m.label})]}),e.jsxs("div",{className:"disposal-type-stats",children:[e.jsx("span",{className:"disposal-type-count",children:p}),e.jsx("div",{className:"disposal-type-bar",children:e.jsx("div",{className:"disposal-type-bar-fill",style:{width:`${k}%`}})})]})]},m.value)})}),x.length>0&&e.jsxs("button",{className:"disposal-expand-btn",onClick:()=>c(!l),children:[l?e.jsx(Rs,{size:16}):e.jsx(ns,{size:16}),e.jsxs("span",{children:[l?"Hide":"View"," Daily Breakdown"]})]}),l&&x.length>0&&e.jsx("div",{className:"disposal-daily-breakdown",children:x.map(m=>{const p=new Date(m.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),k=m.loads.reduce((P,v)=>(P[v.load_type]||(P[v.load_type]=0),P[v.load_type]+=v.load_count,P),{});return e.jsxs("div",{className:"disposal-daily-row",children:[e.jsxs("div",{className:"disposal-daily-header",children:[e.jsx("span",{className:"disposal-daily-date",children:p}),e.jsxs("span",{className:"disposal-daily-total",children:[m.total," loads"]})]}),e.jsx("div",{className:"disposal-daily-types",children:Object.entries(k).map(([P,v])=>{const O=Oc(P);return e.jsxs("span",{className:"disposal-daily-type",children:[O.icon," ",v]},P)})})]},m.date)})})]}):e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx(Pe,{size:32}),e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("span",{className:"text-muted",children:"Loads will appear here when logged by field crews"})]})]})}const Nt=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function Ac({project:s,company:a,user:r,isAdmin:t,onShowToast:n}){const[i,l]=d.useState([]),[c,h]=d.useState([]),[u,o]=d.useState(!0),[x,j]=d.useState(!1),[b,m]=d.useState(""),[p,k]=d.useState("Team Member"),[P,v]=d.useState(null);d.useEffect(()=>{s?.id&&O()},[s?.id]),d.useEffect(()=>{x&&a?.id&&g()},[x,a?.id]);const O=async()=>{try{o(!0);const _=await L.getProjectTeam(s.id);l(_)}catch(_){console.error("Error loading project team:",_)}finally{o(!1)}},g=async()=>{try{const _=await L.getCompanyMembers(a.id),w=i.map($=>$.users?.id),M=_.filter($=>!w.includes($.users?.id));h(M)}catch(_){console.error("Error loading company members:",_)}},N=async()=>{if(!b){n("Select a team member","error");return}try{v("add"),await L.addProjectMember(s.id,b,p,r.id),n("Team member added","success"),j(!1),m(""),k("Team Member"),O()}catch(_){console.error("Error adding team member:",_),n("Error adding team member","error")}finally{v(null)}},F=async(_,w)=>{try{v(_.id),await L.updateProjectMemberRole(s.id,_.users?.id,w),n("Role updated","success"),O()}catch(M){console.error("Error updating role:",M),n("Error updating role","error")}finally{v(null)}},K=async _=>{try{v(_.id),await L.removeProjectMember(s.id,_.users?.id),n("Team member removed","success"),O()}catch(w){console.error("Error removing team member:",w),n("Error removing team member","error")}finally{v(null)}};return u?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Project Team"]}),t&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>j(!0),children:[e.jsx(Oi,{size:14})," Add"]})]}),i.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",t&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:i.map(_=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:_.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:_.users?.email})]}),e.jsx("div",{className:"team-member-role",children:t?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:_.project_role,onChange:w=>F(_,w.target.value),disabled:P===_.id,className:"role-select",children:Nt.map(w=>e.jsx("option",{value:w,children:w},w))}),e.jsx(ns,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:_.project_role})}),t&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>K(_),disabled:P===_.id,title:"Remove from project",children:e.jsx(Ti,{size:14})})]},_.id))}),x&&e.jsx("div",{className:"modal-overlay",onClick:()=>j(!1),children:e.jsxs("div",{className:"modal-content small",onClick:_=>_.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>j(!1),children:e.jsx(ts,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:b,onChange:_=>m(_.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),c.map(_=>e.jsx("option",{value:_.users?.id,children:_.users?.name||_.users?.email},_.users?.id))]}),c.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:p,onChange:_=>k(_.target.value),className:"form-select",children:Nt.map(_=>e.jsx("option",{value:_,children:_},_))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>j(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:N,disabled:!b||P==="add",children:P==="add"?"Adding...":"Add to Project"})]})]})})]})}const Y=d.memo(function({width:a,height:r,borderRadius:t="8px",className:n="",variant:i="default"}){const c=(()=>{switch(i){case"text":return{height:"1em",borderRadius:"4px"};case"circular":return{borderRadius:"50%"};case"rectangular":return{borderRadius:"0"};default:return{borderRadius:t}}})();return e.jsx("div",{className:`skeleton ${n}`,style:{width:a||"100%",height:r||c.height||"1rem",borderRadius:c.borderRadius},"aria-hidden":"true"})});d.memo(function({showProgress:a=!1}){return e.jsxs("div",{className:"metric-skeleton",children:[e.jsx(Y,{width:"60%",height:"0.75rem",className:"skeleton-label"}),e.jsx(Y,{width:"80%",height:"1.75rem",className:"skeleton-value"}),a&&e.jsx(Y,{width:"100%",height:"6px",className:"skeleton-progress"})]})});const mo=d.memo(function({lines:a=3,showHeader:r=!0,showAction:t=!1}){return e.jsxs("div",{className:"card-skeleton","aria-busy":"true","aria-label":"Loading content",children:[r&&e.jsxs("div",{className:"card-skeleton-header",children:[e.jsx(Y,{width:"40%",height:"1.25rem"}),t&&e.jsx(Y,{width:"80px",height:"32px"})]}),e.jsx("div",{className:"card-skeleton-body",children:Array.from({length:a}).map((n,i)=>e.jsx(Y,{width:`${100-i*15}%`,height:"1rem",className:"skeleton-line"},i))})]})});d.memo(function({count:a=3,showAvatar:r=!1,showAction:t=!1}){return e.jsx("div",{className:"list-skeleton","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:a}).map((n,i)=>e.jsxs("div",{className:"list-item-skeleton",children:[r&&e.jsx(Y,{width:"40px",height:"40px",variant:"circular"}),e.jsxs("div",{className:"list-item-skeleton-content",children:[e.jsx(Y,{width:"60%",height:"1rem"}),e.jsx(Y,{width:"40%",height:"0.75rem"})]}),t&&e.jsx(Y,{width:"60px",height:"28px"})]},i))})});d.memo(function(){return e.jsx("div",{className:"financial-row-skeleton","aria-busy":"true","aria-label":"Loading financial data",children:[1,2,3].map(a=>e.jsxs("div",{className:"financial-card-skeleton",children:[e.jsxs("div",{className:"financial-card-skeleton-header",children:[e.jsx(Y,{width:"24px",height:"24px",variant:"circular"}),e.jsx(Y,{width:"60%",height:"1rem"})]}),e.jsx(Y,{width:"50%",height:"2rem",className:"skeleton-hero-value"}),e.jsxs("div",{className:"financial-card-skeleton-details",children:[e.jsx(Y,{width:"100%",height:"0.875rem"}),e.jsx(Y,{width:"80%",height:"0.875rem"})]})]},a))})});d.memo(function({height:a="200px"}){return e.jsxs("div",{className:"chart-skeleton",style:{height:a},"aria-busy":"true","aria-label":"Loading chart",children:[e.jsx("div",{className:"chart-skeleton-bars",children:[40,65,45,80,55,70,50,75,60,85].map((r,t)=>e.jsx("div",{className:"chart-skeleton-bar",style:{height:`${r}%`}},t))}),e.jsx(Y,{width:"100%",height:"1px",className:"chart-skeleton-axis"})]})});const Se=d.memo(function({count:a=3}){return e.jsx("div",{className:"ticket-skeleton-list","aria-busy":"true","aria-label":"Loading tickets",children:Array.from({length:a}).map((r,t)=>e.jsxs("div",{className:"ticket-skeleton-item",children:[e.jsxs("div",{className:"ticket-skeleton-header",children:[e.jsx(Y,{width:"100px",height:"0.875rem"}),e.jsx(Y,{width:"80px",height:"24px",borderRadius:"12px"})]}),e.jsx(Y,{width:"90%",height:"1rem"}),e.jsxs("div",{className:"ticket-skeleton-footer",children:[e.jsx(Y,{width:"60px",height:"0.75rem"}),e.jsx(Y,{width:"60px",height:"0.75rem"}),e.jsx(Y,{width:"60px",height:"0.75rem"})]})]},t))})}),Rc=d.memo(function(){return e.jsx("div",{className:"hero-metrics-skeleton","aria-busy":"true","aria-label":"Loading metrics",children:[1,2,3,4].map(a=>e.jsxs("div",{className:"hero-metric-skeleton",children:[e.jsx(Y,{width:"80px",height:"0.75rem",className:"skeleton-label"}),e.jsx(Y,{width:"120px",height:"1.75rem",className:"skeleton-value"}),e.jsx(Y,{width:"100%",height:"4px",className:"skeleton-bar"})]},a))})}),ho=d.memo(function({title:a="Unable to load data",message:r="Something went wrong. Please try again.",error:t=null,onRetry:n=null,retryLabel:i="Try Again",variant:l="default",icon:c=null}){const u=c||(t?.message?.includes("network")||t?.message?.includes("offline")?Ai:Es);return l==="compact"?e.jsxs("div",{className:"error-state error-state-compact",role:"alert",children:[e.jsx(u,{size:16,className:"error-state-icon","aria-hidden":"true"}),e.jsx("span",{className:"error-state-message",children:r}),n&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:n,"aria-label":i,children:e.jsx(Js,{size:14})})]}):l==="inline"?e.jsxs("div",{className:"error-state error-state-inline",role:"alert",children:[e.jsxs("div",{className:"error-state-content",children:[e.jsx(u,{size:20,className:"error-state-icon","aria-hidden":"true"}),e.jsxs("div",{className:"error-state-text",children:[e.jsx("span",{className:"error-state-title",children:a}),e.jsx("span",{className:"error-state-message",children:r})]})]}),n&&e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:n,children:[e.jsx(Js,{size:14})," ",i]})]}):e.jsxs("div",{className:"error-state",role:"alert","aria-live":"polite",children:[e.jsx("div",{className:"error-state-icon-wrapper",children:e.jsx(u,{size:32,className:"error-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"error-state-title",children:a}),e.jsx("p",{className:"error-state-message",children:r}),!1,n&&e.jsxs("button",{className:"btn btn-primary",onClick:n,children:[e.jsx(Js,{size:16})," ",i]})]})}),po=d.memo(function({title:a="No data yet",message:r="Items will appear here once added.",icon:t=null,action:n=null,actionLabel:i="Get Started",onAction:l=null}){return e.jsxs("div",{className:"empty-state",role:"status",children:[t&&e.jsx("div",{className:"empty-state-icon-wrapper",children:e.jsx(t,{size:32,className:"empty-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"empty-state-title",children:a}),e.jsx("p",{className:"empty-state-message",children:r}),l&&e.jsx("button",{className:"btn btn-primary btn-small",onClick:l,children:i}),n&&!l&&n]})});d.memo(function({label:a,error:r,required:t=!1,hint:n,children:i,className:l=""}){return e.jsxs("div",{className:`form-field ${r?"has-error":""} ${l}`,children:[a&&e.jsxs("label",{className:"form-field-label",children:[a,t&&e.jsx("span",{className:"form-field-required",children:"*"})]}),e.jsx("div",{className:"form-field-input",children:i}),r&&e.jsxs("div",{className:"form-field-error",role:"alert",children:[e.jsx(ls,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:r})]}),n&&!r&&e.jsx("div",{className:"form-field-hint",children:n})]})});d.memo(function({type:a="text",value:r,onChange:t,onBlur:n,error:i,placeholder:l,disabled:c,min:h,max:u,step:o,pattern:x,required:j,autoComplete:b,name:m,id:p,className:k="","aria-label":P,"aria-describedby":v}){const O=p||m,g=i?`${O}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:a,id:O,name:m,value:r,onChange:t,onBlur:n,placeholder:l,disabled:c,min:h,max:u,step:o,pattern:x,required:j,autoComplete:b,className:`validated-input ${i?"has-error":""} ${k}`,"aria-label":P,"aria-invalid":!!i,"aria-describedby":i?g:v}),i&&e.jsxs("div",{id:g,className:"input-error-inline",role:"alert",children:[e.jsx(ls,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:i})]})]})});d.memo(function({value:a,onChange:r,onBlur:t,error:n,disabled:i,required:l,name:c,id:h,className:u="",children:o,"aria-label":x}){const j=h||c,b=n?`${j}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("select",{id:j,name:c,value:a,onChange:r,onBlur:t,disabled:i,required:l,className:`validated-select ${n?"has-error":""} ${u}`,"aria-label":x,"aria-invalid":!!n,"aria-describedby":n?b:void 0,children:o}),n&&e.jsxs("div",{id:b,className:"input-error-inline",role:"alert",children:[e.jsx(ls,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:n})]})]})});d.memo(function({value:a,onChange:r,onBlur:t,error:n,placeholder:i,disabled:l,required:c,rows:h=3,maxLength:u,name:o,id:x,className:j="","aria-label":b}){const m=x||o,p=n?`${m}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("textarea",{id:m,name:o,value:a,onChange:r,onBlur:t,placeholder:i,disabled:l,required:c,rows:h,maxLength:u,className:`validated-textarea ${n?"has-error":""} ${j}`,"aria-label":b,"aria-invalid":!!n,"aria-describedby":n?p:void 0}),u&&e.jsxs("div",{className:"textarea-counter",children:[a?.length||0," / ",u]}),n&&e.jsxs("div",{id:p,className:"input-error-inline",role:"alert",children:[e.jsx(ls,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:n})]})]})});const Mc=d.memo(function({count:a,label:r,variant:t="default",size:n="medium",pulse:i=!1,icon:l}){const[c,h]=d.useState(a),[u,o]=d.useState(!1);return d.useEffect(()=>{if(a!==c){o(!0);const x=setTimeout(()=>{o(!1),h(a)},400);return()=>clearTimeout(x)}},[a,c]),e.jsxs("span",{className:`count-badge count-badge-${t} count-badge-${n} ${i?"badge-new":""} ${u?"animate-count-up":""}`,title:r,children:[l&&e.jsx(l,{size:n==="small"?12:n==="large"?18:14}),e.jsx("span",{className:"count-badge-value",children:a}),r&&e.jsx("span",{className:"count-badge-label",children:r})]})}),Fc=d.memo(function({value:a,max:r=100,showLabel:t=!1,size:n="medium",variant:i="default",animated:l=!0}){const c=Math.min(100,Math.max(0,a/r*100)),h=n==="small"?"4px":n==="large"?"8px":"6px",u=i==="default"?c>=80?"danger":c>=60?"warning":"success":i;return e.jsxs("div",{className:`mini-progress mini-progress-${n}`,children:[e.jsx("div",{className:"mini-progress-track",style:{height:h},children:e.jsx("div",{className:`mini-progress-fill mini-progress-${u} ${l?"progress-animate":""}`,style:{width:`${c}%`}})}),t&&e.jsxs("span",{className:"mini-progress-label",children:[Math.round(c),"%"]})]})}),Ic=d.memo(function({value:a,previousValue:r,format:t="percent",inverted:n=!1,showValue:i=!0}){const l=a-r,c=r!==0?l/r*100:0;let h=l===0?"neutral":l>0?"up":"down",u="neutral";l!==0&&(n?u=l>0?"negative":"positive":u=l>0?"positive":"negative");const o=h==="up"?is:h==="down"?rs:ha,x=()=>{const j=Math.abs(l);switch(t){case"percent":return`${Math.abs(c).toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(j);default:return j.toLocaleString()}};return e.jsxs("span",{className:`trend-indicator trend-${u}`,children:[e.jsx(o,{size:14}),i&&e.jsx("span",{className:"trend-value",children:x()})]})});d.memo(function({status:a="default",label:r,size:t="medium",pulse:n=!1}){return e.jsxs("span",{className:`status-dot-container status-dot-${t}`,children:[e.jsx("span",{className:`status-dot status-dot-${a} ${n?"status-dot-pulse":""}`}),r&&e.jsx("span",{className:"status-dot-label",children:r})]})});d.memo(function({data:a=[],width:r=80,height:t=24,strokeWidth:n=2,color:i="var(--accent-blue)",showArea:l=!0}){if(!a.length)return null;const c=Math.max(...a),h=Math.min(...a),u=c-h||1,o=a.map((j,b)=>{const m=b/(a.length-1)*r,p=t-(j-h)/u*(t-n*2)-n;return`${m},${p}`}).join(" "),x=`0,${t} ${o} ${r},${t}`;return e.jsxs("svg",{width:r,height:t,className:"sparkline",viewBox:`0 0 ${r} ${t}`,children:[l&&e.jsx("polygon",{points:x,fill:i,fillOpacity:"0.15"}),e.jsx("polyline",{points:o,fill:"none",stroke:i,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"})]})});d.memo(function({items:a=[]}){return e.jsx("div",{className:"quick-stats",children:a.map((r,t)=>e.jsxs("span",{className:"quick-stat-item",children:[r.icon&&e.jsx(r.icon,{size:12}),e.jsx("span",{className:"quick-stat-value",children:r.value}),r.label&&e.jsx("span",{className:"quick-stat-label",children:r.label})]},t))})});d.memo(function({status:a,label:r,size:t="medium"}){const n={success:Ri,warning:Es,danger:Es,info:ot,pending:ot},i=n[a]||n.info;return e.jsxs("span",{className:`status-indicator status-indicator-${a} status-indicator-${t}`,children:[e.jsx(i,{size:t==="small"?12:t==="large"?18:14}),r&&e.jsx("span",{className:"status-indicator-label",children:r})]})});d.memo(function({current:a,previous:r,format:t="number",label:n,inverted:i=!1}){const l=a-r,c=i?l<0:l>0,h=i?l>0:l<0,u=o=>{switch(t){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(Math.abs(o));case"percent":return`${Math.abs(o).toFixed(1)}%`;default:return Math.abs(o).toLocaleString()}};return e.jsxs("div",{className:`metric-delta ${c?"positive":h?"negative":"neutral"}`,children:[e.jsx("span",{className:"metric-delta-arrow",children:l>0?"↑":l<0?"↓":"→"}),e.jsx("span",{className:"metric-delta-value",children:u(l)}),n&&e.jsx("span",{className:"metric-delta-label",children:n})]})});d.memo(function({value:a,max:r=100,size:t=40,strokeWidth:n=4,showValue:i=!0,color:l="var(--accent-blue)"}){const c=Math.min(100,Math.max(0,a/r*100)),h=(t-n)/2,u=h*2*Math.PI,o=u-c/100*u;return e.jsxs("div",{className:"circular-progress",style:{width:t,height:t},children:[e.jsxs("svg",{width:t,height:t,viewBox:`0 0 ${t} ${t}`,children:[e.jsx("circle",{className:"circular-progress-track",cx:t/2,cy:t/2,r:h,fill:"none",strokeWidth:n}),e.jsx("circle",{className:"circular-progress-fill",cx:t/2,cy:t/2,r:h,fill:"none",stroke:l,strokeWidth:n,strokeDasharray:u,strokeDashoffset:o,strokeLinecap:"round",transform:`rotate(-90 ${t/2} ${t/2})`,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),i&&e.jsxs("span",{className:"circular-progress-value",children:[Math.round(c),"%"]})]})});d.memo(function({isOpen:a,onClose:r,title:t,children:n,size:i="medium",className:l="",showCloseButton:c=!0,closeOnOverlayClick:h=!0,closeOnEscape:u=!0,footer:o,ariaDescribedBy:x}){const j=d.useRef(null),b=d.useRef(null),m=d.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`);d.useEffect(()=>{if(a){b.current=document.activeElement;const v=setTimeout(()=>{j.current?.focus()},10);return()=>clearTimeout(v)}},[a]),d.useEffect(()=>{!a&&b.current&&b.current.focus()},[a]),d.useEffect(()=>{if(!a||!u)return;const v=O=>{O.key==="Escape"&&(O.preventDefault(),r())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[a,u,r]),d.useEffect(()=>{if(a){const v=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=v}}},[a]);const p=d.useCallback(v=>{if(v.key!=="Tab")return;const O=j.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!O||O.length===0)return;const g=O[0],N=O[O.length-1];v.shiftKey?document.activeElement===g&&(v.preventDefault(),N.focus()):document.activeElement===N&&(v.preventDefault(),g.focus())},[]),k=v=>{h&&v.target===v.currentTarget&&r()};if(!a)return null;const P={small:"modal-small",medium:"modal-medium",large:"modal-large",full:"modal-full"};return e.jsx("div",{className:"modal-overlay",onClick:k,role:"presentation",children:e.jsxs("div",{ref:j,className:`modal-content ${P[i]||""} ${l}`,role:"dialog","aria-modal":"true","aria-labelledby":t?m.current:void 0,"aria-describedby":x,tabIndex:-1,onKeyDown:p,onClick:v=>v.stopPropagation(),children:[t&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:m.current,children:t}),c&&e.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close modal",type:"button",children:e.jsx(ts,{size:20})})]}),e.jsx("div",{className:"modal-body",children:n}),o&&e.jsx("div",{className:"modal-footer",children:o})]})})});const Ye=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Ds=d.memo(function({icon:a,label:r,value:t,formattedValue:n,subLabel:i,progress:l,progressLabel:c,variant:h="default",trend:u,previousValue:o}){const x={default:"var(--accent-blue)",success:"var(--accent-green)",warning:"var(--accent-amber)",danger:"var(--accent-red)"};return e.jsxs("div",{className:"hero-metric-card hover-lift animate-fade-in-up",children:[e.jsxs("div",{className:"hero-metric-header",children:[e.jsx("div",{className:"hero-metric-icon",style:{color:x[h]},children:e.jsx(a,{size:18})}),e.jsx("span",{className:"hero-metric-label",children:r})]}),e.jsxs("div",{className:"hero-metric-value-row",children:[e.jsx("span",{className:`hero-metric-value hero-metric-${h}`,children:n}),u!==void 0&&o!==void 0&&e.jsx(Ic,{value:t,previousValue:o,format:"currency",inverted:r.toLowerCase().includes("cost")})]}),i&&e.jsx("span",{className:"hero-metric-sublabel",children:i}),l!==void 0&&e.jsxs("div",{className:"hero-metric-progress",children:[e.jsx(Fc,{value:l,max:100,size:"small",variant:h,showLabel:!0}),c&&e.jsx("span",{className:"hero-metric-progress-label",children:c})]})]})}),$c=d.memo(function({contractValue:a=0,earnedRevenue:r=0,totalCosts:t=0,profit:n=0,progress:i=0,corApprovedValue:l=0,loading:c=!1,previousData:h}){const u=a+l,o=r>0?n/r*100:0,x=r>0?t/r*100:0,j=u>0?r/u*100:0,b=u>0?t/u*100:0,m=d.useMemo(()=>o>=20?"success":o>=10?"warning":o<0?"danger":"default",[o]),p=d.useMemo(()=>x<=60?"success":x<=80?"warning":"danger",[x]);return c?e.jsx(Rc,{}):e.jsxs("div",{className:"hero-metrics stagger-children",children:[e.jsx(Ds,{icon:Xe,label:"Contract Value",value:u,formattedValue:Ye(u),subLabel:l>0?`+${Ye(l)} CORs`:null,variant:"default"}),e.jsx(Ds,{icon:is,label:"Earned Revenue",value:r,formattedValue:Ye(r),progress:j,progressLabel:`${Math.round(j)}% of contract`,variant:"success",previousValue:h?.earnedRevenue,trend:h?r:void 0}),e.jsx(Ds,{icon:Lt,label:"Total Costs",value:t,formattedValue:Ye(t),progress:b,progressLabel:`${Math.round(x)}% of revenue`,variant:p,previousValue:h?.totalCosts,trend:h?t:void 0}),e.jsx(Ds,{icon:Mi,label:"Profit",value:n,formattedValue:Ye(n),subLabel:`${o>=0?"+":""}${o.toFixed(1)}% margin`,variant:m,previousValue:h?.profit,trend:h?n:void 0})]})}),wt=[{id:"overview",label:"Overview",shortLabel:"Overview",icon:Ii,description:"Metrics & trends",step:null},{id:"cors",label:"Change Orders",shortLabel:"CORs",icon:$e,description:"CORs & approvals",step:1},{id:"tickets",label:"T&M Tickets",shortLabel:"Tickets",icon:he,description:"Field data",step:2},{id:"billing",label:"Billing",shortLabel:"Billing",icon:Lt,description:"Invoices & billing",step:3}],Lc=d.memo(function({activeSection:a="overview",onSectionChange:r,collapsed:t=!1,onToggleCollapse:n,onMobileClose:i,stats:l={}}){const{corCount:c=0,ticketCount:h=0,corPending:u=0,ticketPending:o=0,billableCount:x=0,invoiceCount:j=0}=l,b=m=>m==="cors"&&c>0?{count:c,variant:u>0?"warning":"default",pending:u}:m==="tickets"&&h>0?{count:h,variant:o>0?"warning":"default",pending:o}:m==="billing"&&x>0?{count:x,variant:"success",pending:x}:null;return e.jsxs("nav",{className:`financials-nav ${t?"collapsed":""}`,"aria-label":"Financials sections",children:[i&&e.jsxs("div",{className:"financials-nav-mobile-header",children:[e.jsx("span",{className:"financials-nav-mobile-title",children:"Financials"}),e.jsx("button",{className:"financials-nav-mobile-close",onClick:i,"aria-label":"Close menu",children:e.jsx(ts,{size:20})})]}),e.jsxs("button",{className:"financials-nav-toggle",onClick:n,"aria-label":t?"Expand sidebar":"Collapse sidebar",title:t?"Expand sidebar":"Collapse sidebar",children:[t?e.jsx(Fi,{size:18}):e.jsx(zt,{size:18}),!t&&e.jsx("span",{children:"Collapse"})]}),e.jsx("div",{className:"financials-nav-items",children:wt.map((m,p)=>{const k=a===m.id,P=m.icon,v=b(m.id),O=p<wt.length-1&&m.step!==null;return e.jsxs("div",{className:"financials-nav-item-wrapper",children:[e.jsxs("button",{className:`financials-nav-item ${k?"active":""}`,onClick:()=>r?.(m.id),"aria-current":k?"page":void 0,title:`${m.label}${v?` (${v.count})`:""}`,children:[m.step&&!t&&e.jsx("span",{className:"financials-nav-step",children:m.step}),e.jsxs("div",{className:"financials-nav-icon",children:[e.jsx(P,{size:t?22:20}),v&&v.pending>0&&e.jsx("span",{className:"financials-nav-dot"})]}),t&&e.jsx("span",{className:"financials-nav-short-label",children:m.shortLabel}),!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"financials-nav-content",children:[e.jsx("span",{className:"financials-nav-label",children:m.label}),e.jsx("span",{className:"financials-nav-desc",children:m.description})]}),v&&e.jsx(Mc,{count:v.count,size:"small",variant:v.variant}),e.jsx(ze,{size:16,className:"financials-nav-arrow"})]})]}),O&&!t&&e.jsx("div",{className:"financials-nav-connector",children:e.jsx("div",{className:"connector-line"})})]},m.id)})}),t&&e.jsxs("button",{className:"financials-nav-expand-btn",onClick:n,"aria-label":"Expand sidebar",children:[e.jsx(ze,{size:14}),e.jsx("span",{children:"Expand"})]})]})}),zc=d.memo(function({progress:a=0,areasComplete:r=0,totalAreas:t=0,areasWorking:n=0,size:i=110,strokeWidth:l=9}){const[c,h]=d.useState(0),u=d.useRef(null);d.useEffect(()=>{const m=c,p=Math.min(100,Math.max(0,a)),k=800,P=performance.now(),v=O=>{const g=O-P,N=Math.min(g/k,1),F=1-Math.pow(1-N,3),K=m+(p-m)*F;h(K),N<1&&(u.current=requestAnimationFrame(v))};return u.current=requestAnimationFrame(v),()=>{u.current&&cancelAnimationFrame(u.current)}},[a]);const o=(i-l)/2,x=o*2*Math.PI,j=x-c/100*x,b=()=>c>=80?"var(--accent-green)":c>=50||c>=25?"var(--accent-blue)":"var(--text-muted)";return e.jsxs("div",{className:"overview-progress-gauge",children:[e.jsxs("div",{className:"progress-gauge-circle",style:{width:i,height:i},children:[e.jsxs("svg",{width:i,height:i,viewBox:`0 0 ${i} ${i}`,children:[e.jsx("circle",{className:"gauge-track",cx:i/2,cy:i/2,r:o,fill:"none",strokeWidth:l,stroke:"var(--bg-tertiary)"}),e.jsx("circle",{className:"gauge-fill",cx:i/2,cy:i/2,r:o,fill:"none",stroke:b(),strokeWidth:l,strokeDasharray:x,strokeDashoffset:j,strokeLinecap:"round",transform:`rotate(-90 ${i/2} ${i/2})`,style:{transition:"stroke 0.3s ease"}})]}),e.jsxs("div",{className:"gauge-center",children:[e.jsxs("span",{className:"gauge-value",children:[Math.round(c),"%"]}),e.jsx("span",{className:"gauge-label",children:"Complete"})]})]}),e.jsxs("div",{className:"gauge-areas-status",children:[e.jsxs("span",{className:"areas-count",children:[e.jsx("strong",{children:r}),"/",t," Areas Done"]}),n>0&&e.jsxs("span",{className:"areas-active",children:[n," active"]})]})]})}),qc=d.memo(function({earnedRevenue:a=0,totalCosts:r=0,laborCost:t=0,disposalCost:n=0,equipmentCost:i=0,materialsCost:l=0,otherCost:c=0,contractValue:h=0}){const u=a-r,o=a>0?u/a*100:0,x=u>=0,j=p=>p>=1e6?`$${(p/1e6).toFixed(1)}M`:p>=1e3?`$${(p/1e3).toFixed(1)}K`:`$${p.toFixed(0)}`,b=[{key:"labor",value:t,color:B.labor,label:"Labor"},{key:"disposal",value:n,color:B.disposal,label:"Disposal"},{key:"equipment",value:i,color:B.equipment,label:"Equipment"},{key:"materials",value:l,color:B.materials,label:"Materials"},{key:"other",value:c,color:B.other,label:"Other"}].filter(p=>p.value>0),m=b.length>0&&r>0;return e.jsxs("div",{className:"overview-financial-card animate-fade-in-up",children:[e.jsxs("div",{className:"financial-metrics-row",children:[e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value green",children:j(a)}),e.jsx("span",{className:"financial-metric-label",children:"Earned"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value amber",children:j(r)}),e.jsx("span",{className:"financial-metric-label",children:"Costs"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsxs("span",{className:`financial-metric-value ${x?"green":"red"}`,children:[x?"":"-",j(Math.abs(u))]}),e.jsxs("span",{className:"financial-metric-label",children:["Profit",e.jsxs("span",{className:`margin-badge ${x?"positive":"negative"}`,children:[o>=0?"+":"",o.toFixed(0),"%"]})]})]})]}),m&&e.jsxs("div",{className:"cost-breakdown-section",children:[e.jsx("div",{className:"cost-breakdown-bar",children:b.map((p,k)=>{const P=p.value/r*100;return e.jsx("div",{className:"cost-segment",style:{width:`${P}%`,backgroundColor:p.color,animationDelay:`${k*100}ms`},title:`${p.label}: ${j(p.value)} (${P.toFixed(0)}%)`},p.key)})}),e.jsx("div",{className:"cost-breakdown-legend",children:b.slice(0,4).map(p=>e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot",style:{backgroundColor:p.color}}),e.jsx("span",{className:"legend-label",children:p.label})]},p.key))})]})]})}),Vc=()=>ne(()=>import("./pdf-aQqpMATS.js").then(s=>s.j),[]),Ss={contract:B.contract,tm:B.costs},Ct=[{id:"7d",label:"7D",days:7},{id:"14d",label:"14D",days:14},{id:"30d",label:"30D",days:30}],Bc=d.memo(function({project:a,onShowToast:r}){const[t,n]=d.useState([]),[i,l]=d.useState([]),[c,h]=d.useState(new Date().toISOString().split("T")[0]),[u,o]=d.useState("14d"),[x,j]=d.useState(!0),[b,m]=d.useState(!1);d.useEffect(()=>{a?.id&&p()},[a?.id]);const p=async()=>{j(!0);try{const[T,z]=await Promise.all([L.getCrewCheckinHistory(a.id,365),L.getTMTickets(a.id)]);n(T||[]),l(z||[])}catch(T){console.error("Error loading crew metrics:",T)}finally{j(!1)}},k=d.useMemo(()=>{const T={};return i.forEach(z=>{const C=z.work_date;C&&(T[C]||(T[C]=new Set),(z.t_and_m_workers||[]).forEach(Z=>{T[C].add(Z.name.toLowerCase().trim())}))}),T},[i]),P=d.useMemo(()=>{const T={};return t.forEach(z=>{T[z.check_in_date]=z.workers||[]}),T},[t]),v=P[c]||[],O=k[c]||new Set,g=d.useMemo(()=>{const T=[],z=[];return v.forEach(C=>{O.has(C.name.toLowerCase().trim())?z.push(C):T.push(C)}),{total:v.length,contract:T,tm:z}},[v,O]),N=d.useMemo(()=>{const T=Ct.find(Z=>Z.id===u)?.days||14,z=[],C=new Date;for(let Z=T-1;Z>=0;Z--){const A=new Date(C);A.setDate(A.getDate()-Z);const re=A.toISOString().split("T")[0],Ne=P[re]||[],ie=k[re]||new Set;let ds=0,we=0;Ne.forEach(Be=>{ie.has(Be.name.toLowerCase().trim())?we++:ds++}),z.push({date:re,displayDate:pa(re),contract:ds,tm:we,total:Ne.length})}return z},[P,k,u]),F=d.useCallback(T=>{const z=new Date(c+"T12:00:00");z.setDate(z.getDate()+T),h(z.toISOString().split("T")[0])},[c]),K=c===new Date().toISOString().split("T")[0],_=T=>new Date(T+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),w=d.useCallback(T=>{T?.date&&h(T.date)},[]),M=({active:T,payload:z,label:C})=>{if(!T||!z?.length)return null;const Z=(z[0]?.value||0)+(z[1]?.value||0);return e.jsxs("div",{style:{...jt.contentStyle,fontSize:"0.8rem"},children:[e.jsx("p",{style:{...jt.labelStyle,fontSize:"0.85rem",marginBottom:6},children:C}),e.jsxs("p",{style:{margin:"3px 0",color:Ss.contract},children:["Contract: ",e.jsx("strong",{children:z[0]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:Ss.tm},children:["T&M: ",e.jsx("strong",{children:z[1]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:"var(--text-primary)",borderTop:"1px solid var(--border-color)",paddingTop:4},children:["Total: ",e.jsx("strong",{children:Z})]})]})},$=d.useCallback(async()=>{m(!0),r?.("Generating crew report PDF...","info");try{const z=(await Vc()).default,C=new z,Z=C.internal.pageSize.width;let A=20;C.setFontSize(18),C.setFont(void 0,"bold"),C.text("Crew On-Site Report",Z/2,A,{align:"center"}),A+=8,C.setFontSize(11),C.setFont(void 0,"normal"),C.text(`Project: ${a.name}`,Z/2,A,{align:"center"}),A+=6,C.text(`Date: ${_(c)}`,Z/2,A,{align:"center"}),A+=12,C.setFontSize(12),C.setFont(void 0,"bold"),C.text("Selected Day Summary",14,A),A+=7,C.setFontSize(10),C.setFont(void 0,"normal"),C.text(`Total Crew On-Site: ${g.total}`,14,A),A+=5,C.text(`Contract Workers: ${g.contract.length}`,14,A),A+=5,C.text(`T&M Workers: ${g.tm.length}`,14,A),A+=10,g.contract.length>0&&(C.setFontSize(12),C.setFont(void 0,"bold"),C.text("Contract Workers",14,A),A+=7,C.setFontSize(9),C.setFont(void 0,"bold"),C.text("Name",14,A),C.text("Role",100,A),A+=5,C.setFont(void 0,"normal"),g.contract.forEach(ie=>{A>270&&(C.addPage(),A=20),C.text(ie.name,14,A),C.text(ie.role||"—",100,A),A+=5}),A+=8),g.tm.length>0&&(A>240&&(C.addPage(),A=20),C.setFontSize(12),C.setFont(void 0,"bold"),C.text("T&M Workers (Extra Work)",14,A),A+=7,C.setFontSize(9),C.setFont(void 0,"bold"),C.text("Name",14,A),C.text("Role",100,A),A+=5,C.setFont(void 0,"normal"),g.tm.forEach(ie=>{A>270&&(C.addPage(),A=20),C.text(ie.name,14,A),C.text(ie.role||"—",100,A),A+=5}),A+=8),A>200&&(C.addPage(),A=20),C.setFontSize(12),C.setFont(void 0,"bold"),C.text("Daily Timeline",14,A),A+=7,C.setFontSize(8),C.setFont(void 0,"bold"),C.text("Date",14,A),C.text("Total",70,A),C.text("Contract",95,A),C.text("T&M",125,A),A+=5,C.setFont(void 0,"normal"),N.forEach(ie=>{A>275&&(C.addPage(),A=20),C.text(ie.displayDate,14,A),C.text(String(ie.total),70,A),C.text(String(ie.contract),95,A),C.text(String(ie.tm),125,A),A+=4.5});const re=C.internal.pageSize.height-10;C.setFontSize(8),C.setTextColor(128,128,128),C.text(`Generated ${new Date().toLocaleString()} — FieldSync`,Z/2,re,{align:"center"});const Ne=`${a.name}_Crew_Report_${c}.pdf`;C.save(Ne),r?.("PDF exported!","success")}catch(T){console.error("Error exporting crew PDF:",T),r?.("Error generating PDF","error")}finally{m(!1)}},[a,c,g,N,r]);return x?e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsx("div",{className:"crew-metrics-header",children:e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Crew On-Site"]})}),e.jsxs("div",{className:"crew-metrics-loading",children:[e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"})]})]}):e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsxs("div",{className:"crew-metrics-header",children:[e.jsxs("h3",{children:[e.jsx(xe,{size:18})," Crew On-Site"]}),e.jsx("div",{className:"crew-metrics-actions",children:e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:$,disabled:b,title:"Export crew report as PDF",children:[e.jsx(Je,{size:14})," ",b?"Exporting...":"PDF"]})})]}),e.jsxs("div",{className:"crew-date-nav",children:[e.jsx("button",{className:"crew-date-btn",onClick:()=>F(-1),children:e.jsx(zt,{size:16})}),e.jsxs("span",{className:"crew-date-label",children:[e.jsx(It,{size:14}),K?"Today":_(c)]}),e.jsx("button",{className:"crew-date-btn",onClick:()=>F(1),disabled:K,children:e.jsx(ze,{size:16})})]}),e.jsxs("div",{className:"crew-stats-row",children:[e.jsxs("div",{className:"crew-stat total",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(xe,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.total}),e.jsx("span",{className:"crew-stat-label",children:"Total On-Site"})]})]}),e.jsxs("div",{className:"crew-stat contract",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(Ee,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.contract.length}),e.jsx("span",{className:"crew-stat-label",children:"Contract"})]})]}),e.jsxs("div",{className:"crew-stat tm",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(aa,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:g.tm.length}),e.jsx("span",{className:"crew-stat-label",children:"T&M"})]})]})]}),g.total>0&&e.jsxs("div",{className:"crew-breakdown-bar",children:[e.jsx("div",{className:"crew-bar-segment contract",style:{width:`${g.contract.length/g.total*100}%`},title:`${g.contract.length} Contract`}),e.jsx("div",{className:"crew-bar-segment tm",style:{width:`${g.tm.length/g.total*100}%`},title:`${g.tm.length} T&M`})]}),g.total>0&&e.jsxs("div",{className:"crew-name-lists",children:[g.contract.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header contract",children:[e.jsx(Ee,{size:13}),e.jsxs("span",{children:["Contract (",g.contract.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:g.contract.map((T,z)=>e.jsxs("span",{className:"crew-name-tag contract",children:[T.name,T.role&&T.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:T.role})]},z))})]}),g.tm.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header tm",children:[e.jsx(aa,{size:13}),e.jsxs("span",{children:["T&M (",g.tm.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:g.tm.map((T,z)=>e.jsxs("span",{className:"crew-name-tag tm",children:[T.name,T.role&&T.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:T.role})]},z))})]})]}),e.jsxs("div",{className:"crew-timeline-section",children:[e.jsxs("div",{className:"crew-timeline-header",children:[e.jsx("span",{className:"crew-timeline-title",children:"Daily Breakdown"}),e.jsx("div",{className:"crew-time-range-pills",children:Ct.map(T=>e.jsx("button",{className:`crew-range-pill ${u===T.id?"active":""}`,onClick:()=>o(T.id),children:T.label},T.id))})]}),e.jsx("div",{className:"crew-chart-container",children:e.jsx(ua,{width:"100%",height:140,children:e.jsxs(vi,{data:N,onClick:T=>T?.activePayload?.[0]&&w(T.activePayload[0].payload),style:{cursor:"pointer"},children:[e.jsx(At,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Rt,{dataKey:"displayDate",tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:{stroke:"var(--border-color)"},tickLine:!1,interval:u==="30d"?4:u==="14d"?1:0}),e.jsx(Mt,{tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:!1,tickLine:!1,allowDecimals:!1,width:30}),e.jsx(ma,{content:e.jsx(M,{})}),e.jsx(Ms,{wrapperStyle:{fontSize:"0.75rem",paddingTop:4},iconType:"circle",iconSize:8}),e.jsx(lt,{dataKey:"contract",name:"Contract",stackId:"crew",fill:Ss.contract,radius:[0,0,0,0]}),e.jsx(lt,{dataKey:"tm",name:"T&M (Extra Work)",stackId:"crew",fill:Ss.tm,radius:[3,3,0,0]})]})})})]}),g.total===0&&e.jsx("div",{className:"crew-empty",children:e.jsx("p",{children:"No crew checked in for this date"})})]})}),Wc=d.lazy(()=>ne(()=>import("./TMList-kfqzDz4n.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Hc=d.lazy(()=>ne(()=>import("./ShareModal-DDMCJvz0.js"),__vite__mapDeps([9,2,3,4,1,5,6]))),Uc=d.lazy(()=>ne(()=>import("./InjuryReportsList-DM0eYzGa.js"),__vite__mapDeps([10,1,2,3,4,5,6,8]))),Kc=d.lazy(()=>ne(()=>import("./NotificationSettings-B7kOXw94.js"),__vite__mapDeps([11,2,3,4,1,5,6]))),Gc=d.lazy(()=>ne(()=>import("./DailyReportsList-JukE7RVP.js"),__vite__mapDeps([12,1,2,3,4,5,6,8]))),Yc=d.lazy(()=>ne(()=>import("./CORList-85xlWopU.js"),__vite__mapDeps([13,1,2,3,4,5,6,8,14]))),Xc=d.lazy(()=>ne(()=>import("./CORForm-BcudIanW.js"),__vite__mapDeps([15,2,3,4,1,5,6,8]))),Jc=d.lazy(()=>ne(()=>import("./CORDetail-C1Q9Y9KF.js"),__vite__mapDeps([16,2,3,4,1,5,6,8,7]))),Zc=d.lazy(()=>ne(()=>import("./CORLogPreview-B1pIsifF.js"),__vite__mapDeps([17,2,3,4,1,5,6,8]))),Qc=d.lazy(()=>ne(()=>import("./CORLog-DFq6b9QJ.js"),__vite__mapDeps([14,1,2,3,4,5,6,8]))),eo=d.lazy(()=>ne(()=>import("./BillingCenter-CdErthfA.js"),__vite__mapDeps([18,2,3,4,1,5,6,8]))),so=d.lazy(()=>ne(()=>import("./DrawRequestModal-JmkT4rb-.js"),__vite__mapDeps([19,2,3,4,1,5,6,8]))),ao=d.lazy(()=>ne(()=>import("./EquipmentModal-D0s2xQH0.js"),__vite__mapDeps([20,2,3,4,1,5,6]))),to=d.lazy(()=>ne(()=>import("./AddCostModal-DRmCQi8k.js"),__vite__mapDeps([21,2,3,4,1,5,6]))),no=d.lazy(()=>ne(()=>import("./DocumentsTab-CdRbXjYG.js"),__vite__mapDeps([22,2,3,4,1,5,6])));function ro({company:s,user:a,isAdmin:r,onShowToast:t,navigateToProjectId:n,onProjectNavigated:i}){const[l,c]=d.useState([]),[h,u]=d.useState([]),[o,x]=d.useState(null),[j,b]=d.useState([]),[m,p]=d.useState(!0),[k,P]=d.useState(!1),[v,O]=d.useState(null),[g,N]=d.useState(!1),[F,K]=d.useState(!1),[_,w]=d.useState(!1),[M,$]=d.useState("overview"),[T,z]=d.useState("overview"),[C,Z]=d.useState(!0),[A,re]=d.useState(!1),[Ne,ie]=d.useState(!1),[ds,we]=d.useState("list"),[Be,Is]=d.useState("preview"),[xa,Jt]=d.useState([]),[Zt,We]=d.useState(!1),[Qt,He]=d.useState(null),[en,us]=d.useState(!1),[va,ms]=d.useState(null),[sn,fa]=d.useState(0),[an,$s]=d.useState(!1),[tn,ja]=d.useState(!1),[nn,hs]=d.useState(!1),[ga,ps]=d.useState(null),[rn,ln]=d.useState(0),[cn,xs]=d.useState(!1),[ba,vs]=d.useState(null),[on,dn]=d.useState(0),{isOpen:un,setIsOpen:mn,close:hn}=pc(),Ue=d.useRef(null),fs=d.useRef(!1),Ls=d.useRef(!1),zs=d.useRef(new Map),ya=300*1e3,ae=d.useCallback((f={})=>{const{refreshAreas:E=!1,refreshCOR:D=!1,projectId:R=null}=f;E&&R&&(fs.current=R),D&&(Ls.current=!0),Ue.current&&clearTimeout(Ue.current),Ue.current=setTimeout(async()=>{fs.current&&(await qs(fs.current),fs.current=!1),Ls.current&&(fa(V=>V+1),Ls.current=!1),await Ke()},150)},[]);d.useEffect(()=>()=>{Ue.current&&clearTimeout(Ue.current)},[]),d.useEffect(()=>{s?.id&&(Ke(),vn())},[s?.id]);const pn=d.useRef([]),xn=l.map(f=>f.id).sort().join(",");d.useEffect(()=>{if(!s?.id||l.length===0)return;const f=l.map(D=>D.id).sort();pn.current=f;const E=L.subscribeToCompanyActivity?.(s.id,f,{onMessage:()=>ae(),onMaterialRequest:()=>ae(),onTMTicket:()=>ae(),onCrewCheckin:()=>ae(),onAreaUpdate:()=>ae(),onCORChange:()=>ae({refreshCOR:!0}),onInjuryReport:()=>ae(),onProjectChange:()=>ae(),onMaterialsEquipmentChange:()=>ae(),onLaborRateChange:()=>ae()});return()=>{E&&L.unsubscribe?.(E)}},[s?.id,xn,ae]),d.useEffect(()=>(A?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[A]);const vn=async()=>{try{const f=await L.getDumpSites(s.id);Jt(f||[])}catch(f){console.error("Error loading dump sites:",f)}},Na=d.useRef(null);d.useEffect(()=>{if(n&&n!==Na.current&&l.length>0){const f=l.find(E=>E.id===n);f&&(Na.current=n,x(f),i?.())}},[n,l,i]),d.useEffect(()=>{if(o){qs(o.id);const f=[],E=o.id,D=L.subscribeToAreas?.(E,()=>{ae({refreshAreas:!0,projectId:E})});D&&f.push(D);const R=L.subscribeToDailyReports?.(E,()=>{ae()});R&&f.push(R);const V=L.subscribeToCrewCheckins?.(E,()=>{ae()});V&&f.push(V);const U=L.subscribeToHaulOffs?.(E,()=>{ae()});U&&f.push(U);const H=L.subscribeToCORs?.(E,()=>{ae({refreshCOR:!0})});return H&&f.push(H),()=>{f.forEach(X=>L.unsubscribe?.(X))}}},[o,ae]),d.useEffect(()=>{T==="tickets"&&Is("full")},[T]);const fn=async(f,E=!1)=>{const D=f.id,R=zs.current.get(D);if(R&&!E&&Date.now()-R.timestamp<ya)return R.data;try{const[V,U,H,X,J,ee,Ce,bs,S,W,te,fe]=await Promise.all([le(()=>L.getAreas(f.id),{fallback:[],context:{operation:"getAreas",projectId:f.id}}),le(()=>L.getTMTickets(f.id),{fallback:[],context:{operation:"getTMTickets",projectId:f.id}}),le(()=>L.getChangeOrderTotals(f.id),{fallback:null,context:{operation:"getChangeOrderTotals",projectId:f.id}}),le(()=>L.getDailyReports(f.id,100),{fallback:[],context:{operation:"getDailyReports",projectId:f.id}}),le(()=>L.getInjuryReports(f.id),{fallback:[],context:{operation:"getInjuryReports",projectId:f.id}}),le(()=>L.calculateManDayCosts(f.id,s?.id,f.work_type||"demolition",f.job_type||"standard"),{fallback:null,context:{operation:"calculateManDayCosts",projectId:f.id}}),le(()=>L.calculateHaulOffCosts(f.id),{fallback:null,context:{operation:"calculateHaulOffCosts",projectId:f.id}}),le(()=>L.getProjectCosts(f.id),{fallback:[],context:{operation:"getProjectCosts",projectId:f.id}}),le(()=>L.getCORStats(f.id),{fallback:null,context:{operation:"getCORStats",projectId:f.id}}),le(()=>L.getCrewCheckinHistory(f.id,60),{fallback:[],context:{operation:"getCrewCheckinHistory",projectId:f.id}}),le(()=>L.getMaterialRequests(f.id),{fallback:[],context:{operation:"getMaterialRequests",projectId:f.id}}),le(()=>L.getWeeklyDisposalSummary(f.id,4),{fallback:[],context:{operation:"getWeeklyDisposalSummary",projectId:f.id}})]),me=ct(V),Vs=me.progress,Va=H?.totalApprovedValue||0,Ba=f.contract_value+Va,ys=me.isValueBased?me.earnedValue:Vs/100*Ba,Xn=U.filter(q=>q.status==="pending").length,Bs=new Date;Bs.setDate(Bs.getDate()-7);const Jn=X.filter(q=>new Date(q.report_date)>=Bs).length,Wa=bs.reduce((q,G)=>{const Ae=parseFloat(G.amount);return q+(isNaN(Ae)?0:Ae)},0);let Ns=0;const ws={};U.forEach(q=>{const G=q.work_date||q.ticket_date||q.created_at?.split("T")[0],Ae=q.t_and_m_items||q.items||[];let Cs=0;Ae.forEach(Ys=>{const hr=parseFloat(Ys.quantity)||1,pr=parseFloat(Ys.unit_cost)||parseFloat(Ys.materials_equipment?.cost_per_unit)||0;Cs+=hr*pr}),Cs>0&&G&&(Ns+=Cs,ws[G]||(ws[G]={date:G,cost:0}),ws[G].cost+=Cs)});const Ha=Object.values(ws).sort((q,G)=>new Date(G.date)-new Date(q.date)),Ws=ee?.totalCost||0,Zn=Ce?.totalCost||0,Ua=Ws+Ns+Wa,Ka=ys-Ua,Qn=ys>0?Ka/ys*100:0,Ga=ee?.byDate?.length||0,er=Ha.length,Hs=Math.max(Ga,er),Ya=Ws+Ns,sr=Hs>0?Ya/Hs:0,je=bi({...f,progress:Vs},ee?.totalManDays||0),ke={},Xa=new Set;(W||[]).forEach(q=>{const G=q.workers||[];ke[q.check_in_date]=G.length,G.forEach(Ae=>Xa.add(Ae.name?.toLowerCase()))});const ge=Object.keys(ke).sort(),ar=ge.length>0?Math.round(ge.reduce((q,G)=>q+ke[G],0)/ge.length*10)/10:0,tr=ge.length>0?Math.max(...ge.map(q=>ke[q])):0,Us=ge.slice(-7),Ks=ge.slice(-14,-7),Ja=Us.length>0?Us.reduce((q,G)=>q+ke[G],0)/Us.length:0,Gs=Ks.length>0?Ks.reduce((q,G)=>q+ke[G],0)/Ks.length:0,nr=(te||[]).filter(q=>q.status==="pending").length,rr=(te||[]).filter(q=>q.status==="ordered").length,ir=(te||[]).filter(q=>q.status==="delivered").length,lr=(te||[]).filter(q=>q.priority==="urgent"&&q.status==="pending").length,cr=X.filter(q=>q.issues&&q.issues.trim().length>0).length,or=U.reduce((q,G)=>q+(G.photos?.length||0),0),dr=(fe||[]).reduce((q,G)=>q+(G.concrete||0)+(G.trash||0)+(G.metals||0)+(G.hazardous_waste||0),0),Za=J.length>0?new Date(J[0]?.incident_date||J[0]?.created_at):null,ur=Za?Math.floor((new Date-Za)/(1e3*60*60*24)):null,mr=V.filter(q=>q.status==="done"),Qa={...f,areas:V,progress:Vs,billable:ys,changeOrderValue:Va,revisedContractValue:Ba,changeOrderPending:H?.pendingCount||0,totalTickets:U.length,pendingTickets:Xn,approvedTickets:U.filter(q=>q.status==="approved").length,tmTickets:U,dailyReportsCount:X.length,recentDailyReports:Jn,injuryReportsCount:J.length,lastDailyReport:X[0]?.report_date||null,isValueBased:me.isValueBased,earnedValue:me.earnedValue,totalSOVValue:me.totalValue,laborCost:Ws,laborDaysWorked:Ga,laborManDays:ee?.totalManDays||0,laborByDate:ee?.byDate||[],dailyBurn:sr,materialsEquipmentCost:Ns,materialsEquipmentByDate:Ha,haulOffCost:Zn,haulOffLoads:Ce?.totalLoads||0,haulOffDays:Ce?.daysWithHaulOff||0,haulOffByType:Ce?.byWasteType||{},haulOffByDate:Ce?.byDate||[],customCosts:bs,customCostTotal:Wa,totalBurn:Ya,totalBurnDays:Hs,allCostsTotal:Ua,currentProfit:Ka,profitMargin:Qn,corPendingValue:S?.total_pending_value||0,corPendingCount:S?.pending_count||0,corApprovedValue:S?.total_approved_value||0,corBilledValue:S?.total_billed_value||0,corTotalCount:S?.total_cors||0,corStats:S,scheduleStatus:je.scheduleStatus,scheduleVariance:je.scheduleVariance,scheduleLabel:je.scheduleLabel,laborStatus:je.laborStatus,laborVariance:je.laborVariance,laborLabel:je.laborLabel,hasScheduleData:je.hasScheduleData,hasLaborData:je.hasLaborData,actualManDays:ee?.totalManDays||0,crewHistory:W||[],crewByDate:ke,uniqueWorkerCount:Xa.size,avgCrewSize:ar,peakCrewSize:tr,crewDaysTracked:ge.length,crewTrend:Gs>0?(Ja-Gs)/Gs*100:0,recentCrewAvg:Ja,materialRequests:te||[],pendingMaterialRequests:nr,orderedMaterialRequests:rr,deliveredMaterialRequests:ir,urgentMaterialRequests:lr,totalMaterialRequests:(te||[]).length,reportsWithIssues:cr,totalPhotosFromTickets:or,dailyReports:X,weeklyDisposal:fe||[],disposalTotalLoads:dr,daysSinceLastInjury:ur,injuryReports:J,oshaRecordable:J.filter(q=>q.osha_recordable).length,completedAreasCount:mr.length,hasError:!1,_detailsLoaded:!0};return zs.current.set(D,{data:Qa,timestamp:Date.now()}),Qa}catch(V){return console.error(`Error loading details for project ${f.id}:`,V),{...f,hasError:!0,_detailsLoaded:!1}}},Ke=async()=>{try{const f=await L.getProjectDashboardSummary(s?.id);c(f);const E=f.map(D=>{const R=zs.current.get(D.id);if(R&&Date.now()-R.timestamp<ya)return R.data;const V=D.areaCount||0,U=D.completedAreas||0,H=V>0?Math.round(U/V*100):0;return{...D,progress:H,areas:[],totalTickets:D.ticketCount||0,pendingTickets:D.pendingTicketCount||0,approvedTickets:D.approvedTicketCount||0,dailyReportsCount:D.dailyReportsThisWeek||0,recentDailyReports:D.dailyReportsThisWeek||0,corTotalCount:D.corCount||0,billable:0,changeOrderValue:0,revisedContractValue:D.contract_value||0,changeOrderPending:0,tmTickets:[],injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,materialsEquipmentCost:0,materialsEquipmentByDate:[],haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corStats:null,scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1,actualManDays:0,hasError:!1,_detailsLoaded:!1}});u(E)}catch(f){console.error("Error loading projects:",f),t("Error loading projects","error")}finally{p(!1)}},qs=async f=>{try{const E=await L.getAreas(f);b(E)}catch(E){console.error("Error loading areas:",E)}},js=async f=>{if(x(f),!f._detailsLoaded){const E=await fn(f);u(D=>D.map(R=>R.id===f.id?E:R)),x(E)}},wa=()=>{x(null),b([]),P(!1),O(null),$("overview"),Ke()},Ca=()=>{O({name:o.name,job_number:o.job_number||"",address:o.address||"",general_contractor:o.general_contractor||"",client_contact:o.client_contact||"",client_phone:o.client_phone||"",contract_value:o.contract_value,work_type:o.work_type||"demolition",job_type:o.job_type||"standard",pin:o.pin||"",default_dump_site_id:o.default_dump_site_id||"",areas:j.map(f=>({id:f.id,name:f.name,weight:f.weight,isNew:!1}))}),P(!0)},jn=()=>{P(!1),O(null)},ue=(f,E)=>{O(D=>({...D,[f]:E}))},ka=(f,E,D)=>{O(R=>({...R,areas:R.areas.map((V,U)=>U===f?{...V,[E]:D}:V)}))},gn=()=>{O(f=>({...f,areas:[...f.areas,{id:null,name:"",weight:"",isNew:!0}]}))},bn=f=>{v.areas.length>1&&O(E=>({...E,areas:E.areas.filter((D,R)=>R!==f)}))},yn=async()=>{if(!v.name.trim()){t("Please enter a project name","error");return}const f=parseFloat(v.contract_value);if(!f||f<=0){t("Please enter a valid contract value","error");return}if(v.pin&&v.pin.length!==4){t("PIN must be 4 digits","error");return}if(v.pin&&v.pin!==o.pin&&!await L.isPinAvailable(v.pin,o.id)){t("This PIN is already in use","error");return}const E=v.areas.filter(R=>R.name.trim()&&parseFloat(R.weight)>0);if(E.length===0){t("Please add at least one area","error");return}if(E.reduce((R,V)=>R+parseFloat(V.weight),0)!==100){t("Area weights must total 100%","error");return}N(!0);try{await L.updateProject(o.id,{name:v.name.trim(),job_number:v.job_number?.trim()||null,address:v.address?.trim()||null,general_contractor:v.general_contractor?.trim()||null,client_contact:v.client_contact?.trim()||null,client_phone:v.client_phone?.trim()||null,contract_value:f,work_type:v.work_type||"demolition",job_type:v.job_type||"standard",pin:v.pin||null,default_dump_site_id:v.default_dump_site_id||null},s?.id);const R=j.map(H=>H.id),V=v.areas.filter(H=>H.id).map(H=>H.id);for(const H of R)V.includes(H)||await L.deleteArea(H);for(let H=0;H<E.length;H++){const X=E[H];X.id?await L.updateArea(X.id,{name:X.name.trim(),weight:parseFloat(X.weight),sort_order:H}):await L.createArea({project_id:o.id,name:X.name.trim(),weight:parseFloat(X.weight),status:"not_started",sort_order:H})}const U=await L.getProject(o.id);x(U),await qs(o.id),P(!1),O(null),t("Project updated!","success")}catch(R){console.error("Error saving project:",R?.message||R),t(R?.message||"Error saving changes","error")}finally{N(!1)}},Nn=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await L.deleteProject(o.id),t("Project deleted","success"),wa()}catch(f){console.error("Error deleting project:",f),t("Error deleting project","error")}},y=d.useMemo(()=>o?h.find(f=>f.id===o.id):null,[o,h]),wn=d.useMemo(()=>{if(!o)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const f=ct(j),E=f.progress,D=y?.changeOrderValue||0,R=o.contract_value+D,V=f.isValueBased?f.earnedValue:E/100*R;return{progress:E,billable:V,changeOrderValue:D,revisedContractValue:R,isValueBased:f.isValueBased,earnedValue:f.earnedValue,totalSOVValue:f.totalValue}},[o,j,y]),Cn=d.useMemo(()=>{const f=h.reduce((J,ee)=>J+(ee.contract_value||0),0),E=h.reduce((J,ee)=>J+(ee.changeOrderValue||0),0),D=f+E,R=h.reduce((J,ee)=>J+(ee.billable||0),0),V=D-R,U=D>0?Math.round(R/D*100):0,H=h.reduce((J,ee)=>J+(ee.corPendingValue||0),0),X=h.reduce((J,ee)=>J+(ee.corPendingCount||0),0);return{totalOriginalContract:f,totalChangeOrders:E,totalPortfolioValue:D,totalEarned:R,totalRemaining:V,weightedCompletion:U,totalPendingCORValue:H,totalPendingCORCount:X}},[h]),kn=d.useMemo(()=>{let f=0,E=0,D=0,R=0,V=0;for(const U of h){const H=U.revisedContractValue||U.contract_value;U.progress>=100&&f++,U.progress<100&&U.billable<=H*(U.progress/100)*1.1&&E++,U.billable>H*.9&&U.progress<90&&D++,U.billable>H&&R++,(U.changeOrderValue||0)>0&&V++}return{projectsComplete:f,projectsOnTrack:E,projectsAtRisk:D,projectsOverBudget:R,projectsWithChangeOrders:V}},[h]),Dn=d.useMemo(()=>{let f=0,E=0,D=0,R=0,V=0,U=0;for(const H of h)H.hasScheduleData&&(H.scheduleStatus==="ahead"?f++:H.scheduleStatus==="behind"?D++:E++),H.hasLaborData&&(H.laborStatus==="over"?R++:H.laborStatus==="under"?V++:U++);return{scheduleAhead:f,scheduleOnTrack:E,scheduleBehind:D,laborOver:R,laborUnder:V,laborOnTrack:U,hasAnyScheduleData:f+E+D>0,hasAnyLaborData:R+V+U>0}},[h]),Ge=d.useMemo(()=>{const f=h.map(D=>{const R={id:D.id,name:D.name,totalCosts:D.totalCosts||0,earnedRevenue:D.billable||0,actualProgress:D.progress||0,expectedProgress:D.expectedProgress||D.progress,pendingCORValue:D.corPendingValue||0,contractValue:D.revisedContractValue||D.contract_value||0,lastReportDate:D.lastDailyReport,recentInjuryCount:D.recentInjuryCount||0,startDate:D.start_date},V=ic(R),U=lc(V,{...R,name:D.name}),H=cc(R),X=U.map(J=>({...J,projectName:D.name,projectId:D.id}));return{projectId:D.id,projectName:D.name,riskScore:V.score,riskStatus:V.status,riskLabel:V.label,factors:V.factors,alerts:X,projections:H}}),E=f.flatMap(D=>D.alerts).sort((D,R)=>{const V={critical:0,warning:1,info:2};return V[D.type]-V[R.type]});return{projectRisks:f,allAlerts:E,criticalCount:E.filter(D=>D.type==="critical").length,warningCount:E.filter(D=>D.type==="warning").length}},[h]),Sn=d.useCallback(({target:f,projectId:E,alert:D})=>{const R=l.find(V=>V.id===E);R&&(x(R),f==="financials"?$("financials"):f==="reports"?$("reports"):f==="cors"?($("financials"),z("cors")):$("overview"))},[l]);d.useEffect(()=>{const f=async()=>{for(const E of h)if(fi(E,30))try{await L.archiveProject(E.id),t(`Project "${E.name}" has been auto-archived after 30 days of completion`,"info")}catch(D){console.error("Failed to auto-archive project:",D)}};h.length>0&&f()},[]);const _n=d.useCallback(()=>{ps(null),hs(!0)},[]),En=d.useCallback(f=>{ps(f),hs(!0)},[]),Pn=d.useCallback(()=>{vs(null),xs(!0)},[]),On=d.useCallback(f=>{vs(f),xs(!0)},[]),Tn=d.useCallback(()=>{Is("full")},[]),An=d.useCallback(()=>{Z(f=>!f)},[]),Rn=d.useCallback(()=>{re(f=>!f)},[]),Da=d.useCallback(()=>{re(!1)},[]),Sa=d.useCallback(()=>{ie(f=>!f)},[]),gs=d.useCallback(async(f="all")=>{if(o){t("Gathering field data...","info");try{const[E,D,R]=await Promise.all([L.getDailyReports(o.id,365),L.getInjuryReports(o.id),L.getCrewCheckinHistory(o.id,365)]);f==="daily"?await oc(E||[],o):f==="incidents"?await dc(D||[],o):f==="crew"?await uc(R||[],o):await mc({dailyReports:E||[],incidentReports:D||[],crewCheckins:R||[],project:o}),t("PDF exported!","success")}catch(E){console.error("Error exporting field documents:",E),t("Error generating PDF","error")}}},[o,t]),Mn=d.useCallback(()=>{Is("preview")},[]),Fn=d.useCallback(()=>{we("log")},[]),_a=d.useCallback(()=>{He(null),We(!0)},[]),In=d.useCallback(f=>{ms(f),us(!0)},[]),$n=d.useCallback(f=>{He(f),We(!0)},[]),Ln=d.useCallback(()=>{$s(!0)},[]),zn=d.useCallback(async f=>{try{await L.deleteProjectCost(f),Ke(),t?.("Cost deleted","success")}catch{t?.("Error deleting cost","error")}},[]),qn=d.useMemo(()=>({corCount:y?.corStats?.total||0,ticketCount:y?.totalTickets||0,corPending:y?.corStats?.pending||0,ticketPending:y?.pendingTickets||0}),[y?.corStats?.total,y?.totalTickets,y?.corStats?.pending,y?.pendingTickets]),{totalOriginalContract:Vn,totalChangeOrders:Ea,totalPortfolioValue:Bn,totalEarned:Wn,totalRemaining:Hn,weightedCompletion:Un,totalPendingCORValue:Kn,totalPendingCORCount:Pa}=Cn,{projectsComplete:Oa,projectsOnTrack:Ta,projectsAtRisk:Aa,projectsOverBudget:Ra,projectsWithChangeOrders:Ma}=kn,{scheduleAhead:Fa,scheduleOnTrack:Ia,scheduleBehind:$a,laborOver:La,laborUnder:za,laborOnTrack:qa,hasAnyScheduleData:Gn,hasAnyLaborData:Yn}=Dn;if(m)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(o){const{progress:f,billable:E,changeOrderValue:D,revisedContractValue:R,isValueBased:V,earnedValue:U,totalSOVValue:H}=wn;if(k&&v){const S=v.areas.reduce((W,te)=>W+(parseFloat(te.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:jn,style:{marginBottom:"1.5rem"},children:"← Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:v.name,onChange:W=>ue("name",W.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:v.job_number,onChange:W=>ue("job_number",W.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:v.address,onChange:W=>ue("address",W.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:v.general_contractor,onChange:W=>ue("general_contractor",W.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:v.client_contact,onChange:W=>ue("client_contact",W.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:v.client_phone,onChange:W=>ue("client_phone",W.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:v.contract_value,onChange:W=>ue("contract_value",W.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:v.pin,onChange:W=>ue("pin",W.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:v.work_type,onChange:W=>ue("work_type",W.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:v.job_type,onChange:W=>ue("job_type",W.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:v.default_dump_site_id,onChange:W=>ue("default_dump_site_id",W.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),xa.map(W=>e.jsx("option",{value:W.id,children:W.name},W.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),v.areas.map((W,te)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:W.name,onChange:fe=>ka(te,"name",fe.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:W.weight,onChange:fe=>ka(te,"weight",fe.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>bn(te),children:"×"})]},te)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${S===100?"valid":"invalid"}`,children:[S,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:gn,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:yn,disabled:g,style:{flex:1},children:g?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:Nn,children:"Delete Project"})]})}const X=j.filter(S=>S.status==="done").length,J=j.filter(S=>S.status==="working").length,ee=j.filter(S=>S.status==="not_started").length,Ce=(y?.pendingTickets||0)+(y?.changeOrderPending||0),bs=[{id:"overview",label:"Overview",Icon:dt},{id:"financials",label:"Financials",Icon:Xe,badge:Ce},{id:"reports",label:"Reports",Icon:he},{id:"documents",label:"Documents",Icon:sa},{id:"info",label:"Info",Icon:_s}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:wa,children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>K(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>w(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:Ca,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:o.name}),(o.job_number||o.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[o.job_number&&`Job #${o.job_number}`,o.job_number&&o.work_type&&" • ",o.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[f,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:se(E)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:se(R-E)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:bs.map(S=>e.jsxs("button",{className:`pv-tab ${M===S.id?"active":""} ${S.badge>0?"has-badge":""}`,onClick:()=>$(S.id),children:[e.jsx(S.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:S.label}),S.badge>0&&e.jsx("span",{className:"pv-tab-badge",children:S.badge})]},S.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[M==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab animate-fade-in",children:[e.jsxs("div",{className:"overview-hero-split",children:[e.jsx(zc,{progress:f,areasComplete:X,totalAreas:j.length,areasWorking:J}),e.jsx(qc,{earnedRevenue:E,totalCosts:y?.allCostsTotal||0,laborCost:y?.laborCost||0,disposalCost:y?.haulOffCost||0,equipmentCost:y?.materialsEquipmentCost||0,materialsCost:0,otherCost:y?.customCostTotal||0,contractValue:R})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(Bc,{project:o,onShowToast:t}),e.jsxs("div",{className:"overview-section-card overview-work-areas-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[X>0&&e.jsxs("span",{className:"section-badge done",children:[X," Done"]}),J>0&&e.jsxs("span",{className:"section-badge working",children:[J," Active"]}),ee>0&&e.jsxs("span",{className:"section-badge pending",children:[ee," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list work-areas-scroll stagger-areas",children:j.map(S=>e.jsxs("div",{className:`work-area-item ${S.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[S.status==="done"&&e.jsx("span",{className:"status-icon done",children:"✓"}),S.status==="working"&&e.jsx("span",{className:"status-icon working",children:"●"}),S.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:"○"})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:S.name}),e.jsx("span",{className:"work-area-weight",children:S.scheduled_value?se(S.scheduled_value):`${S.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${S.status}`,style:{width:S.status==="done"?"100%":S.status==="working"?"50%":"0%"}})})]},S.id))})]})]}),e.jsxs("div",{className:"overview-bottom-strip",children:[(y?.pendingTickets>0||y?.changeOrderPending>0)&&e.jsxs("div",{className:"overview-attention-inline",children:[y?.pendingTickets>0&&e.jsxs("div",{className:"attention-chip warning",onClick:()=>$("financials"),children:[e.jsx(he,{size:14}),e.jsxs("span",{children:[y.pendingTickets," T&M pending"]})]}),y?.changeOrderPending>0&&e.jsxs("div",{className:"attention-chip info",onClick:()=>$("financials"),children:[e.jsx($e,{size:14}),e.jsxs("span",{children:[y.changeOrderPending," CO pending"]})]})]}),e.jsxs("div",{className:"overview-quick-actions",children:[e.jsxs("button",{className:"overview-action-btn",onClick:()=>$("reports"),children:[e.jsx(he,{size:15}),e.jsxs("span",{children:[y?.dailyReportsCount||0," Reports"]})]}),e.jsxs("button",{className:"overview-action-btn",onClick:()=>$("financials"),children:[e.jsx(Xe,{size:15}),e.jsxs("span",{children:[y?.totalTickets||0," T&M Tickets"]})]}),e.jsx("span",{className:"overview-action-divider"}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>gs("all"),children:[e.jsx(Je,{size:15}),e.jsx("span",{children:"Export All Docs"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>gs("daily"),children:[e.jsx(Je,{size:14}),e.jsx("span",{children:"Daily"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>gs("incidents"),children:[e.jsx(Je,{size:14}),e.jsx("span",{children:"Incidents"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>gs("crew"),children:[e.jsx(Je,{size:14}),e.jsx("span",{children:"Crew"})]})]})]})]}),M==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsx($c,{contractValue:o?.contract_value||0,earnedRevenue:E,totalCosts:y?.allCostsTotal||0,profit:y?.currentProfit||0,progress:f,corApprovedValue:D,loading:!y}),e.jsxs("div",{className:`financials-layout ${C?"sidebar-collapsed":""}`,children:[e.jsxs("button",{className:"financials-mobile-menu-toggle",onClick:Rn,"aria-label":"Open navigation menu",title:"Open navigation menu",children:[e.jsx($i,{size:20}),e.jsx("span",{children:"Menu"})]}),A&&e.jsx("div",{className:"financials-sidebar-overlay",onClick:Da,"aria-hidden":"true"}),e.jsx("div",{className:`financials-sidebar ${C?"collapsed":""} ${A?"mobile-open":""}`,children:e.jsx(Lc,{activeSection:T,onSectionChange:S=>{z(S),re(!1)},collapsed:C,onToggleCollapse:An,onMobileClose:Da,stats:qn})}),e.jsxs("div",{className:"financials-main",children:[T==="overview"&&e.jsxs("div",{className:"financials-overview animate-fade-in",children:[e.jsx(Sc,{projectData:y,project:o,tmTickets:y?.tmTickets||[],corStats:y?.corStats,areas:j}),e.jsxs("div",{className:"financials-analysis-row stagger-children",children:[e.jsx(yc,{dailyBurn:y?.dailyBurn||0,totalBurn:y?.totalBurn||0,daysWorked:y?.totalBurnDays||0,laborCost:y?.laborCost||0,materialsEquipmentCost:y?.materialsEquipmentCost||0,progress:f,contractValue:R,laborByDate:y?.laborByDate||[],materialsEquipmentByDate:y?.materialsEquipmentByDate||[]}),e.jsx(Pc,{revenue:E,totalCosts:y?.allCostsTotal||0,contractValue:R,progress:f})]}),e.jsxs("div",{className:"cost-disposal-row",children:[e.jsx(Ec,{laborCost:y?.laborCost||0,haulOffCost:y?.haulOffCost||0,customCosts:y?.customCosts||[],onAddCost:Ln,onDeleteCost:zn}),e.jsx(Tc,{project:o,period:"week"})]}),e.jsx(gc,{project:o,onAddEquipment:_n,onEditEquipment:En,onShowToast:t},rn),e.jsx(jc,{project:o,areas:j,corStats:y?.corStats,onCreateDraw:Pn,onViewDraw:On,onShowToast:t},on),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(Ee,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:se(y?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(fc,{project:o,company:s,onShowToast:t})})]})]}),T==="cors"&&e.jsxs("div",{className:"financials-cors animate-fade-in",children:[e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(d.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(Zc,{project:o,onShowToast:t,onToggleList:Sa,showingList:Ne,onViewFullLog:Fn,onCreateCOR:_a})})}),Ne&&e.jsx("div",{className:"financials-section cor-section-list animate-fade-in",style:{marginTop:"1rem"},children:e.jsx(d.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(Yc,{project:o,company:s,areas:j,refreshKey:sn,onShowToast:t,previewMode:!1,onViewAll:Sa,onDisplayModeChange:we,onCreateCOR:_a,onViewCOR:In,onEditCOR:$n})})})]}),T==="tickets"&&e.jsx("div",{className:"financials-tickets animate-fade-in",children:e.jsxs("div",{className:"financials-section tm-section",children:[Be==="full"&&e.jsx("button",{className:"section-back-btn",onClick:Mn,children:"← Back to summary"}),e.jsx(d.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(Wc,{project:o,company:s,onShowToast:t,compact:Be==="preview",previewMode:Be==="preview",onViewAll:Tn})})]})}),T==="billing"&&e.jsx("div",{className:"financials-billing animate-fade-in",children:e.jsx(d.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(eo,{project:o,company:s,user:a,onShowToast:t})})})]})]})]}),M==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(he,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:y?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:y?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((y?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:y?.totalTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"T&M Tickets"}),(y?.pendingTickets||0)>0&&e.jsxs("div",{className:"reports-metric-status",style:{background:"#fef3c7",color:"#92400e"},children:[y.pendingTickets," pending"]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:y?.totalPhotosFromTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"Photos Captured"})]})]})}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsx("div",{className:"reports-insight-header",children:e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(xe,{size:18}),e.jsx("h3",{children:"Crew Analytics"})]})}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.uniqueWorkerCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Workers"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.avgCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Avg Crew / Day"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.peakCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Peak Crew Size"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.crewDaysTracked||0}),e.jsx("span",{className:"reports-stat-label",children:"Days Tracked"})]})]}),(y?.crewTrend||0)!==0&&e.jsxs("div",{className:`reports-trend-badge ${y.crewTrend>0?"up":"down"}`,children:[y.crewTrend>0?e.jsx(is,{size:14}):e.jsx(rs,{size:14}),e.jsxs("span",{children:[Math.abs(Math.round(y.crewTrend)),"% ",y.crewTrend>0?"increase":"decrease"," vs prior week"]})]}),y?.crewByDate&&Object.keys(y.crewByDate).length>0&&e.jsxs("div",{className:"reports-mini-chart",children:[e.jsx("div",{className:"reports-mini-chart-label",children:"Recent Crew Size"}),e.jsx("div",{className:"reports-mini-bars",children:Object.keys(y.crewByDate).sort().slice(-14).map(S=>{const W=y.crewByDate[S],te=y.peakCrewSize||1;return e.jsx("div",{className:"reports-mini-bar-wrap",title:`${new Date(S+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}: ${W} workers`,children:e.jsx("div",{className:"reports-mini-bar",style:{height:`${W/te*100}%`}})},S)})})]})]})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Li,{size:18}),e.jsx("h3",{children:"Safety Dashboard"})]}),e.jsx("span",{className:`reports-section-badge ${(y?.injuryReportsCount||0)>0?"warning":"success"}`,children:(y?.injuryReportsCount||0)>0?`${y.injuryReportsCount} incident${y.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsx("div",{className:"reports-safety-hero",children:e.jsxs("div",{className:`reports-safety-days ${y?.daysSinceLastInjury===null||y?.daysSinceLastInjury>30?"excellent":y?.daysSinceLastInjury>7?"good":"caution"}`,children:[e.jsx("span",{className:"reports-safety-days-value",children:y?.daysSinceLastInjury!==null?y.daysSinceLastInjury:"--"}),e.jsx("span",{className:"reports-safety-days-label",children:y?.daysSinceLastInjury!==null?"Days Since Last Incident":"No Incidents Recorded"})]})}),e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.injuryReportsCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Incidents"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.oshaRecordable||0}),e.jsx("span",{className:"reports-stat-label",children:"OSHA Recordable"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.reportsWithIssues||0}),e.jsx("span",{className:"reports-stat-label",children:"Reports w/ Issues"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:y?.laborManDays||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Man-Days"})]})]})]})]})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Pe,{size:18}),e.jsx("h3",{children:"Disposal Trends"})]}),e.jsxs("span",{className:"reports-section-count",children:[y?.disposalTotalLoads||0," loads"]})]}),e.jsx("div",{className:"reports-insight-body",children:(y?.weeklyDisposal||[]).length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Pe,{size:32}),e.jsx("p",{children:"No disposal data yet"}),e.jsx("span",{children:"Disposal loads from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-disposal-chart",children:[e.jsx("div",{className:"reports-disposal-bars",children:(y?.weeklyDisposal||[]).map((S,W)=>{const te=(S.concrete||0)+(S.trash||0)+(S.metals||0)+(S.hazardous_waste||0),fe=Math.max(...(y?.weeklyDisposal||[]).map(me=>(me.concrete||0)+(me.trash||0)+(me.metals||0)+(me.hazardous_waste||0)))||1;return e.jsxs("div",{className:"reports-disposal-bar-col",children:[e.jsxs("div",{className:"reports-disposal-bar-stack",style:{height:`${te/fe*100}%`},children:[S.concrete>0&&e.jsx("div",{className:"reports-disposal-seg concrete",style:{flex:S.concrete},title:`Concrete: ${S.concrete}`}),S.trash>0&&e.jsx("div",{className:"reports-disposal-seg trash",style:{flex:S.trash},title:`Trash: ${S.trash}`}),S.metals>0&&e.jsx("div",{className:"reports-disposal-seg metals",style:{flex:S.metals},title:`Metals: ${S.metals}`}),S.hazardous_waste>0&&e.jsx("div",{className:"reports-disposal-seg hazardous",style:{flex:S.hazardous_waste},title:`Hazardous: ${S.hazardous_waste}`})]}),e.jsx("span",{className:"reports-disposal-bar-label",children:new Date(S.week+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},W)})}),e.jsxs("div",{className:"reports-disposal-legend",children:[e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot concrete"}),"Concrete"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot trash"}),"Trash"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot metals"}),"Metals"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot hazardous"}),"Hazardous"]})]})]}),(y?.haulOffCost||0)>0&&e.jsxs("div",{className:"reports-disposal-cost",children:[e.jsx("span",{children:"Total Disposal Cost"}),e.jsx("strong",{children:se(y.haulOffCost)})]})]})})]}),e.jsxs("div",{className:"reports-insight-card reports-activity-summary",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(he,{size:18}),e.jsx("h3",{children:"Field Activity Summary"})]}),e.jsx("div",{className:"reports-activity-badges",children:y?.lastDailyReport&&e.jsxs("span",{className:"reports-last-filed",children:["Last report: ",new Date(y.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ","(",Math.floor((new Date-new Date(y.lastDailyReport))/(1e3*60*60*24)),"d ago)"]})})]}),e.jsx("div",{className:"reports-insight-body",children:e.jsxs("div",{className:"reports-activity-grid",children:[e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(he,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.dailyReportsCount||0}),e.jsx("span",{children:"Daily Reports Filed"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx($e,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.totalTickets||0}),e.jsx("span",{children:"T&M Tickets Created"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(zi,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.totalPhotosFromTickets||0}),e.jsx("span",{children:"Photos Documented"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Ee,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsxs("strong",{children:[y?.completedAreasCount||0,"/",j.length]}),e.jsx("span",{children:"Work Areas Complete"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Xe,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:se(y?.allCostsTotal||0)}),e.jsx("span",{children:"Total Costs Tracked"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(xe,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:y?.laborManDays||0}),e.jsx("span",{children:"Total Man-Days"})]})]})]})})]}),e.jsxs("div",{className:"reports-two-col reports-lists-row",children:[e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(he,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[y?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(d.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(Gc,{project:o,company:s,onShowToast:t})})})]}),e.jsxs("div",{className:`reports-section-card ${(y?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(y?.injuryReportsCount||0)>0?"warning":"success"}`,children:(y?.injuryReportsCount||0)>0?"⚠":"✓"}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(y?.injuryReportsCount||0)>0?"warning":"success"}`,children:(y?.injuryReportsCount||0)>0?`${y.injuryReportsCount} incident${y.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(d.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(Uc,{project:o,companyId:s?.id||o?.company_id,company:s,user:a,onShowToast:t})})})]})]})]}),M==="documents"&&e.jsx("div",{className:"pv-tab-panel documents-tab",children:e.jsx(d.Suspense,{fallback:e.jsx(Se,{}),children:e.jsx(no,{project:o,companyId:s?.id||o?.company_id,onShowToast:t,userRole:a?.access_level||"office"})})}),M==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:o.name}),o.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",o.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:Ca,children:e.jsx("span",{children:"Edit Project"})})]}),o.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(qi,{size:14}),e.jsx("span",{children:o.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Ee,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:o.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx($e,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:o.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Xe,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:se(R)}),e.jsx("span",{className:"info-quick-label",children:D>0?`Incl. +${se(D)} COs`:"Contract Value"})]})]}),o.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:o.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Vi,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[o.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:o.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),o.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:o.client_contact})]}),o.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(Bi,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${o.client_phone}`,className:"info-detail-value link",children:o.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(dt,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[X>0&&e.jsxs("span",{className:"info-badge done",children:[X," Done"]}),J>0&&e.jsxs("span",{className:"info-badge working",children:[J," Active"]}),ee>0&&e.jsxs("span",{className:"info-badge pending",children:[ee," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:j.map(S=>e.jsxs("div",{className:`info-area-item ${S.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[S.status==="done"&&e.jsx("span",{className:"status-dot done",children:"✓"}),S.status==="working"&&e.jsx("span",{className:"status-dot working",children:"●"}),S.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:"○"})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:S.name}),e.jsx("span",{className:`info-area-status-label ${S.status}`,children:S.status==="done"?"Complete":S.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[S.weight,"%"]})]},S.id))})]}),e.jsx(Ac,{project:o,company:s,user:a,isAdmin:r,onShowToast:t}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(_s,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:se(o.contract_value)})]}),D>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",se(D)]})]}),o.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:xa.find(S=>S.id===o.default_dump_site_id)?.name||"Unknown"})]})]})]})]})]}),F&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(Hc,{project:o,user:a,onClose:()=>K(!1),onShareCreated:S=>{t("Share link created successfully!","success")}})}),_&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(d.Suspense,{fallback:null,children:e.jsx(Kc,{project:o,company:s,onShowToast:t,onClose:()=>w(!1)})})}),Zt&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(Xc,{project:o,company:s,areas:j,existingCOR:Qt,onClose:()=>{We(!1),He(null)},onSaved:()=>{We(!1),He(null),fa(S=>S+1)},onShowToast:t})}),en&&va&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(Jc,{cor:va,project:o,company:s,areas:j,onClose:()=>{us(!1),ms(null)},onEdit:S=>{us(!1),ms(null),He(S),We(!0)},onShowToast:t,onStatusChange:()=>{}})}),ds==="log"&&o&&e.jsx("div",{className:"cor-log-modal-overlay",onClick:()=>we("list"),children:e.jsxs("div",{className:"cor-log-modal",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"cor-log-modal-header",children:[e.jsx("h2",{children:"Change Order Log"}),e.jsx("button",{className:"cor-log-modal-close",onClick:()=>we("list"),title:"Close",children:"✕"})]}),e.jsx("div",{className:"cor-log-modal-content",children:e.jsx(d.Suspense,{fallback:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:e.jsx(Qc,{project:o,company:s,onShowToast:t})})})]})}),an&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(to,{onClose:()=>$s(!1),saving:tn,onSave:async S=>{try{ja(!0),await L.addProjectCost(o.id,s.id,S),$s(!1),Ke(),t("Cost added successfully","success")}catch(W){console.error("Error adding cost:",W),t("Error adding cost","error")}finally{ja(!1)}}})}),nn&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(ao,{project:o,company:s,user:a,editItem:ga,onSave:()=>{hs(!1),ps(null),ln(S=>S+1),t(ga?"Equipment updated":"Equipment added","success")},onClose:()=>{hs(!1),ps(null)}})}),cn&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(so,{project:o,company:s,areas:j,corStats:h.find(S=>S.id===o?.id)?.corStats,editDrawRequest:ba,onSave:()=>{xs(!1),vs(null),dn(S=>S+1),t(ba?"Draw request updated":"Draw request created","success")},onClose:()=>{xs(!1),vs(null)}})})]})}return l.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(he,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("button",{className:"search-trigger-btn",onClick:()=>mn(!0),children:[e.jsx(Ft,{size:16}),e.jsx("span",{children:"Search"}),e.jsx("span",{className:"shortcut",children:"⌘K"})]}),e.jsxs("div",{className:"bo-project-count",children:[l.length," Active Project",l.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(Un,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:se(Wn)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:se(Bn)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:se(Hn)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Ea>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:se(Vn)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",Ma," project",Ma!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",se(Ea)]})]})]}),Pa>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:se(Kn)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",Pa," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[Oa>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:Oa}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),Ta>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Ta}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Aa>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:Aa}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),Ra>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:Ra}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),Gn&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[Fa>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:Fa}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),Ia>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Ia}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),$a>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:$a}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),Yn&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),za>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[za," under"]}),qa>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[qa," on track"]}),La>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[La," over"]})]})]})]}),Ge.allAlerts.length>0&&e.jsxs("div",{className:"smart-alerts-section",style:{marginBottom:"var(--space-lg, 1.5rem)"},children:[e.jsx("div",{className:"smart-alerts-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"var(--space-sm, 0.5rem)"},children:e.jsxs("h3",{style:{fontSize:"var(--font-size-md, 1rem)",fontWeight:"var(--font-weight-semibold, 600)",color:"var(--text-primary)",margin:0},children:["Needs Attention",Ge.criticalCount>0&&e.jsxs("span",{style:{marginLeft:"0.5rem",padding:"2px 8px",fontSize:"0.75rem",fontWeight:600,borderRadius:"9999px",background:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"},children:[Ge.criticalCount," critical"]})]})}),e.jsx(xc,{alerts:Ge.allAlerts,onAction:Sn,maxVisible:3})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[l.length," active"]})]}),e.jsx("div",{className:"project-list",children:h.map(f=>{const E=Ge.projectRisks.find(D=>D.projectId===f.id);return e.jsx(io,{project:f,riskScore:E?.riskScore,riskStatus:E?.riskStatus,onClick:()=>js(f)},f.id)})}),e.jsx(hc,{isOpen:un,onClose:hn,companyId:s?.id,onSelectProject:f=>{js(f)},onSelectTicket:f=>{const E=l.find(D=>D.id===f.project_id);E&&(js(E),$("financials"),z("tickets"))},onSelectCOR:f=>{const E=l.find(D=>D.id===f.project_id);E&&(js(E),$("financials"),z("cors"),ms(f),us(!0))},onShowToast:t})]})}function io({project:s,riskScore:a,riskStatus:r,onClick:t}){const n=ji(s.areas||[]),i=gi(s.areas||[]),l=s.contract_value-s.billable,c=s.billable>s.contract_value*.9&&s.progress<90,h={healthy:{bg:"var(--status-success-bg, #064e3b)",color:"var(--status-success, #059669)"},warning:{bg:"var(--status-warning-bg, #78350f)",color:"var(--status-warning, #d97706)"},critical:{bg:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"}},u=h[r]||h.healthy;return e.jsxs("div",{className:`project-card enhanced ${c?"at-risk":""}`,onClick:t,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[typeof a=="number"&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,background:u.bg,color:u.color},title:`Risk Score: ${a}`,"aria-label":`Risk score ${a}, ${r}`,children:a}),e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:s.name}),e.jsx("div",{className:"project-card-value",children:se(s.contract_value)})]})]}),e.jsx("span",{className:`status-badge ${n}`,children:i})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[s.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:se(s.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${l<0?"negative":""}`,children:se(Math.abs(l))}),e.jsx("span",{className:"stat-label",children:l>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${s.progress}%`}})}),(s.pendingTickets>0||s.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[s.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[s.pendingTickets," Pending T&M"]}),s.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[s.approvedTickets," Approved T&M"]})]}),s.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${s.scheduleStatus}`,children:s.scheduleLabel}),s.hasLaborData&&s.laborLabel&&e.jsx("span",{className:`labor-indicator ${s.laborStatus}`,children:s.laborLabel})]})]})}const xo=Object.freeze(Object.defineProperty({__proto__:null,default:ro},Symbol.toStringTag,{value:"Module"}));export{Xl as A,Mc as C,xo as D,ho as E,Se as T,Ze as a,po as b,mo as c};
//# sourceMappingURL=Dashboard-C4CmpGWc.js.map
