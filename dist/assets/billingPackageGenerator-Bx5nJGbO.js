import{_ as Y}from"./pdf-aQqpMATS.js";import{f as h,a as G,b as P}from"./corCalculations-vdJc_BOT.js";import{aG as H,aH as B,aU as W}from"./index-Bq3IVWxB.js";import"./icons-D1pGYcxw.js";import"./react-DXGY7bZi.js";import"./supabase-VuevzHjS.js";const U=x=>{if(!x)return"";const[d,m]=x.split(":"),u=parseInt(d),_=u>=12?"pm":"am";return`${u%12||12}:${m}${_}`};async function X({cors:x=[],tickets:d=[],invoice:m=null,project:u,company:_,branding:b={},billTo:v={}}){const{default:N}=await Y(async()=>{const{default:a}=await import("./pdf-aQqpMATS.js").then(l=>l.j);return{default:a}},[]),{default:C}=await Y(async()=>{const{default:a}=await import("./pdf-aQqpMATS.js").then(l=>l.c);return{default:a}},[]),t=new N,n=t.internal.pageSize.getWidth(),c=t.internal.pageSize.getHeight(),o=20;let e=o;const s=b.primaryColor?H(b.primaryColor):[30,58,95];if(b.logoUrl)try{const a=await B(b.logoUrl);a&&t.addImage(a,"PNG",o,e,45,17)}catch{_?.name&&(t.setFontSize(16),t.setFont("helvetica","bold"),t.setTextColor(...s),t.text(_.name,o,e+10))}else _?.name&&(t.setFontSize(16),t.setFont("helvetica","bold"),t.setTextColor(...s),t.text(_.name,o,e+10));t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(120,120,120);let z=e;_?.phone&&(t.text(_.phone,n-o,z,{align:"right"}),z+=4),_?.email&&(t.text(_.email,n-o,z,{align:"right"}),z+=4),e+=25,t.setDrawColor(...s),t.setLineWidth(1),t.line(o,e,n-o,e),e+=2,t.setLineWidth(.3),t.line(o,e,n-o,e),e+=20,t.setFontSize(24),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("CERTIFIED BILLING PACKAGE",n/2,e,{align:"center"}),e+=12,t.setFontSize(14),t.setFont("helvetica","normal"),t.setTextColor(71,85,105),t.text(u?.name||"Project",n/2,e,{align:"center"}),e+=6,u?.job_number&&(t.setFontSize(11),t.text(`Job #${u.job_number}`,n/2,e,{align:"center"})),e+=20,t.setFillColor(248,250,252),t.setDrawColor(226,232,240),t.roundedRect(o,e,n-o*2,65,3,3,"FD");const f=o+10,y=n/2+10;let r=e+12;t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("PACKAGE CONTENTS",f,r),t.setDrawColor(200,210,220),t.line(f,r+3,n-o-10,r+3),r+=12,t.setFont("helvetica","normal"),t.setTextColor(71,85,105),t.setFontSize(9),t.text("Change Orders:",f,r),t.setFont("helvetica","bold"),t.text(`${x.length}`,f+40,r),t.setFont("helvetica","normal"),t.text("T&M Tickets:",y,r),t.setFont("helvetica","bold"),t.text(`${d.length}`,y+40,r),t.setFont("helvetica","normal"),r+=7;const E=x.reduce((a,l)=>a+(l.cor_total||0),0),k=d.reduce((a,l)=>a+(parseFloat(l.change_order_value)||0)*100,0);t.text("COR Value:",f,r),t.setFont("helvetica","bold"),t.text(h(E),f+40,r),t.setFont("helvetica","normal");const $=d.reduce((a,l)=>a+(l.photos?.length||0),0);t.text("Photos:",y,r),t.setFont("helvetica","bold"),t.text(`${$}`,y+40,r),t.setFont("helvetica","normal"),r+=7;const S=d.filter(a=>a.client_signature_data);if(t.text("Client Verified:",f,r),t.setFont("helvetica","bold"),t.setTextColor(S.length>0?16:71,S.length>0?185:85,S.length>0?129:105),t.text(`${S.length} of ${d.length} tickets`,f+40,r),t.setFont("helvetica","normal"),t.setTextColor(71,85,105),r+=7,m&&(t.text("Invoice:",f,r),t.setFont("helvetica","bold"),t.text(`${m.invoice_number} — ${h(m.total||0)}`,f+40,r),t.setFont("helvetica","normal")),e+=80,v.name||m?.bill_to_name){const a=v.name||m?.bill_to_name,l=v.address||m?.bill_to_address,T=v.contact||m?.bill_to_contact;t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(120,120,120),t.text("SUBMITTED TO:",o,e),e+=6,t.setFont("helvetica","normal"),t.setTextColor(30,41,59),a&&(t.text(a,o,e),e+=5),l&&(t.text(l,o,e),e+=5),T&&(t.text(T,o,e),e+=5)}e=c-40,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(120,120,120);const R=new Date;t.text(`Generated: ${R.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})} at ${R.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`,o,e),e+=5;const O=crypto.randomUUID().substring(0,16).toUpperCase();t.text(`Document ID: ${O}`,o,e);for(const a of x){if(t.addPage(),e=o,t.setFillColor(...s),t.rect(o,e,n-o*2,14,"F"),t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(255,255,255),t.text(`${a.cor_number||"COR"} — ${a.title||"Untitled"}`,o+5,e+9),e+=20,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(71,85,105),(a.period_start||a.period_end)&&(t.text(`Period: ${G(a.period_start,a.period_end)}`,o,e),e+=5),a.scope_of_work){t.setFont("helvetica","bold"),t.text("Scope:",o,e),t.setFont("helvetica","normal");const l=t.splitTextToSize(a.scope_of_work,n-o*2-15);t.text(l,o+15,e),e+=l.length*4+5}a.change_order_labor?.length>0&&(t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("Labor",o,e),e+=4,C(t,{startY:e,head:[["Class","Wage Type","Reg Hrs","Reg Rate","OT Hrs","OT Rate","Total"]],body:a.change_order_labor.map(l=>[l.labor_class||l.description,l.wage_type||"Standard",l.regular_hours?.toString()||"0",h(l.regular_rate),l.overtime_hours?.toString()||"0",h(l.overtime_rate),h(l.total)]),margin:{left:o,right:o},headStyles:{fillColor:s,textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid"}),e=t.lastAutoTable.finalY+8),a.change_order_materials?.length>0&&(e>c-50&&(t.addPage(),e=o),t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("Materials",o,e),e+=4,C(t,{startY:e,head:[["Description","Source","Qty","Unit Cost","Total"]],body:a.change_order_materials.map(l=>[l.description,l.source_reference||"-",l.quantity?.toString()||"1",h(l.unit_cost),h(l.total)]),margin:{left:o,right:o},headStyles:{fillColor:s,textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid"}),e=t.lastAutoTable.finalY+8),a.change_order_equipment?.length>0&&(e>c-50&&(t.addPage(),e=o),t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("Equipment",o,e),e+=4,C(t,{startY:e,head:[["Description","Qty","Unit Cost","Total"]],body:a.change_order_equipment.map(l=>[l.description,l.quantity?.toString()||"1",h(l.unit_cost),h(l.total)]),margin:{left:o,right:o},headStyles:{fillColor:s,textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid"}),e=t.lastAutoTable.finalY+8),a.change_order_subcontractors?.length>0&&(e>c-50&&(t.addPage(),e=o),t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("Subcontractors",o,e),e+=4,C(t,{startY:e,head:[["Company","Description","Total"]],body:a.change_order_subcontractors.map(l=>[l.company_name||"-",l.description,h(l.total)]),margin:{left:o,right:o},headStyles:{fillColor:s,textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid"}),e=t.lastAutoTable.finalY+8),e>c-30&&(t.addPage(),e=o),t.setFillColor(...s),t.rect(o,e,n-o*2,10,"F"),t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(255,255,255),t.text("COR TOTAL:",o+5,e+7),t.text(h(a.cor_total),n-o-5,e+7,{align:"right"}),e+=15,(a.gc_signature_data||a.client_signature_data)&&(e>c-30&&(t.addPage(),e=o),t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(16,185,129),t.text("SIGNATURES",o,e),e+=5,t.setFont("helvetica","normal"),t.setFontSize(8),t.setTextColor(71,85,105),a.gc_signature_name&&(t.text(`GC: ${a.gc_signature_name} — ${P(a.gc_signature_date)}`,o,e),e+=4),a.client_signature_name&&(t.text(`Client: ${a.client_signature_name} — ${P(a.client_signature_date)}`,o,e),e+=4))}if(d.length>0){t.addPage(),e=o,t.setDrawColor(...s),t.setLineWidth(.8),t.line(o,e,n-o,e),e+=15,t.setFontSize(18),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("T&M TICKET BACKUP",n/2,e,{align:"center"}),e+=8,t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(71,85,105),t.text(`${d.length} tickets | ${$} photos | ${S.length} client verified`,n/2,e,{align:"center"}),e+=15,C(t,{startY:e,head:[["Date","CE/PCO","Workers","Hours","Photos","Verified"]],body:d.map(a=>{const l=a.t_and_m_workers||[],T=l.reduce((i,g)=>i+(parseFloat(g.hours)||0)+(parseFloat(g.overtime_hours)||0),0);return[P(a.work_date||a.ticket_date),a.ce_pco_number||"-",l.length.toString(),T.toFixed(1),(a.photos?.length||0).toString(),a.client_signature_data?"Yes":"No"]}),margin:{left:o,right:o},headStyles:{fillColor:s,textColor:[255,255,255],fontSize:8},bodyStyles:{fontSize:8},theme:"grid"});for(const a of d){t.addPage(),e=o;const l=!!a.client_signature_data,T=l?[16,185,129]:[245,158,11];if(t.setFillColor(...T),t.rect(o,e,4,18,"F"),t.setFillColor(248,250,252),t.rect(o+4,e,n-o*2-4,18,"F"),t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text(`T&M TICKET — ${P(a.work_date||a.ticket_date)}`,o+10,e+7),a.ce_pco_number&&(t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(59,130,246),t.text(`CE/PCO: ${a.ce_pco_number}`,o+10,e+14)),l&&(t.setFontSize(8),t.setFont("helvetica","bold"),t.setTextColor(16,185,129),t.text("CLIENT VERIFIED",n-o-30,e+10)),e+=24,a.notes){t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("DESCRIPTION",o,e),e+=5,t.setFont("helvetica","normal"),t.setTextColor(51,65,85);const i=t.splitTextToSize(a.notes,n-o*2);t.text(i,o,e),e+=i.length*4+6}if(a.t_and_m_workers?.length>0&&(t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("LABOR",o,e),e+=4,C(t,{startY:e,head:[["Worker","Class","Reg Hrs","OT Hrs","Time In","Time Out"]],body:a.t_and_m_workers.map(i=>[i.name,i.role||i.labor_class||"Laborer",i.hours?.toString()||"0",i.overtime_hours?.toString()||"-",U(i.time_started),U(i.time_ended)]),margin:{left:o,right:o},headStyles:{fillColor:s,textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),e=t.lastAutoTable.finalY+8),a.t_and_m_items?.length>0&&(e>c-50&&(t.addPage(),e=o),t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("MATERIALS / EQUIPMENT",o,e),e+=4,C(t,{startY:e,head:[["Item","Qty","Unit"]],body:a.t_and_m_items.map(i=>[i.custom_name||i.materials_equipment?.name||i.description||"Item",i.quantity?.toString()||"1",i.materials_equipment?.unit||i.unit||"ea"]),margin:{left:o,right:o},headStyles:{fillColor:s,textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid"}),e=t.lastAutoTable.finalY+8),a.photos?.length>0){e>c-70&&(t.addPage(),e=o),t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text(`PHOTO EVIDENCE (${a.photos.length})`,o,e),e+=6;const i=await W(a.photos);let g=o;const I=55,F=45,w=5;for(let p=0;p<a.photos.length;p++){p>0&&p%3===0&&(g=o,e+=F+w+2),e+F>c-15&&(t.addPage(),e=o,g=o);const L=i[p];L?(t.setDrawColor(200,200,200),t.rect(g-.5,e-.5,I+1,F+1,"S"),t.addImage(L,"JPEG",g,e,I,F)):(t.setFillColor(245,245,245),t.rect(g,e,I,F,"F"),t.setFontSize(7),t.setTextColor(150,150,150),t.text("Photo unavailable",g+8,e+F/2)),g+=I+w}e+=F+10}if(a.client_signature_data){e>c-35&&(t.addPage(),e=o),t.setFillColor(240,253,244),t.roundedRect(o,e,n-o*2,25,3,3,"F"),t.setFillColor(16,185,129),t.rect(o,e,4,25,"F"),t.setFontSize(8),t.setFont("helvetica","bold"),t.setTextColor(16,185,129),t.text("CLIENT VERIFIED",o+10,e+8),t.setFont("helvetica","normal"),t.setFontSize(8),t.setTextColor(71,85,105);const i=[a.client_signature_name,a.client_signature_title,a.client_signature_company].filter(Boolean).join(", ");t.text(i,o+10,e+15),a.client_signature_date&&t.text(`Signed: ${P(a.client_signature_date)}`,o+10,e+21);try{t.addImage(a.client_signature_data,"PNG",n-o-55,e+3,50,19)}catch{}}}}const D=t.internal.getNumberOfPages();for(let a=1;a<=D;a++){t.setPage(a);const l=c-8;t.setFontSize(7),t.setTextColor(150,150,150),t.text(`${u?.name||"Project"} — Billing Package`,o,l),t.setTextColor(180,180,180),t.text("Generated with FieldSync",n/2,l,{align:"center"}),t.setTextColor(150,150,150),t.text(`Page ${a} of ${D}`,n-o,l,{align:"right"})}const V=new Date().toISOString().split("T")[0],A=`Billing_Package_${u?.job_number||u?.name?.replace(/\s+/g,"_")||"export"}_${V}.pdf`;return t.save(A),{success:!0,fileName:A,pageCount:D,documentId:O,summary:{corCount:x.length,ticketCount:d.length,photoCount:$,verifiedCount:S.length,totalCORValue:E,totalTicketValue:k}}}export{X as generateBillingPackage};
//# sourceMappingURL=billingPackageGenerator-Bx5nJGbO.js.map
