import{ar as h,as as e}from"./index-BFDJUxru.js";import{r as c,aA as T,n as u,j as k,c as A,a5 as E,aw as L,p as S,q as z}from"./icons-B-oSmWeD.js";import{f as p}from"./corCalculations-D9qkkIbo.js";import"./react-DXGY7bZi.js";import"./pdf-aQqpMATS.js";import"./supabase-VuevzHjS.js";const g={pending:["draft","pending_approval"],approved:["approved","billed"],void:["rejected","closed"]},N={draft:{label:"Draft",className:"draft"},pending_approval:{label:"Pending",className:"pending"},approved:{label:"Approved",className:"approved"},rejected:{label:"Rejected",className:"rejected"},billed:{label:"Billed",className:"billed"},closed:{label:"Closed",className:"closed"}};function B({project:o,onShowToast:b,onToggleList:C,showingList:m,onViewFullLog:O,onCreateCOR:j}){const[l,w]=c.useState([]),[f,R]=c.useState(!0);c.useEffect(()=>{x();const s=h.subscribeToCORLog?.(o.id,()=>{x()});return()=>{s&&h.unsubscribe?.(s)}},[o.id]);const x=async()=>{try{const s=await h.getCORLog(o.id);w(s||[])}catch(s){console.error("Error loading COR log:",s),b?.("Error loading COR log","error")}finally{R(!1)}},v=c.useMemo(()=>{const s=l.filter(a=>g.pending.includes(a.changeOrder?.status)),t=l.filter(a=>g.approved.includes(a.changeOrder?.status)),d=l.filter(a=>g.void.includes(a.changeOrder?.status));return{pending:s,approved:t,voided:d}},[l]),r=c.useMemo(()=>{const{pending:s,approved:t,voided:d}=v;return{totalCORs:l.length,approvedCount:t.length,pendingCount:s.length,voidCount:d.length,approvedTotal:t.reduce((a,i)=>a+(i.changeOrder?.corTotal||0),0),pendingTotal:s.reduce((a,i)=>a+(i.changeOrder?.corTotal||0),0)}},[l,v]),n=c.useMemo(()=>[...l].sort((s,t)=>new Date(t.changeOrder?.createdAt||0)-new Date(s.changeOrder?.createdAt||0)),[l]);return f?e.jsx("div",{className:"cor-log-preview",children:e.jsxs("div",{className:"cor-log-preview-loading",children:[e.jsxs("div",{className:"skeleton-stats",children:[e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"})]}),e.jsx("div",{className:"skeleton-table",children:[1,2,3].map(s=>e.jsx("div",{className:"skeleton-row"},s))})]})}):e.jsxs("div",{className:"cor-log-preview",children:[e.jsxs("div",{className:"cor-log-preview-header",children:[e.jsxs("div",{className:"cor-log-preview-title",children:[e.jsx("h3",{children:"Change Order Log"}),e.jsxs("span",{className:"cor-log-preview-count",children:[r.totalCORs," total"]})]}),e.jsxs("div",{className:"cor-log-preview-actions",children:[e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:O,title:"Open full COR log with edit & export",children:[e.jsx(T,{size:14})," Edit Log"]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:j,children:[e.jsx(u,{size:14})," New COR"]})]})]}),e.jsxs("div",{className:"cor-log-preview-stats",children:[e.jsxs("div",{className:"cor-log-stat approved",children:[e.jsx("div",{className:"cor-log-stat-icon",children:e.jsx(k,{size:18})}),e.jsxs("div",{className:"cor-log-stat-content",children:[e.jsx("span",{className:"cor-log-stat-value",children:p(r.approvedTotal)}),e.jsxs("span",{className:"cor-log-stat-label",children:[r.approvedCount," Approved"]})]})]}),e.jsxs("div",{className:"cor-log-stat pending",children:[e.jsx("div",{className:"cor-log-stat-icon",children:e.jsx(A,{size:18})}),e.jsxs("div",{className:"cor-log-stat-content",children:[e.jsx("span",{className:"cor-log-stat-value",children:p(r.pendingTotal)}),e.jsxs("span",{className:"cor-log-stat-label",children:[r.pendingCount," Pending"]})]})]}),r.voidCount>0&&e.jsxs("div",{className:"cor-log-stat void",children:[e.jsx("div",{className:"cor-log-stat-icon",children:e.jsx(E,{size:18})}),e.jsxs("div",{className:"cor-log-stat-content",children:[e.jsx("span",{className:"cor-log-stat-value",children:r.voidCount}),e.jsx("span",{className:"cor-log-stat-label",children:"Void/Rejected"})]})]})]}),n.length>0?e.jsx("div",{className:"cor-log-preview-table-wrapper",children:e.jsxs("table",{className:"cor-log-preview-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"COR #"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"cor-number",children:s.changeOrder?.corNumber||"—"}),e.jsx("td",{className:"cor-title",children:s.changeOrder?.title||"Untitled"}),e.jsx("td",{className:"cor-amount",children:p(s.changeOrder?.corTotal||0)}),e.jsx("td",{children:e.jsx("span",{className:`cor-status-badge ${N[s.changeOrder?.status]?.className||""}`,children:N[s.changeOrder?.status]?.label||s.changeOrder?.status})}),e.jsx("td",{className:"cor-date",children:s.changeOrder?.createdAt?new Date(s.changeOrder.createdAt).toLocaleDateString():"—"})]},s.id))})]})}):e.jsxs("div",{className:"cor-log-preview-empty",children:[e.jsx("p",{children:"No change orders yet"}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:j,children:[e.jsx(u,{size:14})," Create First COR"]})]}),n.length>0&&e.jsxs("button",{className:"cor-log-preview-view-all",onClick:C,children:[e.jsx(L,{size:14}),e.jsxs("span",{children:[m?"Hide":"Show"," Full COR List"]}),m?e.jsx(S,{size:16}):e.jsx(z,{size:16})]})]})}export{B as default};
//# sourceMappingURL=CORLogPreview-CQ0piEPx.js.map
