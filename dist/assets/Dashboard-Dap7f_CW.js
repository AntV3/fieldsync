const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ShareModal-C-PKrnfl.js","assets/index-Da6Ug3b9.js","assets/icons-BDU0tZd_.js","assets/react-DXGY7bZi.js","assets/pdf-Dbgi5wV4.js","assets/supabase-VuevzHjS.js","assets/index-CQHYvI2m.css","assets/NotificationSettings-C_loAwgJ.js","assets/CORForm-CiCjVyfN.js","assets/corCalculations-vdJc_BOT.js","assets/CORDetail-DVQ40zw6.js","assets/SignatureCanvas-BuOv264D.js","assets/SignatureLinkGenerator-DbCgWsXC.js","assets/CORLog-D9fZDhx3.js","assets/DrawRequestModal-BBmdvEtC.js","assets/EquipmentModal-C6W5jEy1.js","assets/AddCostModal--tgfgs0E.js","assets/DocumentsTab-MjeMu28R.js","assets/CORLogPreview-DQs_HoFn.js","assets/CORList-Bk8clyeZ.js","assets/TMList-1wE0oQPI.js","assets/safeXlsx-F6PERwMH.js","assets/BillingCenter-mtpV36r1.js","assets/PhotoTimeline-BN1NfF23.js"])))=>i.map(i=>d[i]);
import{_ as de}from"./pdf-Dbgi5wV4.js";import{r as ws,c as Rt,a as Tr,S as Fr,b as Ar,u as is,s as Mr,d as Or,e as $r,f as Ir,g as Lr,h as zr,i as qr,j as Xe,k as Tt,l as Vr,m as wa,n as Br,o as Wr,p as Ur,D as Qa,q as Ft,t as Hr,v as Kr,w as Gr,x as Ca,y as Yr,z as Jr,A as Za,Z as en,L as ys,C as Xr,B as Qr,E as ze,F as ka,G as At,H as Zr,I as Qs,J as Mt,K as sn,M as tn,N as ei,O as si,P as Ot,Q as $t,R as ti,T as ai,U as an,V as _a,W as ni,X as ri,Y as ii,_ as li,$ as ci,a0 as oi,a1 as nn,a2 as di,a3 as ui,a4 as mi,a5 as hi,a6 as pi,a7 as xi,a8 as vi,a9 as ji,aa as Sa,ab as Da,ac as Ea,ad as fi,ae as gi,af as bi,ag as as,ah as yi,ai as Ni,aj as wi,ak as rn,al as ft,am as Ci,an as ki,ao as _i,ap as Si,aq as Di,ar as q,as as e,at as Zs,au as Ei,av as ln,aw as It,ax as Lt,ay as et,az as Pa,aA as Pi,aB as Ri,aC as Ti,aD as ns,aE as Fi,aF as cn,aG as bs,aH as on,aI as Ai,aJ as Mi,aK as js,aL as re,aM as Oi,aN as gt,aO as Ra,aP as $i,aQ as Ii,aR as Li,aS as zi}from"./index-Da6Ug3b9.js";import{r as o,h as dn,X as ms,af as qi,a3 as kt,C as Ve,F as os,w as xe,_ as Re,ad as Ks,T as Ae,ag as Vi,ah as gs,D as Ke,ai as un,$ as st,H as Ge,W as _t,aj as bt,ak as Bi,f as Cs,Y as hs,al as ps,q as zt,e as St,b as mn,a0 as ls,am as hn,an as Wi,ao as Ui,ap as Hi,n as Ki,aq as Gi,ar as Ws,p as Ye,u as tt,v as Qe,ac as pn,s as Ns,R as Yi,as as Ji,O as Xi,at as Qi,U as Zi,au as el,av as yt,d as Dt,L as Ta,aw as Fa,g as sl,ax as Aa,ay as Ma,az as tl,l as al,i as nl,j as rl,a as il,aA as ll}from"./icons-BDU0tZd_.js";import{f as we}from"./corCalculations-vdJc_BOT.js";function Gs(){return Gs=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},Gs.apply(null,arguments)}function Oa(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function cl(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Oa(Object(n),!0).forEach(function(a){ol(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Oa(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function ol(s,t,n){return(t=dl(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function dl(s){var t=ul(s,"string");return typeof t=="symbol"?t:t+""}function ul(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}var Ne=32,ml={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function hl(s){var{data:t,iconType:n,inactiveColor:a}=s,r=Ne/2,l=Ne/6,c=Ne/3,i=t.inactive?a:t.color,u=n??t.type;if(u==="none")return null;if(u==="plainline"){var m;return o.createElement("line",{strokeWidth:4,fill:"none",stroke:i,strokeDasharray:(m=t.payload)===null||m===void 0?void 0:m.strokeDasharray,x1:0,y1:r,x2:Ne,y2:r,className:"recharts-legend-icon"})}if(u==="line")return o.createElement("path",{strokeWidth:4,fill:"none",stroke:i,d:"M0,".concat(r,"h").concat(c,`
            A`).concat(l,",").concat(l,",0,1,1,").concat(2*c,",").concat(r,`
            H`).concat(Ne,"M").concat(2*c,",").concat(r,`
            A`).concat(l,",").concat(l,",0,1,1,").concat(c,",").concat(r),className:"recharts-legend-icon"});if(u==="rect")return o.createElement("path",{stroke:"none",fill:i,d:"M0,".concat(Ne/8,"h").concat(Ne,"v").concat(Ne*3/4,"h").concat(-Ne,"z"),className:"recharts-legend-icon"});if(o.isValidElement(t.legendIcon)){var d=cl({},t);return delete d.legendIcon,o.cloneElement(t.legendIcon,d)}return o.createElement(Ar,{fill:i,cx:r,cy:r,size:Ne,sizeType:"diameter",type:u})}function pl(s){var{payload:t,iconSize:n,layout:a,formatter:r,inactiveColor:l,iconType:c}=s,i={x:0,y:0,width:Ne,height:Ne},u={display:a==="horizontal"?"inline-block":"block",marginRight:10},m={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((d,h)=>{var x=d.formatter||r,f=Rt({"recharts-legend-item":!0,["legend-item-".concat(h)]:!0,inactive:d.inactive});if(d.type==="none")return null;var p=d.inactive?l:d.color,v=x?x(d.value,d,h):d.value;return o.createElement("li",Gs({className:f,style:u,key:"legend-item-".concat(h)},Tr(s,d,h)),o.createElement(Fr,{width:n,height:n,viewBox:i,style:m,"aria-label":"".concat(v," legend icon")},o.createElement(hl,{data:d,iconType:c,inactiveColor:l})),o.createElement("span",{className:"recharts-legend-item-text",style:{color:p}},v))})}var xl=s=>{var t=ws(s,ml),{payload:n,layout:a,align:r}=t;if(!n||!n.length)return null;var l={padding:0,margin:0,textAlign:a==="horizontal"?r:"left"};return o.createElement("ul",{className:"recharts-default-legend",style:l},o.createElement(pl,Gs({},t,{payload:n})))};function vl(){return is(Mr)}var jl=["contextPayload"];function Et(){return Et=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},Et.apply(null,arguments)}function $a(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function us(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$a(Object(n),!0).forEach(function(a){fl(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):$a(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function fl(s,t,n){return(t=gl(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function gl(s){var t=bl(s,"string");return typeof t=="symbol"?t:t+""}function bl(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function yl(s,t){if(s==null)return{};var n,a,r=Nl(s,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(s,n)&&(r[n]=s[n])}return r}function Nl(s,t){if(s==null)return{};var n={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(t.indexOf(a)!==-1)continue;n[a]=s[a]}return n}function wl(s){return s.value}function Cl(s){var{contextPayload:t}=s,n=yl(s,jl),a=Br(t,s.payloadUniqBy,wl),r=us(us({},n),{},{payload:a});return o.isValidElement(s.content)?o.cloneElement(s.content,r):typeof s.content=="function"?o.createElement(s.content,r):o.createElement(xl,r)}function kl(s,t,n,a,r,l){var{layout:c,align:i,verticalAlign:u}=t,m,d;return(!s||(s.left===void 0||s.left===null)&&(s.right===void 0||s.right===null))&&(i==="center"&&c==="vertical"?m={left:((a||0)-l.width)/2}:m=i==="right"?{right:n&&n.right||0}:{left:n&&n.left||0}),(!s||(s.top===void 0||s.top===null)&&(s.bottom===void 0||s.bottom===null))&&(u==="middle"?d={top:((r||0)-l.height)/2}:d=u==="bottom"?{bottom:n&&n.bottom||0}:{top:n&&n.top||0}),us(us({},m),d)}function _l(s){var t=Tt();return o.useEffect(()=>{t(Vr(s))},[t,s]),null}function Sl(s){var t=Tt();return o.useEffect(()=>(t(wa(s)),()=>{t(wa({width:0,height:0}))}),[t,s]),null}function Dl(s,t,n,a){return s==="vertical"&&Xe(t)?{height:t}:s==="horizontal"?{width:n||a}:null}var El={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function ks(s){var t=ws(s,El),n=vl(),a=Or(),r=$r(),{width:l,height:c,wrapperStyle:i,portal:u}=t,[m,d]=Ir([n]),h=Lr(),x=zr();if(h==null||x==null)return null;var f=h-(r?.left||0)-(r?.right||0),p=Dl(t.layout,c,l,f),v=u?i:us(us({position:"absolute",width:p?.width||l||"auto",height:p?.height||c||"auto"},kl(i,t,r,h,x,m)),i),g=u??a;if(g==null||n==null)return null;var T=o.createElement("div",{className:"recharts-legend-wrapper",style:v,ref:d},o.createElement(_l,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),!u&&o.createElement(Sl,{width:m.width,height:m.height}),o.createElement(Cl,Et({},t,p,{margin:r,chartWidth:h,chartHeight:x,contextPayload:n})));return qr.createPortal(T,g)}ks.displayName="Legend";function Ia(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function La(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ia(Object(n),!0).forEach(function(a){Pl(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Ia(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function Pl(s,t,n){return(t=Rl(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function Rl(s){var t=Tl(s,"string");return typeof t=="symbol"?t:t+""}function Tl(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Ys(){return Ys=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},Ys.apply(null,arguments)}var Fl=(s,t)=>{var n;if(o.isValidElement(s))n=o.cloneElement(s,t);else if(typeof s=="function")n=s(t);else{if(!ze(t.x1)||!ze(t.y1)||!ze(t.x2)||!ze(t.y2))return null;n=o.createElement("line",Ys({},t,{className:"recharts-reference-line-line"}))}return n},Al=(s,t,n,a,r,l)=>{var{x:c,width:i}=l,u=r.y.apply(s,{position:n});if(At(u)||t==="discard"&&!r.y.isInRange(u))return null;var m=[{x:c+i,y:u},{x:c,y:u}];return a==="left"?m.reverse():m},Ml=(s,t,n,a,r,l)=>{var{y:c,height:i}=l,u=r.x.apply(s,{position:n});if(At(u)||t==="discard"&&!r.x.isInRange(u))return null;var m=[{x:u,y:c+i},{x:u,y:c}];return a==="top"?m.reverse():m},Ol=(s,t,n,a)=>{var r=s.map(l=>a.apply(l,{position:n}));return t==="discard"&&r.some(l=>!a.isInRange(l))?null:r},$l=(s,t,n,a,r,l)=>{var{x:c,y:i,segment:u,ifOverflow:m}=l,d=ka(c),h=ka(i);return h?Al(i,m,n,r,s,t):d?Ml(c,m,n,a,s,t):u!=null&&u.length===2?Ol(u,m,n,s):null};function Il(s){var t=Tt();return o.useEffect(()=>(t(Wr(s)),()=>{t(Ur(s))})),null}function Ll(s){var{xAxisId:t,yAxisId:n,shape:a,className:r,ifOverflow:l}=s,c=Ft(),i=Hr(),u=is(_=>Kr(_,t)),m=is(_=>Gr(_,n)),d=is(_=>Ca(_,"xAxis",t,c)),h=is(_=>Ca(_,"yAxis",n,c)),x=Yr();if(!i||!x||u==null||m==null||d==null||h==null)return null;var f=Jr({x:d,y:h}),p=$l(f,x,s.position,u.orientation,m.orientation,s);if(!p)return null;var[{x:v,y:g},{x:T,y}]=p,A=l==="hidden"?"url(#".concat(i,")"):void 0,j=La(La({clipPath:A},Za(s)),{},{x1:v,y1:g,x2:T,y2:y}),F=Zr({x1:v,y1:g,x2:T,y2:y});return o.createElement(en,{zIndex:s.zIndex},o.createElement(ys,{className:Rt("recharts-reference-line",r)},Fl(a,j),o.createElement(Xr,Ys({},F,{lowerWidth:F.width,upperWidth:F.width}),o.createElement(Qr,{label:s.label}),s.children)))}var zl={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:Qa.line};function Pt(s){var t=ws(s,zl);return o.createElement(o.Fragment,null,o.createElement(Il,{yAxisId:t.yAxisId,xAxisId:t.xAxisId,ifOverflow:t.ifOverflow,x:t.x,y:t.y,segment:t.segment}),o.createElement(Ll,t))}Pt.displayName="ReferenceLine";var xn=(s,t,n)=>sn(s,"xAxis",Ot(s,t),n),vn=(s,t,n)=>tn(s,"xAxis",Ot(s,t),n),jn=(s,t,n)=>sn(s,"yAxis",$t(s,t),n),fn=(s,t,n)=>tn(s,"yAxis",$t(s,t),n),ql=Qs([Mt,xn,jn,vn,fn],(s,t,n,a,r)=>an(s,"xAxis")?_a(t,a,!1):_a(n,r,!1)),Vl=(s,t)=>t,gn=Qs([ni,Vl],(s,t)=>s.filter(n=>n.type==="area").find(n=>n.id===t)),bn=s=>{var t=Mt(s),n=an(t,"xAxis");return n?"yAxis":"xAxis"},Bl=(s,t)=>{var n=bn(s);return n==="yAxis"?$t(s,t):Ot(s,t)},Wl=(s,t,n)=>ti(s,bn(s),Bl(s,t),n),Ul=Qs([gn,Wl],(s,t)=>{var n;if(!(s==null||t==null)){var{stackId:a}=s,r=ai(s);if(!(a==null||r==null)){var l=(n=t[a])===null||n===void 0?void 0:n.stackedData,c=l?.find(i=>i.key===r);if(c!=null)return c.map(i=>[i[0],i[1]])}}}),Hl=Qs([Mt,xn,jn,vn,fn,Ul,ei,ql,gn,si],(s,t,n,a,r,l,c,i,u,m)=>{var{chartData:d,dataStartIndex:h,dataEndIndex:x}=c;if(!(u==null||s!=="horizontal"&&s!=="vertical"||t==null||n==null||a==null||r==null||a.length===0||r.length===0||i==null)){var{data:f}=u,p;if(f&&f.length>0?p=f:p=d?.slice(h,x+1),p!=null)return uc({layout:s,xAxis:t,yAxis:n,xAxisTicks:a,yAxisTicks:r,dataStartIndex:h,areaSettings:u,stackedData:l,displayedData:p,chartBaseValue:m,bandSize:i})}}),Kl=["id"],Gl=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function Je(){return Je=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s},Je.apply(null,arguments)}function yn(s,t){if(s==null)return{};var n,a,r=Yl(s,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(s,n)&&(r[n]=s[n])}return r}function Yl(s,t){if(s==null)return{};var n={};for(var a in s)if({}.hasOwnProperty.call(s,a)){if(t.indexOf(a)!==-1)continue;n[a]=s[a]}return n}function za(s,t){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,a)}return n}function cs(s){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?za(Object(n),!0).forEach(function(a){Jl(s,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):za(Object(n)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(n,a))})}return s}function Jl(s,t,n){return(t=Xl(t))in s?Object.defineProperty(s,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[t]=n,s}function Xl(s){var t=Ql(s,"string");return typeof t=="symbol"?t:t+""}function Ql(s,t){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var a=n.call(s,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Js(s,t){return s&&s!=="none"?s:t}var Zl=s=>{var{dataKey:t,name:n,stroke:a,fill:r,legendType:l,hide:c}=s;return[{inactive:c,dataKey:t,type:l,color:Js(a,r),value:nn(n,t),payload:s}]},ec=o.memo(s=>{var{dataKey:t,data:n,stroke:a,strokeWidth:r,fill:l,name:c,hide:i,unit:u,tooltipType:m,id:d}=s,h={dataDefinedOnItem:n,positions:void 0,settings:{stroke:a,strokeWidth:r,fill:l,dataKey:t,nameKey:void 0,name:nn(c,t),hide:i,type:m,color:Js(a,l),unit:u,graphicalItemId:d}};return o.createElement(di,{tooltipEntrySettings:h})});function sc(s){var{clipPathId:t,points:n,props:a}=s,{needClip:r,dot:l,dataKey:c}=a,i=rn(a);return o.createElement(Ci,{points:n,dot:l,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:c,baseProps:i,needClip:r,clipPathId:t})}function tc(s){var{showLabels:t,children:n,points:a}=s,r=a.map(l=>{var c,i,u={x:(c=l.x)!==null&&c!==void 0?c:0,y:(i=l.y)!==null&&i!==void 0?i:0,width:0,lowerWidth:0,upperWidth:0,height:0};return cs(cs({},u),{},{value:l.value,payload:l.payload,parentViewBox:void 0,viewBox:u,fill:void 0})});return o.createElement(wi,{value:t?r:void 0},n)}function qa(s){var{points:t,baseLine:n,needClip:a,clipPathId:r,props:l}=s,{layout:c,type:i,stroke:u,connectNulls:m,isRange:d}=l,{id:h}=l,x=yn(l,Kl),f=rn(x),p=Za(x);return o.createElement(o.Fragment,null,t?.length>1&&o.createElement(ys,{clipPath:a?"url(#clipPath-".concat(r,")"):void 0},o.createElement(ft,Je({},p,{id:h,points:t,connectNulls:m,type:i,baseLine:n,layout:c,stroke:"none",className:"recharts-area-area"})),u!=="none"&&o.createElement(ft,Je({},f,{className:"recharts-area-curve",layout:c,type:i,connectNulls:m,fill:"none",points:t})),u!=="none"&&d&&o.createElement(ft,Je({},f,{className:"recharts-area-curve",layout:c,type:i,connectNulls:m,fill:"none",points:n}))),o.createElement(sc,{points:t,props:x,clipPathId:r}))}function ac(s){var t,n,{alpha:a,baseLine:r,points:l,strokeWidth:c}=s,i=(t=l[0])===null||t===void 0?void 0:t.y,u=(n=l[l.length-1])===null||n===void 0?void 0:n.y;if(!ze(i)||!ze(u))return null;var m=a*Math.abs(i-u),d=Math.max(...l.map(h=>h.x||0));return Xe(r)?d=Math.max(r,d):r&&Array.isArray(r)&&r.length&&(d=Math.max(...r.map(h=>h.x||0),d)),Xe(d)?o.createElement("rect",{x:0,y:i<u?i:i-m,width:d+(c?parseInt("".concat(c),10):1),height:Math.floor(m)}):null}function nc(s){var t,n,{alpha:a,baseLine:r,points:l,strokeWidth:c}=s,i=(t=l[0])===null||t===void 0?void 0:t.x,u=(n=l[l.length-1])===null||n===void 0?void 0:n.x;if(!ze(i)||!ze(u))return null;var m=a*Math.abs(i-u),d=Math.max(...l.map(h=>h.y||0));return Xe(r)?d=Math.max(r,d):r&&Array.isArray(r)&&r.length&&(d=Math.max(...r.map(h=>h.y||0),d)),Xe(d)?o.createElement("rect",{x:i<u?i:i-m,y:0,width:m,height:Math.floor(d+(c?parseInt("".concat(c),10):1))}):null}function rc(s){var{alpha:t,layout:n,points:a,baseLine:r,strokeWidth:l}=s;return n==="vertical"?o.createElement(ac,{alpha:t,points:a,baseLine:r,strokeWidth:l}):o.createElement(nc,{alpha:t,points:a,baseLine:r,strokeWidth:l})}function ic(s){var{needClip:t,clipPathId:n,props:a,previousPointsRef:r,previousBaselineRef:l}=s,{points:c,baseLine:i,isAnimationActive:u,animationBegin:m,animationDuration:d,animationEasing:h,onAnimationStart:x,onAnimationEnd:f}=a,p=o.useMemo(()=>({points:c,baseLine:i}),[c,i]),v=fi(p,"recharts-area-"),g=gi(),[T,y]=o.useState(!1),A=!T,j=o.useCallback(()=>{typeof f=="function"&&f(),y(!1)},[f]),F=o.useCallback(()=>{typeof x=="function"&&x(),y(!0)},[x]);if(g==null)return null;var _=r.current,L=l.current;return o.createElement(tc,{showLabels:A,points:c},a.children,o.createElement(bi,{animationId:v,begin:m,duration:d,isActive:u,easing:h,onAnimationEnd:j,onAnimationStart:F,key:v},S=>{if(_){var D=_.length/c.length,b=S===1?c:c.map((M,V)=>{var P=Math.floor(V*D);if(_[P]){var W=_[P];return cs(cs({},M),{},{x:as(W.x,M.x,S),y:as(W.y,M.y,S)})}return M}),I;return Xe(i)?I=as(L,i,S):yi(i)||At(i)?I=as(L,0,S):I=i.map((M,V)=>{var P=Math.floor(V*D);if(Array.isArray(L)&&L[P]){var W=L[P];return cs(cs({},M),{},{x:as(W.x,M.x,S),y:as(W.y,M.y,S)})}return M}),S>0&&(r.current=b,l.current=I),o.createElement(qa,{points:b,baseLine:I,needClip:t,clipPathId:n,props:a})}return S>0&&(r.current=c,l.current=i),o.createElement(ys,null,u&&o.createElement("defs",null,o.createElement("clipPath",{id:"animationClipPath-".concat(n)},o.createElement(rc,{alpha:S,points:c,baseLine:i,layout:g,strokeWidth:a.strokeWidth}))),o.createElement(ys,{clipPath:"url(#animationClipPath-".concat(n,")")},o.createElement(qa,{points:c,baseLine:i,needClip:t,clipPathId:n,props:a})))}),o.createElement(Ni,{label:a.label}))}function lc(s){var{needClip:t,clipPathId:n,props:a}=s,r=o.useRef(null),l=o.useRef();return o.createElement(ic,{needClip:t,clipPathId:n,props:a,previousPointsRef:r,previousBaselineRef:l})}class cc extends o.PureComponent{render(){var{hide:t,dot:n,points:a,className:r,top:l,left:c,needClip:i,xAxisId:u,yAxisId:m,width:d,height:h,id:x,baseLine:f,zIndex:p}=this.props;if(t)return null;var v=Rt("recharts-area",r),g=x,{r:T,strokeWidth:y}=xi(n),A=vi(n),j=T*2+y,F=i?"url(#clipPath-".concat(A?"":"dots-").concat(g,")"):void 0;return o.createElement(en,{zIndex:p},o.createElement(ys,{className:v},i&&o.createElement("defs",null,o.createElement(ji,{clipPathId:g,xAxisId:u,yAxisId:m}),!A&&o.createElement("clipPath",{id:"clipPath-dots-".concat(g)},o.createElement("rect",{x:c-j/2,y:l-j/2,width:d+j,height:h+j}))),o.createElement(lc,{needClip:i,clipPathId:g,props:this.props})),o.createElement(Sa,{points:a,mainColor:Js(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:F}),this.props.isRange&&Array.isArray(f)&&o.createElement(Sa,{points:f,mainColor:Js(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:F}))}}var Nn={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:Qa.area};function oc(s){var t,n=ws(s,Nn),{activeDot:a,animationBegin:r,animationDuration:l,animationEasing:c,connectNulls:i,dot:u,fill:m,fillOpacity:d,hide:h,isAnimationActive:x,legendType:f,stroke:p,xAxisId:v,yAxisId:g}=n,T=yn(n,Gl),y=ui(),A=mi(),{needClip:j}=hi(v,g),F=Ft(),{points:_,isRange:L,baseLine:S}=(t=is(P=>Hl(P,s.id,F)))!==null&&t!==void 0?t:{},D=pi();if(y!=="horizontal"&&y!=="vertical"||D==null||A!=="AreaChart"&&A!=="ComposedChart")return null;var{height:b,width:I,x:M,y:V}=D;return!_||!_.length?null:o.createElement(cc,Je({},T,{activeDot:a,animationBegin:r,animationDuration:l,animationEasing:c,baseLine:S,connectNulls:i,dot:u,fill:m,fillOpacity:d,height:b,hide:h,layout:y,isAnimationActive:x==="auto"?!ki.isSsr:x,isRange:L,legendType:f,needClip:j,points:_,stroke:p,width:I,left:M,top:V,xAxisId:v,yAxisId:g}))}var dc=(s,t,n,a,r)=>{var l=n??t;if(Xe(l))return l;var c=s==="horizontal"?r:a,i=c.scale.domain();if(c.type==="number"){var u=Math.max(i[0],i[1]),m=Math.min(i[0],i[1]);return l==="dataMin"?m:l==="dataMax"||u<0?u:Math.max(Math.min(i[0],i[1]),0)}return l==="dataMin"?i[0]:l==="dataMax"?i[1]:i[0]};function uc(s){var{areaSettings:{connectNulls:t,baseValue:n,dataKey:a},stackedData:r,layout:l,chartBaseValue:c,xAxis:i,yAxis:u,displayedData:m,dataStartIndex:d,xAxisTicks:h,yAxisTicks:x,bandSize:f}=s,p=r&&r.length,v=dc(l,c,n,i,u),g=l==="horizontal",T=!1,y=m.map((j,F)=>{var _,L,S;if(p)S=r[d+F];else{var D=Da(j,a);Array.isArray(D)?(S=D,T=!0):S=[v,D]}var b=(_=(L=S)===null||L===void 0?void 0:L[1])!==null&&_!==void 0?_:null,I=b==null||p&&!t&&Da(j,a)==null;return g?{x:Ea({axis:i,ticks:h,bandSize:f,entry:j,index:F}),y:I?null:u.scale(b),value:S,payload:j}:{x:I?null:i.scale(b),y:Ea({axis:u,ticks:x,bandSize:f,entry:j,index:F}),value:S,payload:j}}),A;return p||T?A=y.map(j=>{var F=Array.isArray(j.value)?j.value[0]:null;return g?{x:j.x,y:F!=null&&j.y!=null?u.scale(F):null,payload:j.payload}:{x:F!=null?i.scale(F):null,y:j.y,payload:j.payload}}):A=g?u.scale(v):i.scale(v),{points:y,baseLine:A,isRange:T}}function mc(s){var t=ws(s,Nn),n=Ft();return o.createElement(ii,{id:t.id,type:"area"},a=>o.createElement(o.Fragment,null,o.createElement(li,{legendPayload:Zl(t)}),o.createElement(ec,{dataKey:t.dataKey,data:t.data,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,unit:t.unit,tooltipType:t.tooltipType,id:a}),o.createElement(ci,{type:"area",id:a,data:t.data,dataKey:t.dataKey,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,stackId:oi(t.stackId),hide:t.hide,barSize:void 0,baseValue:t.baseValue,isPanorama:n,connectNulls:t.connectNulls}),o.createElement(oc,Je({},t,{id:a}))))}var Us=o.memo(mc,ri);Us.displayName="Area";var hc=["axis"],pc=o.forwardRef((s,t)=>o.createElement(_i,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:hc,tooltipPayloadSearcher:Si,categoricalChartProps:s,ref:t}));const Va={WARNING:"warning",ERROR:"error"},Ce={DATABASE:"database",NETWORK:"network",AUTH:"auth",VALIDATION:"validation",STORAGE:"storage",SYNC:"sync",GENERAL:"general"};function xc(s){const t=s?.message?.toLowerCase()||"",n=s?.code?.toLowerCase()||"";return t.includes("fetch")||t.includes("network")||t.includes("offline")?Ce.NETWORK:t.includes("auth")||t.includes("unauthorized")||n.includes("auth")?Ce.AUTH:t.includes("storage")||t.includes("bucket")||t.includes("upload")?Ce.STORAGE:t.includes("validation")||t.includes("invalid")||t.includes("required")?Ce.VALIDATION:t.includes("sync")||t.includes("conflict")?Ce.SYNC:s?.code||t.includes("database")||t.includes("supabase")?Ce.DATABASE:Ce.GENERAL}function vc(s,t,n){return n?.userMessage?n.userMessage:t===Ce.NETWORK?"Network connection issue. Your changes will sync when back online.":t===Ce.AUTH?"Session expired. Please sign in again.":t===Ce.STORAGE?"Failed to upload file. Please try again.":t===Ce.VALIDATION?s?.message||"Please check your input and try again.":t===Ce.SYNC?"Sync conflict detected. Please refresh and try again.":n?.operation?`Failed to ${n.operation.replace(/([A-Z])/g," $1").toLowerCase().trim()}. Please try again.`:"Something went wrong. Please try again."}function jc(s,t={}){const{operation:n="unknown",category:a=xc(s),severity:r=Va.ERROR,showToast:l,userMessage:c,companyId:i,projectId:u,userId:m,silent:d=!1,rethrow:h=!1}=t;if(Di.error(a,{message:s?.message||"Unknown error",code:s?.code,severity:r,operation:n,company_id:i,project_id:u,user_id:m,extra:{stack:s?.stack,name:s?.name}}),!d&&l){const x=vc(s,a,{operation:n,userMessage:c}),f=r===Va.WARNING?"warning":"error";l(x,f)}if(h)throw s;return null}async function ye(s,t={}){const{fallback:n=null,context:a={},showToast:r,silent:l=!0}=t;try{return await s()}catch(c){return jc(c,{...a,showToast:r,silent:l}),n}}const xs={budget:{healthy:.6,warning:.75,critical:.85},schedule:{healthy:.05,warning:.15,critical:.25},corExposure:{healthy:.05,warning:.15,critical:.25},activity:{healthy:1,warning:3,critical:5},safety:{healthy:0,warning:1,critical:2}},fc={budget:.3,schedule:.25,corExposure:.2,activity:.15,safety:.1};function _s(s,t){if(s<=t.healthy)return 0;if(s>=t.critical)return 100;const n=t.critical-t.healthy;return(s-t.healthy)/n*100}function Ss(s){return s<=25?"healthy":s<=60?"warning":"critical"}function gc(s,t,n=xs.budget){if(!t||t<=0)return{score:0,status:"healthy",ratio:0,label:"No revenue yet"};const a=s/t,r=_s(a,n),l=Ss(r);let c;return a<n.healthy?c=`Costs at ${(a*100).toFixed(0)}% of revenue`:a<n.warning?c=`Costs at ${(a*100).toFixed(0)}% - monitor closely`:c=`Costs at ${(a*100).toFixed(0)}% - review immediately`,{score:r,status:l,ratio:a,label:c}}function bc(s,t,n=xs.schedule){if(!t||t<=0)return{score:0,status:"healthy",variance:0,label:"No schedule baseline"};const a=(t-s)/t,r=Math.max(0,a),l=_s(r,n),c=Ss(l);let i;return a<=0?i=s>=100?"Complete":"On or ahead of schedule":a<n.warning?i=`${(a*100).toFixed(0)}% behind schedule`:i=`${(a*100).toFixed(0)}% behind - needs attention`,{score:l,status:c,variance:a,label:i}}function yc(s,t,n=xs.corExposure){if(!t||t<=0)return{score:0,status:"healthy",exposure:0,label:"No contract value"};const a=s/t,r=_s(a,n),l=Ss(r);let c;return a<n.healthy?c=s>0?`$${Nt(s)} pending`:"No pending CORs":a<n.warning?c=`$${Nt(s)} pending (${(a*100).toFixed(0)}% of contract)`:c=`High exposure: $${Nt(s)} (${(a*100).toFixed(0)}%)`,{score:r,status:l,exposure:a,label:c}}function Nc(s,t=xs.activity){if(!s)return{score:100,status:"critical",daysSince:null,label:"No reports filed"};const n=new Date(s),r=Math.floor((new Date-n)/(1e3*60*60*24)),l=_s(r,t),c=Ss(l);let i;return r===0?i="Report filed today":r===1?i="Report filed yesterday":r<=t.warning?i=`Last report ${r} days ago`:i=`No report in ${r} days - may be stalled`,{score:l,status:c,daysSince:r,label:i}}function wc(s,t=xs.safety){const n=s||0,a=_s(n,t),r=Ss(a);let l;return n===0?l="No incidents":n===1?l="1 incident in last 30 days":l=`${n} incidents - safety review needed`,{score:a,status:r,count:n,label:l}}function Cc(s,t={}){const n={...xs,...t.thresholds},a={...fc,...t.weights},r=gc(s.totalCosts,s.earnedRevenue,n.budget),l=bc(s.actualProgress,s.expectedProgress,n.schedule),c=yc(s.pendingCORValue,s.contractValue,n.corExposure),i=Nc(s.lastReportDate,n.activity),u=wc(s.recentInjuryCount,n.safety),m=Math.round(r.score*a.budget+l.score*a.schedule+c.score*a.corExposure+i.score*a.activity+u.score*a.safety);let d;m<=25?d="healthy":m<=60?d="warning":d="critical";let h;return d==="healthy"?h="Project is on track":d==="warning"?h="Some factors need attention":h="Immediate review recommended",{score:m,status:d,label:h,factors:{budget:{...r,weight:a.budget},schedule:{...l,weight:a.schedule},corExposure:{...c,weight:a.corExposure},activity:{...i,weight:a.activity},safety:{...u,weight:a.safety}}}}function kc(s,t){const n=[],{factors:a}=s;a.budget.status==="critical"&&n.push({type:"critical",title:"Budget Alert",description:a.budget.label,action:"Review costs immediately",actionTarget:"financials",projectId:t.id}),a.activity.status==="critical"&&n.push({type:"critical",title:"Activity Alert",description:a.activity.label,action:"Check project status",actionTarget:"overview",projectId:t.id}),a.safety.status==="critical"&&n.push({type:"critical",title:"Safety Alert",description:a.safety.label,action:"Review safety reports",actionTarget:"reports",projectId:t.id}),a.budget.status==="warning"&&n.push({type:"warning",title:"Budget Watch",description:a.budget.label,action:"Monitor costs",actionTarget:"financials",projectId:t.id}),(a.schedule.status==="critical"||a.schedule.status==="warning")&&n.push({type:a.schedule.status==="critical"?"critical":"warning",title:"Schedule Alert",description:a.schedule.label,action:"Review progress",actionTarget:"overview",projectId:t.id}),(a.corExposure.status==="warning"||a.corExposure.status==="critical")&&n.push({type:a.corExposure.status==="critical"?"critical":"warning",title:"COR Exposure",description:a.corExposure.label,action:"Review pending CORs",actionTarget:"cors",projectId:t.id}),a.activity.status==="warning"&&n.push({type:"info",title:"Activity Notice",description:a.activity.label,action:"File daily report",actionTarget:"reports",projectId:t.id});const r={critical:0,warning:1,info:2};return n.sort((l,c)=>r[l.type]-r[c.type]),n}function _c(s){const{actualProgress:t,totalCosts:n,earnedRevenue:a,contractValue:r}=s;if(!t||t<=0)return{estimatedCompletionCost:null,estimatedFinalMargin:null,estimatedCompletionDate:null};const l=n/t,c=Math.round(l*100),i=r>0?(r-c)/r*100:0;let u=null;if(s.startDate&&t>0&&t<100){const m=new Date(s.startDate),d=new Date,h=Math.max(1,(d-m)/(1e3*60*60*24)),x=t/h,p=(100-t)/x;u=new Date(d.getTime()+p*24*60*60*1e3)}return{estimatedCompletionCost:c,estimatedFinalMargin:i,estimatedCompletionDate:u,costPerPercent:l}}function Nt(s){return s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toFixed(0)}function Sc(s){const t=o.useMemo(()=>{const l=s.reduce((f,p)=>f+(p.contract_value||0),0),c=s.reduce((f,p)=>f+(p.changeOrderValue||0),0),i=l+c,u=s.reduce((f,p)=>f+(p.billable||0),0),m=i-u,d=i>0?Math.round(u/i*100):0,h=s.reduce((f,p)=>f+(p.corPendingValue||0),0),x=s.reduce((f,p)=>f+(p.corPendingCount||0),0);return{totalOriginalContract:l,totalChangeOrders:c,totalPortfolioValue:i,totalEarned:u,totalRemaining:m,weightedCompletion:d,totalPendingCORValue:h,totalPendingCORCount:x}},[s]),n=o.useMemo(()=>{let l=0,c=0,i=0,u=0,m=0;for(const d of s){const h=d.revisedContractValue||d.contract_value;d.progress>=100&&l++,d.progress<100&&d.billable<=h*(d.progress/100)*1.1&&c++,d.billable>h*.9&&d.progress<90&&i++,d.billable>h&&u++,(d.changeOrderValue||0)>0&&m++}return{projectsComplete:l,projectsOnTrack:c,projectsAtRisk:i,projectsOverBudget:u,projectsWithChangeOrders:m}},[s]),a=o.useMemo(()=>{let l=0,c=0,i=0,u=0,m=0,d=0;for(const h of s)h.hasScheduleData&&(h.scheduleStatus==="ahead"?l++:h.scheduleStatus==="behind"?i++:c++),h.hasLaborData&&(h.laborStatus==="over"?u++:h.laborStatus==="under"?m++:d++);return{scheduleAhead:l,scheduleOnTrack:c,scheduleBehind:i,laborOver:u,laborUnder:m,laborOnTrack:d,hasAnyScheduleData:l+c+i>0,hasAnyLaborData:u+m+d>0}},[s]),r=o.useMemo(()=>{const l=s.map(i=>{const u={id:i.id,name:i.name,totalCosts:i.totalCosts||0,earnedRevenue:i.billable||0,actualProgress:i.progress||0,expectedProgress:i.expectedProgress||i.progress,pendingCORValue:i.corPendingValue||0,contractValue:i.revisedContractValue||i.contract_value||0,lastReportDate:i.lastDailyReport,recentInjuryCount:i.recentInjuryCount||0,startDate:i.start_date},m=Cc(u),d=kc(m,{...u,name:i.name}),h=_c(u),x=d.map(f=>({...f,projectName:i.name,projectId:i.id}));return{projectId:i.id,projectName:i.name,riskScore:m.score,riskStatus:m.status,riskLabel:m.label,factors:m.factors,alerts:x,projections:h}}),c=l.flatMap(i=>i.alerts).sort((i,u)=>{const m={critical:0,warning:1,info:2};return m[i.type]-m[u.type]});return{projectRisks:l,allAlerts:c,criticalCount:c.filter(i=>i.type==="critical").length,warningCount:c.filter(i=>i.type==="warning").length}},[s]);return{portfolioMetrics:t,projectHealth:n,scheduleMetrics:a,riskAnalysis:r}}function Dc({selectedProject:s,areas:t,company:n,onShowToast:a,loadAreas:r,setSelectedProject:l}){const[c,i]=o.useState(!1),[u,m]=o.useState(null),[d,h]=o.useState(!1);return{editMode:c,editData:u,saving:d,handleEditClick:()=>{m({name:s.name,job_number:s.job_number||"",address:s.address||"",general_contractor:s.general_contractor||"",client_contact:s.client_contact||"",client_phone:s.client_phone||"",contract_value:s.contract_value,work_type:s.work_type||"demolition",job_type:s.job_type||"standard",pin:s.pin||"",default_dump_site_id:s.default_dump_site_id||"",areas:t.map(j=>({id:j.id,name:j.name,weight:j.weight,isNew:!1}))}),i(!0)},handleCancelEdit:()=>{i(!1),m(null)},handleEditChange:(j,F)=>{m(_=>({..._,[j]:F}))},handleAreaEditChange:(j,F,_)=>{m(L=>({...L,areas:L.areas.map((S,D)=>D===j?{...S,[F]:_}:S)}))},handleAddArea:()=>{m(j=>({...j,areas:[...j.areas,{id:null,name:"",weight:"",isNew:!0}]}))},handleRemoveArea:j=>{u.areas.length>1&&m(F=>({...F,areas:F.areas.filter((_,L)=>L!==j)}))},handleSaveEdit:async()=>{if(!u.name.trim()){a("Please enter a project name","error");return}const j=parseFloat(u.contract_value);if(!j||j<=0){a("Please enter a valid contract value","error");return}if(u.pin&&u.pin.length!==4){a("PIN must be 4 digits","error");return}if(u.pin&&u.pin!==s.pin&&!await q.isPinAvailable(u.pin,s.id)){a("This PIN is already in use","error");return}const F=u.areas.filter(L=>L.name.trim()&&parseFloat(L.weight)>0);if(F.length===0){a("Please add at least one area","error");return}if(F.reduce((L,S)=>L+parseFloat(S.weight),0)!==100){a("Area weights must total 100%","error");return}h(!0);try{await q.updateProject(s.id,{name:u.name.trim(),job_number:u.job_number?.trim()||null,address:u.address?.trim()||null,general_contractor:u.general_contractor?.trim()||null,client_contact:u.client_contact?.trim()||null,client_phone:u.client_phone?.trim()||null,contract_value:j,work_type:u.work_type||"demolition",job_type:u.job_type||"standard",pin:u.pin||null,default_dump_site_id:u.default_dump_site_id||null},n?.id);const L=t.map(b=>b.id),S=u.areas.filter(b=>b.id).map(b=>b.id);for(const b of L)S.includes(b)||await q.deleteArea(b);for(let b=0;b<F.length;b++){const I=F[b];I.id?await q.updateArea(I.id,{name:I.name.trim(),weight:parseFloat(I.weight),sort_order:b}):await q.createArea({project_id:s.id,name:I.name.trim(),weight:parseFloat(I.weight),status:"not_started",sort_order:b})}const D=await q.getProject(s.id);l(D),await r(s.id),i(!1),m(null),a("Project updated!","success")}catch(L){console.error("Error saving project:",L?.message||L),a(L?.message||"Error saving changes","error")}finally{h(!1)}},handleDeleteProject:async j=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await q.deleteProject(s.id,n?.id),l(null),a("Project deleted","success"),typeof j=="function"&&j()}catch(F){console.error("Error deleting project:",F),a(F?.message||"Error deleting project","error")}}}}const at=()=>de(()=>import("./pdf-Dbgi5wV4.js").then(s=>s.j),[]),ce=210,B=14,Pe=ce-B*2,ds=s=>s?new Date(s+(s.includes("T")?"":"T12:00:00")).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"—",Me=(s,t,n=30)=>t+n>s.internal.pageSize.height-20?(s.addPage(),20):t;async function Ec(s,t){const a=(await at()).default,r=new a;let l=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Daily Reports",ce/2,l,{align:"center"}),l+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${t.name}`,ce/2,l,{align:"center"}),l+=6,r.text(`${s.length} report${s.length!==1?"s":""}`,ce/2,l,{align:"center"}),l+=12,s.forEach((i,u)=>{l=Me(r,l,60),r.setDrawColor(200,200,200),r.setFillColor(245,247,250),r.roundedRect(B,l-2,Pe,10,2,2,"F"),r.setFontSize(11),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(`${ds(i.report_date)}`,B+4,l+5);const m=i.status==="submitted"?"Submitted":"Draft";r.setFontSize(9),r.setFont(void 0,"normal"),r.text(m,ce-B-4,l+5,{align:"right"}),l+=14,r.setTextColor(0,0,0),r.setFontSize(9);const d=[`Crew: ${i.crew_count||0}`,`Tasks: ${i.tasks_completed||0}/${i.tasks_total||0}`,`T&M Tickets: ${i.tm_tickets_count||0}`,`Photos: ${i.photos_count||0}`];if(r.text(d.join("    |    "),B+4,l),l+=7,i.crew_list?.length>0){r.setFont(void 0,"bold"),r.text("Crew:",B+4,l),r.setFont(void 0,"normal");const h=i.crew_list.map(f=>`${f.name} (${f.role||"Laborer"})`).join(", "),x=r.splitTextToSize(h,Pe-8);l+=4,r.text(x,B+4,l),l+=x.length*4+2}if(i.field_notes){l=Me(r,l,15),r.setFont(void 0,"bold"),r.text("Field Notes:",B+4,l),r.setFont(void 0,"normal"),l+=4;const h=r.splitTextToSize(i.field_notes,Pe-8);r.text(h,B+4,l),l+=h.length*4+2}if(i.issues){l=Me(r,l,15),r.setFont(void 0,"bold"),r.text("Issues:",B+4,l),r.setFont(void 0,"normal"),l+=4;const h=r.splitTextToSize(i.issues,Pe-8);r.text(h,B+4,l),l+=h.length*4+2}l+=8,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(B,l,ce-B,l),l+=6)});const c=`${t.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;r.save(c)}async function Pc(s,t){const a=(await at()).default,r=new a;let l=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Incident / Injury Reports",ce/2,l,{align:"center"}),l+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${t.name}`,ce/2,l,{align:"center"}),l+=6,r.text(`${s.length} report${s.length!==1?"s":""}`,ce/2,l,{align:"center"}),l+=12,s.forEach((i,u)=>{l=Me(r,l,50);const d={minor:[34,197,94],serious:[245,158,11],critical:[239,68,68],near_miss:[59,130,246]}[i.injury_type]||[128,128,128];r.setFillColor(...d),r.roundedRect(B,l-2,3,14,1,1,"F"),r.setFontSize(11),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(`${ds(i.incident_date)}`,B+8,l+4),r.setFontSize(9);const h=(i.injury_type||"").replace("_"," ").toUpperCase();if(r.text(h,B+8,l+10),r.setFont(void 0,"normal"),r.text(i.status==="open"?"OPEN":"CLOSED",ce-B-4,l+4,{align:"right"}),l+=16,r.setTextColor(0,0,0),i.description){r.setFontSize(9),r.setFont(void 0,"bold"),r.text("Description:",B+4,l),r.setFont(void 0,"normal"),l+=4;const x=r.splitTextToSize(i.description,Pe-8);r.text(x,B+4,l),l+=x.length*4+2}i.location&&(r.setFont(void 0,"bold"),r.text("Location: ",B+4,l),r.setFont(void 0,"normal"),r.text(i.location,B+30,l),l+=6),l+=6,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(B,l,ce-B,l),l+=6)});const c=`${t.name}_Incident_Reports_${new Date().toISOString().split("T")[0]}.pdf`;r.save(c)}async function Rc(s,t){const a=(await at()).default,r=new a;let l=20;r.setFontSize(18),r.setFont(void 0,"bold"),r.text("Crew Check-In History",ce/2,l,{align:"center"}),l+=8,r.setFontSize(11),r.setFont(void 0,"normal"),r.text(`Project: ${t.name}`,ce/2,l,{align:"center"}),l+=6,r.text(`${s.length} check-in${s.length!==1?"s":""}`,ce/2,l,{align:"center"}),l+=12,s.forEach((i,u)=>{l=Me(r,l,30);const m=i.workers||[];r.setFillColor(245,247,250),r.roundedRect(B,l-2,Pe,9,2,2,"F"),r.setFontSize(10),r.setFont(void 0,"bold"),r.setTextColor(30,30,30),r.text(ds(i.check_in_date),B+4,l+4),r.setFont(void 0,"normal"),r.text(`${m.length} workers`,ce-B-4,l+4,{align:"right"}),l+=12,r.setTextColor(0,0,0),r.setFontSize(9),m.length>0&&(r.setFont(void 0,"bold"),r.text("Name",B+4,l),r.text("Role",110,l),l+=5,r.setFont(void 0,"normal"),m.forEach(d=>{l=Me(r,l,6),r.text(d.name||"—",B+4,l),r.text(d.role||"Laborer",110,l),l+=4.5})),l+=6,u<s.length-1&&(r.setDrawColor(220,220,220),r.line(B,l,ce-B,l),l+=5)});const c=`${t.name}_Crew_Checkins_${new Date().toISOString().split("T")[0]}.pdf`;r.save(c)}async function Tc({dailyReports:s=[],incidentReports:t=[],crewCheckins:n=[],project:a}){const l=(await at()).default,c=new l;let i=20;c.setFontSize(22),c.setFont(void 0,"bold"),c.text("Field Documents Report",ce/2,i,{align:"center"}),i+=10,c.setFontSize(13),c.setFont(void 0,"normal"),c.text(`Project: ${a.name}`,ce/2,i,{align:"center"}),i+=8,c.setFontSize(10),c.text(`Generated: ${new Date().toLocaleDateString()}`,ce/2,i,{align:"center"}),i+=16,c.setFontSize(11),c.setFont(void 0,"bold"),c.text("Document Summary",B,i),i+=8,c.setFontSize(10),c.setFont(void 0,"normal"),[["Daily Reports",`${s.length}`],["Incident Reports",`${t.length}`],["Crew Check-Ins",`${n.length}`]].forEach(([d,h])=>{c.text(d,B+4,i),c.text(h,100,i),i+=6}),s.length>0&&(c.addPage(),i=20,c.setFontSize(16),c.setFont(void 0,"bold"),c.text("Daily Reports",B,i),i+=10,s.forEach((d,h)=>{if(i=Me(c,i,40),c.setFontSize(10),c.setFont(void 0,"bold"),c.setTextColor(30,30,30),c.text(ds(d.report_date),B+2,i),c.setFont(void 0,"normal"),c.setFontSize(8),c.text(`Crew: ${d.crew_count||0} | Tasks: ${d.tasks_completed||0}/${d.tasks_total||0} | T&M: ${d.tm_tickets_count||0}`,B+60,i),i+=6,c.setTextColor(0,0,0),c.setFontSize(9),d.field_notes){const x=c.splitTextToSize(d.field_notes,Pe-4);c.text(x,B+2,i),i+=x.length*4+2}if(d.issues){c.setFont(void 0,"bold"),c.text("Issues: ",B+2,i),c.setFont(void 0,"normal");const x=c.splitTextToSize(d.issues,Pe-20);c.text(x,B+20,i),i+=x.length*4+2}i+=4,h<s.length-1&&(c.setDrawColor(220,220,220),c.line(B,i,ce-B,i),i+=4)})),t.length>0&&(c.addPage(),i=20,c.setFontSize(16),c.setFont(void 0,"bold"),c.text("Incident / Injury Reports",B,i),i+=10,t.forEach((d,h)=>{i=Me(c,i,35),c.setFontSize(10),c.setFont(void 0,"bold"),c.setTextColor(30,30,30),c.text(ds(d.incident_date),B+2,i),c.setFontSize(8),c.setFont(void 0,"normal");const x=(d.injury_type||"").replace("_"," ").toUpperCase();if(c.text(`${x} — ${d.status?.toUpperCase()||""}`,B+60,i),i+=6,c.setTextColor(0,0,0),c.setFontSize(9),d.description){const f=c.splitTextToSize(d.description,Pe-4);c.text(f,B+2,i),i+=f.length*4+2}d.location&&(c.text(`Location: ${d.location}`,B+2,i),i+=5),i+=4,h<t.length-1&&(c.setDrawColor(220,220,220),c.line(B,i,ce-B,i),i+=4)})),n.length>0&&(c.addPage(),i=20,c.setFontSize(16),c.setFont(void 0,"bold"),c.text("Crew Check-In History",B,i),i+=10,n.forEach((d,h)=>{i=Me(c,i,20);const x=d.workers||[];if(c.setFontSize(10),c.setFont(void 0,"bold"),c.setTextColor(30,30,30),c.text(ds(d.check_in_date),B+2,i),c.setFont(void 0,"normal"),c.setFontSize(8),c.text(`${x.length} workers`,B+60,i),i+=6,c.setTextColor(0,0,0),c.setFontSize(8),x.length>0){const f=x.map(v=>`${v.name} (${v.role||"Laborer"})`).join(", "),p=c.splitTextToSize(f,Pe-4);c.text(p,B+2,i),i+=p.length*3.5+3}h<n.length-1&&(c.setDrawColor(230,230,230),c.line(B,i,ce-B,i),i+=3)}));const m=`${a.name}_Field_Documents_${new Date().toISOString().split("T")[0]}.pdf`;c.save(m)}function nt(s,t,n="text/csv"){const a=new Blob([s],{type:n}),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r)}function Ba(s){if(s==null)return"";let t=String(s);return/^[=+\-@\t\r]/.test(t)&&(t="'"+t),t.includes(",")||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t}function qt(s,t){const n=s.map(r=>Ba(r.label)).join(","),a=t.map(r=>s.map(l=>Ba(r[l.key])).join(","));return[n,...a].join(`
`)}function Fc(s,t){const n=[{key:"category",label:"Category"},{key:"description",label:"Description"},{key:"amount",label:"Amount"},{key:"date",label:"Date"},{key:"type",label:"Type"}],a=[];a.push({category:"Revenue",description:"Original Contract Value",amount:s.contract_value||0,date:s.start_date||"",type:"Contract"}),t?.earnedRevenue&&a.push({category:"Revenue",description:"Earned Revenue (Progress)",amount:t.earnedRevenue,date:new Date().toISOString().split("T")[0],type:"Earned"}),t?.laborByDate&&t.laborByDate.forEach(u=>{a.push({category:"Cost",description:"Labor",amount:u.cost,date:u.date,type:"Labor"})}),t?.haulOffByDate&&t.haulOffByDate.forEach(u=>{a.push({category:"Cost",description:"Disposal/Haul-off",amount:u.cost,date:u.date,type:"Disposal"})}),t?.customCosts&&t.customCosts.forEach(u=>{a.push({category:"Cost",description:u.description||u.category||"Other",amount:parseFloat(u.amount)||0,date:u.cost_date||"",type:u.category||"Other"})});const r=a.filter(u=>u.category==="Revenue").reduce((u,m)=>u+(parseFloat(m.amount)||0),0),l=a.filter(u=>u.category==="Cost").reduce((u,m)=>u+(parseFloat(m.amount)||0),0);a.push({category:"",description:"",amount:"",date:"",type:""}),a.push({category:"Summary",description:"Total Revenue",amount:r,date:"",type:""}),a.push({category:"Summary",description:"Total Costs",amount:l,date:"",type:""}),a.push({category:"Summary",description:"Gross Profit",amount:r-l,date:"",type:""}),a.push({category:"Summary",description:"Margin %",amount:r>0?((r-l)/r*100).toFixed(1)+"%":"N/A",date:"",type:""});const c=qt(n,a),i=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_Financials_${new Date().toISOString().split("T")[0]}.csv`;nt(c,i)}function Go(s,t){const n=[],a=[{key:"section",label:"Section"},{key:"description",label:"Description"},{key:"quantity",label:"Quantity"},{key:"unit",label:"Unit"},{key:"rate",label:"Rate"},{key:"total",label:"Total"}];n.push({section:"COR Info",description:`${s.cor_number} - ${s.title}`,quantity:"",unit:"",rate:"",total:""}),n.push({section:"Status",description:s.status,quantity:"",unit:"",rate:"",total:""}),n.push({section:"Period",description:`${s.period_start||""} to ${s.period_end||""}`,quantity:"",unit:"",rate:"",total:""}),n.push({section:"",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor?.length>0&&(n.push({section:"LABOR",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor.forEach(c=>{const i=parseFloat(c.regular_hours)||0,u=parseFloat(c.overtime_hours)||0;n.push({section:"",description:c.description||c.classification,quantity:i+u,unit:"hours",rate:(parseInt(c.regular_rate)||0)/100,total:(parseInt(c.total)||0)/100})})),s.change_order_materials?.length>0&&(n.push({section:"MATERIALS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_materials.forEach(c=>{n.push({section:"",description:c.description,quantity:parseFloat(c.quantity)||0,unit:c.unit||"each",rate:(parseInt(c.unit_cost)||0)/100,total:(parseInt(c.total)||0)/100})})),s.change_order_equipment?.length>0&&(n.push({section:"EQUIPMENT",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_equipment.forEach(c=>{n.push({section:"",description:c.description,quantity:parseFloat(c.quantity)||0,unit:c.unit||"day",rate:(parseInt(c.unit_cost)||0)/100,total:(parseInt(c.total)||0)/100})})),s.change_order_subcontractors?.length>0&&(n.push({section:"SUBCONTRACTORS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_subcontractors.forEach(c=>{n.push({section:"",description:c.description,quantity:parseFloat(c.quantity)||0,unit:c.unit||"lump sum",rate:(parseInt(c.unit_cost)||0)/100,total:(parseInt(c.total)||0)/100})}));const r=qt(a,n),l=`COR_${s.cor_number||s.id}_${new Date().toISOString().split("T")[0]}.csv`;nt(r,l)}function Yo(s,t){const n=[{key:"date",label:"Date"},{key:"status",label:"Status"},{key:"workers",label:"Worker Count"},{key:"totalHours",label:"Total Hours"},{key:"otHours",label:"OT Hours"},{key:"materialsCost",label:"Materials Cost"},{key:"corNumber",label:"COR #"},{key:"notes",label:"Notes"}],a=s.map(c=>{const i=c.t_and_m_workers||[],u=c.t_and_m_items||[],m=i.reduce((x,f)=>x+(parseFloat(f.hours)||0),0),d=i.reduce((x,f)=>x+(parseFloat(f.overtime_hours)||0),0),h=u.reduce((x,f)=>x+(parseFloat(f.quantity)||0)*(f.materials_equipment?.cost_per_unit||0),0);return{date:c.work_date,status:c.status,workers:i.length,totalHours:(m+d).toFixed(1),otHours:d.toFixed(1),materialsCost:h.toFixed(2),corNumber:c.assigned_cor_id?"Linked":"",notes:c.notes||""}}),r=qt(n,a),l=`${t.name.replace(/[^a-zA-Z0-9]/g,"_")}_TM_Tickets_${new Date().toISOString().split("T")[0]}.csv`;nt(r,l)}function Ac(s,t){const n=[],a=new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}),r=(s.name||"").replace(/[\t\r\n]/g," ");n.push("!TRNS	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),n.push("!SPL	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),n.push("!ENDTRNS");const l=s.contract_value||0;n.push(`TRNS	GENERAL JOURNAL	${a}	Accounts Receivable	${r}	${l.toFixed(2)}	FieldSync - Contract Revenue`),n.push(`SPL	GENERAL JOURNAL	${a}	Construction Revenue	${r}	${(-l).toFixed(2)}	Contract: ${r}`),n.push("ENDTRNS");const c=t?.totalLaborCost||0;c>0&&(n.push(`TRNS	GENERAL JOURNAL	${a}	Direct Labor	${r}	${c.toFixed(2)}	Labor costs - ${r}`),n.push(`SPL	GENERAL JOURNAL	${a}	Accounts Payable	${r}	${(-c).toFixed(2)}	Labor costs`),n.push("ENDTRNS"));const i=t?.totalDisposalCost||0;i>0&&(n.push(`TRNS	GENERAL JOURNAL	${a}	Disposal Expense	${r}	${i.toFixed(2)}	Disposal costs - ${r}`),n.push(`SPL	GENERAL JOURNAL	${a}	Accounts Payable	${r}	${(-i).toFixed(2)}	Disposal costs`),n.push("ENDTRNS"));const u=n.join(`
`),m=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_QB_${new Date().toISOString().split("T")[0]}.iif`;nt(u,m,"application/x-iif")}function Mc({isOpen:s,onClose:t,companyId:n,onSelectProject:a,onSelectTicket:r,onSelectCOR:l,onShowToast:c}){const[i,u]=o.useState(""),[m,d]=o.useState({projects:[],tickets:[],cors:[],workers:[]}),[h,x]=o.useState(!1),[f,p]=o.useState(0),v=o.useRef(null),g=o.useRef(null),T=o.useRef(null);o.useEffect(()=>()=>{g.current&&clearTimeout(g.current),T.current&&clearTimeout(T.current)},[]),o.useEffect(()=>{s&&(u(""),d({projects:[],tickets:[],cors:[],workers:[]}),p(0),T.current=setTimeout(()=>v.current?.focus(),50))},[s]);const y=o.useCallback(async D=>{if(!D.trim()||D.length<2){d({projects:[],tickets:[],cors:[],workers:[]});return}x(!0);try{const b=await q.universalSearch(n,D.trim());d(b),p(0)}catch(b){console.error("Search error:",b),c?.("Search failed","error")}finally{x(!1)}},[n,c]),A=D=>{const b=D.target.value;u(b),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{y(b)},200)},F=(()=>{const D=[];return m.projects.forEach(b=>D.push({type:"project",data:b})),m.tickets.forEach(b=>D.push({type:"ticket",data:b})),m.cors.forEach(b=>D.push({type:"cor",data:b})),m.workers.forEach(b=>D.push({type:"worker",data:b})),D})(),_=F.length>0,L=D=>{D.key==="Escape"?t():D.key==="ArrowDown"?(D.preventDefault(),p(b=>Math.min(b+1,F.length-1))):D.key==="ArrowUp"?(D.preventDefault(),p(b=>Math.max(b-1,0))):D.key==="Enter"&&_&&(D.preventDefault(),S(F[f]))},S=D=>{if(D){switch(D.type){case"project":a?.(D.data);break;case"ticket":r?.(D.data);break;case"cor":l?.(D.data);break;case"worker":D.data.lastProject&&a?.(D.data.lastProject);break}t()}};return s?e.jsx("div",{className:"universal-search-overlay",onClick:t,children:e.jsxs("div",{className:"universal-search-modal",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"universal-search-input-wrapper",children:[e.jsx(dn,{size:20,className:"universal-search-icon"}),e.jsx("input",{ref:v,type:"text",value:i,onChange:A,onKeyDown:L,placeholder:"Search projects, tickets, CORs, workers...",className:"universal-search-input",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),i&&e.jsx("button",{className:"universal-search-clear",onClick:()=>u(""),children:e.jsx(ms,{size:16})}),e.jsx("div",{className:"universal-search-shortcut",children:e.jsx("span",{children:"esc"})})]}),e.jsx("div",{className:"universal-search-results",children:h?e.jsxs("div",{className:"universal-search-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Searching..."})]}):i.trim()?_?e.jsxs(e.Fragment,{children:[m.projects.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(kt,{size:14}),e.jsx("span",{children:"Projects"})]}),m.projects.map((D,b)=>{const I=b;return e.jsxs("button",{className:`universal-search-item ${f===I?"selected":""}`,onClick:()=>S({type:"project",data:D}),onMouseEnter:()=>p(I),children:[e.jsx(kt,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:D.name}),D.job_number&&e.jsxs("span",{className:"universal-search-item-meta",children:["#",D.job_number]})]}),e.jsx(Ve,{size:16,className:"universal-search-item-arrow"})]},D.id)})]}),m.tickets.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(os,{size:14}),e.jsx("span",{children:"Time & Material"})]}),m.tickets.map((D,b)=>{const I=m.projects.length+b;return e.jsxs("button",{className:`universal-search-item ${f===I?"selected":""}`,onClick:()=>S({type:"ticket",data:D}),onMouseEnter:()=>p(I),children:[e.jsx(os,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[D.notes?.substring(0,50)||"Time & Material Ticket",D.notes?.length>50&&"..."]}),e.jsxs("span",{className:"universal-search-item-meta",children:[D.projectName," • ",D.work_date]})]}),e.jsx("span",{className:`universal-search-item-badge ${D.status}`,children:D.status})]},D.id)})]}),m.cors.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(xe,{size:14}),e.jsx("span",{children:"Change Orders"})]}),m.cors.map((D,b)=>{const I=m.projects.length+m.tickets.length+b;return e.jsxs("button",{className:`universal-search-item ${f===I?"selected":""}`,onClick:()=>S({type:"cor",data:D}),onMouseEnter:()=>p(I),children:[e.jsx(xe,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[D.cor_number?`COR #${D.cor_number}: `:"",D.title]}),e.jsx("span",{className:"universal-search-item-meta",children:D.projectName})]}),e.jsx("span",{className:`universal-search-item-badge ${D.status}`,children:D.status})]},D.id)})]}),m.workers.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(Re,{size:14}),e.jsx("span",{children:"Workers"})]}),m.workers.map((D,b)=>{const I=m.projects.length+m.tickets.length+m.cors.length+b;return e.jsxs("button",{className:`universal-search-item ${f===I?"selected":""}`,onClick:()=>S({type:"worker",data:D}),onMouseEnter:()=>p(I),children:[e.jsx(Re,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:D.name}),e.jsxs("span",{className:"universal-search-item-meta",children:[D.role," • ",D.projectName]})]}),e.jsx(Ve,{size:16,className:"universal-search-item-arrow"})]},`${D.name}-${b}`)})]})]}):e.jsx("div",{className:"universal-search-no-results",children:e.jsxs("span",{children:['No results for "',i,'"']})}):e.jsxs("div",{className:"universal-search-empty",children:[e.jsxs("div",{className:"universal-search-tip",children:[e.jsx(qi,{size:14}),e.jsx("span",{children:"Type to search across all data"})]}),e.jsxs("div",{className:"universal-search-hints",children:[e.jsx("span",{children:"Projects"}),e.jsx("span",{children:"Time & Material"}),e.jsx("span",{children:"Change Orders"}),e.jsx("span",{children:"Workers"})]})]})}),e.jsxs("div",{className:"universal-search-footer",children:[e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↑↓"})," navigate"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↵"})," select"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"esc"})," close"]})]})]})}):null}function Oc(){const[s,t]=o.useState(!1);return o.useEffect(()=>{const n=a=>{(a.metaKey||a.ctrlKey)&&a.key==="k"&&(a.preventDefault(),t(r=>!r))};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]),{isOpen:s,setIsOpen:t,open:()=>t(!0),close:()=>t(!1)}}function $c({alerts:s=[],onAction:t,onDismiss:n,maxVisible:a=3,className:r=""}){const[l,c]=o.useState(new Set),i=s.filter(m=>!l.has(m.id||`${m.projectId}-${m.type}-${m.title}`)).slice(0,a),u=o.useCallback(m=>{const d=m.id||`${m.projectId}-${m.type}-${m.title}`;c(h=>new Set([...h,d])),n?.(m)},[n]);return i.length===0?null:e.jsxs("div",{className:`smart-alerts ${r}`,role:"region","aria-label":"Project alerts","aria-live":"polite",children:[i.map((m,d)=>e.jsx(Ic,{alert:m,onAction:t,onDismiss:()=>u(m)},m.id||`${m.projectId}-${m.type}-${d}`)),s.length>a&&e.jsx("div",{className:"smart-alerts__overflow",children:e.jsxs("span",{className:"smart-alerts__overflow-text",children:["+",s.length-a," more alerts"]})})]})}function Ic({alert:s,onAction:t,onDismiss:n}){const{type:a="info",title:r,description:l,action:c,actionTarget:i,projectId:u,projectName:m}=s,h={critical:Vi,warning:Ae,info:Ks}[a]||Ks,x=()=>{t?.({target:i,projectId:u,alert:s})};return e.jsxs("div",{className:`smart-alert smart-alert--${a}`,role:"alert","aria-live":a==="critical"?"assertive":"polite",children:[e.jsx(h,{className:"smart-alert__icon","aria-hidden":"true"}),e.jsxs("div",{className:"smart-alert__content",children:[e.jsxs("div",{className:"smart-alert__title",children:[m&&e.jsxs("span",{className:"smart-alert__project",children:[m,": "]}),r]}),l&&e.jsx("div",{className:"smart-alert__description",children:l}),c&&e.jsx("div",{className:"smart-alert__action",children:e.jsxs("button",{type:"button",className:"smart-alert__action-btn",onClick:x,children:[c,e.jsx(gs,{size:14,"aria-hidden":"true"})]})})]}),n&&e.jsx("button",{type:"button",className:"smart-alert__dismiss",onClick:n,"aria-label":"Dismiss alert",children:e.jsx(ms,{size:18,"aria-hidden":"true"})})]})}const Lc=o.memo(function({progress:t=0,areasComplete:n=0,totalAreas:a=0,areasWorking:r=0,size:l=110,strokeWidth:c=9}){const[i,u]=o.useState(0),m=o.useRef(null);o.useEffect(()=>{const p=i,v=Math.min(100,Math.max(0,t)),g=800,T=performance.now(),y=A=>{const j=A-T,F=Math.min(j/g,1),_=1-Math.pow(1-F,3),L=p+(v-p)*_;u(L),F<1&&(m.current=requestAnimationFrame(y))};return m.current=requestAnimationFrame(y),()=>{m.current&&cancelAnimationFrame(m.current)}},[t]);const d=(l-c)/2,h=d*2*Math.PI,x=h-i/100*h,f=()=>i>=80?"var(--accent-green)":i>=50||i>=25?"var(--accent-blue)":"var(--text-muted)";return e.jsxs("div",{className:"overview-progress-gauge",children:[e.jsxs("div",{className:"progress-gauge-circle",style:{width:l,height:l},children:[e.jsxs("svg",{width:l,height:l,viewBox:`0 0 ${l} ${l}`,children:[e.jsx("circle",{className:"gauge-track",cx:l/2,cy:l/2,r:d,fill:"none",strokeWidth:c,stroke:"var(--bg-tertiary)"}),e.jsx("circle",{className:"gauge-fill",cx:l/2,cy:l/2,r:d,fill:"none",stroke:f(),strokeWidth:c,strokeDasharray:h,strokeDashoffset:x,strokeLinecap:"round",transform:`rotate(-90 ${l/2} ${l/2})`,style:{transition:"stroke 0.3s ease"}})]}),e.jsxs("div",{className:"gauge-center",children:[e.jsxs("span",{className:"gauge-value",children:[Math.round(i),"%"]}),e.jsx("span",{className:"gauge-label",children:"Complete"})]})]}),e.jsxs("div",{className:"gauge-areas-status",children:[e.jsxs("span",{className:"areas-count",children:[e.jsx("strong",{children:n}),"/",a," Areas Done"]}),r>0&&e.jsxs("span",{className:"areas-active",children:[r," active"]})]})]})}),K={contract:"#3b82f6",revenue:"#10b981",costs:"#f59e0b",profit:"#22c55e",loss:"#ef4444",tmValue:"#8b5cf6",corValue:"#14b8a6",labor:"#6366f1",disposal:"#14b8a6",equipment:"#f97316",materials:"#a855f7",subcontractor:"#ec4899",other:"#6b7280"},Hs={duration:800},Xs={contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"12px 16px"},labelStyle:{color:"var(--text-primary)",fontWeight:600,marginBottom:"8px"}},Wa={labor:{label:"Labor",color:K.labor,icon:"HardHat"},disposal:{label:"Disposal",color:K.disposal,icon:"Trash2"},equipment:{label:"Equipment",color:K.equipment,icon:"Truck"},materials:{label:"Materials",color:K.materials,icon:"Package"},subcontractor:{label:"Subcontractor",color:K.subcontractor,icon:"Users"},other:{label:"Other",color:K.other,icon:"MoreHorizontal"}},Ua=[{id:"7d",label:"7D",days:7},{id:"30d",label:"30D",days:30},{id:"90d",label:"90D",days:90},{id:"all",label:"All",days:null}],qe=s=>s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(0)}K`:`$${s.toFixed(0)}`,Vt=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}),zc={revenue:{id:"revenueGradient",color:K.revenue,startOpacity:.3,endOpacity:0},costs:{id:"costsGradient",color:K.costs,startOpacity:.3,endOpacity:0},tmValue:{id:"tmValueGradient",color:K.tmValue,startOpacity:.2,endOpacity:0}},qc=o.memo(function({earnedRevenue:t=0,totalCosts:n=0,laborCost:a=0,disposalCost:r=0,equipmentCost:l=0,materialsCost:c=0,otherCost:i=0,contractValue:u=0}){const m=t-n,d=t>0?m/t*100:0,h=m>=0,x=v=>v>=1e6?`$${(v/1e6).toFixed(1)}M`:v>=1e3?`$${(v/1e3).toFixed(1)}K`:`$${v.toFixed(0)}`,f=[{key:"labor",value:a,color:K.labor,label:"Labor"},{key:"disposal",value:r,color:K.disposal,label:"Disposal"},{key:"equipment",value:l,color:K.equipment,label:"Equipment"},{key:"materials",value:c,color:K.materials,label:"Materials"},{key:"other",value:i,color:K.other,label:"Other"}].filter(v=>v.value>0),p=f.length>0&&n>0;return e.jsxs("div",{className:"overview-financial-card animate-fade-in-up",children:[e.jsxs("div",{className:"financial-metrics-row",children:[e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value green",children:x(t)}),e.jsx("span",{className:"financial-metric-label",children:"Earned"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value amber",children:x(n)}),e.jsx("span",{className:"financial-metric-label",children:"Costs"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsxs("span",{className:`financial-metric-value ${h?"green":"red"}`,children:[h?"":"-",x(Math.abs(m))]}),e.jsxs("span",{className:"financial-metric-label",children:["Profit",e.jsxs("span",{className:`margin-badge ${h?"positive":"negative"}`,children:[d>=0?"+":"",d.toFixed(0),"%"]})]})]})]}),p&&e.jsxs("div",{className:"cost-breakdown-section",children:[e.jsx("div",{className:"cost-breakdown-bar",children:f.map((v,g)=>{const T=v.value/n*100;return e.jsx("div",{className:"cost-segment",style:{width:`${T}%`,backgroundColor:v.color,animationDelay:`${g*100}ms`},title:`${v.label}: ${x(v.value)} (${T.toFixed(0)}%)`},v.key)})}),e.jsx("div",{className:"cost-breakdown-legend",children:f.slice(0,4).map(v=>e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot",style:{backgroundColor:v.color}}),e.jsx("span",{className:"legend-label",children:v.label})]},v.key))})]})]})}),Vc=()=>de(()=>import("./pdf-Dbgi5wV4.js").then(s=>s.j),[]),qs={contract:K.contract,tm:K.costs},Ha=[{id:"7d",label:"7D",days:7},{id:"14d",label:"14D",days:14},{id:"30d",label:"30D",days:30}],Bc=o.memo(function({project:t,onShowToast:n}){const[a,r]=o.useState([]),[l,c]=o.useState([]),[i,u]=o.useState(new Date().toISOString().split("T")[0]),[m,d]=o.useState("14d"),[h,x]=o.useState(!0),[f,p]=o.useState(!1);o.useEffect(()=>{t?.id&&v()},[t?.id]);const v=async()=>{x(!0);try{const[M,V]=await Promise.all([q.getCrewCheckinHistory(t.id,365),q.getTMTickets(t.id)]);r(M||[]),c(V||[])}catch(M){console.error("Error loading crew metrics:",M)}finally{x(!1)}},g=o.useMemo(()=>{const M={};return l.forEach(V=>{const P=V.work_date;P&&(M[P]||(M[P]=new Set),(V.t_and_m_workers||[]).forEach(W=>{M[P].add(W.name.toLowerCase().trim())}))}),M},[l]),T=o.useMemo(()=>{const M={};return a.forEach(V=>{M[V.check_in_date]=V.workers||[]}),M},[a]),y=T[i]||[],A=g[i]||new Set,j=o.useMemo(()=>{const M=[],V=[];return y.forEach(P=>{A.has(P.name.toLowerCase().trim())?V.push(P):M.push(P)}),{total:y.length,contract:M,tm:V}},[y,A]),F=o.useMemo(()=>{const M=Ha.find(W=>W.id===m)?.days||14,V=[],P=new Date;for(let W=M-1;W>=0;W--){const $=new Date(P);$.setDate($.getDate()-W);const ee=$.toISOString().split("T")[0],le=T[ee]||[],te=g[ee]||new Set;let ve=0,O=0;le.forEach(N=>{te.has(N.name.toLowerCase().trim())?O++:ve++}),V.push({date:ee,displayDate:Vt(ee),contract:ve,tm:O,total:le.length})}return V},[T,g,m]),_=o.useCallback(M=>{const V=new Date(i+"T12:00:00");V.setDate(V.getDate()+M),u(V.toISOString().split("T")[0])},[i]),L=i===new Date().toISOString().split("T")[0],S=M=>new Date(M+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),D=o.useCallback(M=>{M?.date&&u(M.date)},[]),b=({active:M,payload:V,label:P})=>{if(!M||!V?.length)return null;const W=(V[0]?.value||0)+(V[1]?.value||0);return e.jsxs("div",{style:{...Xs.contentStyle,fontSize:"0.8rem"},children:[e.jsx("p",{style:{...Xs.labelStyle,fontSize:"0.85rem",marginBottom:6},children:P}),e.jsxs("p",{style:{margin:"3px 0",color:qs.contract},children:["Contract: ",e.jsx("strong",{children:V[0]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:qs.tm},children:["Time & Material: ",e.jsx("strong",{children:V[1]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:"var(--text-primary)",borderTop:"1px solid var(--border-color)",paddingTop:4},children:["Total: ",e.jsx("strong",{children:W})]})]})},I=o.useCallback(async()=>{p(!0),n?.("Generating crew report PDF...","info");try{const V=(await Vc()).default,P=new V,W=P.internal.pageSize.width;let $=20;P.setFontSize(18),P.setFont(void 0,"bold"),P.text("Crew On-Site Report",W/2,$,{align:"center"}),$+=8,P.setFontSize(11),P.setFont(void 0,"normal"),P.text(`Project: ${t.name}`,W/2,$,{align:"center"}),$+=6,P.text(`Date: ${S(i)}`,W/2,$,{align:"center"}),$+=12,P.setFontSize(12),P.setFont(void 0,"bold"),P.text("Selected Day Summary",14,$),$+=7,P.setFontSize(10),P.setFont(void 0,"normal"),P.text(`Total Crew On-Site: ${j.total}`,14,$),$+=5,P.text(`Contract Workers: ${j.contract.length}`,14,$),$+=5,P.text(`Time & Material Workers: ${j.tm.length}`,14,$),$+=10,j.contract.length>0&&(P.setFontSize(12),P.setFont(void 0,"bold"),P.text("Contract Workers",14,$),$+=7,P.setFontSize(9),P.setFont(void 0,"bold"),P.text("Name",14,$),P.text("Role",100,$),$+=5,P.setFont(void 0,"normal"),j.contract.forEach(te=>{$>270&&(P.addPage(),$=20),P.text(te.name,14,$),P.text(te.role||"—",100,$),$+=5}),$+=8),j.tm.length>0&&($>240&&(P.addPage(),$=20),P.setFontSize(12),P.setFont(void 0,"bold"),P.text("Time & Material Workers (Extra Work)",14,$),$+=7,P.setFontSize(9),P.setFont(void 0,"bold"),P.text("Name",14,$),P.text("Role",100,$),$+=5,P.setFont(void 0,"normal"),j.tm.forEach(te=>{$>270&&(P.addPage(),$=20),P.text(te.name,14,$),P.text(te.role||"—",100,$),$+=5}),$+=8),$>200&&(P.addPage(),$=20),P.setFontSize(12),P.setFont(void 0,"bold"),P.text("Daily Timeline",14,$),$+=7,P.setFontSize(8),P.setFont(void 0,"bold"),P.text("Date",14,$),P.text("Total",70,$),P.text("Contract",95,$),P.text("T&M",125,$),$+=5,P.setFont(void 0,"normal"),F.forEach(te=>{$>275&&(P.addPage(),$=20),P.text(te.displayDate,14,$),P.text(String(te.total),70,$),P.text(String(te.contract),95,$),P.text(String(te.tm),125,$),$+=4.5});const ee=P.internal.pageSize.height-10;P.setFontSize(8),P.setTextColor(128,128,128),P.text(`Generated ${new Date().toLocaleString()} — FieldSync`,W/2,ee,{align:"center"});const le=`${t.name}_Crew_Report_${i}.pdf`;P.save(le),n?.("PDF exported!","success")}catch(M){console.error("Error exporting crew PDF:",M),n?.("Error generating PDF","error")}finally{p(!1)}},[t,i,j,F,n]);return h?e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsx("div",{className:"crew-metrics-header",children:e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Crew On-Site"]})}),e.jsxs("div",{className:"crew-metrics-loading",children:[e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"})]})]}):e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsxs("div",{className:"crew-metrics-header",children:[e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Crew On-Site"]}),e.jsx("div",{className:"crew-metrics-actions",children:e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:I,disabled:f,title:"Export crew report as PDF",children:[e.jsx(Ke,{size:14})," ",f?"Exporting...":"PDF"]})})]}),e.jsxs("div",{className:"crew-date-nav",children:[e.jsx("button",{className:"crew-date-btn",onClick:()=>_(-1),children:e.jsx(un,{size:16})}),e.jsxs("span",{className:"crew-date-label",children:[e.jsx(st,{size:14}),L?"Today":S(i)]}),e.jsx("button",{className:"crew-date-btn",onClick:()=>_(1),disabled:L,children:e.jsx(Ve,{size:16})})]}),e.jsxs("div",{className:"crew-stats-row",children:[e.jsxs("div",{className:"crew-stat total",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(Re,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:j.total}),e.jsx("span",{className:"crew-stat-label",children:"Total On-Site"})]})]}),e.jsxs("div",{className:"crew-stat contract",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(Ge,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:j.contract.length}),e.jsx("span",{className:"crew-stat-label",children:"Contract"})]})]}),e.jsxs("div",{className:"crew-stat tm",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(_t,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:j.tm.length}),e.jsx("span",{className:"crew-stat-label",children:"Time & Material"})]})]})]}),j.total>0&&e.jsxs("div",{className:"crew-breakdown-bar",children:[e.jsx("div",{className:"crew-bar-segment contract",style:{width:`${j.contract.length/j.total*100}%`},title:`${j.contract.length} Contract`}),e.jsx("div",{className:"crew-bar-segment tm",style:{width:`${j.tm.length/j.total*100}%`},title:`${j.tm.length} Time & Material`})]}),j.total>0&&e.jsxs("div",{className:"crew-name-lists",children:[j.contract.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header contract",children:[e.jsx(Ge,{size:13}),e.jsxs("span",{children:["Contract (",j.contract.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:j.contract.map((M,V)=>e.jsxs("span",{className:"crew-name-tag contract",children:[M.name,M.role&&M.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:M.role})]},V))})]}),j.tm.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header tm",children:[e.jsx(_t,{size:13}),e.jsxs("span",{children:["Time & Material (",j.tm.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:j.tm.map((M,V)=>e.jsxs("span",{className:"crew-name-tag tm",children:[M.name,M.role&&M.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:M.role})]},V))})]})]}),e.jsxs("div",{className:"crew-timeline-section",children:[e.jsxs("div",{className:"crew-timeline-header",children:[e.jsx("span",{className:"crew-timeline-title",children:"Daily Breakdown"}),e.jsx("div",{className:"crew-time-range-pills",children:Ha.map(M=>e.jsx("button",{className:`crew-range-pill ${m===M.id?"active":""}`,onClick:()=>d(M.id),children:M.label},M.id))})]}),e.jsx("div",{className:"crew-chart-container",children:e.jsx(Zs,{width:"100%",height:140,children:e.jsxs(Ei,{data:F,onClick:M=>M?.activePayload?.[0]&&D(M.activePayload[0].payload),style:{cursor:"pointer"},children:[e.jsx(ln,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(It,{dataKey:"displayDate",tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:{stroke:"var(--border-color)"},tickLine:!1,interval:m==="30d"?4:m==="14d"?1:0}),e.jsx(Lt,{tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:!1,tickLine:!1,allowDecimals:!1,width:30}),e.jsx(et,{content:e.jsx(b,{})}),e.jsx(ks,{wrapperStyle:{fontSize:"0.75rem",paddingTop:4},iconType:"circle",iconSize:8}),e.jsx(Pa,{dataKey:"contract",name:"Contract",stackId:"crew",fill:qs.contract,radius:[0,0,0,0]}),e.jsx(Pa,{dataKey:"tm",name:"Time & Material (Extra Work)",stackId:"crew",fill:qs.tm,radius:[3,3,0,0]})]})})})]}),j.total===0&&e.jsx("div",{className:"crew-empty",children:e.jsx("p",{children:"No crew checked in for this date"})})]})}),ie=o.memo(function({width:t,height:n,borderRadius:a="8px",className:r="",variant:l="default"}){const i=(()=>{switch(l){case"text":return{height:"1em",borderRadius:"4px"};case"circular":return{borderRadius:"50%"};case"rectangular":return{borderRadius:"0"};default:return{borderRadius:a}}})();return e.jsx("div",{className:`skeleton ${r}`,style:{width:t||"100%",height:n||i.height||"1rem",borderRadius:i.borderRadius},"aria-hidden":"true"})});o.memo(function({showProgress:t=!1}){return e.jsxs("div",{className:"metric-skeleton",children:[e.jsx(ie,{width:"60%",height:"0.75rem",className:"skeleton-label"}),e.jsx(ie,{width:"80%",height:"1.75rem",className:"skeleton-value"}),t&&e.jsx(ie,{width:"100%",height:"6px",className:"skeleton-progress"})]})});const Jo=o.memo(function({lines:t=3,showHeader:n=!0,showAction:a=!1}){return e.jsxs("div",{className:"card-skeleton","aria-busy":"true","aria-label":"Loading content",children:[n&&e.jsxs("div",{className:"card-skeleton-header",children:[e.jsx(ie,{width:"40%",height:"1.25rem"}),a&&e.jsx(ie,{width:"80px",height:"32px"})]}),e.jsx("div",{className:"card-skeleton-body",children:Array.from({length:t}).map((r,l)=>e.jsx(ie,{width:`${100-l*15}%`,height:"1rem",className:"skeleton-line"},l))})]})});o.memo(function({count:t=3,showAvatar:n=!1,showAction:a=!1}){return e.jsx("div",{className:"list-skeleton","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:t}).map((r,l)=>e.jsxs("div",{className:"list-item-skeleton",children:[n&&e.jsx(ie,{width:"40px",height:"40px",variant:"circular"}),e.jsxs("div",{className:"list-item-skeleton-content",children:[e.jsx(ie,{width:"60%",height:"1rem"}),e.jsx(ie,{width:"40%",height:"0.75rem"})]}),a&&e.jsx(ie,{width:"60px",height:"28px"})]},l))})});o.memo(function(){return e.jsx("div",{className:"financial-row-skeleton","aria-busy":"true","aria-label":"Loading financial data",children:[1,2,3].map(t=>e.jsxs("div",{className:"financial-card-skeleton",children:[e.jsxs("div",{className:"financial-card-skeleton-header",children:[e.jsx(ie,{width:"24px",height:"24px",variant:"circular"}),e.jsx(ie,{width:"60%",height:"1rem"})]}),e.jsx(ie,{width:"50%",height:"2rem",className:"skeleton-hero-value"}),e.jsxs("div",{className:"financial-card-skeleton-details",children:[e.jsx(ie,{width:"100%",height:"0.875rem"}),e.jsx(ie,{width:"80%",height:"0.875rem"})]})]},t))})});o.memo(function({height:t="200px"}){return e.jsxs("div",{className:"chart-skeleton",style:{height:t},"aria-busy":"true","aria-label":"Loading chart",children:[e.jsx("div",{className:"chart-skeleton-bars",children:[40,65,45,80,55,70,50,75,60,85].map((n,a)=>e.jsx("div",{className:"chart-skeleton-bar",style:{height:`${n}%`}},a))}),e.jsx(ie,{width:"100%",height:"1px",className:"chart-skeleton-axis"})]})});const Ue=o.memo(function({count:t=3}){return e.jsx("div",{className:"ticket-skeleton-list","aria-busy":"true","aria-label":"Loading tickets",children:Array.from({length:t}).map((n,a)=>e.jsxs("div",{className:"ticket-skeleton-item",children:[e.jsxs("div",{className:"ticket-skeleton-header",children:[e.jsx(ie,{width:"100px",height:"0.875rem"}),e.jsx(ie,{width:"80px",height:"24px",borderRadius:"12px"})]}),e.jsx(ie,{width:"90%",height:"1rem"}),e.jsxs("div",{className:"ticket-skeleton-footer",children:[e.jsx(ie,{width:"60px",height:"0.75rem"}),e.jsx(ie,{width:"60px",height:"0.75rem"}),e.jsx(ie,{width:"60px",height:"0.75rem"})]})]},a))})}),Wc=o.memo(function(){return e.jsx("div",{className:"hero-metrics-skeleton","aria-busy":"true","aria-label":"Loading metrics",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"hero-metric-skeleton",children:[e.jsx(ie,{width:"80px",height:"0.75rem",className:"skeleton-label"}),e.jsx(ie,{width:"120px",height:"1.75rem",className:"skeleton-value"}),e.jsx(ie,{width:"100%",height:"4px",className:"skeleton-bar"})]},t))})}),wn=o.memo(function({title:t="Unable to load data",message:n="Something went wrong. Please try again.",error:a=null,onRetry:r=null,retryLabel:l="Try Again",variant:c="default",icon:i=null}){const m=i||(a?.message?.includes("network")||a?.message?.includes("offline")?Bi:Ae);return c==="compact"?e.jsxs("div",{className:"error-state error-state-compact",role:"alert",children:[e.jsx(m,{size:16,className:"error-state-icon","aria-hidden":"true"}),e.jsx("span",{className:"error-state-message",children:n}),r&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:r,"aria-label":l,children:e.jsx(bt,{size:14})})]}):c==="inline"?e.jsxs("div",{className:"error-state error-state-inline",role:"alert",children:[e.jsxs("div",{className:"error-state-content",children:[e.jsx(m,{size:20,className:"error-state-icon","aria-hidden":"true"}),e.jsxs("div",{className:"error-state-text",children:[e.jsx("span",{className:"error-state-title",children:t}),e.jsx("span",{className:"error-state-message",children:n})]})]}),r&&e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:r,children:[e.jsx(bt,{size:14})," ",l]})]}):e.jsxs("div",{className:"error-state",role:"alert","aria-live":"polite",children:[e.jsx("div",{className:"error-state-icon-wrapper",children:e.jsx(m,{size:32,className:"error-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"error-state-title",children:t}),e.jsx("p",{className:"error-state-message",children:n}),!1,r&&e.jsxs("button",{className:"btn btn-primary",onClick:r,children:[e.jsx(bt,{size:16})," ",l]})]})}),Ka=o.memo(function({title:t="No data yet",message:n="Items will appear here once added.",icon:a=null,action:r=null,actionLabel:l="Get Started",onAction:c=null}){return e.jsxs("div",{className:"empty-state",role:"status",children:[a&&e.jsx("div",{className:"empty-state-icon-wrapper",children:e.jsx(a,{size:32,className:"empty-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"empty-state-title",children:t}),e.jsx("p",{className:"empty-state-message",children:n}),c&&e.jsx("button",{className:"btn btn-primary btn-small",onClick:c,children:l}),r&&!c&&r]})});o.memo(function({label:t,error:n,required:a=!1,hint:r,children:l,className:c=""}){return e.jsxs("div",{className:`form-field ${n?"has-error":""} ${c}`,children:[t&&e.jsxs("label",{className:"form-field-label",children:[t,a&&e.jsx("span",{className:"form-field-required",children:"*"})]}),e.jsx("div",{className:"form-field-input",children:l}),n&&e.jsxs("div",{className:"form-field-error",role:"alert",children:[e.jsx(Cs,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:n})]}),r&&!n&&e.jsx("div",{className:"form-field-hint",children:r})]})});o.memo(function({type:t="text",value:n,onChange:a,onBlur:r,error:l,placeholder:c,disabled:i,min:u,max:m,step:d,pattern:h,required:x,autoComplete:f,name:p,id:v,className:g="","aria-label":T,"aria-describedby":y}){const A=v||p,j=l?`${A}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:t,id:A,name:p,value:n,onChange:a,onBlur:r,placeholder:c,disabled:i,min:u,max:m,step:d,pattern:h,required:x,autoComplete:f,className:`validated-input ${l?"has-error":""} ${g}`,"aria-label":T,"aria-invalid":!!l,"aria-describedby":l?j:y}),l&&e.jsxs("div",{id:j,className:"input-error-inline",role:"alert",children:[e.jsx(Cs,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:l})]})]})});o.memo(function({value:t,onChange:n,onBlur:a,error:r,disabled:l,required:c,name:i,id:u,className:m="",children:d,"aria-label":h}){const x=u||i,f=r?`${x}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("select",{id:x,name:i,value:t,onChange:n,onBlur:a,disabled:l,required:c,className:`validated-select ${r?"has-error":""} ${m}`,"aria-label":h,"aria-invalid":!!r,"aria-describedby":r?f:void 0,children:d}),r&&e.jsxs("div",{id:f,className:"input-error-inline",role:"alert",children:[e.jsx(Cs,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});o.memo(function({value:t,onChange:n,onBlur:a,error:r,placeholder:l,disabled:c,required:i,rows:u=3,maxLength:m,name:d,id:h,className:x="","aria-label":f}){const p=h||d,v=r?`${p}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("textarea",{id:p,name:d,value:t,onChange:n,onBlur:a,placeholder:l,disabled:c,required:i,rows:u,maxLength:m,className:`validated-textarea ${r?"has-error":""} ${x}`,"aria-label":f,"aria-invalid":!!r,"aria-describedby":r?v:void 0}),m&&e.jsxs("div",{className:"textarea-counter",children:[t?.length||0," / ",m]}),r&&e.jsxs("div",{id:v,className:"input-error-inline",role:"alert",children:[e.jsx(Cs,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});const Uc=o.memo(function({count:t,label:n,variant:a="default",size:r="medium",pulse:l=!1,icon:c}){const[i,u]=o.useState(t),[m,d]=o.useState(!1);return o.useEffect(()=>{if(t!==i){d(!0);const h=setTimeout(()=>{d(!1),u(t)},400);return()=>clearTimeout(h)}},[t,i]),e.jsxs("span",{className:`count-badge count-badge-${a} count-badge-${r} ${l?"badge-new":""} ${m?"animate-count-up":""}`,title:n,children:[c&&e.jsx(c,{size:r==="small"?12:r==="large"?18:14}),e.jsx("span",{className:"count-badge-value",children:t}),n&&e.jsx("span",{className:"count-badge-label",children:n})]})}),Hc=o.memo(function({value:t,max:n=100,showLabel:a=!1,size:r="medium",variant:l="default",animated:c=!0}){const i=Math.min(100,Math.max(0,t/n*100)),u=r==="small"?"4px":r==="large"?"8px":"6px",m=l==="default"?i>=80?"danger":i>=60?"warning":"success":l;return e.jsxs("div",{className:`mini-progress mini-progress-${r}`,children:[e.jsx("div",{className:"mini-progress-track",style:{height:u},children:e.jsx("div",{className:`mini-progress-fill mini-progress-${m} ${c?"progress-animate":""}`,style:{width:`${i}%`}})}),a&&e.jsxs("span",{className:"mini-progress-label",children:[Math.round(i),"%"]})]})}),Kc=o.memo(function({value:t,previousValue:n,format:a="percent",inverted:r=!1,showValue:l=!0}){const c=t-n,i=n!==0?c/n*100:0;let u=c===0?"neutral":c>0?"up":"down",m="neutral";c!==0&&(r?m=c>0?"negative":"positive":m=c>0?"positive":"negative");const d=u==="up"?hs:u==="down"?ps:zt,h=()=>{const x=Math.abs(c);switch(a){case"percent":return`${Math.abs(i).toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(x);default:return x.toLocaleString()}};return e.jsxs("span",{className:`trend-indicator trend-${m}`,children:[e.jsx(d,{size:14}),l&&e.jsx("span",{className:"trend-value",children:h()})]})});o.memo(function({status:t="default",label:n,size:a="medium",pulse:r=!1}){return e.jsxs("span",{className:`status-dot-container status-dot-${a}`,children:[e.jsx("span",{className:`status-dot status-dot-${t} ${r?"status-dot-pulse":""}`}),n&&e.jsx("span",{className:"status-dot-label",children:n})]})});o.memo(function({data:t=[],width:n=80,height:a=24,strokeWidth:r=2,color:l="var(--accent-blue)",showArea:c=!0}){if(!t.length)return null;const i=Math.max(...t),u=Math.min(...t),m=i-u||1,d=t.map((x,f)=>{const p=f/(t.length-1)*n,v=a-(x-u)/m*(a-r*2)-r;return`${p},${v}`}).join(" "),h=`0,${a} ${d} ${n},${a}`;return e.jsxs("svg",{width:n,height:a,className:"sparkline",viewBox:`0 0 ${n} ${a}`,children:[c&&e.jsx("polygon",{points:h,fill:l,fillOpacity:"0.15"}),e.jsx("polyline",{points:d,fill:"none",stroke:l,strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]})});o.memo(function({items:t=[]}){return e.jsx("div",{className:"quick-stats",children:t.map((n,a)=>e.jsxs("span",{className:"quick-stat-item",children:[n.icon&&e.jsx(n.icon,{size:12}),e.jsx("span",{className:"quick-stat-value",children:n.value}),n.label&&e.jsx("span",{className:"quick-stat-label",children:n.label})]},a))})});o.memo(function({status:t,label:n,size:a="medium"}){const r={success:mn,warning:Ae,danger:Ae,info:St,pending:St},l=r[t]||r.info;return e.jsxs("span",{className:`status-indicator status-indicator-${t} status-indicator-${a}`,children:[e.jsx(l,{size:a==="small"?12:a==="large"?18:14}),n&&e.jsx("span",{className:"status-indicator-label",children:n})]})});o.memo(function({current:t,previous:n,format:a="number",label:r,inverted:l=!1}){const c=t-n,i=l?c<0:c>0,u=l?c>0:c<0,m=d=>{switch(a){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(Math.abs(d));case"percent":return`${Math.abs(d).toFixed(1)}%`;default:return Math.abs(d).toLocaleString()}};return e.jsxs("div",{className:`metric-delta ${i?"positive":u?"negative":"neutral"}`,children:[e.jsx("span",{className:"metric-delta-arrow",children:c>0?"↑":c<0?"↓":"→"}),e.jsx("span",{className:"metric-delta-value",children:m(c)}),r&&e.jsx("span",{className:"metric-delta-label",children:r})]})});o.memo(function({value:t,max:n=100,size:a=40,strokeWidth:r=4,showValue:l=!0,color:c="var(--accent-blue)"}){const i=Math.min(100,Math.max(0,t/n*100)),u=(a-r)/2,m=u*2*Math.PI,d=m-i/100*m;return e.jsxs("div",{className:"circular-progress",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,viewBox:`0 0 ${a} ${a}`,children:[e.jsx("circle",{className:"circular-progress-track",cx:a/2,cy:a/2,r:u,fill:"none",strokeWidth:r}),e.jsx("circle",{className:"circular-progress-fill",cx:a/2,cy:a/2,r:u,fill:"none",stroke:c,strokeWidth:r,strokeDasharray:m,strokeDashoffset:d,strokeLinecap:"round",transform:`rotate(-90 ${a/2} ${a/2})`,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),l&&e.jsxs("span",{className:"circular-progress-value",children:[Math.round(i),"%"]})]})});o.memo(function({isOpen:t,onClose:n,title:a,children:r,size:l="medium",className:c="",showCloseButton:i=!0,closeOnOverlayClick:u=!0,closeOnEscape:m=!0,footer:d,ariaDescribedBy:h}){const x=o.useRef(null),f=o.useRef(null),p=o.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`);o.useEffect(()=>{if(t){f.current=document.activeElement;const y=setTimeout(()=>{x.current?.focus()},10);return()=>clearTimeout(y)}},[t]),o.useEffect(()=>{!t&&f.current&&f.current.focus()},[t]),o.useEffect(()=>{if(!t||!m)return;const y=A=>{A.key==="Escape"&&(A.preventDefault(),n())};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[t,m,n]),o.useEffect(()=>{if(t){const y=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=y}}},[t]);const v=o.useCallback(y=>{if(y.key!=="Tab")return;const A=x.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!A||A.length===0)return;const j=A[0],F=A[A.length-1];y.shiftKey?document.activeElement===j&&(y.preventDefault(),F.focus()):document.activeElement===F&&(y.preventDefault(),j.focus())},[]),g=y=>{u&&y.target===y.currentTarget&&n()};if(!t)return null;const T={small:"modal-small",medium:"modal-medium",large:"modal-large",full:"modal-full"};return e.jsx("div",{className:"modal-overlay",onClick:g,role:"presentation",children:e.jsxs("div",{ref:x,className:`modal-content ${T[l]||""} ${c}`,role:"dialog","aria-modal":"true","aria-labelledby":a?p.current:void 0,"aria-describedby":h,tabIndex:-1,onKeyDown:v,onClick:y=>y.stopPropagation(),children:[a&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:p.current,children:a}),i&&e.jsx("button",{className:"close-btn",onClick:n,"aria-label":"Close modal",type:"button",children:e.jsx(ms,{size:20})})]}),e.jsx("div",{className:"modal-body",children:r}),d&&e.jsx("div",{className:"modal-footer",children:d})]})})});const fs=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Vs=o.memo(function({icon:t,label:n,value:a,formattedValue:r,subLabel:l,progress:c,progressLabel:i,variant:u="default",trend:m,previousValue:d}){const h={default:"var(--accent-blue)",success:"var(--accent-green)",warning:"var(--accent-amber)",danger:"var(--accent-red)"};return e.jsxs("div",{className:"hero-metric-card hover-lift animate-fade-in-up",children:[e.jsxs("div",{className:"hero-metric-header",children:[e.jsx("div",{className:"hero-metric-icon",style:{color:h[u]},children:e.jsx(t,{size:18})}),e.jsx("span",{className:"hero-metric-label",children:n})]}),e.jsxs("div",{className:"hero-metric-value-row",children:[e.jsx("span",{className:`hero-metric-value hero-metric-${u}`,children:r}),m!==void 0&&d!==void 0&&e.jsx(Kc,{value:a,previousValue:d,format:"currency",inverted:n.toLowerCase().includes("cost")})]}),l&&e.jsx("span",{className:"hero-metric-sublabel",children:l}),c!==void 0&&e.jsxs("div",{className:"hero-metric-progress",children:[e.jsx(Hc,{value:c,max:100,size:"small",variant:u,showLabel:!0}),i&&e.jsx("span",{className:"hero-metric-progress-label",children:i})]})]})}),Gc=o.memo(function({contractValue:t=0,earnedRevenue:n=0,totalCosts:a=0,profit:r=0,progress:l=0,corApprovedValue:c=0,loading:i=!1,previousData:u}){const m=t+c,d=n>0?r/n*100:0,h=n>0?a/n*100:0,x=m>0?n/m*100:0,f=m>0?a/m*100:0,p=o.useMemo(()=>d>=20?"success":d>=10?"warning":d<0?"danger":"default",[d]),v=o.useMemo(()=>h<=60?"success":h<=80?"warning":"danger",[h]);return i?e.jsx(Wc,{}):e.jsxs("div",{className:"hero-metrics stagger-children",children:[e.jsx(Vs,{icon:ls,label:"Contract Value",value:m,formattedValue:fs(m),subLabel:c>0?`+${fs(c)} CORs`:null,variant:"default"}),e.jsx(Vs,{icon:hs,label:"Earned Revenue",value:n,formattedValue:fs(n),progress:x,progressLabel:`${Math.round(x)}% of contract`,variant:"success",previousValue:u?.earnedRevenue,trend:u?n:void 0}),e.jsx(Vs,{icon:hn,label:"Total Costs",value:a,formattedValue:fs(a),progress:f,progressLabel:`${Math.round(h)}% of revenue`,variant:v,previousValue:u?.totalCosts,trend:u?a:void 0}),e.jsx(Vs,{icon:Wi,label:"Profit",value:r,formattedValue:fs(r),subLabel:`${d>=0?"+":""}${d.toFixed(1)}% margin`,variant:p,previousValue:u?.profit,trend:u?r:void 0})]})}),Ga=[{id:"overview",label:"Overview",shortLabel:"Overview",icon:Hi,description:"Metrics & trends",step:null},{id:"cors",label:"Change Orders",shortLabel:"CORs",icon:os,description:"CORs & approvals",step:1},{id:"tickets",label:"Time & Material",shortLabel:"Tickets",icon:xe,description:"Field data",step:2},{id:"billing",label:"Billing",shortLabel:"Billing",icon:hn,description:"Invoices & billing",step:3}],Yc=o.memo(function({activeSection:t="overview",onSectionChange:n,collapsed:a=!1,onToggleCollapse:r,onMobileClose:l,stats:c={}}){const{corCount:i=0,ticketCount:u=0,corPending:m=0,ticketPending:d=0,billableCount:h=0,invoiceCount:x=0}=c,f=p=>p==="cors"&&i>0?{count:i,variant:m>0?"warning":"default",pending:m}:p==="tickets"&&u>0?{count:u,variant:d>0?"warning":"default",pending:d}:p==="billing"&&h>0?{count:h,variant:"success",pending:h}:null;return e.jsxs("nav",{className:`financials-nav ${a?"collapsed":""}`,"aria-label":"Financials sections",children:[l&&e.jsxs("div",{className:"financials-nav-mobile-header",children:[e.jsx("span",{className:"financials-nav-mobile-title",children:"Financials"}),e.jsx("button",{className:"financials-nav-mobile-close",onClick:l,"aria-label":"Close menu",children:e.jsx(ms,{size:20})})]}),e.jsxs("button",{className:"financials-nav-toggle",onClick:r,"aria-label":a?"Expand sidebar":"Collapse sidebar",title:a?"Expand sidebar":"Collapse sidebar",children:[a?e.jsx(Ui,{size:18}):e.jsx(un,{size:18}),!a&&e.jsx("span",{children:"Collapse"})]}),e.jsx("div",{className:"financials-nav-items",children:Ga.map((p,v)=>{const g=t===p.id,T=p.icon,y=f(p.id),A=v<Ga.length-1&&p.step!==null;return e.jsxs("div",{className:"financials-nav-item-wrapper",children:[e.jsxs("button",{className:`financials-nav-item ${g?"active":""}`,onClick:()=>n?.(p.id),"aria-current":g?"page":void 0,title:`${p.label}${y?` (${y.count})`:""}`,children:[p.step&&!a&&e.jsx("span",{className:"financials-nav-step",children:p.step}),e.jsxs("div",{className:"financials-nav-icon",children:[e.jsx(T,{size:a?22:20}),y&&y.pending>0&&e.jsx("span",{className:"financials-nav-dot"})]}),a&&e.jsx("span",{className:"financials-nav-short-label",children:p.shortLabel}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"financials-nav-content",children:[e.jsx("span",{className:"financials-nav-label",children:p.label}),e.jsx("span",{className:"financials-nav-desc",children:p.description})]}),y&&e.jsx(Uc,{count:y.count,size:"small",variant:y.variant}),e.jsx(Ve,{size:16,className:"financials-nav-arrow"})]})]}),A&&!a&&e.jsx("div",{className:"financials-nav-connector",children:e.jsx("div",{className:"connector-line"})})]},p.id)})}),a&&e.jsxs("button",{className:"financials-nav-expand-btn",onClick:r,"aria-label":"Expand sidebar",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"Expand"})]})]})});function Jc(s,t,n=[],a=null,r=[],l=0){const i=(t?.contract_value||0)+l,u=s?.laborByDate||[],m=s?.haulOffByDate||[],d=s?.materialsEquipmentByDate||[],h=s?.customCosts||[],x=new Set;u.forEach(b=>x.add(b.date)),m.forEach(b=>x.add(b.date)),d.forEach(b=>x.add(b.date)),h.forEach(b=>{b.cost_date&&x.add(b.cost_date)}),n.forEach(b=>{b.work_date&&x.add(b.work_date),b.ticket_date&&x.add(b.ticket_date),b.created_at&&x.add(b.created_at.split("T")[0])}),r.forEach(b=>{b.status==="done"&&b.updated_at&&x.add(b.updated_at.split("T")[0])});const f=[...x].sort((b,I)=>new Date(b)-new Date(I));if(f.length===0)return[];const p={},v=r.reduce((b,I)=>b+(parseFloat(I.weight)||0),0);r.forEach(b=>{if(b.status==="done"&&b.updated_at){const I=b.updated_at.split("T")[0],M=parseFloat(b.weight)||0,V=b.scheduled_value?parseFloat(b.scheduled_value):v>0?M/v*i:0;p[I]||(p[I]=0),p[I]+=V}});const g={};n.forEach(b=>{const I=b.work_date||b.ticket_date||b.created_at?.split("T")[0];if(!I)return;let M=0;const V=b.t_and_m_workers||b.workers||[];Array.isArray(V)&&V.forEach(W=>{const $=parseFloat(W.hours)||parseFloat(W.regular_hours)||0,ee=parseFloat(W.overtime_hours)||0,le=parseFloat(W.regular_rate)||parseFloat(W.rate)||65,te=parseFloat(W.overtime_rate)||le*1.5;M+=$*le+ee*te});const P=b.t_and_m_items||b.items||[];Array.isArray(P)&&P.forEach(W=>{const $=parseFloat(W.quantity)||1,ee=parseFloat(W.unit_cost)||parseFloat(W.materials_equipment?.cost_per_unit)||0;M+=$*ee}),g[I]||(g[I]=0),g[I]+=M});const T={};h.forEach(b=>{const I=b.cost_date;I&&(T[I]||(T[I]=0),T[I]+=parseFloat(b.amount)||0)});const y={};d.forEach(b=>{b.date&&(y[b.date]=b.cost||0)});const A=Object.keys(p).length>0,j=s?.billable||0;let F=0;!A&&j>0&&f.forEach(b=>{const M=u.find(ee=>ee.date===b)?.cost||0,P=m.find(ee=>ee.date===b)?.cost||0,W=y[b]||0,$=T[b]||0;F+=M+W+P+$});let _=0,L=0,S=0;return f.map(b=>{const M=u.find(O=>O.date===b)?.cost||0,P=m.find(O=>O.date===b)?.cost||0,W=y[b]||0,$=T[b]||0,ee=M+W+P+$;_+=ee;const le=g[b]||0;L+=le;let te;if(A){const O=p[b]||0;S+=O,te=S}else F>0?te=_/F*j:te=j;const ve=A&&p[b]||0;return{date:b,contract:i,revenue:Math.round(te),costs:Math.round(_),tmValue:Math.round(L),corValue:Math.round(a?.total_approved_value||0),profit:Math.round(te-_),dailyLabor:Math.round(M),dailyRevenue:Math.round(ve),dailyMaterials:Math.round(W),dailyHaulOff:Math.round(P),dailyCustom:Math.round($),dailyTM:Math.round(le),dailyTotal:Math.round(ee)}})}function Xc(s,t){if(!t||!s.length)return s;const n=new Date,a=new Date;return a.setDate(n.getDate()-t),s.filter(r=>new Date(r.date)>=a)}function Qc(s=0,t=0,n=[],a=0){const r=[];s>0&&r.push({name:"Labor",value:s,color:K.labor,category:"labor"}),t>0&&r.push({name:"Disposal",value:t,color:K.disposal,category:"disposal"}),a>0&&r.push({name:"Materials & Equipment",value:a,color:K.equipment,category:"equipment"});const l={};n.forEach(i=>{const u=i.category||"other";l[u]||(l[u]={items:[],total:0}),l[u].items.push(i),l[u].total+=parseFloat(i.amount)||0}),Object.entries(l).forEach(([i,u])=>{if(u.total>0){const m=Wa[i]||Wa.other;r.push({name:m.label,value:u.total,color:m.color,category:i,items:u.items})}});const c=r.reduce((i,u)=>i+u.value,0);return r.forEach(i=>{i.percentage=c>0?Math.round(i.value/c*100):0}),r.sort((i,u)=>u.value-i.value),r}function Ya(s,t){if(!s||s.length<2)return{direction:"flat",percentage:0};const n=s.slice(-7);if(n.length<2)return{direction:"flat",percentage:0};const a=n[0][t]||0,r=n[n.length-1][t]||0;if(a===0)return{direction:r>0?"up":"flat",percentage:0};const l=(r-a)/a*100;return{direction:l>5?"up":l<-5?"down":"flat",percentage:Math.abs(Math.round(l))}}function Zc({active:s,payload:t,label:n}){if(!s||!t||!t.length)return null;const a=l=>l>=1e6?`$${(l/1e6).toFixed(2)}M`:l>=1e3?`$${(l/1e3).toFixed(1)}K`:`$${l.toFixed(0)}`,r=t[0]?.payload||{};return e.jsxs("div",{className:"chart-tooltip",children:[e.jsx("div",{className:"chart-tooltip-date",children:Vt(n)}),e.jsxs("div",{className:"chart-tooltip-rows",children:[r.contract!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:K.contract}}),"Contract"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.contract)})]}),r.revenue!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:K.revenue}}),"Revenue"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.revenue)})]}),r.costs!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:K.costs}}),"Costs"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.costs)})]}),r.tmValue!==void 0&&r.tmValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:K.tmValue}}),"T&M Value"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.tmValue)})]}),r.corValue!==void 0&&r.corValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:K.corValue}}),"COR Approved"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(r.corValue)})]}),r.profit!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:r.profit>=0?K.profit:K.loss}}),r.profit>=0?"Profit":"Loss"]}),e.jsx("span",{className:"chart-tooltip-value",style:{color:r.profit>=0?K.profit:K.loss},children:a(Math.abs(r.profit))})]})]}),(r.dailyRevenue>0||r.dailyLabor>0||r.dailyMaterials>0||r.dailyHaulOff>0||r.dailyTM>0)&&e.jsxs("div",{className:"chart-tooltip-daily",children:[e.jsx("div",{className:"chart-tooltip-daily-label",children:"Today's Activity"}),r.dailyRevenue>0&&e.jsx("div",{className:"chart-tooltip-daily-row earned",children:e.jsxs("span",{style:{color:K.revenue},children:["Areas Completed: ",a(r.dailyRevenue)]})}),r.dailyLabor>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Labor: ",a(r.dailyLabor)]}),r.dailyMaterials>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Materials: ",a(r.dailyMaterials)]}),r.dailyHaulOff>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Disposal: ",a(r.dailyHaulOff)]}),r.dailyTM>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["T&M Added: ",a(r.dailyTM)]}),r.dailyTotal>0&&e.jsx("div",{className:"chart-tooltip-daily-row total",children:e.jsxs("strong",{children:["Day Costs: ",a(r.dailyTotal)]})})]}),e.jsx("div",{className:"chart-tooltip-hint",children:"Click to see details"})]})}function eo({projectData:s,project:t,tmTickets:n=[],corStats:a=null,areas:r=[],changeOrderValue:l=0,onDrillDown:c}){const[i,u]=o.useState("30d"),[m,d]=o.useState(null),h=o.useMemo(()=>{const g=Jc(s,t,n,a,r,l),T=Ua.find(y=>y.id===i);return Xc(g,T?.days)},[s,t,n,a,r,l,i]),x=o.useMemo(()=>Ya(h,"costs"),[h]),f=o.useMemo(()=>Ya(h,"revenue"),[h]),p=g=>{if(g?.activePayload?.[0]){const T=g.activePayload[0].payload;c?.(T.date,T)}},v=({trend:g})=>g.direction==="up"?e.jsx(hs,{size:14,className:"trend-icon up"}):g.direction==="down"?e.jsx(ps,{size:14,className:"trend-icon down"}):e.jsx(zt,{size:14,className:"trend-icon flat"});return h.length?e.jsxs("div",{className:"financial-trend-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[e.jsx("h3",{children:"Financial Trend"}),e.jsxs("div",{className:"chart-trend-indicators",children:[e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:K.revenue},children:"Revenue"}),e.jsx(v,{trend:f}),f.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[f.percentage,"%"]})]}),e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:K.costs},children:"Costs"}),e.jsx(v,{trend:x}),x.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[x.percentage,"%"]})]})]})]}),e.jsx("div",{className:"time-range-selector",children:Ua.map(g=>e.jsx("button",{className:i===g.id?"active":"",onClick:()=>u(g.id),children:g.label},g.id))})]}),e.jsx("div",{className:"chart-container",children:e.jsx(Zs,{width:"100%",height:300,children:e.jsxs(pc,{data:h,onClick:p,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:Object.values(zc).map(g=>e.jsxs("linearGradient",{id:g.id,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:g.color,stopOpacity:g.startOpacity}),e.jsx("stop",{offset:"95%",stopColor:g.color,stopOpacity:g.endOpacity})]},g.id))}),e.jsx(ln,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(It,{dataKey:"date",tickFormatter:Vt,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(Lt,{tickFormatter:qe,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:!1,width:60}),e.jsx(et,{content:e.jsx(Zc,{})}),e.jsx(ks,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,formatter:g=>e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:g})}),h[0]?.contract>0&&e.jsx(Pt,{y:h[0].contract,stroke:K.contract,strokeDasharray:"5 5",strokeWidth:2,label:{value:"Contract",position:"right",fill:K.contract,fontSize:11}}),e.jsx(Us,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:K.revenue,strokeWidth:2,fill:"url(#revenueGradient)",animationDuration:Hs.duration,onMouseEnter:()=>d("revenue"),onMouseLeave:()=>d(null),style:{opacity:m&&m!=="revenue"?.3:1}}),e.jsx(Us,{type:"monotone",dataKey:"costs",name:"Costs",stroke:K.costs,strokeWidth:2,fill:"url(#costsGradient)",animationDuration:Hs.duration,onMouseEnter:()=>d("costs"),onMouseLeave:()=>d(null),style:{opacity:m&&m!=="costs"?.3:1}}),h.some(g=>g.tmValue>0)&&e.jsx(Us,{type:"monotone",dataKey:"tmValue",name:"Time & Material Value",stroke:K.tmValue,strokeWidth:2,fill:"url(#tmValueGradient)",animationDuration:Hs.duration,onMouseEnter:()=>d("tmValue"),onMouseLeave:()=>d(null),style:{opacity:m&&m!=="tmValue"?.3:1}}),(a?.total_approved_value||0)>0&&e.jsx(Pt,{y:a.total_approved_value,stroke:K.corValue,strokeDasharray:"4 2",strokeWidth:2,label:{value:"COR Approved",position:"right",fill:K.corValue,fontSize:11}})]})})}),e.jsxs("div",{className:"chart-quick-stats",children:[e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Current Revenue"}),e.jsx("span",{className:"stat-value",style:{color:K.revenue},children:qe(h[h.length-1]?.revenue||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Total Costs"}),e.jsx("span",{className:"stat-value",style:{color:K.costs},children:qe(h[h.length-1]?.costs||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Margin"}),e.jsx("span",{className:"stat-value",style:{color:(h[h.length-1]?.profit||0)>=0?K.profit:K.loss},children:(()=>{const g=h[h.length-1];return!g||!g.revenue?"0%":`${((g.revenue-g.costs)/g.revenue*100).toFixed(1)}%`})()})]}),h[h.length-1]?.tmValue>0&&e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Time & Material Pending"}),e.jsx("span",{className:"stat-value",style:{color:K.tmValue},children:qe(h[h.length-1]?.tmValue||0)})]})]})]}):e.jsx("div",{className:"financial-trend-chart empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No financial data available yet."}),e.jsx("span",{children:"Start tracking labor and costs to see trends."})]})})}function so({laborCost:s=0,haulOffCost:t=0,materialsEquipmentCost:n=0,customCosts:a=[],onSegmentClick:r}){const[l,c]=o.useState(null),i=o.useMemo(()=>Qc(s,t,a,n),[s,t,a,n]),u=o.useMemo(()=>i.reduce((p,v)=>p+v.value,0),[i]),m=(p,v)=>{c(v)},d=()=>{c(null)},h=(p,v)=>{r&&r(i[v])},x=({active:p,payload:v})=>{if(!p||!v||!v.length)return null;const g=v[0].payload;return e.jsxs("div",{className:"chart-tooltip donut-tooltip",children:[e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:g.color}}),g.name]}),e.jsx("span",{className:"chart-tooltip-value",children:qe(g.value)})]}),e.jsxs("div",{className:"donut-tooltip-pct",children:[g.percentage,"% of total costs"]}),g.items&&g.items.length>0&&e.jsx("div",{className:"donut-tooltip-items",children:e.jsxs("div",{className:"donut-tooltip-items-label",children:[g.items.length," item",g.items.length>1?"s":""]})}),r&&e.jsx("div",{className:"chart-tooltip-hint",children:"Click to view details"})]})},f=p=>{const{payload:v}=p;return e.jsx("div",{className:"donut-legend",children:v.map((g,T)=>e.jsxs("div",{className:`donut-legend-item ${l===T?"active":""}`,onMouseEnter:()=>c(T),onMouseLeave:()=>c(null),onClick:()=>h(null,T),children:[e.jsx("span",{className:"donut-legend-color",style:{backgroundColor:g.payload.color}}),e.jsx("span",{className:"donut-legend-name",children:g.value}),e.jsx("span",{className:"donut-legend-value",children:qe(g.payload.value)})]},`legend-${T}`))})};return!i.length||u===0?e.jsx("div",{className:"cost-donut empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No cost data available."}),e.jsx("span",{children:"Add labor, disposal, or custom costs to see breakdown."})]})}):e.jsx("div",{className:"cost-donut",children:e.jsxs("div",{className:"donut-chart-container",children:[e.jsx(Zs,{width:"100%",height:200,children:e.jsxs(Pi,{children:[e.jsx(Ri,{data:i,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",onMouseEnter:m,onMouseLeave:d,onClick:h,animationDuration:Hs.duration,animationEasing:"ease-out",children:i.map((p,v)=>e.jsx(Ti,{fill:p.color,stroke:"var(--card-bg)",strokeWidth:2,style:{filter:l===v?"brightness(1.1)":"none",cursor:r?"pointer":"default",transform:l===v?"scale(1.05)":"scale(1)",transformOrigin:"center",transition:"all 0.2s ease"}},`cell-${v}`))}),e.jsx(et,{content:e.jsx(x,{})}),e.jsx(ks,{content:f})]})}),e.jsxs("div",{className:"donut-center-label",children:[e.jsx("span",{className:"donut-center-value",children:qe(u)}),e.jsx("span",{className:"donut-center-text",children:"Total"})]})]})})}const He=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0);function to({revenue:s,totalCosts:t,contractValue:n,progress:a}){const r=s-t,l=s>0?r/s*100:0,c=n,i=a>0?t/(a/100):t,u=c-i,m=c>0?u/c*100:0,d=l>=20,h=l>=0&&l<20,x=l<0,f=d?"healthy":h?"warning":"loss",p=d?"On Track":h?"Watch Margin":"Over Cost",v=d?Ki:h?Cs:ps;return e.jsxs("div",{className:`profitability-card ${f}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${f}`,children:[e.jsx(v,{size:14}),e.jsx("span",{children:p})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${l<0?"negative":""}`,children:[Math.round(l),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${l<0?"negative":l<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(l),100)}%`}})})]}),a>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${m<0?"negative":""}`,children:[Math.round(m),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${m<0?"negative":m<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(m),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:He(s)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",He(t)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${r<0?"negative":"positive"}`,children:[r>=0?"":"-",He(Math.abs(r))]})]})]}),a>10&&e.jsxs("div",{className:"profitability-insight",children:[d&&e.jsxs("p",{children:["At ",Math.round(a),"% complete, you're at ",He(r)," profit.",u>0&&` Projected final profit: ${He(u)}`]}),h&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",u<0&&` Trending toward ${He(u)} loss.`]}),x&&e.jsxs("p",{children:["Currently over cost by ",He(Math.abs(r)),". Immediate review recommended."]})]})]})}const wt=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Bs={labor:{label:"Labor",Icon:Ge,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Ye,color:"#10b981"},equipment:{label:"Equipment",Icon:_t,color:"#f59e0b"},materials:{label:"Materials",Icon:Ws,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:Re,color:"#ec4899"},other:{label:"Other",Icon:Gi,color:"#6b7280"}};function ao({laborCost:s=0,haulOffCost:t=0,materialsEquipmentCost:n=0,customCosts:a=[],onAddCost:r,onDeleteCost:l}){const[c,i]=o.useState(!0),[u,m]=o.useState(null),d=[];s>0&&d.push({category:"labor",label:"Labor",amount:s,source:"auto",description:"From crew check-ins"}),t>0&&d.push({category:"disposal",label:"Disposal",amount:t,source:"auto",description:"From haul-off logs"}),n>0&&d.push({category:"equipment",label:"Materials & Equipment",amount:n,source:"auto",description:"From T&M tickets"});const h={};a.forEach(v=>{h[v.category]||(h[v.category]={category:v.category,items:[],total:0}),h[v.category].items.push(v),h[v.category].total+=parseFloat(v.amount)||0}),Object.values(h).forEach(v=>{const g=Bs[v.category]||Bs.other;d.push({category:v.category,label:g.label,amount:v.total,source:"manual",items:v.items})});const x=d.reduce((v,g)=>v+g.amount,0);d.forEach(v=>{v.percentage=x>0?v.amount/x*100:0}),d.sort((v,g)=>g.amount-v.amount);const f=v=>{m(u===v?null:v)},p=v=>{v.items&&v.items.length>0&&(i(!1),m(v.category))};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsxs("div",{className:"cost-contributors-title",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:wt(x)})]}),d.length>0&&e.jsxs("div",{className:"cost-view-toggle",children:[e.jsx("button",{className:c?"active":"",onClick:()=>i(!0),children:"Chart"}),e.jsx("button",{className:c?"":"active",onClick:()=>i(!1),children:"List"})]})]}),d.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):c?e.jsx(so,{laborCost:s,haulOffCost:t,materialsEquipmentCost:n,customCosts:a,onSegmentClick:p}):e.jsx("div",{className:"cost-breakdown",children:d.map(v=>{const g=Bs[v.category]||Bs.other,T=g.Icon,y=v.items&&v.items.length>0,A=u===v.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${y?"expandable":""}`,onClick:()=>y&&f(v.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(v.percentage,2)}%`,backgroundColor:g.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(T,{size:14,style:{color:g.color}}),e.jsx("span",{children:v.label}),v.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),y&&(A?e.jsx(tt,{size:14}):e.jsx(Qe,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:wt(v.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(v.percentage),"%"]})]})]})]}),A&&y&&e.jsx("div",{className:"cost-category-items",children:v.items.map(j=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:j.description}),e.jsx("span",{className:"cost-item-date",children:new Date(j.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:wt(j.amount)}),l&&e.jsx("button",{className:"cost-item-delete",onClick:F=>{F.stopPropagation(),confirm("Delete this cost entry?")&&l(j.id)},children:e.jsx(pn,{size:14})})]})]},j.id))})]},v.category)})}),r&&e.jsxs("button",{className:"cost-add-btn",onClick:r,children:[e.jsx(Ns,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const Cn=[{value:"concrete",label:"Concrete",icon:"🧱"},{value:"trash",label:"Trash",icon:"🗑️"},{value:"metals",label:"Metals",icon:"🔩"},{value:"hazardous_waste",label:"Hazardous",icon:"☣️"}],no=s=>Cn.find(t=>t.value===s)||{label:s,icon:"📦"};function ro({project:s,period:t="week"}){const[n,a]=o.useState([]),[r,l]=o.useState(!0),[c,i]=o.useState(!1);o.useEffect(()=>{s?.id&&u()},[s?.id,t]);const u=async()=>{try{l(!0);const p=t==="week"?7:t==="month"?30:14,v=await q.getDisposalLoadsHistory(s.id,p);a(v||[])}catch(p){console.error("Error loading disposal summary:",p)}finally{l(!1)}},m=n.reduce((p,v)=>{const g=v.load_type;return p[g]||(p[g]=0),p[g]+=v.load_count,p},{}),d=n.reduce((p,v)=>{const g=v.load_date||v.work_date;return p[g]||(p[g]={date:g,loads:[],total:0}),p[g].loads.push(v),p[g].total+=v.load_count,p},{}),h=Object.values(d).sort((p,v)=>new Date(v.date)-new Date(p.date)).slice(0,7),x=n.reduce((p,v)=>p+v.load_count,0),f=x>0;return r?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Ye,{size:18}),e.jsx("span",{children:"Disposal Loads"})]})}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Ye,{size:18}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("span",{className:"period-badge",children:t==="week"?"Last 7 days":t==="month"?"Last 30 days":"Last 14 days"})]}),f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"disposal-total-value",children:x}),e.jsx("span",{className:"disposal-total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:Cn.map(p=>{const v=m[p.value]||0;if(v===0)return null;const g=Math.round(v/x*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"disposal-type-info",children:[e.jsx("span",{className:"disposal-type-icon",children:p.icon}),e.jsx("span",{className:"disposal-type-label",children:p.label})]}),e.jsxs("div",{className:"disposal-type-stats",children:[e.jsx("span",{className:"disposal-type-count",children:v}),e.jsx("div",{className:"disposal-type-bar",children:e.jsx("div",{className:"disposal-type-bar-fill",style:{width:`${g}%`}})})]})]},p.value)})}),h.length>0&&e.jsxs("button",{className:"disposal-expand-btn",onClick:()=>i(!c),children:[c?e.jsx(tt,{size:16}):e.jsx(Qe,{size:16}),e.jsxs("span",{children:[c?"Hide":"View"," Daily Breakdown"]})]}),c&&h.length>0&&e.jsx("div",{className:"disposal-daily-breakdown",children:h.map(p=>{const v=new Date(p.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),g=p.loads.reduce((T,y)=>(T[y.load_type]||(T[y.load_type]=0),T[y.load_type]+=y.load_count,T),{});return e.jsxs("div",{className:"disposal-daily-row",children:[e.jsxs("div",{className:"disposal-daily-header",children:[e.jsx("span",{className:"disposal-daily-date",children:v}),e.jsxs("span",{className:"disposal-daily-total",children:[p.total," loads"]})]}),e.jsx("div",{className:"disposal-daily-types",children:Object.entries(g).map(([T,y])=>{const A=no(T);return e.jsxs("span",{className:"disposal-daily-type",children:[A.icon," ",y]},T)})})]},p.date)})})]}):e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx(Ye,{size:32}),e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("span",{className:"text-muted",children:"Loads will appear here when logged by field crews"})]})]})}const Ct=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",io=o.memo(function({project:t,onAddEquipment:n,onEditEquipment:a,onShowToast:r}){const[l,c]=o.useState([]),[i,u]=o.useState(!0),[m,d]=o.useState(!0),[h,x]=o.useState(0),f=o.useCallback(async()=>{if(t?.id)try{u(!0);const y=await ns.getProjectEquipment(t.id);c(y||[]);const A=ns.calculateProjectEquipmentCost(y||[]);x(A)}catch(y){console.error("Error loading equipment:",y),r?.("Failed to load equipment","error")}finally{u(!1)}},[t?.id]);o.useEffect(()=>{f()},[f]);const p=o.useCallback(async y=>{try{await ns.markEquipmentReturned(y.id),r?.(`${y.equipment_name} marked as returned`,"success"),f()}catch(A){console.error("Error marking equipment returned:",A),r?.("Failed to update equipment","error")}},[f]),v=o.useCallback(async y=>{if(confirm(`Remove ${y.equipment_name} from this project?`))try{await ns.removeEquipmentFromProject(y.id),r?.("Equipment removed","success"),f()}catch(A){console.error("Error removing equipment:",A),r?.("Failed to remove equipment","error")}},[f]),g=o.useMemo(()=>l.filter(y=>!y.end_date),[l]),T=o.useMemo(()=>l.filter(y=>y.end_date),[l]);return e.jsxs("div",{className:"project-equipment-card",children:[e.jsxs("div",{className:"project-equipment-header",children:[e.jsxs("div",{className:"project-equipment-title",children:[e.jsx(Ye,{size:18}),e.jsx("h3",{children:"Equipment on Site"}),l.length>0&&e.jsxs("span",{className:"equipment-count",children:[g.length," active"]})]}),e.jsxs("div",{className:"project-equipment-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>n?.(),title:"Add equipment",children:[e.jsx(Ns,{size:14}),e.jsx("span",{children:"Add"})]}),l.length>0&&e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>d(!m),children:m?e.jsx(tt,{size:16}):e.jsx(Qe,{size:16})})]})]}),i?e.jsx("div",{className:"equipment-loading",children:e.jsx("div",{className:"loading-spinner small"})}):l.length===0?e.jsxs("div",{className:"equipment-empty",children:[e.jsx("p",{children:"No equipment tracked on this project"}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>n?.(),children:[e.jsx(Ns,{size:14}),"Track Equipment"]})]}):m?e.jsxs(e.Fragment,{children:[g.length>0&&e.jsx("div",{className:"equipment-list",children:g.map(y=>{const A=ns.calculateDaysOnSite(y.start_date,y.end_date),j=y.daily_rate*A;return e.jsxs("div",{className:"equipment-item active",children:[e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:y.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[e.jsx(st,{size:12}),"On-site since ",Ct(y.start_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-rate",children:[we(y.daily_rate),"/day"]}),e.jsxs("span",{className:"equipment-days",children:[A," days"]}),e.jsx("span",{className:"equipment-total",children:we(j)})]})]}),e.jsxs("div",{className:"equipment-item-actions",children:[e.jsxs("button",{className:"btn btn-xs btn-outline",onClick:()=>p(y),title:"Mark as returned",children:[e.jsx(Yi,{size:12}),"Returned"]}),e.jsx("button",{className:"btn btn-xs btn-ghost",onClick:()=>a?.(y),title:"Edit",children:e.jsx(Ji,{size:12})}),e.jsx("button",{className:"btn btn-xs btn-ghost text-danger",onClick:()=>v(y),title:"Remove",children:e.jsx(pn,{size:12})})]})]},y.id)})}),T.length>0&&e.jsxs("details",{className:"equipment-returned-section",children:[e.jsx("summary",{className:"equipment-returned-toggle",children:e.jsxs("span",{children:["Returned Equipment (",T.length,")"]})}),e.jsx("div",{className:"equipment-list returned",children:T.map(y=>{const A=ns.calculateDaysOnSite(y.start_date,y.end_date),j=y.daily_rate*A;return e.jsx("div",{className:"equipment-item returned",children:e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:y.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[Ct(y.start_date)," - ",Ct(y.end_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-days",children:[A," days"]}),e.jsx("span",{className:"equipment-total",children:we(j)})]})]})},y.id)})})]}),e.jsxs("div",{className:"equipment-total-row",children:[e.jsx("span",{children:"Total Equipment Cost"}),e.jsx("span",{className:"equipment-grand-total",children:we(h)})]})]}):e.jsxs("div",{className:"equipment-summary-collapsed",children:[e.jsxs("span",{children:[g.length," active, ",T.length," returned"]}),e.jsx("span",{className:"equipment-grand-total",children:we(h)})]})]})}),lo=o.memo(function({project:t,areas:n=[],corStats:a={},onCreateDraw:r,onViewDraw:l,onShowToast:c}){const[i,u]=o.useState([]),[m,d]=o.useState(!0),h=o.useMemo(()=>n.reduce((j,F)=>{const _=(F.square_footage||0)*(F.price_per_sqft||0);return j+Math.round(_*100)},0),[n]),x=o.useMemo(()=>a?.approvedTotal||0,[a?.approvedTotal]),f=h+x,p=o.useCallback(async()=>{if(t?.id)try{d(!0);const j=await Fi.getProjectDrawRequests(t.id);u(j||[])}catch(j){console.error("Error loading draw requests:",j)}finally{d(!1)}},[t?.id]);o.useEffect(()=>{p()},[p]);const v=o.useMemo(()=>{const j=i.filter(S=>["submitted","approved","paid"].includes(S.status)),F=j.reduce((S,D)=>S+(D.previous_billings||0)+(D.current_billing||0),0),L=j[0]?.retention_held||0;return{billedToDate:F,retentionHeld:L}},[i]),g=f>0?Math.round(v.billedToDate/f*100):0,T=i.length>0?Math.max(...i.map(j=>j.draw_number))+1:1,y=j=>j?new Date(j).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",A=j=>{switch(j){case"draft":return e.jsx("span",{className:"badge badge-muted",children:"Draft"});case"submitted":return e.jsx("span",{className:"badge badge-warning",children:"Submitted"});case"approved":return e.jsx("span",{className:"badge badge-success",children:"Approved"});case"paid":return e.jsx("span",{className:"badge badge-info",children:"Paid"});case"rejected":return e.jsx("span",{className:"badge badge-danger",children:"Rejected"});default:return null}};return e.jsxs("div",{className:"progress-billing-card",children:[e.jsxs("div",{className:"progress-billing-header",children:[e.jsxs("div",{className:"progress-billing-title",children:[e.jsx(Xi,{size:18}),e.jsx("h3",{children:"Progress Billing"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>r?.(),disabled:h===0,title:h===0?"Add areas with contract values first":`Create Draw #${T}`,children:[e.jsx(Ns,{size:14}),e.jsxs("span",{children:["Draw #",T]})]})]}),e.jsxs("div",{className:"progress-billing-contract",children:[e.jsxs("div",{className:"contract-row",children:[e.jsx("span",{className:"contract-label",children:"Original Contract"}),e.jsx("span",{className:"contract-value",children:we(h)})]}),x>0&&e.jsxs("div",{className:"contract-row co",children:[e.jsx("span",{className:"contract-label",children:"Approved COs"}),e.jsxs("span",{className:"contract-value positive",children:["+",we(x)]})]}),e.jsxs("div",{className:"contract-row revised",children:[e.jsx("span",{className:"contract-label",children:"Revised Contract"}),e.jsx("span",{className:"contract-value",children:we(f)})]})]}),e.jsxs("div",{className:"progress-billing-status",children:[e.jsx("div",{className:"billing-progress-bar",children:e.jsx("div",{className:"billing-progress-fill",style:{width:`${Math.min(g,100)}%`}})}),e.jsxs("div",{className:"billing-stats",children:[e.jsxs("div",{className:"billing-stat",children:[e.jsx("span",{className:"billing-stat-value",children:we(v.billedToDate)}),e.jsxs("span",{className:"billing-stat-label",children:["Billed to Date (",g,"%)"]})]}),v.retentionHeld>0&&e.jsxs("div",{className:"billing-stat retention",children:[e.jsxs("span",{className:"billing-stat-value",children:["-",we(v.retentionHeld)]}),e.jsx("span",{className:"billing-stat-label",children:"Retention Held"})]}),e.jsxs("div",{className:"billing-stat remaining",children:[e.jsx("span",{className:"billing-stat-value",children:we(f-v.billedToDate)}),e.jsx("span",{className:"billing-stat-label",children:"Balance to Finish"})]})]})]}),m?e.jsx("div",{className:"progress-billing-loading",children:e.jsx("div",{className:"loading-spinner small"})}):i.length===0?e.jsxs("div",{className:"progress-billing-empty",children:[e.jsx("p",{children:"No draw requests yet"}),h>0&&e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>r?.(),children:[e.jsx(Ns,{size:14}),"Create First Draw Request"]})]}):e.jsxs("div",{className:"progress-billing-draws",children:[e.jsx("div",{className:"draws-header",children:e.jsx("span",{children:"Recent Draws"})}),e.jsx("div",{className:"draws-list",children:i.slice(0,3).map(j=>e.jsxs("button",{className:"draw-item",onClick:()=>l?.(j),children:[e.jsxs("div",{className:"draw-item-info",children:[e.jsxs("span",{className:"draw-number",children:["Draw #",j.draw_number]}),e.jsx("span",{className:"draw-date",children:y(j.period_end||j.created_at)})]}),e.jsx("div",{className:"draw-item-amount",children:we(j.current_billing||0)}),A(j.status),e.jsx(Ve,{size:16,className:"draw-item-arrow"})]},j.id))}),i.length>3&&e.jsxs("button",{className:"btn btn-sm btn-ghost view-all-draws",children:["View all ",i.length," draws"]})]})]})});function co({project:s,company:t,onShowToast:n}){const[a,r]=o.useState(null),[l,c]=o.useState(!0),[i,u]=o.useState(!1);o.useEffect(()=>{if(s?.id&&t?.id){m();const p=q.subscribeToCrewCheckins?.(s.id,()=>{m()});return()=>{p&&q.unsubscribe?.(p)}}},[s?.id,t?.id]);const m=async()=>{try{const p=await q.calculateManDayCosts(s.id,t.id,s.work_type||"demolition",s.job_type||"standard");r(p)}catch(p){console.error("Error loading man day costs:",p)}finally{c(!1)}},d=p=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(p),h=p=>new Date(p).toLocaleDateString("en-US",{month:"short",day:"numeric"}),x=p=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[p]||p.charAt(0).toUpperCase()+p.slice(1);if(l)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!a||a.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Ge,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const f=Object.entries(a.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>u(!i),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:d(a.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:i?"▼ Collapse":"▶ Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:d(a.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.daysWorked>0?d(a.totalCost/a.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),i&&e.jsxs("div",{className:"man-day-details",children:[f.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:f.map(([p,v])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:x(p)}),e.jsxs("span",{className:"role-rate",children:[d(v.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[v.count," days"]}),e.jsx("span",{className:"role-cost",children:d(v.cost)})]})]},p))})]}),a.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:a.byDate.slice(0,7).map((p,v)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:h(p.date)}),e.jsxs("span",{className:"date-workers",children:[p.workers," crew"]}),e.jsx("span",{className:"date-cost",children:d(p.cost)})]},v))}),a.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",a.byDate.length-7," more days"]})]})]})]})}const Ee=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),oo=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"});function uo({dailyBurn:s,totalBurn:t,daysWorked:n,laborCost:a,materialsEquipmentCost:r=0,disposalCost:l=0,customCostTotal:c=0,progress:i,contractValue:u,laborByDate:m=[],materialsEquipmentByDate:d=[]}){const[h,x]=o.useState(!1),f=u*(i/100)*.6,p=t<=f?"on-budget":t<=f*1.2?"warning":"over-budget",v={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[p],g=p==="on-budget"?ps:p==="warning"?zt:hs,y=i>0?t/(i/100):0,A=[],j={};m.forEach(_=>{j[_.date]||(j[_.date]={date:_.date,labor:0,materialsEquipment:0,total:0}),j[_.date].labor=_.cost||0,j[_.date].total+=_.cost||0}),d.forEach(_=>{j[_.date]||(j[_.date]={date:_.date,labor:0,materialsEquipment:0,total:0}),j[_.date].materialsEquipment=_.cost||0,j[_.date].total+=_.cost||0}),Object.values(j).sort((_,L)=>new Date(L.date)-new Date(_.date)).slice(0,10).forEach(_=>A.push(_));const F=Math.max(...A.map(_=>_.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(Qi,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${p}`,children:[e.jsx(g,{size:14}),e.jsx("span",{children:v})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:Ee(s)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),n>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",n," work day",n!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:Ee(t)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:Ee(a)})]}),l>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Disposal"}),e.jsx("span",{className:"burn-summary-value",children:Ee(l)})]})]}),r>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Materials & Equip"}),e.jsx("span",{className:"burn-summary-value",children:Ee(r)})]})]}),c>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Other"}),e.jsx("span",{className:"burn-summary-value",children:Ee(c)})]})]})]}),i>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${y>u*.7?"warning":""}`,children:Ee(y)})]}),A.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>x(!h),children:[h?e.jsx(tt,{size:16}):e.jsx(Qe,{size:16}),e.jsxs("span",{children:[h?"Hide":"View"," Daily Breakdown"]})]}),h&&A.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Materials"}),e.jsx("span",{children:"Total"})]}),A.map(_=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:oo(_.date)}),e.jsx("span",{className:"burn-labor",children:_.labor>0?Ee(_.labor):"-"}),e.jsx("span",{className:"burn-materials",children:_.materialsEquipment>0?Ee(_.materialsEquipment):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${_.total/F*100}%`}}),e.jsx("span",{className:"burn-amount",children:Ee(_.total)})]})]},_.date))]})]})}const mo=()=>de(()=>import("./pdf-Dbgi5wV4.js").then(s=>s.j),[]);function ho({project:s,company:t,onShowToast:n}){const{branding:a}=cn(),[r,l]=o.useState([]),[c,i]=o.useState(!0),[u,m]=o.useState(null),[d,h]=o.useState(null),[x,f]=o.useState(new Set),[p,v]=o.useState(!1),[g,T]=o.useState("recent"),[y,A]=o.useState(new Set),[j,F]=o.useState({start:"",end:""});o.useEffect(()=>{_();const N=q.subscribeToDailyReports?.(s.id,()=>{_()});return()=>{N&&q.unsubscribe?.(N)}},[s.id]);const _=o.useCallback(async()=>{try{m(null);const N=await q.getDailyReports(s.id,365);l(N||[])}catch(N){console.error("Error loading daily reports:",N),m(N),n?.("Error loading daily reports","error")}finally{i(!1)}},[s.id]),L=o.useMemo(()=>{let N=[...r];if(j.start){const C=new Date(j.start);C.setHours(0,0,0,0),N=N.filter(Y=>new Date(Y.report_date||Y.created_at)>=C)}if(j.end){const C=new Date(j.end);C.setHours(23,59,59,999),N=N.filter(Y=>new Date(Y.report_date||Y.created_at)<=C)}if(g==="recent"){const C=new Date;C.setDate(C.getDate()-7),C.setHours(0,0,0,0),N=N.filter(Y=>new Date(Y.report_date||Y.created_at)>=C)}return N},[r,g,j]),S=o.useMemo(()=>{if(g!=="all")return null;const N={};return L.forEach(C=>{const Y=new Date(C.report_date||C.created_at),E=`${Y.getFullYear()}-${String(Y.getMonth()+1).padStart(2,"0")}`,J=Y.toLocaleDateString("en-US",{month:"long",year:"numeric"});N[E]||(N[E]={label:J,reports:[]}),N[E].reports.push(C)}),Object.entries(N).sort((C,Y)=>Y[0].localeCompare(C[0]))},[L,g]);o.useEffect(()=>{if(S&&S.length>0){const N=S[0][0];A(new Set([N]))}},[S]);const D=()=>{v(!p),p&&f(new Set)},b=N=>{const C=new Set(x);C.has(N)?C.delete(N):C.add(N),f(C)},I=()=>{x.size===L.length?f(new Set):f(new Set(L.map(N=>N.id)))},M=N=>{const C=new Set(y);C.has(N)?C.delete(N):C.add(N),A(C)},V=()=>x.size>0?L.filter(N=>x.has(N.id)):L,P=N=>new Date(N).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),W=N=>new Date(N).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),$=N=>{switch(N){case"submitted":return"✓";case"reviewed":return"✓✓";case"draft":return"○";default:return"○"}},ee=N=>{switch(N){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return N}},le=async()=>{const N=V();if(N.length===0){n?.("No reports to export","error");return}n?.("Generating PDF...","info");const Y=(await mo()).default,E=new Y,J=E.internal.pageSize.getWidth(),X=20;let ae=X;const De=bs(a?.primary_color||"#3B82F6"),Ze=bs(a?.secondary_color||"#1E40AF");E.setFillColor(...De),E.rect(0,0,J,45,"F"),E.setFillColor(...Ze),E.rect(0,42,J,3,"F");let Te=X;if(a?.logo_url)try{const se=await on(a.logo_url);se&&(E.addImage(se,"PNG",X,7,30,30),Te=X+40)}catch(se){console.error("Error adding logo:",se)}E.setTextColor(255,255,255),E.setFontSize(22),E.setFont("helvetica","bold"),E.text(t?.name||"Company Name",Te,20),E.setFontSize(10),E.setFont("helvetica","normal"),E.text("DAILY REPORTS SUMMARY",Te,30),E.setFontSize(9),E.text(`Generated: ${new Date().toLocaleDateString()}`,J-X,20,{align:"right"}),s.job_number&&E.text(`Job #: ${s.job_number}`,J-X,28,{align:"right"}),ae=55,E.setFillColor(248,250,252),E.rect(X,ae-5,J-X*2,20,"F"),E.setTextColor(...De),E.setFontSize(14),E.setFont("helvetica","bold"),E.text(`Project: ${s.name}`,X+5,ae+7),E.setFontSize(10),E.setTextColor(100,100,100),E.text(`${N.length} Report${N.length!==1?"s":""}`,J-X-5,ae+7,{align:"right"}),ae+=25,N.forEach((se,je)=>{ae>250&&(E.addPage(),ae=X),E.setFillColor(...De),E.setTextColor(255,255,255),E.rect(X,ae,J-X*2,10,"F"),E.setFontSize(11),E.setFont("helvetica","bold"),E.text(P(se.report_date||se.created_at),X+5,ae+7),E.text(ee(se.status),J-X-5,ae+7,{align:"right"}),ae+=15,E.setTextColor(50,50,50),E.setFontSize(10),E.setFont("helvetica","normal");const Ds=`Crew: ${se.crew_count||0}  |  Tasks: ${se.tasks_completed||0}  |  Time & Material: ${se.tm_tickets_count||0}  |  Photos: ${se.photos_count||0}`;if(E.text(Ds,X+5,ae),ae+=8,se.crew_list?.length>0){E.setFont("helvetica","bold"),E.text("Crew:",X+5,ae),E.setFont("helvetica","normal");const fe=se.crew_list.map(Ps=>`${Ps.name} (${Ps.role})`).join(", "),Es=E.splitTextToSize(fe,J-X*2-30);E.text(Es,X+25,ae),ae+=Es.length*5+3}if(se.field_notes){E.setFont("helvetica","bold"),E.text("Notes:",X+5,ae),E.setFont("helvetica","normal");const fe=E.splitTextToSize(se.field_notes,J-X*2-30);E.text(fe,X+25,ae),ae+=fe.length*5+3}if(se.issues){E.setTextColor(180,50,50),E.setFont("helvetica","bold"),E.text("Issues:",X+5,ae),E.setFont("helvetica","normal");const fe=E.splitTextToSize(se.issues,J-X*2-30);E.text(fe,X+25,ae),E.setTextColor(50,50,50),ae+=fe.length*5+3}ae+=10});const Z=E.internal.getNumberOfPages();for(let se=1;se<=Z;se++)E.setPage(se),E.setFontSize(8),E.setTextColor(150,150,150),E.text(`Page ${se} of ${Z}`,J/2,E.internal.pageSize.getHeight()-10,{align:"center"});const es=`${s.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;E.save(es),n?.("PDF exported!","success")},te=N=>e.jsxs("div",{className:`daily-report-card ${N.status} ${x.has(N.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>h(d===N.id?null:N.id),children:[p&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:x.has(N.id),onChange:C=>{C.stopPropagation(),b(N.id)},onClick:C=>C.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:P(N.report_date||N.created_at)}),e.jsxs("span",{className:`report-status ${N.status}`,children:[$(N.status)," ",ee(N.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[N.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[N.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:d===N.id?"▼":"▶"})]})]}),d===N.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:N.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:N.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:N.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"Time & Material"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:N.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),N.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:N.crew_list.map((C,Y)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:C.name}),e.jsx("span",{className:"crew-role",children:C.role})]},Y))})]}),N.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:N.completed_tasks.map((C,Y)=>e.jsxs("li",{children:[C.name,C.group&&e.jsx("span",{className:"task-group",children:C.group})]},Y))})]}),N.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:N.field_notes})]}),N.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:N.issues})]}),N.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",N.submitted_by||"Field"," at ",W(N.submitted_at)]})})]})]},N.id);if(c)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});if(u)return e.jsx("div",{className:"daily-reports-list card",children:e.jsx(wn,{title:"Unable to load reports",message:"There was a problem loading daily reports. Please try again.",error:u,onRetry:_})});const ve=r.length,O=L.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:r.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${p?"btn-primary":"btn-secondary"}`,onClick:D,children:p?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:le,children:["PDF",x.size>0?` (${x.size})`:""]})]})})]}),r.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${g==="recent"?"active":""}`,onClick:()=>T("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${g==="all"?"active":""}`,onClick:()=>T("all"),children:["All (",ve,")"]})]}),g==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(st,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:j.start,onChange:N=>F(C=>({...C,start:N.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:j.end,onChange:N=>F(C=>({...C,end:N.target.value})),className:"date-input"}),(j.start||j.end)&&e.jsx("button",{className:"date-clear",onClick:()=>F({start:"",end:""}),children:"Clear"})]})]}),p&&L.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:x.size===L.length&&L.length>0,onChange:I}),"Select All (",L.length,")"]}),x.size>0&&e.jsxs("span",{className:"selected-count",children:[x.size," selected"]})]}),r.length===0?e.jsx(Ka,{icon:xe,title:"No daily reports yet",message:"Reports from the field will appear here"}):L.length===0?e.jsx(Ka,{icon:xe,title:"No reports in this time period",message:g==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"}):g==="recent"?e.jsxs("div",{className:"daily-reports",children:[L.map(N=>te(N)),ve>O&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>T("all"),children:["View All ",ve," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:S?.map(([N,{label:C,reports:Y}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>M(N),children:[y.has(N)?e.jsx(Qe,{size:18,className:"month-chevron"}):e.jsx(Ve,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:C}),e.jsxs("span",{className:"month-count",children:[Y.length," report",Y.length!==1?"s":""]})]}),y.has(N)&&e.jsx("div",{className:"month-reports",children:Y.map(E=>te(E))})]},N))})]})}const Ja=o.memo(function({report:t,formatDate:n,formatTime:a,getInjuryTypeColor:r,getInjuryTypeLabel:l,getStatusColor:c,onViewDetails:i}){const u=()=>i(t),m=d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),i(t))};return e.jsxs("div",{className:"report-card",onClick:u,onKeyDown:m,role:"button",tabIndex:0,"aria-label":`Injury report for ${t.employee_name} on ${n(t.incident_date)}`,children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[n(t.incident_date)," at ",a(t.incident_time)]}),e.jsx("div",{className:"employee-name",children:t.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:r(t.injury_type)},children:l(t.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:c(t.status)},children:t.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",t.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",t.reported_by_name," (",t.reported_by_title,")"]}),t.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",t.body_part_affected]}),t.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[t.incident_description.substring(0,150),t.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]})}),po=()=>de(()=>import("./pdf-Dbgi5wV4.js").then(s=>s.j),[]);function xo({project:s,companyId:t,company:n,user:a,onShowToast:r}){const{branding:l}=cn(),[c,i]=o.useState([]),[u,m]=o.useState(null),[d,h]=o.useState(!1),[x,f]=o.useState(!0),[p,v]=o.useState(null),[g,T]=o.useState(null),[y,A]=o.useState("recent"),[j,F]=o.useState(new Set),[_,L]=o.useState({start:"",end:""});o.useEffect(()=>{S();const O=t||s?.company_id,N=O?q.subscribeToInjuryReports?.(O,()=>{S()}):null;return()=>{N&&q.unsubscribe?.(N)}},[s?.id,t]);const S=o.useCallback(async()=>{f(!0),v(null);try{const O=s?await q.getInjuryReports(s.id):await q.getCompanyInjuryReports(t);i(O)}catch(O){console.error("Error loading injury reports:",O),v(O),T({type:"error",message:"Failed to load injury reports"})}finally{f(!1)}},[s?.id,t]),D=()=>{S(),h(!1),T({type:"success",message:"Injury report created successfully"})},b=O=>{m(O)},I=()=>{m(null)},M=O=>O?new Date(O).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",V=O=>O?new Date(`2000-01-01T${O}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",P=O=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[O]||O,W=O=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[O]||"#9ca3af",$=O=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[O]||"#9ca3af",ee=o.useMemo(()=>{let O=[...c];if(_.start){const N=new Date(_.start);N.setHours(0,0,0,0),O=O.filter(C=>new Date(C.incident_date)>=N)}if(_.end){const N=new Date(_.end);N.setHours(23,59,59,999),O=O.filter(C=>new Date(C.incident_date)<=N)}if(y==="recent"){const N=new Date;N.setDate(N.getDate()-7),N.setHours(0,0,0,0),O=O.filter(C=>new Date(C.incident_date)>=N)}return O},[c,y,_]),le=o.useMemo(()=>{if(y!=="all")return null;const O={};return ee.forEach(N=>{const C=new Date(N.incident_date),Y=`${C.getFullYear()}-${String(C.getMonth()+1).padStart(2,"0")}`,E=C.toLocaleDateString("en-US",{month:"long",year:"numeric"});O[Y]||(O[Y]={label:E,reports:[]}),O[Y].reports.push(N)}),Object.entries(O).sort((N,C)=>C[0].localeCompare(N[0]))},[ee,y]);o.useEffect(()=>{if(le&&le.length>0){const O=le[0][0];F(new Set([O]))}},[le]);const te=O=>{const N=new Set(j);N.has(O)?N.delete(O):N.add(O),F(N)},ve=async()=>{if(c.length===0){T({type:"error",message:"No reports to export"});return}T({type:"info",message:"Generating PDF..."});const N=(await po()).default,C=new N,Y=C.internal.pageSize.getWidth(),E=20;let J=E;const X=bs(l?.primary_color||"#3B82F6"),ae=bs(l?.secondary_color||"#1E40AF");C.setFillColor(...X),C.rect(0,0,Y,45,"F"),C.setFillColor(...ae),C.rect(0,42,Y,3,"F");let De=E;if(l?.logo_url)try{const Z=await on(l.logo_url);Z&&(C.addImage(Z,"PNG",E,7,30,30),De=E+40)}catch(Z){console.error("Error adding logo:",Z)}C.setTextColor(255,255,255),C.setFontSize(22),C.setFont("helvetica","bold"),C.text(n?.name||"Company",De,20),C.setFontSize(10),C.setFont("helvetica","normal"),C.text("INJURY & INCIDENT REPORTS",De,30),C.setFontSize(9),C.text(`Generated: ${new Date().toLocaleDateString()}`,Y-E,20,{align:"right"}),C.text(`Total Reports: ${c.length}`,Y-E,28,{align:"right"}),J=55,s&&(C.setFillColor(248,250,252),C.rect(E,J-5,Y-E*2,15,"F"),C.setTextColor(...X),C.setFontSize(12),C.setFont("helvetica","bold"),C.text(`Project: ${s.name}`,E+5,J+5),J+=20),c.forEach(Z=>{J>200&&(C.addPage(),J=E);const es=bs($(Z.injury_type));C.setFillColor(...es),C.rect(E,J,Y-E*2,12,"F"),C.setTextColor(255,255,255),C.setFontSize(11),C.setFont("helvetica","bold"),C.text(`${Z.employee_name} - ${P(Z.injury_type)}`,E+5,J+8),C.text(M(Z.incident_date),Y-E-5,J+8,{align:"right"}),J+=17,C.setTextColor(50,50,50),C.setFontSize(9),C.setFont("helvetica","normal"),C.text(`Location: ${Z.incident_location}`,E+5,J),Z.incident_time&&C.text(`Time: ${V(Z.incident_time)}`,E+100,J),J+=6,C.setFont("helvetica","bold"),C.text("Description:",E+5,J),C.setFont("helvetica","normal"),J+=5;const se=C.splitTextToSize(Z.incident_description,Y-E*2-10);C.text(se,E+5,J),J+=se.length*4+3;const je=[];Z.body_part_affected&&je.push(`Body Part: ${Z.body_part_affected}`),Z.osha_recordable&&je.push("OSHA Recordable"),Z.workers_comp_claim&&je.push("Workers' Comp Filed"),Z.medical_treatment_required&&je.push("Medical Treatment Required"),je.length>0&&(C.setFontSize(8),C.setTextColor(100,100,100),C.text(je.join("  |  "),E+5,J),J+=5),C.setFontSize(8),C.text(`Reported by: ${Z.reported_by_name} (${Z.reported_by_title})`,E+5,J),J+=12});const Ze=C.internal.getNumberOfPages();for(let Z=1;Z<=Ze;Z++)C.setPage(Z),C.setFontSize(8),C.setTextColor(150,150,150),C.text(`Page ${Z} of ${Ze}`,Y/2,C.internal.pageSize.getHeight()-10,{align:"center"}),C.text("CONFIDENTIAL - Injury Report",E,C.internal.pageSize.getHeight()-10);const Te=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;C.save(Te),T({type:"success",message:"PDF exported!"})};return x?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):p?e.jsx("div",{className:"injury-reports-section card",children:e.jsx(wn,{title:"Unable to load reports",message:"There was a problem loading injury reports. Please try again.",error:p,onRetry:S})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[c.length>0&&e.jsx("button",{className:"btn-secondary",onClick:ve,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>h(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${y==="recent"?"active":""}`,onClick:()=>{A("recent"),L({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${y==="all"?"active":""}`,onClick:()=>A("all"),children:["All (",c.length,")"]})]}),y==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(st,{size:16}),e.jsx("input",{type:"date",value:_.start,onChange:O=>L(N=>({...N,start:O.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:_.end,onChange:O=>L(N=>({...N,end:O.target.value})),placeholder:"End date"}),(_.start||_.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>L({start:"",end:""}),children:"Clear"})]})]}),ee.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:"🏥"}),e.jsxs("h4",{children:["No Injury Reports",y==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),y==="recent"&&c.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>A("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:y==="all"&&le?le.map(([O,N])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>te(O),children:e.jsxs("div",{className:"month-header-left",children:[j.has(O)?e.jsx(Qe,{size:18}):e.jsx(Ve,{size:18}),e.jsx("span",{className:"month-label",children:N.label}),e.jsxs("span",{className:"month-count",children:[N.reports.length," reports"]})]})}),j.has(O)&&e.jsx("div",{className:"month-reports",children:N.reports.map(C=>e.jsx(Ja,{report:C,formatDate:M,formatTime:V,getInjuryTypeColor:$,getInjuryTypeLabel:P,getStatusColor:W,onViewDetails:b},C.id))})]},O)):ee.map(O=>e.jsx(Ja,{report:O,formatDate:M,formatTime:V,getInjuryTypeColor:$,getInjuryTypeLabel:P,getStatusColor:W,onViewDetails:b},O.id))}),u&&e.jsx("div",{className:"modal-overlay",onClick:I,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:O=>O.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:I,children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[M(u.incident_date)," at ",V(u.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:u.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:$(u.injury_type)},children:P(u.injury_type)})})]}),u.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:u.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:u.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:u.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:u.employee_job_title})]}),u.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:u.employee_phone})]}),u.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:u.employee_email})]}),u.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:u.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:u.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:u.reported_by_title})]}),u.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:u.reported_by_phone})]}),u.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:u.reported_by_email})]})]})]}),u.witnesses&&u.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),u.witnesses.map((O,N)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:O.name}),O.phone&&e.jsxs("span",{children:[" • ",O.phone]}),O.email&&e.jsxs("span",{children:[" • ",O.email]})]}),O.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',O.testimony,'"']})})]},N))]}),u.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[u.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:u.medical_facility_name})]}),u.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:u.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:u.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),u.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:u.immediate_actions_taken})]}),u.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:u.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[u.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:u.safety_equipment_used})]}),u.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:u.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:u.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:u.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:u.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:u.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",M(u.created_at)]})]})]})}),d&&e.jsx(Ai,{project:s,companyId:t,user:a,onClose:()=>h(!1),onReportCreated:D}),g&&e.jsx(Mi,{message:g.message,type:g.type,onClose:()=>T(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const Xa=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function vo({project:s,company:t,user:n,isAdmin:a,onShowToast:r}){const[l,c]=o.useState([]),[i,u]=o.useState([]),[m,d]=o.useState(!0),[h,x]=o.useState(!1),[f,p]=o.useState(""),[v,g]=o.useState("Team Member"),[T,y]=o.useState(null);o.useEffect(()=>{s?.id&&A()},[s?.id]),o.useEffect(()=>{h&&t?.id&&j()},[h,t?.id]);const A=async()=>{try{d(!0);const S=await q.getProjectTeam(s.id);c(S)}catch(S){console.error("Error loading project team:",S),r("Error loading project team","error")}finally{d(!1)}},j=async()=>{try{const S=await q.getCompanyMembers(t.id),D=l.map(I=>I.users?.id),b=S.filter(I=>!D.includes(I.users?.id));u(b)}catch(S){console.error("Error loading company members:",S),r("Error loading company members","error")}},F=async()=>{if(!f){r("Select a team member","error");return}try{y("add"),await q.addProjectMember(s.id,f,v,n.id),r("Team member added","success"),x(!1),p(""),g("Team Member"),A()}catch(S){console.error("Error adding team member:",S),r("Error adding team member","error")}finally{y(null)}},_=async(S,D)=>{try{y(S.id),await q.updateProjectMemberRole(s.id,S.users?.id,D),r("Role updated","success"),A()}catch(b){console.error("Error updating role:",b),r("Error updating role","error")}finally{y(null)}},L=async S=>{try{y(S.id),await q.removeProjectMember(s.id,S.users?.id),r("Team member removed","success"),A()}catch(D){console.error("Error removing team member:",D),r("Error removing team member","error")}finally{y(null)}};return m?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Project Team"]}),a&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>x(!0),children:[e.jsx(Zi,{size:14})," Add"]})]}),l.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",a&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:l.map(S=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:S.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:S.users?.email})]}),e.jsx("div",{className:"team-member-role",children:a?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:S.project_role,onChange:D=>_(S,D.target.value),disabled:T===S.id,className:"role-select",children:Xa.map(D=>e.jsx("option",{value:D,children:D},D))}),e.jsx(Qe,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:S.project_role})}),a&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>L(S),disabled:T===S.id,title:"Remove from project",children:e.jsx(el,{size:14})})]},S.id))}),h&&e.jsx("div",{className:"modal-overlay",onClick:()=>x(!1),children:e.jsxs("div",{className:"modal-content small",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:e.jsx(ms,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:f,onChange:S=>p(S.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),i.map(S=>e.jsx("option",{value:S.users?.id,children:S.users?.name||S.users?.email},S.users?.id))]}),i.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:v,onChange:S=>g(S.target.value),className:"form-select",children:Xa.map(S=>e.jsx("option",{value:S,children:S},S))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:F,disabled:!f||T==="add",children:T==="add"?"Adding...":"Add to Project"})]})]})})]})}function jo({onShowToast:s,onClose:t}){const[n,a]=o.useState("loading"),[r,l]=o.useState([]),[c,i]=o.useState(null),[u,m]=o.useState(null),[d,h]=o.useState(null),[x,f]=o.useState(""),[p,v]=o.useState(!1),[g,T]=o.useState(!1),[y,A]=o.useState(null);o.useEffect(()=>{j()},[]);const j=async()=>{try{const{data:b,error:I}=await js.auth.mfa.listFactors();if(I)throw I;const M=(b?.totp||[]).filter(V=>V.status==="verified");l(M),a("overview")}catch{a("overview")}},F=async()=>{A(null);try{const{data:b,error:I}=await js.auth.mfa.enroll({factorType:"totp",friendlyName:"FieldSync Authenticator"});if(I)throw I;if(!b?.totp)throw new Error("MFA enrollment response missing TOTP data");i(b.totp.qr_code),m(b.totp.secret),h(b.id),a("enroll")}catch(b){A(b.message),s?.("Failed to start MFA enrollment","error")}},_=async()=>{if(x.length===6){v(!0),A(null);try{const{data:b,error:I}=await js.auth.mfa.challenge({factorId:d});if(I)throw I;const{error:M}=await js.auth.mfa.verify({factorId:d,challengeId:b.id,code:x});if(M)throw M;a("success"),s?.("MFA enabled successfully!","success"),await j()}catch{A("Invalid code. Please try again."),f("")}finally{v(!1)}}},L=async b=>{try{const{error:I}=await js.auth.mfa.unenroll({factorId:b});if(I)throw I;s?.("MFA disabled","success"),await j()}catch{s?.("Failed to disable MFA","error")}},S=()=>{navigator.clipboard.writeText(u),T(!0),setTimeout(()=>T(!1),2e3)},D=r.length>0;return e.jsxs("div",{className:"mfa-setup",children:[e.jsxs("div",{className:"mfa-header",children:[e.jsxs("div",{className:"mfa-title",children:[D?e.jsx(yt,{size:20,className:"text-success"}):e.jsx(Dt,{size:20}),e.jsx("h3",{children:"Two-Factor Authentication"})]}),t&&e.jsx("button",{className:"close-btn",onClick:t,"aria-label":"Close",children:e.jsx(ms,{size:20})})]}),n==="loading"&&e.jsxs("div",{className:"mfa-loading",children:[e.jsx(Ta,{size:24,className:"spinner"})," Loading..."]}),n==="overview"&&e.jsxs("div",{className:"mfa-overview",children:[e.jsx("p",{className:"mfa-description",children:"Add an extra layer of security to your account. When enabled, you will need to enter a code from your authenticator app each time you sign in."}),D?e.jsxs("div",{className:"mfa-status mfa-status-enabled",children:[e.jsx(yt,{size:18}),e.jsx("span",{children:"MFA is enabled"}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>L(r[0].id),children:[e.jsx(Fa,{size:14})," Disable"]})]}):e.jsxs("div",{className:"mfa-status mfa-status-disabled",children:[e.jsx(Fa,{size:18}),e.jsx("span",{children:"MFA is not enabled"}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:F,children:[e.jsx(Dt,{size:14})," Enable MFA"]})]})]}),n==="enroll"&&e.jsxs("div",{className:"mfa-enroll",children:[e.jsx("p",{children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):"}),c&&e.jsx("div",{className:"mfa-qr-container",children:e.jsx("img",{src:c,alt:"MFA QR Code",className:"mfa-qr"})}),e.jsxs("div",{className:"mfa-secret",children:[e.jsx("span",{className:"mfa-secret-label",children:"Or enter this key manually:"}),e.jsxs("div",{className:"mfa-secret-value",children:[e.jsx("code",{children:u}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:S,"aria-label":"Copy secret key",children:g?e.jsx(mn,{size:14}):e.jsx(sl,{size:14})})]})]}),e.jsxs("div",{className:"mfa-verify-section",children:[e.jsx("label",{htmlFor:"mfa-verify-code",children:"Enter the 6-digit code from your app:"}),e.jsxs("div",{className:"mfa-code-input",children:[e.jsx("input",{id:"mfa-verify-code",type:"text",value:x,onChange:b=>f(b.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,autoFocus:!0,inputMode:"numeric",pattern:"[0-9]*"}),e.jsx("button",{className:"btn btn-primary",onClick:_,disabled:x.length!==6||p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ta,{size:14,className:"spinner"})," Verifying..."]}):"Verify & Enable"})]}),y&&e.jsx("p",{className:"mfa-error",children:y})]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>a("overview"),children:"Cancel"})]}),n==="success"&&e.jsxs("div",{className:"mfa-success",children:[e.jsx(yt,{size:48,className:"text-success"}),e.jsx("h4",{children:"MFA Enabled"}),e.jsx("p",{children:"Your account is now protected with two-factor authentication."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>a("overview"),children:"Done"})]})]})}function fo({contractValue:s=0,changeOrderValue:t=0,progressPercent:n=0,actualCosts:a=0,startDate:r,endDate:l,areas:c=[]}){const i=s+t,u=n/100*i,m=go(i,r,l),d=a,h=d>0?u/d:1,x=m>0?u/m:1,f=u-d,p=u-m,v=h>0?i/h:i*2,g=Math.max(0,v-d),T=i-v,y=i-u,A=i-d,j=A>0?y/A:999,F=yo(r,l,x),_=No(h,x);return{bac:i,earnedValue:u,plannedValue:m,actualCost:d,cpi:rs(h,2),spi:rs(x,2),costVariance:f,scheduleVariance:p,eac:Math.round(v),etc:Math.round(g),vac:Math.round(T),tcpi:rs(j,2),projectedEndDate:F,percentScheduled:bo(r,l),percentComplete:n,healthStatus:_,cpiLabel:wo(h),spiLabel:Co(x),budgetUtilization:i>0?rs(d/i*100,1):0,earnedPercent:i>0?rs(u/i*100,1):0}}function go(s,t,n){if(!t||!n)return 0;const a=new Date(t),r=new Date(n),l=new Date,c=r-a;if(c<=0)return s;const i=l-a;return Math.min(1,Math.max(0,i/c))*s}function bo(s,t){if(!s||!t)return 0;const n=new Date(s),a=new Date(t),r=new Date,l=a-n;if(l<=0)return 100;const c=r-n;return rs(Math.min(100,Math.max(0,c/l*100)),1)}function yo(s,t,n){if(!s||!t||n<=0)return null;const a=new Date(s),c=(new Date(t)-a)/(1e3*60*60*24)/n;return new Date(a.getTime()+c*24*60*60*1e3).toISOString().split("T")[0]}function No(s,t){return s>=.95&&t>=.95?"healthy":s>=.85&&t>=.85?"watch":s>=.7&&t>=.7?"warning":"critical"}function wo(s){return s>=1.05?"Under Budget":s>=.95?"On Budget":s>=.85?"Slightly Over":"Over Budget"}function Co(s){return s>=1.05?"Ahead of Schedule":s>=.95?"On Schedule":s>=.85?"Slightly Behind":"Behind Schedule"}function rs(s,t){const n=Math.pow(10,t);return Math.round(s*n)/n}function ko({contractValue:s=0,changeOrderValue:t=0,progressPercent:n=0,actualCosts:a=0,startDate:r,endDate:l}){if(!r||!l)return[];const c=s+t,i=new Date(r),u=new Date(l),m=new Date,d=Math.max(1,(u-i)/(1e3*60*60*24)),h=[],x=Math.min(12,Math.ceil(d/7));for(let f=0;f<=x;f++){const p=f/x,v=new Date(i.getTime()+p*(u-i)),g=v.toLocaleDateString("en-US",{month:"short",day:"numeric"}),T=Math.round(p*c),y=v<=m,A=f===x||y&&f===x-1,j={date:g,plannedValue:T};if(y||A){const F=Math.min(1,(v-i)/(m-i));j.earnedValue=Math.round(F*(n/100)*c),j.actualCost=Math.round(F*a)}h.push(j)}return h}function _o({contractValue:s=0,changeOrderValue:t=0,progressPercent:n=0,actualCosts:a=0,startDate:r,endDate:l,areas:c=[]}){const i=o.useMemo(()=>fo({contractValue:s,changeOrderValue:t,progressPercent:n,actualCosts:a,startDate:r,endDate:l,areas:c}),[s,t,n,a,r,l,c]),u=o.useMemo(()=>ko({contractValue:s,changeOrderValue:t,progressPercent:n,actualCosts:a,startDate:r,endDate:l}),[s,t,n,a,r,l]),m={healthy:"#10b981",watch:"#f59e0b",warning:"#f97316",critical:"#ef4444"},d=m[i.healthStatus]||m.watch;return e.jsxs("div",{className:"ev-card",children:[e.jsxs("div",{className:"ev-card-header",children:[e.jsxs("div",{className:"ev-card-title",children:[e.jsx(Aa,{size:18}),e.jsx("h3",{children:"Earned Value Analysis"})]}),e.jsx("span",{className:"ev-health-badge",style:{background:`${d}18`,color:d,borderColor:`${d}40`},children:i.healthStatus==="healthy"?"Healthy":i.healthStatus==="watch"?"Watch":i.healthStatus==="warning"?"Warning":"Critical"})]}),e.jsxs("div",{className:"ev-indices-row",children:[e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[e.jsx(ls,{size:14}),e.jsx("span",{children:"CPI"})]}),e.jsx("div",{className:"ev-index-value",style:{color:i.cpi>=.95?"#10b981":i.cpi>=.85?"#f59e0b":"#ef4444"},children:i.cpi.toFixed(2)}),e.jsx("div",{className:"ev-index-label",children:i.cpiLabel})]}),e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[e.jsx(St,{size:14}),e.jsx("span",{children:"SPI"})]}),e.jsx("div",{className:"ev-index-value",style:{color:i.spi>=.95?"#10b981":i.spi>=.85?"#f59e0b":"#ef4444"},children:i.spi.toFixed(2)}),e.jsx("div",{className:"ev-index-label",children:i.spiLabel})]}),e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[i.vac>=0?e.jsx(hs,{size:14}):e.jsx(ps,{size:14}),e.jsx("span",{children:"EAC"})]}),e.jsx("div",{className:"ev-index-value",children:re(i.eac)}),e.jsx("div",{className:"ev-index-label",children:"Est. at Completion"})]}),e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[e.jsx(Aa,{size:14}),e.jsx("span",{children:"ETC"})]}),e.jsx("div",{className:"ev-index-value",children:re(i.etc)}),e.jsx("div",{className:"ev-index-label",children:"Est. to Complete"})]})]}),e.jsxs("div",{className:"ev-variance-row",children:[e.jsxs("div",{className:`ev-variance-item ${i.costVariance>=0?"positive":"negative"}`,children:[e.jsx("span",{className:"ev-variance-label",children:"Cost Variance"}),e.jsxs("span",{className:"ev-variance-value",children:[i.costVariance>=0?"+":"",re(i.costVariance)]})]}),e.jsxs("div",{className:`ev-variance-item ${i.scheduleVariance>=0?"positive":"negative"}`,children:[e.jsx("span",{className:"ev-variance-label",children:"Schedule Variance"}),e.jsxs("span",{className:"ev-variance-value",children:[i.scheduleVariance>=0?"+":"",re(i.scheduleVariance)]})]}),e.jsxs("div",{className:`ev-variance-item ${i.vac>=0?"positive":"negative"}`,children:[e.jsx("span",{className:"ev-variance-label",children:"Variance at Completion"}),e.jsxs("span",{className:"ev-variance-value",children:[i.vac>=0?"+":"",re(i.vac)]})]})]}),u.length>0&&e.jsx("div",{className:"ev-chart-container",children:e.jsx(Zs,{width:"100%",height:220,children:e.jsxs(Oi,{data:u,margin:{top:8,right:8,left:0,bottom:0},children:[e.jsx(It,{dataKey:"date",tick:{fontSize:11,fill:"var(--text-secondary)"},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(Lt,{tickFormatter:qe,tick:{fontSize:11,fill:"var(--text-secondary)"},tickLine:!1,axisLine:!1,width:55}),e.jsx(et,{formatter:h=>re(h),contentStyle:Xs.contentStyle,labelStyle:Xs.labelStyle}),e.jsx(ks,{iconType:"line",wrapperStyle:{fontSize:11,paddingTop:4}}),e.jsx(gt,{type:"monotone",dataKey:"plannedValue",stroke:K.contract,strokeDasharray:"5 5",strokeWidth:2,dot:!1,name:"Planned Value"}),e.jsx(gt,{type:"monotone",dataKey:"earnedValue",stroke:K.revenue,strokeWidth:2,dot:!1,name:"Earned Value",connectNulls:!1}),e.jsx(gt,{type:"monotone",dataKey:"actualCost",stroke:K.costs,strokeWidth:2,dot:!1,name:"Actual Cost",connectNulls:!1})]})})}),i.projectedEndDate&&l&&e.jsxs("div",{className:"ev-projection-row",children:[e.jsxs("div",{className:"ev-projection-item",children:[e.jsx("span",{className:"ev-projection-label",children:"Planned End"}),e.jsx("span",{className:"ev-projection-value",children:new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"ev-projection-item",children:[e.jsx("span",{className:"ev-projection-label",children:"Projected End"}),e.jsx("span",{className:"ev-projection-value",style:{color:i.spi>=.95?"#10b981":"#f59e0b"},children:new Date(i.projectedEndDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),i.tcpi>1.1&&e.jsxs("div",{className:"ev-projection-alert",children:[e.jsx(Ae,{size:14}),e.jsxs("span",{children:["Need CPI of ",i.tcpi.toFixed(2)," to finish on budget"]})]})]})]})}const So=o.lazy(()=>de(()=>import("./ShareModal-C-PKrnfl.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Do=o.lazy(()=>de(()=>import("./NotificationSettings-C_loAwgJ.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),Eo=o.lazy(()=>de(()=>import("./CORForm-CiCjVyfN.js"),__vite__mapDeps([8,1,2,3,4,5,6,9]))),Po=o.lazy(()=>de(()=>import("./CORDetail-DVQ40zw6.js"),__vite__mapDeps([10,1,2,3,4,5,6,9,11,12]))),Ro=o.lazy(()=>de(()=>import("./CORLog-D9fZDhx3.js").then(s=>s.a),__vite__mapDeps([13,4,1,2,3,5,6,9]))),To=o.lazy(()=>de(()=>import("./DrawRequestModal-BBmdvEtC.js"),__vite__mapDeps([14,1,2,3,4,5,6,9]))),Fo=o.lazy(()=>de(()=>import("./EquipmentModal-C6W5jEy1.js"),__vite__mapDeps([15,1,2,3,4,5,6]))),Ao=o.lazy(()=>de(()=>import("./AddCostModal--tgfgs0E.js"),__vite__mapDeps([16,1,2,3,4,5,6]))),Mo=o.lazy(()=>de(()=>import("./DocumentsTab-MjeMu28R.js"),__vite__mapDeps([17,1,2,3,4,5,6]))),Oo=o.lazy(()=>de(()=>import("./CORLogPreview-DQs_HoFn.js"),__vite__mapDeps([18,1,2,3,4,5,6,9]))),$o=o.lazy(()=>de(()=>import("./CORList-Bk8clyeZ.js"),__vite__mapDeps([19,4,1,2,3,5,6,9,13]))),Io=o.lazy(()=>de(()=>import("./TMList-1wE0oQPI.js"),__vite__mapDeps([20,4,1,2,3,5,6,12,21,9]))),Lo=o.lazy(()=>de(()=>import("./BillingCenter-mtpV36r1.js"),__vite__mapDeps([22,1,2,3,4,5,6,9]))),zo=o.lazy(()=>de(()=>import("./PhotoTimeline-BN1NfF23.js"),__vite__mapDeps([23,1,2,3,4,5,6]))),qo=o.lazy(()=>de(()=>import("./index-Da6Ug3b9.js").then(s=>s.aZ),__vite__mapDeps([1,2,3,4,5,6])));function Vo({company:s,user:t,isAdmin:n,onShowToast:a,navigateToProjectId:r,onProjectNavigated:l}){const[c,i]=o.useState([]),[u,m]=o.useState([]),[d,h]=o.useState(null),[x,f]=o.useState([]),[p,v]=o.useState(!0),[g,T]=o.useState(!1),[y,A]=o.useState(!1),[j,F]=o.useState("overview"),[_,L]=o.useState("overview"),[S,D]=o.useState(!0),[b,I]=o.useState(!1),[M,V]=o.useState(!1),[P,W]=o.useState("list"),[$,ee]=o.useState("preview"),[le,te]=o.useState([]),[ve,O]=o.useState(!1),[N,C]=o.useState(null),[Y,E]=o.useState(!1),[J,X]=o.useState(null),[ae,De]=o.useState(0),[Ze,Te]=o.useState(!1),[Z,es]=o.useState(!1),[se,je]=o.useState(!1),[Ds,fe]=o.useState(null),[Es,Ps]=o.useState(0),[kn,Rs]=o.useState(!1),[Bt,Ts]=o.useState(null),[_n,Sn]=o.useState(0),{isOpen:Dn,setIsOpen:En,close:Pn}=Oc(),{portfolioMetrics:Rn,projectHealth:Tn,scheduleMetrics:Fn,riskAnalysis:Fe}=Sc(u),{editMode:An,editData:he,saving:Wt,handleEditClick:Ut,handleCancelEdit:Ht,handleEditChange:ke,handleAreaEditChange:Kt,handleAddArea:Mn,handleRemoveArea:On,handleSaveEdit:$n,handleDeleteProject:In}=Dc({selectedProject:d,areas:x,company:s,onShowToast:a,loadAreas:lt,setSelectedProject:h}),vs=o.useRef(null),Fs=o.useRef(!1),rt=o.useRef(!1),it=o.useRef(new Map),Gt=300*1e3,ue=o.useCallback((k={})=>{const{refreshAreas:z=!1,refreshCOR:U=!1,projectId:Q=null}=k;z&&Q&&(Fs.current=Q),U&&(rt.current=!0),vs.current&&clearTimeout(vs.current),vs.current=setTimeout(async()=>{Fs.current&&(await lt(Fs.current),Fs.current=!1),rt.current&&(De(me=>me+1),rt.current=!1),await ss()},150)},[]);o.useEffect(()=>()=>{vs.current&&clearTimeout(vs.current)},[]),o.useEffect(()=>{s?.id&&(ss(),qn())},[s?.id]);const Ln=o.useRef([]),zn=c.map(k=>k.id).sort().join(",");o.useEffect(()=>{if(!s?.id||c.length===0)return;const k=c.map(U=>U.id).sort();Ln.current=k;const z=q.subscribeToCompanyActivity?.(s.id,k,{onMessage:()=>ue(),onMaterialRequest:()=>ue(),onTMTicket:()=>ue(),onCrewCheckin:()=>ue(),onAreaUpdate:()=>ue(),onCORChange:()=>ue({refreshCOR:!0}),onInjuryReport:()=>ue(),onProjectChange:()=>ue(),onMaterialsEquipmentChange:()=>ue(),onLaborRateChange:()=>ue(),onPunchListChange:()=>ue()});return()=>{z&&q.unsubscribe?.(z)}},[s?.id,zn,ue]),o.useEffect(()=>(b?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[b]);const qn=async()=>{try{const k=await q.getDumpSites(s.id);te(k||[])}catch(k){console.error("Error loading dump sites:",k)}},Yt=o.useRef(null);o.useEffect(()=>{if(r&&r!==Yt.current&&c.length>0){const k=c.find(z=>z.id===r);k&&(Yt.current=r,h(k),l?.())}},[r,c,l]),o.useEffect(()=>{if(d){lt(d.id);const k=[],z=d.id,U=q.subscribeToAreas?.(z,()=>{ue({refreshAreas:!0,projectId:z})});U&&k.push(U);const Q=q.subscribeToDailyReports?.(z,()=>{ue()});Q&&k.push(Q);const me=q.subscribeToCrewCheckins?.(z,()=>{ue()});me&&k.push(me);const ge=q.subscribeToHaulOffs?.(z,()=>{ue()});ge&&k.push(ge);const Oe=q.subscribeToCORs?.(z,()=>{ue({refreshCOR:!0})});return Oe&&k.push(Oe),()=>{k.forEach(pe=>q.unsubscribe?.(pe))}}},[d,ue]),o.useEffect(()=>{_==="tickets"&&ee("full")},[_]);const Vn=async(k,z=!1)=>{const U=k.id,Q=it.current.get(U);if(Q&&!z&&Date.now()-Q.timestamp<Gt)return Q.data;try{const[me,ge,Oe,pe,be,_e,Be,Os,R,G,oe,$e]=await Promise.all([ye(()=>q.getAreas(k.id),{fallback:[],context:{operation:"getAreas",projectId:k.id}}),ye(()=>q.getTMTickets(k.id),{fallback:[],context:{operation:"getTMTickets",projectId:k.id}}),ye(()=>q.getChangeOrderTotals(k.id),{fallback:null,context:{operation:"getChangeOrderTotals",projectId:k.id}}),ye(()=>q.getDailyReports(k.id,100),{fallback:[],context:{operation:"getDailyReports",projectId:k.id}}),ye(()=>q.getInjuryReports(k.id),{fallback:[],context:{operation:"getInjuryReports",projectId:k.id}}),ye(()=>q.calculateManDayCosts(k.id,s?.id,k.work_type||"demolition",k.job_type||"standard"),{fallback:null,context:{operation:"calculateManDayCosts",projectId:k.id}}),ye(()=>q.calculateHaulOffCosts(k.id),{fallback:null,context:{operation:"calculateHaulOffCosts",projectId:k.id}}),ye(()=>q.getProjectCosts(k.id),{fallback:[],context:{operation:"getProjectCosts",projectId:k.id}}),ye(()=>q.getCORStats(k.id),{fallback:null,context:{operation:"getCORStats",projectId:k.id}}),ye(()=>q.getCrewCheckinHistory(k.id,60),{fallback:[],context:{operation:"getCrewCheckinHistory",projectId:k.id}}),ye(()=>q.getMaterialRequests(k.id),{fallback:[],context:{operation:"getMaterialRequests",projectId:k.id}}),ye(()=>q.getWeeklyDisposalSummary(k.id,4),{fallback:[],context:{operation:"getWeeklyDisposalSummary",projectId:k.id}})]),Se=Ra(me),ct=Se.progress,ma=Oe?.totalApprovedValue||0,ha=k.contract_value+ma,$s=Se.isValueBased?Se.earnedValue:ct/100*ha,pr=ge.filter(H=>H.status==="pending").length,ot=new Date;ot.setDate(ot.getDate()-7);const xr=pe.filter(H=>new Date(H.report_date)>=ot).length,dt=Os.reduce((H,ne)=>{const ts=parseFloat(ne.amount);return H+(isNaN(ts)?0:ts)},0);let Is=0;const Ls={};ge.forEach(H=>{const ne=H.work_date||H.ticket_date||H.created_at?.split("T")[0],ts=H.t_and_m_items||H.items||[];let zs=0;ts.forEach(jt=>{const Pr=parseFloat(jt.quantity)||1,Rr=parseFloat(jt.unit_cost)||parseFloat(jt.materials_equipment?.cost_per_unit)||0;zs+=Pr*Rr}),zs>0&&ne&&(Is+=zs,Ls[ne]||(Ls[ne]={date:ne,cost:0}),Ls[ne].cost+=zs)});const pa=Object.values(Ls).sort((H,ne)=>new Date(ne.date)-new Date(H.date)),ut=_e?.totalCost||0,mt=Be?.totalCost||0,xa=ut+mt+Is+dt,va=$s-xa,vr=$s>0?va/$s*100:0,ja=_e?.byDate?.length||0,jr=pa.length,ht=Math.max(ja,jr),fa=ut+mt+Is+dt,fr=ht>0?fa/ht:0,Ie=zi({...k,progress:ct},_e?.totalManDays||0),We={},ga=new Set;(G||[]).forEach(H=>{const ne=H.workers||[];We[H.check_in_date]=ne.length,ne.forEach(ts=>ga.add(ts.name?.toLowerCase()))});const Le=Object.keys(We).sort(),gr=Le.length>0?Math.round(Le.reduce((H,ne)=>H+We[ne],0)/Le.length*10)/10:0,br=Le.length>0?Math.max(...Le.map(H=>We[H])):0,pt=Le.slice(-7),xt=Le.slice(-14,-7),ba=pt.length>0?pt.reduce((H,ne)=>H+We[ne],0)/pt.length:0,vt=xt.length>0?xt.reduce((H,ne)=>H+We[ne],0)/xt.length:0,yr=(oe||[]).filter(H=>H.status==="pending").length,Nr=(oe||[]).filter(H=>H.status==="ordered").length,wr=(oe||[]).filter(H=>H.status==="delivered").length,Cr=(oe||[]).filter(H=>H.priority==="urgent"&&H.status==="pending").length,kr=pe.filter(H=>H.issues&&H.issues.trim().length>0).length,_r=ge.reduce((H,ne)=>H+(ne.photos?.length||0),0),Sr=($e||[]).reduce((H,ne)=>H+(ne.concrete||0)+(ne.trash||0)+(ne.metals||0)+(ne.hazardous_waste||0),0),ya=be.length>0?new Date(be[0]?.incident_date||be[0]?.created_at):null,Dr=ya?Math.floor((new Date-ya)/(1e3*60*60*24)):null,Er=me.filter(H=>H.status==="done"),Na={...k,areas:me,progress:ct,billable:$s,changeOrderValue:ma,revisedContractValue:ha,changeOrderPending:Oe?.pendingCount||0,totalTickets:ge.length,pendingTickets:pr,approvedTickets:ge.filter(H=>H.status==="approved").length,tmTickets:ge,dailyReportsCount:pe.length,recentDailyReports:xr,injuryReportsCount:be.length,lastDailyReport:pe[0]?.report_date||null,isValueBased:Se.isValueBased,earnedValue:Se.earnedValue,totalSOVValue:Se.totalValue,laborCost:ut,laborDaysWorked:ja,laborManDays:_e?.totalManDays||0,laborByDate:_e?.byDate||[],dailyBurn:fr,materialsEquipmentCost:Is,materialsEquipmentByDate:pa,haulOffCost:mt,haulOffLoads:Be?.totalLoads||0,haulOffDays:Be?.daysWithHaulOff||0,haulOffByType:Be?.byWasteType||{},haulOffByDate:Be?.byDate||[],customCosts:Os,customCostTotal:dt,totalBurn:fa,totalBurnDays:ht,allCostsTotal:xa,currentProfit:va,profitMargin:vr,corPendingValue:R?.total_pending_value||0,corPendingCount:R?.pending_count||0,corApprovedValue:R?.total_approved_value||0,corBilledValue:R?.total_billed_value||0,corTotalCount:R?.total_cors||0,corStats:R,scheduleStatus:Ie.scheduleStatus,scheduleVariance:Ie.scheduleVariance,scheduleLabel:Ie.scheduleLabel,laborStatus:Ie.laborStatus,laborVariance:Ie.laborVariance,laborLabel:Ie.laborLabel,hasScheduleData:Ie.hasScheduleData,hasLaborData:Ie.hasLaborData,actualManDays:_e?.totalManDays||0,crewHistory:G||[],crewByDate:We,uniqueWorkerCount:ga.size,avgCrewSize:gr,peakCrewSize:br,crewDaysTracked:Le.length,crewTrend:vt>0?(ba-vt)/vt*100:0,recentCrewAvg:ba,materialRequests:oe||[],pendingMaterialRequests:yr,orderedMaterialRequests:Nr,deliveredMaterialRequests:wr,urgentMaterialRequests:Cr,totalMaterialRequests:(oe||[]).length,reportsWithIssues:kr,totalPhotosFromTickets:_r,dailyReports:pe,weeklyDisposal:$e||[],disposalTotalLoads:Sr,daysSinceLastInjury:Dr,injuryReports:be,oshaRecordable:be.filter(H=>H.osha_recordable).length,completedAreasCount:Er.length,hasError:!1,_detailsLoaded:!0};return it.current.set(U,{data:Na,timestamp:Date.now()}),Na}catch(me){return console.error(`Error loading details for project ${k.id}:`,me),{...k,hasError:!0,_detailsLoaded:!1}}},ss=async()=>{try{const k=await q.getProjectDashboardSummary(s?.id);i(k);const z=k.map(U=>{const Q=it.current.get(U.id);if(Q&&Date.now()-Q.timestamp<Gt)return Q.data;const me=U.areaCount||0,ge=U.completedAreas||0,Oe=me>0?Math.round(ge/me*100):0;return{...U,progress:Oe,areas:[],totalTickets:U.ticketCount||0,pendingTickets:U.pendingTicketCount||0,approvedTickets:U.approvedTicketCount||0,dailyReportsCount:U.dailyReportsThisWeek||0,recentDailyReports:U.dailyReportsThisWeek||0,corTotalCount:U.corCount||0,billable:0,changeOrderValue:0,revisedContractValue:U.contract_value||0,changeOrderPending:0,tmTickets:[],injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,materialsEquipmentCost:0,materialsEquipmentByDate:[],haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corStats:null,scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1,actualManDays:0,hasError:!1,_detailsLoaded:!1}});m(z)}catch(k){console.error("Error loading projects:",k),a("Error loading projects","error")}finally{v(!1)}};async function lt(k){try{const z=await q.getAreas(k);f(z)}catch(z){console.error("Error loading areas:",z)}}const As=async k=>{if(h(k),!k._detailsLoaded){const z=await Vn(k);m(U=>U.map(Q=>Q.id===k.id?z:Q)),h(z)}},Bn=()=>{h(null),f([]),Ht(),F("overview"),ss()},w=o.useMemo(()=>d?u.find(k=>k.id===d.id):null,[d,u]),Wn=o.useMemo(()=>{if(!d)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const k=Ra(x),z=k.progress,U=w?.changeOrderValue||0,Q=d.contract_value+U,me=k.isValueBased?k.earnedValue:z/100*Q;return{progress:z,billable:me,changeOrderValue:U,revisedContractValue:Q,isValueBased:k.isValueBased,earnedValue:k.earnedValue,totalSOVValue:k.totalValue}},[d,x,w]),Un=o.useCallback(({target:k,projectId:z,alert:U})=>{const Q=c.find(me=>me.id===z);Q&&(h(Q),k==="financials"?F("financials"):k==="reports"?F("reports"):k==="cors"?(F("financials"),L("cors")):F("overview"))},[c]);o.useEffect(()=>{const k=async()=>{for(const z of u)if($i(z,30))try{await q.archiveProject(z.id),a(`Project "${z.name}" has been auto-archived after 30 days of completion`,"info")}catch(U){console.error("Failed to auto-archive project:",U)}};u.length>0&&k()},[]);const Hn=o.useCallback(()=>{fe(null),je(!0)},[]),Kn=o.useCallback(k=>{fe(k),je(!0)},[]),Gn=o.useCallback(()=>{Ts(null),Rs(!0)},[]),Yn=o.useCallback(k=>{Ts(k),Rs(!0)},[]),Jn=o.useCallback(()=>{ee("full")},[]),Xn=o.useCallback(()=>{D(k=>!k)},[]),Qn=o.useCallback(()=>{I(k=>!k)},[]),Jt=o.useCallback(()=>{I(!1)},[]),Xt=o.useCallback(()=>{V(k=>!k)},[]),Ms=o.useCallback(async(k="all")=>{if(d){a("Gathering field data...","info");try{const[z,U,Q]=await Promise.all([q.getDailyReports(d.id,365),q.getInjuryReports(d.id),q.getCrewCheckinHistory(d.id,365)]);k==="daily"?await Ec(z||[],d):k==="incidents"?await Pc(U||[],d):k==="crew"?await Rc(Q||[],d):await Tc({dailyReports:z||[],incidentReports:U||[],crewCheckins:Q||[],project:d}),a("PDF exported!","success")}catch(z){console.error("Error exporting field documents:",z),a("Error generating PDF","error")}}},[d,a]),Zn=o.useCallback(()=>{ee("preview")},[]),er=o.useCallback(()=>{W("log")},[]),Qt=o.useCallback(()=>{C(null),O(!0)},[]),sr=o.useCallback(k=>{X(k),E(!0)},[]),tr=o.useCallback(k=>{C(k),O(!0)},[]),ar=o.useCallback(()=>{Te(!0)},[]),nr=o.useCallback(async k=>{try{await q.deleteProjectCost(k),ss(),a?.("Cost deleted","success")}catch{a?.("Error deleting cost","error")}},[]),rr=o.useMemo(()=>({corCount:w?.corTotalCount||0,ticketCount:w?.totalTickets||0,corPending:w?.corPendingCount||0,ticketPending:w?.pendingTickets||0}),[w?.corTotalCount,w?.totalTickets,w?.corPendingCount,w?.pendingTickets]),{totalOriginalContract:ir,totalChangeOrders:Zt,totalPortfolioValue:lr,totalEarned:cr,totalRemaining:or,weightedCompletion:dr,totalPendingCORValue:ur,totalPendingCORCount:ea}=Rn,{projectsComplete:sa,projectsOnTrack:ta,projectsAtRisk:aa,projectsOverBudget:na,projectsWithChangeOrders:ra}=Tn,{scheduleAhead:ia,scheduleOnTrack:la,scheduleBehind:ca,laborOver:oa,laborUnder:da,laborOnTrack:ua,hasAnyScheduleData:mr,hasAnyLaborData:hr}=Fn;if(p)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(d){const{progress:k,billable:z,changeOrderValue:U,revisedContractValue:Q,isValueBased:me,earnedValue:ge,totalSOVValue:Oe}=Wn;if(An&&he){const R=he.areas.reduce((G,oe)=>G+(parseFloat(oe.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Ht,style:{marginBottom:"1.5rem"},children:"← Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:he.name,onChange:G=>ke("name",G.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:he.job_number,onChange:G=>ke("job_number",G.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:he.address,onChange:G=>ke("address",G.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:he.general_contractor,onChange:G=>ke("general_contractor",G.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:he.client_contact,onChange:G=>ke("client_contact",G.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:he.client_phone,onChange:G=>ke("client_phone",G.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:he.contract_value,onChange:G=>ke("contract_value",G.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:he.pin,onChange:G=>ke("pin",G.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:he.work_type,onChange:G=>ke("work_type",G.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:he.job_type,onChange:G=>ke("job_type",G.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:he.default_dump_site_id,onChange:G=>ke("default_dump_site_id",G.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),le.map(G=>e.jsx("option",{value:G.id,children:G.name},G.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),he.areas.map((G,oe)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:G.name,onChange:$e=>Kt(oe,"name",$e.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:G.weight,onChange:$e=>Kt(oe,"weight",$e.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>On(oe),children:"×"})]},oe)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${R===100?"valid":"invalid"}`,children:[R,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:Mn,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:$n,disabled:Wt,style:{flex:1},children:Wt?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:()=>In(ss),children:"Delete Project"})]})}const pe=x.filter(R=>R.status==="done").length,be=x.filter(R=>R.status==="working").length,_e=x.filter(R=>R.status==="not_started").length,Be=(w?.pendingTickets||0)+(w?.changeOrderPending||0),Os=[{id:"overview",label:"Overview",Icon:Ma},{id:"financials",label:"Financials",Icon:ls,badge:Be},{id:"reports",label:"Reports",Icon:xe},{id:"documents",label:"Documents",Icon:kt},{id:"info",label:"Info",Icon:Ks}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:Bn,children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>T(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>A(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:Ut,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:d.name}),(d.job_number||d.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[d.job_number&&`Job #${d.job_number}`,d.job_number&&d.work_type&&" • ",d.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[k,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:re(z)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:re(Q-z)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:Os.map(R=>e.jsxs("button",{className:`pv-tab ${j===R.id?"active":""} ${R.badge>0?"has-badge":""}`,onClick:()=>F(R.id),children:[e.jsx(R.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:R.label}),R.badge>0&&e.jsx("span",{className:"pv-tab-badge",children:R.badge})]},R.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[j==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab animate-fade-in",children:[e.jsxs("div",{className:"overview-hero-split",children:[e.jsx(Lc,{progress:k,areasComplete:pe,totalAreas:x.length,areasWorking:be}),e.jsx(qc,{earnedRevenue:z,totalCosts:w?.allCostsTotal||0,laborCost:w?.laborCost||0,disposalCost:w?.haulOffCost||0,equipmentCost:w?.materialsEquipmentCost||0,materialsCost:0,otherCost:w?.customCostTotal||0,contractValue:Q})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(Bc,{project:d,onShowToast:a}),e.jsxs("div",{className:"overview-section-card overview-work-areas-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[pe>0&&e.jsxs("span",{className:"section-badge done",children:[pe," Done"]}),be>0&&e.jsxs("span",{className:"section-badge working",children:[be," Active"]}),_e>0&&e.jsxs("span",{className:"section-badge pending",children:[_e," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list work-areas-scroll stagger-areas",children:x.map(R=>e.jsxs("div",{className:`work-area-item ${R.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[R.status==="done"&&e.jsx("span",{className:"status-icon done",children:"✓"}),R.status==="working"&&e.jsx("span",{className:"status-icon working",children:"●"}),R.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:"○"})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:R.name}),e.jsx("span",{className:"work-area-weight",children:R.scheduled_value?re(R.scheduled_value):`${R.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${R.status}`,style:{width:R.status==="done"?"100%":R.status==="working"?"50%":"0%"}})})]},R.id))})]})]}),d?.contract_value>0&&e.jsx(_o,{contractValue:d.contract_value,changeOrderValue:U,progressPercent:k,actualCosts:w?.allCostsTotal||0,startDate:d.start_date,endDate:d.end_date,areas:x}),(w?.pendingTickets>0||w?.changeOrderPending>0||w?.pendingMaterialRequests>0||w?.urgentMaterialRequests>0)&&e.jsxs("div",{className:"overview-needs-attention",children:[e.jsxs("div",{className:"overview-needs-attention__header",children:[e.jsx(Ae,{size:15,className:"overview-needs-attention__icon"}),e.jsx("span",{className:"overview-needs-attention__title",children:"Needs Attention"}),e.jsx("span",{className:"overview-needs-attention__count",children:[w?.urgentMaterialRequests>0,!w?.urgentMaterialRequests&&w?.pendingMaterialRequests>0,w?.pendingTickets>0,w?.changeOrderPending>0].filter(Boolean).length})]}),e.jsxs("div",{className:"overview-needs-attention__items",children:[w?.urgentMaterialRequests>0&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--warning",onClick:()=>F("reports"),children:[e.jsx(Ae,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[w.urgentMaterialRequests," urgent material request",w.urgentMaterialRequests!==1?"s":""]}),e.jsx(gs,{size:13,className:"overview-needs-attention__item-arrow"})]}),w?.pendingMaterialRequests>0&&!w?.urgentMaterialRequests&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--info",onClick:()=>F("reports"),children:[e.jsx(Ws,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[w.pendingMaterialRequests," material request",w.pendingMaterialRequests!==1?"s":""," pending"]}),e.jsx(gs,{size:13,className:"overview-needs-attention__item-arrow"})]}),w?.pendingTickets>0&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--warning",onClick:()=>F("financials"),children:[e.jsx(xe,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[w.pendingTickets," Time & Material ticket",w.pendingTickets!==1?"s":""," need approval"]}),e.jsx(gs,{size:13,className:"overview-needs-attention__item-arrow"})]}),w?.changeOrderPending>0&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--info",onClick:()=>F("financials"),children:[e.jsx(os,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[w.changeOrderPending," change order",w.changeOrderPending!==1?"s":""," pending"]}),e.jsx(gs,{size:13,className:"overview-needs-attention__item-arrow"})]})]})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"Loading photos..."}),children:e.jsx(zo,{projectId:d?.id,areas:x,onShowToast:a})}),e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"Loading punch list..."}),children:e.jsx(qo,{projectId:d?.id,areas:x,companyId:s?.id,onShowToast:a})})]}),e.jsx("div",{className:"overview-bottom-strip",children:e.jsxs("div",{className:"overview-quick-actions",children:[e.jsxs("button",{className:"overview-action-btn",onClick:()=>F("reports"),children:[e.jsx(xe,{size:15}),e.jsxs("span",{children:[w?.dailyReportsCount||0," Reports"]})]}),e.jsxs("button",{className:"overview-action-btn",onClick:()=>F("financials"),children:[e.jsx(ls,{size:15}),e.jsxs("span",{children:[w?.totalTickets||0," Time & Material Tickets"]})]}),e.jsx("span",{className:"overview-action-divider"}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Ms("all"),children:[e.jsx(Ke,{size:15}),e.jsx("span",{children:"Export All"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Ms("daily"),children:[e.jsx(Ke,{size:14}),e.jsx("span",{children:"Daily"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Ms("incidents"),children:[e.jsx(Ke,{size:14}),e.jsx("span",{children:"Incidents"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>Ms("crew"),children:[e.jsx(Ke,{size:14}),e.jsx("span",{children:"Crew"})]})]})})]}),j==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsxs("div",{className:"export-actions",style:{display:"flex",gap:"8px",marginLeft:"auto",marginBottom:"12px",justifyContent:"flex-end"},children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>Fc(d,{earnedRevenue:z,laborByDate:w?.laborByDate,haulOffByDate:w?.haulOffByDate,customCosts:w?.customCosts}),children:[e.jsx(Ke,{size:14})," Export CSV"]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>Ac(d,{totalLaborCost:w?.laborCost||0,totalDisposalCost:w?.haulOffCost||0}),children:[e.jsx(Ke,{size:14})," QuickBooks"]})]}),e.jsx(Gc,{contractValue:d?.contract_value||0,earnedRevenue:z,totalCosts:w?.allCostsTotal||0,profit:w?.currentProfit||0,progress:k,corApprovedValue:U,loading:!w}),e.jsxs("div",{className:`financials-layout ${S?"sidebar-collapsed":""}`,children:[e.jsxs("button",{className:"financials-mobile-menu-toggle",onClick:Qn,"aria-label":"Open navigation menu",title:"Open navigation menu",children:[e.jsx(tl,{size:20}),e.jsx("span",{children:"Menu"})]}),b&&e.jsx("div",{className:"financials-sidebar-overlay",onClick:Jt,"aria-hidden":"true"}),e.jsx("div",{className:`financials-sidebar ${S?"collapsed":""} ${b?"mobile-open":""}`,children:e.jsx(Yc,{activeSection:_,onSectionChange:R=>{L(R),I(!1)},collapsed:S,onToggleCollapse:Xn,onMobileClose:Jt,stats:rr})}),e.jsxs("div",{className:"financials-main",children:[_==="overview"&&e.jsxs("div",{className:"financials-overview animate-fade-in",children:[e.jsx(eo,{projectData:w,project:d,tmTickets:w?.tmTickets||[],corStats:w?.corStats,areas:x,changeOrderValue:U}),e.jsxs("div",{className:"financials-analysis-row stagger-children",children:[e.jsx(uo,{dailyBurn:w?.dailyBurn||0,totalBurn:w?.totalBurn||0,daysWorked:w?.totalBurnDays||0,laborCost:w?.laborCost||0,materialsEquipmentCost:w?.materialsEquipmentCost||0,disposalCost:w?.haulOffCost||0,customCostTotal:w?.customCostTotal||0,progress:k,contractValue:Q,laborByDate:w?.laborByDate||[],materialsEquipmentByDate:w?.materialsEquipmentByDate||[]}),e.jsx(to,{revenue:z,totalCosts:w?.allCostsTotal||0,contractValue:Q,progress:k})]}),e.jsxs("div",{className:"cost-disposal-row",children:[e.jsx(ao,{laborCost:w?.laborCost||0,haulOffCost:w?.haulOffCost||0,materialsEquipmentCost:w?.materialsEquipmentCost||0,customCosts:w?.customCosts||[],onAddCost:ar,onDeleteCost:nr}),e.jsx(ro,{project:d,period:"week"})]}),e.jsx(io,{project:d,onAddEquipment:Hn,onEditEquipment:Kn,onShowToast:a},Es),e.jsx(lo,{project:d,areas:x,corStats:w?.corStats,onCreateDraw:Gn,onViewDraw:Yn,onShowToast:a},_n),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(Ge,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:re(w?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(co,{project:d,company:s,onShowToast:a})})]})]}),_==="cors"&&e.jsxs("div",{className:"financials-cors animate-fade-in",children:[e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(o.Suspense,{fallback:e.jsx(Ue,{}),children:e.jsx(Oo,{project:d,onShowToast:a,onToggleList:Xt,showingList:M,onViewFullLog:er,onCreateCOR:Qt})})}),M&&e.jsx("div",{className:"financials-section cor-section-list animate-fade-in",style:{marginTop:"1rem"},children:e.jsx(o.Suspense,{fallback:e.jsx(Ue,{}),children:e.jsx($o,{project:d,company:s,areas:x,refreshKey:ae,onShowToast:a,previewMode:!1,onViewAll:Xt,onDisplayModeChange:W,onCreateCOR:Qt,onViewCOR:sr,onEditCOR:tr})})})]}),_==="tickets"&&e.jsx("div",{className:"financials-tickets animate-fade-in",children:e.jsxs("div",{className:"financials-section tm-section",children:[$==="full"&&e.jsx("button",{className:"section-back-btn",onClick:Zn,children:"← Back to summary"}),e.jsx(o.Suspense,{fallback:e.jsx(Ue,{}),children:e.jsx(Io,{project:d,company:s,onShowToast:a,compact:$==="preview",previewMode:$==="preview",onViewAll:Jn})})]})}),_==="billing"&&e.jsx("div",{className:"financials-billing animate-fade-in",children:e.jsx(o.Suspense,{fallback:e.jsx(Ue,{}),children:e.jsx(Lo,{project:d,company:s,user:t,onShowToast:a})})})]})]})]}),j==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(xe,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:w?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:w?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((w?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:w?.totalTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"Time & Material"}),(w?.pendingTickets||0)>0&&e.jsxs("div",{className:"reports-metric-status",style:{background:"#fef3c7",color:"#92400e"},children:[w.pendingTickets," pending"]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:w?.totalPhotosFromTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"Photos Captured"})]})]})}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsx("div",{className:"reports-insight-header",children:e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Re,{size:18}),e.jsx("h3",{children:"Crew Analytics"})]})}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:w?.uniqueWorkerCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Workers"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:w?.avgCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Avg Crew / Day"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:w?.peakCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Peak Crew Size"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:w?.crewDaysTracked||0}),e.jsx("span",{className:"reports-stat-label",children:"Days Tracked"})]})]}),(w?.crewTrend||0)!==0&&e.jsxs("div",{className:`reports-trend-badge ${w.crewTrend>0?"up":"down"}`,children:[w.crewTrend>0?e.jsx(hs,{size:14}):e.jsx(ps,{size:14}),e.jsxs("span",{children:[Math.abs(Math.round(w.crewTrend)),"% ",w.crewTrend>0?"increase":"decrease"," vs prior week"]})]}),w?.crewByDate&&Object.keys(w.crewByDate).length>0&&e.jsxs("div",{className:"reports-mini-chart",children:[e.jsx("div",{className:"reports-mini-chart-label",children:"Recent Crew Size"}),e.jsx("div",{className:"reports-mini-bars",children:Object.keys(w.crewByDate).sort().slice(-14).map(R=>{const G=w.crewByDate[R],oe=w.peakCrewSize||1;return e.jsx("div",{className:"reports-mini-bar-wrap",title:`${new Date(R+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}: ${G} workers`,children:e.jsx("div",{className:"reports-mini-bar",style:{height:`${G/oe*100}%`}})},R)})})]})]})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Dt,{size:18}),e.jsx("h3",{children:"Safety Dashboard"})]}),e.jsx("span",{className:`reports-section-badge ${(w?.injuryReportsCount||0)>0?"warning":"success"}`,children:(w?.injuryReportsCount||0)>0?`${w.injuryReportsCount} incident${w.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsx("div",{className:"reports-safety-hero",children:e.jsxs("div",{className:`reports-safety-days ${w?.daysSinceLastInjury===null||w?.daysSinceLastInjury>30?"excellent":w?.daysSinceLastInjury>7?"good":"caution"}`,children:[e.jsx("span",{className:"reports-safety-days-value",children:w?.daysSinceLastInjury!==null?w.daysSinceLastInjury:"--"}),e.jsx("span",{className:"reports-safety-days-label",children:w?.daysSinceLastInjury!==null?"Days Since Last Incident":"No Incidents Recorded"})]})}),e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:w?.injuryReportsCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Incidents"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:w?.oshaRecordable||0}),e.jsx("span",{className:"reports-stat-label",children:"OSHA Recordable"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:w?.reportsWithIssues||0}),e.jsx("span",{className:"reports-stat-label",children:"Reports w/ Issues"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:w?.laborManDays||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Man-Days"})]})]})]})]})]}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Ws,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("span",{className:"reports-section-count",children:[w?.totalMaterialRequests||0," total"]})]}),e.jsx("div",{className:"reports-insight-body",children:(w?.totalMaterialRequests||0)===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Ws,{size:32}),e.jsx("p",{children:"No material requests yet"}),e.jsx("span",{children:"Requests from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-material-pipeline",children:[w?.urgentMaterialRequests>0&&e.jsxs("div",{className:"reports-material-status urgent",children:[e.jsx(Ae,{size:14}),e.jsxs("span",{children:[w.urgentMaterialRequests," Urgent"]})]}),e.jsxs("div",{className:"reports-material-status pending",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[w?.pendingMaterialRequests||0," Pending"]})]}),e.jsxs("div",{className:"reports-material-status ordered",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[w?.orderedMaterialRequests||0," Ordered"]})]}),e.jsxs("div",{className:"reports-material-status delivered",children:[e.jsx(al,{size:14}),e.jsxs("span",{children:[w?.deliveredMaterialRequests||0," Delivered"]})]})]}),e.jsx("div",{className:"reports-recent-list",children:(w?.materialRequests||[]).slice(0,3).map(R=>e.jsxs("div",{className:`reports-recent-item ${R.status}`,children:[e.jsxs("div",{className:"reports-recent-item-main",children:[e.jsx("span",{className:`reports-recent-item-status ${R.status}`,children:R.status}),e.jsx("span",{className:"reports-recent-item-date",children:new Date(R.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"reports-recent-item-detail",children:[(R.items||[]).slice(0,2).map((G,oe)=>e.jsxs("span",{children:[G.name,G.quantity?` (${G.quantity})`:""]},oe)),(R.items||[]).length>2&&e.jsxs("span",{className:"reports-recent-more",children:["+",(R.items||[]).length-2," more"]})]}),R.priority==="urgent"&&e.jsx("span",{className:"reports-urgent-tag",children:"URGENT"})]},R.id))})]})})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Ye,{size:18}),e.jsx("h3",{children:"Disposal Trends"})]}),e.jsxs("span",{className:"reports-section-count",children:[w?.disposalTotalLoads||0," loads"]})]}),e.jsx("div",{className:"reports-insight-body",children:(w?.weeklyDisposal||[]).length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Ye,{size:32}),e.jsx("p",{children:"No disposal data yet"}),e.jsx("span",{children:"Disposal loads from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-disposal-chart",children:[e.jsx("div",{className:"reports-disposal-bars",children:(w?.weeklyDisposal||[]).map((R,G)=>{const oe=(R.concrete||0)+(R.trash||0)+(R.metals||0)+(R.hazardous_waste||0),$e=Math.max(...(w?.weeklyDisposal||[]).map(Se=>(Se.concrete||0)+(Se.trash||0)+(Se.metals||0)+(Se.hazardous_waste||0)))||1;return e.jsxs("div",{className:"reports-disposal-bar-col",children:[e.jsxs("div",{className:"reports-disposal-bar-stack",style:{height:`${oe/$e*100}%`},children:[R.concrete>0&&e.jsx("div",{className:"reports-disposal-seg concrete",style:{flex:R.concrete},title:`Concrete: ${R.concrete}`}),R.trash>0&&e.jsx("div",{className:"reports-disposal-seg trash",style:{flex:R.trash},title:`Trash: ${R.trash}`}),R.metals>0&&e.jsx("div",{className:"reports-disposal-seg metals",style:{flex:R.metals},title:`Metals: ${R.metals}`}),R.hazardous_waste>0&&e.jsx("div",{className:"reports-disposal-seg hazardous",style:{flex:R.hazardous_waste},title:`Hazardous: ${R.hazardous_waste}`})]}),e.jsx("span",{className:"reports-disposal-bar-label",children:new Date(R.week+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},G)})}),e.jsxs("div",{className:"reports-disposal-legend",children:[e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot concrete"}),"Concrete"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot trash"}),"Trash"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot metals"}),"Metals"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot hazardous"}),"Hazardous"]})]})]}),(w?.haulOffCost||0)>0&&e.jsxs("div",{className:"reports-disposal-cost",children:[e.jsx("span",{children:"Total Disposal Cost"}),e.jsx("strong",{children:re(w.haulOffCost)})]})]})})]})]}),e.jsxs("div",{className:"reports-insight-card reports-activity-summary",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(xe,{size:18}),e.jsx("h3",{children:"Field Activity Summary"})]}),e.jsx("div",{className:"reports-activity-badges",children:w?.lastDailyReport&&e.jsxs("span",{className:"reports-last-filed",children:["Last report: ",new Date(w.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ","(",Math.floor((new Date-new Date(w.lastDailyReport))/(1e3*60*60*24)),"d ago)"]})})]}),e.jsx("div",{className:"reports-insight-body",children:e.jsxs("div",{className:"reports-activity-grid",children:[e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(xe,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:w?.dailyReportsCount||0}),e.jsx("span",{children:"Daily Reports Filed"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(os,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:w?.totalTickets||0}),e.jsx("span",{children:"Time & Material Tickets"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(nl,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:w?.totalPhotosFromTickets||0}),e.jsx("span",{children:"Photos Documented"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Ge,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsxs("strong",{children:[w?.completedAreasCount||0,"/",x.length]}),e.jsx("span",{children:"Work Areas Complete"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(ls,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:re(w?.allCostsTotal||0)}),e.jsx("span",{children:"Total Costs Tracked"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Re,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:w?.laborManDays||0}),e.jsx("span",{children:"Total Man-Days"})]})]})]})})]}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(xe,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[w?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(o.Suspense,{fallback:e.jsx(Ue,{}),children:e.jsx(ho,{project:d,company:s,onShowToast:a})})})]}),e.jsxs("div",{className:`reports-section-card ${(w?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(w?.injuryReportsCount||0)>0?"warning":"success"}`,children:(w?.injuryReportsCount||0)>0?"⚠":"✓"}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(w?.injuryReportsCount||0)>0?"warning":"success"}`,children:(w?.injuryReportsCount||0)>0?`${w.injuryReportsCount} incident${w.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(o.Suspense,{fallback:e.jsx(Ue,{}),children:e.jsx(xo,{project:d,companyId:s?.id||d?.company_id,company:s,user:t,onShowToast:a})})})]})]}),j==="documents"&&e.jsx("div",{className:"pv-tab-panel documents-tab",children:e.jsx(o.Suspense,{fallback:e.jsx(Ue,{}),children:e.jsx(Mo,{project:d,companyId:s?.id||d?.company_id,onShowToast:a,userRole:t?.access_level||"office"})})}),j==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:d.name}),d.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",d.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:Ut,children:e.jsx("span",{children:"Edit Project"})})]}),d.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(rl,{size:14}),e.jsx("span",{children:d.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Ge,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:d.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(os,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:d.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ls,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:re(Q)}),e.jsx("span",{className:"info-quick-label",children:U>0?`Incl. +${re(U)} COs`:"Contract Value"})]})]}),d.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:d.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(il,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[d.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:d.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),d.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:d.client_contact})]}),d.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(ll,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${d.client_phone}`,className:"info-detail-value link",children:d.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Ma,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[pe>0&&e.jsxs("span",{className:"info-badge done",children:[pe," Done"]}),be>0&&e.jsxs("span",{className:"info-badge working",children:[be," Active"]}),_e>0&&e.jsxs("span",{className:"info-badge pending",children:[_e," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:x.map(R=>e.jsxs("div",{className:`info-area-item ${R.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[R.status==="done"&&e.jsx("span",{className:"status-dot done",children:"✓"}),R.status==="working"&&e.jsx("span",{className:"status-dot working",children:"●"}),R.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:"○"})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:R.name}),e.jsx("span",{className:`info-area-status-label ${R.status}`,children:R.status==="done"?"Complete":R.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[R.weight,"%"]})]},R.id))})]}),e.jsx(vo,{project:d,company:s,user:t,isAdmin:n,onShowToast:a}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(Ks,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:re(d.contract_value)})]}),U>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",re(U)]})]}),d.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:le.find(R=>R.id===d.default_dump_site_id)?.name||"Unknown"})]})]})]}),e.jsx("div",{className:"info-section-card",children:e.jsx(jo,{onShowToast:a})})]})]}),g&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(So,{project:d,user:t,onClose:()=>T(!1),onShareCreated:R=>{a("Share link created successfully!","success")}})}),y&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(o.Suspense,{fallback:null,children:e.jsx(Do,{project:d,company:s,onShowToast:a,onClose:()=>A(!1)})})}),ve&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Eo,{project:d,company:s,areas:x,existingCOR:N,onClose:()=>{O(!1),C(null)},onSaved:()=>{O(!1),C(null),De(R=>R+1)},onShowToast:a})}),Y&&J&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Po,{cor:J,project:d,company:s,areas:x,onClose:()=>{E(!1),X(null)},onEdit:R=>{E(!1),X(null),C(R),O(!0)},onShowToast:a,onStatusChange:()=>{}})}),P==="log"&&d&&e.jsx("div",{className:"cor-log-modal-overlay",onClick:()=>W("list"),children:e.jsxs("div",{className:"cor-log-modal",onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{className:"cor-log-modal-header",children:[e.jsx("h2",{children:"Change Order Log"}),e.jsx("button",{className:"cor-log-modal-close",onClick:()=>W("list"),title:"Close",children:"✕"})]}),e.jsx("div",{className:"cor-log-modal-content",children:e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:e.jsx(Ro,{project:d,company:s,onShowToast:a})})})]})}),Ze&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Ao,{onClose:()=>Te(!1),saving:Z,onSave:async R=>{try{es(!0),await q.addProjectCost(d.id,s.id,R),Te(!1),ss(),a("Cost added successfully","success")}catch(G){console.error("Error adding cost:",G),a("Error adding cost","error")}finally{es(!1)}}})}),se&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(Fo,{project:d,company:s,user:t,editItem:Ds,onSave:()=>{je(!1),fe(null),Ps(R=>R+1),a(Ds?"Equipment updated":"Equipment added","success")},onClose:()=>{je(!1),fe(null)}})}),kn&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(To,{project:d,company:s,areas:x,corStats:u.find(R=>R.id===d?.id)?.corStats,editDrawRequest:Bt,onSave:()=>{Rs(!1),Ts(null),Sn(R=>R+1),a(Bt?"Draw request updated":"Draw request created","success")},onClose:()=>{Rs(!1),Ts(null)}})})]})}return c.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(xe,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("button",{className:"search-trigger-btn",onClick:()=>En(!0),children:[e.jsx(dn,{size:16}),e.jsx("span",{children:"Search"}),e.jsx("span",{className:"shortcut",children:"⌘K"})]}),e.jsxs("div",{className:"bo-project-count",children:[c.length," Active Project",c.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(dr,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:re(cr)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:re(lr)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:re(or)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Zt>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:re(ir)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",ra," project",ra!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",re(Zt)]})]})]}),ea>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:re(ur)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",ea," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[sa>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:sa}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),ta>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:ta}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),aa>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:aa}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),na>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:na}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),mr&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[ia>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:ia}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),la>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:la}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),ca>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:ca}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),hr&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),da>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[da," under"]}),ua>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[ua," on track"]}),oa>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[oa," over"]})]})]})]}),Fe.allAlerts.length>0&&e.jsxs("div",{className:`smart-alerts-section${Fe.criticalCount>0?" smart-alerts-section--has-critical":Fe.allAlerts.some(k=>k.type==="warning")?" smart-alerts-section--has-warning":""}`,children:[e.jsxs("div",{className:"smart-alerts-header",children:[e.jsxs("div",{className:"smart-alerts-header__left",children:[e.jsx(Ae,{className:"smart-alerts-header__icon",size:18}),e.jsx("h3",{className:"smart-alerts-header__title",children:"Needs Attention"})]}),Fe.criticalCount>0?e.jsxs("span",{className:"smart-alerts-count-badge smart-alerts-count-badge--critical",children:[Fe.criticalCount," critical"]}):e.jsxs("span",{className:"smart-alerts-count-badge smart-alerts-count-badge--warning",children:[Fe.allAlerts.length," item",Fe.allAlerts.length!==1?"s":""]})]}),e.jsx($c,{alerts:Fe.allAlerts,onAction:Un,maxVisible:3})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[c.length," active"]})]}),e.jsx("div",{className:"project-list",children:u.map(k=>{const z=Fe.projectRisks.find(U=>U.projectId===k.id);return e.jsx(Bo,{project:k,riskScore:z?.riskScore,riskStatus:z?.riskStatus,onClick:()=>As(k)},k.id)})}),e.jsx(Mc,{isOpen:Dn,onClose:Pn,companyId:s?.id,onSelectProject:k=>{As(k)},onSelectTicket:k=>{const z=c.find(U=>U.id===k.project_id);z&&(As(z),F("financials"),L("tickets"))},onSelectCOR:k=>{const z=c.find(U=>U.id===k.project_id);z&&(As(z),F("financials"),L("cors"),X(k),E(!0))},onShowToast:a})]})}function Bo({project:s,riskScore:t,riskStatus:n,onClick:a}){const r=Ii(s.areas||[]),l=Li(s.areas||[]),c=s.contract_value-s.billable,i=s.billable>s.contract_value*.9&&s.progress<90,u={healthy:{bg:"var(--status-success-bg, #064e3b)",color:"var(--status-success, #059669)"},warning:{bg:"var(--status-warning-bg, #78350f)",color:"var(--status-warning, #d97706)"},critical:{bg:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"}},m=u[n]||u.healthy;return e.jsxs("div",{className:`project-card enhanced ${i?"at-risk":""}`,onClick:a,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[typeof t=="number"&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,background:m.bg,color:m.color},title:`Risk Score: ${t}`,"aria-label":`Risk score ${t}, ${n}`,children:t}),e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:s.name}),e.jsx("div",{className:"project-card-value",children:re(s.contract_value)})]})]}),e.jsx("span",{className:`status-badge ${r}`,children:l})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[s.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:re(s.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${c<0?"negative":""}`,children:re(Math.abs(c))}),e.jsx("span",{className:"stat-label",children:c>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${s.progress}%`}})}),(s.pendingTickets>0||s.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[s.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[s.pendingTickets," Pending"]}),s.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[s.approvedTickets," Approved"]})]}),s.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${s.scheduleStatus}`,children:s.scheduleLabel}),s.hasLaborData&&s.laborLabel&&e.jsx("span",{className:`labor-indicator ${s.laborStatus}`,children:s.laborLabel})]})]})}const Xo=Object.freeze(Object.defineProperty({__proto__:null,default:Vo},Symbol.toStringTag,{value:"Module"}));export{pc as A,Jo as C,Xo as D,Ue as T,Uc as a,Us as b,Yo as c,Go as e};
//# sourceMappingURL=Dashboard-Dap7f_CW.js.map
