{"version":3,"mappings":"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","names":["formatTime","timeStr","hours","minutes","h","ampm","formatTimePeriod","worker","verifyPhotosForExport","tmTickets","manifest","verified","failed","issues","ticket","photoUrl","entry","loadImageAsBase64","err","createExportSnapshot","cor","photoManifest","totals","dataString","hash","i","char","checksum","exportCORToPDF","project","company","branding","options","verifyPhotos","createSnapshot","jsPDF","__vitePreload","n","autoTable","doc","pageWidth","pageHeight","margin","yPos","calculateCORTotals","primaryColor","hexToRgb","headerBg","logoBase64","e","statusText","col1X","col2X","formatDateRange","formatDate","scopeLines","item","centsToDollars","formatCurrency","formatPercent","totalsCol1","totalsCol2","renderSignatureBlock","startY","label","signatureData","signerName","signerTitle","signerCompany","signedDate","sigLineY","titleCompany","totalLaborHours","sum","t","wSum","w","totalOTHours","totalPhotos","verifiedCount","dateRange","min","max","docIdArray","docIdSuffix","b","docId","summaryCol1","summaryCol2","genDate","hasVerification","headerHeight","ticketStatusColor","notesLines","xPos","photoWidth","photoHeight","photoGap","photosPerRow","frameWidth","photoImages","loadImagesAsBase64","imgData","verifyBlockHeight","verifyBlockWidth","sealX","sealY","infoX","totalPages","footerY","fileName","result","exportTMTicketToPDF","logoData","materials","m","dateString","StatusBadge","status","statusMap","info","jsx","SignaturePage","signatureToken","loading","setLoading","useState","error","setError","signatureRequest","setSignatureRequest","document","setDocument","showSignatureModal","setShowSignatureModal","activeSlot","setActiveSlot","submitting","setSubmitting","successMessage","setSuccessMessage","downloading","setDownloading","backupTickets","setBackupTickets","backupExpanded","setBackupExpanded","expandedTickets","setExpandedTickets","useEffect","loadData","request","db","docData","tickets","photoGroups","allPhotos","signed","offset","resolved","len","photos","useMemo","getSignatureStatus","signatures","slot1","s","slot2","availableSlots","getClientIP","handleSignatureSubmit","ipAddress","signature","openSignatureModal","slot","handleDownload","isCOR","handleDownloadTMTicket","jsxs","AlertCircle","isFullySigned","workerCount","totalHours","Building2","CheckCircle","Fragment","Download","FileText","HardHat","idx","Package","Camera","photo","renderSignatureSlot","SignatureCanvas","Users","Truck","Briefcase","ChevronDown","ChevronRight","isExpanded","ticketTotalHours","ticketOTHours","next","Calendar","wIdx","iIdx","pIdx","Clock","openModal"],"ignoreList":[],"sources":["../../src/lib/corPdfExport.js","../../src/components/SignaturePage.jsx"],"sourcesContent":["// ============================================\n// DEPRECATED: Legacy COR PDF Export\n// ============================================\n//\n// This file is DEPRECATED and maintained only for backward compatibility\n// with SignaturePage.jsx (client-side downloads after signing).\n//\n// For new code, use the snapshot-based export pipeline:\n// - corExportPipeline.js - Orchestrates idempotent, async exports\n// - corPdfGenerator.js - Generates PDFs from frozen snapshots\n//\n// The new system provides:\n// - Idempotent exports (repeat requests return same result)\n// - Snapshot-based generation (deterministic, reproducible)\n// - Async pipeline with state tracking (pending/generating/completed/failed)\n// - Pre-aggregated stats and photo manifests\n//\n// Migration: Replace exportCORToPDF calls with executeExport from corExportPipeline.js\n// ============================================\n\nimport {\n  formatCurrency,\n  formatPercent,\n  centsToDollars,\n  calculateCORTotals,\n  formatDate,\n  formatDateRange\n} from './corCalculations'\nimport { hexToRgb, loadImageAsBase64, loadImagesAsBase64 } from './imageUtils'\n\n// Helper to format time (HH:MM or HH:MM:SS to 9:00am format)\nconst formatTime = (timeStr) => {\n  if (!timeStr) return ''\n  const [hours, minutes] = timeStr.split(':')\n  const h = parseInt(hours)\n  const ampm = h >= 12 ? 'pm' : 'am'\n  const h12 = h % 12 || 12\n  return `${h12}:${minutes}${ampm}`\n}\n\n// Format time period for workers\nconst formatTimePeriod = (worker) => {\n  if (worker.time_started && worker.time_ended) {\n    return `${formatTime(worker.time_started)} - ${formatTime(worker.time_ended)}`\n  }\n  return '-'\n}\n\n/**\n * Pre-verify all photos in T&M tickets before export\n * Creates a manifest of verified photos and tracks failures\n * @param {Object[]} tmTickets - T&M tickets with photos\n * @returns {Promise<Object>} Photo manifest with verification status\n */\nexport async function verifyPhotosForExport(tmTickets) {\n  if (!tmTickets || tmTickets.length === 0) {\n    return { totalPhotos: 0, verified: 0, failed: 0, issues: [], manifest: [] }\n  }\n\n  const manifest = []\n  let verified = 0\n  let failed = 0\n  const issues = []\n\n  for (const ticket of tmTickets) {\n    if (!ticket.photos || ticket.photos.length === 0) continue\n\n    for (const photoUrl of ticket.photos) {\n      const entry = {\n        ticketId: ticket.id,\n        workDate: ticket.work_date,\n        url: photoUrl,\n        verified: false,\n        error: null\n      }\n\n      try {\n        // Try to load the image to verify accessibility\n        const imgData = await loadImageAsBase64(photoUrl)\n        if (imgData) {\n          entry.verified = true\n          verified++\n        } else {\n          entry.error = 'Failed to load image'\n          failed++\n          issues.push({\n            ticketId: ticket.id,\n            workDate: ticket.work_date,\n            url: photoUrl,\n            error: 'Failed to load image'\n          })\n        }\n      } catch (err) {\n        entry.error = err.message || 'Unknown error'\n        failed++\n        issues.push({\n          ticketId: ticket.id,\n          workDate: ticket.work_date,\n          url: photoUrl,\n          error: entry.error\n        })\n      }\n\n      manifest.push(entry)\n    }\n  }\n\n  return {\n    totalPhotos: verified + failed,\n    verified,\n    failed,\n    issues,\n    manifest,\n    allVerified: failed === 0,\n    verifiedAt: new Date().toISOString()\n  }\n}\n\n/**\n * Create a frozen snapshot of COR data at export time for dispute purposes\n * @param {Object} cor - The COR data object\n * @param {Object[]} tmTickets - Associated T&M tickets\n * @param {Object} photoManifest - Photo verification manifest\n * @param {Object} totals - Calculated totals\n * @returns {Object} Frozen snapshot ready for database storage\n */\nexport function createExportSnapshot(cor, tmTickets, photoManifest, totals) {\n  // Create a SHA256-like checksum from the data (simplified for client-side)\n  const dataString = JSON.stringify({ cor, tmTickets, photoManifest, totals })\n  let hash = 0\n  for (let i = 0; i < dataString.length; i++) {\n    const char = dataString.charCodeAt(i)\n    hash = ((hash << 5) - hash) + char\n    hash = hash & hash\n  }\n  const checksum = Math.abs(hash).toString(16).padStart(16, '0')\n\n  return {\n    cor_data: {\n      id: cor.id,\n      cor_number: cor.cor_number,\n      title: cor.title,\n      description: cor.description,\n      status: cor.status,\n      created_at: cor.created_at,\n      submitted_at: cor.submitted_at,\n      labor_items: cor.labor_items,\n      material_items: cor.material_items,\n      equipment_items: cor.equipment_items,\n      gc_markup_percent: cor.gc_markup_percent,\n      profit_markup_percent: cor.profit_markup_percent\n    },\n    tickets_data: (tmTickets || []).map(ticket => ({\n      id: ticket.id,\n      work_date: ticket.work_date,\n      ce_pco_number: ticket.ce_pco_number,\n      notes: ticket.notes,\n      status: ticket.status,\n      created_at: ticket.created_at,\n      workers: ticket.t_and_m_workers || [],\n      items: ticket.t_and_m_items || [],\n      photos: ticket.photos || [],\n      client_signature_name: ticket.client_signature_name,\n      client_signature_date: ticket.client_signature_date\n    })),\n    photos_manifest: photoManifest,\n    totals_snapshot: totals,\n    checksum: checksum\n  }\n}\n\n/**\n * Export a Change Order Request to PDF\n * @param {Object} cor - The COR data object\n * @param {Object} project - The project data\n * @param {Object} company - The company data\n * @param {Object} branding - Optional branding settings\n * @param {Object[]} tmTickets - Optional T&M tickets for backup documentation\n * @param {Object} options - Export options (verifyPhotos, createSnapshot)\n * @returns {Promise<Object>} Export result with optional snapshot and verification data\n */\nexport async function exportCORToPDF(cor, project, company, branding = {}, tmTickets = null, options = {}) {\n  const { verifyPhotos = false, createSnapshot = false } = options\n\n  // Photo verification (optional, for dispute-ready exports)\n  let photoManifest = null\n  if (verifyPhotos && tmTickets?.length > 0) {\n    photoManifest = await verifyPhotosForExport(tmTickets)\n  }\n  const { default: jsPDF } = await import('jspdf')\n  const { default: autoTable } = await import('jspdf-autotable')\n  const doc = new jsPDF()\n  const pageWidth = doc.internal.pageSize.getWidth()\n  const pageHeight = doc.internal.pageSize.getHeight()\n  const margin = 20\n  let yPos = margin\n\n  // Calculate totals\n  const totals = calculateCORTotals(cor)\n\n  // Colors\n  const primaryColor = branding.primaryColor ? hexToRgb(branding.primaryColor) : [30, 58, 138]\n  const headerBg = [241, 245, 249]\n\n  // Load company logo if available\n  let logoBase64 = null\n  if (branding.logoUrl) {\n    try {\n      logoBase64 = await loadImageAsBase64(branding.logoUrl)\n    } catch (e) {\n      console.error('Error loading logo:', e)\n    }\n  }\n\n  // ============================================\n  // HEADER\n  // ============================================\n\n  // Company Logo or Name\n  if (logoBase64) {\n    try {\n      doc.addImage(logoBase64, 'PNG', margin, yPos, 40, 15)\n      yPos += 20\n    } catch (e) {\n      doc.setFontSize(16)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(...primaryColor)\n      doc.text(company?.name || 'Company Name', margin, yPos + 10)\n      yPos += 20\n    }\n  } else {\n    doc.setFontSize(16)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(...primaryColor)\n    doc.text(company?.name || 'Company Name', margin, yPos + 10)\n    yPos += 20\n  }\n\n  // Title\n  doc.setFontSize(20)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(0, 0, 0)\n  doc.text('CHANGE ORDER REQUEST', margin, yPos)\n  yPos += 10\n\n  // COR Number and Status\n  doc.setFontSize(12)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(100, 100, 100)\n  doc.text(cor.cor_number || 'COR-XXXX', margin, yPos)\n\n  // Status badge\n  const statusText = cor.status?.replace('_', ' ').toUpperCase() || 'DRAFT'\n  doc.setTextColor(...primaryColor)\n  doc.text(statusText, pageWidth - margin - doc.getTextWidth(statusText), yPos)\n  yPos += 12\n\n  // Divider line\n  doc.setDrawColor(...primaryColor)\n  doc.setLineWidth(0.5)\n  doc.line(margin, yPos, pageWidth - margin, yPos)\n  yPos += 10\n\n  // ============================================\n  // PROJECT & COR INFO\n  // ============================================\n\n  doc.setFontSize(10)\n  doc.setTextColor(0, 0, 0)\n\n  // Two column layout for project info\n  const col1X = margin\n  const col2X = pageWidth / 2\n\n  doc.setFont('helvetica', 'bold')\n  doc.text('Project:', col1X, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.text(project?.name || 'Project Name', col1X + 25, yPos)\n\n  doc.setFont('helvetica', 'bold')\n  doc.text('Job #:', col2X, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.text(project?.job_number || 'N/A', col2X + 25, yPos)\n  yPos += 6\n\n  doc.setFont('helvetica', 'bold')\n  doc.text('Period:', col1X, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.text(formatDateRange(cor.period_start, cor.period_end), col1X + 25, yPos)\n\n  doc.setFont('helvetica', 'bold')\n  doc.text('Date:', col2X, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.text(formatDate(cor.created_at), col2X + 25, yPos)\n  yPos += 10\n\n  // COR Title\n  doc.setFont('helvetica', 'bold')\n  doc.setFontSize(12)\n  doc.text(cor.title || 'Untitled Change Order', margin, yPos)\n  yPos += 8\n\n  // Scope of Work\n  doc.setFont('helvetica', 'normal')\n  doc.setFontSize(10)\n  doc.setTextColor(80, 80, 80)\n  const scopeLines = doc.splitTextToSize(cor.scope_of_work || 'No scope of work provided.', pageWidth - (margin * 2))\n  doc.text(scopeLines, margin, yPos)\n  yPos += (scopeLines.length * 5) + 10\n\n  // ============================================\n  // LABOR SECTION\n  // ============================================\n\n  if (cor.change_order_labor?.length > 0) {\n    doc.setFont('helvetica', 'bold')\n    doc.setFontSize(11)\n    doc.setTextColor(0, 0, 0)\n    doc.text('LABOR', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Class', 'Type', 'Reg Hrs', 'Reg Rate', 'OT Hrs', 'OT Rate', 'Total']],\n      body: cor.change_order_labor.map(item => [\n        item.labor_class,\n        item.wage_type,\n        item.regular_hours.toString(),\n        `$${centsToDollars(item.regular_rate)}/hr`,\n        item.overtime_hours?.toString() || '-',\n        item.overtime_hours ? `$${centsToDollars(item.overtime_rate)}/hr` : '-',\n        formatCurrency(item.total)\n      ]),\n      foot: [[\n        { content: `Subtotal: ${formatCurrency(totals.labor_subtotal)}`, colSpan: 5, styles: { halign: 'right', fontStyle: 'bold' } },\n        { content: `+${formatPercent(cor.labor_markup_percent || 1500)} Markup`, colSpan: 1, styles: { halign: 'right' } },\n        { content: formatCurrency(totals.labor_subtotal + totals.labor_markup_amount), styles: { fontStyle: 'bold' } }\n      ]],\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontStyle: 'bold', fontSize: 8 },\n      bodyStyles: { fontSize: 8 },\n      footStyles: { fillColor: headerBg, textColor: [0, 0, 0], fontSize: 8 },\n      theme: 'striped'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // MATERIALS SECTION\n  // ============================================\n\n  if (cor.change_order_materials?.length > 0) {\n    // Check if we need a new page\n    if (yPos > pageHeight - 80) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    doc.setFont('helvetica', 'bold')\n    doc.setFontSize(11)\n    doc.setTextColor(0, 0, 0)\n    doc.text('MATERIALS', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Description', 'Source', 'Qty', 'Unit', 'Unit Cost', 'Total']],\n      body: cor.change_order_materials.map(item => [\n        item.description,\n        item.source_reference || item.source_type,\n        item.quantity.toString(),\n        item.unit,\n        `$${centsToDollars(item.unit_cost)}`,\n        formatCurrency(item.total)\n      ]),\n      foot: [[\n        { content: `Subtotal: ${formatCurrency(totals.materials_subtotal)}`, colSpan: 4, styles: { halign: 'right', fontStyle: 'bold' } },\n        { content: `+${formatPercent(cor.materials_markup_percent || 1500)} Markup`, colSpan: 1, styles: { halign: 'right' } },\n        { content: formatCurrency(totals.materials_subtotal + totals.materials_markup_amount), styles: { fontStyle: 'bold' } }\n      ]],\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontStyle: 'bold', fontSize: 8 },\n      bodyStyles: { fontSize: 8 },\n      footStyles: { fillColor: headerBg, textColor: [0, 0, 0], fontSize: 8 },\n      theme: 'striped'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // EQUIPMENT SECTION\n  // ============================================\n\n  if (cor.change_order_equipment?.length > 0) {\n    if (yPos > pageHeight - 80) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    doc.setFont('helvetica', 'bold')\n    doc.setFontSize(11)\n    doc.setTextColor(0, 0, 0)\n    doc.text('EQUIPMENT', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Description', 'Source', 'Qty', 'Unit', 'Unit Cost', 'Total']],\n      body: cor.change_order_equipment.map(item => [\n        item.description,\n        item.source_reference || item.source_type,\n        item.quantity.toString(),\n        item.unit,\n        `$${centsToDollars(item.unit_cost)}`,\n        formatCurrency(item.total)\n      ]),\n      foot: [[\n        { content: `Subtotal: ${formatCurrency(totals.equipment_subtotal)}`, colSpan: 4, styles: { halign: 'right', fontStyle: 'bold' } },\n        { content: `+${formatPercent(cor.equipment_markup_percent || 1500)} Markup`, colSpan: 1, styles: { halign: 'right' } },\n        { content: formatCurrency(totals.equipment_subtotal + totals.equipment_markup_amount), styles: { fontStyle: 'bold' } }\n      ]],\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontStyle: 'bold', fontSize: 8 },\n      bodyStyles: { fontSize: 8 },\n      footStyles: { fillColor: headerBg, textColor: [0, 0, 0], fontSize: 8 },\n      theme: 'striped'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // SUBCONTRACTORS SECTION\n  // ============================================\n\n  if (cor.change_order_subcontractors?.length > 0) {\n    if (yPos > pageHeight - 80) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    doc.setFont('helvetica', 'bold')\n    doc.setFontSize(11)\n    doc.setTextColor(0, 0, 0)\n    doc.text('SUBCONTRACTORS', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Company', 'Description', 'Source', 'Amount']],\n      body: cor.change_order_subcontractors.map(item => [\n        item.company_name,\n        item.description,\n        item.source_reference || item.source_type,\n        formatCurrency(item.total)\n      ]),\n      foot: [[\n        { content: `Subtotal: ${formatCurrency(totals.subcontractors_subtotal)}`, colSpan: 2, styles: { halign: 'right', fontStyle: 'bold' } },\n        { content: `+${formatPercent(cor.subcontractors_markup_percent || 500)} Markup`, colSpan: 1, styles: { halign: 'right' } },\n        { content: formatCurrency(totals.subcontractors_subtotal + totals.subcontractors_markup_amount), styles: { fontStyle: 'bold' } }\n      ]],\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontStyle: 'bold', fontSize: 8 },\n      bodyStyles: { fontSize: 8 },\n      footStyles: { fillColor: headerBg, textColor: [0, 0, 0], fontSize: 8 },\n      theme: 'striped'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // TOTALS SECTION\n  // ============================================\n\n  if (yPos > pageHeight - 100) {\n    doc.addPage()\n    yPos = margin\n  }\n\n  // Totals box\n  doc.setFillColor(...headerBg)\n  doc.roundedRect(margin, yPos, pageWidth - (margin * 2), 70, 3, 3, 'F')\n\n  yPos += 10\n  doc.setFontSize(10)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(0, 0, 0)\n\n  const totalsCol1 = margin + 10\n  const totalsCol2 = pageWidth - margin - 60\n\n  // COR Subtotal\n  doc.text('COR Subtotal:', totalsCol1, yPos)\n  doc.setFont('helvetica', 'bold')\n  doc.text(formatCurrency(totals.cor_subtotal), totalsCol2, yPos, { align: 'right' })\n  yPos += 8\n\n  // Additional Fees\n  doc.setFont('helvetica', 'normal')\n  doc.setFontSize(9)\n  doc.text(`Liability Insurance (${formatPercent(cor.liability_insurance_percent || 144)}):`, totalsCol1, yPos)\n  doc.text(formatCurrency(totals.liability_insurance_amount), totalsCol2, yPos, { align: 'right' })\n  yPos += 6\n\n  doc.text(`Bond (${formatPercent(cor.bond_percent || 100)}):`, totalsCol1, yPos)\n  doc.text(formatCurrency(totals.bond_amount), totalsCol2, yPos, { align: 'right' })\n  yPos += 6\n\n  doc.text(`City License Fee (${formatPercent(cor.license_fee_percent || 10)}):`, totalsCol1, yPos)\n  doc.text(formatCurrency(totals.license_fee_amount), totalsCol2, yPos, { align: 'right' })\n  yPos += 10\n\n  // Grand Total\n  doc.setFillColor(...primaryColor)\n  doc.roundedRect(totalsCol1 - 5, yPos - 3, pageWidth - (margin * 2) - 10, 16, 2, 2, 'F')\n  doc.setTextColor(255, 255, 255)\n  doc.setFontSize(12)\n  doc.setFont('helvetica', 'bold')\n  doc.text('COR TOTAL:', totalsCol1, yPos + 8)\n  doc.text(formatCurrency(totals.cor_total), totalsCol2, yPos + 8, { align: 'right' })\n  yPos += 25\n\n  // ============================================\n  // SIGNATURE SECTION (Dual Signatures)\n  // ============================================\n\n  if (yPos > pageHeight - 120) {\n    doc.addPage()\n    yPos = margin\n  }\n\n  yPos += 10\n  doc.setTextColor(0, 0, 0)\n  doc.setFontSize(10)\n  doc.setFont('helvetica', 'bold')\n  doc.text('AUTHORIZATION', margin, yPos)\n  yPos += 15\n\n  doc.setFont('helvetica', 'normal')\n  doc.setFontSize(9)\n  doc.setDrawColor(0, 0, 0)\n\n  // Helper function to render a signature block\n  const renderSignatureBlock = (startY, label, signatureData, signerName, signerTitle, signerCompany, signedDate) => {\n    // Label\n    doc.setFont('helvetica', 'bold')\n    doc.setFontSize(8)\n    doc.text(label, margin, startY)\n    doc.setFont('helvetica', 'normal')\n    doc.setFontSize(9)\n\n    const sigLineY = startY + 20\n\n    // Signature line\n    doc.line(margin, sigLineY, margin + 70, sigLineY)\n    doc.text('Signature', margin, sigLineY + 8)\n\n    // Title/Company line\n    doc.line(margin + 85, sigLineY, margin + 145, sigLineY)\n    doc.text('Title / Company', margin + 85, sigLineY + 8)\n\n    // Date line\n    doc.line(pageWidth - margin - 40, sigLineY, pageWidth - margin, sigLineY)\n    doc.text('Date', pageWidth - margin - 40, sigLineY + 8)\n\n    // If signature exists, add it\n    if (signatureData) {\n      try {\n        doc.addImage(signatureData, 'PNG', margin, sigLineY - 18, 60, 18)\n        if (signerName) {\n          doc.setFontSize(8)\n          doc.text(signerName, margin, sigLineY + 15)\n        }\n        if (signerTitle || signerCompany) {\n          const titleCompany = [signerTitle, signerCompany].filter(Boolean).join(' - ')\n          doc.text(titleCompany, margin + 85, sigLineY - 5)\n        }\n        if (signedDate) {\n          doc.text(formatDate(signedDate), pageWidth - margin - 40, sigLineY - 5)\n        }\n      } catch (e) {\n        console.error('Error adding signature:', e)\n      }\n    } else {\n      // Show \"Awaiting Signature\" when not yet signed\n      doc.setFont('helvetica', 'italic')\n      doc.setFontSize(9)\n      doc.setTextColor(150, 150, 150)\n      doc.text('Awaiting Signature', margin + 5, sigLineY - 5)\n      doc.setTextColor(0, 0, 0)\n      doc.setFont('helvetica', 'normal')\n    }\n\n    return sigLineY + 25\n  }\n\n  // GC Signature (Signature 1)\n  yPos = renderSignatureBlock(\n    yPos,\n    'GC AUTHORIZATION',\n    cor.gc_signature_data || cor.gc_signature,\n    cor.gc_signature_name || cor.gc_signer_name,\n    cor.gc_signature_title,\n    cor.gc_signature_company,\n    cor.gc_signature_date || cor.signed_at\n  )\n\n  yPos += 10\n\n  // Client Signature (Signature 2)\n  yPos = renderSignatureBlock(\n    yPos,\n    'CLIENT AUTHORIZATION',\n    cor.client_signature_data,\n    cor.client_signature_name,\n    cor.client_signature_title,\n    cor.client_signature_company,\n    cor.client_signature_date\n  )\n\n  // ============================================\n  // T&M BACKUP SECTION (if tickets provided)\n  // Professional Layout with Cover Page\n  // ============================================\n\n  if (tmTickets && tmTickets.length > 0) {\n    // Calculate summary statistics\n    const totalLaborHours = tmTickets.reduce((sum, t) =>\n      sum + (t.t_and_m_workers?.reduce((wSum, w) => wSum + (parseFloat(w.hours) || 0), 0) || 0), 0\n    )\n    const totalOTHours = tmTickets.reduce((sum, t) =>\n      sum + (t.t_and_m_workers?.reduce((wSum, w) => wSum + (parseFloat(w.overtime_hours) || 0), 0) || 0), 0\n    )\n    const totalPhotos = tmTickets.reduce((sum, t) => sum + (t.photos?.length || 0), 0)\n    const verifiedCount = tmTickets.filter(t => t.client_signature_data).length\n    const dateRange = tmTickets.length > 0 ? {\n      start: tmTickets.reduce((min, t) => !min || t.work_date < min ? t.work_date : min, null),\n      end: tmTickets.reduce((max, t) => !max || t.work_date > max ? t.work_date : max, null)\n    } : null\n\n    // Generate document ID with secure random suffix\n    const docIdArray = new Uint8Array(3)\n    crypto.getRandomValues(docIdArray)\n    const docIdSuffix = Array.from(docIdArray, b => b.toString(36)).join('').toUpperCase().substring(0, 4)\n    const docId = `FS-${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}${String(new Date().getDate()).padStart(2, '0')}-${docIdSuffix}`\n\n    doc.addPage()\n    yPos = margin\n\n    // ============================================\n    // BACKUP COVER PAGE\n    // ============================================\n\n    // Company Logo/Name at top\n    if (logoBase64) {\n      try {\n        doc.addImage(logoBase64, 'PNG', margin, yPos, 50, 18)\n      } catch (e) {\n        doc.setFontSize(14)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(...primaryColor)\n        doc.text(company?.name || 'Company Name', margin, yPos + 10)\n      }\n    } else {\n      doc.setFontSize(14)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(...primaryColor)\n      doc.text(company?.name || 'Company Name', margin, yPos + 10)\n    }\n    yPos += 35\n\n    // Decorative double line\n    doc.setDrawColor(...primaryColor)\n    doc.setLineWidth(0.8)\n    doc.line(margin, yPos, pageWidth - margin, yPos)\n    doc.setLineWidth(0.3)\n    doc.line(margin, yPos + 3, pageWidth - margin, yPos + 3)\n    yPos += 15\n\n    // Title\n    doc.setFontSize(22)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(30, 41, 59)\n    doc.text('SUPPORTING DOCUMENTATION', pageWidth / 2, yPos, { align: 'center' })\n    yPos += 8\n\n    doc.setFontSize(12)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(100, 116, 139)\n    doc.text('Change Order Request Backup', pageWidth / 2, yPos, { align: 'center' })\n    yPos += 8\n\n    // Decorative double line\n    doc.setDrawColor(...primaryColor)\n    doc.setLineWidth(0.3)\n    doc.line(margin, yPos, pageWidth - margin, yPos)\n    doc.setLineWidth(0.8)\n    doc.line(margin, yPos + 3, pageWidth - margin, yPos + 3)\n    yPos += 20\n\n    // Reference info\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(30, 41, 59)\n    doc.text('COR Reference:', margin, yPos)\n    doc.setFont('helvetica', 'normal')\n    doc.text(cor.cor_number || 'N/A', margin + 35, yPos)\n\n    doc.setFont('helvetica', 'bold')\n    doc.text('Project:', pageWidth / 2, yPos)\n    doc.setFont('helvetica', 'normal')\n    doc.text(project?.name || 'N/A', pageWidth / 2 + 20, yPos)\n    yPos += 7\n\n    doc.setFont('helvetica', 'bold')\n    doc.text('Job #:', margin, yPos)\n    doc.setFont('helvetica', 'normal')\n    doc.text(project?.job_number || 'N/A', margin + 35, yPos)\n    yPos += 20\n\n    // Summary Box\n    doc.setFillColor(248, 250, 252)\n    doc.setDrawColor(203, 213, 225)\n    doc.roundedRect(margin, yPos, pageWidth - (margin * 2), 65, 4, 4, 'FD')\n\n    yPos += 10\n    doc.setFontSize(11)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(30, 41, 59)\n    doc.text('DOCUMENTATION SUMMARY', margin + 10, yPos)\n\n    doc.setDrawColor(203, 213, 225)\n    doc.setLineWidth(0.3)\n    doc.line(margin + 10, yPos + 3, margin + 80, yPos + 3)\n    yPos += 12\n\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(71, 85, 105)\n\n    const summaryCol1 = margin + 15\n    const summaryCol2 = margin + 70\n\n    doc.text('Time & Material Tickets:', summaryCol1, yPos)\n    doc.setFont('helvetica', 'bold')\n    doc.text(String(tmTickets.length), summaryCol2, yPos)\n    doc.setFont('helvetica', 'normal')\n    yPos += 7\n\n    doc.text('Total Labor:', summaryCol1, yPos)\n    doc.setFont('helvetica', 'bold')\n    doc.text(`${totalLaborHours.toFixed(1)} hrs`, summaryCol2, yPos)\n    doc.setFont('helvetica', 'normal')\n    yPos += 7\n\n    if (totalOTHours > 0) {\n      doc.text('Total OT:', summaryCol1, yPos)\n      doc.setFont('helvetica', 'bold')\n      doc.text(`${totalOTHours.toFixed(1)} hrs`, summaryCol2, yPos)\n      doc.setFont('helvetica', 'normal')\n      yPos += 7\n    }\n\n    doc.text('Photo Evidence:', summaryCol1, yPos)\n    doc.setFont('helvetica', 'bold')\n    doc.text(`${totalPhotos} photos`, summaryCol2, yPos)\n    doc.setFont('helvetica', 'normal')\n    yPos += 7\n\n    doc.text('Client Verified:', summaryCol1, yPos)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(verifiedCount > 0 ? 16 : 71, verifiedCount > 0 ? 185 : 85, verifiedCount > 0 ? 129 : 105)\n    doc.text(`${verifiedCount} of ${tmTickets.length} tickets`, summaryCol2, yPos)\n    doc.setTextColor(71, 85, 105)\n    doc.setFont('helvetica', 'normal')\n    yPos += 7\n\n    if (dateRange?.start && dateRange?.end) {\n      doc.text('Date Range:', summaryCol1, yPos)\n      doc.setFont('helvetica', 'bold')\n      doc.text(`${formatDate(dateRange.start)} - ${formatDate(dateRange.end)}`, summaryCol2, yPos)\n    }\n\n    yPos += 30\n\n    // Footer info\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(100, 116, 139)\n    const genDate = new Date()\n    doc.text(`Generated: ${genDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })} at ${genDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}`, margin, yPos)\n    yPos += 6\n    doc.text(`Document ID: ${docId}`, margin, yPos)\n\n    // ============================================\n    // INDIVIDUAL TICKET PAGES\n    // ============================================\n\n    for (const ticket of tmTickets) {\n      doc.addPage()\n      yPos = margin\n\n      const hasVerification = !!ticket.client_signature_data\n\n      // Ticket Header with colored left border\n      const headerHeight = 22\n      const ticketStatusColor = hasVerification ? [16, 185, 129] : (ticket.status === 'approved' ? [16, 185, 129] : [245, 158, 11])\n\n      // Colored left border\n      doc.setFillColor(...ticketStatusColor)\n      doc.rect(margin, yPos, 4, headerHeight, 'F')\n\n      // Header background\n      doc.setFillColor(248, 250, 252)\n      doc.rect(margin + 4, yPos, pageWidth - (margin * 2) - 4, headerHeight, 'F')\n\n      // Ticket title\n      doc.setFontSize(12)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(30, 41, 59)\n      doc.text(`TIME & MATERIAL TICKET  ${formatDate(ticket.work_date)}`, margin + 10, yPos + 8)\n\n      // CE/PCO badge\n      if (ticket.ce_pco_number) {\n        doc.setFontSize(9)\n        doc.setFont('helvetica', 'normal')\n        doc.setTextColor(59, 130, 246)\n        doc.text(`CE/PCO: ${ticket.ce_pco_number}`, margin + 10, yPos + 16)\n      }\n\n      // Verified badge\n      if (hasVerification) {\n        doc.setFontSize(8)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(16, 185, 129)\n        doc.text(' CLIENT VERIFIED', pageWidth - margin - 35, yPos + 12)\n      }\n\n      yPos += headerHeight + 8\n\n      // Description/Notes\n      if (ticket.notes) {\n        doc.setFontSize(10)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text('DESCRIPTION', margin, yPos)\n        yPos += 6\n\n        doc.setFontSize(9)\n        doc.setFont('helvetica', 'normal')\n        doc.setTextColor(51, 65, 85)\n        const notesLines = doc.splitTextToSize(ticket.notes, pageWidth - (margin * 2))\n        doc.text(notesLines, margin, yPos)\n        yPos += (notesLines.length * 4) + 10\n      }\n\n      // Workers table\n      if (ticket.t_and_m_workers?.length > 0) {\n        doc.setFontSize(10)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text('LABOR', margin, yPos)\n        yPos += 6\n\n        autoTable(doc, {\n          startY: yPos,\n          head: [['Worker', 'Time Period', 'Class', 'Reg Hrs', 'OT Hrs']],\n          body: ticket.t_and_m_workers.map(w => [\n            w.name,\n            formatTimePeriod(w),\n            w.role || w.labor_class || 'Laborer',\n            w.hours?.toString() || '0',\n            w.overtime_hours?.toString() || '-'\n          ]),\n          margin: { left: margin, right: margin },\n          headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 8, cellPadding: 3, fontStyle: 'bold' },\n          bodyStyles: { fontSize: 8, cellPadding: 3 },\n          alternateRowStyles: { fillColor: [248, 250, 252] },\n          theme: 'grid'\n        })\n\n        yPos = doc.lastAutoTable.finalY + 10\n      }\n\n      // Items table (materials/equipment)\n      if (ticket.t_and_m_items?.length > 0) {\n        if (yPos > pageHeight - 60) {\n          doc.addPage()\n          yPos = margin\n        }\n\n        doc.setFontSize(10)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text('MATERIALS / EQUIPMENT', margin, yPos)\n\n        // Source badge\n        doc.setFontSize(7)\n        doc.setFont('helvetica', 'normal')\n        doc.setTextColor(100, 116, 139)\n        doc.text('Source: Time & Material Ticket', margin + 55, yPos)\n        yPos += 6\n\n        autoTable(doc, {\n          startY: yPos,\n          head: [['Item', 'Qty', 'Unit', 'Unit Cost', 'Total']],\n          body: ticket.t_and_m_items.map(item => [\n            item.materials_equipment?.name || item.description || 'Item',\n            item.quantity?.toString() || '1',\n            item.materials_equipment?.unit || 'ea',\n            item.materials_equipment?.cost_per_unit ? `$${item.materials_equipment.cost_per_unit}` : '-',\n            item.materials_equipment?.cost_per_unit && item.quantity\n              ? `$${(item.quantity * item.materials_equipment.cost_per_unit).toFixed(2)}`\n              : '-'\n          ]),\n          margin: { left: margin, right: margin },\n          headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 8, cellPadding: 3, fontStyle: 'bold' },\n          bodyStyles: { fontSize: 8, cellPadding: 3 },\n          alternateRowStyles: { fillColor: [248, 250, 252] },\n          theme: 'grid'\n        })\n\n        yPos = doc.lastAutoTable.finalY + 10\n      }\n\n      // Photos - Professional Evidence Section\n      if (ticket.photos?.length > 0) {\n        if (yPos > pageHeight - 80) {\n          doc.addPage()\n          yPos = margin\n        }\n\n        doc.setFontSize(10)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text('PHOTO DOCUMENTATION', margin, yPos)\n\n        // Photo count badge\n        doc.setFontSize(8)\n        doc.setFont('helvetica', 'normal')\n        doc.setTextColor(59, 130, 246)\n        doc.text(`${ticket.photos.length} photo${ticket.photos.length !== 1 ? 's' : ''}`, margin + 50, yPos)\n        yPos += 8\n\n        let xPos = margin\n        const photoWidth = 55\n        const photoHeight = 45\n        const photoGap = 6\n        const photosPerRow = 3\n        const frameWidth = 1\n\n        // Load all photos in parallel for faster PDF generation\n        const photoImages = await loadImagesAsBase64(ticket.photos)\n\n        for (let i = 0; i < ticket.photos.length; i++) {\n          // Check if we need to wrap to next row\n          if (i > 0 && i % photosPerRow === 0) {\n            xPos = margin\n            yPos += photoHeight + photoGap + 4\n          }\n\n          // Check if we need a new page\n          if (yPos + photoHeight > pageHeight - 20) {\n            doc.addPage()\n            yPos = margin\n            xPos = margin\n          }\n\n          const imgData = photoImages[i]\n          if (imgData) {\n            // Draw frame border\n            doc.setDrawColor(200, 200, 200)\n            doc.setLineWidth(frameWidth)\n            doc.rect(xPos - frameWidth, yPos - frameWidth, photoWidth + frameWidth * 2, photoHeight + frameWidth * 2, 'S')\n\n            // Add photo with shadow effect (light gray background offset)\n            doc.setFillColor(230, 230, 230)\n            doc.rect(xPos + 2, yPos + 2, photoWidth, photoHeight, 'F')\n\n            doc.addImage(imgData, 'JPEG', xPos, yPos, photoWidth, photoHeight)\n          } else {\n            // Draw placeholder for failed images\n            doc.setFillColor(245, 245, 245)\n            doc.rect(xPos, yPos, photoWidth, photoHeight, 'F')\n            doc.setDrawColor(200, 200, 200)\n            doc.rect(xPos, yPos, photoWidth, photoHeight, 'S')\n            doc.setFontSize(7)\n            doc.setTextColor(150, 150, 150)\n            doc.text('Photo unavailable', xPos + 8, yPos + photoHeight / 2)\n          }\n\n          xPos += photoWidth + photoGap\n        }\n\n        yPos += photoHeight + 12\n      }\n\n      // Client Signature Verification Block (if ticket was signed) - Professional styling\n      if (ticket.client_signature_data) {\n        if (yPos > pageHeight - 50) {\n          doc.addPage()\n          yPos = margin\n        }\n\n        // Verification block with green background\n        const verifyBlockHeight = 32\n        const verifyBlockWidth = pageWidth - (margin * 2)\n\n        // Light green background\n        doc.setFillColor(240, 253, 244) // Very light green\n        doc.roundedRect(margin, yPos, verifyBlockWidth, verifyBlockHeight, 3, 3, 'F')\n\n        // Green left accent border\n        doc.setFillColor(16, 185, 129)\n        doc.rect(margin, yPos, 4, verifyBlockHeight, 'F')\n\n        // Top border line\n        doc.setDrawColor(187, 247, 208)\n        doc.setLineWidth(0.5)\n        doc.line(margin + 4, yPos, margin + verifyBlockWidth, yPos)\n\n        // Checkmark seal icon (circle)\n        const sealX = margin + 14\n        const sealY = yPos + verifyBlockHeight / 2\n        doc.setFillColor(16, 185, 129)\n        doc.circle(sealX, sealY, 6, 'F')\n        doc.setFontSize(9)\n        doc.setTextColor(255, 255, 255)\n        doc.text('', sealX - 2.5, sealY + 3)\n\n        // \"CLIENT VERIFIED\" header\n        doc.setFontSize(9)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(16, 185, 129)\n        doc.text('CLIENT VERIFIED', margin + 26, yPos + 10)\n\n        try {\n          // Add signature image\n          const sigWidth = 50\n          const sigHeight = 16\n          doc.addImage(ticket.client_signature_data, 'PNG', margin + 26, yPos + 13, sigWidth, sigHeight)\n\n          // Add signer info to the right of signature\n          const signerName = ticket.client_signature_name || 'Client'\n          const signerTitle = ticket.client_signature_title || ''\n          const signerCompany = ticket.client_signature_company || ''\n          const signedDate = ticket.client_signature_date\n            ? formatDate(ticket.client_signature_date)\n            : ''\n\n          const infoX = margin + 85\n\n          doc.setFont('helvetica', 'bold')\n          doc.setFontSize(9)\n          doc.setTextColor(30, 41, 59)\n          doc.text(signerName, infoX, yPos + 12)\n\n          doc.setFont('helvetica', 'normal')\n          doc.setFontSize(8)\n          doc.setTextColor(71, 85, 105)\n          if (signerTitle || signerCompany) {\n            doc.text(`${signerTitle}${signerTitle && signerCompany ? ', ' : ''}${signerCompany}`, infoX, yPos + 18)\n          }\n          if (signedDate) {\n            doc.setTextColor(100, 116, 139)\n            doc.text(`Verified: ${signedDate}`, infoX, yPos + 24)\n          }\n        } catch (e) {\n          // If signature image fails, show text info\n          const signerName = ticket.client_signature_name || 'Client'\n          doc.setFont('helvetica', 'normal')\n          doc.setFontSize(9)\n          doc.setTextColor(30, 41, 59)\n          doc.text(`Signed by: ${signerName}`, margin + 26, yPos + 20)\n        }\n\n        yPos += verifyBlockHeight + 8\n      }\n\n      // Ticket divider\n      yPos += 5\n      doc.setDrawColor(200, 200, 200)\n      doc.setLineWidth(0.2)\n      doc.line(margin, yPos, pageWidth - margin, yPos)\n      yPos += 10\n    }\n  }\n\n  // ============================================\n  // FOOTER (on all pages)\n  // ============================================\n\n  const totalPages = doc.internal.getNumberOfPages()\n  for (let i = 1; i <= totalPages; i++) {\n    doc.setPage(i)\n    const footerY = pageHeight - 10\n    doc.setFontSize(8)\n    doc.setTextColor(150, 150, 150)\n    doc.text(`Generated on ${new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`, margin, footerY)\n    doc.text(`Page ${i} of ${totalPages}`, pageWidth - margin, footerY, { align: 'right' })\n  }\n\n  // Save the PDF\n  const fileName = `${cor.cor_number || 'COR'}_${project?.job_number || 'export'}${tmTickets?.length ? '_with_backup' : ''}.pdf`\n  doc.save(fileName)\n\n  // Build export result\n  const result = {\n    success: true,\n    fileName,\n    exportedAt: new Date().toISOString(),\n    photoManifest\n  }\n\n  // Create snapshot for dispute-ready export (if requested)\n  if (createSnapshot) {\n    result.snapshot = createExportSnapshot(cor, tmTickets, photoManifest, totals)\n  }\n\n  return result\n}\n\n/**\n * Export a single T&M ticket to PDF\n * @param {Object} ticket - T&M ticket data\n * @param {Object} project - Project data\n * @param {Object} company - Company data\n * @param {Object} branding - Company branding (logoUrl, primaryColor)\n */\nexport async function exportTMTicketToPDF(ticket, project, company, branding = {}) {\n  const { default: jsPDF } = await import('jspdf')\n  const { default: autoTable } = await import('jspdf-autotable')\n  const doc = new jsPDF('p', 'mm', 'letter')\n  const pageWidth = doc.internal.pageSize.getWidth()\n  const pageHeight = doc.internal.pageSize.getHeight()\n  const margin = 20\n  let yPos = margin\n\n  const primaryColor = branding.primaryColor\n    ? hexToRgb(branding.primaryColor)\n    : [30, 58, 95]\n\n  // ============================================\n  // HEADER\n  // ============================================\n\n  // Company info or logo\n  if (branding.logoUrl) {\n    try {\n      const logoData = await loadImageAsBase64(branding.logoUrl)\n      if (logoData) {\n        doc.addImage(logoData, 'PNG', margin, yPos, 40, 15)\n      }\n    } catch (e) {\n      // Fall back to company name\n      if (company?.name) {\n        doc.setFontSize(14)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(...primaryColor)\n        doc.text(company.name, margin, yPos + 8)\n      }\n    }\n  } else if (company?.name) {\n    doc.setFontSize(14)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(...primaryColor)\n    doc.text(company.name, margin, yPos + 8)\n  }\n\n  // T&M Ticket title\n  doc.setFontSize(16)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(30, 41, 59)\n  doc.text('TIME & MATERIAL TICKET', pageWidth - margin, yPos + 8, { align: 'right' })\n\n  yPos += 25\n\n  // Divider line\n  doc.setDrawColor(...primaryColor)\n  doc.setLineWidth(0.5)\n  doc.line(margin, yPos, pageWidth - margin, yPos)\n  yPos += 10\n\n  // ============================================\n  // TICKET INFO\n  // ============================================\n\n  const hasVerification = !!ticket.client_signature_data\n\n  // Status indicator\n  if (hasVerification) {\n    doc.setFillColor(240, 253, 244)\n    doc.roundedRect(pageWidth - margin - 45, yPos - 5, 45, 12, 2, 2, 'F')\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(16, 185, 129)\n    doc.text(' CLIENT VERIFIED', pageWidth - margin - 42, yPos + 3)\n  }\n\n  // Project and date info\n  doc.setFontSize(10)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(71, 85, 105)\n  doc.text('Project:', margin, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(30, 41, 59)\n  doc.text(project?.name || 'N/A', margin + 20, yPos)\n  yPos += 6\n\n  if (project?.job_number) {\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('Job #:', margin, yPos)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(30, 41, 59)\n    doc.text(project.job_number, margin + 20, yPos)\n    yPos += 6\n  }\n\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(71, 85, 105)\n  doc.text('Work Date:', margin, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(30, 41, 59)\n  doc.text(formatDate(ticket.work_date || ticket.ticket_date), margin + 26, yPos)\n\n  if (ticket.ce_pco_number) {\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('CE/PCO:', margin + 70, yPos)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(59, 130, 246)\n    doc.text(ticket.ce_pco_number, margin + 88, yPos)\n  }\n\n  yPos += 12\n\n  // Description/Notes\n  if (ticket.notes) {\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('DESCRIPTION', margin, yPos)\n    yPos += 6\n\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(51, 65, 85)\n    const notesLines = doc.splitTextToSize(ticket.notes, pageWidth - (margin * 2))\n    doc.text(notesLines, margin, yPos)\n    yPos += (notesLines.length * 4) + 10\n  }\n\n  // ============================================\n  // LABOR TABLE\n  // ============================================\n\n  if (ticket.t_and_m_workers?.length > 0) {\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('LABOR', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Worker', 'Time Period', 'Class', 'Reg Hrs', 'OT Hrs']],\n      body: ticket.t_and_m_workers.map(w => [\n        w.name,\n        formatTimePeriod(w),\n        w.role || w.labor_class || 'Laborer',\n        w.hours?.toString() || '0',\n        w.overtime_hours?.toString() || '-'\n      ]),\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 8, cellPadding: 3, fontStyle: 'bold' },\n      bodyStyles: { fontSize: 8, cellPadding: 3 },\n      alternateRowStyles: { fillColor: [248, 250, 252] },\n      theme: 'grid'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // MATERIALS/EQUIPMENT\n  // ============================================\n\n  const materials = ticket.t_and_m_items || ticket.materials_equipment?.filter(m => m.type === 'material') || []\n  if (materials.length > 0) {\n    if (yPos > pageHeight - 60) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('MATERIALS / EQUIPMENT', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Item', 'Qty', 'Unit']],\n      body: materials.map(item => [\n        item.materials_equipment?.name || item.description || item.name || 'Item',\n        item.quantity?.toString() || '1',\n        item.materials_equipment?.unit || item.unit || 'ea'\n      ]),\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 8, cellPadding: 3, fontStyle: 'bold' },\n      bodyStyles: { fontSize: 8, cellPadding: 3 },\n      alternateRowStyles: { fillColor: [248, 250, 252] },\n      theme: 'grid'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // PHOTOS\n  // ============================================\n\n  if (ticket.photos?.length > 0) {\n    if (yPos > pageHeight - 80) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('PHOTO DOCUMENTATION', margin, yPos)\n\n    doc.setFontSize(8)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(59, 130, 246)\n    doc.text(`${ticket.photos.length} photo${ticket.photos.length !== 1 ? 's' : ''}`, margin + 50, yPos)\n    yPos += 8\n\n    let xPos = margin\n    const photoWidth = 55\n    const photoHeight = 45\n    const photoGap = 6\n    const photosPerRow = 3\n\n    // Load all photos in parallel for faster PDF generation\n    const photoImages = await loadImagesAsBase64(ticket.photos)\n\n    for (let i = 0; i < ticket.photos.length; i++) {\n      if (i > 0 && i % photosPerRow === 0) {\n        xPos = margin\n        yPos += photoHeight + photoGap + 4\n      }\n\n      if (yPos + photoHeight > pageHeight - 20) {\n        doc.addPage()\n        yPos = margin\n        xPos = margin\n      }\n\n      const imgData = photoImages[i]\n      if (imgData) {\n        doc.setDrawColor(200, 200, 200)\n        doc.setLineWidth(1)\n        doc.rect(xPos - 1, yPos - 1, photoWidth + 2, photoHeight + 2, 'S')\n        doc.setFillColor(230, 230, 230)\n        doc.rect(xPos + 2, yPos + 2, photoWidth, photoHeight, 'F')\n        doc.addImage(imgData, 'JPEG', xPos, yPos, photoWidth, photoHeight)\n      } else {\n        doc.setFillColor(245, 245, 245)\n        doc.rect(xPos, yPos, photoWidth, photoHeight, 'F')\n        doc.setDrawColor(200, 200, 200)\n        doc.rect(xPos, yPos, photoWidth, photoHeight, 'S')\n        doc.setFontSize(7)\n        doc.setTextColor(150, 150, 150)\n        doc.text('Photo unavailable', xPos + 8, yPos + photoHeight / 2)\n      }\n\n      xPos += photoWidth + photoGap\n    }\n\n    yPos += photoHeight + 12\n  }\n\n  // ============================================\n  // CLIENT VERIFICATION\n  // ============================================\n\n  if (ticket.client_signature_data) {\n    if (yPos > pageHeight - 50) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    const verifyBlockHeight = 32\n    const verifyBlockWidth = pageWidth - (margin * 2)\n\n    doc.setFillColor(240, 253, 244)\n    doc.roundedRect(margin, yPos, verifyBlockWidth, verifyBlockHeight, 3, 3, 'F')\n\n    doc.setFillColor(16, 185, 129)\n    doc.rect(margin, yPos, 4, verifyBlockHeight, 'F')\n\n    doc.setDrawColor(187, 247, 208)\n    doc.setLineWidth(0.5)\n    doc.line(margin + 4, yPos, margin + verifyBlockWidth, yPos)\n\n    const sealX = margin + 14\n    const sealY = yPos + verifyBlockHeight / 2\n    doc.setFillColor(16, 185, 129)\n    doc.circle(sealX, sealY, 6, 'F')\n    doc.setFontSize(9)\n    doc.setTextColor(255, 255, 255)\n    doc.text('', sealX - 2.5, sealY + 3)\n\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(16, 185, 129)\n    doc.text('CLIENT VERIFIED', margin + 26, yPos + 10)\n\n    try {\n      const sigWidth = 50\n      const sigHeight = 16\n      doc.addImage(ticket.client_signature_data, 'PNG', margin + 26, yPos + 13, sigWidth, sigHeight)\n\n      const signerName = ticket.client_signature_name || 'Client'\n      const signerTitle = ticket.client_signature_title || ''\n      const signerCompany = ticket.client_signature_company || ''\n      const signedDate = ticket.client_signature_date\n        ? formatDate(ticket.client_signature_date)\n        : ''\n\n      const infoX = margin + 85\n\n      doc.setFont('helvetica', 'bold')\n      doc.setFontSize(9)\n      doc.setTextColor(30, 41, 59)\n      doc.text(signerName, infoX, yPos + 12)\n\n      doc.setFont('helvetica', 'normal')\n      doc.setFontSize(8)\n      doc.setTextColor(71, 85, 105)\n      if (signerTitle || signerCompany) {\n        doc.text(`${signerTitle}${signerTitle && signerCompany ? ', ' : ''}${signerCompany}`, infoX, yPos + 18)\n      }\n      if (signedDate) {\n        doc.setTextColor(100, 116, 139)\n        doc.text(`Verified: ${signedDate}`, infoX, yPos + 24)\n      }\n    } catch (e) {\n      const signerName = ticket.client_signature_name || 'Client'\n      doc.setFont('helvetica', 'normal')\n      doc.setFontSize(9)\n      doc.setTextColor(30, 41, 59)\n      doc.text(`Signed by: ${signerName}`, margin + 26, yPos + 20)\n    }\n\n    yPos += verifyBlockHeight + 8\n  }\n\n  // ============================================\n  // FOOTER\n  // ============================================\n\n  const totalPages = doc.internal.getNumberOfPages()\n  for (let i = 1; i <= totalPages; i++) {\n    doc.setPage(i)\n    const footerY = pageHeight - 10\n    doc.setFontSize(8)\n    doc.setTextColor(150, 150, 150)\n    doc.text(`Generated on ${new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`, margin, footerY)\n    doc.text(`Page ${i} of ${totalPages}`, pageWidth - margin, footerY, { align: 'right' })\n  }\n\n  // Save the PDF\n  const ticketDate = formatDate(ticket.work_date || ticket.ticket_date).replace(/\\//g, '-')\n  const fileName = `TM_Ticket_${ticketDate}${ticket.ce_pco_number ? '_' + ticket.ce_pco_number : ''}.pdf`\n  doc.save(fileName)\n\n  return { success: true, fileName }\n}\n","import { useState, useEffect, useMemo } from 'react'\nimport { FileText, CheckCircle, Clock, AlertCircle, Building2, Users, Package, Truck, Briefcase, Download, Camera, HardHat, ChevronDown, ChevronRight, Calendar } from 'lucide-react'\nimport { db } from '../lib/supabase'\nimport { calculateCORTotals, formatCurrency, formatPercent, centsToDollars, formatDateRange } from '../lib/corCalculations'\nimport { exportCORToPDF, exportTMTicketToPDF } from '../lib/corPdfExport'\nimport SignatureCanvas from './ui/SignatureCanvas'\n\n// Helper to format date\nconst formatDate = (dateString) => {\n  if (!dateString) return ''\n  return new Date(dateString).toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric'\n  })\n}\n\n// Helper to format time (HH:MM or HH:MM:SS to 9:00am format)\nconst formatTime = (timeStr) => {\n  if (!timeStr) return ''\n  const [hours, minutes] = timeStr.split(':')\n  const h = parseInt(hours)\n  const ampm = h >= 12 ? 'pm' : 'am'\n  const h12 = h % 12 || 12\n  return `${h12}:${minutes}${ampm}`\n}\n\n// Status badge component\nconst StatusBadge = ({ status }) => {\n  const statusMap = {\n    draft: { label: 'Draft', color: '#6b7280', bg: '#f3f4f6' },\n    pending_approval: { label: 'Pending Approval', color: '#d97706', bg: '#fef3c7' },\n    approved: { label: 'Approved', color: '#059669', bg: '#d1fae5' },\n    rejected: { label: 'Rejected', color: '#dc2626', bg: '#fee2e2' },\n    billed: { label: 'Billed', color: '#2563eb', bg: '#dbeafe' },\n    closed: { label: 'Closed', color: '#4b5563', bg: '#e5e7eb' }\n  }\n  const info = statusMap[status] || statusMap.draft\n  return (\n    <span\n      className=\"cor-status-badge\"\n      style={{ color: info.color, backgroundColor: info.bg }}\n    >\n      {info.label}\n    </span>\n  )\n}\n\nexport default function SignaturePage({ signatureToken }) {\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState(null)\n  const [signatureRequest, setSignatureRequest] = useState(null)\n  const [document, setDocument] = useState(null)\n  const [showSignatureModal, setShowSignatureModal] = useState(false)\n  const [activeSlot, setActiveSlot] = useState(null)\n  const [submitting, setSubmitting] = useState(false)\n  const [successMessage, setSuccessMessage] = useState(null)\n  const [downloading, setDownloading] = useState(false)\n\n  // T&M backup documentation state\n  const [backupTickets, setBackupTickets] = useState([])\n  const [backupExpanded, setBackupExpanded] = useState(false)\n  const [expandedTickets, setExpandedTickets] = useState(new Set())\n\n  // Load signature request and document\n  useEffect(() => {\n    loadData()\n  }, [signatureToken])\n\n  const loadData = async () => {\n    try {\n      setLoading(true)\n      setError(null)\n\n      // Get signature request by token\n      const request = await db.getSignatureRequestByToken(signatureToken)\n      if (!request) {\n        setError('This signature link is invalid or has expired.')\n        return\n      }\n\n      if (request.status === 'completed') {\n        setError('This document has already been fully signed.')\n        return\n      }\n\n      if (request.status === 'revoked') {\n        setError('This signature link has been revoked.')\n        return\n      }\n\n      if (request.status === 'expired') {\n        setError('This signature link has expired.')\n        return\n      }\n\n      setSignatureRequest(request)\n\n      // Get the document data\n      const docData = await db.getDocumentForSigning(request.document_type, request.document_id)\n      if (!docData) {\n        setError('The document associated with this link could not be found.')\n        return\n      }\n\n      setDocument(docData)\n\n      // Load T&M backup tickets if this is a COR\n      if (request.document_type === 'cor' && docData?.id) {\n        try {\n          const tickets = await db.getCORTickets(docData.id)\n          // Resolve ticket photos to signed URLs in one batch (bucket is private)\n          if (tickets?.length) {\n            const photoGroups = tickets.map(t => t.photos || [])\n            const allPhotos = photoGroups.flat()\n            if (allPhotos.length) {\n              const signed = await db.resolvePhotoUrls(allPhotos)\n              let offset = 0\n              const resolved = tickets.map((t, i) => {\n                const len = photoGroups[i].length\n                const photos = signed.slice(offset, offset + len)\n                offset += len\n                return { ...t, photos }\n              })\n              setBackupTickets(resolved)\n            } else {\n              setBackupTickets(tickets)\n            }\n          } else {\n            setBackupTickets(tickets || [])\n          }\n        } catch (err) {\n          console.warn('Failed to load backup tickets:', err)\n        }\n      }\n    } catch (err) {\n      console.error('Error loading signature data:', err)\n      setError('Unable to load signature request. Please try again.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Calculate COR totals\n  const totals = useMemo(() => {\n    if (!document || signatureRequest?.document_type !== 'cor') return null\n    return calculateCORTotals(document)\n  }, [document, signatureRequest])\n\n  // Get available signature slots\n  const getSignatureStatus = () => {\n    if (!signatureRequest) return { slot1: null, slot2: null, availableSlots: [] }\n\n    const signatures = signatureRequest.signatures || []\n    const slot1 = signatures.find(s => s.signature_slot === 1)\n    const slot2 = signatures.find(s => s.signature_slot === 2)\n    const availableSlots = []\n    if (!slot1) availableSlots.push(1)\n    if (!slot2) availableSlots.push(2)\n\n    return { slot1, slot2, availableSlots }\n  }\n\n  // Get client IP address\n  const getClientIP = async () => {\n    try {\n      const response = await fetch('https://api.ipify.org?format=json')\n      const data = await response.json()\n      return data.ip\n    } catch {\n      return null\n    }\n  }\n\n  // Handle signature submission\n  const handleSignatureSubmit = async (signatureData) => {\n    if (!signatureRequest || !activeSlot) return\n\n    try {\n      setSubmitting(true)\n\n      // Get IP address\n      const ipAddress = await getClientIP()\n\n      // Add signature\n      const signature = await db.addSignature(signatureRequest.id, activeSlot, {\n        ...signatureData,\n        ipAddress,\n        userAgent: navigator.userAgent\n      })\n\n      // Sync signature to main document table\n      await db.syncSignatureToDocument(signature, signatureRequest)\n\n      // Reload data to get updated status\n      await loadData()\n\n      setShowSignatureModal(false)\n      setActiveSlot(null)\n      // Show persistent signed confirmation (don't auto-clear)\n      setSuccessMessage('signed')\n    } catch (err) {\n      console.error('Error submitting signature:', err)\n      setError('Failed to submit signature. Please try again.')\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  // Open signature modal for a specific slot\n  const openSignatureModal = (slot) => {\n    setActiveSlot(slot)\n    setShowSignatureModal(true)\n  }\n\n  // Handle PDF download with T&M backup\n  const handleDownload = async () => {\n    if (!document || !signatureRequest) return\n\n    try {\n      setDownloading(true)\n\n      // Fetch associated T&M tickets if this is a COR\n      let tmTickets = null\n      if (isCOR) {\n        try {\n          tmTickets = await db.getCORTickets(document.id)\n        } catch (err) {\n          console.warn('Failed to fetch T&M tickets for backup:', err)\n          // Continue without T&M backup\n        }\n      }\n\n      // Get branding from company\n      const branding = {\n        logoUrl: company?.logo_url,\n        primaryColor: company?.branding_color\n      }\n\n      // Export PDF with T&M backup\n      await exportCORToPDF(document, project, company, branding, tmTickets)\n\n      setSuccessMessage('PDF downloaded successfully!')\n      setTimeout(() => setSuccessMessage(null), 3000)\n    } catch (err) {\n      console.error('Download failed:', err)\n      setError('Failed to generate PDF. Please try again.')\n    } finally {\n      setDownloading(false)\n    }\n  }\n\n  // Handle T&M Ticket PDF download\n  const handleDownloadTMTicket = async () => {\n    if (!document || !signatureRequest) return\n\n    try {\n      setDownloading(true)\n\n      const company = document?.projects?.companies\n      const project = document?.projects\n\n      // Get branding from company\n      const branding = {\n        logoUrl: company?.logo_url,\n        primaryColor: company?.branding_color\n      }\n\n      // Export T&M Ticket PDF\n      await exportTMTicketToPDF(document, project, company, branding)\n\n      setSuccessMessage('PDF downloaded successfully!')\n      setTimeout(() => setSuccessMessage(null), 3000)\n    } catch (err) {\n      console.error('Download failed:', err)\n      setError('Failed to generate PDF. Please try again.')\n    } finally {\n      setDownloading(false)\n    }\n  }\n\n  // Render loading state\n  if (loading) {\n    return (\n      <div className=\"signature-page\">\n        <div className=\"signature-page-loading\">\n          <div className=\"loading-spinner\"></div>\n          <p>Loading document...</p>\n        </div>\n      </div>\n    )\n  }\n\n  // Render error state\n  if (error) {\n    return (\n      <div className=\"signature-page\">\n        <div className=\"signature-page-error\">\n          <AlertCircle size={48} />\n          <h2>Unable to Load Document</h2>\n          <p>{error}</p>\n        </div>\n      </div>\n    )\n  }\n\n  const { slot1, slot2, availableSlots } = getSignatureStatus()\n  // Only one signature is required - either slot1 OR slot2\n  const isFullySigned = slot1 || slot2\n  const isCOR = signatureRequest?.document_type === 'cor'\n  const company = document?.projects?.companies\n  const project = document?.projects\n\n  // Render T&M ticket (simpler view)\n  if (!isCOR) {\n    const workerCount = document.t_and_m_workers?.length || 0\n    const totalHours = document.t_and_m_workers?.reduce((sum, w) => sum + (w.hours || 0), 0) || 0\n\n    return (\n      <div className=\"signature-page\">\n        <header className=\"signature-page-header\">\n          {company?.logo_url ? (\n            <img src={company.logo_url} alt={company.name} className=\"company-logo\" />\n          ) : (\n            <div className=\"company-logo-placeholder\">\n              <Building2 size={24} />\n            </div>\n          )}\n          <div className=\"company-info\">\n            <h1>{company?.name || 'FieldSync'}</h1>\n            <span className=\"doc-type-label\">Time & Material Ticket</span>\n          </div>\n        </header>\n\n        {successMessage === 'signed' && (\n          <div className=\"signature-signed-overlay\">\n            <div className=\"signature-signed-content\">\n              <CheckCircle size={48} />\n              <h2>Document Signed Successfully</h2>\n              <p>This document has been signed and submitted.</p>\n              <button\n                className=\"btn btn-primary download-copy-btn\"\n                onClick={handleDownloadTMTicket}\n                disabled={downloading}\n              >\n                {downloading ? (\n                  <>\n                    <span className=\"btn-spinner\"></span>\n                    Generating PDF...\n                  </>\n                ) : (\n                  <>\n                    <Download size={18} />\n                    Save a Copy for Your Records\n                  </>\n                )}\n              </button>\n              <p className=\"close-prompt\">You may close this page when done.</p>\n            </div>\n          </div>\n        )}\n\n        <main className=\"signature-page-content\">\n          <div className=\"signature-document-card\">\n            <div className=\"document-card-header\">\n              <FileText size={20} />\n              <div className=\"document-card-title\">\n                <h2>Time & Material Ticket</h2>\n                <span className=\"document-subtitle\">\n                  {document.ce_pco_number ? `CE/PCO: ${document.ce_pco_number}` : 'Time & Materials'}\n                </span>\n              </div>\n            </div>\n\n            <div className=\"document-card-details\">\n              <div className=\"detail-row\">\n                <span className=\"detail-label\">Project</span>\n                <span className=\"detail-value\">{project?.name}</span>\n              </div>\n              <div className=\"detail-row\">\n                <span className=\"detail-label\">Work Date</span>\n                <span className=\"detail-value\">{formatDate(document.work_date)}</span>\n              </div>\n              <div className=\"detail-row\">\n                <span className=\"detail-label\">Workers</span>\n                <span className=\"detail-value\">{workerCount} ({totalHours} hrs)</span>\n              </div>\n              {document.notes && (\n                <div className=\"detail-row full-width\">\n                  <span className=\"detail-label\">Description</span>\n                  <span className=\"detail-value\">{document.notes}</span>\n                </div>\n              )}\n            </div>\n\n            {/* Full Ticket Details - Workers */}\n            {document.t_and_m_workers?.length > 0 && (\n              <div className=\"signature-detail-section\">\n                <h4><HardHat size={16} /> Workers</h4>\n                <table className=\"signature-detail-table\">\n                  <thead>\n                    <tr>\n                      <th>Name</th>\n                      <th>Role</th>\n                      <th>Time</th>\n                      <th>Reg Hrs</th>\n                      <th>OT</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {document.t_and_m_workers.map((w, idx) => (\n                      <tr key={idx}>\n                        <td>{w.name}</td>\n                        <td>{w.role || 'Laborer'}</td>\n                        <td>\n                          {w.time_started && w.time_ended\n                            ? `${formatTime(w.time_started)} - ${formatTime(w.time_ended)}`\n                            : '-'}\n                        </td>\n                        <td>{w.hours || 0}</td>\n                        <td>{w.overtime_hours || '-'}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            )}\n\n            {/* Full Ticket Details - Materials/Equipment */}\n            {document.t_and_m_items?.length > 0 && (\n              <div className=\"signature-detail-section\">\n                <h4><Package size={16} /> Materials & Equipment</h4>\n                <table className=\"signature-detail-table\">\n                  <thead>\n                    <tr>\n                      <th>Item</th>\n                      <th>Qty</th>\n                      <th>Unit</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {document.t_and_m_items.map((item, idx) => (\n                      <tr key={idx}>\n                        <td>{item.custom_name || item.materials_equipment?.name || 'Item'}</td>\n                        <td>{item.quantity}</td>\n                        <td>{item.materials_equipment?.unit || 'each'}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            )}\n\n            {/* Full Ticket Details - Photos */}\n            {document.photos?.length > 0 && (\n              <div className=\"signature-detail-section\">\n                <h4><Camera size={16} /> Photos ({document.photos.length})</h4>\n                <div className=\"signature-photo-grid\">\n                  {document.photos.map((photo, idx) => (\n                    <div key={idx} className=\"signature-photo-thumb\">\n                      <img\n                        src={typeof photo === 'string' ? photo : photo.url}\n                        alt={`Photo ${idx + 1}`}\n                        onError={(e) => { e.target.style.display = 'none' }}\n                      />\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Signature section */}\n          <div className=\"signature-status-section\">\n            <h3>Signature</h3>\n            {!isFullySigned ? (\n              <>\n                {renderSignatureSlot(1, slot1, 'GC Authorization', openSignatureModal, submitting)}\n                {!slot1 && <p className=\"or-divider\"> or </p>}\n                {renderSignatureSlot(2, slot2, 'Client Authorization', openSignatureModal, submitting)}\n              </>\n            ) : (\n              <>\n                {slot1 && renderSignatureSlot(1, slot1, 'GC Authorization', openSignatureModal, submitting)}\n                {slot2 && renderSignatureSlot(2, slot2, 'Client Authorization', openSignatureModal, submitting)}\n              </>\n            )}\n            {isFullySigned && (\n              <div className=\"fully-signed-message\">\n                <CheckCircle size={24} />\n                <p>This document has been signed.</p>\n              </div>\n            )}\n          </div>\n        </main>\n\n        <footer className=\"signature-page-footer\">\n          <p>Powered by FieldSync</p>\n        </footer>\n\n        {showSignatureModal && activeSlot && (\n          <SignatureCanvas\n            enhanced\n            requireAcknowledgment\n            lockBodyScroll\n            slot={activeSlot}\n            documentType=\"tm_ticket\"\n            documentTitle=\"Time & Material Ticket\"\n            onSave={handleSignatureSubmit}\n            onClose={() => {\n              setShowSignatureModal(false)\n              setActiveSlot(null)\n            }}\n          />\n        )}\n      </div>\n    )\n  }\n\n  // Render full COR document\n  return (\n    <div className=\"signature-page\">\n      {/* Header with company branding */}\n      <header className=\"signature-page-header\">\n        {company?.logo_url ? (\n          <img src={company.logo_url} alt={company.name} className=\"company-logo\" />\n        ) : (\n          <div className=\"company-logo-placeholder\">\n            <Building2 size={24} />\n          </div>\n        )}\n        <div className=\"company-info\">\n          <h1>{company?.name || 'FieldSync'}</h1>\n          <span className=\"doc-type-label\">Change Order Request</span>\n        </div>\n      </header>\n\n      {/* Success message - persistent signed confirmation */}\n      {successMessage === 'signed' && (\n        <div className=\"signature-signed-overlay\">\n          <div className=\"signature-signed-content\">\n            <CheckCircle size={48} />\n            <h2>Document Signed Successfully</h2>\n            <p>This document has been signed and submitted.</p>\n            <button\n              className=\"btn btn-primary download-copy-btn\"\n              onClick={handleDownload}\n              disabled={downloading}\n            >\n              {downloading ? (\n                <>\n                  <span className=\"btn-spinner\"></span>\n                  Generating PDF...\n                </>\n              ) : (\n                <>\n                  <Download size={18} />\n                  Save a Copy for Your Records\n                </>\n              )}\n            </button>\n            <p className=\"close-prompt\">You may close this page when done.</p>\n          </div>\n        </div>\n      )}\n\n      {/* Main COR Document */}\n      <main className=\"signature-page-content cor-full-document\">\n        {/* COR Header Card */}\n        <div className=\"cor-header-card\">\n          <div className=\"cor-header-top\">\n            <div className=\"cor-title-section\">\n              <h2 className=\"cor-number\">{document.cor_number}</h2>\n              <StatusBadge status={document.status} />\n            </div>\n            <div className=\"cor-date\">\n              Created {formatDate(document.created_at)}\n            </div>\n          </div>\n\n          <h3 className=\"cor-title\">{document.title || 'Untitled Change Order'}</h3>\n\n          <div className=\"cor-info-grid\">\n            <div className=\"cor-info-item\">\n              <span className=\"cor-info-label\">Project</span>\n              <span className=\"cor-info-value\">{project?.name}</span>\n            </div>\n            {project?.job_number && (\n              <div className=\"cor-info-item\">\n                <span className=\"cor-info-label\">Job #</span>\n                <span className=\"cor-info-value\">{project.job_number}</span>\n              </div>\n            )}\n            <div className=\"cor-info-item\">\n              <span className=\"cor-info-label\">Period</span>\n              <span className=\"cor-info-value\">{formatDateRange(document.period_start, document.period_end)}</span>\n            </div>\n          </div>\n\n          {document.scope_of_work && (\n            <div className=\"cor-scope\">\n              <h4>Scope of Work</h4>\n              <p>{document.scope_of_work}</p>\n            </div>\n          )}\n        </div>\n\n        {/* Labor Section */}\n        {document.change_order_labor?.length > 0 && (\n          <div className=\"cor-section\">\n            <div className=\"cor-section-header\">\n              <Users size={18} />\n              <h4>Labor</h4>\n            </div>\n            <div className=\"cor-table-wrapper\">\n              <table className=\"cor-line-items-table\">\n                <thead>\n                  <tr>\n                    <th>Class</th>\n                    <th>Type</th>\n                    <th className=\"text-right\">Reg Hrs</th>\n                    <th className=\"text-right\">Reg Rate</th>\n                    <th className=\"text-right\">OT Hrs</th>\n                    <th className=\"text-right\">OT Rate</th>\n                    <th className=\"text-right\">Total</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {document.change_order_labor.map((item, idx) => (\n                    <tr key={idx}>\n                      <td>{item.labor_class}</td>\n                      <td>{item.wage_type}</td>\n                      <td className=\"text-right\">{item.regular_hours}</td>\n                      <td className=\"text-right\">${centsToDollars(item.regular_rate)}/hr</td>\n                      <td className=\"text-right\">{item.overtime_hours || '-'}</td>\n                      <td className=\"text-right\">{item.overtime_hours ? `$${centsToDollars(item.overtime_rate)}/hr` : '-'}</td>\n                      <td className=\"text-right\">{formatCurrency(item.total)}</td>\n                    </tr>\n                  ))}\n                </tbody>\n                <tfoot>\n                  <tr>\n                    <td colSpan=\"5\" className=\"text-right\">Subtotal:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.labor_subtotal)}</td>\n                  </tr>\n                  <tr className=\"markup-row\">\n                    <td colSpan=\"5\" className=\"text-right\">+ {formatPercent(document.labor_markup_percent || 1500)} Markup:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.labor_markup_amount)}</td>\n                  </tr>\n                  <tr className=\"section-total-row\">\n                    <td colSpan=\"5\" className=\"text-right\"><strong>Labor Total:</strong></td>\n                    <td className=\"text-right\" colSpan=\"2\"><strong>{formatCurrency(totals.labor_subtotal + totals.labor_markup_amount)}</strong></td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n        )}\n\n        {/* Materials Section */}\n        {document.change_order_materials?.length > 0 && (\n          <div className=\"cor-section\">\n            <div className=\"cor-section-header\">\n              <Package size={18} />\n              <h4>Materials</h4>\n            </div>\n            <div className=\"cor-table-wrapper\">\n              <table className=\"cor-line-items-table\">\n                <thead>\n                  <tr>\n                    <th>Description</th>\n                    <th>Source</th>\n                    <th className=\"text-right\">Qty</th>\n                    <th>Unit</th>\n                    <th className=\"text-right\">Unit Cost</th>\n                    <th className=\"text-right\">Total</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {document.change_order_materials.map((item, idx) => (\n                    <tr key={idx}>\n                      <td>{item.description}</td>\n                      <td>{item.source_reference || item.source_type}</td>\n                      <td className=\"text-right\">{item.quantity}</td>\n                      <td>{item.unit}</td>\n                      <td className=\"text-right\">${centsToDollars(item.unit_cost)}</td>\n                      <td className=\"text-right\">{formatCurrency(item.total)}</td>\n                    </tr>\n                  ))}\n                </tbody>\n                <tfoot>\n                  <tr>\n                    <td colSpan=\"4\" className=\"text-right\">Subtotal:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.materials_subtotal)}</td>\n                  </tr>\n                  <tr className=\"markup-row\">\n                    <td colSpan=\"4\" className=\"text-right\">+ {formatPercent(document.materials_markup_percent || 1500)} Markup:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.materials_markup_amount)}</td>\n                  </tr>\n                  <tr className=\"section-total-row\">\n                    <td colSpan=\"4\" className=\"text-right\"><strong>Materials Total:</strong></td>\n                    <td className=\"text-right\" colSpan=\"2\"><strong>{formatCurrency(totals.materials_subtotal + totals.materials_markup_amount)}</strong></td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n        )}\n\n        {/* Equipment Section */}\n        {document.change_order_equipment?.length > 0 && (\n          <div className=\"cor-section\">\n            <div className=\"cor-section-header\">\n              <Truck size={18} />\n              <h4>Equipment</h4>\n            </div>\n            <div className=\"cor-table-wrapper\">\n              <table className=\"cor-line-items-table\">\n                <thead>\n                  <tr>\n                    <th>Description</th>\n                    <th>Source</th>\n                    <th className=\"text-right\">Qty</th>\n                    <th>Unit</th>\n                    <th className=\"text-right\">Unit Cost</th>\n                    <th className=\"text-right\">Total</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {document.change_order_equipment.map((item, idx) => (\n                    <tr key={idx}>\n                      <td>{item.description}</td>\n                      <td>{item.source_reference || item.source_type}</td>\n                      <td className=\"text-right\">{item.quantity}</td>\n                      <td>{item.unit}</td>\n                      <td className=\"text-right\">${centsToDollars(item.unit_cost)}</td>\n                      <td className=\"text-right\">{formatCurrency(item.total)}</td>\n                    </tr>\n                  ))}\n                </tbody>\n                <tfoot>\n                  <tr>\n                    <td colSpan=\"4\" className=\"text-right\">Subtotal:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.equipment_subtotal)}</td>\n                  </tr>\n                  <tr className=\"markup-row\">\n                    <td colSpan=\"4\" className=\"text-right\">+ {formatPercent(document.equipment_markup_percent || 1500)} Markup:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.equipment_markup_amount)}</td>\n                  </tr>\n                  <tr className=\"section-total-row\">\n                    <td colSpan=\"4\" className=\"text-right\"><strong>Equipment Total:</strong></td>\n                    <td className=\"text-right\" colSpan=\"2\"><strong>{formatCurrency(totals.equipment_subtotal + totals.equipment_markup_amount)}</strong></td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n        )}\n\n        {/* Subcontractors Section */}\n        {document.change_order_subcontractors?.length > 0 && (\n          <div className=\"cor-section\">\n            <div className=\"cor-section-header\">\n              <Briefcase size={18} />\n              <h4>Subcontractors</h4>\n            </div>\n            <div className=\"cor-table-wrapper\">\n              <table className=\"cor-line-items-table\">\n                <thead>\n                  <tr>\n                    <th>Company</th>\n                    <th>Description</th>\n                    <th>Source</th>\n                    <th className=\"text-right\">Amount</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {document.change_order_subcontractors.map((item, idx) => (\n                    <tr key={idx}>\n                      <td>{item.company_name}</td>\n                      <td>{item.description}</td>\n                      <td>{item.source_reference || item.source_type}</td>\n                      <td className=\"text-right\">{formatCurrency(item.total)}</td>\n                    </tr>\n                  ))}\n                </tbody>\n                <tfoot>\n                  <tr>\n                    <td colSpan=\"2\" className=\"text-right\">Subtotal:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.subcontractors_subtotal)}</td>\n                  </tr>\n                  <tr className=\"markup-row\">\n                    <td colSpan=\"2\" className=\"text-right\">+ {formatPercent(document.subcontractors_markup_percent || 500)} Markup:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.subcontractors_markup_amount)}</td>\n                  </tr>\n                  <tr className=\"section-total-row\">\n                    <td colSpan=\"2\" className=\"text-right\"><strong>Subcontractors Total:</strong></td>\n                    <td className=\"text-right\" colSpan=\"2\"><strong>{formatCurrency(totals.subcontractors_subtotal + totals.subcontractors_markup_amount)}</strong></td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n        )}\n\n        {/* T&M Backup Documentation Section - Professional Layout */}\n        {backupTickets.length > 0 && (() => {\n          // Calculate summary statistics\n          const totalLaborHours = backupTickets.reduce((sum, t) =>\n            sum + (t.t_and_m_workers?.reduce((wSum, w) => wSum + (parseFloat(w.hours) || 0), 0) || 0), 0\n          )\n          const totalOTHours = backupTickets.reduce((sum, t) =>\n            sum + (t.t_and_m_workers?.reduce((wSum, w) => wSum + (parseFloat(w.overtime_hours) || 0), 0) || 0), 0\n          )\n          const totalPhotos = backupTickets.reduce((sum, t) => sum + (t.photos?.length || 0), 0)\n          const verifiedCount = backupTickets.filter(t => t.client_signature_data).length\n\n          return (\n            <div className=\"cor-section cor-backup-section\">\n              {/* Professional Official Header */}\n              <div className=\"backup-official-header\">\n                <div className=\"backup-official-badge\">\n                  <FileText size={16} />\n                  <span>Supporting Documentation</span>\n                </div>\n                <div className=\"backup-summary-bar\">\n                  <div className=\"backup-stat\">\n                    <span className=\"backup-stat-value\">{backupTickets.length}</span>\n                    <span className=\"backup-stat-label\">Tickets</span>\n                  </div>\n                  <div className=\"backup-stat\">\n                    <span className=\"backup-stat-value\">{totalLaborHours.toFixed(1)}</span>\n                    <span className=\"backup-stat-label\">Labor Hrs</span>\n                  </div>\n                  {totalOTHours > 0 && (\n                    <div className=\"backup-stat\">\n                      <span className=\"backup-stat-value\">{totalOTHours.toFixed(1)}</span>\n                      <span className=\"backup-stat-label\">OT Hrs</span>\n                    </div>\n                  )}\n                  <div className=\"backup-stat\">\n                    <span className=\"backup-stat-value\">{totalPhotos}</span>\n                    <span className=\"backup-stat-label\">Photos</span>\n                  </div>\n                  {verifiedCount > 0 && (\n                    <div className=\"backup-stat verified\">\n                      <span className=\"backup-stat-value\">{verifiedCount}</span>\n                      <span className=\"backup-stat-label\">Verified</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {/* Collapsible Toggle */}\n              <div\n                className=\"cor-section-header cor-backup-header\"\n                onClick={() => setBackupExpanded(!backupExpanded)}\n                style={{ cursor: 'pointer', marginBottom: backupExpanded ? '1rem' : 0 }}\n              >\n                <div className=\"backup-header-left\">\n                  <span>View All T&M Tickets</span>\n                </div>\n                <div className=\"backup-header-toggle\">\n                  {backupExpanded ? <ChevronDown size={20} /> : <ChevronRight size={20} />}\n                </div>\n              </div>\n\n              {backupExpanded && (\n                <div className=\"backup-tickets-list\" style={{ padding: '0 0.5rem' }}>\n                  {backupTickets.map((ticket) => {\n                    const isExpanded = expandedTickets.has(ticket.id)\n                    const ticketTotalHours = ticket.t_and_m_workers?.reduce((sum, w) =>\n                      sum + (parseFloat(w.hours) || 0), 0\n                    ) || 0\n                    const ticketOTHours = ticket.t_and_m_workers?.reduce((sum, w) =>\n                      sum + (parseFloat(w.overtime_hours) || 0), 0\n                    ) || 0\n                    const hasVerification = !!ticket.client_signature_data\n\n                    return (\n                      <div\n                        key={ticket.id}\n                        className=\"backup-ticket-pro\"\n                        data-verified={hasVerification}\n                        data-status={ticket.status || 'pending'}\n                      >\n                        {/* Professional Ticket Header */}\n                        <div\n                          className=\"ticket-pro-header\"\n                          onClick={() => {\n                            const next = new Set(expandedTickets)\n                            if (isExpanded) {\n                              next.delete(ticket.id)\n                            } else {\n                              next.add(ticket.id)\n                            }\n                            setExpandedTickets(next)\n                          }}\n                          style={{ cursor: 'pointer' }}\n                        >\n                          <div className=\"ticket-date-badge\">\n                            <Calendar size={14} />\n                            <span>{formatDate(ticket.work_date)}</span>\n                          </div>\n                          {ticket.ce_pco_number && (\n                            <span className=\"ticket-pco-badge\">{ticket.ce_pco_number}</span>\n                          )}\n                          {hasVerification && (\n                            <span className=\"ticket-verified-seal\">\n                              <CheckCircle size={12} /> Verified\n                            </span>\n                          )}\n                          <div style={{ marginLeft: 'auto', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                            <span style={{ fontSize: '0.85rem', color: 'var(--text-muted)' }}>\n                              {ticket.t_and_m_workers?.length || 0} workers  {ticketTotalHours + ticketOTHours} hrs\n                            </span>\n                            {isExpanded ? <ChevronDown size={16} /> : <ChevronRight size={16} />}\n                          </div>\n                        </div>\n\n                        {/* Ticket Body - Expanded Content */}\n                        {isExpanded && (\n                          <div className=\"ticket-pro-body\">\n                            {/* Description */}\n                            {ticket.notes && (\n                              <div className=\"ticket-description-box\">\n                                <p>{ticket.notes}</p>\n                              </div>\n                            )}\n\n                            {/* Workers Section */}\n                            {ticket.t_and_m_workers?.length > 0 && (\n                              <div className=\"ticket-section-pro\">\n                                <div className=\"ticket-section-header\">\n                                  <HardHat size={14} />\n                                  <span>Labor</span>\n                                  <span className=\"section-count\">{ticketTotalHours + ticketOTHours} hrs total</span>\n                                </div>\n                                <div className=\"worker-pro-grid\">\n                                  {ticket.t_and_m_workers.map((worker, wIdx) => (\n                                    <div key={wIdx} className=\"worker-pro-row\">\n                                      <div>\n                                        <span className=\"worker-name\">{worker.name}</span>\n                                        {worker.role && <span className=\"worker-role\">  {worker.role}</span>}\n                                      </div>\n                                      <span className=\"worker-time\">\n                                        {worker.time_started && worker.time_ended\n                                          ? `${formatTime(worker.time_started)} - ${formatTime(worker.time_ended)}`\n                                          : '-'}\n                                      </span>\n                                      <span className=\"worker-hours\">{worker.hours || 0} hrs</span>\n                                      <span className=\"worker-ot\">\n                                        {parseFloat(worker.overtime_hours) > 0 ? `+${worker.overtime_hours} OT` : '-'}\n                                      </span>\n                                    </div>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* Materials Section */}\n                            {ticket.t_and_m_items?.length > 0 && (\n                              <div className=\"ticket-section-pro\">\n                                <div className=\"ticket-section-header\">\n                                  <Package size={14} />\n                                  <span>Materials / Equipment</span>\n                                  <span className=\"section-count\">{ticket.t_and_m_items.length} items</span>\n                                </div>\n                                <div className=\"materials-pro-list\">\n                                  {ticket.t_and_m_items.map((item, iIdx) => (\n                                    <div key={iIdx} className=\"material-pro-row\">\n                                      <span className=\"material-name\">\n                                        {item.materials_equipment?.name || item.description || 'Item'}\n                                      </span>\n                                      <span className=\"material-qty\">\n                                        {item.quantity || 1} {item.materials_equipment?.unit || 'ea'}\n                                      </span>\n                                      <span className=\"material-source\">Time & Material</span>\n                                    </div>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* Photos Section */}\n                            {ticket.photos?.length > 0 && (\n                              <div className=\"ticket-section-pro\">\n                                <div className=\"ticket-section-header\">\n                                  <Camera size={14} />\n                                  <span>Photo Evidence</span>\n                                  <span className=\"section-count\">{ticket.photos.length}</span>\n                                </div>\n                                <div className=\"photo-evidence-grid\">\n                                  {ticket.photos.map((photo, pIdx) => (\n                                    <a\n                                      key={pIdx}\n                                      href={photo}\n                                      target=\"_blank\"\n                                      rel=\"noopener noreferrer\"\n                                      className=\"photo-evidence-item\"\n                                    >\n                                      <img\n                                        src={photo}\n                                        alt={`Evidence ${pIdx + 1}`}\n                                        onError={(e) => {\n                                          e.target.onerror = null\n                                          e.target.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiI+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=='\n                                        }}\n                                      />\n                                    </a>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* Client Verification Footer */}\n                            {hasVerification && (\n                              <div className=\"ticket-verification-footer\">\n                                <div className=\"verification-seal-icon\">\n                                  <CheckCircle size={22} />\n                                </div>\n                                {ticket.client_signature_data && (\n                                  <img\n                                    src={ticket.client_signature_data}\n                                    alt=\"Client Signature\"\n                                    className=\"verification-signature-img\"\n                                  />\n                                )}\n                                <div className=\"verification-info\">\n                                  <span className=\"signer-name\">{ticket.client_signature_name || 'Client'}</span>\n                                  {(ticket.client_signature_title || ticket.client_signature_company) && (\n                                    <span className=\"signer-title\">\n                                      {[ticket.client_signature_title, ticket.client_signature_company].filter(Boolean).join(', ')}\n                                    </span>\n                                  )}\n                                  {ticket.client_signature_date && (\n                                    <span className=\"verify-date\">Verified {formatDate(ticket.client_signature_date)}</span>\n                                  )}\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    )\n                  })}\n                </div>\n              )}\n\n              <div className=\"backup-note\">\n                <AlertCircle size={14} />\n                <span>This documentation supports the work described in this Change Order Request.</span>\n              </div>\n            </div>\n          )\n        })()}\n\n        {/* Totals Section */}\n        <div className=\"cor-totals-card\">\n          <h4>COR Summary</h4>\n\n          <div className=\"cor-totals-grid\">\n            <div className=\"cor-total-row\">\n              <span>COR Subtotal</span>\n              <span>{formatCurrency(totals.cor_subtotal)}</span>\n            </div>\n\n            <div className=\"cor-fees-section\">\n              <div className=\"cor-fee-row\">\n                <span>Liability Insurance ({formatPercent(document.liability_insurance_percent || 144)})</span>\n                <span>{formatCurrency(totals.liability_insurance_amount)}</span>\n              </div>\n              <div className=\"cor-fee-row\">\n                <span>Bond ({formatPercent(document.bond_percent || 100)})</span>\n                <span>{formatCurrency(totals.bond_amount)}</span>\n              </div>\n              <div className=\"cor-fee-row\">\n                <span>City License Fee ({formatPercent(document.license_fee_percent || 10)})</span>\n                <span>{formatCurrency(totals.license_fee_amount)}</span>\n              </div>\n            </div>\n\n            <div className=\"cor-grand-total\">\n              <span>COR TOTAL</span>\n              <span>{formatCurrency(totals.cor_total)}</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Signature Section */}\n        <div className=\"cor-signature-section\">\n          <h4>Authorization</h4>\n          <p className=\"signature-instruction\">\n            By signing below, you authorize the above change order request and agree to the terms and costs outlined.\n          </p>\n\n          <div className=\"signature-slots-grid\">\n            {/* Show signature options if not signed yet */}\n            {!isFullySigned ? (\n              <>\n                {/* GC Signature */}\n                <div className={`signature-slot-card ${slot1 ? 'signed' : 'unsigned'}`}>\n                  <div className=\"slot-header\">\n                    {slot1 ? (\n                      <CheckCircle size={20} className=\"status-icon signed\" />\n                    ) : (\n                      <Clock size={20} className=\"status-icon pending\" />\n                    )}\n                    <span className=\"slot-label\">GC Authorization</span>\n                  </div>\n                  <button\n                    className=\"btn btn-primary sign-btn\"\n                    onClick={() => openSignatureModal(1)}\n                    disabled={submitting}\n                  >\n                    Sign as GC\n                  </button>\n                </div>\n\n                <p className=\"or-divider\"> or </p>\n\n                {/* Client Signature */}\n                <div className={`signature-slot-card ${slot2 ? 'signed' : 'unsigned'}`}>\n                  <div className=\"slot-header\">\n                    {slot2 ? (\n                      <CheckCircle size={20} className=\"status-icon signed\" />\n                    ) : (\n                      <Clock size={20} className=\"status-icon pending\" />\n                    )}\n                    <span className=\"slot-label\">Client Authorization</span>\n                  </div>\n                  <button\n                    className=\"btn btn-primary sign-btn\"\n                    onClick={() => openSignatureModal(2)}\n                    disabled={submitting}\n                  >\n                    Sign as Client\n                  </button>\n                </div>\n              </>\n            ) : (\n              <>\n                {/* Show the collected signature */}\n                {slot1 && (\n                  <div className=\"signature-slot-card signed\">\n                    <div className=\"slot-header\">\n                      <CheckCircle size={20} className=\"status-icon signed\" />\n                      <span className=\"slot-label\">GC Authorization</span>\n                    </div>\n                    <div className=\"slot-signed-info\">\n                      {slot1.signature_data && (\n                        <img src={slot1.signature_data} alt=\"Signature\" className=\"signature-image\" />\n                      )}\n                      <div className=\"signer-details\">\n                        <span className=\"signer-name\">{slot1.signer_name}</span>\n                        {(slot1.signer_title || slot1.signer_company) && (\n                          <span className=\"signer-org\">\n                            {slot1.signer_title}{slot1.signer_title && slot1.signer_company && '  '}{slot1.signer_company}\n                          </span>\n                        )}\n                      </div>\n                      <span className=\"signed-date\">Signed {formatDate(slot1.signed_at)}</span>\n                    </div>\n                  </div>\n                )}\n                {slot2 && (\n                  <div className=\"signature-slot-card signed\">\n                    <div className=\"slot-header\">\n                      <CheckCircle size={20} className=\"status-icon signed\" />\n                      <span className=\"slot-label\">Client Authorization</span>\n                    </div>\n                    <div className=\"slot-signed-info\">\n                      {slot2.signature_data && (\n                        <img src={slot2.signature_data} alt=\"Signature\" className=\"signature-image\" />\n                      )}\n                      <div className=\"signer-details\">\n                        <span className=\"signer-name\">{slot2.signer_name}</span>\n                        {(slot2.signer_title || slot2.signer_company) && (\n                          <span className=\"signer-org\">\n                            {slot2.signer_title}{slot2.signer_title && slot2.signer_company && '  '}{slot2.signer_company}\n                          </span>\n                        )}\n                      </div>\n                      <span className=\"signed-date\">Signed {formatDate(slot2.signed_at)}</span>\n                    </div>\n                  </div>\n                )}\n              </>\n            )}\n          </div>\n\n          {/* Fully signed message */}\n          {isFullySigned && (\n            <div className=\"fully-signed-message\">\n              <CheckCircle size={24} />\n              <p>This change order request has been signed.</p>\n            </div>\n          )}\n\n          {/* Download section - always available so clients can save a copy */}\n          <div className=\"cor-download-section\">\n            <h4>Download Your Copy</h4>\n            <p className=\"download-description\">\n              {isFullySigned\n                ? 'Download a PDF copy of this fully signed COR including all T&M backup documentation.'\n                : 'Download a PDF copy of this COR for your records. Signature status will be included.'}\n            </p>\n            <button\n              className=\"btn btn-primary download-btn\"\n              onClick={handleDownload}\n              disabled={downloading}\n            >\n              {downloading ? (\n                <>\n                  <span className=\"download-spinner\"></span>\n                  Generating PDF...\n                </>\n              ) : (\n                <>\n                  <Download size={18} />\n                  Download COR + Backup\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </main>\n\n      {/* Footer */}\n      <footer className=\"signature-page-footer\">\n        <p>Powered by FieldSync</p>\n      </footer>\n\n      {/* Signature modal */}\n      {showSignatureModal && activeSlot && (\n        <SignatureCanvas\n          enhanced\n          requireAcknowledgment\n          lockBodyScroll\n          slot={activeSlot}\n          documentType={signatureRequest.document_type}\n          documentTitle={`${document.cor_number} - ${document.title}`}\n          onSave={handleSignatureSubmit}\n          onClose={() => {\n            setShowSignatureModal(false)\n            setActiveSlot(null)\n          }}\n        />\n      )}\n    </div>\n  )\n}\n\n// Helper function to render a signature slot (for T&M tickets)\nfunction renderSignatureSlot(slot, signatureData, label, openModal, submitting) {\n  return (\n    <div className={`signature-slot-card ${signatureData ? 'signed' : 'unsigned'}`}>\n      <div className=\"slot-header\">\n        {signatureData ? (\n          <CheckCircle size={20} className=\"status-icon signed\" />\n        ) : (\n          <Clock size={20} className=\"status-icon pending\" />\n        )}\n        <span className=\"slot-label\">Signature {slot}  {label}</span>\n      </div>\n\n      {signatureData ? (\n        <div className=\"slot-signed-info\">\n          <div className=\"signer-details\">\n            <span className=\"signer-name\">{signatureData.signer_name}</span>\n            {(signatureData.signer_title || signatureData.signer_company) && (\n              <span className=\"signer-org\">\n                {signatureData.signer_title}{signatureData.signer_title && signatureData.signer_company && '  '}{signatureData.signer_company}\n              </span>\n            )}\n          </div>\n          <span className=\"signed-date\">Signed {formatDate(signatureData.signed_at)}</span>\n        </div>\n      ) : (\n        <button\n          className=\"btn btn-primary sign-btn\"\n          onClick={() => openModal(slot)}\n          disabled={submitting}\n        >\n          Sign as {slot === 1 ? 'GC' : 'Client'}\n        </button>\n      )}\n    </div>\n  )\n}\n"],"file":"SignaturePage-Cd6ZnJig.js"}