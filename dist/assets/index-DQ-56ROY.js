import{r as Ff,a as $f,b as Nx}from"./react-DXGY7bZi.js";import{c as Sx}from"./supabase-VuevzHjS.js";import{u as tn,w as Cx,r as wx}from"./xlsx-BTp1RmNK.js";import{E as Ui,a as sn}from"./pdf-C0G31WKZ.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))c(m);new MutationObserver(m=>{for(const u of m)if(u.type==="childList")for(const j of u.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&c(j)}).observe(document,{childList:!0,subtree:!0});function o(m){const u={};return m.integrity&&(u.integrity=m.integrity),m.referrerPolicy&&(u.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?u.credentials="include":m.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(m){if(m.ep)return;m.ep=!0;const u=o(m);fetch(m.href,u)}})();var Io={exports:{}},dl={};var rf;function kx(){if(rf)return dl;rf=1;var r=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function o(c,m,u){var j=null;if(u!==void 0&&(j=""+u),m.key!==void 0&&(j=""+m.key),"key"in m){u={};for(var p in m)p!=="key"&&(u[p]=m[p])}else u=m;return m=u.ref,{$$typeof:r,type:c,key:j,ref:m!==void 0?m:null,props:u}}return dl.Fragment=l,dl.jsx=o,dl.jsxs=o,dl}var lf;function Ex(){return lf||(lf=1,Io.exports=kx()),Io.exports}var e=Ex(),f=Ff();const Dx=$f(f);var Zo={exports:{}},ul={},Jo={exports:{}},Ko={};var cf;function Mx(){return cf||(cf=1,(function(r){function l(D,V){var k=D.length;D.push(V);e:for(;0<k;){var fe=k-1>>>1,Y=D[fe];if(0<m(Y,V))D[fe]=V,D[k]=Y,k=fe;else break e}}function o(D){return D.length===0?null:D[0]}function c(D){if(D.length===0)return null;var V=D[0],k=D.pop();if(k!==V){D[0]=k;e:for(var fe=0,Y=D.length,I=Y>>>1;fe<I;){var X=2*(fe+1)-1,C=D[X],de=X+1,_e=D[de];if(0>m(C,k))de<Y&&0>m(_e,C)?(D[fe]=_e,D[de]=k,fe=de):(D[fe]=C,D[X]=k,fe=X);else if(de<Y&&0>m(_e,k))D[fe]=_e,D[de]=k,fe=de;else break e}}return V}function m(D,V){var k=D.sortIndex-V.sortIndex;return k!==0?k:D.id-V.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;r.unstable_now=function(){return u.now()}}else{var j=Date,p=j.now();r.unstable_now=function(){return j.now()-p}}var x=[],y=[],g=1,T=null,B=3,U=!1,F=!1,L=!1,J=!1,W=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function A(D){for(var V=o(y);V!==null;){if(V.callback===null)c(y);else if(V.startTime<=D)c(y),V.sortIndex=V.expirationTime,l(x,V);else break;V=o(y)}}function ee(D){if(L=!1,A(D),!F)if(o(x)!==null)F=!0,ne||(ne=!0,v());else{var V=o(y);V!==null&&ae(ee,V.startTime-D)}}var ne=!1,Q=-1,z=5,H=-1;function $(){return J?!0:!(r.unstable_now()-H<z)}function S(){if(J=!1,ne){var D=r.unstable_now();H=D;var V=!0;try{e:{F=!1,L&&(L=!1,N(Q),Q=-1),U=!0;var k=B;try{t:{for(A(D),T=o(x);T!==null&&!(T.expirationTime>D&&$());){var fe=T.callback;if(typeof fe=="function"){T.callback=null,B=T.priorityLevel;var Y=fe(T.expirationTime<=D);if(D=r.unstable_now(),typeof Y=="function"){T.callback=Y,A(D),V=!0;break t}T===o(x)&&c(x),A(D)}else c(x);T=o(x)}if(T!==null)V=!0;else{var I=o(y);I!==null&&ae(ee,I.startTime-D),V=!1}}break e}finally{T=null,B=k,U=!1}V=void 0}}finally{V?v():ne=!1}}}var v;if(typeof M=="function")v=function(){M(S)};else if(typeof MessageChannel<"u"){var _=new MessageChannel,w=_.port2;_.port1.onmessage=S,v=function(){w.postMessage(null)}}else v=function(){W(S,0)};function ae(D,V){Q=W(function(){D(r.unstable_now())},V)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(D){D.callback=null},r.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<D?Math.floor(1e3/D):5},r.unstable_getCurrentPriorityLevel=function(){return B},r.unstable_next=function(D){switch(B){case 1:case 2:case 3:var V=3;break;default:V=B}var k=B;B=V;try{return D()}finally{B=k}},r.unstable_requestPaint=function(){J=!0},r.unstable_runWithPriority=function(D,V){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var k=B;B=D;try{return V()}finally{B=k}},r.unstable_scheduleCallback=function(D,V,k){var fe=r.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?fe+k:fe):k=fe,D){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=k+Y,D={id:g++,callback:V,priorityLevel:D,startTime:k,expirationTime:Y,sortIndex:-1},k>fe?(D.sortIndex=k,l(y,D),o(x)===null&&D===o(y)&&(L?(N(Q),Q=-1):L=!0,ae(ee,k-fe))):(D.sortIndex=Y,l(x,D),F||U||(F=!0,ne||(ne=!0,v()))),D},r.unstable_shouldYield=$,r.unstable_wrapCallback=function(D){var V=B;return function(){var k=B;B=V;try{return D.apply(this,arguments)}finally{B=k}}}})(Ko)),Ko}var of;function Ax(){return of||(of=1,Jo.exports=Mx()),Jo.exports}var df;function Tx(){if(df)return ul;df=1;var r=Ax(),l=Ff(),o=Nx();function c(t){var a="https://react.dev/errors/"+t;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)a+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function m(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function u(t){var a=t,s=t;if(t.alternate)for(;a.return;)a=a.return;else{t=a;do a=t,(a.flags&4098)!==0&&(s=a.return),t=a.return;while(t)}return a.tag===3?s:null}function j(t){if(t.tag===13){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function p(t){if(t.tag===31){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function x(t){if(u(t)!==t)throw Error(c(188))}function y(t){var a=t.alternate;if(!a){if(a=u(t),a===null)throw Error(c(188));return a!==t?null:t}for(var s=t,n=a;;){var i=s.return;if(i===null)break;var d=i.alternate;if(d===null){if(n=i.return,n!==null){s=n;continue}break}if(i.child===d.child){for(d=i.child;d;){if(d===s)return x(i),t;if(d===n)return x(i),a;d=d.sibling}throw Error(c(188))}if(s.return!==n.return)s=i,n=d;else{for(var h=!1,b=i.child;b;){if(b===s){h=!0,s=i,n=d;break}if(b===n){h=!0,n=i,s=d;break}b=b.sibling}if(!h){for(b=d.child;b;){if(b===s){h=!0,s=d,n=i;break}if(b===n){h=!0,n=d,s=i;break}b=b.sibling}if(!h)throw Error(c(189))}}if(s.alternate!==n)throw Error(c(190))}if(s.tag!==3)throw Error(c(188));return s.stateNode.current===s?t:a}function g(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t;for(t=t.child;t!==null;){if(a=g(t),a!==null)return a;t=t.sibling}return null}var T=Object.assign,B=Symbol.for("react.element"),U=Symbol.for("react.transitional.element"),F=Symbol.for("react.portal"),L=Symbol.for("react.fragment"),J=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),N=Symbol.for("react.consumer"),M=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),ee=Symbol.for("react.suspense"),ne=Symbol.for("react.suspense_list"),Q=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),H=Symbol.for("react.activity"),$=Symbol.for("react.memo_cache_sentinel"),S=Symbol.iterator;function v(t){return t===null||typeof t!="object"?null:(t=S&&t[S]||t["@@iterator"],typeof t=="function"?t:null)}var _=Symbol.for("react.client.reference");function w(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===_?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case L:return"Fragment";case W:return"Profiler";case J:return"StrictMode";case ee:return"Suspense";case ne:return"SuspenseList";case H:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case F:return"Portal";case M:return t.displayName||"Context";case N:return(t._context.displayName||"Context")+".Consumer";case A:var a=t.render;return t=t.displayName,t||(t=a.displayName||a.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Q:return a=t.displayName||null,a!==null?a:w(t.type)||"Memo";case z:a=t._payload,t=t._init;try{return w(t(a))}catch{}}return null}var ae=Array.isArray,D=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k={pending:!1,data:null,method:null,action:null},fe=[],Y=-1;function I(t){return{current:t}}function X(t){0>Y||(t.current=fe[Y],fe[Y]=null,Y--)}function C(t,a){Y++,fe[Y]=t.current,t.current=a}var de=I(null),_e=I(null),ze=I(null),re=I(null);function qe(t,a){switch(C(ze,a),C(_e,t),C(de,null),a.nodeType){case 9:case 11:t=(t=a.documentElement)&&(t=t.namespaceURI)?Eh(t):0;break;default:if(t=a.tagName,a=a.namespaceURI)a=Eh(a),t=Dh(a,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}X(de),C(de,t)}function Ve(){X(de),X(_e),X(ze)}function Oe(t){t.memoizedState!==null&&C(re,t);var a=de.current,s=Dh(a,t.type);a!==s&&(C(_e,t),C(de,s))}function nt(t){_e.current===t&&(X(de),X(_e)),re.current===t&&(X(re),ll._currentValue=k)}var zt,tt;function ot(t){if(zt===void 0)try{throw Error()}catch(s){var a=s.stack.trim().match(/\n( *(at )?)/);zt=a&&a[1]||"",tt=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+zt+t+tt}var St=!1;function rt(t,a){if(!t||St)return"";St=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(a){var je=function(){throw Error()};if(Object.defineProperty(je.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(je,[])}catch(me){var oe=me}Reflect.construct(t,[],je)}else{try{je.call()}catch(me){oe=me}t.call(je.prototype)}}else{try{throw Error()}catch(me){oe=me}(je=t())&&typeof je.catch=="function"&&je.catch(function(){})}}catch(me){if(me&&oe&&typeof me.stack=="string")return[me.stack,oe.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=n.DetermineComponentFrameRoot(),h=d[0],b=d[1];if(h&&b){var O=h.split(`
`),ce=b.split(`
`);for(i=n=0;n<O.length&&!O[n].includes("DetermineComponentFrameRoot");)n++;for(;i<ce.length&&!ce[i].includes("DetermineComponentFrameRoot");)i++;if(n===O.length||i===ce.length)for(n=O.length-1,i=ce.length-1;1<=n&&0<=i&&O[n]!==ce[i];)i--;for(;1<=n&&0<=i;n--,i--)if(O[n]!==ce[i]){if(n!==1||i!==1)do if(n--,i--,0>i||O[n]!==ce[i]){var pe=`
`+O[n].replace(" at new "," at ");return t.displayName&&pe.includes("<anonymous>")&&(pe=pe.replace("<anonymous>",t.displayName)),pe}while(1<=n&&0<=i);break}}}finally{St=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?ot(s):""}function at(t,a){switch(t.tag){case 26:case 27:case 5:return ot(t.type);case 16:return ot("Lazy");case 13:return t.child!==a&&a!==null?ot("Suspense Fallback"):ot("Suspense");case 19:return ot("SuspenseList");case 0:case 15:return rt(t.type,!1);case 11:return rt(t.type.render,!1);case 1:return rt(t.type,!0);case 31:return ot("Activity");default:return""}}function ma(t){try{var a="",s=null;do a+=at(t,s),s=t,t=t.return;while(t);return a}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var Ne=Object.prototype.hasOwnProperty,Ie=r.unstable_scheduleCallback,Ge=r.unstable_cancelCallback,ge=r.unstable_shouldYield,Le=r.unstable_requestPaint,Je=r.unstable_now,ve=r.unstable_getCurrentPriorityLevel,ct=r.unstable_ImmediatePriority,pt=r.unstable_UserBlockingPriority,ia=r.unstable_NormalPriority,Ft=r.unstable_LowPriority,Zt=r.unstable_IdlePriority,Z=r.log,q=r.unstable_setDisableYieldValue,Me=null,Se=null;function ke(t){if(typeof Z=="function"&&q(t),Se&&typeof Se.setStrictMode=="function")try{Se.setStrictMode(Me,t)}catch{}}var De=Math.clz32?Math.clz32:he,K=Math.log,ye=Math.LN2;function he(t){return t>>>=0,t===0?32:31-(K(t)/ye|0)|0}var Ke=256,jt=262144,Yt=4194304;function Ct(t){var a=t&42;if(a!==0)return a;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function ta(t,a,s){var n=t.pendingLanes;if(n===0)return 0;var i=0,d=t.suspendedLanes,h=t.pingedLanes;t=t.warmLanes;var b=n&134217727;return b!==0?(n=b&~d,n!==0?i=Ct(n):(h&=b,h!==0?i=Ct(h):s||(s=b&~t,s!==0&&(i=Ct(s))))):(b=n&~d,b!==0?i=Ct(b):h!==0?i=Ct(h):s||(s=n&~t,s!==0&&(i=Ct(s)))),i===0?0:a!==0&&a!==i&&(a&d)===0&&(d=i&-i,s=a&-a,d>=s||d===32&&(s&4194048)!==0)?a:i}function aa(t,a){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&a)===0}function Pt(t,a){switch(t){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function we(){var t=Yt;return Yt<<=1,(Yt&62914560)===0&&(Yt=4194304),t}function bt(t){for(var a=[],s=0;31>s;s++)a.push(t);return a}function dt(t,a){t.pendingLanes|=a,a!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function ja(t,a,s,n,i,d){var h=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var b=t.entanglements,O=t.expirationTimes,ce=t.hiddenUpdates;for(s=h&~s;0<s;){var pe=31-De(s),je=1<<pe;b[pe]=0,O[pe]=-1;var oe=ce[pe];if(oe!==null)for(ce[pe]=null,pe=0;pe<oe.length;pe++){var me=oe[pe];me!==null&&(me.lane&=-536870913)}s&=~je}n!==0&&Ce(t,n,0),d!==0&&i===0&&t.tag!==0&&(t.suspendedLanes|=d&~(h&~a))}function Ce(t,a,s){t.pendingLanes|=a,t.suspendedLanes&=~a;var n=31-De(a);t.entangledLanes|=a,t.entanglements[n]=t.entanglements[n]|1073741824|s&261930}function Ue(t,a){var s=t.entangledLanes|=a;for(t=t.entanglements;s;){var n=31-De(s),i=1<<n;i&a|t[n]&a&&(t[n]|=a),s&=~i}}function He(t,a){var s=a&-a;return s=(s&42)!==0?1:Xe(s),(s&(t.suspendedLanes|a))!==0?0:s}function Xe(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function E(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function ie(){var t=V.p;return t!==0?t:(t=window.event,t===void 0?32:Kh(t.type))}function ue(t,a){var s=V.p;try{return V.p=t,a()}finally{V.p=s}}var be=Math.random().toString(36).slice(2),Ae="__reactFiber$"+be,Te="__reactProps$"+be,Ye="__reactContainer$"+be,$t="__reactEvents$"+be,Ot="__reactListeners$"+be,Re="__reactHandles$"+be,We="__reactResources$"+be,Vt="__reactMarker$"+be;function Jt(t){delete t[Ae],delete t[Te],delete t[$t],delete t[Ot],delete t[Re]}function $e(t){var a=t[Ae];if(a)return a;for(var s=t.parentNode;s;){if(a=s[Ye]||s[Ae]){if(s=a.alternate,a.child!==null||s!==null&&s.child!==null)for(t=Oh(t);t!==null;){if(s=t[Ae])return s;t=Oh(t)}return a}t=s,s=t.parentNode}return null}function st(t){if(t=t[Ae]||t[Ye]){var a=t.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return t}return null}function _t(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t.stateNode;throw Error(c(33))}function Dt(t){var a=t[We];return a||(a=t[We]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function wt(t){t[Vt]=!0}var va=new Set,La={};function Lt(t,a){ya(t,a),ya(t+"Capture",a)}function ya(t,a){for(La[t]=a,t=0;t<a.length;t++)va.add(a[t])}var Bi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),yr={},br={};function _r(t){return Ne.call(br,t)?!0:Ne.call(yr,t)?!1:Bi.test(t)?br[t]=!0:(yr[t]=!0,!1)}function ln(t,a,s){if(_r(a))if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(a);return;case"boolean":var n=a.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){t.removeAttribute(a);return}}t.setAttribute(a,""+s)}}function zn(t,a,s){if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(a);return}t.setAttribute(a,""+s)}}function oa(t,a,s,n){if(n===null)t.removeAttribute(s);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(a,s,""+n)}}function Qt(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function jl(t){var a=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function vl(t,a,s){var n=Object.getOwnPropertyDescriptor(t.constructor.prototype,a);if(!t.hasOwnProperty(a)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,d=n.set;return Object.defineProperty(t,a,{configurable:!0,get:function(){return i.call(this)},set:function(h){s=""+h,d.call(this,h)}}),Object.defineProperty(t,a,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(h){s=""+h},stopTracking:function(){t._valueTracker=null,delete t[a]}}}}function Fi(t){if(!t._valueTracker){var a=jl(t)?"checked":"value";t._valueTracker=vl(t,a,""+t[a])}}function bd(t){if(!t)return!1;var a=t._valueTracker;if(!a)return!0;var s=a.getValue(),n="";return t&&(n=jl(t)?t.checked?"true":"false":t.value),t=n,t!==s?(a.setValue(t),!0):!1}function yl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var xp=/[\n"\\]/g;function Ha(t){return t.replace(xp,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function $i(t,a,s,n,i,d,h,b){t.name="",h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"?t.type=h:t.removeAttribute("type"),a!=null?h==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+Qt(a)):t.value!==""+Qt(a)&&(t.value=""+Qt(a)):h!=="submit"&&h!=="reset"||t.removeAttribute("value"),a!=null?Vi(t,h,Qt(a)):s!=null?Vi(t,h,Qt(s)):n!=null&&t.removeAttribute("value"),i==null&&d!=null&&(t.defaultChecked=!!d),i!=null&&(t.checked=i&&typeof i!="function"&&typeof i!="symbol"),b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?t.name=""+Qt(b):t.removeAttribute("name")}function _d(t,a,s,n,i,d,h,b){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(t.type=d),a!=null||s!=null){if(!(d!=="submit"&&d!=="reset"||a!=null)){Fi(t);return}s=s!=null?""+Qt(s):"",a=a!=null?""+Qt(a):s,b||a===t.value||(t.value=a),t.defaultValue=a}n=n??i,n=typeof n!="function"&&typeof n!="symbol"&&!!n,t.checked=b?t.checked:!!n,t.defaultChecked=!!n,h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(t.name=h),Fi(t)}function Vi(t,a,s){a==="number"&&yl(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function On(t,a,s,n){if(t=t.options,a){a={};for(var i=0;i<s.length;i++)a["$"+s[i]]=!0;for(s=0;s<t.length;s++)i=a.hasOwnProperty("$"+t[s].value),t[s].selected!==i&&(t[s].selected=i),i&&n&&(t[s].defaultSelected=!0)}else{for(s=""+Qt(s),a=null,i=0;i<t.length;i++){if(t[i].value===s){t[i].selected=!0,n&&(t[i].defaultSelected=!0);return}a!==null||t[i].disabled||(a=t[i])}a!==null&&(a.selected=!0)}}function Nd(t,a,s){if(a!=null&&(a=""+Qt(a),a!==t.value&&(t.value=a),s==null)){t.defaultValue!==a&&(t.defaultValue=a);return}t.defaultValue=s!=null?""+Qt(s):""}function Sd(t,a,s,n){if(a==null){if(n!=null){if(s!=null)throw Error(c(92));if(ae(n)){if(1<n.length)throw Error(c(93));n=n[0]}s=n}s==null&&(s=""),a=s}s=Qt(a),t.defaultValue=s,n=t.textContent,n===s&&n!==""&&n!==null&&(t.value=n),Fi(t)}function Un(t,a){if(a){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=a;return}}t.textContent=a}var jp=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Cd(t,a,s){var n=a.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?n?t.setProperty(a,""):a==="float"?t.cssFloat="":t[a]="":n?t.setProperty(a,s):typeof s!="number"||s===0||jp.has(a)?a==="float"?t.cssFloat=s:t[a]=(""+s).trim():t[a]=s+"px"}function wd(t,a,s){if(a!=null&&typeof a!="object")throw Error(c(62));if(t=t.style,s!=null){for(var n in s)!s.hasOwnProperty(n)||a!=null&&a.hasOwnProperty(n)||(n.indexOf("--")===0?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="");for(var i in a)n=a[i],a.hasOwnProperty(i)&&s[i]!==n&&Cd(t,i,n)}else for(var d in a)a.hasOwnProperty(d)&&Cd(t,d,a[d])}function Gi(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),yp=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function bl(t){return yp.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function is(){}var Yi=null;function Pi(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ln=null,Hn=null;function kd(t){var a=st(t);if(a&&(t=a.stateNode)){var s=t[Te]||null;e:switch(t=a.stateNode,a.type){case"input":if($i(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),a=s.name,s.type==="radio"&&a!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+Ha(""+a)+'"][type="radio"]'),a=0;a<s.length;a++){var n=s[a];if(n!==t&&n.form===t.form){var i=n[Te]||null;if(!i)throw Error(c(90));$i(n,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(a=0;a<s.length;a++)n=s[a],n.form===t.form&&bd(n)}break e;case"textarea":Nd(t,s.value,s.defaultValue);break e;case"select":a=s.value,a!=null&&On(t,!!s.multiple,a,!1)}}}var Qi=!1;function Ed(t,a,s){if(Qi)return t(a,s);Qi=!0;try{var n=t(a);return n}finally{if(Qi=!1,(Ln!==null||Hn!==null)&&(ci(),Ln&&(a=Ln,t=Hn,Hn=Ln=null,kd(a),t)))for(a=0;a<t.length;a++)kd(t[a])}}function Nr(t,a){var s=t.stateNode;if(s===null)return null;var n=s[Te]||null;if(n===null)return null;s=n[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(c(231,a,typeof s));return s}var cs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xi=!1;if(cs)try{var Sr={};Object.defineProperty(Sr,"passive",{get:function(){Xi=!0}}),window.addEventListener("test",Sr,Sr),window.removeEventListener("test",Sr,Sr)}catch{Xi=!1}var As=null,Ii=null,_l=null;function Dd(){if(_l)return _l;var t,a=Ii,s=a.length,n,i="value"in As?As.value:As.textContent,d=i.length;for(t=0;t<s&&a[t]===i[t];t++);var h=s-t;for(n=1;n<=h&&a[s-n]===i[d-n];n++);return _l=i.slice(t,1<n?1-n:void 0)}function Nl(t){var a=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&a===13&&(t=13)):t=a,t===10&&(t=13),32<=t||t===13?t:0}function Sl(){return!0}function Md(){return!1}function Na(t){function a(s,n,i,d,h){this._reactName=s,this._targetInst=i,this.type=n,this.nativeEvent=d,this.target=h,this.currentTarget=null;for(var b in t)t.hasOwnProperty(b)&&(s=t[b],this[b]=s?s(d):d[b]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?Sl:Md,this.isPropagationStopped=Md,this}return T(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Sl)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Sl)},persist:function(){},isPersistent:Sl}),a}var cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cl=Na(cn),Cr=T({},cn,{view:0,detail:0}),bp=Na(Cr),Zi,Ji,wr,wl=T({},Cr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wi,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==wr&&(wr&&t.type==="mousemove"?(Zi=t.screenX-wr.screenX,Ji=t.screenY-wr.screenY):Ji=Zi=0,wr=t),Zi)},movementY:function(t){return"movementY"in t?t.movementY:Ji}}),Ad=Na(wl),_p=T({},wl,{dataTransfer:0}),Np=Na(_p),Sp=T({},Cr,{relatedTarget:0}),Ki=Na(Sp),Cp=T({},cn,{animationName:0,elapsedTime:0,pseudoElement:0}),wp=Na(Cp),kp=T({},cn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Ep=Na(kp),Dp=T({},cn,{data:0}),Td=Na(Dp),Mp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ap={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rp(t){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(t):(t=Tp[t])?!!a[t]:!1}function Wi(){return Rp}var qp=T({},Cr,{key:function(t){if(t.key){var a=Mp[t.key]||t.key;if(a!=="Unidentified")return a}return t.type==="keypress"?(t=Nl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Ap[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wi,charCode:function(t){return t.type==="keypress"?Nl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Nl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),zp=Na(qp),Op=T({},wl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rd=Na(Op),Up=T({},Cr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wi}),Lp=Na(Up),Hp=T({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Bp=Na(Hp),Fp=T({},wl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),$p=Na(Fp),Vp=T({},cn,{newState:0,oldState:0}),Gp=Na(Vp),Yp=[9,13,27,32],ec=cs&&"CompositionEvent"in window,kr=null;cs&&"documentMode"in document&&(kr=document.documentMode);var Pp=cs&&"TextEvent"in window&&!kr,qd=cs&&(!ec||kr&&8<kr&&11>=kr),zd=" ",Od=!1;function Ud(t,a){switch(t){case"keyup":return Yp.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ld(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Bn=!1;function Qp(t,a){switch(t){case"compositionend":return Ld(a);case"keypress":return a.which!==32?null:(Od=!0,zd);case"textInput":return t=a.data,t===zd&&Od?null:t;default:return null}}function Xp(t,a){if(Bn)return t==="compositionend"||!ec&&Ud(t,a)?(t=Dd(),_l=Ii=As=null,Bn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return qd&&a.locale!=="ko"?null:a.data;default:return null}}var Ip={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hd(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a==="input"?!!Ip[t.type]:a==="textarea"}function Bd(t,a,s,n){Ln?Hn?Hn.push(n):Hn=[n]:Ln=n,a=pi(a,"onChange"),0<a.length&&(s=new Cl("onChange","change",null,s,n),t.push({event:s,listeners:a}))}var Er=null,Dr=null;function Zp(t){_h(t,0)}function kl(t){var a=_t(t);if(bd(a))return t}function Fd(t,a){if(t==="change")return a}var $d=!1;if(cs){var tc;if(cs){var ac="oninput"in document;if(!ac){var Vd=document.createElement("div");Vd.setAttribute("oninput","return;"),ac=typeof Vd.oninput=="function"}tc=ac}else tc=!1;$d=tc&&(!document.documentMode||9<document.documentMode)}function Gd(){Er&&(Er.detachEvent("onpropertychange",Yd),Dr=Er=null)}function Yd(t){if(t.propertyName==="value"&&kl(Dr)){var a=[];Bd(a,Dr,t,Pi(t)),Ed(Zp,a)}}function Jp(t,a,s){t==="focusin"?(Gd(),Er=a,Dr=s,Er.attachEvent("onpropertychange",Yd)):t==="focusout"&&Gd()}function Kp(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return kl(Dr)}function Wp(t,a){if(t==="click")return kl(a)}function eg(t,a){if(t==="input"||t==="change")return kl(a)}function tg(t,a){return t===a&&(t!==0||1/t===1/a)||t!==t&&a!==a}var Da=typeof Object.is=="function"?Object.is:tg;function Mr(t,a){if(Da(t,a))return!0;if(typeof t!="object"||t===null||typeof a!="object"||a===null)return!1;var s=Object.keys(t),n=Object.keys(a);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var i=s[n];if(!Ne.call(a,i)||!Da(t[i],a[i]))return!1}return!0}function Pd(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Qd(t,a){var s=Pd(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=a&&n>=a)return{node:s,offset:a-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Pd(s)}}function Xd(t,a){return t&&a?t===a?!0:t&&t.nodeType===3?!1:a&&a.nodeType===3?Xd(t,a.parentNode):"contains"in t?t.contains(a):t.compareDocumentPosition?!!(t.compareDocumentPosition(a)&16):!1:!1}function Id(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var a=yl(t.document);a instanceof t.HTMLIFrameElement;){try{var s=typeof a.contentWindow.location.href=="string"}catch{s=!1}if(s)t=a.contentWindow;else break;a=yl(t.document)}return a}function sc(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a&&(a==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||a==="textarea"||t.contentEditable==="true")}var ag=cs&&"documentMode"in document&&11>=document.documentMode,Fn=null,nc=null,Ar=null,rc=!1;function Zd(t,a,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;rc||Fn==null||Fn!==yl(n)||(n=Fn,"selectionStart"in n&&sc(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Ar&&Mr(Ar,n)||(Ar=n,n=pi(nc,"onSelect"),0<n.length&&(a=new Cl("onSelect","select",null,a,s),t.push({event:a,listeners:n}),a.target=Fn)))}function on(t,a){var s={};return s[t.toLowerCase()]=a.toLowerCase(),s["Webkit"+t]="webkit"+a,s["Moz"+t]="moz"+a,s}var $n={animationend:on("Animation","AnimationEnd"),animationiteration:on("Animation","AnimationIteration"),animationstart:on("Animation","AnimationStart"),transitionrun:on("Transition","TransitionRun"),transitionstart:on("Transition","TransitionStart"),transitioncancel:on("Transition","TransitionCancel"),transitionend:on("Transition","TransitionEnd")},lc={},Jd={};cs&&(Jd=document.createElement("div").style,"AnimationEvent"in window||(delete $n.animationend.animation,delete $n.animationiteration.animation,delete $n.animationstart.animation),"TransitionEvent"in window||delete $n.transitionend.transition);function dn(t){if(lc[t])return lc[t];if(!$n[t])return t;var a=$n[t],s;for(s in a)if(a.hasOwnProperty(s)&&s in Jd)return lc[t]=a[s];return t}var Kd=dn("animationend"),Wd=dn("animationiteration"),eu=dn("animationstart"),sg=dn("transitionrun"),ng=dn("transitionstart"),rg=dn("transitioncancel"),tu=dn("transitionend"),au=new Map,ic="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ic.push("scrollEnd");function Ia(t,a){au.set(t,a),Lt(a,[t])}var El=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},Ba=[],Vn=0,cc=0;function Dl(){for(var t=Vn,a=cc=Vn=0;a<t;){var s=Ba[a];Ba[a++]=null;var n=Ba[a];Ba[a++]=null;var i=Ba[a];Ba[a++]=null;var d=Ba[a];if(Ba[a++]=null,n!==null&&i!==null){var h=n.pending;h===null?i.next=i:(i.next=h.next,h.next=i),n.pending=i}d!==0&&su(s,i,d)}}function Ml(t,a,s,n){Ba[Vn++]=t,Ba[Vn++]=a,Ba[Vn++]=s,Ba[Vn++]=n,cc|=n,t.lanes|=n,t=t.alternate,t!==null&&(t.lanes|=n)}function oc(t,a,s,n){return Ml(t,a,s,n),Al(t)}function un(t,a){return Ml(t,null,null,a),Al(t)}function su(t,a,s){t.lanes|=s;var n=t.alternate;n!==null&&(n.lanes|=s);for(var i=!1,d=t.return;d!==null;)d.childLanes|=s,n=d.alternate,n!==null&&(n.childLanes|=s),d.tag===22&&(t=d.stateNode,t===null||t._visibility&1||(i=!0)),t=d,d=d.return;return t.tag===3?(d=t.stateNode,i&&a!==null&&(i=31-De(s),t=d.hiddenUpdates,n=t[i],n===null?t[i]=[a]:n.push(a),a.lane=s|536870912),d):null}function Al(t){if(50<Wr)throw Wr=0,vo=null,Error(c(185));for(var a=t.return;a!==null;)t=a,a=t.return;return t.tag===3?t.stateNode:null}var Gn={};function lg(t,a,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ma(t,a,s,n){return new lg(t,a,s,n)}function dc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function os(t,a){var s=t.alternate;return s===null?(s=Ma(t.tag,a,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=a,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,a=t.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function nu(t,a){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=a,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,a=s.dependencies,t.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),t}function Tl(t,a,s,n,i,d){var h=0;if(n=t,typeof t=="function")dc(t)&&(h=1);else if(typeof t=="string")h=ux(t,s,de.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case H:return t=Ma(31,s,a,i),t.elementType=H,t.lanes=d,t;case L:return mn(s.children,i,d,a);case J:h=8,i|=24;break;case W:return t=Ma(12,s,a,i|2),t.elementType=W,t.lanes=d,t;case ee:return t=Ma(13,s,a,i),t.elementType=ee,t.lanes=d,t;case ne:return t=Ma(19,s,a,i),t.elementType=ne,t.lanes=d,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case M:h=10;break e;case N:h=9;break e;case A:h=11;break e;case Q:h=14;break e;case z:h=16,n=null;break e}h=29,s=Error(c(130,t===null?"null":typeof t,"")),n=null}return a=Ma(h,s,a,i),a.elementType=t,a.type=n,a.lanes=d,a}function mn(t,a,s,n){return t=Ma(7,t,n,a),t.lanes=s,t}function uc(t,a,s){return t=Ma(6,t,null,a),t.lanes=s,t}function ru(t){var a=Ma(18,null,null,0);return a.stateNode=t,a}function mc(t,a,s){return a=Ma(4,t.children!==null?t.children:[],t.key,a),a.lanes=s,a.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},a}var lu=new WeakMap;function Fa(t,a){if(typeof t=="object"&&t!==null){var s=lu.get(t);return s!==void 0?s:(a={value:t,source:a,stack:ma(a)},lu.set(t,a),a)}return{value:t,source:a,stack:ma(a)}}var Yn=[],Pn=0,Rl=null,Tr=0,$a=[],Va=0,Ts=null,es=1,ts="";function ds(t,a){Yn[Pn++]=Tr,Yn[Pn++]=Rl,Rl=t,Tr=a}function iu(t,a,s){$a[Va++]=es,$a[Va++]=ts,$a[Va++]=Ts,Ts=t;var n=es;t=ts;var i=32-De(n)-1;n&=~(1<<i),s+=1;var d=32-De(a)+i;if(30<d){var h=i-i%5;d=(n&(1<<h)-1).toString(32),n>>=h,i-=h,es=1<<32-De(a)+i|s<<i|n,ts=d+t}else es=1<<d|s<<i|n,ts=t}function hc(t){t.return!==null&&(ds(t,1),iu(t,1,0))}function fc(t){for(;t===Rl;)Rl=Yn[--Pn],Yn[Pn]=null,Tr=Yn[--Pn],Yn[Pn]=null;for(;t===Ts;)Ts=$a[--Va],$a[Va]=null,ts=$a[--Va],$a[Va]=null,es=$a[--Va],$a[Va]=null}function cu(t,a){$a[Va++]=es,$a[Va++]=ts,$a[Va++]=Ts,es=a.id,ts=a.overflow,Ts=t}var ha=null,Ht=null,gt=!1,Rs=null,Ga=!1,pc=Error(c(519));function qs(t){var a=Error(c(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Rr(Fa(a,t)),pc}function ou(t){var a=t.stateNode,s=t.type,n=t.memoizedProps;switch(a[Ae]=t,a[Te]=n,s){case"dialog":mt("cancel",a),mt("close",a);break;case"iframe":case"object":case"embed":mt("load",a);break;case"video":case"audio":for(s=0;s<tl.length;s++)mt(tl[s],a);break;case"source":mt("error",a);break;case"img":case"image":case"link":mt("error",a),mt("load",a);break;case"details":mt("toggle",a);break;case"input":mt("invalid",a),_d(a,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":mt("invalid",a);break;case"textarea":mt("invalid",a),Sd(a,n.value,n.defaultValue,n.children)}s=n.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||a.textContent===""+s||n.suppressHydrationWarning===!0||wh(a.textContent,s)?(n.popover!=null&&(mt("beforetoggle",a),mt("toggle",a)),n.onScroll!=null&&mt("scroll",a),n.onScrollEnd!=null&&mt("scrollend",a),n.onClick!=null&&(a.onclick=is),a=!0):a=!1,a||qs(t,!0)}function du(t){for(ha=t.return;ha;)switch(ha.tag){case 5:case 31:case 13:Ga=!1;return;case 27:case 3:Ga=!0;return;default:ha=ha.return}}function Qn(t){if(t!==ha)return!1;if(!gt)return du(t),gt=!0,!1;var a=t.tag,s;if((s=a!==3&&a!==27)&&((s=a===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||qo(t.type,t.memoizedProps)),s=!s),s&&Ht&&qs(t),du(t),a===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(317));Ht=zh(t)}else if(a===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(317));Ht=zh(t)}else a===27?(a=Ht,Xs(t.type)?(t=Ho,Ho=null,Ht=t):Ht=a):Ht=ha?Pa(t.stateNode.nextSibling):null;return!0}function hn(){Ht=ha=null,gt=!1}function gc(){var t=Rs;return t!==null&&(ka===null?ka=t:ka.push.apply(ka,t),Rs=null),t}function Rr(t){Rs===null?Rs=[t]:Rs.push(t)}var xc=I(null),fn=null,us=null;function zs(t,a,s){C(xc,a._currentValue),a._currentValue=s}function ms(t){t._currentValue=xc.current,X(xc)}function jc(t,a,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&a)!==a?(t.childLanes|=a,n!==null&&(n.childLanes|=a)):n!==null&&(n.childLanes&a)!==a&&(n.childLanes|=a),t===s)break;t=t.return}}function vc(t,a,s,n){var i=t.child;for(i!==null&&(i.return=t);i!==null;){var d=i.dependencies;if(d!==null){var h=i.child;d=d.firstContext;e:for(;d!==null;){var b=d;d=i;for(var O=0;O<a.length;O++)if(b.context===a[O]){d.lanes|=s,b=d.alternate,b!==null&&(b.lanes|=s),jc(d.return,s,t),n||(h=null);break e}d=b.next}}else if(i.tag===18){if(h=i.return,h===null)throw Error(c(341));h.lanes|=s,d=h.alternate,d!==null&&(d.lanes|=s),jc(h,s,t),h=null}else h=i.child;if(h!==null)h.return=i;else for(h=i;h!==null;){if(h===t){h=null;break}if(i=h.sibling,i!==null){i.return=h.return,h=i;break}h=h.return}i=h}}function Xn(t,a,s,n){t=null;for(var i=a,d=!1;i!==null;){if(!d){if((i.flags&524288)!==0)d=!0;else if((i.flags&262144)!==0)break}if(i.tag===10){var h=i.alternate;if(h===null)throw Error(c(387));if(h=h.memoizedProps,h!==null){var b=i.type;Da(i.pendingProps.value,h.value)||(t!==null?t.push(b):t=[b])}}else if(i===re.current){if(h=i.alternate,h===null)throw Error(c(387));h.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(t!==null?t.push(ll):t=[ll])}i=i.return}t!==null&&vc(a,t,s,n),a.flags|=262144}function ql(t){for(t=t.firstContext;t!==null;){if(!Da(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function pn(t){fn=t,us=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function fa(t){return uu(fn,t)}function zl(t,a){return fn===null&&pn(t),uu(t,a)}function uu(t,a){var s=a._currentValue;if(a={context:a,memoizedValue:s,next:null},us===null){if(t===null)throw Error(c(308));us=a,t.dependencies={lanes:0,firstContext:a},t.flags|=524288}else us=us.next=a;return s}var ig=typeof AbortController<"u"?AbortController:function(){var t=[],a=this.signal={aborted:!1,addEventListener:function(s,n){t.push(n)}};this.abort=function(){a.aborted=!0,t.forEach(function(s){return s()})}},cg=r.unstable_scheduleCallback,og=r.unstable_NormalPriority,sa={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function yc(){return{controller:new ig,data:new Map,refCount:0}}function qr(t){t.refCount--,t.refCount===0&&cg(og,function(){t.controller.abort()})}var zr=null,bc=0,In=0,Zn=null;function dg(t,a){if(zr===null){var s=zr=[];bc=0,In=Co(),Zn={status:"pending",value:void 0,then:function(n){s.push(n)}}}return bc++,a.then(mu,mu),a}function mu(){if(--bc===0&&zr!==null){Zn!==null&&(Zn.status="fulfilled");var t=zr;zr=null,In=0,Zn=null;for(var a=0;a<t.length;a++)(0,t[a])()}}function ug(t,a){var s=[],n={status:"pending",value:null,reason:null,then:function(i){s.push(i)}};return t.then(function(){n.status="fulfilled",n.value=a;for(var i=0;i<s.length;i++)(0,s[i])(a)},function(i){for(n.status="rejected",n.reason=i,i=0;i<s.length;i++)(0,s[i])(void 0)}),n}var hu=D.S;D.S=function(t,a){Zm=Je(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&dg(t,a),hu!==null&&hu(t,a)};var gn=I(null);function _c(){var t=gn.current;return t!==null?t:qt.pooledCache}function Ol(t,a){a===null?C(gn,gn.current):C(gn,a.pool)}function fu(){var t=_c();return t===null?null:{parent:sa._currentValue,pool:t}}var Jn=Error(c(460)),Nc=Error(c(474)),Ul=Error(c(542)),Ll={then:function(){}};function pu(t){return t=t.status,t==="fulfilled"||t==="rejected"}function gu(t,a,s){switch(s=t[s],s===void 0?t.push(a):s!==a&&(a.then(is,is),a=s),a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,ju(t),t;default:if(typeof a.status=="string")a.then(is,is);else{if(t=qt,t!==null&&100<t.shellSuspendCounter)throw Error(c(482));t=a,t.status="pending",t.then(function(n){if(a.status==="pending"){var i=a;i.status="fulfilled",i.value=n}},function(n){if(a.status==="pending"){var i=a;i.status="rejected",i.reason=n}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,ju(t),t}throw jn=a,Jn}}function xn(t){try{var a=t._init;return a(t._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(jn=s,Jn):s}}var jn=null;function xu(){if(jn===null)throw Error(c(459));var t=jn;return jn=null,t}function ju(t){if(t===Jn||t===Ul)throw Error(c(483))}var Kn=null,Or=0;function Hl(t){var a=Or;return Or+=1,Kn===null&&(Kn=[]),gu(Kn,t,a)}function Ur(t,a){a=a.props.ref,t.ref=a!==void 0?a:null}function Bl(t,a){throw a.$$typeof===B?Error(c(525)):(t=Object.prototype.toString.call(a),Error(c(31,t==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":t)))}function vu(t){function a(te,P){if(t){var le=te.deletions;le===null?(te.deletions=[P],te.flags|=16):le.push(P)}}function s(te,P){if(!t)return null;for(;P!==null;)a(te,P),P=P.sibling;return null}function n(te){for(var P=new Map;te!==null;)te.key!==null?P.set(te.key,te):P.set(te.index,te),te=te.sibling;return P}function i(te,P){return te=os(te,P),te.index=0,te.sibling=null,te}function d(te,P,le){return te.index=le,t?(le=te.alternate,le!==null?(le=le.index,le<P?(te.flags|=67108866,P):le):(te.flags|=67108866,P)):(te.flags|=1048576,P)}function h(te){return t&&te.alternate===null&&(te.flags|=67108866),te}function b(te,P,le,xe){return P===null||P.tag!==6?(P=uc(le,te.mode,xe),P.return=te,P):(P=i(P,le),P.return=te,P)}function O(te,P,le,xe){var Ze=le.type;return Ze===L?pe(te,P,le.props.children,xe,le.key):P!==null&&(P.elementType===Ze||typeof Ze=="object"&&Ze!==null&&Ze.$$typeof===z&&xn(Ze)===P.type)?(P=i(P,le.props),Ur(P,le),P.return=te,P):(P=Tl(le.type,le.key,le.props,null,te.mode,xe),Ur(P,le),P.return=te,P)}function ce(te,P,le,xe){return P===null||P.tag!==4||P.stateNode.containerInfo!==le.containerInfo||P.stateNode.implementation!==le.implementation?(P=mc(le,te.mode,xe),P.return=te,P):(P=i(P,le.children||[]),P.return=te,P)}function pe(te,P,le,xe,Ze){return P===null||P.tag!==7?(P=mn(le,te.mode,xe,Ze),P.return=te,P):(P=i(P,le),P.return=te,P)}function je(te,P,le){if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return P=uc(""+P,te.mode,le),P.return=te,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case U:return le=Tl(P.type,P.key,P.props,null,te.mode,le),Ur(le,P),le.return=te,le;case F:return P=mc(P,te.mode,le),P.return=te,P;case z:return P=xn(P),je(te,P,le)}if(ae(P)||v(P))return P=mn(P,te.mode,le,null),P.return=te,P;if(typeof P.then=="function")return je(te,Hl(P),le);if(P.$$typeof===M)return je(te,zl(te,P),le);Bl(te,P)}return null}function oe(te,P,le,xe){var Ze=P!==null?P.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return Ze!==null?null:b(te,P,""+le,xe);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case U:return le.key===Ze?O(te,P,le,xe):null;case F:return le.key===Ze?ce(te,P,le,xe):null;case z:return le=xn(le),oe(te,P,le,xe)}if(ae(le)||v(le))return Ze!==null?null:pe(te,P,le,xe,null);if(typeof le.then=="function")return oe(te,P,Hl(le),xe);if(le.$$typeof===M)return oe(te,P,zl(te,le),xe);Bl(te,le)}return null}function me(te,P,le,xe,Ze){if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return te=te.get(le)||null,b(P,te,""+xe,Ze);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case U:return te=te.get(xe.key===null?le:xe.key)||null,O(P,te,xe,Ze);case F:return te=te.get(xe.key===null?le:xe.key)||null,ce(P,te,xe,Ze);case z:return xe=xn(xe),me(te,P,le,xe,Ze)}if(ae(xe)||v(xe))return te=te.get(le)||null,pe(P,te,xe,Ze,null);if(typeof xe.then=="function")return me(te,P,le,Hl(xe),Ze);if(xe.$$typeof===M)return me(te,P,le,zl(P,xe),Ze);Bl(P,xe)}return null}function Be(te,P,le,xe){for(var Ze=null,vt=null,Pe=P,it=P=0,ft=null;Pe!==null&&it<le.length;it++){Pe.index>it?(ft=Pe,Pe=null):ft=Pe.sibling;var yt=oe(te,Pe,le[it],xe);if(yt===null){Pe===null&&(Pe=ft);break}t&&Pe&&yt.alternate===null&&a(te,Pe),P=d(yt,P,it),vt===null?Ze=yt:vt.sibling=yt,vt=yt,Pe=ft}if(it===le.length)return s(te,Pe),gt&&ds(te,it),Ze;if(Pe===null){for(;it<le.length;it++)Pe=je(te,le[it],xe),Pe!==null&&(P=d(Pe,P,it),vt===null?Ze=Pe:vt.sibling=Pe,vt=Pe);return gt&&ds(te,it),Ze}for(Pe=n(Pe);it<le.length;it++)ft=me(Pe,te,it,le[it],xe),ft!==null&&(t&&ft.alternate!==null&&Pe.delete(ft.key===null?it:ft.key),P=d(ft,P,it),vt===null?Ze=ft:vt.sibling=ft,vt=ft);return t&&Pe.forEach(function(Ws){return a(te,Ws)}),gt&&ds(te,it),Ze}function et(te,P,le,xe){if(le==null)throw Error(c(151));for(var Ze=null,vt=null,Pe=P,it=P=0,ft=null,yt=le.next();Pe!==null&&!yt.done;it++,yt=le.next()){Pe.index>it?(ft=Pe,Pe=null):ft=Pe.sibling;var Ws=oe(te,Pe,yt.value,xe);if(Ws===null){Pe===null&&(Pe=ft);break}t&&Pe&&Ws.alternate===null&&a(te,Pe),P=d(Ws,P,it),vt===null?Ze=Ws:vt.sibling=Ws,vt=Ws,Pe=ft}if(yt.done)return s(te,Pe),gt&&ds(te,it),Ze;if(Pe===null){for(;!yt.done;it++,yt=le.next())yt=je(te,yt.value,xe),yt!==null&&(P=d(yt,P,it),vt===null?Ze=yt:vt.sibling=yt,vt=yt);return gt&&ds(te,it),Ze}for(Pe=n(Pe);!yt.done;it++,yt=le.next())yt=me(Pe,te,it,yt.value,xe),yt!==null&&(t&&yt.alternate!==null&&Pe.delete(yt.key===null?it:yt.key),P=d(yt,P,it),vt===null?Ze=yt:vt.sibling=yt,vt=yt);return t&&Pe.forEach(function(_x){return a(te,_x)}),gt&&ds(te,it),Ze}function Tt(te,P,le,xe){if(typeof le=="object"&&le!==null&&le.type===L&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case U:e:{for(var Ze=le.key;P!==null;){if(P.key===Ze){if(Ze=le.type,Ze===L){if(P.tag===7){s(te,P.sibling),xe=i(P,le.props.children),xe.return=te,te=xe;break e}}else if(P.elementType===Ze||typeof Ze=="object"&&Ze!==null&&Ze.$$typeof===z&&xn(Ze)===P.type){s(te,P.sibling),xe=i(P,le.props),Ur(xe,le),xe.return=te,te=xe;break e}s(te,P);break}else a(te,P);P=P.sibling}le.type===L?(xe=mn(le.props.children,te.mode,xe,le.key),xe.return=te,te=xe):(xe=Tl(le.type,le.key,le.props,null,te.mode,xe),Ur(xe,le),xe.return=te,te=xe)}return h(te);case F:e:{for(Ze=le.key;P!==null;){if(P.key===Ze)if(P.tag===4&&P.stateNode.containerInfo===le.containerInfo&&P.stateNode.implementation===le.implementation){s(te,P.sibling),xe=i(P,le.children||[]),xe.return=te,te=xe;break e}else{s(te,P);break}else a(te,P);P=P.sibling}xe=mc(le,te.mode,xe),xe.return=te,te=xe}return h(te);case z:return le=xn(le),Tt(te,P,le,xe)}if(ae(le))return Be(te,P,le,xe);if(v(le)){if(Ze=v(le),typeof Ze!="function")throw Error(c(150));return le=Ze.call(le),et(te,P,le,xe)}if(typeof le.then=="function")return Tt(te,P,Hl(le),xe);if(le.$$typeof===M)return Tt(te,P,zl(te,le),xe);Bl(te,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,P!==null&&P.tag===6?(s(te,P.sibling),xe=i(P,le),xe.return=te,te=xe):(s(te,P),xe=uc(le,te.mode,xe),xe.return=te,te=xe),h(te)):s(te,P)}return function(te,P,le,xe){try{Or=0;var Ze=Tt(te,P,le,xe);return Kn=null,Ze}catch(Pe){if(Pe===Jn||Pe===Ul)throw Pe;var vt=Ma(29,Pe,null,te.mode);return vt.lanes=xe,vt.return=te,vt}finally{}}}var vn=vu(!0),yu=vu(!1),Os=!1;function Sc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Cc(t,a){t=t.updateQueue,a.updateQueue===t&&(a.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Us(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Ls(t,a,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(Nt&2)!==0){var i=n.pending;return i===null?a.next=a:(a.next=i.next,i.next=a),n.pending=a,a=Al(t),su(t,null,s),a}return Ml(t,n,a,s),Al(t)}function Lr(t,a,s){if(a=a.updateQueue,a!==null&&(a=a.shared,(s&4194048)!==0)){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,Ue(t,s)}}function wc(t,a){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var i=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var h={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};d===null?i=d=h:d=d.next=h,s=s.next}while(s!==null);d===null?i=d=a:d=d.next=a}else i=d=a;s={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:d,shared:n.shared,callbacks:n.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=a:t.next=a,s.lastBaseUpdate=a}var kc=!1;function Hr(){if(kc){var t=Zn;if(t!==null)throw t}}function Br(t,a,s,n){kc=!1;var i=t.updateQueue;Os=!1;var d=i.firstBaseUpdate,h=i.lastBaseUpdate,b=i.shared.pending;if(b!==null){i.shared.pending=null;var O=b,ce=O.next;O.next=null,h===null?d=ce:h.next=ce,h=O;var pe=t.alternate;pe!==null&&(pe=pe.updateQueue,b=pe.lastBaseUpdate,b!==h&&(b===null?pe.firstBaseUpdate=ce:b.next=ce,pe.lastBaseUpdate=O))}if(d!==null){var je=i.baseState;h=0,pe=ce=O=null,b=d;do{var oe=b.lane&-536870913,me=oe!==b.lane;if(me?(ht&oe)===oe:(n&oe)===oe){oe!==0&&oe===In&&(kc=!0),pe!==null&&(pe=pe.next={lane:0,tag:b.tag,payload:b.payload,callback:null,next:null});e:{var Be=t,et=b;oe=a;var Tt=s;switch(et.tag){case 1:if(Be=et.payload,typeof Be=="function"){je=Be.call(Tt,je,oe);break e}je=Be;break e;case 3:Be.flags=Be.flags&-65537|128;case 0:if(Be=et.payload,oe=typeof Be=="function"?Be.call(Tt,je,oe):Be,oe==null)break e;je=T({},je,oe);break e;case 2:Os=!0}}oe=b.callback,oe!==null&&(t.flags|=64,me&&(t.flags|=8192),me=i.callbacks,me===null?i.callbacks=[oe]:me.push(oe))}else me={lane:oe,tag:b.tag,payload:b.payload,callback:b.callback,next:null},pe===null?(ce=pe=me,O=je):pe=pe.next=me,h|=oe;if(b=b.next,b===null){if(b=i.shared.pending,b===null)break;me=b,b=me.next,me.next=null,i.lastBaseUpdate=me,i.shared.pending=null}}while(!0);pe===null&&(O=je),i.baseState=O,i.firstBaseUpdate=ce,i.lastBaseUpdate=pe,d===null&&(i.shared.lanes=0),Vs|=h,t.lanes=h,t.memoizedState=je}}function bu(t,a){if(typeof t!="function")throw Error(c(191,t));t.call(a)}function _u(t,a){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)bu(s[t],a)}var Wn=I(null),Fl=I(0);function Nu(t,a){t=bs,C(Fl,t),C(Wn,a),bs=t|a.baseLanes}function Ec(){C(Fl,bs),C(Wn,Wn.current)}function Dc(){bs=Fl.current,X(Wn),X(Fl)}var Aa=I(null),Ya=null;function Hs(t){var a=t.alternate;C(Kt,Kt.current&1),C(Aa,t),Ya===null&&(a===null||Wn.current!==null||a.memoizedState!==null)&&(Ya=t)}function Mc(t){C(Kt,Kt.current),C(Aa,t),Ya===null&&(Ya=t)}function Su(t){t.tag===22?(C(Kt,Kt.current),C(Aa,t),Ya===null&&(Ya=t)):Bs()}function Bs(){C(Kt,Kt.current),C(Aa,Aa.current)}function Ta(t){X(Aa),Ya===t&&(Ya=null),X(Kt)}var Kt=I(0);function $l(t){for(var a=t;a!==null;){if(a.tag===13){var s=a.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||Uo(s)||Lo(s)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var hs=0,lt=null,Mt=null,na=null,Vl=!1,er=!1,yn=!1,Gl=0,Fr=0,tr=null,mg=0;function Xt(){throw Error(c(321))}function Ac(t,a){if(a===null)return!1;for(var s=0;s<a.length&&s<t.length;s++)if(!Da(t[s],a[s]))return!1;return!0}function Tc(t,a,s,n,i,d){return hs=d,lt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,D.H=t===null||t.memoizedState===null?im:Qc,yn=!1,d=s(n,i),yn=!1,er&&(d=wu(a,s,n,i)),Cu(t),d}function Cu(t){D.H=Gr;var a=Mt!==null&&Mt.next!==null;if(hs=0,na=Mt=lt=null,Vl=!1,Fr=0,tr=null,a)throw Error(c(300));t===null||ra||(t=t.dependencies,t!==null&&ql(t)&&(ra=!0))}function wu(t,a,s,n){lt=t;var i=0;do{if(er&&(tr=null),Fr=0,er=!1,25<=i)throw Error(c(301));if(i+=1,na=Mt=null,t.updateQueue!=null){var d=t.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}D.H=cm,d=a(s,n)}while(er);return d}function hg(){var t=D.H,a=t.useState()[0];return a=typeof a.then=="function"?$r(a):a,t=t.useState()[0],(Mt!==null?Mt.memoizedState:null)!==t&&(lt.flags|=1024),a}function Rc(){var t=Gl!==0;return Gl=0,t}function qc(t,a,s){a.updateQueue=t.updateQueue,a.flags&=-2053,t.lanes&=~s}function zc(t){if(Vl){for(t=t.memoizedState;t!==null;){var a=t.queue;a!==null&&(a.pending=null),t=t.next}Vl=!1}hs=0,na=Mt=lt=null,er=!1,Fr=Gl=0,tr=null}function ba(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return na===null?lt.memoizedState=na=t:na=na.next=t,na}function Wt(){if(Mt===null){var t=lt.alternate;t=t!==null?t.memoizedState:null}else t=Mt.next;var a=na===null?lt.memoizedState:na.next;if(a!==null)na=a,Mt=t;else{if(t===null)throw lt.alternate===null?Error(c(467)):Error(c(310));Mt=t,t={memoizedState:Mt.memoizedState,baseState:Mt.baseState,baseQueue:Mt.baseQueue,queue:Mt.queue,next:null},na===null?lt.memoizedState=na=t:na=na.next=t}return na}function Yl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function $r(t){var a=Fr;return Fr+=1,tr===null&&(tr=[]),t=gu(tr,t,a),a=lt,(na===null?a.memoizedState:na.next)===null&&(a=a.alternate,D.H=a===null||a.memoizedState===null?im:Qc),t}function Pl(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return $r(t);if(t.$$typeof===M)return fa(t)}throw Error(c(438,String(t)))}function Oc(t){var a=null,s=lt.updateQueue;if(s!==null&&(a=s.memoCache),a==null){var n=lt.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(a={data:n.data.map(function(i){return i.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),s===null&&(s=Yl(),lt.updateQueue=s),s.memoCache=a,s=a.data[a.index],s===void 0)for(s=a.data[a.index]=Array(t),n=0;n<t;n++)s[n]=$;return a.index++,s}function fs(t,a){return typeof a=="function"?a(t):a}function Ql(t){var a=Wt();return Uc(a,Mt,t)}function Uc(t,a,s){var n=t.queue;if(n===null)throw Error(c(311));n.lastRenderedReducer=s;var i=t.baseQueue,d=n.pending;if(d!==null){if(i!==null){var h=i.next;i.next=d.next,d.next=h}a.baseQueue=i=d,n.pending=null}if(d=t.baseState,i===null)t.memoizedState=d;else{a=i.next;var b=h=null,O=null,ce=a,pe=!1;do{var je=ce.lane&-536870913;if(je!==ce.lane?(ht&je)===je:(hs&je)===je){var oe=ce.revertLane;if(oe===0)O!==null&&(O=O.next={lane:0,revertLane:0,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null}),je===In&&(pe=!0);else if((hs&oe)===oe){ce=ce.next,oe===In&&(pe=!0);continue}else je={lane:0,revertLane:ce.revertLane,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},O===null?(b=O=je,h=d):O=O.next=je,lt.lanes|=oe,Vs|=oe;je=ce.action,yn&&s(d,je),d=ce.hasEagerState?ce.eagerState:s(d,je)}else oe={lane:je,revertLane:ce.revertLane,gesture:ce.gesture,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},O===null?(b=O=oe,h=d):O=O.next=oe,lt.lanes|=je,Vs|=je;ce=ce.next}while(ce!==null&&ce!==a);if(O===null?h=d:O.next=b,!Da(d,t.memoizedState)&&(ra=!0,pe&&(s=Zn,s!==null)))throw s;t.memoizedState=d,t.baseState=h,t.baseQueue=O,n.lastRenderedState=d}return i===null&&(n.lanes=0),[t.memoizedState,n.dispatch]}function Lc(t){var a=Wt(),s=a.queue;if(s===null)throw Error(c(311));s.lastRenderedReducer=t;var n=s.dispatch,i=s.pending,d=a.memoizedState;if(i!==null){s.pending=null;var h=i=i.next;do d=t(d,h.action),h=h.next;while(h!==i);Da(d,a.memoizedState)||(ra=!0),a.memoizedState=d,a.baseQueue===null&&(a.baseState=d),s.lastRenderedState=d}return[d,n]}function ku(t,a,s){var n=lt,i=Wt(),d=gt;if(d){if(s===void 0)throw Error(c(407));s=s()}else s=a();var h=!Da((Mt||i).memoizedState,s);if(h&&(i.memoizedState=s,ra=!0),i=i.queue,Fc(Mu.bind(null,n,i,t),[t]),i.getSnapshot!==a||h||na!==null&&na.memoizedState.tag&1){if(n.flags|=2048,ar(9,{destroy:void 0},Du.bind(null,n,i,s,a),null),qt===null)throw Error(c(349));d||(hs&127)!==0||Eu(n,a,s)}return s}function Eu(t,a,s){t.flags|=16384,t={getSnapshot:a,value:s},a=lt.updateQueue,a===null?(a=Yl(),lt.updateQueue=a,a.stores=[t]):(s=a.stores,s===null?a.stores=[t]:s.push(t))}function Du(t,a,s,n){a.value=s,a.getSnapshot=n,Au(a)&&Tu(t)}function Mu(t,a,s){return s(function(){Au(a)&&Tu(t)})}function Au(t){var a=t.getSnapshot;t=t.value;try{var s=a();return!Da(t,s)}catch{return!0}}function Tu(t){var a=un(t,2);a!==null&&Ea(a,t,2)}function Hc(t){var a=ba();if(typeof t=="function"){var s=t;if(t=s(),yn){ke(!0);try{s()}finally{ke(!1)}}}return a.memoizedState=a.baseState=t,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:t},a}function Ru(t,a,s,n){return t.baseState=s,Uc(t,Mt,typeof n=="function"?n:fs)}function fg(t,a,s,n,i){if(Zl(t))throw Error(c(485));if(t=a.action,t!==null){var d={payload:i,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(h){d.listeners.push(h)}};D.T!==null?s(!0):d.isTransition=!1,n(d),s=a.pending,s===null?(d.next=a.pending=d,qu(a,d)):(d.next=s.next,a.pending=s.next=d)}}function qu(t,a){var s=a.action,n=a.payload,i=t.state;if(a.isTransition){var d=D.T,h={};D.T=h;try{var b=s(i,n),O=D.S;O!==null&&O(h,b),zu(t,a,b)}catch(ce){Bc(t,a,ce)}finally{d!==null&&h.types!==null&&(d.types=h.types),D.T=d}}else try{d=s(i,n),zu(t,a,d)}catch(ce){Bc(t,a,ce)}}function zu(t,a,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(n){Ou(t,a,n)},function(n){return Bc(t,a,n)}):Ou(t,a,s)}function Ou(t,a,s){a.status="fulfilled",a.value=s,Uu(a),t.state=s,a=t.pending,a!==null&&(s=a.next,s===a?t.pending=null:(s=s.next,a.next=s,qu(t,s)))}function Bc(t,a,s){var n=t.pending;if(t.pending=null,n!==null){n=n.next;do a.status="rejected",a.reason=s,Uu(a),a=a.next;while(a!==n)}t.action=null}function Uu(t){t=t.listeners;for(var a=0;a<t.length;a++)(0,t[a])()}function Lu(t,a){return a}function Hu(t,a){if(gt){var s=qt.formState;if(s!==null){e:{var n=lt;if(gt){if(Ht){t:{for(var i=Ht,d=Ga;i.nodeType!==8;){if(!d){i=null;break t}if(i=Pa(i.nextSibling),i===null){i=null;break t}}d=i.data,i=d==="F!"||d==="F"?i:null}if(i){Ht=Pa(i.nextSibling),n=i.data==="F!";break e}}qs(n)}n=!1}n&&(a=s[0])}}return s=ba(),s.memoizedState=s.baseState=a,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Lu,lastRenderedState:a},s.queue=n,s=nm.bind(null,lt,n),n.dispatch=s,n=Hc(!1),d=Pc.bind(null,lt,!1,n.queue),n=ba(),i={state:a,dispatch:null,action:t,pending:null},n.queue=i,s=fg.bind(null,lt,i,d,s),i.dispatch=s,n.memoizedState=t,[a,s,!1]}function Bu(t){var a=Wt();return Fu(a,Mt,t)}function Fu(t,a,s){if(a=Uc(t,a,Lu)[0],t=Ql(fs)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var n=$r(a)}catch(h){throw h===Jn?Ul:h}else n=a;a=Wt();var i=a.queue,d=i.dispatch;return s!==a.memoizedState&&(lt.flags|=2048,ar(9,{destroy:void 0},pg.bind(null,i,s),null)),[n,d,t]}function pg(t,a){t.action=a}function $u(t){var a=Wt(),s=Mt;if(s!==null)return Fu(a,s,t);Wt(),a=a.memoizedState,s=Wt();var n=s.queue.dispatch;return s.memoizedState=t,[a,n,!1]}function ar(t,a,s,n){return t={tag:t,create:s,deps:n,inst:a,next:null},a=lt.updateQueue,a===null&&(a=Yl(),lt.updateQueue=a),s=a.lastEffect,s===null?a.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,a.lastEffect=t),t}function Vu(){return Wt().memoizedState}function Xl(t,a,s,n){var i=ba();lt.flags|=t,i.memoizedState=ar(1|a,{destroy:void 0},s,n===void 0?null:n)}function Il(t,a,s,n){var i=Wt();n=n===void 0?null:n;var d=i.memoizedState.inst;Mt!==null&&n!==null&&Ac(n,Mt.memoizedState.deps)?i.memoizedState=ar(a,d,s,n):(lt.flags|=t,i.memoizedState=ar(1|a,d,s,n))}function Gu(t,a){Xl(8390656,8,t,a)}function Fc(t,a){Il(2048,8,t,a)}function gg(t){lt.flags|=4;var a=lt.updateQueue;if(a===null)a=Yl(),lt.updateQueue=a,a.events=[t];else{var s=a.events;s===null?a.events=[t]:s.push(t)}}function Yu(t){var a=Wt().memoizedState;return gg({ref:a,nextImpl:t}),function(){if((Nt&2)!==0)throw Error(c(440));return a.impl.apply(void 0,arguments)}}function Pu(t,a){return Il(4,2,t,a)}function Qu(t,a){return Il(4,4,t,a)}function Xu(t,a){if(typeof a=="function"){t=t();var s=a(t);return function(){typeof s=="function"?s():a(null)}}if(a!=null)return t=t(),a.current=t,function(){a.current=null}}function Iu(t,a,s){s=s!=null?s.concat([t]):null,Il(4,4,Xu.bind(null,a,t),s)}function $c(){}function Zu(t,a){var s=Wt();a=a===void 0?null:a;var n=s.memoizedState;return a!==null&&Ac(a,n[1])?n[0]:(s.memoizedState=[t,a],t)}function Ju(t,a){var s=Wt();a=a===void 0?null:a;var n=s.memoizedState;if(a!==null&&Ac(a,n[1]))return n[0];if(n=t(),yn){ke(!0);try{t()}finally{ke(!1)}}return s.memoizedState=[n,a],n}function Vc(t,a,s){return s===void 0||(hs&1073741824)!==0&&(ht&261930)===0?t.memoizedState=a:(t.memoizedState=s,t=Km(),lt.lanes|=t,Vs|=t,s)}function Ku(t,a,s,n){return Da(s,a)?s:Wn.current!==null?(t=Vc(t,s,n),Da(t,a)||(ra=!0),t):(hs&42)===0||(hs&1073741824)!==0&&(ht&261930)===0?(ra=!0,t.memoizedState=s):(t=Km(),lt.lanes|=t,Vs|=t,a)}function Wu(t,a,s,n,i){var d=V.p;V.p=d!==0&&8>d?d:8;var h=D.T,b={};D.T=b,Pc(t,!1,a,s);try{var O=i(),ce=D.S;if(ce!==null&&ce(b,O),O!==null&&typeof O=="object"&&typeof O.then=="function"){var pe=ug(O,n);Vr(t,a,pe,za(t))}else Vr(t,a,n,za(t))}catch(je){Vr(t,a,{then:function(){},status:"rejected",reason:je},za())}finally{V.p=d,h!==null&&b.types!==null&&(h.types=b.types),D.T=h}}function xg(){}function Gc(t,a,s,n){if(t.tag!==5)throw Error(c(476));var i=em(t).queue;Wu(t,i,a,k,s===null?xg:function(){return tm(t),s(n)})}function em(t){var a=t.memoizedState;if(a!==null)return a;a={memoizedState:k,baseState:k,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:k},next:null};var s={};return a.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:s},next:null},t.memoizedState=a,t=t.alternate,t!==null&&(t.memoizedState=a),a}function tm(t){var a=em(t);a.next===null&&(a=t.alternate.memoizedState),Vr(t,a.next.queue,{},za())}function Yc(){return fa(ll)}function am(){return Wt().memoizedState}function sm(){return Wt().memoizedState}function jg(t){for(var a=t.return;a!==null;){switch(a.tag){case 24:case 3:var s=za();t=Us(s);var n=Ls(a,t,s);n!==null&&(Ea(n,a,s),Lr(n,a,s)),a={cache:yc()},t.payload=a;return}a=a.return}}function vg(t,a,s){var n=za();s={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},Zl(t)?rm(a,s):(s=oc(t,a,s,n),s!==null&&(Ea(s,t,n),lm(s,a,n)))}function nm(t,a,s){var n=za();Vr(t,a,s,n)}function Vr(t,a,s,n){var i={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(Zl(t))rm(a,i);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=a.lastRenderedReducer,d!==null))try{var h=a.lastRenderedState,b=d(h,s);if(i.hasEagerState=!0,i.eagerState=b,Da(b,h))return Ml(t,a,i,0),qt===null&&Dl(),!1}catch{}finally{}if(s=oc(t,a,i,n),s!==null)return Ea(s,t,n),lm(s,a,n),!0}return!1}function Pc(t,a,s,n){if(n={lane:2,revertLane:Co(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Zl(t)){if(a)throw Error(c(479))}else a=oc(t,s,n,2),a!==null&&Ea(a,t,2)}function Zl(t){var a=t.alternate;return t===lt||a!==null&&a===lt}function rm(t,a){er=Vl=!0;var s=t.pending;s===null?a.next=a:(a.next=s.next,s.next=a),t.pending=a}function lm(t,a,s){if((s&4194048)!==0){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,Ue(t,s)}}var Gr={readContext:fa,use:Pl,useCallback:Xt,useContext:Xt,useEffect:Xt,useImperativeHandle:Xt,useLayoutEffect:Xt,useInsertionEffect:Xt,useMemo:Xt,useReducer:Xt,useRef:Xt,useState:Xt,useDebugValue:Xt,useDeferredValue:Xt,useTransition:Xt,useSyncExternalStore:Xt,useId:Xt,useHostTransitionStatus:Xt,useFormState:Xt,useActionState:Xt,useOptimistic:Xt,useMemoCache:Xt,useCacheRefresh:Xt};Gr.useEffectEvent=Xt;var im={readContext:fa,use:Pl,useCallback:function(t,a){return ba().memoizedState=[t,a===void 0?null:a],t},useContext:fa,useEffect:Gu,useImperativeHandle:function(t,a,s){s=s!=null?s.concat([t]):null,Xl(4194308,4,Xu.bind(null,a,t),s)},useLayoutEffect:function(t,a){return Xl(4194308,4,t,a)},useInsertionEffect:function(t,a){Xl(4,2,t,a)},useMemo:function(t,a){var s=ba();a=a===void 0?null:a;var n=t();if(yn){ke(!0);try{t()}finally{ke(!1)}}return s.memoizedState=[n,a],n},useReducer:function(t,a,s){var n=ba();if(s!==void 0){var i=s(a);if(yn){ke(!0);try{s(a)}finally{ke(!1)}}}else i=a;return n.memoizedState=n.baseState=i,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},n.queue=t,t=t.dispatch=vg.bind(null,lt,t),[n.memoizedState,t]},useRef:function(t){var a=ba();return t={current:t},a.memoizedState=t},useState:function(t){t=Hc(t);var a=t.queue,s=nm.bind(null,lt,a);return a.dispatch=s,[t.memoizedState,s]},useDebugValue:$c,useDeferredValue:function(t,a){var s=ba();return Vc(s,t,a)},useTransition:function(){var t=Hc(!1);return t=Wu.bind(null,lt,t.queue,!0,!1),ba().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,a,s){var n=lt,i=ba();if(gt){if(s===void 0)throw Error(c(407));s=s()}else{if(s=a(),qt===null)throw Error(c(349));(ht&127)!==0||Eu(n,a,s)}i.memoizedState=s;var d={value:s,getSnapshot:a};return i.queue=d,Gu(Mu.bind(null,n,d,t),[t]),n.flags|=2048,ar(9,{destroy:void 0},Du.bind(null,n,d,s,a),null),s},useId:function(){var t=ba(),a=qt.identifierPrefix;if(gt){var s=ts,n=es;s=(n&~(1<<32-De(n)-1)).toString(32)+s,a="_"+a+"R_"+s,s=Gl++,0<s&&(a+="H"+s.toString(32)),a+="_"}else s=mg++,a="_"+a+"r_"+s.toString(32)+"_";return t.memoizedState=a},useHostTransitionStatus:Yc,useFormState:Hu,useActionState:Hu,useOptimistic:function(t){var a=ba();a.memoizedState=a.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=s,a=Pc.bind(null,lt,!0,s),s.dispatch=a,[t,a]},useMemoCache:Oc,useCacheRefresh:function(){return ba().memoizedState=jg.bind(null,lt)},useEffectEvent:function(t){var a=ba(),s={impl:t};return a.memoizedState=s,function(){if((Nt&2)!==0)throw Error(c(440));return s.impl.apply(void 0,arguments)}}},Qc={readContext:fa,use:Pl,useCallback:Zu,useContext:fa,useEffect:Fc,useImperativeHandle:Iu,useInsertionEffect:Pu,useLayoutEffect:Qu,useMemo:Ju,useReducer:Ql,useRef:Vu,useState:function(){return Ql(fs)},useDebugValue:$c,useDeferredValue:function(t,a){var s=Wt();return Ku(s,Mt.memoizedState,t,a)},useTransition:function(){var t=Ql(fs)[0],a=Wt().memoizedState;return[typeof t=="boolean"?t:$r(t),a]},useSyncExternalStore:ku,useId:am,useHostTransitionStatus:Yc,useFormState:Bu,useActionState:Bu,useOptimistic:function(t,a){var s=Wt();return Ru(s,Mt,t,a)},useMemoCache:Oc,useCacheRefresh:sm};Qc.useEffectEvent=Yu;var cm={readContext:fa,use:Pl,useCallback:Zu,useContext:fa,useEffect:Fc,useImperativeHandle:Iu,useInsertionEffect:Pu,useLayoutEffect:Qu,useMemo:Ju,useReducer:Lc,useRef:Vu,useState:function(){return Lc(fs)},useDebugValue:$c,useDeferredValue:function(t,a){var s=Wt();return Mt===null?Vc(s,t,a):Ku(s,Mt.memoizedState,t,a)},useTransition:function(){var t=Lc(fs)[0],a=Wt().memoizedState;return[typeof t=="boolean"?t:$r(t),a]},useSyncExternalStore:ku,useId:am,useHostTransitionStatus:Yc,useFormState:$u,useActionState:$u,useOptimistic:function(t,a){var s=Wt();return Mt!==null?Ru(s,Mt,t,a):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:Oc,useCacheRefresh:sm};cm.useEffectEvent=Yu;function Xc(t,a,s,n){a=t.memoizedState,s=s(n,a),s=s==null?a:T({},a,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var Ic={enqueueSetState:function(t,a,s){t=t._reactInternals;var n=za(),i=Us(n);i.payload=a,s!=null&&(i.callback=s),a=Ls(t,i,n),a!==null&&(Ea(a,t,n),Lr(a,t,n))},enqueueReplaceState:function(t,a,s){t=t._reactInternals;var n=za(),i=Us(n);i.tag=1,i.payload=a,s!=null&&(i.callback=s),a=Ls(t,i,n),a!==null&&(Ea(a,t,n),Lr(a,t,n))},enqueueForceUpdate:function(t,a){t=t._reactInternals;var s=za(),n=Us(s);n.tag=2,a!=null&&(n.callback=a),a=Ls(t,n,s),a!==null&&(Ea(a,t,s),Lr(a,t,s))}};function om(t,a,s,n,i,d,h){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,d,h):a.prototype&&a.prototype.isPureReactComponent?!Mr(s,n)||!Mr(i,d):!0}function dm(t,a,s,n){t=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(s,n),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(s,n),a.state!==t&&Ic.enqueueReplaceState(a,a.state,null)}function bn(t,a){var s=a;if("ref"in a){s={};for(var n in a)n!=="ref"&&(s[n]=a[n])}if(t=t.defaultProps){s===a&&(s=T({},s));for(var i in t)s[i]===void 0&&(s[i]=t[i])}return s}function um(t){El(t)}function mm(t){console.error(t)}function hm(t){El(t)}function Jl(t,a){try{var s=t.onUncaughtError;s(a.value,{componentStack:a.stack})}catch(n){setTimeout(function(){throw n})}}function fm(t,a,s){try{var n=t.onCaughtError;n(s.value,{componentStack:s.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function Zc(t,a,s){return s=Us(s),s.tag=3,s.payload={element:null},s.callback=function(){Jl(t,a)},s}function pm(t){return t=Us(t),t.tag=3,t}function gm(t,a,s,n){var i=s.type.getDerivedStateFromError;if(typeof i=="function"){var d=n.value;t.payload=function(){return i(d)},t.callback=function(){fm(a,s,n)}}var h=s.stateNode;h!==null&&typeof h.componentDidCatch=="function"&&(t.callback=function(){fm(a,s,n),typeof i!="function"&&(Gs===null?Gs=new Set([this]):Gs.add(this));var b=n.stack;this.componentDidCatch(n.value,{componentStack:b!==null?b:""})})}function yg(t,a,s,n,i){if(s.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(a=s.alternate,a!==null&&Xn(a,s,i,!0),s=Aa.current,s!==null){switch(s.tag){case 31:case 13:return Ya===null?oi():s.alternate===null&&It===0&&(It=3),s.flags&=-257,s.flags|=65536,s.lanes=i,n===Ll?s.flags|=16384:(a=s.updateQueue,a===null?s.updateQueue=new Set([n]):a.add(n),_o(t,n,i)),!1;case 22:return s.flags|=65536,n===Ll?s.flags|=16384:(a=s.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([n])},s.updateQueue=a):(s=a.retryQueue,s===null?a.retryQueue=new Set([n]):s.add(n)),_o(t,n,i)),!1}throw Error(c(435,s.tag))}return _o(t,n,i),oi(),!1}if(gt)return a=Aa.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=i,n!==pc&&(t=Error(c(422),{cause:n}),Rr(Fa(t,s)))):(n!==pc&&(a=Error(c(423),{cause:n}),Rr(Fa(a,s))),t=t.current.alternate,t.flags|=65536,i&=-i,t.lanes|=i,n=Fa(n,s),i=Zc(t.stateNode,n,i),wc(t,i),It!==4&&(It=2)),!1;var d=Error(c(520),{cause:n});if(d=Fa(d,s),Kr===null?Kr=[d]:Kr.push(d),It!==4&&(It=2),a===null)return!0;n=Fa(n,s),s=a;do{switch(s.tag){case 3:return s.flags|=65536,t=i&-i,s.lanes|=t,t=Zc(s.stateNode,n,t),wc(s,t),!1;case 1:if(a=s.type,d=s.stateNode,(s.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(Gs===null||!Gs.has(d))))return s.flags|=65536,i&=-i,s.lanes|=i,i=pm(i),gm(i,t,s,n),wc(s,i),!1}s=s.return}while(s!==null);return!1}var Jc=Error(c(461)),ra=!1;function pa(t,a,s,n){a.child=t===null?yu(a,null,s,n):vn(a,t.child,s,n)}function xm(t,a,s,n,i){s=s.render;var d=a.ref;if("ref"in n){var h={};for(var b in n)b!=="ref"&&(h[b]=n[b])}else h=n;return pn(a),n=Tc(t,a,s,h,d,i),b=Rc(),t!==null&&!ra?(qc(t,a,i),ps(t,a,i)):(gt&&b&&hc(a),a.flags|=1,pa(t,a,n,i),a.child)}function jm(t,a,s,n,i){if(t===null){var d=s.type;return typeof d=="function"&&!dc(d)&&d.defaultProps===void 0&&s.compare===null?(a.tag=15,a.type=d,vm(t,a,d,n,i)):(t=Tl(s.type,null,n,a,a.mode,i),t.ref=a.ref,t.return=a,a.child=t)}if(d=t.child,!ro(t,i)){var h=d.memoizedProps;if(s=s.compare,s=s!==null?s:Mr,s(h,n)&&t.ref===a.ref)return ps(t,a,i)}return a.flags|=1,t=os(d,n),t.ref=a.ref,t.return=a,a.child=t}function vm(t,a,s,n,i){if(t!==null){var d=t.memoizedProps;if(Mr(d,n)&&t.ref===a.ref)if(ra=!1,a.pendingProps=n=d,ro(t,i))(t.flags&131072)!==0&&(ra=!0);else return a.lanes=t.lanes,ps(t,a,i)}return Kc(t,a,s,n,i)}function ym(t,a,s,n){var i=n.children,d=t!==null?t.memoizedState:null;if(t===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((a.flags&128)!==0){if(d=d!==null?d.baseLanes|s:s,t!==null){for(n=a.child=t.child,i=0;n!==null;)i=i|n.lanes|n.childLanes,n=n.sibling;n=i&~d}else n=0,a.child=null;return bm(t,a,d,s,n)}if((s&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},t!==null&&Ol(a,d!==null?d.cachePool:null),d!==null?Nu(a,d):Ec(),Su(a);else return n=a.lanes=536870912,bm(t,a,d!==null?d.baseLanes|s:s,s,n)}else d!==null?(Ol(a,d.cachePool),Nu(a,d),Bs(),a.memoizedState=null):(t!==null&&Ol(a,null),Ec(),Bs());return pa(t,a,i,s),a.child}function Yr(t,a){return t!==null&&t.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function bm(t,a,s,n,i){var d=_c();return d=d===null?null:{parent:sa._currentValue,pool:d},a.memoizedState={baseLanes:s,cachePool:d},t!==null&&Ol(a,null),Ec(),Su(a),t!==null&&Xn(t,a,n,!0),a.childLanes=i,null}function Kl(t,a){return a=ei({mode:a.mode,children:a.children},t.mode),a.ref=t.ref,t.child=a,a.return=t,a}function _m(t,a,s){return vn(a,t.child,null,s),t=Kl(a,a.pendingProps),t.flags|=2,Ta(a),a.memoizedState=null,t}function bg(t,a,s){var n=a.pendingProps,i=(a.flags&128)!==0;if(a.flags&=-129,t===null){if(gt){if(n.mode==="hidden")return t=Kl(a,n),a.lanes=536870912,Yr(null,t);if(Mc(a),(t=Ht)?(t=qh(t,Ga),t=t!==null&&t.data==="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:Ts!==null?{id:es,overflow:ts}:null,retryLane:536870912,hydrationErrors:null},s=ru(t),s.return=a,a.child=s,ha=a,Ht=null)):t=null,t===null)throw qs(a);return a.lanes=536870912,null}return Kl(a,n)}var d=t.memoizedState;if(d!==null){var h=d.dehydrated;if(Mc(a),i)if(a.flags&256)a.flags&=-257,a=_m(t,a,s);else if(a.memoizedState!==null)a.child=t.child,a.flags|=128,a=null;else throw Error(c(558));else if(ra||Xn(t,a,s,!1),i=(s&t.childLanes)!==0,ra||i){if(n=qt,n!==null&&(h=He(n,s),h!==0&&h!==d.retryLane))throw d.retryLane=h,un(t,h),Ea(n,t,h),Jc;oi(),a=_m(t,a,s)}else t=d.treeContext,Ht=Pa(h.nextSibling),ha=a,gt=!0,Rs=null,Ga=!1,t!==null&&cu(a,t),a=Kl(a,n),a.flags|=4096;return a}return t=os(t.child,{mode:n.mode,children:n.children}),t.ref=a.ref,a.child=t,t.return=a,t}function Wl(t,a){var s=a.ref;if(s===null)t!==null&&t.ref!==null&&(a.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(c(284));(t===null||t.ref!==s)&&(a.flags|=4194816)}}function Kc(t,a,s,n,i){return pn(a),s=Tc(t,a,s,n,void 0,i),n=Rc(),t!==null&&!ra?(qc(t,a,i),ps(t,a,i)):(gt&&n&&hc(a),a.flags|=1,pa(t,a,s,i),a.child)}function Nm(t,a,s,n,i,d){return pn(a),a.updateQueue=null,s=wu(a,n,s,i),Cu(t),n=Rc(),t!==null&&!ra?(qc(t,a,d),ps(t,a,d)):(gt&&n&&hc(a),a.flags|=1,pa(t,a,s,d),a.child)}function Sm(t,a,s,n,i){if(pn(a),a.stateNode===null){var d=Gn,h=s.contextType;typeof h=="object"&&h!==null&&(d=fa(h)),d=new s(n,d),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Ic,a.stateNode=d,d._reactInternals=a,d=a.stateNode,d.props=n,d.state=a.memoizedState,d.refs={},Sc(a),h=s.contextType,d.context=typeof h=="object"&&h!==null?fa(h):Gn,d.state=a.memoizedState,h=s.getDerivedStateFromProps,typeof h=="function"&&(Xc(a,s,h,n),d.state=a.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(h=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),h!==d.state&&Ic.enqueueReplaceState(d,d.state,null),Br(a,n,d,i),Hr(),d.state=a.memoizedState),typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!0}else if(t===null){d=a.stateNode;var b=a.memoizedProps,O=bn(s,b);d.props=O;var ce=d.context,pe=s.contextType;h=Gn,typeof pe=="object"&&pe!==null&&(h=fa(pe));var je=s.getDerivedStateFromProps;pe=typeof je=="function"||typeof d.getSnapshotBeforeUpdate=="function",b=a.pendingProps!==b,pe||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(b||ce!==h)&&dm(a,d,n,h),Os=!1;var oe=a.memoizedState;d.state=oe,Br(a,n,d,i),Hr(),ce=a.memoizedState,b||oe!==ce||Os?(typeof je=="function"&&(Xc(a,s,je,n),ce=a.memoizedState),(O=Os||om(a,s,O,n,oe,ce,h))?(pe||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(a.flags|=4194308)):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=n,a.memoizedState=ce),d.props=n,d.state=ce,d.context=h,n=O):(typeof d.componentDidMount=="function"&&(a.flags|=4194308),n=!1)}else{d=a.stateNode,Cc(t,a),h=a.memoizedProps,pe=bn(s,h),d.props=pe,je=a.pendingProps,oe=d.context,ce=s.contextType,O=Gn,typeof ce=="object"&&ce!==null&&(O=fa(ce)),b=s.getDerivedStateFromProps,(ce=typeof b=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==je||oe!==O)&&dm(a,d,n,O),Os=!1,oe=a.memoizedState,d.state=oe,Br(a,n,d,i),Hr();var me=a.memoizedState;h!==je||oe!==me||Os||t!==null&&t.dependencies!==null&&ql(t.dependencies)?(typeof b=="function"&&(Xc(a,s,b,n),me=a.memoizedState),(pe=Os||om(a,s,pe,n,oe,me,O)||t!==null&&t.dependencies!==null&&ql(t.dependencies))?(ce||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,me,O),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,me,O)),typeof d.componentDidUpdate=="function"&&(a.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=1024),a.memoizedProps=n,a.memoizedState=me),d.props=n,d.state=me,d.context=O,n=pe):(typeof d.componentDidUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&oe===t.memoizedState||(a.flags|=1024),n=!1)}return d=n,Wl(t,a),n=(a.flags&128)!==0,d||n?(d=a.stateNode,s=n&&typeof s.getDerivedStateFromError!="function"?null:d.render(),a.flags|=1,t!==null&&n?(a.child=vn(a,t.child,null,i),a.child=vn(a,null,s,i)):pa(t,a,s,i),a.memoizedState=d.state,t=a.child):t=ps(t,a,i),t}function Cm(t,a,s,n){return hn(),a.flags|=256,pa(t,a,s,n),a.child}var Wc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function eo(t){return{baseLanes:t,cachePool:fu()}}function to(t,a,s){return t=t!==null?t.childLanes&~s:0,a&&(t|=qa),t}function wm(t,a,s){var n=a.pendingProps,i=!1,d=(a.flags&128)!==0,h;if((h=d)||(h=t!==null&&t.memoizedState===null?!1:(Kt.current&2)!==0),h&&(i=!0,a.flags&=-129),h=(a.flags&32)!==0,a.flags&=-33,t===null){if(gt){if(i?Hs(a):Bs(),(t=Ht)?(t=qh(t,Ga),t=t!==null&&t.data!=="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:Ts!==null?{id:es,overflow:ts}:null,retryLane:536870912,hydrationErrors:null},s=ru(t),s.return=a,a.child=s,ha=a,Ht=null)):t=null,t===null)throw qs(a);return Lo(t)?a.lanes=32:a.lanes=536870912,null}var b=n.children;return n=n.fallback,i?(Bs(),i=a.mode,b=ei({mode:"hidden",children:b},i),n=mn(n,i,s,null),b.return=a,n.return=a,b.sibling=n,a.child=b,n=a.child,n.memoizedState=eo(s),n.childLanes=to(t,h,s),a.memoizedState=Wc,Yr(null,n)):(Hs(a),ao(a,b))}var O=t.memoizedState;if(O!==null&&(b=O.dehydrated,b!==null)){if(d)a.flags&256?(Hs(a),a.flags&=-257,a=so(t,a,s)):a.memoizedState!==null?(Bs(),a.child=t.child,a.flags|=128,a=null):(Bs(),b=n.fallback,i=a.mode,n=ei({mode:"visible",children:n.children},i),b=mn(b,i,s,null),b.flags|=2,n.return=a,b.return=a,n.sibling=b,a.child=n,vn(a,t.child,null,s),n=a.child,n.memoizedState=eo(s),n.childLanes=to(t,h,s),a.memoizedState=Wc,a=Yr(null,n));else if(Hs(a),Lo(b)){if(h=b.nextSibling&&b.nextSibling.dataset,h)var ce=h.dgst;h=ce,n=Error(c(419)),n.stack="",n.digest=h,Rr({value:n,source:null,stack:null}),a=so(t,a,s)}else if(ra||Xn(t,a,s,!1),h=(s&t.childLanes)!==0,ra||h){if(h=qt,h!==null&&(n=He(h,s),n!==0&&n!==O.retryLane))throw O.retryLane=n,un(t,n),Ea(h,t,n),Jc;Uo(b)||oi(),a=so(t,a,s)}else Uo(b)?(a.flags|=192,a.child=t.child,a=null):(t=O.treeContext,Ht=Pa(b.nextSibling),ha=a,gt=!0,Rs=null,Ga=!1,t!==null&&cu(a,t),a=ao(a,n.children),a.flags|=4096);return a}return i?(Bs(),b=n.fallback,i=a.mode,O=t.child,ce=O.sibling,n=os(O,{mode:"hidden",children:n.children}),n.subtreeFlags=O.subtreeFlags&65011712,ce!==null?b=os(ce,b):(b=mn(b,i,s,null),b.flags|=2),b.return=a,n.return=a,n.sibling=b,a.child=n,Yr(null,n),n=a.child,b=t.child.memoizedState,b===null?b=eo(s):(i=b.cachePool,i!==null?(O=sa._currentValue,i=i.parent!==O?{parent:O,pool:O}:i):i=fu(),b={baseLanes:b.baseLanes|s,cachePool:i}),n.memoizedState=b,n.childLanes=to(t,h,s),a.memoizedState=Wc,Yr(t.child,n)):(Hs(a),s=t.child,t=s.sibling,s=os(s,{mode:"visible",children:n.children}),s.return=a,s.sibling=null,t!==null&&(h=a.deletions,h===null?(a.deletions=[t],a.flags|=16):h.push(t)),a.child=s,a.memoizedState=null,s)}function ao(t,a){return a=ei({mode:"visible",children:a},t.mode),a.return=t,t.child=a}function ei(t,a){return t=Ma(22,t,null,a),t.lanes=0,t}function so(t,a,s){return vn(a,t.child,null,s),t=ao(a,a.pendingProps.children),t.flags|=2,a.memoizedState=null,t}function km(t,a,s){t.lanes|=a;var n=t.alternate;n!==null&&(n.lanes|=a),jc(t.return,a,s)}function no(t,a,s,n,i,d){var h=t.memoizedState;h===null?t.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:i,treeForkCount:d}:(h.isBackwards=a,h.rendering=null,h.renderingStartTime=0,h.last=n,h.tail=s,h.tailMode=i,h.treeForkCount=d)}function Em(t,a,s){var n=a.pendingProps,i=n.revealOrder,d=n.tail;n=n.children;var h=Kt.current,b=(h&2)!==0;if(b?(h=h&1|2,a.flags|=128):h&=1,C(Kt,h),pa(t,a,n,s),n=gt?Tr:0,!b&&t!==null&&(t.flags&128)!==0)e:for(t=a.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&km(t,s,a);else if(t.tag===19)km(t,s,a);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===a)break e;for(;t.sibling===null;){if(t.return===null||t.return===a)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(i){case"forwards":for(s=a.child,i=null;s!==null;)t=s.alternate,t!==null&&$l(t)===null&&(i=s),s=s.sibling;s=i,s===null?(i=a.child,a.child=null):(i=s.sibling,s.sibling=null),no(a,!1,i,s,d,n);break;case"backwards":case"unstable_legacy-backwards":for(s=null,i=a.child,a.child=null;i!==null;){if(t=i.alternate,t!==null&&$l(t)===null){a.child=i;break}t=i.sibling,i.sibling=s,s=i,i=t}no(a,!0,s,null,d,n);break;case"together":no(a,!1,null,null,void 0,n);break;default:a.memoizedState=null}return a.child}function ps(t,a,s){if(t!==null&&(a.dependencies=t.dependencies),Vs|=a.lanes,(s&a.childLanes)===0)if(t!==null){if(Xn(t,a,s,!1),(s&a.childLanes)===0)return null}else return null;if(t!==null&&a.child!==t.child)throw Error(c(153));if(a.child!==null){for(t=a.child,s=os(t,t.pendingProps),a.child=s,s.return=a;t.sibling!==null;)t=t.sibling,s=s.sibling=os(t,t.pendingProps),s.return=a;s.sibling=null}return a.child}function ro(t,a){return(t.lanes&a)!==0?!0:(t=t.dependencies,!!(t!==null&&ql(t)))}function _g(t,a,s){switch(a.tag){case 3:qe(a,a.stateNode.containerInfo),zs(a,sa,t.memoizedState.cache),hn();break;case 27:case 5:Oe(a);break;case 4:qe(a,a.stateNode.containerInfo);break;case 10:zs(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,Mc(a),null;break;case 13:var n=a.memoizedState;if(n!==null)return n.dehydrated!==null?(Hs(a),a.flags|=128,null):(s&a.child.childLanes)!==0?wm(t,a,s):(Hs(a),t=ps(t,a,s),t!==null?t.sibling:null);Hs(a);break;case 19:var i=(t.flags&128)!==0;if(n=(s&a.childLanes)!==0,n||(Xn(t,a,s,!1),n=(s&a.childLanes)!==0),i){if(n)return Em(t,a,s);a.flags|=128}if(i=a.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),C(Kt,Kt.current),n)break;return null;case 22:return a.lanes=0,ym(t,a,s,a.pendingProps);case 24:zs(a,sa,t.memoizedState.cache)}return ps(t,a,s)}function Dm(t,a,s){if(t!==null)if(t.memoizedProps!==a.pendingProps)ra=!0;else{if(!ro(t,s)&&(a.flags&128)===0)return ra=!1,_g(t,a,s);ra=(t.flags&131072)!==0}else ra=!1,gt&&(a.flags&1048576)!==0&&iu(a,Tr,a.index);switch(a.lanes=0,a.tag){case 16:e:{var n=a.pendingProps;if(t=xn(a.elementType),a.type=t,typeof t=="function")dc(t)?(n=bn(t,n),a.tag=1,a=Sm(null,a,t,n,s)):(a.tag=0,a=Kc(null,a,t,n,s));else{if(t!=null){var i=t.$$typeof;if(i===A){a.tag=11,a=xm(null,a,t,n,s);break e}else if(i===Q){a.tag=14,a=jm(null,a,t,n,s);break e}}throw a=w(t)||t,Error(c(306,a,""))}}return a;case 0:return Kc(t,a,a.type,a.pendingProps,s);case 1:return n=a.type,i=bn(n,a.pendingProps),Sm(t,a,n,i,s);case 3:e:{if(qe(a,a.stateNode.containerInfo),t===null)throw Error(c(387));n=a.pendingProps;var d=a.memoizedState;i=d.element,Cc(t,a),Br(a,n,null,s);var h=a.memoizedState;if(n=h.cache,zs(a,sa,n),n!==d.cache&&vc(a,[sa],s,!0),Hr(),n=h.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:h.cache},a.updateQueue.baseState=d,a.memoizedState=d,a.flags&256){a=Cm(t,a,n,s);break e}else if(n!==i){i=Fa(Error(c(424)),a),Rr(i),a=Cm(t,a,n,s);break e}else{switch(t=a.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Ht=Pa(t.firstChild),ha=a,gt=!0,Rs=null,Ga=!0,s=yu(a,null,n,s),a.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(hn(),n===i){a=ps(t,a,s);break e}pa(t,a,n,s)}a=a.child}return a;case 26:return Wl(t,a),t===null?(s=Bh(a.type,null,a.pendingProps,null))?a.memoizedState=s:gt||(s=a.type,t=a.pendingProps,n=gi(ze.current).createElement(s),n[Ae]=a,n[Te]=t,ga(n,s,t),wt(n),a.stateNode=n):a.memoizedState=Bh(a.type,t.memoizedProps,a.pendingProps,t.memoizedState),null;case 27:return Oe(a),t===null&&gt&&(n=a.stateNode=Uh(a.type,a.pendingProps,ze.current),ha=a,Ga=!0,i=Ht,Xs(a.type)?(Ho=i,Ht=Pa(n.firstChild)):Ht=i),pa(t,a,a.pendingProps.children,s),Wl(t,a),t===null&&(a.flags|=4194304),a.child;case 5:return t===null&&gt&&((i=n=Ht)&&(n=Kg(n,a.type,a.pendingProps,Ga),n!==null?(a.stateNode=n,ha=a,Ht=Pa(n.firstChild),Ga=!1,i=!0):i=!1),i||qs(a)),Oe(a),i=a.type,d=a.pendingProps,h=t!==null?t.memoizedProps:null,n=d.children,qo(i,d)?n=null:h!==null&&qo(i,h)&&(a.flags|=32),a.memoizedState!==null&&(i=Tc(t,a,hg,null,null,s),ll._currentValue=i),Wl(t,a),pa(t,a,n,s),a.child;case 6:return t===null&&gt&&((t=s=Ht)&&(s=Wg(s,a.pendingProps,Ga),s!==null?(a.stateNode=s,ha=a,Ht=null,t=!0):t=!1),t||qs(a)),null;case 13:return wm(t,a,s);case 4:return qe(a,a.stateNode.containerInfo),n=a.pendingProps,t===null?a.child=vn(a,null,n,s):pa(t,a,n,s),a.child;case 11:return xm(t,a,a.type,a.pendingProps,s);case 7:return pa(t,a,a.pendingProps,s),a.child;case 8:return pa(t,a,a.pendingProps.children,s),a.child;case 12:return pa(t,a,a.pendingProps.children,s),a.child;case 10:return n=a.pendingProps,zs(a,a.type,n.value),pa(t,a,n.children,s),a.child;case 9:return i=a.type._context,n=a.pendingProps.children,pn(a),i=fa(i),n=n(i),a.flags|=1,pa(t,a,n,s),a.child;case 14:return jm(t,a,a.type,a.pendingProps,s);case 15:return vm(t,a,a.type,a.pendingProps,s);case 19:return Em(t,a,s);case 31:return bg(t,a,s);case 22:return ym(t,a,s,a.pendingProps);case 24:return pn(a),n=fa(sa),t===null?(i=_c(),i===null&&(i=qt,d=yc(),i.pooledCache=d,d.refCount++,d!==null&&(i.pooledCacheLanes|=s),i=d),a.memoizedState={parent:n,cache:i},Sc(a),zs(a,sa,i)):((t.lanes&s)!==0&&(Cc(t,a),Br(a,null,null,s),Hr()),i=t.memoizedState,d=a.memoizedState,i.parent!==n?(i={parent:n,cache:n},a.memoizedState=i,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=i),zs(a,sa,n)):(n=d.cache,zs(a,sa,n),n!==i.cache&&vc(a,[sa],s,!0))),pa(t,a,a.pendingProps.children,s),a.child;case 29:throw a.pendingProps}throw Error(c(156,a.tag))}function gs(t){t.flags|=4}function lo(t,a,s,n,i){if((a=(t.mode&32)!==0)&&(a=!1),a){if(t.flags|=16777216,(i&335544128)===i)if(t.stateNode.complete)t.flags|=8192;else if(ah())t.flags|=8192;else throw jn=Ll,Nc}else t.flags&=-16777217}function Mm(t,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!Yh(a))if(ah())t.flags|=8192;else throw jn=Ll,Nc}function ti(t,a){a!==null&&(t.flags|=4),t.flags&16384&&(a=t.tag!==22?we():536870912,t.lanes|=a,lr|=a)}function Pr(t,a){if(!gt)switch(t.tailMode){case"hidden":a=t.tail;for(var s=null;a!==null;)a.alternate!==null&&(s=a),a=a.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?a||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Bt(t){var a=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(a)for(var i=t.child;i!==null;)s|=i.lanes|i.childLanes,n|=i.subtreeFlags&65011712,n|=i.flags&65011712,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)s|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=n,t.childLanes=s,a}function Ng(t,a,s){var n=a.pendingProps;switch(fc(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bt(a),null;case 1:return Bt(a),null;case 3:return s=a.stateNode,n=null,t!==null&&(n=t.memoizedState.cache),a.memoizedState.cache!==n&&(a.flags|=2048),ms(sa),Ve(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(Qn(a)?gs(a):t===null||t.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,gc())),Bt(a),null;case 26:var i=a.type,d=a.memoizedState;return t===null?(gs(a),d!==null?(Bt(a),Mm(a,d)):(Bt(a),lo(a,i,null,n,s))):d?d!==t.memoizedState?(gs(a),Bt(a),Mm(a,d)):(Bt(a),a.flags&=-16777217):(t=t.memoizedProps,t!==n&&gs(a),Bt(a),lo(a,i,t,n,s)),null;case 27:if(nt(a),s=ze.current,i=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&gs(a);else{if(!n){if(a.stateNode===null)throw Error(c(166));return Bt(a),null}t=de.current,Qn(a)?ou(a):(t=Uh(i,n,s),a.stateNode=t,gs(a))}return Bt(a),null;case 5:if(nt(a),i=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&gs(a);else{if(!n){if(a.stateNode===null)throw Error(c(166));return Bt(a),null}if(d=de.current,Qn(a))ou(a);else{var h=gi(ze.current);switch(d){case 1:d=h.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:d=h.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":d=h.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":d=h.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":d=h.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof n.is=="string"?h.createElement("select",{is:n.is}):h.createElement("select"),n.multiple?d.multiple=!0:n.size&&(d.size=n.size);break;default:d=typeof n.is=="string"?h.createElement(i,{is:n.is}):h.createElement(i)}}d[Ae]=a,d[Te]=n;e:for(h=a.child;h!==null;){if(h.tag===5||h.tag===6)d.appendChild(h.stateNode);else if(h.tag!==4&&h.tag!==27&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break e;for(;h.sibling===null;){if(h.return===null||h.return===a)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}a.stateNode=d;e:switch(ga(d,i,n),i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&gs(a)}}return Bt(a),lo(a,a.type,t===null?null:t.memoizedProps,a.pendingProps,s),null;case 6:if(t&&a.stateNode!=null)t.memoizedProps!==n&&gs(a);else{if(typeof n!="string"&&a.stateNode===null)throw Error(c(166));if(t=ze.current,Qn(a)){if(t=a.stateNode,s=a.memoizedProps,n=null,i=ha,i!==null)switch(i.tag){case 27:case 5:n=i.memoizedProps}t[Ae]=a,t=!!(t.nodeValue===s||n!==null&&n.suppressHydrationWarning===!0||wh(t.nodeValue,s)),t||qs(a,!0)}else t=gi(t).createTextNode(n),t[Ae]=a,a.stateNode=t}return Bt(a),null;case 31:if(s=a.memoizedState,t===null||t.memoizedState!==null){if(n=Qn(a),s!==null){if(t===null){if(!n)throw Error(c(318));if(t=a.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(557));t[Ae]=a}else hn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Bt(a),t=!1}else s=gc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),t=!0;if(!t)return a.flags&256?(Ta(a),a):(Ta(a),null);if((a.flags&128)!==0)throw Error(c(558))}return Bt(a),null;case 13:if(n=a.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(i=Qn(a),n!==null&&n.dehydrated!==null){if(t===null){if(!i)throw Error(c(318));if(i=a.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(c(317));i[Ae]=a}else hn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Bt(a),i=!1}else i=gc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=i),i=!0;if(!i)return a.flags&256?(Ta(a),a):(Ta(a),null)}return Ta(a),(a.flags&128)!==0?(a.lanes=s,a):(s=n!==null,t=t!==null&&t.memoizedState!==null,s&&(n=a.child,i=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(i=n.alternate.memoizedState.cachePool.pool),d=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(d=n.memoizedState.cachePool.pool),d!==i&&(n.flags|=2048)),s!==t&&s&&(a.child.flags|=8192),ti(a,a.updateQueue),Bt(a),null);case 4:return Ve(),t===null&&Do(a.stateNode.containerInfo),Bt(a),null;case 10:return ms(a.type),Bt(a),null;case 19:if(X(Kt),n=a.memoizedState,n===null)return Bt(a),null;if(i=(a.flags&128)!==0,d=n.rendering,d===null)if(i)Pr(n,!1);else{if(It!==0||t!==null&&(t.flags&128)!==0)for(t=a.child;t!==null;){if(d=$l(t),d!==null){for(a.flags|=128,Pr(n,!1),t=d.updateQueue,a.updateQueue=t,ti(a,t),a.subtreeFlags=0,t=s,s=a.child;s!==null;)nu(s,t),s=s.sibling;return C(Kt,Kt.current&1|2),gt&&ds(a,n.treeForkCount),a.child}t=t.sibling}n.tail!==null&&Je()>li&&(a.flags|=128,i=!0,Pr(n,!1),a.lanes=4194304)}else{if(!i)if(t=$l(d),t!==null){if(a.flags|=128,i=!0,t=t.updateQueue,a.updateQueue=t,ti(a,t),Pr(n,!0),n.tail===null&&n.tailMode==="hidden"&&!d.alternate&&!gt)return Bt(a),null}else 2*Je()-n.renderingStartTime>li&&s!==536870912&&(a.flags|=128,i=!0,Pr(n,!1),a.lanes=4194304);n.isBackwards?(d.sibling=a.child,a.child=d):(t=n.last,t!==null?t.sibling=d:a.child=d,n.last=d)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=Je(),t.sibling=null,s=Kt.current,C(Kt,i?s&1|2:s&1),gt&&ds(a,n.treeForkCount),t):(Bt(a),null);case 22:case 23:return Ta(a),Dc(),n=a.memoizedState!==null,t!==null?t.memoizedState!==null!==n&&(a.flags|=8192):n&&(a.flags|=8192),n?(s&536870912)!==0&&(a.flags&128)===0&&(Bt(a),a.subtreeFlags&6&&(a.flags|=8192)):Bt(a),s=a.updateQueue,s!==null&&ti(a,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),n=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(n=a.memoizedState.cachePool.pool),n!==s&&(a.flags|=2048),t!==null&&X(gn),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),a.memoizedState.cache!==s&&(a.flags|=2048),ms(sa),Bt(a),null;case 25:return null;case 30:return null}throw Error(c(156,a.tag))}function Sg(t,a){switch(fc(a),a.tag){case 1:return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 3:return ms(sa),Ve(),t=a.flags,(t&65536)!==0&&(t&128)===0?(a.flags=t&-65537|128,a):null;case 26:case 27:case 5:return nt(a),null;case 31:if(a.memoizedState!==null){if(Ta(a),a.alternate===null)throw Error(c(340));hn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 13:if(Ta(a),t=a.memoizedState,t!==null&&t.dehydrated!==null){if(a.alternate===null)throw Error(c(340));hn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 19:return X(Kt),null;case 4:return Ve(),null;case 10:return ms(a.type),null;case 22:case 23:return Ta(a),Dc(),t!==null&&X(gn),t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 24:return ms(sa),null;case 25:return null;default:return null}}function Am(t,a){switch(fc(a),a.tag){case 3:ms(sa),Ve();break;case 26:case 27:case 5:nt(a);break;case 4:Ve();break;case 31:a.memoizedState!==null&&Ta(a);break;case 13:Ta(a);break;case 19:X(Kt);break;case 10:ms(a.type);break;case 22:case 23:Ta(a),Dc(),t!==null&&X(gn);break;case 24:ms(sa)}}function Qr(t,a){try{var s=a.updateQueue,n=s!==null?s.lastEffect:null;if(n!==null){var i=n.next;s=i;do{if((s.tag&t)===t){n=void 0;var d=s.create,h=s.inst;n=d(),h.destroy=n}s=s.next}while(s!==i)}}catch(b){Et(a,a.return,b)}}function Fs(t,a,s){try{var n=a.updateQueue,i=n!==null?n.lastEffect:null;if(i!==null){var d=i.next;n=d;do{if((n.tag&t)===t){var h=n.inst,b=h.destroy;if(b!==void 0){h.destroy=void 0,i=a;var O=s,ce=b;try{ce()}catch(pe){Et(i,O,pe)}}}n=n.next}while(n!==d)}}catch(pe){Et(a,a.return,pe)}}function Tm(t){var a=t.updateQueue;if(a!==null){var s=t.stateNode;try{_u(a,s)}catch(n){Et(t,t.return,n)}}}function Rm(t,a,s){s.props=bn(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(n){Et(t,a,n)}}function Xr(t,a){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var n=t.stateNode;break;case 30:n=t.stateNode;break;default:n=t.stateNode}typeof s=="function"?t.refCleanup=s(n):s.current=n}}catch(i){Et(t,a,i)}}function as(t,a){var s=t.ref,n=t.refCleanup;if(s!==null)if(typeof n=="function")try{n()}catch(i){Et(t,a,i)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(i){Et(t,a,i)}else s.current=null}function qm(t){var a=t.type,s=t.memoizedProps,n=t.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break e;case"img":s.src?n.src=s.src:s.srcSet&&(n.srcset=s.srcSet)}}catch(i){Et(t,t.return,i)}}function io(t,a,s){try{var n=t.stateNode;Pg(n,t.type,s,a),n[Te]=a}catch(i){Et(t,t.return,i)}}function zm(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Xs(t.type)||t.tag===4}function co(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||zm(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Xs(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function oo(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,a):(a=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,a.appendChild(t),s=s._reactRootContainer,s!=null||a.onclick!==null||(a.onclick=is));else if(n!==4&&(n===27&&Xs(t.type)&&(s=t.stateNode,a=null),t=t.child,t!==null))for(oo(t,a,s),t=t.sibling;t!==null;)oo(t,a,s),t=t.sibling}function ai(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?s.insertBefore(t,a):s.appendChild(t);else if(n!==4&&(n===27&&Xs(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(ai(t,a,s),t=t.sibling;t!==null;)ai(t,a,s),t=t.sibling}function Om(t){var a=t.stateNode,s=t.memoizedProps;try{for(var n=t.type,i=a.attributes;i.length;)a.removeAttributeNode(i[0]);ga(a,n,s),a[Ae]=t,a[Te]=s}catch(d){Et(t,t.return,d)}}var xs=!1,la=!1,uo=!1,Um=typeof WeakSet=="function"?WeakSet:Set,da=null;function Cg(t,a){if(t=t.containerInfo,To=Ni,t=Id(t),sc(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var i=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var h=0,b=-1,O=-1,ce=0,pe=0,je=t,oe=null;t:for(;;){for(var me;je!==s||i!==0&&je.nodeType!==3||(b=h+i),je!==d||n!==0&&je.nodeType!==3||(O=h+n),je.nodeType===3&&(h+=je.nodeValue.length),(me=je.firstChild)!==null;)oe=je,je=me;for(;;){if(je===t)break t;if(oe===s&&++ce===i&&(b=h),oe===d&&++pe===n&&(O=h),(me=je.nextSibling)!==null)break;je=oe,oe=je.parentNode}je=me}s=b===-1||O===-1?null:{start:b,end:O}}else s=null}s=s||{start:0,end:0}}else s=null;for(Ro={focusedElem:t,selectionRange:s},Ni=!1,da=a;da!==null;)if(a=da,t=a.child,(a.subtreeFlags&1028)!==0&&t!==null)t.return=a,da=t;else for(;da!==null;){switch(a=da,d=a.alternate,t=a.flags,a.tag){case 0:if((t&4)!==0&&(t=a.updateQueue,t=t!==null?t.events:null,t!==null))for(s=0;s<t.length;s++)i=t[s],i.ref.impl=i.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&d!==null){t=void 0,s=a,i=d.memoizedProps,d=d.memoizedState,n=s.stateNode;try{var Be=bn(s.type,i);t=n.getSnapshotBeforeUpdate(Be,d),n.__reactInternalSnapshotBeforeUpdate=t}catch(et){Et(s,s.return,et)}}break;case 3:if((t&1024)!==0){if(t=a.stateNode.containerInfo,s=t.nodeType,s===9)Oo(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Oo(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(c(163))}if(t=a.sibling,t!==null){t.return=a.return,da=t;break}da=a.return}}function Lm(t,a,s){var n=s.flags;switch(s.tag){case 0:case 11:case 15:vs(t,s),n&4&&Qr(5,s);break;case 1:if(vs(t,s),n&4)if(t=s.stateNode,a===null)try{t.componentDidMount()}catch(h){Et(s,s.return,h)}else{var i=bn(s.type,a.memoizedProps);a=a.memoizedState;try{t.componentDidUpdate(i,a,t.__reactInternalSnapshotBeforeUpdate)}catch(h){Et(s,s.return,h)}}n&64&&Tm(s),n&512&&Xr(s,s.return);break;case 3:if(vs(t,s),n&64&&(t=s.updateQueue,t!==null)){if(a=null,s.child!==null)switch(s.child.tag){case 27:case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}try{_u(t,a)}catch(h){Et(s,s.return,h)}}break;case 27:a===null&&n&4&&Om(s);case 26:case 5:vs(t,s),a===null&&n&4&&qm(s),n&512&&Xr(s,s.return);break;case 12:vs(t,s);break;case 31:vs(t,s),n&4&&Fm(t,s);break;case 13:vs(t,s),n&4&&$m(t,s),n&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=qg.bind(null,s),ex(t,s))));break;case 22:if(n=s.memoizedState!==null||xs,!n){a=a!==null&&a.memoizedState!==null||la,i=xs;var d=la;xs=n,(la=a)&&!d?ys(t,s,(s.subtreeFlags&8772)!==0):vs(t,s),xs=i,la=d}break;case 30:break;default:vs(t,s)}}function Hm(t){var a=t.alternate;a!==null&&(t.alternate=null,Hm(a)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(a=t.stateNode,a!==null&&Jt(a)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Gt=null,Sa=!1;function js(t,a,s){for(s=s.child;s!==null;)Bm(t,a,s),s=s.sibling}function Bm(t,a,s){if(Se&&typeof Se.onCommitFiberUnmount=="function")try{Se.onCommitFiberUnmount(Me,s)}catch{}switch(s.tag){case 26:la||as(s,a),js(t,a,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:la||as(s,a);var n=Gt,i=Sa;Xs(s.type)&&(Gt=s.stateNode,Sa=!1),js(t,a,s),sl(s.stateNode),Gt=n,Sa=i;break;case 5:la||as(s,a);case 6:if(n=Gt,i=Sa,Gt=null,js(t,a,s),Gt=n,Sa=i,Gt!==null)if(Sa)try{(Gt.nodeType===9?Gt.body:Gt.nodeName==="HTML"?Gt.ownerDocument.body:Gt).removeChild(s.stateNode)}catch(d){Et(s,a,d)}else try{Gt.removeChild(s.stateNode)}catch(d){Et(s,a,d)}break;case 18:Gt!==null&&(Sa?(t=Gt,Th(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),fr(t)):Th(Gt,s.stateNode));break;case 4:n=Gt,i=Sa,Gt=s.stateNode.containerInfo,Sa=!0,js(t,a,s),Gt=n,Sa=i;break;case 0:case 11:case 14:case 15:Fs(2,s,a),la||Fs(4,s,a),js(t,a,s);break;case 1:la||(as(s,a),n=s.stateNode,typeof n.componentWillUnmount=="function"&&Rm(s,a,n)),js(t,a,s);break;case 21:js(t,a,s);break;case 22:la=(n=la)||s.memoizedState!==null,js(t,a,s),la=n;break;default:js(t,a,s)}}function Fm(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{fr(t)}catch(s){Et(a,a.return,s)}}}function $m(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{fr(t)}catch(s){Et(a,a.return,s)}}function wg(t){switch(t.tag){case 31:case 13:case 19:var a=t.stateNode;return a===null&&(a=t.stateNode=new Um),a;case 22:return t=t.stateNode,a=t._retryCache,a===null&&(a=t._retryCache=new Um),a;default:throw Error(c(435,t.tag))}}function si(t,a){var s=wg(t);a.forEach(function(n){if(!s.has(n)){s.add(n);var i=zg.bind(null,t,n);n.then(i,i)}})}function Ca(t,a){var s=a.deletions;if(s!==null)for(var n=0;n<s.length;n++){var i=s[n],d=t,h=a,b=h;e:for(;b!==null;){switch(b.tag){case 27:if(Xs(b.type)){Gt=b.stateNode,Sa=!1;break e}break;case 5:Gt=b.stateNode,Sa=!1;break e;case 3:case 4:Gt=b.stateNode.containerInfo,Sa=!0;break e}b=b.return}if(Gt===null)throw Error(c(160));Bm(d,h,i),Gt=null,Sa=!1,d=i.alternate,d!==null&&(d.return=null),i.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Vm(a,t),a=a.sibling}var Za=null;function Vm(t,a){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Ca(a,t),wa(t),n&4&&(Fs(3,t,t.return),Qr(3,t),Fs(5,t,t.return));break;case 1:Ca(a,t),wa(t),n&512&&(la||s===null||as(s,s.return)),n&64&&xs&&(t=t.updateQueue,t!==null&&(n=t.callbacks,n!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?n:s.concat(n))));break;case 26:var i=Za;if(Ca(a,t),wa(t),n&512&&(la||s===null||as(s,s.return)),n&4){var d=s!==null?s.memoizedState:null;if(n=t.memoizedState,s===null)if(n===null)if(t.stateNode===null){e:{n=t.type,s=t.memoizedProps,i=i.ownerDocument||i;t:switch(n){case"title":d=i.getElementsByTagName("title")[0],(!d||d[Vt]||d[Ae]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=i.createElement(n),i.head.insertBefore(d,i.querySelector("head > title"))),ga(d,n,s),d[Ae]=t,wt(d),n=d;break e;case"link":var h=Vh("link","href",i).get(n+(s.href||""));if(h){for(var b=0;b<h.length;b++)if(d=h[b],d.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&d.getAttribute("rel")===(s.rel==null?null:s.rel)&&d.getAttribute("title")===(s.title==null?null:s.title)&&d.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){h.splice(b,1);break t}}d=i.createElement(n),ga(d,n,s),i.head.appendChild(d);break;case"meta":if(h=Vh("meta","content",i).get(n+(s.content||""))){for(b=0;b<h.length;b++)if(d=h[b],d.getAttribute("content")===(s.content==null?null:""+s.content)&&d.getAttribute("name")===(s.name==null?null:s.name)&&d.getAttribute("property")===(s.property==null?null:s.property)&&d.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&d.getAttribute("charset")===(s.charSet==null?null:s.charSet)){h.splice(b,1);break t}}d=i.createElement(n),ga(d,n,s),i.head.appendChild(d);break;default:throw Error(c(468,n))}d[Ae]=t,wt(d),n=d}t.stateNode=n}else Gh(i,t.type,t.stateNode);else t.stateNode=$h(i,n,t.memoizedProps);else d!==n?(d===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):d.count--,n===null?Gh(i,t.type,t.stateNode):$h(i,n,t.memoizedProps)):n===null&&t.stateNode!==null&&io(t,t.memoizedProps,s.memoizedProps)}break;case 27:Ca(a,t),wa(t),n&512&&(la||s===null||as(s,s.return)),s!==null&&n&4&&io(t,t.memoizedProps,s.memoizedProps);break;case 5:if(Ca(a,t),wa(t),n&512&&(la||s===null||as(s,s.return)),t.flags&32){i=t.stateNode;try{Un(i,"")}catch(Be){Et(t,t.return,Be)}}n&4&&t.stateNode!=null&&(i=t.memoizedProps,io(t,i,s!==null?s.memoizedProps:i)),n&1024&&(uo=!0);break;case 6:if(Ca(a,t),wa(t),n&4){if(t.stateNode===null)throw Error(c(162));n=t.memoizedProps,s=t.stateNode;try{s.nodeValue=n}catch(Be){Et(t,t.return,Be)}}break;case 3:if(vi=null,i=Za,Za=xi(a.containerInfo),Ca(a,t),Za=i,wa(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{fr(a.containerInfo)}catch(Be){Et(t,t.return,Be)}uo&&(uo=!1,Gm(t));break;case 4:n=Za,Za=xi(t.stateNode.containerInfo),Ca(a,t),wa(t),Za=n;break;case 12:Ca(a,t),wa(t);break;case 31:Ca(a,t),wa(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,si(t,n)));break;case 13:Ca(a,t),wa(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(ri=Je()),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,si(t,n)));break;case 22:i=t.memoizedState!==null;var O=s!==null&&s.memoizedState!==null,ce=xs,pe=la;if(xs=ce||i,la=pe||O,Ca(a,t),la=pe,xs=ce,wa(t),n&8192)e:for(a=t.stateNode,a._visibility=i?a._visibility&-2:a._visibility|1,i&&(s===null||O||xs||la||_n(t)),s=null,a=t;;){if(a.tag===5||a.tag===26){if(s===null){O=s=a;try{if(d=O.stateNode,i)h=d.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none";else{b=O.stateNode;var je=O.memoizedProps.style,oe=je!=null&&je.hasOwnProperty("display")?je.display:null;b.style.display=oe==null||typeof oe=="boolean"?"":(""+oe).trim()}}catch(Be){Et(O,O.return,Be)}}}else if(a.tag===6){if(s===null){O=a;try{O.stateNode.nodeValue=i?"":O.memoizedProps}catch(Be){Et(O,O.return,Be)}}}else if(a.tag===18){if(s===null){O=a;try{var me=O.stateNode;i?Rh(me,!0):Rh(O.stateNode,!1)}catch(Be){Et(O,O.return,Be)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===t)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break e;for(;a.sibling===null;){if(a.return===null||a.return===t)break e;s===a&&(s=null),a=a.return}s===a&&(s=null),a.sibling.return=a.return,a=a.sibling}n&4&&(n=t.updateQueue,n!==null&&(s=n.retryQueue,s!==null&&(n.retryQueue=null,si(t,s))));break;case 19:Ca(a,t),wa(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,si(t,n)));break;case 30:break;case 21:break;default:Ca(a,t),wa(t)}}function wa(t){var a=t.flags;if(a&2){try{for(var s,n=t.return;n!==null;){if(zm(n)){s=n;break}n=n.return}if(s==null)throw Error(c(160));switch(s.tag){case 27:var i=s.stateNode,d=co(t);ai(t,d,i);break;case 5:var h=s.stateNode;s.flags&32&&(Un(h,""),s.flags&=-33);var b=co(t);ai(t,b,h);break;case 3:case 4:var O=s.stateNode.containerInfo,ce=co(t);oo(t,ce,O);break;default:throw Error(c(161))}}catch(pe){Et(t,t.return,pe)}t.flags&=-3}a&4096&&(t.flags&=-4097)}function Gm(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var a=t;Gm(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),t=t.sibling}}function vs(t,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Lm(t,a.alternate,a),a=a.sibling}function _n(t){for(t=t.child;t!==null;){var a=t;switch(a.tag){case 0:case 11:case 14:case 15:Fs(4,a,a.return),_n(a);break;case 1:as(a,a.return);var s=a.stateNode;typeof s.componentWillUnmount=="function"&&Rm(a,a.return,s),_n(a);break;case 27:sl(a.stateNode);case 26:case 5:as(a,a.return),_n(a);break;case 22:a.memoizedState===null&&_n(a);break;case 30:_n(a);break;default:_n(a)}t=t.sibling}}function ys(t,a,s){for(s=s&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var n=a.alternate,i=t,d=a,h=d.flags;switch(d.tag){case 0:case 11:case 15:ys(i,d,s),Qr(4,d);break;case 1:if(ys(i,d,s),n=d,i=n.stateNode,typeof i.componentDidMount=="function")try{i.componentDidMount()}catch(ce){Et(n,n.return,ce)}if(n=d,i=n.updateQueue,i!==null){var b=n.stateNode;try{var O=i.shared.hiddenCallbacks;if(O!==null)for(i.shared.hiddenCallbacks=null,i=0;i<O.length;i++)bu(O[i],b)}catch(ce){Et(n,n.return,ce)}}s&&h&64&&Tm(d),Xr(d,d.return);break;case 27:Om(d);case 26:case 5:ys(i,d,s),s&&n===null&&h&4&&qm(d),Xr(d,d.return);break;case 12:ys(i,d,s);break;case 31:ys(i,d,s),s&&h&4&&Fm(i,d);break;case 13:ys(i,d,s),s&&h&4&&$m(i,d);break;case 22:d.memoizedState===null&&ys(i,d,s),Xr(d,d.return);break;case 30:break;default:ys(i,d,s)}a=a.sibling}}function mo(t,a){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(t=a.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&qr(s))}function ho(t,a){t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&qr(t))}function Ja(t,a,s,n){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Ym(t,a,s,n),a=a.sibling}function Ym(t,a,s,n){var i=a.flags;switch(a.tag){case 0:case 11:case 15:Ja(t,a,s,n),i&2048&&Qr(9,a);break;case 1:Ja(t,a,s,n);break;case 3:Ja(t,a,s,n),i&2048&&(t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&qr(t)));break;case 12:if(i&2048){Ja(t,a,s,n),t=a.stateNode;try{var d=a.memoizedProps,h=d.id,b=d.onPostCommit;typeof b=="function"&&b(h,a.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(O){Et(a,a.return,O)}}else Ja(t,a,s,n);break;case 31:Ja(t,a,s,n);break;case 13:Ja(t,a,s,n);break;case 23:break;case 22:d=a.stateNode,h=a.alternate,a.memoizedState!==null?d._visibility&2?Ja(t,a,s,n):Ir(t,a):d._visibility&2?Ja(t,a,s,n):(d._visibility|=2,sr(t,a,s,n,(a.subtreeFlags&10256)!==0||!1)),i&2048&&mo(h,a);break;case 24:Ja(t,a,s,n),i&2048&&ho(a.alternate,a);break;default:Ja(t,a,s,n)}}function sr(t,a,s,n,i){for(i=i&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var d=t,h=a,b=s,O=n,ce=h.flags;switch(h.tag){case 0:case 11:case 15:sr(d,h,b,O,i),Qr(8,h);break;case 23:break;case 22:var pe=h.stateNode;h.memoizedState!==null?pe._visibility&2?sr(d,h,b,O,i):Ir(d,h):(pe._visibility|=2,sr(d,h,b,O,i)),i&&ce&2048&&mo(h.alternate,h);break;case 24:sr(d,h,b,O,i),i&&ce&2048&&ho(h.alternate,h);break;default:sr(d,h,b,O,i)}a=a.sibling}}function Ir(t,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var s=t,n=a,i=n.flags;switch(n.tag){case 22:Ir(s,n),i&2048&&mo(n.alternate,n);break;case 24:Ir(s,n),i&2048&&ho(n.alternate,n);break;default:Ir(s,n)}a=a.sibling}}var Zr=8192;function nr(t,a,s){if(t.subtreeFlags&Zr)for(t=t.child;t!==null;)Pm(t,a,s),t=t.sibling}function Pm(t,a,s){switch(t.tag){case 26:nr(t,a,s),t.flags&Zr&&t.memoizedState!==null&&mx(s,Za,t.memoizedState,t.memoizedProps);break;case 5:nr(t,a,s);break;case 3:case 4:var n=Za;Za=xi(t.stateNode.containerInfo),nr(t,a,s),Za=n;break;case 22:t.memoizedState===null&&(n=t.alternate,n!==null&&n.memoizedState!==null?(n=Zr,Zr=16777216,nr(t,a,s),Zr=n):nr(t,a,s));break;default:nr(t,a,s)}}function Qm(t){var a=t.alternate;if(a!==null&&(t=a.child,t!==null)){a.child=null;do a=t.sibling,t.sibling=null,t=a;while(t!==null)}}function Jr(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];da=n,Im(n,t)}Qm(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Xm(t),t=t.sibling}function Xm(t){switch(t.tag){case 0:case 11:case 15:Jr(t),t.flags&2048&&Fs(9,t,t.return);break;case 3:Jr(t);break;case 12:Jr(t);break;case 22:var a=t.stateNode;t.memoizedState!==null&&a._visibility&2&&(t.return===null||t.return.tag!==13)?(a._visibility&=-3,ni(t)):Jr(t);break;default:Jr(t)}}function ni(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];da=n,Im(n,t)}Qm(t)}for(t=t.child;t!==null;){switch(a=t,a.tag){case 0:case 11:case 15:Fs(8,a,a.return),ni(a);break;case 22:s=a.stateNode,s._visibility&2&&(s._visibility&=-3,ni(a));break;default:ni(a)}t=t.sibling}}function Im(t,a){for(;da!==null;){var s=da;switch(s.tag){case 0:case 11:case 15:Fs(8,s,a);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var n=s.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:qr(s.memoizedState.cache)}if(n=s.child,n!==null)n.return=s,da=n;else e:for(s=t;da!==null;){n=da;var i=n.sibling,d=n.return;if(Hm(n),n===s){da=null;break e}if(i!==null){i.return=d,da=i;break e}da=d}}}var kg={getCacheForType:function(t){var a=fa(sa),s=a.data.get(t);return s===void 0&&(s=t(),a.data.set(t,s)),s},cacheSignal:function(){return fa(sa).controller.signal}},Eg=typeof WeakMap=="function"?WeakMap:Map,Nt=0,qt=null,ut=null,ht=0,kt=0,Ra=null,$s=!1,rr=!1,fo=!1,bs=0,It=0,Vs=0,Nn=0,po=0,qa=0,lr=0,Kr=null,ka=null,go=!1,ri=0,Zm=0,li=1/0,ii=null,Gs=null,ca=0,Ys=null,ir=null,_s=0,xo=0,jo=null,Jm=null,Wr=0,vo=null;function za(){return(Nt&2)!==0&&ht!==0?ht&-ht:D.T!==null?Co():ie()}function Km(){if(qa===0)if((ht&536870912)===0||gt){var t=jt;jt<<=1,(jt&3932160)===0&&(jt=262144),qa=t}else qa=536870912;return t=Aa.current,t!==null&&(t.flags|=32),qa}function Ea(t,a,s){(t===qt&&(kt===2||kt===9)||t.cancelPendingCommit!==null)&&(cr(t,0),Ps(t,ht,qa,!1)),dt(t,s),((Nt&2)===0||t!==qt)&&(t===qt&&((Nt&2)===0&&(Nn|=s),It===4&&Ps(t,ht,qa,!1)),ss(t))}function Wm(t,a,s){if((Nt&6)!==0)throw Error(c(327));var n=!s&&(a&127)===0&&(a&t.expiredLanes)===0||aa(t,a),i=n?Ag(t,a):bo(t,a,!0),d=n;do{if(i===0){rr&&!n&&Ps(t,a,0,!1);break}else{if(s=t.current.alternate,d&&!Dg(s)){i=bo(t,a,!1),d=!1;continue}if(i===2){if(d=a,t.errorRecoveryDisabledLanes&d)var h=0;else h=t.pendingLanes&-536870913,h=h!==0?h:h&536870912?536870912:0;if(h!==0){a=h;e:{var b=t;i=Kr;var O=b.current.memoizedState.isDehydrated;if(O&&(cr(b,h).flags|=256),h=bo(b,h,!1),h!==2){if(fo&&!O){b.errorRecoveryDisabledLanes|=d,Nn|=d,i=4;break e}d=ka,ka=i,d!==null&&(ka===null?ka=d:ka.push.apply(ka,d))}i=h}if(d=!1,i!==2)continue}}if(i===1){cr(t,0),Ps(t,a,0,!0);break}e:{switch(n=t,d=i,d){case 0:case 1:throw Error(c(345));case 4:if((a&4194048)!==a)break;case 6:Ps(n,a,qa,!$s);break e;case 2:ka=null;break;case 3:case 5:break;default:throw Error(c(329))}if((a&62914560)===a&&(i=ri+300-Je(),10<i)){if(Ps(n,a,qa,!$s),ta(n,0,!0)!==0)break e;_s=a,n.timeoutHandle=Mh(eh.bind(null,n,s,ka,ii,go,a,qa,Nn,lr,$s,d,"Throttled",-0,0),i);break e}eh(n,s,ka,ii,go,a,qa,Nn,lr,$s,d,null,-0,0)}}break}while(!0);ss(t)}function eh(t,a,s,n,i,d,h,b,O,ce,pe,je,oe,me){if(t.timeoutHandle=-1,je=a.subtreeFlags,je&8192||(je&16785408)===16785408){je={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:is},Pm(a,d,je);var Be=(d&62914560)===d?ri-Je():(d&4194048)===d?Zm-Je():0;if(Be=hx(je,Be),Be!==null){_s=d,t.cancelPendingCommit=Be(ch.bind(null,t,a,d,s,n,i,h,b,O,pe,je,null,oe,me)),Ps(t,d,h,!ce);return}}ch(t,a,d,s,n,i,h,b,O)}function Dg(t){for(var a=t;;){var s=a.tag;if((s===0||s===11||s===15)&&a.flags&16384&&(s=a.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var n=0;n<s.length;n++){var i=s[n],d=i.getSnapshot;i=i.value;try{if(!Da(d(),i))return!1}catch{return!1}}if(s=a.child,a.subtreeFlags&16384&&s!==null)s.return=a,a=s;else{if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Ps(t,a,s,n){a&=~po,a&=~Nn,t.suspendedLanes|=a,t.pingedLanes&=~a,n&&(t.warmLanes|=a),n=t.expirationTimes;for(var i=a;0<i;){var d=31-De(i),h=1<<d;n[d]=-1,i&=~h}s!==0&&Ce(t,s,a)}function ci(){return(Nt&6)===0?(el(0),!1):!0}function yo(){if(ut!==null){if(kt===0)var t=ut.return;else t=ut,us=fn=null,zc(t),Kn=null,Or=0,t=ut;for(;t!==null;)Am(t.alternate,t),t=t.return;ut=null}}function cr(t,a){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,Ig(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),_s=0,yo(),qt=t,ut=s=os(t.current,null),ht=a,kt=0,Ra=null,$s=!1,rr=aa(t,a),fo=!1,lr=qa=po=Nn=Vs=It=0,ka=Kr=null,go=!1,(a&8)!==0&&(a|=a&32);var n=t.entangledLanes;if(n!==0)for(t=t.entanglements,n&=a;0<n;){var i=31-De(n),d=1<<i;a|=t[i],n&=~d}return bs=a,Dl(),s}function th(t,a){lt=null,D.H=Gr,a===Jn||a===Ul?(a=xu(),kt=3):a===Nc?(a=xu(),kt=4):kt=a===Jc?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Ra=a,ut===null&&(It=1,Jl(t,Fa(a,t.current)))}function ah(){var t=Aa.current;return t===null?!0:(ht&4194048)===ht?Ya===null:(ht&62914560)===ht||(ht&536870912)!==0?t===Ya:!1}function sh(){var t=D.H;return D.H=Gr,t===null?Gr:t}function nh(){var t=D.A;return D.A=kg,t}function oi(){It=4,$s||(ht&4194048)!==ht&&Aa.current!==null||(rr=!0),(Vs&134217727)===0&&(Nn&134217727)===0||qt===null||Ps(qt,ht,qa,!1)}function bo(t,a,s){var n=Nt;Nt|=2;var i=sh(),d=nh();(qt!==t||ht!==a)&&(ii=null,cr(t,a)),a=!1;var h=It;e:do try{if(kt!==0&&ut!==null){var b=ut,O=Ra;switch(kt){case 8:yo(),h=6;break e;case 3:case 2:case 9:case 6:Aa.current===null&&(a=!0);var ce=kt;if(kt=0,Ra=null,or(t,b,O,ce),s&&rr){h=0;break e}break;default:ce=kt,kt=0,Ra=null,or(t,b,O,ce)}}Mg(),h=It;break}catch(pe){th(t,pe)}while(!0);return a&&t.shellSuspendCounter++,us=fn=null,Nt=n,D.H=i,D.A=d,ut===null&&(qt=null,ht=0,Dl()),h}function Mg(){for(;ut!==null;)rh(ut)}function Ag(t,a){var s=Nt;Nt|=2;var n=sh(),i=nh();qt!==t||ht!==a?(ii=null,li=Je()+500,cr(t,a)):rr=aa(t,a);e:do try{if(kt!==0&&ut!==null){a=ut;var d=Ra;t:switch(kt){case 1:kt=0,Ra=null,or(t,a,d,1);break;case 2:case 9:if(pu(d)){kt=0,Ra=null,lh(a);break}a=function(){kt!==2&&kt!==9||qt!==t||(kt=7),ss(t)},d.then(a,a);break e;case 3:kt=7;break e;case 4:kt=5;break e;case 7:pu(d)?(kt=0,Ra=null,lh(a)):(kt=0,Ra=null,or(t,a,d,7));break;case 5:var h=null;switch(ut.tag){case 26:h=ut.memoizedState;case 5:case 27:var b=ut;if(h?Yh(h):b.stateNode.complete){kt=0,Ra=null;var O=b.sibling;if(O!==null)ut=O;else{var ce=b.return;ce!==null?(ut=ce,di(ce)):ut=null}break t}}kt=0,Ra=null,or(t,a,d,5);break;case 6:kt=0,Ra=null,or(t,a,d,6);break;case 8:yo(),It=6;break e;default:throw Error(c(462))}}Tg();break}catch(pe){th(t,pe)}while(!0);return us=fn=null,D.H=n,D.A=i,Nt=s,ut!==null?0:(qt=null,ht=0,Dl(),It)}function Tg(){for(;ut!==null&&!ge();)rh(ut)}function rh(t){var a=Dm(t.alternate,t,bs);t.memoizedProps=t.pendingProps,a===null?di(t):ut=a}function lh(t){var a=t,s=a.alternate;switch(a.tag){case 15:case 0:a=Nm(s,a,a.pendingProps,a.type,void 0,ht);break;case 11:a=Nm(s,a,a.pendingProps,a.type.render,a.ref,ht);break;case 5:zc(a);default:Am(s,a),a=ut=nu(a,bs),a=Dm(s,a,bs)}t.memoizedProps=t.pendingProps,a===null?di(t):ut=a}function or(t,a,s,n){us=fn=null,zc(a),Kn=null,Or=0;var i=a.return;try{if(yg(t,i,a,s,ht)){It=1,Jl(t,Fa(s,t.current)),ut=null;return}}catch(d){if(i!==null)throw ut=i,d;It=1,Jl(t,Fa(s,t.current)),ut=null;return}a.flags&32768?(gt||n===1?t=!0:rr||(ht&536870912)!==0?t=!1:($s=t=!0,(n===2||n===9||n===3||n===6)&&(n=Aa.current,n!==null&&n.tag===13&&(n.flags|=16384))),ih(a,t)):di(a)}function di(t){var a=t;do{if((a.flags&32768)!==0){ih(a,$s);return}t=a.return;var s=Ng(a.alternate,a,bs);if(s!==null){ut=s;return}if(a=a.sibling,a!==null){ut=a;return}ut=a=t}while(a!==null);It===0&&(It=5)}function ih(t,a){do{var s=Sg(t.alternate,t);if(s!==null){s.flags&=32767,ut=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!a&&(t=t.sibling,t!==null)){ut=t;return}ut=t=s}while(t!==null);It=6,ut=null}function ch(t,a,s,n,i,d,h,b,O){t.cancelPendingCommit=null;do ui();while(ca!==0);if((Nt&6)!==0)throw Error(c(327));if(a!==null){if(a===t.current)throw Error(c(177));if(d=a.lanes|a.childLanes,d|=cc,ja(t,s,d,h,b,O),t===qt&&(ut=qt=null,ht=0),ir=a,Ys=t,_s=s,xo=d,jo=i,Jm=n,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,Og(ia,function(){return hh(),null})):(t.callbackNode=null,t.callbackPriority=0),n=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||n){n=D.T,D.T=null,i=V.p,V.p=2,h=Nt,Nt|=4;try{Cg(t,a,s)}finally{Nt=h,V.p=i,D.T=n}}ca=1,oh(),dh(),uh()}}function oh(){if(ca===1){ca=0;var t=Ys,a=ir,s=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||s){s=D.T,D.T=null;var n=V.p;V.p=2;var i=Nt;Nt|=4;try{Vm(a,t);var d=Ro,h=Id(t.containerInfo),b=d.focusedElem,O=d.selectionRange;if(h!==b&&b&&b.ownerDocument&&Xd(b.ownerDocument.documentElement,b)){if(O!==null&&sc(b)){var ce=O.start,pe=O.end;if(pe===void 0&&(pe=ce),"selectionStart"in b)b.selectionStart=ce,b.selectionEnd=Math.min(pe,b.value.length);else{var je=b.ownerDocument||document,oe=je&&je.defaultView||window;if(oe.getSelection){var me=oe.getSelection(),Be=b.textContent.length,et=Math.min(O.start,Be),Tt=O.end===void 0?et:Math.min(O.end,Be);!me.extend&&et>Tt&&(h=Tt,Tt=et,et=h);var te=Qd(b,et),P=Qd(b,Tt);if(te&&P&&(me.rangeCount!==1||me.anchorNode!==te.node||me.anchorOffset!==te.offset||me.focusNode!==P.node||me.focusOffset!==P.offset)){var le=je.createRange();le.setStart(te.node,te.offset),me.removeAllRanges(),et>Tt?(me.addRange(le),me.extend(P.node,P.offset)):(le.setEnd(P.node,P.offset),me.addRange(le))}}}}for(je=[],me=b;me=me.parentNode;)me.nodeType===1&&je.push({element:me,left:me.scrollLeft,top:me.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<je.length;b++){var xe=je[b];xe.element.scrollLeft=xe.left,xe.element.scrollTop=xe.top}}Ni=!!To,Ro=To=null}finally{Nt=i,V.p=n,D.T=s}}t.current=a,ca=2}}function dh(){if(ca===2){ca=0;var t=Ys,a=ir,s=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||s){s=D.T,D.T=null;var n=V.p;V.p=2;var i=Nt;Nt|=4;try{Lm(t,a.alternate,a)}finally{Nt=i,V.p=n,D.T=s}}ca=3}}function uh(){if(ca===4||ca===3){ca=0,Le();var t=Ys,a=ir,s=_s,n=Jm;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?ca=5:(ca=0,ir=Ys=null,mh(t,t.pendingLanes));var i=t.pendingLanes;if(i===0&&(Gs=null),E(s),a=a.stateNode,Se&&typeof Se.onCommitFiberRoot=="function")try{Se.onCommitFiberRoot(Me,a,void 0,(a.current.flags&128)===128)}catch{}if(n!==null){a=D.T,i=V.p,V.p=2,D.T=null;try{for(var d=t.onRecoverableError,h=0;h<n.length;h++){var b=n[h];d(b.value,{componentStack:b.stack})}}finally{D.T=a,V.p=i}}(_s&3)!==0&&ui(),ss(t),i=t.pendingLanes,(s&261930)!==0&&(i&42)!==0?t===vo?Wr++:(Wr=0,vo=t):Wr=0,el(0)}}function mh(t,a){(t.pooledCacheLanes&=a)===0&&(a=t.pooledCache,a!=null&&(t.pooledCache=null,qr(a)))}function ui(){return oh(),dh(),uh(),hh()}function hh(){if(ca!==5)return!1;var t=Ys,a=xo;xo=0;var s=E(_s),n=D.T,i=V.p;try{V.p=32>s?32:s,D.T=null,s=jo,jo=null;var d=Ys,h=_s;if(ca=0,ir=Ys=null,_s=0,(Nt&6)!==0)throw Error(c(331));var b=Nt;if(Nt|=4,Xm(d.current),Ym(d,d.current,h,s),Nt=b,el(0,!1),Se&&typeof Se.onPostCommitFiberRoot=="function")try{Se.onPostCommitFiberRoot(Me,d)}catch{}return!0}finally{V.p=i,D.T=n,mh(t,a)}}function fh(t,a,s){a=Fa(s,a),a=Zc(t.stateNode,a,2),t=Ls(t,a,2),t!==null&&(dt(t,2),ss(t))}function Et(t,a,s){if(t.tag===3)fh(t,t,s);else for(;a!==null;){if(a.tag===3){fh(a,t,s);break}else if(a.tag===1){var n=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Gs===null||!Gs.has(n))){t=Fa(s,t),s=pm(2),n=Ls(a,s,2),n!==null&&(gm(s,n,a,t),dt(n,2),ss(n));break}}a=a.return}}function _o(t,a,s){var n=t.pingCache;if(n===null){n=t.pingCache=new Eg;var i=new Set;n.set(a,i)}else i=n.get(a),i===void 0&&(i=new Set,n.set(a,i));i.has(s)||(fo=!0,i.add(s),t=Rg.bind(null,t,a,s),a.then(t,t))}function Rg(t,a,s){var n=t.pingCache;n!==null&&n.delete(a),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,qt===t&&(ht&s)===s&&(It===4||It===3&&(ht&62914560)===ht&&300>Je()-ri?(Nt&2)===0&&cr(t,0):po|=s,lr===ht&&(lr=0)),ss(t)}function ph(t,a){a===0&&(a=we()),t=un(t,a),t!==null&&(dt(t,a),ss(t))}function qg(t){var a=t.memoizedState,s=0;a!==null&&(s=a.retryLane),ph(t,s)}function zg(t,a){var s=0;switch(t.tag){case 31:case 13:var n=t.stateNode,i=t.memoizedState;i!==null&&(s=i.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(c(314))}n!==null&&n.delete(a),ph(t,s)}function Og(t,a){return Ie(t,a)}var mi=null,dr=null,No=!1,hi=!1,So=!1,Qs=0;function ss(t){t!==dr&&t.next===null&&(dr===null?mi=dr=t:dr=dr.next=t),hi=!0,No||(No=!0,Lg())}function el(t,a){if(!So&&hi){So=!0;do for(var s=!1,n=mi;n!==null;){if(t!==0){var i=n.pendingLanes;if(i===0)var d=0;else{var h=n.suspendedLanes,b=n.pingedLanes;d=(1<<31-De(42|t)+1)-1,d&=i&~(h&~b),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(s=!0,vh(n,d))}else d=ht,d=ta(n,n===qt?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(d&3)===0||aa(n,d)||(s=!0,vh(n,d));n=n.next}while(s);So=!1}}function Ug(){gh()}function gh(){hi=No=!1;var t=0;Qs!==0&&Xg()&&(t=Qs);for(var a=Je(),s=null,n=mi;n!==null;){var i=n.next,d=xh(n,a);d===0?(n.next=null,s===null?mi=i:s.next=i,i===null&&(dr=s)):(s=n,(t!==0||(d&3)!==0)&&(hi=!0)),n=i}ca!==0&&ca!==5||el(t),Qs!==0&&(Qs=0)}function xh(t,a){for(var s=t.suspendedLanes,n=t.pingedLanes,i=t.expirationTimes,d=t.pendingLanes&-62914561;0<d;){var h=31-De(d),b=1<<h,O=i[h];O===-1?((b&s)===0||(b&n)!==0)&&(i[h]=Pt(b,a)):O<=a&&(t.expiredLanes|=b),d&=~b}if(a=qt,s=ht,s=ta(t,t===a?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n=t.callbackNode,s===0||t===a&&(kt===2||kt===9)||t.cancelPendingCommit!==null)return n!==null&&n!==null&&Ge(n),t.callbackNode=null,t.callbackPriority=0;if((s&3)===0||aa(t,s)){if(a=s&-s,a===t.callbackPriority)return a;switch(n!==null&&Ge(n),E(s)){case 2:case 8:s=pt;break;case 32:s=ia;break;case 268435456:s=Zt;break;default:s=ia}return n=jh.bind(null,t),s=Ie(s,n),t.callbackPriority=a,t.callbackNode=s,a}return n!==null&&n!==null&&Ge(n),t.callbackPriority=2,t.callbackNode=null,2}function jh(t,a){if(ca!==0&&ca!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(ui()&&t.callbackNode!==s)return null;var n=ht;return n=ta(t,t===qt?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n===0?null:(Wm(t,n,a),xh(t,Je()),t.callbackNode!=null&&t.callbackNode===s?jh.bind(null,t):null)}function vh(t,a){if(ui())return null;Wm(t,a,!0)}function Lg(){Zg(function(){(Nt&6)!==0?Ie(ct,Ug):gh()})}function Co(){if(Qs===0){var t=In;t===0&&(t=Ke,Ke<<=1,(Ke&261888)===0&&(Ke=256)),Qs=t}return Qs}function yh(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:bl(""+t)}function bh(t,a){var s=a.ownerDocument.createElement("input");return s.name=a.name,s.value=a.value,t.id&&s.setAttribute("form",t.id),a.parentNode.insertBefore(s,a),t=new FormData(t),s.parentNode.removeChild(s),t}function Hg(t,a,s,n,i){if(a==="submit"&&s&&s.stateNode===i){var d=yh((i[Te]||null).action),h=n.submitter;h&&(a=(a=h[Te]||null)?yh(a.formAction):h.getAttribute("formAction"),a!==null&&(d=a,h=null));var b=new Cl("action","action",null,n,i);t.push({event:b,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(Qs!==0){var O=h?bh(i,h):new FormData(i);Gc(s,{pending:!0,data:O,method:i.method,action:d},null,O)}}else typeof d=="function"&&(b.preventDefault(),O=h?bh(i,h):new FormData(i),Gc(s,{pending:!0,data:O,method:i.method,action:d},d,O))},currentTarget:i}]})}}for(var wo=0;wo<ic.length;wo++){var ko=ic[wo],Bg=ko.toLowerCase(),Fg=ko[0].toUpperCase()+ko.slice(1);Ia(Bg,"on"+Fg)}Ia(Kd,"onAnimationEnd"),Ia(Wd,"onAnimationIteration"),Ia(eu,"onAnimationStart"),Ia("dblclick","onDoubleClick"),Ia("focusin","onFocus"),Ia("focusout","onBlur"),Ia(sg,"onTransitionRun"),Ia(ng,"onTransitionStart"),Ia(rg,"onTransitionCancel"),Ia(tu,"onTransitionEnd"),ya("onMouseEnter",["mouseout","mouseover"]),ya("onMouseLeave",["mouseout","mouseover"]),ya("onPointerEnter",["pointerout","pointerover"]),ya("onPointerLeave",["pointerout","pointerover"]),Lt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Lt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Lt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Lt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Lt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Lt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var tl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$g=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(tl));function _h(t,a){a=(a&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],i=n.event;n=n.listeners;e:{var d=void 0;if(a)for(var h=n.length-1;0<=h;h--){var b=n[h],O=b.instance,ce=b.currentTarget;if(b=b.listener,O!==d&&i.isPropagationStopped())break e;d=b,i.currentTarget=ce;try{d(i)}catch(pe){El(pe)}i.currentTarget=null,d=O}else for(h=0;h<n.length;h++){if(b=n[h],O=b.instance,ce=b.currentTarget,b=b.listener,O!==d&&i.isPropagationStopped())break e;d=b,i.currentTarget=ce;try{d(i)}catch(pe){El(pe)}i.currentTarget=null,d=O}}}}function mt(t,a){var s=a[$t];s===void 0&&(s=a[$t]=new Set);var n=t+"__bubble";s.has(n)||(Nh(a,t,2,!1),s.add(n))}function Eo(t,a,s){var n=0;a&&(n|=4),Nh(s,t,n,a)}var fi="_reactListening"+Math.random().toString(36).slice(2);function Do(t){if(!t[fi]){t[fi]=!0,va.forEach(function(s){s!=="selectionchange"&&($g.has(s)||Eo(s,!1,t),Eo(s,!0,t))});var a=t.nodeType===9?t:t.ownerDocument;a===null||a[fi]||(a[fi]=!0,Eo("selectionchange",!1,a))}}function Nh(t,a,s,n){switch(Kh(a)){case 2:var i=gx;break;case 8:i=xx;break;default:i=Go}s=i.bind(null,a,s,t),i=void 0,!Xi||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(i=!0),n?i!==void 0?t.addEventListener(a,s,{capture:!0,passive:i}):t.addEventListener(a,s,!0):i!==void 0?t.addEventListener(a,s,{passive:i}):t.addEventListener(a,s,!1)}function Mo(t,a,s,n,i){var d=n;if((a&1)===0&&(a&2)===0&&n!==null)e:for(;;){if(n===null)return;var h=n.tag;if(h===3||h===4){var b=n.stateNode.containerInfo;if(b===i)break;if(h===4)for(h=n.return;h!==null;){var O=h.tag;if((O===3||O===4)&&h.stateNode.containerInfo===i)return;h=h.return}for(;b!==null;){if(h=$e(b),h===null)return;if(O=h.tag,O===5||O===6||O===26||O===27){n=d=h;continue e}b=b.parentNode}}n=n.return}Ed(function(){var ce=d,pe=Pi(s),je=[];e:{var oe=au.get(t);if(oe!==void 0){var me=Cl,Be=t;switch(t){case"keypress":if(Nl(s)===0)break e;case"keydown":case"keyup":me=zp;break;case"focusin":Be="focus",me=Ki;break;case"focusout":Be="blur",me=Ki;break;case"beforeblur":case"afterblur":me=Ki;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":me=Ad;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":me=Np;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":me=Lp;break;case Kd:case Wd:case eu:me=wp;break;case tu:me=Bp;break;case"scroll":case"scrollend":me=bp;break;case"wheel":me=$p;break;case"copy":case"cut":case"paste":me=Ep;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":me=Rd;break;case"toggle":case"beforetoggle":me=Gp}var et=(a&4)!==0,Tt=!et&&(t==="scroll"||t==="scrollend"),te=et?oe!==null?oe+"Capture":null:oe;et=[];for(var P=ce,le;P!==null;){var xe=P;if(le=xe.stateNode,xe=xe.tag,xe!==5&&xe!==26&&xe!==27||le===null||te===null||(xe=Nr(P,te),xe!=null&&et.push(al(P,xe,le))),Tt)break;P=P.return}0<et.length&&(oe=new me(oe,Be,null,s,pe),je.push({event:oe,listeners:et}))}}if((a&7)===0){e:{if(oe=t==="mouseover"||t==="pointerover",me=t==="mouseout"||t==="pointerout",oe&&s!==Yi&&(Be=s.relatedTarget||s.fromElement)&&($e(Be)||Be[Ye]))break e;if((me||oe)&&(oe=pe.window===pe?pe:(oe=pe.ownerDocument)?oe.defaultView||oe.parentWindow:window,me?(Be=s.relatedTarget||s.toElement,me=ce,Be=Be?$e(Be):null,Be!==null&&(Tt=u(Be),et=Be.tag,Be!==Tt||et!==5&&et!==27&&et!==6)&&(Be=null)):(me=null,Be=ce),me!==Be)){if(et=Ad,xe="onMouseLeave",te="onMouseEnter",P="mouse",(t==="pointerout"||t==="pointerover")&&(et=Rd,xe="onPointerLeave",te="onPointerEnter",P="pointer"),Tt=me==null?oe:_t(me),le=Be==null?oe:_t(Be),oe=new et(xe,P+"leave",me,s,pe),oe.target=Tt,oe.relatedTarget=le,xe=null,$e(pe)===ce&&(et=new et(te,P+"enter",Be,s,pe),et.target=le,et.relatedTarget=Tt,xe=et),Tt=xe,me&&Be)t:{for(et=Vg,te=me,P=Be,le=0,xe=te;xe;xe=et(xe))le++;xe=0;for(var Ze=P;Ze;Ze=et(Ze))xe++;for(;0<le-xe;)te=et(te),le--;for(;0<xe-le;)P=et(P),xe--;for(;le--;){if(te===P||P!==null&&te===P.alternate){et=te;break t}te=et(te),P=et(P)}et=null}else et=null;me!==null&&Sh(je,oe,me,et,!1),Be!==null&&Tt!==null&&Sh(je,Tt,Be,et,!0)}}e:{if(oe=ce?_t(ce):window,me=oe.nodeName&&oe.nodeName.toLowerCase(),me==="select"||me==="input"&&oe.type==="file")var vt=Fd;else if(Hd(oe))if($d)vt=eg;else{vt=Kp;var Pe=Jp}else me=oe.nodeName,!me||me.toLowerCase()!=="input"||oe.type!=="checkbox"&&oe.type!=="radio"?ce&&Gi(ce.elementType)&&(vt=Fd):vt=Wp;if(vt&&(vt=vt(t,ce))){Bd(je,vt,s,pe);break e}Pe&&Pe(t,oe,ce),t==="focusout"&&ce&&oe.type==="number"&&ce.memoizedProps.value!=null&&Vi(oe,"number",oe.value)}switch(Pe=ce?_t(ce):window,t){case"focusin":(Hd(Pe)||Pe.contentEditable==="true")&&(Fn=Pe,nc=ce,Ar=null);break;case"focusout":Ar=nc=Fn=null;break;case"mousedown":rc=!0;break;case"contextmenu":case"mouseup":case"dragend":rc=!1,Zd(je,s,pe);break;case"selectionchange":if(ag)break;case"keydown":case"keyup":Zd(je,s,pe)}var it;if(ec)e:{switch(t){case"compositionstart":var ft="onCompositionStart";break e;case"compositionend":ft="onCompositionEnd";break e;case"compositionupdate":ft="onCompositionUpdate";break e}ft=void 0}else Bn?Ud(t,s)&&(ft="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(ft="onCompositionStart");ft&&(qd&&s.locale!=="ko"&&(Bn||ft!=="onCompositionStart"?ft==="onCompositionEnd"&&Bn&&(it=Dd()):(As=pe,Ii="value"in As?As.value:As.textContent,Bn=!0)),Pe=pi(ce,ft),0<Pe.length&&(ft=new Td(ft,t,null,s,pe),je.push({event:ft,listeners:Pe}),it?ft.data=it:(it=Ld(s),it!==null&&(ft.data=it)))),(it=Pp?Qp(t,s):Xp(t,s))&&(ft=pi(ce,"onBeforeInput"),0<ft.length&&(Pe=new Td("onBeforeInput","beforeinput",null,s,pe),je.push({event:Pe,listeners:ft}),Pe.data=it)),Hg(je,t,ce,s,pe)}_h(je,a)})}function al(t,a,s){return{instance:t,listener:a,currentTarget:s}}function pi(t,a){for(var s=a+"Capture",n=[];t!==null;){var i=t,d=i.stateNode;if(i=i.tag,i!==5&&i!==26&&i!==27||d===null||(i=Nr(t,s),i!=null&&n.unshift(al(t,i,d)),i=Nr(t,a),i!=null&&n.push(al(t,i,d))),t.tag===3)return n;t=t.return}return[]}function Vg(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Sh(t,a,s,n,i){for(var d=a._reactName,h=[];s!==null&&s!==n;){var b=s,O=b.alternate,ce=b.stateNode;if(b=b.tag,O!==null&&O===n)break;b!==5&&b!==26&&b!==27||ce===null||(O=ce,i?(ce=Nr(s,d),ce!=null&&h.unshift(al(s,ce,O))):i||(ce=Nr(s,d),ce!=null&&h.push(al(s,ce,O)))),s=s.return}h.length!==0&&t.push({event:a,listeners:h})}var Gg=/\r\n?/g,Yg=/\u0000|\uFFFD/g;function Ch(t){return(typeof t=="string"?t:""+t).replace(Gg,`
`).replace(Yg,"")}function wh(t,a){return a=Ch(a),Ch(t)===a}function At(t,a,s,n,i,d){switch(s){case"children":typeof n=="string"?a==="body"||a==="textarea"&&n===""||Un(t,n):(typeof n=="number"||typeof n=="bigint")&&a!=="body"&&Un(t,""+n);break;case"className":zn(t,"class",n);break;case"tabIndex":zn(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":zn(t,s,n);break;case"style":wd(t,n,d);break;case"data":if(a!=="object"){zn(t,"data",n);break}case"src":case"href":if(n===""&&(a!=="a"||s!=="href")){t.removeAttribute(s);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=bl(""+n),t.setAttribute(s,n);break;case"action":case"formAction":if(typeof n=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(s==="formAction"?(a!=="input"&&At(t,a,"name",i.name,i,null),At(t,a,"formEncType",i.formEncType,i,null),At(t,a,"formMethod",i.formMethod,i,null),At(t,a,"formTarget",i.formTarget,i,null)):(At(t,a,"encType",i.encType,i,null),At(t,a,"method",i.method,i,null),At(t,a,"target",i.target,i,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=bl(""+n),t.setAttribute(s,n);break;case"onClick":n!=null&&(t.onclick=is);break;case"onScroll":n!=null&&mt("scroll",t);break;case"onScrollEnd":n!=null&&mt("scrollend",t);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(c(61));if(s=n.__html,s!=null){if(i.children!=null)throw Error(c(60));t.innerHTML=s}}break;case"multiple":t.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":t.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){t.removeAttribute("xlink:href");break}s=bl(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""+n):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":n===!0?t.setAttribute(s,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,n):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?t.setAttribute(s,n):t.removeAttribute(s);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?t.removeAttribute(s):t.setAttribute(s,n);break;case"popover":mt("beforetoggle",t),mt("toggle",t),ln(t,"popover",n);break;case"xlinkActuate":oa(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":oa(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":oa(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":oa(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":oa(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":oa(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":oa(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":oa(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":oa(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":ln(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=vp.get(s)||s,ln(t,s,n))}}function Ao(t,a,s,n,i,d){switch(s){case"style":wd(t,n,d);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(c(61));if(s=n.__html,s!=null){if(i.children!=null)throw Error(c(60));t.innerHTML=s}}break;case"children":typeof n=="string"?Un(t,n):(typeof n=="number"||typeof n=="bigint")&&Un(t,""+n);break;case"onScroll":n!=null&&mt("scroll",t);break;case"onScrollEnd":n!=null&&mt("scrollend",t);break;case"onClick":n!=null&&(t.onclick=is);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!La.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(i=s.endsWith("Capture"),a=s.slice(2,i?s.length-7:void 0),d=t[Te]||null,d=d!=null?d[s]:null,typeof d=="function"&&t.removeEventListener(a,d,i),typeof n=="function")){typeof d!="function"&&d!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(a,n,i);break e}s in t?t[s]=n:n===!0?t.setAttribute(s,""):ln(t,s,n)}}}function ga(t,a,s){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":mt("error",t),mt("load",t);var n=!1,i=!1,d;for(d in s)if(s.hasOwnProperty(d)){var h=s[d];if(h!=null)switch(d){case"src":n=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(c(137,a));default:At(t,a,d,h,s,null)}}i&&At(t,a,"srcSet",s.srcSet,s,null),n&&At(t,a,"src",s.src,s,null);return;case"input":mt("invalid",t);var b=d=h=i=null,O=null,ce=null;for(n in s)if(s.hasOwnProperty(n)){var pe=s[n];if(pe!=null)switch(n){case"name":i=pe;break;case"type":h=pe;break;case"checked":O=pe;break;case"defaultChecked":ce=pe;break;case"value":d=pe;break;case"defaultValue":b=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(c(137,a));break;default:At(t,a,n,pe,s,null)}}_d(t,d,b,O,ce,h,i,!1);return;case"select":mt("invalid",t),n=h=d=null;for(i in s)if(s.hasOwnProperty(i)&&(b=s[i],b!=null))switch(i){case"value":d=b;break;case"defaultValue":h=b;break;case"multiple":n=b;default:At(t,a,i,b,s,null)}a=d,s=h,t.multiple=!!n,a!=null?On(t,!!n,a,!1):s!=null&&On(t,!!n,s,!0);return;case"textarea":mt("invalid",t),d=i=n=null;for(h in s)if(s.hasOwnProperty(h)&&(b=s[h],b!=null))switch(h){case"value":n=b;break;case"defaultValue":i=b;break;case"children":d=b;break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(c(91));break;default:At(t,a,h,b,s,null)}Sd(t,n,i,d);return;case"option":for(O in s)if(s.hasOwnProperty(O)&&(n=s[O],n!=null))switch(O){case"selected":t.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:At(t,a,O,n,s,null)}return;case"dialog":mt("beforetoggle",t),mt("toggle",t),mt("cancel",t),mt("close",t);break;case"iframe":case"object":mt("load",t);break;case"video":case"audio":for(n=0;n<tl.length;n++)mt(tl[n],t);break;case"image":mt("error",t),mt("load",t);break;case"details":mt("toggle",t);break;case"embed":case"source":case"link":mt("error",t),mt("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ce in s)if(s.hasOwnProperty(ce)&&(n=s[ce],n!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":throw Error(c(137,a));default:At(t,a,ce,n,s,null)}return;default:if(Gi(a)){for(pe in s)s.hasOwnProperty(pe)&&(n=s[pe],n!==void 0&&Ao(t,a,pe,n,s,void 0));return}}for(b in s)s.hasOwnProperty(b)&&(n=s[b],n!=null&&At(t,a,b,n,s,null))}function Pg(t,a,s,n){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,d=null,h=null,b=null,O=null,ce=null,pe=null;for(me in s){var je=s[me];if(s.hasOwnProperty(me)&&je!=null)switch(me){case"checked":break;case"value":break;case"defaultValue":O=je;default:n.hasOwnProperty(me)||At(t,a,me,null,n,je)}}for(var oe in n){var me=n[oe];if(je=s[oe],n.hasOwnProperty(oe)&&(me!=null||je!=null))switch(oe){case"type":d=me;break;case"name":i=me;break;case"checked":ce=me;break;case"defaultChecked":pe=me;break;case"value":h=me;break;case"defaultValue":b=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(c(137,a));break;default:me!==je&&At(t,a,oe,me,n,je)}}$i(t,h,b,O,ce,pe,d,i);return;case"select":me=h=b=oe=null;for(d in s)if(O=s[d],s.hasOwnProperty(d)&&O!=null)switch(d){case"value":break;case"multiple":me=O;default:n.hasOwnProperty(d)||At(t,a,d,null,n,O)}for(i in n)if(d=n[i],O=s[i],n.hasOwnProperty(i)&&(d!=null||O!=null))switch(i){case"value":oe=d;break;case"defaultValue":b=d;break;case"multiple":h=d;default:d!==O&&At(t,a,i,d,n,O)}a=b,s=h,n=me,oe!=null?On(t,!!s,oe,!1):!!n!=!!s&&(a!=null?On(t,!!s,a,!0):On(t,!!s,s?[]:"",!1));return;case"textarea":me=oe=null;for(b in s)if(i=s[b],s.hasOwnProperty(b)&&i!=null&&!n.hasOwnProperty(b))switch(b){case"value":break;case"children":break;default:At(t,a,b,null,n,i)}for(h in n)if(i=n[h],d=s[h],n.hasOwnProperty(h)&&(i!=null||d!=null))switch(h){case"value":oe=i;break;case"defaultValue":me=i;break;case"children":break;case"dangerouslySetInnerHTML":if(i!=null)throw Error(c(91));break;default:i!==d&&At(t,a,h,i,n,d)}Nd(t,oe,me);return;case"option":for(var Be in s)if(oe=s[Be],s.hasOwnProperty(Be)&&oe!=null&&!n.hasOwnProperty(Be))switch(Be){case"selected":t.selected=!1;break;default:At(t,a,Be,null,n,oe)}for(O in n)if(oe=n[O],me=s[O],n.hasOwnProperty(O)&&oe!==me&&(oe!=null||me!=null))switch(O){case"selected":t.selected=oe&&typeof oe!="function"&&typeof oe!="symbol";break;default:At(t,a,O,oe,n,me)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var et in s)oe=s[et],s.hasOwnProperty(et)&&oe!=null&&!n.hasOwnProperty(et)&&At(t,a,et,null,n,oe);for(ce in n)if(oe=n[ce],me=s[ce],n.hasOwnProperty(ce)&&oe!==me&&(oe!=null||me!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(c(137,a));break;default:At(t,a,ce,oe,n,me)}return;default:if(Gi(a)){for(var Tt in s)oe=s[Tt],s.hasOwnProperty(Tt)&&oe!==void 0&&!n.hasOwnProperty(Tt)&&Ao(t,a,Tt,void 0,n,oe);for(pe in n)oe=n[pe],me=s[pe],!n.hasOwnProperty(pe)||oe===me||oe===void 0&&me===void 0||Ao(t,a,pe,oe,n,me);return}}for(var te in s)oe=s[te],s.hasOwnProperty(te)&&oe!=null&&!n.hasOwnProperty(te)&&At(t,a,te,null,n,oe);for(je in n)oe=n[je],me=s[je],!n.hasOwnProperty(je)||oe===me||oe==null&&me==null||At(t,a,je,oe,n,me)}function kh(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Qg(){if(typeof performance.getEntriesByType=="function"){for(var t=0,a=0,s=performance.getEntriesByType("resource"),n=0;n<s.length;n++){var i=s[n],d=i.transferSize,h=i.initiatorType,b=i.duration;if(d&&b&&kh(h)){for(h=0,b=i.responseEnd,n+=1;n<s.length;n++){var O=s[n],ce=O.startTime;if(ce>b)break;var pe=O.transferSize,je=O.initiatorType;pe&&kh(je)&&(O=O.responseEnd,h+=pe*(O<b?1:(b-ce)/(O-ce)))}if(--n,a+=8*(d+h)/(i.duration/1e3),t++,10<t)break}}if(0<t)return a/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var To=null,Ro=null;function gi(t){return t.nodeType===9?t:t.ownerDocument}function Eh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Dh(t,a){if(t===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&a==="foreignObject"?0:t}function qo(t,a){return t==="textarea"||t==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var zo=null;function Xg(){var t=window.event;return t&&t.type==="popstate"?t===zo?!1:(zo=t,!0):(zo=null,!1)}var Mh=typeof setTimeout=="function"?setTimeout:void 0,Ig=typeof clearTimeout=="function"?clearTimeout:void 0,Ah=typeof Promise=="function"?Promise:void 0,Zg=typeof queueMicrotask=="function"?queueMicrotask:typeof Ah<"u"?function(t){return Ah.resolve(null).then(t).catch(Jg)}:Mh;function Jg(t){setTimeout(function(){throw t})}function Xs(t){return t==="head"}function Th(t,a){var s=a,n=0;do{var i=s.nextSibling;if(t.removeChild(s),i&&i.nodeType===8)if(s=i.data,s==="/$"||s==="/&"){if(n===0){t.removeChild(i),fr(a);return}n--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")n++;else if(s==="html")sl(t.ownerDocument.documentElement);else if(s==="head"){s=t.ownerDocument.head,sl(s);for(var d=s.firstChild;d;){var h=d.nextSibling,b=d.nodeName;d[Vt]||b==="SCRIPT"||b==="STYLE"||b==="LINK"&&d.rel.toLowerCase()==="stylesheet"||s.removeChild(d),d=h}}else s==="body"&&sl(t.ownerDocument.body);s=i}while(s);fr(a)}function Rh(t,a){var s=t;t=0;do{var n=s.nextSibling;if(s.nodeType===1?a?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(a?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),n&&n.nodeType===8)if(s=n.data,s==="/$"){if(t===0)break;t--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||t++;s=n}while(s)}function Oo(t){var a=t.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var s=a;switch(a=a.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":Oo(s),Jt(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function Kg(t,a,s,n){for(;t.nodeType===1;){var i=s;if(t.nodeName.toLowerCase()!==a.toLowerCase()){if(!n&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(n){if(!t[Vt])switch(a){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(d=t.getAttribute("rel"),d==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(d!==i.rel||t.getAttribute("href")!==(i.href==null||i.href===""?null:i.href)||t.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin)||t.getAttribute("title")!==(i.title==null?null:i.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(d=t.getAttribute("src"),(d!==(i.src==null?null:i.src)||t.getAttribute("type")!==(i.type==null?null:i.type)||t.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin))&&d&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(a==="input"&&t.type==="hidden"){var d=i.name==null?null:""+i.name;if(i.type==="hidden"&&t.getAttribute("name")===d)return t}else return t;if(t=Pa(t.nextSibling),t===null)break}return null}function Wg(t,a,s){if(a==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=Pa(t.nextSibling),t===null))return null;return t}function qh(t,a){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!a||(t=Pa(t.nextSibling),t===null))return null;return t}function Uo(t){return t.data==="$?"||t.data==="$~"}function Lo(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function ex(t,a){var s=t.ownerDocument;if(t.data==="$~")t._reactRetry=a;else if(t.data!=="$?"||s.readyState!=="loading")a();else{var n=function(){a(),s.removeEventListener("DOMContentLoaded",n)};s.addEventListener("DOMContentLoaded",n),t._reactRetry=n}}function Pa(t){for(;t!=null;t=t.nextSibling){var a=t.nodeType;if(a===1||a===3)break;if(a===8){if(a=t.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return t}var Ho=null;function zh(t){t=t.nextSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"||s==="/&"){if(a===0)return Pa(t.nextSibling);a--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||a++}t=t.nextSibling}return null}function Oh(t){t=t.previousSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(a===0)return t;a--}else s!=="/$"&&s!=="/&"||a++}t=t.previousSibling}return null}function Uh(t,a,s){switch(a=gi(s),t){case"html":if(t=a.documentElement,!t)throw Error(c(452));return t;case"head":if(t=a.head,!t)throw Error(c(453));return t;case"body":if(t=a.body,!t)throw Error(c(454));return t;default:throw Error(c(451))}}function sl(t){for(var a=t.attributes;a.length;)t.removeAttributeNode(a[0]);Jt(t)}var Qa=new Map,Lh=new Set;function xi(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Ns=V.d;V.d={f:tx,r:ax,D:sx,C:nx,L:rx,m:lx,X:cx,S:ix,M:ox};function tx(){var t=Ns.f(),a=ci();return t||a}function ax(t){var a=st(t);a!==null&&a.tag===5&&a.type==="form"?tm(a):Ns.r(t)}var ur=typeof document>"u"?null:document;function Hh(t,a,s){var n=ur;if(n&&typeof a=="string"&&a){var i=Ha(a);i='link[rel="'+t+'"][href="'+i+'"]',typeof s=="string"&&(i+='[crossorigin="'+s+'"]'),Lh.has(i)||(Lh.add(i),t={rel:t,crossOrigin:s,href:a},n.querySelector(i)===null&&(a=n.createElement("link"),ga(a,"link",t),wt(a),n.head.appendChild(a)))}}function sx(t){Ns.D(t),Hh("dns-prefetch",t,null)}function nx(t,a){Ns.C(t,a),Hh("preconnect",t,a)}function rx(t,a,s){Ns.L(t,a,s);var n=ur;if(n&&t&&a){var i='link[rel="preload"][as="'+Ha(a)+'"]';a==="image"&&s&&s.imageSrcSet?(i+='[imagesrcset="'+Ha(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(i+='[imagesizes="'+Ha(s.imageSizes)+'"]')):i+='[href="'+Ha(t)+'"]';var d=i;switch(a){case"style":d=mr(t);break;case"script":d=hr(t)}Qa.has(d)||(t=T({rel:"preload",href:a==="image"&&s&&s.imageSrcSet?void 0:t,as:a},s),Qa.set(d,t),n.querySelector(i)!==null||a==="style"&&n.querySelector(nl(d))||a==="script"&&n.querySelector(rl(d))||(a=n.createElement("link"),ga(a,"link",t),wt(a),n.head.appendChild(a)))}}function lx(t,a){Ns.m(t,a);var s=ur;if(s&&t){var n=a&&typeof a.as=="string"?a.as:"script",i='link[rel="modulepreload"][as="'+Ha(n)+'"][href="'+Ha(t)+'"]',d=i;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=hr(t)}if(!Qa.has(d)&&(t=T({rel:"modulepreload",href:t},a),Qa.set(d,t),s.querySelector(i)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(rl(d)))return}n=s.createElement("link"),ga(n,"link",t),wt(n),s.head.appendChild(n)}}}function ix(t,a,s){Ns.S(t,a,s);var n=ur;if(n&&t){var i=Dt(n).hoistableStyles,d=mr(t);a=a||"default";var h=i.get(d);if(!h){var b={loading:0,preload:null};if(h=n.querySelector(nl(d)))b.loading=5;else{t=T({rel:"stylesheet",href:t,"data-precedence":a},s),(s=Qa.get(d))&&Bo(t,s);var O=h=n.createElement("link");wt(O),ga(O,"link",t),O._p=new Promise(function(ce,pe){O.onload=ce,O.onerror=pe}),O.addEventListener("load",function(){b.loading|=1}),O.addEventListener("error",function(){b.loading|=2}),b.loading|=4,ji(h,a,n)}h={type:"stylesheet",instance:h,count:1,state:b},i.set(d,h)}}}function cx(t,a){Ns.X(t,a);var s=ur;if(s&&t){var n=Dt(s).hoistableScripts,i=hr(t),d=n.get(i);d||(d=s.querySelector(rl(i)),d||(t=T({src:t,async:!0},a),(a=Qa.get(i))&&Fo(t,a),d=s.createElement("script"),wt(d),ga(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(i,d))}}function ox(t,a){Ns.M(t,a);var s=ur;if(s&&t){var n=Dt(s).hoistableScripts,i=hr(t),d=n.get(i);d||(d=s.querySelector(rl(i)),d||(t=T({src:t,async:!0,type:"module"},a),(a=Qa.get(i))&&Fo(t,a),d=s.createElement("script"),wt(d),ga(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},n.set(i,d))}}function Bh(t,a,s,n){var i=(i=ze.current)?xi(i):null;if(!i)throw Error(c(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(a=mr(s.href),s=Dt(i).hoistableStyles,n=s.get(a),n||(n={type:"style",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=mr(s.href);var d=Dt(i).hoistableStyles,h=d.get(t);if(h||(i=i.ownerDocument||i,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(t,h),(d=i.querySelector(nl(t)))&&!d._p&&(h.instance=d,h.state.loading=5),Qa.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},Qa.set(t,s),d||dx(i,t,s,h.state))),a&&n===null)throw Error(c(528,""));return h}if(a&&n!==null)throw Error(c(529,""));return null;case"script":return a=s.async,s=s.src,typeof s=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=hr(s),s=Dt(i).hoistableScripts,n=s.get(a),n||(n={type:"script",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(c(444,t))}}function mr(t){return'href="'+Ha(t)+'"'}function nl(t){return'link[rel="stylesheet"]['+t+"]"}function Fh(t){return T({},t,{"data-precedence":t.precedence,precedence:null})}function dx(t,a,s,n){t.querySelector('link[rel="preload"][as="style"]['+a+"]")?n.loading=1:(a=t.createElement("link"),n.preload=a,a.addEventListener("load",function(){return n.loading|=1}),a.addEventListener("error",function(){return n.loading|=2}),ga(a,"link",s),wt(a),t.head.appendChild(a))}function hr(t){return'[src="'+Ha(t)+'"]'}function rl(t){return"script[async]"+t}function $h(t,a,s){if(a.count++,a.instance===null)switch(a.type){case"style":var n=t.querySelector('style[data-href~="'+Ha(s.href)+'"]');if(n)return a.instance=n,wt(n),n;var i=T({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return n=(t.ownerDocument||t).createElement("style"),wt(n),ga(n,"style",i),ji(n,s.precedence,t),a.instance=n;case"stylesheet":i=mr(s.href);var d=t.querySelector(nl(i));if(d)return a.state.loading|=4,a.instance=d,wt(d),d;n=Fh(s),(i=Qa.get(i))&&Bo(n,i),d=(t.ownerDocument||t).createElement("link"),wt(d);var h=d;return h._p=new Promise(function(b,O){h.onload=b,h.onerror=O}),ga(d,"link",n),a.state.loading|=4,ji(d,s.precedence,t),a.instance=d;case"script":return d=hr(s.src),(i=t.querySelector(rl(d)))?(a.instance=i,wt(i),i):(n=s,(i=Qa.get(d))&&(n=T({},s),Fo(n,i)),t=t.ownerDocument||t,i=t.createElement("script"),wt(i),ga(i,"link",n),t.head.appendChild(i),a.instance=i);case"void":return null;default:throw Error(c(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(n=a.instance,a.state.loading|=4,ji(n,s.precedence,t));return a.instance}function ji(t,a,s){for(var n=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=n.length?n[n.length-1]:null,d=i,h=0;h<n.length;h++){var b=n[h];if(b.dataset.precedence===a)d=b;else if(d!==i)break}d?d.parentNode.insertBefore(t,d.nextSibling):(a=s.nodeType===9?s.head:s,a.insertBefore(t,a.firstChild))}function Bo(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.title==null&&(t.title=a.title)}function Fo(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.integrity==null&&(t.integrity=a.integrity)}var vi=null;function Vh(t,a,s){if(vi===null){var n=new Map,i=vi=new Map;i.set(s,n)}else i=vi,n=i.get(s),n||(n=new Map,i.set(s,n));if(n.has(t))return n;for(n.set(t,null),s=s.getElementsByTagName(t),i=0;i<s.length;i++){var d=s[i];if(!(d[Vt]||d[Ae]||t==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var h=d.getAttribute(a)||"";h=t+h;var b=n.get(h);b?b.push(d):n.set(h,[d])}}return n}function Gh(t,a,s){t=t.ownerDocument||t,t.head.insertBefore(s,a==="title"?t.querySelector("head > title"):null)}function ux(t,a,s){if(s===1||a.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return t=a.disabled,typeof a.precedence=="string"&&t==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Yh(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function mx(t,a,s,n){if(s.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var i=mr(n.href),d=a.querySelector(nl(i));if(d){a=d._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(t.count++,t=yi.bind(t),a.then(t,t)),s.state.loading|=4,s.instance=d,wt(d);return}d=a.ownerDocument||a,n=Fh(n),(i=Qa.get(i))&&Bo(n,i),d=d.createElement("link"),wt(d);var h=d;h._p=new Promise(function(b,O){h.onload=b,h.onerror=O}),ga(d,"link",n),s.instance=d}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(s,a),(a=s.state.preload)&&(s.state.loading&3)===0&&(t.count++,s=yi.bind(t),a.addEventListener("load",s),a.addEventListener("error",s))}}var $o=0;function hx(t,a){return t.stylesheets&&t.count===0&&_i(t,t.stylesheets),0<t.count||0<t.imgCount?function(s){var n=setTimeout(function(){if(t.stylesheets&&_i(t,t.stylesheets),t.unsuspend){var d=t.unsuspend;t.unsuspend=null,d()}},6e4+a);0<t.imgBytes&&$o===0&&($o=62500*Qg());var i=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&_i(t,t.stylesheets),t.unsuspend)){var d=t.unsuspend;t.unsuspend=null,d()}},(t.imgBytes>$o?50:800)+a);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(n),clearTimeout(i)}}:null}function yi(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)_i(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var bi=null;function _i(t,a){t.stylesheets=null,t.unsuspend!==null&&(t.count++,bi=new Map,a.forEach(fx,t),bi=null,yi.call(t))}function fx(t,a){if(!(a.state.loading&4)){var s=bi.get(t);if(s)var n=s.get(null);else{s=new Map,bi.set(t,s);for(var i=t.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<i.length;d++){var h=i[d];(h.nodeName==="LINK"||h.getAttribute("media")!=="not all")&&(s.set(h.dataset.precedence,h),n=h)}n&&s.set(null,n)}i=a.instance,h=i.getAttribute("data-precedence"),d=s.get(h)||n,d===n&&s.set(null,i),s.set(h,i),this.count++,n=yi.bind(this),i.addEventListener("load",n),i.addEventListener("error",n),d?d.parentNode.insertBefore(i,d.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(i,t.firstChild)),a.state.loading|=4}}var ll={$$typeof:M,Provider:null,Consumer:null,_currentValue:k,_currentValue2:k,_threadCount:0};function px(t,a,s,n,i,d,h,b,O){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=bt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bt(0),this.hiddenUpdates=bt(null),this.identifierPrefix=n,this.onUncaughtError=i,this.onCaughtError=d,this.onRecoverableError=h,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=O,this.incompleteTransitions=new Map}function Ph(t,a,s,n,i,d,h,b,O,ce,pe,je){return t=new px(t,a,s,h,O,ce,pe,je,b),a=1,d===!0&&(a|=24),d=Ma(3,null,null,a),t.current=d,d.stateNode=t,a=yc(),a.refCount++,t.pooledCache=a,a.refCount++,d.memoizedState={element:n,isDehydrated:s,cache:a},Sc(d),t}function Qh(t){return t?(t=Gn,t):Gn}function Xh(t,a,s,n,i,d){i=Qh(i),n.context===null?n.context=i:n.pendingContext=i,n=Us(a),n.payload={element:s},d=d===void 0?null:d,d!==null&&(n.callback=d),s=Ls(t,n,a),s!==null&&(Ea(s,t,a),Lr(s,t,a))}function Ih(t,a){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<a?s:a}}function Vo(t,a){Ih(t,a),(t=t.alternate)&&Ih(t,a)}function Zh(t){if(t.tag===13||t.tag===31){var a=un(t,67108864);a!==null&&Ea(a,t,67108864),Vo(t,67108864)}}function Jh(t){if(t.tag===13||t.tag===31){var a=za();a=Xe(a);var s=un(t,a);s!==null&&Ea(s,t,a),Vo(t,a)}}var Ni=!0;function gx(t,a,s,n){var i=D.T;D.T=null;var d=V.p;try{V.p=2,Go(t,a,s,n)}finally{V.p=d,D.T=i}}function xx(t,a,s,n){var i=D.T;D.T=null;var d=V.p;try{V.p=8,Go(t,a,s,n)}finally{V.p=d,D.T=i}}function Go(t,a,s,n){if(Ni){var i=Yo(n);if(i===null)Mo(t,a,n,Si,s),Wh(t,n);else if(vx(i,t,a,s,n))n.stopPropagation();else if(Wh(t,n),a&4&&-1<jx.indexOf(t)){for(;i!==null;){var d=st(i);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var h=Ct(d.pendingLanes);if(h!==0){var b=d;for(b.pendingLanes|=2,b.entangledLanes|=2;h;){var O=1<<31-De(h);b.entanglements[1]|=O,h&=~O}ss(d),(Nt&6)===0&&(li=Je()+500,el(0))}}break;case 31:case 13:b=un(d,2),b!==null&&Ea(b,d,2),ci(),Vo(d,2)}if(d=Yo(n),d===null&&Mo(t,a,n,Si,s),d===i)break;i=d}i!==null&&n.stopPropagation()}else Mo(t,a,n,null,s)}}function Yo(t){return t=Pi(t),Po(t)}var Si=null;function Po(t){if(Si=null,t=$e(t),t!==null){var a=u(t);if(a===null)t=null;else{var s=a.tag;if(s===13){if(t=j(a),t!==null)return t;t=null}else if(s===31){if(t=p(a),t!==null)return t;t=null}else if(s===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;t=null}else a!==t&&(t=null)}}return Si=t,null}function Kh(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ve()){case ct:return 2;case pt:return 8;case ia:case Ft:return 32;case Zt:return 268435456;default:return 32}default:return 32}}var Qo=!1,Is=null,Zs=null,Js=null,il=new Map,cl=new Map,Ks=[],jx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Wh(t,a){switch(t){case"focusin":case"focusout":Is=null;break;case"dragenter":case"dragleave":Zs=null;break;case"mouseover":case"mouseout":Js=null;break;case"pointerover":case"pointerout":il.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":cl.delete(a.pointerId)}}function ol(t,a,s,n,i,d){return t===null||t.nativeEvent!==d?(t={blockedOn:a,domEventName:s,eventSystemFlags:n,nativeEvent:d,targetContainers:[i]},a!==null&&(a=st(a),a!==null&&Zh(a)),t):(t.eventSystemFlags|=n,a=t.targetContainers,i!==null&&a.indexOf(i)===-1&&a.push(i),t)}function vx(t,a,s,n,i){switch(a){case"focusin":return Is=ol(Is,t,a,s,n,i),!0;case"dragenter":return Zs=ol(Zs,t,a,s,n,i),!0;case"mouseover":return Js=ol(Js,t,a,s,n,i),!0;case"pointerover":var d=i.pointerId;return il.set(d,ol(il.get(d)||null,t,a,s,n,i)),!0;case"gotpointercapture":return d=i.pointerId,cl.set(d,ol(cl.get(d)||null,t,a,s,n,i)),!0}return!1}function ef(t){var a=$e(t.target);if(a!==null){var s=u(a);if(s!==null){if(a=s.tag,a===13){if(a=j(s),a!==null){t.blockedOn=a,ue(t.priority,function(){Jh(s)});return}}else if(a===31){if(a=p(s),a!==null){t.blockedOn=a,ue(t.priority,function(){Jh(s)});return}}else if(a===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ci(t){if(t.blockedOn!==null)return!1;for(var a=t.targetContainers;0<a.length;){var s=Yo(t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);Yi=n,s.target.dispatchEvent(n),Yi=null}else return a=st(s),a!==null&&Zh(a),t.blockedOn=s,!1;a.shift()}return!0}function tf(t,a,s){Ci(t)&&s.delete(a)}function yx(){Qo=!1,Is!==null&&Ci(Is)&&(Is=null),Zs!==null&&Ci(Zs)&&(Zs=null),Js!==null&&Ci(Js)&&(Js=null),il.forEach(tf),cl.forEach(tf)}function wi(t,a){t.blockedOn===a&&(t.blockedOn=null,Qo||(Qo=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,yx)))}var ki=null;function af(t){ki!==t&&(ki=t,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){ki===t&&(ki=null);for(var a=0;a<t.length;a+=3){var s=t[a],n=t[a+1],i=t[a+2];if(typeof n!="function"){if(Po(n||s)===null)continue;break}var d=st(s);d!==null&&(t.splice(a,3),a-=3,Gc(d,{pending:!0,data:i,method:s.method,action:n},n,i))}}))}function fr(t){function a(O){return wi(O,t)}Is!==null&&wi(Is,t),Zs!==null&&wi(Zs,t),Js!==null&&wi(Js,t),il.forEach(a),cl.forEach(a);for(var s=0;s<Ks.length;s++){var n=Ks[s];n.blockedOn===t&&(n.blockedOn=null)}for(;0<Ks.length&&(s=Ks[0],s.blockedOn===null);)ef(s),s.blockedOn===null&&Ks.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(n=0;n<s.length;n+=3){var i=s[n],d=s[n+1],h=i[Te]||null;if(typeof d=="function")h||af(s);else if(h){var b=null;if(d&&d.hasAttribute("formAction")){if(i=d,h=d[Te]||null)b=h.formAction;else if(Po(i)!==null)continue}else b=h.action;typeof b=="function"?s[n+1]=b:(s.splice(n,3),n-=3),af(s)}}}function sf(){function t(d){d.canIntercept&&d.info==="react-transition"&&d.intercept({handler:function(){return new Promise(function(h){return i=h})},focusReset:"manual",scroll:"manual"})}function a(){i!==null&&(i(),i=null),n||setTimeout(s,20)}function s(){if(!n&&!navigation.transition){var d=navigation.currentEntry;d&&d.url!=null&&navigation.navigate(d.url,{state:d.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,i=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(s,100),function(){n=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),i!==null&&(i(),i=null)}}}function Xo(t){this._internalRoot=t}Ei.prototype.render=Xo.prototype.render=function(t){var a=this._internalRoot;if(a===null)throw Error(c(409));var s=a.current,n=za();Xh(s,n,t,a,null,null)},Ei.prototype.unmount=Xo.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var a=t.containerInfo;Xh(t.current,2,null,t,null,null),ci(),a[Ye]=null}};function Ei(t){this._internalRoot=t}Ei.prototype.unstable_scheduleHydration=function(t){if(t){var a=ie();t={blockedOn:null,target:t,priority:a};for(var s=0;s<Ks.length&&a!==0&&a<Ks[s].priority;s++);Ks.splice(s,0,t),s===0&&ef(t)}};var nf=l.version;if(nf!=="19.2.0")throw Error(c(527,nf,"19.2.0"));V.findDOMNode=function(t){var a=t._reactInternals;if(a===void 0)throw typeof t.render=="function"?Error(c(188)):(t=Object.keys(t).join(","),Error(c(268,t)));return t=y(a),t=t!==null?g(t):null,t=t===null?null:t.stateNode,t};var bx={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Di=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Di.isDisabled&&Di.supportsFiber)try{Me=Di.inject(bx),Se=Di}catch{}}return ul.createRoot=function(t,a){if(!m(t))throw Error(c(299));var s=!1,n="",i=um,d=mm,h=hm;return a!=null&&(a.unstable_strictMode===!0&&(s=!0),a.identifierPrefix!==void 0&&(n=a.identifierPrefix),a.onUncaughtError!==void 0&&(i=a.onUncaughtError),a.onCaughtError!==void 0&&(d=a.onCaughtError),a.onRecoverableError!==void 0&&(h=a.onRecoverableError)),a=Ph(t,1,!1,null,null,s,n,null,i,d,h,sf),t[Ye]=a.current,Do(t),new Xo(a)},ul.hydrateRoot=function(t,a,s){if(!m(t))throw Error(c(299));var n=!1,i="",d=um,h=mm,b=hm,O=null;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(i=s.identifierPrefix),s.onUncaughtError!==void 0&&(d=s.onUncaughtError),s.onCaughtError!==void 0&&(h=s.onCaughtError),s.onRecoverableError!==void 0&&(b=s.onRecoverableError),s.formState!==void 0&&(O=s.formState)),a=Ph(t,1,!0,a,s??null,n,i,O,d,h,b,sf),a.context=Qh(null),s=a.current,n=za(),n=Xe(n),i=Us(n),i.callback=null,Ls(s,i,n),s=n,a.current.lanes=s,dt(a,s),ss(a),t[Ye]=a.current,Do(t),new Ei(a)},ul.version="19.2.0",ul}var uf;function Rx(){if(uf)return Zo.exports;uf=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(l){console.error(l)}}return r(),Zo.exports=Tx(),Zo.exports}var qx=Rx();const zx=$f(qx),Ox="fieldsync-offline",Ux=1,ea={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let Dn=null;const Ds=()=>new Promise((r,l)=>{if(Dn){r(Dn);return}const o=indexedDB.open(Ox,Ux);o.onerror=()=>{console.error("Failed to open offline database"),l(o.error)},o.onsuccess=()=>{Dn=o.result,console.log("Offline database initialized"),r(Dn)},o.onupgradeneeded=c=>{const m=c.target.result;if(m.objectStoreNames.contains(ea.PROJECTS)||m.createObjectStore(ea.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),m.objectStoreNames.contains(ea.AREAS)||m.createObjectStore(ea.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),m.objectStoreNames.contains(ea.CREW_CHECKINS)||m.createObjectStore(ea.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!m.objectStoreNames.contains(ea.PENDING_ACTIONS)){const u=m.createObjectStore(ea.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});u.createIndex("type","type",{unique:!1}),u.createIndex("created_at","created_at",{unique:!1})}m.objectStoreNames.contains(ea.CACHED_DATA)||m.createObjectStore(ea.CACHED_DATA,{keyPath:"key"})}}),Rn=(r,l="readonly")=>{if(!Dn)throw new Error("Database not initialized");return Dn.transaction(r,l).objectStore(r)},Lx=async(r,l)=>(await Ds(),new Promise((o,c)=>{const u=Rn(r,"readwrite").put(l);u.onsuccess=()=>o(u.result),u.onerror=()=>c(u.error)})),Vf=async(r,l)=>(await Ds(),new Promise((o,c)=>{const m=Dn.transaction(r,"readwrite"),u=m.objectStore(r);l.forEach(j=>u.put(j)),m.oncomplete=()=>o(),m.onerror=()=>c(m.error)})),Hx=async(r,l)=>(await Ds(),new Promise((o,c)=>{const u=Rn(r).get(l);u.onsuccess=()=>o(u.result),u.onerror=()=>c(u.error)})),Gf=async r=>(await Ds(),new Promise((l,o)=>{const m=Rn(r).getAll();m.onsuccess=()=>l(m.result||[]),m.onerror=()=>o(m.error)})),Yf=async(r,l,o)=>(await Ds(),new Promise((c,m)=>{const p=Rn(r).index(l).getAll(o);p.onsuccess=()=>c(p.result||[]),p.onerror=()=>m(p.error)})),Bx=async(r,l)=>(await Ds(),new Promise((o,c)=>{const u=Rn(r,"readwrite").delete(l);u.onsuccess=()=>o(),u.onerror=()=>c(u.error)})),nn={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},mf=async(r,l,o={})=>{await Ds();const c={type:r,payload:l,metadata:o,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((m,u)=>{const p=Rn(ea.PENDING_ACTIONS,"readwrite").add(c);p.onsuccess=()=>{console.log(`Queued offline action: ${r}`),m(p.result)},p.onerror=()=>u(p.error)})},Pf=async()=>Gf(ea.PENDING_ACTIONS),Wo=async()=>(await Pf()).length,Fx=async r=>Bx(ea.PENDING_ACTIONS,r),$x=async(r,l)=>(await Ds(),new Promise((o,c)=>{const m=Rn(ea.PENDING_ACTIONS,"readwrite"),u=m.get(r);u.onsuccess=()=>{const j=u.result;if(j){const p={...j,...l},x=m.put(p);x.onsuccess=()=>o(p),x.onerror=()=>c(x.error)}else c(new Error("Action not found"))},u.onerror=()=>c(u.error)})),Vx=async r=>Vf(ea.PROJECTS,r),hf=async r=>r?Yf(ea.PROJECTS,"company_id",r):Gf(ea.PROJECTS),Gx=async r=>Vf(ea.AREAS,r),ff=async r=>Yf(ea.AREAS,"project_id",r),ed=async(r,l)=>{const o=await Hx(ea.AREAS,r);return o&&(o.status=l,o.updated_at=new Date().toISOString(),await Lx(ea.AREAS,o)),o};let jd=navigator.onLine;const fd=new Set,Qf=r=>(fd.add(r),()=>fd.delete(r)),ml=()=>jd,pf=r=>{jd=r,fd.forEach(l=>l(r))};typeof window<"u"&&(window.addEventListener("online",()=>{console.log("Connection restored"),pf(!0)}),window.addEventListener("offline",()=>{console.log("Connection lost"),pf(!1)}));let td=!1;const Yx=async r=>{if(td||!jd)return{synced:0,failed:0};td=!0;const l={synced:0,failed:0};try{const o=await Pf();console.log(`Syncing ${o.length} pending actions...`);for(const c of o)try{await Px(c,r),await Fx(c.id),l.synced++,console.log(`Synced action: ${c.type}`)}catch(m){console.error(`Failed to sync action ${c.type}:`,m),l.failed++,await $x(c.id,{attempts:(c.attempts||0)+1,last_error:m.message,last_attempt:new Date().toISOString()})}}finally{td=!1}return l},Px=async(r,l)=>{const{type:o,payload:c}=r;switch(o){case nn.UPDATE_AREA_STATUS:return l.updateAreaStatus(c.areaId,c.status);case nn.CREATE_TM_TICKET:const m=await l.createTMTicket(c.ticket);return c.workers?.length>0&&await l.addTMWorkers(m.id,c.workers),c.items?.length>0&&await l.addTMItems(m.id,c.items),m;case nn.SAVE_CREW_CHECKIN:return l.saveCrewCheckin(c.projectId,c.workers,c.checkInDate);case nn.SUBMIT_DAILY_REPORT:return await l.saveDailyReport(c.projectId,c.reportData),l.submitDailyReport(c.projectId,c.submittedBy);case nn.SEND_MESSAGE:return l.sendMessage(c.projectId,c.senderType,c.senderName,c.content);case nn.CREATE_MATERIAL_REQUEST:return l.createMaterialRequest(c.projectId,c.items,c.requestedBy,c.neededBy,c.priority,c.notes);default:throw new Error(`Unknown action type: ${o}`)}},Qx="https://cegifnrcwdilromcyouq.supabase.co",Xf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlZ2lmbnJjd2RpbHJvbWN5b3VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTQ5OTAsImV4cCI6MjA4MDIzMDk5MH0.qAiBG5XaB0C1E0U2tQbQkrhpm1iUhM6A2MXngEHhX4A",G=!!Xf;Ds().catch(r=>console.error("Failed to init offline DB:",r));const R=G?Sx(Qx,Xf):null,If="fieldsync_data",pd="fieldsync_user",Qe=()=>{const r=localStorage.getItem(If);return r?JSON.parse(r):{projects:[],areas:[],users:[],assignments:[]}},xt=r=>{localStorage.setItem(If,JSON.stringify(r))},Mi=()=>{const r=localStorage.getItem(pd);return r?JSON.parse(r):null},Ai=r=>{r?localStorage.setItem(pd,JSON.stringify(r)):localStorage.removeItem(pd)},gf={async signUp(r,l,o,c){if(G){const{data:m,error:u}=await R.auth.signUp({email:r,password:l,options:{data:{name:o,role:c}}});if(u)throw u;return m}else{const m=Qe(),u={id:crypto.randomUUID(),email:r,name:o,role:c,created_at:new Date().toISOString()};return m.users.push(u),xt(m),Ai(u),{user:u}}},async signIn(r,l){if(G){const{data:o,error:c}=await R.auth.signInWithPassword({email:r,password:l});if(c)throw c;return o}else{const c=Qe().users.find(m=>m.email===r);if(!c)throw new Error("User not found");return Ai(c),{user:c}}},async signOut(){if(G){const{error:r}=await R.auth.signOut();if(r)throw r}else Ai(null)},async getUser(){if(G){const{data:{user:r}}=await R.auth.getUser();return r}else return Mi()},async getProfile(){if(G){const{data:{user:r}}=await R.auth.getUser();if(!r)return null;const{data:l,error:o}=await R.from("users").select("*").eq("id",r.id).single();return o?{id:r.id,email:r.email,name:r.user_metadata?.name||"",role:r.user_metadata?.role||"foreman"}:l}else return Mi()},async updateRole(r,l){if(G){const{data:o,error:c}=await R.from("users").update({role:l}).eq("id",r).select().single();if(c)throw c;return o}else{const o=Qe(),c=o.users.find(m=>m.id===r);return c&&(c.role=l,xt(o),Mi()?.id===r&&Ai(c)),c}},onAuthStateChange(r){if(G)return R.auth.onAuthStateChange(r);{const l=Mi();return r(l?"SIGNED_IN":"SIGNED_OUT",{user:l}),{data:{subscription:{unsubscribe:()=>{}}}}}}},se={async getProjects(r=null,l=!1){if(G){if(!ml()){console.log("Offline: returning cached projects");const u=await hf(r);return l?u:u.filter(j=>j.status!=="archived")}let o=R.from("projects").select("*").order("created_at",{ascending:!1});r&&(o=o.eq("company_id",r)),l||(o=o.eq("status","active"));const{data:c,error:m}=await o;if(m){console.log("Error fetching projects, trying cache:",m.message);const u=await hf(r);if(u.length>0)return u;throw m}return c?.length>0&&Vx(c).catch(u=>console.error("Failed to cache projects:",u)),c}else{const o=Qe().projects;return l?o:o.filter(c=>c.status!=="archived")}},async getArchivedProjects(r){if(G){const{data:l,error:o}=await R.from("projects").select("*").eq("company_id",r).eq("status","archived").order("archived_at",{ascending:!1});if(o)throw o;return l}else return Qe().projects.filter(l=>l.status==="archived")},async getProjectCount(r){if(G){const{count:l,error:o}=await R.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",r).in("status",["active","archived"]);if(o)throw o;return l||0}else return Qe().projects.filter(o=>o.company_id===r&&o.status!=="deleted").length},async archiveProject(r){if(G){const{data:l,error:o}=await R.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",r).select().single();if(o)throw o;return l}else{const l=Qe(),o=l.projects.find(c=>c.id===r);return o&&(o.status="archived",o.archived_at=new Date().toISOString(),xt(l)),o}},async getProjectStorageStats(r){if(!G)return{photoCount:0,estimatedMB:0};const{data:l,error:o}=await R.from("t_and_m_tickets").select("photos").eq("project_id",r);if(o)throw o;let c=0;const m=[];l?.forEach(j=>{j.photos&&Array.isArray(j.photos)&&(c+=j.photos.length,m.push(...j.photos))});const u=c*1.5;return{photoCount:c,estimatedMB:u,photoUrls:m}},async archiveProjectDeep(r,l){if(!G)return null;const{photoUrls:o}=await this.getProjectStorageStats(r);if(o.length>0){const u=o.map(j=>{try{const x=new URL(j).pathname.match(/\/tm-photos\/(.+)$/);return x?x[1]:null}catch{return null}}).filter(Boolean);if(u.length>0)for(let j=0;j<u.length;j+=100){const p=u.slice(j,j+100);await R.storage.from("tm-photos").remove(p)}}await R.from("t_and_m_tickets").update({photos:[]}).eq("project_id",r);const{data:c,error:m}=await R.from("projects").update({status:"archived",archived_at:new Date().toISOString(),photos:[],storage_cleaned:!0}).eq("id",r).select().single();if(m)throw m;return{...c,photosDeleted:o.length}},async restoreProject(r){if(G){const{data:l,error:o}=await R.from("projects").update({status:"active",archived_at:null}).eq("id",r).select().single();if(o)throw o;return l}else{const l=Qe(),o=l.projects.find(c=>c.id===r);return o&&(o.status="active",o.archived_at=null,xt(l)),o}},async getProject(r){if(G){const{data:l,error:o}=await R.from("projects").select("*").eq("id",r).single();if(o)throw o;return l}else return Qe().projects.find(l=>l.id===r)},async createProject(r){if(G){console.log("Creating project with data:",r);const{data:l,error:o}=await R.from("projects").insert({...r,status:"active"}).select().single();if(o)throw console.error("Supabase createProject error:",o.message,o.details,o.hint),o;return l}else{const l=Qe(),o={...r,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return l.projects.push(o),xt(l),o}},async getProjectByPin(r){if(G){const{data:l,error:o}=await R.from("projects").select("*").eq("pin",r).eq("status","active").single();return o?null:l}else return Qe().projects.find(o=>o.pin===r&&o.status==="active")||null},async getProjectByPinAndCompany(r,l){if(G){const{data:o,error:c}=await R.from("projects").select("*").eq("pin",r).eq("company_id",l).eq("status","active").single();return c?null:o}else return Qe().projects.find(c=>c.pin===r&&c.company_id===l&&c.status==="active")||null},async isPinAvailable(r,l=null){if(G){let o=R.from("projects").select("id").eq("pin",r);l&&(o=o.neq("id",l));const{data:c,error:m}=await o;if(m)throw m;return c.length===0}else return!Qe().projects.some(c=>c.pin===r&&c.id!==l)},async updateProjectPin(r,l){if(G){const{data:o,error:c}=await R.from("projects").update({pin:l}).eq("id",r).select().single();if(c)throw c;return o}else{const o=Qe(),c=o.projects.find(m=>m.id===r);return c&&(c.pin=l,xt(o)),c}},async updateProject(r,l){if(G){const{data:o,error:c}=await R.from("projects").update(l).eq("id",r).select().single();if(c)throw console.error("Error updating project:",c),c;return o}else{const o=Qe(),c=o.projects.find(m=>m.id===r);return c&&(Object.assign(c,l),xt(o)),c}},async deleteProject(r){if(G){const{error:l}=await R.from("projects").delete().eq("id",r);if(l)throw l}else{const l=Qe();l.projects=l.projects.filter(o=>o.id!==r),l.areas=l.areas.filter(o=>o.project_id!==r),xt(l)}},async getAreas(r){if(G){if(!ml())return console.log("Offline: returning cached areas"),ff(r);const{data:l,error:o}=await R.from("areas").select("*").eq("project_id",r).order("sort_order",{ascending:!0});if(o){console.log("Error fetching areas, trying cache:",o.message);const c=await ff(r);if(c.length>0)return c;throw o}return l?.length>0&&Gx(l).catch(c=>console.error("Failed to cache areas:",c)),l}else return Qe().areas.filter(l=>l.project_id===r)},async createArea(r){if(G){const{data:l,error:o}=await R.from("areas").insert(r).select().single();if(o)throw o;return l}else{const l=Qe(),o={...r,id:crypto.randomUUID(),created_at:new Date().toISOString()};return l.areas.push(o),xt(l),o}},async updateAreaStatus(r,l){if(G){if(!ml()){console.log("Offline: queuing area status update");const m=await ed(r,l);return await mf(nn.UPDATE_AREA_STATUS,{areaId:r,status:l}),m}const{data:o,error:c}=await R.from("areas").update({status:l}).eq("id",r).select().single();if(c){if(c.message?.includes("fetch")||c.message?.includes("network")){console.log("Network error: queuing area status update");const m=await ed(r,l);return await mf(nn.UPDATE_AREA_STATUS,{areaId:r,status:l}),m}throw c}return o&&ed(r,l).catch(m=>console.error("Failed to update cached area:",m)),o}else{const o=Qe(),c=o.areas.find(m=>m.id===r);return c&&(c.status=l,c.updated_at=new Date().toISOString()),xt(o),c}},async updateArea(r,l){if(G){const{data:o,error:c}=await R.from("areas").update(l).eq("id",r).select().single();if(c)throw c;return o}else{const o=Qe(),c=o.areas.find(m=>m.id===r);return c&&(Object.assign(c,l),c.updated_at=new Date().toISOString()),xt(o),c}},async deleteArea(r){if(G){const{error:l}=await R.from("areas").delete().eq("id",r);if(l)throw l}else{const l=Qe();l.areas=l.areas.filter(o=>o.id!==r),xt(l)}},subscribeToAreas(r,l){return G?R.channel(`areas:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMessages(r,l){return G?R.channel(`messages:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMaterialRequests(r,l){return G?R.channel(`material_requests:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToDailyReports(r,l){return G?R.channel(`daily_reports:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCrewCheckins(r,l){return G?R.channel(`crew_checkins:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToInjuryReports(r,l){return G?R.channel(`injury_reports:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},l).subscribe():null},subscribeToTMTickets(r,l){return G?R.channel(`tm_tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCompanyActivity(r,l,o){if(!G||!l||l.length===0)return null;const c=R.channel(`company_activity:${r}`);return l.forEach(m=>{c.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${m}`},u=>o.onMessage?.(u)),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"material_requests",filter:`project_id=eq.${m}`},u=>o.onMaterialRequest?.(u)),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${m}`},u=>o.onTMTicket?.(u))}),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},m=>o.onInjuryReport?.(m)),c.subscribe()},unsubscribe(r){r&&G&&R.removeChannel(r)},async getAssignedProjects(r){if(G){const{data:l,error:o}=await R.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",r);if(o)throw o;return l.map(c=>c.projects)}else{const l=Qe();return(l.assignments?.filter(c=>c.user_id===r)||[]).map(c=>l.projects.find(m=>m.id===c.project_id)).filter(Boolean)}},async assignUserToProject(r,l,o){if(G){const{data:c,error:m}=await R.from("project_assignments").insert({project_id:r,user_id:l,assigned_by:o}).select().single();if(m)throw m;return c}else{const c=Qe();c.assignments||(c.assignments=[]);const m={id:crypto.randomUUID(),project_id:r,user_id:l,assigned_by:o,assigned_at:new Date().toISOString()};return c.assignments.push(m),xt(c),m}},async removeUserFromProject(r,l){if(G){const{error:o}=await R.from("project_assignments").delete().eq("project_id",r).eq("user_id",l);if(o)throw o}else{const o=Qe();o.assignments=o.assignments?.filter(c=>!(c.project_id===r&&c.user_id===l))||[],xt(o)}},async getProjectAssignments(r){if(G){const{data:l,error:o}=await R.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",r);if(o)throw o;return l.map(c=>c.users)}else{const l=Qe();return(l.assignments?.filter(c=>c.project_id===r)||[]).map(c=>l.users.find(m=>m.id===c.user_id)).filter(Boolean)}},async getAllUsers(){if(G){const{data:r,error:l}=await R.from("users").select("*").order("name");if(l)throw l;return r}else return Qe().users||[]},async getForemen(){if(G){const{data:r,error:l}=await R.from("users").select("*").eq("role","foreman").order("name");if(l)throw l;return r}else return(Qe().users||[]).filter(r=>r.role==="foreman")},async logActivity(r,l,o,c,m,u){if(G){const{error:j}=await R.from("activity_log").insert({user_id:r,project_id:l,area_id:o,action:c,old_value:m,new_value:u});j&&console.error("Error logging activity:",j)}},async getProjectActivity(r,l=50){if(G){const{data:o,error:c}=await R.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",r).order("created_at",{ascending:!1}).limit(l);if(c)throw c;return o}return[]},async getMaterialsEquipment(r){if(G){const{data:l,error:o}=await R.from("materials_equipment").select("*").eq("company_id",r).eq("active",!0).order("category").order("name");if(o)throw o;return l}return[]},async getMaterialsEquipmentByCategory(r,l){if(G){const{data:o,error:c}=await R.from("materials_equipment").select("*").eq("company_id",r).eq("category",l).eq("active",!0).order("name");if(c)throw c;return o}return[]},async getAllMaterialsEquipment(r){if(G){const{data:l,error:o}=await R.from("materials_equipment").select("*").eq("company_id",r).order("category").order("name");if(o)throw o;return l}return[]},async createMaterialEquipment(r){if(G){const{data:l,error:o}=await R.from("materials_equipment").insert(r).select().single();if(o)throw o;return l}return null},async updateMaterialEquipment(r,l){if(G){const{data:o,error:c}=await R.from("materials_equipment").update(l).eq("id",r).select().single();if(c)throw c;return o}return null},async deleteMaterialEquipment(r){if(G){const{error:l}=await R.from("materials_equipment").update({active:!1}).eq("id",r);if(l)throw l}},async getTMTickets(r){if(G){const{data:l,error:o}=await R.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).order("created_at",{ascending:!1});if(o)throw o;return l}return[]},async getChangeOrderTotals(r){if(G){const{data:l,error:o}=await R.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",r).not("ce_pco_number","is",null).neq("ce_pco_number","");if(o)throw o;const c={};let m=0,u=0;return l?.forEach(j=>{const p=j.ce_pco_number;if(c[p]||(c[p]={approved:0,pending:0,count:0}),c[p].count++,j.status==="approved"||j.status==="billed"){const x=parseFloat(j.change_order_value)||0;c[p].approved+=x,m+=x}else j.status==="pending"&&u++}),{changeOrders:c,totalApprovedValue:m,pendingCount:u}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(r,l){if(G){const{data:o,error:c}=await R.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).eq("status",l).order("created_at",{ascending:!1});if(c)throw c;return o}return[]},async getCORTickets(r){if(G){const{data:l,error:o}=await R.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",r).order("work_date",{ascending:!0});if(o)throw o;return l||[]}return[]},async createTMTicket(r){if(G){const{data:l,error:o}=await R.from("t_and_m_tickets").insert({project_id:r.project_id,work_date:r.work_date,ce_pco_number:r.ce_pco_number||null,assigned_cor_id:r.assigned_cor_id||null,notes:r.notes,photos:r.photos||[],status:"pending",created_by_name:r.created_by_name||"Field User"}).select().single();if(o)throw o;return l}return null},async addTMWorkers(r,l){if(G){const o=l.map(m=>({ticket_id:r,name:m.name,hours:m.hours,overtime_hours:m.overtime_hours||0,time_started:m.time_started||null,time_ended:m.time_ended||null,role:m.role||"Laborer"})),{error:c}=await R.from("t_and_m_workers").insert(o);if(c)throw c}},async addTMItems(r,l){if(G){const o=l.map(m=>({ticket_id:r,material_equipment_id:m.material_equipment_id||null,custom_name:m.custom_name||null,custom_category:m.custom_category||null,quantity:m.quantity})),{error:c}=await R.from("t_and_m_items").insert(o);if(c)throw c}},async getPreviousTicketCrew(r,l){if(!G)return null;const{data:o,error:c}=await R.from("t_and_m_tickets").select(`
        id,
        work_date,
        t_and_m_workers (*)
      `).eq("project_id",r).lt("work_date",l).order("work_date",{ascending:!1}).limit(1).single();if(c||!o)return null;const m=o.t_and_m_workers||[],u=m.filter(x=>["Foreman","General Foreman","Superintendent"].includes(x.role)).map(x=>({name:x.name,hours:x.hours?.toString()||"",overtimeHours:x.overtime_hours?.toString()||"",timeStarted:x.time_started||"",timeEnded:x.time_ended||"",role:x.role})),j=m.filter(x=>x.role==="Operator").map(x=>({name:x.name,hours:x.hours?.toString()||"",overtimeHours:x.overtime_hours?.toString()||"",timeStarted:x.time_started||"",timeEnded:x.time_ended||""})),p=m.filter(x=>x.role==="Laborer").map(x=>({name:x.name,hours:x.hours?.toString()||"",overtimeHours:x.overtime_hours?.toString()||"",timeStarted:x.time_started||"",timeEnded:x.time_ended||""}));return{workDate:o.work_date,supervision:u.length>0?u:null,operators:j.length>0?j:null,laborers:p.length>0?p:null,totalWorkers:m.length}},async updateTMTicketStatus(r,l){if(G){const{data:o,error:c}=await R.from("t_and_m_tickets").update({status:l}).eq("id",r).select().single();if(c)throw c;return o}return null},async approveTMTicket(r,l,o,c=null){if(G){const m={status:"approved",approved_by_user_id:l,approved_by_name:o,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};c!==null&&(m.change_order_value=parseFloat(c)||0);const{data:u,error:j}=await R.from("t_and_m_tickets").update(m).eq("id",r).select().single();if(j)throw j;return u}return null},async rejectTMTicket(r,l,o,c=""){if(G){const{data:m,error:u}=await R.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:l,rejected_by_name:o,rejected_at:new Date().toISOString(),rejection_reason:c,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",r).select().single();if(u)throw u;return m}return null},canApproveTickets(r){return["owner","admin","manager"].includes(r)},async updateTMTicketPhotos(r,l){if(G){const{data:o,error:c}=await R.from("t_and_m_tickets").update({photos:l}).eq("id",r).select().single();if(c)throw c;return o}return null},async deleteTMTicket(r){if(G){const{error:l}=await R.from("t_and_m_tickets").delete().eq("id",r);if(l)throw l}},async isTicketEditable(r){if(!r?.assigned_cor_id)return{editable:!0};if(G)try{const{data:l,error:o}=await R.from("change_orders").select("id, status, cor_number").eq("id",r.assigned_cor_id).single();if(o||!l)return{editable:!0};const m=["draft","pending_approval"].includes(l.status);return{editable:m,lockedBy:m?null:l,reason:m?null:`This ticket is linked to ${l.cor_number} which has been ${l.status==="approved"?"approved":l.status}`}}catch(l){return console.error("Error checking ticket editability:",l),{editable:!0}}return{editable:!0}},async getCompanyByCode(r){if(G){const{data:l,error:o}=await R.from("companies").select("*").eq("code",r).single();return o?null:l}return null},async getCompany(r){if(G){const{data:l,error:o}=await R.from("companies").select("*").eq("id",r).single();if(o)throw o;return l}return null},async getUserCompanies(r){if(G){const{data:l,error:o}=await R.from("user_companies").select(`
          id,
          access_level,
          company_id,
          status,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",r).eq("status","active").order("created_at",{ascending:!0});return o?(console.error("Error fetching user companies:",o),[]):l.map(c=>({id:c.companies.id,name:c.companies.name,code:c.companies.code,access_level:c.access_level}))}return[]},async getUserPendingMemberships(r){if(G){const{count:l,error:o}=await R.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r).eq("status","pending");return o?(console.error("Error fetching pending memberships:",o),0):l||0}return 0},async getCompanyMemberships(r){if(G){const{data:l,error:o}=await R.from("user_companies").select(`
          id,
          access_level,
          company_role,
          status,
          created_at,
          approved_at,
          approved_by,
          removed_at,
          removed_by,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).order("created_at",{ascending:!1});return o?(console.error("Error fetching company memberships:",o),[]):l||[]}return[]},async approveMembership(r,l){if(G){const{error:o}=await R.from("user_companies").update({status:"active",approved_at:new Date().toISOString(),approved_by:l}).eq("id",r);if(o)throw o}},async approveMembershipWithRole(r,l,o="member"){if(G){const{error:c}=await R.rpc("approve_membership_with_role",{membership_id:r,approved_by_user:l,new_access_level:o});if(c)throw c}},async rejectMembership(r){if(G){const{error:l}=await R.from("user_companies").delete().eq("id",r);if(l)throw l}},async removeMember(r,l){if(G){const{error:o}=await R.from("user_companies").update({status:"removed",removed_at:new Date().toISOString(),removed_by:l}).eq("id",r);if(o)throw o}},async getProjectTeam(r){if(G){const{data:l,error:o}=await R.from("project_users").select(`
          id,
          project_role,
          assigned_at,
          notes,
          users!project_users_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("project_id",r).order("assigned_at",{ascending:!0});return o?(console.error("Error fetching project team:",o),[]):l||[]}return[]},async getCompanyMembers(r){if(G){const{data:l,error:o}=await R.from("user_companies").select(`
          id,
          access_level,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).eq("status","active").order("created_at",{ascending:!0});return o?(console.error("Error fetching company members:",o),[]):l||[]}return[]},async addProjectMember(r,l,o,c){if(G){const{data:m,error:u}=await R.from("project_users").insert({project_id:r,user_id:l,project_role:o,assigned_by:c}).select().single();if(u)throw u;return m}return null},async updateProjectMemberRole(r,l,o){if(G){const{error:c}=await R.from("project_users").update({project_role:o}).eq("project_id",r).eq("user_id",l);if(c)throw c}},async removeProjectMember(r,l){if(G){const{error:o}=await R.from("project_users").delete().eq("project_id",r).eq("user_id",l);if(o)throw o}},async updateMemberAccessLevel(r,l){if(G){const{error:o}=await R.from("user_companies").update({access_level:l}).eq("id",r);if(o)throw o}},async updateMemberCompanyRole(r,l){if(G){const{error:o}=await R.from("user_companies").update({company_role:l}).eq("id",r);if(o)throw o}},async repairLegacyUser(r,l,o="member"){if(!G||!r||!l)return!1;try{const{data:c,error:m}=await R.rpc("repair_legacy_user",{p_user_id:r,p_company_id:l,p_role:o});return m?(console.error("RPC repair_legacy_user failed:",m),!1):(console.log("Legacy user repaired via RPC:",c),c===!0)}catch(c){return console.error("Error repairing legacy user:",c),!1}},async isLegacyUser(r){if(!G)return!1;try{const{data:l}=await R.from("users").select("company_id, role").eq("id",r).single();if(!l?.company_id)return!1;const{count:o}=await R.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r);return o===0}catch(l){return console.error("Error checking legacy user:",l),!1}},async uploadPhoto(r,l,o,c){if(!G)return null;const m=Date.now(),u=Math.random().toString(36).substring(7),j=c.name?.split(".").pop()||"jpg",p=`${m}-${u}.${j}`,x=`${r}/${l}/${o}/${p}`,{data:y,error:g}=await R.storage.from("tm-photos").upload(x,c,{cacheControl:"3600",upsert:!1});if(g)throw g;const{data:T}=R.storage.from("tm-photos").getPublicUrl(x);return T.publicUrl},async uploadPhotoBase64(r,l,o,c,m="photo.jpg"){if(!G)return null;const j=await(await fetch(c)).blob(),p=Date.now(),x=Math.random().toString(36).substring(7),y=m.split(".").pop()||"jpg",g=`${p}-${x}.${y}`,T=`${r}/${l}/${o}/${g}`,{data:B,error:U}=await R.storage.from("tm-photos").upload(T,j,{cacheControl:"3600",upsert:!1,contentType:j.type});if(U)throw U;const{data:F}=R.storage.from("tm-photos").getPublicUrl(T);return F.publicUrl},async deletePhoto(r){if(!G)return;const o=new URL(r).pathname.match(/\/tm-photos\/(.+)$/);if(!o)return;const c=o[1],{error:m}=await R.storage.from("tm-photos").remove([c]);if(m)throw m},async getCrewCheckin(r,l=null){if(!G)return null;const o=l||new Date().toISOString().split("T")[0],{data:c,error:m}=await R.from("crew_checkins").select("*").eq("project_id",r).eq("check_in_date",o).single();return m&&m.code!=="PGRST116"&&console.error("Error fetching crew checkin:",m),c},async saveCrewCheckin(r,l,o=null,c=null){if(!G)return null;const m=c||new Date().toISOString().split("T")[0],{data:u,error:j}=await R.from("crew_checkins").upsert({project_id:r,check_in_date:m,workers:l,created_by:o,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(j)throw console.error("Error saving crew checkin:",j),j;return u},async addCrewMember(r,l,o=null){if(!G)return null;const c=await this.getCrewCheckin(r),m=c?.workers||[];return m.find(u=>u.name.toLowerCase()===l.name.toLowerCase())?c:(m.push(l),await this.saveCrewCheckin(r,m,o))},async removeCrewMember(r,l){if(!G)return null;const o=await this.getCrewCheckin(r);if(!o)return null;const c=o.workers.filter(m=>m.name.toLowerCase()!==l.toLowerCase());return await this.saveCrewCheckin(r,c,o.created_by)},async getCrewCheckinHistory(r,l=30){if(!G)return[];const{data:o,error:c}=await R.from("crew_checkins").select("*").eq("project_id",r).order("check_in_date",{ascending:!1}).limit(l);return c?(console.error("Error fetching crew history:",c),[]):o||[]},async getLaborRates(r,l=null,o=null){if(!G)return[];let c=R.from("labor_rates").select("*").eq("company_id",r);l&&(c=c.eq("work_type",l)),o&&(c=c.eq("job_type",o));const{data:m,error:u}=await c;return u?(console.error("Error fetching labor rates:",u),[]):m||[]},async calculateManDayCosts(r,l,o,c){if(!G)return{totalCost:0,totalManDays:0,breakdown:[]};const m=await this.getCrewCheckinHistory(r,365),u=await this.getLaborRates(l,o,c),j={};u.forEach(T=>{j[T.role.toLowerCase()]=parseFloat(T.regular_rate)||0});let p=0,x=0;const y={},g=[];return m.forEach(T=>{const B=T.workers||[];let U=0;const F={};B.forEach(L=>{const J=(L.role||"laborer").toLowerCase(),W=j[J]||0;F[J]||(F[J]={count:0,cost:0}),F[J].count++,F[J].cost+=W,U+=W,y[J]||(y[J]={count:0,cost:0,rate:W}),y[J].count++,y[J].cost+=W}),p+=U,x+=B.length,g.push({date:T.check_in_date,workers:B.length,cost:U,breakdown:F})}),{totalCost:p,totalManDays:x,byRole:y,byDate:g,daysWorked:m.length}},async getDailyReport(r,l=null){if(!G)return null;const o=l||new Date().toISOString().split("T")[0],{data:c,error:m}=await R.from("daily_reports").select("*").eq("project_id",r).eq("report_date",o).single();return m&&m.code!=="PGRST116"&&console.error("Error fetching daily report:",m),c},async compileDailyReport(r,l=null){if(!G)return null;const o=l||new Date().toISOString().split("T")[0],c=await this.getCrewCheckin(r,o),{data:m}=await R.from("areas").select("*").eq("project_id",r),u=m?.filter(x=>x.status==="done"&&x.completed_at?.startsWith(o))||[],{data:j}=await R.from("t_and_m_tickets").select("*").eq("project_id",r).eq("work_date",o),p=j?.reduce((x,y)=>x+(y.photos?.length||0),0)||0;return{crew_count:c?.workers?.length||0,crew_list:c?.workers||[],tasks_completed:u.length,tasks_total:m?.length||0,completed_tasks:u.map(x=>({name:x.name,group:x.group_name})),tm_tickets_count:j?.length||0,photos_count:p}},async saveDailyReport(r,l,o=null){if(!G)return null;const c=o||new Date().toISOString().split("T")[0],{data:m,error:u}=await R.from("daily_reports").upsert({project_id:r,report_date:c,...l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(u)throw console.error("Error saving daily report:",u),u;return m},async submitDailyReport(r,l,o=null){if(!G)return null;const c=o||new Date().toISOString().split("T")[0],m=await this.compileDailyReport(r,c),{data:u,error:j}=await R.from("daily_reports").upsert({project_id:r,report_date:c,...m,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(j)throw console.error("Error submitting daily report:",j),j;return u},async getDailyReports(r,l=30){if(!G)return[];const{data:o,error:c}=await R.from("daily_reports").select("*").eq("project_id",r).order("report_date",{ascending:!1}).limit(l);return c?(console.error("Error fetching daily reports:",c),[]):o||[]},async sendMessage(r,l,o,c,m=null,u=null,j="general",p=null){if(!G)return null;const{data:x,error:y}=await R.from("messages").insert({project_id:r,sender_type:o,sender_name:c,sender_user_id:m,message:l,photo_url:u,message_type:j,parent_message_id:p}).select().single();if(y)throw console.error("Error sending message:",y),y;return x},async getMessages(r,l=50){if(!G)return[];const{data:o,error:c}=await R.from("messages").select("*").eq("project_id",r).order("created_at",{ascending:!1}).limit(l);return c?(console.error("Error fetching messages:",c),[]):o||[]},async getUnreadCount(r,l){if(!G)return 0;const o=l==="field"?"office":"field",{count:c,error:m}=await R.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("sender_type",o).eq("is_read",!1);return m?(console.error("Error getting unread count:",m),0):c||0},async markMessagesRead(r,l){if(!G)return;const o=l==="field"?"office":"field",{error:c}=await R.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",r).eq("sender_type",o).eq("is_read",!1);c&&console.error("Error marking messages read:",c)},async createMaterialRequest(r,l,o,c=null,m="normal",u=null){if(!G)return null;const{data:j,error:p}=await R.from("material_requests").insert({project_id:r,items:l,requested_by:o,needed_by:c,priority:m,notes:u}).select().single();if(p)throw console.error("Error creating material request:",p),p;return j},async getMaterialRequests(r,l=null){if(!G)return[];let o=R.from("material_requests").select("*").eq("project_id",r).order("created_at",{ascending:!1});l&&(o=o.eq("status",l));const{data:c,error:m}=await o;return m?(console.error("Error fetching material requests:",m),[]):c||[]},async getPendingRequestsCount(r){if(!G)return 0;const{count:l,error:o}=await R.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("status","pending");return o?0:l||0},async updateMaterialRequest(r,l,o,c=null,m=null){if(!G)return null;const u={status:l,responded_by:o,responded_at:new Date().toISOString(),response_notes:c,updated_at:new Date().toISOString()};m&&(u.expected_delivery=m),l==="delivered"&&(u.delivered_at=new Date().toISOString());const{data:j,error:p}=await R.from("material_requests").update(u).eq("id",r).select().single();if(p)throw console.error("Error updating material request:",p),p;return j},generateShareToken(){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let l="";for(let o=0;o<12;o++)l+=r.charAt(Math.floor(Math.random()*r.length));return l},async createProjectShare(r,l,o,c=null){if(!G){const x=Qe();x.projectShares||(x.projectShares=[]);const y={id:crypto.randomUUID(),project_id:r,share_token:this.generateShareToken(),created_by:l,expires_at:c,is_active:!0,permissions:o,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return x.projectShares.push(y),xt(x),y}const{data:m,error:u}=await R.rpc("generate_share_token");if(u)throw console.error("Error generating share token:",u),u;const{data:j,error:p}=await R.from("project_shares").insert({project_id:r,share_token:m,created_by:l,expires_at:c,permissions:o}).select().single();if(p)throw console.error("Error creating project share:",p),p;return j},async getShareByToken(r){if(!G){const c=Qe();if(!c.projectShares)return null;const m=c.projectShares.find(u=>u.share_token===r&&u.is_active&&(!u.expires_at||new Date(u.expires_at)>new Date));return m&&(m.view_count++,m.last_viewed_at=new Date().toISOString(),xt(c)),m}const{data:l,error:o}=await R.from("project_shares").select("*, projects(*)").eq("share_token",r).eq("is_active",!0).single();return o?(console.error("Error fetching share by token:",o),null):l.expires_at&&new Date(l.expires_at)<new Date?null:(await R.rpc("increment_share_view_count",{token:r}),l)},async getProjectShares(r){if(!G){const c=Qe();return c.projectShares?c.projectShares.filter(m=>m.project_id===r):[]}const{data:l,error:o}=await R.from("project_shares").select("*, users(name, email)").eq("project_id",r).order("created_at",{ascending:!1});return o?(console.error("Error fetching project shares:",o),[]):l||[]},async updateProjectShare(r,l){if(!G){const m=Qe();if(!m.projectShares)return null;const u=m.projectShares.findIndex(j=>j.id===r);return u===-1?null:(m.projectShares[u]={...m.projectShares[u],...l,updated_at:new Date().toISOString()},xt(m),m.projectShares[u])}const{data:o,error:c}=await R.from("project_shares").update(l).eq("id",r).select().single();if(c)throw console.error("Error updating project share:",c),c;return o},async revokeProjectShare(r){return this.updateProjectShare(r,{is_active:!1})},async deleteProjectShare(r){if(!G){const o=Qe();if(!o.projectShares)return;o.projectShares=o.projectShares.filter(c=>c.id!==r),xt(o);return}const{error:l}=await R.from("project_shares").delete().eq("id",r);if(l)throw console.error("Error deleting project share:",l),l},async getPublicProjectData(r){const l=await this.getShareByToken(r);if(!l)return null;const o=l.project_id||l.projects?.id;if(!G){const u=Qe(),j=u.projects.find(T=>T.id===o);if(!j)return null;const p=u.areas.filter(T=>T.project_id===o),x=p.reduce((T,B)=>T+parseFloat(B.weight||0),0),y=p.filter(T=>T.status==="done").reduce((T,B)=>T+parseFloat(B.weight||0),0),g=x>0?Math.round(y/x*100):0;return{share:l,project:j,progress:g,areas:l.permissions.progress?p:[],photos:[],dailyReports:[],tmTickets:[]}}const c=l.projects||await this.getProject(o);if(!c)return null;const m={share:l,project:c,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(l.permissions.progress){m.areas=await this.getAreas(o);const u=m.areas.reduce((p,x)=>p+parseFloat(x.weight||0),0),j=m.areas.filter(p=>p.status==="done").reduce((p,x)=>p+parseFloat(x.weight||0),0);m.progress=u>0?Math.round(j/u*100):0}if(l.permissions.photos){const{data:u}=await R.from("t_and_m_tickets").select("photos, work_date").eq("project_id",o).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);m.photos=u?.flatMap(j=>(j.photos||[]).map(p=>({url:p,date:j.work_date})))||[]}if(l.permissions.daily_reports){const{data:u}=await R.from("daily_reports").select("*").eq("project_id",o).order("report_date",{ascending:!1}).limit(10);m.dailyReports=u||[]}return l.permissions.tm_tickets&&(m.tmTickets=await this.getTMTickets(o)),m},async createInjuryReport(r){if(!G){const c=Qe();c.injuryReports||(c.injuryReports=[]);const m={id:crypto.randomUUID(),...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return c.injuryReports.push(m),xt(c),m}const{data:l,error:o}=await R.from("injury_reports").insert(r).select().single();if(o)throw console.error("Error creating injury report:",o),o;return l},async getInjuryReports(r){if(!G){const c=Qe();return c.injuryReports?c.injuryReports.filter(m=>m.project_id===r).sort((m,u)=>new Date(u.incident_date)-new Date(m.incident_date)):[]}const{data:l,error:o}=await R.from("injury_reports").select("*").eq("project_id",r).order("incident_date",{ascending:!1});return o?(console.error("Error fetching injury reports:",o),[]):l||[]},async getCompanyInjuryReports(r,l=null){if(!G){const u=Qe();if(!u.injuryReports)return[];let j=u.injuryReports.filter(p=>p.company_id===r);return l&&(j=j.filter(p=>p.status===l)),j.sort((p,x)=>new Date(x.incident_date)-new Date(p.incident_date))}let o=R.from("injury_reports").select("*, projects(name)").eq("company_id",r).order("incident_date",{ascending:!1});l&&(o=o.eq("status",l));const{data:c,error:m}=await o;return m?(console.error("Error fetching company injury reports:",m),[]):c||[]},async getInjuryReport(r){if(!G){const c=Qe();return c.injuryReports?c.injuryReports.find(m=>m.id===r):null}const{data:l,error:o}=await R.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",r).single();return o?(console.error("Error fetching injury report:",o),null):l},async updateInjuryReport(r,l){if(!G){const m=Qe();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(j=>j.id===r);return u===-1?null:(m.injuryReports[u]={...m.injuryReports[u],...l,updated_at:new Date().toISOString()},xt(m),m.injuryReports[u])}const{data:o,error:c}=await R.from("injury_reports").update(l).eq("id",r).select().single();if(c)throw console.error("Error updating injury report:",c),c;return o},async closeInjuryReport(r,l){return this.updateInjuryReport(r,{status:"closed",closed_at:new Date().toISOString(),closed_by:l})},async deleteInjuryReport(r){if(!G){const o=Qe();if(!o.injuryReports)return;o.injuryReports=o.injuryReports.filter(c=>c.id!==r),xt(o);return}const{error:l}=await R.from("injury_reports").delete().eq("id",r);if(l)throw console.error("Error deleting injury report:",l),l},async getInjuryStatistics(r,l=null,o=null){if(!G){const u=Qe();if(!u.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let j=u.injuryReports.filter(p=>p.company_id===r);return l&&(j=j.filter(p=>new Date(p.incident_date)>=new Date(l))),o&&(j=j.filter(p=>new Date(p.incident_date)<=new Date(o))),{total_incidents:j.length,minor_injuries:j.filter(p=>p.injury_type==="minor").length,serious_injuries:j.filter(p=>p.injury_type==="serious").length,critical_injuries:j.filter(p=>p.injury_type==="critical").length,near_misses:j.filter(p=>p.injury_type==="near_miss").length,osha_recordable:j.filter(p=>p.osha_recordable).length,total_days_away:j.reduce((p,x)=>p+(x.days_away_from_work||0),0),total_restricted_days:j.reduce((p,x)=>p+(x.restricted_work_days||0),0)}}const{data:c,error:m}=await R.rpc("get_injury_statistics",{comp_id:r,start_date:l,end_date:o});return m?(console.error("Error fetching injury statistics:",m),null):c[0]||null},async addWitness(r,l){if(!G){const m=Qe();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(x=>x.id===r);if(u===-1)return null;const j=m.injuryReports[u],p=j.witnesses||[];return p.push(l),m.injuryReports[u]={...j,witnesses:p,updated_at:new Date().toISOString()},xt(m),m.injuryReports[u]}const o=await this.getInjuryReport(r);if(!o)return null;const c=o.witnesses||[];return c.push(l),this.updateInjuryReport(r,{witnesses:c})},async removeWitness(r,l){if(!G){const m=Qe();if(!m.injuryReports)return null;const u=m.injuryReports.findIndex(x=>x.id===r);if(u===-1)return null;const j=m.injuryReports[u],p=j.witnesses||[];return p.splice(l,1),m.injuryReports[u]={...j,witnesses:p,updated_at:new Date().toISOString()},xt(m),m.injuryReports[u]}const o=await this.getInjuryReport(r);if(!o)return null;const c=o.witnesses||[];return c.splice(l,1),this.updateInjuryReport(r,{witnesses:c})},async getCompanyUsers(r){if(G){const{data:l,error:o}=await R.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",r);return o?(console.error("Error fetching company users:",o),[]):l?.map(c=>({id:c.user_id,name:c.users?.name||c.users?.email,email:c.users?.email,role:c.role}))||[]}return[]},async getProjectNotificationPreferences(r){if(G){const{data:o,error:c}=await R.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",r);return c?(console.error("Error fetching notification preferences:",c),[]):o||[]}const l=Qe();return l.notificationPreferences?l.notificationPreferences.filter(o=>o.project_id===r):[]},async getUserNotificationPreferences(r){if(G){const{data:o,error:c}=await R.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",r);return c?(console.error("Error fetching user notification preferences:",c),[]):o||[]}const l=Qe();return l.notificationPreferences?l.notificationPreferences.filter(o=>o.user_id===r):[]},async setNotificationPreference(r,l,o){if(G){const{data:j,error:p}=await R.from("notification_preferences").upsert({project_id:r,user_id:l,notification_types:o,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(p)throw console.error("Error setting notification preference:",p),p;return j}const c=Qe();c.notificationPreferences||(c.notificationPreferences=[]);const m=c.notificationPreferences.findIndex(j=>j.project_id===r&&j.user_id===l),u={id:m>=0?c.notificationPreferences[m].id:crypto.randomUUID(),project_id:r,user_id:l,notification_types:o,created_at:m>=0?c.notificationPreferences[m].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return m>=0?c.notificationPreferences[m]=u:c.notificationPreferences.push(u),xt(c),u},async removeNotificationPreference(r,l){if(G){const{error:c}=await R.from("notification_preferences").delete().eq("project_id",r).eq("user_id",l);if(c)throw console.error("Error removing notification preference:",c),c;return!0}const o=Qe();return o.notificationPreferences&&(o.notificationPreferences=o.notificationPreferences.filter(c=>!(c.project_id===r&&c.user_id===l)),xt(o)),!0},async setProjectNotificationPreferences(r,l){const o=[];for(const c of l)if(c.notificationTypes&&c.notificationTypes.length>0){const m=await this.setNotificationPreference(r,c.userId,c.notificationTypes);o.push(m)}else await this.removeNotificationPreference(r,c.userId);return o},async getNotificationPresets(r){if(G){const{data:o,error:c}=await R.from("notification_presets").select("*").eq("company_id",r).order("name");return c?(console.error("Error fetching notification presets:",c),[]):o||[]}const l=Qe();return l.notificationPresets?l.notificationPresets.filter(o=>o.company_id===r):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:r},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:r},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:r},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:r}]},async createNotificationPreset(r,l,o){if(G){const{data:u,error:j}=await R.from("notification_presets").insert({company_id:r,name:l,notification_types:o}).select().single();if(j)throw console.error("Error creating notification preset:",j),j;return u}const c=Qe();c.notificationPresets||(c.notificationPresets=[]);const m={id:crypto.randomUUID(),company_id:r,name:l,notification_types:o,created_at:new Date().toISOString()};return c.notificationPresets.push(m),xt(c),m},async updateNotificationPreset(r,l,o){if(G){const{data:u,error:j}=await R.from("notification_presets").update({name:l,notification_types:o,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(j)throw console.error("Error updating notification preset:",j),j;return u}const c=Qe();if(!c.notificationPresets)return null;const m=c.notificationPresets.findIndex(u=>u.id===r);return m===-1?null:(c.notificationPresets[m]={...c.notificationPresets[m],name:l,notification_types:o,updated_at:new Date().toISOString()},xt(c),c.notificationPresets[m])},async deleteNotificationPreset(r){if(G){const{error:o}=await R.from("notification_presets").delete().eq("id",r);if(o)throw console.error("Error deleting notification preset:",o),o;return!0}const l=Qe();return l.notificationPresets&&(l.notificationPresets=l.notificationPresets.filter(o=>o.id!==r),xt(l)),!0},async getDumpSites(r){if(G){const{data:o,error:c}=await R.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",r).eq("active",!0).order("name");return c?(console.error("Error fetching dump sites:",c),[]):o||[]}return(Qe().dumpSites||[]).filter(o=>o.company_id===r&&o.active)},async createDumpSite(r,l,o="",c=""){if(G){const{data:j,error:p}=await R.from("dump_sites").insert({company_id:r,name:l,address:o,notes:c,active:!0}).select().single();if(p)throw console.error("Error creating dump site:",p),p;return j}const m=Qe();m.dumpSites||(m.dumpSites=[]);const u={id:crypto.randomUUID(),company_id:r,name:l,address:o,notes:c,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return m.dumpSites.push(u),xt(m),u},async updateDumpSite(r,l){if(G){const{data:m,error:u}=await R.from("dump_sites").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(u)throw console.error("Error updating dump site:",u),u;return m}const o=Qe();if(!o.dumpSites)return null;const c=o.dumpSites.findIndex(m=>m.id===r);return c===-1?null:(o.dumpSites[c]={...o.dumpSites[c],...l},xt(o),o.dumpSites[c])},async deleteDumpSite(r){return this.updateDumpSite(r,{active:!1})},async setDumpSiteRate(r,l,o,c="load"){if(G){const{data:p}=await R.from("dump_site_rates").select("id").eq("dump_site_id",r).eq("waste_type",l).maybeSingle();if(p){const{data:x,error:y}=await R.from("dump_site_rates").update({estimated_cost_per_load:o,unit:c}).eq("id",p.id).select().single();if(y)throw console.error("Error updating dump site rate:",y),y;return x}else{const{data:x,error:y}=await R.from("dump_site_rates").insert({dump_site_id:r,waste_type:l,estimated_cost_per_load:o,unit:c}).select().single();if(y)throw console.error("Error inserting dump site rate:",y),y;return x}}const m=Qe();m.dumpSiteRates||(m.dumpSiteRates=[]);const u=m.dumpSiteRates.findIndex(p=>p.dump_site_id===r&&p.waste_type===l),j={id:u>=0?m.dumpSiteRates[u].id:crypto.randomUUID(),dump_site_id:r,waste_type:l,estimated_cost_per_load:o,unit:c,created_at:new Date().toISOString()};return u>=0?m.dumpSiteRates[u]=j:m.dumpSiteRates.push(j),xt(m),j},async getDumpSiteRates(r){if(G){const{data:o,error:c}=await R.from("dump_site_rates").select("*").eq("dump_site_id",r);return c?(console.error("Error fetching dump site rates:",c),[]):o||[]}return(Qe().dumpSiteRates||[]).filter(o=>o.dump_site_id===r)},async getHaulOffs(r){if(G){const{data:o,error:c}=await R.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",r).order("work_date",{ascending:!1});return c?(console.error("Error fetching haul-offs:",c),[]):o||[]}return(Qe().haulOffs||[]).filter(o=>o.project_id===r).sort((o,c)=>new Date(c.work_date)-new Date(o.work_date))},async createHaulOff(r,l){const o={project_id:r,dump_site_id:l.dumpSiteId,waste_type:l.wasteType,loads:l.loads,hauling_company:l.haulingCompany||"",work_date:l.workDate,notes:l.notes||"",estimated_cost:l.estimatedCost||0,created_by:l.createdBy||""};if(G){const{data:u,error:j}=await R.from("haul_offs").insert(o).select().single();if(j)throw console.error("Error creating haul-off:",j),j;return u}const c=Qe();c.haulOffs||(c.haulOffs=[]);const m={...o,id:crypto.randomUUID(),created_at:new Date().toISOString()};return c.haulOffs.push(m),xt(c),m},async calculateHaulOffCosts(r){const l=await this.getHaulOffs(r);let o=0,c=0;const m={},u=[],j={};l.forEach(x=>{const y=parseFloat(x.estimated_cost)||0,g=parseInt(x.loads)||0;o+=y,c+=g,m[x.waste_type]||(m[x.waste_type]={loads:0,cost:0}),m[x.waste_type].loads+=g,m[x.waste_type].cost+=y,j[x.work_date]||(j[x.work_date]={date:x.work_date,loads:0,cost:0}),j[x.work_date].loads+=g,j[x.work_date].cost+=y}),Object.values(j).sort((x,y)=>new Date(y.date)-new Date(x.date)).forEach(x=>u.push(x));const p=u.length;return{totalCost:o,totalLoads:c,byWasteType:m,byDate:u,daysWithHaulOff:p,avgDailyHaulOffCost:p>0?o/p:0}},subscribeToHaulOffs(r,l){return G?R.channel(`haul_offs:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${r}`},l).subscribe():null},async createCOR(r){if(G){const{data:l,error:o}=await R.from("change_orders").insert({company_id:r.company_id,project_id:r.project_id,area_id:r.area_id||null,cor_number:r.cor_number,title:r.title,description:r.description||"",scope_of_work:r.scope_of_work,period_start:r.period_start,period_end:r.period_end,status:"draft",labor_markup_percent:r.labor_markup_percent??1500,materials_markup_percent:r.materials_markup_percent??1500,equipment_markup_percent:r.equipment_markup_percent??1500,subcontractors_markup_percent:r.subcontractors_markup_percent??500,liability_insurance_percent:r.liability_insurance_percent??144,bond_percent:r.bond_percent??100,license_fee_percent:r.license_fee_percent??10,created_by:r.created_by||null}).select().single();if(o)throw o;return l}return null},async updateCOR(r,l){if(G){const{data:o,error:c}=await R.from("change_orders").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw c;return o}return null},async deleteCOR(r){if(G){const{error:l}=await R.from("change_orders").delete().eq("id",r);if(l)throw l}},async getCORs(r,l={}){if(G){let o=R.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",r);l.status&&(o=o.eq("status",l.status)),l.area_id&&(o=o.eq("area_id",l.area_id)),l.date_start&&(o=o.gte("period_start",l.date_start)),l.date_end&&(o=o.lte("period_end",l.date_end)),o=o.order("created_at",{ascending:!1});const{data:c,error:m}=await o;if(m)throw m;return c}return[]},async getCORById(r){if(G){const{data:l,error:o}=await R.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              id, work_date, ce_pco_number, status, notes
            )
          )
        `).eq("id",r).single();if(o)throw o;return l}return null},async getCORsByArea(r,l){if(G){const{data:o,error:c}=await R.from("change_orders").select("*").eq("project_id",r).eq("area_id",l).order("created_at",{ascending:!1});if(c)throw c;return o}return[]},async getAssignableCORs(r){if(G){const{data:l,error:o}=await R.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",r).neq("status","archived").order("cor_number",{ascending:!0});if(o)throw o;return l||[]}return[]},async getNextCORNumber(r){if(G){const{data:l,error:o}=await R.from("change_orders").select("cor_number").eq("project_id",r).order("created_at",{ascending:!1}).limit(1);if(o)throw o;if(l&&l.length>0){const c=l[0].cor_number.match(/COR #(\d+)/);if(c)return`COR #${parseInt(c[1])+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(r,l){if(G){const o=Math.round(l.regular_hours*l.regular_rate),c=Math.round(l.overtime_hours*l.overtime_rate),m=o+c,{data:u,error:j}=await R.from("change_order_labor").insert({change_order_id:r,labor_class:l.labor_class,wage_type:l.wage_type||"standard",regular_hours:l.regular_hours||0,overtime_hours:l.overtime_hours||0,regular_rate:l.regular_rate||0,overtime_rate:l.overtime_rate||0,regular_total:o,overtime_total:c,total:m,sort_order:l.sort_order||0,source_ticket_id:l.source_ticket_id||null}).select().single();if(j)throw j;return u}return null},async updateCORLaborItem(r,l){if(G){let o={...l};if(l.regular_hours!==void 0||l.regular_rate!==void 0||l.overtime_hours!==void 0||l.overtime_rate!==void 0){const{data:u}=await R.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",r).single(),j=l.regular_hours??u?.regular_hours??0,p=l.overtime_hours??u?.overtime_hours??0,x=l.regular_rate??u?.regular_rate??0,y=l.overtime_rate??u?.overtime_rate??0;o.regular_total=Math.round(j*x),o.overtime_total=Math.round(p*y),o.total=o.regular_total+o.overtime_total}const{data:c,error:m}=await R.from("change_order_labor").update(o).eq("id",r).select().single();if(m)throw m;return c}return null},async deleteCORLaborItem(r){if(G){const{error:l}=await R.from("change_order_labor").delete().eq("id",r);if(l)throw l}},async addCORMaterialItem(r,l){if(G){const o=Math.round(l.quantity*l.unit_cost),{data:c,error:m}=await R.from("change_order_materials").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"each",unit_cost:l.unit_cost||0,total:o,source_type:l.source_type||"custom",source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(m)throw m;return c}return null},async updateCORMaterialItem(r,l){if(G){let o={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:u}=await R.from("change_order_materials").select("quantity, unit_cost").eq("id",r).single(),j=l.quantity??u?.quantity??1,p=l.unit_cost??u?.unit_cost??0;o.total=Math.round(j*p)}const{data:c,error:m}=await R.from("change_order_materials").update(o).eq("id",r).select().single();if(m)throw m;return c}return null},async deleteCORMaterialItem(r){if(G){const{error:l}=await R.from("change_order_materials").delete().eq("id",r);if(l)throw l}},async addCOREquipmentItem(r,l){if(G){const o=Math.round(l.quantity*l.unit_cost),{data:c,error:m}=await R.from("change_order_equipment").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"day",unit_cost:l.unit_cost||0,total:o,source_type:l.source_type||"custom",source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(m)throw m;return c}return null},async updateCOREquipmentItem(r,l){if(G){let o={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:u}=await R.from("change_order_equipment").select("quantity, unit_cost").eq("id",r).single(),j=l.quantity??u?.quantity??1,p=l.unit_cost??u?.unit_cost??0;o.total=Math.round(j*p)}const{data:c,error:m}=await R.from("change_order_equipment").update(o).eq("id",r).select().single();if(m)throw m;return c}return null},async deleteCOREquipmentItem(r){if(G){const{error:l}=await R.from("change_order_equipment").delete().eq("id",r);if(l)throw l}},async addCORSubcontractorItem(r,l){if(G){const o=Math.round(l.quantity*l.unit_cost),{data:c,error:m}=await R.from("change_order_subcontractors").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"lump sum",unit_cost:l.unit_cost||0,total:o,source_type:l.source_type||"custom",source_reference:l.source_reference||null,sort_order:l.sort_order||0}).select().single();if(m)throw m;return c}return null},async updateCORSubcontractorItem(r,l){if(G){let o={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:u}=await R.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",r).single(),j=l.quantity??u?.quantity??1,p=l.unit_cost??u?.unit_cost??0;o.total=Math.round(j*p)}const{data:c,error:m}=await R.from("change_order_subcontractors").update(o).eq("id",r).select().single();if(m)throw m;return c}return null},async deleteCORSubcontractorItem(r){if(G){const{error:l}=await R.from("change_order_subcontractors").delete().eq("id",r);if(l)throw l}},async addBulkLaborItems(r,l){if(G&&l.length>0){const o=l.map((u,j)=>{const p=Math.round(u.regular_hours*u.regular_rate),x=Math.round(u.overtime_hours*u.overtime_rate);return{change_order_id:r,labor_class:u.labor_class,wage_type:u.wage_type||"standard",regular_hours:u.regular_hours||0,overtime_hours:u.overtime_hours||0,regular_rate:u.regular_rate||0,overtime_rate:u.overtime_rate||0,regular_total:p,overtime_total:x,total:p+x,sort_order:u.sort_order??j,source_ticket_id:u.source_ticket_id||null}}),{data:c,error:m}=await R.from("change_order_labor").insert(o).select();if(m)throw m;return c}return[]},async addBulkMaterialItems(r,l){if(G&&l.length>0){const o=l.map((u,j)=>({change_order_id:r,description:u.description,quantity:u.quantity||1,unit:u.unit||"each",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,source_ticket_id:u.source_ticket_id||null,sort_order:u.sort_order??j})),{data:c,error:m}=await R.from("change_order_materials").insert(o).select();if(m)throw m;return c}return[]},async addBulkEquipmentItems(r,l){if(G&&l.length>0){const o=l.map((u,j)=>({change_order_id:r,description:u.description,quantity:u.quantity||1,unit:u.unit||"day",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,source_ticket_id:u.source_ticket_id||null,sort_order:u.sort_order??j})),{data:c,error:m}=await R.from("change_order_equipment").insert(o).select();if(m)throw m;return c}return[]},async addBulkSubcontractorItems(r,l){if(G&&l.length>0){const o=l.map((u,j)=>({change_order_id:r,description:u.description,quantity:u.quantity||1,unit:u.unit||"lump sum",unit_cost:u.unit_cost||0,total:Math.round((u.quantity||1)*(u.unit_cost||0)),source_type:u.source_type||"custom",source_reference:u.source_reference||null,sort_order:u.sort_order??j})),{data:c,error:m}=await R.from("change_order_subcontractors").insert(o).select();if(m)throw m;return c}return[]},async clearCORLineItems(r){G&&(await R.from("change_order_labor").delete().eq("change_order_id",r),await R.from("change_order_materials").delete().eq("change_order_id",r),await R.from("change_order_equipment").delete().eq("change_order_id",r),await R.from("change_order_subcontractors").delete().eq("change_order_id",r))},async saveCORLineItems(r,{laborItems:l,materialItems:o,equipmentItems:c,subcontractorItems:m}){if(G){await this.clearCORLineItems(r);const u=await Promise.all([l?.length>0?this.addBulkLaborItems(r,l):[],o?.length>0?this.addBulkMaterialItems(r,o):[],c?.length>0?this.addBulkEquipmentItems(r,c):[],m?.length>0?this.addBulkSubcontractorItems(r,m):[]]);return{labor:u[0],materials:u[1],equipment:u[2],subcontractors:u[3]}}return null},async assignTicketToCOR(r,l){if(G){const{data:o,error:c}=await R.from("change_order_ticket_associations").insert({change_order_id:l,ticket_id:r,data_imported:!1}).select().single();if(c)throw c;const{error:m}=await R.from("t_and_m_tickets").update({assigned_cor_id:l}).eq("id",r);if(m)throw m;return o}return null},async unassignTicketFromCOR(r,l){if(G){const{error:o}=await R.from("change_order_ticket_associations").delete().eq("ticket_id",r).eq("change_order_id",l);if(o)throw o;const{error:c}=await R.from("t_and_m_tickets").update({assigned_cor_id:null}).eq("id",r);if(c)throw c}},async getTicketsForCOR(r){if(G){const{data:l,error:o}=await R.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",r);if(o)throw o;return l}return[]},async getUnassignedTickets(r){if(G){const{data:l,error:o}=await R.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(o)throw o;return l}return[]},async importTicketDataToCOR(r,l,o,c,m){if(G){const{data:u,error:j}=await R.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",r).single();if(j)throw j;const{data:p,error:x}=await R.from("labor_rates").select("*").eq("company_id",o).eq("work_type",c||"demolition").eq("job_type",m||"standard");if(x)throw x;const y={};p?.forEach(L=>{y[L.role.toLowerCase()]=L});const g={};u.t_and_m_workers?.forEach(L=>{const J=(L.role||"laborer").toLowerCase();g[J]||(g[J]={regular_hours:0,overtime_hours:0}),g[J].regular_hours+=parseFloat(L.hours)||0,g[J].overtime_hours+=parseFloat(L.overtime_hours)||0});const T=Object.entries(g).map(([L,J])=>{const W=y[L]||{regular_rate:0,overtime_rate:0},N=Math.round((parseFloat(W.regular_rate)||0)*100),M=Math.round((parseFloat(W.overtime_rate)||0)*100);return{labor_class:L.charAt(0).toUpperCase()+L.slice(1),wage_type:m||"standard",regular_hours:J.regular_hours,overtime_hours:J.overtime_hours,regular_rate:N,overtime_rate:M,source_ticket_id:r}});T.length>0&&await this.addBulkLaborItems(l,T);const B=[],U=[];u.t_and_m_items?.forEach(L=>{const J=L.custom_name||L.materials_equipment?.name||"Unknown Item",W=L.custom_category||L.materials_equipment?.category||"Other",N=L.materials_equipment?.unit||"each",M=Math.round((parseFloat(L.materials_equipment?.cost_per_unit)||0)*100),A={description:J,quantity:L.quantity||1,unit:N,unit_cost:M,source_type:"backup_sheet",source_ticket_id:r};W==="Equipment"?U.push(A):B.push(A)}),B.length>0&&await this.addBulkMaterialItems(l,B),U.length>0&&await this.addBulkEquipmentItems(l,U);const{error:F}=await R.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString()}).eq("change_order_id",l).eq("ticket_id",r);if(F)throw F;return{laborItems:T,materialItems:B,equipmentItems:U}}return null},async reimportTicketDataToCOR(r,l,o,c,m){return G?(await R.from("change_order_labor").delete().eq("change_order_id",l).eq("source_ticket_id",r),await R.from("change_order_materials").delete().eq("change_order_id",l).eq("source_ticket_id",r),await R.from("change_order_equipment").delete().eq("change_order_id",l).eq("source_ticket_id",r),this.importTicketDataToCOR(r,l,o,c,m)):null},async recalculateCOR(r){if(G){const{error:l}=await R.rpc("recalculate_cor_totals",{cor_id:r});if(l)throw l;return this.getCORById(r)}return null},async updateCORMarkupPercentages(r,l){if(G){const o={};l.labor!==void 0&&(o.labor_markup_percent=l.labor),l.materials!==void 0&&(o.materials_markup_percent=l.materials),l.equipment!==void 0&&(o.equipment_markup_percent=l.equipment),l.subcontractors!==void 0&&(o.subcontractors_markup_percent=l.subcontractors);const{data:c,error:m}=await R.from("change_orders").update(o).eq("id",r).select().single();if(m)throw m;return c}return null},async updateCORFeePercentages(r,l){if(G){const o={};l.liabilityInsurance!==void 0&&(o.liability_insurance_percent=l.liabilityInsurance),l.bond!==void 0&&(o.bond_percent=l.bond),l.licenseFee!==void 0&&(o.license_fee_percent=l.licenseFee);const{data:c,error:m}=await R.from("change_orders").update(o).eq("id",r).select().single();if(m)throw m;return c}return null},async submitCORForApproval(r){if(G){const{data:l,error:o}=await R.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",r).select().single();if(o)throw o;return l}return null},async approveCOR(r,l){if(G){const{data:o,error:c}=await R.from("change_orders").update({status:"approved",approved_by:l,approved_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw c;return o}return null},async rejectCOR(r,l=null){if(G){const{data:o,error:c}=await R.from("change_orders").update({status:"rejected",rejection_reason:l}).eq("id",r).select().single();if(c)throw c;return o}return null},async markCORAsBilled(r){if(G){const{data:l,error:o}=await R.from("change_orders").update({status:"billed"}).eq("id",r).select().single();if(o)throw o;return l}return null},async closeCOR(r){if(G){const{data:l,error:o}=await R.from("change_orders").update({status:"closed"}).eq("id",r).select().single();if(o)throw o;return l}return null},async saveCORSignature(r,l,o){if(G){const{data:c,error:m}=await R.from("change_orders").update({gc_signature_data:l,gc_signature_name:o,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",r).select().single();if(m)throw m;return c}return null},async getCORStats(r){if(G){const{data:l,error:o}=await R.from("change_orders").select("status, cor_total").eq("project_id",r);if(o)throw o;const c={total_cors:l.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return l.forEach(m=>{switch(m.status){case"draft":c.draft_count++;break;case"pending_approval":c.pending_count++,c.total_pending_value+=m.cor_total||0;break;case"approved":c.approved_count++,c.total_approved_value+=m.cor_total||0;break;case"rejected":c.rejected_count++;break;case"billed":case"closed":c.billed_count++,c.total_billed_value+=m.cor_total||0;break}}),c}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(r,l){return G?R.channel(`change_orders:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCorTickets(r,l){return G?R.channel(`cor-tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${r}`},l).subscribe():null},async createSignatureRequest(r,l,o,c,m=null,u=null){if(G){const{data:j,error:p}=await R.rpc("generate_signature_token");if(p)throw p;const{data:x,error:y}=await R.from("signature_requests").insert({document_type:r,document_id:l,company_id:o,project_id:c,signature_token:j,expires_at:u,created_by:m}).select().single();if(y)throw y;return x}return null},async getSignatureRequestByToken(r){if(G){await R.rpc("increment_signature_view_count",{token:r});const{data:l,error:o}=await R.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",r).single();if(o)throw o;return l}return null},async getSignatureRequestsForDocument(r,l){if(G){const{data:o,error:c}=await R.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",r).eq("document_id",l).order("created_at",{ascending:!1});if(c)throw c;return o||[]}return[]},async addSignature(r,l,o){if(G){const{data:c,error:m}=await R.from("signatures").insert({signature_request_id:r,signature_slot:l,signature_image:o.signature,signer_name:o.signerName,signer_title:o.signerTitle||null,signer_company:o.signerCompany||null,signed_at:o.signedAt||new Date().toISOString(),ip_address:o.ipAddress||null,user_agent:o.userAgent||null}).select().single();if(m)throw m;return c}return null},async syncSignatureToDocument(r,l){if(!G)return null;const{document_type:o,document_id:c}=l,m=r.signature_slot,u={};m===1?(u.gc_signature_data=r.signature_image,u.gc_signature_name=r.signer_name,u.gc_signature_title=r.signer_title,u.gc_signature_company=r.signer_company,u.gc_signature_date=r.signed_at,u.gc_signature_ip=r.ip_address):m===2&&(u.client_signature_data=r.signature_image,u.client_signature_name=r.signer_name,u.client_signature_title=r.signer_title,u.client_signature_company=r.signer_company,u.client_signature_date=r.signed_at,u.client_signature_ip=r.ip_address);const j=o==="cor"?"change_orders":"t_and_m_tickets",{data:p,error:x}=await R.from(j).update(u).eq("id",c).select().single();if(x)throw x;return p},async revokeSignatureRequest(r){if(G){const{data:l,error:o}=await R.from("signature_requests").update({status:"revoked"}).eq("id",r).select().single();if(o)throw o;return l}return null},async getDocumentForSigning(r,l){if(!G)return null;if(r==="cor"){const{data:o,error:c}=await R.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",l).single();if(c)throw c;return o}else if(r==="tm_ticket"){const{data:o,error:c}=await R.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (*)
        `).eq("id",l).single();if(c)throw c;return o}return null},async getProjectCosts(r){if(G){const{data:o,error:c}=await R.from("project_costs").select("*").eq("project_id",r).order("cost_date",{ascending:!1});return c?(console.error("Error fetching project costs:",c),[]):o||[]}return(Qe().projectCosts||[]).filter(o=>o.project_id===r).sort((o,c)=>new Date(c.cost_date)-new Date(o.cost_date))},async addProjectCost(r,l,o){const c={project_id:r,company_id:l,category:o.category,description:o.description,amount:parseFloat(o.amount),cost_date:o.cost_date||new Date().toISOString().split("T")[0],notes:o.notes||null,created_by:o.created_by||null};if(G){const{data:j,error:p}=await R.from("project_costs").insert(c).select().single();if(p)throw console.error("Error adding project cost:",p),p;return j}const m=Qe();m.projectCosts||(m.projectCosts=[]);const u={...c,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return m.projectCosts.push(u),xt(m),u},async updateProjectCost(r,l){const o={category:l.category,description:l.description,amount:parseFloat(l.amount),cost_date:l.cost_date,notes:l.notes||null,updated_at:new Date().toISOString()};if(G){const{data:u,error:j}=await R.from("project_costs").update(o).eq("id",r).select().single();if(j)throw console.error("Error updating project cost:",j),j;return u}const c=Qe();if(!c.projectCosts)return null;const m=c.projectCosts.findIndex(u=>u.id===r);return m===-1?null:(c.projectCosts[m]={...c.projectCosts[m],...o},xt(c),c.projectCosts[m])},async deleteProjectCost(r){if(G){const{error:o}=await R.from("project_costs").delete().eq("id",r);if(o)throw console.error("Error deleting project cost:",o),o;return!0}const l=Qe();return l.projectCosts&&(l.projectCosts=l.projectCosts.filter(o=>o.id!==r),xt(l)),!0},async getProjectCostsSummary(r){const l=await this.getProjectCosts(r),o={};let c=0;return l.forEach(m=>{const u=parseFloat(m.amount)||0;c+=u,o[m.category]||(o[m.category]={category:m.category,total:0,count:0,items:[]}),o[m.category].total+=u,o[m.category].count++,o[m.category].items.push(m)}),Object.values(o).forEach(m=>{m.percentage=c>0?m.total/c*100:0}),{totalCost:c,byCategory:o,itemCount:l.length}}};Qf(async r=>{if(r&&G){console.log("Back online - syncing pending actions...");try{const l=await Yx(se);l.synced>0&&console.log(`Synced ${l.synced} pending actions`),l.failed>0&&console.warn(`Failed to sync ${l.failed} actions`)}catch(l){console.error("Error syncing pending actions:",l)}}});const Zf=f.createContext(),Oa={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function Sn({children:r,companyId:l}){const[o,c]=f.useState(Oa),[m,u]=f.useState(!0);f.useEffect(()=>{l?j(l):p()},[l]),f.useEffect(()=>{g(o)},[o]);const j=async U=>{try{if(u(!0),!G){c(Oa),u(!1);return}const{data:F,error:L}=await R.from("company_branding").select("*").eq("company_id",U).single();L?(L.code==="PGRST116"?await x(U):console.error("Error loading branding:",L),c(Oa)):c({...Oa,...F})}catch(F){console.error("Error in loadBranding:",F),c(Oa)}finally{u(!1)}},p=async()=>{try{u(!0);const U=window.location.hostname;if(U==="localhost"||U==="127.0.0.1"){c(Oa),u(!1);return}if(!G){c(Oa),u(!1);return}const{data:F,error:L}=await R.rpc("get_branding_by_domain",{domain_name:U});L||!F||F.length===0?c(Oa):c({...Oa,...F[0]})}catch(U){console.error("Error loading branding by domain:",U),c(Oa)}finally{u(!1)}},x=async U=>{try{const{data:F,error:L}=await R.from("company_branding").insert({company_id:U,...Oa}).select().single();L&&console.error("Error creating default branding:",L)}catch(F){console.error("Error in createDefaultBranding:",F)}},y=async U=>{try{if(!G)return c(A=>({...A,...U})),{success:!0};if(!l)return{success:!1,error:"No company ID"};const F={},L=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const A of L)U[A]!==void 0&&(F[A]=U[A]);const{data:J,error:W}=await R.from("company_branding").select("id").eq("company_id",l).single();if(W&&W.code==="PGRST116"){const{data:A,error:ee}=await R.from("company_branding").insert({company_id:l,...F}).select().single();return ee?(console.error("Error creating branding:",ee),{success:!1,error:ee.message}):(c({...Oa,...A}),{success:!0,data:A})}const{data:N,error:M}=await R.from("company_branding").update(F).eq("company_id",l).select().single();return M?(console.error("Error updating branding:",M),{success:!1,error:M.message}):(c({...Oa,...N}),{success:!0,data:N})}catch(F){return console.error("Error in updateBranding:",F),{success:!1,error:F.message}}},g=U=>{const F=document.documentElement;if(F.style.setProperty("--primary-color",U.primary_color),F.style.setProperty("--secondary-color",U.secondary_color),U.favicon_url){let L=document.querySelector("link[rel*='icon']");L||(L=document.createElement("link"),L.rel="icon",document.head.appendChild(L)),L.href=U.favicon_url}document.title=U.custom_app_name||"FieldSync"},B={branding:o,loading:m,updateBranding:y,uploadBrandingImage:async(U,F)=>{try{if(!G)return{success:!0,url:URL.createObjectURL(U)};const L=U.name.split(".").pop(),W=`branding/${`${l}/${F}-${Date.now()}.${L}`}`,{data:N,error:M}=await R.storage.from("public").upload(W,U,{cacheControl:"3600",upsert:!0});if(M)return console.error("Error uploading image:",M),{success:!1,error:M.message};const{data:{publicUrl:A}}=R.storage.from("public").getPublicUrl(W);return{success:!0,url:A}}catch(L){return console.error("Error in uploadBrandingImage:",L),{success:!1,error:L.message}}},refreshBranding:()=>l?j(l):p()};return e.jsx(Zf.Provider,{value:B,children:r})}function vr(){const r=f.useContext(Zf);if(!r)throw new Error("useBranding must be used within a BrandingProvider");return r}const Jf=f.createContext();function Cn({children:r}){const[l,o]=f.useState(()=>{const m=localStorage.getItem("fieldsync-theme");return m==="light"||m==="dark"?m:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"});f.useEffect(()=>{document.documentElement.setAttribute("data-theme",l),localStorage.setItem("fieldsync-theme",l)},[l]),f.useEffect(()=>{const m=window.matchMedia("(prefers-color-scheme: light)"),u=j=>{localStorage.getItem("fieldsync-theme")||o(j.matches?"light":"dark")};return m.addEventListener("change",u),()=>m.removeEventListener("change",u)},[]);const c=()=>{o(m=>m==="dark"?"light":"dark")};return e.jsx(Jf.Provider,{value:{theme:l,setTheme:o,toggleTheme:c},children:r})}function Xx(){const r=f.useContext(Jf);if(!r)throw new Error("useTheme must be used within a ThemeProvider");return r}const Ix=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Zx=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(l,o,c)=>c?c.toUpperCase():o.toLowerCase()),xf=r=>{const l=Zx(r);return l.charAt(0).toUpperCase()+l.slice(1)},Kf=(...r)=>r.filter((l,o,c)=>!!l&&l.trim()!==""&&c.indexOf(l)===o).join(" ").trim(),Jx=r=>{for(const l in r)if(l.startsWith("aria-")||l==="role"||l==="title")return!0};var Kx={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Wx=f.forwardRef(({color:r="currentColor",size:l=24,strokeWidth:o=2,absoluteStrokeWidth:c,className:m="",children:u,iconNode:j,...p},x)=>f.createElement("svg",{ref:x,...Kx,width:l,height:l,stroke:r,strokeWidth:c?Number(o)*24/Number(l):o,className:Kf("lucide",m),...!u&&!Jx(p)&&{"aria-hidden":"true"},...p},[...j.map(([y,g])=>f.createElement(y,g)),...Array.isArray(u)?u:[u]]));const Fe=(r,l)=>{const o=f.forwardRef(({className:c,...m},u)=>f.createElement(Wx,{ref:u,iconNode:l,className:Kf(`lucide-${Ix(xf(r))}`,`lucide-${r}`,c),...m}));return o.displayName=xf(r),o};const ej=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],tj=Fe("bell",ej);const aj=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],Mn=Fe("briefcase",aj);const sj=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Oi=Fe("building-2",sj);const nj=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],fl=Fe("calendar",nj);const rj=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],xr=Fe("camera",rj);const lj=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],hl=Fe("check",lj);const ij=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],_a=Fe("chevron-down",ij);const cj=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],oj=Fe("chevron-left",cj);const dj=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Es=Fe("chevron-right",dj);const uj=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Wf=Fe("chevron-up",uj);const mj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],An=Fe("circle-alert",mj);const hj=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ns=Fe("circle-check-big",hj);const fj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],jf=Fe("circle-x",fj);const pj=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],Xa=Fe("clipboard-list",pj);const gj=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Tn=Fe("clock",gj);const xj=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],gd=Fe("copy",xj);const jj=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],jr=Fe("dollar-sign",jj);const vj=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],ep=Fe("download",vj);const yj=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],tp=Fe("ellipsis",yj);const bj=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],vf=Fe("external-link",bj);const _j=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Nj=Fe("eye",_j);const Sj=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ua=Fe("file-text",Sj);const Cj=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],wj=Fe("flame",Cj);const kj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Ej=Fe("globe",kj);const Dj=[["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["rect",{x:"2",y:"15",width:"20",height:"4",rx:"1",key:"g3x8cw"}]],ua=Fe("hard-hat",Dj);const Mj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],xd=Fe("info",Mj);const Aj=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],yf=Fe("layout-grid",Aj);const Tj=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Rj=Fe("link-2",Tj);const qj=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],vd=Fe("link",qj);const zj=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],bf=Fe("lock",zj);const Oj=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Uj=Fe("map-pin",Oj);const Lj=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Cs=Fe("message-square",Lj);const Hj=[["path",{d:"M5 12h14",key:"1ays0h"}]],Bj=Fe("minus",Hj);const Fj=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],$j=Fe("moon",Fj);const Vj=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],ls=Fe("package",Vj);const Gj=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],yd=Fe("pen-line",Gj);const Yj=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Pj=Fe("pen-tool",Yj);const Qj=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ap=Fe("pen",Qj);const Xj=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],sp=Fe("pencil",Xj);const Ij=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],Zj=Fe("percent",Ij);const Jj=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Kj=Fe("phone",Jj);const Wj=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ka=Fe("plus",Wj);const ev=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],tv=Fe("refresh-cw",ev);const av=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],np=Fe("rotate-ccw",av);const sv=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],_f=Fe("save",sv);const nv=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],rv=Fe("search",nv);const lv=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],rp=Fe("send",lv);const iv=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Li=Fe("shield",iv);const cv=[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]],ov=Fe("stamp",cv);const dv=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],uv=Fe("sun",dv);const mv=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ks=Fe("trash-2",mv);const hv=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],lp=Fe("trending-down",hv);const fv=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],pv=Fe("trending-up",fv);const gv=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],pl=Fe("triangle-alert",gv);const xv=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],qn=Fe("truck",xv);const jv=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],vv=Fe("upload",jv);const yv=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ip=Fe("user-check",yv);const bv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],cp=Fe("user-minus",bv);const _v=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Nv=Fe("user-plus",_v);const Sv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Cv=Fe("user-x",Sv);const wv=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],op=Fe("user",wv);const kv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],rn=Fe("users",kv);const Ev=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],gl=Fe("wrench",Ev);const Dv=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ms=Fe("x",Dv);const Mv=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Nf=Fe("zap",Mv);function Wa({className:r="",showPoweredBy:l=!1}){const{branding:o}=vr();return e.jsxs("div",{className:`app-logo ${r}`,children:[o.logo_url?e.jsx("img",{src:o.logo_url,alt:o.custom_app_name||"Logo",className:"custom-logo"}):e.jsxs("div",{className:"logo",children:[o.custom_app_name||"Field",e.jsx("span",{children:"Sync"})]}),l&&!o.hide_fieldsync_branding&&e.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function Av({onForemanAccess:r,onOfficeLogin:l,onShowToast:o}){const[c,m]=f.useState(null),[u,j]=f.useState(""),[p,x]=f.useState(null),[y,g]=f.useState(""),[T,B]=f.useState(!1),[U,F]=f.useState(""),[L,J]=f.useState(""),[W,N]=f.useState(1),[M,A]=f.useState(null),[ee,ne]=f.useState(""),[Q,z]=f.useState(""),[H,$]=f.useState(""),[S,v]=f.useState(""),_=C=>{const de=C.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);j(de)},w=async()=>{if(u.length<2){o("Enter company code","error");return}B(!0);try{const C=await se.getCompanyByCode(u);C?x(C):(o("Invalid company code","error"),j(""))}catch{o("Error checking code","error")}finally{B(!1)}},ae=async C=>{if(C.length===4){B(!0);try{const de=await se.getProjectByPinAndCompany(C,p.id);de?r(de):(o("Invalid PIN","error"),g(""))}catch{o("Error checking PIN","error")}finally{B(!1)}}},D=C=>{if(y.length<4){const de=y+C;g(de),de.length===4&&setTimeout(()=>ae(de),200)}},V=()=>{g(C=>C.slice(0,-1))},k=()=>{x(null),g("")},fe=()=>{if(!U.trim()||!L.trim()){o("Enter email and password","error");return}l(U,L)},Y=async()=>{if(u.length<2){o("Enter company code","error");return}B(!0);try{const C=await se.getCompanyByCode(u);C?(A(C),N(2)):(o("Invalid company code","error"),j(""))}catch{o("Error checking code","error")}finally{B(!1)}},I=async()=>{if(!ee.trim()){o("Enter office code","error");return}B(!0);try{const{data:C,error:de}=await R.rpc("verify_office_code",{company_id:M.id,code:ee.trim()});if(de)throw de;C===!0?N(3):(o("Invalid office code","error"),ne(""))}catch{o("Error verifying code","error")}finally{B(!1)}},X=async()=>{if(!Q.trim()){o("Enter your name","error");return}if(!H.trim()||!H.includes("@")){o("Enter valid email","error");return}if(S.length<6){o("Password must be 6+ characters","error");return}B(!0);try{const C=H.toLowerCase().trim(),{data:de,error:_e}=await R.auth.signUp({email:C,password:S});let ze;if(_e?.message?.includes("already registered")||de?.user&&de.user.identities?.length===0){const{data:qe,error:Ve}=await R.auth.signInWithPassword({email:C,password:S});if(Ve){o("Account exists with different password. Use your existing password.","error"),B(!1);return}ze=qe.user.id;const{data:Oe}=await R.from("user_companies").select("id, status").eq("user_id",ze).eq("company_id",M.id).maybeSingle();if(Oe){Oe.status==="active"?(o("You already belong to this company. Logging you in...","success"),setTimeout(()=>window.location.reload(),1e3)):Oe.status==="pending"?(o("Your request is still pending approval.","error"),await R.auth.signOut()):(o("Your membership was removed. Contact the company admin.","error"),await R.auth.signOut());return}const{error:nt}=await R.from("user_companies").insert({user_id:ze,company_id:M.id,role:"member",status:"pending"});if(nt)throw console.error("Error adding to user_companies:",nt),await R.auth.signOut(),new Error("Failed to submit join request");await R.auth.signOut(),o("Request to join submitted! Awaiting admin approval.","success")}else{if(_e)throw _e;{if(ze=de.user?.id,!ze)throw new Error("Failed to create user");const{error:qe}=await R.from("users").insert({id:ze,email:C,password_hash:"managed_by_supabase_auth",name:Q.trim(),company_id:M.id,role:"member",is_active:!0});if(qe)throw qe;const{error:Ve}=await R.from("user_companies").insert({user_id:ze,company_id:M.id,role:"member",status:"pending"});if(Ve)throw console.error("Error adding to user_companies:",Ve),new Error("Failed to submit join request");await R.auth.signOut(),o("Account created! Awaiting admin approval.","success")}}}catch(C){console.error("Join error:",C),o(C.message||"Error creating account","error")}finally{B(!1)}};if(c===null)return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx(Wa,{className:"entry-logo",showPoweredBy:!1}),e.jsxs("div",{className:"entry-buttons",children:[e.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>m("foreman"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(ua,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Foreman"}),e.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),e.jsxs("button",{className:"entry-mode-btn office",onClick:()=>m("office"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(Mn,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Office"}),e.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(c==="foreman")return p?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:k,children:""}),e.jsx(Wa,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:p.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),e.jsx("div",{className:"pin-display",children:[0,1,2,3].map(C=>e.jsx("div",{className:`pin-dot ${y.length>C?"filled":""}`,children:y.length>C?"":""},C))}),e.jsxs("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map(C=>e.jsx("button",{className:"num-btn",onClick:()=>D(C.toString()),disabled:T,children:C},C)),e.jsx("button",{className:"num-btn empty",disabled:!0}),e.jsx("button",{className:"num-btn",onClick:()=>D("0"),disabled:T,children:"0"}),e.jsx("button",{className:"num-btn backspace",onClick:V,disabled:T||y.length===0,children:""})]}),T&&e.jsx("div",{className:"entry-loading",children:e.jsx("div",{className:"spinner"})})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m(null),children:""}),e.jsx(Wa,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:u,onChange:C=>_(C.target.value),placeholder:"Company Code",disabled:T,autoFocus:!0,onKeyDown:C=>{C.key==="Enter"&&w()}}),e.jsx("button",{className:"entry-submit-btn",onClick:w,disabled:T||u.length<2,children:T?"...":""})]})]})});if(c==="office")return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m(null),children:""}),e.jsx(Wa,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"email",value:U,onChange:C=>F(C.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:C=>{C.key==="Enter"&&fe()}}),e.jsx("input",{type:"password",value:L,onChange:C=>J(C.target.value),placeholder:"Password",onKeyDown:C=>{C.key==="Enter"&&fe()}}),e.jsx("button",{className:"entry-login-btn",onClick:fe,children:"Sign In"})]}),e.jsxs("div",{className:"entry-signup-hint",children:[e.jsx("p",{children:"New employee?"}),e.jsx("button",{className:"entry-join-link",onClick:()=>m("join"),children:"Join your company"})]})]})});if(c==="join")return W===1?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>m("office"),children:""}),e.jsx(Wa,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),e.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:u,onChange:C=>_(C.target.value),placeholder:"Company Code",disabled:T,autoFocus:!0,onKeyDown:C=>{C.key==="Enter"&&Y()}}),e.jsx("button",{className:"entry-submit-btn",onClick:Y,disabled:T||u.length<2,children:T?"...":""})]})]})}):W===2?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{N(1),A(null),ne("")},children:""}),e.jsx(Wa,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:M?.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),e.jsx("p",{className:"entry-hint",children:"This code is only for office staff"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"password",value:ee,onChange:C=>ne(C.target.value),placeholder:"Office Code",disabled:T,autoFocus:!0,onKeyDown:C=>{C.key==="Enter"&&I()}}),e.jsx("button",{className:"entry-submit-btn",onClick:I,disabled:T||!ee.trim(),children:T?"...":""})]})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{N(2),ne("")},children:""}),e.jsx(Wa,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:M?.name}),e.jsx("p",{className:"entry-subtitle",children:"Create your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"text",value:Q,onChange:C=>z(C.target.value),placeholder:"Your Name",autoFocus:!0}),e.jsx("input",{type:"email",value:H,onChange:C=>$(C.target.value),placeholder:"Email"}),e.jsx("input",{type:"password",value:S,onChange:C=>v(C.target.value),placeholder:"Password (6+ characters)",onKeyDown:C=>{C.key==="Enter"&&X()}}),e.jsx("button",{className:"entry-login-btn",onClick:X,disabled:T,children:T?"Creating...":"Join Company"})]}),e.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})})}function Ut(r){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}function Tv(r){if(!r||r.length===0)return 0;let l=0;return r.forEach(o=>{o.status==="done"&&(l+=o.weight)}),Math.round(l)}function Sf(r){if(!r||r.length===0)return{progress:0,earnedValue:0,totalValue:0,isValueBased:!1};if(r.some(c=>c.scheduled_value>0)){const c=r.reduce((j,p)=>j+(p.scheduled_value||0),0),m=r.filter(j=>j.status==="done").reduce((j,p)=>j+(p.scheduled_value||0),0);return{progress:c>0?Math.round(m/c*100):0,earnedValue:m,totalValue:c,isValueBased:!0}}const o=r.filter(c=>c.status==="done").reduce((c,m)=>c+(m.weight||0),0);return{progress:Math.round(o),earnedValue:0,totalValue:0,isValueBased:!1}}function dp(r){if(!r||r.length===0)return"not_started";const l=r.some(m=>m.status==="working"),o=r.some(m=>m.status==="done");return r.every(m=>m.status==="done")?"done":l||o?"working":"not_started"}function Rv(r){const l=dp(r);return l==="done"?"Complete":l==="working"?"In Progress":"Not Started"}function qv(r,l=0){const o=new Date;o.setHours(0,0,0,0);const c={scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1};if(r.start_date&&r.end_date){const m=new Date(r.start_date),u=new Date(r.end_date);m.setHours(0,0,0,0),u.setHours(0,0,0,0);const j=Math.max(1,Math.ceil((u-m)/(1e3*60*60*24))),p=Math.max(0,Math.ceil((o-m)/(1e3*60*60*24))),x=Math.min(100,p/j*100),g=(r.progress||0)-x;c.scheduleVariance=Math.round(g),c.hasScheduleData=!0,g>5?(c.scheduleStatus="ahead",c.scheduleLabel=`Ahead of Schedule (+${c.scheduleVariance}%)`):g<-5?(c.scheduleStatus="behind",c.scheduleLabel=`Behind Schedule (${c.scheduleVariance}%)`):(c.scheduleStatus="on_track",c.scheduleLabel="On Track")}if(r.planned_man_days&&r.planned_man_days>0){const u=(r.progress||0)/100*r.planned_man_days;if(u>0&&l>0){const j=(l-u)/u*100;c.laborVariance=Math.round(j),c.hasLaborData=!0,j>10?(c.laborStatus="over",c.laborLabel=`Over Planned (+${c.laborVariance}% man-days)`):j<-10?(c.laborStatus="under",c.laborLabel=`Under Planned (${c.laborVariance}% man-days)`):(c.laborStatus="on_track",c.laborLabel="Labor On Track")}else l>0&&(c.hasLaborData=!0,c.laborLabel=`${l} man-days used`)}return c}function zv(r,l=30){if(r.status==="archived"||r.progress<100)return!1;const o=r.areas||[];if(o.length===0||!o.every(j=>j.status==="done"))return!1;const m=o.reduce((j,p)=>{const x=new Date(p.updated_at);return x>j?x:j},new Date(0));return m.getTime()===0?!1:Math.floor((Date.now()-m.getTime())/(1e3*60*60*24))>=l}async function Ov(r,l=1920,o=.8){return!r.type.startsWith("image/")||r.size<500*1024?r:new Promise(c=>{const m=document.createElement("canvas"),u=m.getContext("2d"),j=new Image;j.onload=()=>{let{width:p,height:x}=j;p>l&&(x=Math.round(x*l/p),p=l);const y=1920;x>y&&(p=Math.round(p*y/x),x=y),m.width=p,m.height=x,u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.drawImage(j,0,0,p,x),m.toBlob(g=>{if(g){const T=r.name.replace(/\.[^/.]+$/,""),B=new File([g],`${T}.jpg`,{type:"image/jpeg",lastModified:Date.now()}),U=((1-g.size/r.size)*100).toFixed(1);console.log(`Image compressed: ${r.name} - ${(r.size/1024).toFixed(0)}KB  ${(g.size/1024).toFixed(0)}KB (${U}% smaller)`),c(B)}else console.warn("Image compression failed, using original"),c(r)},"image/jpeg",o),URL.revokeObjectURL(j.src)},j.onerror=()=>{console.warn("Failed to load image for compression, using original"),URL.revokeObjectURL(j.src),c(r)},j.src=URL.createObjectURL(r)})}const Cf=["Containment","PPE","Disposal","Equipment"],Uv={en:{workers:"Workers",materialsEquipment:"Materials & Equipment",review:"Review",quickActions:"Quick Actions",sameAsYesterday:"Same as Yesterday",setCrewHours:"Set Crew Hours",loading:"Loading...",supervision:"Supervision",operators:"Operators",laborers:"Laborers",addSupervision:"+ Add Supervision",addOperator:"+ Add Operator",addLaborer:"+ Add Laborer",foreman:"Foreman",superintendent:"Superintendent",firstLastName:"First & Last Name",start:"Start",end:"End",regHrs:"Reg Hrs",otHrs:"OT Hrs",selectCategory:"Select a category:",addCustomItem:"+ Add Custom Item",customItem:"Custom Item",itemName:"Item Name",category:"Category",quantity:"Quantity",addItem:"Add Item",cancel:"Cancel",noItemsCategory:"No items in this category yet",workDate:"Work Date",ceNumber:"CE/PCO #",optional:"optional",linkedCOR:"Link to Change Order",selectCOR:"Select COR (optional)",noCORs:"No pending CORs",laborSummary:"Labor Summary",worker:"worker",workers_plural:"workers",totalHours:"Total Hours",regular:"Regular",overtime:"Overtime",materials:"Materials",item:"item",items_plural:"items",noMaterials:"No materials added",notes:"Notes",addNotes:"Add notes about the work performed...",photos:"Photos",addPhotos:"Add Photos",maxPhotos:"max",noPhotos:"No photos added",certification:"Certification",certifyStatement:"I certify that this T&M ticket accurately reflects the work performed.",foremanSignature:"Foreman's Name (Signature)",yourName:"Your name",back:"Back",next:"Next",nextMaterials:"Next: Materials",reviewItems:"Review",skipNoMaterials:"Skip (no materials)",submitTM:"Submit T&M",submitting:"Submitting...",applySameHours:"Apply Same Hours",batchDescription:"Set start/end time and hours for all workers with names entered.",timeStarted:"Time Started",timeEnded:"Time Ended",regularHours:"Regular Hours",overtimeHours:"Overtime Hours",willApplyTo:"Will apply to",applyToAll:"Apply to All",preset8hr:"8hr Day",preset10hr:"10hr Day",preset4hr:"4hr Day",loadedWorkers:"Loaded {count} workers from {date}",noPreviousCrew:"No previous crew found for this project",appliedHours:"Applied hours to {count} worker(s)",assignedToCOR:"Assigned to COR"},es:{workers:"Trabajadores",materialsEquipment:"Materiales y Equipo",review:"Revisar",quickActions:"Acciones Rapidas",sameAsYesterday:"Igual que Ayer",setCrewHours:"Poner Horas",loading:"Cargando...",supervision:"Supervision",operators:"Operadores",laborers:"Trabajadores",addSupervision:"+ Agregar Supervision",addOperator:"+ Agregar Operador",addLaborer:"+ Agregar Trabajador",foreman:"Capataz",superintendent:"Superintendente",firstLastName:"Nombre y Apellido",start:"Inicio",end:"Fin",regHrs:"Hrs Reg",otHrs:"Hrs Extra",selectCategory:"Seleccione una categoria:",addCustomItem:"+ Agregar Articulo",customItem:"Articulo Personalizado",itemName:"Nombre del Articulo",category:"Categoria",quantity:"Cantidad",addItem:"Agregar",cancel:"Cancelar",noItemsCategory:"No hay articulos en esta categoria",workDate:"Fecha de Trabajo",ceNumber:"CE/PCO #",optional:"opcional",linkedCOR:"Vincular a Orden de Cambio",selectCOR:"Seleccionar COR (opcional)",noCORs:"No hay CORs pendientes",laborSummary:"Resumen de Mano de Obra",worker:"trabajador",workers_plural:"trabajadores",totalHours:"Horas Totales",regular:"Regular",overtime:"Extra",materials:"Materiales",item:"articulo",items_plural:"articulos",noMaterials:"No se agregaron materiales",notes:"Notas",addNotes:"Agregar notas sobre el trabajo realizado...",photos:"Fotos",addPhotos:"Agregar Fotos",maxPhotos:"max",noPhotos:"No se agregaron fotos",certification:"Certificacion",certifyStatement:"Certifico que este ticket T&M refleja con precision el trabajo realizado.",foremanSignature:"Nombre del Capataz (Firma)",yourName:"Su nombre",back:"Atras",next:"Siguiente",nextMaterials:"Siguiente: Materiales",reviewItems:"Revisar",skipNoMaterials:"Saltar (sin materiales)",submitTM:"Enviar T&M",submitting:"Enviando...",applySameHours:"Aplicar Mismas Horas",batchDescription:"Establezca hora de inicio/fin y horas para todos los trabajadores.",timeStarted:"Hora de Inicio",timeEnded:"Hora de Fin",regularHours:"Horas Regulares",overtimeHours:"Horas Extra",willApplyTo:"Se aplicara a",applyToAll:"Aplicar a Todos",preset8hr:"Dia 8hr",preset10hr:"Dia 10hr",preset4hr:"Dia 4hr",loadedWorkers:"Se cargaron {count} trabajadores del {date}",noPreviousCrew:"No se encontro equipo anterior para este proyecto",appliedHours:"Horas aplicadas a {count} trabajador(es)",assignedToCOR:"Asignado a COR"}};function Lv({project:r,companyId:l,maxPhotos:o=10,onSubmit:c,onCancel:m,onShowToast:u}){const[j,p]=f.useState(1),[x,y]=f.useState(new Date().toISOString().split("T")[0]),[g,T]=f.useState(""),[B,U]=f.useState(""),[F,L]=f.useState(""),[J,W]=f.useState([]),[N,M]=f.useState(!1),[A,ee]=f.useState(!1),[ne,Q]=f.useState({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),[z,H]=f.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}]),[$,S]=f.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[v,_]=f.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[w,ae]=f.useState([]),[D,V]=f.useState(""),[k,fe]=f.useState([]),[Y,I]=f.useState(!1),[X,C]=f.useState(""),[de,_e]=f.useState([]),[ze,re]=f.useState(!1),[qe,Ve]=f.useState(null),[Oe,nt]=f.useState([]),[zt,tt]=f.useState(!1),[ot,St]=f.useState(!1),[rt,at]=f.useState({name:"",category:"",quantity:""}),[ma,Ne]=f.useState(!1),[Ie,Ge]=f.useState("en"),ge=E=>Uv[Ie][E]||E,Le=(E,ie)=>{if(!E||!ie)return null;const[ue,be]=E.split(":").map(Number),[Ae,Te]=ie.split(":").map(Number);let Ye=Ae*60+Te-(ue*60+be);Ye<0&&(Ye+=1440);const $t=Ye/60,Ot=Math.min($t,8),Re=Math.max(0,$t-8);return{hours:Ot.toFixed(1),overtimeHours:Re>0?Re.toFixed(1):""}},Je=E=>{let ie,ue,be,Ae;switch(E){case"full":ie="07:00",ue="15:30",be="8",Ae="";break;case"10hr":ie="06:00",ue="16:30",be="8",Ae="2";break;case"half":ie="07:00",ue="11:00",be="4",Ae="";break;default:return}Q({timeStarted:ie,timeEnded:ue,hours:be,overtimeHours:Ae})};f.useEffect(()=>{pt(),ve()},[r.id]);const ve=async()=>{M(!0);try{const E=await se.getAssignableCORs(r.id);W(E||[])}catch(E){console.error("Error loading assignable CORs:",E)}finally{M(!1)}},ct=()=>{const{timeStarted:E,timeEnded:ie,hours:ue,overtimeHours:be}=ne;H(z.map(Te=>Te.name.trim()?{...Te,timeStarted:E,timeEnded:ie,hours:ue,overtimeHours:be}:Te)),S($.map(Te=>Te.name.trim()?{...Te,timeStarted:E,timeEnded:ie,hours:ue,overtimeHours:be}:Te)),_(v.map(Te=>Te.name.trim()?{...Te,timeStarted:E,timeEnded:ie,hours:ue,overtimeHours:be}:Te));const Ae=[...z.filter(Te=>Te.name.trim()),...$.filter(Te=>Te.name.trim()),...v.filter(Te=>Te.name.trim())].length;ee(!1),Q({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),u(`Applied hours to ${Ae} worker${Ae!==1?"s":""}`,"success")},pt=async()=>{try{const E=await se.getCrewCheckin(r.id);E?.workers&&_e(E.workers)}catch(E){console.error("Error loading crew:",E)}};f.useEffect(()=>{qe&&l&&ia(qe)},[qe,l]);const ia=async E=>{tt(!0);try{const ie=await se.getMaterialsEquipmentByCategory(l,E);nt(ie)}catch(ie){console.error("Error loading items:",ie),u("Error loading items","error")}finally{tt(!1)}},Ft=async()=>{Ne(!0);try{const E=await se.getPreviousTicketCrew(r.id,x);if(!E||E.totalWorkers===0){u("No previous crew found for this project","info");return}E.supervision&&H(E.supervision),E.operators&&S(E.operators),E.laborers&&_(E.laborers);const ie=new Date(E.workDate).toLocaleDateString();u(`Loaded ${E.totalWorkers} workers from ${ie}`,"success")}catch(E){console.error("Error loading previous crew:",E),u("Error loading previous crew","error")}finally{Ne(!1)}},Zt=()=>{H([...z,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},Z=(E,ie,ue)=>{H(z.map((be,Ae)=>{if(Ae!==E)return be;const Te={...be,[ie]:ue};if(ie==="timeStarted"||ie==="timeEnded"){const Ye=ie==="timeStarted"?ue:be.timeStarted,$t=ie==="timeEnded"?ue:be.timeEnded,Ot=Le(Ye,$t);Ot&&(Te.hours=Ot.hours,Te.overtimeHours=Ot.overtimeHours)}return Te}))},q=E=>{z.length>1?H(z.filter((ie,ue)=>ue!==E)):H([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},Me=()=>{_([...v,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Se=(E,ie,ue)=>{_(v.map((be,Ae)=>{if(Ae!==E)return be;const Te={...be,[ie]:ue};if(ie==="timeStarted"||ie==="timeEnded"){const Ye=ie==="timeStarted"?ue:be.timeStarted,$t=ie==="timeEnded"?ue:be.timeEnded,Ot=Le(Ye,$t);Ot&&(Te.hours=Ot.hours,Te.overtimeHours=Ot.overtimeHours)}return Te}))},ke=E=>{v.length>1?_(v.filter((ie,ue)=>ue!==E)):_([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},De=()=>{S([...$,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},K=(E,ie,ue)=>{S($.map((be,Ae)=>{if(Ae!==E)return be;const Te={...be,[ie]:ue};if(ie==="timeStarted"||ie==="timeEnded"){const Ye=ie==="timeStarted"?ue:be.timeStarted,$t=ie==="timeEnded"?ue:be.timeEnded,Ot=Le(Ye,$t);Ot&&(Te.hours=Ot.hours,Te.overtimeHours=Ot.overtimeHours)}return Te}))},ye=E=>{$.length>1?S($.filter((ie,ue)=>ue!==E)):S([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},he=E=>{const ie=w.findIndex(ue=>ue.material_equipment_id===E.id);ie>=0?ae(w.map((ue,be)=>be===ie?{...ue,quantity:ue.quantity+1}:ue)):ae([...w,{material_equipment_id:E.id,name:E.name,unit:E.unit,category:E.category,quantity:1,isCustom:!1}]),u(`Added ${E.name}`,"success")},Ke=()=>{if(!rt.name||!rt.category||!rt.quantity){u("Fill in all fields","error");return}ae([...w,{material_equipment_id:null,custom_name:rt.name,custom_category:rt.category,name:rt.name,category:rt.category,quantity:parseFloat(rt.quantity),unit:"each",isCustom:!0}]),at({name:"",category:"",quantity:""}),St(!1),Ve(null),u("Custom item added","success")},jt=(E,ie)=>{const ue=parseFloat(ie)||0;ue<=0?Yt(E):ae(w.map((be,Ae)=>Ae===E?{...be,quantity:ue}:be))},Yt=E=>{ae(w.filter((ie,ue)=>ue!==E))},Ct=E=>{const ie=Array.from(E.target.files);if(ie.length===0)return;const ue=o===-1?1/0:o-k.length;if(ue<=0){u(`Photo limit reached (${o} max)`,"error"),E.target.value="";return}const be=ie.slice(0,ue);be.length<ie.length&&u(`Only ${be.length} photo(s) added (${o} max)`,"error"),be.forEach(Ae=>{if(!Ae.type.startsWith("image/")){u("Please select an image file","error");return}const Te=URL.createObjectURL(Ae);fe(Ye=>[...Ye,{id:Date.now()+Math.random(),file:Ae,previewUrl:Te,name:Ae.name}])}),E.target.value=""},ta=E=>{const ie=k.find(ue=>ue.id===E);ie?.previewUrl&&URL.revokeObjectURL(ie.previewUrl),fe(k.filter(ue=>ue.id!==E))},aa=()=>{if(j===1){const E=z.some(be=>be.name.trim()&&(parseFloat(be.hours)>0||parseFloat(be.overtimeHours)>0)),ie=$.some(be=>be.name.trim()&&(parseFloat(be.hours)>0||parseFloat(be.overtimeHours)>0)),ue=v.some(be=>be.name.trim()&&(parseFloat(be.hours)>0||parseFloat(be.overtimeHours)>0));return E||ie||ue}return!0},Pt=()=>{j<3&&p(j+1)},we=()=>{qe?(Ve(null),St(!1)):ot?St(!1):j>1?p(j-1):m()},bt=async()=>{if(!B.trim()){u("Enter your name to submit","error");return}const E=z.filter(be=>be.name.trim()&&(parseFloat(be.hours)>0||parseFloat(be.overtimeHours)>0)),ie=$.filter(be=>be.name.trim()&&(parseFloat(be.hours)>0||parseFloat(be.overtimeHours)>0)),ue=v.filter(be=>be.name.trim()&&(parseFloat(be.hours)>0||parseFloat(be.overtimeHours)>0));if(E.length===0&&ie.length===0&&ue.length===0){u("Add at least one worker","error");return}I(!0),C("Creating ticket...");try{const be=await se.createTMTicket({project_id:r.id,work_date:x,ce_pco_number:g.trim()||null,assigned_cor_id:F||null,notes:D.trim()||null,photos:[],created_by_name:B.trim()});let Ae=[];if(k.length>0){C(`Compressing ${k.length} photo${k.length>1?"s":""}...`);const Ye=await Promise.all(k.map(async(We,Vt)=>{try{const Jt=await Ov(We.file);return{...We,file:Jt}}catch(Jt){return console.warn(`Failed to compress photo ${Vt+1}, using original:`,Jt),We}}));C(`Uploading ${k.length} photo${k.length>1?"s":""}...`);let $t=0;const Ot=Ye.map(async(We,Vt)=>{try{const Jt=await se.uploadPhoto(l,r.id,be.id,We.file);return $t++,C(`Uploading ${$t}/${k.length} photos...`),console.log(`Photo ${Vt+1} uploaded successfully:`,Jt),Jt}catch(Jt){return console.error(`Photo ${Vt+1} upload failed:`,Jt),u(`Photo ${Vt+1} failed to upload`,"error"),null}});Ae=(await Promise.all(Ot)).filter(We=>We!==null),Ae.length<k.length&&Ae.length>0&&u(`${Ae.length}/${k.length} photos uploaded`,"warning")}Ae.length>0&&(C("Saving photos..."),await se.updateTMTicketPhotos(be.id,Ae));const Te=[...E.map(Ye=>({name:Ye.name.trim(),hours:parseFloat(Ye.hours)||0,overtime_hours:parseFloat(Ye.overtimeHours)||0,time_started:Ye.timeStarted||null,time_ended:Ye.timeEnded||null,role:Ye.role})),...ie.map(Ye=>({name:Ye.name.trim(),hours:parseFloat(Ye.hours)||0,overtime_hours:parseFloat(Ye.overtimeHours)||0,time_started:Ye.timeStarted||null,time_ended:Ye.timeEnded||null,role:"Operator"})),...ue.map(Ye=>({name:Ye.name.trim(),hours:parseFloat(Ye.hours)||0,overtime_hours:parseFloat(Ye.overtimeHours)||0,time_started:Ye.timeStarted||null,time_ended:Ye.timeEnded||null,role:"Laborer"}))];if(C("Saving workers..."),await se.addTMWorkers(be.id,Te),w.length>0&&(C("Saving materials..."),await se.addTMItems(be.id,w.map(Ye=>({material_equipment_id:Ye.material_equipment_id,custom_name:Ye.custom_name||null,custom_category:Ye.custom_category||null,quantity:Ye.quantity})))),F){C("Importing to COR...");try{await se.importTicketDataToCOR(be.id,F,l,r.work_type||"demolition",r.job_type||"standard")}catch(Ye){console.error("Error importing to COR:",Ye),u("T&M saved, but COR import failed","warning")}}k.forEach(Ye=>{Ye.previewUrl&&URL.revokeObjectURL(Ye.previewUrl)}),u("T&M submitted!","success"),c()}catch(be){console.error("Error submitting T&M:",be),u("Error submitting T&M","error")}finally{I(!1),C("")}},dt=z.filter(E=>E.name.trim()&&(parseFloat(E.hours)>0||parseFloat(E.overtimeHours)>0)),ja=$.filter(E=>E.name.trim()&&(parseFloat(E.hours)>0||parseFloat(E.overtimeHours)>0)),Ce=v.filter(E=>E.name.trim()&&(parseFloat(E.hours)>0||parseFloat(E.overtimeHours)>0)),Ue=dt.length+ja.length+Ce.length,He=[...dt,...ja,...Ce].reduce((E,ie)=>E+parseFloat(ie.hours||0),0),Xe=[...dt,...ja,...Ce].reduce((E,ie)=>E+parseFloat(ie.overtimeHours||0),0);return w.reduce((E,ie)=>E+ie.quantity,0),j===2&&(qe||ot)?e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[e.jsx("button",{className:"tm-back-btn",onClick:we,children:""}),e.jsx("h2",{children:ot?"Add Custom Item":qe}),e.jsxs("div",{className:"tm-item-count",children:[w.length," items"]})]}),ot?e.jsxs("div",{className:"tm-custom-form",children:[e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Item Name"}),e.jsx("input",{type:"text",placeholder:"What did you use?",value:rt.name,onChange:E=>at({...rt,name:E.target.value}),autoFocus:!0})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Category"}),e.jsx("div",{className:"tm-category-select",children:Cf.map(E=>e.jsx("button",{className:`tm-cat-chip ${rt.category===E?"active":""}`,onClick:()=>at({...rt,category:E}),children:E},E))})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",placeholder:"How many?",value:rt.quantity,onChange:E=>at({...rt,quantity:E.target.value})})]}),e.jsx("button",{className:"tm-big-btn primary",onClick:Ke,children:"Add Custom Item"})]}):e.jsx("div",{className:"tm-item-grid",children:zt?e.jsx("div",{className:"tm-loading",children:"Loading..."}):e.jsxs(e.Fragment,{children:[Oe.map(E=>{const ie=w.find(ue=>ue.material_equipment_id===E.id);return e.jsxs("button",{className:`tm-item-card ${ie?"added":""}`,onClick:()=>he(E),children:[e.jsx("span",{className:"tm-item-name",children:E.name}),e.jsx("span",{className:"tm-item-unit",children:E.unit}),ie&&e.jsx("span",{className:"tm-item-badge",children:ie.quantity})]},E.id)}),e.jsxs("button",{className:"tm-item-card custom",onClick:()=>St(!0),children:[e.jsx("span",{className:"tm-item-name",children:"+ Add Other"}),e.jsx("span",{className:"tm-item-unit",children:"Not on list"})]})]})}),!ot&&w.length>0&&e.jsx("div",{className:"tm-wizard-footer",children:e.jsxs("button",{className:"tm-big-btn primary",onClick:()=>Ve(null),children:["Done Adding (",w.length," items)"]})})]}):e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[e.jsx("button",{className:"tm-back-btn",onClick:we,children:""}),e.jsxs("h2",{children:[j===1&&ge("workers"),j===2&&ge("materialsEquipment"),j===3&&ge("review")]}),e.jsxs("div",{className:"tm-header-right",children:[e.jsxs("button",{className:"tm-lang-toggle",onClick:()=>Ge(Ie==="en"?"es":"en"),title:Ie==="en"?"Cambiar a Espaol":"Switch to English",children:[e.jsx(Ej,{size:16}),Ie==="en"?"ES":"EN"]}),e.jsxs("div",{className:"tm-step-dots",children:[e.jsx("span",{className:`tm-dot ${j>=1?"active":""}`}),e.jsx("span",{className:`tm-dot ${j>=2?"active":""}`}),e.jsx("span",{className:`tm-dot ${j>=3?"active":""}`})]})]})]}),j===1&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-project-info",children:[r.job_number&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Job #"}),e.jsx("span",{className:"tm-project-value",children:r.job_number})]}),e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Project"}),e.jsx("span",{className:"tm-project-value",children:r.name})]}),r.address&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Address"}),e.jsx("span",{className:"tm-project-value",children:r.address})]}),r.general_contractor&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"GC"}),e.jsx("span",{className:"tm-project-value",children:r.general_contractor})]})]}),e.jsxs("div",{className:"tm-field-row",children:[e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:x,onChange:E=>y(E.target.value),className:"tm-date"})]}),e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"CE / PCO #"}),e.jsx("input",{type:"text",placeholder:"Change Event / PCO",value:g,onChange:E=>T(E.target.value),className:"tm-input"})]})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Link to Change Order Request (Optional)"}),e.jsxs("div",{className:"tm-cor-row",children:[e.jsxs("select",{value:F,onChange:E=>L(E.target.value),className:"tm-input tm-select",children:[e.jsx("option",{value:"",children:"-- No COR --"}),J.map(E=>e.jsxs("option",{value:E.id,children:[E.cor_number,": ",E.title||"Untitled"," (",E.status,")"]},E.id))]}),e.jsx("button",{type:"button",className:"tm-refresh-btn",onClick:ve,disabled:N,title:"Refresh COR list",children:e.jsx(tv,{size:16,className:N?"spinning":""})})]}),e.jsx("span",{className:"tm-field-hint",children:"T&M data will be imported into the selected COR"})]}),de.length>0&&e.jsxs("div",{className:"tm-crew-picker",children:[e.jsxs("button",{className:"tm-crew-picker-btn",onClick:()=>re(!ze),children:[e.jsx(ua,{size:16})," ",ze?"Hide":"Select from"," Today's Crew (",de.length,")"]}),ze&&e.jsx("div",{className:"tm-crew-list",children:de.map((E,ie)=>{const ue=z.some(be=>be.name.toLowerCase()===E.name.toLowerCase())||$.some(be=>be.name.toLowerCase()===E.name.toLowerCase())||v.some(be=>be.name.toLowerCase()===E.name.toLowerCase());return e.jsxs("button",{className:`tm-crew-item ${ue?"added":""}`,onClick:()=>{if(!ue){if(E.role==="Foreman"||E.role==="Supervisor"){const be=z.findIndex(Ae=>!Ae.name.trim());be>=0?Z(be,"name",E.name):H([...z,{name:E.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:E.role==="Supervisor"?"Superintendent":"Foreman"}])}else if(E.role==="Operator"){const be=$.findIndex(Ae=>!Ae.name.trim());be>=0?K(be,"name",E.name):S([...$,{name:E.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}else{const be=v.findIndex(Ae=>!Ae.name.trim());be>=0?Se(be,"name",E.name):_([...v,{name:E.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}u(`Added ${E.name}`,"success")}},disabled:ue,children:[e.jsx("span",{className:"tm-crew-item-name",children:E.name}),e.jsx("span",{className:`tm-crew-item-role ${(E.role||"laborer").toLowerCase()}`,children:E.role||"Laborer"}),ue&&e.jsx("span",{className:"tm-crew-item-check",children:""})]},ie)})})]}),e.jsxs("div",{className:"tm-quick-actions-panel",children:[e.jsxs("div",{className:"tm-batch-hours-header",children:[e.jsx(Nf,{size:18}),e.jsx("span",{children:ge("quickActions")})]}),e.jsxs("div",{className:"tm-quick-actions-buttons",children:[e.jsxs("button",{type:"button",className:"tm-quick-action-btn primary",onClick:Ft,disabled:ma,children:[e.jsx(gd,{size:16}),ge(ma?"loading":"sameAsYesterday")]}),e.jsxs("button",{type:"button",className:"tm-quick-action-btn",onClick:()=>ee(!0),children:[e.jsx(Tn,{size:16}),ge("setCrewHours")]})]})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:ge("supervision")}),e.jsx("div",{className:"tm-workers-list",children:z.map((E,ie)=>e.jsxs("div",{className:"tm-worker-card-expanded",children:[e.jsxs("div",{className:"tm-worker-row-top",children:[e.jsx("div",{className:"tm-role-select",children:e.jsxs("select",{value:E.role,onChange:ue=>Z(ie,"role",ue.target.value),children:[e.jsx("option",{value:"Foreman",children:ge("foreman")}),e.jsx("option",{value:"Superintendent",children:ge("superintendent")})]})}),e.jsx("input",{type:"text",placeholder:ge("firstLastName"),value:E.name,onChange:ue=>Z(ie,"name",ue.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>q(ie),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("start")}),e.jsx("input",{type:"time",value:E.timeStarted,onChange:ue=>Z(ie,"timeStarted",ue.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("end")}),e.jsx("input",{type:"time",value:E.timeEnded,onChange:ue=>Z(ie,"timeEnded",ue.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:E.hours,onChange:ue=>Z(ie,"hours",ue.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:E.overtimeHours,onChange:ue=>Z(ie,"overtimeHours",ue.target.value)})]})]})]},ie))}),e.jsx("button",{className:"tm-add-btn",onClick:Zt,children:ge("addSupervision")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:ge("operators")}),e.jsx("div",{className:"tm-workers-list",children:$.map((E,ie)=>e.jsxs("div",{className:"tm-worker-card-expanded",children:[e.jsxs("div",{className:"tm-worker-row-top",children:[e.jsx("input",{type:"text",placeholder:ge("firstLastName"),value:E.name,onChange:ue=>K(ie,"name",ue.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>ye(ie),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("start")}),e.jsx("input",{type:"time",value:E.timeStarted,onChange:ue=>K(ie,"timeStarted",ue.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("end")}),e.jsx("input",{type:"time",value:E.timeEnded,onChange:ue=>K(ie,"timeEnded",ue.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:E.hours,onChange:ue=>K(ie,"hours",ue.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:E.overtimeHours,onChange:ue=>K(ie,"overtimeHours",ue.target.value)})]})]})]},ie))}),e.jsx("button",{className:"tm-add-btn",onClick:De,children:ge("addOperator")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:ge("laborers")}),e.jsx("div",{className:"tm-workers-list",children:v.map((E,ie)=>e.jsxs("div",{className:"tm-worker-card-expanded",children:[e.jsxs("div",{className:"tm-worker-row-top",children:[e.jsx("input",{type:"text",placeholder:ge("firstLastName"),value:E.name,onChange:ue=>Se(ie,"name",ue.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>ke(ie),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("start")}),e.jsx("input",{type:"time",value:E.timeStarted,onChange:ue=>Se(ie,"timeStarted",ue.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("end")}),e.jsx("input",{type:"time",value:E.timeEnded,onChange:ue=>Se(ie,"timeEnded",ue.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:E.hours,onChange:ue=>Se(ie,"hours",ue.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:ge("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:E.overtimeHours,onChange:ue=>Se(ie,"overtimeHours",ue.target.value)})]})]})]},ie))}),e.jsx("button",{className:"tm-add-btn",onClick:Me,children:ge("addLaborer")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Description of Work"}),e.jsx("textarea",{placeholder:"What work was performed today?",value:D,onChange:E=>V(E.target.value),rows:3,className:"tm-description"})]}),e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:[e.jsx(xr,{size:16,className:"inline-icon"})," Photos",o!==-1&&e.jsxs("span",{className:"tm-photo-count",children:["(",k.length,"/",o,")"]})]}),k.length>0&&e.jsx("div",{className:"tm-photo-grid",children:k.map(E=>e.jsxs("div",{className:"tm-photo-item",children:[e.jsx("img",{src:E.previewUrl,alt:E.name}),e.jsx("button",{className:"tm-photo-remove",onClick:()=>ta(E.id),children:""})]},E.id))}),(o===-1||k.length<o)&&e.jsxs("label",{className:"tm-photo-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:Ct,style:{display:"none"}}),e.jsx(xr,{size:16,className:"inline-icon"})," ",k.length>0?"Add More Photos":"Add Photos"]}),o!==-1&&k.length>=o&&e.jsxs("div",{className:"tm-photo-limit-reached",children:["Photo limit reached (",o," max)"]})]})]}),j===2&&!qe&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"What was used?"}),e.jsx("div",{className:"tm-category-grid",children:Cf.map(E=>{const ie=w.filter(ue=>ue.category===E);return e.jsxs("button",{className:"tm-category-card",onClick:()=>Ve(E),children:[e.jsx("span",{className:"tm-cat-name",children:E}),ie.length>0&&e.jsx("span",{className:"tm-cat-count",children:ie.length})]},E)})})]}),w.length>0&&e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:["Added Items (",w.length,")"]}),e.jsx("div",{className:"tm-added-list",children:w.map((E,ie)=>e.jsxs("div",{className:"tm-added-item",children:[e.jsxs("div",{className:"tm-added-info",children:[E.isCustom&&e.jsx("span",{className:"tm-custom-badge",children:"Custom"}),e.jsx("span",{className:"tm-added-name",children:E.name})]}),e.jsxs("div",{className:"tm-added-qty",children:[e.jsx("button",{onClick:()=>jt(ie,E.quantity-1),children:""}),e.jsx("span",{children:E.quantity}),e.jsx("button",{onClick:()=>jt(ie,E.quantity+1),children:"+"})]})]},ie))})]})]}),j===3&&e.jsxs("div",{className:"tm-step-content",children:[e.jsx("div",{className:"tm-review-section",children:e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Date"}),e.jsx("span",{children:new Date(x).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]})}),D&&e.jsxs("div",{className:"tm-review-section",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(Ua,{size:16,className:"inline-icon"})," Description"]})}),e.jsx("div",{className:"tm-review-notes",children:D})]}),k.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(xr,{size:16,className:"inline-icon"})," Photos"]}),e.jsx("span",{children:k.length})]}),e.jsx("div",{className:"tm-review-photos",children:k.map(E=>e.jsx("img",{src:E.previewUrl,alt:E.name},E.id))})]}),dt.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(ip,{size:16,className:"inline-icon"})," Supervision"]}),e.jsxs("span",{children:[dt.reduce((E,ie)=>E+parseFloat(ie.hours||0)+parseFloat(ie.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:dt.map((E,ie)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsxs("div",{className:"tm-review-worker-name",children:[e.jsx("span",{className:"tm-role-badge",children:E.role})," ",E.name]}),e.jsxs("div",{className:"tm-review-worker-details",children:[E.timeStarted&&E.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[E.timeStarted," - ",E.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[E.hours||0," reg",parseFloat(E.overtimeHours)>0?` + ${E.overtimeHours} OT`:""]})]})]},ie))})]}),ja.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Operators"}),e.jsxs("span",{children:[ja.reduce((E,ie)=>E+parseFloat(ie.hours||0)+parseFloat(ie.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:ja.map((E,ie)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:E.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[E.timeStarted&&E.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[E.timeStarted," - ",E.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[E.hours||0," reg",parseFloat(E.overtimeHours)>0?` + ${E.overtimeHours} OT`:""]})]})]},ie))})]}),Ce.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(ua,{size:16,className:"inline-icon"})," Laborers"]}),e.jsxs("span",{children:[Ce.reduce((E,ie)=>E+parseFloat(ie.hours||0)+parseFloat(ie.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:Ce.map((E,ie)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:E.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[E.timeStarted&&E.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[E.timeStarted," - ",E.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[E.hours||0," reg",parseFloat(E.overtimeHours)>0?` + ${E.overtimeHours} OT`:""]})]})]},ie))})]}),w.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(gl,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsxs("span",{children:[w.length," items"]})]}),e.jsx("div",{className:"tm-review-list",children:w.map((E,ie)=>e.jsxs("div",{className:"tm-review-row",children:[e.jsxs("span",{children:[E.isCustom&&e.jsxs(e.Fragment,{children:[e.jsx(Nf,{size:14,className:"inline-icon"})," "]}),E.name]}),e.jsxs("span",{children:[E.quantity," ",E.unit]})]},ie))})]}),e.jsxs("div",{className:"tm-review-section tm-certification",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(yd,{size:16,className:"inline-icon"})," Submitted By"]})}),e.jsx("input",{type:"text",className:"tm-certification-input",placeholder:"Enter your name",value:B,onChange:E=>U(E.target.value)}),e.jsx("p",{className:"tm-certification-note",children:"By submitting, you certify this T&M is accurate."})]})]}),e.jsxs("div",{className:"tm-wizard-footer",children:[j<3?e.jsx("button",{className:"tm-big-btn primary",onClick:Pt,disabled:j===1&&!aa(),children:j===1?`${ge("nextMaterials")} (${Ue} ${ge(Ue===1?"worker":"workers_plural")}, ${He+Xe} hrs)`:j===2?`${ge("reviewItems")} (${w.length} ${w.length===1?ge("item"):ge("items_plural")})`:ge("next")}):e.jsx("button",{className:"tm-big-btn submit",onClick:bt,disabled:Y,children:Y?X||ge("submitting"):` ${ge("submitTM")}`}),j===2&&e.jsx("button",{className:"tm-skip-btn",onClick:Pt,children:ge("skipNoMaterials")})]}),A&&e.jsx("div",{className:"tm-modal-overlay",onClick:()=>ee(!1),children:e.jsxs("div",{className:"tm-batch-modal",onClick:E=>E.stopPropagation(),children:[e.jsxs("h3",{children:[e.jsx(Tn,{size:18})," ",ge("applySameHours")]}),e.jsx("p",{className:"tm-batch-description",children:ge("batchDescription")}),e.jsxs("div",{className:"tm-time-presets",children:[e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>Je("full"),children:ge("preset8hr")}),e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>Je("10hr"),children:ge("preset10hr")}),e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>Je("half"),children:ge("preset4hr")})]}),e.jsxs("div",{className:"tm-batch-form",children:[e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:ge("timeStarted")}),e.jsx("input",{type:"time",value:ne.timeStarted,onChange:E=>{const ie=E.target.value,ue=Le(ie,ne.timeEnded);Q({...ne,timeStarted:ie,...ue||{}})}})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:ge("timeEnded")}),e.jsx("input",{type:"time",value:ne.timeEnded,onChange:E=>{const ie=E.target.value,ue=Le(ne.timeStarted,ie);Q({...ne,timeEnded:ie,...ue||{}})}})]})]}),e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:ge("regularHours")}),e.jsx("input",{type:"number",placeholder:"8",value:ne.hours,onChange:E=>Q({...ne,hours:E.target.value})})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:ge("overtimeHours")}),e.jsx("input",{type:"number",placeholder:"0",value:ne.overtimeHours,onChange:E=>Q({...ne,overtimeHours:E.target.value})})]})]})]}),e.jsxs("div",{className:"tm-batch-preview",children:[e.jsxs("strong",{children:[ge("willApplyTo"),":"]}),e.jsxs("span",{children:[[...z.filter(E=>E.name.trim()),...$.filter(E=>E.name.trim()),...v.filter(E=>E.name.trim())].length," ",ge("workers_plural")]})]}),e.jsxs("div",{className:"tm-batch-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>ee(!1),children:ge("cancel")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:ct,disabled:!ne.hours&&!ne.overtimeHours,children:ge("applyToAll")})]})]})})]})}function Hv({project:r,onShowToast:l}){const[o,c]=f.useState([]),[m,u]=f.useState(!0),[j,p]=f.useState(!1),[x,y]=f.useState(!1),[g,T]=f.useState({name:"",role:"Laborer"});f.useEffect(()=>{B()},[r.id]);const B=async()=>{try{const J=await se.getCrewCheckin(r.id);J?.workers&&c(J.workers)}catch(J){console.error("Error loading crew:",J)}finally{u(!1)}},U=async()=>{if(!g.name.trim()){l("Enter worker name","error");return}if(o.find(J=>J.name.toLowerCase()===g.name.trim().toLowerCase())){l("Worker already added","error");return}p(!0);try{const J=[...o,{name:g.name.trim(),role:g.role}];await se.saveCrewCheckin(r.id,J),c(J),T({name:"",role:"Laborer"}),y(!1),l("Crew member added","success")}catch(J){console.error("Error adding worker:",J),l("Error adding crew member","error")}finally{p(!1)}},F=async J=>{p(!0);try{const W=o.filter(N=>N.name.toLowerCase()!==J.toLowerCase());await se.saveCrewCheckin(r.id,W),c(W),l("Crew member removed","success")}catch(W){console.error("Error removing worker:",W),l("Error removing crew member","error")}finally{p(!1)}},L=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"});return m?e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(ua,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:L})]}),e.jsx("div",{className:"crew-loading",children:"Loading..."})]}):e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(ua,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:L})]}),o.length===0?e.jsxs("div",{className:"crew-empty",children:[e.jsx("p",{children:"No crew checked in yet"}),e.jsx("p",{className:"crew-empty-hint",children:"Add your crew for the day"})]}):e.jsx("div",{className:"crew-list",children:o.map(J=>e.jsxs("div",{className:"crew-member",children:[e.jsxs("div",{className:"crew-member-info",children:[e.jsx("span",{className:"crew-member-name",children:J.name}),e.jsx("span",{className:`crew-member-role ${J.role.toLowerCase()}`,children:J.role})]}),e.jsx("button",{className:"crew-remove-btn",onClick:()=>F(J.name),disabled:j,children:""})]},J.name))}),x?e.jsxs("div",{className:"crew-add-form",children:[e.jsx("input",{type:"text",value:g.name,onChange:J=>T({...g,name:J.target.value}),placeholder:"Name",autoFocus:!0}),e.jsxs("select",{value:g.role,onChange:J=>T({...g,role:J.target.value}),children:[e.jsx("option",{value:"Foreman",children:"Foreman"}),e.jsx("option",{value:"Laborer",children:"Laborer"}),e.jsx("option",{value:"Supervisor",children:"Supervisor"}),e.jsx("option",{value:"Operator",children:"Operator"})]}),e.jsxs("div",{className:"crew-add-buttons",children:[e.jsx("button",{className:"crew-add-confirm",onClick:U,disabled:j,children:j?"...":"Add"}),e.jsx("button",{className:"crew-add-cancel",onClick:()=>{y(!1),T({name:"",role:"Laborer"})},children:"Cancel"})]})]}):e.jsx("button",{className:"crew-add-btn",onClick:()=>y(!0),children:"+ Add Crew Member"}),e.jsxs("div",{className:"crew-count",children:[o.length," ",o.length===1?"person":"people"," on site"]})]})}function Bv({project:r,onShowToast:l,onClose:o}){const[c,m]=f.useState(!0),[u,j]=f.useState(!1),[p,x]=f.useState(null),[y,g]=f.useState(""),[T,B]=f.useState("");f.useEffect(()=>{U()},[r.id]);const U=async()=>{try{const W=await se.getDailyReport(r.id);if(W)x(W),g(W.field_notes||""),B(W.issues||"");else{const N=await se.compileDailyReport(r.id);x({...N,status:"draft"})}}catch(W){console.error("Error loading report:",W),l("Error loading report","error")}finally{m(!1)}},F=async()=>{if(!G){l("Demo Mode: Report saved locally only - won't reach office","info"),o();return}j(!0);try{await se.saveDailyReport(r.id,{field_notes:y,issues:T}),await se.submitDailyReport(r.id,"Field")?(l("Daily report submitted!","success"),o()):l("Report not sent - check connection","error")}catch(W){console.error("Error submitting report:",W),l("Error submitting report","error")}finally{j(!1)}},L=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});if(c)return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),e.jsx("h2",{children:"Daily Report"})]}),e.jsx("div",{className:"daily-report-loading",children:"Compiling report..."})]});const J=p?.status==="submitted";return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),e.jsxs("div",{children:[e.jsx("h2",{children:"Daily Report"}),e.jsx("p",{className:"daily-report-date",children:L})]})]}),J&&e.jsxs("div",{className:"daily-report-submitted-banner",children:[" Submitted ",new Date(p.submitted_at).toLocaleTimeString()]}),e.jsxs("div",{className:"daily-report-content",children:[e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:p.crew_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:p.tasks_completed||0}),e.jsx("div",{className:"daily-report-card-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:p.tm_tickets_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:p.photos_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Photos"})]})]}),p.crew_list?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(ua,{size:18,className:"inline-icon"})," Crew"]}),e.jsx("div",{className:"daily-report-crew",children:p.crew_list.map((W,N)=>e.jsxs("div",{className:"daily-report-crew-item",children:[e.jsx("span",{children:W.name}),e.jsx("span",{className:"daily-report-crew-role",children:W.role})]},N))})]}),p.completed_tasks?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(ns,{size:18,className:"inline-icon"})," Completed Today"]}),e.jsx("ul",{className:"daily-report-tasks",children:p.completed_tasks.map((W,N)=>e.jsxs("li",{children:[W.name,W.group&&e.jsx("span",{className:"daily-report-task-group",children:W.group})]},N))})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Ua,{size:18,className:"inline-icon"})," Notes"]}),e.jsx("textarea",{value:y,onChange:W=>g(W.target.value),placeholder:"Any notes about today's work...",rows:3,disabled:J})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(pl,{size:18,className:"inline-icon"})," Issues / Concerns"]}),e.jsx("textarea",{value:T,onChange:W=>B(W.target.value),placeholder:"Any problems, delays, or concerns...",rows:3,disabled:J})]})]}),!J&&e.jsxs("div",{className:"daily-report-footer",children:[e.jsx("button",{className:"btn btn-primary daily-report-submit",onClick:F,disabled:u,children:u?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(vv,{size:16,className:"inline-icon"})," Submit Report"]})}),e.jsx("p",{className:"daily-report-hint",children:"This will be sent to the office"})]})]})}function Fv({project:r,viewerType:l,viewerName:o,onShowToast:c,onClose:m}){const[u,j]=f.useState([]),[p,x]=f.useState(!0),[y,g]=f.useState(!1),[T,B]=f.useState(""),U=f.useRef(null);f.useEffect(()=>{F(),se.markMessagesRead(r.id,l)},[r.id]),f.useEffect(()=>{U.current?.scrollIntoView({behavior:"smooth"})},[u]);const F=async()=>{try{const N=await se.getMessages(r.id);j(N.reverse())}catch(N){console.error("Error loading messages:",N)}finally{x(!1)}},L=async()=>{if(T.trim()){if(!G){c("Demo Mode: Messages won't sync to other users","info");const N={id:Date.now(),project_id:r.id,message:T.trim(),sender_type:l,sender_name:o,created_at:new Date().toISOString()};j([...u,N]),B("");return}g(!0);try{const N=await se.sendMessage(r.id,T.trim(),l,o);N?(j([...u,N]),B("")):c("Message not sent - check connection","error")}catch(N){console.error("Error sending message:",N),c("Error sending message","error")}finally{g(!1)}}},J=N=>{N.key==="Enter"&&!N.shiftKey&&(N.preventDefault(),L())},W=N=>{const M=new Date(N),A=new Date;return M.toDateString()===A.toDateString()?M.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):M.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})};return e.jsxs("div",{className:"messages-container",children:[e.jsxs("div",{className:"messages-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:m,children:""}),e.jsxs("div",{children:[e.jsx("h2",{children:"Messages"}),e.jsx("p",{className:"messages-project",children:r.name})]})]}),e.jsxs("div",{className:"messages-list",children:[p?e.jsx("div",{className:"messages-loading",children:"Loading..."}):u.length===0?e.jsxs("div",{className:"messages-empty",children:[e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"messages-empty-hint",children:l==="field"?"Messages from the office will appear here":"Send a message to the field crew"})]}):u.map(N=>e.jsx("div",{className:`message ${N.sender_type===l?"sent":"received"}`,children:e.jsxs("div",{className:"message-bubble",children:[e.jsxs("div",{className:"message-sender",children:[N.sender_type==="office"?e.jsx(Mn,{size:14,className:"inline-icon"}):e.jsx(ua,{size:14,className:"inline-icon"})," ",N.sender_name]}),e.jsx("div",{className:"message-text",children:N.message}),N.photo_url&&e.jsx("img",{src:N.photo_url,alt:"Attached",className:"message-photo"}),e.jsx("div",{className:"message-time",children:W(N.created_at)})]})},N.id)),e.jsx("div",{ref:U})]}),e.jsxs("div",{className:"messages-input-container",children:[e.jsx("textarea",{value:T,onChange:N=>B(N.target.value),onKeyDown:J,placeholder:"Type a message...",rows:1,disabled:y}),e.jsx("button",{className:"messages-send-btn",onClick:L,disabled:y||!T.trim(),children:y?"...":""})]})]})}function $v({project:r,requestedBy:l,onShowToast:o,onClose:c}){const[m,u]=f.useState([{name:"",quantity:"",unit:"each"}]),[j,p]=f.useState(""),[x,y]=f.useState("normal"),[g,T]=f.useState(""),[B,U]=f.useState(!1),F=()=>{u([...m,{name:"",quantity:"",unit:"each"}])},L=(N,M,A)=>{u(m.map((ee,ne)=>ne===N?{...ee,[M]:A}:ee))},J=N=>{m.length>1&&u(m.filter((M,A)=>A!==N))},W=async()=>{const N=m.filter(M=>M.name.trim()&&parseFloat(M.quantity)>0);if(N.length===0){o("Add at least one item with quantity","error");return}if(!G){o("Demo Mode: Request saved locally only - won't reach office","info"),c();return}U(!0);try{await se.createMaterialRequest(r.id,N,l,j||null,x,g||null)?(o("Request submitted!","success"),c()):o("Request not sent - check connection","error")}catch(M){console.error("Error submitting request:",M),o("Error submitting request","error")}finally{U(!1)}};return e.jsxs("div",{className:"material-request",children:[e.jsxs("div",{className:"material-request-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsx("h2",{children:"Request Materials"})]}),e.jsxs("div",{className:"material-request-content",children:[e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"What do you need?"}),m.map((N,M)=>e.jsxs("div",{className:"material-request-item",children:[e.jsx("input",{type:"text",placeholder:"Item name",value:N.name,onChange:A=>L(M,"name",A.target.value),className:"material-request-name"}),e.jsx("input",{type:"number",placeholder:"Qty",value:N.quantity,onChange:A=>L(M,"quantity",A.target.value),className:"material-request-qty"}),e.jsxs("select",{value:N.unit,onChange:A=>L(M,"unit",A.target.value),className:"material-request-unit",children:[e.jsx("option",{value:"each",children:"each"}),e.jsx("option",{value:"rolls",children:"rolls"}),e.jsx("option",{value:"boxes",children:"boxes"}),e.jsx("option",{value:"bags",children:"bags"}),e.jsx("option",{value:"sheets",children:"sheets"}),e.jsx("option",{value:"gallons",children:"gal"}),e.jsx("option",{value:"feet",children:"ft"}),e.jsx("option",{value:"lbs",children:"lbs"})]}),e.jsx("button",{className:"material-request-remove",onClick:()=>J(M),children:""})]},M)),e.jsx("button",{className:"material-request-add",onClick:F,children:"+ Add Another Item"})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Priority"}),e.jsx("div",{className:"material-request-priority",children:["low","normal","urgent"].map(N=>e.jsxs("button",{className:`priority-btn ${x===N?"active":""} ${N}`,onClick:()=>y(N),children:[N==="urgent"&&" ",N==="normal"&&" ",N==="low"&&" ",N.charAt(0).toUpperCase()+N.slice(1)]},N))})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Needed By (optional)"}),e.jsx("input",{type:"date",value:j,onChange:N=>p(N.target.value),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"material-request-section",children:[e.jsx("label",{children:"Notes (optional)"}),e.jsx("textarea",{value:g,onChange:N=>T(N.target.value),placeholder:"Any additional details...",rows:2})]})]}),e.jsx("div",{className:"material-request-footer",children:e.jsx("button",{className:"btn btn-primary",onClick:W,disabled:B,children:B?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(ls,{size:16,className:"inline-icon"})," Submit Request"]})})})]})}const Vv=f.createContext({}),up=()=>f.useContext(Vv);function Ss({message:r,type:l="",onClose:o}){return f.useEffect(()=>{const c=setTimeout(o,3e3);return()=>clearTimeout(c)},[o]),e.jsx("div",{className:"toast-container",children:e.jsx("div",{className:`toast ${l}`,children:r})})}function mp({project:r,companyId:l,onClose:o,onReportCreated:c}){const{user:m}=up(),[u,j]=f.useState(!1),[p,x]=f.useState(null),[y,g]=f.useState(1),[T,B]=f.useState(new Date().toISOString().split("T")[0]),[U,F]=f.useState(new Date().toTimeString().split(" ")[0].substring(0,5)),[L,J]=f.useState(""),[W,N]=f.useState(""),[M,A]=f.useState("minor"),[ee,ne]=f.useState(""),[Q,z]=f.useState(""),[H,$]=f.useState(""),[S,v]=f.useState(""),[_,w]=f.useState(""),[ae,D]=f.useState(""),[V,k]=f.useState(""),[fe,Y]=f.useState(m?.name||""),[I,X]=f.useState(""),[C,de]=f.useState(""),[_e,ze]=f.useState(m?.email||""),[re,qe]=f.useState([]),[Ve,Oe]=f.useState(""),[nt,zt]=f.useState(""),[tt,ot]=f.useState(""),[St,rt]=f.useState(""),[at,ma]=f.useState(!1),[Ne,Ie]=f.useState(""),[Ge,ge]=f.useState(""),[Le,Je]=f.useState(!1),[ve,ct]=f.useState(""),[pt,ia]=f.useState(""),[Ft,Zt]=f.useState(""),[Z,q]=f.useState(""),[Me,Se]=f.useState(!1),[ke,De]=f.useState(!1),[K,ye]=f.useState(0),[he,Ke]=f.useState(0),jt=()=>{if(!Ve.trim()){x({type:"error",message:"Please enter witness name"});return}const we={name:Ve,phone:nt,email:tt,testimony:St};qe([...re,we]),Oe(""),zt(""),ot(""),rt(""),x({type:"success",message:"Witness added"})},Yt=we=>{qe(re.filter((bt,dt)=>dt!==we))},Ct=we=>{switch(we){case 1:if(!L.trim()||!W.trim())return x({type:"error",message:"Please fill in all incident details"}),!1;break;case 2:if(!Q.trim()||!ae.trim())return x({type:"error",message:"Please fill in employee name and job title"}),!1;break;case 3:if(!fe.trim()||!I.trim())return x({type:"error",message:"Please fill in supervisor name and title"}),!1;break}return!0},ta=()=>{Ct(y)&&g(y+1)},aa=()=>{g(y-1)},Pt=async()=>{if(Ct(y)){if(!G){x({type:"info",message:"Demo Mode: Report saved locally only - won't reach office"}),setTimeout(()=>{o()},1500);return}j(!0);try{const we={project_id:r.id,company_id:l,incident_date:T,incident_time:U,incident_location:L,incident_description:W,injury_type:M,body_part_affected:ee||null,employee_name:Q,employee_phone:H||null,employee_email:S||null,employee_address:_||null,employee_job_title:ae,employee_hire_date:V||null,medical_treatment_required:at,medical_facility_name:Ne||null,medical_facility_address:Ge||null,hospitalized:Le,reported_by_name:fe,reported_by_title:I,reported_by_phone:C||null,reported_by_email:_e||null,witnesses:re,immediate_actions_taken:ve||null,corrective_actions_planned:pt||null,safety_equipment_used:Ft||null,safety_equipment_failed:Z||null,osha_recordable:Me,workers_comp_claim:ke,days_away_from_work:parseInt(K)||0,restricted_work_days:parseInt(he)||0,status:"reported",created_by:m?.id},bt=await se.createInjuryReport(we);x({type:"success",message:"Injury report submitted successfully"}),c&&c(bt),setTimeout(()=>{o()},1500)}catch(we){console.error("Error submitting injury report:",we),x({type:"error",message:"Failed to submit injury report"})}finally{j(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:o,children:e.jsxs("div",{className:"modal-content injury-report-modal",onClick:we=>we.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Workplace Injury/Incident Report"}),e.jsx("button",{className:"close-btn",onClick:o,children:""})]}),e.jsxs("div",{className:"progress-steps",children:[e.jsx("div",{className:`step ${y>=1?"active":""}`,children:"1. Incident"}),e.jsx("div",{className:`step ${y>=2?"active":""}`,children:"2. Employee"}),e.jsx("div",{className:`step ${y>=3?"active":""}`,children:"3. Supervisor"}),e.jsx("div",{className:`step ${y>=4?"active":""}`,children:"4. Witnesses"}),e.jsx("div",{className:`step ${y>=5?"active":""}`,children:"5. Medical & Safety"})]}),e.jsxs("div",{className:"modal-body",children:[y===1&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Incident Details"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date of Incident *"}),e.jsx("input",{type:"date",value:T,onChange:we=>B(we.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Time of Incident *"}),e.jsx("input",{type:"time",value:U,onChange:we=>F(we.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Location on Site *"}),e.jsx("input",{type:"text",value:L,onChange:we=>J(we.target.value),placeholder:"e.g., Floor 2, near elevator shaft"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Incident Description *"}),e.jsx("textarea",{value:W,onChange:we=>N(we.target.value),rows:4,placeholder:"Describe what happened in detail..."})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Injury Type *"}),e.jsxs("select",{value:M,onChange:we=>A(we.target.value),children:[e.jsx("option",{value:"minor",children:"Minor Injury"}),e.jsx("option",{value:"serious",children:"Serious Injury"}),e.jsx("option",{value:"critical",children:"Critical Injury"}),e.jsx("option",{value:"near_miss",children:"Near Miss (No Injury)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("input",{type:"text",value:ee,onChange:we=>ne(we.target.value),placeholder:"e.g., Left hand, lower back"})]})]})]}),y===2&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Injured Employee Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:Q,onChange:we=>z(we.target.value),placeholder:"First and last name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:H,onChange:we=>$(we.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:S,onChange:we=>v(we.target.value),placeholder:"email@example.com"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Home Address"}),e.jsx("input",{type:"text",value:_,onChange:we=>w(we.target.value),placeholder:"Street address, city, state, zip"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Title *"}),e.jsx("input",{type:"text",value:ae,onChange:we=>D(we.target.value),placeholder:"e.g., Carpenter, Electrician"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Hire Date"}),e.jsx("input",{type:"date",value:V,onChange:we=>k(we.target.value)})]})]})]}),y===3&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Foreman/Supervisor Making Report"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Name *"}),e.jsx("input",{type:"text",value:fe,onChange:we=>Y(we.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Title *"}),e.jsx("input",{type:"text",value:I,onChange:we=>X(we.target.value),placeholder:"e.g., Site Foreman, Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Phone Number"}),e.jsx("input",{type:"tel",value:C,onChange:we=>de(we.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Email Address"}),e.jsx("input",{type:"email",value:_e,onChange:we=>ze(we.target.value),placeholder:"email@example.com"})]})]}),y===4&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Witness Testimonies (Optional)"}),re.length>0&&e.jsx("div",{className:"witnesses-list",children:re.map((we,bt)=>e.jsxs("div",{className:"witness-item",children:[e.jsxs("div",{className:"witness-info",children:[e.jsx("strong",{children:we.name}),we.phone&&e.jsxs("span",{children:["  ",we.phone]}),we.testimony&&e.jsxs("p",{className:"witness-testimony",children:['"',we.testimony,'"']})]}),e.jsx("button",{className:"btn-danger btn-small",onClick:()=>Yt(bt),children:"Remove"})]},bt))}),e.jsxs("div",{className:"add-witness-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Name"}),e.jsx("input",{type:"text",value:Ve,onChange:we=>Oe(we.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:nt,onChange:we=>zt(we.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:tt,onChange:we=>ot(we.target.value),placeholder:"email@example.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Testimony"}),e.jsx("textarea",{value:St,onChange:we=>rt(we.target.value),rows:3,placeholder:"What did the witness see or hear?"})]}),e.jsx("button",{className:"btn-secondary",onClick:jt,children:"+ Add Witness"})]})]}),y===5&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Medical Treatment & Safety"}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:at,onChange:we=>ma(we.target.checked)}),"Medical treatment required"]})}),at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Name"}),e.jsx("input",{type:"text",value:Ne,onChange:we=>Ie(we.target.value),placeholder:"Hospital or clinic name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Address"}),e.jsx("input",{type:"text",value:Ge,onChange:we=>ge(we.target.value),placeholder:"Street address"})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Le,onChange:we=>Je(we.target.checked)}),"Employee was hospitalized"]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("textarea",{value:ve,onChange:we=>ct(we.target.value),rows:2,placeholder:"What was done immediately after the incident?"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("textarea",{value:pt,onChange:we=>ia(we.target.value),rows:2,placeholder:"What will be done to prevent this in the future?"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("input",{type:"text",value:Ft,onChange:we=>Zt(we.target.value),placeholder:"e.g., Hard hat, gloves, harness"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("input",{type:"text",value:Z,onChange:we=>q(we.target.value),placeholder:"Equipment that failed, if any"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("input",{type:"number",min:"0",value:K,onChange:we=>ye(we.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("input",{type:"number",min:"0",value:he,onChange:we=>Ke(we.target.value)})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Me,onChange:we=>Se(we.target.checked)}),"OSHA Recordable Incident"]})}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:ke,onChange:we=>De(we.target.checked)}),"Workers' Compensation Claim Filed"]})})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"form-actions",children:[y>1&&e.jsx("button",{className:"btn-secondary",onClick:aa,children:" Back"}),e.jsx("button",{className:"btn-secondary",onClick:o,children:"Cancel"}),y<5?e.jsx("button",{className:"btn-primary",onClick:ta,children:"Next "}):e.jsx("button",{className:"btn-primary",onClick:Pt,disabled:u,children:u?"Submitting...":"Submit Report"})]})})]})}),p&&e.jsx(Ss,{message:p.message,type:p.type,onClose:()=>x(null)}),e.jsx("style",{children:`
        .injury-report-modal {
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid var(--border-color);
          background-color: var(--bg-elevated);
          overflow-x: auto;
        }

        .progress-steps .step {
          font-size: 0.875rem;
          color: var(--text-muted);
          font-weight: 500;
          white-space: nowrap;
          padding: 0.5rem;
        }

        .progress-steps .step.active {
          color: var(--accent-primary);
          font-weight: 600;
        }

        .form-step h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          color: var(--text-primary);
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 1rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-group textarea {
          resize: vertical;
        }

        .checkbox-group label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: normal;
          cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
          width: auto;
          margin: 0;
        }

        .witnesses-list {
          margin-bottom: 1.5rem;
        }

        .witness-item {
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .witness-info {
          flex: 1;
          color: var(--text-primary);
        }

        .witness-testimony {
          margin-top: 0.5rem;
          color: var(--text-secondary);
          font-style: italic;
          font-size: 0.875rem;
        }

        .add-witness-form {
          border: 2px dashed var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          background-color: var(--bg-elevated);
        }

        .modal-footer {
          border-top: 1px solid var(--border-color);
          padding: 1rem 1.5rem;
        }

        .form-actions {
          display: flex;
          justify-content: space-between;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
        }

        @media (max-width: 768px) {
          .injury-report-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }

          .form-row {
            grid-template-columns: 1fr;
          }

          .progress-steps .step {
            font-size: 0.75rem;
            padding: 0.25rem;
          }
        }
      `})]})}const wf=[{id:"trash",label:"Trash",description:"General debris"},{id:"metal",label:"Metal",description:"Scrap metal (recyclable)"},{id:"copper",label:"Copper",description:"Copper scrap (recyclable)"},{id:"concrete",label:"Concrete",description:"Concrete/masonry"},{id:"hazardous",label:"Hazardous",description:"Hazardous materials"}];function Gv({project:r,companyId:l,onClose:o,onSubmit:c,onShowToast:m}){const[u,j]=f.useState(!1),[p,x]=f.useState([]),[y,g]=f.useState(!0),[T,B]=f.useState(new Date().toISOString().split("T")[0]),[U,F]=f.useState("trash"),[L,J]=f.useState(1),[W,N]=f.useState(""),[M,A]=f.useState(r.default_dump_site_id||""),[ee,ne]=f.useState(""),[Q,z]=f.useState(null),[H,$]=f.useState(null);f.useEffect(()=>{S()},[l]),f.useEffect(()=>{v()},[M,U,L,p]);const S=async()=>{try{const V=await se.getDumpSites(l);x(V||[]),r.default_dump_site_id?A(r.default_dump_site_id):V&&V.length>0&&A(V[0].id)}catch(V){console.error("Error loading dump sites:",V)}finally{g(!1)}},v=()=>{if(!M||!U||!L){z(null),$(null);return}const V=p.find(fe=>fe.id===M);if(!V||!V.dump_site_rates){z(null),$(null);return}const k=V.dump_site_rates.find(fe=>fe.waste_type===U);if(k&&k.estimated_cost_per_load!==null){const fe=parseFloat(k.estimated_cost_per_load);$(fe),z(fe*parseInt(L))}else z(null),$(null)},_=V=>V==null?"--":V<0?`-$${Math.abs(V).toFixed(0)}`:`$${V.toFixed(0)}`,w=async V=>{if(V.preventDefault(),!M){m("Please select a dump site","error");return}if(!L||L<1){m("Please enter number of loads","error");return}j(!0);try{await se.createHaulOff(r.id,{dump_site_id:M,waste_type:U,loads:parseInt(L),hauling_company:W.trim()||null,work_date:T,notes:ee.trim()||null,estimated_cost:Q,created_by:"Field"}),m("Haul-off logged successfully","success"),c&&c(),o()}catch(k){console.error("Error logging haul-off:",k),m("Error logging haul-off","error")}finally{j(!1)}},ae=p.find(V=>V.id===M),D=wf.find(V=>V.id===U);return e.jsxs("div",{className:"hauloff-form-container",children:[e.jsxs("div",{className:"hauloff-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:o,children:""}),e.jsx("h2",{children:"Log Haul-Off"})]}),e.jsxs("form",{onSubmit:w,className:"hauloff-form",children:[e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:T,onChange:V=>B(V.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Waste Type"}),e.jsx("div",{className:"waste-type-grid",children:wf.map(V=>e.jsxs("button",{type:"button",className:`waste-type-btn ${U===V.id?"active":""} ${V.id==="metal"||V.id==="copper"?"recyclable":""}`,onClick:()=>F(V.id),children:[e.jsx("span",{className:"waste-label",children:V.label}),(V.id==="metal"||V.id==="copper")&&e.jsx("span",{className:"waste-badge",children:"$"})]},V.id))})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Number of Loads"}),e.jsxs("div",{className:"loads-input-row",children:[e.jsx("button",{type:"button",className:"loads-btn",onClick:()=>J(Math.max(1,L-1)),children:""}),e.jsx("input",{type:"number",value:L,onChange:V=>J(Math.max(1,parseInt(V.target.value)||1)),min:"1",className:"loads-input"}),e.jsx("button",{type:"button",className:"loads-btn",onClick:()=>J(L+1),children:"+"})]})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Dump Site"}),y?e.jsx("div",{className:"loading-inline",children:"Loading sites..."}):p.length===0?e.jsx("div",{className:"no-sites-warning",children:"No dump sites configured. Ask office to add dump sites."}):e.jsxs("select",{value:M,onChange:V=>A(V.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),p.map(V=>e.jsx("option",{value:V.id,children:V.name},V.id))]}),ae?.address&&e.jsx("span",{className:"field-hint",children:ae.address})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Hauling Company (Optional)"}),e.jsx("input",{type:"text",value:W,onChange:V=>N(V.target.value),placeholder:"e.g., ABC Trucking"})]}),e.jsxs("div",{className:"hauloff-field",children:[e.jsx("label",{children:"Notes (Optional)"}),e.jsx("textarea",{value:ee,onChange:V=>ne(V.target.value),placeholder:"Any additional notes...",rows:2})]}),e.jsxs("div",{className:"hauloff-estimate",children:[e.jsx("div",{className:"estimate-header",children:"Estimated Cost"}),Q!==null?e.jsxs("div",{className:`estimate-value ${Q<0?"revenue":""}`,children:[e.jsx("span",{className:"estimate-amount",children:_(Q)}),e.jsxs("span",{className:"estimate-breakdown",children:[_(H),"/load  ",L," load",L>1?"s":""]}),Q<0&&e.jsx("span",{className:"estimate-note revenue-note",children:"Revenue from recyclables"})]}):e.jsxs("div",{className:"estimate-value",children:[e.jsx("span",{className:"estimate-amount",children:"--"}),e.jsx("span",{className:"estimate-breakdown",children:M?ae?.dump_site_rates?.find(V=>V.waste_type===U)?"Unable to calculate":`No rate set for ${D?.label||U}`:"Select a dump site"})]}),e.jsx("div",{className:"estimate-disclaimer",children:"This is an estimate for burn rate tracking, not an invoice amount."})]}),e.jsxs("div",{className:"hauloff-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:o,disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:u||!M,children:u?"Saving...":"Log Haul-Off"})]})]})]})}function hp({compact:r=!1}){const{theme:l,toggleTheme:o}=Xx();return e.jsx("button",{className:`theme-toggle ${r?"theme-toggle-compact":""}`,onClick:o,title:`Switch to ${l==="dark"?"light":"dark"} mode`,"aria-label":`Switch to ${l==="dark"?"light":"dark"} mode`,children:l==="dark"?e.jsxs(e.Fragment,{children:[e.jsx(uv,{size:r?18:16}),!r&&e.jsx("span",{children:"Light"})]}):e.jsxs(e.Fragment,{children:[e.jsx($j,{size:r?18:16}),!r&&e.jsx("span",{children:"Dark"})]})})}function Yv({project:r,companyId:l,onShowToast:o,onExit:c}){const[m,u]=f.useState([]),[j,p]=f.useState(!0),[x,y]=f.useState(null),[g,T]=f.useState({}),[B,U]=f.useState(!1),[F,L]=f.useState(!0),[J,W]=f.useState(!1),[N,M]=f.useState(!1),[A,ee]=f.useState(!1),[ne,Q]=f.useState(!1),[z,H]=f.useState(!1),[$,S]=f.useState(!1),[v,_]=f.useState(0);f.useEffect(()=>{w(),ae()},[r.id]);const w=async()=>{try{const _e=await se.getAreas(r.id);u(_e);const ze=[...new Set(_e.map(qe=>qe.group_name||"General"))],re={};ze.forEach(qe=>re[qe]=!1),T(re)}catch(_e){console.error("Error loading areas:",_e),o("Error loading areas","error")}finally{p(!1)}},ae=async()=>{const _e=await se.getUnreadCount(r.id,"field");_(_e)},D=async(_e,ze)=>{const re=m.find(Ve=>Ve.id===_e);if(!re)return;const qe=re.status===ze?"not_started":ze;y(_e);try{await se.updateAreaStatus(_e,qe),u(Ve=>Ve.map(Oe=>Oe.id===_e?{...Oe,status:qe}:Oe)),o("Updated","success")}catch(Ve){console.error("Error updating status:",Ve),o("Error updating","error")}finally{y(null)}},V=_e=>{T(ze=>({...ze,[_e]:!ze[_e]}))};if(j)return e.jsx("div",{className:"foreman-container",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading..."]})});if(B)return e.jsx("div",{className:"foreman-container",children:e.jsx(Lv,{project:r,companyId:l,onSubmit:()=>U(!1),onCancel:()=>U(!1),onShowToast:o})});if(J)return e.jsx(Bv,{project:r,onShowToast:o,onClose:()=>W(!1)});if(N)return e.jsx(Fv,{project:r,viewerType:"field",viewerName:"Field",onShowToast:o,onClose:()=>{M(!1),ae()}});if(A)return e.jsx($v,{project:r,requestedBy:"Field",onShowToast:o,onClose:()=>ee(!1)});if(ne)return e.jsx("div",{className:"foreman-container",children:e.jsx(mp,{project:r,companyId:l,onClose:()=>Q(!1),onReportCreated:()=>{Q(!1),o("Injury report submitted","success")}})});if(z)return e.jsx("div",{className:"foreman-container",children:e.jsx(Gv,{project:r,companyId:l,onClose:()=>H(!1),onSubmit:()=>H(!1),onShowToast:o})});const k=Tv(m),fe=m.reduce((_e,ze)=>{const re=ze.group_name||"General";return _e[re]||(_e[re]=[]),_e[re].push(ze),_e},{}),Y=Object.keys(fe).length>1||Object.keys(fe).length===1&&!fe.General,I=_e=>`${_e.filter(re=>re.status==="done").length}/${_e.length}`,X=m.filter(_e=>_e.status==="done").length,C=m.filter(_e=>_e.status==="working").length,de=m.length-X;return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsxs("div",{className:"foreman-header-info",children:[e.jsx("div",{className:"foreman-project-name",children:r.name}),e.jsxs("div",{className:"foreman-progress",children:[k,"% Complete"]})]}),e.jsxs("div",{className:"foreman-header-actions",children:[e.jsx(hp,{compact:!0}),e.jsx("button",{className:"foreman-info-btn",onClick:()=>S(!$),children:e.jsx(xd,{size:20})})]})]}),$&&e.jsxs("div",{className:"foreman-project-info",children:[r.job_number&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Job #"}),e.jsx("span",{className:"foreman-info-value",children:r.job_number})]}),r.address&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Address"}),e.jsx("span",{className:"foreman-info-value",children:r.address})]}),r.general_contractor&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"GC / Client"}),e.jsx("span",{className:"foreman-info-value",children:r.general_contractor})]}),r.client_contact&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Contact"}),e.jsx("span",{className:"foreman-info-value",children:r.client_contact})]}),r.client_phone&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Phone"}),e.jsx("a",{href:`tel:${r.client_phone}`,className:"foreman-info-value foreman-info-link",children:r.client_phone})]})]}),e.jsxs("div",{className:"foreman-stats",children:[e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value working",children:C}),e.jsx("div",{className:"foreman-stat-label",children:"Working"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value done",children:X}),e.jsx("div",{className:"foreman-stat-label",children:"Done"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value remaining",children:de}),e.jsx("div",{className:"foreman-stat-label",children:"Remaining"})]})]}),e.jsxs("div",{className:"field-actions",children:[e.jsxs("button",{className:"field-action-btn",onClick:()=>U(!0),children:[e.jsx(Ua,{size:20,className:"icon"}),"T&M Ticket"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>M(!0),children:[e.jsx(Cs,{size:20,className:"icon"}),"Messages",v>0&&e.jsx("span",{className:"badge",children:v})]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>ee(!0),children:[e.jsx(ls,{size:20,className:"icon"}),"Materials"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>W(!0),children:[e.jsx(Xa,{size:20,className:"icon"}),"Daily Report"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>H(!0),children:[e.jsx(qn,{size:20,className:"icon"}),"Haul-Off"]}),e.jsxs("button",{className:"field-action-btn danger",onClick:()=>Q(!0),children:[e.jsx(pl,{size:20,className:"icon"}),"Report Injury"]})]}),e.jsx(Hv,{project:r,onShowToast:o}),e.jsx("div",{className:"foreman-areas",children:Y?Object.entries(fe).map(([_e,ze])=>e.jsxs("div",{className:"foreman-group",children:[e.jsxs("div",{className:"foreman-group-header",onClick:()=>V(_e),children:[e.jsxs("div",{className:"foreman-group-title",children:[e.jsx("span",{className:"foreman-group-arrow",children:g[_e]?"":""}),e.jsx("span",{className:"foreman-group-name",children:_e})]}),e.jsx("span",{className:"foreman-group-progress",children:I(ze)})]}),g[_e]&&e.jsx("div",{className:"foreman-group-tasks",children:ze.map(re=>e.jsxs("div",{className:`foreman-area-card ${re.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:re.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${re.status==="working"?"active":""}`,onClick:()=>D(re.id,"working"),disabled:x===re.id,children:x===re.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${re.status==="done"?"active":""}`,onClick:()=>D(re.id,"done"),disabled:x===re.id,children:x===re.id?"...":"Done"})]})]},re.id))})]},_e)):m.map(_e=>e.jsxs("div",{className:`foreman-area-card ${_e.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:_e.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${_e.status==="working"?"active":""}`,onClick:()=>D(_e.id,"working"),disabled:x===_e.id,children:x===_e.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${_e.status==="done"?"active":""}`,onClick:()=>D(_e.id,"done"),disabled:x===_e.id,children:x===_e.id?"...":"Done"})]})]},_e.id))}),m.length===0&&e.jsxs("div",{className:"foreman-empty",children:[e.jsx(Xa,{size:48,className:"foreman-empty-icon"}),e.jsx("div",{className:"foreman-empty-text",children:"No areas yet"}),e.jsx("div",{className:"foreman-empty-subtext",children:"Office needs to add areas to this project"})]})]})}const kf=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";function fp({documentType:r,documentId:l,companyId:o,projectId:c,documentTitle:m="",onClose:u,onShowToast:j}){const[p,x]=f.useState(!0),[y,g]=f.useState(!1),[T,B]=f.useState([]),[U,F]=f.useState(null),[L,J]=f.useState(!1),[W,N]=f.useState("never");f.useEffect(()=>{M()},[r,l]);const M=async()=>{try{x(!0);const H=await se.getSignatureRequestsForDocument(r,l);B(H||[])}catch(H){console.error("Error loading signature requests:",H)}finally{x(!1)}},A=async()=>{try{g(!0);let H=null;if(W!=="never"){const S=parseInt(W);H=new Date,H.setDate(H.getDate()+S),H=H.toISOString()}const $=await se.createSignatureRequest(r,l,o,c,null,H);if($){const S=`${window.location.origin}/sign/${$.signature_token}`;F(S),await M(),j?.("Signature link created","success")}}catch(H){console.error("Error generating signature link:",H),j?.("Failed to create signature link","error")}finally{g(!1)}},ee=async H=>{try{await navigator.clipboard.writeText(H),J(!0),j?.("Link copied to clipboard","success"),setTimeout(()=>J(!1),2e3)}catch($){console.error("Error copying to clipboard:",$)}},ne=async H=>{if(confirm("Are you sure you want to revoke this signature link? It will no longer be usable."))try{await se.revokeSignatureRequest(H),await M(),j?.("Signature link revoked","success")}catch($){console.error("Error revoking signature request:",$),j?.("Failed to revoke link","error")}},Q=H=>{switch(H){case"pending":return{label:"Awaiting Signatures",color:"#f59e0b",bg:"#fef3c7"};case"partially_signed":return{label:"1 of 2 Signed",color:"#3b82f6",bg:"#dbeafe"};case"completed":return{label:"Fully Signed",color:"#10b981",bg:"#d1fae5"};case"revoked":return{label:"Revoked",color:"#ef4444",bg:"#fee2e2"};case"expired":return{label:"Expired",color:"#6b7280",bg:"#f3f4f6"};default:return{label:H,color:"#6b7280",bg:"#f3f4f6"}}},z=r==="cor"?"Change Order":"T&M Ticket";return e.jsx("div",{className:"modal-overlay",onClick:u,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content signature-link-modal",onClick:H=>H.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Get Signature Link"}),m&&e.jsx("span",{className:"modal-subtitle",children:m})]}),e.jsx("button",{className:"close-btn",onClick:u,"aria-label":"Close",children:e.jsx(Ms,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(vd,{size:16}),"Create New Signature Link"]}),e.jsxs("p",{className:"section-description",children:["Generate a secure link that allows GC/Client to sign this ",z," without logging in."]}),e.jsxs("div",{className:"link-options",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("select",{value:W,onChange:H=>N(H.target.value),disabled:y,children:[e.jsx("option",{value:"never",children:"Never expires"}),e.jsx("option",{value:"7",children:"7 days"}),e.jsx("option",{value:"30",children:"30 days"}),e.jsx("option",{value:"90",children:"90 days"})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:A,disabled:y,children:y?"Generating...":"Generate Link"})]}),U&&e.jsxs("div",{className:"new-link-box",children:[e.jsxs("div",{className:"link-display",children:[e.jsx("input",{type:"text",value:U,readOnly:!0,className:"link-input"}),e.jsxs("button",{className:"btn btn-secondary copy-btn",onClick:()=>ee(U),children:[L?e.jsx(hl,{size:16}):e.jsx(gd,{size:16}),L?"Copied!":"Copy"]})]}),e.jsxs("a",{href:U,target:"_blank",rel:"noopener noreferrer",className:"preview-link",children:[e.jsx(vf,{size:14}),"Preview link"]})]})]}),e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(Tn,{size:16}),"Existing Signature Links"]}),p?e.jsx("div",{className:"loading-inline",children:"Loading..."}):T.length===0?e.jsxs("p",{className:"empty-state",children:["No signature links have been created for this ",z,"."]}):e.jsx("div",{className:"existing-links-list",children:T.map(H=>{const $=Q(H.status),S=`${window.location.origin}/sign/${H.signature_token}`,v=H.signatures?.length||0;return e.jsxs("div",{className:"existing-link-card",children:[e.jsxs("div",{className:"link-card-header",children:[e.jsx("span",{className:"status-badge",style:{color:$.color,backgroundColor:$.bg},children:$.label}),e.jsxs("span",{className:"link-created",children:["Created ",kf(H.created_at)]})]}),e.jsxs("div",{className:"link-card-body",children:[e.jsxs("div",{className:"link-info",children:[e.jsxs("span",{className:"link-token",children:["...",H.signature_token.slice(-8)]}),H.expires_at&&e.jsxs("span",{className:"link-expires",children:["Expires ",kf(H.expires_at)]}),e.jsxs("span",{className:"link-views",children:[H.view_count," view",H.view_count!==1?"s":""]})]}),v>0&&e.jsx("div",{className:"signatures-summary",children:H.signatures.map(_=>e.jsxs("div",{className:"sig-item",children:[e.jsx(hl,{size:12}),e.jsxs("span",{children:["Slot ",_.signature_slot,": ",_.signer_name,_.signer_company&&` (${_.signer_company})`]})]},_.id))})]}),e.jsxs("div",{className:"link-card-actions",children:[H.status!=="revoked"&&H.status!=="expired"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>ee(S),children:[e.jsx(gd,{size:14})," Copy"]}),e.jsxs("a",{href:S,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-small",children:[e.jsx(vf,{size:14})," Open"]})]}),H.status!=="completed"&&H.status!=="revoked"&&e.jsxs("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>ne(H.id),children:[e.jsx(ks,{size:14})," Revoke"]})]})]},H.id)})})]}),e.jsxs("div",{className:"signature-info-box",children:[e.jsx(An,{size:16}),e.jsxs("div",{children:[e.jsx("strong",{children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Share the link with your GC or Client"}),e.jsx("li",{children:"They can view the document and sign without logging in"}),e.jsx("li",{children:"Supports 2 signatures (GC + Client)"}),e.jsx("li",{children:"Signatures are recorded with name, title, company, date, and IP"})]})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:u,children:"Close"})})]})})}const Ef=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},Pv=r=>new Promise(l=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),l(c.toDataURL("image/png"))},o.onerror=()=>l(null),o.src=r});function Qv({project:r,company:l,onShowToast:o}){const{branding:c}=vr(),[m,u]=f.useState([]),[j,p]=f.useState(!0),[x,y]=f.useState("all"),[g,T]=f.useState(null),[B,U]=f.useState(new Set),[F,L]=f.useState("recent"),[J,W]=f.useState(new Set),[N,M]=f.useState({start:"",end:""}),[A,ee]=f.useState(!1),[ne,Q]=f.useState(null),[z,H]=f.useState(""),[$,S]=f.useState(!1),[v,_]=f.useState(null),[w,ae]=f.useState(!1),[D,V]=f.useState(null),[k,fe]=f.useState([]),[Y,I]=f.useState(""),[X,C]=f.useState(!1),[de,_e]=f.useState({});f.useEffect(()=>{ze();const Z=se.subscribeToTMTickets?.(r.id,()=>{ze()});return()=>{Z&&se.unsubscribe?.(Z)}},[r.id]);const ze=async()=>{try{const Z=await se.getTMTickets(r.id);u(Z);const q=Z.filter(Me=>Me.assigned_cor_id);if(q.length>0){const Me={};await Promise.all(q.map(async Se=>{const ke=await se.isTicketEditable(Se);ke.editable||(Me[Se.id]=ke)})),_e(Me)}}catch(Z){console.error("Error loading tickets:",Z),o("Error loading T&M tickets","error")}finally{p(!1)}},re=async(Z,q)=>{if(de[Z]){o(de[Z].reason||"This ticket is locked (COR approved)","error");return}try{await se.updateTMTicketStatus(Z,q),u(m.map(Me=>Me.id===Z?{...Me,status:q}:Me)),o(`Ticket ${q}`,"success")}catch(Me){console.error("Error updating status:",Me),o("Error updating status","error")}},qe=Z=>{if(de[Z.id]){o(de[Z.id].reason||"This ticket is locked (COR approved)","error");return}re(Z.id,"approved")},Ve=async()=>{if(ne)try{const Z=parseFloat(z)||0;await se.approveTMTicket(ne.id,null,null,Z),u(m.map(q=>q.id===ne.id?{...q,status:"approved",change_order_value:Z}:q)),o(`Ticket approved with $${Z.toLocaleString()} change order`,"success"),ee(!1),Q(null),H("")}catch(Z){console.error("Error approving ticket:",Z),o("Error approving ticket","error")}},Oe=async Z=>{if(de[Z]){o(de[Z].reason||"This ticket is locked (COR approved)","error");return}if(confirm("Delete this T&M ticket?"))try{await se.deleteTMTicket(Z),u(m.filter(q=>q.id!==Z)),o("Ticket deleted","success")}catch(q){console.error("Error deleting ticket:",q),o("Error deleting ticket","error")}},nt=async Z=>{V(Z),I(Z.assigned_cor_id||""),ae(!0),C(!0);try{const q=await se.getChangeOrders(r.id);fe(q||[])}catch(q){console.error("Error loading CORs:",q),o("Error loading change orders","error")}finally{C(!1)}},zt=async()=>{if(D)try{if(Y){await se.associateTicketWithCOR(Y,D.id);const Z=k.find(q=>q.id===Y);o(`Ticket linked to ${Z?.cor_number||"COR"}`,"success")}else D.assigned_cor_id&&(await se.removeTicketFromCOR(D.assigned_cor_id,D.id),o("Ticket unlinked from COR","success"));ze(),ae(!1),V(null),I("")}catch(Z){console.error("Error updating COR association:",Z),o("Error updating COR link","error")}},tt=Z=>{let q=0;return Z.t_and_m_items&&Z.t_and_m_items.forEach(Me=>{Me.materials_equipment?.cost_per_unit&&(q+=Me.quantity*Me.materials_equipment.cost_per_unit)}),q},ot=Z=>Z.t_and_m_workers?Z.t_and_m_workers.reduce((q,Me)=>{const Se=parseFloat(Me.hours)||0,ke=parseFloat(Me.overtime_hours)||0;return q+Se+ke},0):0,St=Z=>new Date(Z).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),rt=(Z,q)=>{q.stopPropagation(),U(Me=>{const Se=new Set(Me);return Se.has(Z)?Se.delete(Z):Se.add(Z),Se})},at=()=>{const Z=x==="all"?m:m.filter(Me=>Me.status===x),q=Z.every(Me=>B.has(Me.id));U(q?new Set:new Set(Z.map(Me=>Me.id)))},ma=()=>{U(new Set)},Ne=()=>{const Z=x==="all"?m:m.filter(q=>q.status===x);return B.size>0?Z.filter(q=>B.has(q.id)):Z},Ie=()=>{const Z=Ne();if(Z.length===0){o("No tickets to export","error");return}const q=[],Me=[],Se=[];Z.forEach(ye=>{const he=St(ye.work_date),Ke=ye.status;ye.t_and_m_workers&&ye.t_and_m_workers.forEach(jt=>{const Yt=parseFloat(jt.hours)||0,Ct=parseFloat(jt.overtime_hours)||0;q.push({Date:he,Status:Ke,"Worker Name":jt.name,Role:jt.role||"Laborer","Regular Hours":Yt,"OT Hours":Ct,"Total Hours":Yt+Ct})}),ye.t_and_m_items&&ye.t_and_m_items.forEach(jt=>{const Yt=jt.custom_name||jt.materials_equipment?.name||"Unknown",Ct=jt.custom_category||jt.materials_equipment?.category||"Unknown",ta=jt.materials_equipment?.unit||"each",aa=jt.materials_equipment?.cost_per_unit||0,Pt=jt.quantity*aa;Me.push({Date:he,Status:Ke,Category:Ct,Item:Yt,Quantity:jt.quantity,Unit:ta,"Cost/Unit":aa,Total:Pt})}),Se.push({Date:he,Status:Ke,Workers:ye.t_and_m_workers?.length||0,"Total Hours":ot(ye),Items:ye.t_and_m_items?.length||0,"Materials Cost":tt(ye),Notes:ye.notes||""})});const ke=tn.book_new(),De=tn.json_to_sheet(Se);if(tn.book_append_sheet(ke,De,"Summary"),q.length>0){const ye=tn.json_to_sheet(q);tn.book_append_sheet(ke,ye,"Workers")}if(Me.length>0){const ye=tn.json_to_sheet(Me);tn.book_append_sheet(ke,ye,"Materials & Equipment")}const K=`${r.name}_TM_${new Date().toISOString().split("T")[0]}.xlsx`;Cx(ke,K),o("Export downloaded!","success")},Ge=async()=>{const Z=Ne();if(Z.length===0){o("No tickets to export","error");return}o("Generating PDF...","info");const q=new Ui,Me=q.internal.pageSize.getWidth(),Se=q.internal.pageSize.getHeight(),ke=20;let De=ke;const K=Ef(c?.primary_color||"#3B82F6"),ye=Ef(c?.secondary_color||"#1E40AF");q.setFillColor(...K),q.rect(0,0,Me,45,"F"),q.setFillColor(...ye),q.rect(0,42,Me,3,"F");let he=ke;if(c?.logo_url)try{const $e=await Pv(c.logo_url);$e&&(q.addImage($e,"PNG",ke,7,30,30),he=ke+30+10)}catch($e){console.error("Error adding logo:",$e)}q.setTextColor(255,255,255),q.setFontSize(22),q.setFont("helvetica","bold"),q.text(l?.name||"Company Name",he,20),q.setFontSize(10),q.setFont("helvetica","normal"),q.text("TIME & MATERIALS REPORT",he,30),q.setFontSize(9),q.text(`Report Date: ${new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,Me-ke,18,{align:"right"}),r.job_number&&q.text(`Job #: ${r.job_number}`,Me-ke,26,{align:"right"}),q.text(`Status: ${x.charAt(0).toUpperCase()+x.slice(1)}`,Me-ke,34,{align:"right"}),De=55,q.setFillColor(248,250,252),q.rect(ke,De-5,Me-ke*2,30,"F"),q.setDrawColor(...K),q.setLineWidth(.5),q.rect(ke,De-5,Me-ke*2,30,"S"),q.setTextColor(...K),q.setFontSize(14),q.setFont("helvetica","bold"),q.text(`Project: ${r.name}`,ke+5,De+7),q.setFontSize(10),q.setFont("helvetica","normal"),q.setTextColor(51,65,85);const Ke=Z.map($e=>new Date($e.work_date)).sort(($e,st)=>$e-st),jt=Ke[0]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Yt=Ke[Ke.length-1]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});q.text(`Date Range: ${jt} - ${Yt}`,ke+5,De+17),q.text(`Total Tickets: ${Z.length}`,Me-ke-5,De+7,{align:"right"}),De+=40;const Ct=Z.reduce(($e,st)=>$e+ot(st),0),ta=Z.reduce(($e,st)=>$e+tt(st),0),aa=new Set(Z.flatMap($e=>$e.t_and_m_workers?.map(st=>st.name)||[])).size;q.setTextColor(...K),q.setFontSize(12),q.setFont("helvetica","bold"),q.text("SUMMARY",ke,De),De+=8;const Pt=(Me-ke*2-20)/3,we=[{label:"Total Labor Hours",value:Ct.toFixed(1)},{label:"Unique Workers",value:aa.toString()},{label:"Materials Cost",value:`$${ta.toFixed(2)}`}],bt=K.map($e=>Math.min(255,$e+180));we.forEach(($e,st)=>{const _t=ke+st*(Pt+10);q.setFillColor(...bt),q.rect(_t,De,Pt,25,"F"),q.setDrawColor(...K),q.setLineWidth(.5),q.rect(_t,De,Pt,25,"S"),q.setTextColor(...K),q.setFontSize(16),q.setFont("helvetica","bold"),q.text($e.value,_t+Pt/2,De+12,{align:"center"}),q.setTextColor(100,116,139),q.setFontSize(8),q.setFont("helvetica","normal"),q.text($e.label,_t+Pt/2,De+20,{align:"center"})}),De+=35;const dt=[],ja=[],Ce=[];let Ue=0,He=0,Xe=0,E=0,ie=0,ue=0;Z.forEach($e=>{$e.t_and_m_workers&&$e.t_and_m_workers.forEach(st=>{const _t=parseFloat(st.hours)||0,Dt=parseFloat(st.overtime_hours)||0,wt=st.role||"Laborer",va=[St($e.work_date),st.name,_t.toString(),Dt>0?Dt.toString():"-",(_t+Dt).toString()];wt==="Foreman"||wt==="Superintendent"?(dt.push(va),Ue+=_t,He+=Dt):wt==="Operator"?(ja.push(va),Xe+=_t,E+=Dt):(Ce.push(va),ie+=_t,ue+=Dt)})});const be=($e,st,_t,Dt)=>{st.length!==0&&(De>Se-80&&(q.addPage(),De=ke),q.setTextColor(...K),q.setFontSize(11),q.setFont("helvetica","bold"),q.text($e,ke,De),De+=5,sn(q,{startY:De,head:[["Date","Name","Reg Hrs","OT Hrs","Total"]],body:st,margin:{left:ke,right:ke},headStyles:{fillColor:K,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:30},2:{halign:"center",cellWidth:22},3:{halign:"center",cellWidth:22},4:{halign:"center",cellWidth:22}},foot:[["","SUBTOTAL:",_t.toString(),Dt>0?Dt.toString():"-",(_t+Dt).toString()]],footStyles:{fillColor:ye,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),De=q.lastAutoTable.finalY+10)};if(dt.length>0||ja.length>0||Ce.length>0){q.setTextColor(...K),q.setFontSize(12),q.setFont("helvetica","bold"),q.text("LABOR",ke,De),De+=8,be("SUPERVISION",dt,Ue,He),be("OPERATORS",ja,Xe,E),be("LABORERS",Ce,ie,ue);const $e=Ue+Xe+ie,st=He+E+ue;q.setFillColor(...K),q.rect(ke,De,Me-ke*2,12,"F"),q.setTextColor(255,255,255),q.setFontSize(10),q.setFont("helvetica","bold"),q.text("LABOR TOTAL:",ke+5,De+8),q.text(`${$e} Reg + ${st} OT = ${$e+st} Hours`,Me-ke-5,De+8,{align:"right"}),De+=20}De>Se-100&&(q.addPage(),De=ke);const Ae={},Te={},Ye=["Containment","PPE","Disposal","Equipment","Other"];Z.forEach($e=>{$e.t_and_m_items&&$e.t_and_m_items.forEach(st=>{const _t=st.custom_name||st.materials_equipment?.name||"Unknown",Dt=st.custom_category||st.materials_equipment?.category||"Other",wt=st.materials_equipment?.unit||"each",va=st.materials_equipment?.cost_per_unit||0,La=st.quantity*va;Ae[Dt]||(Ae[Dt]=[],Te[Dt]=0),Ae[Dt].push([St($e.work_date),_t,st.quantity.toString(),wt,`$${va.toFixed(2)}`,`$${La.toFixed(2)}`]),Te[Dt]+=La})});const $t=($e,st,_t)=>{!st||st.length===0||(De>Se-80&&(q.addPage(),De=ke),q.setTextColor(...K),q.setFontSize(11),q.setFont("helvetica","bold"),q.text($e.toUpperCase(),ke,De),De+=5,sn(q,{startY:De,head:[["Date","Item","Qty","Unit","Rate","Total"]],body:st,margin:{left:ke,right:ke},headStyles:{fillColor:K,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{2:{halign:"center",cellWidth:20},3:{halign:"center",cellWidth:25},4:{halign:"right",cellWidth:25},5:{halign:"right",cellWidth:30}},foot:[["","","","","Subtotal:",`$${_t.toFixed(2)}`]],footStyles:{fillColor:ye,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),De=q.lastAutoTable.finalY+10)};Object.keys(Ae).length>0&&(q.setTextColor(...K),q.setFontSize(12),q.setFont("helvetica","bold"),q.text("MATERIALS & EQUIPMENT",ke,De),De+=8,Ye.forEach($e=>{Ae[$e]&&$t($e,Ae[$e],Te[$e])}),Object.keys(Ae).forEach($e=>{Ye.includes($e)||$t($e,Ae[$e],Te[$e])}),q.setFillColor(...K),q.rect(ke,De,Me-ke*2,12,"F"),q.setTextColor(255,255,255),q.setFontSize(10),q.setFont("helvetica","bold"),q.text("MATERIALS TOTAL:",ke+5,De+8),q.text(`$${ta.toFixed(2)}`,Me-ke-5,De+8,{align:"right"}),De+=20),De>Se-80&&(q.addPage(),De=ke),De+=10,q.setDrawColor(...K),q.setLineWidth(1),q.line(ke,De,Me-ke,De),De+=15,q.setTextColor(...K),q.setFontSize(12),q.setFont("helvetica","bold"),q.text("AUTHORIZATION",ke,De),De+=10,q.setFontSize(10),q.setFont("helvetica","normal"),q.setTextColor(71,85,105),q.text("I hereby authorize the above time and materials charges as accurate and approved for billing.",ke,De),De+=20;const Re=ticketsToExport[0]||{},We=($e,st,_t,Dt,wt,va,La)=>{q.setFont("helvetica","bold"),q.setFontSize(8),q.setTextColor(...K),q.text(st,ke,$e),q.setFont("helvetica","normal"),q.setFontSize(9),q.setTextColor(100,116,139);const Lt=$e+18;if(q.setDrawColor(...ye),q.setLineWidth(.5),q.line(ke,Lt,ke+70,Lt),q.text("Signature",ke,Lt+8),q.line(ke+85,Lt,ke+145,Lt),q.text("Title / Company",ke+85,Lt+8),q.line(Me-ke-40,Lt,Me-ke,Lt),q.text("Date",Me-ke-40,Lt+8),_t)try{if(q.addImage(_t,"PNG",ke,Lt-16,60,16),Dt&&(q.setFontSize(8),q.text(Dt,ke,Lt+15)),wt||va){const ya=[wt,va].filter(Boolean).join(" - ");q.text(ya,ke+85,Lt-5)}if(La){const ya=new Date(La).toLocaleDateString();q.text(ya,Me-ke-40,Lt-5)}}catch(ya){console.error("Error adding signature to PDF:",ya)}return Lt+25};De=We(De,"GC AUTHORIZATION",Re.gc_signature_data,Re.gc_signature_name,Re.gc_signature_title,Re.gc_signature_company,Re.gc_signature_date),De+=8,De=We(De,"CLIENT AUTHORIZATION",Re.client_signature_data,Re.client_signature_name,Re.client_signature_title,Re.client_signature_company,Re.client_signature_date);const Vt=q.internal.getNumberOfPages();for(let $e=1;$e<=Vt;$e++){q.setPage($e);const st=Se-15;q.setFontSize(8),q.setTextColor(148,163,184),q.text(`${l?.name||"Company"} - T&M Report - ${r.name}`,ke,st),q.text(`Page ${$e} of ${Vt}`,Me-ke,st,{align:"right"})}const Jt=`${r.name}_TM_Report_${new Date().toISOString().split("T")[0]}.pdf`;q.save(Jt),o("PDF exported!","success")},ge=f.useMemo(()=>{let Z=x==="all"?[...m]:m.filter(q=>q.status===x);if(N.start){const q=new Date(N.start);q.setHours(0,0,0,0),Z=Z.filter(Me=>new Date(Me.work_date)>=q)}if(N.end){const q=new Date(N.end);q.setHours(23,59,59,999),Z=Z.filter(Me=>new Date(Me.work_date)<=q)}if(F==="recent"){const q=new Date;q.setDate(q.getDate()-7),q.setHours(0,0,0,0),Z=Z.filter(Me=>new Date(Me.work_date)>=q)}return Z},[m,x,F,N]),Le=f.useMemo(()=>{if(F!=="all")return null;const Z={};return ge.forEach(q=>{const Me=new Date(q.work_date),Se=`${Me.getFullYear()}-${String(Me.getMonth()+1).padStart(2,"0")}`,ke=Me.toLocaleDateString("en-US",{month:"long",year:"numeric"});Z[Se]||(Z[Se]={label:ke,tickets:[],hours:0,cost:0}),Z[Se].tickets.push(q),Z[Se].hours+=ot(q),Z[Se].cost+=tt(q)}),Object.entries(Z).sort((q,Me)=>Me[0].localeCompare(q[0]))},[ge,F]);f.useEffect(()=>{if(Le&&Le.length>0){const Z=Le[0][0];W(new Set([Z]))}},[Le]);const Je=Z=>{const q=new Set(J);q.has(Z)?q.delete(Z):q.add(Z),W(q)},ve=ge.reduce((Z,q)=>Z+ot(q),0),ct=ge.reduce((Z,q)=>Z+tt(q),0),pt=x==="all"?m.length:m.filter(Z=>Z.status===x).length;if(j)return e.jsx("div",{className:"loading",children:"Loading T&M tickets..."});const ia=ge.length>0&&ge.every(Z=>B.has(Z.id)),Ft=B.size>0,Zt=Z=>{const q=!!de[Z.id],Me=de[Z.id];return e.jsxs("div",{className:`tm-ticket-card ${Z.status} ${B.has(Z.id)?"selected":""} ${q?"locked":""}`,children:[e.jsxs("div",{className:"tm-ticket-header",onClick:()=>T(g===Z.id?null:Z.id),children:[e.jsx("input",{type:"checkbox",checked:B.has(Z.id),onChange:Se=>rt(Z.id,Se),onClick:Se=>Se.stopPropagation(),className:"tm-checkbox"}),e.jsxs("div",{className:"tm-ticket-info",children:[e.jsx("span",{className:"tm-ticket-date",children:St(Z.work_date)}),Z.ce_pco_number&&e.jsx("span",{className:"tm-ce-badge",children:Z.ce_pco_number}),Z.assigned_cor_id&&Me?.lockedBy&&e.jsxs("span",{className:`tm-cor-badge ${q?"locked":""}`,title:Me.reason,children:[q&&e.jsx(bf,{size:10}),Me.lockedBy.cor_number]}),Z.photos?.length>0&&e.jsxs("span",{className:"tm-photo-badge",title:`${Z.photos.length} photo${Z.photos.length>1?"s":""}`,children:[e.jsx(xr,{size:12})," ",Z.photos.length]}),e.jsx("span",{className:`tm-ticket-status ${Z.status}`,children:Z.status})]}),e.jsxs("div",{className:"tm-ticket-summary",children:[e.jsxs("span",{className:"tm-ticket-hours",children:[ot(Z)," hrs"]}),e.jsxs("span",{className:"tm-ticket-total",children:["$",tt(Z).toFixed(2)]}),e.jsx("span",{className:"tm-expand-arrow",children:g===Z.id?"":""})]})]}),g===Z.id&&e.jsxs("div",{className:"tm-ticket-details",children:[Z.t_and_m_workers?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(ua,{size:16,className:"inline-icon"})," Workers"]}),e.jsx("div",{className:"tm-detail-list",children:Z.t_and_m_workers.map(Se=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsxs("span",{children:[Se.role&&Se.role!=="Laborer"&&e.jsx("span",{className:"tm-role-badge",children:Se.role}),Se.name]}),e.jsxs("span",{children:[Se.hours," hrs",parseFloat(Se.overtime_hours)>0&&e.jsxs("span",{className:"tm-ot-badge",children:[" +",Se.overtime_hours," OT"]})]})]},Se.id))})]}),Z.t_and_m_items?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(gl,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsx("div",{className:"tm-detail-list",children:Z.t_and_m_items.map(Se=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsx("span",{children:Se.custom_name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"tm-custom-badge",children:"Custom"})," ",Se.custom_name]}):Se.materials_equipment?.name}),e.jsxs("span",{className:"tm-detail-qty",children:[Se.quantity," ",Se.materials_equipment?.unit||"each",Se.materials_equipment?.cost_per_unit>0&&e.jsxs("span",{className:"tm-item-cost",children:["$",(Se.quantity*Se.materials_equipment.cost_per_unit).toFixed(2)]})]})]},Se.id))})]}),Z.notes&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Ua,{size:16,className:"inline-icon"})," Description"]}),e.jsx("p",{className:"tm-notes-text",children:Z.notes})]}),Z.photos&&Z.photos.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(xr,{size:16,className:"inline-icon"})," Photos (",Z.photos.length,")"]}),e.jsx("div",{className:"tm-photos-grid",children:Z.photos.map((Se,ke)=>e.jsx("a",{href:Se,target:"_blank",rel:"noopener noreferrer",className:"tm-photo-thumb",children:e.jsx("img",{src:Se,alt:`Photo ${ke+1}`,onError:De=>{De.target.onerror=null,De.target.classList.add("photo-error"),De.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg==",console.error("Failed to load photo:",Se)}})},ke))})]}),Z.ce_pco_number&&Z.change_order_value>0&&e.jsxs("div",{className:"tm-change-order-value",children:[e.jsx("span",{className:"tm-co-label",children:"Change Order Value:"}),e.jsxs("span",{className:"tm-co-amount",children:["$",Z.change_order_value.toLocaleString()]})]}),q&&e.jsxs("div",{className:"tm-lock-notice",children:[e.jsx(bf,{size:14}),e.jsx("span",{children:Me?.reason||"This ticket is locked (COR approved)"})]}),e.jsxs("div",{className:"tm-ticket-actions",children:[Z.status==="pending"&&!q&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:Se=>{Se.stopPropagation(),qe(Z)},children:"Approve"}),e.jsx("button",{className:"btn btn-warning btn-small",onClick:Se=>{Se.stopPropagation(),re(Z.id,"rejected")},children:"Reject"})]}),Z.status==="approved"&&!q&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary btn-small",onClick:Se=>{Se.stopPropagation(),re(Z.id,"billed")},children:"Mark Billed"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:Se=>{Se.stopPropagation(),_(Z),S(!0)},children:[e.jsx(vd,{size:14})," Signature Link"]})]}),Z.status==="rejected"&&!q&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Se=>{Se.stopPropagation(),re(Z.id,"pending")},children:"Restore"}),!q&&e.jsxs("button",{className:`btn btn-small ${Z.assigned_cor_id?"btn-ghost":"btn-secondary"}`,onClick:Se=>{Se.stopPropagation(),nt(Z)},title:Z.assigned_cor_id?"Change COR link":"Link to Change Order",children:[e.jsx(Rj,{size:14})," ",Z.assigned_cor_id?"COR":"Link COR"]}),!q&&e.jsx("button",{className:"btn btn-danger btn-small",onClick:Se=>{Se.stopPropagation(),Oe(Z.id)},children:"Delete"})]})]})]},Z.id)};return e.jsxs("div",{className:"tm-list",children:[e.jsxs("div",{className:"tm-list-header",children:[e.jsxs("div",{className:"tm-list-title",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("div",{className:"tm-export-buttons",children:[Ft&&e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:ma,children:["Clear (",B.size,")"]}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:Ie,children:["Excel ",Ft?`(${B.size})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:Ge,children:["PDF ",Ft?`(${B.size})`:""]})]})]}),e.jsx("div",{className:"tm-filter-tabs",children:["all","pending","approved","billed","rejected"].map(Z=>e.jsxs("button",{className:`tm-filter-tab ${x===Z?"active":""}`,onClick:()=>{y(Z),ma()},children:[Z.charAt(0).toUpperCase()+Z.slice(1),e.jsx("span",{className:"tm-filter-count",children:Z==="all"?m.length:m.filter(q=>q.status===Z).length})]},Z))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${F==="recent"?"active":""}`,onClick:()=>{L("recent"),M({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${F==="all"?"active":""}`,onClick:()=>L("all"),children:["All (",pt,")"]})]}),F==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(fl,{size:16}),e.jsx("input",{type:"date",value:N.start,onChange:Z=>M(q=>({...q,start:Z.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:N.end,onChange:Z=>M(q=>({...q,end:Z.target.value})),placeholder:"End date"}),(N.start||N.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>M({start:"",end:""}),children:"Clear"})]})]})]}),ge.length>0&&e.jsxs("div",{className:"tm-summary-bar",children:[e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Tickets"}),e.jsx("span",{className:"tm-summary-value",children:ge.length})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Total Hours"}),e.jsx("span",{className:"tm-summary-value",children:ve.toFixed(1)})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Materials Cost"}),e.jsxs("span",{className:"tm-summary-value",children:["$",ct.toFixed(2)]})]})]}),ge.length===0?e.jsxs("div",{className:"tm-empty-state",children:[e.jsxs("p",{children:["No ",x==="all"?"":x," T&M tickets",F==="recent"?" in the last 7 days":""]}),F==="recent"&&pt>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>L("all"),children:"View All Tickets"})]}):e.jsxs("div",{className:"tm-tickets",children:[e.jsx("div",{className:"tm-select-all-row",children:e.jsxs("label",{className:"tm-checkbox-label",onClick:at,children:[e.jsx("input",{type:"checkbox",checked:ia,onChange:at,className:"tm-checkbox"}),e.jsxs("span",{children:["Select All (",ge.length,")"]})]})}),F==="all"&&Le?Le.map(([Z,q])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>Je(Z),children:[e.jsxs("div",{className:"month-header-left",children:[J.has(Z)?e.jsx(_a,{size:18}):e.jsx(Es,{size:18}),e.jsx("span",{className:"month-label",children:q.label}),e.jsxs("span",{className:"month-count",children:[q.tickets.length," tickets"]})]}),e.jsxs("div",{className:"month-header-right",children:[e.jsxs("span",{className:"month-stat",children:[q.hours.toFixed(1)," hrs"]}),e.jsxs("span",{className:"month-stat",children:["$",q.cost.toFixed(2)]})]})]}),J.has(Z)&&e.jsx("div",{className:"month-tickets",children:q.tickets.map(Me=>Zt(Me))})]},Z)):ge.map(Z=>Zt(Z))]}),A&&ne&&e.jsx("div",{className:"modal-overlay",onClick:()=>ee(!1),children:e.jsxs("div",{className:"modal change-order-modal",onClick:Z=>Z.stopPropagation(),children:[e.jsx("h3",{children:"Approve Change Order Work"}),e.jsxs("p",{className:"modal-subtitle",children:["This T&M ticket is associated with ",e.jsx("strong",{children:ne.ce_pco_number})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Change Order Value ($)"}),e.jsx("input",{type:"number",value:z,onChange:Z=>H(Z.target.value),placeholder:"Enter the change order amount",autoFocus:!0}),e.jsx("p",{className:"form-help",children:"This amount will be added to the project's total contract value."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>ee(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:Ve,children:["Approve with $",parseFloat(z||0).toLocaleString()]})]})]})}),$&&v&&e.jsx(fp,{documentType:"tm_ticket",documentId:v.id,companyId:l?.id,projectId:r?.id,documentTitle:`T&M Ticket - ${new Date(v.work_date).toLocaleDateString()}${v.ce_pco_number?` (${v.ce_pco_number})`:""}`,onClose:()=>{S(!1),_(null)},onShowToast:o}),w&&D&&e.jsx("div",{className:"modal-overlay",onClick:()=>ae(!1),children:e.jsxs("div",{className:"modal cor-assign-modal",onClick:Z=>Z.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Link Ticket to Change Order"}),e.jsx("button",{className:"close-btn",onClick:()=>ae(!1),children:e.jsx(Ms,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{className:"modal-subtitle",children:["Ticket: ",e.jsx("strong",{children:new Date(D.work_date).toLocaleDateString()}),D.ce_pco_number&&` (${D.ce_pco_number})`]}),X?e.jsx("div",{className:"loading",children:"Loading change orders..."}):k.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No change orders found for this project."}),e.jsx("p",{className:"text-muted",children:"Create a COR first, then link tickets to it."})]}):e.jsxs("div",{className:"cor-select-wrapper",children:[e.jsx("label",{children:"Select Change Order:"}),e.jsxs("select",{value:Y,onChange:Z=>I(Z.target.value),className:"cor-select",children:[e.jsx("option",{value:"",children:"-- No COR (unlink) --"}),k.map(Z=>e.jsxs("option",{value:Z.id,children:[Z.cor_number," - ",Z.title||"Untitled"," (",Z.status,")"]},Z.id))]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>ae(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:zt,disabled:X||k.length===0,children:D.assigned_cor_id&&!Y?"Unlink from COR":"Link to COR"})]})]})})]})}function Xv({project:r,onClose:l,onShareCreated:o}){const{user:c}=up(),[m,u]=f.useState(!1),[j,p]=f.useState(null),[x,y]=f.useState([]),[g,T]=f.useState(!1),[B,U]=f.useState({progress:!0,photos:!0,daily_reports:!0,tm_tickets:!1,crew_info:!1}),[F,L]=f.useState("never"),[J,W]=f.useState("");f.useEffect(()=>{N()},[r.id]);const N=async()=>{try{const v=await se.getProjectShares(r.id);y(v)}catch(v){console.error("Error loading shares:",v)}},M=v=>{U(_=>({..._,[v]:!_[v]}))},A=()=>{if(F==="never")return null;const v=new Date;if(F==="30days")v.setDate(v.getDate()+30);else if(F==="90days")v.setDate(v.getDate()+90);else if(F==="custom"&&J)return new Date(J).toISOString();return v.toISOString()},ee=async()=>{u(!0);try{const v=A(),_=await se.createProjectShare(r.id,c.id,B,v);p({type:"success",message:"Share link created!"}),T(!1),N(),o&&o(_)}catch(v){console.error("Error creating share:",v),p({type:"error",message:"Failed to create share link"})}finally{u(!1)}},ne=v=>{const _=`${window.location.origin}/view/${v}`;navigator.clipboard.writeText(_),p({type:"success",message:"Link copied to clipboard!"})},Q=async v=>{if(confirm("Are you sure you want to revoke this share link?"))try{await se.revokeProjectShare(v),p({type:"success",message:"Share link revoked"}),N()}catch(_){console.error("Error revoking share:",_),p({type:"error",message:"Failed to revoke share link"})}},z=async v=>{if(confirm("Are you sure you want to permanently delete this share link?"))try{await se.deleteProjectShare(v),p({type:"success",message:"Share link deleted"}),N()}catch(_){console.error("Error deleting share:",_),p({type:"error",message:"Failed to delete share link"})}},H=v=>v?new Date(v).toLocaleDateString():"Never",$=v=>v?new Date(v)<new Date:!1,S=v=>{const _=[];return v.progress&&_.push("Progress"),v.photos&&_.push("Photos"),v.daily_reports&&_.push("Reports"),v.tm_tickets&&_.push("T&M"),v.crew_info&&_.push("Crew"),_.join(", ")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:l,children:e.jsxs("div",{className:"modal-content share-modal",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Share Project: ",r.name]}),e.jsx("button",{className:"close-btn",onClick:l,children:""})]}),e.jsxs("div",{className:"modal-body",children:[x.length>0&&e.jsxs("div",{className:"existing-shares",children:[e.jsx("h3",{children:"Active Share Links"}),e.jsx("div",{className:"shares-list",children:x.map(v=>e.jsxs("div",{className:`share-item ${!v.is_active||$(v.expires_at)?"inactive":""}`,children:[e.jsxs("div",{className:"share-info",children:[e.jsxs("div",{className:"share-token",children:[e.jsxs("code",{children:[window.location.origin,"/view/",v.share_token]}),e.jsx("button",{className:"btn-small",onClick:()=>ne(v.share_token),disabled:!v.is_active||$(v.expires_at),children:"Copy"})]}),e.jsxs("div",{className:"share-meta",children:[e.jsx("span",{className:"permissions",children:S(v.permissions)}),e.jsxs("span",{className:"expiry",children:["Expires: ",H(v.expires_at)]}),e.jsxs("span",{className:"views",children:["Views: ",v.view_count||0,v.last_viewed_at&&` (Last: ${H(v.last_viewed_at)})`]})]}),!v.is_active&&e.jsx("div",{className:"status-badge revoked",children:"Revoked"}),$(v.expires_at)&&v.is_active&&e.jsx("div",{className:"status-badge expired",children:"Expired"})]}),e.jsxs("div",{className:"share-actions",children:[v.is_active&&!$(v.expires_at)&&e.jsx("button",{className:"btn-secondary",onClick:()=>Q(v.id),children:"Revoke"}),e.jsx("button",{className:"btn-danger",onClick:()=>z(v.id),children:"Delete"})]})]},v.id))})]}),!g&&e.jsx("button",{className:"btn-primary",onClick:()=>T(!0),children:"+ Create New Share Link"}),g&&e.jsxs("div",{className:"new-share-form",children:[e.jsx("h3",{children:"Create New Share Link"}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Permissions"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:B.progress,onChange:()=>M("progress")}),"Progress/completion status"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:B.photos,onChange:()=>M("photos")}),"Photos feed"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:B.daily_reports,onChange:()=>M("daily_reports")}),"Daily reports"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:B.tm_tickets,onChange:()=>M("tm_tickets")}),"T&M tickets"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:B.crew_info,onChange:()=>M("crew_info")}),"Crew information"]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"never",checked:F==="never",onChange:v=>L(v.target.value)}),"Never expires"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"30days",checked:F==="30days",onChange:v=>L(v.target.value)}),"30 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"90days",checked:F==="90days",onChange:v=>L(v.target.value)}),"90 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"custom",checked:F==="custom",onChange:v=>L(v.target.value)}),"Custom date"]})]}),F==="custom"&&e.jsx("input",{type:"date",value:J,onChange:v=>W(v.target.value),min:new Date().toISOString().split("T")[0],className:"date-input"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>T(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:ee,disabled:m,children:m?"Generating...":"Generate Share Link"})]})]})]})]})}),j&&e.jsx(Ss,{message:j.message,type:j.type,onClose:()=>p(null)}),e.jsx("style",{children:`
        .share-modal {
          max-width: 700px;
          max-height: 80vh;
          overflow-y: auto;
        }

        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1.5rem;
          border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .close-btn {
          background: none;
          border: none;
          font-size: 2rem;
          cursor: pointer;
          color: var(--text-secondary);
          padding: 0;
          width: 2rem;
          height: 2rem;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .close-btn:hover {
          color: var(--text-primary);
        }

        .modal-body {
          padding: 1.5rem;
        }

        .existing-shares {
          margin-bottom: 2rem;
        }

        .existing-shares h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .shares-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .share-item {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          gap: 1rem;
          background: var(--bg-card);
        }

        .share-item.inactive {
          opacity: 0.6;
          background-color: var(--bg-elevated);
        }

        .share-info {
          flex: 1;
        }

        .share-token {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-bottom: 0.5rem;
        }

        .share-token code {
          background-color: var(--bg-elevated);
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.875rem;
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          color: var(--text-primary);
        }

        .share-meta {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .status-badge {
          display: inline-block;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 500;
          margin-top: 0.5rem;
        }

        .status-badge.revoked {
          background-color: #fee2e2;
          color: #991b1b;
        }

        .status-badge.expired {
          background-color: #fef3c7;
          color: #92400e;
        }

        .share-actions {
          display: flex;
          gap: 0.5rem;
          flex-shrink: 0;
        }

        .new-share-form {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          background-color: var(--bg-elevated);
        }

        .new-share-form h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .form-section {
          margin-bottom: 1.5rem;
        }

        .form-section label {
          display: block;
          font-weight: 500;
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .checkbox-group,
        .radio-group {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .checkbox-group label,
        .radio-group label {
          font-weight: normal;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .checkbox-group input[type="checkbox"],
        .radio-group input[type="radio"] {
          margin: 0;
        }

        .date-input {
          margin-top: 0.5rem;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          width: 100%;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-actions {
          display: flex;
          justify-content: flex-end;
          gap: 0.5rem;
          margin-top: 1.5rem;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
          border: 1px solid var(--border-color);
          background-color: var(--bg-card);
          color: var(--text-primary);
          border-radius: 4px;
          cursor: pointer;
        }

        .btn-small:hover:not(:disabled) {
          background-color: var(--bg-elevated);
        }

        .btn-small:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }
      `})]})}const ad=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},Iv=r=>new Promise(l=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),l(c.toDataURL("image/png"))},o.onerror=()=>l(null),o.src=r});function Zv({project:r,companyId:l,company:o,onShowToast:c}){const{branding:m}=vr(),[u,j]=f.useState([]),[p,x]=f.useState(null),[y,g]=f.useState(!1),[T,B]=f.useState(!0),[U,F]=f.useState(null),[L,J]=f.useState("recent"),[W,N]=f.useState(new Set),[M,A]=f.useState({start:"",end:""});f.useEffect(()=>{ee();const k=l||r?.company_id,fe=k?se.subscribeToInjuryReports?.(k,()=>{ee()}):null;return()=>{fe&&se.unsubscribe?.(fe)}},[r?.id,l]);const ee=async()=>{B(!0);try{const k=r?await se.getInjuryReports(r.id):await se.getCompanyInjuryReports(l);j(k)}catch(k){console.error("Error loading injury reports:",k),F({type:"error",message:"Failed to load injury reports"})}finally{B(!1)}},ne=()=>{ee(),g(!1),F({type:"success",message:"Injury report created successfully"})},Q=k=>{x(k)},z=()=>{x(null)},H=k=>k?new Date(k).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",$=k=>k?new Date(`2000-01-01T${k}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",S=k=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[k]||k,v=k=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[k]||"#9ca3af",_=k=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[k]||"#9ca3af",w=f.useMemo(()=>{let k=[...u];if(M.start){const fe=new Date(M.start);fe.setHours(0,0,0,0),k=k.filter(Y=>new Date(Y.incident_date)>=fe)}if(M.end){const fe=new Date(M.end);fe.setHours(23,59,59,999),k=k.filter(Y=>new Date(Y.incident_date)<=fe)}if(L==="recent"){const fe=new Date;fe.setDate(fe.getDate()-7),fe.setHours(0,0,0,0),k=k.filter(Y=>new Date(Y.incident_date)>=fe)}return k},[u,L,M]),ae=f.useMemo(()=>{if(L!=="all")return null;const k={};return w.forEach(fe=>{const Y=new Date(fe.incident_date),I=`${Y.getFullYear()}-${String(Y.getMonth()+1).padStart(2,"0")}`,X=Y.toLocaleDateString("en-US",{month:"long",year:"numeric"});k[I]||(k[I]={label:X,reports:[]}),k[I].reports.push(fe)}),Object.entries(k).sort((fe,Y)=>Y[0].localeCompare(fe[0]))},[w,L]);f.useEffect(()=>{if(ae&&ae.length>0){const k=ae[0][0];N(new Set([k]))}},[ae]);const D=k=>{const fe=new Set(W);fe.has(k)?fe.delete(k):fe.add(k),N(fe)},V=async()=>{if(u.length===0){F({type:"error",message:"No reports to export"});return}F({type:"info",message:"Generating PDF..."});const k=new Ui,fe=k.internal.pageSize.getWidth(),Y=20;let I=Y;const X=ad(m?.primary_color||"#3B82F6"),C=ad(m?.secondary_color||"#1E40AF");k.setFillColor(...X),k.rect(0,0,fe,45,"F"),k.setFillColor(...C),k.rect(0,42,fe,3,"F");let de=Y;if(m?.logo_url)try{const re=await Iv(m.logo_url);re&&(k.addImage(re,"PNG",Y,7,30,30),de=Y+40)}catch(re){console.error("Error adding logo:",re)}k.setTextColor(255,255,255),k.setFontSize(22),k.setFont("helvetica","bold"),k.text(o?.name||"Company",de,20),k.setFontSize(10),k.setFont("helvetica","normal"),k.text("INJURY & INCIDENT REPORTS",de,30),k.setFontSize(9),k.text(`Generated: ${new Date().toLocaleDateString()}`,fe-Y,20,{align:"right"}),k.text(`Total Reports: ${u.length}`,fe-Y,28,{align:"right"}),I=55,r&&(k.setFillColor(248,250,252),k.rect(Y,I-5,fe-Y*2,15,"F"),k.setTextColor(...X),k.setFontSize(12),k.setFont("helvetica","bold"),k.text(`Project: ${r.name}`,Y+5,I+5),I+=20),u.forEach(re=>{I>200&&(k.addPage(),I=Y);const qe=ad(_(re.injury_type));k.setFillColor(...qe),k.rect(Y,I,fe-Y*2,12,"F"),k.setTextColor(255,255,255),k.setFontSize(11),k.setFont("helvetica","bold"),k.text(`${re.employee_name} - ${S(re.injury_type)}`,Y+5,I+8),k.text(H(re.incident_date),fe-Y-5,I+8,{align:"right"}),I+=17,k.setTextColor(50,50,50),k.setFontSize(9),k.setFont("helvetica","normal"),k.text(`Location: ${re.incident_location}`,Y+5,I),re.incident_time&&k.text(`Time: ${$(re.incident_time)}`,Y+100,I),I+=6,k.setFont("helvetica","bold"),k.text("Description:",Y+5,I),k.setFont("helvetica","normal"),I+=5;const Ve=k.splitTextToSize(re.incident_description,fe-Y*2-10);k.text(Ve,Y+5,I),I+=Ve.length*4+3;const Oe=[];re.body_part_affected&&Oe.push(`Body Part: ${re.body_part_affected}`),re.osha_recordable&&Oe.push("OSHA Recordable"),re.workers_comp_claim&&Oe.push("Workers' Comp Filed"),re.medical_treatment_required&&Oe.push("Medical Treatment Required"),Oe.length>0&&(k.setFontSize(8),k.setTextColor(100,100,100),k.text(Oe.join("  |  "),Y+5,I),I+=5),k.setFontSize(8),k.text(`Reported by: ${re.reported_by_name} (${re.reported_by_title})`,Y+5,I),I+=12});const _e=k.internal.getNumberOfPages();for(let re=1;re<=_e;re++)k.setPage(re),k.setFontSize(8),k.setTextColor(150,150,150),k.text(`Page ${re} of ${_e}`,fe/2,k.internal.pageSize.getHeight()-10,{align:"center"}),k.text("CONFIDENTIAL - Injury Report",Y,k.internal.pageSize.getHeight()-10);const ze=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;k.save(ze),F({type:"success",message:"PDF exported!"})};return T?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[u.length>0&&e.jsx("button",{className:"btn-secondary",onClick:V,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>g(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${L==="recent"?"active":""}`,onClick:()=>{J("recent"),A({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${L==="all"?"active":""}`,onClick:()=>J("all"),children:["All (",u.length,")"]})]}),L==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(fl,{size:16}),e.jsx("input",{type:"date",value:M.start,onChange:k=>A(fe=>({...fe,start:k.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:M.end,onChange:k=>A(fe=>({...fe,end:k.target.value})),placeholder:"End date"}),(M.start||M.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>A({start:"",end:""}),children:"Clear"})]})]}),w.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:""}),e.jsxs("h4",{children:["No Injury Reports",L==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),L==="recent"&&u.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>J("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:L==="all"&&ae?ae.map(([k,fe])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>D(k),children:e.jsxs("div",{className:"month-header-left",children:[W.has(k)?e.jsx(_a,{size:18}):e.jsx(Es,{size:18}),e.jsx("span",{className:"month-label",children:fe.label}),e.jsxs("span",{className:"month-count",children:[fe.reports.length," reports"]})]})}),W.has(k)&&e.jsx("div",{className:"month-reports",children:fe.reports.map(Y=>e.jsxs("div",{className:"report-card",onClick:()=>Q(Y),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[H(Y.incident_date)," at ",$(Y.incident_time)]}),e.jsx("div",{className:"employee-name",children:Y.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:_(Y.injury_type)},children:S(Y.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:v(Y.status)},children:Y.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",Y.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",Y.reported_by_name," (",Y.reported_by_title,")"]}),Y.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",Y.body_part_affected]}),Y.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[Y.incident_description.substring(0,150),Y.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},Y.id))})]},k)):w.map(k=>e.jsxs("div",{className:"report-card",onClick:()=>Q(k),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[H(k.incident_date)," at ",$(k.incident_time)]}),e.jsx("div",{className:"employee-name",children:k.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:_(k.injury_type)},children:S(k.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:v(k.status)},children:k.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",k.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",k.reported_by_name," (",k.reported_by_title,")"]}),k.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",k.body_part_affected]}),k.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[k.incident_description.substring(0,150),k.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},k.id))}),p&&e.jsx("div",{className:"modal-overlay",onClick:z,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:z,children:""})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[H(p.incident_date)," at ",$(p.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:p.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:_(p.injury_type)},children:S(p.injury_type)})})]}),p.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:p.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:p.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:p.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:p.employee_job_title})]}),p.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:p.employee_phone})]}),p.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:p.employee_email})]}),p.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:p.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:p.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:p.reported_by_title})]}),p.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:p.reported_by_phone})]}),p.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:p.reported_by_email})]})]})]}),p.witnesses&&p.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),p.witnesses.map((k,fe)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:k.name}),k.phone&&e.jsxs("span",{children:["  ",k.phone]}),k.email&&e.jsxs("span",{children:["  ",k.email]})]}),k.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',k.testimony,'"']})})]},fe))]}),p.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[p.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:p.medical_facility_name})]}),p.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:p.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:p.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),p.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:p.immediate_actions_taken})]}),p.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:p.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[p.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:p.safety_equipment_used})]}),p.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:p.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:p.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:p.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:p.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:p.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",H(p.created_at)]})]})]})}),y&&e.jsx(mp,{project:r,companyId:l,onClose:()=>g(!1),onReportCreated:ne}),U&&e.jsx(Ss,{message:U.message,type:U.type,onClose:()=>F(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const sd=[{id:"message",label:"Messages",Icon:Cs,description:"Chat messages from field"},{id:"material_request",label:"Material Requests",Icon:ls,description:"Equipment and material requests"},{id:"injury_report",label:"Safety Reports",Icon:An,description:"Injury and safety incident reports"},{id:"tm_ticket",label:"T&M Tickets",Icon:Xa,description:"Time and materials tickets"}];function Jv({project:r,company:l,onShowToast:o,onClose:c}){const[m,u]=f.useState([]),[j,p]=f.useState({}),[x,y]=f.useState([]),[g,T]=f.useState(!0),[B,U]=f.useState(!1);f.useEffect(()=>{F()},[r?.id,l?.id]);const F=async()=>{if(!(!r?.id||!l?.id))try{T(!0);const M=await se.getCompanyUsers(l.id);u(M);const A=await se.getProjectNotificationPreferences(r.id),ee={};A.forEach(Q=>{ee[Q.user_id]={types:Q.notification_types||[],presetId:null}}),p(ee);const ne=await se.getNotificationPresets(l.id);y(ne)}catch(M){console.error("Error loading notification settings:",M),o?.("Error loading notification settings","error")}finally{T(!1)}},L=(M,A)=>{p(ee=>{const ne=ee[M]||{types:[]},Q=ne.types.includes(A)?ne.types.filter(z=>z!==A):[...ne.types,A];return{...ee,[M]:{types:Q,presetId:null}}})},J=(M,A)=>{const ee=x.find(ne=>ne.id===A);ee&&p(ne=>({...ne,[M]:{types:[...ee.notification_types],presetId:A}}))},W=(M,A)=>{p(ee=>({...ee,[M]:{types:A?sd.map(ne=>ne.id):[],presetId:null}}))},N=async()=>{try{U(!0);const M=Object.entries(j).map(([A,ee])=>({userId:A,notificationTypes:ee.types}));await se.setProjectNotificationPreferences(r.id,M),o?.("Notification settings saved","success"),c?.()}catch(M){console.error("Error saving notification settings:",M),o?.("Error saving notification settings","error")}finally{U(!1)}};return g?e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsx("button",{className:"close-btn",onClick:c,children:""})]}),e.jsx("div",{className:"loading-message",children:"Loading..."})]}):e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsxs("h3",{children:["Notification Settings for ",r?.name]}),e.jsx("button",{className:"close-btn",onClick:c,children:""})]}),e.jsx("p",{className:"settings-description",children:"Choose who receives notifications when field workers send messages, request materials, submit safety reports, or create T&M tickets for this project."}),m.length===0?e.jsxs("div",{className:"no-users-message",children:[e.jsx("p",{children:"No users found in this company."}),e.jsx("small",{children:"Users need to be added to the company to receive notifications."})]}):e.jsx("div",{className:"notification-users-list",children:m.map(M=>{const A=j[M.id]||{types:[],presetId:null},ee=A.types.length===sd.length,ne=A.types.length>0&&!ee;return e.jsxs("div",{className:"notification-user-row",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:M.name?.charAt(0).toUpperCase()||M.email?.charAt(0).toUpperCase()}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:M.name||M.email}),M.role&&e.jsx("span",{className:"user-role",children:M.role})]})]}),e.jsxs("div",{className:"notification-controls",children:[e.jsxs("select",{className:"preset-select",value:A.presetId||"",onChange:Q=>Q.target.value&&J(M.id,Q.target.value),children:[e.jsx("option",{value:"",children:"Apply preset..."}),x.map(Q=>e.jsx("option",{value:Q.id,children:Q.name},Q.id))]}),e.jsx("button",{className:`toggle-all-btn ${ee?"all-on":ne?"some-on":""}`,onClick:()=>W(M.id,!ee),title:ee?"Disable all":"Enable all",children:ee?"All On":ne?"Some":"None"})]}),e.jsx("div",{className:"notification-types",children:sd.map(Q=>e.jsxs("label",{className:`notification-type-toggle ${A.types.includes(Q.id)?"active":""}`,title:Q.description,children:[e.jsx("input",{type:"checkbox",checked:A.types.includes(Q.id),onChange:()=>L(M.id,Q.id)}),e.jsx("span",{className:"type-icon",children:e.jsx(Q.Icon,{size:16})}),e.jsx("span",{className:"type-label",children:Q.label})]},Q.id))})]},M.id)})}),e.jsxs("div",{className:"notification-settings-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:c,children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:N,disabled:B,children:B?"Saving...":"Save Settings"})]})]})}function Kv({project:r,company:l,onShowToast:o}){const[c,m]=f.useState([]),[u,j]=f.useState(!0),[p,x]=f.useState("all"),[y,g]=f.useState(null),[T,B]=f.useState("recent"),[U,F]=f.useState(new Set),[L,J]=f.useState({start:"",end:""});f.useEffect(()=>{W();const _=se.subscribeToMaterialRequests?.(r.id,()=>{W()});return()=>{_&&se.unsubscribe?.(_)}},[r.id]);const W=async()=>{try{const _=await se.getMaterialRequests(r.id);m(_||[])}catch(_){console.error("Error loading material requests:",_),o?.("Error loading material requests","error")}finally{j(!1)}},N=async(_,w)=>{try{await se.updateMaterialRequest(_,w,"Office"),m(c.map(ae=>ae.id===_?{...ae,status:w}:ae)),o?.(`Request ${w}`,"success")}catch(ae){console.error("Error updating status:",ae),o?.("Error updating status","error")}},M=_=>new Date(_).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),A=_=>new Date(_).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),ee=_=>{switch(_){case"urgent":return"priority-urgent";case"low":return"priority-low";default:return"priority-normal"}},ne=_=>{switch(_){case"urgent":return"";case"low":return"";default:return""}},Q=f.useMemo(()=>{let _=p==="all"?[...c]:c.filter(w=>w.status===p);if(L.start){const w=new Date(L.start);w.setHours(0,0,0,0),_=_.filter(ae=>new Date(ae.created_at)>=w)}if(L.end){const w=new Date(L.end);w.setHours(23,59,59,999),_=_.filter(ae=>new Date(ae.created_at)<=w)}if(T==="recent"){const w=new Date;w.setDate(w.getDate()-7),w.setHours(0,0,0,0),_=_.filter(ae=>new Date(ae.created_at)>=w)}return _},[c,p,T,L]),z=f.useMemo(()=>{if(T!=="all")return null;const _={};return Q.forEach(w=>{const ae=new Date(w.created_at),D=`${ae.getFullYear()}-${String(ae.getMonth()+1).padStart(2,"0")}`,V=ae.toLocaleDateString("en-US",{month:"long",year:"numeric"});_[D]||(_[D]={label:V,requests:[],itemCount:0}),_[D].requests.push(w),_[D].itemCount+=w.items?.length||0}),Object.entries(_).sort((w,ae)=>ae[0].localeCompare(w[0]))},[Q,T]);f.useEffect(()=>{if(z&&z.length>0){const _=z[0][0];F(new Set([_]))}},[z]);const H=_=>{const w=new Set(U);w.has(_)?w.delete(_):w.add(_),F(w)},$={all:c.length,pending:c.filter(_=>_.status==="pending").length,ordered:c.filter(_=>_.status==="ordered").length,delivered:c.filter(_=>_.status==="delivered").length,cancelled:c.filter(_=>_.status==="cancelled").length},S=p==="all"?c.length:c.filter(_=>_.status===p).length;if(u)return e.jsx("div",{className:"loading",children:"Loading material requests..."});const v=_=>e.jsxs("div",{className:`material-request-card ${_.status} ${_.priority==="urgent"?"urgent":""}`,children:[e.jsxs("div",{className:"material-request-header-row",onClick:()=>g(y===_.id?null:_.id),children:[e.jsxs("div",{className:"material-request-info",children:[e.jsxs("span",{className:`material-priority-badge ${ee(_.priority)}`,children:[ne(_.priority)," ",_.priority]}),e.jsx("span",{className:"material-request-date",children:M(_.created_at)}),e.jsx("span",{className:"material-request-time",children:A(_.created_at)})]}),e.jsxs("div",{className:"material-request-summary",children:[e.jsxs("span",{className:"material-items-count",children:[_.items?.length||0," item",(_.items?.length||0)!==1?"s":""]}),e.jsx("span",{className:`material-status ${_.status}`,children:_.status}),e.jsx("span",{className:"material-expand-arrow",children:y===_.id?"":""})]})]}),y===_.id&&e.jsxs("div",{className:"material-request-details",children:[e.jsxs("div",{className:"material-detail-section",children:[e.jsxs("div",{className:"material-requester",children:[e.jsx("span",{className:"requester-label",children:"Requested by:"}),e.jsx("span",{className:"requester-name",children:_.requested_by||"Field"})]}),_.needed_by&&e.jsxs("div",{className:"material-needed-by",children:[e.jsx("span",{className:"needed-label",children:"Needed by:"}),e.jsx("span",{className:"needed-date",children:M(_.needed_by)})]})]}),_.items?.length>0&&e.jsxs("div",{className:"material-detail-section",children:[e.jsx("h4",{children:"Items Requested"}),e.jsx("div",{className:"material-items-list",children:_.items.map((w,ae)=>e.jsxs("div",{className:"material-item-row",children:[e.jsx("span",{className:"item-name",children:w.name}),e.jsxs("span",{className:"item-quantity",children:[w.quantity," ",w.unit]})]},ae))})]}),_.notes&&e.jsxs("div",{className:"material-detail-section",children:[e.jsx("h4",{children:"Notes"}),e.jsx("p",{className:"material-notes",children:_.notes})]}),e.jsxs("div",{className:"material-request-actions",children:[_.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:w=>{w.stopPropagation(),N(_.id,"ordered")},children:"Mark Ordered"}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:w=>{w.stopPropagation(),N(_.id,"cancelled")},children:"Cancel"})]}),_.status==="ordered"&&e.jsx("button",{className:"btn btn-success btn-small",onClick:w=>{w.stopPropagation(),N(_.id,"delivered")},children:"Mark Delivered"}),_.status==="cancelled"&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:w=>{w.stopPropagation(),N(_.id,"pending")},children:"Restore"})]})]})]},_.id);return e.jsxs("div",{className:"material-requests-list card",children:[e.jsxs("div",{className:"material-requests-header",children:[e.jsxs("div",{className:"material-requests-title",children:[e.jsx("h3",{children:"Material Requests"}),$.pending>0&&e.jsxs("span",{className:"pending-badge",children:[$.pending," pending"]})]}),e.jsx("div",{className:"material-filter-tabs",children:["all","pending","ordered","delivered","cancelled"].map(_=>e.jsxs("button",{className:`material-filter-tab ${p===_?"active":""}`,onClick:()=>x(_),children:[_.charAt(0).toUpperCase()+_.slice(1),e.jsx("span",{className:"material-filter-count",children:$[_]})]},_))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${T==="recent"?"active":""}`,onClick:()=>{B("recent"),J({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${T==="all"?"active":""}`,onClick:()=>B("all"),children:["All (",S,")"]})]}),T==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(fl,{size:16}),e.jsx("input",{type:"date",value:L.start,onChange:_=>J(w=>({...w,start:_.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:L.end,onChange:_=>J(w=>({...w,end:_.target.value})),placeholder:"End date"}),(L.start||L.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>J({start:"",end:""}),children:"Clear"})]})]})]}),Q.length===0?e.jsxs("div",{className:"material-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(ls,{size:32})}),e.jsxs("p",{children:["No ",p==="all"?"":p," material requests",T==="recent"?" in the last 7 days":""]}),T==="recent"&&S>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>B("all"),children:"View All Requests"})]}):e.jsx("div",{className:"material-requests",children:T==="all"&&z?z.map(([_,w])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>H(_),children:[e.jsxs("div",{className:"month-header-left",children:[U.has(_)?e.jsx(_a,{size:18}):e.jsx(Es,{size:18}),e.jsx("span",{className:"month-label",children:w.label}),e.jsxs("span",{className:"month-count",children:[w.requests.length," requests"]})]}),e.jsx("div",{className:"month-header-right",children:e.jsxs("span",{className:"month-stat",children:[w.itemCount," items"]})})]}),U.has(_)&&e.jsx("div",{className:"month-requests",children:w.requests.map(ae=>v(ae))})]},_)):Q.map(_=>v(_))})]})}const Df=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},Wv=r=>new Promise(l=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),l(c.toDataURL("image/png"))},o.onerror=()=>l(null),o.src=r});function ey({project:r,company:l,onShowToast:o}){const{branding:c}=vr(),[m,u]=f.useState([]),[j,p]=f.useState(!0),[x,y]=f.useState(null),[g,T]=f.useState(new Set),[B,U]=f.useState(!1),[F,L]=f.useState("recent"),[J,W]=f.useState(new Set),[N,M]=f.useState({start:"",end:""});f.useEffect(()=>{A();const Y=se.subscribeToDailyReports?.(r.id,()=>{A()});return()=>{Y&&se.unsubscribe?.(Y)}},[r.id]);const A=async()=>{try{const Y=await se.getDailyReports(r.id,365);u(Y||[])}catch(Y){console.error("Error loading daily reports:",Y),o?.("Error loading daily reports","error")}finally{p(!1)}},ee=f.useMemo(()=>{let Y=[...m];if(N.start){const I=new Date(N.start);I.setHours(0,0,0,0),Y=Y.filter(X=>new Date(X.report_date||X.created_at)>=I)}if(N.end){const I=new Date(N.end);I.setHours(23,59,59,999),Y=Y.filter(X=>new Date(X.report_date||X.created_at)<=I)}if(F==="recent"){const I=new Date;I.setDate(I.getDate()-7),I.setHours(0,0,0,0),Y=Y.filter(X=>new Date(X.report_date||X.created_at)>=I)}return Y},[m,F,N]),ne=f.useMemo(()=>{if(F!=="all")return null;const Y={};return ee.forEach(I=>{const X=new Date(I.report_date||I.created_at),C=`${X.getFullYear()}-${String(X.getMonth()+1).padStart(2,"0")}`,de=X.toLocaleDateString("en-US",{month:"long",year:"numeric"});Y[C]||(Y[C]={label:de,reports:[]}),Y[C].reports.push(I)}),Object.entries(Y).sort((I,X)=>X[0].localeCompare(I[0]))},[ee,F]);f.useEffect(()=>{if(ne&&ne.length>0){const Y=ne[0][0];W(new Set([Y]))}},[ne]);const Q=()=>{U(!B),B&&T(new Set)},z=Y=>{const I=new Set(g);I.has(Y)?I.delete(Y):I.add(Y),T(I)},H=()=>{g.size===ee.length?T(new Set):T(new Set(ee.map(Y=>Y.id)))},$=Y=>{const I=new Set(J);I.has(Y)?I.delete(Y):I.add(Y),W(I)},S=()=>g.size>0?ee.filter(Y=>g.has(Y.id)):ee,v=Y=>new Date(Y).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),_=Y=>new Date(Y).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),w=Y=>{switch(Y){case"submitted":return"";case"reviewed":return"";case"draft":return"";default:return""}},ae=Y=>{switch(Y){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return Y}},D=async()=>{const Y=S();if(Y.length===0){o?.("No reports to export","error");return}o?.("Generating PDF...","info");const I=new Ui,X=I.internal.pageSize.getWidth(),C=20;let de=C;const _e=Df(c?.primary_color||"#3B82F6"),ze=Df(c?.secondary_color||"#1E40AF");I.setFillColor(..._e),I.rect(0,0,X,45,"F"),I.setFillColor(...ze),I.rect(0,42,X,3,"F");let re=C;if(c?.logo_url)try{const Oe=await Wv(c.logo_url);Oe&&(I.addImage(Oe,"PNG",C,7,30,30),re=C+40)}catch(Oe){console.error("Error adding logo:",Oe)}I.setTextColor(255,255,255),I.setFontSize(22),I.setFont("helvetica","bold"),I.text(l?.name||"Company Name",re,20),I.setFontSize(10),I.setFont("helvetica","normal"),I.text("DAILY REPORTS SUMMARY",re,30),I.setFontSize(9),I.text(`Generated: ${new Date().toLocaleDateString()}`,X-C,20,{align:"right"}),r.job_number&&I.text(`Job #: ${r.job_number}`,X-C,28,{align:"right"}),de=55,I.setFillColor(248,250,252),I.rect(C,de-5,X-C*2,20,"F"),I.setTextColor(..._e),I.setFontSize(14),I.setFont("helvetica","bold"),I.text(`Project: ${r.name}`,C+5,de+7),I.setFontSize(10),I.setTextColor(100,100,100),I.text(`${Y.length} Report${Y.length!==1?"s":""}`,X-C-5,de+7,{align:"right"}),de+=25,Y.forEach((Oe,nt)=>{de>250&&(I.addPage(),de=C),I.setFillColor(..._e),I.setTextColor(255,255,255),I.rect(C,de,X-C*2,10,"F"),I.setFontSize(11),I.setFont("helvetica","bold"),I.text(v(Oe.report_date||Oe.created_at),C+5,de+7),I.text(ae(Oe.status),X-C-5,de+7,{align:"right"}),de+=15,I.setTextColor(50,50,50),I.setFontSize(10),I.setFont("helvetica","normal");const zt=`Crew: ${Oe.crew_count||0}  |  Tasks: ${Oe.tasks_completed||0}  |  T&M: ${Oe.tm_tickets_count||0}  |  Photos: ${Oe.photos_count||0}`;if(I.text(zt,C+5,de),de+=8,Oe.crew_list?.length>0){I.setFont("helvetica","bold"),I.text("Crew:",C+5,de),I.setFont("helvetica","normal");const tt=Oe.crew_list.map(St=>`${St.name} (${St.role})`).join(", "),ot=I.splitTextToSize(tt,X-C*2-30);I.text(ot,C+25,de),de+=ot.length*5+3}if(Oe.field_notes){I.setFont("helvetica","bold"),I.text("Notes:",C+5,de),I.setFont("helvetica","normal");const tt=I.splitTextToSize(Oe.field_notes,X-C*2-30);I.text(tt,C+25,de),de+=tt.length*5+3}if(Oe.issues){I.setTextColor(180,50,50),I.setFont("helvetica","bold"),I.text("Issues:",C+5,de),I.setFont("helvetica","normal");const tt=I.splitTextToSize(Oe.issues,X-C*2-30);I.text(tt,C+25,de),I.setTextColor(50,50,50),de+=tt.length*5+3}de+=10});const qe=I.internal.getNumberOfPages();for(let Oe=1;Oe<=qe;Oe++)I.setPage(Oe),I.setFontSize(8),I.setTextColor(150,150,150),I.text(`Page ${Oe} of ${qe}`,X/2,I.internal.pageSize.getHeight()-10,{align:"center"});const Ve=`${r.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;I.save(Ve),o?.("PDF exported!","success")},V=Y=>e.jsxs("div",{className:`daily-report-card ${Y.status} ${g.has(Y.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>y(x===Y.id?null:Y.id),children:[B&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:g.has(Y.id),onChange:I=>{I.stopPropagation(),z(Y.id)},onClick:I=>I.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:v(Y.report_date||Y.created_at)}),e.jsxs("span",{className:`report-status ${Y.status}`,children:[w(Y.status)," ",ae(Y.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[Y.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[Y.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:x===Y.id?"":""})]})]}),x===Y.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:Y.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:Y.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:Y.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:Y.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),Y.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:Y.crew_list.map((I,X)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:I.name}),e.jsx("span",{className:"crew-role",children:I.role})]},X))})]}),Y.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:Y.completed_tasks.map((I,X)=>e.jsxs("li",{children:[I.name,I.group&&e.jsx("span",{className:"task-group",children:I.group})]},X))})]}),Y.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:Y.field_notes})]}),Y.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:Y.issues})]}),Y.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",Y.submitted_by||"Field"," at ",_(Y.submitted_at)]})})]})]},Y.id);if(j)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});const k=m.length,fe=ee.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${B?"btn-primary":"btn-secondary"}`,onClick:Q,children:B?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:D,children:["PDF",g.size>0?` (${g.size})`:""]})]})})]}),m.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${F==="recent"?"active":""}`,onClick:()=>L("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${F==="all"?"active":""}`,onClick:()=>L("all"),children:["All (",k,")"]})]}),F==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(fl,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:N.start,onChange:Y=>M(I=>({...I,start:Y.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:N.end,onChange:Y=>M(I=>({...I,end:Y.target.value})),className:"date-input"}),(N.start||N.end)&&e.jsx("button",{className:"date-clear",onClick:()=>M({start:"",end:""}),children:"Clear"})]})]}),B&&ee.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:g.size===ee.length&&ee.length>0,onChange:H}),"Select All (",ee.length,")"]}),g.size>0&&e.jsxs("span",{className:"selected-count",children:[g.size," selected"]})]}),m.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Xa,{size:32})}),e.jsx("p",{children:"No daily reports yet"}),e.jsx("small",{children:"Reports from the field will appear here"})]}):ee.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Xa,{size:32})}),e.jsx("p",{children:"No reports in this time period"}),e.jsx("small",{children:F==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"})]}):F==="recent"?e.jsxs("div",{className:"daily-reports",children:[ee.map(Y=>V(Y)),k>fe&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>L("all"),children:["View All ",k," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:ne?.map(([Y,{label:I,reports:X}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>$(Y),children:[J.has(Y)?e.jsx(_a,{size:18,className:"month-chevron"}):e.jsx(Es,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:I}),e.jsxs("span",{className:"month-count",children:[X.length," report",X.length!==1?"s":""]})]}),J.has(Y)&&e.jsx("div",{className:"month-reports",children:X.map(C=>V(C))})]},Y))})]})}function ty({project:r,company:l,userName:o,onShowToast:c}){const[m,u]=f.useState([]),[j,p]=f.useState(!0),[x,y]=f.useState(!1),[g,T]=f.useState(""),[B,U]=f.useState(0),[F,L]=f.useState(!1),J=f.useRef(null);f.useEffect(()=>{W();const ne=se.subscribeToMessages?.(r.id,Q=>{Q.new&&(u(z=>[...z,Q.new]),Q.new.sender_type==="field"&&U(z=>z+1))});return()=>{ne&&se.unsubscribe?.(ne)}},[r.id]),f.useEffect(()=>{F&&(J.current?.scrollIntoView({behavior:"smooth"}),se.markMessagesRead?.(r.id,"office"),U(0))},[m,F]);const W=async()=>{try{const Q=(await se.getMessages(r.id,50)||[]).sort((H,$)=>new Date(H.created_at)-new Date($.created_at));u(Q);const z=Q.filter(H=>H.sender_type==="field"&&!H.is_read).length;U(z)}catch(ne){console.error("Error loading messages:",ne)}finally{p(!1)}},N=async()=>{if(g.trim()){y(!0);try{const ne=await se.sendMessage(r.id,g.trim(),"office",o||"Office");u(Q=>[...Q,ne]),T("")}catch(ne){console.error("Error sending message:",ne),c?.("Error sending message","error")}finally{y(!1)}}},M=ne=>{ne.key==="Enter"&&!ne.shiftKey&&(ne.preventDefault(),N())},A=ne=>{const Q=new Date(ne),z=new Date;return Q.toDateString()===z.toDateString()?Q.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):Q.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})},ee=m.slice(-3);return j?e.jsxs("div",{className:"project-messages card",children:[e.jsx("div",{className:"project-messages-header",children:e.jsx("h3",{children:"Messages"})}),e.jsx("div",{className:"loading",children:"Loading messages..."})]}):e.jsxs("div",{className:`project-messages card ${F?"expanded":""}`,children:[e.jsxs("div",{className:"project-messages-header",onClick:()=>L(!F),children:[e.jsxs("div",{className:"messages-title-row",children:[e.jsx("h3",{children:"Messages"}),B>0&&e.jsxs("span",{className:"messages-unread-badge",children:[B," new"]})]}),e.jsx("button",{className:"messages-toggle-btn",children:F?" Collapse":" Expand"})]}),!F&&m.length>0&&e.jsxs("div",{className:"messages-preview",children:[ee.map(ne=>e.jsxs("div",{className:`preview-message ${ne.sender_type}`,children:[e.jsxs("span",{className:"preview-sender",children:[ne.sender_type==="office"?e.jsx(Mn,{size:12,className:"inline-icon"}):e.jsx(ua,{size:12,className:"inline-icon"})," ",ne.sender_name,":"]}),e.jsxs("span",{className:"preview-text",children:[ne.message?.slice(0,50),ne.message?.length>50?"...":""]})]},ne.id)),m.length===0&&e.jsx("p",{className:"no-messages-hint",children:"No messages yet. Click to start chatting."})]}),F&&e.jsxs("div",{className:"messages-full",children:[e.jsxs("div",{className:"messages-list-container",children:[m.length===0?e.jsxs("div",{className:"messages-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Cs,{size:32})}),e.jsx("p",{children:"No messages yet"}),e.jsx("small",{children:"Send a message to the field crew"})]}):m.map(ne=>e.jsxs("div",{className:`message-bubble ${ne.sender_type==="office"?"sent":"received"}`,children:[e.jsxs("div",{className:"message-sender",children:[ne.sender_type==="office"?e.jsx(Mn,{size:14,className:"inline-icon"}):e.jsx(ua,{size:14,className:"inline-icon"})," ",ne.sender_name]}),e.jsx("div",{className:"message-text",children:ne.message}),ne.photo_url&&e.jsx("img",{src:ne.photo_url,alt:"Attached",className:"message-photo"}),e.jsx("div",{className:"message-time",children:A(ne.created_at)})]},ne.id)),e.jsx("div",{ref:J})]}),e.jsxs("div",{className:"messages-input-row",children:[e.jsx("textarea",{value:g,onChange:ne=>T(ne.target.value),onKeyDown:M,placeholder:"Type a message...",rows:1,disabled:x}),e.jsx("button",{className:"btn btn-primary send-btn",onClick:N,disabled:x||!g.trim(),children:x?"...":"Send"})]})]})]})}function ay({project:r,company:l,onShowToast:o}){const[c,m]=f.useState(null),[u,j]=f.useState(!0),[p,x]=f.useState(!1);f.useEffect(()=>{if(r?.id&&l?.id){y();const F=se.subscribeToCrewCheckins?.(r.id,()=>{y()});return()=>{F&&se.unsubscribe?.(F)}}},[r?.id,l?.id]);const y=async()=>{try{const F=await se.calculateManDayCosts(r.id,l.id,r.work_type||"demolition",r.job_type||"standard");m(F)}catch(F){console.error("Error loading man day costs:",F)}finally{j(!1)}},g=F=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(F),T=F=>new Date(F).toLocaleDateString("en-US",{month:"short",day:"numeric"}),B=F=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[F]||F.charAt(0).toUpperCase()+F.slice(1);if(u)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!c||c.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(ua,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const U=Object.entries(c.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>x(!p),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:g(c.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:p?" Collapse":" Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:c.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:c.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:g(c.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:c.daysWorked>0?g(c.totalCost/c.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),p&&e.jsxs("div",{className:"man-day-details",children:[U.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:U.map(([F,L])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:B(F)}),e.jsxs("span",{className:"role-rate",children:[g(L.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[L.count," days"]}),e.jsx("span",{className:"role-cost",children:g(L.cost)})]})]},F))})]}),c.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:c.byDate.slice(0,7).map((F,L)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:T(F.date)}),e.jsxs("span",{className:"date-workers",children:[F.workers," crew"]}),e.jsx("span",{className:"date-cost",children:g(F.cost)})]},L))}),c.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",c.byDate.length-7," more days"]})]})]})]})}const xa=r=>((r||0)/100).toFixed(2),Ee=r=>{const l=(r||0)/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(l)},ws=r=>Math.round((parseFloat(r)||0)*100),an=r=>((r||0)/100).toFixed(2),Rt=r=>`${an(r)}%`,wn=r=>Math.round((parseFloat(r)||0)*100),sy=(r,l,o,c)=>{const m=parseFloat(r)||0,u=parseFloat(l)||0,j=parseInt(o)||0,p=parseInt(c)||0,x=Math.round(m*j),y=Math.round(u*p),g=x+y;return{regularTotal:x,overtimeTotal:y,total:g}},Mf=(r,l)=>{const o=parseFloat(r)||0,c=parseInt(l)||0;return Math.round(o*c)},Ti=(r,l)=>{const o=parseInt(r)||0,c=parseInt(l)||0;return Math.round(o*c/1e4)},nd=(r,l)=>{const o=parseInt(r)||0,c=parseInt(l)||0;return Math.round(o*c/1e4)},xl=r=>{const l=(r.change_order_labor||[]).reduce((L,J)=>L+(parseInt(J.total)||0),0),o=(r.change_order_materials||[]).reduce((L,J)=>L+(parseInt(J.total)||0),0),c=(r.change_order_equipment||[]).reduce((L,J)=>L+(parseInt(J.total)||0),0),m=(r.change_order_subcontractors||[]).reduce((L,J)=>L+(parseInt(J.total)||0),0),u=Ti(l,r.labor_markup_percent||1500),j=Ti(o,r.materials_markup_percent||1500),p=Ti(c,r.equipment_markup_percent||1500),x=Ti(m,r.subcontractors_markup_percent||500),y=l+o+c+m+u+j+p+x,g=nd(y,r.liability_insurance_percent||144),T=nd(y,r.bond_percent||100),B=nd(y,r.license_fee_percent||10),U=g+T+B,F=y+U;return{labor_subtotal:l,materials_subtotal:o,equipment_subtotal:c,subcontractors_subtotal:m,labor_markup_amount:u,materials_markup_amount:j,equipment_markup_amount:p,subcontractors_markup_amount:x,liability_insurance_amount:g,bond_amount:T,license_fee_amount:B,additional_fees_total:U,cor_subtotal:y,cor_total:F}},rd=r=>{const l=[];if(r.title?.trim()||l.push("Title is required"),r.scope_of_work?.trim()||l.push("Scope of work is required"),r.period_start||l.push("Start date is required"),r.period_end||l.push("End date is required"),r.period_start&&r.period_end){const x=new Date(r.period_start);new Date(r.period_end)<x&&l.push("End date must be after start date")}const o=(r.change_order_labor||[]).length>0,c=(r.change_order_materials||[]).length>0,m=(r.change_order_equipment||[]).length>0,u=(r.change_order_subcontractors||[]).length>0;!o&&!c&&!m&&!u&&l.push("At least one line item (labor, materials, equipment, or subcontractor) is required"),xl(r).cor_total<=0&&l.push("COR total must be greater than zero");const p=5e3;return r.labor_markup_percent>p&&l.push("Labor markup percentage seems too high (>50%)"),r.materials_markup_percent>p&&l.push("Materials markup percentage seems too high (>50%)"),r.equipment_markup_percent>p&&l.push("Equipment markup percentage seems too high (>50%)"),r.subcontractors_markup_percent>p&&l.push("Subcontractors markup percentage seems too high (>50%)"),{valid:l.length===0,errors:l}},pp=r=>{const l={draft:{label:"Draft",color:"#6b7280",bgColor:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bgColor:"#fef3c7"},approved:{label:"Approved",color:"#059669",bgColor:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bgColor:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bgColor:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bgColor:"#e5e7eb"}};return l[r]||l.draft},rs=r=>r?new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",Hi=(r,l)=>{const o=rs(r),c=rs(l);return o&&c?`${o} - ${c}`:o||c||""},kn={labor_markup:1500,materials_markup:1500,equipment_markup:1500,subcontractors_markup:500,liability_insurance:144,bond:100,license_fee:10},Af=["Foreman","Superintendent","Operator","Laborer"],ny=[{value:"standard",label:"Standard"},{value:"pla",label:"PLA (Project Labor Agreement)"},{value:"prevailing",label:"Prevailing Wage"}],ld={materials:[{value:"backup_sheet",label:"Backup Sheet"},{value:"invoice",label:"Invoice"},{value:"mobilization",label:"Mobilization"},{value:"custom",label:"Custom Entry"}],equipment:[{value:"backup_sheet",label:"Backup Sheet"},{value:"invoice",label:"Invoice"},{value:"custom",label:"Custom Entry"}],subcontractors:[{value:"invoice",label:"Invoice"},{value:"quote",label:"Quote"},{value:"custom",label:"Custom Entry"}]},Tf=["each","day","week","month","hour","sqft","lf","gallon","pound","ton","cy","lump sum"];function ry({project:r,company:l,areas:o,refreshKey:c,onShowToast:m,onCreateCOR:u,onViewCOR:j,onEditCOR:p}){const[x,y]=f.useState([]),[g,T]=f.useState(!0),[B,U]=f.useState("all"),[F,L]=f.useState("all"),[J,W]=f.useState(null),[N,M]=f.useState(new Set),[A,ee]=f.useState("recent"),[ne,Q]=f.useState(new Set),[z,H]=f.useState({start:"",end:""}),[$,S]=f.useState(null);f.useEffect(()=>{v(),_();const X=se.subscribeToCORs?.(r.id,()=>{v(),_()});return()=>{X&&se.unsubscribe?.(X)}},[r.id,c]);const v=async()=>{try{const X=await se.getCORs(r.id);y(X||[])}catch(X){console.error("Error loading CORs:",X),m?.("Error loading change order requests","error")}finally{T(!1)}},_=async()=>{try{const X=await se.getCORStats?.(r.id);S(X)}catch(X){console.error("Error loading COR stats:",X)}},w=async(X,C)=>{if(C?.stopPropagation(),!!confirm("Are you sure you want to delete this COR? This action cannot be undone."))try{await se.deleteCOR(X),y(x.filter(de=>de.id!==X)),m?.("COR deleted","success"),_()}catch(de){console.error("Error deleting COR:",de),m?.("Error deleting COR","error")}},ae=async(X,C)=>{C?.stopPropagation();try{await se.submitCORForApproval(X),await v(),m?.("COR submitted for approval","success"),_()}catch(de){console.error("Error submitting COR:",de?.message||de),m?.(de?.message||"Error submitting COR","error")}},D=f.useMemo(()=>{let X=[...x];if(B!=="all"&&(X=X.filter(C=>C.status===B)),F!=="all"&&(X=X.filter(C=>C.area_id===F)),z.start){const C=new Date(z.start);C.setHours(0,0,0,0),X=X.filter(de=>new Date(de.created_at)>=C)}if(z.end){const C=new Date(z.end);C.setHours(23,59,59,999),X=X.filter(de=>new Date(de.created_at)<=C)}if(A==="recent"){const C=new Date;C.setDate(C.getDate()-7),C.setHours(0,0,0,0),X=X.filter(de=>new Date(de.created_at)>=C)}return X.sort((C,de)=>new Date(de.created_at)-new Date(C.created_at)),X},[x,B,F,A,z]),V=f.useMemo(()=>{if(A!=="all")return null;const X={};return D.forEach(C=>{const de=new Date(C.created_at),_e=`${de.getFullYear()}-${String(de.getMonth()+1).padStart(2,"0")}`,ze=de.toLocaleDateString("en-US",{month:"long",year:"numeric"});X[_e]||(X[_e]={label:ze,cors:[],totalAmount:0}),X[_e].cors.push(C),X[_e].totalAmount+=C.cor_total||0}),Object.entries(X).sort((C,de)=>de[0].localeCompare(C[0]))},[D,A]);f.useEffect(()=>{if(V&&V.length>0){const X=V[0][0];Q(new Set([X]))}},[V]);const k=X=>{const C=new Set(ne);C.has(X)?C.delete(X):C.add(X),Q(C)},fe=f.useMemo(()=>({all:x.length,draft:x.filter(X=>X.status==="draft").length,pending_approval:x.filter(X=>X.status==="pending_approval").length,approved:x.filter(X=>X.status==="approved").length,rejected:x.filter(X=>X.status==="rejected").length,billed:x.filter(X=>X.status==="billed").length,closed:x.filter(X=>X.status==="closed").length}),[x]);B==="all"?x.length:x.filter(X=>X.status===B).length;const Y=X=>o?.find(de=>de.id===X)?.name||"No Area",I=X=>{const C=pp(X.status);X.id;const de=X.status==="draft",_e=["draft","pending_approval","rejected"].includes(X.status),ze=X.status==="draft";return e.jsxs("div",{className:`cor-card ${X.status}`,onClick:()=>j?.(X),onKeyDown:re=>{(re.key==="Enter"||re.key===" ")&&(re.preventDefault(),j?.(X))},tabIndex:0,role:"button","aria-label":`View COR ${X.cor_number}: ${X.title||"Untitled"}, ${C.label}, ${Ee(X.cor_total||0)}`,children:[e.jsxs("div",{className:"cor-card-header",children:[e.jsxs("div",{className:"cor-card-left",children:[e.jsx("span",{className:"cor-number",children:X.cor_number}),e.jsx("span",{className:"cor-status-badge",style:{backgroundColor:C.bgColor,color:C.color},children:C.label})]}),e.jsx("div",{className:"cor-card-right",children:e.jsx("span",{className:"cor-total",children:Ee(X.cor_total||0)})})]}),e.jsxs("div",{className:"cor-card-body",children:[e.jsx("h4",{className:"cor-title",children:X.title||"Untitled COR"}),e.jsxs("div",{className:"cor-meta",children:[X.area_id&&e.jsx("span",{className:"cor-area",children:Y(X.area_id)}),e.jsx("span",{className:"cor-period",children:Hi(X.period_start,X.period_end)})]})]}),e.jsxs("div",{className:"cor-card-footer",children:[e.jsx("span",{className:"cor-created",children:rs(X.created_at)}),e.jsxs("div",{className:"cor-actions",onClick:re=>re.stopPropagation(),children:[ze&&e.jsx("button",{className:"cor-action-btn submit",onClick:re=>ae(X.id,re),title:"Submit for Approval","aria-label":`Submit COR ${X.cor_number} for approval`,children:e.jsx(rp,{size:14,"aria-hidden":"true"})}),de&&e.jsx("button",{className:"cor-action-btn edit",onClick:re=>{re.stopPropagation(),p?.(X)},title:"Edit","aria-label":`Edit COR ${X.cor_number}`,children:e.jsx(yd,{size:14,"aria-hidden":"true"})}),e.jsx("button",{className:"cor-action-btn view",onClick:re=>{re.stopPropagation(),j?.(X)},title:"View Details","aria-label":`View COR ${X.cor_number} details`,children:e.jsx(Nj,{size:14,"aria-hidden":"true"})}),_e&&e.jsx("button",{className:"cor-action-btn delete",onClick:re=>w(X.id,re),title:"Delete","aria-label":`Delete COR ${X.cor_number}`,children:e.jsx(ks,{size:14,"aria-hidden":"true"})})]})]})]},X.id)};return g?e.jsx("div",{className:"loading",children:"Loading change order requests..."}):e.jsxs("div",{className:"cor-list",children:[e.jsxs("div",{className:"cor-list-header",children:[e.jsxs("div",{className:"cor-list-info",children:[e.jsx("h3",{children:"Change Orders"}),e.jsxs("div",{className:"cor-stats-inline",children:[e.jsxs("span",{className:"cor-stat-item",children:[fe.all," total"]}),fe.pending_approval>0&&e.jsxs("span",{className:"cor-stat-item pending",children:[fe.pending_approval," pending"]}),$?.totalApproved>0&&e.jsx("span",{className:"cor-stat-item approved",children:Ee($.totalApproved)})]})]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:u,children:[e.jsx(Ka,{size:14})," New COR"]})]}),e.jsxs("div",{className:"cor-controls",children:[e.jsx("div",{className:"cor-filter-pills",role:"tablist",children:[{id:"all",label:"All"},{id:"draft",label:"Draft"},{id:"pending_approval",label:"Pending"},{id:"approved",label:"Approved"}].map(X=>e.jsxs("button",{role:"tab","aria-selected":B===X.id,className:`cor-pill ${B===X.id?"active":""}`,onClick:()=>U(X.id),children:[X.label,fe[X.id]>0&&e.jsx("span",{className:"cor-pill-count",children:fe[X.id]})]},X.id))}),e.jsxs("div",{className:"cor-view-toggle",children:[e.jsx("button",{className:`cor-toggle-btn ${A==="recent"?"active":""}`,onClick:()=>{ee("recent"),H({start:"",end:""})},children:"Recent"}),e.jsx("button",{className:`cor-toggle-btn ${A==="all"?"active":""}`,onClick:()=>ee("all"),children:"All"})]})]}),A==="all"&&e.jsxs("div",{className:"cor-date-filter",children:[e.jsx(fl,{size:14}),e.jsx("input",{type:"date",value:z.start,onChange:X=>H(C=>({...C,start:X.target.value}))}),e.jsx("span",{className:"cor-date-sep",children:"to"}),e.jsx("input",{type:"date",value:z.end,onChange:X=>H(C=>({...C,end:X.target.value}))}),(z.start||z.end)&&e.jsx("button",{className:"cor-clear-btn",onClick:()=>H({start:"",end:""}),children:"Clear"})]}),D.length===0?e.jsxs("div",{className:"cor-empty",children:[e.jsx(Ua,{size:24,className:"cor-empty-icon"}),e.jsxs("p",{children:["No change orders ",B!=="all"?`(${B.replace("_"," ")})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:u,children:[e.jsx(Ka,{size:14})," Create COR"]})]}):e.jsx("div",{className:"cor-cards",children:A==="all"&&V?V.map(([X,C])=>e.jsxs("div",{className:"cor-month-group",children:[e.jsxs("button",{className:"cor-month-header",onClick:()=>k(X),children:[e.jsxs("div",{className:"cor-month-left",children:[ne.has(X)?e.jsx(_a,{size:16}):e.jsx(Es,{size:16}),e.jsx("span",{children:C.label}),e.jsx("span",{className:"cor-month-count",children:C.cors.length})]}),e.jsx("span",{className:"cor-month-total",children:Ee(C.totalAmount)})]}),ne.has(X)&&e.jsx("div",{className:"cor-month-items",children:C.cors.map(de=>I(de))})]},X)):D.map(X=>I(X))})]})}function ly({projectId:r,corId:l,onImport:o,onClose:c,onShowToast:m}){const[u,j]=f.useState([]),[p,x]=f.useState(!0),[y,g]=f.useState(new Set),[T,B]=f.useState(null),[U,F]=f.useState(""),[L,J]=f.useState("unassigned");f.useEffect(()=>{W()},[r]);const W=async()=>{try{const z=await se.getTMTickets(r);j(z||[])}catch(z){console.error("Error loading tickets:",z),m?.("Error loading tickets","error")}finally{x(!1)}},N=f.useMemo(()=>{let z=[...u];if(L==="unassigned"?z=z.filter(H=>!H.assigned_cor_id):L==="approved"&&(z=z.filter(H=>H.status==="approved")),U){const H=U.toLowerCase();z=z.filter($=>$.work_description?.toLowerCase().includes(H)||$.ce_pco_number?.toLowerCase().includes(H)||$.ticket_date?.includes(H))}return z.sort((H,$)=>new Date($.ticket_date)-new Date(H.ticket_date)),z},[u,L,U]),M=z=>{const H=new Set(y);H.has(z)?H.delete(z):H.add(z),g(H)},A=()=>{y.size===N.length?g(new Set):g(new Set(N.map(z=>z.id)))},ee=z=>new Date(z).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),ne=z=>{const H=z.workers?.length||0,$=z.items?.length||0,S=z.materials_equipment?.filter(_=>_.type==="equipment")?.length||0;let v=0;return z.workers?.forEach(_=>{v+=(parseFloat(_.regular_hours)||0)+(parseFloat(_.overtime_hours)||0)}),{workerCount:H,itemCount:$,equipmentCount:S,laborHours:v}},Q=()=>{if(y.size===0){m?.("Please select at least one ticket","error");return}const z=u.filter(v=>y.has(v.id)),H=[],$=[],S=[];z.forEach(v=>{v.workers?.forEach(_=>{H.push({id:`import-${v.id}-${_.id||Date.now()}`,labor_class:_.role||"Laborer",wage_type:"standard",regular_hours:parseFloat(_.regular_hours)||0,overtime_hours:parseFloat(_.overtime_hours)||0,regular_rate:0,overtime_rate:0,total:0,source_ticket_id:v.id,source_ticket_date:v.ticket_date})}),v.items?.forEach(_=>{$.push({id:`import-${v.id}-${_.id||Date.now()}`,description:_.description||_.name,source_type:"backup_sheet",source_reference:`Ticket ${ee(v.ticket_date)}`,quantity:parseFloat(_.quantity)||1,unit:_.unit||"each",unit_cost:ws(_.unit_cost||0),total:ws((_.quantity||1)*(_.unit_cost||0)),source_ticket_id:v.id})}),v.materials_equipment?.filter(_=>_.type==="equipment").forEach(_=>{S.push({id:`import-${v.id}-${_.id||Date.now()}`,description:_.description||_.name,source_type:"backup_sheet",source_reference:`Ticket ${ee(v.ticket_date)}`,quantity:parseFloat(_.quantity)||1,unit:_.unit||"day",unit_cost:ws(_.unit_cost||_.cost||0),total:ws((_.quantity||1)*(_.unit_cost||_.cost||0)),source_ticket_id:v.id})})}),o?.({ticketIds:Array.from(y),laborItems:H,materialsItems:$,equipmentItems:S}),c?.()};return p?e.jsx("div",{className:"modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-label":"Loading tickets",children:e.jsx("div",{className:"modal-content ticket-selector-modal",onClick:z=>z.stopPropagation(),children:e.jsx("div",{className:"loading",role:"status","aria-live":"polite",children:"Loading tickets..."})})}):e.jsx("div",{className:"modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-labelledby":"ticket-selector-title",children:e.jsxs("div",{className:"modal-content ticket-selector-modal",onClick:z=>z.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"ticket-selector-title",children:"Import from T&M Tickets"}),e.jsx("button",{className:"close-btn",onClick:c,"aria-label":"Close ticket selector",children:e.jsx(Ms,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"ticket-selector-controls",children:[e.jsxs("div",{className:"ticket-search",children:[e.jsx(rv,{size:16,"aria-hidden":"true"}),e.jsx("input",{type:"text",placeholder:"Search tickets...",value:U,onChange:z=>F(z.target.value),"aria-label":"Search tickets"})]}),e.jsxs("div",{className:"ticket-filters",role:"group","aria-label":"Filter tickets by status",children:[e.jsx("button",{className:`filter-btn ${L==="unassigned"?"active":""}`,onClick:()=>J("unassigned"),"aria-pressed":L==="unassigned",children:"Unassigned"}),e.jsx("button",{className:`filter-btn ${L==="approved"?"active":""}`,onClick:()=>J("approved"),"aria-pressed":L==="approved",children:"Approved"}),e.jsx("button",{className:`filter-btn ${L==="all"?"active":""}`,onClick:()=>J("all"),"aria-pressed":L==="all",children:"All"})]})]}),e.jsxs("div",{className:"ticket-selector-header",children:[e.jsxs("label",{className:"select-all",children:[e.jsx("input",{type:"checkbox",checked:y.size===N.length&&N.length>0,onChange:A,"aria-label":`Select all ${N.length} tickets`}),e.jsxs("span",{children:["Select All (",N.length,")"]})]}),e.jsxs("span",{className:"selected-count",children:[y.size," selected"]})]}),e.jsx("div",{className:"modal-body ticket-selector-body",children:N.length===0?e.jsxs("div",{className:"ticket-empty",children:[e.jsx(Ua,{size:32}),e.jsx("p",{children:"No tickets found"}),L==="unassigned"&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>J("all"),children:"Show all tickets"})]}):e.jsx("div",{className:"ticket-list",children:N.map(z=>{const H=ne(z),$=y.has(z.id),S=T===z.id;return e.jsxs("div",{className:`ticket-item ${$?"selected":""} ${z.assigned_cor_id?"assigned":""}`,children:[e.jsxs("div",{className:"ticket-item-main",children:[e.jsx("label",{className:"ticket-checkbox",children:e.jsx("input",{type:"checkbox",checked:$,onChange:()=>M(z.id),disabled:z.assigned_cor_id&&z.assigned_cor_id!==l})}),e.jsxs("div",{className:"ticket-item-info",onClick:()=>B(S?null:z.id),children:[e.jsxs("div",{className:"ticket-item-header",children:[e.jsx("span",{className:"ticket-date",children:ee(z.ticket_date)}),e.jsx("span",{className:`ticket-status ${z.status}`,children:z.status}),z.ce_pco_number&&e.jsxs("span",{className:"ticket-pco",children:["CE/PCO: ",z.ce_pco_number]})]}),e.jsx("div",{className:"ticket-item-desc",children:z.work_description||"No description"}),e.jsxs("div",{className:"ticket-item-summary",children:[H.workerCount>0&&e.jsxs("span",{children:[e.jsx(rn,{size:12})," ",H.workerCount," workers"]}),H.itemCount>0&&e.jsxs("span",{children:[e.jsx(ls,{size:12})," ",H.itemCount," items"]}),H.equipmentCount>0&&e.jsxs("span",{children:[e.jsx(qn,{size:12})," ",H.equipmentCount," equipment"]}),H.laborHours>0&&e.jsxs("span",{children:[H.laborHours," hrs"]})]})]}),e.jsx("button",{className:"ticket-expand-btn",onClick:()=>B(S?null:z.id),children:S?e.jsx(_a,{size:16}):e.jsx(Es,{size:16})})]}),S&&e.jsxs("div",{className:"ticket-item-details",children:[z.workers?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Workers"}),e.jsx("ul",{children:z.workers.map((v,_)=>e.jsxs("li",{children:[v.name||v.role," - ",v.regular_hours||0," reg hrs",v.overtime_hours>0&&`, ${v.overtime_hours} OT hrs`]},_))})]}),z.items?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Materials"}),e.jsx("ul",{children:z.items.map((v,_)=>e.jsxs("li",{children:[v.description||v.name," - ",v.quantity," ",v.unit]},_))})]}),z.materials_equipment?.filter(v=>v.type==="equipment").length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Equipment"}),e.jsx("ul",{children:z.materials_equipment.filter(v=>v.type==="equipment").map((v,_)=>e.jsx("li",{children:v.description||v.name},_))})]})]})]},z.id)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:c,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:Q,disabled:y.size===0,children:[e.jsx(hl,{size:16})," Import ",y.size," Ticket",y.size!==1?"s":""]})]})]})})}const Ri=[{id:1,label:"Title & Info",shortLabel:"Info"},{id:2,label:"Period",shortLabel:"Period"},{id:3,label:"Labor",shortLabel:"Labor"},{id:4,label:"Materials",shortLabel:"Materials"},{id:5,label:"Equipment",shortLabel:"Equipment"},{id:6,label:"Subcontractors",shortLabel:"Subs"},{id:7,label:"Markups & Fees",shortLabel:"Markups"},{id:8,label:"Summary",shortLabel:"Summary"},{id:9,label:"Submit",shortLabel:"Submit"}];function iy({project:r,company:l,areas:o,existingCOR:c,onClose:m,onSaved:u,onShowToast:j}){const[p,x]=f.useState(1),[y,g]=f.useState(!1),[T,B]=f.useState([]),[U,F]=f.useState(!1),[L,J]=f.useState(c?.title||""),[W,N]=f.useState(c?.scope_of_work||""),[M,A]=f.useState(c?.area_id||""),[ee,ne]=f.useState(c?.cor_number||""),[Q,z]=f.useState(c?.period_start||""),[H,$]=f.useState(c?.period_end||""),[S,v]=f.useState(c?.change_order_labor||[]),[_,w]=f.useState(c?.change_order_materials||[]),[ae,D]=f.useState(c?.change_order_equipment||[]),[V,k]=f.useState(c?.change_order_subcontractors||[]),[fe,Y]=f.useState(c?.labor_markup_percent??kn.labor_markup),[I,X]=f.useState(c?.materials_markup_percent??kn.materials_markup),[C,de]=f.useState(c?.equipment_markup_percent??kn.equipment_markup),[_e,ze]=f.useState(c?.subcontractors_markup_percent??kn.subcontractors_markup),[re,qe]=f.useState(c?.liability_insurance_percent??kn.liability_insurance),[Ve,Oe]=f.useState(c?.bond_percent??kn.bond),[nt,zt]=f.useState(c?.license_fee_percent??kn.license_fee);f.useEffect(()=>{tt(),c||St()},[]);const tt=async()=>{try{const K=await se.getLaborRates?.(l?.id,r?.work_type,r?.job_type);B(K||[])}catch(K){console.error("Error loading labor rates:",K)}},ot=K=>{const ye=K?.toLowerCase()||"";return T.find(he=>he.role?.toLowerCase()===ye)||null},St=async()=>{try{const K=await se.getNextCORNumber?.(r.id);ne(K||`COR-${Date.now()}`)}catch(K){console.error("Error generating COR number:",K),ne(`COR-${Date.now()}`)}},rt=f.useMemo(()=>({title:L,scope_of_work:W,area_id:M||null,cor_number:ee,period_start:Q,period_end:H,change_order_labor:S,change_order_materials:_,change_order_equipment:ae,change_order_subcontractors:V,labor_markup_percent:fe,materials_markup_percent:I,equipment_markup_percent:C,subcontractors_markup_percent:_e,liability_insurance_percent:re,bond_percent:Ve,license_fee_percent:nt}),[L,W,M,ee,Q,H,S,_,ae,V,fe,I,C,_e,re,Ve,nt]),at=f.useMemo(()=>xl(rt),[rt]),ma=K=>{switch(K){case 1:return L.trim()?W.trim()?!0:(j?.("Scope of work is required","error"),!1):(j?.("Title is required","error"),!1);case 2:return Q?H?new Date(H)<new Date(Q)?(j?.("End date must be after start date","error"),!1):!0:(j?.("End date is required","error"),!1):(j?.("Start date is required","error"),!1);default:return!0}},Ne=()=>{ma(p)&&x(Math.min(p+1,Ri.length))},Ie=()=>{x(Math.max(p-1,1))},Ge=K=>{if(K<p)x(K);else if(K>p){for(let ye=p;ye<K;ye++)if(!ma(ye))return;x(K)}},ge=()=>{const K=Af[0],ye=ot(K);v([...S,{id:`temp-${Date.now()}`,labor_class:K,wage_type:"standard",regular_hours:0,overtime_hours:0,regular_rate:ye?Math.round((parseFloat(ye.regular_rate)||0)*100):0,overtime_rate:ye?Math.round((parseFloat(ye.overtime_rate)||0)*100):0,total:0}])},Le=(K,ye,he)=>{const Ke=[...S];if(Ke[K]={...Ke[K],[ye]:he},ye==="labor_class"){const Yt=ot(he);Yt&&(Ke[K].regular_rate=Math.round((parseFloat(Yt.regular_rate)||0)*100),Ke[K].overtime_rate=Math.round((parseFloat(Yt.overtime_rate)||0)*100))}const{total:jt}=sy(Ke[K].regular_hours,Ke[K].overtime_hours,Ke[K].regular_rate,Ke[K].overtime_rate);Ke[K].total=jt,v(Ke)},Je=K=>{v(S.filter((ye,he)=>he!==K))},ve=()=>{w([..._,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"each",unit_cost:0,total:0}])},ct=(K,ye,he)=>{const Ke=[..._];Ke[K]={...Ke[K],[ye]:he},Ke[K].total=Mf(Ke[K].quantity,Ke[K].unit_cost),w(Ke)},pt=K=>{w(_.filter((ye,he)=>he!==K))},ia=()=>{D([...ae,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"day",unit_cost:0,total:0}])},Ft=(K,ye,he)=>{const Ke=[...ae];Ke[K]={...Ke[K],[ye]:he},Ke[K].total=Mf(Ke[K].quantity,Ke[K].unit_cost),D(Ke)},Zt=K=>{D(ae.filter((ye,he)=>he!==K))},Z=()=>{k([...V,{id:`temp-${Date.now()}`,company_name:"",description:"",source_type:"invoice",source_reference:"",amount:0,total:0}])},q=(K,ye,he)=>{const Ke=[...V];Ke[K]={...Ke[K],[ye]:he},ye==="amount"&&(Ke[K].total=parseInt(he)||0),k(Ke)},Me=K=>{k(V.filter((ye,he)=>he!==K))},Se=K=>{K.laborItems?.length>0&&v([...S,...K.laborItems]),K.materialsItems?.length>0&&w([..._,...K.materialsItems]),K.equipmentItems?.length>0&&D([...ae,...K.equipmentItems]),j?.(`Imported data from ${K.ticketIds.length} ticket(s)`,"success")},ke=async()=>{g(!0);try{const K={company_id:l.id,project_id:r.id,...rt,...at,status:"draft"};let ye;c?.id?ye=await se.updateCOR(c.id,K):ye=await se.createCOR(K),ye?.id&&await se.saveCORLineItems(ye.id,{laborItems:S,materialItems:_,equipmentItems:ae,subcontractorItems:V}),j?.("COR saved as draft","success"),u?.(ye),m?.()}catch(K){console.error("Error saving COR:",K),j?.("Error saving COR","error")}finally{g(!1)}},De=async()=>{const K=rd(rt);if(!K.valid){j?.(K.errors[0],"error");return}g(!0);try{const ye={company_id:l.id,project_id:r.id,...rt,...at,status:"pending_approval"};let he;c?.id?(he=await se.updateCOR(c.id,{...ye,status:"draft"}),await se.saveCORLineItems(c.id,{laborItems:S,materialItems:_,equipmentItems:ae,subcontractorItems:V}),await se.submitCORForApproval(c.id)):(he=await se.createCOR({...ye,status:"draft"}),he?.id&&(await se.saveCORLineItems(he.id,{laborItems:S,materialItems:_,equipmentItems:ae,subcontractorItems:V}),await se.submitCORForApproval(he.id))),j?.("COR submitted for approval","success"),u?.(he),m?.()}catch(ye){console.error("Error submitting COR:",ye),j?.("Error submitting COR","error")}finally{g(!1)}};return e.jsxs("div",{className:"modal-overlay",onClick:m,children:[e.jsxs("div",{className:"modal-content cor-form-modal",onClick:K=>K.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:c?"Edit Change Order Request":"New Change Order Request"}),e.jsx("button",{className:"close-btn",onClick:m,children:e.jsx(Ms,{size:20})})]}),e.jsx("div",{className:"cor-progress-steps",children:Ri.map(K=>e.jsxs("div",{className:`cor-step ${p>=K.id?"active":""} ${p===K.id?"current":""}`,onClick:()=>Ge(K.id),children:[e.jsx("span",{className:"cor-step-number",children:K.id}),e.jsx("span",{className:"cor-step-label",children:K.shortLabel})]},K.id))}),e.jsxs("div",{className:"modal-body cor-form-body",children:[p===1&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Basic Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"COR Number"}),e.jsx("input",{type:"text",value:ee,onChange:K=>ne(K.target.value),placeholder:"Auto-generated",className:"input-readonly",readOnly:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title *"}),e.jsx("input",{type:"text",value:L,onChange:K=>J(K.target.value),placeholder:"e.g., Additional Demolition Work - Building A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Scope of Work *"}),e.jsx("textarea",{value:W,onChange:K=>N(K.target.value),rows:4,placeholder:"Describe the scope of work covered by this change order..."})]}),o&&o.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Area (Optional)"}),e.jsxs("select",{value:M,onChange:K=>A(K.target.value),children:[e.jsx("option",{value:"",children:"No specific area"}),o.map(K=>e.jsx("option",{value:K.id,children:K.name},K.id))]})]})]}),p===2&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Work Period"}),e.jsx("p",{className:"step-description",children:"Specify the date range for this change order work."}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Start Date *"}),e.jsx("input",{type:"date",value:Q,onChange:K=>z(K.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"End Date *"}),e.jsx("input",{type:"date",value:H,onChange:K=>$(K.target.value),min:Q})]})]})]}),p===3&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Labor"}),e.jsx("p",{className:"step-description",children:"Add labor costs for this change order."})]}),e.jsxs("div",{className:"step-header-actions",children:[e.jsxs("button",{className:"btn btn-ghost",onClick:()=>F(!0),children:[e.jsx(Ua,{size:16})," Import from Tickets"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:ge,children:[e.jsx(Ka,{size:16})," Add Labor"]})]})]}),S.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No labor items added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:ge,children:[e.jsx(Ka,{size:16})," Add First Labor Item"]})]}):e.jsx("div",{className:"line-items-list",children:S.map((K,ye)=>e.jsxs("div",{className:"line-item labor-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",ye+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>Je(ye),children:e.jsx(ks,{size:14})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Labor Class"}),e.jsx("select",{value:K.labor_class,onChange:he=>Le(ye,"labor_class",he.target.value),children:Af.map(he=>e.jsx("option",{value:he,children:he},he))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Wage Type"}),e.jsx("select",{value:K.wage_type,onChange:he=>Le(ye,"wage_type",he.target.value),children:ny.map(he=>e.jsx("option",{value:he.value,children:he.label},he.value))})]})]}),e.jsxs("div",{className:"form-row four-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reg Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:K.regular_hours,onChange:he=>Le(ye,"regular_hours",he.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reg Rate ($/hr)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:xa(K.regular_rate),onChange:he=>Le(ye,"regular_rate",ws(he.target.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"OT Hours"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:K.overtime_hours,onChange:he=>Le(ye,"overtime_hours",he.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"OT Rate ($/hr)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:xa(K.overtime_rate),onChange:he=>Le(ye,"overtime_rate",ws(he.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:Ee(K.total)})]})]},K.id||ye))}),e.jsxs("div",{className:"section-subtotal",children:["Labor Subtotal: ",e.jsx("strong",{children:Ee(at.labor_subtotal)})]})]}),p===4&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Materials"}),e.jsx("p",{className:"step-description",children:"Add material costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:ve,children:[e.jsx(Ka,{size:16})," Add Material"]})]}),_.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No materials added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:ve,children:[e.jsx(Ka,{size:16})," Add First Material"]})]}):e.jsx("div",{className:"line-items-list",children:_.map((K,ye)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",ye+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>pt(ye),children:e.jsx(ks,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{type:"text",value:K.description,onChange:he=>ct(ye,"description",he.target.value),placeholder:"Material description"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:K.source_type,onChange:he=>ct(ye,"source_type",he.target.value),children:ld.materials.map(he=>e.jsx("option",{value:he.value,children:he.label},he.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:K.source_reference,onChange:he=>ct(ye,"source_reference",he.target.value),placeholder:"Ticket #, Invoice #"})]})]}),e.jsxs("div",{className:"form-row three-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:K.quantity,onChange:he=>ct(ye,"quantity",he.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit"}),e.jsx("select",{value:K.unit,onChange:he=>ct(ye,"unit",he.target.value),children:Tf.map(he=>e.jsx("option",{value:he,children:he},he))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit Cost ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:xa(K.unit_cost),onChange:he=>ct(ye,"unit_cost",ws(he.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:Ee(K.total)})]})]},K.id||ye))}),e.jsxs("div",{className:"section-subtotal",children:["Materials Subtotal: ",e.jsx("strong",{children:Ee(at.materials_subtotal)})]})]}),p===5&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Equipment"}),e.jsx("p",{className:"step-description",children:"Add equipment rental costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:ia,children:[e.jsx(Ka,{size:16})," Add Equipment"]})]}),ae.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No equipment added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:ia,children:[e.jsx(Ka,{size:16})," Add First Equipment"]})]}):e.jsx("div",{className:"line-items-list",children:ae.map((K,ye)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",ye+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>Zt(ye),children:e.jsx(ks,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{type:"text",value:K.description,onChange:he=>Ft(ye,"description",he.target.value),placeholder:"Equipment description"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:K.source_type,onChange:he=>Ft(ye,"source_type",he.target.value),children:ld.equipment.map(he=>e.jsx("option",{value:he.value,children:he.label},he.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:K.source_reference,onChange:he=>Ft(ye,"source_reference",he.target.value),placeholder:"Ticket #, Invoice #"})]})]}),e.jsxs("div",{className:"form-row three-col",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:K.quantity,onChange:he=>Ft(ye,"quantity",he.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit"}),e.jsx("select",{value:K.unit,onChange:he=>Ft(ye,"unit",he.target.value),children:Tf.map(he=>e.jsx("option",{value:he,children:he},he))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unit Cost ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:xa(K.unit_cost),onChange:he=>Ft(ye,"unit_cost",ws(he.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:Ee(K.total)})]})]},K.id||ye))}),e.jsxs("div",{className:"section-subtotal",children:["Equipment Subtotal: ",e.jsx("strong",{children:Ee(at.equipment_subtotal)})]})]}),p===6&&e.jsxs("div",{className:"cor-form-step",children:[e.jsxs("div",{className:"step-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Subcontractors"}),e.jsx("p",{className:"step-description",children:"Add subcontractor costs for this change order."})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:Z,children:[e.jsx(Ka,{size:16})," Add Subcontractor"]})]}),V.length===0?e.jsxs("div",{className:"empty-items",children:[e.jsx("p",{children:"No subcontractors added yet."}),e.jsxs("button",{className:"btn btn-primary",onClick:Z,children:[e.jsx(Ka,{size:16})," Add First Subcontractor"]})]}):e.jsx("div",{className:"line-items-list",children:V.map((K,ye)=>e.jsxs("div",{className:"line-item",children:[e.jsxs("div",{className:"line-item-header",children:[e.jsxs("span",{className:"line-item-number",children:["#",ye+1]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>Me(ye),children:e.jsx(ks,{size:14})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Company Name"}),e.jsx("input",{type:"text",value:K.company_name,onChange:he=>q(ye,"company_name",he.target.value),placeholder:"Subcontractor company name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description of Work"}),e.jsx("input",{type:"text",value:K.description,onChange:he=>q(ye,"description",he.target.value),placeholder:"Work performed"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Source"}),e.jsx("select",{value:K.source_type,onChange:he=>q(ye,"source_type",he.target.value),children:ld.subcontractors.map(he=>e.jsx("option",{value:he.value,children:he.label},he.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:K.source_reference,onChange:he=>q(ye,"source_reference",he.target.value),placeholder:"Invoice #, Quote #"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Amount ($)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:xa(K.amount),onChange:he=>q(ye,"amount",ws(he.target.value))})]})]}),e.jsxs("div",{className:"line-item-total",children:["Total: ",e.jsx("strong",{children:Ee(K.total)})]})]},K.id||ye))}),e.jsxs("div",{className:"section-subtotal",children:["Subcontractors Subtotal: ",e.jsx("strong",{children:Ee(at.subcontractors_subtotal)})]})]}),p===7&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Markups & Fees"}),e.jsx("p",{className:"step-description",children:"Configure markup percentages and additional fees."}),e.jsxs("div",{className:"markups-section",children:[e.jsx("h4",{children:"Markups"}),e.jsxs("div",{className:"markups-grid",children:[e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Labor Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:an(fe),onChange:K=>Y(wn(K.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",Ee(at.labor_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Materials Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:an(I),onChange:K=>X(wn(K.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",Ee(at.materials_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Equipment Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:an(C),onChange:K=>de(wn(K.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",Ee(at.equipment_markup_amount)]})]}),e.jsxs("div",{className:"markup-item",children:[e.jsx("label",{children:"Subcontractors Markup"}),e.jsxs("div",{className:"markup-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:an(_e),onChange:K=>ze(wn(K.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-amount",children:["+",Ee(at.subcontractors_markup_amount)]})]})]})]}),e.jsxs("div",{className:"fees-section",children:[e.jsx("h4",{children:"Additional Fees"}),e.jsxs("div",{className:"fees-grid",children:[e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"Liability Insurance"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:an(re),onChange:K=>qe(wn(K.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",Ee(at.liability_insurance_amount)]})]}),e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"Bond"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:an(Ve),onChange:K=>Oe(wn(K.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",Ee(at.bond_amount)]})]}),e.jsxs("div",{className:"fee-item",children:[e.jsx("label",{children:"City License Fee"}),e.jsxs("div",{className:"fee-input",children:[e.jsx("input",{type:"number",step:"0.001",min:"0",max:"100",value:an(nt),onChange:K=>zt(wn(K.target.value))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"fee-amount",children:["+",Ee(at.license_fee_amount)]})]})]})]})]}),p===8&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Summary"}),e.jsxs("div",{className:"cor-summary",children:[e.jsxs("div",{className:"summary-header",children:[e.jsx("div",{className:"summary-title",children:L||"Untitled COR"}),e.jsx("div",{className:"summary-number",children:ee})]}),e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"Costs Breakdown"}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Labor (",S.length," items)"]}),e.jsx("span",{children:Ee(at.labor_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",Rt(fe),")"]}),e.jsx("span",{children:Ee(at.labor_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Materials (",_.length," items)"]}),e.jsx("span",{children:Ee(at.materials_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",Rt(I),")"]}),e.jsx("span",{children:Ee(at.materials_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Equipment (",ae.length," items)"]}),e.jsx("span",{children:Ee(at.equipment_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",Rt(C),")"]}),e.jsx("span",{children:Ee(at.equipment_markup_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Subcontractors (",V.length," items)"]}),e.jsx("span",{children:Ee(at.subcontractors_subtotal)})]}),e.jsxs("div",{className:"summary-line indent",children:[e.jsxs("span",{children:["+ Markup (",Rt(_e),")"]}),e.jsx("span",{children:Ee(at.subcontractors_markup_amount)})]})]}),e.jsxs("div",{className:"summary-subtotal",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Ee(at.cor_subtotal)})]}),e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"Additional Fees"}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Liability Insurance (",Rt(re),")"]}),e.jsx("span",{children:Ee(at.liability_insurance_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["Bond (",Rt(Ve),")"]}),e.jsx("span",{children:Ee(at.bond_amount)})]}),e.jsxs("div",{className:"summary-line",children:[e.jsxs("span",{children:["City License Fee (",Rt(nt),")"]}),e.jsx("span",{children:Ee(at.license_fee_amount)})]})]}),e.jsxs("div",{className:"summary-total",children:[e.jsx("span",{children:"COR Total"}),e.jsx("span",{children:Ee(at.cor_total)})]})]})]}),p===9&&e.jsxs("div",{className:"cor-form-step",children:[e.jsx("h3",{children:"Submit Change Order Request"}),e.jsxs("div",{className:"submit-preview",children:[e.jsxs("div",{className:"preview-card",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx("span",{className:"preview-number",children:ee}),e.jsx("span",{className:"preview-total",children:Ee(at.cor_total)})]}),e.jsx("div",{className:"preview-title",children:L}),e.jsx("div",{className:"preview-scope",children:W})]}),(()=>{const K=rd(rt);return K.valid?e.jsx("div",{className:"validation-success",children:"Ready to submit for approval!"}):e.jsxs("div",{className:"validation-errors",children:[e.jsx(An,{size:20}),e.jsxs("div",{children:[e.jsx("strong",{children:"Please fix the following issues:"}),e.jsx("ul",{children:K.errors.map((ye,he)=>e.jsx("li",{children:ye},he))})]})]})})(),e.jsxs("div",{className:"submit-actions",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:ke,disabled:y,children:[e.jsx(_f,{size:16})," Save as Draft"]}),e.jsxs("button",{className:"btn btn-primary",onClick:De,disabled:y||!rd(rt).valid,children:[e.jsx(rp,{size:16})," Submit for Approval"]})]})]})]})]}),e.jsxs("div",{className:"modal-footer cor-form-footer",children:[e.jsx("div",{className:"footer-left",children:p>1&&e.jsxs("button",{className:"btn btn-secondary",onClick:Ie,disabled:y,children:[e.jsx(oj,{size:16})," Back"]})}),e.jsx("div",{className:"footer-center",children:e.jsxs("span",{className:"step-indicator",children:["Step ",p," of ",Ri.length]})}),e.jsxs("div",{className:"footer-right",children:[p<Ri.length&&e.jsxs("button",{className:"btn btn-primary",onClick:Ne,disabled:y,children:["Next ",e.jsx(Es,{size:16})]}),p>1&&p<9&&e.jsxs("button",{className:"btn btn-ghost",onClick:ke,disabled:y,children:[e.jsx(_f,{size:14})," Save Draft"]})]})]})]}),U&&e.jsx(ly,{projectId:r.id,corId:c?.id,onImport:Se,onClose:()=>F(!1),onShowToast:j})]})}const cy=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},Rf=r=>new Promise(l=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const c=document.createElement("canvas");c.width=o.width,c.height=o.height,c.getContext("2d").drawImage(o,0,0),l(c.toDataURL("image/png"))},o.onerror=()=>l(null),o.src=r});async function gp(r,l,o,c={},m=null){const u=new Ui,j=u.internal.pageSize.getWidth(),p=u.internal.pageSize.getHeight(),x=20;let y=x;const g=xl(r),T=c.primaryColor?cy(c.primaryColor):[30,58,138],B=[241,245,249];let U=null;if(c.logoUrl)try{U=await Rf(c.logoUrl)}catch(Q){console.error("Error loading logo:",Q)}if(U)try{u.addImage(U,"PNG",x,y,40,15),y+=20}catch{u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...T),u.text(o?.name||"Company Name",x,y+10),y+=20}else u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...T),u.text(o?.name||"Company Name",x,y+10),y+=20;u.setFontSize(20),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("CHANGE ORDER REQUEST",x,y),y+=10,u.setFontSize(12),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(r.cor_number||"COR-XXXX",x,y);const F=r.status?.replace("_"," ").toUpperCase()||"DRAFT";u.setTextColor(...T),u.text(F,j-x-u.getTextWidth(F),y),y+=12,u.setDrawColor(...T),u.setLineWidth(.5),u.line(x,y,j-x,y),y+=10,u.setFontSize(10),u.setTextColor(0,0,0);const L=x,J=j/2;u.setFont("helvetica","bold"),u.text("Project:",L,y),u.setFont("helvetica","normal"),u.text(l?.name||"Project Name",L+25,y),u.setFont("helvetica","bold"),u.text("Job #:",J,y),u.setFont("helvetica","normal"),u.text(l?.job_number||"N/A",J+25,y),y+=6,u.setFont("helvetica","bold"),u.text("Period:",L,y),u.setFont("helvetica","normal"),u.text(Hi(r.period_start,r.period_end),L+25,y),u.setFont("helvetica","bold"),u.text("Date:",J,y),u.setFont("helvetica","normal"),u.text(rs(r.created_at),J+25,y),y+=10,u.setFont("helvetica","bold"),u.setFontSize(12),u.text(r.title||"Untitled Change Order",x,y),y+=8,u.setFont("helvetica","normal"),u.setFontSize(10),u.setTextColor(80,80,80);const W=u.splitTextToSize(r.scope_of_work||"No scope of work provided.",j-x*2);u.text(W,x,y),y+=W.length*5+10,r.change_order_labor?.length>0&&(u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("LABOR",x,y),y+=6,sn(u,{startY:y,head:[["Class","Type","Reg Hrs","Reg Rate","OT Hrs","OT Rate","Total"]],body:r.change_order_labor.map(Q=>[Q.labor_class,Q.wage_type,Q.regular_hours.toString(),`$${xa(Q.regular_rate)}/hr`,Q.overtime_hours?.toString()||"-",Q.overtime_hours?`$${xa(Q.overtime_rate)}/hr`:"-",Ee(Q.total)]),foot:[[{content:`Subtotal: ${Ee(g.labor_subtotal)}`,colSpan:5,styles:{halign:"right",fontStyle:"bold"}},{content:`+${Rt(r.labor_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ee(g.labor_subtotal+g.labor_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:x,right:x},headStyles:{fillColor:T,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:B,textColor:[0,0,0],fontSize:8},theme:"striped"}),y=u.lastAutoTable.finalY+10),r.change_order_materials?.length>0&&(y>p-80&&(u.addPage(),y=x),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("MATERIALS",x,y),y+=6,sn(u,{startY:y,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:r.change_order_materials.map(Q=>[Q.description,Q.source_reference||Q.source_type,Q.quantity.toString(),Q.unit,`$${xa(Q.unit_cost)}`,Ee(Q.total)]),foot:[[{content:`Subtotal: ${Ee(g.materials_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${Rt(r.materials_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ee(g.materials_subtotal+g.materials_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:x,right:x},headStyles:{fillColor:T,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:B,textColor:[0,0,0],fontSize:8},theme:"striped"}),y=u.lastAutoTable.finalY+10),r.change_order_equipment?.length>0&&(y>p-80&&(u.addPage(),y=x),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("EQUIPMENT",x,y),y+=6,sn(u,{startY:y,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:r.change_order_equipment.map(Q=>[Q.description,Q.source_reference||Q.source_type,Q.quantity.toString(),Q.unit,`$${xa(Q.unit_cost)}`,Ee(Q.total)]),foot:[[{content:`Subtotal: ${Ee(g.equipment_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${Rt(r.equipment_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ee(g.equipment_subtotal+g.equipment_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:x,right:x},headStyles:{fillColor:T,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:B,textColor:[0,0,0],fontSize:8},theme:"striped"}),y=u.lastAutoTable.finalY+10),r.change_order_subcontractors?.length>0&&(y>p-80&&(u.addPage(),y=x),u.setFont("helvetica","bold"),u.setFontSize(11),u.setTextColor(0,0,0),u.text("SUBCONTRACTORS",x,y),y+=6,sn(u,{startY:y,head:[["Company","Description","Source","Amount"]],body:r.change_order_subcontractors.map(Q=>[Q.company_name,Q.description,Q.source_reference||Q.source_type,Ee(Q.total)]),foot:[[{content:`Subtotal: ${Ee(g.subcontractors_subtotal)}`,colSpan:2,styles:{halign:"right",fontStyle:"bold"}},{content:`+${Rt(r.subcontractors_markup_percent||500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ee(g.subcontractors_subtotal+g.subcontractors_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:x,right:x},headStyles:{fillColor:T,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:B,textColor:[0,0,0],fontSize:8},theme:"striped"}),y=u.lastAutoTable.finalY+10),y>p-100&&(u.addPage(),y=x),u.setFillColor(...B),u.roundedRect(x,y,j-x*2,70,3,3,"F"),y+=10,u.setFontSize(10),u.setFont("helvetica","normal"),u.setTextColor(0,0,0);const N=x+10,M=j-x-60;u.text("COR Subtotal:",N,y),u.setFont("helvetica","bold"),u.text(Ee(g.cor_subtotal),M,y,{align:"right"}),y+=8,u.setFont("helvetica","normal"),u.setFontSize(9),u.text(`Liability Insurance (${Rt(r.liability_insurance_percent||144)}):`,N,y),u.text(Ee(g.liability_insurance_amount),M,y,{align:"right"}),y+=6,u.text(`Bond (${Rt(r.bond_percent||100)}):`,N,y),u.text(Ee(g.bond_amount),M,y,{align:"right"}),y+=6,u.text(`City License Fee (${Rt(r.license_fee_percent||10)}):`,N,y),u.text(Ee(g.license_fee_amount),M,y,{align:"right"}),y+=10,u.setFillColor(...T),u.roundedRect(N-5,y-3,j-x*2-10,16,2,2,"F"),u.setTextColor(255,255,255),u.setFontSize(12),u.setFont("helvetica","bold"),u.text("COR TOTAL:",N,y+8),u.text(Ee(g.cor_total),M,y+8,{align:"right"}),y+=25,y>p-120&&(u.addPage(),y=x),y+=10,u.setTextColor(0,0,0),u.setFontSize(10),u.setFont("helvetica","bold"),u.text("AUTHORIZATION",x,y),y+=15,u.setFont("helvetica","normal"),u.setFontSize(9),u.setDrawColor(0,0,0);const A=(Q,z,H,$,S,v,_)=>{u.setFont("helvetica","bold"),u.setFontSize(8),u.text(z,x,Q),u.setFont("helvetica","normal"),u.setFontSize(9);const w=Q+20;if(u.line(x,w,x+70,w),u.text("Signature",x,w+8),u.line(x+85,w,x+145,w),u.text("Title / Company",x+85,w+8),u.line(j-x-40,w,j-x,w),u.text("Date",j-x-40,w+8),H)try{if(u.addImage(H,"PNG",x,w-18,60,18),$&&(u.setFontSize(8),u.text($,x,w+15)),S||v){const ae=[S,v].filter(Boolean).join(" - ");u.text(ae,x+85,w-5)}_&&u.text(rs(_),j-x-40,w-5)}catch(ae){console.error("Error adding signature:",ae)}return w+25};if(y=A(y,"GC AUTHORIZATION",r.gc_signature_data||r.gc_signature,r.gc_signature_name||r.gc_signer_name,r.gc_signature_title,r.gc_signature_company,r.gc_signature_date||r.signed_at),y+=10,y=A(y,"CLIENT AUTHORIZATION",r.client_signature_data,r.client_signature_name,r.client_signature_title,r.client_signature_company,r.client_signature_date),m&&m.length>0){u.addPage(),y=x,u.setFontSize(16),u.setFont("helvetica","bold"),u.setTextColor(...T),u.text("T&M BACKUP DOCUMENTATION",x,y),y+=8,u.setFontSize(10),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(`${m.length} T&M ticket${m.length>1?"s":""} associated with this COR`,x,y),y+=12,u.setDrawColor(...T),u.setLineWidth(.5),u.line(x,y,j-x,y),y+=10;for(const Q of m){y>p-100&&(u.addPage(),y=x),u.setFillColor(245,247,250),u.roundedRect(x,y,j-x*2,18,2,2,"F"),u.setFontSize(11),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text(`T&M Ticket  ${rs(Q.work_date)}`,x+5,y+7),Q.ce_pco_number&&(u.setFontSize(9),u.setFont("helvetica","normal"),u.setTextColor(100,100,100),u.text(`CE/PCO: ${Q.ce_pco_number}`,x+5,y+14));const H={pending:[217,119,6],approved:[5,150,105],billed:[37,99,235]}[Q.status]||[100,100,100];if(u.setFontSize(8),u.setTextColor(...H),u.text(Q.status?.toUpperCase()||"PENDING",j-x-30,y+10),y+=24,Q.notes){u.setFontSize(9),u.setFont("helvetica","italic"),u.setTextColor(80,80,80);const $=u.splitTextToSize(Q.notes,j-x*2-10);u.text($,x+5,y),y+=$.length*4+6}if(Q.t_and_m_workers?.length>0&&(u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("Labor:",x+5,y),y+=4,sn(u,{startY:y,head:[["Worker","Class","Hours","Rate","OT Hrs","OT Rate"]],body:Q.t_and_m_workers.map($=>[$.name,$.labor_class||"-",$.hours?.toString()||"0",$.rate?`$${$.rate}/hr`:"-",$.overtime_hours?.toString()||"-",$.overtime_rate?`$${$.overtime_rate}/hr`:"-"]),margin:{left:x+5,right:x},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),y=u.lastAutoTable.finalY+8),Q.t_and_m_items?.length>0&&(y>p-60&&(u.addPage(),y=x),u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text("Materials/Equipment:",x+5,y),y+=4,sn(u,{startY:y,head:[["Item","Qty","Unit","Unit Cost","Total"]],body:Q.t_and_m_items.map($=>[$.materials_equipment?.name||$.description||"Item",$.quantity?.toString()||"1",$.materials_equipment?.unit||"ea",$.materials_equipment?.cost_per_unit?`$${$.materials_equipment.cost_per_unit}`:"-",$.materials_equipment?.cost_per_unit&&$.quantity?`$${($.quantity*$.materials_equipment.cost_per_unit).toFixed(2)}`:"-"]),margin:{left:x+5,right:x},headStyles:{fillColor:[100,116,139],textColor:[255,255,255],fontSize:7,cellPadding:2},bodyStyles:{fontSize:7,cellPadding:2},theme:"grid",tableWidth:"auto"}),y=u.lastAutoTable.finalY+8),Q.photos?.length>0){y>p-80&&(u.addPage(),y=x),u.setFontSize(9),u.setFont("helvetica","bold"),u.setTextColor(0,0,0),u.text(`Photos (${Q.photos.length}):`,x+5,y),y+=6;let $=x+5;const S=45,v=35,_=3;for(let w=0;w<Q.photos.length;w++){w>0&&w%_===0&&($=x+5,y+=v+5),y+v>p-20&&(u.addPage(),y=x,$=x+5);try{const ae=await Rf(Q.photos[w]);ae?u.addImage(ae,"JPEG",$,y,S,v):(u.setFillColor(240,240,240),u.rect($,y,S,v,"F"),u.setFontSize(7),u.setTextColor(150,150,150),u.text("Photo unavailable",$+5,y+v/2))}catch{u.setFillColor(240,240,240),u.rect($,y,S,v,"F"),u.setFontSize(7),u.setTextColor(150,150,150),u.text("Photo unavailable",$+5,y+v/2)}$+=S+5}y+=v+10}y+=5,u.setDrawColor(200,200,200),u.setLineWidth(.2),u.line(x,y,j-x,y),y+=10}}const ee=u.internal.getNumberOfPages();for(let Q=1;Q<=ee;Q++){u.setPage(Q);const z=p-10;u.setFontSize(8),u.setTextColor(150,150,150),u.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,x,z),u.text(`Page ${Q} of ${ee}`,j-x,z,{align:"right"})}const ne=`${r.cor_number||"COR"}_${l?.job_number||"export"}${m?.length?"_with_backup":""}.pdf`;u.save(ne)}function oy({onSave:r,onClose:l,signerName:o=""}){const c=f.useRef(null),[m,u]=f.useState(o),[j,p]=f.useState(!1),[x,y]=f.useState(!1),g=()=>{const N=c.current;return N?N.getContext("2d"):null},T=N=>{const M=c.current;if(!M)return{x:0,y:0};const A=M.getBoundingClientRect(),ee=M.width/A.width,ne=M.height/A.height,Q=N.touches?N.touches[0].clientX:N.clientX,z=N.touches?N.touches[0].clientY:N.clientY;return{x:(Q-A.left)*ee,y:(z-A.top)*ne}},B=N=>{N.preventDefault();const M=g();if(!M)return;const{x:A,y:ee}=T(N);M.beginPath(),M.moveTo(A,ee),y(!0),p(!0)},U=N=>{if(!x)return;N.preventDefault();const M=g();if(!M)return;const{x:A,y:ee}=T(N);M.lineTo(A,ee),M.stroke()},F=()=>{y(!1)},L=()=>{const N=c.current,M=g();!N||!M||(M.clearRect(0,0,N.width,N.height),p(!1))},J=N=>{if(!N)return;c.current=N;const M=N.getContext("2d");M.strokeStyle="#1e293b",M.lineWidth=2,M.lineCap="round",M.lineJoin="round"},W=()=>{if(!j||!m.trim())return;const N=c.current;if(!N)return;const M=N.toDataURL("image/png");r({signature:M,signerName:m.trim(),signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"signature-title",children:"GC Signature"}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close signature modal",children:e.jsx(Ms,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Signer Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:m,onChange:N=>u(N.target.value),placeholder:"Enter full name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(ap,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Sign below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:J,width:500,height:200,className:"signature-canvas",onMouseDown:B,onMouseMove:U,onMouseUp:F,onMouseLeave:F,onTouchStart:B,onTouchMove:U,onTouchEnd:F,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!j&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:L,disabled:!j,"aria-label":"Clear signature",children:[e.jsx(np,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("p",{className:"signature-legal",role:"note",children:"By signing above, I acknowledge that I have reviewed and approve this Change Order Request."})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:W,disabled:!j||!m.trim(),"aria-label":"Save signature",children:[e.jsx(hl,{size:16,"aria-hidden":"true"})," Save Signature"]})]})]})})}function dy({cor:r,project:l,company:o,areas:c,onClose:m,onEdit:u,onShowToast:j,onStatusChange:p}){const[x,y]=f.useState(!0),[g,T]=f.useState(r),[B,U]=f.useState(!1),[F,L]=f.useState(!1),J=f.useCallback(async()=>{try{const v=await se.getCORById(r.id);v&&T(v)}catch(v){console.error("Error fetching COR details:",v),j?.("Error loading COR details","error")}finally{y(!1)}},[r.id,j]);f.useEffect(()=>{J()},[J]),f.useEffect(()=>{const v=se.subscribeToCorTickets?.(r.id,()=>{J()});return()=>{v&&se.unsubscribe?.(v)}},[r.id,J]);const W=f.useMemo(()=>xl(g),[g]),N=pp(g.status),M=g.status==="pending_approval",A=g.status==="draft",ee=v=>c?.find(w=>w.id===v)?.name||null,ne=async()=>{if(confirm("Approve this change order request?")){y(!0);try{await se.approveCOR(g.id),T({...g,status:"approved",approved_at:new Date().toISOString()}),j?.("COR approved","success"),p?.()}catch(v){console.error("Error approving COR:",v),j?.("Error approving COR","error")}finally{y(!1)}}},Q=async()=>{const v=prompt("Enter rejection reason (optional):");if(v!==null){y(!0);try{await se.rejectCOR(g.id,v),T({...g,status:"rejected",rejection_reason:v}),j?.("COR rejected","success"),p?.()}catch(_){console.error("Error rejecting COR:",_),j?.("Error rejecting COR","error")}finally{y(!1)}}},z=async()=>{if(confirm("Mark this COR as billed?")){y(!0);try{await se.markCORAsBilled(g.id),T({...g,status:"billed"}),j?.("COR marked as billed","success"),p?.()}catch(v){console.error("Error marking COR as billed:",v),j?.("Error updating status","error")}finally{y(!1)}}},H=async v=>{y(!0);try{await se.saveCORSignature?.(g.id,{gc_signature:v.signature,gc_signer_name:v.signerName,signed_at:v.signedAt}),T({...g,gc_signature:v.signature,gc_signer_name:v.signerName,signed_at:v.signedAt}),U(!1),j?.("Signature saved","success"),p?.()}catch(_){console.error("Error saving signature:",_),j?.("Error saving signature","error")}finally{y(!1)}},$=g.status==="approved"&&!g.gc_signature,S=async()=>{try{j?.("Generating PDF...","info"),await gp(g,l,o),j?.("PDF downloaded","success")}catch(v){console.error("Error exporting PDF:",v),j?.("Error generating PDF","error")}};return x?e.jsx("div",{className:"modal-overlay",onClick:m,children:e.jsx("div",{className:"modal-content cor-detail-modal",onClick:v=>v.stopPropagation(),children:e.jsx("div",{className:"cor-detail-loading",children:"Loading COR details..."})})}):e.jsxs("div",{className:"modal-overlay",onClick:m,role:"dialog","aria-modal":"true","aria-labelledby":"cor-detail-title",children:[e.jsxs("div",{className:"modal-content cor-detail-modal",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"modal-header cor-detail-header",children:[e.jsxs("div",{className:"cor-detail-title-row",children:[e.jsxs("div",{children:[e.jsx("div",{className:"cor-detail-number",children:g.cor_number}),e.jsx("h2",{id:"cor-detail-title",children:g.title||"Untitled COR"})]}),e.jsx("button",{className:"close-btn",onClick:m,"aria-label":"Close COR details",children:e.jsx(Ms,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"cor-detail-meta",children:[e.jsx("span",{className:"cor-detail-status",style:{backgroundColor:N.bgColor,color:N.color},children:N.label}),ee(g.area_id)&&e.jsx("span",{className:"cor-detail-area",children:ee(g.area_id)}),e.jsxs("span",{className:"cor-detail-period",children:[e.jsx(Tn,{size:14})," ",Hi(g.period_start,g.period_end)]})]})]}),e.jsxs("div",{className:"modal-body cor-detail-body",children:[e.jsxs("div",{className:"cor-detail-section",children:[e.jsxs("h3",{children:[e.jsx(Ua,{size:18})," Scope of Work"]}),e.jsx("p",{className:"cor-scope-text",children:g.scope_of_work||"No scope of work provided."})]}),e.jsxs("div",{className:"cor-detail-section pricing-breakdown",children:[e.jsxs("h3",{children:[e.jsx(jr,{size:18})," Pricing Breakdown"]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(rn,{size:16}),e.jsx("span",{children:"Labor"})]}),e.jsx("span",{className:"category-subtotal",children:Ee(W.labor_subtotal)})]}),g.change_order_labor?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"Reg Rate"}),e.jsx("th",{children:"OT Hrs"}),e.jsx("th",{children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_labor.map((v,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:v.labor_class}),e.jsx("td",{children:v.wage_type}),e.jsx("td",{children:v.regular_hours}),e.jsxs("td",{children:["$",xa(v.regular_rate),"/hr"]}),e.jsx("td",{children:v.overtime_hours||"-"}),e.jsx("td",{children:v.overtime_hours?`$${xa(v.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:Ee(v.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No labor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",Rt(g.labor_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Ee(W.labor_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(ls,{size:16}),e.jsx("span",{children:"Materials"})]}),e.jsx("span",{className:"category-subtotal",children:Ee(W.materials_subtotal)})]}),g.change_order_materials?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_materials.map((v,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:v.description}),e.jsx("td",{children:v.source_reference||v.source_type}),e.jsx("td",{children:v.quantity}),e.jsx("td",{children:v.unit}),e.jsxs("td",{children:["$",xa(v.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ee(v.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No material items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",Rt(g.materials_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Ee(W.materials_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(qn,{size:16}),e.jsx("span",{children:"Equipment"})]}),e.jsx("span",{className:"category-subtotal",children:Ee(W.equipment_subtotal)})]}),g.change_order_equipment?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:g.change_order_equipment.map((v,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:v.description}),e.jsx("td",{children:v.source_reference||v.source_type}),e.jsx("td",{children:v.quantity}),e.jsx("td",{children:v.unit}),e.jsxs("td",{children:["$",xa(v.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ee(v.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No equipment items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",Rt(g.equipment_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Ee(W.equipment_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Mn,{size:16}),e.jsx("span",{children:"Subcontractors"})]}),e.jsx("span",{className:"category-subtotal",children:Ee(W.subcontractors_subtotal)})]}),g.change_order_subcontractors?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:g.change_order_subcontractors.map((v,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:v.company_name}),e.jsx("td",{children:v.description}),e.jsx("td",{children:v.source_reference||v.source_type}),e.jsx("td",{className:"text-right",children:Ee(v.total)})]},_))})]})}):e.jsx("div",{className:"category-empty",children:"No subcontractor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",Rt(g.subcontractors_markup_percent||500),")"]}),e.jsxs("span",{children:["+",Ee(W.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"cor-subtotal-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Ee(W.cor_subtotal)})]}),e.jsxs("div",{className:"pricing-category fees-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Zj,{size:16}),e.jsx("span",{children:"Additional Fees"})]}),e.jsx("span",{className:"category-subtotal",children:Ee(W.additional_fees_total)})]}),e.jsxs("div",{className:"fees-list",children:[e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Li,{size:14}),e.jsxs("span",{children:["Liability Insurance (",Rt(g.liability_insurance_percent||144),")"]})]}),e.jsx("span",{className:"fee-amount",children:Ee(W.liability_insurance_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Ua,{size:14}),e.jsxs("span",{children:["Bond (",Rt(g.bond_percent||100),")"]})]}),e.jsx("span",{className:"fee-amount",children:Ee(W.bond_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Oi,{size:14}),e.jsxs("span",{children:["City License Fee (",Rt(g.license_fee_percent||10),")"]})]}),e.jsx("span",{className:"fee-amount",children:Ee(W.license_fee_amount)})]})]})]}),e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:Ee(W.cor_total)})]})]}),(g.gc_signature_data||g.gc_signature||g.client_signature_data)&&e.jsxs("div",{className:"cor-detail-section signature-section",children:[e.jsxs("h3",{children:[e.jsx(ov,{size:18})," Signatures"]}),e.jsxs("div",{className:"dual-signatures",children:[(g.gc_signature_data||g.gc_signature)&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"GC Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:g.gc_signature_data||g.gc_signature,alt:"GC Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:g.gc_signature_name||g.gc_signer_name}),(g.gc_signature_title||g.gc_signature_company)&&e.jsxs("span",{className:"signer-org",children:[g.gc_signature_title,g.gc_signature_title&&g.gc_signature_company&&" - ",g.gc_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",rs(g.gc_signature_date||g.signed_at)]})]})]})]}),g.client_signature_data&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"Client Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:g.client_signature_data,alt:"Client Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:g.client_signature_name}),(g.client_signature_title||g.client_signature_company)&&e.jsxs("span",{className:"signer-org",children:[g.client_signature_title,g.client_signature_title&&g.client_signature_company&&" - ",g.client_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",rs(g.client_signature_date)]})]})]})]})]})]}),g.status==="rejected"&&g.rejection_reason&&e.jsxs("div",{className:"cor-detail-section rejection-section",children:[e.jsxs("h3",{children:[e.jsx(jf,{size:18})," Rejection Reason"]}),e.jsx("p",{className:"rejection-text",children:g.rejection_reason})]})]}),e.jsxs("div",{className:"modal-footer cor-detail-footer",children:[e.jsxs("div",{className:"footer-info",children:[e.jsxs("span",{children:["Created: ",rs(g.created_at)]}),g.approved_at&&e.jsxs("span",{children:["Approved: ",rs(g.approved_at)]})]}),e.jsxs("div",{className:"footer-actions",role:"group","aria-label":"COR actions",children:[A&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>u?.(g),disabled:x,"aria-label":"Edit this COR",children:[e.jsx(yd,{size:16,"aria-hidden":"true"})," Edit"]}),M&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-danger",onClick:Q,disabled:x,"aria-label":"Reject this COR",children:[e.jsx(jf,{size:16,"aria-hidden":"true"})," Reject"]}),e.jsxs("button",{className:"btn btn-success",onClick:ne,disabled:x,"aria-label":"Approve this COR",children:[e.jsx(ns,{size:16,"aria-hidden":"true"})," Approve"]})]}),$&&e.jsxs("button",{className:"btn btn-success",onClick:()=>U(!0),disabled:x,"aria-label":"Get GC signature for this COR",children:[e.jsx(Pj,{size:16,"aria-hidden":"true"})," Get GC Signature"]}),(g.status==="approved"||g.status==="pending_approval")&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>L(!0),disabled:x,"aria-label":"Get shareable signature link",children:[e.jsx(vd,{size:16,"aria-hidden":"true"})," Get Signature Link"]}),g.status==="approved"&&e.jsxs("button",{className:"btn btn-primary",onClick:z,disabled:x,"aria-label":"Mark this COR as billed",children:[e.jsx(jr,{size:16,"aria-hidden":"true"})," Mark Billed"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:S,"aria-label":"Export COR to PDF",children:[e.jsx(ep,{size:16,"aria-hidden":"true"})," Export PDF"]})]})]})]}),B&&e.jsx(oy,{onSave:H,onClose:()=>U(!1),signerName:""}),F&&e.jsx(fp,{documentType:"cor",documentId:g.id,companyId:o?.id,projectId:l?.id,documentTitle:`COR ${g.cor_number}: ${g.title||"Untitled"}`,onClose:()=>L(!1),onShowToast:j})]})}const en=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),uy=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric"});function my({dailyBurn:r,totalBurn:l,daysWorked:o,laborCost:c,haulOffCost:m,progress:u,contractValue:j,laborByDate:p=[],haulOffByDate:x=[]}){const[y,g]=f.useState(!1),T=j*(u/100)*.6,B=l<=T?"on-budget":l<=T*1.2?"warning":"over-budget",U={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[B],F=B==="on-budget"?lp:B==="warning"?Bj:pv,J=u>0?l/(u/100):0,W=[],N={};p.forEach(A=>{N[A.date]||(N[A.date]={date:A.date,labor:0,haulOff:0,total:0}),N[A.date].labor=A.cost||0,N[A.date].total+=A.cost||0}),x.forEach(A=>{N[A.date]||(N[A.date]={date:A.date,labor:0,haulOff:0,total:0}),N[A.date].haulOff=A.cost||0,N[A.date].total+=A.cost||0}),Object.values(N).sort((A,ee)=>new Date(ee.date)-new Date(A.date)).slice(0,10).forEach(A=>W.push(A));const M=Math.max(...W.map(A=>A.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(wj,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${B}`,children:[e.jsx(F,{size:14}),e.jsx("span",{children:U})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:en(r)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),o>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",o," work day",o!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:en(l)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:en(c)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Disposal"}),e.jsx("span",{className:"burn-summary-value",children:en(m)})]})]}),u>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${J>j*.7?"warning":""}`,children:en(J)})]}),W.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>g(!y),children:[y?e.jsx(Wf,{size:16}):e.jsx(_a,{size:16}),e.jsxs("span",{children:[y?"Hide":"View"," Daily Breakdown"]})]}),y&&W.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Disposal"}),e.jsx("span",{children:"Total"})]}),W.map(A=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:uy(A.date)}),e.jsx("span",{className:"burn-labor",children:A.labor>0?en(A.labor):"-"}),e.jsx("span",{className:"burn-hauloff",children:A.haulOff>0?en(A.haulOff):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${A.total/M*100}%`}}),e.jsx("span",{className:"burn-amount",children:en(A.total)})]})]},A.date))]})]})}const id=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),qi={labor:{label:"Labor",Icon:ua,color:"#3b82f6"},disposal:{label:"Disposal",Icon:qn,color:"#10b981"},equipment:{label:"Equipment",Icon:gl,color:"#f59e0b"},materials:{label:"Materials",Icon:ls,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:rn,color:"#ec4899"},other:{label:"Other",Icon:tp,color:"#6b7280"}};function hy({laborCost:r=0,haulOffCost:l=0,customCosts:o=[],onAddCost:c,onDeleteCost:m}){const[u,j]=f.useState(!1),[p,x]=f.useState(null),y=[];r>0&&y.push({category:"labor",label:"Labor",amount:r,source:"auto",description:"From crew check-ins"}),l>0&&y.push({category:"disposal",label:"Disposal",amount:l,source:"auto",description:"From haul-off logs"});const g={};o.forEach(U=>{g[U.category]||(g[U.category]={category:U.category,items:[],total:0}),g[U.category].items.push(U),g[U.category].total+=parseFloat(U.amount)||0}),Object.values(g).forEach(U=>{const F=qi[U.category]||qi.other;y.push({category:U.category,label:F.label,amount:U.total,source:"manual",items:U.items})});const T=y.reduce((U,F)=>U+F.amount,0);y.forEach(U=>{U.percentage=T>0?U.amount/T*100:0}),y.sort((U,F)=>F.amount-U.amount);const B=U=>{x(p===U?null:U)};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:id(T)})]}),y.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):e.jsx("div",{className:"cost-breakdown",children:y.map(U=>{const F=qi[U.category]||qi.other,L=F.Icon,J=U.items&&U.items.length>0,W=p===U.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${J?"expandable":""}`,onClick:()=>J&&B(U.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(U.percentage,2)}%`,backgroundColor:F.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(L,{size:14,style:{color:F.color}}),e.jsx("span",{children:U.label}),U.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),J&&(W?e.jsx(Wf,{size:14}):e.jsx(_a,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:id(U.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(U.percentage),"%"]})]})]})]}),W&&J&&e.jsx("div",{className:"cost-category-items",children:U.items.map(N=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:N.description}),e.jsx("span",{className:"cost-item-date",children:new Date(N.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:id(N.amount)}),m&&e.jsx("button",{className:"cost-item-delete",onClick:M=>{M.stopPropagation(),confirm("Delete this cost entry?")&&m(N.id)},children:e.jsx(ks,{size:14})})]})]},N.id))})]},U.category)})}),c&&e.jsxs("button",{className:"cost-add-btn",onClick:c,children:[e.jsx(Ka,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const En=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0);function fy({revenue:r,totalCosts:l,contractValue:o,progress:c}){const m=r-l,u=r>0?m/r*100:0,j=o,p=c>0?l/(c/100):l,x=j-p,y=j>0?x/j*100:0,g=u>=20,T=u>=0&&u<20,B=u<0,U=g?"healthy":T?"warning":"loss",F=g?"On Track":T?"Watch Margin":"Over Cost",L=g?ns:T?An:lp;return e.jsxs("div",{className:`profitability-card ${U}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${U}`,children:[e.jsx(L,{size:14}),e.jsx("span",{children:F})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${u<0?"negative":""}`,children:[Math.round(u),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${u<0?"negative":u<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(u),100)}%`}})})]}),c>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${y<0?"negative":""}`,children:[Math.round(y),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${y<0?"negative":y<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(y),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:En(r)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",En(l)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${m<0?"negative":"positive"}`,children:[m>=0?"":"-",En(Math.abs(m))]})]})]}),c>10&&e.jsxs("div",{className:"profitability-insight",children:[g&&e.jsxs("p",{children:["At ",Math.round(c),"% complete, you're at ",En(m)," profit.",x>0&&` Projected final profit: ${En(x)}`]}),T&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",x<0&&` Trending toward ${En(x)} loss.`]}),B&&e.jsxs("p",{children:["Currently over cost by ",En(Math.abs(m)),". Immediate review recommended."]})]})]})}const py=[{value:"labor",label:"Labor",Icon:ua,description:"Additional labor costs"},{value:"materials",label:"Materials",Icon:ls,description:"Materials and supplies"},{value:"equipment",label:"Equipment",Icon:gl,description:"Equipment rental or purchase"},{value:"subcontractor",label:"Subcontractor",Icon:rn,description:"Subcontractor work"},{value:"disposal",label:"Disposal",Icon:qn,description:"Additional disposal costs"},{value:"other",label:"Other",Icon:tp,description:"Miscellaneous costs"}];function gy({onClose:r,onSave:l,saving:o=!1}){const[c,m]=f.useState({category:"materials",description:"",amount:"",cost_date:new Date().toISOString().split("T")[0],notes:""}),[u,j]=f.useState({}),p=(g,T)=>{m(B=>({...B,[g]:T})),u[g]&&j(B=>({...B,[g]:null}))},x=()=>{const g={};c.description.trim()||(g.description="Description is required");const T=parseFloat(c.amount);return(isNaN(T)||T<=0)&&(g.amount="Enter a valid amount"),c.cost_date||(g.cost_date="Date is required"),j(g),Object.keys(g).length===0},y=g=>{g.preventDefault(),x()&&l(c)};return e.jsx("div",{className:"modal-overlay",onClick:r,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content add-cost-modal",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(jr,{size:20}),"Add Cost"]}),e.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close",children:e.jsx(Ms,{size:20})})]}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category *"}),e.jsx("div",{className:"category-grid",children:py.map(g=>{const T=g.Icon,B=c.category===g.value;return e.jsxs("button",{type:"button",className:`category-option ${B?"selected":""}`,onClick:()=>p("category",g.value),children:[e.jsx(T,{size:18}),e.jsx("span",{className:"category-label",children:g.label})]},g.value)})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-description",children:"Description *"}),e.jsx("input",{id:"cost-description",type:"text",value:c.description,onChange:g=>p("description",g.target.value),placeholder:"e.g., Excavator rental - Week 1",className:u.description?"error":""}),u.description&&e.jsx("span",{className:"form-error",children:u.description})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-amount",children:"Amount *"}),e.jsxs("div",{className:"input-with-prefix",children:[e.jsx("span",{className:"input-prefix",children:"$"}),e.jsx("input",{id:"cost-amount",type:"number",step:"0.01",min:"0",value:c.amount,onChange:g=>p("amount",g.target.value),placeholder:"0.00",className:u.amount?"error":""})]}),u.amount&&e.jsx("span",{className:"form-error",children:u.amount})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-date",children:"Date *"}),e.jsx("input",{id:"cost-date",type:"date",value:c.cost_date,onChange:g=>p("cost_date",g.target.value),className:u.cost_date?"error":""}),u.cost_date&&e.jsx("span",{className:"form-error",children:u.cost_date})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-notes",children:"Notes (optional)"}),e.jsx("textarea",{id:"cost-notes",value:c.notes,onChange:g=>p("notes",g.target.value),placeholder:"Additional details...",rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:r,disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?"Saving...":"Add Cost"})]})]})]})})}const qf=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function xy({project:r,company:l,user:o,isAdmin:c,onShowToast:m}){const[u,j]=f.useState([]),[p,x]=f.useState([]),[y,g]=f.useState(!0),[T,B]=f.useState(!1),[U,F]=f.useState(""),[L,J]=f.useState("Team Member"),[W,N]=f.useState(null);f.useEffect(()=>{r?.id&&M()},[r?.id]),f.useEffect(()=>{T&&l?.id&&A()},[T,l?.id]);const M=async()=>{try{g(!0);const z=await se.getProjectTeam(r.id);j(z)}catch(z){console.error("Error loading project team:",z)}finally{g(!1)}},A=async()=>{try{const z=await se.getCompanyMembers(l.id),H=u.map(S=>S.users?.id),$=z.filter(S=>!H.includes(S.users?.id));x($)}catch(z){console.error("Error loading company members:",z)}},ee=async()=>{if(!U){m("Select a team member","error");return}try{N("add"),await se.addProjectMember(r.id,U,L,o.id),m("Team member added","success"),B(!1),F(""),J("Team Member"),M()}catch(z){console.error("Error adding team member:",z),m("Error adding team member","error")}finally{N(null)}},ne=async(z,H)=>{try{N(z.id),await se.updateProjectMemberRole(r.id,z.users?.id,H),m("Role updated","success"),M()}catch($){console.error("Error updating role:",$),m("Error updating role","error")}finally{N(null)}},Q=async z=>{try{N(z.id),await se.removeProjectMember(r.id,z.users?.id),m("Team member removed","success"),M()}catch(H){console.error("Error removing team member:",H),m("Error removing team member","error")}finally{N(null)}};return y?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(rn,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(rn,{size:18})," Project Team"]}),c&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>B(!0),children:[e.jsx(Nv,{size:14})," Add"]})]}),u.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",c&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:u.map(z=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:z.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:z.users?.email})]}),e.jsx("div",{className:"team-member-role",children:c?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:z.project_role,onChange:H=>ne(z,H.target.value),disabled:W===z.id,className:"role-select",children:qf.map(H=>e.jsx("option",{value:H,children:H},H))}),e.jsx(_a,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:z.project_role})}),c&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>Q(z),disabled:W===z.id,title:"Remove from project",children:e.jsx(cp,{size:14})})]},z.id))}),T&&e.jsx("div",{className:"modal-overlay",onClick:()=>B(!1),children:e.jsxs("div",{className:"modal-content small",onClick:z=>z.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>B(!1),children:e.jsx(Ms,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:U,onChange:z=>F(z.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),p.map(z=>e.jsx("option",{value:z.users?.id,children:z.users?.name||z.users?.email},z.users?.id))]}),p.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:L,onChange:z=>J(z.target.value),className:"form-select",children:qf.map(z=>e.jsx("option",{value:z,children:z},z))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>B(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:ee,disabled:!U||W==="add",children:W==="add"?"Adding...":"Add to Project"})]})]})})]})}function jy({company:r,user:l,isAdmin:o,onShowToast:c,navigateToProjectId:m,onProjectNavigated:u}){const[j,p]=f.useState([]),[x,y]=f.useState([]),[g,T]=f.useState(null),[B,U]=f.useState([]),[F,L]=f.useState(!0),[J,W]=f.useState(!1),[N,M]=f.useState(null),[A,ee]=f.useState(!1),[ne,Q]=f.useState(!1),[z,H]=f.useState(!1),[$,S]=f.useState("overview"),[v,_]=f.useState([]),[w,ae]=f.useState(!1),[D,V]=f.useState(null),[k,fe]=f.useState(!1),[Y,I]=f.useState(null),[X,C]=f.useState(0),[de,_e]=f.useState(!1),[ze,re]=f.useState(!1),qe=f.useRef(null),Ve=f.useRef(!1),Oe=f.useRef(!1),nt=f.useCallback((Ce={})=>{const{refreshAreas:Ue=!1,refreshCOR:He=!1,projectId:Xe=null}=Ce;Ue&&Xe&&(Ve.current=Xe),He&&(Oe.current=!0),qe.current&&clearTimeout(qe.current),qe.current=setTimeout(async()=>{Ve.current&&(await ot(Ve.current),Ve.current=!1),Oe.current&&(C(E=>E+1),Oe.current=!1),await tt()},150)},[]);f.useEffect(()=>()=>{qe.current&&clearTimeout(qe.current)},[]),f.useEffect(()=>{if(r?.id){tt(),zt();const Ce=j.map(He=>He.id),Ue=Ce.length>0?se.subscribeToCompanyActivity?.(r.id,Ce,{onMessage:()=>nt(),onMaterialRequest:()=>nt(),onTMTicket:()=>nt(),onInjuryReport:()=>nt()}):null;return()=>{Ue&&se.unsubscribe?.(Ue)}}},[r?.id,j.length,nt]);const zt=async()=>{try{const Ce=await se.getDumpSites(r.id);_(Ce||[])}catch(Ce){console.error("Error loading dump sites:",Ce)}};f.useEffect(()=>{if(m&&j.length>0){const Ce=j.find(Ue=>Ue.id===m);Ce&&(T(Ce),u?.())}},[m,j]),f.useEffect(()=>{if(g){ot(g.id);const Ce=[],Ue=g.id,He=se.subscribeToAreas?.(Ue,()=>{nt({refreshAreas:!0,projectId:Ue})});He&&Ce.push(He);const Xe=se.subscribeToDailyReports?.(Ue,()=>{nt()});Xe&&Ce.push(Xe);const E=se.subscribeToCrewCheckins?.(Ue,()=>{nt()});E&&Ce.push(E);const ie=se.subscribeToHaulOffs?.(Ue,()=>{nt()});ie&&Ce.push(ie);const ue=se.subscribeToCORs?.(Ue,()=>{nt({refreshCOR:!0})});return ue&&Ce.push(ue),()=>{Ce.forEach(be=>se.unsubscribe?.(be))}}},[g,nt]);const tt=async()=>{try{const Ce=await se.getProjects(r?.id);p(Ce);const Ue=await Promise.all(Ce.map(async He=>{try{const[Xe,E,ie,ue,be,Ae,Te,Ye,$t,Ot]=await Promise.all([se.getAreas(He.id).catch(()=>[]),se.getTMTickets(He.id).catch(()=>[]),se.getChangeOrderTotals(He.id).catch(()=>null),se.getDailyReports(He.id,100).catch(()=>[]),se.getInjuryReports(He.id).catch(()=>[]),se.getMaterialRequests(He.id).catch(()=>[]),se.calculateManDayCosts(He.id,r?.id,He.work_type||"demolition",He.job_type||"standard").catch(()=>null),se.calculateHaulOffCosts(He.id).catch(()=>null),se.getProjectCosts(He.id).catch(()=>[]),se.getCORStats(He.id).catch(()=>null)]),Re=Sf(Xe),We=Re.progress,Vt=ie?.totalApprovedValue||0,Jt=He.contract_value+Vt,$e=Re.isValueBased?Re.earnedValue:We/100*Jt,st=E.filter(Qt=>Qt.status==="pending").length,_t=new Date;_t.setDate(_t.getDate()-7);const Dt=ue.filter(Qt=>new Date(Qt.report_date)>=_t).length,wt=$t.reduce((Qt,jl)=>{const vl=parseFloat(jl.amount);return Qt+(isNaN(vl)?0:vl)},0),va=Te?.totalCost||0,La=Ye?.totalCost||0,Lt=va+La+wt,ya=$e-Lt,Bi=$e>0?ya/$e*100:0,yr=Te?.byDate?.length||0,br=Ye?.daysWithHaulOff||0,_r=Math.max(yr,br),ln=va+La,zn=_r>0?ln/_r:0,oa=qv({...He,progress:We},Te?.totalManDays||0);return{...He,areas:Xe,progress:We,billable:$e,changeOrderValue:Vt,revisedContractValue:Jt,changeOrderPending:ie?.pendingCount||0,totalTickets:E.length,pendingTickets:st,approvedTickets:E.filter(Qt=>Qt.status==="approved").length,dailyReportsCount:ue.length,recentDailyReports:Dt,injuryReportsCount:be.length,lastDailyReport:ue[0]?.report_date||null,pendingMaterialRequests:Ae.filter(Qt=>Qt.status==="pending").length,totalMaterialRequests:Ae.length,isValueBased:Re.isValueBased,earnedValue:Re.earnedValue,totalSOVValue:Re.totalValue,laborCost:va,laborDaysWorked:yr,laborManDays:Te?.totalManDays||0,laborByDate:Te?.byDate||[],dailyBurn:zn,haulOffCost:La,haulOffLoads:Ye?.totalLoads||0,haulOffDays:br,haulOffByType:Ye?.byWasteType||{},haulOffByDate:Ye?.byDate||[],customCosts:$t,customCostTotal:wt,totalBurn:ln,totalBurnDays:_r,allCostsTotal:Lt,currentProfit:ya,profitMargin:Bi,corPendingValue:Ot?.total_pending_value||0,corPendingCount:Ot?.pending_count||0,corApprovedValue:Ot?.total_approved_value||0,corBilledValue:Ot?.total_billed_value||0,corTotalCount:Ot?.total_cors||0,scheduleStatus:oa.scheduleStatus,scheduleVariance:oa.scheduleVariance,scheduleLabel:oa.scheduleLabel,laborStatus:oa.laborStatus,laborVariance:oa.laborVariance,laborLabel:oa.laborLabel,hasScheduleData:oa.hasScheduleData,hasLaborData:oa.hasLaborData,actualManDays:Te?.totalManDays||0,hasError:!1}}catch(Xe){return console.error(`Error loading data for project ${He.id}:`,Xe),{...He,areas:[],progress:0,billable:0,changeOrderValue:0,revisedContractValue:He.contract_value,changeOrderPending:0,totalTickets:0,pendingTickets:0,approvedTickets:0,dailyReportsCount:0,recentDailyReports:0,injuryReportsCount:0,lastDailyReport:null,pendingMaterialRequests:0,totalMaterialRequests:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corTotalCount:0,hasError:!0}}}));y(Ue)}catch(Ce){console.error("Error loading projects:",Ce),c("Error loading projects","error")}finally{L(!1)}},ot=async Ce=>{try{const Ue=await se.getAreas(Ce);U(Ue)}catch(Ue){console.error("Error loading areas:",Ue)}},St=Ce=>{T(Ce)},rt=()=>{T(null),U([]),W(!1),M(null),S("overview"),tt()},at=()=>{M({name:g.name,job_number:g.job_number||"",address:g.address||"",general_contractor:g.general_contractor||"",client_contact:g.client_contact||"",client_phone:g.client_phone||"",contract_value:g.contract_value,work_type:g.work_type||"demolition",job_type:g.job_type||"standard",pin:g.pin||"",default_dump_site_id:g.default_dump_site_id||"",areas:B.map(Ce=>({id:Ce.id,name:Ce.name,weight:Ce.weight,isNew:!1}))}),W(!0)},ma=()=>{W(!1),M(null)},Ne=(Ce,Ue)=>{M(He=>({...He,[Ce]:Ue}))},Ie=(Ce,Ue,He)=>{M(Xe=>({...Xe,areas:Xe.areas.map((E,ie)=>ie===Ce?{...E,[Ue]:He}:E)}))},Ge=()=>{M(Ce=>({...Ce,areas:[...Ce.areas,{id:null,name:"",weight:"",isNew:!0}]}))},ge=Ce=>{N.areas.length>1&&M(Ue=>({...Ue,areas:Ue.areas.filter((He,Xe)=>Xe!==Ce)}))},Le=async()=>{if(!N.name.trim()){c("Please enter a project name","error");return}const Ce=parseFloat(N.contract_value);if(!Ce||Ce<=0){c("Please enter a valid contract value","error");return}if(N.pin&&N.pin.length!==4){c("PIN must be 4 digits","error");return}if(N.pin&&N.pin!==g.pin&&!await se.isPinAvailable(N.pin,g.id)){c("This PIN is already in use","error");return}const Ue=N.areas.filter(Xe=>Xe.name.trim()&&parseFloat(Xe.weight)>0);if(Ue.length===0){c("Please add at least one area","error");return}if(Ue.reduce((Xe,E)=>Xe+parseFloat(E.weight),0)!==100){c("Area weights must total 100%","error");return}ee(!0);try{await se.updateProject(g.id,{name:N.name.trim(),job_number:N.job_number?.trim()||null,address:N.address?.trim()||null,general_contractor:N.general_contractor?.trim()||null,client_contact:N.client_contact?.trim()||null,client_phone:N.client_phone?.trim()||null,contract_value:Ce,work_type:N.work_type||"demolition",job_type:N.job_type||"standard",pin:N.pin||null,default_dump_site_id:N.default_dump_site_id||null});const Xe=B.map(ue=>ue.id),E=N.areas.filter(ue=>ue.id).map(ue=>ue.id);for(const ue of Xe)E.includes(ue)||await se.deleteArea(ue);for(let ue=0;ue<Ue.length;ue++){const be=Ue[ue];be.id?await se.updateArea(be.id,{name:be.name.trim(),weight:parseFloat(be.weight),sort_order:ue}):await se.createArea({project_id:g.id,name:be.name.trim(),weight:parseFloat(be.weight),status:"not_started",sort_order:ue})}const ie=await se.getProject(g.id);T(ie),await ot(g.id),W(!1),M(null),c("Project updated!","success")}catch(Xe){console.error("Error saving project:",Xe?.message||Xe),c(Xe?.message||"Error saving changes","error")}finally{ee(!1)}},Je=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await se.deleteProject(g.id),c("Project deleted","success"),rt()}catch(Ce){console.error("Error deleting project:",Ce),c("Error deleting project","error")}},ve=f.useMemo(()=>g?x.find(Ce=>Ce.id===g.id):null,[g,x]),ct=f.useMemo(()=>{if(!g)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const Ce=Sf(B),Ue=Ce.progress,He=ve?.changeOrderValue||0,Xe=g.contract_value+He,E=Ce.isValueBased?Ce.earnedValue:Ue/100*Xe;return{progress:Ue,billable:E,changeOrderValue:He,revisedContractValue:Xe,isValueBased:Ce.isValueBased,earnedValue:Ce.earnedValue,totalSOVValue:Ce.totalValue}},[g,B,ve]),pt=f.useMemo(()=>{const Ce=x.reduce((Ae,Te)=>Ae+(Te.contract_value||0),0),Ue=x.reduce((Ae,Te)=>Ae+(Te.changeOrderValue||0),0),He=Ce+Ue,Xe=x.reduce((Ae,Te)=>Ae+(Te.billable||0),0),E=He-Xe,ie=He>0?Math.round(Xe/He*100):0,ue=x.reduce((Ae,Te)=>Ae+(Te.corPendingValue||0),0),be=x.reduce((Ae,Te)=>Ae+(Te.corPendingCount||0),0);return{totalOriginalContract:Ce,totalChangeOrders:Ue,totalPortfolioValue:He,totalEarned:Xe,totalRemaining:E,weightedCompletion:ie,totalPendingCORValue:ue,totalPendingCORCount:be}},[x]),ia=f.useMemo(()=>{let Ce=0,Ue=0,He=0,Xe=0,E=0;for(const ie of x){const ue=ie.revisedContractValue||ie.contract_value;ie.progress>=100&&Ce++,ie.progress<100&&ie.billable<=ue*(ie.progress/100)*1.1&&Ue++,ie.billable>ue*.9&&ie.progress<90&&He++,ie.billable>ue&&Xe++,(ie.changeOrderValue||0)>0&&E++}return{projectsComplete:Ce,projectsOnTrack:Ue,projectsAtRisk:He,projectsOverBudget:Xe,projectsWithChangeOrders:E}},[x]),Ft=f.useMemo(()=>{let Ce=0,Ue=0,He=0,Xe=0,E=0,ie=0;for(const ue of x)ue.hasScheduleData&&(ue.scheduleStatus==="ahead"?Ce++:ue.scheduleStatus==="behind"?He++:Ue++),ue.hasLaborData&&(ue.laborStatus==="over"?Xe++:ue.laborStatus==="under"?E++:ie++);return{scheduleAhead:Ce,scheduleOnTrack:Ue,scheduleBehind:He,laborOver:Xe,laborUnder:E,laborOnTrack:ie,hasAnyScheduleData:Ce+Ue+He>0,hasAnyLaborData:Xe+E+ie>0}},[x]);f.useEffect(()=>{const Ce=async()=>{for(const Ue of x)if(zv(Ue,30)){console.log(`Auto-archiving completed project: ${Ue.name}`);try{await se.archiveProject(Ue.id),c(`Project "${Ue.name}" has been auto-archived after 30 days of completion`,"info")}catch(He){console.error("Failed to auto-archive project:",He)}}};x.length>0&&Ce()},[]);const{totalOriginalContract:Zt,totalChangeOrders:Z,totalPortfolioValue:q,totalEarned:Me,totalRemaining:Se,weightedCompletion:ke,totalPendingCORValue:De,totalPendingCORCount:K}=pt,{projectsComplete:ye,projectsOnTrack:he,projectsAtRisk:Ke,projectsOverBudget:jt,projectsWithChangeOrders:Yt}=ia,{scheduleAhead:Ct,scheduleOnTrack:ta,scheduleBehind:aa,laborOver:Pt,laborUnder:we,laborOnTrack:bt,hasAnyScheduleData:dt,hasAnyLaborData:ja}=Ft;if(F)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(g){const{progress:Ce,billable:Ue,changeOrderValue:He,revisedContractValue:Xe,isValueBased:E,earnedValue:ie,totalSOVValue:ue}=ct;if(J&&N){const Re=N.areas.reduce((We,Vt)=>We+(parseFloat(Vt.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:ma,style:{marginBottom:"1.5rem"},children:" Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:N.name,onChange:We=>Ne("name",We.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:N.job_number,onChange:We=>Ne("job_number",We.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:N.address,onChange:We=>Ne("address",We.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:N.general_contractor,onChange:We=>Ne("general_contractor",We.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:N.client_contact,onChange:We=>Ne("client_contact",We.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:N.client_phone,onChange:We=>Ne("client_phone",We.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:N.contract_value,onChange:We=>Ne("contract_value",We.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:N.pin,onChange:We=>Ne("pin",We.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:N.work_type,onChange:We=>Ne("work_type",We.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:N.job_type,onChange:We=>Ne("job_type",We.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:N.default_dump_site_id,onChange:We=>Ne("default_dump_site_id",We.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),v.map(We=>e.jsx("option",{value:We.id,children:We.name},We.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),N.areas.map((We,Vt)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:We.name,onChange:Jt=>Ie(Vt,"name",Jt.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:We.weight,onChange:Jt=>Ie(Vt,"weight",Jt.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>ge(Vt),children:""})]},Vt)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Re===100?"valid":"invalid"}`,children:[Re,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:Ge,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:Le,disabled:A,style:{flex:1},children:A?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:Je,children:"Delete Project"})]})}const be=B.filter(Re=>Re.status==="done").length,Ae=B.filter(Re=>Re.status==="working").length,Te=B.filter(Re=>Re.status==="not_started").length,Ye=Xe>0?Math.round(Ue/Xe*100):0,$t=He>0,Ot=[{id:"overview",label:"Overview",Icon:yf},{id:"financials",label:"Financials",Icon:jr},{id:"reports",label:"Reports",Icon:Xa},{id:"activity",label:"Activity",Icon:Cs},{id:"info",label:"Info",Icon:xd}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:rt,children:[e.jsx("span",{children:""}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>Q(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>H(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:at,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:g.name}),(g.job_number||g.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[g.job_number&&`Job #${g.job_number}`,g.job_number&&g.work_type&&"  ",g.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[Ce,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:Ut(Ue)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:Ut(Xe-Ue)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:Ot.map(Re=>e.jsxs("button",{className:`pv-tab ${$===Re.id?"active":""}`,onClick:()=>S(Re.id),children:[e.jsx(Re.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:Re.label})]},Re.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[$==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab",children:[e.jsx("div",{className:"overview-hero",children:e.jsxs("div",{className:"overview-hero-grid",children:[e.jsxs("div",{className:"overview-metric primary",children:[e.jsxs("div",{className:"overview-metric-value",children:[Ce,"%"]}),e.jsx("div",{className:"overview-metric-label",children:"Complete"}),e.jsx("div",{className:"overview-metric-bar",children:e.jsx("div",{className:"overview-metric-fill",style:{width:`${Ce}%`}})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsxs("div",{className:"overview-metric-value",children:[be,"/",B.length]}),e.jsx("div",{className:"overview-metric-label",children:"Areas Done"}),e.jsx("div",{className:"overview-metric-detail",children:Ae>0&&e.jsxs("span",{className:"working",children:[Ae," active"]})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value",children:Ut(Xe)}),e.jsx("div",{className:"overview-metric-label",children:"Contract"}),$t&&e.jsxs("div",{className:"overview-metric-detail green",children:["+",Ut(He)," COs"]})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value green",children:Ut(Ue)}),e.jsx("div",{className:"overview-metric-label",children:"Earned"}),e.jsx("div",{className:"overview-metric-detail",children:E?e.jsxs("span",{children:["of ",Ut(ue)," SOV"]}):e.jsxs("span",{children:[Ye,"% billed"]})})]})]})}),(ve?.pendingTickets>0||ve?.pendingMaterialRequests>0||ve?.changeOrderPending>0)&&e.jsxs("div",{className:"overview-attention-card",children:[e.jsxs("div",{className:"attention-header",children:[e.jsx("h3",{children:"Needs Attention"}),e.jsxs("span",{className:"attention-count",children:[(ve?.pendingTickets||0)+(ve?.pendingMaterialRequests||0)+(ve?.changeOrderPending||0)," items"]})]}),e.jsxs("div",{className:"attention-items",children:[ve?.pendingTickets>0&&e.jsxs("div",{className:"attention-item",onClick:()=>S("financials"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(Xa,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[ve.pendingTickets," T&M ticket",ve.pendingTickets!==1?"s":""," awaiting approval"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]}),ve?.changeOrderPending>0&&e.jsxs("div",{className:"attention-item",onClick:()=>S("financials"),children:[e.jsx("div",{className:"attention-item-icon info",children:e.jsx(Ua,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[ve.changeOrderPending," change order",ve.changeOrderPending!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]}),ve?.pendingMaterialRequests>0&&e.jsxs("div",{className:"attention-item",onClick:()=>S("activity"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(Cs,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[ve.pendingMaterialRequests," material request",ve.pendingMaterialRequests!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Activity"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]})]})]}),e.jsxs("div",{className:"overview-section-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[be>0&&e.jsxs("span",{className:"section-badge done",children:[be," Complete"]}),Ae>0&&e.jsxs("span",{className:"section-badge working",children:[Ae," Active"]}),Te>0&&e.jsxs("span",{className:"section-badge pending",children:[Te," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list",children:B.map(Re=>e.jsxs("div",{className:`work-area-item ${Re.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[Re.status==="done"&&e.jsx("span",{className:"status-icon done",children:""}),Re.status==="working"&&e.jsx("span",{className:"status-icon working",children:""}),Re.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:""})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:Re.name}),e.jsx("span",{className:"work-area-weight",children:Re.scheduled_value?Ut(Re.scheduled_value):`${Re.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${Re.status}`,style:{width:Re.status==="done"?"100%":Re.status==="working"?"50%":"0%"}})})]},Re.id))})]}),e.jsxs("div",{className:"overview-stats-row",children:[e.jsxs("div",{className:"quick-stat-card",onClick:()=>S("reports"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(Xa,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:ve?.dailyReportsCount||0}),e.jsx("span",{className:"quick-stat-label",children:"Daily Reports"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>S("financials"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(jr,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:ve?.totalTickets||0}),e.jsx("span",{className:"quick-stat-label",children:"T&M Tickets"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>S("activity"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(Cs,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:ve?.totalMaterialRequests||0}),e.jsx("span",{className:"quick-stat-label",children:"Material Requests"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]})]})]}),$==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsx("div",{className:"financials-hero",children:e.jsxs("div",{className:"financials-hero-grid",children:[e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Contract"}),e.jsx("div",{className:"fin-metric-value",children:Ut(Xe)}),$t&&e.jsxs("div",{className:"fin-metric-detail green",children:["+",Ut(He)," COs"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Earned"}),e.jsx("div",{className:"fin-metric-value",children:Ut(Ue)}),e.jsx("div",{className:"fin-metric-bar",children:e.jsx("div",{className:"fin-metric-fill",style:{width:`${Ye}%`}})})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Costs"}),e.jsx("div",{className:"fin-metric-value",children:Ut(ve?.allCostsTotal||0)}),Ue>0&&e.jsxs("div",{className:`fin-metric-detail ${(ve?.allCostsTotal||0)/Ue>.6?"warning":""}`,children:[Math.round((ve?.allCostsTotal||0)/Ue*100),"% of revenue"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Profit"}),e.jsx("div",{className:`fin-metric-value ${(ve?.currentProfit||0)<0?"negative":"positive"}`,children:Ut(ve?.currentProfit||0)}),e.jsxs("div",{className:`fin-metric-detail ${(ve?.profitMargin||0)<20?"warning":""}`,children:[Math.round(ve?.profitMargin||0),"% margin"]})]})]})}),e.jsxs("div",{className:"financials-analysis-row",children:[e.jsx(my,{dailyBurn:ve?.dailyBurn||0,totalBurn:ve?.totalBurn||0,daysWorked:ve?.totalBurnDays||0,laborCost:ve?.laborCost||0,haulOffCost:ve?.haulOffCost||0,progress:Ce,contractValue:Xe,laborByDate:ve?.laborByDate||[],haulOffByDate:ve?.haulOffByDate||[]}),e.jsx(fy,{revenue:Ue,totalCosts:ve?.allCostsTotal||0,contractValue:Xe,progress:Ce})]}),e.jsx(hy,{laborCost:ve?.laborCost||0,haulOffCost:ve?.haulOffCost||0,customCosts:ve?.customCosts||[],onAddCost:()=>_e(!0),onDeleteCost:async Re=>{try{await se.deleteProjectCost(Re),tt(),c("Cost deleted","success")}catch{c("Error deleting cost","error")}}}),e.jsxs("div",{className:"financials-pipeline",children:[e.jsxs("div",{className:"pipeline-header",children:[e.jsx("h2",{children:"Extra Work"}),e.jsxs("div",{className:"pipeline-flow",children:[e.jsx("span",{className:"pipeline-step",children:"T&M Tickets"}),e.jsx("span",{className:"pipeline-arrow",children:""}),e.jsx("span",{className:"pipeline-step active",children:"Change Orders"})]})]}),e.jsxs("div",{className:"pipeline-content",children:[e.jsxs("div",{className:"pipeline-section",children:[e.jsxs("div",{className:"pipeline-section-header",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("span",{className:"pipeline-badge",children:[ve?.totalTickets||0," total",ve?.pendingTickets>0&&`  ${ve.pendingTickets} pending`]})]}),e.jsx(Qv,{project:g,company:r,onShowToast:c})]}),e.jsx("div",{className:"pipeline-section",children:e.jsx(ry,{project:g,company:r,areas:B,refreshKey:X,onShowToast:c,onCreateCOR:()=>{V(null),ae(!0)},onViewCOR:Re=>{I(Re),fe(!0)},onEditCOR:Re=>{V(Re),ae(!0)}})})]})]}),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(ua,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:Ut(ve?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(ay,{project:g,company:r,onShowToast:c})})]})]}),$==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(Xa,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:ve?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:ve?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((ve?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:`reports-metric ${(ve?.injuryReportsCount||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"reports-metric-value",children:ve?.injuryReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Injuries"}),e.jsx("div",{className:"reports-metric-status",children:(ve?.injuryReportsCount||0)===0?"No incidents":"Review required"})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value small",children:ve?.lastDailyReport?new Date(ve.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"None"}),e.jsx("div",{className:"reports-metric-label",children:"Last Filed"}),ve?.lastDailyReport&&e.jsxs("div",{className:"reports-metric-detail",children:[Math.floor((new Date-new Date(ve.lastDailyReport))/(1e3*60*60*24))," days ago"]})]})]})}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(Xa,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[ve?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(ey,{project:g,company:r,onShowToast:c})})]}),e.jsxs("div",{className:`reports-section-card ${(ve?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(ve?.injuryReportsCount||0)>0?"warning":"success"}`,children:(ve?.injuryReportsCount||0)>0?"":""}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(ve?.injuryReportsCount||0)>0?"warning":"success"}`,children:(ve?.injuryReportsCount||0)>0?`${ve.injuryReportsCount} incident${ve.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(Zv,{project:g,companyId:r?.id||g?.company_id,company:r,onShowToast:c})})]})]}),$==="activity"&&e.jsxs("div",{className:"pv-tab-panel activity-tab",children:[e.jsx("div",{className:"activity-hero",children:e.jsxs("div",{className:"activity-hero-grid",children:[e.jsxs("div",{className:`activity-metric ${(ve?.pendingMaterialRequests||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"activity-metric-icon",children:(ve?.pendingMaterialRequests||0)>0?"!":""}),e.jsxs("div",{className:"activity-metric-content",children:[e.jsx("div",{className:"activity-metric-value",children:ve?.pendingMaterialRequests||0}),e.jsx("div",{className:"activity-metric-label",children:"Pending"})]})]}),e.jsxs("div",{className:"activity-metric",children:[e.jsx("div",{className:"activity-metric-value",children:ve?.totalMaterialRequests||0}),e.jsx("div",{className:"activity-metric-label",children:"Total Requests"})]}),e.jsxs("div",{className:"activity-metric",children:[e.jsxs("div",{className:"activity-metric-value",children:[ve?.totalMaterialRequests>0?Math.round((ve.totalMaterialRequests-(ve.pendingMaterialRequests||0))/ve.totalMaterialRequests*100):100,"%"]}),e.jsx("div",{className:"activity-metric-label",children:"Fulfilled"}),e.jsx("div",{className:"activity-metric-bar",children:e.jsx("div",{className:"activity-metric-fill",style:{width:`${ve?.totalMaterialRequests>0?(ve.totalMaterialRequests-(ve.pendingMaterialRequests||0))/ve.totalMaterialRequests*100:100}%`}})})]}),e.jsxs("div",{className:"activity-metric status",children:[e.jsx("div",{className:"activity-metric-status-icon",children:e.jsx(Cs,{size:20})}),e.jsx("div",{className:"activity-metric-label",children:"Messages Active"})]})]})}),(ve?.pendingMaterialRequests||0)>0&&e.jsxs("div",{className:"activity-attention-banner",children:[e.jsx("span",{className:"attention-icon",children:"!"}),e.jsxs("span",{className:"attention-text",children:[ve.pendingMaterialRequests," material request",ve.pendingMaterialRequests!==1?"s":""," awaiting response"]})]}),e.jsxs("div",{className:`activity-section-card ${(ve?.pendingMaterialRequests||0)>0?"has-pending":""}`,children:[e.jsxs("div",{className:"activity-section-header",children:[e.jsxs("div",{className:"activity-section-title",children:[e.jsx(ua,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("div",{className:"activity-section-badges",children:[(ve?.pendingMaterialRequests||0)>0&&e.jsxs("span",{className:"activity-badge pending",children:[ve.pendingMaterialRequests," pending"]}),e.jsxs("span",{className:"activity-badge total",children:[ve?.totalMaterialRequests||0," total"]})]})]}),e.jsx("div",{className:"activity-section-content",children:e.jsx(Kv,{project:g,company:r,onShowToast:c})})]}),e.jsxs("div",{className:"activity-section-card messages",children:[e.jsx("div",{className:"activity-section-header",children:e.jsxs("div",{className:"activity-section-title",children:[e.jsx(Cs,{size:18}),e.jsx("h3",{children:"Project Messages"})]})}),e.jsx("div",{className:"activity-section-content",children:e.jsx(ty,{project:g,company:r,userName:r?.name||"Office",onShowToast:c})})]})]}),$==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:g.name}),g.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",g.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:at,children:e.jsx("span",{children:"Edit Project"})})]}),g.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(Uj,{size:14}),e.jsx("span",{children:g.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ua,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:g.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Ua,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:g.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(jr,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:Ut(Xe)}),e.jsx("span",{className:"info-quick-label",children:He>0?`Incl. +${Ut(He)} COs`:"Contract Value"})]})]}),g.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:g.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Oi,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[g.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:g.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),g.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:g.client_contact})]}),g.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(Kj,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${g.client_phone}`,className:"info-detail-value link",children:g.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(yf,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[be>0&&e.jsxs("span",{className:"info-badge done",children:[be," Done"]}),Ae>0&&e.jsxs("span",{className:"info-badge working",children:[Ae," Active"]}),Te>0&&e.jsxs("span",{className:"info-badge pending",children:[Te," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:B.map(Re=>e.jsxs("div",{className:`info-area-item ${Re.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[Re.status==="done"&&e.jsx("span",{className:"status-dot done",children:""}),Re.status==="working"&&e.jsx("span",{className:"status-dot working",children:""}),Re.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:""})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:Re.name}),e.jsx("span",{className:`info-area-status-label ${Re.status}`,children:Re.status==="done"?"Complete":Re.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[Re.weight,"%"]})]},Re.id))})]}),e.jsx(xy,{project:g,company:r,user:l,isAdmin:o,onShowToast:c}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(xd,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:Ut(g.contract_value)})]}),He>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",Ut(He)]})]}),g.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:v.find(Re=>Re.id===g.default_dump_site_id)?.name||"Unknown"})]})]})]})]})]}),ne&&e.jsx(Xv,{project:g,onClose:()=>Q(!1),onShareCreated:Re=>{c("Share link created successfully!","success")}}),z&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(Jv,{project:g,company:r,onShowToast:c,onClose:()=>H(!1)})}),w&&e.jsx(iy,{project:g,company:r,areas:B,existingCOR:D,onClose:()=>{ae(!1),V(null)},onSaved:()=>{ae(!1),V(null),C(Re=>Re+1)},onShowToast:c}),k&&Y&&e.jsx(dy,{cor:Y,project:g,company:r,areas:B,onClose:()=>{fe(!1),I(null)},onEdit:Re=>{fe(!1),I(null),V(Re),ae(!0)},onShowToast:c,onStatusChange:()=>{}}),de&&e.jsx(gy,{onClose:()=>_e(!1),saving:ze,onSave:async Re=>{try{re(!0),await se.addProjectCost(g.id,r.id,Re),_e(!1),tt(),c("Cost added successfully","success")}catch(We){console.error("Error adding cost:",We),c("Error adding cost","error")}finally{re(!1)}}})]})}return j.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(Xa,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("div",{className:"bo-project-count",children:[j.length," Active Project",j.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(ke,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Ut(Me)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Ut(q)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:Ut(Se)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),Z>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:Ut(Zt)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",Yt," project",Yt!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",Ut(Z)]})]})]}),K>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:Ut(De)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",K," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[ye>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:ye}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),he>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:he}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Ke>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:Ke}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),jt>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:jt}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),dt&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[Ct>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:Ct}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),ta>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:ta}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),aa>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:aa}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),ja&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),we>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[we," under"]}),bt>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[bt," on track"]}),Pt>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[Pt," over"]})]})]})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[j.length," active"]})]}),e.jsx("div",{className:"project-list",children:x.map(Ce=>e.jsx(vy,{project:Ce,onClick:()=>St(Ce)},Ce.id))})]})}function vy({project:r,onClick:l}){const o=dp(r.areas||[]),c=Rv(r.areas||[]),m=r.contract_value-r.billable,u=r.billable>r.contract_value*.9&&r.progress<90;return e.jsxs("div",{className:`project-card enhanced ${u?"at-risk":""}`,onClick:l,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:r.name}),e.jsx("div",{className:"project-card-value",children:Ut(r.contract_value)})]}),e.jsx("span",{className:`status-badge ${o}`,children:c})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[r.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:Ut(r.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${m<0?"negative":""}`,children:Ut(Math.abs(m))}),e.jsx("span",{className:"stat-label",children:m>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${r.progress}%`}})}),(r.pendingTickets>0||r.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[r.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[r.pendingTickets," Pending T&M"]}),r.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[r.approvedTickets," Approved T&M"]})]}),r.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${r.scheduleStatus}`,children:r.scheduleLabel}),r.hasLaborData&&r.laborLabel&&e.jsx("span",{className:`labor-indicator ${r.laborStatus}`,children:r.laborLabel})]})]})}const cd=r=>{if(r==null||r==="")return"";const l=parseFloat(r);return isNaN(l)?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)},zf=r=>{if(!r)return null;const l=String(r).replace(/[$,\s]/g,""),o=parseFloat(l);return isNaN(o)?null:o};function yy({company:r,user:l,onProjectCreated:o,onShowToast:c}){const[m,u]=f.useState(""),[j,p]=f.useState(""),[x,y]=f.useState(""),[g,T]=f.useState(""),[B,U]=f.useState(""),[F,L]=f.useState(""),[J,W]=f.useState("demolition"),[N,M]=f.useState("standard"),[A,ee]=f.useState([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),[ne,Q]=f.useState(!1),[z,H]=f.useState(!1),[$,S]=f.useState(!1),[v,_]=f.useState([]),[w,ae]=f.useState(!1),[D,V]=f.useState(""),[k,fe]=f.useState(""),[Y,I]=f.useState(""),X=f.useRef(null),C=A.reduce((Ne,Ie)=>Ne+(parseFloat(Ie.weight)||0),0),de=Ne=>{const Ie=Ne.replace(/\D/g,"").slice(0,4);L(Ie)},_e=()=>{const Ne=Math.floor(1e3+Math.random()*9e3).toString();L(Ne)},ze=(Ne,Ie,Ge)=>{ee(ge=>ge.map((Le,Je)=>Je===Ne?{...Le,[Ie]:Ge}:Le))},re=()=>{ee(Ne=>[...Ne,{name:"",weight:"",group:"",scheduledValue:null}])},qe=Ne=>{A.length>1&&ee(Ie=>Ie.filter((Ge,ge)=>ge!==Ne))},Ve=(Ne="value")=>{const Ie=A.filter(ve=>ve.name.trim());if(Ie.length===0){c("Add tasks first","error");return}let Ge=[...A];const ge=A.map((ve,ct)=>ve.name.trim()?ct:-1).filter(ve=>ve>=0);if(Ne==="value"){const ve=Ie.reduce((ct,pt)=>ct+(parseFloat(pt.scheduledValue)||0),0);if(ve===0)c("No scheduled values - using equal distribution","info"),Ne="equal";else{let ct=0;ge.forEach((pt,ia)=>{const Ft=parseFloat(A[pt].scheduledValue)||0;let Zt;ia===ge.length-1?Zt=100-ct:(Zt=Math.round(Ft/ve*1e4)/100,ct+=Zt),Ge[pt]={...Ge[pt],weight:Zt.toFixed(2)}}),ee(Ge),ae(!1),c("Weights calculated by value","success");return}}const Le=Math.round(100/ge.length*100)/100;let Je=0;ge.forEach((ve,ct)=>{let pt;ct===ge.length-1?pt=100-Je:(pt=Le,Je+=pt),Ge[ve]={...Ge[ve],weight:pt.toFixed(2)}}),ee(Ge),ae(!1),c("Weights distributed equally","success")},Oe=()=>{u(""),p(""),y(""),T(""),U(""),L(""),W("demolition"),M("standard"),V(""),fe(""),I(""),ee([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),S(!1),_([])},nt=()=>{X.current?.click()},zt=Ne=>new Promise((Ie,Ge)=>{const ge=new FileReader;ge.onload=Le=>{try{const Je=new Uint8Array(Le.target.result),ve=wx(Je,{type:"array"}),ct=ve.SheetNames[0],pt=ve.Sheets[ct],ia=tn.sheet_to_json(pt,{header:1}),Ft=[];let Zt="General";const Z=/^\$?\d{1,3}(,\d{3})*(\.\d{2})?$/,q=/^(\d+\.?\d*|[A-Z]\.?\d*)$/i,Me=/^(SF|LF|EA|LS|Days?|MD|Load|CY|SY|GAL|TON)$/i,Se=/^\d{1,3}(,\d{3})*$|^\d+$/,ke=/^(Item|#|No\.?|Description|Scheduled|Value|Amount|Quantity|Unit|Total|Application|Balance|Completed|Stored|Retainage)/i;for(const ye of ia){if(!ye||ye.length===0)continue;const he=ye.map(bt=>bt==null?"":String(bt).trim()).filter(bt=>bt.length>0);if(he.length===0)continue;const Ke=he.join(" ");if(ke.test(he[0])||he.length>1&&ke.test(he[1])||/^(Total|Subtotal|Grand Total|Base Bid|Contract Sum)/i.test(Ke))continue;const jt=he.some(bt=>Z.test(bt.replace(/[$,]/g,"")+(bt.includes(".")?"":".00")));if((!jt&&he.length<=3&&/^(L\d|Level|Floor|\d+(?:st|nd|rd|th)|Plaza|Street|Basement|Roof|Penthouse|Site|Exterior|Interior|Misc|MEP|ABATEMENT|DEMOLITION|UNIVERSAL|SOFT|TRASH|DEMO|Phase|Division|Section|Area|Building|Wing)/i.test(he[0])||he.length===2&&q.test(he[0])&&!jt&&!/^\d+\.\d+$/.test(he[0]))&&!jt){Zt=(he.find(dt=>!q.test(dt)&&dt.length>1)||he.join(" ")).replace(/\s*\(\d{1,3}(?:,\d{3})*\s*SF\)\s*$/i,"").replace(/\s*[-:]\s*$/,"").trim();continue}let Ct="",ta=!1,aa="",Pt=null;const we=[];for(let bt=0;bt<he.length;bt++){const dt=he[bt];if(bt===0&&q.test(dt)){aa=dt;continue}if(!/^ID-\d+$/i.test(dt)&&!/^KN\s*\d+$/i.test(dt)){if(Z.test(dt.replace(/[$,]/g,"")+(dt.includes(".")?"":".00"))||/^\$/.test(dt)){const ja=dt.replace(/[$,]/g,""),Ce=parseFloat(ja);!isNaN(Ce)&&Ce>100&&(Pt===null||Ce>Pt)&&(Pt=Ce),ta=!0;continue}if(Se.test(dt.replace(/,/g,""))){ta=!0;continue}Me.test(dt)||/^\d+\.?\d*%$/.test(dt)||dt.length>1&&!q.test(dt)&&we.push(dt)}}Ct=we.join(" ").trim(),Ct=Ct.replace(/\s+/g," ").replace(/^[-]\s*/,"").trim(),!(Ct.length<3)&&(/^(Plan|Page|Total|Base Bid|Payment|Condition|Exclusion|Subtotal)/i.test(Ct)||ta&&Ct.length>=3&&Ft.push({name:Ct,group:Zt,itemNumber:aa,scheduledValue:Pt,selected:!0}))}const De=new Set,K=Ft.filter(ye=>{const he=`${ye.group}:${ye.name}`;return De.has(he)?!1:(De.add(he),!0)});Ie(K)}catch(Je){Ge(Je)}},ge.onerror=()=>Ge(new Error("Failed to read file")),ge.readAsArrayBuffer(Ne)}),tt=async Ne=>{const Ie=Ne.target.files?.[0];if(!Ie)return;const Ge=Ie.name.split(".").pop().toLowerCase();if(!["xlsx","xls","csv"].includes(Ge)){c("Please upload an Excel file (.xlsx, .xls, or .csv)","error");return}H(!0);try{const ge=await zt(Ie);if(ge.length===0){c("No tasks found. Check Excel format.","error"),H(!1);return}_(ge),S(!0),c(`Found ${ge.length} tasks`,"success")}catch(ge){console.error("Excel import error:",ge),c("Error reading Excel file","error")}finally{H(!1),X.current&&(X.current.value="")}},ot=Ne=>{_(Ie=>Ie.map((Ge,ge)=>ge===Ne?{...Ge,selected:!Ge.selected}:Ge))},St=()=>{const Ne=v.filter(Le=>Le.selected);if(Ne.length===0){c("Please select at least one task","error");return}const Ie=Ne.reduce((Le,Je)=>Le+(Je.scheduledValue||0),0),Ge=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});let ge;if(Ie>0){let Le=0;ge=Ne.map((Je,ve)=>{const ct=Je.scheduledValue||0;let pt;return ve===Ne.length-1?pt=100-Le:(pt=Math.round(ct/Ie*1e4)/100,Le+=pt),{name:Je.name,weight:pt.toFixed(2),group:Je.group,scheduledValue:Je.scheduledValue||null}}),c(`Tasks imported with value-based weights! Total SOV: ${Ge.format(Ie)}`,"success")}else{const Le=Math.round(100/Ne.length*100)/100;ge=Ne.map((Je,ve)=>({name:Je.name,weight:ve===Ne.length-1?(100-Le*(Ne.length-1)).toFixed(2):Le.toFixed(2),group:Je.group,scheduledValue:Je.scheduledValue||null})),c("Tasks imported with equal weights","success")}ee(ge),S(!1)},rt=async()=>{if(!r?.id){c("No company selected. Please log in again.","error");return}if(!m.trim()){c("Please enter a project name","error");return}const Ne=parseFloat(B);if(!Ne||Ne<=0){c("Please enter a valid contract value","error");return}if(F.length!==4){c("Please enter a 4-digit PIN","error");return}if(!await se.isPinAvailable(F)){c("This PIN is already in use. Try another.","error");return}const Ge=A.filter(ge=>ge.name.trim()&&parseFloat(ge.weight)>0);if(Ge.length===0){c("Please add at least one area","error");return}if(Math.abs(C-100)>.1){c("Area weights must total 100%","error");return}if(!D||!k){c("Start date and end date are required","error");return}if(new Date(k)<new Date(D)){c("End date must be on or after start date","error");return}Q(!0);try{const ge=await se.createProject({name:m.trim(),job_number:j.trim()||null,address:x.trim()||null,general_contractor:g.trim()||null,contract_value:Ne,pin:F,work_type:J,job_type:N,company_id:r?.id,created_by:l?.id,start_date:D,end_date:k,planned_man_days:Y?parseInt(Y):null});for(let Le=0;Le<Ge.length;Le++)await se.createArea({project_id:ge.id,name:Ge[Le].name.trim(),weight:parseFloat(Ge[Le].weight),scheduled_value:Ge[Le].scheduledValue||null,group_name:Ge[Le].group||null,status:"not_started",sort_order:Le});c("Project created!","success"),Oe(),o()}catch(ge){console.error("Error creating project:",ge),c("Error creating project","error")}finally{Q(!1)}};if($){const Ne=[...new Set(v.map(Le=>Le.group))],Ie=v.filter(Le=>Le.selected).length,Ge=v.reduce((Le,Je)=>Le+(Je.scheduledValue||0),0),ge=v.filter(Le=>Le.selected).reduce((Le,Je)=>Le+(Je.scheduledValue||0),0);return e.jsxs("div",{children:[e.jsx("h1",{children:"Review Imported Tasks"}),e.jsx("p",{className:"subtitle",children:"Select the tasks to include in your project"}),e.jsxs("div",{className:"import-summary",children:[e.jsxs("span",{children:[Ie," of ",v.length," tasks selected"]}),Ge>0&&e.jsxs("span",{className:"import-sov-total",children:[" Total SOV: ",new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(ge)]})]}),Ne.map(Le=>{const Je=v.filter(ct=>ct.group===Le),ve=Je.filter(ct=>ct.selected).length;return e.jsxs("div",{className:"card import-group",children:[e.jsxs("div",{className:"import-group-header",children:[e.jsx("h3",{children:Le}),e.jsxs("span",{className:"import-group-count",children:[ve,"/",Je.length]})]}),e.jsx("div",{className:"import-task-list",children:Je.map(ct=>{const pt=v.indexOf(ct);return e.jsxs("label",{className:"import-task-item",children:[e.jsx("input",{type:"checkbox",checked:ct.selected,onChange:()=>ot(pt)}),e.jsx("span",{className:"import-task-name",children:ct.name}),ct.scheduledValue>0&&e.jsx("span",{className:"import-task-value",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(ct.scheduledValue)})]},pt)})})]},Le)}),e.jsxs("div",{className:"import-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>S(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:St,children:["Use Selected Tasks (",Ie,")"]})]})]})}const at=A.reduce((Ne,Ie,Ge)=>{const ge=Ie.group||"General";return Ne[ge]||(Ne[ge]=[]),Ne[ge].push({...Ie,originalIndex:Ge}),Ne},{}),ma=Object.keys(at).length>1||Object.keys(at).length===1&&!at.General;return e.jsxs("div",{children:[e.jsx("h1",{children:"New Project"}),e.jsx("p",{className:"subtitle",children:"Set up a new project to track"}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Name"}),e.jsx("input",{type:"text",placeholder:"e.g., Sunrise Apartments",value:m,onChange:Ne=>u(Ne.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",placeholder:"e.g., 4032",value:j,onChange:Ne=>p(Ne.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($)"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"e.g., 365000",value:B,onChange:Ne=>{const Ie=Ne.target.value.replace(/[^0-9.]/g,"");U(Ie)},className:"currency-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",placeholder:"e.g., 123 Main St, Los Angeles, CA 90001",value:x,onChange:Ne=>y(Ne.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",placeholder:"e.g., ABC Construction Inc.",value:g,onChange:Ne=>T(Ne.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Start Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:D,onChange:Ne=>V(Ne.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["End Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:k,onChange:Ne=>fe(Ne.target.value),min:D||void 0,required:!0}),D&&k&&new Date(k)<new Date(D)&&e.jsx("span",{className:"error-text",children:"End date must be after start date"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Planned Man-Days ",e.jsx("span",{className:"optional",children:"(optional)"})]}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Total estimated man-days to complete the project"}),e.jsx("input",{type:"number",inputMode:"numeric",placeholder:"e.g., 120",value:Y,onChange:Ne=>I(Ne.target.value.replace(/\D/g,"")),min:"1"})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${J==="demolition"?"active":""}`,onClick:()=>W("demolition"),children:"Demolition"}),e.jsx("button",{type:"button",className:`toggle-btn ${J==="abatement"?"active":""}`,onClick:()=>W("abatement"),children:"Abatement"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${N==="standard"?"active":""}`,onClick:()=>M("standard"),children:"Standard"}),e.jsx("button",{type:"button",className:`toggle-btn ${N==="pla"?"active":""}`,onClick:()=>M("pla"),children:"PLA"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN (4 digits)"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Foremen will enter this PIN to access this project"}),e.jsxs("div",{className:"pin-input-row",children:[e.jsx("input",{type:"text",placeholder:"e.g., 2847",value:F,onChange:Ne=>de(Ne.target.value),maxLength:4,className:"pin-input"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:_e,children:"Generate"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"areas-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Areas / Tasks"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginTop:"0.25rem"},children:"Define the areas for this project. Weights must total 100%."})]}),e.jsxs("div",{className:"import-btn-container",children:[e.jsx("input",{ref:X,type:"file",accept:".xlsx,.xls,.csv",onChange:tt,style:{display:"none"}}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:nt,disabled:z,children:z?"Reading...":" Import Excel"})]})]}),ma?Object.entries(at).map(([Ne,Ie])=>e.jsxs("div",{className:"area-group",children:[e.jsx("div",{className:"area-group-header",children:Ne}),Ie.map(Ge=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Task name",value:Ge.name,onChange:ge=>ze(Ge.originalIndex,"name",ge.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:Ge.scheduledValue?cd(Ge.scheduledValue):"",onChange:ge=>ze(Ge.originalIndex,"scheduledValue",zf(ge.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:Ge.weight,onChange:ge=>ze(Ge.originalIndex,"weight",ge.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>qe(Ge.originalIndex),children:""})]},Ge.originalIndex))]},Ne)):A.map((Ne,Ie)=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Area name (e.g., Level 1)",value:Ne.name,onChange:Ge=>ze(Ie,"name",Ge.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:Ne.scheduledValue?cd(Ne.scheduledValue):"",onChange:Ge=>ze(Ie,"scheduledValue",zf(Ge.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:Ne.weight,onChange:Ge=>ze(Ie,"weight",Ge.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>qe(Ie),children:""})]},Ie)),e.jsxs("div",{className:"weight-total-row",children:[e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Math.abs(C-100)<.1?"valid":"invalid"}`,children:[C.toFixed(1),"%"]}),A.some(Ne=>Ne.scheduledValue>0)&&e.jsxs("span",{className:"sov-total",children:[" SOV: ",cd(A.reduce((Ne,Ie)=>Ne+(parseFloat(Ie.scheduledValue)||0),0))]})]}),e.jsxs("div",{className:"auto-weight-dropdown",children:[e.jsx("button",{type:"button",className:"btn btn-secondary btn-small",onClick:()=>ae(!w),children:"Auto-Calculate "}),w&&e.jsxs("div",{className:"weight-dropdown-menu",children:[e.jsxs("button",{onClick:()=>Ve("value"),children:["By Value ",e.jsx("span",{className:"dropdown-hint",children:"(Recommended)"})]}),e.jsx("button",{onClick:()=>Ve("equal"),children:"Equal Distribution"})]})]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:re,children:"+ Add Area"})]}),e.jsx("button",{className:"btn btn-primary btn-full",onClick:rt,disabled:ne,children:ne?"Creating...":"Create Project"})]})}function by({company:r,onShowToast:l}){const{branding:o,updateBranding:c,uploadBrandingImage:m,loading:u}=vr(),[j,p]=f.useState(!1),[x,y]=f.useState(!1),[g,T]=f.useState(o),[B,U]=f.useState(""),[F,L]=f.useState(!1),J=f.useRef(null),W=f.useRef(null),N=f.useRef(null);f.useEffect(()=>{r?.id&&M()},[r?.id]);const M=async()=>{try{const{data:w,error:ae}=await R.from("companies").select("office_code").eq("id",r.id).single();!ae&&w?.office_code&&U(w.office_code)}catch(w){console.error("Error loading office code:",w)}},A=async()=>{if(confirm("Regenerate office code? Current code will stop working immediately.")){L(!0);try{const w=Math.random().toString(36).substring(2,8).toUpperCase(),{error:ae}=await R.from("companies").update({office_code:w}).eq("id",r.id);if(ae)throw ae;U(w),l?.("Office code regenerated","success")}catch(w){console.error("Error regenerating code:",w),l?.("Error regenerating code","error")}finally{L(!1)}}},ee=()=>{navigator.clipboard.writeText(B),l?.("Office code copied to clipboard","success")},ne=r?.subscription_tier||"free",Q=["pro","business","enterprise"].includes(ne),z=["business","enterprise"].includes(ne),H=ne==="enterprise",$=(w,ae)=>{T(D=>({...D,[w]:ae}))},S=async(w,ae)=>{if(w){if(w.size>5*1024*1024){l?.("Image must be smaller than 5MB","error");return}if(!w.type.startsWith("image/")){l?.("Please upload an image file","error");return}try{const D=await m(w,ae);D.success?($(`${ae}_url`,D.url),l?.(`${ae.charAt(0).toUpperCase()+ae.slice(1)} uploaded successfully`,"success")):l?.(D.error||"Failed to upload image","error")}catch(D){console.error("Upload error:",D),l?.("Failed to upload image","error")}}},v=async()=>{try{p(!0);const w=/^#[0-9A-F]{6}$/i;if(!w.test(g.primary_color)){l?.("Primary color must be a valid hex color (e.g., #3B82F6)","error");return}if(!w.test(g.secondary_color)){l?.("Secondary color must be a valid hex color (e.g., #1E40AF)","error");return}const ae=await c(g);ae.success?l?.("Branding settings saved successfully!","success"):l?.(ae.error||"Failed to save branding settings","error")}catch(w){console.error("Save error:",w),l?.("Failed to save branding settings","error")}finally{p(!1)}},_=()=>{x?(document.documentElement.style.setProperty("--primary-color",o.primary_color),document.documentElement.style.setProperty("--secondary-color",o.secondary_color),document.title=o.custom_app_name||"FieldSync"):(document.documentElement.style.setProperty("--primary-color",g.primary_color),document.documentElement.style.setProperty("--secondary-color",g.secondary_color),document.title=g.custom_app_name||"FieldSync"),y(!x)};return u?e.jsxs("div",{className:"settings-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading branding settings..."})]}):e.jsxs("div",{className:"branding-settings",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("h2",{children:" Branding Settings"}),ne==="free"&&e.jsx("div",{className:"tier-badge tier-free",children:"Free Plan - Upgrade for branding options"}),ne==="pro"&&e.jsx("div",{className:"tier-badge tier-pro",children:"Pro Plan"}),ne==="business"&&e.jsx("div",{className:"tier-badge tier-business",children:"Business Plan"}),ne==="enterprise"&&e.jsx("div",{className:"tier-badge tier-enterprise",children:"Enterprise Plan"})]}),e.jsxs("div",{className:"settings-section security-section",children:[e.jsx("h3",{children:"Security"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Office Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Share this code with office staff only. Required to create new office accounts."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:B||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:ee,disabled:!B,children:"Copy"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:A,disabled:F,children:F?"...":"Regenerate"})]}),e.jsx("p",{className:"help-text",style:{marginTop:"0.5rem",color:"var(--accent-amber)"},children:"Field workers should NOT have this code - they use project PINs only."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Company Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Public code for employees to find your company."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:r?.code||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:()=>{navigator.clipboard.writeText(r?.code||""),l?.("Company code copied","success")},disabled:!r?.code,children:"Copy"})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Visual Identity"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Logo"}),Q?e.jsxs(e.Fragment,{children:[g.logo_url&&e.jsx("div",{className:"logo-preview",children:e.jsx("img",{src:g.logo_url,alt:"Logo preview"})}),e.jsx("input",{ref:J,type:"file",accept:"image/*",style:{display:"none"},onChange:w=>S(w.target.files[0],"logo")}),e.jsx("button",{className:"btn-secondary",onClick:()=>J.current?.click(),children:g.logo_url?"Change Logo":"Upload Logo"}),e.jsx("p",{className:"help-text",children:"Recommended: 200x60px, PNG with transparent background"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your logo"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"app-name",children:"App Name"}),Q?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"app-name",type:"text",className:"input",value:g.custom_app_name||"",onChange:w=>$("custom_app_name",w.target.value),placeholder:"FieldSync",maxLength:50}),e.jsx("p",{className:"help-text",children:"This name appears in the browser tab and throughout the app"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your app name"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"primary-color",children:"Primary Color"}),Q?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"primary-color",type:"color",value:g.primary_color||"#3B82F6",onChange:w=>$("primary_color",w.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:g.primary_color||"#3B82F6",onChange:w=>$("primary_color",w.target.value),placeholder:"#3B82F6",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"secondary-color",children:"Secondary Color"}),Q?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"secondary-color",type:"color",value:g.secondary_color||"#1E40AF",onChange:w=>$("secondary_color",w.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:g.secondary_color||"#1E40AF",onChange:w=>$("secondary_color",w.target.value),placeholder:"#1E40AF",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Favicon"}),Q?e.jsxs(e.Fragment,{children:[g.favicon_url&&e.jsx("div",{className:"favicon-preview",children:e.jsx("img",{src:g.favicon_url,alt:"Favicon preview"})}),e.jsx("input",{ref:W,type:"file",accept:"image/*",style:{display:"none"},onChange:w=>S(w.target.files[0],"favicon")}),e.jsx("button",{className:"btn-secondary",onClick:()=>W.current?.click(),children:g.favicon_url?"Change Favicon":"Upload Favicon"}),e.jsx("p",{className:"help-text",children:"Recommended: 32x32px or 64x64px, PNG or ICO format"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your favicon"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Login Background"}),z?e.jsxs(e.Fragment,{children:[g.login_background_url&&e.jsx("div",{className:"background-preview",children:e.jsx("img",{src:g.login_background_url,alt:"Background preview"})}),e.jsx("input",{ref:N,type:"file",accept:"image/*",style:{display:"none"},onChange:w=>S(w.target.files[0],"login_background")}),e.jsx("button",{className:"btn-secondary",onClick:()=>N.current?.click(),children:g.login_background_url?"Change Background":"Upload Background"}),e.jsx("p",{className:"help-text",children:"Recommended: 1920x1080px, JPG or PNG"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Business or Enterprise to customize login background"})})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"White-Label Options"}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:g.hide_fieldsync_branding||!1,onChange:w=>$("hide_fieldsync_branding",w.target.checked),disabled:!z}),e.jsx("span",{children:'Hide "Powered by FieldSync"'})]}),!z&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Email Branding"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-name",children:"From Name"}),e.jsx("input",{id:"email-from-name",type:"text",className:"input",value:g.email_from_name||"",onChange:w=>$("email_from_name",w.target.value),placeholder:"Your Company Name",disabled:!z}),!z&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-address",children:"From Email"}),e.jsx("input",{id:"email-from-address",type:"email",className:"input",value:g.email_from_address||"",onChange:w=>$("email_from_address",w.target.value),placeholder:"noreply@yourcompany.com",disabled:!z}),!z&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Custom Domain"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"custom-domain",children:"Domain"}),H?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"custom-domain",type:"text",className:"input",value:g.custom_domain||"",onChange:w=>$("custom_domain",w.target.value),placeholder:"app.yourcompany.com"}),g.custom_domain&&e.jsx("div",{className:`domain-status ${g.domain_verified?"verified":"pending"}`,children:g.domain_verified?e.jsx(e.Fragment,{children:" Connected"}):e.jsx(e.Fragment,{children:" DNS setup required"})}),e.jsx("p",{className:"help-text",children:"Contact support to configure DNS and SSL certificate for your custom domain"})]}):e.jsxs("div",{className:"upgrade-notice",children:[e.jsx("p",{children:" Enterprise plan required for custom domain support"}),e.jsx("p",{className:"help-text",children:"Custom domains allow you to host the app at your own URL (e.g., app.yourcompany.com)"})]})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:_,children:x?"Exit Preview":"Preview Changes"}),e.jsx("button",{className:"btn-primary",onClick:v,disabled:j||!Q,children:j?"Saving...":"Save Changes"})]}),x&&e.jsx("div",{className:"preview-banner",children:"Preview Mode Active - Your changes are not yet saved"})]})}const od=["foreman","operator","laborer"],dd=["demolition","abatement"],ud=["standard","pla"];function _y({company:r,onShowToast:l}){const[o,c]=f.useState({}),[m,u]=f.useState(!1),[j,p]=f.useState(!1),[x,y]=f.useState("demolition"),[g,T]=f.useState(!0);f.useEffect(()=>{r?.id&&U()},[r?.id]);const B=()=>{const M={};return dd.forEach(A=>{M[A]={},ud.forEach(ee=>{M[A][ee]={},od.forEach(ne=>{M[A][ee][ne]={regular:"",overtime:""}})})}),M},U=async()=>{if(!G){c(B()),T(!1);return}const M=B();try{const{data:A,error:ee}=await R.from("labor_rates").select("*").eq("company_id",r.id);if(ee){c(M),T(!1);return}A&&A.length>0&&A.forEach(ne=>{M[ne.work_type]&&M[ne.work_type][ne.job_type]&&M[ne.work_type][ne.job_type][ne.role]&&(M[ne.work_type][ne.job_type][ne.role]={regular:ne.regular_rate||"",overtime:ne.overtime_rate||""})}),c(M)}catch(A){console.error("Error loading labor rates:",A),c(M)}finally{T(!1)}},F=async()=>{if(!G){l("Labor rates require database connection","error");return}p(!0);try{await R.from("labor_rates").delete().eq("company_id",r.id);const M=[];dd.forEach(ee=>{ud.forEach(ne=>{od.forEach(Q=>{const z=o[ee]?.[ne]?.[Q]||{regular:0,overtime:0};M.push({company_id:r.id,role:Q,work_type:ee,job_type:ne,regular_rate:parseFloat(z.regular)||0,overtime_rate:parseFloat(z.overtime)||0})})})});const{error:A}=await R.from("labor_rates").insert(M);if(A)throw A;l("Labor rates saved","success"),u(!1)}catch(M){console.error("Error saving labor rates:",M),l("Error saving rates: "+(M.message||"Unknown error"),"error")}finally{p(!1)}},L=(M,A,ee,ne,Q)=>{c(z=>({...z,[M]:{...z[M],[A]:{...z[M]?.[A],[ee]:{...z[M]?.[A]?.[ee],[ne]:Q}}}}))},J=M=>M.charAt(0).toUpperCase()+M.slice(1),W=M=>M.charAt(0).toUpperCase()+M.slice(1),N=M=>M==="pla"?"PLA (Prevailing Wage)":"Standard (Private)";return g?e.jsx("div",{className:"loading",children:"Loading labor rates..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"pricing-section-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Labor Rates"}),e.jsx("p",{className:"section-desc",children:"Configure hourly rates by role, work type, and job classification"})]}),m?e.jsxs("div",{className:"rate-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>{u(!1),U()},children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:F,disabled:j,children:j?"Saving...":"Save All Rates"})]}):e.jsx("button",{className:"btn btn-primary",onClick:()=>u(!0),children:"Edit Rates"})]}),e.jsx("div",{className:"work-type-tabs",children:dd.map(M=>e.jsx("button",{className:`work-type-tab ${x===M?"active":""}`,onClick:()=>y(M),children:W(M)},M))}),e.jsx("div",{className:"labor-rates-container",children:ud.map(M=>e.jsxs("div",{className:"job-type-section",children:[e.jsx("h3",{className:"job-type-header",children:N(M)}),e.jsxs("div",{className:"rates-table",children:[e.jsxs("div",{className:"rates-table-header",children:[e.jsx("div",{className:"rate-cell role-cell",children:"Role"}),e.jsx("div",{className:"rate-cell",children:"Regular"}),e.jsx("div",{className:"rate-cell",children:"Overtime"})]}),od.map(A=>{const ee=o[x]?.[M]?.[A]||{regular:"",overtime:""};return e.jsxs("div",{className:"rates-table-row",children:[e.jsx("div",{className:"rate-cell role-cell",children:J(A)}),e.jsx("div",{className:"rate-cell",children:m?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"number",value:ee.regular,onChange:ne=>L(x,M,A,"regular",ne.target.value),placeholder:"0.00",step:"0.01"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value",children:["$",(parseFloat(ee.regular)||0).toFixed(2),"/hr"]})}),e.jsx("div",{className:"rate-cell",children:m?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"number",value:ee.overtime,onChange:ne=>L(x,M,A,"overtime",ne.target.value),placeholder:"0.00",step:"0.01"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value ot",children:["$",(parseFloat(ee.overtime)||0).toFixed(2),"/hr"]})})]},A)})]})]},M))})]})}const zi=["Containment","PPE","Disposal","Equipment"];function Ny({company:r,onShowToast:l}){const[o,c]=f.useState([]),[m,u]=f.useState(!0),[j,p]=f.useState("all"),[x,y]=f.useState(null),[g,T]=f.useState(!1),[B,U]=f.useState({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),[F,L]=f.useState([]),[J,W]=f.useState(!1);f.useEffect(()=>{r?.id&&N()},[r?.id]);const N=async()=>{u(!0);try{const S=await se.getAllMaterialsEquipment(r.id);c(S||[]),M(S||[])}catch(S){console.error("Error loading items:",S),l("Error loading materials","error")}finally{u(!1)}},M=S=>{const v={},_=[];S.filter(ae=>ae.active!==!1).forEach(ae=>{const D=ae.name.toLowerCase().trim();v[D]||(v[D]=[]),v[D].push(ae)}),Object.entries(v).forEach(([ae,D])=>{D.length>1&&_.push({name:ae,items:D})}),L(_)},A=async S=>{try{const v=S.items.filter(ae=>ae.cost_per_unit>0),_=v.length>0?v[0]:S.items[0],w=S.items.filter(ae=>ae.id!==_.id);for(const ae of w)await se.deleteMaterialEquipment(ae.id);l(`Merged ${S.items.length} items into one`,"success"),N()}catch(v){console.error("Error merging duplicates:",v),l("Error merging duplicates","error")}},ee=async()=>{if(confirm(`Merge all ${F.length} duplicate groups?`))try{for(const S of F){const v=S.items.filter(ae=>ae.cost_per_unit>0),_=v.length>0?v[0]:S.items[0],w=S.items.filter(ae=>ae.id!==_.id);for(const ae of w)await se.deleteMaterialEquipment(ae.id)}l("All duplicates merged!","success"),N(),W(!1)}catch(S){console.error("Error merging all duplicates:",S),l("Error merging duplicates","error")}},ne=async()=>{if(!B.name.trim()){l("Enter item name","error");return}try{await se.createMaterialEquipment({company_id:r.id,name:B.name.trim(),category:B.category,unit:B.unit||"each",cost_per_unit:parseFloat(B.cost_per_unit)||0,active:!0}),l("Item added","success"),U({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),T(!1),N()}catch(S){console.error("Error adding item:",S),l("Error adding item","error")}},Q=async S=>{try{await se.updateMaterialEquipment(S.id,{name:S.name,category:S.category,unit:S.unit,cost_per_unit:parseFloat(S.cost_per_unit)||0}),l("Item updated","success"),y(null),N()}catch(v){console.error("Error updating item:",v),l("Error updating item","error")}},z=async S=>{if(confirm("Delete this item?"))try{await se.deleteMaterialEquipment(S),l("Item deleted","success"),N()}catch(v){console.error("Error deleting item:",v),l("Error deleting item","error")}},H=j==="all"?o.filter(S=>S.active!==!1):o.filter(S=>S.category===j&&S.active!==!1),$=H.reduce((S,v)=>{const _=v.category||"Other";return S[_]||(S[_]=[]),S[_].push(v),S},{});return m?e.jsx("div",{className:"loading",children:"Loading materials..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"materials-header",children:[e.jsxs("div",{className:"materials-title",children:[e.jsx("h2",{children:"Materials & Equipment"}),e.jsxs("span",{className:"materials-count",children:[o.filter(S=>S.active!==!1).length," items"]})]}),e.jsxs("div",{className:"materials-actions",children:[F.length>0&&e.jsxs("button",{className:`btn btn-warning ${J?"active":""}`,onClick:()=>W(!J),children:[F.length," Duplicates"]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>T(!0),children:"+ Add Item"})]})]}),J&&F.length>0&&e.jsxs("div",{className:"duplicates-panel",children:[e.jsxs("div",{className:"duplicates-header",children:[e.jsx("h3",{children:"Duplicate Items Found"}),e.jsxs("button",{className:"btn btn-success btn-small",onClick:ee,children:["Merge All (",F.length,")"]})]}),e.jsx("div",{className:"duplicates-list",children:F.map((S,v)=>e.jsxs("div",{className:"duplicate-group",children:[e.jsxs("div",{className:"duplicate-name",children:['"',S.name,'" x ',S.items.length]}),e.jsx("div",{className:"duplicate-items",children:S.items.map(_=>e.jsxs("span",{className:"duplicate-item",children:[_.category," - $",_.cost_per_unit||0]},_.id))}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>A(S),children:"Merge"})]},v))})]}),g&&e.jsxs("div",{className:"add-item-form",children:[e.jsx("h3",{children:"Add New Item"}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Item Name",value:B.name,onChange:S=>U({...B,name:S.target.value}),autoFocus:!0}),e.jsx("select",{value:B.category,onChange:S=>U({...B,category:S.target.value}),children:zi.map(S=>e.jsx("option",{value:S,children:S},S))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Unit (e.g., each, day, hour)",value:B.unit,onChange:S=>U({...B,unit:S.target.value})}),e.jsx("input",{type:"number",placeholder:"Cost per unit",value:B.cost_per_unit,onChange:S=>U({...B,cost_per_unit:S.target.value}),step:"0.01"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>T(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:ne,children:"Add Item"})]})]}),e.jsxs("div",{className:"materials-filter",children:[e.jsx("button",{className:`filter-tab ${j==="all"?"active":""}`,onClick:()=>p("all"),children:"All"}),zi.map(S=>e.jsxs("button",{className:`filter-tab ${j===S?"active":""}`,onClick:()=>p(S),children:[S,e.jsx("span",{className:"filter-count",children:o.filter(v=>v.category===S&&v.active!==!1).length})]},S))]}),e.jsxs("div",{className:"materials-list",children:[j==="all"?Object.entries($).map(([S,v])=>e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:S}),e.jsx("div",{className:"category-items",children:v.map(_=>e.jsx(Of,{item:_,editingItem:x,setEditingItem:y,handleUpdateItem:Q,handleDeleteItem:z,categories:zi},_.id))})]},S)):e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:j}),e.jsx("div",{className:"category-items",children:H.map(S=>e.jsx(Of,{item:S,editingItem:x,setEditingItem:y,handleUpdateItem:Q,handleDeleteItem:z,categories:zi},S.id))})]}),H.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No items in this category"})})]})]})}function Of({item:r,editingItem:l,setEditingItem:o,handleUpdateItem:c,handleDeleteItem:m,categories:u}){return l?.id===r.id?e.jsx("div",{className:"material-item",children:e.jsxs("div",{className:"item-edit-form",children:[e.jsx("input",{type:"text",value:l.name,onChange:j=>o({...l,name:j.target.value})}),e.jsx("select",{value:l.category,onChange:j=>o({...l,category:j.target.value}),children:u.map(j=>e.jsx("option",{value:j,children:j},j))}),e.jsx("input",{type:"text",value:l.unit,onChange:j=>o({...l,unit:j.target.value}),placeholder:"Unit"}),e.jsx("input",{type:"number",value:l.cost_per_unit,onChange:j=>o({...l,cost_per_unit:j.target.value}),placeholder:"Cost",step:"0.01"}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>c(l),children:"Save"}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>o(null),children:"Cancel"})]})]})}):e.jsxs("div",{className:"material-item",children:[e.jsxs("div",{className:"item-info",children:[e.jsx("span",{className:"item-name",children:r.name}),e.jsx("span",{className:"item-unit",children:r.unit||"each"})]}),e.jsxs("div",{className:"item-cost",children:["$",(r.cost_per_unit||0).toFixed(2)]}),e.jsxs("div",{className:"item-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>o({...r}),title:"Edit",children:e.jsx(sp,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:()=>m(r.id),title:"Delete",children:e.jsx(ks,{size:16})})]})]})}const Sy=[{id:"trash",label:"Trash",description:"General debris"},{id:"metal",label:"Metal",description:"Scrap metal (recyclable)"},{id:"copper",label:"Copper",description:"Copper scrap (recyclable)"},{id:"concrete",label:"Concrete",description:"Concrete/masonry"},{id:"hazardous",label:"Hazardous",description:"Hazardous materials"}];function Cy({company:r,onShowToast:l}){const[o,c]=f.useState([]),[m,u]=f.useState(!0),[j,p]=f.useState(!1),[x,y]=f.useState(null),[g,T]=f.useState({name:"",address:"",notes:""}),[B,U]=f.useState(!1),[F,L]=f.useState({}),J=f.useRef({});f.useEffect(()=>{r?.id&&W()},[r?.id]),f.useEffect(()=>()=>{Object.values(J.current).forEach(H=>clearTimeout(H))},[]);const W=async()=>{u(!0);try{const H=await se.getDumpSites(r.id);c(H||[])}catch(H){console.error("Error loading dump sites:",H),l("Error loading dump sites","error")}finally{u(!1)}},N=async()=>{if(!g.name.trim()){l("Please enter a site name","error");return}U(!0);try{await se.createDumpSite(r.id,g.name,g.address,g.notes),l("Dump site added","success"),T({name:"",address:"",notes:""}),p(!1),W()}catch(H){console.error("Error adding dump site:",H),l("Error adding dump site","error")}finally{U(!1)}},M=async()=>{if(!x?.name.trim()){l("Please enter a site name","error");return}U(!0);try{await se.updateDumpSite(x.id,{name:x.name,address:x.address,notes:x.notes}),l("Dump site updated","success"),y(null),W()}catch(H){console.error("Error updating dump site:",H),l("Error updating dump site","error")}finally{U(!1)}},A=async H=>{if(confirm("Are you sure you want to delete this dump site?"))try{await se.deleteDumpSite(H),l("Dump site deleted","success"),W()}catch($){console.error("Error deleting dump site:",$),l("Error deleting dump site","error")}},ee=f.useCallback(async(H,$,S)=>{try{await se.setDumpSiteRate(H,$,S),c(v=>v.map(_=>{if(_.id===H){const w=[..._.dump_site_rates||[]],ae=w.findIndex(D=>D.waste_type===$);return ae>=0?w[ae]={...w[ae],estimated_cost_per_load:S}:w.push({waste_type:$,estimated_cost_per_load:S}),{..._,dump_site_rates:w}}return _})),L(v=>{const _={...v};return delete _[`${H}-${$}`],_})}catch(v){console.error("Error saving rate:",v?.message||v),l("Error saving rate","error")}},[l]),ne=(H,$,S)=>{const v=`${H}-${$}`;L(_=>({..._,[v]:S})),J.current[v]&&clearTimeout(J.current[v]),J.current[v]=setTimeout(()=>{const _=parseFloat(S)||0;ee(H,$,_)},500)},Q=(H,$)=>{const S=`${H.id}-${$}`;return F[S]!==void 0?F[S]:H.dump_site_rates?.find(_=>_.waste_type===$)?.estimated_cost_per_load??""},z=H=>{if(H===""||H===null||H===void 0)return"";const $=parseFloat(H);return $<0?`-$${Math.abs($).toFixed(0)}`:`$${$.toFixed(0)}`};return m?e.jsx("div",{className:"loading",children:"Loading dump sites..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"dump-site-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Disposal & Haul-Off"}),e.jsx("p",{className:"section-desc",children:"Configure dump sites and estimated costs per load for each waste type. Use negative values for recyclables (metal, copper) to indicate revenue."})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>p(!0),children:"+ Add Dump Site"})]}),j&&e.jsxs("div",{className:"dump-site-form card",children:[e.jsx("h4",{children:"Add Dump Site"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:g.name,onChange:H=>T({...g,name:H.target.value}),placeholder:"e.g., Metro Landfill"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:g.address,onChange:H=>T({...g,address:H.target.value}),placeholder:"123 Main St, City"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:g.notes,onChange:H=>T({...g,notes:H.target.value}),placeholder:"Operating hours, contact, etc."})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:N,disabled:B,children:B?"Adding...":"Add Site"})]})]}),o.length===0?e.jsxs("div",{className:"dump-site-empty",children:[e.jsx("p",{children:"No dump sites configured yet."}),e.jsx("p",{children:"Add a dump site to start tracking haul-off costs."})]}):e.jsx("div",{className:"dump-sites-list",children:o.map(H=>e.jsxs("div",{className:"dump-site-card card",children:[x?.id===H.id?e.jsxs("div",{className:"dump-site-edit",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:x.name,onChange:$=>y({...x,name:$.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:x.address||"",onChange:$=>y({...x,address:$.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:x.notes||"",onChange:$=>y({...x,notes:$.target.value})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>y(null),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:M,disabled:B,children:B?"Saving...":"Save"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dump-site-info",children:[e.jsx("div",{className:"dump-site-name",children:H.name}),H.address&&e.jsx("div",{className:"dump-site-address",children:H.address}),H.notes&&e.jsx("div",{className:"dump-site-notes",children:H.notes})]}),e.jsxs("div",{className:"dump-site-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>y({...H}),title:"Edit",children:e.jsx(sp,{size:16})}),e.jsx("button",{className:"btn-icon",onClick:()=>A(H.id),title:"Delete",children:e.jsx(ks,{size:16})})]})]}),e.jsxs("div",{className:"dump-site-rates",children:[e.jsx("div",{className:"rates-header",children:"Estimated Cost per Load"}),e.jsx("div",{className:"rates-grid",children:Sy.map($=>e.jsxs("div",{className:"rate-item",children:[e.jsxs("label",{children:[e.jsx("span",{className:"rate-label",children:$.label}),e.jsx("span",{className:"rate-desc",children:$.description})]}),e.jsxs("div",{className:"rate-input-wrapper",children:[e.jsx("span",{className:"rate-prefix",children:"$"}),e.jsx("input",{type:"number",className:"rate-input",value:Q(H,$.id),onChange:S=>ne(H.id,$.id,S.target.value),placeholder:"0"})]}),Q(H,$.id)!==""&&e.jsxs("span",{className:`rate-preview ${parseFloat(Q(H,$.id))<0?"revenue":"cost"}`,children:[z(Q(H,$.id)),"/load"]})]},$.id))}),e.jsx("div",{className:"rates-note",children:"Tip: Use negative values for recyclables that generate revenue (e.g., -50 for metal)"})]})]},H.id))})]})}const wy=[{id:"labor",label:"Labor Rates",Icon:ua},{id:"materials",label:"Materials & Equipment",Icon:gl},{id:"disposal",label:"Disposal & Haul-Off",Icon:qn}];function ky({company:r,onShowToast:l}){const[o,c]=f.useState("labor");return e.jsxs("div",{className:"pricing-manager",children:[e.jsxs("div",{className:"pricing-header",children:[e.jsx("h1",{children:"Pricing Configuration"}),e.jsx("p",{className:"pricing-subtitle",children:"Set up labor rates, materials pricing, and disposal costs"})]}),e.jsx("div",{className:"pricing-tabs",children:wy.map(m=>e.jsxs("button",{className:`pricing-tab ${o===m.id?"active":""}`,onClick:()=>c(m.id),children:[e.jsx(m.Icon,{size:18,className:"pricing-tab-icon"}),e.jsx("span",{className:"pricing-tab-label",children:m.label})]},m.id))}),e.jsxs("div",{className:"pricing-content",children:[o==="labor"&&e.jsx(_y,{company:r,onShowToast:l}),o==="materials"&&e.jsx(Ny,{company:r,onShowToast:l}),o==="disposal"&&e.jsx(Cy,{company:r,onShowToast:l})]})]})}function Ey({shareToken:r}){const[l,o]=f.useState(!0),[c,m]=f.useState(null),[u,j]=f.useState(null),[p,x]=f.useState(0),{branding:y}=vr();f.useEffect(()=>{g()},[r]);const g=async()=>{o(!0),m(null);try{const A=await se.getPublicProjectData(r);if(!A){m("This share link is invalid or has expired.");return}j(A)}catch(A){console.error("Error loading public data:",A),m("Failed to load project data.")}finally{o(!1)}},T=A=>A?new Date(A).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",B=A=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(A);if(l)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading project..."})]}),e.jsx("style",{children:md})]});if(c)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx(pl,{size:48})}),e.jsx("h2",{children:c}),e.jsx("p",{children:"Please contact the project owner for a valid link."})]}),e.jsx("style",{children:md})]});const{share:U,project:F,progress:L,areas:J,photos:W,dailyReports:N,tmTickets:M}=u;return e.jsxs("div",{className:"public-view",children:[e.jsx("header",{className:"public-header",children:e.jsxs("div",{className:"container",children:[e.jsx(Wa,{size:"large"}),e.jsx("div",{className:"header-meta",children:e.jsxs("span",{className:"last-updated",children:["Last updated: ",T(F.updated_at||F.created_at)]})})]})}),e.jsx("main",{className:"public-main",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"project-header",children:[e.jsx("h1",{children:F.name}),F.address&&e.jsx("p",{className:"project-address",children:F.address})]}),U.permissions.progress&&e.jsxs("div",{className:"public-card progress-card",children:[e.jsx("h2",{children:"Project Progress"}),e.jsxs("div",{className:"progress-visual",children:[e.jsxs("div",{className:"progress-circle",children:[e.jsxs("svg",{viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"var(--primary-color, #3b82f6)",strokeWidth:"8",strokeDasharray:`${L*2.827} 282.7`,strokeLinecap:"round",transform:"rotate(-90 50 50)"})]}),e.jsxs("div",{className:"progress-percentage",children:[L,"%"]})]}),e.jsxs("div",{className:"progress-details",children:[e.jsx("div",{className:"progress-label",children:"Complete"}),J&&J.length>0&&e.jsxs("div",{className:"areas-summary",children:[J.filter(A=>A.status==="done").length," of ",J.length," areas completed"]})]})]}),J&&J.length>0&&e.jsxs("div",{className:"areas-list",children:[e.jsx("h3",{children:"Work Areas"}),J.map(A=>e.jsxs("div",{className:"area-item",children:[e.jsxs("div",{className:"area-info",children:[e.jsx("span",{className:"area-name",children:A.name}),e.jsxs("span",{className:"area-weight",children:[A.weight,"%"]})]}),e.jsx("div",{className:`area-status status-${A.status}`,children:A.status==="done"?" Complete":A.status==="working"?" In Progress":" Not Started"})]},A.id))]})]}),U.permissions.photos&&W&&W.length>0&&e.jsxs("div",{className:"public-card photos-card",children:[e.jsx("h2",{children:"Recent Photos"}),e.jsxs("div",{className:"photos-carousel",children:[e.jsxs("div",{className:"carousel-main",children:[W[p]&&e.jsx("img",{src:W[p].url,alt:`Project photo from ${T(W[p].date)}`,className:"carousel-image"}),e.jsx("div",{className:"carousel-date",children:T(W[p]?.date)})]}),e.jsx("div",{className:"carousel-thumbnails",children:W.slice(0,10).map((A,ee)=>e.jsx("div",{className:`thumbnail ${ee===p?"active":""}`,onClick:()=>x(ee),children:e.jsx("img",{src:A.url,alt:`Thumbnail ${ee+1}`})},ee))}),W.length>1&&e.jsxs("div",{className:"carousel-controls",children:[e.jsx("button",{onClick:()=>x(A=>A>0?A-1:W.length-1),className:"carousel-btn",children:""}),e.jsxs("span",{className:"carousel-counter",children:[p+1," / ",W.length]}),e.jsx("button",{onClick:()=>x(A=>A<W.length-1?A+1:0),className:"carousel-btn",children:""})]})]})]}),U.permissions.daily_reports&&N&&N.length>0&&e.jsxs("div",{className:"public-card reports-card",children:[e.jsx("h2",{children:"Daily Reports"}),e.jsx("div",{className:"reports-list",children:N.map((A,ee)=>e.jsxs("div",{className:"report-item",children:[e.jsx("div",{className:"report-date",children:T(A.report_date)}),e.jsxs("div",{className:"report-content",children:[A.crew_count&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Crew:"})," ",A.crew_count," workers"]}),A.tasks_completed&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Tasks Completed:"})," ",A.tasks_completed]}),A.weather&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Weather:"})," ",A.weather]}),A.notes&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Notes:"})," ",A.notes]})]})]},ee))})]}),U.permissions.tm_tickets&&M&&M.length>0&&e.jsxs("div",{className:"public-card tm-card",children:[e.jsx("h2",{children:"Time & Materials Tickets"}),e.jsx("div",{className:"tm-list",children:M.map((A,ee)=>e.jsxs("div",{className:"tm-item",children:[e.jsxs("div",{className:"tm-header",children:[e.jsx("span",{className:"tm-date",children:T(A.work_date)}),e.jsx("span",{className:`tm-status status-${A.status}`,children:A.status})]}),A.description&&e.jsx("div",{className:"tm-description",children:A.description}),A.total_amount&&e.jsxs("div",{className:"tm-amount",children:["Total: ",B(A.total_amount)]})]},ee))})]})]})}),e.jsx("footer",{className:"public-footer",children:e.jsx("div",{className:"container",children:!y?.hide_fieldsync_branding&&e.jsx("p",{children:"Powered by FieldSync"})})}),e.jsx("style",{children:md})]})}const md=`
  .public-view {
    min-height: 100vh;
    background-color: #f9fafb;
    display: flex;
    flex-direction: column;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 1rem;
    width: 100%;
  }

  /* Header */
  .public-header {
    background-color: white;
    border-bottom: 1px solid #e5e7eb;
    padding: 1.5rem 0;
  }

  .public-header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header-meta {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Main Content */
  .public-main {
    flex: 1;
    padding: 2rem 0;
  }

  .project-header {
    margin-bottom: 2rem;
  }

  .project-header h1 {
    font-size: 2rem;
    margin: 0 0 0.5rem 0;
    color: #111827;
  }

  .project-address {
    font-size: 1rem;
    color: #6b7280;
    margin: 0;
  }

  /* Cards */
  .public-card {
    background-color: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .public-card h2 {
    font-size: 1.5rem;
    margin: 0 0 1.5rem 0;
    color: #111827;
  }

  .public-card h3 {
    font-size: 1.125rem;
    margin: 1.5rem 0 1rem 0;
    color: #374151;
  }

  /* Progress Card */
  .progress-visual {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .progress-circle {
    position: relative;
    width: 150px;
    height: 150px;
    flex-shrink: 0;
  }

  .progress-circle svg {
    width: 100%;
    height: 100%;
  }

  .progress-percentage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary-color, #3b82f6);
  }

  .progress-details {
    flex: 1;
  }

  .progress-label {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.5rem;
  }

  .areas-summary {
    font-size: 1rem;
    color: #6b7280;
  }

  /* Areas List */
  .areas-list {
    border-top: 1px solid #e5e7eb;
    padding-top: 1rem;
  }

  .area-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f3f4f6;
  }

  .area-item:last-child {
    border-bottom: none;
  }

  .area-info {
    flex: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-right: 1rem;
  }

  .area-name {
    font-weight: 500;
    color: #374151;
  }

  .area-weight {
    color: #6b7280;
    font-size: 0.875rem;
  }

  .area-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
  }

  .area-status.status-done {
    background-color: #d1fae5;
    color: #065f46;
  }

  .area-status.status-working {
    background-color: #fef3c7;
    color: #92400e;
  }

  .area-status.status-not_started {
    background-color: #f3f4f6;
    color: #6b7280;
  }

  /* Photos Carousel */
  .photos-carousel {
    position: relative;
  }

  .carousel-main {
    position: relative;
    width: 100%;
    height: 400px;
    background-color: #111827;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .carousel-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .carousel-date {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
    color: white;
    padding: 1rem;
    text-align: center;
  }

  .carousel-thumbnails {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
  }

  .thumbnail {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s;
  }

  .thumbnail:hover {
    border-color: #d1d5db;
  }

  .thumbnail.active {
    border-color: var(--primary-color, #3b82f6);
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .carousel-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
  }

  .carousel-btn {
    background-color: white;
    border: 1px solid #d1d5db;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.25rem;
    transition: background-color 0.2s;
  }

  .carousel-btn:hover {
    background-color: #f3f4f6;
  }

  .carousel-counter {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Daily Reports */
  .reports-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .report-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .report-date {
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.75rem;
    font-size: 1.125rem;
  }

  .report-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .report-field {
    color: #374151;
    line-height: 1.5;
  }

  .report-field strong {
    color: #111827;
  }

  /* T&M Tickets */
  .tm-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .tm-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .tm-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .tm-date {
    font-weight: 600;
    color: #111827;
  }

  .tm-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: capitalize;
  }

  .tm-status.status-approved {
    background-color: #d1fae5;
    color: #065f46;
  }

  .tm-status.status-pending {
    background-color: #fef3c7;
    color: #92400e;
  }

  .tm-status.status-rejected {
    background-color: #fee2e2;
    color: #991b1b;
  }

  .tm-description {
    color: #374151;
    margin-bottom: 0.5rem;
  }

  .tm-amount {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--primary-color, #3b82f6);
  }

  /* Footer */
  .public-footer {
    background-color: white;
    border-top: 1px solid #e5e7eb;
    padding: 2rem 0;
    margin-top: auto;
  }

  .public-footer p {
    text-align: center;
    color: #6b7280;
    margin: 0;
    font-size: 0.875rem;
  }

  /* Loading & Error States */
  .loading-container,
  .error-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 2rem;
  }

  .spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #e5e7eb;
    border-top-color: var(--primary-color, #3b82f6);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .loading-container p {
    margin-top: 1rem;
    color: #6b7280;
  }

  .error-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .error-container h2 {
    color: #111827;
    margin: 0 0 0.5rem 0;
  }

  .error-container p {
    color: #6b7280;
    margin: 0;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .project-header h1 {
      font-size: 1.5rem;
    }

    .public-card {
      padding: 1.5rem;
    }

    .progress-visual {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .progress-circle {
      width: 120px;
      height: 120px;
    }

    .progress-percentage {
      font-size: 1.5rem;
    }

    .carousel-main {
      height: 300px;
    }

    .area-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .area-info {
      width: 100%;
      margin-right: 0;
    }
  }
`;function Uf({onSave:r,onClose:l,slot:o=1,documentType:c="cor",documentTitle:m="",signerName:u="",signerTitle:j="",signerCompany:p=""}){const x=f.useRef(null),[y,g]=f.useState(u),[T,B]=f.useState(j),[U,F]=f.useState(p),[L,J]=f.useState(!1),[W,N]=f.useState(!1),[M,A]=f.useState(!1),ee=o===1?"GC Authorization":"Client Authorization",ne=c==="cor"?"Change Order Request":"T&M Work Order",Q=()=>{const D=x.current;return D?D.getContext("2d"):null},z=D=>{const V=x.current;if(!V)return{x:0,y:0};const k=V.getBoundingClientRect(),fe=V.width/k.width,Y=V.height/k.height,I=D.touches?D.touches[0].clientX:D.clientX,X=D.touches?D.touches[0].clientY:D.clientY;return{x:(I-k.left)*fe,y:(X-k.top)*Y}},H=D=>{D.preventDefault();const V=Q();if(!V)return;const{x:k,y:fe}=z(D);V.beginPath(),V.moveTo(k,fe),N(!0),J(!0)},$=D=>{if(!W)return;D.preventDefault();const V=Q();if(!V)return;const{x:k,y:fe}=z(D);V.lineTo(k,fe),V.stroke()},S=()=>{N(!1)},v=()=>{const D=x.current,V=Q();!D||!V||(V.clearRect(0,0,D.width,D.height),J(!1))},_=D=>{if(!D)return;x.current=D;const V=D.getContext("2d");V.strokeStyle="#1e293b",V.lineWidth=2,V.lineCap="round",V.lineJoin="round"},w=L&&y.trim()&&M,ae=()=>{if(!w)return;const D=x.current;if(!D)return;const V=D.toDataURL("image/png");r({signature:V,signerName:y.trim(),signerTitle:T.trim()||null,signerCompany:U.trim()||null,signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal enhanced",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"signature-header-info",children:[e.jsx("h2",{id:"signature-title",children:ee}),m&&e.jsx("span",{className:"signature-doc-ref",children:m})]}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close signature modal",children:e.jsx(Ms,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"signature-slot-badge",children:[e.jsx(Li,{size:14}),e.jsxs("span",{children:["Signature ",o," of 2"]})]}),e.jsxs("div",{className:"signature-fields",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Print Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:y,onChange:D=>g(D.target.value),placeholder:"Enter your full legal name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-fields-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-title",children:"Title"}),e.jsx("input",{id:"signer-title",type:"text",value:T,onChange:D=>B(D.target.value),placeholder:"e.g., Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-company",children:"Company"}),e.jsx("input",{id:"signer-company",type:"text",value:U,onChange:D=>F(D.target.value),placeholder:"e.g., ABC Construction"})]})]})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(ap,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Draw your signature below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:_,width:500,height:180,className:"signature-canvas",onMouseDown:H,onMouseMove:$,onMouseUp:S,onMouseLeave:S,onTouchStart:H,onTouchMove:$,onTouchEnd:S,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!L&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:v,disabled:!L,"aria-label":"Clear signature",children:[e.jsx(np,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("div",{className:"signature-acknowledgment",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:D=>A(D.target.checked)}),e.jsxs("span",{children:["I acknowledge that this electronic signature is legally binding and that I have reviewed and approve this ",ne,". I understand that my signature, name, and IP address will be recorded for verification purposes."]})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:ae,disabled:!w,"aria-label":"Submit signature",children:[e.jsx(hl,{size:16,"aria-hidden":"true"})," Submit Signature"]})]})]})})}const gr=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",Dy=({status:r})=>{const l={draft:{label:"Draft",color:"#6b7280",bg:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bg:"#fef3c7"},approved:{label:"Approved",color:"#059669",bg:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bg:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bg:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bg:"#e5e7eb"}},o=l[r]||l.draft;return e.jsx("span",{className:"cor-status-badge",style:{color:o.color,backgroundColor:o.bg},children:o.label})};function My({signatureToken:r}){const[l,o]=f.useState(!0),[c,m]=f.useState(null),[u,j]=f.useState(null),[p,x]=f.useState(null),[y,g]=f.useState(!1),[T,B]=f.useState(null),[U,F]=f.useState(!1),[L,J]=f.useState(null),[W,N]=f.useState(!1),[M,A]=f.useState([]),[ee,ne]=f.useState(!1),[Q,z]=f.useState(new Set);f.useEffect(()=>{H()},[r]);const H=async()=>{try{o(!0),m(null);const C=await se.getSignatureRequestByToken(r);if(!C){m("This signature link is invalid or has expired.");return}if(C.status==="completed"){m("This document has already been fully signed.");return}if(C.status==="revoked"){m("This signature link has been revoked.");return}if(C.status==="expired"){m("This signature link has expired.");return}j(C);const de=await se.getDocumentForSigning(C.document_type,C.document_id);if(!de){m("The document associated with this link could not be found.");return}if(x(de),C.document_type==="cor"&&de?.id)try{const _e=await se.getCORTickets(de.id);A(_e||[])}catch(_e){console.warn("Failed to load backup tickets:",_e)}}catch(C){console.error("Error loading signature data:",C),m("Unable to load signature request. Please try again.")}finally{o(!1)}},$=f.useMemo(()=>!p||u?.document_type!=="cor"?null:xl(p),[p,u]),S=()=>{if(!u)return{slot1:null,slot2:null,availableSlots:[]};const C=u.signatures||[],de=C.find(re=>re.signature_slot===1),_e=C.find(re=>re.signature_slot===2),ze=[];return de||ze.push(1),_e||ze.push(2),{slot1:de,slot2:_e,availableSlots:ze}},v=async()=>{try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return null}},_=async C=>{if(!(!u||!T))try{F(!0);const de=await v(),_e=await se.addSignature(u.id,T,{...C,ipAddress:de,userAgent:navigator.userAgent});await se.syncSignatureToDocument(_e,u),await H(),g(!1),B(null),J(`Signature ${T} has been recorded successfully.`),setTimeout(()=>J(null),5e3)}catch(de){console.error("Error submitting signature:",de),m("Failed to submit signature. Please try again.")}finally{F(!1)}},w=C=>{B(C),g(!0)},ae=async()=>{if(!(!p||!u))try{N(!0);let C=null;if(Y)try{C=await se.getCORTickets(p.id)}catch(_e){console.warn("Failed to fetch T&M tickets for backup:",_e)}const de={logoUrl:I?.logo_url,primaryColor:I?.branding_color};await gp(p,X,I,de,C),J("PDF downloaded successfully!"),setTimeout(()=>J(null),3e3)}catch(C){console.error("Download failed:",C),m("Failed to generate PDF. Please try again.")}finally{N(!1)}};if(l)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading document..."})]})});if(c)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-error",children:[e.jsx(An,{size:48}),e.jsx("h2",{children:"Unable to Load Document"}),e.jsx("p",{children:c})]})});const{slot1:D,slot2:V,availableSlots:k}=S(),fe=k.length===0,Y=u?.document_type==="cor",I=p?.projects?.companies,X=p?.projects;if(!Y){const C=p.t_and_m_workers?.length||0,de=p.t_and_m_workers?.reduce((_e,ze)=>_e+(ze.hours||0),0)||0;return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[I?.logo_url?e.jsx("img",{src:I.logo_url,alt:I.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Oi,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:I?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"T&M Ticket Signature"})]})]}),L&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(ns,{size:18}),L]}),e.jsxs("main",{className:"signature-page-content",children:[e.jsxs("div",{className:"signature-document-card",children:[e.jsxs("div",{className:"document-card-header",children:[e.jsx(Ua,{size:20}),e.jsxs("div",{className:"document-card-title",children:[e.jsx("h2",{children:"T&M Ticket"}),e.jsx("span",{className:"document-subtitle",children:p.ce_pco_number?`CE/PCO: ${p.ce_pco_number}`:"Time & Materials"})]})]}),e.jsxs("div",{className:"document-card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Project"}),e.jsx("span",{className:"detail-value",children:X?.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Work Date"}),e.jsx("span",{className:"detail-value",children:gr(p.work_date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Workers"}),e.jsxs("span",{className:"detail-value",children:[C," (",de," hrs)"]})]}),p.notes&&e.jsxs("div",{className:"detail-row full-width",children:[e.jsx("span",{className:"detail-label",children:"Description"}),e.jsx("span",{className:"detail-value",children:p.notes})]})]})]}),e.jsxs("div",{className:"signature-status-section",children:[e.jsx("h3",{children:"Signatures Required"}),Lf(1,D,"GC Authorization",w,U),Lf(2,V,"Client Authorization",w,U),fe&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(ns,{size:24}),e.jsx("p",{children:"This document has been fully signed by all parties."})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),y&&T&&e.jsx(Uf,{slot:T,documentType:"tm_ticket",documentTitle:"T&M Ticket",onSave:_,onClose:()=>{g(!1),B(null)}})]})}return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[I?.logo_url?e.jsx("img",{src:I.logo_url,alt:I.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Oi,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:I?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"Change Order Request"})]})]}),L&&e.jsxs("div",{className:"signature-success-banner",children:[e.jsx(ns,{size:18}),L]}),e.jsxs("main",{className:"signature-page-content cor-full-document",children:[e.jsxs("div",{className:"cor-header-card",children:[e.jsxs("div",{className:"cor-header-top",children:[e.jsxs("div",{className:"cor-title-section",children:[e.jsx("h2",{className:"cor-number",children:p.cor_number}),e.jsx(Dy,{status:p.status})]}),e.jsxs("div",{className:"cor-date",children:["Created ",gr(p.created_at)]})]}),e.jsx("h3",{className:"cor-title",children:p.title||"Untitled Change Order"}),e.jsxs("div",{className:"cor-info-grid",children:[e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Project"}),e.jsx("span",{className:"cor-info-value",children:X?.name})]}),X?.job_number&&e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Job #"}),e.jsx("span",{className:"cor-info-value",children:X.job_number})]}),e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Period"}),e.jsx("span",{className:"cor-info-value",children:Hi(p.period_start,p.period_end)})]})]}),p.scope_of_work&&e.jsxs("div",{className:"cor-scope",children:[e.jsx("h4",{children:"Scope of Work"}),e.jsx("p",{children:p.scope_of_work})]})]}),p.change_order_labor?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(rn,{size:18}),e.jsx("h4",{children:"Labor"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{className:"text-right",children:"Reg Hrs"}),e.jsx("th",{className:"text-right",children:"Reg Rate"}),e.jsx("th",{className:"text-right",children:"OT Hrs"}),e.jsx("th",{className:"text-right",children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:p.change_order_labor.map((C,de)=>e.jsxs("tr",{children:[e.jsx("td",{children:C.labor_class}),e.jsx("td",{children:C.wage_type}),e.jsx("td",{className:"text-right",children:C.regular_hours}),e.jsxs("td",{className:"text-right",children:["$",xa(C.regular_rate),"/hr"]}),e.jsx("td",{className:"text-right",children:C.overtime_hours||"-"}),e.jsx("td",{className:"text-right",children:C.overtime_hours?`$${xa(C.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:Ee(C.total)})]},de))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ee($.labor_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"5",className:"text-right",children:["+ ",Rt(p.labor_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ee($.labor_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"5",className:"text-right",children:e.jsx("strong",{children:"Labor Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ee($.labor_subtotal+$.labor_markup_amount)})})]})]})]})})]}),p.change_order_materials?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(ls,{size:18}),e.jsx("h4",{children:"Materials"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:p.change_order_materials.map((C,de)=>e.jsxs("tr",{children:[e.jsx("td",{children:C.description}),e.jsx("td",{children:C.source_reference||C.source_type}),e.jsx("td",{className:"text-right",children:C.quantity}),e.jsx("td",{children:C.unit}),e.jsxs("td",{className:"text-right",children:["$",xa(C.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ee(C.total)})]},de))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ee($.materials_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",Rt(p.materials_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ee($.materials_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Materials Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ee($.materials_subtotal+$.materials_markup_amount)})})]})]})]})})]}),p.change_order_equipment?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(qn,{size:18}),e.jsx("h4",{children:"Equipment"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:p.change_order_equipment.map((C,de)=>e.jsxs("tr",{children:[e.jsx("td",{children:C.description}),e.jsx("td",{children:C.source_reference||C.source_type}),e.jsx("td",{className:"text-right",children:C.quantity}),e.jsx("td",{children:C.unit}),e.jsxs("td",{className:"text-right",children:["$",xa(C.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ee(C.total)})]},de))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ee($.equipment_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",Rt(p.equipment_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ee($.equipment_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Equipment Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ee($.equipment_subtotal+$.equipment_markup_amount)})})]})]})]})})]}),p.change_order_subcontractors?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Mn,{size:18}),e.jsx("h4",{children:"Subcontractors"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:p.change_order_subcontractors.map((C,de)=>e.jsxs("tr",{children:[e.jsx("td",{children:C.company_name}),e.jsx("td",{children:C.description}),e.jsx("td",{children:C.source_reference||C.source_type}),e.jsx("td",{className:"text-right",children:Ee(C.total)})]},de))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ee($.subcontractors_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"2",className:"text-right",children:["+ ",Rt(p.subcontractors_markup_percent||500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ee($.subcontractors_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"2",className:"text-right",children:e.jsx("strong",{children:"Subcontractors Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ee($.subcontractors_subtotal+$.subcontractors_markup_amount)})})]})]})]})})]}),M.length>0&&e.jsxs("div",{className:"cor-section cor-backup-section",children:[e.jsxs("div",{className:"cor-section-header cor-backup-header",onClick:()=>ne(!ee),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"backup-header-left",children:[e.jsx(Ua,{size:18}),e.jsx("h4",{children:"Supporting T&M Documentation"}),e.jsxs("span",{className:"backup-count",children:[M.length," ticket",M.length!==1?"s":""]})]}),e.jsx("div",{className:"backup-header-toggle",children:ee?e.jsx(_a,{size:20}):e.jsx(Es,{size:20})})]}),ee&&e.jsx("div",{className:"backup-tickets-list",children:M.map((C,de)=>{const _e=Q.has(C.id),ze=C.t_and_m_workers?.reduce((re,qe)=>re+(parseFloat(qe.hours)||0)+(parseFloat(qe.overtime_hours)||0),0)||0;return e.jsxs("div",{className:"backup-ticket",children:[e.jsxs("div",{className:"backup-ticket-header",onClick:()=>{const re=new Set(Q);_e?re.delete(C.id):re.add(C.id),z(re)},children:[e.jsxs("div",{className:"backup-ticket-info",children:[e.jsx("span",{className:"backup-ticket-date",children:gr(C.work_date)}),C.ce_pco_number&&e.jsx("span",{className:"backup-ticket-ce",children:C.ce_pco_number}),e.jsxs("span",{className:"backup-ticket-summary",children:[C.t_and_m_workers?.length||0," workers  ",ze," hrs",C.photos?.length>0&&`  ${C.photos.length} photos`]})]}),e.jsx("div",{className:"backup-ticket-toggle",children:_e?e.jsx(_a,{size:16}):e.jsx(Es,{size:16})})]}),_e&&e.jsxs("div",{className:"backup-ticket-details",children:[C.t_and_m_workers?.length>0&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsxs("div",{className:"backup-detail-label",children:[e.jsx(ua,{size:14})," Workers"]}),e.jsx("div",{className:"backup-workers-list",children:C.t_and_m_workers.map((re,qe)=>e.jsxs("div",{className:"backup-worker",children:[e.jsxs("span",{className:"worker-name",children:[re.role&&re.role!=="Laborer"&&e.jsx("span",{className:"worker-role",children:re.role}),re.name]}),e.jsxs("span",{className:"worker-hours",children:[re.hours||0," hrs",parseFloat(re.overtime_hours)>0&&e.jsxs("span",{className:"worker-ot",children:[" + ",re.overtime_hours," OT"]})]})]},qe))})]}),C.notes&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsx("div",{className:"backup-detail-label",children:"Description"}),e.jsx("p",{className:"backup-notes",children:C.notes})]}),C.photos?.length>0&&e.jsxs("div",{className:"backup-detail-group",children:[e.jsxs("div",{className:"backup-detail-label",children:[e.jsx(xr,{size:14})," Photos (",C.photos.length,")"]}),e.jsx("div",{className:"backup-photos-grid",children:C.photos.map((re,qe)=>e.jsx("a",{href:re,target:"_blank",rel:"noopener noreferrer",className:"backup-photo",children:e.jsx("img",{src:re,alt:`Photo ${qe+1}`,onError:Ve=>{Ve.target.onerror=null,Ve.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiI+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=="}})},qe))})]})]})]},C.id)})}),e.jsxs("div",{className:"backup-note",children:[e.jsx(An,{size:14}),e.jsx("span",{children:"This documentation supports the work described in this Change Order Request."})]})]}),e.jsxs("div",{className:"cor-totals-card",children:[e.jsx("h4",{children:"COR Summary"}),e.jsxs("div",{className:"cor-totals-grid",children:[e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Ee($.cor_subtotal)})]}),e.jsxs("div",{className:"cor-fees-section",children:[e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Liability Insurance (",Rt(p.liability_insurance_percent||144),")"]}),e.jsx("span",{children:Ee($.liability_insurance_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Bond (",Rt(p.bond_percent||100),")"]}),e.jsx("span",{children:Ee($.bond_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["City License Fee (",Rt(p.license_fee_percent||10),")"]}),e.jsx("span",{children:Ee($.license_fee_amount)})]})]}),e.jsxs("div",{className:"cor-grand-total",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:Ee($.cor_total)})]})]})]}),e.jsxs("div",{className:"cor-signature-section",children:[e.jsx("h4",{children:"Authorization"}),e.jsx("p",{className:"signature-instruction",children:"By signing below, you authorize the above change order request and agree to the terms and costs outlined."}),e.jsxs("div",{className:"signature-slots-grid",children:[e.jsxs("div",{className:`signature-slot-card ${D?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[D?e.jsx(ns,{size:20,className:"status-icon signed"}):e.jsx(Tn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Signature 1  GC Authorization"})]}),D?e.jsxs("div",{className:"slot-signed-info",children:[D.signature_data&&e.jsx("img",{src:D.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:D.signer_name}),(D.signer_title||D.signer_company)&&e.jsxs("span",{className:"signer-org",children:[D.signer_title,D.signer_title&&D.signer_company&&"  ",D.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",gr(D.signed_at)]})]}):e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>w(1),disabled:U,children:"Sign as GC"})]}),e.jsxs("div",{className:`signature-slot-card ${V?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[V?e.jsx(ns,{size:20,className:"status-icon signed"}):e.jsx(Tn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Signature 2  Client Authorization"})]}),V?e.jsxs("div",{className:"slot-signed-info",children:[V.signature_data&&e.jsx("img",{src:V.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:V.signer_name}),(V.signer_title||V.signer_company)&&e.jsxs("span",{className:"signer-org",children:[V.signer_title,V.signer_title&&V.signer_company&&"  ",V.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",gr(V.signed_at)]})]}):e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>w(2),disabled:U,children:"Sign as Client"})]})]}),fe&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(ns,{size:24}),e.jsx("p",{children:"This change order request has been fully signed by all parties."})]}),fe&&e.jsxs("div",{className:"cor-download-section",children:[e.jsx("h4",{children:"Download Your Copy"}),e.jsx("p",{className:"download-description",children:"Download a PDF copy of this signed COR including all T&M backup documentation."}),e.jsx("button",{className:"btn btn-primary download-btn",onClick:ae,disabled:W,children:W?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"download-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ep,{size:18}),"Download COR + Backup"]})})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),y&&T&&e.jsx(Uf,{slot:T,documentType:u.document_type,documentTitle:`${p.cor_number} - ${p.title}`,onSave:_,onClose:()=>{g(!1),B(null)}})]})}function Lf(r,l,o,c,m){return e.jsxs("div",{className:`signature-slot-card ${l?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[l?e.jsx(ns,{size:20,className:"status-icon signed"}):e.jsx(Tn,{size:20,className:"status-icon pending"}),e.jsxs("span",{className:"slot-label",children:["Signature ",r,"  ",o]})]}),l?e.jsxs("div",{className:"slot-signed-info",children:[e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:l.signer_name}),(l.signer_title||l.signer_company)&&e.jsxs("span",{className:"signer-org",children:[l.signer_title,l.signer_title&&l.signer_company&&"  ",l.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",gr(l.signed_at)]})]}):e.jsxs("button",{className:"btn btn-primary sign-btn",onClick:()=>c(r),disabled:m,children:["Sign as ",r===1?"GC":"Client"]})]})}const hd=[{value:"member",label:"Member",icon:op,description:"Standard access to projects"},{value:"administrator",label:"Administrator",icon:Li,description:"Full control, can manage team"}],Hf=[{value:"Project Manager",label:"Project Manager"},{value:"Superintendent",label:"Superintendent"},{value:"Job Costing",label:"Job Costing"},{value:"Accounting",label:"Accounting"}];function Ay({company:r,user:l,onShowToast:o}){const[c,m]=f.useState("pending"),[u,j]=f.useState([]),[p,x]=f.useState(!0),[y,g]=f.useState(null),[T,B]=f.useState({}),[U,F]=f.useState({});f.useEffect(()=>{r?.id&&L()},[r?.id]);const L=async()=>{try{x(!0);const S=await se.getCompanyMemberships(r.id);j(S)}catch(S){console.error("Error loading members:",S),o("Error loading team members","error")}finally{x(!1)}},J=async S=>{const v=U[S.id];if(!v){o("Please select a role for this member","error");return}try{g(S.id);const _=T[S.id]||"member";await se.approveMembershipWithRole(S.id,l.id,_),await se.updateMemberCompanyRole(S.id,v),o(`${S.users?.name||S.users?.email} approved as ${v}`,"success"),B(w=>{const ae={...w};return delete ae[S.id],ae}),F(w=>{const ae={...w};return delete ae[S.id],ae}),L()}catch(_){console.error("Error approving membership:",_),o("Error approving request","error")}finally{g(null)}},W=(S,v)=>{B(_=>({..._,[S]:v}))},N=(S,v)=>{F(_=>({..._,[S]:v}))},M=async(S,v)=>{try{g(S.id),await se.updateMemberCompanyRole(S.id,v),o(`${S.users?.name||"User"} role updated to ${v}`,"success"),L()}catch(_){console.error("Error updating company role:",_),o("Error updating role","error")}finally{g(null)}},A=async(S,v)=>{if(S.users?.id===l.id&&v!=="administrator"){o("You cannot demote yourself","error");return}try{g(S.id),await se.updateMemberAccessLevel(S.id,v);const _=hd.find(w=>w.value===v)?.label||v;o(`${S.users?.name||"User"} is now ${_}`,"success"),L()}catch(_){console.error("Error updating access level:",_),o("Error updating access level","error")}finally{g(null)}},ee=async S=>{try{g(S.id),await se.rejectMembership(S.id),o("Request rejected","success"),L()}catch(v){console.error("Error rejecting membership:",v),o("Error rejecting request","error")}finally{g(null)}},ne=async S=>{if(S.users?.id===l.id){o("You cannot remove yourself","error");return}try{g(S.id),await se.removeMember(S.id,l.id),o(`${S.users?.name||S.users?.email} removed`,"success"),L()}catch(v){console.error("Error removing member:",v),o("Error removing member","error")}finally{g(null)}},Q=u.filter(S=>c==="all"?!0:S.status===c),z=u.filter(S=>S.status==="pending").length,H=u.filter(S=>S.status==="active").length,$=u.filter(S=>S.status==="removed").length;return p?e.jsx("div",{className:"membership-manager",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading team members..."]})}):e.jsxs("div",{className:"membership-manager",children:[e.jsxs("div",{className:"membership-header",children:[e.jsxs("h2",{children:[e.jsx(rn,{size:24})," Team Members"]}),e.jsxs("p",{className:"membership-subtitle",children:["Manage who has access to ",r?.name]})]}),z>0&&e.jsxs("div",{className:"pending-alert",children:[e.jsx(pl,{size:20}),e.jsxs("span",{children:[z," pending request",z>1?"s":""," awaiting approval"]})]}),e.jsxs("div",{className:"tm-filter-tabs",children:[e.jsxs("button",{className:`tm-filter-tab ${c==="pending"?"active":""}`,onClick:()=>m("pending"),children:["Pending",e.jsx("span",{className:"tm-filter-count",children:z})]}),e.jsxs("button",{className:`tm-filter-tab ${c==="active"?"active":""}`,onClick:()=>m("active"),children:["Active",e.jsx("span",{className:"tm-filter-count",children:H})]}),e.jsxs("button",{className:`tm-filter-tab ${c==="removed"?"active":""}`,onClick:()=>m("removed"),children:["Removed",e.jsx("span",{className:"tm-filter-count",children:$})]})]}),e.jsx("div",{className:"member-list",children:Q.length===0?e.jsxs("div",{className:"member-empty",children:[c==="pending"&&"No pending requests",c==="active"&&"No active members",c==="removed"&&"No removed members"]}):Q.map(S=>e.jsxs("div",{className:`member-card ${S.status}`,children:[e.jsxs("div",{className:"member-info",children:[e.jsxs("div",{className:"member-name",children:[S.users?.name||"Unknown",S.users?.id===l.id&&e.jsx("span",{className:"member-you",children:"(You)"})]}),e.jsx("div",{className:"member-email",children:S.users?.email}),e.jsxs("div",{className:"member-meta",children:[S.status==="pending"&&e.jsxs(e.Fragment,{children:["Requested ",new Date(S.created_at).toLocaleDateString()]}),S.status==="active"&&S.approved_at&&e.jsxs(e.Fragment,{children:["Approved ",new Date(S.approved_at).toLocaleDateString()]}),S.status==="active"&&!S.approved_at&&e.jsxs(e.Fragment,{children:["Member since ",new Date(S.created_at).toLocaleDateString()]}),S.status==="removed"&&S.removed_at&&e.jsxs(e.Fragment,{children:["Removed ",new Date(S.removed_at).toLocaleDateString()]})]}),S.status==="active"&&e.jsxs("div",{className:"member-badges",children:[S.access_level==="administrator"?e.jsxs("span",{className:"access-badge admin",children:[e.jsx(Li,{size:12})," Administrator"]}):e.jsxs("span",{className:"access-badge member",children:[e.jsx(op,{size:12})," Member"]}),S.company_role&&e.jsxs("span",{className:"access-badge role",children:[e.jsx(Mn,{size:12})," ",S.company_role]})]})]}),e.jsxs("div",{className:"member-actions",children:[S.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"role-selector",children:[e.jsxs("select",{value:U[S.id]||"",onChange:v=>N(S.id,v.target.value),disabled:y===S.id,className:"role-select",children:[e.jsx("option",{value:"",children:"Select Role..."}),Hf.map(v=>e.jsx("option",{value:v.value,children:v.label},v.value))]}),e.jsx(_a,{size:14,className:"role-select-icon"})]}),e.jsxs("div",{className:"role-selector",children:[e.jsx("select",{value:T[S.id]||"member",onChange:v=>W(S.id,v.target.value),disabled:y===S.id,className:"role-select",children:hd.map(v=>e.jsx("option",{value:v.value,children:v.label},v.value))}),e.jsx(_a,{size:14,className:"role-select-icon"})]}),e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>J(S),disabled:y===S.id,children:y===S.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(ip,{size:16})," Approve"]})}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>ee(S),disabled:y===S.id,children:y===S.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(Cv,{size:16})," Reject"]})})]}),S.status==="active"&&S.users?.id!==l.id&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"role-selector",children:[e.jsxs("select",{value:S.company_role||"",onChange:v=>M(S,v.target.value),disabled:y===S.id,className:"role-select",children:[e.jsx("option",{value:"",children:"No Role"}),Hf.map(v=>e.jsx("option",{value:v.value,children:v.label},v.value))]}),e.jsx(_a,{size:14,className:"role-select-icon"})]}),e.jsxs("div",{className:"role-selector",children:[e.jsx("select",{value:S.access_level||"member",onChange:v=>A(S,v.target.value),disabled:y===S.id,className:"role-select",children:hd.map(v=>e.jsx("option",{value:v.value,children:v.label},v.value))}),e.jsx(_a,{size:14,className:"role-select-icon"})]}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>ne(S),disabled:y===S.id,children:y===S.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(cp,{size:16})," Remove"]})})]})]})]},S.id))})]})}function Ty({company:r,projects:l,userId:o,onNotificationClick:c,onShowToast:m}){const[u,j]=f.useState([]),[p,x]=f.useState(0),[y,g]=f.useState(!1),[T,B]=f.useState(!1),[U,F]=f.useState({}),L=f.useRef(null);f.useRef(null);const J=f.useRef(null);f.useEffect(()=>{o&&W()},[o]);const W=async()=>{try{const v=await se.getUserNotificationPreferences(o),_={};v.forEach(w=>{_[w.project_id]=w.notification_types||[]}),F(_)}catch(v){console.error("Error loading user preferences:",v)}},N=(v,_)=>U[v]?U[v].length===0?!1:U[v].includes(_):!0;f.useEffect(()=>{if(!r?.id||!l||l.length===0)return;M();const v=A();return()=>{v&&se.unsubscribe(v)}},[r?.id,l,U]),f.useEffect(()=>()=>{J.current&&(J.current.close().catch(()=>{}),J.current=null)},[]),f.useEffect(()=>{function v(_){L.current&&!L.current.contains(_.target)&&g(!1)}return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[]);const M=async()=>{if(!l||l.length===0)return;const v=[];for(const _ of l)try{N(_.id,"message")&&(await se.getMessages(_.id,20)).filter(D=>D.sender_type==="field"&&!D.is_read).forEach(D=>{v.push({id:`msg-${D.id}`,type:"message",title:"New Message",message:D.message?.slice(0,50)+(D.message?.length>50?"...":""),projectId:_.id,projectName:_.name,senderName:D.sender_name,createdAt:D.created_at,isRead:D.is_read,data:D})}),N(_.id,"material_request")&&(await se.getMaterialRequests(_.id,"pending")).forEach(ae=>{v.push({id:`req-${ae.id}`,type:"material_request",title:"Material Request",message:`${ae.items?.length||0} items requested`,projectId:_.id,projectName:_.name,senderName:ae.requested_by,priority:ae.priority,createdAt:ae.created_at,isRead:!1,data:ae})})}catch(w){console.error("Error loading notifications for project:",_.id,w)}try{(await se.getCompanyInjuryReports(r.id,"open")).slice(0,5).forEach(w=>{if(N(w.project_id,"injury_report")){const ae=l.find(D=>D.id===w.project_id);v.push({id:`injury-${w.id}`,type:"injury_report",title:"Safety Report",message:`${w.injury_type} - ${w.injured_person_name}`,projectId:w.project_id,projectName:ae?.name||"Unknown Project",senderName:w.reported_by_name,createdAt:w.created_at,isRead:w.status!=="open",data:w})}})}catch(_){console.error("Error loading injury reports:",_)}v.sort((_,w)=>new Date(w.createdAt)-new Date(_.createdAt)),j(v.slice(0,50)),x(v.filter(_=>!_.isRead).length)},A=()=>{if(!r?.id||!l||l.length===0)return null;const v=l.map(w=>w.id),_=se.subscribeToCompanyActivity(r.id,v,{onMessage:w=>{if(w.new?.sender_type==="field"){if(!N(w.new.project_id,"message"))return;ee({id:`msg-${w.new.id}`,type:"message",title:"New Message",message:w.new.message?.slice(0,50)+(w.new.message?.length>50?"...":""),projectId:w.new.project_id,projectName:l.find(ae=>ae.id===w.new.project_id)?.name||"Project",senderName:w.new.sender_name,createdAt:w.new.created_at,isRead:!1,data:w.new})}},onMaterialRequest:w=>{N(w.new.project_id,"material_request")&&ee({id:`req-${w.new.id}`,type:"material_request",title:"Material Request",message:`${w.new.items?.length||0} items requested`,projectId:w.new.project_id,projectName:l.find(ae=>ae.id===w.new.project_id)?.name||"Project",senderName:w.new.requested_by,priority:w.new.priority,createdAt:w.new.created_at,isRead:!1,data:w.new})},onTMTicket:w=>{if(w.eventType==="INSERT"){if(!N(w.new.project_id,"tm_ticket"))return;ee({id:`tm-${w.new.id}`,type:"tm_ticket",title:"New T&M Ticket",message:`Submitted by ${w.new.created_by_name||"Field"}`,projectId:w.new.project_id,projectName:l.find(ae=>ae.id===w.new.project_id)?.name||"Project",senderName:w.new.created_by_name,createdAt:w.new.created_at,isRead:!1,data:w.new})}},onInjuryReport:w=>{N(w.new.project_id,"injury_report")&&ee({id:`injury-${w.new.id}`,type:"injury_report",title:"Safety Report",message:`${w.new.injury_type} - ${w.new.injured_person_name}`,projectId:w.new.project_id,projectName:l.find(ae=>ae.id===w.new.project_id)?.name||"Project",senderName:w.new.reported_by_name,createdAt:w.new.created_at,isRead:!1,data:w.new})}});return _&&B(!0),_},ee=v=>{j(w=>[v,...w.slice(0,49)]),x(w=>w+1),ne();const _=Q(v.type);m?.(`${_} ${v.title}: ${v.message}`,"info")},ne=()=>{try{(!J.current||J.current.state==="closed")&&(J.current=new(window.AudioContext||window.webkitAudioContext));const v=J.current;v.state==="suspended"&&v.resume();const _=v.createOscillator(),w=v.createGain();_.connect(w),w.connect(v.destination),_.frequency.value=800,_.type="sine",w.gain.value=.3,_.start(),_.stop(v.currentTime+.15),setTimeout(()=>{if(!J.current||J.current.state==="closed")return;const ae=J.current.createOscillator(),D=J.current.createGain();ae.connect(D),D.connect(J.current.destination),ae.frequency.value=1e3,ae.type="sine",D.gain.value=.3,ae.start(),ae.stop(J.current.currentTime+.15)},150)}catch{}},Q=v=>{switch(v){case"message":return e.jsx(Cs,{size:16});case"material_request":return e.jsx(ls,{size:16});case"injury_report":return e.jsx(An,{size:16});case"tm_ticket":return e.jsx(Xa,{size:16});default:return e.jsx(tj,{size:16})}},z=v=>{switch(v){case"message":return"blue";case"material_request":return"orange";case"injury_report":return"red";case"tm_ticket":return"green";default:return"gray"}},H=v=>{j(_=>_.map(w=>w.id===v.id?{...w,isRead:!0}:w)),x(_=>Math.max(0,_-1)),g(!1),c?.(v)},$=async()=>{for(const v of l)try{await se.markMessagesRead(v.id,"office")}catch{}j(v=>v.map(_=>({..._,isRead:!0}))),x(0)},S=v=>{const _=new Date(v),ae=new Date-_,D=Math.floor(ae/6e4),V=Math.floor(ae/36e5),k=Math.floor(ae/864e5);return D<1?"Just now":D<60?`${D}m ago`:V<24?`${V}h ago`:k<7?`${k}d ago`:_.toLocaleDateString()};return e.jsxs("div",{className:"notification-center",ref:L,children:[e.jsxs("button",{className:`notification-bell ${p>0?"has-notifications":""}`,onClick:()=>g(!y),title:`${p} unread notifications`,children:[e.jsx("span",{className:"bell-icon",children:""}),p>0&&e.jsx("span",{className:"notification-badge",children:p>99?"99+":p}),T&&e.jsx("span",{className:"connection-dot"})]}),y&&e.jsxs("div",{className:"notification-dropdown",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h4",{children:"Notifications"}),p>0&&e.jsx("button",{className:"mark-all-read",onClick:$,children:"Mark all read"})]}),e.jsx("div",{className:"notification-list",children:u.length===0?e.jsxs("div",{className:"notification-empty",children:[e.jsx("span",{className:"empty-icon",children:""}),e.jsx("p",{children:"No notifications yet"}),e.jsx("small",{children:"You'll see updates from the field here"})]}):u.map(v=>e.jsxs("div",{className:`notification-item ${v.isRead?"read":"unread"} ${z(v.type)}`,onClick:()=>H(v),children:[e.jsx("div",{className:"notification-icon",children:Q(v.type)}),e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"notification-title",children:[v.title,v.priority==="urgent"&&e.jsx("span",{className:"priority-badge urgent",children:"URGENT"})]}),e.jsx("div",{className:"notification-message",children:v.message}),e.jsxs("div",{className:"notification-meta",children:[e.jsx("span",{className:"notification-project",children:v.projectName}),e.jsx("span",{className:"notification-time",children:S(v.createdAt)})]})]}),!v.isRead&&e.jsx("div",{className:"unread-dot"})]},v.id))}),u.length>0&&e.jsx("div",{className:"notification-footer",children:e.jsx("button",{className:"view-all-btn",onClick:()=>{g(!1),c?.({type:"view_all"})},children:"View All Activity"})})]})]})}class pr extends f.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0}}componentDidCatch(l,o){this.setState({error:l,errorInfo:o}),console.error("ErrorBoundary caught an error:",l,o)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("div",{className:"error-icon",children:e.jsx(pl,{size:48})}),e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),e.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function Bf(){const[r,l]=f.useState(ml()),[o,c]=f.useState(0),[m,u]=f.useState(!1),[j,p]=f.useState(!1);return f.useEffect(()=>{const x=Qf(async g=>{l(g),g&&j&&(u(!0),setTimeout(()=>u(!1),3e3)),g||p(!0);const T=await Wo();c(T)});Wo().then(c);const y=setInterval(async()=>{if(!ml()){const g=await Wo();c(g)}},5e3);return()=>{x(),clearInterval(y)}},[j]),r&&o===0&&!m?null:e.jsxs("div",{className:`offline-indicator ${r?"online":"offline"} ${m?"synced":""}`,children:[e.jsx("div",{className:"offline-indicator-content",children:r?m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"online-icon",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):o>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"syncing-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),e.jsxs("span",{className:"offline-text",children:["Syncing ",o,"..."]})]}):null:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"offline-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),e.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),e.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),e.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),e.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),e.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),e.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),e.jsxs("span",{className:"offline-text",children:["Offline",o>0&&e.jsxs("span",{className:"pending-badge",children:[o," pending"]})]})]})}),e.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function Ry(){const[r,l]=f.useState("entry"),[o,c]=f.useState(null),[m,u]=f.useState(null),[j,p]=f.useState([]),[x,y]=f.useState([]),[g,T]=f.useState(null),[B,U]=f.useState(null),[F,L]=f.useState(null),[J,W]=f.useState(!0),[N,M]=f.useState("dashboard"),[A,ee]=f.useState(null),[ne,Q]=f.useState(!1),[z,H]=f.useState(null),[$,S]=f.useState(0);f.useEffect(()=>{const re=window.location.pathname,qe=re.match(/^\/view\/([a-zA-Z0-9_-]+)$/),Ve=re.match(/^\/sign\/([a-zA-Z0-9_-]+)$/);qe?(U(qe[1]),l("public"),W(!1)):Ve?(L(Ve[1]),l("signature"),W(!1)):v()},[]);const v=async()=>{try{const{data:{user:re}}=await R.auth.getUser();if(!re){W(!1);return}const{data:qe,error:Ve}=await R.from("users").select("*").eq("id",re.id).single();if(qe){c(qe);let Oe=await se.getUserCompanies(re.id);if(Oe.length===0&&qe.company_id&&(console.log("Legacy user detected, attempting repair..."),await se.repairLegacyUser(re.id,qe.company_id,qe.role||"member")&&(Oe=await se.getUserCompanies(re.id),console.log("Legacy user repaired, companies:",Oe.length))),p(Oe),Oe.length===0){if(await se.getUserPendingMemberships(re.id)>0){l("pending");return}k("No company access. Join a company to continue.","error"),await gf.signOut();return}const nt=localStorage.getItem("selectedCompanyId");let zt=null;if(nt&&Oe.find(tt=>tt.id===nt)?zt=Oe.find(tt=>tt.id===nt):Oe.length>0&&(zt=Oe[0]),zt){const{data:tt}=await R.from("companies").select("*").eq("id",zt.id).single();u(tt),l("office")}}}catch(re){console.error("Auth check error:",re)}finally{W(!1)}},_=re=>{T(re),l("foreman")},w=async(re,qe)=>{try{const{data:Ve,error:Oe}=await R.auth.signInWithPassword({email:re,password:qe});if(Oe){k(Oe.message||"Invalid credentials","error");return}const{data:nt,error:zt}=await R.from("users").select("*").eq("id",Ve.user.id).single();if(zt){console.error("User fetch error:",zt),k("Error loading profile","error");return}if(nt){c(nt);let tt=await se.getUserCompanies(Ve.user.id);tt.length===0&&nt.company_id&&(console.log("Legacy user detected on login, attempting repair..."),await se.repairLegacyUser(Ve.user.id,nt.company_id,nt.role||"member")&&(tt=await se.getUserCompanies(Ve.user.id),console.log("Legacy user repaired on login, companies:",tt.length))),p(tt);const ot=localStorage.getItem("selectedCompanyId");let St=null;if(ot&&tt.find(rt=>rt.id===ot)?St=tt.find(rt=>rt.id===ot):tt.length>0&&(St=tt[0]),St){const{data:rt}=await R.from("companies").select("*").eq("id",St.id).single();u(rt),l("office")}else await se.getUserPendingMemberships(Ve.user.id)>0?l("pending"):k("No company access. Please contact admin.","error")}else k("Profile not found. Please contact admin.","error")}catch(Ve){console.error("Login error:",Ve),k("Login failed","error")}},ae=async re=>{try{const{data:qe}=await R.from("companies").select("*").eq("id",re).single();qe&&(u(qe),localStorage.setItem("selectedCompanyId",re),Q(!1),M("dashboard"),k(`Switched to ${qe.name}`,"success"))}catch(qe){console.error("Switch company error:",qe),k("Error switching company","error")}},D=async()=>{try{await gf.signOut(),c(null),u(null),p([]),l("entry"),M("dashboard"),localStorage.removeItem("selectedCompanyId")}catch(re){console.error("Logout error:",re),k("Error signing out","error")}},V=()=>{T(null),l("entry")},k=(re,qe="")=>{ee({message:re,type:qe})},fe=()=>{M("dashboard"),m?.id&&Y()},Y=async()=>{if(m?.id)try{const re=await se.getProjects(m.id);y(re)}catch(re){console.error("Error loading projects:",re)}};f.useEffect(()=>{m?.id&&r==="office"&&(Y(),I())},[m?.id,r]);const I=async()=>{if(m?.id)try{const qe=(await se.getCompanyMemberships(m.id)).filter(Ve=>Ve.status==="pending").length;S(qe)}catch(re){console.error("Error loading pending count:",re)}},X=re=>{if(re.type==="view_all"){M("dashboard"),H(null);return}M("dashboard"),re.projectId&&H(re.projectId)},C=()=>{H(null)};if(J)return e.jsx(Cn,{children:e.jsx(Sn,{companyId:m?.id,children:e.jsxs("div",{className:"loading-screen",children:[e.jsx(Wa,{className:"loading-logo"}),e.jsx("div",{className:"spinner"})]})})});if(r==="entry")return e.jsx(Cn,{children:e.jsxs(Sn,{children:[e.jsx(pr,{children:e.jsx(Av,{onForemanAccess:_,onOfficeLogin:w,onShowToast:k})}),A&&e.jsx(Ss,{message:A.message,type:A.type,onClose:()=>ee(null)})]})});if(r==="public"&&B)return e.jsx(Cn,{children:e.jsxs(Sn,{children:[e.jsx(pr,{children:e.jsx(Ey,{shareToken:B})}),A&&e.jsx(Ss,{message:A.message,type:A.type,onClose:()=>ee(null)})]})});if(r==="signature"&&F)return e.jsx(Cn,{children:e.jsxs(Sn,{children:[e.jsx(pr,{children:e.jsx(My,{signatureToken:F})}),A&&e.jsx(Ss,{message:A.message,type:A.type,onClose:()=>ee(null)})]})});if(r==="pending")return e.jsx(Cn,{children:e.jsxs(Sn,{children:[e.jsx(pr,{children:e.jsxs("div",{className:"pending-approval-screen",children:[e.jsx(Wa,{className:"pending-logo"}),e.jsx("h2",{children:"Awaiting Approval"}),e.jsx("p",{children:"Your membership request has been submitted."}),e.jsx("p",{children:"A company admin will review your request."}),e.jsxs("div",{className:"pending-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:D,children:"Sign Out"}),e.jsx("button",{className:"btn btn-primary",onClick:v,children:"Check Status"})]})]})}),A&&e.jsx(Ss,{message:A.message,type:A.type,onClose:()=>ee(null)})]})});if(r==="foreman"&&g)return e.jsx(Cn,{children:e.jsxs(Sn,{companyId:g.company_id,children:[e.jsx(pr,{children:e.jsx(Yv,{project:g,companyId:g.company_id,onShowToast:k,onExit:V})}),e.jsx(Bf,{}),A&&e.jsx(Ss,{message:A.message,type:A.type,onClose:()=>ee(null)})]})});const ze=j.find(re=>re.id===m?.id)?.access_level==="administrator"||m?.owner_user_id===o?.id;return e.jsx(Cn,{children:e.jsx(Sn,{companyId:m?.id,children:e.jsxs("div",{children:[!G&&e.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),e.jsx("nav",{className:"nav",children:e.jsxs("div",{className:"nav-content",children:[e.jsx(Wa,{}),e.jsxs("div",{className:"nav-tabs",children:[e.jsx("button",{className:`nav-tab ${N==="dashboard"?"active":""}`,onClick:()=>M("dashboard"),children:"Dashboard"}),e.jsx("button",{className:`nav-tab ${N==="setup"?"active":""}`,onClick:()=>M("setup"),children:"+ New Project"}),e.jsx("button",{className:`nav-tab ${N==="pricing"?"active":""}`,onClick:()=>M("pricing"),children:"Pricing"}),ze&&e.jsx("button",{className:`nav-tab ${N==="branding"?"active":""}`,onClick:()=>M("branding"),children:"Branding"}),ze&&e.jsxs("button",{className:`nav-tab ${N==="team"?"active":""}`,onClick:()=>M("team"),children:["Team",$>0&&e.jsx("span",{className:"nav-tab-badge",children:$})]})]}),e.jsxs("div",{className:"nav-user",children:[e.jsx(hp,{compact:!0}),e.jsx(Ty,{company:m,projects:x,userId:o?.id,onNotificationClick:X,onShowToast:k}),j.length>1&&e.jsxs("div",{className:"company-switcher",children:[e.jsxs("button",{className:"company-switcher-btn",onClick:()=>Q(!ne),children:[m?.name||"Select Company",e.jsx("span",{className:"switcher-arrow",children:""})]}),ne&&e.jsx("div",{className:"company-dropdown",children:j.map(re=>e.jsxs("button",{className:`company-option ${re.id===m?.id?"active":""}`,onClick:()=>ae(re.id),children:[re.name,re.id===m?.id&&e.jsx("span",{className:"check",children:""})]},re.id))})]}),j.length<=1&&m&&e.jsx("span",{className:"nav-company-name",children:m.name}),e.jsx("span",{className:"nav-user-name",children:o?.name||o?.email}),e.jsx("button",{className:"nav-logout",onClick:D,children:"Sign Out"})]})]})}),e.jsx(pr,{children:e.jsxs("div",{className:"container",children:[N==="dashboard"&&e.jsx(jy,{company:m,user:o,isAdmin:ze,onShowToast:k,navigateToProjectId:z,onProjectNavigated:C}),N==="setup"&&e.jsx(yy,{company:m,user:o,onProjectCreated:fe,onShowToast:k}),N==="pricing"&&e.jsx(ky,{company:m,onShowToast:k}),N==="branding"&&e.jsx(by,{company:m,onShowToast:k}),N==="team"&&ze&&e.jsx(Ay,{company:m,user:o,onShowToast:k})]},m?.id)}),e.jsx(Bf,{}),A&&e.jsx(Ss,{message:A.message,type:A.type,onClose:()=>ee(null)})]})})})}zx.createRoot(document.getElementById("root")).render(e.jsx(Dx.StrictMode,{children:e.jsx(Ry,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(r=>{console.log("SW registered:",r.scope),setInterval(()=>{r.update()},6e4)}).catch(r=>{console.log("SW registration failed:",r)})});
