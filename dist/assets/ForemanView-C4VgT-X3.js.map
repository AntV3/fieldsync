{"version":3,"mappings":"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;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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","names":["CATEGORIES","TRANSLATIONS","createT","lang","key","WorkDetailsStep","project","workDate","setWorkDate","cePcoNumber","setCePcoNumber","notes","setNotes","t","_lang","jsxs","jsx","e","FileText","getWorkerState","worker","hasName","hasHours","calculateHoursFromTimeRange","startTime","endTime","startHour","startMin","endHour","endMin","totalMinutes","totalHours","regularHours","overtimeHours","WorkerRow","index","onUpdate","onRemove","roleSelect","workerState","Check","BatchHoursModal","batchHours","setBatchHours","namedWorkerCount","onApply","onClose","applyTimePreset","preset","timeStarted","timeEnded","hours","Clock","newStart","calculated","newEnd","CrewHoursStep","supervision","operators","laborers","dynamicWorkers","activeLaborClassIds","_setActiveLaborClassIds","laborCategories","laborClasses","hasCustomLaborClasses","loadingLaborClasses","todaysCrew","showBatchHoursModal","setShowBatchHoursModal","loadingPreviousCrew","namedWorkers","workersNeedingHours","totalRegHours","totalOTHours","onLoadPreviousCrew","onApplyBatchHours","onApplyInlinePreset","onAddCrewWorker","onActivateLaborClass","onDeactivateLaborClass","addSupervision","updateSupervision","removeSupervision","addOperator","updateOperator","removeOperator","addLaborer","updateLaborer","removeLaborer","addDynamicWorker","updateDynamicWorker","removeDynamicWorker","getInactiveLaborClasses","_onShowToast","AlertCircle","Copy","HardHat","inLegacy","s","o","l","inDynamic","workers","w","isAdded","Fragment","category","activeCategoryClasses","lc","laborClass","idx","i","field","value","inactiveInCategory","Loader2","sup","operator","laborer","MaterialsStep","companyId","items","setItems","onShowToast","selectedCategory","setSelectedCategory","useState","categoryItems","setCategoryItems","loadingItems","setLoadingItems","materialSearch","setMaterialSearch","searchResults","setSearchResults","allMaterials","setAllMaterials","showCustomForm","setShowCustomForm","customItem","setCustomItem","materialsSearchRef","useRef","focusTimeoutRef","useEffect","loadCategoryItems","data","db","error","loadAllMaterials","allItems","item","handleMaterialSearch","query","lowerQuery","results","selectItem","existingIndex","it","addCustomItemHandler","updateItemQuantity","quantity","qty","_","goBack","cat","added","Search","existingItem","catItems","EvidenceStep","photos","onPhotoAdd","onRemovePhoto","_maxPhotos","selectedCorId","setSelectedCorId","assignableCORs","Camera","photo","MapPin","Link","c","cor","SignatureLinkGenerator","lazy","__vitePreload","TMClientSignature","ReviewStep","step","setStep","maxPhotos","validDynamicWorkersList","validSupervision","validOperators","validLaborers","totalWorkers","submittedByName","setSubmittedByName","submittedTicket","_submitting","_submitProgress","clientSigned","setClientSigned","showSignatureLinkModal","setShowSignatureLinkModal","showOnSiteSignature","setShowOnSiteSignature","onRetryPhotoUpload","CheckCircle2","p","RotateCcw","failedPhotos","PenLine","Suspense","UserCheck","sum","Wrench","Zap","generateRandomId","array","b","TMForm","onSubmit","onCancel","setSubmittedTicket","setAssignableCORs","_loadingCORs","setLoadingCORs","setSupervision","setOperators","setLaborers","setPhotos","submitting","setSubmitting","submitProgress","setSubmitProgress","setTodaysCrew","setLoadingPreviousCrew","setLang","setLaborCategories","setLaborClasses","setDynamicWorkers","setLoadingLaborClasses","setActiveLaborClassIds","loadTodaysCrew","loadAssignableCORs","corSub","err","crewLaborClassIds","initialWorkers","activeIds","classId","prev","cors","applyBatchHours","updatedCount","updatedDynamic","applyInlinePreset","count","checkin","loadPreviousCrew","previousCrew","dateStr","addSupervisionFn","updated","addLaborerFn","addOperatorFn","activateLaborClass","deactivateLaborClass","newSet","newWorkers","getValidDynamicWorkers","allWorkers","handleAddCrewWorker","classWorkers","emptyIndex","targetClassId","role","emptySupIndex","emptyOpIndex","emptyLabIndex","handlePhotoAdd","files","remainingSlots","filesToAdd","gps","getGPSLocation","MAX_FILE_SIZE","file","previewUrl","tempId","updatePhotoStatus","photoId","updates","retryPhotoUpload","ticketId","fileToUpload","compressImage","url","removePhoto","canGoNext","hasSupervision","hasOperators","hasLaborers","validationWarnings","warnings","goNext","handleSubmit","allWorkersForSubmit","vs","vo","vl","ticket","photoUrls","pendingPhotos","compressedPhotos","compressed","uploadedCount","failedCount","uploadPromises","r","photoLocations","result","importError","markError","Globe","CrewCheckin","setWorkers","loading","setLoading","saving","setSaving","showAddForm","setShowAddForm","newWorker","setNewWorker","recentWorkers","setRecentWorkers","loadingRecent","setLoadingRecent","loadingClasses","setLoadingClasses","defaultRoles","useCallback","loadRecentWorkers","recent","loadLaborClasses","handleRoleChange","handleAddWorker","updatedWorkers","handleRemoveWorker","workerName","handleQuickAdd","recentWorker","availableRecentWorkers","rw","today","getClassesByCategory","grouped","uncategorized","hasCustomClasses","catId","UserPlus","DailyReport","report","setReport","fieldNotes","setFieldNotes","issues","setIssues","loadReport","existing","compiled","isSupabaseConfigured","isSubmitted","CheckCircle","task","AlertTriangle","Upload","LOAD_TYPES","getLoadTypeInfo","type","DisposalLoadInput","user","date","loads","setLoads","history","setHistory","showHistory","setShowHistory","newLoad","setNewLoad","displayDate","loadDisposalData","loadHistory","load","acc","historyArray","a","handleAddLoad","handleDeleteLoad","id","loadType","handleIncrementLoad","handleDecrementLoad","loadsByType","totalLoads","Truck","typeData","Minus","Plus","X","History","ChevronUp","ChevronDown","day","formattedDate","typeInfo","ForemanMetrics","_companyId","onBack","timeRange","setTimeRange","metrics","setMetrics","loadMetrics","now","startDate","startStr","days","areas","tickets","disposalLoads","dailyReports","crewHistory","currentDate","crew","refreshTimeoutRef","debouncedReload","subs","areaSub","crewSub","tmSub","haulSub","reportSub","sub","derivedMetrics","useMemo","totalAreas","completedAreas","inProgressAreas","notStartedAreas","progressPercent","totalManDays","avgCrewSize","d","daysWithCrew","pendingTickets","signedTickets","totalTicketValue","totalTonnage","reportsSubmitted","reportsDue","reportStreak","calculateReportStreak","reports","sortedDates","streak","checkDate","COLORS","PIE_COLORS","progressPieData","ticketsByDay","byDay","ArrowLeft","TrendingUp","Users","ResponsiveContainer","PieChart","Pie","name","entry","Cell","Tooltip","BarChart","CartesianGrid","XAxis","YAxis","label","Bar","LineChart","Line","Calendar","DollarSign","ALL_ACTIONS","ClipboardList","CheckSquare","FolderOpen","BarChart2","ClipboardCheck","DEFAULT_PINNED","getPinStorageKey","projectId","ForemanLanding","todayStatus","progress","areasWorking","areasDone","areasRemaining","punchListOpenCount","onNavigate","pinnedIds","setPinnedIds","stored","isEditMode","setIsEditMode","moreCollapsed","setMoreCollapsed","togglePin","actionId","unpinnedActions","getActionStatus","renderPinnedAction","action","Icon","status","PinOff","renderUnpinnedAction","Pin","Settings","ForemanView","foremanName","onExit","setAreas","updating","setUpdating","expandedGroups","setExpandedGroups","activeView","setActiveView","showProjectInfo","setShowProjectInfo","setPunchListOpenCount","setTodayStatus","isDark","setIsDark","loadAreas","loadTodayStatus","loadPunchListCount","crewWorkers","crewCheckedIn","todayTickets","disposal","getSupabaseClient","debouncedRefresh","matReqSub","projectSub","punchSub","materialsSub","laborSub","groups","expanded","g","handleStatusUpdate","areaId","newStatus","area","finalStatus","toggleGroup","group","toggleTheme","newTheme","calculateProgress","groupedAreas","hasGroups","getGroupProgress","groupAreas","handleNavigate","viewId","InjuryReportForm","FolderGrid","PunchList","ChevronRight","Info","Sun","Moon"],"ignoreList":[],"sources":["../../src/components/tm/translations.js","../../src/components/tm/WorkDetailsStep.jsx","../../src/components/tm/WorkerRow.jsx","../../src/components/tm/BatchHoursModal.jsx","../../src/components/tm/CrewHoursStep.jsx","../../src/components/tm/MaterialsStep.jsx","../../src/components/tm/EvidenceStep.jsx","../../src/components/tm/ReviewStep.jsx","../../src/components/TMForm.jsx","../../src/components/CrewCheckin.jsx","../../src/components/DailyReport.jsx","../../src/components/DisposalLoadInput.jsx","../../src/components/ForemanMetrics.jsx","../../src/components/ForemanLanding.jsx","../../src/components/ForemanView.jsx"],"sourcesContent":["export const CATEGORIES = ['Containment', 'PPE', 'Disposal', 'Equipment']\n\nexport const TRANSLATIONS = {\n  en: {\n    // Steps\n    workInfo: 'Work Details',\n    crewHours: 'Crew & Hours',\n    materialsEquipment: 'Materials',\n    evidence: 'Evidence',\n    review: 'Review',\n\n    // Quick Actions\n    quickActions: 'Quick Actions',\n    sameAsYesterday: 'Same as Yesterday',\n    setCrewHours: 'Set Crew Hours',\n    loading: 'Loading...',\n\n    // Worker sections\n    supervision: 'Supervision',\n    operators: 'Operators',\n    laborers: 'Laborers',\n    addSupervision: '+ Add Supervision',\n    addOperator: '+ Add Operator',\n    addLaborer: '+ Add Laborer',\n\n    // Worker fields\n    foreman: 'Foreman',\n    superintendent: 'Superintendent',\n    firstLastName: 'First & Last Name',\n    start: 'Start',\n    end: 'End',\n    regHrs: 'Reg Hrs',\n    otHrs: 'OT Hrs',\n\n    // Materials\n    selectCategory: 'Select a category:',\n    addCustomItem: '+ Add Custom Item',\n    customItem: 'Custom Item',\n    itemName: 'Item Name',\n    category: 'Category',\n    quantity: 'Quantity',\n    addItem: 'Add Item',\n    cancel: 'Cancel',\n    noItemsCategory: 'No items in this category yet',\n\n    // Review\n    workDate: 'Work Date',\n    ceNumber: 'CE/PCO #',\n    optional: 'optional',\n    linkedCOR: 'Link to Change Order',\n    selectCOR: 'Select COR (optional)',\n    noCORs: 'No pending CORs',\n    laborSummary: 'Labor Summary',\n    worker: 'worker',\n    workers_plural: 'workers',\n    totalHours: 'Total Hours',\n    regular: 'Regular',\n    overtime: 'Overtime',\n    materials: 'Materials',\n    item: 'item',\n    items_plural: 'items',\n    noMaterials: 'No materials added',\n    notes: 'Notes',\n    addNotes: 'Add notes about the work performed...',\n    photos: 'Photos',\n    addPhotos: 'Add Photos',\n    maxPhotos: 'max',\n    noPhotos: 'No photos added',\n    certification: 'Certification',\n    certifyStatement: 'I certify that this T&M ticket accurately reflects the work performed.',\n    foremanSignature: \"Foreman's Name (Signature)\",\n    yourName: 'Your name',\n\n    // Work Info step\n    describeWork: 'Describe the work performed',\n    descriptionRequired: 'Description is required',\n    whatWorkPerformed: 'What work was performed today?',\n\n    // Materials search\n    searchMaterials: 'Search materials & equipment...',\n    noSearchResults: 'No items found',\n    orBrowse: 'Or browse by category:',\n\n    // Navigation\n    back: 'Back',\n    next: 'Next',\n    nextCrew: 'Next: Crew',\n    nextMaterials: 'Next: Materials',\n    reviewItems: 'Review',\n    skipNoMaterials: 'Skip (no materials)',\n    submitTM: 'Submit T&M',\n    submitting: 'Submitting...',\n\n    // Batch hours modal\n    applySameHours: 'Apply Same Hours',\n    batchDescription: 'Set start/end time and hours for all workers with names entered.',\n    timeStarted: 'Time Started',\n    timeEnded: 'Time Ended',\n    regularHours: 'Regular Hours',\n    overtimeHours: 'Overtime Hours',\n    willApplyTo: 'Will apply to',\n    applyToAll: 'Apply to All',\n\n    // Time presets\n    preset8hr: '8hr Day',\n    preset10hr: '10hr Day',\n    preset4hr: '4hr Day',\n\n    // Toast messages\n    loadedWorkers: 'Loaded {count} workers from {date}',\n    noPreviousCrew: 'No previous crew found for this project',\n    appliedHours: 'Applied hours to {count} worker(s)',\n\n    // COR\n    assignedToCOR: 'Assigned to COR',\n\n    // Evidence step\n    photoEvidence: 'Photo Evidence',\n    photosAdded: 'photo(s) added',\n    recommendedForBilling: 'Recommended for billing',\n    addMorePhotos: 'Add More Photos',\n    linkToChangeOrder: 'Link to Change Order',\n    linkedTo: 'Linked to',\n    optionalLinkCOR: 'Optional - Link this T&M to a COR',\n    selectCOROptional: '-- Select a COR (optional) --',\n    noActiveCORs: 'No active CORs available for this project',\n\n    // TMForm inline strings\n    addWorkersFirst: 'Add workers first',\n    errorLoadingCrew: 'Error loading previous crew',\n    descriptionRecommended: 'Description recommended',\n    workersNoHours: 'worker(s) have no hours entered',\n    nameRequired: 'Name required to submit',\n    submitted: 'Submitted',\n    switchToSpanish: 'Cambiar a Espanol',\n    switchToEnglish: 'Switch to English',\n    reviewAndSubmit: 'Review & Submit',\n    enterNameToSubmit: 'Enter name to submit',\n    done: 'Done',\n    skipSignature: 'Skip signature for now',\n\n    // CrewHoursStep inline strings\n    total: 'total',\n    needHours: 'need hours',\n    customHours: 'Custom hours',\n    selectTMWorkers: 'Select T&M Workers',\n    tapToAdd: 'Tap to add',\n    removeClass: 'Remove this labor class',\n    add: 'Add',\n    addLaborClass: 'Add Labor Class...',\n    other: 'Other',\n    noCustomClasses: 'No custom labor classes set up for this company. Using default categories.',\n    loadingLaborClasses: 'Loading labor classes...',\n    noLaborClassesYet: 'No labor classes added yet. Select from crew check-in above or add manually:',\n\n    // ReviewStep inline strings\n    tmSubmitted: 'T&M Ticket Submitted!',\n    ticketSavedReady: 'Your ticket has been saved and is ready for client signature.',\n    workersLabel: 'Workers',\n    retry: 'Retry',\n    retryAllPhotos: 'Retry All Failed Photos',\n    getClientSignature: 'Get Client Signature',\n    signatureDescription: 'Have the client sign this T&M ticket to verify the work performed.',\n    clientSignatureCollected: 'Client signature collected!',\n    signNowOnSite: 'Sign Now (On-Site)',\n    clientSignsDevice: 'Client signs on this device',\n    sendSignatureLink: 'Send Signature Link',\n    clientSignsLater: 'Client signs later via link',\n    ticketSummary: 'Ticket Summary',\n    edit: 'Edit',\n    submittedBy: 'Submitted By',\n    enterYourName: 'Enter your name',\n    certifyAccurate: 'By submitting, you certify this T&M is accurate.'\n  },\n  es: {\n    // Steps\n    workInfo: 'Info del Trabajo',\n    crewHours: 'Cuadrilla y Horas',\n    materialsEquipment: 'Materiales',\n    evidence: 'Evidencia',\n    review: 'Revisar',\n\n    // Quick Actions\n    quickActions: 'Acciones Rapidas',\n    sameAsYesterday: 'Igual que Ayer',\n    setCrewHours: 'Poner Horas',\n    loading: 'Cargando...',\n\n    // Worker sections\n    supervision: 'Supervision',\n    operators: 'Operadores',\n    laborers: 'Trabajadores',\n    addSupervision: '+ Agregar Supervision',\n    addOperator: '+ Agregar Operador',\n    addLaborer: '+ Agregar Trabajador',\n\n    // Worker fields\n    foreman: 'Capataz',\n    superintendent: 'Superintendente',\n    firstLastName: 'Nombre y Apellido',\n    start: 'Inicio',\n    end: 'Fin',\n    regHrs: 'Hrs Reg',\n    otHrs: 'Hrs Extra',\n\n    // Materials\n    selectCategory: 'Seleccione una categoria:',\n    addCustomItem: '+ Agregar Articulo',\n    customItem: 'Articulo Personalizado',\n    itemName: 'Nombre del Articulo',\n    category: 'Categoria',\n    quantity: 'Cantidad',\n    addItem: 'Agregar',\n    cancel: 'Cancelar',\n    noItemsCategory: 'No hay articulos en esta categoria',\n\n    // Review\n    workDate: 'Fecha de Trabajo',\n    ceNumber: 'CE/PCO #',\n    optional: 'opcional',\n    linkedCOR: 'Vincular a Orden de Cambio',\n    selectCOR: 'Seleccionar COR (opcional)',\n    noCORs: 'No hay CORs pendientes',\n    laborSummary: 'Resumen de Mano de Obra',\n    worker: 'trabajador',\n    workers_plural: 'trabajadores',\n    totalHours: 'Horas Totales',\n    regular: 'Regular',\n    overtime: 'Extra',\n    materials: 'Materiales',\n    item: 'articulo',\n    items_plural: 'articulos',\n    noMaterials: 'No se agregaron materiales',\n    notes: 'Notas',\n    addNotes: 'Agregar notas sobre el trabajo realizado...',\n    photos: 'Fotos',\n    addPhotos: 'Agregar Fotos',\n    maxPhotos: 'max',\n    noPhotos: 'No se agregaron fotos',\n    certification: 'Certificacion',\n    certifyStatement: 'Certifico que este ticket T&M refleja con precision el trabajo realizado.',\n    foremanSignature: 'Nombre del Capataz (Firma)',\n    yourName: 'Su nombre',\n\n    // Work Info step\n    describeWork: 'Describir el trabajo realizado',\n    descriptionRequired: 'Descripcion es requerida',\n    whatWorkPerformed: 'Que trabajo se realizo hoy?',\n\n    // Materials search\n    searchMaterials: 'Buscar materiales y equipo...',\n    noSearchResults: 'No se encontraron articulos',\n    orBrowse: 'O navegar por categoria:',\n\n    // Navigation\n    back: 'Atras',\n    next: 'Siguiente',\n    nextCrew: 'Siguiente: Cuadrilla',\n    nextMaterials: 'Siguiente: Materiales',\n    reviewItems: 'Revisar',\n    skipNoMaterials: 'Saltar (sin materiales)',\n    submitTM: 'Enviar T&M',\n    submitting: 'Enviando...',\n\n    // Batch hours modal\n    applySameHours: 'Aplicar Mismas Horas',\n    batchDescription: 'Establezca hora de inicio/fin y horas para todos los trabajadores.',\n    timeStarted: 'Hora de Inicio',\n    timeEnded: 'Hora de Fin',\n    regularHours: 'Horas Regulares',\n    overtimeHours: 'Horas Extra',\n    willApplyTo: 'Se aplicara a',\n    applyToAll: 'Aplicar a Todos',\n\n    // Time presets\n    preset8hr: 'Dia 8hr',\n    preset10hr: 'Dia 10hr',\n    preset4hr: 'Dia 4hr',\n\n    // Toast messages\n    loadedWorkers: 'Se cargaron {count} trabajadores del {date}',\n    noPreviousCrew: 'No se encontro equipo anterior para este proyecto',\n    appliedHours: 'Horas aplicadas a {count} trabajador(es)',\n\n    // COR\n    assignedToCOR: 'Asignado a COR',\n\n    // Evidence step\n    photoEvidence: 'Evidencia Fotogr\\u00e1fica',\n    photosAdded: 'foto(s) agregada(s)',\n    recommendedForBilling: 'Recomendado para facturaci\\u00f3n',\n    addMorePhotos: 'Agregar M\\u00e1s Fotos',\n    linkToChangeOrder: 'Vincular a Orden de Cambio',\n    linkedTo: 'Vinculado a',\n    optionalLinkCOR: 'Opcional - Vincular este T&M a un COR',\n    selectCOROptional: '-- Seleccionar COR (opcional) --',\n    noActiveCORs: 'No hay CORs activos para este proyecto',\n\n    // TMForm inline strings\n    addWorkersFirst: 'Agregue trabajadores primero',\n    errorLoadingCrew: 'Error cargando equipo anterior',\n    descriptionRecommended: 'Descripcion recomendada',\n    workersNoHours: 'trabajador(es) sin horas',\n    nameRequired: 'Nombre requerido',\n    submitted: 'Enviado',\n    switchToSpanish: 'Cambiar a Espanol',\n    switchToEnglish: 'Switch to English',\n    reviewAndSubmit: 'Revisar y Enviar',\n    enterNameToSubmit: 'Ingrese nombre',\n    done: 'Listo',\n    skipSignature: 'Saltar firma por ahora',\n\n    // CrewHoursStep inline strings\n    total: 'total',\n    needHours: 'sin horas',\n    customHours: 'Horas personalizadas',\n    selectTMWorkers: 'Seleccionar Trabajadores T&M',\n    tapToAdd: 'Toca para agregar',\n    removeClass: 'Eliminar esta clase',\n    add: 'Agregar',\n    addLaborClass: 'Agregar Clase de Trabajo...',\n    other: 'Otros',\n    noCustomClasses: 'No hay clases de trabajo personalizadas. Usando categorias predeterminadas.',\n    loadingLaborClasses: 'Cargando clases de trabajo...',\n    noLaborClassesYet: 'No hay clases de trabajo agregadas. Seleccione del check-in o agregue manualmente:',\n\n    // ReviewStep inline strings\n    tmSubmitted: '\\u00a1Ticket T&M Enviado!',\n    ticketSavedReady: 'Su ticket ha sido guardado y est\\u00e1 listo para la firma del cliente.',\n    workersLabel: 'Trabajadores',\n    retry: 'Reintentar',\n    retryAllPhotos: 'Reintentar Todas las Fotos',\n    getClientSignature: 'Obtener Firma del Cliente',\n    signatureDescription: 'Haga que el cliente firme este ticket T&M para verificar el trabajo realizado.',\n    clientSignatureCollected: '\\u00a1Firma del cliente recopilada!',\n    signNowOnSite: 'Firmar Ahora',\n    clientSignsDevice: 'Cliente firma en este dispositivo',\n    sendSignatureLink: 'Enviar Enlace',\n    clientSignsLater: 'Cliente firma despu\\u00e9s v\\u00eda enlace',\n    ticketSummary: 'Resumen del Ticket',\n    edit: 'Editar',\n    submittedBy: 'Enviado Por',\n    enterYourName: 'Ingrese su nombre',\n    certifyAccurate: 'Al enviar, certifica que este T&M es preciso.'\n  }\n}\n\n// Helper to create a translation function for a given language\nexport const createT = (lang) => (key) => TRANSLATIONS[lang]?.[key] || key\n","import { FileText } from 'lucide-react'\n\n/**\n * WorkDetailsStep - Step 1: Work description, date, CE/PCO, COR linking.\n *\n * Props:\n *  - project: project object\n *  - workDate, setWorkDate\n *  - cePcoNumber, setCePcoNumber\n *  - notes, setNotes (description of work)\n *  - t: translation function\n *  - lang: 'en' | 'es'\n */\nexport default function WorkDetailsStep({\n  project,\n  workDate, setWorkDate,\n  cePcoNumber, setCePcoNumber,\n  notes, setNotes,\n  t, lang: _lang\n}) {\n  return (\n    <div className=\"tm-step-content\">\n      {/* Project Info Header */}\n      <div className=\"tm-project-info\">\n        {project.job_number && (\n          <div className=\"tm-project-detail\">\n            <span className=\"tm-project-label\">Job #</span>\n            <span className=\"tm-project-value\">{project.job_number}</span>\n          </div>\n        )}\n        <div className=\"tm-project-detail\">\n          <span className=\"tm-project-label\">Project</span>\n          <span className=\"tm-project-value\">{project.name}</span>\n        </div>\n        {project.address && (\n          <div className=\"tm-project-detail\">\n            <span className=\"tm-project-label\">Address</span>\n            <span className=\"tm-project-value\">{project.address}</span>\n          </div>\n        )}\n        {project.general_contractor && (\n          <div className=\"tm-project-detail\">\n            <span className=\"tm-project-label\">GC</span>\n            <span className=\"tm-project-value\">{project.general_contractor}</span>\n          </div>\n        )}\n      </div>\n\n      <div className=\"tm-field-row\">\n        <div className=\"tm-field tm-field-half\">\n          <label>Date</label>\n          <input\n            type=\"date\"\n            value={workDate}\n            onChange={(e) => setWorkDate(e.target.value)}\n            className=\"tm-date\"\n          />\n        </div>\n        <div className=\"tm-field tm-field-half\">\n          <label>CE / PCO #</label>\n          <input\n            type=\"text\"\n            placeholder=\"Change Event / PCO\"\n            value={cePcoNumber}\n            onChange={(e) => setCePcoNumber(e.target.value)}\n            className=\"tm-input\"\n          />\n        </div>\n      </div>\n\n      {/* Description of Work - REQUIRED */}\n      <div className=\"tm-field tm-description-field\">\n        <label>\n          <FileText size={16} className=\"inline-icon\" />\n          {t('describeWork')} <span className=\"tm-required\">*</span>\n        </label>\n        <textarea\n          placeholder={t('whatWorkPerformed')}\n          value={notes}\n          onChange={(e) => setNotes(e.target.value)}\n          rows={4}\n          className={`tm-description ${!notes.trim() ? 'tm-field-required' : ''}`}\n        />\n      </div>\n    </div>\n  )\n}\n","/* eslint-disable react-refresh/only-export-components */\nimport { Check } from 'lucide-react'\n\n// Helper to determine worker completion state for visual indicators\nexport const getWorkerState = (worker) => {\n  if (!worker) return 'empty'\n  const hasName = worker.name && worker.name.trim() !== ''\n  const hasHours = parseFloat(worker.hours) > 0 || parseFloat(worker.overtimeHours) > 0\n  if (!hasName) return 'empty'\n  if (hasHours) return 'complete'\n  return 'incomplete'\n}\n\n// Calculate hours from time range (auto-split into regular + OT)\nexport const calculateHoursFromTimeRange = (startTime, endTime) => {\n  if (!startTime || !endTime) return null\n\n  const [startHour, startMin] = startTime.split(':').map(Number)\n  const [endHour, endMin] = endTime.split(':').map(Number)\n\n  let totalMinutes = (endHour * 60 + endMin) - (startHour * 60 + startMin)\n  if (totalMinutes < 0) totalMinutes += 24 * 60 // Handle overnight\n\n  const totalHours = totalMinutes / 60\n  const regularHours = Math.min(totalHours, 8)\n  const overtimeHours = Math.max(0, totalHours - 8)\n\n  return {\n    hours: regularHours.toFixed(1),\n    overtimeHours: overtimeHours > 0 ? overtimeHours.toFixed(1) : ''\n  }\n}\n\n/**\n * WorkerRow - Renders a single worker card with name, time, and hours fields.\n * Used across supervision, operators, laborers, and dynamic labor class sections.\n *\n * Props:\n *  - worker: { name, hours, overtimeHours, timeStarted, timeEnded, role? }\n *  - index: number\n *  - onUpdate: (index, field, value) => void\n *  - onRemove: (index) => void\n *  - t: translation function\n *  - roleSelect?: JSX element for supervision role dropdown (optional)\n */\nexport default function WorkerRow({ worker, index, onUpdate, onRemove, t, roleSelect }) {\n  const workerState = getWorkerState(worker)\n\n  return (\n    <div className={`tm-worker-card-expanded ${workerState !== 'empty' ? `worker-${workerState}` : ''}`}>\n      <div className=\"tm-worker-row-top\">\n        {workerState === 'complete' && (\n          <span className=\"tm-worker-check\"><Check size={14} /></span>\n        )}\n        {roleSelect}\n        <input\n          type=\"text\"\n          placeholder={t('firstLastName')}\n          value={worker.name}\n          onChange={(e) => onUpdate(index, 'name', e.target.value)}\n          className=\"tm-worker-input\"\n        />\n        <button className=\"tm-remove\" onClick={() => onRemove(index)}></button>\n      </div>\n      <div className=\"tm-worker-row-bottom\">\n        <div className=\"tm-time-group\">\n          <label>{t('start')}</label>\n          <input\n            type=\"time\"\n            value={worker.timeStarted}\n            onChange={(e) => onUpdate(index, 'timeStarted', e.target.value)}\n          />\n        </div>\n        <div className=\"tm-time-group\">\n          <label>{t('end')}</label>\n          <input\n            type=\"time\"\n            value={worker.timeEnded}\n            onChange={(e) => onUpdate(index, 'timeEnded', e.target.value)}\n          />\n        </div>\n        <div className=\"tm-time-group\">\n          <label>{t('regHrs')}</label>\n          <input\n            type=\"number\"\n            placeholder=\"0\"\n            value={worker.hours}\n            onChange={(e) => onUpdate(index, 'hours', e.target.value)}\n          />\n        </div>\n        <div className=\"tm-time-group\">\n          <label>{t('otHrs')}</label>\n          <input\n            type=\"number\"\n            placeholder=\"0\"\n            value={worker.overtimeHours}\n            onChange={(e) => onUpdate(index, 'overtimeHours', e.target.value)}\n          />\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { Clock } from 'lucide-react'\nimport { calculateHoursFromTimeRange } from './WorkerRow'\n\n/**\n * BatchHoursModal - Modal for applying the same hours to all named workers.\n *\n * Props:\n *  - batchHours: { timeStarted, timeEnded, hours, overtimeHours }\n *  - setBatchHours: setter\n *  - namedWorkerCount: number of workers with names\n *  - onApply: () => void\n *  - onClose: () => void\n *  - t: translation function\n */\nexport default function BatchHoursModal({ batchHours, setBatchHours, namedWorkerCount, onApply, onClose, t }) {\n  const applyTimePreset = (preset) => {\n    let timeStarted, timeEnded, hours, overtimeHours\n\n    switch (preset) {\n      case 'full':\n        timeStarted = '07:00'\n        timeEnded = '15:30'\n        hours = '8'\n        overtimeHours = ''\n        break\n      case '10hr':\n        timeStarted = '06:00'\n        timeEnded = '16:30'\n        hours = '8'\n        overtimeHours = '2'\n        break\n      case 'half':\n        timeStarted = '07:00'\n        timeEnded = '11:00'\n        hours = '4'\n        overtimeHours = ''\n        break\n      default:\n        return\n    }\n\n    setBatchHours({ timeStarted, timeEnded, hours, overtimeHours })\n  }\n\n  return (\n    <div className=\"tm-modal-overlay\" onClick={onClose}>\n      <div className=\"tm-batch-modal\" onClick={(e) => e.stopPropagation()}>\n        <h3><Clock size={18} /> {t('applySameHours')}</h3>\n        <p className=\"tm-batch-description\">\n          {t('batchDescription')}\n        </p>\n\n        {/* Time Presets - Quick Selection */}\n        <div className=\"tm-time-presets\">\n          <button type=\"button\" className=\"tm-preset-btn\" onClick={() => applyTimePreset('full')}>\n            {t('preset8hr')}\n          </button>\n          <button type=\"button\" className=\"tm-preset-btn\" onClick={() => applyTimePreset('10hr')}>\n            {t('preset10hr')}\n          </button>\n          <button type=\"button\" className=\"tm-preset-btn\" onClick={() => applyTimePreset('half')}>\n            {t('preset4hr')}\n          </button>\n        </div>\n\n        <div className=\"tm-batch-form\">\n          <div className=\"tm-batch-row\">\n            <div className=\"tm-batch-field\">\n              <label>{t('timeStarted')}</label>\n              <input\n                type=\"time\"\n                value={batchHours.timeStarted}\n                onChange={(e) => {\n                  const newStart = e.target.value\n                  const calculated = calculateHoursFromTimeRange(newStart, batchHours.timeEnded)\n                  setBatchHours({\n                    ...batchHours,\n                    timeStarted: newStart,\n                    ...(calculated || {})\n                  })\n                }}\n              />\n            </div>\n            <div className=\"tm-batch-field\">\n              <label>{t('timeEnded')}</label>\n              <input\n                type=\"time\"\n                value={batchHours.timeEnded}\n                onChange={(e) => {\n                  const newEnd = e.target.value\n                  const calculated = calculateHoursFromTimeRange(batchHours.timeStarted, newEnd)\n                  setBatchHours({\n                    ...batchHours,\n                    timeEnded: newEnd,\n                    ...(calculated || {})\n                  })\n                }}\n              />\n            </div>\n          </div>\n          <div className=\"tm-batch-row\">\n            <div className=\"tm-batch-field\">\n              <label>{t('regularHours')}</label>\n              <input\n                type=\"number\"\n                placeholder=\"8\"\n                value={batchHours.hours}\n                onChange={(e) => setBatchHours({ ...batchHours, hours: e.target.value })}\n              />\n            </div>\n            <div className=\"tm-batch-field\">\n              <label>{t('overtimeHours')}</label>\n              <input\n                type=\"number\"\n                placeholder=\"0\"\n                value={batchHours.overtimeHours}\n                onChange={(e) => setBatchHours({ ...batchHours, overtimeHours: e.target.value })}\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"tm-batch-preview\">\n          <strong>{t('willApplyTo')}:</strong>\n          <span>\n            {namedWorkerCount} {t('workers_plural')}\n          </span>\n        </div>\n\n        <div className=\"tm-batch-actions\">\n          <button\n            type=\"button\"\n            className=\"btn btn-secondary\"\n            onClick={onClose}\n          >\n            {t('cancel')}\n          </button>\n          <button\n            type=\"button\"\n            className=\"btn btn-primary\"\n            onClick={onApply}\n            disabled={!batchHours.hours && !batchHours.overtimeHours}\n          >\n            {t('applyToAll')}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { HardHat, Copy, Clock, AlertCircle, Loader2 } from 'lucide-react'\nimport WorkerRow from './WorkerRow'\nimport BatchHoursModal from './BatchHoursModal'\n\n/**\n * CrewHoursStep - Step 2: Worker sections, batch hours, crew selection.\n *\n * Props:\n *  - supervision, setSupervision\n *  - operators, setOperators\n *  - laborers, setLaborers\n *  - dynamicWorkers, setDynamicWorkers\n *  - activeLaborClassIds, setActiveLaborClassIds\n *  - laborCategories, laborClasses\n *  - hasCustomLaborClasses, loadingLaborClasses\n *  - todaysCrew\n *  - showBatchHoursModal, setShowBatchHoursModal\n *  - batchHours, setBatchHours\n *  - loadingPreviousCrew\n *  - namedWorkers, workersWithHours, workersNeedingHours\n *  - totalRegHours, totalOTHours\n *  - onLoadPreviousCrew, onApplyBatchHours, onApplyInlinePreset\n *  - onAddCrewWorker: (worker) => void - handles adding a crew member to proper section\n *  - onActivateLaborClass, onDeactivateLaborClass\n *  - addSupervision, updateSupervision, removeSupervision\n *  - addOperator, updateOperator, removeOperator\n *  - addLaborer, updateLaborer, removeLaborer\n *  - addDynamicWorker, updateDynamicWorker, removeDynamicWorker\n *  - getInactiveLaborClasses\n *  - t, lang\n *  - onShowToast\n */\nexport default function CrewHoursStep({\n  supervision, operators, laborers,\n  dynamicWorkers,\n  activeLaborClassIds, setActiveLaborClassIds: _setActiveLaborClassIds,\n  laborCategories, laborClasses,\n  hasCustomLaborClasses, loadingLaborClasses,\n  todaysCrew,\n  showBatchHoursModal, setShowBatchHoursModal,\n  batchHours, setBatchHours,\n  loadingPreviousCrew,\n  namedWorkers, workersNeedingHours,\n  totalRegHours, totalOTHours,\n  onLoadPreviousCrew, onApplyBatchHours, onApplyInlinePreset,\n  onAddCrewWorker,\n  onActivateLaborClass, onDeactivateLaborClass,\n  addSupervision, updateSupervision, removeSupervision,\n  addOperator, updateOperator, removeOperator,\n  addLaborer, updateLaborer, removeLaborer,\n  addDynamicWorker, updateDynamicWorker, removeDynamicWorker,\n  getInactiveLaborClasses,\n  t, lang: _lang,\n  onShowToast: _onShowToast\n}) {\n  const namedWorkerCount = namedWorkers.length\n\n  return (\n    <div className=\"tm-step-content\">\n      {/* Crew Summary Bar */}\n      <div className=\"tm-crew-summary-bar\">\n        <div className=\"tm-summary-left\">\n          <span className=\"tm-summary-count\">{namedWorkers.length}</span>\n          <span className=\"tm-summary-label\">{namedWorkers.length === 1 ? t('worker') : t('workers_plural')}</span>\n        </div>\n        <div className=\"tm-summary-middle\">\n          <span className=\"tm-summary-hours\">{totalRegHours + totalOTHours}h</span>\n          <span className=\"tm-summary-label\">{t('total')}</span>\n        </div>\n        {workersNeedingHours > 0 && (\n          <div className=\"tm-summary-warning\">\n            <AlertCircle size={14} />\n            <span>{workersNeedingHours} {t('needHours')}</span>\n          </div>\n        )}\n      </div>\n\n      {/* Quick Actions - Same as Yesterday + Time Presets */}\n      <div className=\"tm-quick-actions-row\">\n        <button\n          className=\"tm-quick-action\"\n          onClick={onLoadPreviousCrew}\n          disabled={loadingPreviousCrew}\n        >\n          <Copy size={16} />\n          <span>{loadingPreviousCrew ? t('loading') : t('sameAsYesterday')}</span>\n        </button>\n        {namedWorkers.length > 0 && (\n          <div className=\"tm-time-presets-inline\">\n            <button className=\"tm-preset-chip\" onClick={() => onApplyInlinePreset('8hr')}>8h</button>\n            <button className=\"tm-preset-chip\" onClick={() => onApplyInlinePreset('10hr')}>10h</button>\n            <button className=\"tm-preset-chip\" onClick={() => onApplyInlinePreset('4hr')}>4h</button>\n            <button className=\"tm-preset-chip more\" onClick={() => setShowBatchHoursModal(true)} title={t('customHours')}>\n              <Clock size={14} />\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Select from Today's Crew - Prominent */}\n      {todaysCrew.length > 0 && (\n        <div className=\"tm-crew-select-section\">\n          <div className=\"tm-section-header\">\n            <h4><HardHat size={16} /> {t('selectTMWorkers')}</h4>\n            <span className=\"tm-section-hint\">{t('tapToAdd')}</span>\n          </div>\n          <div className=\"tm-crew-grid\">\n              {todaysCrew.map((worker, index) => {\n                // Check if already added (in legacy or dynamic sections)\n                const inLegacy =\n                  supervision.some(s => s.name.toLowerCase() === worker.name.toLowerCase()) ||\n                  operators.some(o => o.name.toLowerCase() === worker.name.toLowerCase()) ||\n                  laborers.some(l => l.name.toLowerCase() === worker.name.toLowerCase())\n                const inDynamic = Object.values(dynamicWorkers).some(workers =>\n                  workers.some(w => w.name.toLowerCase() === worker.name.toLowerCase())\n                )\n                const isAdded = inLegacy || inDynamic\n\n                return (\n                  <button\n                    key={index}\n                    className={`tm-crew-item ${isAdded ? 'added' : ''}`}\n                    onClick={() => {\n                      if (!isAdded) {\n                        onAddCrewWorker(worker)\n                      }\n                    }}\n                    disabled={isAdded}\n                  >\n                    <span className=\"tm-crew-item-name\">{worker.name}</span>\n                    <span className={`tm-crew-item-role ${(worker.role || 'laborer').toLowerCase()}`}>\n                      {worker.role || 'Laborer'}\n                    </span>\n                    {isAdded && <span className=\"tm-crew-item-check\">{'\\u2713'}</span>}\n                  </button>\n                )\n              })}\n          </div>\n        </div>\n      )}\n\n      {/* Dynamic Labor Classes (when company has custom classes) */}\n      {/* Only show labor classes that are active (from crew check-in or manually added) */}\n      {hasCustomLaborClasses && !loadingLaborClasses && (\n        <>\n          {/* Render active labor classes grouped by category */}\n          {laborCategories.map(category => {\n            // Only show classes in this category that are active\n            const activeCategoryClasses = laborClasses.filter(\n              lc => lc.category_id === category.id && activeLaborClassIds.has(lc.id)\n            )\n            if (activeCategoryClasses.length === 0) return null\n            return (\n              <div key={category.id} className=\"tm-labor-category-section\">\n                <div className=\"tm-category-header\">{category.name}</div>\n                {activeCategoryClasses.map(laborClass => (\n                  <div key={laborClass.id} className=\"tm-field\">\n                    <div className=\"tm-field-header\">\n                      <label>{laborClass.name}</label>\n                      <button\n                        type=\"button\"\n                        className=\"tm-remove-class-btn\"\n                        onClick={() => onDeactivateLaborClass(laborClass.id)}\n                        title={t('removeClass')}\n                      >\n                        {'\\u00d7'}\n                      </button>\n                    </div>\n                    <div className=\"tm-workers-list\">\n                      {(dynamicWorkers[laborClass.id] || []).map((worker, idx) => (\n                        <WorkerRow\n                          key={idx}\n                          worker={worker}\n                          index={idx}\n                          onUpdate={(i, field, value) => updateDynamicWorker(laborClass.id, i, field, value)}\n                          onRemove={(i) => removeDynamicWorker(laborClass.id, i)}\n                          t={t}\n                        />\n                      ))}\n                    </div>\n                    <button className=\"tm-add-btn\" onClick={() => addDynamicWorker(laborClass.id)}>\n                      + {t('add')} {laborClass.name}\n                    </button>\n                  </div>\n                ))}\n              </div>\n            )\n          })}\n\n          {/* Active classes without category */}\n          {laborClasses.filter(lc => !lc.category_id && activeLaborClassIds.has(lc.id)).map(laborClass => (\n            <div key={laborClass.id} className=\"tm-field\">\n              <div className=\"tm-field-header\">\n                <label>{laborClass.name}</label>\n                <button\n                  type=\"button\"\n                  className=\"tm-remove-class-btn\"\n                  onClick={() => onDeactivateLaborClass(laborClass.id)}\n                  title={t('removeClass')}\n                >\n                  {'\\u00d7'}\n                </button>\n              </div>\n              <div className=\"tm-workers-list\">\n                {(dynamicWorkers[laborClass.id] || []).map((worker, idx) => (\n                  <WorkerRow\n                    key={idx}\n                    worker={worker}\n                    index={idx}\n                    onUpdate={(i, field, value) => updateDynamicWorker(laborClass.id, i, field, value)}\n                    onRemove={(i) => removeDynamicWorker(laborClass.id, i)}\n                    t={t}\n                  />\n                ))}\n              </div>\n              <button className=\"tm-add-btn\" onClick={() => addDynamicWorker(laborClass.id)}>\n                + {t('add')} {laborClass.name}\n              </button>\n            </div>\n          ))}\n\n          {/* Add Labor Class dropdown - shows classes not yet active */}\n          {getInactiveLaborClasses().length > 0 && (\n            <div className=\"tm-add-labor-class-section\">\n              <select\n                className=\"tm-add-labor-class-select\"\n                value=\"\"\n                onChange={(e) => {\n                  if (e.target.value) {\n                    onActivateLaborClass(e.target.value)\n                  }\n                }}\n              >\n                <option value=\"\">\n                  + {t('addLaborClass')}\n                </option>\n                {laborCategories.map(category => {\n                  const inactiveInCategory = getInactiveLaborClasses().filter(lc => lc.category_id === category.id)\n                  if (inactiveInCategory.length === 0) return null\n                  return (\n                    <optgroup key={category.id} label={category.name}>\n                      {inactiveInCategory.map(lc => (\n                        <option key={lc.id} value={lc.id}>{lc.name}</option>\n                      ))}\n                    </optgroup>\n                  )\n                })}\n                {/* Uncategorized classes */}\n                {getInactiveLaborClasses().filter(lc => !lc.category_id).length > 0 && (\n                  <optgroup label={t('other')}>\n                    {getInactiveLaborClasses().filter(lc => !lc.category_id).map(lc => (\n                      <option key={lc.id} value={lc.id}>{lc.name}</option>\n                    ))}\n                  </optgroup>\n                )}\n              </select>\n            </div>\n          )}\n\n          {/* Empty state - no labor classes active yet */}\n          {activeLaborClassIds.size === 0 && (\n            <div className=\"tm-no-labor-classes\">\n              <p>\n                {t('noLaborClassesYet')}\n              </p>\n            </div>\n          )}\n        </>\n      )}\n\n      {/* Loading indicator for labor classes */}\n      {loadingLaborClasses && (\n        <div className=\"tm-loading-labor-classes\">\n          <Loader2 size={20} className=\"tm-spinner\" />\n          <span>{t('loadingLaborClasses')}</span>\n        </div>\n      )}\n\n      {/* Hardcoded Worker Sections (fallback when no custom classes) */}\n      {!hasCustomLaborClasses && !loadingLaborClasses && (\n        <>\n          {/* Supervision Section */}\n          <div className=\"tm-field\">\n            <label>{t('supervision')}</label>\n            <div className=\"tm-workers-list\">\n              {supervision.map((sup, index) => (\n                <WorkerRow\n                  key={index}\n                  worker={sup}\n                  index={index}\n                  onUpdate={updateSupervision}\n                  onRemove={removeSupervision}\n                  t={t}\n                  roleSelect={\n                    <div className=\"tm-role-select\">\n                      <select\n                        value={sup.role}\n                        onChange={(e) => updateSupervision(index, 'role', e.target.value)}\n                      >\n                        <option value=\"Foreman\">{t('foreman')}</option>\n                        <option value=\"Superintendent\">{t('superintendent')}</option>\n                      </select>\n                    </div>\n                  }\n                />\n              ))}\n            </div>\n            <button className=\"tm-add-btn\" onClick={addSupervision}>\n              {t('addSupervision')}\n            </button>\n          </div>\n\n          {/* Operators Section */}\n          <div className=\"tm-field\">\n            <label>{t('operators')}</label>\n            <div className=\"tm-workers-list\">\n              {operators.map((operator, index) => (\n                <WorkerRow\n                  key={index}\n                  worker={operator}\n                  index={index}\n                  onUpdate={updateOperator}\n                  onRemove={removeOperator}\n                  t={t}\n                />\n              ))}\n            </div>\n            <button className=\"tm-add-btn\" onClick={addOperator}>\n              {t('addOperator')}\n            </button>\n          </div>\n\n          {/* Laborers Section */}\n          <div className=\"tm-field\">\n            <label>{t('laborers')}</label>\n            <div className=\"tm-workers-list\">\n              {laborers.map((laborer, index) => (\n                <WorkerRow\n                  key={index}\n                  worker={laborer}\n                  index={index}\n                  onUpdate={updateLaborer}\n                  onRemove={removeLaborer}\n                  t={t}\n                />\n              ))}\n            </div>\n            <button className=\"tm-add-btn\" onClick={addLaborer}>\n              {t('addLaborer')}\n            </button>\n          </div>\n        </>\n      )}\n\n      {/* Batch Hours Modal */}\n      {showBatchHoursModal && (\n        <BatchHoursModal\n          batchHours={batchHours}\n          setBatchHours={setBatchHours}\n          namedWorkerCount={namedWorkerCount}\n          onApply={onApplyBatchHours}\n          onClose={() => setShowBatchHoursModal(false)}\n          t={t}\n        />\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect, useRef } from 'react'\nimport { Search } from 'lucide-react'\nimport { CATEGORIES } from './translations'\nimport { db } from '../../lib/supabase'\n\n/**\n * MaterialsStep - Step 3: Material/equipment category browsing and item selection.\n *\n * Props:\n *  - companyId\n *  - items, setItems\n *  - t, lang\n *  - onShowToast\n */\nexport default function MaterialsStep({ companyId, items, setItems, t, lang: _lang, onShowToast }) {\n  const [selectedCategory, setSelectedCategory] = useState(null)\n  const [categoryItems, setCategoryItems] = useState([])\n  const [loadingItems, setLoadingItems] = useState(false)\n  const [materialSearch, setMaterialSearch] = useState('')\n  const [searchResults, setSearchResults] = useState([])\n  const [allMaterials, setAllMaterials] = useState([])\n  const [showCustomForm, setShowCustomForm] = useState(false)\n  const [customItem, setCustomItem] = useState({ name: '', category: '', quantity: '' })\n  const materialsSearchRef = useRef(null)\n  const focusTimeoutRef = useRef(null)\n\n  // Load items when category selected\n  useEffect(() => {\n    if (selectedCategory && companyId) {\n      loadCategoryItems(selectedCategory)\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedCategory, companyId])\n\n  // Auto-focus search on mount when no category selected\n  useEffect(() => {\n    if (!selectedCategory && materialsSearchRef.current) {\n      focusTimeoutRef.current = setTimeout(() => {\n        materialsSearchRef.current?.focus()\n      }, 100)\n    }\n    return () => {\n      if (focusTimeoutRef.current) clearTimeout(focusTimeoutRef.current)\n    }\n  }, [selectedCategory])\n\n  const loadCategoryItems = async (category) => {\n    setLoadingItems(true)\n    try {\n      const data = await db.getMaterialsEquipmentByCategory(companyId, category)\n      setCategoryItems(data)\n    } catch (error) {\n      console.error('Error loading items:', error)\n      onShowToast('Error loading items', 'error')\n    } finally {\n      setLoadingItems(false)\n    }\n  }\n\n  const loadAllMaterials = async () => {\n    if (allMaterials.length > 0) return\n    try {\n      const allItems = []\n      for (const category of CATEGORIES) {\n        const data = await db.getMaterialsEquipmentByCategory(companyId, category)\n        allItems.push(...data.map(item => ({ ...item, category })))\n      }\n      setAllMaterials(allItems)\n    } catch (error) {\n      console.error('Error loading all materials:', error)\n    }\n  }\n\n  const handleMaterialSearch = (query) => {\n    setMaterialSearch(query)\n    if (!query.trim()) {\n      setSearchResults([])\n      return\n    }\n    const lowerQuery = query.toLowerCase()\n    const results = allMaterials.filter(item =>\n      item.name.toLowerCase().includes(lowerQuery) ||\n      item.category.toLowerCase().includes(lowerQuery)\n    )\n    setSearchResults(results.slice(0, 10))\n  }\n\n  const selectItem = (item) => {\n    const existingIndex = items.findIndex(i => i.material_equipment_id === item.id)\n    if (existingIndex >= 0) {\n      setItems(items.map((it, i) =>\n        i === existingIndex ? { ...it, quantity: it.quantity + 1 } : it\n      ))\n    } else {\n      setItems([...items, {\n        material_equipment_id: item.id,\n        name: item.name,\n        unit: item.unit,\n        category: item.category,\n        quantity: 1,\n        isCustom: false\n      }])\n    }\n    onShowToast(`Added ${item.name}`, 'success')\n  }\n\n  const addCustomItemHandler = () => {\n    if (!customItem.name || !customItem.category || !customItem.quantity) {\n      onShowToast('Fill in all fields', 'error')\n      return\n    }\n    setItems([...items, {\n      material_equipment_id: null,\n      custom_name: customItem.name,\n      custom_category: customItem.category,\n      name: customItem.name,\n      category: customItem.category,\n      quantity: parseFloat(customItem.quantity),\n      unit: 'each',\n      isCustom: true\n    }])\n    setCustomItem({ name: '', category: '', quantity: '' })\n    setShowCustomForm(false)\n    setSelectedCategory(null)\n    onShowToast('Custom item added', 'success')\n  }\n\n  const updateItemQuantity = (index, quantity) => {\n    const qty = parseFloat(quantity) || 0\n    if (qty <= 0) {\n      setItems(items.filter((_, i) => i !== index))\n    } else {\n      setItems(items.map((item, i) =>\n        i === index ? { ...item, quantity: qty } : item\n      ))\n    }\n  }\n\n  const goBack = () => {\n    if (showCustomForm) {\n      setShowCustomForm(false)\n    } else if (selectedCategory) {\n      setSelectedCategory(null)\n      setShowCustomForm(false)\n    }\n  }\n\n  // Category detail / custom form view\n  if (selectedCategory || showCustomForm) {\n    return (\n      <div className=\"tm-step-content\">\n        <div className=\"tm-wizard-header\" style={{ margin: '-1rem -1rem 1rem -1rem', padding: '0.75rem 1rem' }}>\n          <button className=\"tm-back-btn\" onClick={goBack}>{'\\u2190'}</button>\n          <h2>{showCustomForm ? 'Add Custom Item' : selectedCategory}</h2>\n          <div className=\"tm-item-count\">{items.length} items</div>\n        </div>\n\n        {showCustomForm ? (\n          <div className=\"tm-custom-form\">\n            <div className=\"tm-field\">\n              <label>Item Name</label>\n              <input\n                type=\"text\"\n                placeholder=\"What did you use?\"\n                value={customItem.name}\n                onChange={(e) => setCustomItem({ ...customItem, name: e.target.value })}\n                autoFocus\n              />\n            </div>\n            <div className=\"tm-field\">\n              <label>Category</label>\n              <div className=\"tm-category-select\">\n                {CATEGORIES.map(cat => (\n                  <button\n                    key={cat}\n                    className={`tm-cat-chip ${customItem.category === cat ? 'active' : ''}`}\n                    onClick={() => setCustomItem({ ...customItem, category: cat })}\n                  >\n                    {cat}\n                  </button>\n                ))}\n              </div>\n            </div>\n            <div className=\"tm-field\">\n              <label>Quantity</label>\n              <input\n                type=\"number\"\n                placeholder=\"How many?\"\n                value={customItem.quantity}\n                onChange={(e) => setCustomItem({ ...customItem, quantity: e.target.value })}\n              />\n            </div>\n            <button className=\"tm-big-btn primary\" onClick={addCustomItemHandler}>\n              Add Custom Item\n            </button>\n          </div>\n        ) : (\n          <div className=\"tm-item-grid\">\n            {loadingItems ? (\n              <div className=\"tm-loading\">Loading...</div>\n            ) : (\n              <>\n                {categoryItems.map(item => {\n                  const added = items.find(i => i.material_equipment_id === item.id)\n                  return (\n                    <button\n                      key={item.id}\n                      className={`tm-item-card ${added ? 'added' : ''}`}\n                      onClick={() => selectItem(item)}\n                    >\n                      <span className=\"tm-item-name\">{item.name}</span>\n                      <span className=\"tm-item-unit\">{item.unit}</span>\n                      {added && <span className=\"tm-item-badge\">{added.quantity}</span>}\n                    </button>\n                  )\n                })}\n                <button\n                  className=\"tm-item-card custom\"\n                  onClick={() => setShowCustomForm(true)}\n                >\n                  <span className=\"tm-item-name\">+ Add Other</span>\n                  <span className=\"tm-item-unit\">Not on list</span>\n                </button>\n              </>\n            )}\n          </div>\n        )}\n\n        {!showCustomForm && items.length > 0 && (\n          <div className=\"tm-wizard-footer\">\n            <button className=\"tm-big-btn primary\" onClick={() => setSelectedCategory(null)}>\n              Done Adding ({items.length} items)\n            </button>\n          </div>\n        )}\n      </div>\n    )\n  }\n\n  // Main materials browse view\n  return (\n    <div className=\"tm-step-content\">\n      {/* Quick Search */}\n      <div className=\"tm-field tm-search-field\">\n        <div className=\"tm-search-input-wrapper\">\n          <Search size={18} className=\"tm-search-icon\" />\n          <input\n            ref={materialsSearchRef}\n            type=\"text\"\n            placeholder={t('searchMaterials')}\n            value={materialSearch}\n            onChange={(e) => handleMaterialSearch(e.target.value)}\n            onFocus={() => loadAllMaterials()}\n            className=\"tm-search-input\"\n          />\n          {materialSearch && (\n            <button className=\"tm-search-clear\" onClick={() => { setMaterialSearch(''); setSearchResults([]); }}>{'\\u00d7'}</button>\n          )}\n        </div>\n\n        {/* Search Results */}\n        {materialSearch && searchResults.length > 0 && (\n          <div className=\"tm-search-results\">\n            {searchResults.map((item, idx) => {\n              const existingItem = items.find(i => i.id === item.id)\n              return (\n                <button\n                  key={idx}\n                  className={`tm-search-result-item ${existingItem ? 'added' : ''}`}\n                  onClick={() => {\n                    if (existingItem) {\n                      updateItemQuantity(items.indexOf(existingItem), existingItem.quantity + 1)\n                    } else {\n                      setItems([...items, { ...item, quantity: 1, isCustom: false }])\n                    }\n                    setMaterialSearch('')\n                    setSearchResults([])\n                  }}\n                >\n                  <span className=\"tm-search-result-name\">{item.name}</span>\n                  <span className=\"tm-search-result-category\">{item.category}</span>\n                  {existingItem && <span className=\"tm-search-result-qty\">{'\\u00d7'}{existingItem.quantity}</span>}\n                </button>\n              )\n            })}\n          </div>\n        )}\n        {materialSearch && searchResults.length === 0 && (\n          <div className=\"tm-search-no-results\">{t('noSearchResults')}</div>\n        )}\n      </div>\n\n      <div className=\"tm-field\">\n        <label>{t('orBrowse')}</label>\n        <div className=\"tm-category-grid\">\n          {CATEGORIES.map(cat => {\n            const catItems = items.filter(i => i.category === cat)\n            return (\n              <button\n                key={cat}\n                className=\"tm-category-card\"\n                onClick={() => setSelectedCategory(cat)}\n              >\n                <span className=\"tm-cat-name\">{cat}</span>\n                {catItems.length > 0 && (\n                  <span className=\"tm-cat-count\">{catItems.length}</span>\n                )}\n              </button>\n            )\n          })}\n        </div>\n      </div>\n\n      {items.length > 0 && (\n        <div className=\"tm-field\">\n          <label>Added Items ({items.length})</label>\n          <div className=\"tm-added-list\">\n            {items.map((item, index) => (\n              <div key={index} className=\"tm-added-item\">\n                <div className=\"tm-added-info\">\n                  {item.isCustom && <span className=\"tm-custom-badge\">Custom</span>}\n                  <span className=\"tm-added-name\">{item.name}</span>\n                </div>\n                <div className=\"tm-added-qty\">\n                  <button onClick={() => updateItemQuantity(index, item.quantity - 1)}>{'\\u2212'}</button>\n                  <span>{item.quantity}</span>\n                  <button onClick={() => updateItemQuantity(index, item.quantity + 1)}>+</button>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","import { Camera, Link, MapPin } from 'lucide-react'\nimport { createT } from './translations'\n\n/**\n * EvidenceStep - Step 4 evidence section: photo capture/upload and COR linking.\n * This is rendered as part of the Review step (step 4) in the wizard.\n *\n * Props:\n *  - photos, onPhotoAdd, onRemovePhoto\n *  - maxPhotos\n *  - selectedCorId, setSelectedCorId\n *  - assignableCORs\n *  - lang\n */\nexport default function EvidenceStep({\n  photos, onPhotoAdd, onRemovePhoto,\n  maxPhotos: _maxPhotos,\n  selectedCorId, setSelectedCorId,\n  assignableCORs,\n  lang\n}) {\n  const t = createT(lang)\n\n  return (\n    <>\n      {/* PHOTOS - Prominent Action Card */}\n      <div className={`tm-action-card-prominent ${photos.length > 0 ? 'has-content' : 'needs-action'}`}>\n        <div className=\"tm-action-card-header\">\n          <div className=\"tm-action-card-icon\">\n            <Camera size={24} />\n          </div>\n          <div className=\"tm-action-card-title\">\n            <h4>{t('photoEvidence')}</h4>\n            <span className=\"tm-action-card-status\">\n              {photos.length > 0\n                ? `${photos.length} ${t('photosAdded')}`\n                : t('recommendedForBilling')\n              }\n            </span>\n          </div>\n        </div>\n        {photos.length > 0 && (\n          <div className=\"tm-photo-preview-row\">\n            {photos.map(photo => (\n              <div key={photo.id} className=\"tm-photo-preview-thumb\">\n                <img src={photo.previewUrl} alt={photo.name} />\n                {photo.latitude && <span className=\"tm-photo-gps-badge\" title={`${photo.latitude.toFixed(4)}, ${photo.longitude.toFixed(4)}`}><MapPin size={10} /></span>}\n                <button className=\"tm-photo-remove-x\" onClick={() => onRemovePhoto(photo.id)}>{'\\u00d7'}</button>\n              </div>\n            ))}\n          </div>\n        )}\n        <label className={`tm-action-card-btn ${photos.length === 0 ? 'primary' : ''}`}>\n          <input\n            type=\"file\"\n            accept=\"image/*\"\n            multiple\n            onChange={onPhotoAdd}\n            style={{ display: 'none' }}\n          />\n          <Camera size={18} />\n          <span>{photos.length > 0 ? t('addMorePhotos') : t('addPhotos')}</span>\n        </label>\n      </div>\n\n      {/* COR LINKING - Prominent Action Card */}\n      <div className={`tm-action-card-prominent ${selectedCorId ? 'has-content' : ''}`}>\n        <div className=\"tm-action-card-header\">\n          <div className=\"tm-action-card-icon cor\">\n            <Link size={24} />\n          </div>\n          <div className=\"tm-action-card-title\">\n            <h4>{t('linkToChangeOrder')}</h4>\n            <span className=\"tm-action-card-status\">\n              {selectedCorId\n                ? `${t('linkedTo')}: ${assignableCORs.find(c => c.id === selectedCorId)?.cor_number || ''}`\n                : t('optionalLinkCOR')\n              }\n            </span>\n          </div>\n        </div>\n        <select\n          value={selectedCorId}\n          onChange={(e) => setSelectedCorId(e.target.value)}\n          className=\"tm-cor-select-prominent\"\n        >\n          <option value=\"\">{t('selectCOROptional')}</option>\n          {assignableCORs.map(cor => (\n            <option key={cor.id} value={cor.id}>\n              {cor.cor_number}: {cor.title || 'Untitled'} ({cor.status})\n            </option>\n          ))}\n        </select>\n        {assignableCORs.length === 0 && (\n          <p className=\"tm-cor-hint\">{t('noActiveCORs')}</p>\n        )}\n      </div>\n    </>\n  )\n}\n","import { lazy, Suspense } from 'react'\nimport { FileText, HardHat, UserCheck, Wrench, Zap, PenLine, CheckCircle2, Check, AlertCircle, Loader2, RotateCcw } from 'lucide-react'\nimport EvidenceStep from './EvidenceStep'\n\nconst SignatureLinkGenerator = lazy(() => import('../SignatureLinkGenerator'))\nconst TMClientSignature = lazy(() => import('../TMClientSignature'))\n\n/**\n * ReviewStep - Step 4 (review+evidence+submit) and Step 5 (success/signature).\n *\n * Props:\n *  - step: 4 or 5\n *  - setStep\n *  - project, companyId\n *  - workDate, cePcoNumber, notes\n *  - photos, onPhotoAdd, onRemovePhoto, maxPhotos\n *  - selectedCorId, setSelectedCorId, assignableCORs\n *  - items\n *  - hasCustomLaborClasses\n *  - validDynamicWorkersList, validSupervision, validOperators, validLaborers\n *  - totalWorkers, totalRegHours, totalOTHours\n *  - submittedByName, setSubmittedByName\n *  - submittedTicket\n *  - submitting, submitProgress\n *  - clientSigned, setClientSigned\n *  - showSignatureLinkModal, setShowSignatureLinkModal\n *  - showOnSiteSignature, setShowOnSiteSignature\n *  - onRetryPhotoUpload\n *  - t, lang\n *  - onShowToast\n */\nexport default function ReviewStep({\n  step, setStep,\n  project, companyId,\n  workDate, cePcoNumber, notes,\n  photos, onPhotoAdd, onRemovePhoto, maxPhotos,\n  selectedCorId, setSelectedCorId, assignableCORs,\n  items,\n  hasCustomLaborClasses,\n  validDynamicWorkersList, validSupervision, validOperators, validLaborers,\n  totalWorkers, totalRegHours, totalOTHours,\n  submittedByName, setSubmittedByName,\n  submittedTicket,\n  submitting: _submitting, submitProgress: _submitProgress,\n  clientSigned, setClientSigned,\n  showSignatureLinkModal, setShowSignatureLinkModal,\n  showOnSiteSignature, setShowOnSiteSignature,\n  onRetryPhotoUpload,\n  t, lang,\n  onShowToast\n}) {\n  // Step 5: Success & Client Signature\n  if (step === 5 && submittedTicket) {\n    return (\n      <div className=\"tm-step-content tm-success-step\">\n        <div className=\"tm-success-header\">\n          <div className=\"tm-success-icon\">\n            <CheckCircle2 size={48} />\n          </div>\n          <h2>{t('tmSubmitted')}</h2>\n          <p className=\"tm-success-subtitle\">\n            {t('ticketSavedReady')}\n          </p>\n        </div>\n\n        <div className=\"tm-success-summary\">\n          <div className=\"tm-success-stat\">\n            <span className=\"tm-success-stat-value\">{totalWorkers}</span>\n            <span className=\"tm-success-stat-label\">{t('workersLabel')}</span>\n          </div>\n          <div className=\"tm-success-stat\">\n            <span className=\"tm-success-stat-value\">{totalRegHours + totalOTHours}</span>\n            <span className=\"tm-success-stat-label\">{t('totalHours')}</span>\n          </div>\n          <div className=\"tm-success-stat\">\n            <span className=\"tm-success-stat-value\">{new Date(workDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>\n            <span className=\"tm-success-stat-label\">{t('workDate')}</span>\n          </div>\n        </div>\n\n        {/* Failed Photos Retry Section */}\n        {photos.some(p => p.status === 'failed') && (\n          <div className=\"tm-failed-photos-section\">\n            <div className=\"tm-failed-photos-header\">\n              <AlertCircle size={18} />\n              <span>\n                {lang === 'en'\n                  ? `${photos.filter(p => p.status === 'failed').length} photo(s) failed to upload`\n                  : `${photos.filter(p => p.status === 'failed').length} foto(s) no se subieron`}\n              </span>\n            </div>\n            <div className=\"tm-failed-photos-grid\">\n              {photos.filter(p => p.status === 'failed').map(photo => (\n                <div key={photo.id} className=\"tm-failed-photo-item\">\n                  <img src={photo.previewUrl} alt={photo.name} />\n                  <div className=\"tm-failed-photo-overlay\">\n                    <button\n                      className=\"tm-retry-photo-btn\"\n                      onClick={() => onRetryPhotoUpload(photo.id, submittedTicket.id)}\n                      disabled={photo.status === 'uploading' || photo.status === 'compressing'}\n                    >\n                      {photo.status === 'uploading' || photo.status === 'compressing' ? (\n                        <Loader2 size={16} className=\"tm-spinner\" />\n                      ) : (\n                        <>\n                          <RotateCcw size={16} />\n                          <span>{t('retry')}</span>\n                        </>\n                      )}\n                    </button>\n                  </div>\n                  {photo.error && (\n                    <div className=\"tm-failed-photo-error\" title={photo.error}>\n                      {photo.error.substring(0, 20)}{photo.error.length > 20 ? '...' : ''}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n            <button\n              className=\"tm-retry-all-btn\"\n              onClick={async () => {\n                const failedPhotos = photos.filter(p => p.status === 'failed')\n                for (const photo of failedPhotos) {\n                  await onRetryPhotoUpload(photo.id, submittedTicket.id)\n                }\n              }}\n            >\n              <RotateCcw size={16} />\n              {t('retryAllPhotos')}\n            </button>\n          </div>\n        )}\n\n        {/* Photo Upload Success Indicator */}\n        {photos.length > 0 && photos.every(p => p.status === 'confirmed') && (\n          <div className=\"tm-photos-success\">\n            <Check size={16} />\n            <span>\n              {lang === 'en'\n                ? `All ${photos.length} photo(s) uploaded successfully`\n                : `${photos.length} foto(s) subidas exitosamente`}\n            </span>\n          </div>\n        )}\n\n        <div className=\"tm-signature-options\">\n          <h3>{t('getClientSignature')}</h3>\n          <p className=\"tm-signature-description\">\n            {t('signatureDescription')}\n          </p>\n\n          {clientSigned ? (\n            <div className=\"tm-signed-confirmation\">\n              <CheckCircle2 size={32} className=\"tm-signed-icon\" />\n              <span>{t('clientSignatureCollected')}</span>\n            </div>\n          ) : (\n            <div className=\"tm-signature-buttons\">\n              <button\n                className=\"tm-signature-option-btn primary\"\n                onClick={() => setShowOnSiteSignature(true)}\n              >\n                <div className=\"tm-signature-option-icon\">\n                  <PenLine size={24} />\n                </div>\n                <div className=\"tm-signature-option-text\">\n                  <span className=\"tm-signature-option-title\">\n                    {t('signNowOnSite')}\n                  </span>\n                  <span className=\"tm-signature-option-desc\">\n                    {t('clientSignsDevice')}\n                  </span>\n                </div>\n              </button>\n\n              <button\n                className=\"tm-signature-option-btn\"\n                onClick={() => setShowSignatureLinkModal(true)}\n              >\n                <div className=\"tm-signature-option-icon\">\n                  <PenLine size={24} />\n                </div>\n                <div className=\"tm-signature-option-text\">\n                  <span className=\"tm-signature-option-title\">\n                    {t('sendSignatureLink')}\n                  </span>\n                  <span className=\"tm-signature-option-desc\">\n                    {t('clientSignsLater')}\n                  </span>\n                </div>\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Signature Link Generator Modal */}\n        {showSignatureLinkModal && (\n          <Suspense fallback={<div className=\"loading\">Loading...</div>}>\n            <SignatureLinkGenerator\n              documentType=\"tm_ticket\"\n              documentId={submittedTicket.id}\n              companyId={companyId}\n              projectId={project.id}\n              project={project}\n              documentTitle={`T&M - ${new Date(workDate).toLocaleDateString()}`}\n              onClose={() => setShowSignatureLinkModal(false)}\n              onShowToast={onShowToast}\n            />\n          </Suspense>\n        )}\n\n        {/* On-Site Client Signature Modal */}\n        {showOnSiteSignature && (\n          <Suspense fallback={<div className=\"loading\">Loading...</div>}>\n            <TMClientSignature\n              ticketId={submittedTicket.id}\n              ticketSummary={{\n                workDate: workDate,\n                workerCount: totalWorkers,\n                totalHours: totalRegHours + totalOTHours\n              }}\n              lang={lang}\n              onSave={() => {\n                setShowOnSiteSignature(false)\n                setClientSigned(true)\n              }}\n              onClose={() => setShowOnSiteSignature(false)}\n              onShowToast={onShowToast}\n            />\n          </Suspense>\n        )}\n      </div>\n    )\n  }\n\n  // Step 4: Review (includes Evidence + Summary + Certification)\n  return (\n    <div className=\"tm-step-content\">\n      {/* Evidence section (photos + COR linking) */}\n      <EvidenceStep\n        photos={photos}\n        onPhotoAdd={onPhotoAdd}\n        onRemovePhoto={onRemovePhoto}\n        maxPhotos={maxPhotos}\n        selectedCorId={selectedCorId}\n        setSelectedCorId={setSelectedCorId}\n        assignableCORs={assignableCORs}\n        lang={lang}\n      />\n\n      <div className=\"tm-review-divider\">\n        <span>{t('ticketSummary')}</span>\n      </div>\n\n      {/* Work Info Summary */}\n      <div className=\"tm-review-section\">\n        <div className=\"tm-review-section-header\">\n          <h4>{'\\ud83d\\udcc5'} {t('workDate')}</h4>\n          <button className=\"tm-edit-link\" onClick={() => setStep(1)}>{t('edit')}</button>\n        </div>\n        <div className=\"tm-review-row\">\n          <span>{new Date(workDate).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</span>\n          {cePcoNumber && <span>CE/PCO: {cePcoNumber}</span>}\n        </div>\n      </div>\n\n      {/* Description */}\n      {notes && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4><FileText size={16} className=\"inline-icon\" /> {t('notes')}</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(1)}>{t('edit')}</button>\n          </div>\n          <div className=\"tm-review-notes\">{notes}</div>\n        </div>\n      )}\n\n      {/* Dynamic Workers Review (when company has custom classes) */}\n      {hasCustomLaborClasses && validDynamicWorkersList.length > 0 && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4><HardHat size={16} className=\"inline-icon\" /> {t('workersLabel')} ({totalRegHours + totalOTHours} hrs)</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(2)}>{t('edit')}</button>\n          </div>\n          <div className=\"tm-review-list\">\n            {validDynamicWorkersList.map((w, i) => (\n              <div key={i} className=\"tm-review-row-detailed\">\n                <div className=\"tm-review-worker-name\">\n                  <span className=\"tm-role-badge\">{w.role}</span> {w.name}\n                </div>\n                <div className=\"tm-review-worker-details\">\n                  {w.time_started && w.time_ended && (\n                    <span className=\"tm-review-time\">{w.time_started} - {w.time_ended}</span>\n                  )}\n                  <span className=\"tm-review-hours\">{w.hours || 0} reg{w.overtime_hours > 0 ? ` + ${w.overtime_hours} OT` : ''}</span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Hardcoded Workers Review (fallback when no custom classes) */}\n      {!hasCustomLaborClasses && validSupervision.length > 0 && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4><UserCheck size={16} className=\"inline-icon\" /> Supervision ({validSupervision.reduce((sum, s) => sum + parseFloat(s.hours || 0) + parseFloat(s.overtimeHours || 0), 0)} hrs)</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(2)}>{t('edit')}</button>\n          </div>\n          <div className=\"tm-review-list\">\n            {validSupervision.map((s, i) => (\n              <div key={i} className=\"tm-review-row-detailed\">\n                <div className=\"tm-review-worker-name\">\n                  <span className=\"tm-role-badge\">{s.role}</span> {s.name}\n                </div>\n                <div className=\"tm-review-worker-details\">\n                  {s.timeStarted && s.timeEnded && (\n                    <span className=\"tm-review-time\">{s.timeStarted} - {s.timeEnded}</span>\n                  )}\n                  <span className=\"tm-review-hours\">{s.hours || 0} reg{parseFloat(s.overtimeHours) > 0 ? ` + ${s.overtimeHours} OT` : ''}</span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {!hasCustomLaborClasses && validOperators.length > 0 && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4>{'\\ud83d\\ude9c'} Operators ({validOperators.reduce((sum, o) => sum + parseFloat(o.hours || 0) + parseFloat(o.overtimeHours || 0), 0)} hrs)</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(2)}>{t('edit')}</button>\n          </div>\n          <div className=\"tm-review-list\">\n            {validOperators.map((o, i) => (\n              <div key={i} className=\"tm-review-row-detailed\">\n                <div className=\"tm-review-worker-name\">{o.name}</div>\n                <div className=\"tm-review-worker-details\">\n                  {o.timeStarted && o.timeEnded && (\n                    <span className=\"tm-review-time\">{o.timeStarted} - {o.timeEnded}</span>\n                  )}\n                  <span className=\"tm-review-hours\">{o.hours || 0} reg{parseFloat(o.overtimeHours) > 0 ? ` + ${o.overtimeHours} OT` : ''}</span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {!hasCustomLaborClasses && validLaborers.length > 0 && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4><HardHat size={16} className=\"inline-icon\" /> Laborers ({validLaborers.reduce((sum, l) => sum + parseFloat(l.hours || 0) + parseFloat(l.overtimeHours || 0), 0)} hrs)</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(2)}>{t('edit')}</button>\n          </div>\n          <div className=\"tm-review-list\">\n            {validLaborers.map((l, i) => (\n              <div key={i} className=\"tm-review-row-detailed\">\n                <div className=\"tm-review-worker-name\">{l.name}</div>\n                <div className=\"tm-review-worker-details\">\n                  {l.timeStarted && l.timeEnded && (\n                    <span className=\"tm-review-time\">{l.timeStarted} - {l.timeEnded}</span>\n                  )}\n                  <span className=\"tm-review-hours\">{l.hours || 0} reg{parseFloat(l.overtimeHours) > 0 ? ` + ${l.overtimeHours} OT` : ''}</span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {items.length > 0 && (\n        <div className=\"tm-review-section\">\n          <div className=\"tm-review-section-header\">\n            <h4><Wrench size={16} className=\"inline-icon\" /> Materials & Equipment ({items.length} items)</h4>\n            <button className=\"tm-edit-link\" onClick={() => setStep(3)}>{t('edit')}</button>\n          </div>\n          <div className=\"tm-review-list\">\n            {items.map((item, i) => (\n              <div key={i} className=\"tm-review-row\">\n                <span>{item.isCustom && <><Zap size={14} className=\"inline-icon\" /> </>}{item.name}</span>\n                <span>{item.quantity} {item.unit}</span>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Submitted By - Certification */}\n      <div className=\"tm-review-section tm-certification\">\n        <div className=\"tm-review-header\">\n          <span><PenLine size={16} className=\"inline-icon\" /> {t('submittedBy')}</span>\n        </div>\n        <input\n          type=\"text\"\n          className=\"tm-certification-input\"\n          placeholder={t('enterYourName')}\n          value={submittedByName}\n          onChange={(e) => setSubmittedByName(e.target.value)}\n        />\n        <p className=\"tm-certification-note\">\n          {t('certifyAccurate')}\n        </p>\n      </div>\n    </div>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { Globe, Check, Loader2, PenLine, AlertCircle, CheckCircle2 } from 'lucide-react'\nimport { db } from '../lib/supabase'\nimport { compressImage, getGPSLocation } from '../lib/imageUtils'\nimport { TRANSLATIONS } from './tm/translations'\nimport WorkDetailsStep from './tm/WorkDetailsStep'\nimport CrewHoursStep from './tm/CrewHoursStep'\nimport MaterialsStep from './tm/MaterialsStep'\nimport ReviewStep from './tm/ReviewStep'\n\n// Generate secure random ID\nconst generateRandomId = () => {\n  const array = new Uint8Array(6)\n  crypto.getRandomValues(array)\n  return Array.from(array, b => b.toString(36)).join('')\n}\n\n// Calculate hours from time range (auto-split into regular + OT)\nconst calculateHoursFromTimeRange = (startTime, endTime) => {\n  if (!startTime || !endTime) return null\n\n  const [startHour, startMin] = startTime.split(':').map(Number)\n  const [endHour, endMin] = endTime.split(':').map(Number)\n\n  let totalMinutes = (endHour * 60 + endMin) - (startHour * 60 + startMin)\n  if (totalMinutes < 0) totalMinutes += 24 * 60 // Handle overnight\n\n  const totalHours = totalMinutes / 60\n  const regularHours = Math.min(totalHours, 8)\n  const overtimeHours = Math.max(0, totalHours - 8)\n\n  return {\n    hours: regularHours.toFixed(1),\n    overtimeHours: overtimeHours > 0 ? overtimeHours.toFixed(1) : ''\n  }\n}\n\nexport default function TMForm({ project, companyId, maxPhotos = 10, onSubmit, onCancel, onShowToast }) {\n  const [step, setStep] = useState(1)\n  const [workDate, setWorkDate] = useState(new Date().toISOString().split('T')[0])\n\n  // Post-submit signature state\n  const [submittedTicket, setSubmittedTicket] = useState(null)\n  const [showSignatureLinkModal, setShowSignatureLinkModal] = useState(false)\n  const [showOnSiteSignature, setShowOnSiteSignature] = useState(false)\n  const [clientSigned, setClientSigned] = useState(false)\n  const [cePcoNumber, setCePcoNumber] = useState('')\n  const [submittedByName, setSubmittedByName] = useState('')\n\n  // COR assignment state\n  const [selectedCorId, setSelectedCorId] = useState('')\n  const [assignableCORs, setAssignableCORs] = useState([])\n  const [_loadingCORs, setLoadingCORs] = useState(false)\n\n  // Batch hours modal state\n  const [showBatchHoursModal, setShowBatchHoursModal] = useState(false)\n  const [batchHours, setBatchHours] = useState({ timeStarted: '', timeEnded: '', hours: '', overtimeHours: '' })\n  const [supervision, setSupervision] = useState([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '', role: 'Foreman' }])\n  const [operators, setOperators] = useState([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n  const [laborers, setLaborers] = useState([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n  const [items, setItems] = useState([])\n  const [notes, setNotes] = useState('')\n  const [photos, setPhotos] = useState([])\n  const [submitting, setSubmitting] = useState(false)\n  const [submitProgress, setSubmitProgress] = useState('')\n\n  // Crew check-in state\n  const [todaysCrew, setTodaysCrew] = useState([])\n\n  // Same as Yesterday state\n  const [loadingPreviousCrew, setLoadingPreviousCrew] = useState(false)\n\n  // Language state\n  const [lang, setLang] = useState('en')\n  const t = (key) => TRANSLATIONS[lang][key] || key\n\n  // Dynamic labor classes state\n  const [laborCategories, setLaborCategories] = useState([])\n  const [laborClasses, setLaborClasses] = useState([])\n  const [dynamicWorkers, setDynamicWorkers] = useState({})\n  const [loadingLaborClasses, setLoadingLaborClasses] = useState(true)\n  const [activeLaborClassIds, setActiveLaborClassIds] = useState(new Set())\n\n  const hasCustomLaborClasses = laborClasses.length > 0\n\n  // Load today's crew and assignable CORs on mount\n  useEffect(() => {\n    loadTodaysCrew()\n    loadAssignableCORs()\n\n    const corSub = db.subscribeToCORs?.(project.id, () => {\n      loadAssignableCORs()\n    })\n\n    return () => {\n      corSub?.unsubscribe?.()\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [project.id])\n\n  // Load custom labor classes for the company\n  useEffect(() => {\n    const loadLaborClasses = async () => {\n      if (!companyId) {\n        setLoadingLaborClasses(false)\n        return\n      }\n\n      try {\n        const data = await db.getLaborClassesForField(companyId)\n        setLaborCategories(data.categories || [])\n        setLaborClasses(data.classes || [])\n      } catch (err) {\n        console.error('Error loading labor classes:', err)\n      } finally {\n        setLoadingLaborClasses(false)\n      }\n    }\n\n    loadLaborClasses()\n  }, [companyId])\n\n  // Initialize labor classes based on today's crew check-in\n  useEffect(() => {\n    if (loadingLaborClasses || laborClasses.length === 0) return\n\n    const crewLaborClassIds = new Set()\n    todaysCrew.forEach(worker => {\n      if (worker.labor_class_id) {\n        crewLaborClassIds.add(worker.labor_class_id)\n      }\n    })\n\n    const initialWorkers = {}\n    const activeIds = new Set()\n\n    crewLaborClassIds.forEach(classId => {\n      if (laborClasses.some(lc => lc.id === classId)) {\n        initialWorkers[classId] = [{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }]\n        activeIds.add(classId)\n      }\n    })\n\n    setDynamicWorkers(prev => {\n      if (Object.keys(prev).length === 0) {\n        return initialWorkers\n      }\n      return prev\n    })\n\n    setActiveLaborClassIds(prev => {\n      if (prev.size === 0) {\n        return activeIds\n      }\n      return prev\n    })\n  }, [laborClasses, todaysCrew, loadingLaborClasses])\n\n  // Load all CORs that can receive T&M tickets\n  const loadAssignableCORs = async () => {\n    setLoadingCORs(true)\n    try {\n      const cors = await db.getAssignableCORs(project.id)\n      setAssignableCORs(cors || [])\n    } catch (err) {\n      console.error('Error loading assignable CORs:', err)\n    } finally {\n      setLoadingCORs(false)\n    }\n  }\n\n  // Apply batch hours to all workers with names\n  const applyBatchHours = () => {\n    const { timeStarted, timeEnded, hours, overtimeHours } = batchHours\n    let updatedCount = 0\n\n    if (hasCustomLaborClasses) {\n      const updatedDynamic = {}\n      Object.entries(dynamicWorkers).forEach(([classId, workers]) => {\n        updatedDynamic[classId] = workers.map(w => {\n          if (w && w.name && w.name.trim()) {\n            updatedCount++\n            return { ...w, timeStarted, timeEnded, hours, overtimeHours }\n          }\n          return w\n        })\n      })\n      setDynamicWorkers(updatedDynamic)\n    } else {\n      setSupervision(supervision.map(s => {\n        if (s && s.name && s.name.trim()) {\n          updatedCount++\n          return { ...s, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return s\n      }))\n      setOperators(operators.map(o => {\n        if (o && o.name && o.name.trim()) {\n          updatedCount++\n          return { ...o, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return o\n      }))\n      setLaborers(laborers.map(l => {\n        if (l && l.name && l.name.trim()) {\n          updatedCount++\n          return { ...l, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return l\n      }))\n    }\n\n    setShowBatchHoursModal(false)\n    setBatchHours({ timeStarted: '', timeEnded: '', hours: '', overtimeHours: '' })\n\n    if (updatedCount > 0) {\n      onShowToast(t('appliedHours').replace('{count}', updatedCount), 'success')\n    } else {\n      onShowToast(t('addWorkersFirst'), 'info')\n    }\n  }\n\n  // Apply preset hours directly to all workers (inline, no modal)\n  const applyInlinePreset = (preset) => {\n    let timeStarted, timeEnded, hours, overtimeHours\n\n    switch (preset) {\n      case '8hr':\n        timeStarted = '07:00'\n        timeEnded = '15:30'\n        hours = '8'\n        overtimeHours = ''\n        break\n      case '10hr':\n        timeStarted = '06:00'\n        timeEnded = '16:30'\n        hours = '8'\n        overtimeHours = '2'\n        break\n      case '4hr':\n        timeStarted = '07:00'\n        timeEnded = '11:00'\n        hours = '4'\n        overtimeHours = ''\n        break\n      default:\n        return\n    }\n\n    let count = 0\n\n    if (hasCustomLaborClasses) {\n      const updatedDynamic = {}\n      Object.entries(dynamicWorkers).forEach(([classId, workers]) => {\n        updatedDynamic[classId] = workers.map(w => {\n          if (w && w.name && w.name.trim()) {\n            count++\n            return { ...w, timeStarted, timeEnded, hours, overtimeHours }\n          }\n          return w\n        })\n      })\n      setDynamicWorkers(updatedDynamic)\n    } else {\n      setSupervision(prev => prev.map(s => {\n        if (s && s.name && s.name.trim()) {\n          count++\n          return { ...s, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return s\n      }))\n      setOperators(prev => prev.map(o => {\n        if (o && o.name && o.name.trim()) {\n          count++\n          return { ...o, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return o\n      }))\n      setLaborers(prev => prev.map(l => {\n        if (l && l.name && l.name.trim()) {\n          count++\n          return { ...l, timeStarted, timeEnded, hours, overtimeHours }\n        }\n        return l\n      }))\n    }\n\n    if (count > 0) {\n      onShowToast(t('appliedHours').replace('{count}', count), 'success')\n    } else {\n      onShowToast(t('addWorkersFirst'), 'info')\n    }\n  }\n\n  const loadTodaysCrew = async () => {\n    try {\n      const checkin = await db.getCrewCheckin(project.id)\n      if (checkin?.workers) {\n        setTodaysCrew(checkin.workers)\n      }\n    } catch (err) {\n      console.error('Error loading crew:', err)\n    }\n  }\n\n  // Load previous ticket's crew (\"Same as Yesterday\")\n  const loadPreviousCrew = async () => {\n    setLoadingPreviousCrew(true)\n    try {\n      const previousCrew = await db.getPreviousTicketCrew(project.id, workDate)\n\n      if (!previousCrew || previousCrew.totalWorkers === 0) {\n        onShowToast(t('noPreviousCrew'), 'info')\n        return\n      }\n\n      if (hasCustomLaborClasses && previousCrew.dynamicWorkers) {\n        setDynamicWorkers(previousCrew.dynamicWorkers)\n      } else {\n        if (previousCrew.supervision) {\n          setSupervision(previousCrew.supervision)\n        }\n        if (previousCrew.operators) {\n          setOperators(previousCrew.operators)\n        }\n        if (previousCrew.laborers) {\n          setLaborers(previousCrew.laborers)\n        }\n      }\n\n      const dateStr = new Date(previousCrew.workDate).toLocaleDateString()\n      onShowToast(t('loadedWorkers').replace('{count}', previousCrew.totalWorkers).replace('{date}', dateStr), 'success')\n    } catch (error) {\n      console.error('Error loading previous crew:', error)\n      onShowToast(t('errorLoadingCrew'), 'error')\n    } finally {\n      setLoadingPreviousCrew(false)\n    }\n  }\n\n  // Supervision functions\n  const addSupervisionFn = () => {\n    setSupervision([...supervision, { name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '', role: 'Foreman' }])\n  }\n\n  const updateSupervision = (index, field, value) => {\n    setSupervision(supervision.map((s, i) => {\n      if (i !== index) return s\n      const updated = { ...s, [field]: value }\n      if (field === 'timeStarted' || field === 'timeEnded') {\n        const startTime = field === 'timeStarted' ? value : s.timeStarted\n        const endTime = field === 'timeEnded' ? value : s.timeEnded\n        const calculated = calculateHoursFromTimeRange(startTime, endTime)\n        if (calculated) {\n          updated.hours = calculated.hours\n          updated.overtimeHours = calculated.overtimeHours\n        }\n      }\n      return updated\n    }))\n  }\n\n  const removeSupervision = (index) => {\n    if (supervision.length > 1) {\n      setSupervision(supervision.filter((_, i) => i !== index))\n    } else {\n      setSupervision([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '', role: 'Foreman' }])\n    }\n  }\n\n  // Laborer functions\n  const addLaborerFn = () => {\n    setLaborers([...laborers, { name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n  }\n\n  const updateLaborer = (index, field, value) => {\n    setLaborers(laborers.map((l, i) => {\n      if (i !== index) return l\n      const updated = { ...l, [field]: value }\n      if (field === 'timeStarted' || field === 'timeEnded') {\n        const startTime = field === 'timeStarted' ? value : l.timeStarted\n        const endTime = field === 'timeEnded' ? value : l.timeEnded\n        const calculated = calculateHoursFromTimeRange(startTime, endTime)\n        if (calculated) {\n          updated.hours = calculated.hours\n          updated.overtimeHours = calculated.overtimeHours\n        }\n      }\n      return updated\n    }))\n  }\n\n  const removeLaborer = (index) => {\n    if (laborers.length > 1) {\n      setLaborers(laborers.filter((_, i) => i !== index))\n    } else {\n      setLaborers([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n    }\n  }\n\n  // Operator functions\n  const addOperatorFn = () => {\n    setOperators([...operators, { name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n  }\n\n  const updateOperator = (index, field, value) => {\n    setOperators(operators.map((o, i) => {\n      if (i !== index) return o\n      const updated = { ...o, [field]: value }\n      if (field === 'timeStarted' || field === 'timeEnded') {\n        const startTime = field === 'timeStarted' ? value : o.timeStarted\n        const endTime = field === 'timeEnded' ? value : o.timeEnded\n        const calculated = calculateHoursFromTimeRange(startTime, endTime)\n        if (calculated) {\n          updated.hours = calculated.hours\n          updated.overtimeHours = calculated.overtimeHours\n        }\n      }\n      return updated\n    }))\n  }\n\n  const removeOperator = (index) => {\n    if (operators.length > 1) {\n      setOperators(operators.filter((_, i) => i !== index))\n    } else {\n      setOperators([{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n    }\n  }\n\n  // Dynamic worker functions (for custom labor classes)\n  const addDynamicWorker = (classId) => {\n    setDynamicWorkers(prev => ({\n      ...prev,\n      [classId]: [...(prev[classId] || []), { name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }]\n    }))\n  }\n\n  const updateDynamicWorker = (classId, index, field, value) => {\n    setDynamicWorkers(prev => ({\n      ...prev,\n      [classId]: (prev[classId] || []).map((w, i) => {\n        if (i !== index) return w\n        const updated = { ...w, [field]: value }\n        if (field === 'timeStarted' || field === 'timeEnded') {\n          const startTime = field === 'timeStarted' ? value : w.timeStarted\n          const endTime = field === 'timeEnded' ? value : w.timeEnded\n          const calculated = calculateHoursFromTimeRange(startTime, endTime)\n          if (calculated) {\n            updated.hours = calculated.hours\n            updated.overtimeHours = calculated.overtimeHours\n          }\n        }\n        return updated\n      })\n    }))\n  }\n\n  const removeDynamicWorker = (classId, index) => {\n    setDynamicWorkers(prev => {\n      const workers = prev[classId] || []\n      if (workers.length > 1) {\n        return { ...prev, [classId]: workers.filter((_, i) => i !== index) }\n      } else {\n        return { ...prev, [classId]: [{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }] }\n      }\n    })\n  }\n\n  // Activate a labor class\n  const activateLaborClass = (classId) => {\n    if (!classId) return\n    setActiveLaborClassIds(prev => new Set([...prev, classId]))\n    setDynamicWorkers(prev => {\n      if (!prev[classId] || prev[classId].length === 0) {\n        return { ...prev, [classId]: [{ name: '', hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }] }\n      }\n      return prev\n    })\n  }\n\n  // Remove a labor class from the visible list\n  const deactivateLaborClass = (classId) => {\n    setActiveLaborClassIds(prev => {\n      const newSet = new Set(prev)\n      newSet.delete(classId)\n      return newSet\n    })\n    setDynamicWorkers(prev => {\n      const newWorkers = { ...prev }\n      delete newWorkers[classId]\n      return newWorkers\n    })\n  }\n\n  // Get labor classes not currently active\n  const getInactiveLaborClasses = () => {\n    return laborClasses.filter(lc => !activeLaborClassIds.has(lc.id))\n  }\n\n  // Get all valid dynamic workers for submission\n  const getValidDynamicWorkers = () => {\n    if (!dynamicWorkers || typeof dynamicWorkers !== 'object') return []\n    const allWorkers = []\n    Object.entries(dynamicWorkers).forEach(([classId, workers]) => {\n      if (!Array.isArray(workers)) return\n      const laborClass = laborClasses.find(lc => lc.id === classId)\n      workers.forEach(w => {\n        if (w && w.name && w.name.trim() && (parseFloat(w.hours) > 0 || parseFloat(w.overtimeHours) > 0)) {\n          allWorkers.push({\n            name: w.name.trim(),\n            hours: parseFloat(w.hours) || 0,\n            overtime_hours: parseFloat(w.overtimeHours) || 0,\n            time_started: w.timeStarted || null,\n            time_ended: w.timeEnded || null,\n            role: laborClass?.name || 'Worker',\n            labor_class_id: classId\n          })\n        }\n      })\n    })\n    return allWorkers\n  }\n\n  // Handle adding a crew worker from todaysCrew to the appropriate section\n  const handleAddCrewWorker = (worker) => {\n    const validLaborClass = worker.labor_class_id && hasCustomLaborClasses &&\n      laborClasses.some(lc => lc.id === worker.labor_class_id)\n\n    if (validLaborClass) {\n      // Worker has a matching labor class  add to that class's section\n      if (!activeLaborClassIds.has(worker.labor_class_id)) {\n        setActiveLaborClassIds(prev => new Set([...prev, worker.labor_class_id]))\n      }\n\n      const classWorkers = dynamicWorkers[worker.labor_class_id] || []\n      const emptyIndex = classWorkers.findIndex(w => !w || !w.name || !w.name.trim())\n      if (emptyIndex >= 0) {\n        const updated = [...classWorkers]\n        updated[emptyIndex] = { ...updated[emptyIndex], name: worker.name }\n        setDynamicWorkers(prev => ({ ...prev, [worker.labor_class_id]: updated }))\n      } else {\n        setDynamicWorkers(prev => ({\n          ...prev,\n          [worker.labor_class_id]: [...(prev[worker.labor_class_id] || []), {\n            name: worker.name, hours: '', overtimeHours: '', timeStarted: '', timeEnded: ''\n          }]\n        }))\n      }\n    } else if (hasCustomLaborClasses) {\n      // Company uses custom labor classes but this worker has no matching class.\n      // Route to the first active class, or activate and use the first available class.\n      const firstActiveId = [...activeLaborClassIds][0]\n      const targetClassId = firstActiveId || laborClasses[0]?.id\n\n      if (targetClassId) {\n        if (!activeLaborClassIds.has(targetClassId)) {\n          setActiveLaborClassIds(prev => new Set([...prev, targetClassId]))\n        }\n        const classWorkers = dynamicWorkers[targetClassId] || []\n        const emptyIndex = classWorkers.findIndex(w => !w || !w.name || !w.name.trim())\n        if (emptyIndex >= 0) {\n          const updated = [...classWorkers]\n          updated[emptyIndex] = { ...updated[emptyIndex], name: worker.name }\n          setDynamicWorkers(prev => ({ ...prev, [targetClassId]: updated }))\n        } else {\n          setDynamicWorkers(prev => ({\n            ...prev,\n            [targetClassId]: [...(prev[targetClassId] || []), {\n              name: worker.name, hours: '', overtimeHours: '', timeStarted: '', timeEnded: ''\n            }]\n          }))\n        }\n      }\n    } else {\n      // No custom labor classes  use legacy role-based sections\n      const role = (worker.role || '').toLowerCase()\n\n      if (role.includes('foreman') || role.includes('supervisor') || role.includes('superintendent')) {\n        const emptySupIndex = supervision.findIndex(s => !s || !s.name || !s.name.trim())\n        if (emptySupIndex >= 0) {\n          updateSupervision(emptySupIndex, 'name', worker.name)\n          updateSupervision(emptySupIndex, 'role', role.includes('superintendent') ? 'Superintendent' : 'Foreman')\n        } else {\n          setSupervision([...supervision, {\n            name: worker.name, hours: '', overtimeHours: '', timeStarted: '', timeEnded: '',\n            role: role.includes('superintendent') ? 'Superintendent' : 'Foreman'\n          }])\n        }\n      } else if (role.includes('operator')) {\n        const emptyOpIndex = operators.findIndex(o => !o || !o.name || !o.name.trim())\n        if (emptyOpIndex >= 0) {\n          updateOperator(emptyOpIndex, 'name', worker.name)\n        } else {\n          setOperators([...operators, { name: worker.name, hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n        }\n      } else {\n        const emptyLabIndex = laborers.findIndex(l => !l || !l.name || !l.name.trim())\n        if (emptyLabIndex >= 0) {\n          updateLaborer(emptyLabIndex, 'name', worker.name)\n        } else {\n          setLaborers([...laborers, { name: worker.name, hours: '', overtimeHours: '', timeStarted: '', timeEnded: '' }])\n        }\n      }\n    }\n    onShowToast(`Added ${worker.name}`, 'success')\n  }\n\n  // Photo functions\n  const handlePhotoAdd = async (e) => {\n    const files = Array.from(e.target.files)\n    if (files.length === 0) return\n\n    const remainingSlots = maxPhotos === -1 ? Infinity : maxPhotos - photos.length\n    if (remainingSlots <= 0) {\n      onShowToast(`Photo limit reached (${maxPhotos} max)`, 'error')\n      e.target.value = ''\n      return\n    }\n\n    const filesToAdd = files.slice(0, remainingSlots)\n    if (filesToAdd.length < files.length) {\n      onShowToast(`Only ${filesToAdd.length} photo(s) added (${maxPhotos} max)`, 'error')\n    }\n\n    // Capture GPS location (non-blocking  resolves to null if unavailable)\n    const gps = await getGPSLocation()\n\n    const MAX_FILE_SIZE = 10 * 1024 * 1024\n\n    filesToAdd.forEach(file => {\n      if (!file.type.startsWith('image/')) {\n        onShowToast('Please select an image file', 'error')\n        return\n      }\n      if (file.size > MAX_FILE_SIZE) {\n        onShowToast(`Photo too large: ${file.name} (max 10MB)`, 'error')\n        return\n      }\n\n      const previewUrl = URL.createObjectURL(file)\n      const tempId = `photo-${Date.now()}-${generateRandomId()}`\n      setPhotos(prev => [...prev, {\n        id: `${Date.now()}-${generateRandomId()}`,\n        tempId: tempId,\n        file: file,\n        previewUrl: previewUrl,\n        name: file.name,\n        status: 'pending',\n        attempts: 0,\n        error: null,\n        uploadedUrl: null,\n        latitude: gps?.latitude || null,\n        longitude: gps?.longitude || null,\n        gpsAccuracy: gps?.accuracy || null\n      }])\n    })\n\n    e.target.value = ''\n  }\n\n  const updatePhotoStatus = (photoId, updates) => {\n    setPhotos(prev => prev.map(p =>\n      p.id === photoId ? { ...p, ...updates } : p\n    ))\n  }\n\n  const retryPhotoUpload = async (photoId, ticketId) => {\n    const photo = photos.find(p => p.id === photoId)\n    if (!photo || photo.status !== 'failed') return\n\n    updatePhotoStatus(photoId, { status: 'compressing', error: null })\n\n    try {\n      let fileToUpload = photo.file\n      try {\n        fileToUpload = await compressImage(photo.file)\n      } catch (err) {\n        console.warn('Compression failed, using original:', err)\n      }\n\n      updatePhotoStatus(photoId, { status: 'uploading' })\n\n      const url = await db.uploadPhoto(companyId, project.id, ticketId, fileToUpload)\n\n      updatePhotoStatus(photoId, {\n        status: 'confirmed',\n        uploadedUrl: url,\n        attempts: photo.attempts + 1\n      })\n\n      await db.updateTMTicketPhotos(ticketId, [...photos.filter(p => p.uploadedUrl).map(p => p.uploadedUrl), url])\n\n      onShowToast('Photo uploaded successfully', 'success')\n    } catch (err) {\n      console.error('Retry failed:', err)\n      updatePhotoStatus(photoId, {\n        status: 'failed',\n        error: err.message || 'Upload failed',\n        attempts: photo.attempts + 1\n      })\n      onShowToast('Photo retry failed', 'error')\n    }\n  }\n\n  const removePhoto = (photoId) => {\n    const photo = photos.find(p => p.id === photoId)\n    if (photo?.previewUrl) {\n      URL.revokeObjectURL(photo.previewUrl)\n    }\n    setPhotos(photos.filter(p => p.id !== photoId))\n  }\n\n  // Computed values for summaries\n  const validSupervision = supervision.filter(s => s && s.name && s.name.trim() && (parseFloat(s.hours) > 0 || parseFloat(s.overtimeHours) > 0))\n  const validOperators = operators.filter(o => o && o.name && o.name.trim() && (parseFloat(o.hours) > 0 || parseFloat(o.overtimeHours) > 0))\n  const validLaborers = laborers.filter(l => l && l.name && l.name.trim() && (parseFloat(l.hours) > 0 || parseFloat(l.overtimeHours) > 0))\n  const validDynamicWorkersList = getValidDynamicWorkers()\n\n  const totalWorkers = hasCustomLaborClasses\n    ? validDynamicWorkersList.length\n    : validSupervision.length + validOperators.length + validLaborers.length\n  const totalRegHours = hasCustomLaborClasses\n    ? validDynamicWorkersList.reduce((sum, w) => sum + (w.hours || 0), 0)\n    : [...validSupervision, ...validOperators, ...validLaborers].reduce((sum, w) => sum + parseFloat(w.hours || 0), 0)\n  const totalOTHours = hasCustomLaborClasses\n    ? validDynamicWorkersList.reduce((sum, w) => sum + (w.overtime_hours || 0), 0)\n    : [...validSupervision, ...validOperators, ...validLaborers].reduce((sum, w) => sum + parseFloat(w.overtimeHours || 0), 0)\n\n  const namedWorkers = hasCustomLaborClasses\n    ? Object.values(dynamicWorkers || {}).flat().filter(w => w && w.name && w.name.trim())\n    : [\n        ...supervision.filter(s => s && s.name && s.name.trim()),\n        ...operators.filter(o => o && o.name && o.name.trim()),\n        ...laborers.filter(l => l && l.name && l.name.trim())\n      ]\n  const workersNeedingHours = namedWorkers.length - totalWorkers\n\n  // Navigation\n  const canGoNext = () => {\n    if (step === 1) return notes.trim().length > 0\n    if (step === 2) {\n      if (hasCustomLaborClasses) return getValidDynamicWorkers().length > 0\n      const hasSupervision = supervision.some(s => s && s.name && s.name.trim() && (parseFloat(s.hours) > 0 || parseFloat(s.overtimeHours) > 0))\n      const hasOperators = operators.some(o => o && o.name && o.name.trim() && (parseFloat(o.hours) > 0 || parseFloat(o.overtimeHours) > 0))\n      const hasLaborers = laborers.some(l => l && l.name && l.name.trim() && (parseFloat(l.hours) > 0 || parseFloat(l.overtimeHours) > 0))\n      return hasSupervision || hasOperators || hasLaborers\n    }\n    return true\n  }\n\n  // Validation warnings\n  const getValidationWarnings = () => {\n    const warnings = []\n    if (step === 1 && !notes.trim()) {\n      warnings.push(t('descriptionRecommended'))\n    }\n    if (step === 2 && workersNeedingHours > 0) {\n      warnings.push(`${workersNeedingHours} ${t('workersNoHours')}`)\n    }\n    if (step === 4 && !submittedByName.trim()) {\n      warnings.push(t('nameRequired'))\n    }\n    return warnings\n  }\n\n  const validationWarnings = getValidationWarnings()\n\n  const goNext = () => {\n    if (step < 4) setStep(step + 1)\n  }\n\n  const goBack = () => {\n    if (step > 1) {\n      setStep(step - 1)\n    } else {\n      onCancel()\n    }\n  }\n\n  // Submit\n  const handleSubmit = async () => {\n    if (!submittedByName.trim()) {\n      onShowToast('Enter your name to submit', 'error')\n      return\n    }\n\n    let allWorkersForSubmit = []\n\n    if (hasCustomLaborClasses) {\n      allWorkersForSubmit = getValidDynamicWorkers()\n      if (allWorkersForSubmit.length === 0) {\n        onShowToast('Add at least one worker', 'error')\n        return\n      }\n    } else {\n      const vs = supervision.filter(s => s && s.name && s.name.trim() && (parseFloat(s.hours) > 0 || parseFloat(s.overtimeHours) > 0))\n      const vo = operators.filter(o => o && o.name && o.name.trim() && (parseFloat(o.hours) > 0 || parseFloat(o.overtimeHours) > 0))\n      const vl = laborers.filter(l => l && l.name && l.name.trim() && (parseFloat(l.hours) > 0 || parseFloat(l.overtimeHours) > 0))\n\n      if (vs.length === 0 && vo.length === 0 && vl.length === 0) {\n        onShowToast('Add at least one worker', 'error')\n        return\n      }\n\n      allWorkersForSubmit = [\n        ...vs.map(s => ({ name: s.name.trim(), hours: parseFloat(s.hours) || 0, overtime_hours: parseFloat(s.overtimeHours) || 0, time_started: s.timeStarted || null, time_ended: s.timeEnded || null, role: s.role })),\n        ...vo.map(o => ({ name: o.name.trim(), hours: parseFloat(o.hours) || 0, overtime_hours: parseFloat(o.overtimeHours) || 0, time_started: o.timeStarted || null, time_ended: o.timeEnded || null, role: 'Operator' })),\n        ...vl.map(l => ({ name: l.name.trim(), hours: parseFloat(l.hours) || 0, overtime_hours: parseFloat(l.overtimeHours) || 0, time_started: l.timeStarted || null, time_ended: l.timeEnded || null, role: 'Laborer' }))\n      ]\n    }\n\n    setSubmitting(true)\n    setSubmitProgress('Creating ticket...')\n    try {\n      const ticket = await db.createTMTicket({\n        project_id: project.id,\n        work_date: workDate,\n        ce_pco_number: cePcoNumber.trim() || null,\n        assigned_cor_id: selectedCorId || null,\n        notes: notes.trim() || null,\n        photos: [],\n        created_by_name: submittedByName.trim()\n      })\n\n      if (!ticket || !ticket.id) {\n        throw new Error('Failed to create ticket - no ticket ID returned')\n      }\n\n      // Compress and upload photos\n      let photoUrls = []\n      const pendingPhotos = photos.filter(p => p.status === 'pending')\n      if (pendingPhotos.length > 0) {\n        setSubmitProgress(`Compressing ${pendingPhotos.length} photo${pendingPhotos.length > 1 ? 's' : ''}...`)\n        pendingPhotos.forEach(p => updatePhotoStatus(p.id, { status: 'compressing' }))\n\n        const compressedPhotos = await Promise.all(\n          pendingPhotos.map(async (photo) => {\n            try {\n              const compressed = await compressImage(photo.file)\n              return { ...photo, file: compressed }\n            } catch (err) {\n              console.warn(`Failed to compress photo ${photo.name}, using original:`, err)\n              return photo\n            }\n          })\n        )\n\n        setSubmitProgress(`Uploading ${pendingPhotos.length} photo${pendingPhotos.length > 1 ? 's' : ''}...`)\n        pendingPhotos.forEach(p => updatePhotoStatus(p.id, { status: 'uploading' }))\n\n        let uploadedCount = 0\n        let failedCount = 0\n        const uploadPromises = compressedPhotos.map(async (photo) => {\n          try {\n            const url = await db.uploadPhoto(companyId, project.id, ticket.id, photo.file)\n            uploadedCount++\n            setSubmitProgress(`Uploading ${uploadedCount}/${pendingPhotos.length} photos...`)\n            updatePhotoStatus(photo.id, { status: 'confirmed', uploadedUrl: url, attempts: (photo.attempts || 0) + 1 })\n            return { id: photo.id, url }\n          } catch (err) {\n            console.error(`Photo ${photo.name} upload failed:`, err)\n            failedCount++\n            updatePhotoStatus(photo.id, { status: 'failed', error: err.message || 'Upload failed', attempts: (photo.attempts || 0) + 1 })\n            return { id: photo.id, url: null, error: err.message }\n          }\n        })\n\n        const results = await Promise.all(uploadPromises)\n        photoUrls = results.filter(r => r.url !== null).map(r => r.url)\n\n        // Build GPS metadata: map photo URL  {lat, lng, accuracy}\n        const photoLocations = {}\n        for (const result of results) {\n          if (result.url) {\n            const photo = pendingPhotos.find(p => p.id === result.id)\n            if (photo?.latitude && photo?.longitude) {\n              photoLocations[result.url] = {\n                lat: photo.latitude,\n                lng: photo.longitude,\n                accuracy: photo.gpsAccuracy\n              }\n            }\n          }\n        }\n\n        if (failedCount > 0 && photoUrls.length > 0) {\n          onShowToast(`${photoUrls.length}/${pendingPhotos.length} photos uploaded. ${failedCount} failed - can retry later.`, 'warning')\n        } else if (failedCount > 0 && photoUrls.length === 0) {\n          onShowToast(`All ${failedCount} photos failed to upload - can retry after submission.`, 'error')\n        }\n\n        if (photoUrls.length > 0) {\n          setSubmitProgress('Saving photos...')\n          await db.updateTMTicketPhotos(ticket.id, photoUrls,\n            Object.keys(photoLocations).length > 0 ? photoLocations : null)\n        }\n      } else if (photoUrls.length > 0) {\n        setSubmitProgress('Saving photos...')\n        await db.updateTMTicketPhotos(ticket.id, photoUrls)\n      }\n\n      setSubmitProgress('Saving workers...')\n      await db.addTMWorkers(ticket.id, allWorkersForSubmit)\n\n      if (items.length > 0) {\n        setSubmitProgress('Saving materials...')\n        await db.addTMItems(ticket.id, items.map(item => ({\n          material_equipment_id: item.material_equipment_id,\n          custom_name: item.custom_name || null,\n          custom_category: item.custom_category || null,\n          quantity: item.quantity\n        })))\n      }\n\n      if (selectedCorId) {\n        setSubmitProgress('Importing to COR...')\n        try {\n          await db.importTicketDataToCOR(ticket.id, selectedCorId, companyId, project.work_type || 'demolition', project.job_type || 'standard')\n        } catch (importError) {\n          console.error('Error importing to COR:', importError)\n          try {\n            await db.markImportFailed(ticket.id, selectedCorId, importError?.message || 'Import failed')\n          } catch (markError) {\n            console.error('Error marking import failed:', markError)\n          }\n          onShowToast('T&M saved. COR data sync failed - retry from ticket list.', 'warning')\n        }\n      }\n\n      photos.forEach(p => {\n        if (p.previewUrl) URL.revokeObjectURL(p.previewUrl)\n      })\n\n      setSubmittedTicket(ticket)\n      onShowToast('T&M submitted!', 'success')\n      setStep(5)\n    } catch (error) {\n      console.error('Error submitting T&M:', error)\n      onShowToast('Error submitting T&M', 'error')\n    } finally {\n      setSubmitting(false)\n      setSubmitProgress('')\n    }\n  }\n\n  return (\n    <div className=\"tm-wizard\">\n      {/* Header */}\n      <div className=\"tm-wizard-header\">\n        {step < 5 ? (\n          <button className=\"tm-back-btn\" onClick={goBack}>{'\\u2190'}</button>\n        ) : (\n          <div className=\"tm-success-check\"><CheckCircle2 size={24} /></div>\n        )}\n        <h2>\n          {step === 1 && t('workInfo')}\n          {step === 2 && t('crewHours')}\n          {step === 3 && t('materialsEquipment')}\n          {step === 4 && t('review')}\n          {step === 5 && (t('submitted'))}\n        </h2>\n        <div className=\"tm-header-right\">\n          {step < 4 && (\n            <button\n              className=\"tm-lang-toggle\"\n              onClick={() => setLang(lang === 'en' ? 'es' : 'en')}\n              title={lang === 'en' ? t('switchToSpanish') : t('switchToEnglish')}\n            >\n              <Globe size={16} />\n              {lang === 'en' ? 'ES' : 'EN'}\n            </button>\n          )}\n          {step < 5 && (\n            <div className=\"tm-step-dots\">\n              <span className={`tm-dot ${step >= 1 ? 'active' : ''}`}></span>\n              <span className={`tm-dot ${step >= 2 ? 'active' : ''}`}></span>\n              <span className={`tm-dot ${step >= 3 ? 'active' : ''}`}></span>\n              <span className={`tm-dot ${step >= 4 ? 'active' : ''}`}></span>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Step 1: Work Details */}\n      {step === 1 && (\n        <WorkDetailsStep\n          project={project}\n          workDate={workDate}\n          setWorkDate={setWorkDate}\n          cePcoNumber={cePcoNumber}\n          setCePcoNumber={setCePcoNumber}\n          notes={notes}\n          setNotes={setNotes}\n          t={t}\n          lang={lang}\n        />\n      )}\n\n      {/* Step 2: Crew & Hours */}\n      {step === 2 && (\n        <CrewHoursStep\n          supervision={supervision}\n          operators={operators}\n          laborers={laborers}\n          dynamicWorkers={dynamicWorkers}\n          activeLaborClassIds={activeLaborClassIds}\n          setActiveLaborClassIds={setActiveLaborClassIds}\n          laborCategories={laborCategories}\n          laborClasses={laborClasses}\n          hasCustomLaborClasses={hasCustomLaborClasses}\n          loadingLaborClasses={loadingLaborClasses}\n          todaysCrew={todaysCrew}\n          showBatchHoursModal={showBatchHoursModal}\n          setShowBatchHoursModal={setShowBatchHoursModal}\n          batchHours={batchHours}\n          setBatchHours={setBatchHours}\n          loadingPreviousCrew={loadingPreviousCrew}\n          namedWorkers={namedWorkers}\n          workersNeedingHours={workersNeedingHours}\n          totalRegHours={totalRegHours}\n          totalOTHours={totalOTHours}\n          onLoadPreviousCrew={loadPreviousCrew}\n          onApplyBatchHours={applyBatchHours}\n          onApplyInlinePreset={applyInlinePreset}\n          onAddCrewWorker={handleAddCrewWorker}\n          onActivateLaborClass={activateLaborClass}\n          onDeactivateLaborClass={deactivateLaborClass}\n          addSupervision={addSupervisionFn}\n          updateSupervision={updateSupervision}\n          removeSupervision={removeSupervision}\n          addOperator={addOperatorFn}\n          updateOperator={updateOperator}\n          removeOperator={removeOperator}\n          addLaborer={addLaborerFn}\n          updateLaborer={updateLaborer}\n          removeLaborer={removeLaborer}\n          addDynamicWorker={addDynamicWorker}\n          updateDynamicWorker={updateDynamicWorker}\n          removeDynamicWorker={removeDynamicWorker}\n          getInactiveLaborClasses={getInactiveLaborClasses}\n          t={t}\n          lang={lang}\n          onShowToast={onShowToast}\n        />\n      )}\n\n      {/* Step 3: Materials & Equipment */}\n      {step === 3 && (\n        <MaterialsStep\n          companyId={companyId}\n          items={items}\n          setItems={setItems}\n          t={t}\n          lang={lang}\n          onShowToast={onShowToast}\n        />\n      )}\n\n      {/* Step 4: Review + Evidence / Step 5: Success & Signature */}\n      {(step === 4 || step === 5) && (\n        <ReviewStep\n          step={step}\n          setStep={setStep}\n          project={project}\n          companyId={companyId}\n          workDate={workDate}\n          cePcoNumber={cePcoNumber}\n          notes={notes}\n          photos={photos}\n          onPhotoAdd={handlePhotoAdd}\n          onRemovePhoto={removePhoto}\n          maxPhotos={maxPhotos}\n          selectedCorId={selectedCorId}\n          setSelectedCorId={setSelectedCorId}\n          assignableCORs={assignableCORs}\n          items={items}\n          hasCustomLaborClasses={hasCustomLaborClasses}\n          validDynamicWorkersList={validDynamicWorkersList}\n          validSupervision={validSupervision}\n          validOperators={validOperators}\n          validLaborers={validLaborers}\n          totalWorkers={totalWorkers}\n          totalRegHours={totalRegHours}\n          totalOTHours={totalOTHours}\n          submittedByName={submittedByName}\n          setSubmittedByName={setSubmittedByName}\n          submittedTicket={submittedTicket}\n          submitting={submitting}\n          submitProgress={submitProgress}\n          clientSigned={clientSigned}\n          setClientSigned={setClientSigned}\n          showSignatureLinkModal={showSignatureLinkModal}\n          setShowSignatureLinkModal={setShowSignatureLinkModal}\n          showOnSiteSignature={showOnSiteSignature}\n          setShowOnSiteSignature={setShowOnSiteSignature}\n          onRetryPhotoUpload={retryPhotoUpload}\n          t={t}\n          lang={lang}\n          onShowToast={onShowToast}\n        />\n      )}\n\n      {/* Footer */}\n      {step < 5 && (\n        <div className=\"tm-wizard-footer\">\n          {validationWarnings.length > 0 && (\n            <div className=\"tm-validation-summary\">\n              <AlertCircle size={16} />\n              <span>{validationWarnings[0]}</span>\n            </div>\n          )}\n\n          {step === 1 && (\n            <button className=\"tm-big-btn primary\" onClick={goNext} disabled={!canGoNext()}>\n              {t('nextCrew')}\n            </button>\n          )}\n\n          {step === 2 && (\n            <button className=\"tm-big-btn primary\" onClick={goNext} disabled={!canGoNext()}>\n              {t('nextMaterials')} ({totalWorkers} {totalWorkers === 1 ? t('worker') : t('workers_plural')}, {totalRegHours + totalOTHours} hrs)\n            </button>\n          )}\n\n          {step === 3 && (\n            <>\n              <button className=\"tm-big-btn primary\" onClick={goNext}>\n                {t('reviewAndSubmit')} ({items.length} {items.length === 1 ? t('item') : t('items_plural')})\n              </button>\n              <button className=\"tm-skip-btn\" onClick={goNext}>\n                {t('skipNoMaterials')}\n              </button>\n            </>\n          )}\n\n          {step === 4 && (\n            <button\n              className={`tm-big-btn submit ${submitting ? 'submitting' : ''} ${!submittedByName.trim() ? 'needs-name' : 'ready'}`}\n              onClick={handleSubmit}\n              disabled={submitting || !submittedByName.trim()}\n            >\n              {submitting ? (\n                <>\n                  <Loader2 size={20} className=\"tm-spinner\" />\n                  <span className=\"tm-submit-text\">{submitProgress || t('submitting')}</span>\n                </>\n              ) : !submittedByName.trim() ? (\n                <>\n                  <PenLine size={18} />\n                  <span>{t('enterNameToSubmit')}</span>\n                </>\n              ) : (\n                <>\n                  <Check size={20} />\n                  <span>{t('submitTM')}</span>\n                </>\n              )}\n            </button>\n          )}\n        </div>\n      )}\n\n      {/* Step 5: Success Footer */}\n      {step === 5 && (\n        <div className=\"tm-wizard-footer\">\n          <button className=\"tm-big-btn primary\" onClick={onSubmit}>\n            <Check size={20} />\n            <span>{t('done')}</span>\n          </button>\n          <button className=\"tm-skip-btn\" onClick={onSubmit}>\n            {t('skipSignature')}\n          </button>\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect, useCallback } from 'react'\nimport { HardHat, UserPlus } from 'lucide-react'\nimport { db } from '../lib/supabase'\n\nexport default function CrewCheckin({ project, companyId, onShowToast }) {\n  const [workers, setWorkers] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [showAddForm, setShowAddForm] = useState(false)\n  const [newWorker, setNewWorker] = useState({ name: '', role: '', labor_class_id: null })\n\n  // Recent workers for quick-add\n  const [recentWorkers, setRecentWorkers] = useState([])\n  const [loadingRecent, setLoadingRecent] = useState(true)\n\n  // Labor classes from company pricing setup\n  const [laborCategories, setLaborCategories] = useState([])\n  const [laborClasses, setLaborClasses] = useState([])\n  const [loadingClasses, setLoadingClasses] = useState(true)\n\n  // Fallback roles if no custom labor classes are set up\n  const defaultRoles = ['Foreman', 'Laborer', 'Supervisor', 'Operator']\n\n  const loadTodaysCrew = useCallback(async () => {\n    try {\n      const checkin = await db.getCrewCheckin(project.id)\n      if (checkin?.workers) {\n        setWorkers(checkin.workers)\n      }\n    } catch (err) {\n      console.error('Error loading crew:', err)\n      onShowToast?.('Error loading today\\'s crew', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }, [project?.id, onShowToast])\n\n  const loadRecentWorkers = useCallback(async () => {\n    try {\n      const recent = await db.getRecentWorkers(project.id, 30)\n      setRecentWorkers(recent)\n    } catch (err) {\n      console.error('Error loading recent workers:', err)\n      // Non-critical  quick-add still works without recent worker list\n    } finally {\n      setLoadingRecent(false)\n    }\n  }, [project?.id])\n\n  const loadLaborClasses = useCallback(async () => {\n    try {\n      // Use field-safe function that doesn't expose labor rates\n      const data = await db.getLaborClassesForField(companyId)\n      setLaborCategories(data.categories || [])\n      setLaborClasses(data.classes || [])\n\n      // Set default selection to first class if available\n      if (data.classes && data.classes.length > 0) {\n        setNewWorker(prev => ({\n          ...prev,\n          role: data.classes[0].name,\n          labor_class_id: data.classes[0].id\n        }))\n      }\n    } catch (err) {\n      console.error('Error loading labor classes:', err)\n      // Show toast but continue with default roles\n      onShowToast?.('Using default roles - custom labor classes unavailable', 'info')\n    } finally {\n      setLoadingClasses(false)\n    }\n  }, [companyId, onShowToast])\n\n  useEffect(() => {\n    if (project?.id) {\n      loadTodaysCrew()\n      loadRecentWorkers()\n      if (companyId) {\n        loadLaborClasses()\n      } else {\n        setLoadingClasses(false)\n      }\n    }\n  }, [project?.id, companyId, loadTodaysCrew, loadRecentWorkers, loadLaborClasses])\n\n  const handleRoleChange = (value) => {\n    // Check if it's a labor class ID (UUID format)\n    const laborClass = laborClasses.find(lc => lc.id === value)\n    if (laborClass) {\n      setNewWorker({\n        ...newWorker,\n        role: laborClass.name,\n        labor_class_id: laborClass.id\n      })\n    } else {\n      // It's a default role\n      setNewWorker({\n        ...newWorker,\n        role: value,\n        labor_class_id: null\n      })\n    }\n  }\n\n  const handleAddWorker = async () => {\n    if (!newWorker.name.trim()) {\n      onShowToast('Enter worker name', 'error')\n      return\n    }\n\n    if (!newWorker.role) {\n      onShowToast('Select a role', 'error')\n      return\n    }\n\n    // Check for duplicate\n    if (workers.find(w => w.name.toLowerCase() === newWorker.name.trim().toLowerCase())) {\n      onShowToast('Worker already added', 'error')\n      return\n    }\n\n    setSaving(true)\n    try {\n      const updatedWorkers = [...workers, {\n        name: newWorker.name.trim(),\n        role: newWorker.role,\n        labor_class_id: newWorker.labor_class_id\n      }]\n\n      await db.saveCrewCheckin(project.id, updatedWorkers)\n      setWorkers(updatedWorkers)\n\n      // Reset form but keep same role selected for quick entry\n      setNewWorker({ ...newWorker, name: '' })\n      setShowAddForm(false)\n      onShowToast('Crew member added', 'success')\n    } catch (err) {\n      console.error('Error adding worker:', err)\n      onShowToast('Error adding crew member', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleRemoveWorker = async (workerName) => {\n    setSaving(true)\n    try {\n      const updatedWorkers = workers.filter(\n        w => w.name.toLowerCase() !== workerName.toLowerCase()\n      )\n      await db.saveCrewCheckin(project.id, updatedWorkers)\n      setWorkers(updatedWorkers)\n      onShowToast('Crew member removed', 'success')\n    } catch (err) {\n      console.error('Error removing worker:', err)\n      onShowToast('Error removing crew member', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  // Quick-add a recent worker with one tap\n  const handleQuickAdd = async (recentWorker) => {\n    // Check if already added\n    if (workers.find(w => w.name.toLowerCase() === recentWorker.name.toLowerCase())) {\n      onShowToast('Already checked in', 'info')\n      return\n    }\n\n    setSaving(true)\n    try {\n      const updatedWorkers = [...workers, {\n        name: recentWorker.name,\n        role: recentWorker.role,\n        labor_class_id: recentWorker.labor_class_id\n      }]\n      await db.saveCrewCheckin(project.id, updatedWorkers)\n      setWorkers(updatedWorkers)\n      onShowToast(`${recentWorker.name} checked in`, 'success')\n    } catch (err) {\n      console.error('Error adding worker:', err)\n      onShowToast('Error adding crew member', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  // Get recent workers not already checked in today\n  const availableRecentWorkers = recentWorkers.filter(\n    rw => !workers.find(w => w.name.toLowerCase() === rw.name.toLowerCase())\n  )\n\n  const today = new Date().toLocaleDateString('en-US', {\n    weekday: 'long',\n    month: 'short',\n    day: 'numeric'\n  })\n\n  // Group labor classes by category for display\n  const getClassesByCategory = () => {\n    const grouped = {}\n    laborCategories.forEach(cat => {\n      grouped[cat.id] = {\n        name: cat.name,\n        classes: laborClasses.filter(lc => lc.category_id === cat.id)\n      }\n    })\n    // Add uncategorized classes\n    const uncategorized = laborClasses.filter(lc => !lc.category_id)\n    if (uncategorized.length > 0) {\n      grouped['uncategorized'] = {\n        name: 'Other',\n        classes: uncategorized\n      }\n    }\n    return grouped\n  }\n\n  const hasCustomClasses = laborClasses.length > 0\n\n  if (loading || loadingClasses) {\n    return (\n      <div className=\"crew-checkin\">\n        <div className=\"crew-header\">\n          <h3><HardHat size={18} className=\"inline-icon\" /> Today's Crew</h3>\n          <span className=\"crew-date\">{today}</span>\n        </div>\n        <div className=\"crew-loading\">Loading...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"crew-checkin\">\n      <div className=\"crew-header\">\n        <h3><HardHat size={18} className=\"inline-icon\" /> Today's Crew</h3>\n        <span className=\"crew-date\">{today}</span>\n      </div>\n\n      {workers.length === 0 ? (\n        <div className=\"crew-empty\">\n          <p>No crew checked in yet</p>\n          <p className=\"crew-empty-hint\">Add your crew for the day</p>\n        </div>\n      ) : (\n        <div className=\"crew-list\">\n          {workers.map((worker) => (\n            <div key={worker.name} className=\"crew-member\">\n              <div className=\"crew-member-info\">\n                <span className=\"crew-member-name\">{worker.name}</span>\n                <span className={`crew-member-role ${(worker.role || 'laborer').toLowerCase().replace(/\\s+/g, '-')}`}>\n                  {worker.role}\n                </span>\n              </div>\n              <button\n                className=\"crew-remove-btn\"\n                onClick={() => handleRemoveWorker(worker.name)}\n                disabled={saving}\n              >\n                \n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Quick-add recent workers */}\n      {!loadingRecent && availableRecentWorkers.length > 0 && (\n        <div className=\"crew-quick-add\">\n          <div className=\"crew-quick-add-header\">\n            <span>Tap to add</span>\n          </div>\n          <div className=\"crew-quick-add-grid\">\n            {availableRecentWorkers.map(rw => (\n              <button\n                key={rw.name}\n                className=\"crew-quick-add-btn\"\n                onClick={() => handleQuickAdd(rw)}\n                disabled={saving}\n              >\n                <span className=\"crew-quick-add-name\">{rw.name}</span>\n                <span className=\"crew-quick-add-role\">{rw.role}</span>\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Manual add form */}\n      {showAddForm ? (\n        <div className=\"crew-add-form\">\n          <input\n            type=\"text\"\n            value={newWorker.name}\n            onChange={(e) => setNewWorker({ ...newWorker, name: e.target.value })}\n            placeholder=\"Name\"\n            autoFocus\n          />\n          <select\n            value={newWorker.labor_class_id || newWorker.role}\n            onChange={(e) => handleRoleChange(e.target.value)}\n          >\n            {hasCustomClasses ? (\n              // Show labor classes from company pricing\n              Object.entries(getClassesByCategory()).map(([catId, category]) => (\n                <optgroup key={catId} label={category.name}>\n                  {category.classes.map(lc => (\n                    <option key={lc.id} value={lc.id}>\n                      {lc.name}\n                    </option>\n                  ))}\n                </optgroup>\n              ))\n            ) : (\n              // Fallback to default roles\n              defaultRoles.map(role => (\n                <option key={role} value={role}>{role}</option>\n              ))\n            )}\n          </select>\n          <div className=\"crew-add-buttons\">\n            <button\n              className=\"crew-add-confirm\"\n              onClick={handleAddWorker}\n              disabled={saving}\n            >\n              {saving ? '...' : 'Add'}\n            </button>\n            <button\n              className=\"crew-add-cancel\"\n              onClick={() => {\n                setShowAddForm(false)\n                setNewWorker({ name: '', role: laborClasses[0]?.name || 'Laborer', labor_class_id: laborClasses[0]?.id || null })\n              }}\n            >\n              Cancel\n            </button>\n          </div>\n        </div>\n      ) : (\n        <button\n          className=\"crew-add-btn\"\n          onClick={() => setShowAddForm(true)}\n        >\n          <UserPlus size={18} />\n          <span>Add New Person</span>\n        </button>\n      )}\n\n      <div className=\"crew-count\">\n        {workers.length} {workers.length === 1 ? 'person' : 'people'} on site\n      </div>\n    </div>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { HardHat, FileText, AlertTriangle, CheckCircle, Upload } from 'lucide-react'\nimport { db, isSupabaseConfigured } from '../lib/supabase'\n\nexport default function DailyReport({ project, onShowToast, onClose }) {\n  const [loading, setLoading] = useState(true)\n  const [submitting, setSubmitting] = useState(false)\n  const [report, setReport] = useState(null)\n  const [fieldNotes, setFieldNotes] = useState('')\n  const [issues, setIssues] = useState('')\n\n  useEffect(() => {\n    if (project?.id) {\n      loadReport()\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [project?.id])\n\n  const loadReport = async () => {\n    try {\n      // Check for existing report\n      const existing = await db.getDailyReport(project.id)\n      \n      if (existing) {\n        setReport(existing)\n        setFieldNotes(existing.field_notes || '')\n        setIssues(existing.issues || '')\n      } else {\n        // Compile fresh data\n        const compiled = await db.compileDailyReport(project.id)\n        setReport({\n          ...compiled,\n          status: 'draft'\n        })\n      }\n    } catch (err) {\n      console.error('Error loading report:', err)\n      onShowToast('Error loading report', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleSubmit = async () => {\n    // Demo mode warning\n    if (!isSupabaseConfigured) {\n      onShowToast('Demo Mode: Report saved locally only - won\\'t reach office', 'info')\n      onClose()\n      return\n    }\n\n    setSubmitting(true)\n    try {\n      // Save notes first\n      await db.saveDailyReport(project.id, {\n        field_notes: fieldNotes,\n        issues: issues\n      })\n\n      // Then submit\n      const result = await db.submitDailyReport(project.id, 'Field')\n\n      if (result) {\n        onShowToast('Daily report submitted!', 'success')\n        onClose()\n      } else {\n        onShowToast('Report not sent - check connection', 'error')\n      }\n    } catch (err) {\n      console.error('Error submitting report:', err)\n      onShowToast('Error submitting report', 'error')\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  const today = new Date().toLocaleDateString('en-US', { \n    weekday: 'long', \n    month: 'long', \n    day: 'numeric',\n    year: 'numeric'\n  })\n\n  if (loading) {\n    return (\n      <div className=\"daily-report\">\n        <div className=\"daily-report-header\">\n          <button className=\"back-btn-simple\" onClick={onClose}></button>\n          <h2>Daily Report</h2>\n        </div>\n        <div className=\"daily-report-loading\">Compiling report...</div>\n      </div>\n    )\n  }\n\n  // Handle case where report failed to load\n  if (!report) {\n    return (\n      <div className=\"daily-report\">\n        <div className=\"daily-report-header\">\n          <button className=\"back-btn-simple\" onClick={onClose}></button>\n          <h2>Daily Report</h2>\n        </div>\n        <div className=\"daily-report-error\">\n          <p>Unable to load report data.</p>\n          <button className=\"btn btn-secondary\" onClick={loadReport}>Retry</button>\n        </div>\n      </div>\n    )\n  }\n\n  const isSubmitted = report.status === 'submitted'\n\n  return (\n    <div className=\"daily-report\">\n      <div className=\"daily-report-header\">\n        <button className=\"back-btn-simple\" onClick={onClose}></button>\n        <div>\n          <h2>Daily Report</h2>\n          <p className=\"daily-report-date\">{today}</p>\n        </div>\n      </div>\n\n      {isSubmitted && (\n        <div className=\"daily-report-submitted-banner\">\n           Submitted {new Date(report.submitted_at).toLocaleTimeString()}\n        </div>\n      )}\n\n      <div className=\"daily-report-content\">\n        {/* Summary Cards */}\n        <div className=\"daily-report-summary\">\n          <div className=\"daily-report-card\">\n            <div className=\"daily-report-card-value\">{report.crew_count || 0}</div>\n            <div className=\"daily-report-card-label\">Crew on Site</div>\n          </div>\n          <div className=\"daily-report-card\">\n            <div className=\"daily-report-card-value\">{report.tasks_completed || 0}</div>\n            <div className=\"daily-report-card-label\">Tasks Done</div>\n          </div>\n          <div className=\"daily-report-card\">\n            <div className=\"daily-report-card-value\">{report.tm_tickets_count || 0}</div>\n            <div className=\"daily-report-card-label\">T&M Tickets</div>\n          </div>\n          <div className=\"daily-report-card\">\n            <div className=\"daily-report-card-value\">{report.photos_count || 0}</div>\n            <div className=\"daily-report-card-label\">Photos</div>\n          </div>\n        </div>\n\n        {/* Crew List */}\n        {report.crew_list?.length > 0 && (\n          <div className=\"daily-report-section\">\n            <h3><HardHat size={18} className=\"inline-icon\" /> Crew</h3>\n            <div className=\"daily-report-crew\">\n              {report.crew_list.map((worker, i) => (\n                <div key={i} className=\"daily-report-crew-item\">\n                  <span>{worker.name}</span>\n                  <span className=\"daily-report-crew-role\">{worker.role}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Completed Tasks */}\n        {report.completed_tasks?.length > 0 && (\n          <div className=\"daily-report-section\">\n            <h3><CheckCircle size={18} className=\"inline-icon\" /> Completed Today</h3>\n            <ul className=\"daily-report-tasks\">\n              {report.completed_tasks.map((task, i) => (\n                <li key={i}>\n                  {task.name}\n                  {task.group && <span className=\"daily-report-task-group\">{task.group}</span>}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {/* Field Notes */}\n        <div className=\"daily-report-section\">\n          <h3><FileText size={18} className=\"inline-icon\" /> Notes</h3>\n          <textarea\n            value={fieldNotes}\n            onChange={(e) => setFieldNotes(e.target.value)}\n            placeholder=\"Any notes about today's work...\"\n            rows={3}\n            disabled={isSubmitted}\n          />\n        </div>\n\n        {/* Issues */}\n        <div className=\"daily-report-section\">\n          <h3><AlertTriangle size={18} className=\"inline-icon\" /> Issues / Concerns</h3>\n          <textarea\n            value={issues}\n            onChange={(e) => setIssues(e.target.value)}\n            placeholder=\"Any problems, delays, or concerns...\"\n            rows={3}\n            disabled={isSubmitted}\n          />\n        </div>\n      </div>\n\n      {/* Submit Button */}\n      {!isSubmitted && (\n        <div className=\"daily-report-footer\">\n          <button \n            className=\"btn btn-primary daily-report-submit\"\n            onClick={handleSubmit}\n            disabled={submitting}\n          >\n            {submitting ? 'Submitting...' : <><Upload size={16} className=\"inline-icon\" /> Submit Report</>}\n          </button>\n          <p className=\"daily-report-hint\">This will be sent to the office</p>\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect } from 'react'\nimport { Truck, Plus, Minus, Check, X, ChevronDown, ChevronUp, History } from 'lucide-react'\nimport { db } from '../lib/supabase'\n\nconst LOAD_TYPES = [\n  { value: 'concrete', label: 'Concrete', icon: '' },\n  { value: 'trash', label: 'Trash', icon: '' },\n  { value: 'metals', label: 'Metals', icon: '' },\n  { value: 'hazardous_waste', label: 'Hazardous', icon: '' }\n]\n\nconst getLoadTypeInfo = (type) => LOAD_TYPES.find(t => t.value === type) || { label: type, icon: '' }\n\nexport default function DisposalLoadInput({ project, user = null, date, onShowToast }) {\n  const [loads, setLoads] = useState([])\n  const [history, setHistory] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [showAddForm, setShowAddForm] = useState(false)\n  const [showHistory, setShowHistory] = useState(false)\n  const [newLoad, setNewLoad] = useState({ type: 'concrete', count: 1 })\n\n  // Format date for display\n  const displayDate = new Date(date).toLocaleDateString('en-US', {\n    weekday: 'short',\n    month: 'short',\n    day: 'numeric'\n  })\n\n  useEffect(() => {\n    loadDisposalData()\n    loadHistory()\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [project.id, date])\n\n  const loadDisposalData = async () => {\n    try {\n      setLoading(true)\n      const data = await db.getDisposalLoads(project.id, date)\n      setLoads(data || [])\n    } catch (err) {\n      console.error('Error loading disposal loads:', err)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const loadHistory = async () => {\n    try {\n      const data = await db.getDisposalLoadsHistory(project.id, 14) // Last 14 days\n      // Group by date and filter out today\n      const grouped = (data || [])\n        .filter(load => load.load_date !== date)\n        .reduce((acc, load) => {\n          if (!acc[load.load_date]) {\n            acc[load.load_date] = []\n          }\n          acc[load.load_date].push(load)\n          return acc\n        }, {})\n\n      // Convert to array sorted by date descending\n      const historyArray = Object.entries(grouped)\n        .map(([dateStr, loads]) => ({\n          date: dateStr,\n          loads,\n          totalLoads: loads.reduce((sum, l) => sum + l.load_count, 0)\n        }))\n        .sort((a, b) => new Date(b.date) - new Date(a.date))\n\n      setHistory(historyArray)\n    } catch (err) {\n      console.error('Error loading disposal history:', err)\n    }\n  }\n\n  const handleAddLoad = async () => {\n    if (newLoad.count < 1) return\n\n    setSaving(true)\n    try {\n      await db.addDisposalLoad(\n        project.id,\n        user?.id || null,\n        date,\n        newLoad.type,\n        newLoad.count\n      )\n      await loadDisposalData()\n      setNewLoad({ type: 'concrete', count: 1 })\n      setShowAddForm(false)\n      onShowToast?.('Disposal load added', 'success')\n    } catch (err) {\n      console.error('Error adding disposal load:', err)\n      onShowToast?.('Error adding load', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleDeleteLoad = async (id) => {\n    setSaving(true)\n    try {\n      await db.deleteDisposalLoad(id)\n      await loadDisposalData()\n      onShowToast?.('Load removed', 'success')\n    } catch (err) {\n      console.error('Error deleting disposal load:', err)\n      onShowToast?.('Error removing load', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleQuickAdd = async (loadType) => {\n    setSaving(true)\n    try {\n      await db.addDisposalLoad(project.id, user?.id || null, date, loadType, 1)\n      await loadDisposalData()\n      onShowToast?.('Load added', 'success')\n    } catch (err) {\n      console.error('Error adding disposal load:', err)\n      onShowToast?.('Error adding load', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleIncrementLoad = async (load) => {\n    setSaving(true)\n    try {\n      await db.updateDisposalLoad(load.id, load.load_type, load.load_count + 1)\n      await loadDisposalData()\n    } catch (err) {\n      console.error('Error updating load:', err)\n      onShowToast?.('Error updating load', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handleDecrementLoad = async (load) => {\n    if (load.load_count <= 1) {\n      await handleDeleteLoad(load.id)\n      return\n    }\n\n    setSaving(true)\n    try {\n      await db.updateDisposalLoad(load.id, load.load_type, load.load_count - 1)\n      await loadDisposalData()\n    } catch (err) {\n      console.error('Error updating load:', err)\n      onShowToast?.('Error updating load', 'error')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  // Group loads by type for display\n  const loadsByType = loads.reduce((acc, load) => {\n    if (!acc[load.load_type]) {\n      acc[load.load_type] = { items: [], total: 0 }\n    }\n    acc[load.load_type].items.push(load)\n    acc[load.load_type].total += load.load_count\n    return acc\n  }, {})\n\n  const totalLoads = loads.reduce((sum, l) => sum + l.load_count, 0)\n\n  if (loading) {\n    return (\n      <div className=\"disposal-load-input\">\n        <div className=\"disposal-header\">\n          <Truck size={20} />\n          <span>Disposal Loads</span>\n        </div>\n        <div className=\"disposal-loading\">Loading...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"disposal-load-input\">\n      <div className=\"disposal-header\">\n        <div className=\"disposal-title\">\n          <Truck size={20} />\n          <span>Disposal Loads</span>\n          {totalLoads > 0 && (\n            <span className=\"disposal-badge\">{totalLoads}</span>\n          )}\n        </div>\n        <span className=\"disposal-date\">{displayDate}</span>\n      </div>\n\n      {/* Quick Add Buttons */}\n      <div className=\"disposal-quick-add\">\n        {LOAD_TYPES.map(type => (\n          <button\n            key={type.value}\n            className=\"quick-add-btn\"\n            onClick={() => handleQuickAdd(type.value)}\n            disabled={saving}\n          >\n            <span className=\"quick-add-icon\">{type.icon}</span>\n            <span className=\"quick-add-label\">+ {type.label}</span>\n          </button>\n        ))}\n      </div>\n\n      {/* Current Loads */}\n      {Object.keys(loadsByType).length > 0 ? (\n        <div className=\"disposal-loads-list\">\n          {LOAD_TYPES.map(type => {\n            const typeData = loadsByType[type.value]\n            if (!typeData) return null\n\n            return (\n              <div key={type.value} className=\"disposal-load-row\">\n                <div className=\"load-info\">\n                  <span className=\"load-icon\">{type.icon}</span>\n                  <span className=\"load-label\">{type.label}</span>\n                </div>\n                <div className=\"load-controls\">\n                  <button\n                    className=\"load-btn decrement\"\n                    onClick={() => handleDecrementLoad(typeData.items[0])}\n                    disabled={saving}\n                  >\n                    <Minus size={16} />\n                  </button>\n                  <span className=\"load-count\">{typeData.total}</span>\n                  <button\n                    className=\"load-btn increment\"\n                    onClick={() => handleIncrementLoad(typeData.items[0])}\n                    disabled={saving}\n                  >\n                    <Plus size={16} />\n                  </button>\n                </div>\n              </div>\n            )\n          })}\n        </div>\n      ) : (\n        <div className=\"disposal-empty\">\n          <p>No disposal loads recorded for {displayDate}</p>\n          <p className=\"disposal-hint\">Tap a button above to add loads</p>\n        </div>\n      )}\n\n      {/* Add Custom Amount Form */}\n      {showAddForm && (\n        <div className=\"disposal-add-form\">\n          <div className=\"add-form-row\">\n            <select\n              value={newLoad.type}\n              onChange={(e) => setNewLoad({ ...newLoad, type: e.target.value })}\n              className=\"load-type-select\"\n            >\n              {LOAD_TYPES.map(type => (\n                <option key={type.value} value={type.value}>\n                  {type.icon} {type.label}\n                </option>\n              ))}\n            </select>\n            <div className=\"count-input-group\">\n              <button\n                className=\"count-btn\"\n                onClick={() => setNewLoad({ ...newLoad, count: Math.max(1, newLoad.count - 1) })}\n              >\n                <Minus size={16} />\n              </button>\n              <input\n                type=\"number\"\n                min=\"1\"\n                value={newLoad.count}\n                onChange={(e) => setNewLoad({ ...newLoad, count: parseInt(e.target.value) || 1 })}\n                className=\"count-input\"\n              />\n              <button\n                className=\"count-btn\"\n                onClick={() => setNewLoad({ ...newLoad, count: newLoad.count + 1 })}\n              >\n                <Plus size={16} />\n              </button>\n            </div>\n          </div>\n          <div className=\"add-form-actions\">\n            <button\n              className=\"btn btn-secondary btn-small\"\n              onClick={() => setShowAddForm(false)}\n            >\n              <X size={16} /> Cancel\n            </button>\n            <button\n              className=\"btn btn-primary btn-small\"\n              onClick={handleAddLoad}\n              disabled={saving}\n            >\n              <Check size={16} /> Add\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Toggle Custom Form */}\n      {!showAddForm && (\n        <button\n          className=\"disposal-add-custom\"\n          onClick={() => setShowAddForm(true)}\n        >\n          <Plus size={16} />\n          Add multiple loads\n        </button>\n      )}\n\n      {/* Summary */}\n      {totalLoads > 0 && (\n        <div className=\"disposal-summary\">\n          <strong>{totalLoads}</strong> total load{totalLoads !== 1 ? 's' : ''} today\n        </div>\n      )}\n\n      {/* History Section */}\n      {history.length > 0 && (\n        <div className=\"disposal-history-section\">\n          <button\n            className=\"disposal-history-toggle\"\n            onClick={() => setShowHistory(!showHistory)}\n          >\n            <History size={16} />\n            <span>View History ({history.length} days)</span>\n            {showHistory ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\n          </button>\n\n          {showHistory && (\n            <div className=\"disposal-history-list\">\n              {history.map(day => {\n                const formattedDate = new Date(day.date).toLocaleDateString('en-US', {\n                  weekday: 'short',\n                  month: 'short',\n                  day: 'numeric'\n                })\n\n                // Group loads by type for this day\n                const loadsByType = day.loads.reduce((acc, load) => {\n                  if (!acc[load.load_type]) {\n                    acc[load.load_type] = 0\n                  }\n                  acc[load.load_type] += load.load_count\n                  return acc\n                }, {})\n\n                return (\n                  <div key={day.date} className=\"disposal-history-day\">\n                    <div className=\"disposal-history-header\">\n                      <span className=\"disposal-history-date\">{formattedDate}</span>\n                      <span className=\"disposal-history-total\">{day.totalLoads} load{day.totalLoads !== 1 ? 's' : ''}</span>\n                    </div>\n                    <div className=\"disposal-history-types\">\n                      {Object.entries(loadsByType).map(([type, count]) => {\n                        const typeInfo = getLoadTypeInfo(type)\n                        return (\n                          <span key={type} className=\"disposal-history-type\">\n                            {typeInfo.icon} {count} {typeInfo.label}\n                          </span>\n                        )\n                      })}\n                    </div>\n                  </div>\n                )\n              })}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useState, useEffect, useMemo, useCallback, useRef } from 'react'\nimport { db } from '../lib/supabase'\nimport {\n  BarChart, Bar, LineChart, Line, PieChart, Pie, Cell,\n  XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer\n} from 'recharts'\nimport {\n  TrendingUp, Users, FileText, Truck, Calendar,\n  CheckCircle2, Clock, DollarSign, ArrowLeft\n} from 'lucide-react'\n\nexport default function ForemanMetrics({ project, companyId: _companyId, onBack }) {\n  const [loading, setLoading] = useState(true)\n  const [timeRange, setTimeRange] = useState('week') // week, month\n  const [metrics, setMetrics] = useState({\n    areas: [],\n    tickets: [],\n    crewHistory: [],\n    disposalLoads: [],\n    dailyReports: []\n  })\n\n  useEffect(() => {\n    if (project?.id) {\n      loadMetrics()\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [project?.id, timeRange])\n\n  const loadMetrics = async () => {\n    setLoading(true)\n    try {\n      const now = new Date()\n      const startDate = new Date()\n      if (timeRange === 'week') {\n        startDate.setDate(now.getDate() - 7)\n      } else {\n        startDate.setDate(now.getDate() - 30)\n      }\n      const startStr = startDate.toISOString().split('T')[0]\n\n      // Load all data in parallel\n      const days = timeRange === 'week' ? 7 : 30\n      const [areas, tickets, disposalLoads, dailyReports] = await Promise.all([\n        db.getAreas(project.id),\n        db.getTMTickets?.(project.id) || [],\n        db.getDisposalLoadsHistory?.(project.id, days) || [],\n        db.getDailyReports?.(project.id) || []\n      ])\n\n      // Load crew history for each day\n      const crewHistory = []\n      const currentDate = new Date(startDate)\n      while (currentDate <= now) {\n        const dateStr = currentDate.toISOString().split('T')[0]\n        try {\n          const crew = await db.getCrewCheckin(project.id, dateStr)\n          crewHistory.push({\n            date: dateStr,\n            count: crew?.workers?.length || 0,\n            dayName: currentDate.toLocaleDateString('en-US', { weekday: 'short' })\n          })\n        } catch {\n          crewHistory.push({ date: dateStr, count: 0, dayName: currentDate.toLocaleDateString('en-US', { weekday: 'short' }) })\n        }\n        currentDate.setDate(currentDate.getDate() + 1)\n      }\n\n      setMetrics({\n        areas,\n        tickets: tickets.filter(t => t.work_date >= startStr),\n        crewHistory,\n        disposalLoads: disposalLoads,\n        dailyReports: dailyReports.filter(r => r.report_date >= startStr)\n      })\n    } catch (error) {\n      console.error('Error loading metrics:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Real-time subscriptions - reload metrics when underlying data changes\n  const refreshTimeoutRef = useRef(null)\n\n  const debouncedReload = useCallback(() => {\n    if (refreshTimeoutRef.current) clearTimeout(refreshTimeoutRef.current)\n    refreshTimeoutRef.current = setTimeout(() => {\n      loadMetrics()\n    }, 300)\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [project?.id, timeRange])\n\n  useEffect(() => {\n    if (!project?.id) return\n    const subs = []\n\n    const areaSub = db.subscribeToAreas?.(project.id, debouncedReload)\n    if (areaSub) subs.push(areaSub)\n\n    const crewSub = db.subscribeToCrewCheckins?.(project.id, debouncedReload)\n    if (crewSub) subs.push(crewSub)\n\n    const tmSub = db.subscribeToTMTickets?.(project.id, debouncedReload)\n    if (tmSub) subs.push(tmSub)\n\n    const haulSub = db.subscribeToHaulOffs?.(project.id, debouncedReload)\n    if (haulSub) subs.push(haulSub)\n\n    const reportSub = db.subscribeToDailyReports?.(project.id, debouncedReload)\n    if (reportSub) subs.push(reportSub)\n\n    return () => {\n      if (refreshTimeoutRef.current) clearTimeout(refreshTimeoutRef.current)\n      subs.forEach(sub => db.unsubscribe?.(sub))\n    }\n  }, [project?.id, debouncedReload])\n\n  // Calculate derived metrics\n  const derivedMetrics = useMemo(() => {\n    const { areas, tickets, crewHistory, disposalLoads, dailyReports } = metrics\n\n    // Progress stats\n    const totalAreas = areas.length\n    const completedAreas = areas.filter(a => a.status === 'done').length\n    const inProgressAreas = areas.filter(a => a.status === 'working').length\n    const notStartedAreas = areas.filter(a => a.status === 'not_started').length\n    const progressPercent = totalAreas > 0 ? Math.round((completedAreas / totalAreas) * 100) : 0\n\n    // Crew stats\n    const totalManDays = crewHistory.reduce((sum, day) => sum + day.count, 0)\n    const avgCrewSize = crewHistory.length > 0\n      ? Math.round((totalManDays / crewHistory.filter(d => d.count > 0).length) * 10) / 10 || 0\n      : 0\n    const daysWithCrew = crewHistory.filter(d => d.count > 0).length\n\n    // T&M stats\n    const pendingTickets = tickets.filter(t => t.status === 'pending' || t.status === 'draft').length\n    const signedTickets = tickets.filter(t => t.status === 'signed' || t.status === 'approved').length\n    const totalTicketValue = tickets.reduce((sum, t) => sum + (t.total_amount || 0), 0)\n\n    // Disposal stats\n    const totalLoads = disposalLoads.reduce((sum, d) => sum + (d.load_count || 0), 0)\n    const totalTonnage = 0 // tonnage not tracked in disposal_loads\n\n    // Daily reports\n    const reportsSubmitted = dailyReports.filter(r => r.submitted).length\n    const reportsDue = timeRange === 'week' ? 7 : 30\n    const reportStreak = calculateReportStreak(dailyReports)\n\n    return {\n      progress: { totalAreas, completedAreas, inProgressAreas, notStartedAreas, progressPercent },\n      crew: { totalManDays, avgCrewSize, daysWithCrew, history: crewHistory },\n      tickets: { total: tickets.length, pending: pendingTickets, signed: signedTickets, totalValue: totalTicketValue },\n      disposal: { totalLoads, totalTonnage },\n      reports: { submitted: reportsSubmitted, due: reportsDue, streak: reportStreak }\n    }\n  }, [metrics, timeRange])\n\n  // Calculate consecutive days with reports\n  function calculateReportStreak(reports) {\n    if (!reports.length) return 0\n    const sortedDates = [...new Set(reports.filter(r => r.submitted).map(r => r.report_date))].sort().reverse()\n    let streak = 0\n    const today = new Date().toISOString().split('T')[0]\n    const checkDate = new Date(today)\n\n    for (let i = 0; i < 30; i++) {\n      const dateStr = checkDate.toISOString().split('T')[0]\n      if (sortedDates.includes(dateStr)) {\n        streak++\n        checkDate.setDate(checkDate.getDate() - 1)\n      } else {\n        break\n      }\n    }\n    return streak\n  }\n\n  // Chart colors\n  const COLORS = {\n    primary: '#3b82f6',\n    success: '#22c55e',\n    warning: '#f59e0b',\n    danger: '#ef4444',\n    muted: '#6b7280',\n    purple: '#8b5cf6'\n  }\n\n  const PIE_COLORS = [COLORS.success, COLORS.primary, COLORS.muted]\n\n  // Prepare chart data\n  const progressPieData = [\n    { name: 'Completed', value: derivedMetrics.progress.completedAreas },\n    { name: 'In Progress', value: derivedMetrics.progress.inProgressAreas },\n    { name: 'Not Started', value: derivedMetrics.progress.notStartedAreas }\n  ].filter(d => d.value > 0)\n\n  const ticketsByDay = useMemo(() => {\n    const byDay = {}\n    metrics.tickets.forEach(t => {\n      const day = t.work_date\n      byDay[day] = (byDay[day] || 0) + 1\n    })\n    return derivedMetrics.crew.history.map(d => ({\n      ...d,\n      tickets: byDay[d.date] || 0\n    }))\n  }, [metrics.tickets, derivedMetrics.crew.history])\n\n  if (loading) {\n    return (\n      <div className=\"foreman-metrics loading\">\n        <div className=\"metrics-header\">\n          <button className=\"back-btn\" onClick={onBack}>\n            <ArrowLeft size={20} />\n            Back\n          </button>\n          <h2>Project Metrics</h2>\n        </div>\n        <div className=\"loading-state\">\n          <div className=\"spinner\"></div>\n          <p>Loading metrics...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"foreman-metrics\">\n      <div className=\"metrics-header\">\n        <button className=\"back-btn\" onClick={onBack}>\n          <ArrowLeft size={20} />\n          Back\n        </button>\n        <h2>Project Metrics</h2>\n        <div className=\"time-toggle\">\n          <button\n            className={timeRange === 'week' ? 'active' : ''}\n            onClick={() => setTimeRange('week')}\n          >\n            7 Days\n          </button>\n          <button\n            className={timeRange === 'month' ? 'active' : ''}\n            onClick={() => setTimeRange('month')}\n          >\n            30 Days\n          </button>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"summary-cards\">\n        <div className=\"summary-card progress-card\">\n          <div className=\"card-icon\">\n            <TrendingUp size={24} />\n          </div>\n          <div className=\"card-content\">\n            <span className=\"card-value\">{derivedMetrics.progress.progressPercent}%</span>\n            <span className=\"card-label\">Complete</span>\n          </div>\n          <div className=\"card-detail\">\n            {derivedMetrics.progress.completedAreas}/{derivedMetrics.progress.totalAreas} areas\n          </div>\n        </div>\n\n        <div className=\"summary-card crew-card\">\n          <div className=\"card-icon\">\n            <Users size={24} />\n          </div>\n          <div className=\"card-content\">\n            <span className=\"card-value\">{derivedMetrics.crew.totalManDays}</span>\n            <span className=\"card-label\">Man-Days</span>\n          </div>\n          <div className=\"card-detail\">\n            Avg {derivedMetrics.crew.avgCrewSize} workers/day\n          </div>\n        </div>\n\n        <div className=\"summary-card tickets-card\">\n          <div className=\"card-icon\">\n            <FileText size={24} />\n          </div>\n          <div className=\"card-content\">\n            <span className=\"card-value\">{derivedMetrics.tickets.total}</span>\n            <span className=\"card-label\">T&M Tickets</span>\n          </div>\n          <div className=\"card-detail\">\n            {derivedMetrics.tickets.signed} signed, {derivedMetrics.tickets.pending} pending\n          </div>\n        </div>\n\n        <div className=\"summary-card disposal-card\">\n          <div className=\"card-icon\">\n            <Truck size={24} />\n          </div>\n          <div className=\"card-content\">\n            <span className=\"card-value\">{derivedMetrics.disposal.totalLoads}</span>\n            <span className=\"card-label\">Disposal Loads</span>\n          </div>\n          <div className=\"card-detail\">\n            {derivedMetrics.disposal.totalTonnage.toFixed(1)} tons\n          </div>\n        </div>\n      </div>\n\n      {/* Charts Section */}\n      <div className=\"charts-grid\">\n        {/* Progress Pie Chart */}\n        <div className=\"chart-card\">\n          <h3>Area Progress</h3>\n          {progressPieData.length > 0 ? (\n            <ResponsiveContainer width=\"100%\" height={200}>\n              <PieChart>\n                <Pie\n                  data={progressPieData}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  innerRadius={50}\n                  outerRadius={80}\n                  paddingAngle={2}\n                  dataKey=\"value\"\n                  label={({ name, value }) => `${name}: ${value}`}\n                  labelLine={false}\n                >\n                  {progressPieData.map((entry, index) => (\n                    <Cell key={`cell-${index}`} fill={PIE_COLORS[index % PIE_COLORS.length]} />\n                  ))}\n                </Pie>\n                <Tooltip />\n              </PieChart>\n            </ResponsiveContainer>\n          ) : (\n            <div className=\"no-data\">No area data</div>\n          )}\n        </div>\n\n        {/* Crew Trend Chart */}\n        <div className=\"chart-card\">\n          <h3>Daily Crew Size</h3>\n          <ResponsiveContainer width=\"100%\" height={200}>\n            <BarChart data={derivedMetrics.crew.history}>\n              <CartesianGrid strokeDasharray=\"3 3\" opacity={0.3} />\n              <XAxis dataKey=\"dayName\" tick={{ fontSize: 12 }} />\n              <YAxis tick={{ fontSize: 12 }} />\n              <Tooltip\n                formatter={(value) => [value, 'Workers']}\n                labelFormatter={(label) => `Day: ${label}`}\n              />\n              <Bar dataKey=\"count\" fill={COLORS.primary} radius={[4, 4, 0, 0]} />\n            </BarChart>\n          </ResponsiveContainer>\n        </div>\n\n        {/* T&M Tickets Over Time */}\n        <div className=\"chart-card\">\n          <h3>T&M Tickets by Day</h3>\n          <ResponsiveContainer width=\"100%\" height={200}>\n            <LineChart data={ticketsByDay}>\n              <CartesianGrid strokeDasharray=\"3 3\" opacity={0.3} />\n              <XAxis dataKey=\"dayName\" tick={{ fontSize: 12 }} />\n              <YAxis tick={{ fontSize: 12 }} />\n              <Tooltip\n                formatter={(value) => [value, 'Tickets']}\n              />\n              <Line\n                type=\"monotone\"\n                dataKey=\"tickets\"\n                stroke={COLORS.success}\n                strokeWidth={2}\n                dot={{ fill: COLORS.success, strokeWidth: 2 }}\n              />\n            </LineChart>\n          </ResponsiveContainer>\n        </div>\n\n        {/* Activity Summary */}\n        <div className=\"chart-card activity-card\">\n          <h3>Activity Summary</h3>\n          <div className=\"activity-list\">\n            <div className=\"activity-item\">\n              <div className=\"activity-icon\" style={{ backgroundColor: `${COLORS.success}20`, color: COLORS.success }}>\n                <CheckCircle2 size={20} />\n              </div>\n              <div className=\"activity-info\">\n                <span className=\"activity-label\">Days with Crew</span>\n                <span className=\"activity-value\">{derivedMetrics.crew.daysWithCrew} of {timeRange === 'week' ? 7 : 30}</span>\n              </div>\n            </div>\n            <div className=\"activity-item\">\n              <div className=\"activity-icon\" style={{ backgroundColor: `${COLORS.primary}20`, color: COLORS.primary }}>\n                <Calendar size={20} />\n              </div>\n              <div className=\"activity-info\">\n                <span className=\"activity-label\">Reports Submitted</span>\n                <span className=\"activity-value\">{derivedMetrics.reports.submitted}</span>\n              </div>\n            </div>\n            <div className=\"activity-item\">\n              <div className=\"activity-icon\" style={{ backgroundColor: `${COLORS.warning}20`, color: COLORS.warning }}>\n                <Clock size={20} />\n              </div>\n              <div className=\"activity-info\">\n                <span className=\"activity-label\">Report Streak</span>\n                <span className=\"activity-value\">{derivedMetrics.reports.streak} days</span>\n              </div>\n            </div>\n            {derivedMetrics.tickets.totalValue > 0 && (\n              <div className=\"activity-item\">\n                <div className=\"activity-icon\" style={{ backgroundColor: `${COLORS.purple}20`, color: COLORS.purple }}>\n                  <DollarSign size={20} />\n                </div>\n                <div className=\"activity-info\">\n                  <span className=\"activity-label\">T&M Value</span>\n                  <span className=\"activity-value\">${derivedMetrics.tickets.totalValue.toLocaleString()}</span>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <style>{`\n        .foreman-metrics {\n          padding: 1rem;\n          max-width: 100%;\n          overflow-x: hidden;\n        }\n\n        .foreman-metrics.loading {\n          min-height: 400px;\n        }\n\n        .loading-state {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          padding: 3rem;\n          color: var(--text-secondary);\n        }\n\n        .metrics-header {\n          display: flex;\n          align-items: center;\n          gap: 1rem;\n          margin-bottom: 1.5rem;\n          flex-wrap: wrap;\n        }\n\n        .metrics-header h2 {\n          flex: 1;\n          margin: 0;\n          font-size: 1.25rem;\n          color: var(--text-primary);\n        }\n\n        .back-btn {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          padding: 0.5rem 1rem;\n          background: var(--bg-elevated);\n          border: 1px solid var(--border-color);\n          border-radius: 8px;\n          color: var(--text-primary);\n          cursor: pointer;\n          font-size: 0.875rem;\n        }\n\n        .back-btn:hover {\n          background: var(--bg-tertiary);\n        }\n\n        .time-toggle {\n          display: flex;\n          background: var(--bg-elevated);\n          border-radius: 8px;\n          padding: 4px;\n          gap: 4px;\n        }\n\n        .time-toggle button {\n          padding: 0.5rem 1rem;\n          border: none;\n          background: transparent;\n          border-radius: 6px;\n          color: var(--text-secondary);\n          cursor: pointer;\n          font-size: 0.875rem;\n          transition: all 0.2s;\n        }\n\n        .time-toggle button.active {\n          background: var(--primary-color, #3b82f6);\n          color: white;\n        }\n\n        .summary-cards {\n          display: grid;\n          grid-template-columns: repeat(2, 1fr);\n          gap: 1rem;\n          margin-bottom: 1.5rem;\n        }\n\n        @media (min-width: 640px) {\n          .summary-cards {\n            grid-template-columns: repeat(4, 1fr);\n          }\n        }\n\n        .summary-card {\n          background: var(--bg-card);\n          border: 1px solid var(--border-color);\n          border-radius: 12px;\n          padding: 1rem;\n          display: flex;\n          flex-direction: column;\n          gap: 0.5rem;\n        }\n\n        .card-icon {\n          width: 40px;\n          height: 40px;\n          border-radius: 10px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n\n        .progress-card .card-icon {\n          background: #dbeafe;\n          color: #3b82f6;\n        }\n\n        .crew-card .card-icon {\n          background: #dcfce7;\n          color: #22c55e;\n        }\n\n        .tickets-card .card-icon {\n          background: #fef3c7;\n          color: #f59e0b;\n        }\n\n        .disposal-card .card-icon {\n          background: #f3e8ff;\n          color: #8b5cf6;\n        }\n\n        [data-theme=\"dark\"] .progress-card .card-icon {\n          background: #1e3a5f;\n        }\n\n        [data-theme=\"dark\"] .crew-card .card-icon {\n          background: #14532d;\n        }\n\n        [data-theme=\"dark\"] .tickets-card .card-icon {\n          background: #451a03;\n        }\n\n        [data-theme=\"dark\"] .disposal-card .card-icon {\n          background: #3b0764;\n        }\n\n        .card-content {\n          display: flex;\n          flex-direction: column;\n        }\n\n        .card-value {\n          font-size: 1.5rem;\n          font-weight: 700;\n          color: var(--text-primary);\n          line-height: 1.2;\n        }\n\n        .card-label {\n          font-size: 0.75rem;\n          color: var(--text-secondary);\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n        }\n\n        .card-detail {\n          font-size: 0.75rem;\n          color: var(--text-secondary);\n          margin-top: auto;\n        }\n\n        .charts-grid {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 1rem;\n        }\n\n        @media (min-width: 640px) {\n          .charts-grid {\n            grid-template-columns: repeat(2, 1fr);\n          }\n        }\n\n        .chart-card {\n          background: var(--bg-card);\n          border: 1px solid var(--border-color);\n          border-radius: 12px;\n          padding: 1rem;\n        }\n\n        .chart-card h3 {\n          margin: 0 0 1rem 0;\n          font-size: 0.875rem;\n          font-weight: 600;\n          color: var(--text-primary);\n        }\n\n        .no-data {\n          height: 200px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: var(--text-secondary);\n          font-size: 0.875rem;\n        }\n\n        .activity-card {\n          grid-column: 1 / -1;\n        }\n\n        @media (min-width: 640px) {\n          .activity-card {\n            grid-column: auto;\n          }\n        }\n\n        .activity-list {\n          display: flex;\n          flex-direction: column;\n          gap: 0.75rem;\n        }\n\n        .activity-item {\n          display: flex;\n          align-items: center;\n          gap: 0.75rem;\n        }\n\n        .activity-icon {\n          width: 40px;\n          height: 40px;\n          border-radius: 10px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          flex-shrink: 0;\n        }\n\n        .activity-info {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n        }\n\n        .activity-label {\n          font-size: 0.75rem;\n          color: var(--text-secondary);\n        }\n\n        .activity-value {\n          font-size: 1rem;\n          font-weight: 600;\n          color: var(--text-primary);\n        }\n\n        /* Recharts customization */\n        .recharts-cartesian-grid-horizontal line,\n        .recharts-cartesian-grid-vertical line {\n          stroke: var(--border-color);\n        }\n\n        .recharts-text {\n          fill: var(--text-secondary);\n        }\n\n        .recharts-tooltip-wrapper {\n          outline: none;\n        }\n\n        .recharts-default-tooltip {\n          background: var(--bg-card) !important;\n          border: 1px solid var(--border-color) !important;\n          border-radius: 8px !important;\n        }\n\n        .recharts-tooltip-label {\n          color: var(--text-primary) !important;\n        }\n\n        .recharts-tooltip-item {\n          color: var(--text-secondary) !important;\n        }\n      `}</style>\n    </div>\n  )\n}\n","import { useState, useEffect, useCallback, useMemo } from 'react'\nimport {\n  Users, FileText, ClipboardList, CheckSquare, Truck,\n  FolderOpen, AlertTriangle, BarChart2, ChevronDown, ChevronUp,\n  Pin, PinOff, Settings, TrendingUp, Clock, CheckCircle2, ClipboardCheck\n} from 'lucide-react'\n\n/**\n * ForemanLanding - Mobile-first landing page for foremen\n *\n * Features:\n * - Metrics snapshot (tappable for full view)\n * - Pinnable action cards\n * - Collapsible \"More Actions\" section\n * - Zero training required UX\n */\n\n// All available actions with their config\nconst ALL_ACTIONS = {\n  crew: {\n    id: 'crew',\n    label: 'Crew Check-in',\n    icon: Users,\n    description: 'Log who\\'s on site today'\n  },\n  tm: {\n    id: 'tm',\n    label: 'T&M Ticket',\n    icon: FileText,\n    description: 'Create time & materials ticket'\n  },\n  report: {\n    id: 'report',\n    label: 'Daily Report',\n    icon: ClipboardList,\n    description: 'Submit end-of-day report'\n  },\n  progress: {\n    id: 'progress',\n    label: 'Update Progress',\n    icon: CheckSquare,\n    description: 'Mark tasks complete'\n  },\n  disposal: {\n    id: 'disposal',\n    label: 'Disposal Loads',\n    icon: Truck,\n    description: 'Log haul-off loads'\n  },\n  docs: {\n    id: 'docs',\n    label: 'Documents',\n    icon: FolderOpen,\n    description: 'View project files'\n  },\n  metrics: {\n    id: 'metrics',\n    label: 'Project Metrics',\n    icon: BarChart2,\n    description: 'View charts & trends'\n  },\n  punchlist: {\n    id: 'punchlist',\n    label: 'Punch List',\n    icon: ClipboardCheck,\n    description: 'View & resolve punch items'\n  },\n  injury: {\n    id: 'injury',\n    label: 'Report Injury',\n    icon: AlertTriangle,\n    description: 'Log safety incident',\n    isDanger: true\n  }\n}\n\n// Default pinned actions (sensible defaults for new users)\nconst DEFAULT_PINNED = ['crew', 'tm', 'report', 'progress']\n\n// Storage key generator\nconst getPinStorageKey = (projectId) => `fm_pinned_${projectId}`\n\nexport default function ForemanLanding({\n  project,\n  todayStatus,\n  progress,\n  areasWorking,\n  areasDone,\n  areasRemaining,\n  punchListOpenCount,\n  onNavigate,\n  onShowToast\n}) {\n  // Pinned actions state\n  const [pinnedIds, setPinnedIds] = useState(() => {\n    try {\n      const stored = localStorage.getItem(getPinStorageKey(project?.id))\n      return stored ? JSON.parse(stored) : DEFAULT_PINNED\n    } catch {\n      return DEFAULT_PINNED\n    }\n  })\n\n  // Edit mode for customizing pins\n  const [isEditMode, setIsEditMode] = useState(false)\n\n  // More actions collapsed state\n  const [moreCollapsed, setMoreCollapsed] = useState(true)\n\n  // Save pinned actions to localStorage\n  useEffect(() => {\n    if (project?.id) {\n      try {\n        localStorage.setItem(getPinStorageKey(project.id), JSON.stringify(pinnedIds))\n      } catch {\n        // Storage unavailable\n      }\n    }\n  }, [pinnedIds, project?.id])\n\n  // Toggle pin status\n  const togglePin = useCallback((actionId) => {\n    setPinnedIds(prev => {\n      if (prev.includes(actionId)) {\n        // Don't allow unpinning if only one left\n        if (prev.length <= 1) {\n          onShowToast?.('Keep at least one pinned action', 'info')\n          return prev\n        }\n        return prev.filter(id => id !== actionId)\n      } else {\n        // Max 5 pinned\n        if (prev.length >= 5) {\n          onShowToast?.('Maximum 5 pinned actions', 'info')\n          return prev\n        }\n        return [...prev, actionId]\n      }\n    })\n  }, [onShowToast])\n\n  // Get unpinned actions (for \"More Actions\" section)\n  const unpinnedActions = useMemo(() => {\n    return Object.keys(ALL_ACTIONS).filter(id => !pinnedIds.includes(id))\n  }, [pinnedIds])\n\n  // Get status info for an action\n  const getActionStatus = useCallback((actionId) => {\n    switch (actionId) {\n      case 'crew':\n        return {\n          done: todayStatus.crewCheckedIn,\n          badge: todayStatus.crewCheckedIn ? `${todayStatus.crewCount} on site` : null,\n          status: todayStatus.crewCheckedIn ? 'Done today' : 'Not started'\n        }\n      case 'tm':\n        return {\n          done: false,\n          badge: todayStatus.tmTicketsToday > 0 ? `${todayStatus.tmTicketsToday} today` : null,\n          status: todayStatus.tmTicketsToday > 0 ? `${todayStatus.tmTicketsToday} created` : 'Create new'\n        }\n      case 'report':\n        return {\n          done: todayStatus.dailyReportDone,\n          badge: null,\n          status: todayStatus.dailyReportDone ? 'Submitted' : 'Not submitted'\n        }\n      case 'progress':\n        return {\n          done: areasRemaining === 0,\n          badge: areasRemaining > 0 ? `${areasRemaining} left` : null,\n          status: `${progress}% complete`\n        }\n      case 'disposal':\n        return {\n          done: false,\n          badge: todayStatus.disposalLoadsToday > 0 ? `${todayStatus.disposalLoadsToday} today` : null,\n          status: todayStatus.disposalLoadsToday > 0 ? `${todayStatus.disposalLoadsToday} logged` : 'Log loads'\n        }\n      case 'punchlist':\n        return {\n          done: punchListOpenCount === 0 && punchListOpenCount !== undefined,\n          badge: punchListOpenCount > 0 ? `${punchListOpenCount} open` : null,\n          status: punchListOpenCount > 0 ? `${punchListOpenCount} items open` : 'All clear'\n        }\n      default:\n        return { done: false, badge: null, status: null }\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [todayStatus, progress, areasRemaining])\n\n  // Render a pinned action card\n  const renderPinnedAction = (actionId) => {\n    const action = ALL_ACTIONS[actionId]\n    if (!action) return null\n\n    const Icon = action.icon\n    const status = getActionStatus(actionId)\n\n    return (\n      <div key={actionId} className=\"fm-pinned-card-wrapper\">\n        <button\n          className={`fm-pinned-card ${status.done ? 'completed' : ''} ${action.isDanger ? 'danger' : ''}`}\n          onClick={() => !isEditMode && onNavigate(actionId)}\n          disabled={isEditMode}\n        >\n          <div className=\"fm-pinned-icon\">\n            <Icon size={28} />\n          </div>\n          <span className=\"fm-pinned-label\">{action.label}</span>\n          {status.badge && !isEditMode && (\n            <span className=\"fm-pinned-badge\">{status.badge}</span>\n          )}\n          {status.done && !isEditMode && (\n            <div className=\"fm-pinned-check\">\n              <CheckCircle2 size={18} />\n            </div>\n          )}\n        </button>\n        {isEditMode && (\n          <button\n            className=\"fm-pin-toggle pinned\"\n            onClick={() => togglePin(actionId)}\n            aria-label={`Unpin ${action.label}`}\n          >\n            <PinOff size={16} />\n          </button>\n        )}\n      </div>\n    )\n  }\n\n  // Render an unpinned action row\n  const renderUnpinnedAction = (actionId) => {\n    const action = ALL_ACTIONS[actionId]\n    if (!action) return null\n\n    const Icon = action.icon\n    const status = getActionStatus(actionId)\n\n    return (\n      <div key={actionId} className=\"fm-action-row-wrapper\">\n        <button\n          className={`fm-action-row ${action.isDanger ? 'danger' : ''}`}\n          onClick={() => !isEditMode && onNavigate(actionId)}\n          disabled={isEditMode}\n        >\n          <Icon size={20} />\n          <span className=\"fm-action-label\">{action.label}</span>\n          {status.badge && !isEditMode && (\n            <span className=\"fm-action-badge\">{status.badge}</span>\n          )}\n        </button>\n        {isEditMode && (\n          <button\n            className=\"fm-pin-toggle\"\n            onClick={() => togglePin(actionId)}\n            aria-label={`Pin ${action.label}`}\n          >\n            <Pin size={16} />\n          </button>\n        )}\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"fm-landing\">\n      {/* Metrics Snapshot - Tappable */}\n      <button\n        className=\"fm-metrics-snapshot\"\n        onClick={() => onNavigate('metrics')}\n        aria-label=\"View full project metrics\"\n      >\n        <div className=\"fm-snapshot-header\">\n          <TrendingUp size={18} />\n          <span>Project Overview</span>\n          <ChevronDown size={16} className=\"fm-snapshot-arrow\" />\n        </div>\n        <div className=\"fm-snapshot-stats\">\n          <div className=\"fm-snapshot-stat main\">\n            <span className=\"fm-snapshot-value\">{progress}%</span>\n            <span className=\"fm-snapshot-label\">Complete</span>\n          </div>\n          <div className=\"fm-snapshot-divider\" />\n          <div className=\"fm-snapshot-stat\">\n            <span className=\"fm-snapshot-value\">{areasWorking}</span>\n            <span className=\"fm-snapshot-label\">In Progress</span>\n          </div>\n          <div className=\"fm-snapshot-stat\">\n            <span className=\"fm-snapshot-value\">{areasDone}</span>\n            <span className=\"fm-snapshot-label\">Done</span>\n          </div>\n          <div className=\"fm-snapshot-stat\">\n            <span className=\"fm-snapshot-value\">{areasRemaining}</span>\n            <span className=\"fm-snapshot-label\">Remaining</span>\n          </div>\n        </div>\n        {todayStatus.crewCheckedIn && (\n          <div className=\"fm-snapshot-today\">\n            <Clock size={14} />\n            <span>{todayStatus.crewCount} crew on site today</span>\n          </div>\n        )}\n      </button>\n\n      {/* Pinned Actions Header */}\n      <div className=\"fm-section-header\">\n        <h2>Quick Actions</h2>\n        <button\n          className={`fm-edit-btn ${isEditMode ? 'active' : ''}`}\n          onClick={() => setIsEditMode(!isEditMode)}\n          aria-label={isEditMode ? 'Done editing' : 'Customize actions'}\n        >\n          {isEditMode ? 'Done' : <Settings size={18} />}\n        </button>\n      </div>\n\n      {isEditMode && (\n        <p className=\"fm-edit-hint\">Tap icons to pin/unpin actions</p>\n      )}\n\n      {/* Pinned Actions Grid */}\n      <div className=\"fm-pinned-grid\">\n        {pinnedIds.map(renderPinnedAction)}\n      </div>\n\n      {/* More Actions Section */}\n      {unpinnedActions.length > 0 && (\n        <div className=\"fm-more-section\">\n          <button\n            className=\"fm-more-header\"\n            onClick={() => setMoreCollapsed(!moreCollapsed)}\n            aria-expanded={!moreCollapsed}\n          >\n            <span>More Actions</span>\n            {moreCollapsed ? <ChevronDown size={20} /> : <ChevronUp size={20} />}\n          </button>\n\n          {!moreCollapsed && (\n            <div className=\"fm-more-content\">\n              {unpinnedActions.map(renderUnpinnedAction)}\n            </div>\n          )}\n        </div>\n      )}\n\n      <style>{`\n        .fm-landing {\n          padding: 0 1rem 2rem;\n        }\n\n        /* Metrics Snapshot - Premium Hero Card */\n        .fm-metrics-snapshot {\n          width: 100%;\n          background: var(--gradient-blue, linear-gradient(135deg, #3b82f6, #2563eb, #1d4ed8));\n          border: none;\n          border-radius: 16px;\n          padding: 1.25rem;\n          color: white;\n          text-align: left;\n          cursor: pointer;\n          margin-bottom: 1.5rem;\n          transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s ease;\n          box-shadow: 0 4px 15px rgba(59, 130, 246, 0.25), 0 2px 8px rgba(0,0,0,0.15);\n          position: relative;\n          overflow: hidden;\n        }\n\n        .fm-metrics-snapshot::before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          height: 50%;\n          background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, transparent 100%);\n          pointer-events: none;\n          border-radius: 16px 16px 0 0;\n        }\n\n        .fm-metrics-snapshot::after {\n          content: '';\n          position: absolute;\n          bottom: -40px;\n          right: -40px;\n          width: 160px;\n          height: 160px;\n          background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%);\n          pointer-events: none;\n        }\n\n        .fm-metrics-snapshot:active {\n          transform: scale(0.98);\n        }\n\n        .fm-snapshot-header {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          font-size: 0.875rem;\n          opacity: 0.9;\n          margin-bottom: 0.875rem;\n          font-weight: 500;\n          position: relative;\n          z-index: 1;\n        }\n\n        .fm-snapshot-arrow {\n          margin-left: auto;\n          opacity: 0.7;\n        }\n\n        .fm-snapshot-stats {\n          display: flex;\n          align-items: center;\n          gap: 0.875rem;\n          position: relative;\n          z-index: 1;\n        }\n\n        .fm-snapshot-stat {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          flex: 1;\n        }\n\n        .fm-snapshot-stat.main {\n          flex: 1.5;\n          align-items: flex-start;\n        }\n\n        .fm-snapshot-value {\n          font-size: 1.625rem;\n          font-weight: 700;\n          line-height: 1.2;\n          font-variant-numeric: tabular-nums;\n          letter-spacing: -0.02em;\n        }\n\n        .fm-snapshot-stat.main .fm-snapshot-value {\n          font-size: 2.25rem;\n        }\n\n        .fm-snapshot-label {\n          font-size: 0.68rem;\n          opacity: 0.85;\n          text-transform: uppercase;\n          letter-spacing: 0.06em;\n          font-weight: 600;\n          margin-top: 0.1rem;\n        }\n\n        .fm-snapshot-divider {\n          width: 1px;\n          height: 44px;\n          background: rgba(255,255,255,0.25);\n        }\n\n        .fm-snapshot-today {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n          margin-top: 0.875rem;\n          padding-top: 0.875rem;\n          border-top: 1px solid rgba(255,255,255,0.15);\n          font-size: 0.8rem;\n          opacity: 0.9;\n          font-weight: 500;\n          position: relative;\n          z-index: 1;\n        }\n\n        /* Section Header */\n        .fm-section-header {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          margin-bottom: 0.875rem;\n        }\n\n        .fm-section-header h2 {\n          font-size: 1.05rem;\n          font-weight: 700;\n          color: var(--text-primary);\n          margin: 0;\n          letter-spacing: -0.01em;\n        }\n\n        .fm-edit-btn {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          padding: 0.5rem;\n          background: var(--gradient-card-dark, var(--bg-elevated));\n          border: 1px solid var(--border-color);\n          border-radius: 10px;\n          color: var(--text-secondary);\n          cursor: pointer;\n          font-size: 0.8rem;\n          min-width: 36px;\n          min-height: 36px;\n          transition: all 0.2s ease;\n          box-shadow: var(--shadow-sm, 0 1px 2px rgba(0,0,0,0.1));\n        }\n\n        .fm-edit-btn:hover {\n          border-color: var(--accent-blue, #3b82f6);\n        }\n\n        .fm-edit-btn.active {\n          background: var(--gradient-blue, var(--primary-color, #3b82f6));\n          border-color: transparent;\n          color: white;\n          padding: 0.5rem 1rem;\n          box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);\n        }\n\n        .fm-edit-hint {\n          font-size: 0.8rem;\n          color: var(--text-secondary);\n          margin: 0 0 0.75rem;\n          text-align: center;\n          font-weight: 500;\n        }\n\n        /* Pinned Actions Grid */\n        .fm-pinned-grid {\n          display: grid;\n          grid-template-columns: repeat(2, 1fr);\n          gap: 0.875rem;\n          margin-bottom: 1.5rem;\n        }\n\n        .fm-pinned-card-wrapper {\n          position: relative;\n        }\n\n        .fm-pinned-card {\n          width: 100%;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          padding: 1.375rem 1rem;\n          background: var(--gradient-card-dark, var(--bg-card));\n          border: 1px solid var(--border-color);\n          border-radius: 14px;\n          cursor: pointer;\n          transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n          min-height: 114px;\n          position: relative;\n          box-shadow: var(--shadow-card, 0 1px 3px rgba(0,0,0,0.1));\n          overflow: hidden;\n        }\n\n        .fm-pinned-card::before {\n          content: '';\n          position: absolute;\n          bottom: 0;\n          left: 0;\n          right: 0;\n          height: 2px;\n          background: var(--gradient-blue, linear-gradient(90deg, #3b82f6, #2563eb));\n          opacity: 0;\n          transition: opacity 0.2s ease;\n        }\n\n        .fm-pinned-card:hover:not(:disabled) {\n          transform: translateY(-2px);\n          box-shadow: var(--shadow-card-hover, 0 8px 25px rgba(0,0,0,0.15));\n          border-color: rgba(59, 130, 246, 0.3);\n        }\n\n        .fm-pinned-card:hover:not(:disabled)::before {\n          opacity: 1;\n        }\n\n        .fm-pinned-card:active:not(:disabled) {\n          transform: scale(0.97);\n        }\n\n        .fm-pinned-card:disabled {\n          opacity: 0.7;\n          cursor: default;\n        }\n\n        .fm-pinned-card.completed {\n          border-color: rgba(34, 197, 94, 0.4);\n          background: linear-gradient(135deg, rgba(34, 197, 94, 0.08) 0%, rgba(34, 197, 94, 0.03) 100%);\n        }\n\n        .fm-pinned-card.completed::before {\n          background: linear-gradient(90deg, #22c55e, #16a34a);\n          opacity: 1;\n        }\n\n        .fm-pinned-card.danger {\n          border-color: rgba(245, 158, 11, 0.4);\n        }\n\n        .fm-pinned-card.danger::before {\n          background: linear-gradient(90deg, #f59e0b, #d97706);\n        }\n\n        .fm-pinned-card.danger .fm-pinned-icon {\n          color: #f59e0b;\n        }\n\n        .fm-pinned-icon {\n          color: var(--primary-color, #3b82f6);\n          margin-bottom: 0.625rem;\n          transition: transform 0.2s ease;\n        }\n\n        .fm-pinned-card:hover:not(:disabled) .fm-pinned-icon {\n          transform: scale(1.08);\n        }\n\n        .fm-pinned-label {\n          font-size: 0.875rem;\n          font-weight: 600;\n          color: var(--text-primary);\n          text-align: center;\n          letter-spacing: -0.01em;\n        }\n\n        .fm-pinned-badge {\n          position: absolute;\n          top: 8px;\n          right: 8px;\n          background: var(--gradient-blue, var(--primary-color, #3b82f6));\n          color: white;\n          font-size: 0.68rem;\n          font-weight: 700;\n          padding: 0.2rem 0.55rem;\n          border-radius: 10px;\n          box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);\n        }\n\n        .fm-pinned-check {\n          position: absolute;\n          top: 8px;\n          right: 8px;\n          color: #22c55e;\n          filter: drop-shadow(0 1px 3px rgba(34, 197, 94, 0.3));\n        }\n\n        .fm-pin-toggle {\n          position: absolute;\n          top: -8px;\n          right: -8px;\n          width: 28px;\n          height: 28px;\n          border-radius: 50%;\n          background: var(--bg-card);\n          border: 2px solid var(--border-color);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          cursor: pointer;\n          color: var(--text-secondary);\n          transition: all 0.2s ease;\n          z-index: 10;\n          box-shadow: 0 2px 6px rgba(0,0,0,0.15);\n        }\n\n        .fm-pin-toggle:hover {\n          background: var(--bg-elevated);\n          transform: scale(1.1);\n        }\n\n        .fm-pin-toggle.pinned {\n          background: #ef4444;\n          border-color: #ef4444;\n          color: white;\n          box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);\n        }\n\n        /* More Actions Section */\n        .fm-more-section {\n          background: var(--gradient-card-dark, var(--bg-card));\n          border: 1px solid var(--border-color);\n          border-radius: 14px;\n          overflow: hidden;\n          box-shadow: var(--shadow-card, 0 1px 3px rgba(0,0,0,0.1));\n        }\n\n        .fm-more-header {\n          width: 100%;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 1rem 1.125rem;\n          background: transparent;\n          border: none;\n          cursor: pointer;\n          font-size: 0.9rem;\n          font-weight: 600;\n          color: var(--text-primary);\n          transition: background 0.15s ease;\n        }\n\n        .fm-more-header:hover {\n          background: var(--bg-secondary, rgba(255,255,255,0.02));\n        }\n\n        .fm-more-header:active {\n          background: var(--bg-elevated);\n        }\n\n        .fm-more-content {\n          border-top: 1px solid var(--border-color);\n        }\n\n        .fm-action-row-wrapper {\n          position: relative;\n          display: flex;\n          align-items: center;\n        }\n\n        .fm-action-row-wrapper .fm-pin-toggle {\n          position: static;\n          margin-right: 0.75rem;\n          flex-shrink: 0;\n        }\n\n        .fm-action-row {\n          flex: 1;\n          display: flex;\n          align-items: center;\n          gap: 0.875rem;\n          padding: 1.125rem;\n          background: transparent;\n          border: none;\n          border-bottom: 1px solid var(--border-color);\n          cursor: pointer;\n          text-align: left;\n          color: var(--text-primary);\n          transition: all 0.2s ease;\n        }\n\n        .fm-action-row:last-child {\n          border-bottom: none;\n        }\n\n        .fm-action-row:hover:not(:disabled) {\n          background: var(--bg-secondary, rgba(255,255,255,0.02));\n          padding-left: 1.25rem;\n        }\n\n        .fm-action-row:active:not(:disabled) {\n          background: var(--bg-elevated);\n        }\n\n        .fm-action-row:disabled {\n          opacity: 0.7;\n          cursor: default;\n        }\n\n        .fm-action-row.danger {\n          color: #f59e0b;\n        }\n\n        .fm-action-row svg {\n          transition: color 0.15s ease;\n        }\n\n        .fm-action-row:hover:not(:disabled) svg {\n          color: var(--accent-blue, #3b82f6);\n        }\n\n        .fm-action-row.danger:hover:not(:disabled) svg {\n          color: #f59e0b;\n        }\n\n        .fm-action-label {\n          flex: 1;\n          font-size: 0.9rem;\n          font-weight: 500;\n        }\n\n        .fm-action-badge {\n          font-size: 0.72rem;\n          color: var(--text-secondary);\n          background: var(--bg-elevated);\n          padding: 0.25rem 0.625rem;\n          border-radius: 20px;\n          font-weight: 600;\n        }\n\n        /* Dark mode adjustments */\n        [data-theme=\"dark\"] .fm-metrics-snapshot {\n          background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 60%, #172554 100%);\n          box-shadow: 0 4px 20px rgba(30, 64, 175, 0.3), 0 2px 8px rgba(0,0,0,0.2);\n        }\n\n        [data-theme=\"dark\"] .fm-pinned-card.completed {\n          background: linear-gradient(135deg, rgba(34, 197, 94, 0.12) 0%, rgba(34, 197, 94, 0.04) 100%);\n        }\n      `}</style>\n    </div>\n  )\n}\n","import { useState, useEffect, useCallback, useRef } from 'react'\nimport { db, isSupabaseConfigured, getSupabaseClient } from '../lib/supabase'\nimport { calculateProgress } from '../lib/utils'\nimport {\n  Info, CheckSquare,\n  ArrowLeft, ChevronDown, ChevronRight,\n  Clock, CheckCircle2, Moon, Sun\n} from 'lucide-react'\nimport TMForm from './TMForm'\nimport CrewCheckin from './CrewCheckin'\nimport DailyReport from './DailyReport'\nimport InjuryReportForm from './InjuryReportForm'\nimport DisposalLoadInput from './DisposalLoadInput'\nimport FolderGrid from './documents/FolderGrid'\nimport ForemanMetrics from './ForemanMetrics'\nimport ForemanLanding from './ForemanLanding'\nimport PunchList from './PunchList'\n\nexport default function ForemanView({ project, companyId, foremanName, onShowToast, onExit }) {\n  const [areas, setAreas] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [updating, setUpdating] = useState(null)\n  const [expandedGroups, setExpandedGroups] = useState({})\n\n  // View states\n  const [activeView, setActiveView] = useState('home') // home, crew, tm, disposal, report, injury, docs, progress, punchlist\n  const [showProjectInfo, setShowProjectInfo] = useState(false)\n\n  // Punch list open count for badge\n  const [punchListOpenCount, setPunchListOpenCount] = useState(0)\n\n  // Today's activity status (for smart cards)\n  const [todayStatus, setTodayStatus] = useState({\n    crewCheckedIn: false,\n    crewCount: 0,\n    tmTicketsToday: 0,\n    dailyReportDone: false,\n    disposalLoadsToday: 0\n  })\n\n  // Theme\n  const [isDark, setIsDark] = useState(() => {\n    if (typeof window !== 'undefined') {\n      return document.documentElement.getAttribute('data-theme') === 'dark'\n    }\n    return false\n  })\n\n  // Get current hour for time-based UI\n  const currentHour = new Date().getHours()\n  const _isMorning = currentHour >= 5 && currentHour < 12\n  const _isAfternoon = currentHour >= 12 && currentHour < 17\n  const _isEvening = currentHour >= 17 || currentHour < 5\n\n  useEffect(() => {\n    if (project?.id) {\n      loadAreas()\n      loadTodayStatus()\n      loadPunchListCount()\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [project?.id])\n\n  // Load today's activity status\n  const loadTodayStatus = async () => {\n    try {\n      const today = new Date().toISOString().split('T')[0]\n\n      // Load crew check-in for today (returns single object with .workers array, or null)\n      const crew = await db.getCrewCheckin(project.id, today)\n      const crewWorkers = crew?.workers || []\n      const crewCheckedIn = crewWorkers.length > 0\n\n      // Load T&M tickets for today\n      const tickets = await db.getTMTickets?.(project.id) || []\n      const todayTickets = tickets.filter(t => t.work_date === today)\n\n      // Load disposal loads for today\n      const disposal = await db.getDisposalLoads?.(project.id, today) || []\n\n      setTodayStatus({\n        crewCheckedIn,\n        crewCount: crewWorkers.length,\n        tmTicketsToday: todayTickets.length,\n        dailyReportDone: false, // We'll track this separately\n        disposalLoadsToday: disposal.reduce((sum, d) => sum + (d.load_count || 1), 0)\n      })\n    } catch (error) {\n      console.error('Error loading today status:', error)\n    }\n  }\n\n  // Load open punch list item count for badge\n  const loadPunchListCount = async () => {\n    if (!project?.id || !isSupabaseConfigured) return\n    try {\n      const { count } = await getSupabaseClient()\n        .from('punch_list_items')\n        .select('*', { count: 'exact', head: true })\n        .eq('project_id', project.id)\n        .eq('status', 'open')\n      setPunchListOpenCount(count || 0)\n    } catch {\n      // Table may not exist yet\n    }\n  }\n\n  // Real-time subscriptions for live updates\n  const refreshTimeoutRef = useRef(null)\n\n  const debouncedRefresh = useCallback(() => {\n    if (refreshTimeoutRef.current) clearTimeout(refreshTimeoutRef.current)\n    refreshTimeoutRef.current = setTimeout(() => {\n      loadAreas()\n      loadTodayStatus()\n    }, 300)\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [project?.id])\n\n  useEffect(() => {\n    if (!project?.id) return\n    const subs = []\n\n    const areaSub = db.subscribeToAreas?.(project.id, debouncedRefresh)\n    if (areaSub) subs.push(areaSub)\n\n    const crewSub = db.subscribeToCrewCheckins?.(project.id, debouncedRefresh)\n    if (crewSub) subs.push(crewSub)\n\n    const tmSub = db.subscribeToTMTickets?.(project.id, debouncedRefresh)\n    if (tmSub) subs.push(tmSub)\n\n    const haulSub = db.subscribeToHaulOffs?.(project.id, debouncedRefresh)\n    if (haulSub) subs.push(haulSub)\n\n    const reportSub = db.subscribeToDailyReports?.(project.id, debouncedRefresh)\n    if (reportSub) subs.push(reportSub)\n\n    // COR status changes from office (approvals, rejections)\n    const corSub = db.subscribeToCORs?.(project.id, debouncedRefresh)\n    if (corSub) subs.push(corSub)\n\n    // Material request responses from office\n    const matReqSub = db.subscribeToMaterialRequests?.(project.id, debouncedRefresh)\n    if (matReqSub) subs.push(matReqSub)\n\n    // Project-level changes from office (name, dates, budget)\n    const projectSub = db.subscribeToProject?.(project.id, debouncedRefresh)\n    if (projectSub) subs.push(projectSub)\n\n    // Punch list changes (office resolves items, or field teammate creates items)\n    const punchSub = db.subscribeToPunchList?.(project.id, () => {\n      loadPunchListCount()\n      debouncedRefresh()\n    })\n    if (punchSub) subs.push(punchSub)\n\n    // Materials/equipment pricing changes from office\n    if (companyId) {\n      const materialsSub = db.subscribeToMaterialsEquipment?.(companyId, debouncedRefresh)\n      if (materialsSub) subs.push(materialsSub)\n\n      const laborSub = db.subscribeToLaborRates?.(companyId, debouncedRefresh)\n      if (laborSub) subs.push(laborSub)\n    }\n\n    return () => {\n      if (refreshTimeoutRef.current) clearTimeout(refreshTimeoutRef.current)\n      subs.forEach(sub => db.unsubscribe?.(sub))\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [project?.id, debouncedRefresh])\n\n  const loadAreas = async () => {\n    try {\n      const data = await db.getAreas(project.id)\n      setAreas(data)\n      const groups = [...new Set(data.map(a => a.group_name || 'General'))]\n      const expanded = {}\n      groups.forEach(g => expanded[g] = false)\n      setExpandedGroups(expanded)\n    } catch (error) {\n      console.error('Error loading areas:', error)\n      onShowToast?.('Error loading areas', 'error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleStatusUpdate = async (areaId, newStatus) => {\n    const area = areas.find(a => a.id === areaId)\n    if (!area) return\n    const finalStatus = area.status === newStatus ? 'not_started' : newStatus\n    setUpdating(areaId)\n    try {\n      await db.updateAreaStatus(areaId, finalStatus)\n      setAreas(prev => prev.map(a => a.id === areaId ? { ...a, status: finalStatus } : a))\n    } catch (error) {\n      console.error('Error updating status:', error)\n      onShowToast?.('Error updating', 'error')\n    } finally {\n      setUpdating(null)\n    }\n  }\n\n  const toggleGroup = (group) => {\n    setExpandedGroups(prev => ({ ...prev, [group]: !prev[group] }))\n  }\n\n  const toggleTheme = () => {\n    const newTheme = isDark ? 'light' : 'dark'\n    document.documentElement.setAttribute('data-theme', newTheme)\n    localStorage.setItem('theme', newTheme)\n    setIsDark(!isDark)\n  }\n\n  // Calculate stats\n  const progress = calculateProgress(areas)\n  const areasDone = areas.filter(a => a.status === 'done').length\n  const areasWorking = areas.filter(a => a.status === 'working').length\n  const areasRemaining = areas.length - areasDone\n\n  // Group areas\n  const groupedAreas = areas.reduce((acc, area) => {\n    const group = area.group_name || 'General'\n    if (!acc[group]) acc[group] = []\n    acc[group].push(area)\n    return acc\n  }, {})\n\n  const hasGroups = Object.keys(groupedAreas).length > 1 ||\n    (Object.keys(groupedAreas).length === 1 && !groupedAreas['General'])\n\n  const getGroupProgress = (groupAreas) => {\n    const done = groupAreas.filter(a => a.status === 'done').length\n    return `${done}/${groupAreas.length}`\n  }\n\n  // Navigation handler for ForemanLanding (must be before early returns)\n  const handleNavigate = useCallback((viewId) => {\n    setActiveView(viewId)\n  }, [])\n\n  // T&M Form View\n  if (activeView === 'tm') {\n    return (\n      <div className=\"fm-view\">\n        <TMForm\n          project={project}\n          companyId={companyId}\n          onSubmit={() => setActiveView('home')}\n          onCancel={() => setActiveView('home')}\n          onShowToast={onShowToast}\n        />\n      </div>\n    )\n  }\n\n  // Daily Report View\n  if (activeView === 'report') {\n    return (\n      <DailyReport\n        project={project}\n        onShowToast={onShowToast}\n        onClose={() => setActiveView('home')}\n      />\n    )\n  }\n\n  // Injury Report View\n  if (activeView === 'injury') {\n    return (\n      <div className=\"fm-view\">\n        <InjuryReportForm\n          project={project}\n          companyId={companyId}\n          onClose={() => setActiveView('home')}\n          onReportCreated={() => {\n            setActiveView('home')\n            onShowToast?.('Injury report submitted', 'success')\n          }}\n        />\n      </div>\n    )\n  }\n\n  // Crew Check-in View\n  if (activeView === 'crew') {\n    return (\n      <div className=\"fm-view\">\n        <div className=\"fm-subheader\">\n          <button className=\"fm-back\" onClick={() => setActiveView('home')}>\n            <ArrowLeft size={20} />\n          </button>\n          <h2>Crew Check-in</h2>\n        </div>\n        <CrewCheckin project={project} companyId={companyId} onShowToast={onShowToast} />\n      </div>\n    )\n  }\n\n  // Disposal Loads View\n  if (activeView === 'disposal') {\n    return (\n      <div className=\"fm-view\">\n        <div className=\"fm-subheader\">\n          <button className=\"fm-back\" onClick={() => setActiveView('home')}>\n            <ArrowLeft size={20} />\n          </button>\n          <h2>Disposal Loads</h2>\n        </div>\n        <DisposalLoadInput\n          project={project}\n          date={new Date().toISOString().split('T')[0]}\n          onShowToast={onShowToast}\n        />\n      </div>\n    )\n  }\n\n  // Documents View\n  if (activeView === 'docs') {\n    return (\n      <div className=\"fm-view\">\n        <div className=\"fm-subheader\">\n          <button className=\"fm-back\" onClick={() => setActiveView('home')}>\n            <ArrowLeft size={20} />\n          </button>\n          <h2>Documents</h2>\n        </div>\n        <FolderGrid projectId={project.id} onShowToast={onShowToast} />\n      </div>\n    )\n  }\n\n  // Metrics View\n  if (activeView === 'metrics') {\n    return (\n      <ForemanMetrics\n        project={project}\n        companyId={companyId}\n        onBack={() => setActiveView('home')}\n      />\n    )\n  }\n\n  // Punch List View\n  if (activeView === 'punchlist') {\n    return (\n      <div className=\"fm-view\">\n        <div className=\"fm-subheader\">\n          <button className=\"fm-back\" onClick={() => { setActiveView('home'); loadPunchListCount() }}>\n            <ArrowLeft size={20} />\n          </button>\n          <h2>Punch List</h2>\n        </div>\n        <PunchList\n          projectId={project.id}\n          areas={areas}\n          companyId={companyId}\n          onShowToast={onShowToast}\n        />\n      </div>\n    )\n  }\n\n  // Progress View\n  if (activeView === 'progress') {\n    return (\n      <div className=\"fm-view\">\n        <div className=\"fm-subheader\">\n          <button className=\"fm-back\" onClick={() => setActiveView('home')}>\n            <ArrowLeft size={20} />\n          </button>\n          <h2>Progress</h2>\n          <span className=\"fm-subheader-badge\">{progress}%</span>\n        </div>\n\n        <div className=\"fm-progress-content\">\n          {loading ? (\n            <div className=\"fm-loading\">\n              <div className=\"spinner\"></div>\n              <span>Loading...</span>\n            </div>\n          ) : areas.length === 0 ? (\n            <div className=\"fm-empty\">\n              <CheckSquare size={48} />\n              <h3>No tasks yet</h3>\n              <p>Office will add tasks to this project</p>\n            </div>\n          ) : hasGroups ? (\n            Object.entries(groupedAreas).map(([group, groupAreas]) => (\n              <div key={group} className=\"fm-group\">\n                <button className=\"fm-group-header\" onClick={() => toggleGroup(group)}>\n                  <div className=\"fm-group-left\">\n                    {expandedGroups[group] ? <ChevronDown size={18} /> : <ChevronRight size={18} />}\n                    <span>{group}</span>\n                  </div>\n                  <span className=\"fm-group-count\">{getGroupProgress(groupAreas)}</span>\n                </button>\n                {expandedGroups[group] && (\n                  <div className=\"fm-group-items\">\n                    {groupAreas.map(area => (\n                      <div key={area.id} className={`fm-task ${area.status}`}>\n                        <span className=\"fm-task-name\">{area.name}</span>\n                        <div className=\"fm-task-btns\">\n                          <button\n                            className={`fm-status-btn working ${area.status === 'working' ? 'active' : ''}`}\n                            onClick={() => handleStatusUpdate(area.id, 'working')}\n                            disabled={updating === area.id}\n                          >\n                            <Clock size={14} />\n                          </button>\n                          <button\n                            className={`fm-status-btn done ${area.status === 'done' ? 'active' : ''}`}\n                            onClick={() => handleStatusUpdate(area.id, 'done')}\n                            disabled={updating === area.id}\n                          >\n                            <CheckCircle2 size={14} />\n                          </button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            ))\n          ) : (\n            <div className=\"fm-task-list\">\n              {areas.map(area => (\n                <div key={area.id} className={`fm-task ${area.status}`}>\n                  <span className=\"fm-task-name\">{area.name}</span>\n                  <div className=\"fm-task-btns\">\n                    <button\n                      className={`fm-status-btn working ${area.status === 'working' ? 'active' : ''}`}\n                      onClick={() => handleStatusUpdate(area.id, 'working')}\n                      disabled={updating === area.id}\n                    >\n                      <Clock size={14} />\n                    </button>\n                    <button\n                      className={`fm-status-btn done ${area.status === 'done' ? 'active' : ''}`}\n                      onClick={() => handleStatusUpdate(area.id, 'done')}\n                      disabled={updating === area.id}\n                    >\n                      <CheckCircle2 size={14} />\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    )\n  }\n\n  // HOME VIEW - New Mobile Landing Page\n  return (\n    <div className=\"fm-view\">\n      {/* Header */}\n      <div className=\"fm-header\">\n        <button className=\"fm-exit\" onClick={onExit}>\n          <ArrowLeft size={20} />\n        </button>\n        <div className=\"fm-header-center\">\n          <h1 className=\"fm-project-name\">{project.name}</h1>\n          {foremanName && (\n            <span className=\"fm-foreman-name\">{foremanName}</span>\n          )}\n          <button className=\"fm-info-toggle\" onClick={() => setShowProjectInfo(!showProjectInfo)}>\n            <Info size={16} />\n          </button>\n        </div>\n        <button className=\"fm-theme\" onClick={toggleTheme}>\n          {isDark ? <Sun size={20} /> : <Moon size={20} />}\n        </button>\n      </div>\n\n      {/* Project Info (collapsible) */}\n      {showProjectInfo && (\n        <div className=\"fm-project-info\">\n          {project.job_number && <div className=\"fm-info-item\"><span>Job #</span><span>{project.job_number}</span></div>}\n          {project.address && <div className=\"fm-info-item\"><span>Address</span><span>{project.address}</span></div>}\n          {project.general_contractor && <div className=\"fm-info-item\"><span>GC</span><span>{project.general_contractor}</span></div>}\n          {project.client_phone && (\n            <div className=\"fm-info-item\">\n              <span>Phone</span>\n              <a href={`tel:${project.client_phone}`}>{project.client_phone}</a>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* New Mobile-First Landing Page */}\n      <ForemanLanding\n        project={project}\n        todayStatus={todayStatus}\n        progress={progress}\n        areasWorking={areasWorking}\n        areasDone={areasDone}\n        areasRemaining={areasRemaining}\n        punchListOpenCount={punchListOpenCount}\n        onNavigate={handleNavigate}\n        onShowToast={onShowToast}\n      />\n    </div>\n  )\n}\n"],"file":"ForemanView-C4VgT-X3.js"}